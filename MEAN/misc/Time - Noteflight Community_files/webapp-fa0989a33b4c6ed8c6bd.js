/*******************************************************************************
 *
 * NOTEFLIGHT LLC
 * Copyright 2019 Noteflight LLC
 * All Rights Reserved
 *
 * @license
 *******************************************************************************/!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/assets/",o(o.s=342)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resource=a,t.resourceIfFound=function(e){if(s(e))return a(e);return e},t.hasResource=s,t.pluralize=function(e,t){var o;switch(t){case 0:o=".zero";break;case 1:o=".one";break;default:o=".other"}r.$.i18n.map[e+o]||(o=".other");var n=Array.prototype.slice.call(arguments,1);return n.unshift(e+o),r.$.i18n.prop.apply(r.$.i18n.prop,n)},t.testResources=c,t.findValidLocale=u,t.initializeResources=function(e){if(window.location.href.includes("/laboratory/test3")||"test"==r.NF.environment)return e.callback();var t={name:"Resources",path:"resources/",mode:"map",language:u(r.NF.session.locale()),cache:!0,testResources:c};r.$.extend(t,e),r.$.i18n.properties(t)};var r=o(6),n=o(16),i=o(27);function a(){return r.$.i18n.prop.apply(r.$.i18n.prop,arguments)}function s(e){return!!r.$.i18n.map[e]}o(174);var l="_nf_testResources";function c(e){if(0===arguments.length)return(0,i.hasStorage)()?localStorage.getItem(l):null;(0,i.hasStorage)()&&(null===e?localStorage.removeItem(l):localStorage.setItem(l,e))}function u(e){var t=e||"en";if(!(0,n.assetExists)("resources/Resources_"+t+".properties")){var o=t.slice(0,2);t=(0,n.assetExists)("resources/Resources_"+o+".properties")?o:"en"}return t}},function(e,t,o){e.exports=o(7)(5)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setHasherPrepared=function(e){h=e},t.resetRoutes=m,t.addRoute=g,t.addRouteAlias=function(e,t,o){var r=i[t];if(!r)throw new Error("destination of alias not found: "+t);var n=e+"."+t;g(n,o,r.contentViewClass,r.contentViewState);var a=c.Noteflight.routeAliases[e];a||(a=c.Noteflight.routeAliases[e]={});a[t]=n},t.prepareHasher=b,t.initializeRouter=function(){b(),n.bypassed.add(function(){""!==l.default.getHash()?l.default.setHash(""):"test"==c.NF.environment||(0,u.crawler)()||v()}),l.default.init()},t.navigate=y,t.siteNavigator=function(e,t){return function(){var o=c.Noteflight.paths[e];o?y(o(t)):alert((0,d.resource)("errors.unknownRoute",e))}},t.path=_,t.throw404=void 0;var r,n,i,a=p(o(9)),s=p(o(173)),l=p(o(105)),c=o(6),u=o(27),d=o(0);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var h=!1;function m(){r={},i={},n=s.default.create(),c.Noteflight.paths={},c.Noteflight.currentRouteName=null,c.Noteflight.currentRouteParams=null,c.Noteflight.routeAliases={}}function g(e,t,o,s){if(r[e])throw new Error("Attempt to add duplicate route name: "+e);if(t.indexOf("?")<0){t.indexOf("#")>=0?t=t.replace("#",":?_dummyOptionalArg:#"):t+=":?_dummyOptionalArg:"}var u=n.addRoute(t,function(){var t,r={},n=arguments;if(!u._paramsIds)throw new Error("Could not find parameter IDs in Crossroads route "+e);if(t=0,a.default.each(u._paramsIds,function(e,o){var i=n[t++];if("object"==f(i))for(var a in i){var s=decodeURIComponent(a);u._paramsIds.indexOf("?"+s)>=0&&(r[s]=i[a])}else"?"!=o.charAt(0)&&(r[o]=i)}),c.Noteflight.currentRouteName=e,c.Noteflight.currentRouteParams=r,c.Noteflight.currentQueryParams={},window.location.search){var i=window.location.search.replace(/^\?/,"").split("&");for(t=0;t<i.length;t++){var l=i[t].split("=");c.Noteflight.currentQueryParams[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}}c.Noteflight.appViewModel.navigate(o,a.default.extend(r,s))});return r[e]=u,i[e]={contentViewClass:o,contentViewState:s},c.Noteflight.paths[e]=function(e){b();var t="",o=!1,r={};a.default.each(u._paramsIds,function(n,i){if("?"==i.charAt(0)){var a=i.substring(1);o=!0,e&&e[a]&&(t+=t.length?"&":"?",t+=encodeURIComponent(a)+"="+encodeURIComponent(e[a]))}else r[i]=e[i]});var n=u.interpolate(r);return o&&(n=n.replace(/\/+#/,"#")),(""===n||n.match(/^[\?\#]/))&&(n="/"+n),n.replace(/#/,t+"#"+l.default.prependHash).replace(/#\/?$/,"")},u}function b(){if(!h){var e=function(e,t){n.parse(c.Noteflight.location.getPathname()+"#"+e)};l.default.prependHash="",l.default.changed.add(e),l.default.initialized.add(e),h=!0}}m();var v=function(){c.Noteflight.location.setUri("/404")};function y(e){var t,o,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.indexOf("#");n<0?(t=e,o=""):(t=e.substring(0,n),o=e.substring(n+1),l.default.prependHash&&0===o.indexOf(l.default.prependHash)&&(o=o.substring(l.default.prependHash.length))),c.Noteflight.location.getPathname()==t?l.default.setHash(o):r?window.open(e):c.Noteflight.location.setUri(e)}function _(e,t){var o=c.Noteflight.paths[e];return o?o(t):(alert((0,d.resource)("errors.unknownRoute",e)),null)}t.throw404=v,c.Noteflight.path=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelAndCloseCurrentModalDialog=function(e){v()&&(h(),null!=e&&e.preventDefault())},t.checkIfOneTimePerScoreAlertHasBeenShown=function(e,t){if((0,i.hasStorage)()){var o=u+e+t;return localStorage.getItem(o)}return!1},t.createAndShowDialog=d,t.DialogViewModel=p,t.doMoveDialogToFront=f,t.hideCurrentDialog=h,t.okCancel=function(e,t,o){d({viewModel:new _(e,t),templateName:o||"dialogs/okCancel"})},t.oneTimeMessage=m,t.oneTimeAlert=g,t.oneTimePerScoreAlert=function(e,t){if((0,i.hasStorage)()){var o=u+e+t;localStorage.getItem(o)||(b((0,r.resource)(e)),localStorage.setItem(o,(new Date).getTime().toString()))}else g(e)},t.saveAndCloseCurrentModalDialog=function(e){v()&&!function(e){var t=y();if(!t)return;return t.key.needsEvent(e)}(e)&&(!function(e){if(!y(e))return;y(e).key.ok()}(),e.preventDefault())},t.showBeforeUnloadDialog=function(e,t){d({viewModel:new _(e,t),templateName:"dialogs/beforeUnload"})},t.showMustCreateProfileDialog=function(e,t){d({viewModel:new function(e,t){p.call(this),this.title=e,this.message=(0,r.resource)("mustCreateProfile.actionMessage",t),this.siteNavigator=n.siteNavigator}(e,t),templateName:"dialogs/mustCreateProfile"})},t.showMustLoginSignupDialog=function(e,t){d({viewModel:new function(e,t){p.call(this),this.title=e,this.message=(0,r.resource)("mustLogin.actionMessage",t),this.showLogin=function(){h(),Noteflight.appViewModel.showLoginForm()},this.showSignup=function(){h(),Noteflight.appViewModel.showSignupForm()}}(e,t),templateName:"dialogs/mustLoginSignup"})},t.showSimpleDialog=function(e,t,o,r){d({viewModel:new function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=this;p.call(n),n.title=a.ko.observable(e),n.message=a.ko.observable(t),n.okCallback=o,n.doOk=function(){h(),n.okCallback()},n.okText=a.ko.observable(r.okText||"action.ok")}(e,t,o),templateName:"dialogs/simpleDialog"})},t.standardAlertDialog=b,t.currentDialogs=void 0;var r=o(0),n=o(2),i=o(27),a=o(6),s=[];t.currentDialogs=s;var l,c=[],u="_nf_alert_";function d(e){var t,o,r,n,i,u,d,p,h,m=(e=e||{}).templateName,g=e.viewModel,b=function(e){for(var t=0;t<c.length;t++)if(c[t].title==e.title)return c[t];return!1}(g);b&&function(e){e.isDialogHidden(!1);for(var t=0;t<c.length;t++)c[t].title==e.title&&c.splice(t,1)}(b);var v=function(e){e=e.replace("/","-");for(var t=0;t<s.length;t++)if(s[t].templateName==e)return s[t];return!1}(m);return v?f(v.value):(r=e.callback?e.callback+"();":"",p=e.templateName.replace("/","-"),h=!0===e.modal||void 0===e.modal,l++,h?(t=l>1e4?l+1:l+8001,i="dialogContainer",d="'.dialog', '#"+p+"'",o="body",n=""):(t=l,d="'#"+p+"."+(i="modelessDialogContainer")+"'",o="body",n=""),u='<div class="'+i+'" id="'+p+'" style="z-index: '+t+'" data-bind="template: '+("{ name: '"+m+"', afterRender: function() { $("+d+").draggable({ handle: '.draggable', containment: '"+n+"'}); "+r+"} }")+'" >',function(e,t,o,r,n){var i=t[0],l=r.replace("/","-");s.push({key:o,value:i,templateName:l}),e.append(t),a.ko.applyBindings(o,i)}($(o),$(u),g,m)),g}function p(){var e=this;e.doCancel=function(){return!0},e.cancel=function(){e.doCancel()&&h(e)},e.doOk=function(){return!0},e.needsEvent=function(e){return!1},e.ok=function(){e.doOk()&&h(e)},e.hideDialog=function(){!function(e){e.isDialogHidden(!0),c.push(e)}(e)},e.moveDialogToFront=function(){for(var t=0;t<s.length;t++)if(s[t].key==e){f(s[t].value);break}return!0}}function f(e){l=$(e).css("z-index")>l?$(e).css("z-index"):l,l++,$(e).css("z-index",l)}function h(e){var t=y(e);if(t){a.ko.removeNode(t.value);var o=s.indexOf(t);s.splice(o,1)}}function m(e){return(!(0,i.hasStorage)()||!localStorage.getItem(e))&&(localStorage.getItem(e)||localStorage.setItem(e,(new Date).getTime().toString()),!0)}function g(e){m(u+e)&&b((0,r.resource)(e))}function b(e,t){arguments.length<2&&(t=null);d({viewModel:new function(e,t){var o=this;p.call(o),o.message=e,o.callback=t,o.doOk=function(){h(),o.callback&&o.callback()}}(e,t),templateName:"dialogs/alert"})}function v(){return s.length>0}function y(e){var t=0,o=0;if(s.length){if(void 0===e){var r=0;for(t=0;t<s.length;t++){var n=$(s[t].value).css("z-index");n>r&&(r=n,o=t)}}else for(t=0;t<s.length;t++)if(s[t].key==e){o=t;break}return s[o]}}function _(e,t){var o=this;p.call(o),o.message=e,o.callback=t,o.doOk=function(){h(),o.callback()}}},function(e,t,o){e.exports=o(7)(667)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SELLING_WORK_SELECTED=t.BUYER_SIGN_IN_PRODUCT_OWNED=t.BUYER_SIGN_IN_PRODUCT_PREVIEW=t.WINDOW_RESIZED=t.REVIEWS_DELETED=t.COLLECTIONS_ITEMS_REMOVED=t.COLLECTIONS_ITEMS_ADDED=t.COLLECTIONS_USER_COLLECTIONS_FETCHED=t.COLLECTIONS_REFRESH=t.COLLECTIONS_UPDATE_COUNTER=t.AUDIO_PREVIEW_STOP=t.AUDIO_PREVIEW_PLAYING=t.SELLER_SIGNUP_HAS_ACCOUNT=t.SELLER_SIGNUP_RESET=t.MARKETPLACE_PRODUCT_PURCHASED=t.SCROLL_INLINE_ERROR_SCROLLED=t.SCROLL_INLINE_ERROR=t.STARS_CLICK=t.STARS_OUT=t.STARS_HOVER=t.DIALOG_RESIZE=t.PALETTE_CLOSE_SUB_POPUPS=t.PALETTE=t.PROFILE_EPOCH_FORCE_UPDATE=t.COLLECTION_IMAGE_UPLOADED=t.STOCK_IMAGE_GROUP_LOGO_SELECTED=t.STOCK_IMAGE_COVER_ART_SELECTED=t.STOCK_IMAGE_UPLOADED=t.STOCK_IMAGE_UPLOADING=t.STOCK_IMAGE_SELECTED=t.REPORTER_CLEAR_ERRORS=t.REPORTER_CLEAR_ALL=t.REPORTER_CLEAR=t.REPORTER_ADD_ERRORS=t.REPORTER_ADD_ERROR=t.REPORTER_REMOVE=t.REPORTER_ADD=t.REPORTER=t.SCORE_PLAYING=t.SCORE_FETCH_DATA=t.SCORE_SET_FACETS=t.SCORE_SET_DESCRIPTION=t.SCORE_SET_TITLE=t.SCORE_PUBLISH_FAIL=t.SCORE_IS_SYNC_MEDIA_PLAYING=t.SCORE_IS_ABOUT_TO_PLAY=t.SCORE_COVER_ART_REGENERATED=t.SCORE_IMAGE_GENERATED=t.SCORE_GENERATE_IMAGE=t.SCORE_FLAGGED=t.SCORE_REQUIRE_SAVE=t.SCORE_SAVED=t.SCORE_FORCE_SAVE=t.SITE_UPDATED=t.SITE=t.SEARCH_QUERY_REQUESTED=t.SEARCH_QUERY_BROADCAST=t.FILTER_TOGGLE=t.FILTER_SELECTION=t.FILTER_UPDATE_AGGREGATIONS=t.SEARCH_EDITORHELP=t.SEARCH_PRODUCT=t.SEARCH_MEMBER=t.SEARCH_GROUP=t.SEARCH_SCORE=t.SEARCH=t.GROUP_LOGO_REGENERATED=t.GROUP_LOGO_IMAGE_GENERATED=t.GROUP_IMAGE_GENERATED=t.GROUP_GENERATE_IMAGE=t.GROUP_SAVED=t.GROUP_SAVE=t.GROUP_UPDATED=t.GROUP_CREATED=t.GROUP=t.STRIPE_CARD_EDITING_NUMBER=t.CUSTOMER_CARD_UPDATE_FAILED=t.CUSTOMER_CARD_UPDATED=t.CUSTOMER_CARDS_RETRIEVED=t.CUSTOMER_CARD_DELETED=t.CUSTOMER_CARD_CREATION_FAILED=t.CUSTOMER_CARD_CREATED=t.CUSTOMER_CARD_ADDRESS_CHANGED=t.CUSTOMER_CARD_SELECTED_CHANGED=t.APPCUES_IDENTIFY=void 0;t.APPCUES_IDENTIFY="APPCUES.IDENTIFY";t.CUSTOMER_CARD_SELECTED_CHANGED="CUSTOMER_CARD.SELECTED_CHANGED";t.CUSTOMER_CARD_ADDRESS_CHANGED="CUSTOMER_CARD.ADDRESS_CHANGED";t.CUSTOMER_CARD_CREATED="CUSTOMER_CARD.CREATED";t.CUSTOMER_CARD_CREATION_FAILED="CUSTOMER_CARD.CREATED_FAILURE";t.CUSTOMER_CARD_DELETED="CUSTOMER_CARD.DELETED";t.CUSTOMER_CARDS_RETRIEVED="CUSTOMER_CARD.RETRIEVED";t.CUSTOMER_CARD_UPDATED="CUSTOMER_CARD.UPDATED";t.CUSTOMER_CARD_UPDATE_FAILED="CUSTOMER_CARD.UPDATED_FAILURE";t.STRIPE_CARD_EDITING_NUMBER="STRIPE_CARD.EDITING_NUMBER";t.GROUP="GROUP";t.GROUP_CREATED="GROUP.CREATED";t.GROUP_UPDATED="GROUP.UPDATED";t.GROUP_SAVE="GROUP.SAVE";t.GROUP_SAVED="GROUP.SAVED";t.GROUP_GENERATE_IMAGE="GROUP.GENERATE_IMAGE";t.GROUP_IMAGE_GENERATED="GROUP.IMAGE_GENERATED";t.GROUP_LOGO_IMAGE_GENERATED="GROUP.IMAGE_GENERATED";t.GROUP_LOGO_REGENERATED="GROUP.GROUP_LOGO.REGENERATED";t.SEARCH="SEARCH";t.SEARCH_SCORE="SEARCH.SCORE";t.SEARCH_GROUP="SEARCH.GROUP";t.SEARCH_MEMBER="SEARCH.MEMBER";t.SEARCH_PRODUCT="SEARCH.PRODUCT";t.SEARCH_EDITORHELP="SEARCH.EDITORHELP";t.FILTER_UPDATE_AGGREGATIONS="FILTER.UPDATE_AGGREGATIONS";t.FILTER_SELECTION="FILTER.SELECTION";t.FILTER_TOGGLE="FILTER.TOGGLE";t.SEARCH_QUERY_BROADCAST="SEARCH_QUERY.BROADCAST";t.SEARCH_QUERY_REQUESTED="SEARCH_QUERY.REQUESTED";t.SITE="SITE";t.SITE_UPDATED="SITE.UPDATED";t.SCORE_FORCE_SAVE="SCORE.FORCE_SAVE";t.SCORE_SAVED="SCORE.SAVED";t.SCORE_REQUIRE_SAVE="SCORE.REQUIRE_SAVE";t.SCORE_FLAGGED="SCORE.FLAGGED";t.SCORE_GENERATE_IMAGE="SCORE.GENERATE_IMAGE";t.SCORE_IMAGE_GENERATED="SCORE.IMAGE_GENERATED";t.SCORE_COVER_ART_REGENERATED="SCORE.COVER_ART.REGENERATED";t.SCORE_IS_ABOUT_TO_PLAY="SCORE.IS_ABOUT_TO_PLAY";t.SCORE_IS_SYNC_MEDIA_PLAYING="SCORE.IS_SYNC_MEDIA_PLAYING";t.SCORE_PUBLISH_FAIL="SCORE.PUBLISH_FAIL";t.SCORE_SET_TITLE="SCORE.SET_TITLE";t.SCORE_SET_DESCRIPTION="SCORE.SET_DESCRIPTION";t.SCORE_SET_FACETS="SCORE.SET_FACETS";t.SCORE_FETCH_DATA="SCORE.FETCH_DATA";t.SCORE_PLAYING="SCORE.PLAYING";t.REPORTER="REPORTER";t.REPORTER_ADD="REPORTER.ADD";t.REPORTER_REMOVE="REPORTER.REMOVE";t.REPORTER_ADD_ERROR="REPORTER.ADDERROR";t.REPORTER_ADD_ERRORS="REPORTER.ADDERRORS";t.REPORTER_CLEAR="REPORTER.CLEAR";t.REPORTER_CLEAR_ALL="REPORTER.CLEAR.ALL";t.REPORTER_CLEAR_ERRORS="REPORTER.CLEAR.ERRORS";t.STOCK_IMAGE_SELECTED="STOCK_IMAGE.SELECTED";t.STOCK_IMAGE_UPLOADING="STOCK_IMAGE.UPLOADING";t.STOCK_IMAGE_UPLOADED="STOCK_IMAGE.UPLOADED";t.STOCK_IMAGE_COVER_ART_SELECTED="STOCK_IMAGE.COVER_ART_SELECTED";t.STOCK_IMAGE_GROUP_LOGO_SELECTED="STOCK_IMAGE.GROUP_LOGO_SELECTED";t.COLLECTION_IMAGE_UPLOADED="COLLECTION_IMAGE.UPLOADED";t.PROFILE_EPOCH_FORCE_UPDATE="PROFILE_EPOCH.FORCE_UPDATE";t.PALETTE="PALETTE";t.PALETTE_CLOSE_SUB_POPUPS="PALETTE.CLOSE_SUB_POPUPS";t.DIALOG_RESIZE="DIALOG.RESIZE";t.STARS_HOVER="STARS.HOVER";t.STARS_OUT="STARS.OUT";t.STARS_CLICK="STARS.CLICK";t.SCROLL_INLINE_ERROR="SCROLL.INLINE_ERROR";t.SCROLL_INLINE_ERROR_SCROLLED="SCROLL.INLINE_ERROR_SCROLLED";t.MARKETPLACE_PRODUCT_PURCHASED="MARKETPLACE.PRODUCT_PURCHASED";t.SELLER_SIGNUP_RESET="SELLER_SIGNUP.RESET";t.SELLER_SIGNUP_HAS_ACCOUNT="SELLER_SIGNUP.HAS_ACCOUNT";t.AUDIO_PREVIEW_PLAYING="AUDIO_PREVIEW.PLAYING";t.AUDIO_PREVIEW_STOP="AUDIO_PREVIEW.STOP";t.COLLECTIONS_UPDATE_COUNTER="COLLECTIONS.UPDATE_COUNTER";t.COLLECTIONS_REFRESH="COLLECTIONS.REFRESH";t.COLLECTIONS_USER_COLLECTIONS_FETCHED="COLLECTIONS.USER_COLLECTIONS_FETCHED";t.COLLECTIONS_ITEMS_ADDED="COLLECTIONS.ITEMS_ADDED";t.COLLECTIONS_ITEMS_REMOVED="COLLECTIONS.ITEMS_REMOVED";t.REVIEWS_DELETED="REVIEWS.DELETED";t.WINDOW_RESIZED="WINDOW.RESIZED";t.BUYER_SIGN_IN_PRODUCT_PREVIEW="BUYER.SIGN_IN_PRODUCT_PREVIEW";t.BUYER_SIGN_IN_PRODUCT_OWNED="BUYER.SIGN_IN_PRODUCT_OWNED";t.SELLING_WORK_SELECTED="SELLING.WORK_SELECTED"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jQuery=t.$=t.ko=t.NF=t.Noteflight=void 0;var r=i(o(9)),n=i(o(135));function i(e){return e&&e.__esModule?e:{default:e}}o(136);var a={};t.Noteflight=a;var s=a;t.NF=s;var l=n.default;t.ko=l;var c=r.default;t.$=c;var u=r.default;t.jQuery=u,window.Noteflight=a,window.NF=s,window.ko=l,window.$=r.default,window.jQuery=r.default},function(e,t){e.exports=clientLib},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALIBRATED_LATENCY_STORAGE_KEY=t.storeModelTypes=t.STRIP_VIEW_VALUE=t.PERFORM_VIEW_VALUE=t.PAGE_VIEW_VALUE=t.FLOW_VIEW_VALUE=t.COPYRIGHT_INFO=t.SHARING_OPTIONS=t.SHARE_WIZARD=t.DOCUMENT_ROLE_DEMO=t.DOCUMENT_ROLE_AUTHOR=t.DOCUMENT_ROLE_COAUTHOR=t.DOCUMENT_ROLE_REVIEWER=t.DOCUMENT_ROLE_READER=t.SCORE=t.PRODUCT=t.PRODUCT_PREVIEW_TYPE_PARTIAL=t.PRODUCT_PREVIEW_TYPE_FULL=t.PRODUCT_PREVIEW=t.HL_A_EDITOR=t.HL_A_ARRANGER=t.HL_A_MUSICIAN=t.HL_A_ARTIST=t.HL_A_AUTHOR=t.HL_A_WRITER=t.HL_A_COMPOSER=t.HL_S_AT=t.HL_S_A=t.HL_S_CR=t.HL_S_C=t.HL_S_CA=t.NF_ARRANGER=t.NF_LYRICIST=t.NF_COMPOSER=t.NF_ARTIST=t.LYRICIST=t.COMPOSER=t.COPYRIGHT_OPTIONS=t.ARRANGEMENT_EXISTING_WORK=t.ARRANGEMENT_AUTHORSHIP=t.PUBLIC_DOMAIN_AUTHORSHIP=t.ORIGINAL_AUTHORSHIP=t.THUMBNAIL=t.GRID=t.LIST=t.PRODUCT_DEFAULT_QUERY=t.PRODUCT_SORT_OPTIONS=t.ALL_TIME_FAVES=t.RECENT_SCORES=t.RECENT_FAVES=t.ALL=t.WEEK=t.MAX_PER_PAGE=t.POPULAR=t.TITLE=t.MOST_RELEVANT=t.MOST_RECENT=t.COOKIE_DOMAIN=t.DESKTOP_SIZE=t.ALL_GROUPS=t.MY_GROUPS=t.GROUP_NAME_MAX=t.GROUP_NAME_MIN=t.SITE_STUDENT_ROLE=t.SITE_TEACHER_ROLE=t.SITE_ADMIN_ROLE=t.SITE_TYPE_GC=t.SITE_TYPE_SCC=t.SITE_TYPE_LTI=t.MAX_PASSWORD_LENGTH=t.MIN_PASSWORD_LENGTH=t.Z_INDEX_1000=t.GOOGLE_SITE_KEY=void 0;var r=o(6);t.GOOGLE_SITE_KEY="6LdBiRQUAAAAALKQtuR3v9R6ypwGLfTr8ubkky7-";t.Z_INDEX_1000=1e3;t.MIN_PASSWORD_LENGTH=4;t.MAX_PASSWORD_LENGTH=200;t.SITE_TYPE_LTI="lti";t.SITE_TYPE_SCC="scc";t.SITE_TYPE_GC="gc";t.SITE_ADMIN_ROLE="admin";t.SITE_TEACHER_ROLE="instructor";t.SITE_STUDENT_ROLE="student";t.GROUP_NAME_MIN=3;t.GROUP_NAME_MAX=48;t.MY_GROUPS="myGroups";t.ALL_GROUPS="allGroups";t.DESKTOP_SIZE=1024;t.COOKIE_DOMAIN=".noteflight.com",r.NF.COOKIE_DOMAIN=".noteflight.com";t.MOST_RECENT="most_recent";t.MOST_RELEVANT="relevance";t.TITLE="title";t.POPULAR="popular";t.MAX_PER_PAGE=36;t.WEEK="week";t.ALL="all";t.RECENT_FAVES="recentFaves";t.RECENT_SCORES="recentScores";t.ALL_TIME_FAVES="allTimeFaves";var n=[{value:"relevance",label:"order.relevance"},{value:"most_recent",label:"order.mostRecent"},{value:"title",label:"order.title"}];t.PRODUCT_SORT_OPTIONS=n;t.PRODUCT_DEFAULT_QUERY="all";t.LIST="list";t.GRID="grid";t.THUMBNAIL="thumbnail";t.ORIGINAL_AUTHORSHIP="original";t.PUBLIC_DOMAIN_AUTHORSHIP="public_domain";t.ARRANGEMENT_AUTHORSHIP="arrangement";t.ARRANGEMENT_EXISTING_WORK="arrangementExistingWork";var i=[{value:"original",label:"editor.sharingInfo.origin.menuItem.".concat("original")},{value:"arrangementExistingWork",label:"editor.sharingInfo.origin.menuItem.".concat("arrangementExistingWork")}];t.COPYRIGHT_OPTIONS=i;t.COMPOSER="composer";t.LYRICIST="lyricist";t.NF_ARTIST="NF_artist";t.NF_COMPOSER="NF_composer";t.NF_LYRICIST="NF_lyricist";t.NF_ARRANGER="NF_arranger";t.HL_S_CA="HL_S_CA";t.HL_S_C="HL_S_C";t.HL_S_CR="HL_S_CR";t.HL_S_A="HL_S_A";t.HL_S_AT="HL_S_AT";t.HL_A_COMPOSER="HL_A_COMPOSER";t.HL_A_WRITER="HL_A_WRITER";t.HL_A_AUTHOR="HL_A_AUTHOR";t.HL_A_ARTIST="HL_A_ARTIST";t.HL_A_MUSICIAN="HL_A_MUSICIAN";t.HL_A_ARRANGER="HL_A_ARRANGER";t.HL_A_EDITOR="HL_A_EDITOR";t.PRODUCT_PREVIEW="preview";t.PRODUCT_PREVIEW_TYPE_FULL="full";t.PRODUCT_PREVIEW_TYPE_PARTIAL="partial";t.PRODUCT="product";t.SCORE="score";t.DOCUMENT_ROLE_READER="reader";t.DOCUMENT_ROLE_REVIEWER="reviewer";t.DOCUMENT_ROLE_COAUTHOR="coauthor";t.DOCUMENT_ROLE_AUTHOR="author";t.DOCUMENT_ROLE_DEMO="demo";t.SHARE_WIZARD="shareWizard";t.SHARING_OPTIONS="sharingOptions";t.COPYRIGHT_INFO="copyrightInfo";t.FLOW_VIEW_VALUE="flow";t.PAGE_VIEW_VALUE="paginated";t.PERFORM_VIEW_VALUE="perform";t.STRIP_VIEW_VALUE="strip";t.storeModelTypes=["collections","communities","communityMembers","contentPolicies","coverArts","documentRoles","groups","products","profiles","scores","scoreVersions","songs","users"];t.CALIBRATED_LATENCY_STORAGE_KEY="_nf_calibrated_input_latency"},function(e,t,o){e.exports=o(7)(87)},function(e,t,o){e.exports=o(7)(673)},function(e,t,o){e.exports=o(7)(596)},function(e,t,o){e.exports=o(7)(689)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(3),n=o(15);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable((0,n.generateUUID)()),this.maxHeight=ko.observable("none")}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"doCancel",value:function(){return!0}},{key:"cancel",value:function(){this.doCancel()&&this.hide()}},{key:"doOk",value:function(){return!0}},{key:"ok",value:function(){this.doOk()&&this.hide()}},{key:"hideDialog",value:function(){this.hide()}},{key:"hide",value:function(){(0,r.hideCurrentDialog)(this)}},{key:"needsEvent",value:function(e){return!1}},{key:"moveDialogToFront",value:function(){for(var e=0;e<r.currentDialogs.length;e++)if(r.currentDialogs[e].key==this){(0,r.doMoveDialogToFront)(r.currentDialogs[e].value);break}return!0}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connect=t.connectToStore=void 0;var r=o(40),n=o(16);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(o,a){return function(s){var l=function(e){return Object.assign({},o(e),"object"===i(a)?(0,r.bindActionCreators)(a,c().dispatch):a(c().dispatch))},c=function(){return t?(0,n.getApplicationStore)():e},u=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++){var r=t[o];"function"==typeof e[r]?s[r]=e[r]:ko.isObservable(s[r])&&e[r]!==s[r]()&&s[r](e[r])}},d=c().getState(),p=l(d);return u(p),c().subscribe(function(){var e=c().getState(),t=l(e);u(t)}),s}}};t.connectToStore=a;t.connect=function(e,t){return a(null,!0)(e,t)}},function(e,t,o){"use strict";function r(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function n(e,t){var o=Math.pow(10,t);return Math.round(e*o)/o}function i(e){var t=e.toString().split("."),o=t[0],r="00";return 2==t.length&&(1==(r=t[1]).length?r+="0":r=r.substring(0,2)),[o,r]}function a(e){var t=i(n(e,2));return r("".concat(t[0],".").concat(t[1]))}Object.defineProperty(t,"__esModule",{value:!0}),t.formatCommas=r,t.areOnlyNumbers=function(e){return/^\d+$/.test(e)},t.stripToNumbers=function(e){return e.replace(/\D/g,"")},t.roundNumber=n,t.last2DigitsOfYear=function(e){if(!e)return null;var t=e.toString();4==t.length&&(t=t.substr(2,2));return parseFloat(t,10)},t.abbreviateNumber=function(e){if(e<1e3)return e;if(e>=1e3&&e<1e6)return function(e){var t=e/1e3;t=e<1e4?t.toString().match(/^[0-9][\.]?[0-9]?/):t.toString().match(/^[0-9]+/);return t+"K"}(e);if(e>=1e6)return function(e){var t=e/1e6;t=e<1e7?t.toString().match(/^[0-9][\.]?[0-9]?/):t.toString().match(/^[0-9]+/);return t+"M"}(e)},t.getUnitsAndCentsFromPrice=i,t.getFormattedPrice=a,t.formatPriceInCents=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=void 0===t.currency?"$":t.currency;s[o]&&(o=s[o]);var r=t.showDouble0ForCents||!1,n=a(e/100);r||"00"!=n.slice(-2)||(n=n.substring(0,n.length-3));return"".concat(o).concat(n)},t.numberToTime=function(e){e=Math.abs(Math.round(e));var t=Math.floor(e/60),o=Math.round(e%60).toString();1==o.length&&(o="0"+o);return t.toString()+":"+o},t.generateUUID=function(){return l()},t.formatUSPhoneNumber=function(e){if(!e)return;var t=(e=(e=e.replace(/\D/g,"")).substring(0,10)).length;e=0===t?e:t<4?"("+e:t<7?"("+e.substring(0,3)+") "+e.substring(3,6):"("+e.substring(0,3)+") "+e.substring(3,6)+"-"+e.substring(6,10);return e},t.liveFormatSSN=function(e){var t=(e=(e=e.replace(/\D/g,"")).substring(0,10)).length;e=t<4?e:t<6?e.substring(0,3)+"-"+e.substring(3,5):e.substring(0,3)+"-"+e.substring(3,5)+"-"+e.substring(5,9);return e},t.liveFormatTaxId=function(e){(e=(e=e.replace(/\D/g,"")).substring(0,10)).length>=3&&(e=e.substring(0,2)+"-"+e.substring(2,9));return e},t.modulo=function(e,t){if(e>=0)return e%t;var o=Math.ceil(Math.abs(e)/t);return e+o*t};var s={usd:"$"};var l=o(80)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debug=function(){if(a.NF.config.logLevel>=O&&window.console){if("function"==typeof console.log)return a.$.each(arguments,function(e,t){(0,a.$)("#debug").append(t+" ")}),(0,a.$)("#debug").append("<br>"),console.log.apply(console,arguments);a.$.each(arguments,function(e,t){console.log(t)})}},t.default=A,t.setTitleAndMeta=function(e,t,o){if("string"==typeof t&&(0,b.hasResource)(t)&&(0,b.hasResource)("title.suffix")){var r=(0,b.resource)(t)+" "+(0,b.resource)("title.suffix");a.ko.isObservable(e.title)?e.title(r):e.title=r}if("string"==typeof o&&(0,b.hasResource)(o)){var n=(0,b.resource)(o);a.ko.isObservable(e.meta)?e.meta(n):e.meta=n}},t.asset=N,t.assetExists=I,t.loadAsset=function(e,t){if(!I(e)){var o={};return a.$.extend(o,{url:e,status:404,done:function(){return o},fail:function(t){return t(o,"Asset '"+e+"' not found"),o},always:function(e){return e(),o}}),o}var r=a.NF.asset(e),n=a.$.ajax(a.$.extend({url:r,type:"GET"},t));return n.url=r,n},t.safeValueExtractionFromObservableObject=function(e,t){var o=a.ko.utils.unwrapObservable(t);return(0,b.hasResource)(o)?e(o):o},t.markdownToHtml=x,t.getApplicationStore=V,t.initializeStore=H,t.currentYear=t.languageCode=t.locale=t.VIEWER_VERSION=void 0;var r=R(o(4)),n=R(o(143)),i=o(145),a=o(6),s=o(19),l=o(84),c=R(o(112)),u=o(8),d=o(5),p=T(o(30)),f=T(o(56)),h=T(o(89));o(27);var m=R(o(93)),g=o(2),b=o(0),v=o(3),y=o(27),_=R(o(42)),S=o(59),w=o(14),k=o(188),E=o(73),P=R(o(113)),C=o(74);function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}function R(e){return e&&e.__esModule?e:{default:e}}var O=1,M=28;function A(){var e=this;e.initialized=!1,e.reporter=new _.default,e.isCrawler=a.ko.observable((0,y.crawler)()),e.links={helpCenter:C.HELP_CENTER_LINK,faq:C.FAQ_LINK,support:C.SUPPORT_LINK,feedback:C.FEEDBACK_LINK,blog:C.BLOG_LINK,press:C.PRESS_LINK,facebook:C.FACEBOOK_LINK,twitter:C.TWITTER_LINK},void 0!==window.Appcues&&(e.appCuesPackager=new S.AppCuesPackager(a.NF.session.current_user(),a.NF.session.community().default_community(),window.location.pathname,window.Appcues),r.default.subscribe(d.APPCUES_IDENTIFY,function(t,o){var r=!!o.isScoreAuthor;e.appCuesPackager.trackUser(r)})),e.initializeConnectedProperties=function(){e.contentType=a.ko.observable(),(0,w.connect)(k.appViewModelSelector,{})(e)},e.initializeConnectedProperties(),e.headerViewModel=new a.NF.HeaderViewModel,e.contentViewModel=a.ko.observable(new a.NF.DefaultContentViewModel),e.showHeader=a.ko.observable(!0),e.isMobileLayout=s.isMobileLayout,e.product=a.ko.computed(function(){var e=a.NF.session.current_user();return a.NF.session.community().default_community()?e?e.premium_member()?"premium":"free":"anonymous":"learn"}),e.siteSidebar=a.ko.observable(new a.Noteflight.SidebarViewModel),e.userSidebar=a.ko.observable(new a.Noteflight.SidebarViewModel),e.siteSidebar().otherSidebar=e.userSidebar(),e.userSidebar().otherSidebar=e.siteSidebar(),e.hideSidebars=function(){e.siteSidebar().visible(!1),e.userSidebar().visible(!1)},e.init=function(){"true"!=a.NF.currentQueryParams.signup||a.NF.session.current_user()||a.NF.appViewModel.headerViewModel.signupViewModel.show()};var t=function(e){e.hostname==a.Noteflight.session.community().hostname()?(0,g.navigate)((0,g.path)("loggedInHome")):a.Noteflight.appViewModel.changeCommunity(e.hostname)},o=function(e){(0,v.okCancel)((0,b.resource)("content.confirmActivateCommunity",e.communityName),function(){(0,g.navigate)((0,g.path)("activateSite",{hostname:e.hostname}))})},n=function(e){(0,v.standardAlertDialog)((0,b.resource)("content.cannotActivateCommunity",e.communityName))},i=function(e){a.Noteflight.location.setUri(e.adminUrl)};e.sites=a.ko.observableArray([]),e.visitedScores=a.ko.observableArray([]),e.getSites=function(){a.NF.session.current_user()&&a.NF.session.current_user().sites_enabled()&&a.Noteflight.postService("/client/1.0/communities",e,e.processSitesMenuData)()},e.processSitesMenuData=function(r){var s,l,c,u=a.Noteflight.session.current_user().can_create_site();for(s=0;s<r.communities.length;s++)(l=(c=r.communities[s]).active?{title:c.name,hostname:c.hostname,menuAction:t}:{title:(0,b.resource)(u?"menu.activateSite":"menu.inactiveSite",c.name),communityName:c.name,hostname:c.hostname,menuAction:u?o:n}).checkedItem=c.hostname==a.Noteflight.session.community().hostname(),e.sites.push(l);for(s=0;s<r.domains.length;s++){var d=r.domains[s];(l={title:(0,b.resource)("menu.domainAdmin",d.name),adminUrl:d.admin_url,menuAction:i}).checkedItem=c.hostname==a.Noteflight.session.community().hostname(),e.sites.push(l)}},e.supportLocation=a.ko.observable("https://support.noteflight.com"),e.groups=a.ko.observableArray([]),e.communityGroupPath=a.ko.observable(),e.getGroups=function(){if(e.groups([]),a.NF.session.user_groups){for(var t=a.NF.session.user_groups.groups(),o=0;o<t.length;o++)!e.communityGroupPath()&&t[o].is_community_group()&&e.communityGroupPath({route:"viewGroup",routeArgs:{groupId:t[o].id()}}),e.groups.push({title:t[o].name(),route:"viewGroup",routeArgs:{groupId:t[o].id()}});a.NF.session.user_groups.remaining()>0&&e.groups.push({title:(0,b.resource)("siteSidebar.moreGroups"),route:"yourGroups",routeArgs:{}})}},e.getVisitedScores=function(){if(e.visitedScores([]),a.NF.session.visited_scores)for(var t=a.NF.session.visited_scores(),o=0;o<t.length;o++)e.visitedScores.push(new a.Noteflight.VisitedScore(t[o].title(),t[o].external_id()))},e.totalUserGroups=a.ko.observable(a.NF.session.user_groups?a.NF.session.user_groups.count():0),e.namesOfGroupsInSession=[],a.ko.computed(function(){function t(){e.totalUserGroups(a.NF.session.user_groups.count()),e.getGroups(),e.namesOfGroupsInSession=a.$.map(a.NF.session.user_groups.groups(),function(e){return e.name()})}if(a.NF.session.user_groups)if(a.NF.session.user_groups.groups()&&e.totalUserGroups()!=a.NF.session.user_groups.count()||0===e.namesOfGroupsInSession.length)t();else for(var o=0;o<e.namesOfGroupsInSession.length;o++)if(!a.NF.session.user_groups.groups()[o]||e.namesOfGroupsInSession[o]!=a.NF.session.user_groups.groups()[o].name()){t();break}}),e.getSites(),e.getVisitedScores(),e.floatHeader=a.ko.observable(!1),e.floatHeader.subscribe(function(t){l(),a.NF.triggerResize(),t&&setTimeout(function(){e.hideFloatHeader(!0)},50)}),e.hideFloatHeader=a.ko.observable(!1),e.hiddenHeaderRevealed=!1,e.hideFloatHeader.subscribe(function(t){t&&(e.hiddenHeaderRevealed=!1),l()}),e.overHeader=function(){e.hideFloatHeader(!1)},e.outHeader=function(){e.hideFloatHeader(!0)},e.showHeaderIfHidden=function(){return e.hideFloatHeader()&&e.isTouchDevice()&&(e.hideFloatHeader(!1),e.hiddenHeaderRevealed=!0),!0},e.scoreDocumentViewClicked=function(){return e.hiddenHeaderRevealed&&e.hideFloatHeader(!0),!0},e.contentTop=a.ko.observable("0px"),e.headerTop=a.ko.observable("0px"),e.mainPageTop=a.ko.observable("0px"),e.headerPaletteLeft=a.ko.computed(function(){return e.contentViewModel().headerPaletteLeft?e.contentViewModel().headerPaletteLeft():null}),e.headerPaletteRight=a.ko.computed(function(){return e.contentViewModel().headerPaletteRight?e.contentViewModel().headerPaletteRight():null}),e.customHeaderPalette=a.ko.computed(function(){return e.contentViewModel().customHeaderPalette?e.contentViewModel().customHeaderPalette():null}),e.showingEditor=a.ko.computed(function(){return void 0!==e.contentViewModel().html5Editor}),e.marketplaceBreadcrumb=a.ko.computed(function(){return e.contentViewModel().marketplaceBreadcrumb?e.contentViewModel().marketplaceBreadcrumb():null}),e.fullscreen=a.ko.observable(!1),e.marketplaceFullscreen=a.ko.computed(function(){return e.contentType()===u.PRODUCT&&e.fullscreen()}),e.helpTarget=a.ko.computed(function(){return e.contentViewModel().targetHelpInSeparateWindow&&e.contentViewModel().targetHelpInSeparateWindow()?"_blank":""}),e.contentTemplateName=a.ko.computed(function(){return e.contentViewModel().templateName()}),e.contentTitle=a.ko.computed(function(){return a.ko.utils.unwrapObservable(e.contentViewModel().title)}),e.contentTitle.subscribe(function(e){e&&(document.title=e)}),e.contentMeta=a.ko.computed(function(){return a.ko.utils.unwrapObservable(e.contentViewModel().meta)}),e.contentMeta.subscribe(function(e){e&&(0,a.$)(function(){(0,a.$)("meta[name=description]").attr("content",e)})}),e.currentCSSLayout=a.ko.observable(s.STANDARD_LAYOUT),e.checkAtBottom=function(t,o){e.contentViewModel().checkAtBottom&&e.contentViewModel().checkAtBottom(t,o)},e.showingViewer=a.ko.computed(function(){return e.contentViewModel().html5Editor&&e.contentViewModel().html5Editor()&&e.contentViewModel().html5Editor().isViewerOnly()}),e.showSearchBarForMobile=a.ko.computed(function(){return!(!e.contentViewModel().showSearchBarForMobile||!e.contentViewModel().showSearchBarForMobile())}),e.viewerVersion=function(){return"Using Noteflight viewer v"+M};e.currentHeaderHeight=a.ko.observable(0);var l=function(){r.default.publish(d.WINDOW_RESIZED),e.currentCSSLayout((0,s.calculateLayout)());var t=0,o=(0,a.$)("#header").outerHeight()||0;if(e.headerTop("0px"),e.floatHeader()?e.hideFloatHeader()&&e.headerTop(35-o+"px"):t=o,!a.NF.embedded){var n=(0,a.$)("#headerFormsContainer").outerHeight()||0;e.mainPageTop(n+"px")}e.contentTop(t+"px")};e.headerFloatTopMargin=a.ko.computed(function(){return e.floatHeader()?e.currentHeaderHeight():0}),e.headerMayHaveChangedHeight=function(){var t,o=(0,a.$)("#html5Editor")[0];l(),e.currentHeaderHeight((0,a.$)("#header").outerHeight()),t=setInterval(function(){(0,a.$)("#header").outerHeight()!=e.currentHeaderHeight()&&(e.currentHeaderHeight((0,a.$)("#header").outerHeight()),l(),o&&o.dispatchEvent(new Event("headerHeightChangeStart")))},100),setTimeout(function(){window.clearInterval(t)},5e3)},e.initializeView=function(){e.initialized=!0,a.NF.roles=new m.default(a.NF.session),l(),(0,a.$)(window).resize(l),e.headerViewModel.animatingHeaderHeight.subscribe(function(t){t?e.animationTimer=window.setInterval(function(){l()},10):(window.clearInterval(e.animationTimer),l())}),e.contentViewModel()&&e.notifyNavigate()},e.navigate=function(t,o){a.NF.errorResource&&(t=a.NF.DefaultContentViewModel,o={templateName:"content/error",resource:a.NF.errorResource}),e.contentViewModel()&&t!=e.contentViewModel().constructor&&e.contentViewModel(new t),o&&(a.ko.mapping.fromJS(o,{},e.contentViewModel()),e.contentViewModel().searchTarget&&e.searchTarget(e.contentViewModel().searchTarget())),e.contentViewModel().beforeUnload&&(0,a.$)(window).bind("beforeunload",e.contentViewModel().beforeUnload),a.NF.analytics&&(a.NF.analytics.setPage(a.NF.location.getPathname()),a.NF.analytics.trackEvent("r3",a.NF.currentRouteName)),e.initialized&&e.notifyNavigate()},e.notifyNavigate=function(){if(e.contentViewModel().detailView||a.NF.hasSessionStorage&&sessionStorage.setItem("_nf_lastMasterView",window.location.href),r.default.publish(d.REPORTER_CLEAR_ALL),"function"==typeof e.contentViewModel().onNavigate){["content/marketplaceSearch","content/editor"].includes(e.contentTemplateName())||a.NF.hasStorage&&(localStorage.removeItem("marketplaceSearchQuery"),localStorage.removeItem("rr_add_to_cart_params")),e.contentViewModel().onNavigate()}},e.logout=function(){(0,g.navigate)("/logout")},e.noteflightUpdatesLink=a.ko.observable("https://notes.noteflight.com/category/news/new-features");var c=a.NF.session.current_user()&&a.NF.session.current_user().whats_new_last_seen?a.NF.session.current_user().whats_new_last_seen():null;e.showWhatsNewNotification=a.ko.observable(!c||c<Number(a.NF.config.settings.whatsNewLastUpdate)),e.goToWhatsNew=function(){return e.showWhatsNewNotification(!1),a.NF.apiService.updateWhatsNewLastSeen("",function(){},{}),!0},e.linkAccounts=function(){(new a.NF.LinkAccountsViewModel).show()},e.unlinkAccounts=function(){(new a.NF.UnlinkAccountsViewModel).show()},e.navigateToLastMasterView=function(){a.NF.hasSessionStorage&&(0,g.navigate)(sessionStorage.getItem("_nf_lastMasterView")||"/")},e.signInUri=function(){return e.contentViewModel()&&e.contentViewModel().signInUri?e.contentViewModel().signInUri():window.location.href};var p=a.NF.postService("/client/1.0/change_community",e,function(e){a.NF.location.setUri(decodeURI(e.url))});e.changeCommunity=function(e,t){p({hostname:e,destination:t})};var f=a.NF.postService("/client/1.0/session",e,function(e){a.NF.session.update(e)});e.reloadSession=function(){f({})},e.r2Location=function(){var e=a.NF.routeAliases.r2[a.NF.currentRouteName];return(e?(0,g.path)(e,a.NF.currentRouteParams):window.location.href).replace(/#.*$/,"")},e.attachResourceLink=function(){var t=a.NF.currentQueryParams.resource_uri||e.r2Location();(0,g.navigate)("/basiclti/link_resource?resource_uri="+encodeURIComponent(t))},e.showLoginForm=function(){(0,a.$)("#content, body").scrollTop(0),e.headerViewModel.showLoginForm()},e.showSignupForm=function(t){(0,a.$)("#content, body").scrollTop(0),e.headerViewModel.showSignupForm(t)},e.searchViewModel=function(){if(e.contentViewModel().searchPalette&&e.contentViewModel().searchPalette()&&e.contentViewModel().searchPalette().controls()[0]&&e.contentViewModel().searchPalette().controls()[0].searchViewModel)return e.contentViewModel().searchPalette().controls()[0].searchViewModel()},e.search=function(){e.contentViewModel().search?e.contentViewModel().search(e.searchTargetFiltered()):e.defaultSearch()},e.defaultSearch=function(){(0,g.navigate)(a.NF.paths.publicSearch({searchTarget:e.searchTargetFiltered()}))},e.searchTarget=a.ko.observable(),e.searchTargetFiltered=a.ko.computed(function(){return e.searchTarget()&&e.searchTarget().toString().trim().replace(/ +/g," ")}),e.clearSearch=function(){e.searchTarget("")},e.haveSearch=a.ko.computed(function(){return e.searchTarget()&&e.searchTarget().toString().trim().length}),e.handleBodyClick=function(e,t){if(a.NF.homeScreenApp){var o=(0,a.$)(t.target).closest("a").attr("href");if(o)return a.NF.location.setUri(o),!1}return!0},e.isTouchDevice=a.ko.observable((0,s.isTouchDevice)())}function N(e){var t=e;return void 0!==a.NF.config.manifest&&(0===t.indexOf("js/")&&(t=t.slice(3)),(t=a.NF.config.manifest[t])||"undefined"!=typeof jasmine||"function"==typeof console.log&&console.log("Couldn't find asset for "+e)),a.NF.config.assetPrefix+"/assets/"+t}function I(e){return!(a.NF.config.manifest&&!a.NF.config.manifest[e])}function x(e,t){if(!e)return"";var o=0,r=n.default.getSanitizingConverter().makeHtml(e);r=r.replace(/<img[^>]*>?/gi,"[Image]");var i=document.createElement("div");i.innerHTML=r;var a=i.getElementsByTagName("a");for(o=0;o<a.length;o++)a[o].setAttribute("class","standardLink");if(t&&t.newTab)for(o=0;o<a.length;o++)a[o].setAttribute("target","_blank");return i.innerHTML}t.VIEWER_VERSION=M,a.NF.config={logLevel:0,serviceDelay:0,assetPrefix:"",manifestFailureAlert:!0,useMockApiService:!1},a.NF.location={setUri:function(e){if(!a.NF.hasBeforeUnload&&a.NF.appViewModel.contentViewModel().beforeUnload){var t=a.NF.appViewModel.contentViewModel().beforeUnload();if(t)return void(0,v.showBeforeUnloadDialog)(t,function(){window.location.href=e})}window.location.href=e},getPathname:function(){return window.location.pathname+window.location.search}},a.NF.currentQueryParams={},a.NF.asset=N,a.NF.triggerResize=function(){window.setTimeout(function(){(0,a.$)("body").resize()},0)},a.NF.resizeBody=function(e){e.length>0&&(0,a.$)("body").resize()},a.NF.markdownToHtml=x,a.NF.markdownToHtmlLine=function(e){return(0,a.$)(a.NF.markdownToHtml(e)).filter("p").map(function(e,t){return(0,a.$)(t).html()}).toArray().join("\n")},a.NF.reloadWindow=function(){window.location.reload(!0)},a.NF.loadScript=function(e,t){var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=e.replace(/^[a-z]+:/,"https:"==document.location.protocol?"https:":"http:");var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(o,r),t&&(o.readyState?o.onreadystatechange=function(){"loaded"!=o.readyState&&"complete"!=o.readyState||(o.onreadystatechange=null,t())}:o.onload=function(){t()})},a.NF.loadScripts=function(e,t){0!==e.length?a.NF.loadScript(e.shift(),function(){a.NF.loadScripts(e,t)}):t()};var D=a.ko.observable(),F=a.ko.computed({read:function(){return D()},write:function(e){if(e!=a.NF.locale()){var t=a.NF.postService("/client/1.0/locale",a.NF.appViewModel.contentViewModel(),function(){a.NF.reloadWindow()});a.NF.session&&a.NF.session.current_user&&t(e?{locale:e,user:a.NF.session.current_user()}:{}),t(e?{locale:e}:{})}}});t.locale=F,a.NF.locale=F;var L=a.ko.computed(function(){return a.NF.locale()&&a.NF.locale().replace(/-..$/,"")});t.languageCode=L,a.NF.languageCode=L;var U=a.ko.computed(function(){return(new Date).getFullYear()});t.currentYear=U,a.NF.currentYear=U,a.NF.setDefaultStaticViewerVariables=function(){a.NF.embedded=!0,a.NF.session={locale:function(){return"en"},languageCode:function(){return"en"},current_user:function(){return null},showCommunityGroups:function(){return!1},remoteIsmEngaged:function(){return!1},community_member:function(){return{id:function(){return null},sso_user_role:function(){return null}}},community:function(){return{id:function(){return null},community_logo:function(){return null},community_url:function(){return null},default_community:function(){return null},sso_allowed:function(){return!1},allow_anonymous_view:function(){return!1},suppress_embed_branding:function(){return!1},enable_browse_and_search:function(){return!1},managed:function(){return!1},is_google_classroom:function(){return!1}}}};var e=window.location.href.replace(/\/[^/]+$/,"/");e=e.substring(0,e.length-1),a.NF.config.assetPrefix=e,a.NF.config.instrumentPrefix=e+"/assets/instruments/"};var j=/[?&]log=(\d+)/.exec(window.location.search);j&&(a.NF.config.logLevel=parseInt(j[1])||0);var B=null;function V(){return B}function H(){B=(0,l.configureStore)();for(var e=a.Noteflight.models?Object.keys(a.Noteflight.models):[],t=0;t<e.length;t++){var o=e[t];if(u.storeModelTypes.indexOf(o)<0)console.log("Warning: unknown model type in response: ".concat(o));else{var r=a.Noteflight.models[o];B.dispatch({type:p.LOAD_MODELS.SUCCEEDED,modelsType:o,models:r})}}a.Noteflight.editor&&a.Noteflight.editor.contentId&&B.dispatch({type:f.LOAD_CONTENT.SUCCEEDED,contentId:a.Noteflight.editor.contentId,contentType:a.Noteflight.editor.contentType,contentFullUrl:a.Noteflight.editor.contentFullUrl,contentSlug:a.Noteflight.editor.contentSlug,isEditingProduct:a.Noteflight.editor.isEditingProduct}),B.dispatch({type:h.LOAD_SESSION.SUCCEEDED,communityId:a.Noteflight.session.community().id(),userId:a.NF.session.current_user()?a.NF.session.current_user().id():null,communityMemberId:a.NF.session.community_member()&&a.NF.session.community_member().id?a.NF.session.community_member().id():null,environment:a.NF.environment})}function G(){var e=window.innerWidth,t=window.innerHeight;(0,s.windowWidth)(e),(0,s.windowHeight)(t);var o=V();o&&o.dispatch((0,i.updateWindowDimensions)(window.innerWidth,window.innerHeight))}a.NF.initialize=function(){H(),a.NF.inlineTemplates||(0,c.default)(),function(e,t,o){var r=!1;(o=o||window).addEventListener(e,function(){r||(r=!0,requestAnimationFrame(function(){o.dispatchEvent(new CustomEvent(t)),r=!1}))})}("resize","optimizedResize"),window.removeEventListener("optimizedResize",G),window.addEventListener("optimizedResize",G),(0,b.initializeResources)({callback:function(){if(void 0===a.NF.analytics&&(a.NF.analytics=new P.default),D(a.NF.session.locale()),a.NF.appViewModel=new A,a.NF.viewModelOverride){var e={};a.NF.viewModelOverride.state&&(e.state=a.NF.viewModelOverride.state),a.NF.viewModelOverride.mode&&(e.mode=a.NF.viewModelOverride.mode),a.NF.appViewModel.navigate(a.NF.viewModelOverride.viewModelClass,e),a.NF.appViewModel.initializeView()}a.NF.apiService=new E.ApiService,(0,g.initializeRouter)(),(0,a.$)("#r3app")[0]&&a.ko.applyBindings(a.NF.appViewModel,(0,a.$)("#r3app")[0]),a.NF.viewModelOverride||a.NF.appViewModel.initializeView()}})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editorSelector=t.hasCopyrightedSongsSelector=t.editorAuthorshipSelector=t.currentUserIsPreviewingProductSelector=t.currentUserIsProductOwnerSelector=t.currentUserIsAuthorSelector=t.editorPurchaseInfoSelector=t.editorSongsSelector=t.editorSourceSongSelector=t.editorSongSelector=t.editorSongIdsSelector=t.editorScoreIdSelector=t.editorSongIdSelector=t.editorSourceProductSelector=t.editorSourceProductIdSelector=t.editorAuthorSelector=t.editorContentModelSelector=t.editorContentPolicySelector=t.productIdSelector=t.editorFollowersCountSelector=t.editorFollowBusySelector=t.editorReadySelector=t.editorIsEditingProductSelector=t.editorContentSlugSelector=t.editorContentFullUrlSelector=t.editorContentTypeSelector=t.editorContentIdSelector=void 0;var r=o(12),n=o(110),i=o(34),a=o(48),s=o(8),l=o(41);function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var u=function(e){return e.editor.contentId};t.editorContentIdSelector=u;var d=function(e){return e.editor.contentType};t.editorContentTypeSelector=d;var p=function(e){return e.editor.contentFullUrl};t.editorContentFullUrlSelector=p;var f=function(e){return e.editor.contentSlug};t.editorContentSlugSelector=f;var h=function(e){return e.editor.isEditingProduct};t.editorIsEditingProductSelector=h;t.editorReadySelector=function(e){return e.editor.ready};t.editorFollowBusySelector=function(e){return e.editor.followBusy};t.editorFollowersCountSelector=function(e){return e.editor.followersCount};t.productIdSelector=function(e){return{contentId:e.editor.contentId}};var m=(0,r.createSelector)(u,i.contentPoliciesSelector,function(e,t){var o=t[e];return void 0===o&&(o=(0,n.getDefaultContentPolicy)(e)),o});t.editorContentPolicySelector=m;var g=(0,r.createSelector)(u,d,i.scoresSelector,i.productsSelector,function(e,t,o,r){return t==s.SCORE?o[e]:t==s.PRODUCT?r[e]:void 0});t.editorContentModelSelector=g;var b=(0,r.createSelector)(g,i.usersSelector,function(e,t){if(e)return t[e.author_id]});t.editorAuthorSelector=b;var v=(0,r.createSelector)(g,function(e){return null!=e?e.source_product_id:null});t.editorSourceProductIdSelector=v;var y=(0,r.createSelector)(i.productsSelector,v,function(e,t){return null!=t?e[t]:null});t.editorSourceProductSelector=y;var _=(0,r.createSelector)(g,function(e){return e.song_id?e.song_id:null});t.editorSongIdSelector=_;var S=(0,r.createSelector)(u,d,i.scoresSelector,i.productsSelector,function(e,t,o,r){return t==s.SCORE?o[e].id:t==s.PRODUCT?r[e].source_score_id:void 0});t.editorScoreIdSelector=S;var w=(0,r.createSelector)(g,function(e){return e&&e.song_ids?e.song_ids:null});t.editorSongIdsSelector=w;var k=(0,r.createSelector)(i.songsSelector,_,function(e,t){return null!=t?e[t]:null});t.editorSongSelector=k;var E=(0,r.createSelector)(i.songsSelector,y,function(e,t){return null!=t?e[t.song_id]:null});t.editorSourceSongSelector=E;var P=(0,r.createSelector)(d,i.songsSelector,w,function(e,t,o){return"score"!=e||null==o?[]:(0,a.hydrateIdList)(o,t)});t.editorSongsSelector=P;var C=(0,r.createSelector)(d,g,y,function(e,t,o){return"score"==e&&null!=o?{authorizedName:o.authorized_name,purchasedQuantity:o.purchased_quantity,ensembleSizeMax:o.ensemble_size_max}:"product"==e?{authorizedName:t.authorized_name,purchasedQuantity:t.purchased_quantity,ensembleSizeMax:t.ensemble_size_max}:{purchasedQuantity:null,authorizedName:null,ensembleSizeMax:null}});t.editorPurchaseInfoSelector=C;var T=(0,r.createSelector)(l.currentUserSelector,b,function(e,t){return!(!e||!t)&&e.id===t.id});t.currentUserIsAuthorSelector=T;var R=(0,r.createSelector)(d,C,function(e,t){return e===s.PRODUCT&&null!==t.purchasedQuantity&&t.purchasedQuantity>0});t.currentUserIsProductOwnerSelector=R;var O=(0,r.createSelector)(d,T,R,function(e,t,o){return e===s.PRODUCT&&!t&&!o});t.currentUserIsPreviewingProductSelector=O;var M=(0,r.createSelector)(g,function(e){return e&&null!=e.metadata?e.metadata.authorship:s.ORIGINAL_AUTHORSHIP});t.editorAuthorshipSelector=M;var A=(0,r.createSelector)(d,M,P,function(e,t,o){if("score"!=e||t!=s.ARRANGEMENT_AUTHORSHIP)return!1;for(var r=0;r<o.length;r++){if(!o[r].public_domain)return!0}return!1});t.hasCopyrightedSongsSelector=A;var N=(0,r.createSelector)(u,d,g,p,f,m,b,y,C,h,l.isTestEnvironmentSelector,l.isDevEnvironmentSelector,l.isLoggedInSelector,l.currentUserSelector,T,R,O,function(e,t,o,r,n,i,a,s,l,u,d,p,f,h,m,g,b){return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){c(e,t,o[t])})}return e}({contentId:e,contentType:t,contentModel:o,contentFullUrl:r,contentSlug:n,contentPolicy:i,author:a,sourceProduct:s,isEditingProduct:u,isTestEnvironment:d,isDevEnvironment:p,isLoggedIn:f,currentUser:h,currentUserIsAuthor:m,currentUserIsProductOwner:g,currentUserIsPreviewingProduct:b},l)});t.editorSelector=N},function(e,t,o){e.exports=o(7)(68)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateLayout=u,t.isStandardLayout=function(){return u()===n},t.isStandardOrLargerLayout=function(){return u()>=n},t.isMobileLayout=function(){return u()===i},t.isMobileOrSmallerLayout=function(){return u()<=i},t.isMobileLayoutOrLarger=function(){return u()>=i},t.isPhoneLayout=function(){return u()===a},t.isPhoneLayoutOrSmaller=d,t.isPhoneVerticalLayout=function(){return u()===s},t.isTouchDevice=function(){return!!("ontouchstart"in window||navigator.msMaxTouchPoints||navigator.maxTouchPoints)},t.windowHeight=t.windowWidth=t.PHONE_VERTICAL_LAYOUT=t.PHONE_LAYOUT=t.MOBILE_LAYOUT=t.STANDARD_LAYOUT=void 0;var r=o(6),n=4;t.STANDARD_LAYOUT=n;var i=3;t.MOBILE_LAYOUT=i;var a=2;t.PHONE_LAYOUT=a;var s=1;t.PHONE_VERTICAL_LAYOUT=s;var l=r.ko.observable(window.innerWidth);t.windowWidth=l;var c=r.ko.observable(window.innerHeight);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l();return e<500?s:e<768?a:e<1024?i:n}function d(){return u()<=a}t.windowHeight=c,Noteflight.IsPhoneLayout=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fixupDate=l,t.formatDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(l(e),null,t)},t.formatRelativeTime=u,t.getDefaultDatepickerOptions=function(){for(var e=[],t=0;t<7;t++)e.push((0,r.resource)("date.dayMin."+t));for(var o=[],n=0;n<7;n++)o.push((0,r.resource)("date.dayShort."+n));for(var i=[],a=0;a<12;a++)i.push((0,r.resource)("date.monthLong."+a));for(var s=[],l=0;l<12;l++)s.push((0,r.resource)("date.month."+l));var c=new Date;return{autoHide:!0,daysMin:e,daysShort:o,months:i,monthsShort:s,weekStart:(0,r.resource)("date.firstDayWeek"),startDate:c}},t.observableRelativeTime=function(e,t){return ko.computed(function(){return d()&&u(e,t)})},t.getDayAndMonth=function(e){return(0,r.resource)("date.format.dayAndMonth",[e.getDate(),(0,r.resource)("date.month.".concat(e.getMonth()))])},t.daysForMonth=function(e,t){var o=new Date(t,e,0).getDate();isNaN(o)&&(o=31);var r=Array.from(Array(o+1).keys());return r.shift(),r};var r=o(0);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=864e5,a=Math.pow(10,10);function s(e){if(null===e||void 0===e)return new Date;switch(n(e)){case"number":return new Date(e<a?1e3*e:e);case"string":return new Date(e)}return e}function l(e){var t=(e=s(e)).getTime();return(t%i==0||"string"==typeof t&&t.length<=10)&&(e=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),e}function c(e,t){var o="date.format",n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).monthLong?"date.monthLong.":"date.month.";t&&(o+="."+t);var i=e.getYear();i<1900&&(i+=1900);var a=e.getMonth()+1,s=(0,r.resource)(n+e.getMonth()),l=e.getDate(),c=(0,r.resource)("date.day."+e.getDay()),u=e.getHours(),d=e.getHours()%12;0===d&&(d=12);var p=e.getMinutes();p<10&&(p="0"+p);var f=(0,r.resource)(u>=12?"time.pm":"time.am");return(0,r.resource)(o,l,a,s,i,c,u,d,p,f)}function u(e,t){return e=s(e),t=s(t),(e.getTime()>t.getTime()?function(e,t){var o,n=Math.floor((e.getTime()-t.getTime())/1e3);if(n<60)o="seconds";else if((n/=60)<60)o="minutes";else if((n/=60)<24)o="hours";else{if(!((n/=24)<30))return c(e);o="days"}return(0,r.pluralize)("time."+o+".fromNow",Math.floor(n))}:function(e,t){var o;if(t.getTime()-e.getTime()<6*i)switch(t.getDay()-e.getDay()){case 0:o="time_today";break;case 1:case-6:o="time_yesterday";break;default:o="time_days_ago"}else o=e.getYear()==t.getYear()?"time_this_year":"time_long_ago";return c(e,o)})(e,t)}var d=ko.observable(1);setInterval(function(){d(d()+1)},6e4)},,function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.topic=t,this.name=o}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"isTypeFor",value:function(e){return 0===e.indexOf(this.toString())}},{key:"REQUESTED",get:function(){return"".concat(this.toString(),"__REQUESTED")}},{key:"SUCCEEDED",get:function(){return"".concat(this.toString(),"__SUCCEEDED")}},{key:"FAILED",get:function(){return"".concat(this.toString(),"__FAILED")}},{key:"RESET",get:function(){return"".concat(this.toString(),"__RESET")}}]),e}();t.default=n,n.prototype.toString=function(){return"".concat(this.topic,"__").concat(this.name)}},function(e,t,o){e.exports=o(7)(379)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.default)(p(e,t),{method:"GET",credentials:"same-origin"}).then(l).then(c).then(d)},t.getAndIgnoreResponse=function(e){return(0,r.default)(e,{method:"GET",credentials:"same-origin"}).then(l)},t.getScoreContent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.default)("".concat(e,"/").concat(t.id),{method:"GET",credentials:"same-origin"}).then(l).then(u).then(function(e){var t=e;return 0===e.indexOf("<noteflightCompressed>")?t=s(e):e.indexOf("error")>-1&&(t=JSON.parse(e).errors[0].code),t}).then(d)},t.getPakoCompressed=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.default)(p(e,t),{method:"GET",credentials:"same-origin"}).then(l).then(u).then(function(e){return JSON.parse(n.default.inflate(e,{to:"string"}))}).then(d)},t.jsonPost=function(e,t){var o=t?JSON.stringify(t):null;return(0,r.default)(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":function(){if(f)return f;f="undefined"!=typeof Noteflight?Noteflight.authenticityToken:document.querySelector('meta[name="csrf-token"]').content;return f}()},credentials:"same-origin",body:o}).then(l).then(c).then(d)},t.del=function(e){return(0,r.default)(e,{method:"DELETE",credentials:"same-origin"}).then(l).then(c).then(d)},t.jsonPut=function(e,t){var o=t?JSON.stringify(t):null;return(0,r.default)(e,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:o}).then(l).then(c).then(d)},t.decompressScoreXml=s;var r=i(o(170)),n=i(o(55));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return n.default.inflate(atob(e.match(/<noteflightCompressed>(.*)<\/noteflightCompressed>/)[1]),{to:"string"})}function l(e){if(e.status>=500)throw new Error("internalServerError");return e}function c(e){return e.json()}function u(e){return e.text()}function d(e){if(a(e.errors)===a([])&&e.errors.length>0){var t=e.errors[0];throw new Error(t.code)}return e}function p(e,t){var o=encodeURIComponent,r=Object.keys(t).map(function(e){return"".concat(o(e),"=").concat(o(t[e]))}).join("&");return r?"".concat(e,"?").concat(r):e}var f=null},,function(e,t,o){e.exports=o(7)(595)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkWindowProp=a,t.checkStorageEnabled=s,t.iOS=l,t.iOSVersion=c,t.isMac=u,t.chrome=d,t.mozilla=p,t.safari=f,t.IEVersion=h,t.chromeiOS=m,t.crawler=function(){return/bot|googlebot|bingbot|crawler|spider|robot|crawling/i.test(window.navigator.userAgent)},t.homeScreenApp=g,t.hasAudio=b,t.supportsDataURI=v,t.hasBlob=y,t.hasSVG=_,t.hasBeforeUnload=S,t.hasSaveAs=w,t.hasOfflineAudioContext=k,t.hasAsyncOpen=E,t.hasStorage=P,t.hasSessionStorage=C,t.storageDisabled=T,t.slowAudio=R,t.supportsAudioRecording=O,t.SESSION_STORAGE=t.LOCAL_STORAGE=void 0;var r=o(6),n="localStorage";t.LOCAL_STORAGE=n;var i="sessionStorage";function a(e){try{return!!window[e]}catch(e){return!1}}function s(e){try{return e.setItem("_nf_storage","0"),e.removeItem("_nf_storage"),!0}catch(t){return e.length>0}}function l(){return window.navigator.userAgent.indexOf("iPad")>=0||window.navigator.userAgent.indexOf("iPhone")>=0}function c(){if(l()){var e=window.navigator.userAgent.match(/ OS ([0-9]+_[0-9]+)/)||window.navigator.userAgent.match(/Version\/([0-9.]+)/);if(e)return parseFloat(e[1].replace("_","."))}}function u(){return window.navigator.platform.toUpperCase().indexOf("MAC")>=0}function d(){return window.navigator.userAgent.indexOf("Chrome")>=0}function p(){return window.navigator.userAgent.indexOf("Firefox")>=0}function f(){return window.navigator.userAgent.indexOf("Safari")>=0&&!d()}function h(){var e;if("Microsoft Internet Explorer"==window.navigator.appName){if(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(window.navigator.userAgent))return parseFloat(e[1])}else if("Netscape"==window.navigator.appName){if(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(window.navigator.userAgent))return parseFloat(e[1]);if(e=new RegExp("Edge/[0-9]+").exec(window.navigator.userAgent))return parseFloat(e[0].substring(e[0].length-2))}return-1}function m(){return/(CriOS)/.test(window.navigator.userAgent)}function g(){return"standalone"in window.navigator&&window.navigator.standalone}function b(){try{if(window.AudioContext)return!0}catch(e){}try{if(window.webkitAudioContext)return!0}catch(e){}return!1}function v(){return(d()||p())&&-1==h()}function y(){return!l()&&(!window.navigator.getUserMedia||void 0!==window.URL&&void 0!==window.URL.createObjectURL)}function _(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}function S(){return!l()}function w(){return y()&&!f()}function k(){try{return new window.OfflineAudioContext(2,44100,44100),!0}catch(e){return!1}}function E(){return!f()}function P(){return a(n)&&s(window.localStorage)}function C(){return a(i)&&s(window.sessionStorage)}function T(){return a(n)&&!s(window.localStorage)}function R(){return null!=window.navigator.userAgent.match(/iPad/i)&&window.devicePixelRatio<=1}function O(){return window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia}t.SESSION_STORAGE=i,r.NF.iOS=l(),r.NF.iOSVersion=c(),r.NF.isMac=u(),r.NF.chrome=d(),r.NF.mozilla=p(),r.NF.safari=f(),r.NF.IEVersion=h(),r.NF.chromeiOS=m(),r.NF.homeScreenApp=g(),r.NF.hasAudio=b(),r.NF.supportsDataURI=v(),r.NF.hasBlob=y(),r.NF.hasSVG=_(),r.NF.hasBeforeUnload=S(),r.NF.hasSaveAs=w(),r.NF.hasOfflineAudioContext=k(),r.NF.hasAsyncOpen=E(),r.NF.hasStorage=P(),r.NF.hasSessionStorage=C(),r.NF.storageDisabled=T(),r.NF.slowAudio=R(),r.NF.supportsAudioRecording=O()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStringForResourcesKey=a,t.hasInvalidChars=function(e){return!/^[ -~]+$/.test(e)},t.getStringToCompare=s,t.arrayHasContent=function(e){if(!e)return!1;for(var t=0;t<e.length;t++)if(e[t])return!0;return!1},t.getSearchParametersFromQuery=l,t.isNullOrUndefined=function(e){return void 0===e||null===e},t.prepareForElasticSearch=function(e){if(null===e||void 0===e)return null;return e=e.replace(/\//g,"")},t.camelCase=c,t.cssFriendlify=function(e){if(!e)return null;return e.replace(/\//g,"_")},t.validateUsername=function(e){if(!e.trim())return{error:"errors.usernameRequired"};if(!(0,i.usernamePattern)(e))return{error:"errors.usernameFormat"};return{}},t.validatePassword=function(e){var t=e.trim();if(!t)return{error:"errors.passwordRequired"};if(t.length<r.MIN_PASSWORD_LENGTH)return{error:"errors.passwordTooShort"};if(t.length>r.MAX_PASSWORD_LENGTH)return{error:"errors.passwordTooLong"};return{}},t.escapeHtml=function(e){var t,o=""+e,r=/["'&<>]/.exec(o);if(!r)return o;var n="",i=0,a=0;for(i=r.index;i<o.length;i++){switch(o.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}a!==i&&(n+=o.substring(a,i)),a=i+1,n+=t}return a!==i?n+o.substring(a,i):n};var r=o(8),n=o(0),i=o(192);function a(e){return(e=(e=e.replace(/ /g,"_")).replace(/[^\w]/gi,"")).toLowerCase()}function s(e){var t=e.toLowerCase();return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(new RegExp("\\s","g"),"")).replace(new RegExp("[]","g"),"a")).replace(new RegExp("","g"),"ae")).replace(new RegExp("","g"),"c")).replace(new RegExp("[]","g"),"e")).replace(new RegExp("[]","g"),"i")).replace(new RegExp("","g"),"n")).replace(new RegExp("[]","g"),"o")).replace(new RegExp("","g"),"oe")).replace(new RegExp("[]","g"),"u")).replace(new RegExp("[]","g"),"y")).replace(new RegExp("\\W","g"),"")}function l(e){if(!e)return{};for(var t=e.split("&"),o={},r=0;r<t.length;r++){var n=t[r].split(":");o[n[0]]||(o[n[0]]=[]);var i=n.splice(1);o[n[0]].push(i.join(":"))}return o}function c(e){return e?e.replace(/_([a-z])/g,function(e){return e[1].toUpperCase()}):""}Noteflight.getStringForResourcesKey=a,Noteflight.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},Noteflight.toTitleCase=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},Noteflight.prettifyAttributeString=function(e,t){var o;switch(e){case"key_signature":if(t){var r=t.split("/");if("unknown"==r){o=(0,n.resource)("mode.unknown");break}var i=r[1],a=r[0];o=(0,n.resource)("note."+a)+" "+(0,n.resource)("mode."+i);break}o=(0,n.resource)("mode.unknown");break;case"hlc_grade":case"grade":o=(0,n.resource)("content.gradeLevel",t);break;case"hlc_genre":case"genre":default:o=t}return o},Noteflight.isValidEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},Noteflight.getStringToCompare=s,Noteflight.slugify=function(e){var t=e.replace(/[\. _\-]+/g,"-");return t=(t=(t=(t=t.replace(/[^a-zA-Z0-9\-]/g,"")).replace(/^-+/g,"")).replace(/-+$/g,"")).toLowerCase()},Noteflight.removeBreakLines=function(e){return e.replace(/(\r\n|\n|\r)/gm," ")},Noteflight.getSearchParametersFromQuery=l,Noteflight.camelCase=c,Noteflight.snake_case=function(e){return e?e.replace(/([A-Z])/g,function(e){return"_".concat(e.toLowerCase())}):""},Noteflight.cleanLTR=function(e){return e.replace(/&lrm;|\u200E/gi,"")}},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){var t="ui-effects-animated",o=e;return e.effects={effect:{}},function(e,t){var o,r=/^([\-+])=\s*(\d+\.?\d*)/,n=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],i=e.Color=function(t,o,r,n){return new e.Color.fn.parse(t,o,r,n)},a={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},s={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},l=i.support={},c=e("<p>")[0],u=e.each;function d(e,t,o){var r=s[t.type]||{};return null==e?o||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:r.max<e?r.max:e)}function p(t){var r=i(),s=r._rgba=[];return t=t.toLowerCase(),u(n,function(e,o){var n,i=o.re.exec(t),l=i&&o.parse(i),c=o.space||"rgba";if(l)return n=r[c](l),r[a[c].cache]=n[a[c].cache],s=r._rgba=n._rgba,!1}),s.length?("0,0,0,0"===s.join()&&e.extend(s,o.transparent),r):o[t]}function f(e,t,o){return 6*(o=(o+1)%1)<1?e+(t-e)*o*6:2*o<1?t:3*o<2?e+(t-e)*(2/3-o)*6:e}c.style.cssText="background-color:rgba(1,1,1,.5)",l.rgba=c.style.backgroundColor.indexOf("rgba")>-1,u(a,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),i.fn=e.extend(i.prototype,{parse:function(t,r,n,s){if(void 0===t)return this._rgba=[null,null,null,null],this;(t.jquery||t.nodeType)&&(t=e(t).css(r),r=void 0);var l=this,c=e.type(t),f=this._rgba=[];return void 0!==r&&(t=[t,r,n,s],c="array"),"string"===c?this.parse(p(t)||o._default):"array"===c?(u(a.rgba.props,function(e,o){f[o.idx]=d(t[o.idx],o)}),this):"object"===c?(u(a,t instanceof i?function(e,o){t[o.cache]&&(l[o.cache]=t[o.cache].slice())}:function(o,r){var n=r.cache;u(r.props,function(e,o){if(!l[n]&&r.to){if("alpha"===e||null==t[e])return;l[n]=r.to(l._rgba)}l[n][o.idx]=d(t[e],o,!0)}),l[n]&&e.inArray(null,l[n].slice(0,3))<0&&(l[n][3]=1,r.from&&(l._rgba=r.from(l[n])))}),this):void 0},is:function(e){var t=i(e),o=!0,r=this;return u(a,function(e,n){var i,a=t[n.cache];return a&&(i=r[n.cache]||n.to&&n.to(r._rgba)||[],u(n.props,function(e,t){if(null!=a[t.idx])return o=a[t.idx]===i[t.idx]})),o}),o},_space:function(){var e=[],t=this;return u(a,function(o,r){t[r.cache]&&e.push(o)}),e.pop()},transition:function(e,t){var o=i(e),r=o._space(),n=a[r],l=0===this.alpha()?i("transparent"):this,c=l[n.cache]||n.to(l._rgba),p=c.slice();return o=o[n.cache],u(n.props,function(e,r){var n=r.idx,i=c[n],a=o[n],l=s[r.type]||{};null!==a&&(null===i?p[n]=a:(l.mod&&(a-i>l.mod/2?i+=l.mod:i-a>l.mod/2&&(i-=l.mod)),p[n]=d((a-i)*t+i,r)))}),this[r](p)},blend:function(t){if(1===this._rgba[3])return this;var o=this._rgba.slice(),r=o.pop(),n=i(t)._rgba;return i(e.map(o,function(e,t){return(1-r)*n[t]+r*e}))},toRgbaString:function(){var t="rgba(",o=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===o[3]&&(o.pop(),t="rgb("),t+o.join()+")"},toHslaString:function(){var t="hsla(",o=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e});return 1===o[3]&&(o.pop(),t="hsl("),t+o.join()+")"},toHexString:function(t){var o=this._rgba.slice(),r=o.pop();return t&&o.push(~~(255*r)),"#"+e.map(o,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),i.fn.parse.prototype=i.fn,a.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,o,r=e[0]/255,n=e[1]/255,i=e[2]/255,a=e[3],s=Math.max(r,n,i),l=Math.min(r,n,i),c=s-l,u=s+l,d=.5*u;return t=l===s?0:r===s?60*(n-i)/c+360:n===s?60*(i-r)/c+120:60*(r-n)/c+240,o=0===c?0:d<=.5?c/u:c/(2-u),[Math.round(t)%360,o,d,null==a?1:a]},a.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,o=e[1],r=e[2],n=e[3],i=r<=.5?r*(1+o):r+o-r*o,a=2*r-i;return[Math.round(255*f(a,i,t+1/3)),Math.round(255*f(a,i,t)),Math.round(255*f(a,i,t-1/3)),n]},u(a,function(t,o){var n=o.props,a=o.cache,s=o.to,l=o.from;i.fn[t]=function(t){if(s&&!this[a]&&(this[a]=s(this._rgba)),void 0===t)return this[a].slice();var o,r=e.type(t),c="array"===r||"object"===r?t:arguments,p=this[a].slice();return u(n,function(e,t){var o=c["object"===r?e:t.idx];null==o&&(o=p[t.idx]),p[t.idx]=d(o,t)}),l?((o=i(l(p)))[a]=p,o):i(p)},u(n,function(o,n){i.fn[o]||(i.fn[o]=function(i){var a,s=e.type(i),l="alpha"===o?this._hsla?"hsla":"rgba":t,c=this[l](),u=c[n.idx];return"undefined"===s?u:("function"===s&&(i=i.call(this,u),s=e.type(i)),null==i&&n.empty?this:("string"===s&&(a=r.exec(i))&&(i=u+parseFloat(a[2])*("+"===a[1]?1:-1)),c[n.idx]=i,this[l](c)))})})}),i.hook=function(t){var o=t.split(" ");u(o,function(t,o){e.cssHooks[o]={set:function(t,r){var n,a,s="";if("transparent"!==r&&("string"!==e.type(r)||(n=p(r)))){if(r=i(n||r),!l.rgba&&1!==r._rgba[3]){for(a="backgroundColor"===o?t.parentNode:t;(""===s||"transparent"===s)&&a&&a.style;)try{s=e.css(a,"backgroundColor"),a=a.parentNode}catch(e){}r=r.blend(s&&"transparent"!==s?s:"_default")}r=r.toRgbaString()}try{t.style[o]=r}catch(e){}}},e.fx.step[o]=function(t){t.colorInit||(t.start=i(t.elem,o),t.end=i(t.end),t.colorInit=!0),e.cssHooks[o].set(t.elem,t.start.transition(t.end,t.pos))}})},i.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return u(["Top","Right","Bottom","Left"],function(o,r){t["border"+r+"Color"]=e}),t}},o=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(o),function(){var t=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function n(t){var o,r,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,i={};if(n&&n.length&&n[0]&&n[n[0]])for(r=n.length;r--;)"string"==typeof n[o=n[r]]&&(i[e.camelCase(o)]=n[o]);else for(o in n)"string"==typeof n[o]&&(i[o]=n[o]);return i}e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,r){e.fx.step[r]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(o.style(e.elem,r,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(o,i,a,s){var l=e.speed(i,a,s);return this.queue(function(){var i,a=e(this),s=a.attr("class")||"",c=l.children?a.find("*").addBack():a;c=c.map(function(){return{el:e(this),start:n(this)}}),(i=function(){e.each(t,function(e,t){o[t]&&a[t+"Class"](o[t])})})(),c=c.map(function(){return this.end=n(this.el[0]),this.diff=function(t,o){var n,i,a={};for(n in o)i=o[n],t[n]!==i&&(r[n]||!e.fx.step[n]&&isNaN(parseFloat(i))||(a[n]=i));return a}(this.start,this.end),this}),a.attr("class",s),c=c.map(function(){var t=this,o=e.Deferred(),r=e.extend({},l,{queue:!1,complete:function(){o.resolve(t)}});return this.el.animate(this.diff,r),o.promise()}),e.when.apply(e,c.get()).done(function(){i(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(a[0])})})},e.fn.extend({addClass:function(t){return function(o,r,n,i){return r?e.effects.animateClass.call(this,{add:o},r,n,i):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(o,r,n,i){return arguments.length>1?e.effects.animateClass.call(this,{remove:o},r,n,i):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(o,r,n,i,a){return"boolean"==typeof r||void 0===r?n?e.effects.animateClass.call(this,r?{add:o}:{remove:o},n,i,a):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:o},r,n,i)}}(e.fn.toggleClass),switchClass:function(t,o,r,n,i){return e.effects.animateClass.call(this,{add:o,remove:t},r,n,i)}})}(),function(){function o(t,o,r,n){return e.isPlainObject(t)&&(o=t,t=t.effect),t={effect:t},null==o&&(o={}),e.isFunction(o)&&(n=o,r=null,o={}),("number"==typeof o||e.fx.speeds[o])&&(n=r,r=o,o={}),e.isFunction(r)&&(n=r,r=null),o&&e.extend(t,o),r=r||o.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=n||o.complete,t}function r(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||"string"==typeof t&&!e.effects.effect[t]||!!e.isFunction(t)||"object"==typeof t&&!t.effect}function n(e,t){var o=t.outerWidth(),r=t.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(e)||["",0,o,r,0];return{top:parseFloat(n[1])||0,right:"auto"===n[2]?o:parseFloat(n[2]),bottom:"auto"===n[3]?r:parseFloat(n[3]),left:parseFloat(n[4])||0}}e.expr&&e.expr.filters&&e.expr.filters.animated&&(e.expr.filters.animated=function(o){return function(r){return!!e(r).data(t)||o(r)}}(e.expr.filters.animated)),!1!==e.uiBackCompat&&e.extend(e.effects,{save:function(e,t){for(var o=0,r=t.length;o<r;o++)null!==t[o]&&e.data("ui-effects-"+t[o],e[0].style[t[o]])},restore:function(e,t){for(var o,r=0,n=t.length;r<n;r++)null!==t[r]&&(o=e.data("ui-effects-"+t[r]),e.css(t[r],o))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var o={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},i=document.activeElement;try{i.id}catch(e){i=document.body}return t.wrap(r),(t[0]===i||e.contains(t[0],i))&&e(i).trigger("focus"),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(o,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){o[r]=t.css(r),isNaN(parseInt(o[r],10))&&(o[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),r.css(o).show()},removeWrapper:function(t){var o=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===o||e.contains(t[0],o))&&e(o).trigger("focus")),t}}),e.extend(e.effects,{version:"1.12.1",define:function(t,o,r){return r||(r=o,o="effect"),e.effects.effect[t]=r,e.effects.effect[t].mode=o,r},scaledDimensions:function(e,t,o){if(0===t)return{height:0,width:0,outerHeight:0,outerWidth:0};var r="horizontal"!==o?(t||100)/100:1,n="vertical"!==o?(t||100)/100:1;return{height:e.height()*n,width:e.width()*r,outerHeight:e.outerHeight()*n,outerWidth:e.outerWidth()*r}},clipToBox:function(e){return{width:e.clip.right-e.clip.left,height:e.clip.bottom-e.clip.top,left:e.clip.left,top:e.clip.top}},unshift:function(e,t,o){var r=e.queue();t>1&&r.splice.apply(r,[1,0].concat(r.splice(t,o))),e.dequeue()},saveStyle:function(e){e.data("ui-effects-style",e[0].style.cssText)},restoreStyle:function(e){e[0].style.cssText=e.data("ui-effects-style")||"",e.removeData("ui-effects-style")},mode:function(e,t){var o=e.is(":hidden");return"toggle"===t&&(t=o?"show":"hide"),(o?"hide"===t:"show"===t)&&(t="none"),t},getBaseline:function(e,t){var o,r;switch(e[0]){case"top":o=0;break;case"middle":o=.5;break;case"bottom":o=1;break;default:o=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:o}},createPlaceholder:function(t){var o,r=t.css("position"),n=t.position();return t.css({marginTop:t.css("marginTop"),marginBottom:t.css("marginBottom"),marginLeft:t.css("marginLeft"),marginRight:t.css("marginRight")}).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()),/^(static|relative)/.test(r)&&(r="absolute",o=e("<"+t[0].nodeName+">").insertAfter(t).css({display:/^(inline|ruby)/.test(t.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:t.css("marginTop"),marginBottom:t.css("marginBottom"),marginLeft:t.css("marginLeft"),marginRight:t.css("marginRight"),float:t.css("float")}).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).addClass("ui-effects-placeholder"),t.data("ui-effects-placeholder",o)),t.css({position:r,left:n.left,top:n.top}),o},removePlaceholder:function(e){var t="ui-effects-placeholder",o=e.data(t);o&&(o.remove(),e.removeData(t))},cleanUp:function(t){e.effects.restoreStyle(t),e.effects.removePlaceholder(t)},setTransition:function(t,o,r,n){return n=n||{},e.each(o,function(e,o){var i=t.cssUnit(o);i[0]>0&&(n[o]=i[0]*r+i[1])}),n}}),e.fn.extend({effect:function(){var r=o.apply(this,arguments),n=e.effects.effect[r.effect],i=n.mode,a=r.queue,s=a||"fx",l=r.complete,c=r.mode,u=[],d=function(o){var r=e(this),n=e.effects.mode(r,c)||i;r.data(t,!0),u.push(n),i&&("show"===n||n===i&&"hide"===n)&&r.show(),i&&"none"===n||e.effects.saveStyle(r),e.isFunction(o)&&o()};if(e.fx.off||!n)return c?this[c](r.duration,l):this.each(function(){l&&l.call(this)});function p(o){var a=e(this);function s(){e.isFunction(l)&&l.call(a[0]),e.isFunction(o)&&o()}r.mode=u.shift(),!1===e.uiBackCompat||i?"none"===r.mode?(a[c](),s()):n.call(a[0],r,function(){a.removeData(t),e.effects.cleanUp(a),"hide"===r.mode&&a.hide(),s()}):(a.is(":hidden")?"hide"===c:"show"===c)?(a[c](),s()):n.call(a[0],r,s)}return!1===a?this.each(d).each(p):this.queue(s,d).queue(s,p)},show:function(e){return function(t){if(r(t))return e.apply(this,arguments);var n=o.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(r(t))return e.apply(this,arguments);var n=o.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(r(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=o.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var o=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){o.indexOf(t)>0&&(r=[parseFloat(o),t])}),r},cssClip:function(e){return e?this.css("clip","rect("+e.top+"px "+e.right+"px "+e.bottom+"px "+e.left+"px)"):n(this.css("clip"),this)},transfer:function(t,o){var r=e(this),n=e(t.to),i="fixed"===n.css("position"),a=e("body"),s=i?a.scrollTop():0,l=i?a.scrollLeft():0,c=n.offset(),u={top:c.top-s,left:c.left-l,height:n.innerHeight(),width:n.innerWidth()},d=r.offset(),p=e("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(t.className).css({top:d.top-s,left:d.left-l,height:r.innerHeight(),width:r.innerWidth(),position:i?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){p.remove(),e.isFunction(o)&&o()})}}),e.fx.step.clip=function(t){t.clipInit||(t.start=e(t.elem).cssClip(),"string"==typeof t.end&&(t.end=n(t.end,t.elem)),t.clipInit=!0),e(t.elem).cssClip({top:t.pos*(t.end.top-t.start.top)+t.start.top,right:t.pos*(t.end.right-t.start.right)+t.start.right,bottom:t.pos*(t.end.bottom-t.start.bottom)+t.start.bottom,left:t.pos*(t.end.left-t.start.left)+t.start.left})}}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,o){t[o]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,o=4;e<((t=Math.pow(2,--o))-1)/11;);return 1/Math.pow(4,3-o)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,o){e.easing["easeIn"+t]=o,e.easing["easeOut"+t]=function(e){return 1-o(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?o(2*e)/2:1-o(-2*e+2)/2}})}(),e.effects})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMOVE_MODELS=t.UPDATE_MODELS=t.LOAD_MODELS=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("MODELS","LOAD_MODELS");t.LOAD_MODELS=n;var i=new r.default("MODELS","UPDATE_MODELS");t.UPDATE_MODELS=i;var a=new r.default("MODELS","REMOVE_MODELS");t.REMOVE_MODELS=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCookie=function(e){for(var t=e+"=",o=decodeURIComponent(document.cookie).split(";"),r=0;r<o.length;r++){for(var n=o[r];" "==n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return""},t.setCookie=function(e,t,o,r,n){var i=new Date((new Date).getTime()+o),a=e.toString()+"="+t.toString()+"; expires="+i.toUTCString()+"; domain="+r.toString()+"; path="+n.toString();document.cookie=a},t.verifyCookiesEnabled=void 0;var r=o(5),n=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),i=o(0);t.verifyCookiesEnabled=function(){return n.default.publish(r.REPORTER_CLEAR_ERRORS),!!window.navigator.cookieEnabled||(n.default.publish(r.REPORTER_ADD_ERROR,{code:"cookiesRequired",message:(0,i.resource)("errors.cookiesRequired")}),!1)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};new p(e,t,o,r).show()};var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(2),i=o(0),a=o(3);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e,o,r){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=c(this,u(t).call(this))).title=e,a.action=o,a.permission=r,a.actionResource=s.actionResource||"mustBePremium.actionMessage",a.message=(0,i.resource)(a.actionResource,a.action),a.upgradePath=s.upgradePath||(0,n.path)("plans"),a.cancelPath=s.cancelPath,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"show",value:function(){(0,a.createAndShowDialog)({viewModel:this,templateName:"dialogs/mustBePremium"}),NF.analytics.trackEvent("conversion","upgrade_prompt",this.permission)}},{key:"upgrade",value:function(){NF.analytics.trackEvent("conversion","upgrade",this.permission),this.hideDialog(),(0,n.navigate)(this.upgradePath)}},{key:"doCancel",value:function(){return this.cancelPath&&(0,n.navigate)(this.cancelPath),!0}},{key:"doOk",value:function(){return this.upgrade(),!0}}]),t}()},,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.documentRolesSelector=t.groupsSelector=t.usersSelector=t.songsSelector=t.scoresSelector=t.productsSelector=t.contentPoliciesSelector=t.communityMembersSelector=t.communitiesSelector=void 0;t.communitiesSelector=function(e){return e.models.communities};t.communityMembersSelector=function(e){return e.models.communityMembers};t.contentPoliciesSelector=function(e){return e.models.contentPolicies};t.productsSelector=function(e){return e.models.products};t.scoresSelector=function(e){return e.models.scores};t.songsSelector=function(e){return e.models.songs};t.usersSelector=function(e){return e.models.users};t.groupsSelector=function(e){return e.models.groups};t.documentRolesSelector=function(e){return e.models.documentRoles}},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=function(e,t,o){var r;return function(){for(var n=this,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];clearTimeout(r),r=setTimeout(function(){r=null,o||e.apply(n,a)},t),o&&!r&&e.apply(this,a.concat())}},t.default=void 0;var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,null,[{key:"xhrRequest",value:function(e){var t,o,r,n,i;e||(e={});return(n=function(e){var t=document.createElement("a");return t.href=e,t.hostname}(e.url))!=window.location.hostname&&""!==n&&"function"==typeof XDomainRequest?(e.type||(e.type="get"),(o=new XDomainRequest).onload=function(){},o.onprogress=function(){},o.open(e.type,e.url),o.send()):"arraybuffer"==e.dataType?((i=new XMLHttpRequest).open(e.type,e.url,!0),i.responseType=e.dataType,i.send(null)):r=$.ajax(e),t={done:function(n){return o&&(o.onload=function(){var t=function(e,t){return"json"==(t=t.toLowerCase())?JSON.parse(e):"xml"==t?$.parseXML(e):e}(o.responseText,e.dataType);n(t)}),i&&(i.onload=function(){n(i.response)}),r&&r.done(n),t},fail:function(n){return o&&(o.onerror=function(){n(e,o.responseText)}),i&&(i.onerror=function(){n(e,i.response)}),r&&r.fail(n),t}}}},{key:"debounce",value:function(e,t,o){var r;return function(){for(var n=this,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];clearTimeout(r),r=setTimeout(function(){r=null,o||e.apply(n,a)},t),o&&!r&&e.apply(this,a.concat())}}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeTippy=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.maxWidth&&(e.maxWidth=t.maxWidth);setTimeout(function(){var o=(0,r.default)(".tippy",e);t.show&&o.tooltips[0]&&o.tooltips[0].show()},300)},t.leftCueHint=t.sellerSignupHint=t.originalBadgeHint=t.defaultHint=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(236));var n={arrow:!0,delay:50,size:"small",animation:"shift-toward",placement:"top",theme:"default",maxWidth:"150px"};t.defaultHint=n;t.originalBadgeHint={arrow:!0,delay:50,size:"small",animation:"shift-toward",placement:"bottom",theme:"default",maxWidth:"150px",distance:10};t.sellerSignupHint={arrow:!0,delay:50,size:"small",animation:"shift-toward",placement:"bottom",theme:"default",maxWidth:"205px",distance:10};t.leftCueHint={arrow:!0,delay:50,size:"small",animation:"shift-toward",placement:"left",theme:"default",maxWidth:"150px",distance:10,showOnInit:!0,sticky:!0,trigger:"manual"}},function(e,t,o){e.exports=o(7)(14)},,,function(e,t,o){e.exports=o(7)(163)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSiteAdminSelector=t.isSiteTeacherSelector=t.isSiteStudentSelector=t.currentCommunityMemberSelector=t.isDevEnvironmentSelector=t.isTestEnvironmentSelector=t.isLoggedInSelector=t.currentUserSelector=t.isDefaultCommunitySelector=t.sessionCommunitySelector=t.currentEnvironmentSelector=t.currentCommunityMemberIdSelector=t.currentUserIdSelector=t.sessionCommunityIdSelector=void 0;var r=o(12),n=o(8),i=o(34),a=function(e){return e.session.communityId};t.sessionCommunityIdSelector=a;var s=function(e){return e.session.userId};t.currentUserIdSelector=s;var l=function(e){return e.session.communityMemberId};t.currentCommunityMemberIdSelector=l;var c=function(e){return e.session.environment};t.currentEnvironmentSelector=c;var u=(0,r.createSelector)(a,i.communitiesSelector,function(e,t){return t[e]});t.sessionCommunitySelector=u;var d=(0,r.createSelector)(u,function(e){return e.default_community});t.isDefaultCommunitySelector=d;var p=(0,r.createSelector)(s,i.usersSelector,function(e,t){return t[e]?t[e]:null});t.currentUserSelector=p;var f=(0,r.createSelector)(p,function(e){return!!e});t.isLoggedInSelector=f;var h=(0,r.createSelector)(c,function(e){return"test"==e});t.isTestEnvironmentSelector=h;var m=(0,r.createSelector)(c,function(e){return"development"==e});t.isDevEnvironmentSelector=m;var g=(0,r.createSelector)(l,i.communityMembersSelector,function(e,t){if(t&&e)return t[e]});t.currentCommunityMemberSelector=g;var b=(0,r.createSelector)(g,f,function(e,t){return t&&e&&e.sso_user_role===n.SITE_STUDENT_ROLE});t.isSiteStudentSelector=b;var v=(0,r.createSelector)(g,f,function(e,t){return t&&e&&e.sso_user_role===n.SITE_TEACHER_ROLE});t.isSiteTeacherSelector=v;var y=(0,r.createSelector)(g,f,function(e,t){return t&&e&&e.sso_user_role===n.SITE_ADMIN_ROLE});t.isSiteAdminSelector=y},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(4)),n=s(o(58)),i=o(5),a=o(8);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.withBackground=ko.observable(o.withBackground||!1),this.useCss=ko.observable(o.useCss||!1),this.errorsReporter=new n.default(o),this.currentZindex=ko.observable(a.Z_INDEX_1000),this.fullScreenLabels=ko.observableArray([]),this.fullScreenLabel=ko.computed(function(){return 0===t.fullScreenLabels().length?null:t.fullScreenLabels()[t.fullScreenLabels().length-1].text}),this.showFullScreen=ko.computed(function(){return!!t.fullScreenLabel()}),this.actionLabels=ko.observableArray([]),this.actionLabel=ko.computed(function(){return 0===t.actionLabels().length?null:t.actionLabels()[t.actionLabels().length-1].text}),this.showReporter=ko.computed(function(){return t.actionLabels().length>0}),this.showErrors=ko.computed(function(){return t.errorsReporter.errors().length>0}),r.default.subscribe(i.REPORTER_ADD,function(e,o){t.addService(o)}),r.default.subscribe(i.REPORTER_REMOVE,function(e,o){t.removeService(o)}),r.default.subscribe(i.REPORTER_ADD_ERRORS,function(e,o){t.addErrors(o)}),r.default.subscribe(i.REPORTER_ADD_ERROR,function(e,o){t.addError(o)}),r.default.subscribe(i.REPORTER_CLEAR_ALL,function(e,o){t.clear()}),r.default.subscribe(i.REPORTER_CLEAR_ERRORS,function(e,o){t.clearErrors()})}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"addService",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};""!==e.text&&(e.fullScreen?(this.fullScreenLabels.push({text:e.text}),this.withBackground(e.withBackground),this.useCss(e.useCss),this.currentZindex(a.Z_INDEX_1000)):this.actionLabels.push({text:e.text}))}},{key:"removeService",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.fullScreen?this.fullScreenLabels.pop():e.text?this.actionLabels.splice(this.actionLabels().findIndex(function(t){return t.text===e.text}),1):this.actionLabels.pop()}},{key:"addErrors",value:function(e){for(var t=0;t<e.length;t++)this.addError(e[t])}},{key:"addError",value:function(e){this.errorsReporter.addError(e)}},{key:"clearServices",value:function(){this.actionLabels([])}},{key:"clearErrors",value:function(){this.errorsReporter.clearErrors()}},{key:"clear",value:function(){this.clearServices(),this.clearErrors()}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildUserLink=h,t.buildHeaderImageUrl=m,t.buildCssHeaderImageUrl=g,t.buildAvatarUrl=b,t.buildCssAvatarUrl=v,t.default=void 0;var r=d(o(4)),n=o(6),i=o(5),a=o(53),s=o(2),l=o(20),c=d(o(471)),u=o(0);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.profile=n.ko.observable(new c.default),this.update(t),this.createdDate=(0,l.observableRelativeTime)(this.created()),this.fullLocation=n.ko.computed(function(){var e="";return o.profile().location()&&(e+=o.profile().location()),o.profile().country()&&(o.profile().location()&&(e+=", "),e+=o.profile().country()),e}),this.displayableRole=n.ko.computed(function(){return o.role&&o.role()?(0,u.resource)("role."+o.role()):null}),this.isLoggedIn=n.ko.computed(function(){return n.NF.session&&n.NF.session.current_user()&&n.NF.session.current_user().external_id()==o.external_id()}),this.userExternalId=this.external_id,this.avatar=n.ko.computed(function(){return b(o.external_id())}),this.avatarUrl=n.ko.computed(function(){return v(o.external_id())}),this.headerImage=n.ko.computed(function(){return m(o.external_id())}),this.headerImageUrl=n.ko.computed(function(){return g(o.external_id())}),this.profilePage=n.ko.computed(function(){return h(o.external_id())}),r.default.subscribe(i.PROFILE_EPOCH_FORCE_UPDATE,function(e,t){o.profileChanged()})}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"update",value:function(e){var t={profile:{create:function(e){return n.ko.observable(new c.default(e.data))}}};n.ko.mapping.fromJS(e,t,this)}},{key:"profileChanged",value:function(){(0,a.updateProfileEpoch)(!0)}},{key:"navigateToUser",value:function(){(0,s.navigate)(this.profilePage())}}]),e}();function h(e){return n.NF.paths.profile({userId:e})}function m(e){var t="/users/header_images/"+e;return(0,a.profileEpoch)()&&(t+="?"+(0,a.profileEpoch)()),t}function g(e){return"url('".concat(m(e),"')")}function b(e){var t="/users/avatars/"+e;return(0,a.profileEpoch)()&&(t+="?"+(0,a.profileEpoch)()),t}function v(e){return"url('".concat(b(e),"')")}t.default=f,n.Noteflight.User=f},,function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rrReset=l,t.rrEnvironment=c,t.rrProductPage=function(e,t){if(!r.NF.session.rr())return;if(!s())return;RR.jsonCallback=function(){if(RR.data.JSON.placements.length>0){var e=RR.data.JSON.placements[0].strategy_message,t=RR.data.JSON.placements[0].items;(0,n.getApplicationStore)().dispatch({type:i.GET_RECOMMENDED.REQUESTED,title:e,recommendations:t})}},R3_COMMON.addPlacementType("item_page.rr1");var o=new r3_item;o.setId(e),o.setName(t),rr_flush_onload(),r3()},t.rrHomePage=function(){if(!r.NF.session.rr())return;if(!s())return;RR.jsonCallback=function(){if(RR.data.JSON.placements.length>0){var e=RR.data.JSON.placements[0].strategy_message,t=RR.data.JSON.placements[0].items;(0,n.getApplicationStore)().dispatch({type:i.GET_RECOMMENDED.REQUESTED,title:e,recommendations:t})}},R3_COMMON.addPlacementType("home_page.bestsellers");new r3_home;rr_flush_onload(),r3()},t.rrAddToCartPage=function(e){if(!r.NF.session.rr())return;if(!s())return;if(r.NF.hasStorage&&localStorage.getItem("rr_add_to_cart_params")){var t=localStorage.getItem("rr_add_to_cart_params"),o=JSON.parse('{"'+decodeURI(t.replace(/&/g,'","').replace(/=/g,'":"'))+'"}');o.query&&o.lang&&o.page&&o.searchConfigId&&R3_COMMON.addContext({st:o.query,lang:o.lang,page:o.page,searchConfigId:o.searchConfigId}),localStorage.removeItem("rr_add_to_cart_params")}R3_COMMON.addPlacementType("add_to_cart_page"),(new r3_addtocart).addItemIdToCart(e),rr_flush_onload(),r3()},t.rrCartPage=function(e){if(!r.NF.session.rr())return;if(!s())return;R3_COMMON.addPlacementType("cart_page"),(new r3_cart).addItemId(e),rr_flush_onload(),r3()},t.rrPurchaseCompletePage=function(e,t,o,n){if(!r.NF.session.rr())return;if(!s())return;R3_COMMON.addPlacementType("purchase_complete_page");var i=new r3_purchased;i.setOrderNumber(e),i.addItemIdPriceQuantity(t,o,n),rr_flush_onload(),r3()},t.buildFindUrl=function(e){var t=u(e),o="https://".concat(d(),".richrelevance.com/rrserver/api/find/v1/").concat(r.NF.config.rrApiKey),n=encodeURIComponent,i=Object.keys(t).map(function(e){if("filter"==e){var o=t[e].map(function(e){var t=Object.keys(e)[0],o=e[t];return t=f(t),"filter=".concat(t,':"').concat(n(o),'"')}).join("&");return o}return"sort"==e?"".concat(n(e),"=").concat(t[e]):"".concat(n(e),"=").concat(n(t[e]))}).join("&");return i?"".concat(o,"?").concat(i):o},t.convertToFindParams=u,t.rrFindEnvironment=d,t.convertFacetsToAggregations=function(e){var t={};e.forEach(function(e){var o=[];e.values.forEach(function(e){o.push({key:e.value,doc_count:e.count})});var r=g[e.facet]||e.facet;t[r]=o}),t.duration&&t.duration.forEach(function(e){e.key=m(e.key)});return t},t.convertSort=p,t.convertFilter=f,t.convertDurationToRR=h,t.convertDurationFromRR=m;var r=o(6),n=o(16),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(52)),a=o(31);function s(){l();try{return window.R3_COMMON=new r3_common,window.R3_COMMON.setApiKey(r.NF.config.rrApiKey),window.R3_COMMON.setBaseUrl(window.location.protocol+"//"+c()+".richrelevance.com/rrserver/"),window.R3_COMMON.setClickthruServer(window.location.protocol+"//"+window.location.host),window.R3_COMMON.setSessionId(r.NF.config.rrSessionId),r.NF&&r.NF.session&&r.NF.session.current_user()&&window.R3_COMMON.setUserId(r.NF.session.current_user().external_id()),!0}catch(e){return!1}}function l(){void 0!==window.R3_COMMON&&(window.R3_COMMON=void 0),void 0!==window.R3_ITEM&&(window.R3_ITEM=void 0),void 0!==window.R3_PURCHASED&&(window.R3_PURCHASED=void 0),void 0!==window.R3_HOME&&(window.R3_HOME=void 0),void 0!==window.R3_SEARCH&&(window.R3_SEARCH=void 0),void 0!==window.R3_CATEGORY&&(window.R3_CATEGORY=void 0),void 0!==window.R3_BRAND&&(window.R3_BRAND=void 0),void 0!==window.R3_ADDTOCART&&(window.R3_ADDTOCART=void 0),void 0!==window.R3_CART&&(window.R3_CART=void 0),void 0!==window.R3_ERROR&&(window.R3_ERROR=void 0),void 0!==window.R3_GENERIC&&(window.R3_GENERIC=void 0),void 0!==window.R3_ADDTOREGISTRY&&(window.R3_ADDTOREGISTRY=void 0),void 0!==window.R3_WISHLIST&&(window.R3_WISHLIST=void 0)}function c(){var e=r.NF.config.rrEnvironment;return(0,a.getCookie)("rr_environment")&&(console.log("The 'rr_environment' cookie is set to: "+(0,a.getCookie)("rr_environment")),e=(0,a.getCookie)("rr_environment")),e}function u(e){var t={query:e.term||"*",lang:"en",start:e.start_index,rows:e.max_count,placement:"search_page.find",sessionId:r.NF.config.rrSessionId,rcs:(0,a.getCookie)("rr_rcs"),log:r.NF.config.rrFindLog,ssl:!0};return r.NF.session.current_user()&&(t.userId=r.NF.session.current_user().external_id()),e.filters&&e.filters.length>0&&(t.filter=e.filters),e.ranges&&e.ranges.length>0&&(t.filter||(t.filter=[]),e.ranges.forEach(function(e){e.hasOwnProperty("duration")&&(e.duration=h(e.duration)),t.filter.push(e)})),e.order&&"relevance"!=e.order&&(t.sort=p(e.order)),e.song_id&&(t.filter=[{song_id:e.song_id}]),t}function d(){var e=r.NF.config.rrEnvironment;return(0,a.getCookie)("rr_find_environment")&&(console.log("The 'rr_find_environment' cookie is set to: "+(0,a.getCookie)("rr_find_environment")),e=(0,a.getCookie)("rr_find_environment")),e}function p(e){return{most_recent:"nf_created_at+desc",title:"name+asc"}[e]}function f(e){return Object.keys(g).find(function(t){return g[t]===e})}function h(e){var t=[];return e.split("-").forEach(function(e){"*"==e?e="":"0.01"!=e&&(e=e.split(".")[0]),t.push(e)}),t.toString()}function m(e){var t=[];return e.split(",").forEach(function(e){""==e?e="*":e.includes(".")||(e+=".0"),t.push(e)}),t.toString().replace(",","-")}var g={nf_instrument_names:"instrument_names",nf_opening_key:"key_signatures",nf_duration_range:"duration",nf_genre:"genre",nf_format:"format",nf_difficulty_level:"difficulty_level",nf_ensemble_size_id:"ensemble_size_id",nf_sellable_arrangements:"sellable_arrangements",nf_song_id:"song_id"}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeGroups=D,t.normalizeUsers=F,t.sharingCopyrightInfoSelector=t.hasPublicDomainSongsSelector=t.hasCopyrightedSongsSelector=t.sharingDialogSelector=t.sharingParametersSelector=t.shareWithEveryoneSelector=t.shareAdditionalAccessSelector=t.isSharedSelector=t.shareWithUsersSelector=t.shareWithGroupsSelector=void 0;var r=o(12);o(57);var n=o(8),i=o(16),a=o(34),s=o(92),l=o(48),c=o(17),u=o(41),d=o(72);function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var f=function(e){return e.sharing.loaded},h=function(e){return e.sharing.authorship},m=function(e){return e.sharing.everyoneRole},g=function(e){return e.sharing.sharedGroupIds},b=function(e){return e.sharing.sharedGroupPermissionsById},v=function(e){return e.sharing.sharedUserIds},y=function(e){return e.sharing.sharedUserPermissionsById},_=(0,r.createSelector)(a.groupsSelector,function(e){return e.sharing.groupList},g,b,f,function(e,t,o,r,n){var i=D((0,l.hydrateIdList)(t.ids,e)),a=D((0,l.hydrateIdList)(o,e));return{groups:i,groupsLoaded:t.loaded,groupsLoading:t.loading,sharedGroups:a,sharedGroupPermissionsById:r,loaded:n}});t.shareWithGroupsSelector=_;var S=(0,r.createSelector)(c.editorContentPolicySelector,a.usersSelector,function(e){return e.sharing.userList},v,y,f,function(e,t,o,r,n,i){var a=F((0,l.hydrateIdList)(o.ids,t)),s=F((0,l.hydrateIdList)(r,t));return{canShareWithUsers:e.enable_user_based_sharing,sharedUsers:s,sharedUserPermissionsById:n,users:a,usersLoaded:o.loaded,usersLoading:o.loading,loaded:i}});t.shareWithUsersSelector=S;var w=(0,r.createSelector)(m,g,v,function(e,t,o){return null!==e||t.length>0||o.length>0});t.isSharedSelector=w;var k=(0,r.createSelector)(function(e){return e.sharing.copyable},function(e){return e.sharing.template},w,c.editorContentPolicySelector,u.isDefaultCommunitySelector,function(e,t,o,r,n){return{copyable:e,template:t,isShared:o,canCreateTemplate:r.enable_template_creation,isDefaultCommunity:n}});t.shareAdditionalAccessSelector=k;var E=(0,r.createSelector)(m,function(e){return e.sharing.searchable},f,function(e,t,o){return{everyoneRole:e,searchable:t,loaded:o}});t.shareWithEveryoneSelector=E;var P=(0,r.createSelector)(g,b,function(e,t){return e.map(function(e){return{id:e,role:t[e]}})}),C=(0,r.createSelector)(v,y,function(e,t){return e.map(function(e){return{id:e,role:t[e]}})}),T=(0,r.createSelector)(function(e){return e.sharing.selectedSongIds},a.songsSelector,function(e,t){return(0,l.hydrateIdList)(e,t)}),R=function(e){return e.sharing.blackboxSongs},O=(0,r.createSelector)(T,R,function(e,t){for(var o=e.map(function(e){return{id:e.id}}),r=0;r<t.length;r++){var n=t[r];o.push(n)}return o}),M=(0,r.createSelector)(c.editorContentIdSelector,function(e){return e.sharing},P,C,O,function(e,t,o,r,n){return{scoreId:e,everyoneRole:t.everyoneRole,searchable:t.searchable,template:t.template,copyable:t.copyable,authorship:t.authorship,groups:o,users:r,songs:n}});t.sharingParametersSelector=M;var A=(0,r.createSelector)(c.editorContentModelSelector,s.sharedDocumentRolesSelector,u.isDefaultCommunitySelector,function(e){return e.sharing.isSharedByDefault},w,T,R,h,d.activeWizardSelector,function(e,t,o,r,i,a,s,l,c){var u=i||r,d=l==n.ORIGINAL_AUTHORSHIP||l==n.ARRANGEMENT_AUTHORSHIP&&(a.length>0||s.length>0);return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){p(e,t,o[t])})}return e}({currentStepId:c.currentStepId,contentModel:e,isDefaultCommunity:o,isSharedByDefault:r,isShared:i,authorship:l,sharingOptionsComplete:u,copyrightInfoComplete:d},t)});t.sharingDialogSelector=A;var N=(0,r.createSelector)(T,function(e){for(var t=!1,o=0;o<e.length;o++){if(!e[o].public_domain){t=!0;break}}return t});t.hasCopyrightedSongsSelector=N;var I=(0,r.createSelector)(T,function(e){for(var t=!1,o=0;o<e.length;o++){if(e[o].public_domain){t=!0;break}}return t});t.hasPublicDomainSongsSelector=I;var x=(0,r.createSelector)(a.songsSelector,function(e){return e.sharing.songList},T,R,h,N,I,function(e,t,o,r,n,i,a){return{songs:(0,l.hydrateIdList)(t.ids,e),songsLoaded:t.loaded,selectedSongs:o,blackboxSongs:r,authorship:n,hasCopyrightedSongs:i,hasPublicDomainSongs:a}});function D(e){return e.map(function(e){var t=null==e.group_logo_id?(0,i.asset)("images/defaultGroup.png"):"/api/1.0/group_logos/".concat(e.group_logo_id);return Object.assign({},e,{imageUrl:t})})}function F(e){return e.map(function(e){return Object.assign({},e,{imageUrl:e.avatar_uri,name:e.username})})}t.sharingCopyrightInfoSelector=x},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateIdList=function(e,t){return e.map(function(e){return t[e]})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allFirstContributors=c,t.firstContributor=function(e){if(!e)return null;for(var t=function(e){if(!e)return null;for(var t=0;t<n.length;t++)for(var o=n[t],r=0;r<e.length;r++){var i=e[r];if(i.role==o)return i.role}return null}(e),o=[],r=0;r<e.length;r++)e[r].role==t&&o.push(e[r]);return o.map(function(e){return e.name}).join(", ")},t.firstArranger=function(e){if(!e)return null;for(var t=0;t<a.length;t++)for(var o=a[t],r=0;r<e.length;r++){var n=e[r];if(n.role==o)return n.name}return null},t.firstComposerType=u,t.firstLyricistType=d,t.firstArtistType=p,t.firstArrangerType=function(e){if(!e)return null;for(var t=0;t<a.length;t++)for(var o=a[t],r=0;r<e.length;r++){var n=e[r];if(n.role==o)return n.role}return null},t.extractComposers=function(e){if(!e)return null;for(var t=u(e),o=[],r=0;r<e.length;r++)e[r].role==t&&o.push(e[r]);return o},t.extractLyricists=function(e){if(!e)return null;for(var t=d(e),o=[],r=0;r<e.length;r++)e[r].role==t&&o.push(e[r]);return o},t.extractArtist=function(e){if(!e)return null;for(var t=p(e),o=0;o<e.length;o++)if(e[o].role==t)return e[o]},t.isComposer=f,t.isLyricist=h,t.isArtist=m,t.isArranger=function(e){return e==r.NF_ARRANGER||e==r.HL_A_ARRANGER||e==r.HL_A_EDITOR},t.songTextToShow=function(e){var t=c(e.contributors);if(t&&t.length>0)return t=t.join(", "),"".concat(e.title," / ").concat(t);return e.title};var r=o(8),n=[r.NF_COMPOSER,r.NF_ARTIST,r.HL_S_AT,r.HL_S_CA,r.HL_S_C,r.HL_S_CR,r.HL_A_ARTIST,r.HL_A_COMPOSER,r.HL_A_WRITER,r.HL_A_MUSICIAN],i=[r.NF_COMPOSER,r.HL_S_CA,r.HL_S_C,r.HL_S_CR,r.HL_A_COMPOSER,r.HL_A_WRITER],a=[r.NF_ARRANGER,r.HL_A_ARRANGER,r.HL_A_EDITOR],s=[r.NF_LYRICIST,r.HL_S_A,r.HL_A_AUTHOR],l=[r.NF_ARTIST,r.HL_S_AT,r.HL_A_ARTIST,r.HL_A_MUSICIAN];function c(e){if(!e)return null;for(var t=[],o=0;o<n.length;o++)for(var r=n[o],i=0;i<e.length;i++){var a=e[i];a.role==r&&t.push(a.name)}return t}function u(e){if(!e)return null;for(var t=0;t<i.length;t++)for(var o=i[t],r=0;r<e.length;r++){var n=e[r];if(n.role==o&&f(n.role))return n.role}return null}function d(e){if(!e)return null;for(var t=0;t<s.length;t++)for(var o=s[t],r=0;r<e.length;r++){var n=e[r];if(n.role==o&&h(n.role))return n.role}return null}function p(e){if(!e)return null;for(var t=0;t<l.length;t++)for(var o=l[t],r=0;r<e.length;r++){var n=e[r];if(n.role==o&&m(n.role))return n.role}return null}function f(e){return e==r.NF_COMPOSER||e==r.HL_S_CA||e==r.HL_S_C||e==r.HL_S_CR||e==r.HL_A_COMPOSER||e==r.HL_A_WRITER}function h(e){return e==r.NF_LYRICIST||e==r.HL_S_A||e==r.HL_A_AUTHOR}function m(e){return e==r.NF_ARTIST||e==r.HL_S_AT||e==r.HL_A_ARTIST||e==r.HL_A_MUSICIAN}},function(e,t,o){var r,n,i;n=[o(9),o(227),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){var t=!1;return e(document).on("mouseup",function(){t=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(o){if(!0===e.data(o.target,t.widgetName+".preventClickEvent"))return e.removeData(o.target,t.widgetName+".preventClickEvent"),o.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(o){if(!t){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(o),this._mouseDownEvent=o;var r=this,n=1===o.which,i=!("string"!=typeof this.options.cancel||!o.target.nodeName)&&e(o.target).closest(this.options.cancel).length;return!(n&&!i&&this._mouseCapture(o)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(o)&&this._mouseDelayMet(o)&&(this._mouseStarted=!1!==this._mouseStart(o),!this._mouseStarted)?(o.preventDefault(),0):(!0===e.data(o.target,this.widgetName+".preventClickEvent")&&e.removeData(o.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),o.preventDefault(),t=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(o){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,o.target===this._mouseDownEvent.target&&e.data(o.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(o)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,t=!1,o.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){e.exports=o(7)(686)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STOP_PRODUCT_PREVIEW=t.PLAY_PRODUCT_PREVIEW=t.SET_SEARCH_FILTERS=t.SET_SEARCH_TERM=t.SET_SEARCH_QUERY=t.SET_CURRENT_TAB=t.SEARCH_WITH_FIND=t.RR_PRODUCT_CLICKED=t.GET_PRODUCT_PREVIEW=t.RESET_SEARCH=t.SEARCH=t.GET_RECOMMENDED=t.GET_CAROUSEL=t.GET_TABS=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("MARKETPLACE","GET_TABS");t.GET_TABS=n;var i=new r.default("MARKETPLACE","GET_CAROUSEL");t.GET_CAROUSEL=i;var a=new r.default("MARKETPLACE","GET_RECOMMENDED");t.GET_RECOMMENDED=a;var s=new r.default("MARKETPLACE","SEARCH");t.SEARCH=s;var l=new r.default("MARKETPLACE","RESET_SEARCH");t.RESET_SEARCH=l;var c=new r.default("MARKETPLACE","GET_PRODUCT_PREVIEW");t.GET_PRODUCT_PREVIEW=c;var u=new r.default("MARKETPLACE","RR_PRODUCT_CLICKED");t.RR_PRODUCT_CLICKED=u;var d=new r.default("MARKETPLACE","SEARCH_WITH_FIND");t.SEARCH_WITH_FIND=d;t.SET_CURRENT_TAB="MARKETPLACE__SET_CURRENT_TAB";t.SET_SEARCH_QUERY="MARKETPLACE__SET_SEARCH_QUERY";t.SET_SEARCH_TERM="MARKETPLACE__SET_SEARCH_TERM";t.SET_SEARCH_FILTERS="MARKETPLACE__SET_SEARCH_FILTERS";t.PLAY_PRODUCT_PREVIEW="MARKETPLACE__PLAY_PRODUCT_PREVIEW";t.STOP_PRODUCT_PREVIEW="MARKETPLACE__STOP_PRODUCT_PREVIEW"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProfileEpoch=function(e){n(e)},t.profileEpoch=void 0;var r="",n=ko.observable(!1),i=ko.computed(function(){if(!n()){if(!r&&NF.hasSessionStorage){var e=sessionStorage.getItem("_nf_profile_epoch");e&&(r=e)}return r}return r=(new Date).getTime().toString(),NF.hasSessionStorage&&sessionStorage.setItem("_nf_profile_epoch",r),n(!1),r});t.profileEpoch=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(19);function a(){var e=this;e.doesSearch=ko.observable(!1),e.showSearchBarForMobile=ko.observable(!1),e.doesFilter=ko.observable(!1),e.showFilter=ko.observable(!1),e.showFilter.subscribe(function(e){r.default.publish(n.FILTER_TOGGLE,{open:e})}),e.targetHelpInSeparateWindow=ko.observable(!1),e.searchTarget=ko.observable(),e.searchTargetToShow=ko.computed(function(){return decodeURIComponent(e.searchTarget())}),e.activeHeaderTag=ko.observable(),e.newScore=function(){Noteflight.appViewModel.headerViewModel.newScore()},e.goUpgrade=function(){NF.analytics.trackEvent("conversion","upgrade","header"),NF.location.setUri(NF.paths.plans())},e.manageSite=function(){var e=NF.getCommunityGroup().id();NF.location.setUri(NF.paths.viewGroup({groupId:e}))},e.hideBrowse=function(){return!Noteflight.session.community().enable_browse_and_search()||e.anonymousNonPublicCommunity()},e.showUpgrade=function(){return NF.session.canUpgrade()},e.showLibraries=function(){return!NF.session.community().default_community()},e.showMarketplace=function(){return e.defaultCommunity()&&NF.session.showSellerFeatures()},e.showYourGroups=function(){return e.loggedIn()},e.loggedIn=function(){return NF.roles.isLoggedIn()},e.nonLoggedIn=function(){return!NF.roles.isLoggedIn()},e.isPhoneLayoutOrSmaller=function(){return(0,i.isPhoneLayoutOrSmaller)()},e.isMobileLayoutOrLarger=function(){return(0,i.isMobileLayoutOrLarger)()},e.isAtLeastSiteTeacher=function(){return NF.roles.isAtLeastSiteTeacher()},e.defaultCommunity=function(){return NF.session.community().default_community()},e.anonymousNonDefaultCommunity=function(){return!e.loggedIn()&&!e.defaultCommunity()},e.anonymousNonPublicCommunity=function(){return!e.loggedIn()&&!e.defaultCommunity()&&!NF.session.community().allow_anonymous_view()},e.showPublicCommunityGroups=function(){return e.defaultCommunity()||NF.session.community().allow_anonymous_view()},e.allowLogin=function(){return NF.session.allowLogin()},e.allowSignup=function(){return NF.session.allowSignup()},e.signin=function(){NF.appViewModel.showLoginForm()},e.showSearchButton=ko.computed(function(){return!!e.doesSearch&&e.doesSearch()}),e.showFilterButton=ko.computed(function(){return!!e.doesFilter&&e.doesFilter()}),e.showSearchButtonSeparator=ko.computed(function(){return e.showSearchButton()&&!e.loggedIn()}),e.headerPaletteLeft=ko.observable(new Noteflight.GenericHeaderPaletteLeft(e)),e.headerPaletteRight=ko.observable(new Noteflight.GenericHeaderPaletteRight(e)),e.searchPalette=ko.observable(new Noteflight.GenericSearchPalette(e)),r.default.subscribe(n.SEARCH_SCORE,function(){e.showFilter(!(0,i.isPhoneLayoutOrSmaller)())}),r.default.publish(n.APPCUES_IDENTIFY,{})}Noteflight.GenericPageViewModel=a},function(e,t,o){e.exports=o(7)(654)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EDITOR_READY=t.LOAD_CONTENT=void 0;var r=new(function(e){return e&&e.__esModule?e:{default:e}}(o(22)).default)("EDITOR","LOAD_CONTENT");t.LOAD_CONTENT=r;t.EDITOR_READY="EDITOR_READY"},function(e,t,o){e.exports=o.p+"images/defaultGroup-55d5c244e8930a7b8e70507008e371b3.png"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(187));function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errors=ko.observableArray([]),this.fullScreenError=ko.observable(new r.default),this.small=ko.observable(!1),this.marginTop=ko.observable(t.marginTop||"15px")}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"addError",value:function(e){if(e.code&&e.message){for(var t=0;t<this.errors().length;t++)if(this.errors()[t].code===e.code)return void(this.errors()[t].message=e.message);e.fullScreen?(this.fullScreenError().populate(e),this.fullScreenError().show(!0)):this.errors.push(e)}else console.log("The error object needs to have a code and a message property.")}},{key:"addErrors",value:function(e){for(var t=0;t<e.length;t++)this.addError(e[t])}},{key:"hasErrors",value:function(){return this.errors().length>0}},{key:"clearErrors",value:function(){this.errors([]),this.fullScreenError().show(!1)}},{key:"hide",value:function(){this.clearErrors()}}]),e}();t.default=i},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}Object.defineProperty(t,"__esModule",{value:!0}),t.AppCuesPackager=t.AppCuesEventTracker=void 0;var a=function(){function e(){r(this,e)}return i(e,null,[{key:"appCuesPresent",value:function(){return void 0!==window.Appcues}},{key:"trackEvent",value:function(e,t){this.appCuesPresent()&&Appcues.track(e,t)}},{key:"trackScoreCreated",value:function(e){this.trackEvent("Score Created",{scoreExternalId:e})}},{key:"trackProductPurchaseBegun",value:function(e){this.trackEvent("Purchase Begun",{productExternalId:e})}},{key:"trackProductPurchaseComplete",value:function(e){this.trackEvent("Purchase Complete",{productExternalId:e})}}]),e}();t.AppCuesEventTracker=a;var s=function(){function e(t,o,n,i){r(this,e),this._user=t,this._defaultCommunity=o,this._path=n,this._appCuesClass=i,this._hasReported=!1}return i(e,[{key:"packageUserInfo",value:function(e){var t={external_id:this._user.external_id(),created:this._user.created()};return t=Object.assign(t,this._packageProfile(t)),this._user.premium_member&&(t.premium_member=this._user.has_premium_features()),this._user.has_active_subscription&&(t.has_active_subscription=this._user.has_active_subscription()),this._user.has_expired_premium_trial&&(t.has_expired_premium_trial=this._user.has_expired_premium_trial()),this._user.has_active_trial_subscription&&(t.has_active_trial_subscription=this._user.has_active_trial_subscription()),this._user.has_seller_account&&(t.has_seller_account=this._user.has_seller_account()),this._user.last_login_time&&(t.last_login_time=this._user.last_login_time()),this._user.sold_products_count&&(t.sold_products_count=this._user.sold_products_count()),this._user.purchased_products_count&&(t.purchased_products_count=this._user.purchased_products_count()),this._user.authored_scores_count&&(t.authored_scores_count=this._user.authored_scores_count()),this._user.community_member&&this._user.community_member.sso_user_role&&(t.sso_user_role=this._user.community_member.sso_user_role()),t.is_score_author=e,t}},{key:"trackUser",value:function(e){this._hasReported||(this._user&&this._user.external_id()?this._appCuesClass.identify(this._user.external_id(),this.packageUserInfo(e)):this._defaultCommunity&&"/"!==this._path&&this._appCuesClass.anonymous(),this.reported())}},{key:"reported",value:function(){this._hasReported=!0}},{key:"_packageProfile",value:function(){return{receive_news:this._user.profile().receive_news(),composer:!!this._user.profile().composer(),performer:!!this._user.profile().performer(),educational_role:this._user.profile().educational_role(),primary_instrument:this._user.profile().primary_instrument(),composer_skill_level:this._user.profile().composer_skill_level(),performer_skill_level:this._user.profile().performer_skill_level()}}}]),e}();t.AppCuesPackager=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.microphoneStreamGetter=function(){return r},t.getMicStream=function e(t,o){var u=l();if(r&&o==u)return void t(r);o?function(e){(0,a.hasStorage)()?localStorage.setItem(s,e):Noteflight.deviceId=e}(o):o=u;var d={audio:{mozAutoGainControl:!1,mozNoiseSuppression:!1,optional:[{sourceId:o},{echoCancellation:!1},{mozAutoGainControl:!1},{mozNoiseSuppression:!1},{googAutoGainControl:!1},{googAutoGainControl2:!1},{googEchoCancellation:!1},{googEchoCancellation2:!1},{googNoiseSuppression:!1},{googNoiseSuppression2:!1},{googHighpassFilter:!1},{googTypingNoiseDetection:!1},{googAudioMirroring:!1}]}};var p=function(e){r&&c(),r=e,t(e)};var f=function(r){if(!o||"default"==o)return(0,i.standardAlertDialog)((0,n.resource)("errors.noLiveAudio"));e(t,"default")};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(d).then(p,f):navigator.getUserMedia?navigator.getUserMedia(d,p,f):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia(d,p,f)},t.retrieveDeviceId=l,t.getCurrentInputDevice=function(e){u({success:function(t){for(var o=l(),r=0;r<t.length;r++){var n=t[r];n.deviceId==o&&e(n)}},failure:function(){e({label:"Default",deviceId:"default"})}})},t.releaseMicStream=c,t.getInputDevices=u;var r,n=o(0),i=o(3),a=o(27),s="_nf_device_id";function l(){var e;return(e=(0,a.hasStorage)()?localStorage.getItem(s):Noteflight.deviceId)||(e="default"),e}function c(){r&&(r.getAudioTracks().forEach(function(e){e.stop()}),r=null)}function u(e){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||e.failure(),navigator.mediaDevices.enumerateDevices().then(d).then(e.success)}function d(e){var t=[];return e.forEach(function(e){"audioinput"==e.kind&&t.push(e)}),t}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(473)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,null,[{key:"checkAuthorization",value:function(e){return new Promise(function(t,o){NF.apiService.checkGoogleClassroomAuthorization((0,n.resource)("content.gettingGoogleClassroomAuthorization"),function(n){if(n.authorized)return t();new r.default(e,o).show()})})}},{key:"getAuthLink",value:function(e){var t=0;function o(e,o){var r=0===t?"?":"&";return t++,r+="".concat(e,"=").concat(encodeURIComponent(o))}var r="".concat(window.location.protocol,"//").concat(Noteflight.defaultHostname,"/auth/google/");return e.referringHostname&&(r+=o("referring_hostname",function(){var e=window.location.hostname;return window.location.port.length>0&&(e=e+":"+window.location.port),e}())),e.googleClassroom&&(r+=o("googleClassroom",e.googleClassroom)),e.returnTo&&(r+=o("return_to",e.returnTo)),r}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(2);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}o(57);var s="/api/1.0/group_logos/",l=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.new_activity=ko.observable(!1),this.is_community_group=ko.observable(!1),this.deleted_at=ko.observable(0),this.overview_members=ko.observable(""),this.active=ko.observable(!1),this.archived=ko.observable(!1),this.google_course_id=ko.observable(),ko.mapping.fromJS(t,{},this);var a=["application","invitation","blacklisting"];for(var l in a){var c=a[l];null!==this[c]&&(this[c]=ko.observable(this[c]))}this.userIsMember=ko.computed(function(){if(o.role)return"none"!=o.role()}),this.isCommunity=ko.computed(function(){if(o.group_type)return"community"==o.group_type()}),this.isNFCommunity=ko.computed(function(){return o.isCommunity()&&NF.session.community().default_community()}),this.isSiteCommunity=ko.computed(function(){return o.isCommunity()&&!NF.session.community().default_community()}),this.isGoogleClassroomCommunity=ko.computed(function(){return o.isCommunity()&&NF.session.community().is_google_classroom()}),this.isGoogleClassroom=ko.computed(function(){return null!=o.google_course_id()||o.isGoogleClassroomCommunity()}),this.totalMembers=ko.computed(function(){if(o.member_count)return o.member_count()}),this.groupPath=ko.computed(function(){if(o.id)return(0,i.path)("viewGroup",{groupId:o.id()})}),this.showAllMembers=ko.computed(function(){if(o.admission_policy)return"assignment"!=o.admission_policy()&&!o.isCommunity()}),this.showAssignMembers=ko.computed(function(){if(o.admission_policy)return"assignment"==o.admission_policy()||o.isSiteCommunity()}),this.canViewMembers=ko.computed(function(){if(NF.session.current_user()&&o.permissions&&o.permissions.can_view_members_list)return o.permissions.can_view_members_list()}),this.showDetails=ko.computed(function(){return o.userIsMember()||NF.roles.isSiteAdmin()||o.access_policy&&"public"==o.access_policy()}),this.showModeratorUI=ko.computed(function(){return o.role&&("admin"==o.role()||"moderator"==o.role())||NF.roles.isSiteAdmin()}),this.siteDescriptionResource=ko.computed(function(){return o.showModeratorUI()?o.isGoogleClassroomCommunity()?"content.aboutGoogleSiteTeacherBody":"content.aboutSiteTeacherBody":o.isGoogleClassroomCommunity()?"content.aboutGoogleSiteStudentBody":"content.aboutSiteStudentBody"}),this.groupDescriptionResource=ko.computed(function(){return o.showModeratorUI()?o.isGoogleClassroomCommunity()?"content.aboutGoogleGroupsTeacherBody":"content.aboutGroupsTeacherBody":o.isGoogleClassroomCommunity()?"content.aboutGoogleGroupsStudentBody":"content.aboutGroupsStudentBody"}),this.showAdminUI=ko.computed(function(){return o.role&&"admin"==o.role()||NF.roles.isSiteAdmin()}),this.deleted=ko.computed(function(){return!o.active()}),this.imageFullURL=ko.computed(function(){return o.group_logo_id&&o.group_logo_id()?s+o.group_logo_id():NF.asset("images/defaultGroup.png")}),this.imageURL=ko.computed(function(){return"url("+o.imageFullURL()+")"}),this.formattedMemberCount=ko.computed(function(){if(o.member_count)return o.member_count()<1e3?o.member_count():Number(o.member_count()).toLocaleString(NF.languageCode())}),this.path=ko.computed(function(){var e=o.id?o.id():o.group_id?o.group_id():null;return e?(0,i.path)("viewGroup",{groupId:e}):null}),r.default.subscribe(n.STOCK_IMAGE_GROUP_LOGO_SELECTED,function(e,t){o.group_logo_id(t.group_logo_id)})}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"updateGroup",value:function(e){ko.mapping.fromJS(e,{},this)}}]),e}();t.default=l},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(o){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMOVE_AUTHORIZED_APP=t.RETRIEVE_AUTHORIZED_APPS=t.SITE_OWNER_EMAIL=t.PAYMENT_INFO=t.CHECK_SELLER_PAYOUT_DESTINATION_STATUS=t.RETRIEVE_SELLER_PAYOUT_DESTINATION=t.RETRIEVE_SELLER_ACCOUNT=t.UPDATE_PROFILE=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("USER","UPDATE_PROFILE");t.UPDATE_PROFILE=n;var i=new r.default("USER","RETRIEVE_SELLER_ACCOUNT");t.RETRIEVE_SELLER_ACCOUNT=i;var a=new r.default("USER","RETRIEVE_SELLER_PAYOUT_DESTINATION");t.RETRIEVE_SELLER_PAYOUT_DESTINATION=a;var s=new r.default("USER","CHECK_SELLER_PAYOUT_DESTINATION_STATUS");t.CHECK_SELLER_PAYOUT_DESTINATION_STATUS=s;var l=new r.default("USER","PAYMENT_INFO");t.PAYMENT_INFO=l;var c=new r.default("USER","SITE_OWNER_EMAIL");t.SITE_OWNER_EMAIL=c;var u=new r.default("USER","RETRIEVE_AUTHORIZED_APPS");t.RETRIEVE_AUTHORIZED_APPS=u;var d=new r.default("USER","REMOVE_AUTHORIZED_APP");t.REMOVE_AUTHORIZED_APP=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMOVE_FROM_COLLECTION=t.ADD_TO_COLLECTION=t.GET_COLLECTIONS=t.GET_COLLECTION=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("COLLECTION","GET_COLLECTION");t.GET_COLLECTION=n;var i=new r.default("COLLECTION","GET_COLLECTIONS");t.GET_COLLECTIONS=i;var a=new r.default("COLLECTION","ADD_TO_COLLECTION");t.ADD_TO_COLLECTION=a;var s=new r.default("COLLECTION","REMOVE_FROM_COLLECTION");t.REMOVE_FROM_COLLECTION=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIST_GROUPS=t.LIST_USER_GROUPS=t.LIST_SCORES=t.LIST_FAVORITES=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("COMMUNITY_PAGE","LIST_FAVORITES");t.LIST_FAVORITES=n;var i=new r.default("COMMUNITY_PAGE","LIST_SCORES");t.LIST_SCORES=i;var a=new r.default("COMMUNITY_PAGE","LIST_USER_GROUPS");t.LIST_USER_GROUPS=a;var s=new r.default("COMMUNITY_PAGE","LIST_GROUPS");t.LIST_GROUPS=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_FOLLOWERS_COUNT=t.UNFOLLOW_USER=t.FOLLOW_USER=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("FOLLOW","FOLLOW_USER");t.FOLLOW_USER=n;var i=new r.default("FOLLOW","UNFOLLOW_USER");t.UNFOLLOW_USER=i;var a=new r.default("FOLLOW","LOAD_FOLLOWERS_COUNT");t.LOAD_FOLLOWERS_COUNT=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_COMMUNITY=t.CLOSE_ALL_CONTEXT_MENUS=t.SET_CONTEXT_MENU_STATE=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));t.SET_CONTEXT_MENU_STATE="GENERIC__SET_CONTEXT_MENU_STATE";t.CLOSE_ALL_CONTEXT_MENUS="GENERIC__CLOSE_ALL_CONTEXT_MENUS";var n=new r.default("GENERIC","CHANGE_COMMUNITY");t.CHANGE_COMMUNITY=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMOVE_BLACKBOX_SONG=t.ADD_BLACKBOX_SONG=t.REMOVE_SONG=t.ADD_SONG=t.SEARCH_SONGS=t.UPDATE_SHARING_PROPERTIES=t.UPDATE_USER_SHARE=t.REMOVE_USER_SHARE=t.ADD_USER_SHARE=t.SEARCH_USERS=t.UPDATE_GROUP_SHARE=t.REMOVE_GROUP_SHARE=t.ADD_GROUP_SHARE=t.SEARCH_GROUPS=t.UPDATE_SCORE_SHARING=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(22));var n=new r.default("SHARING","UPDATE_SCORE_SHARING");t.UPDATE_SCORE_SHARING=n;var i=new r.default("SHARING","SEARCH_GROUPS");t.SEARCH_GROUPS=i;t.ADD_GROUP_SHARE="SHARING__ADD_GROUP_SHARE";t.REMOVE_GROUP_SHARE="SHARING__REMOVE_GROUP_SHARE";t.UPDATE_GROUP_SHARE="SHARING__UPDATE_GROUP_SHARE";var a=new r.default("SHARING","SEARCH_USERS");t.SEARCH_USERS=a;t.ADD_USER_SHARE="SHARING__ADD_USER_SHARE";t.REMOVE_USER_SHARE="SHARING__REMOVE_USER_SHARE";t.UPDATE_USER_SHARE="SHARING__UPDATE_USER_SHARE";t.UPDATE_SHARING_PROPERTIES="UPDATE_SHARING_PROPERTIES";var s=new r.default("SHARING","SEARCH_SONGS");t.SEARCH_SONGS=s;t.ADD_SONG="SHARING__ADD_SONG";t.REMOVE_SONG="SHARING__REMOVE_SONG";t.ADD_BLACKBOX_SONG="SHARING__ADD_BLACKBOX_SONG";t.REMOVE_BLACKBOX_SONG="SHARING__REMOVE_BLACKBOX_SONG"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SONG_SEARCH=void 0;var r=new(function(e){return e&&e.__esModule?e:{default:e}}(o(22)).default)("SONG","SEARCH");t.SONG_SEARCH=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.CREATE_WIZARD:return function(e,t){var o=Object.assign({},a,{id:t.id,currentStepId:t.currentStepId,stepIds:t.steps.map(function(e){return e.id}),stepsById:(0,n.addMapElementsById)({},t.steps)});return Object.assign({},e,{byId:(0,n.addMapElementsById)(e.byId,[o])})}(e,t);case r.REMOVE_WIZARD:return function(e,t){return Object.assign({},e,{byId:(0,n.removeMapElementsById)(e.byId,[t.id])})}(e,t);case r.NEXT_STEP:case r.PREVIOUS_STEP:case r.SET_STEP_STATUS:return(0,n.passActionToChildReducer)(e,"byId",t.id,s,t)}return e},t.wizard=s,t.createWizardStepState=l,t.wizardStep=c,t.defaultWizardState=t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(109)),n=o(88);var i={byId:{}};t.defaultState=i;var a={id:"default",currentStepId:null,stepIds:[],stepsById:{}};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.NEXT_STEP:return function(e){var t=Math.min(e.stepIds.length-1,e.stepIds.indexOf(e.currentStepId)+1);return Object.assign({},e,{currentStepId:e.stepIds[t]})}(e);case r.PREVIOUS_STEP:return function(e){var t=Math.max(0,e.stepIds.indexOf(e.currentStepId)-1);return Object.assign({},e,{currentStepId:e.stepIds[t]})}(e);case r.SET_STEP_STATUS:return(0,n.passActionToChildReducer)(e,"stepsById",t.stepId,c,t)}return e}function l(){return{id:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,label:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",complete:arguments.length>2&&void 0!==arguments[2]&&arguments[2]}}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.SET_STEP_STATUS:return Object.assign({},e,{complete:t.complete})}return e}t.defaultWizardState=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wizardNavigationSelector=t.wizardStepsSelector=t.isLastStepSelector=t.isFirstStepSelector=t.currentStepSelector=t.activeWizardSelector=t.wizardsByIdSelector=t.wizardIdSelector=void 0;var r=o(12),n=o(71),i=o(111);function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){s(e,t,o[t])})}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var l=function(e,t){return t.wizardId};t.wizardIdSelector=l;var c=function(e){return e.wizards.byId};t.wizardsByIdSelector=c;var u=(0,r.createSelector)(l,c,function(e,t){return void 0!==t[e]?t[e]:n.defaultWizardState});t.activeWizardSelector=u;var d=(0,r.createSelector)(u,function(e){var t=e.stepsById[e.currentStepId];return void 0===t?null:t});t.currentStepSelector=d;var p=(0,r.createSelector)(u,function(e){return 0===e.stepIds.indexOf(e.currentStepId)});t.isFirstStepSelector=p;var f=(0,r.createSelector)(u,function(e){return e.stepIds.indexOf(e.currentStepId)===e.stepIds.length-1});t.isLastStepSelector=f;var h=(0,r.createSelector)(u,d,i.isPhoneLayoutOrSmallerSelector,f,function(e,t,o,r){return a({isPhoneLayoutOrSmaller:o,currentStep:t,isLastStep:r},e)});t.wizardStepsSelector=h;var m=(0,r.createSelector)(u,p,f,d,function(e,t,o,r){return a({isFirstStep:t,isLastStep:o,currentStep:r},e)});t.wizardNavigationSelector=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ApiService=c,t.apiService=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(6),a=o(0);var s=[{name:"fetchGroup",route:"/api/1.0/groups/info"},{name:"fetchAllGroups",route:"/api/1.0/groups/"},{name:"fetchSiteGroupMembers",route:"/api/1.0/groups/users"},{name:"fetchGroupMembers",route:"/api/1.0/groups/members"},{name:"fetchGroupBlacklistMembers",route:"/api/1.0/groups/blacklist"},{name:"addMemberToBlacklist",route:"/api/1.0/groups/blacklist/add"},{name:"removeMemberFromBlacklist",route:"/api/1.0/groups/blacklist/remove"},{name:"createGroupInfo",route:"/api/1.0/groups/create_info"},{name:"createGroup",route:"/api/1.0/groups/create"},{name:"updateGroup",route:"/api/1.0/groups/update"},{name:"joinGroup",route:"/api/1.0/groups/join"},{name:"leaveGroup",route:"/api/1.0/groups/leave"},{name:"updateMembership",route:"/api/1.0/groups/update_membership"},{name:"applyToGroup",route:"/api/1.0/groups/applications/create"},{name:"deleteGroup",route:"/api/1.0/groups/delete"},{name:"undeleteGroup",route:"/api/1.0/groups/undelete"},{name:"fetchGroupRequests",route:"/api/1.0/groups/applications"},{name:"flagGroup",route:"/api/1.0/groups/flag"},{name:"removeScoreFromGroup",route:"/api/1.0/groups/scores/remove"},{name:"fetchGroupInvitations",route:"/api/1.0/groups/invitations"},{name:"sendInvitations",route:"/api/1.0/groups/invitations/create"},{name:"cancelInvitation",route:"/api/1.0/groups/invitations/update"},{name:"fetchSiteMembers",route:"/api/1.0/groups/site_available_users"},{name:"addMembersToSiteGroup",route:"/api/1.0/groups/bulk_create"},{name:"removeSiteGroupMembers",route:"/api/1.0/groups/bulk_destroy"},{name:"getUserInfo",route:"/api/1.0/users/users_info_by_ids",service:"getService"},{name:"mediaPrepareUpload",route:"/api/1.0/media/prepare_upload"},{name:"updateWhatsNewLastSeen",route:"/api/1.0/user/update_whats_new_last_seen"},{name:"fetchLibraries",route:"/api/1.0/libraries"},{name:"contentLibrariesForPurchase",route:"/api/1.0/content_libraries_for_purchase"},{name:"fetchLibrary",route:"/api/1.0/libraries/info"},{name:"commerceFormPurchase",route:"/api/1.0/recurly_subscription/purchase_or_modify_recurly_subscription"},{name:"previewSubscriptionModification",route:"/api/1.0/recurly_subscription/preview_subscription_modification"},{name:"purchasePremiumTrial",route:"/api/1.0/recurly_subscription/purchase_premium_trial"},{name:"requestQuote",route:"/client/1.0/submit_quote_request"},{name:"paymentContextService",route:"/api/1.0/payment_info"},{name:"couponInfo",route:"/api/1.0/recurly_coupon_code"},{name:"sitesExistingUsers",route:"/api/1.0/sites/existing_users"},{name:"updateBillingInfo",route:"/api/1.0/recurly_subscription/recurly_update_billing_info"},{name:"updateBillingInfoWithToken",route:"/api/1.0/recurly_subscription/recurly_update_billing_info_with_token"},{name:"recaptchaVerification",route:"/api/1.0/recaptcha_verification"},{name:"signupEmail",route:"/client/1.0/signup_email"},{name:"checkSignupKey",route:"/client/1.0/check_signup_key"},{name:"registerUser",route:"/client/1.0/register_user"},{name:"editProfileFromActivationPage",route:"/client/1.0/edit_profile"},{name:"loginUser",route:"/client/1.0/login"},{name:"resetPassword",route:"/client/1.0/reset_password"},{name:"editProfile",route:"/api/1.0/members/edit_profile"},{name:"deleteHeaderImage",route:"/api/1.0/members/delete_header_image"},{name:"adminProfile",route:"/api/1.0/sites/edit_user"},{name:"verifyProfile",route:"/api/1.0/members/verify_profile"},{name:"fetchGoogleClasses",route:"/api/1.0/groups/google"},{name:"fetchGoogleClassesForInstructor",route:"/api/1.0/groups/google_groups_for_instructor"},{name:"createGoogleClassroomCourseWork",route:"/api/1.0/google_classroom/create_course_work"},{name:"updateGoogleClassroomCourseWork",route:"/api/1.0/google_classroom/update_course_work"},{name:"getGoogleClassroomCourseWork",route:"/api/1.0/google_classroom/get_course_work"},{name:"deleteGoogleClassroomCourseWork",route:"/api/1.0/google_classroom/delete_course_work"},{name:"getGoogleClassroomCourseWorkForScore",route:"/api/1.0/google_classroom/get_course_work_for_score"},{name:"findStudentSubmissionForCourseWork",route:"/api/1.0/google_classroom/find_student_submission"},{name:"getStudentSubmission",route:"/api/1.0/google_classroom/get_submission"},{name:"turnInGoogleClassroomSubmission",route:"/api/1.0/google_classroom/turn_in_submission"},{name:"reclaimGoogleClassroomSubmission",route:"/api/1.0/google_classroom/reclaim_submission"},{name:"addGoogleSubmissionAttachment",route:"/api/1.0/google_classroom/add_attachment_to_submission"},{name:"fetchGoogleClassroomCourseList",route:"/api/1.0/google_classroom/list_courses"},{name:"fetchGoogleClassroomCourseUserCount",route:"/api/1.0/google_classroom/course_user_count"},{name:"googleClassroomSyncGroupPreview",route:"/api/1.0/google_classroom/preview_group_sync"},{name:"googleClassroomSyncCommunityPreview",route:"/api/1.0/google_classroom/preview_community_sync"},{name:"googleClassroomCommitCommunitySync",route:"/api/1.0/google_classroom/commit_community_sync"},{name:"googleClassroomCommitGroupSync",route:"/api/1.0/google_classroom/commit_group_sync"},{name:"googleClassroomManageCourses",route:"/api/1.0/google_classroom/commit_manage_courses"},{name:"googleClassroomInviteTeachers",route:"/api/1.0/google_classroom/invite_teachers"},{name:"resendTeacherInvite",route:"/api/1.0/google_classroom/resend_teacher_invite"},{name:"checkGoogleClassroomAuthorization",route:"/api/1.0/google_oauth2/check_classroom_authorization"},{name:"changeEmailComplete",route:"/api/1.0/members/complete_change_email"},{name:"createSite",route:"/api/1.0/sites/create"},{name:"updateSite",route:"/api/1.0/sites/update"},{name:"linkUserToNFAccount",route:"/client/1.0/link_user_to_nf_account"},{name:"uploadMidi",route:"/api/1.0/media/midi_upload"},{name:"unlinkAccounts",route:"/client/1.0/unlink_accounts"},{name:"searchSuggestions",route:"/api/1.0/search/suggestions"},{name:"fetchMembers",route:"/api/1.0/search/community_member"},{name:"getUser",route:"/api/1.0/members/data"},{name:"searchScores",route:"/api/1.0/search/scores"},{name:"pollJobs",route:"/api/1.0/poll_jobs"},{name:"pollJob",route:"/api/1.0/poll_job"},{name:"getHomepageScore",route:"/content_item/homepage_score",service:"getService"},{name:"changePasswordService",route:"/api/1.0/members/change_password"},{name:"deleteAccountService",route:"/api/1.0/members/delete_account"},{name:"updateProfileService",route:"/api/1.0/members/edit_profile"},{name:"getUserService",route:"/api/1.0/members/data"},{name:"accountInfoService",route:"/api/1.0/members/account_info"},{name:"updateGroupRequest",route:"/api/1.0/groups/applications/update"},{name:"checkTwoFactor",route:"/client/1.0/two_factor_check"},{name:"favoritesByTimeframe",route:"/api/1.0/social/favorites_by_timeframe"},{name:"commentsByTimeframe",route:"/api/1.0/social/comments_by_timeframe"},{name:"viewsByTimeframe",route:"/api/1.0/social/views_by_timeframe"},{name:"commentsByScore",route:"/api/1.0/social/comments_by_score"},{name:"favoritesByScore",route:"/api/1.0/social/favorites_by_score"},{name:"viewsByScore",route:"/api/1.0/social/views_by_score"},{name:"addFavoriteToScore",route:"/api/1.0/favorites/add_score"},{name:"removeFavoriteFromScore",route:"/api/1.0/favorites/remove_scores"},{name:"disconnectExternalProvider",route:"/api/1.0/disconnect_from_provider"},{name:"createSellerAccount",route:"/api/1.0/seller/create_account"},{name:"retrieveSellerAccount",route:"/api/1.0/seller/retrieve_account"},{name:"updateSellerAccount",route:"/api/1.0/seller/update_account"},{name:"deleteSellerAccount",route:"/api/1.0/seller/delete_account"},{name:"createSellerPayoutDestination",route:"/api/1.0/seller/create_payout_destination"},{name:"retrieveSellerPayoutDestination",route:"/api/1.0/seller/retrieve_payout_destination"},{name:"updateSellerPayoutDestination",route:"/api/1.0/seller/update_payout_destination"},{name:"updateSellerPersonalIdNumber",route:"/api/1.0/seller/update_seller_personal_id_number"},{name:"updateSellerVerificationDocument",route:"/api/1.0/seller/update_seller_verification_document"},{name:"checkSellerPayoutDestinationStatus",route:"/api/1.0/seller/check_payout_destination_status"},{name:"retrieveSellerPayouts",route:"/api/1.0/seller/retrieve_payouts"},{name:"uploadHeaderImageFromUrl",route:"/client/1.0/upload_header_image_from_url"},{name:"uploadAvatar",route:"/client/1.0/upload_avatar"},{name:"uploadAvatarData",route:"/client/1.0/upload_avatar_data"},{name:"uploadHeaderImage",route:"/client/1.0/upload_header_image"},{name:"uploadHeaderImageData",route:"/client/1.0/upload_header_image_data"},{name:"coverArt",route:"/client/1.0/cover_art"},{name:"uploadCoverArt",route:"/client/1.0/upload_cover_art"},{name:"uploadCoverArtData",route:"/client/1.0/upload_cover_art_image_data"},{name:"collectionImage",route:"/client/1.0/collection_image"},{name:"uploadCollectionImage",route:"/client/1.0/upload_collection_image"},{name:"uploadCollectionImageData",route:"/client/1.0/upload_collection_image_data"},{name:"uploadGroupLogo",route:"/api/1.0/groups/upload_logo"},{name:"uploadGroupLogoData",route:"/api/1.0/groups/upload_group_logo_image_data"},{name:"getFolloweesFollowers",route:"/api/1.0/activity_stream/followees_followers"},{name:"iotReconnect",route:"/api/1.0/iot_reconnect"},{name:"createCustomerCard",route:"/api/1.0/customer/create_customer_card"},{name:"updateCustomerCard",route:"/api/1.0/customer/update_customer_card"},{name:"deleteCustomerCard",route:"/api/1.0/customer/delete_customer_card"},{name:"retrieveCustomerCards",route:"/api/1.0/customer/retrieve_customer_cards"},{name:"publishScore",route:"/api/1.0/marketplace/products"},{name:"searchProducts",route:"/api/1.0/marketplace/products/search"},{name:"createProductCopy",route:"/api/1.0/marketplace/products/copy"},{name:"purchaseProduct",route:"/api/1.0/product_purchase/purchase_product"},{name:"scoreProductPricing",route:"/api/1.0/marketplace/score_product_pricing",service:"postService"},{name:"newCollection",route:"/api/1.0/collections/create"},{name:"updateCollection",route:"/api/1.0/collections/update"},{name:"updateCollectionOrder",route:"/api/1.0/collections/update_order"},{name:"updateCollectionImage",route:"/api/1.0/collections/update_image"},{name:"getCollections",route:"/api/1.0/collections/list"},{name:"addToCollection",route:"/api/1.0/collections/add"},{name:"removeFromCollection",route:"/api/1.0/collections/remove_items"},{name:"getProductsByUser",route:"/api/1.0/marketplace/products/get_by_user"},{name:"worksSearch",route:"/api/1.0/marketplace/songs/search"},{name:"retrieveProductReviews",route:"/api/1.0/marketplace/reviews/get_by_product"},{name:"createProductReview",route:"/api/1.0/marketplace/reviews/create_for_product"},{name:"deleteProductReview",route:"/api/1.0/marketplace/reviews/delete"},{name:"flagProductReview",route:"/api/1.0/marketplace/reviews/flag"},{name:"deactivateProduct",route:"/api/1.0/marketplace/products/deactivate"},{name:"flagDocument",route:"/api/1.0/flag/document"},{name:"searchInstruments",route:"/api/1.0/search/instruments"},{name:"sellerCommission",route:"/api/1.0/marketplace/seller_commission"},{name:"checkUsernameUseability",route:"/client/1.0/check_username_useable"},{name:"checkEmailUseability",route:"/client/1.0/check_email_useable"},{name:"getCountries",route:"/api/1.0/marketplace/countries",service:"getService"},{name:"taxLookupWithCard",route:"/api/1.0/product_purchase/tax_lookup_card"},{name:"taxLookupWithAddress",route:"/api/1.0/product_purchase/tax_lookup_address"},{name:"scoreSharing",route:"/api/1.0/scores/sharing"},{name:"terminateWithRefund",route:"/api/1.0/recurly_subscription/terminate_with_refund"},{name:"sessionService",route:"/client/1.0/session"},{name:"cancelFuture",route:"/api/1.0/recurly_subscription/terminate_future_subscription"},{name:"cancelSubscription",route:"/api/1.0/recurly_subscription/cancel_subscription"},{name:"reactivateSubscription",route:"/api/1.0/recurly_subscription/reactivate_subscription"},{name:"redeemRecurlyCoupon",route:"/api/1.0/redeem_recurly_coupon"},{name:"listRedemptionPoints",route:"/api/1.0/redemption_points/list"},{name:"redeemRedemptionCodes",route:"/api/1.0/redemption_codes/redeem"},{name:"collectionItems",route:"/api/1.0/collections/items"},{name:"removeCollectionItems",route:"/api/1.0/collections/remove_items"},{name:"addScoresToCollection",route:"/api/1.0/collections/add"},{name:"deleteCollection",route:"/api/1.0/collections/delete"},{name:"getContentPackagesData",route:"/api/1.0/content_packages/data"},{name:"fetchForums",route:"/api/1.0/forums"},{name:"deleteForum",route:"/api/1.0/forums/delete"},{name:"positionForum",route:"/api/1.0/forums/position"},{name:"createForum",route:"/api/1.0/groups/forums/create"},{name:"updateForum",route:"/api/1.0/forums/update"},{name:"fetchDiscussions",route:"/api/1.0/forums/discussions"},{name:"deleteForum",route:"/api/1.0/forums/delete"},{name:"deleteDiscussion",route:"/api/1.0/forums/delete_discussion"},{name:"fetchPosts",route:"/api/1.0/forums/posts"},{name:"addPost",route:"/api/1.0/forums/add_post"},{name:"addDiscussion",route:"/api/1.0/forums/add_discussion"},{name:"flagPost",route:"/api/1.0/posts/flag"},{name:"deletePost",route:"/api/1.0/forums/delete_post"},{name:"blockPost",route:"/api/1.0/forums/block_post"},{name:"updatePost",route:"/api/1.0/forums/update_post"},{name:"unblockPost",route:"/api/1.0/forums/unblock_post"},{name:"purchaseGiftCert",route:"/api/1.0/gift_certs/purchase_recurly"},{name:"privateStatistics",route:"/api/1.0/members/private_statistics"},{name:"privateCollections",route:"/api/1.0/members/private_collections"},{name:"copyScores",route:"/api/1.0/communities/copy_scores"},{name:"restoreScores",route:"/api/1.0/members/restore_scores"},{name:"deleteScores",route:"/api/1.0/members/delete_scores"},{name:"getSites",route:"/client/1.0/communities"},{name:"fetchScores",route:"/api/1.0/members/private_scores"},{name:"fetchMarketplaceScores",route:"/api/1.0/members/marketplace_scores"},{name:"fetchPurchasedScores",route:"/api/1.0/members/purchased_scores"},{name:"fetchSharedScores",route:"/api/1.0/members/shared_scores"},{name:"removeSharedScores",route:"/api/1.0/shared/remove_scores"},{name:"fetchTemplateCopies",route:"/api/1.0/members/template_copies"},{name:"removeScores",route:"/api/1.0/members/remove_scores"},{name:"fetchFavoriteScores",route:"/api/1.0/members/favorite_scores"},{name:"removeFavoriteScores",route:"/api/1.0/favorites/remove_scores"},{name:"fetchPrivateBooks",route:"/api/1.0/members/private_books"},{name:"fetchTrashScores",route:"/api/1.0/members/trash"},{name:"activateSite",route:"/api/1.0/sites/activate"},{name:"addUsersToSite",route:"/api/1.0/sites/add_users"},{name:"masqueradeAsUser",route:"/api/1.0/sites/masquerade_user"},{name:"fetchSiteUsers",route:"/api/1.0/sites/users"},{name:"deactivateSite",route:"/api/1.0/sites/deactivate"},{name:"deleteSiteUsers",route:"/api/1.0/sites/delete_users"},{name:"massResetPasswords",route:"/api/1.0/sites/reset_passwords"}],l=["fetchGroupRequestsSearch","fetchGroupFlags","loadFlagActions","fetchGroupStats","addFlaggedMemberToBlacklist","removeFlaggedMemberFromBlacklist","suspendFlaggedGroup","unsuspendFlaggedGroup","removeFlaggedScore","restoreFlaggedScore","removeFlaggedComment","restoreFlaggedComment","removeFlaggedPost","restoreFlaggedPost","closeFlag","reopenFlag","suspendGroup","userMessages","replyToFlag"];function c(){var e=this,t={};function o(o){e[o]=function(s,l,c,u){var d=""!==s,p=s.fullScreen,f=s.doNotRemoveReporterAutomatically,h=s.doNotShowDefaultError,m=function(e){r.default.publish(n.REPORTER_REMOVE,{fullScreen:p}),h||(p?r.default.publish(n.REPORTER_ADD_ERROR,{code:e[0].code,message:(0,a.resource)("errors.".concat(e[0].code)),fullScreen:!0,withBackground:!0}):s&&s.errorsReporter?s.errorsReporter.addErrors(e):r.default.publish(n.REPORTER_ADD_ERRORS,e),u.fail&&u.fail(e))},g=function(){d&&!f&&r.default.publish(n.REPORTER_REMOVE,{fullScreen:p})};u=u||{},"string"==typeof s?(r.default.publish(n.REPORTER_ADD,{text:s}),s=null,u.onFail=m):s?(r.default.publish(n.REPORTER_ADD,s),u.onFail=m):u.onFail=g,c=c||{};var b="_"+o,v=null;if(i.NF.config.useMockApiService&&t&&t[b])s&&(s.errors=s.errors||ko.observableArray(),s.busy=s.busy||ko.observable(0),s.busy()||s.errors([])),v=t[b](c,u),setTimeout(function(){l(v)},1e3);else{if(!e[b])throw"Not implemented";e[b](s,function(e){g(),l(e)},c,u)}}}t._flagReview=function(){return{success:!0}},e.map=function(e,t){if($.isArray(e)){for(var o=[],r=0;r<e.length;r++)o.push(t(e[r]));return o}return t(e)},e.getRouteFromName=function(e){for(var t=0;t<s.length;t++)if(s[t].name==e)return s[t].route;return""},e.initialize=function(){!function(){for(var t=function(t){var r=s[t].service?s[t].service:"postService";o(s[t].name),e["_"+s[t].name]=function(e,o,n,a){var l="postService"===r?a:{};i.Noteflight[r](s[t].route,e,o,l)(n,a)}},r=0;r<s.length;r++)t(r)}(),function(){for(var r=function(r){o(l[r]),e["_"+l[r]]=function(e,o,n,i){o(t["_"+l[r]](n))}},n=0;n<l.length;n++)r(n)}()},e.initialize()}var u=new c;t.apiService=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TWITTER_LINK=t.FACEBOOK_LINK=t.PRESS_LINK=t.FEEDBACK_LINK=t.BLOG_LINK=t.SUPPORT_LINK=t.FAQ_LINK=t.HELP_CENTER_LINK=void 0;t.HELP_CENTER_LINK="https://support.noteflight.com";t.FAQ_LINK="https://support.noteflight.com/hc/en-us/sections/360003049952-Frequently-Asked-Questions";t.SUPPORT_LINK="https://support.noteflight.com/hc/en-us/articles/360022145092-Submit-a-Support-Request-";t.BLOG_LINK="https://notes.noteflight.com/";t.FEEDBACK_LINK="http://feedback.noteflight.com";t.PRESS_LINK="https://notes.noteflight.com/category/news/press/";t.FACEBOOK_LINK="https://www.facebook.com/Noteflight";t.TWITTER_LINK="https://twitter.com/noteflight"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(o(4)),n=o(5),i=d(o(32)),a=d(o(194)),s=o(53),l=o(0),c=o(6),u=o(73);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handleUploadComplete=this.handleUploadComplete.bind(this),this.serviceReporter=t.serviceReporter||c.NF.appViewModel.reporter,this.imageId=t.imageId||c.ko.observable(),this._oldImageId=this.imageId(),this.newImageUploaded=c.ko.observable(!1),this._aspectRatio=t.aspectRatio||1,this.pictureKey=c.ko.observable(t.pictureKey),this.id=c.ko.computed(function(){return"".concat(o.pictureKey(),"_id")}),this.endpointName=c.ko.observable(t.endpointName),this.endpointDataName=c.ko.computed(function(){return"".concat(o.endpointName(),"Data")}),this.endpoint=c.ko.computed(function(){return t.endpoint||u.apiService.getRouteFromName(o.endpointName())}),this._originalUrlString=t.imageUrl(),this._originalImageUrl=t.imageUrl,this._rawImageUrl=c.ko.observable(t.imageUrl()),this.imageUrl=c.ko.computed(function(){return"url('".concat(o._rawImageUrl(),"')")}),this.imageAPI=t.imageAPI,this.imageSize=t.imageSize||c.ko.observable("big"),this.uploaderId=c.ko.observable(t.uploaderId||"imageUploader"),this.editable=c.ko.observable(t.editable||!1),this.isPremium=c.ko.observable(t.isPremium||!1),this.externalId=t.externalId,this.uploadImage=this.uploadImage.bind(this),this.contextMenuItems=c.ko.observableArray(t.contextMenuItems||[]),this.originalImage=this.imageId(),this.loading=c.ko.observable(!1),r.default.subscribe(n.STOCK_IMAGE_UPLOADING,function(){o.loading(!0)}),r.default.subscribe(n.STOCK_IMAGE_UPLOADED,function(){o.loading(!1)})}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"setImageUrl",value:function(e){this._rawImageUrl(e)}},{key:"_canEditPremiumFeatures",value:function(e){return!(this.editable()&&!this.isPremium())||((0,i.default)((0,l.resource)("editorDialog.".concat(e)),(0,l.resource)("alerts/premiumRequired".concat(e)),e),!1)}},{key:"_updateProfile",value:function(e,t){var o=t||function(){},i={user:{profile:{}},user_id:this.externalId};i.user[e]=this.imageId(),c.NF.apiService.editProfile("",function(){r.default.publish(n.PROFILE_EPOCH_FORCE_UPDATE),o()},i,{})}},{key:"refreshImage",value:function(){(0,s.updateProfileEpoch)(!0),this._rawImageUrl(this._originalImageUrl())}},{key:"initialize",value:function(){var e=this;setTimeout(function(){$("#"+e.uploaderId()).fineUploader({text:{uploadButton:(0,l.resource)("uploader.uploadButton"),cancelButton:(0,l.resource)("action.cancel"),retryButton:(0,l.resource)("action.retry"),failUpload:(0,l.resource)("uploader.failUpload"),waitingForResponse:(0,l.resource)("uploader.waitingForResponse"),dragZone:(0,l.resource)("uploader.dragZone")},request:{endpoint:e.endpoint(),inputName:e.pictureKey(),forceMultipart:!0,params:{authenticity_token:c.NF.authenticityToken}},multiple:!1}).on("complete",e.handleUploadComplete)},50)}},{key:"uploadImage",value:function(){if(!this.editable())return!1;$("#".concat(this.pictureKey()," .imageUploaderContainer input[type=file]")).trigger("click")}},{key:"handleUploadComplete",value:function(e,t,o,r){this.serviceReporter.clearErrors(),r.success?this._callbackNewImageUploaded(r,!0):413===r.status?this.serviceReporter.addError({message:(0,l.resource)("errors.entityTooLarge",r.max_size),code:"errors.entityTooLarge"}):r.errors?this.serviceReporter.addError({message:(0,l.resource)("errors.".concat(r.errors[0].message)),code:"errors.other"}):this.serviceReporter.addError({message:(0,l.resource)("errors.unexpectedError"),code:"errors.unexpectedError"})}},{key:"_callbackNewImageUploaded",value:function(e,t){this.imageId(e[this.pictureKey()].id),this._rawImageUrl("".concat(this.imageAPI).concat(this.imageId())),this.newImageUploaded(!0)}},{key:"_letUserCropImage",value:function(){new a.default(this._croppingSuccessCallback.bind(this),{imageUrl:this._rawImageUrl(),cancelCallback:this._croppingCancelCallback.bind(this),aspectRatio:this._aspectRatio}).show()}},{key:"_croppingSuccessCallback",value:function(e){this.loading(!0),c.NF.apiService[this.endpointDataName()]("",this._handleImageSaved.bind(this),{data:e})}},{key:"_croppingCancelCallback",value:function(){}},{key:"_handleImageSaved",value:function(e){this._callbackNewImageUploaded(e,!1),this.loading(!1)}},{key:"revertImage",value:function(){this._rawImageUrl(this._originalUrlString),this.newImageUploaded(!1),this.initialize()}}]),e}();t.default=f},function(e,t,o){e.exports=o(7)(683)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateScoreSharing=function(e,t,o,n,i,a,s,l,c){return{type:r.UPDATE_SCORE_SHARING.REQUESTED,scoreId:e,everyoneRole:t,groups:o,users:n,searchable:i,copyable:a,template:s,authorship:l,songs:c}},t.searchGroups=function(e,t,o,n){return{type:r.SEARCH_GROUPS.REQUESTED,query:e,userId:t,startIndex:o,maxCount:n}},t.addGroupShare=function(e,t){return{type:r.ADD_GROUP_SHARE,id:e,permissions:t}},t.removeGroupShare=function(e){return{type:r.REMOVE_GROUP_SHARE,id:e}},t.updateGroupShare=function(e,t){return{type:r.UPDATE_GROUP_SHARE,id:e,permissions:t}},t.searchGroupsReset=function(){return{type:r.SEARCH_GROUPS.RESET}},t.searchUsers=function(e,t,o,n){return{type:r.SEARCH_USERS.REQUESTED,query:e,order:t,startIndex:o,maxCount:n}},t.addUserShare=function(e,t){return{type:r.ADD_USER_SHARE,id:e,permissions:t}},t.removeUserShare=function(e){return{type:r.REMOVE_USER_SHARE,id:e}},t.updateUserShare=function(e,t){return{type:r.UPDATE_USER_SHARE,id:e,permissions:t}},t.searchUsersReset=function(){return{type:r.SEARCH_USERS.RESET}},t.updateSharingProperties=function(e){return{type:r.UPDATE_SHARING_PROPERTIES,properties:e}},t.songSearch=function(e,t){return{type:r.SEARCH_SONGS.REQUESTED,title:e,contributors:t,startIndex:0}},t.songSearchReset=function(){return{type:r.SEARCH_SONGS.RESET}},t.addSong=function(e){return{type:r.ADD_SONG,songId:e}},t.removeSong=function(e){return{type:r.REMOVE_SONG,songId:e}},t.addBlackboxSong=function(e){return{type:r.ADD_BLACKBOX_SONG,blackboxSong:e}},t.removeBlackboxSong=function(e){return{type:r.REMOVE_BLACKBOX_SONG,index:e}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(69))},function(e,t,o){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function o(){this.off(e,o),t.apply(this,arguments)}return o.fn=t,this.on(e,o),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var o,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n=0;n<r.length;n++)if((o=r[n])===t||o.fn===t){r.splice(n,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),o=this._callbacks["$"+e];if(o)for(var r=0,n=(o=o.slice(0)).length;r<n;++r)o[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,o){(function(e){var r,n=o(575),i=o(289),a=o(577),s=o(578),l=o(579);e&&e.ArrayBuffer&&(r=o(580));var c="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),d=c||u;t.protocol=3;var p=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=n(p),h={type:"error",data:"parser error"},m=o(581);function g(e,t,o){for(var r=new Array(e.length),n=s(e.length,o),i=function(e,o,n){t(o,function(t,o){r[e]=o,n(t,r)})},a=0;a<e.length;a++)i(a,e[a],n)}t.encodePacket=function(o,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var a=void 0===o.data?void 0:o.data.buffer||o.data;if(e.ArrayBuffer&&a instanceof ArrayBuffer)return function(e,o,r){if(!o)return t.encodeBase64Packet(e,r);var n=e.data,i=new Uint8Array(n),a=new Uint8Array(1+n.byteLength);a[0]=p[e.type];for(var s=0;s<i.length;s++)a[s+1]=i[s];return r(a.buffer)}(o,r,i);if(m&&a instanceof e.Blob)return function(e,o,r){if(!o)return t.encodeBase64Packet(e,r);if(d)return function(e,o,r){if(!o)return t.encodeBase64Packet(e,r);var n=new FileReader;return n.onload=function(){e.data=n.result,t.encodePacket(e,o,!0,r)},n.readAsArrayBuffer(e.data)}(e,o,r);var n=new Uint8Array(1);n[0]=p[e.type];var i=new m([n.buffer,e.data]);return r(i)}(o,r,i);if(a&&a.base64)return function(e,o){var r="b"+t.packets[e.type]+e.data.data;return o(r)}(o,i);var s=p[o.type];return void 0!==o.data&&(s+=n?l.encode(String(o.data),{strict:!1}):String(o.data)),i(""+s)},t.encodeBase64Packet=function(o,r){var n,i="b"+t.packets[o.type];if(m&&o.data instanceof e.Blob){var a=new FileReader;return a.onload=function(){var e=a.result.split(",")[1];r(i+e)},a.readAsDataURL(o.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(o.data))}catch(e){for(var s=new Uint8Array(o.data),l=new Array(s.length),c=0;c<s.length;c++)l[c]=s[c];n=String.fromCharCode.apply(null,l)}return i+=e.btoa(n),r(i)},t.decodePacket=function(e,o,r){if(void 0===e)return h;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),o);if(r&&!1===(e=function(e){try{e=l.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return h;var n=e.charAt(0);return Number(n)==n&&f[n]?e.length>1?{type:f[n],data:e.substring(1)}:{type:f[n]}:h}n=new Uint8Array(e)[0];var i=a(e,1);return m&&"blob"===o&&(i=new m([i])),{type:f[n],data:i}},t.decodeBase64Packet=function(e,t){var o=f[e.charAt(0)];if(!r)return{type:o,data:{base64:!0,data:e.substr(1)}};var n=r.decode(e.substr(1));return"blob"===t&&m&&(n=new m([n])),{type:o,data:n}},t.encodePayload=function(e,o,r){"function"==typeof o&&(r=o,o=null);var n=i(e);if(o&&n)return m&&!d?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");g(e,function(e,r){t.encodePacket(e,!!n&&o,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,o,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,o,r);var n;if("function"==typeof o&&(r=o,o=null),""===e)return r(h,0,1);for(var i,a,s="",l=0,c=e.length;l<c;l++){var u=e.charAt(l);if(":"===u){if(""===s||s!=(i=Number(s)))return r(h,0,1);if(s!=(a=e.substr(l+1,i)).length)return r(h,0,1);if(a.length){if(n=t.decodePacket(a,o,!1),h.type===n.type&&h.data===n.data)return r(h,0,1);if(!1===r(n,l+i,c))return}l+=i,s=""}else s+=u}return""!==s?r(h,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,o){if(!e.length)return o(new ArrayBuffer(0));g(e,function(e,o){t.encodePacket(e,!0,!0,function(e){return o(null,e)})},function(e,t){var r=t.reduce(function(e,t){var o;return e+(o="string"==typeof t?t.length:t.byteLength).toString().length+o+2},0),n=new Uint8Array(r),i=0;return t.forEach(function(e){var t="string"==typeof e,o=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);o=r.buffer}n[i++]=t?0:1;var s=o.byteLength.toString();for(a=0;a<s.length;a++)n[i++]=parseInt(s[a]);n[i++]=255;for(r=new Uint8Array(o),a=0;a<r.length;a++)n[i++]=r[a]}),o(n.buffer)})},t.encodePayloadAsBlob=function(e,o){g(e,function(e,o){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(i.length+1);for(n=0;n<i.length;n++)a[n]=parseInt(i[n]);if(a[i.length]=255,m){var s=new m([t.buffer,a.buffer,e]);o(null,s)}})},function(e,t){return o(new m(t))})},t.decodePayloadAsBinary=function(e,o,r){"function"==typeof o&&(r=o,o=null);for(var n=e,i=[];n.byteLength>0;){for(var s=new Uint8Array(n),l=0===s[0],c="",u=1;255!==s[u];u++){if(c.length>310)return r(h,0,1);c+=s[u]}n=a(n,2+c.length),c=parseInt(c);var d=a(n,0,c);if(l)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var p=new Uint8Array(d);d="";for(u=0;u<p.length;u++)d+=String.fromCharCode(p[u])}i.push(d),n=a(n,c)}var f=i.length;i.forEach(function(e,n){r(t.decodePacket(e,o,!0),n,f)})}}).call(this,o(37))},function(e,t,o){e.exports=o(7)(709)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return function(){var t,o=Math.max,r=Math.abs,n=/left|center|right/,i=/top|center|bottom/,a=/[\+\-]\d+(\.[\d]+)?%?/,s=/^\w+/,l=/%$/,c=e.fn.position;function u(e,t,o){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?o/100:1)]}function d(t,o){return parseInt(e.css(t,o),10)||0}e.position={scrollbarWidth:function(){if(void 0!==t)return t;var o,r,n=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),i=n.children()[0];return e("body").append(n),o=i.offsetWidth,n.css("overflow","scroll"),o===(r=i.offsetWidth)&&(r=n[0].clientWidth),n.remove(),t=o-r},getScrollInfo:function(t){var o=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===o||"auto"===o&&t.width<t.element[0].scrollWidth;return{width:"scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var o=e(t||window),r=e.isWindow(o[0]),n=!!o[0]&&9===o[0].nodeType;return{element:o,isWindow:r,isDocument:n,offset:r||n?{left:0,top:0}:e(t).offset(),scrollLeft:o.scrollLeft(),scrollTop:o.scrollTop(),width:o.outerWidth(),height:o.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var l,p,f,h,m,g,b=e(t.of),v=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(v),_=(t.collision||"flip").split(" "),S={};return g=function(t){var o=t[0];return 9===o.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(o)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:o.preventDefault?{width:0,height:0,offset:{top:o.pageY,left:o.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(b),b[0].preventDefault&&(t.at="left top"),p=g.width,f=g.height,h=g.offset,m=e.extend({},h),e.each(["my","at"],function(){var e,o,r=(t[this]||"").split(" ");1===r.length&&(r=n.test(r[0])?r.concat(["center"]):i.test(r[0])?["center"].concat(r):["center","center"]),r[0]=n.test(r[0])?r[0]:"center",r[1]=i.test(r[1])?r[1]:"center",e=a.exec(r[0]),o=a.exec(r[1]),S[this]=[e?e[0]:0,o?o[0]:0],t[this]=[s.exec(r[0])[0],s.exec(r[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?m.left+=p:"center"===t.at[0]&&(m.left+=p/2),"bottom"===t.at[1]?m.top+=f:"center"===t.at[1]&&(m.top+=f/2),l=u(S.at,p,f),m.left+=l[0],m.top+=l[1],this.each(function(){var n,i,a=e(this),s=a.outerWidth(),c=a.outerHeight(),g=d(this,"marginLeft"),w=d(this,"marginTop"),k=s+g+d(this,"marginRight")+y.width,E=c+w+d(this,"marginBottom")+y.height,P=e.extend({},m),C=u(S.my,a.outerWidth(),a.outerHeight());"right"===t.my[0]?P.left-=s:"center"===t.my[0]&&(P.left-=s/2),"bottom"===t.my[1]?P.top-=c:"center"===t.my[1]&&(P.top-=c/2),P.left+=C[0],P.top+=C[1],n={marginLeft:g,marginTop:w},e.each(["left","top"],function(o,r){e.ui.position[_[o]]&&e.ui.position[_[o]][r](P,{targetWidth:p,targetHeight:f,elemWidth:s,elemHeight:c,collisionPosition:n,collisionWidth:k,collisionHeight:E,offset:[l[0]+C[0],l[1]+C[1]],my:t.my,at:t.at,within:v,elem:a})}),t.using&&(i=function(e){var n=h.left-P.left,i=n+p-s,l=h.top-P.top,u=l+f-c,d={target:{element:b,left:h.left,top:h.top,width:p,height:f},element:{element:a,left:P.left,top:P.top,width:s,height:c},horizontal:i<0?"left":n>0?"right":"center",vertical:u<0?"top":l>0?"bottom":"middle"};p<s&&r(n+i)<p&&(d.horizontal="center"),f<c&&r(l+u)<f&&(d.vertical="middle"),o(r(n),r(i))>o(r(l),r(u))?d.important="horizontal":d.important="vertical",t.using.call(this,e,d)}),a.offset(e.extend(P,{using:i}))})},e.ui.position={fit:{left:function(e,t){var r,n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,a=n.width,s=e.left-t.collisionPosition.marginLeft,l=i-s,c=s+t.collisionWidth-a-i;t.collisionWidth>a?l>0&&c<=0?(r=e.left+l+t.collisionWidth-a-i,e.left+=l-r):e.left=c>0&&l<=0?i:l>c?i+a-t.collisionWidth:i:l>0?e.left+=l:c>0?e.left-=c:e.left=o(e.left-s,e.left)},top:function(e,t){var r,n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,a=t.within.height,s=e.top-t.collisionPosition.marginTop,l=i-s,c=s+t.collisionHeight-a-i;t.collisionHeight>a?l>0&&c<=0?(r=e.top+l+t.collisionHeight-a-i,e.top+=l-r):e.top=c>0&&l<=0?i:l>c?i+a-t.collisionHeight:i:l>0?e.top+=l:c>0?e.top-=c:e.top=o(e.top-s,e.top)}},flip:{left:function(e,t){var o,n,i=t.within,a=i.offset.left+i.scrollLeft,s=i.width,l=i.isWindow?i.scrollLeft:i.offset.left,c=e.left-t.collisionPosition.marginLeft,u=c-l,d=c+t.collisionWidth-s-l,p="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,f="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,h=-2*t.offset[0];u<0?((o=e.left+p+f+h+t.collisionWidth-s-a)<0||o<r(u))&&(e.left+=p+f+h):d>0&&((n=e.left-t.collisionPosition.marginLeft+p+f+h-l)>0||r(n)<d)&&(e.left+=p+f+h)},top:function(e,t){var o,n,i=t.within,a=i.offset.top+i.scrollTop,s=i.height,l=i.isWindow?i.scrollTop:i.offset.top,c=e.top-t.collisionPosition.marginTop,u=c-l,d=c+t.collisionHeight-s-l,p="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,h=-2*t.offset[1];u<0?((n=e.top+p+f+h+t.collisionHeight-s-a)<0||n<r(u))&&(e.top+=p+f+h):d>0&&((o=e.top-t.collisionPosition.marginTop+p+f+h-l)>0||r(o)<d)&&(e.top+=p+f+h)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.ui.position})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.fn.extend({uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_WINDOW_DIMENSIONS=void 0;t.UPDATE_WINDOW_DIMENSIONS="LAYOUT__UPDATE_WINDOW_DIMENSIONS"},function(e,t,o){"use strict";e.exports=o(146)},function(e,t,o){e.exports=o(7)(19)},function(e,t,o){"use strict";t.__esModule=!0;t.addLeadingSlash=function(e){return"/"===e.charAt(0)?e:"/"+e},t.stripLeadingSlash=function(e){return"/"===e.charAt(0)?e.substr(1):e};var r=t.hasBasename=function(e,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e)};t.stripBasename=function(e,t){return r(e,t)?e.substr(t.length):e},t.stripTrailingSlash=function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e},t.parsePath=function(e){var t=e||"/",o="",r="",n=t.indexOf("#");-1!==n&&(r=t.substr(n),t=t.substr(0,n));var i=t.indexOf("?");return-1!==i&&(o=t.substr(i),t=t.substr(0,i)),{pathname:t,search:"?"===o?"":o,hash:"#"===r?"":r}},t.createPath=function(e){var t=e.pathname,o=e.search,r=e.hash,n=t||"/";return o&&"?"!==o&&(n+="?"===o.charAt(0)?o:"?"+o),r&&"#"!==r&&(n+="#"===r.charAt(0)?r:"#"+r),n}},function(e,t,o){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(){return{ids:[],loaded:!1,loading:!1,count:null,remaining:0,shown:0}}Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultState=n,t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ids:[],loaded:!1,loading:!1,count:null,remaining:0,shown:0},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=o)switch(o.type){case e.REQUESTED:return Object.assign({},t,{loading:!0});case e.FAILED:return Object.assign({},t,{loading:!1});case e.SUCCEEDED:return function(e,t){var o=t.firstPage?t.ids:r(e.ids).concat(r(t.ids));return Object.assign({},e,{ids:o,loaded:!0,loading:!1,count:t.count,remaining:t.remaining,shown:t.shown})}(t,o);case e.RESET:return{ids:[],loaded:!1,loading:!1,count:null,remaining:0,shown:0}}return t}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeMapElementsById=function(e,t){for(var o=Object.assign({},e),r=0;r<t.length;r++){var n=t[r];delete o[n]}return o},t.addMapElementsById=function(e,t){for(var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={},a=0;a<t.length;a++){var s=t[a];"development"===r.NF.environment&&o&&i(s),n[s.id]=s}return Object.assign({},e,n)},t.updateMapElementsById=function(e,t){for(var o=Object.assign({},e),r=0;r<t.length;r++){var n=t[r];o[n.id]=Object.assign({},o[n.id],n)}return o},t.passActionToChildReducer=function(e,t,o,r,i){var a=e[t];if(void 0===e[t])throw"Unknown hash key '".concat(t,"' in passActionToChildReducer");if(void 0===e[t][o])throw"Unknown child key '".concat(o,"' in state's hash '").concat(t,"' in passActionToChildReducer");return Object.assign({},e,n({},t,Object.assign({},a,n({},o,r(a[o],i)))))};var r=o(6);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e){for(var t=Object.keys(e),o=0;o<t.length;o++){var r=e[t[o]];null===r||r.constructor!==Object||a(e,t[o])||console.warn("WARNING: Unexpected sub-object added during LOAD_MODELS: ".concat(t[o],".\n- If it's a first-class model, load it in a separate action and link it to this model with its ID.\n- If it's a valid sub-object (like score metadata), whitelist it in ReducerHelpers.js."))}}function a(e,t){return"score"==e.object_type&&"metadata"==t||("product"==e.object_type&&"metadata"==t||("group"==e.object_type&&"permissions"==t||"user"==e.object_type&&"profile"==t))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_SESSION=void 0;var r=new(function(e){return e&&e.__esModule?e:{default:e}}(o(22)).default)("SESSION","LOAD_SESSION");t.LOAD_SESSION=r},function(e,t,o){"use strict";function r(e,t){return e.map(function(e,o){return n(e,t,o)})}function n(e,t,o){var r={name:e.title,id:e.id,price:e.price/100,brand:e.seller_id,category:e.metadata&&e.metadata.genre,variant:e.official?"Original":"Arrangement"};return t&&(r.list=t),void 0!==o&&(r.position=o),r}Object.defineProperty(t,"__esModule",{value:!0}),t.addProductImpressions=function(e){window.dataLayer.push({event:"eeProductImpressions",ecommerce:{currencyCode:"USD",impressions:r(e,"Search Results")}})},t.addProductView=function(e){window.dataLayer.push({event:"eeProductView",ecommerce:{currencyCode:"USD",detail:{products:[n(e)]}}})},t.startProductCheckout=function(e){window.dataLayer.push({event:"eeCheckout",ecommerce:{checkout:{actionField:{step:1},products:[n(e)]}}})},t.productPurchased=function(e,t,o){window.dataLayer.push({event:"eeProductPurchase",ecommerce:{purchase:{actionField:{id:t.external_id,revenue:Number(t.total_charged)/100,quantity:o},products:[n(e)]}}})},t.formatProducts=r,t.formatProduct=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.songSearch=function(e,t){return(0,r.jsonPost)("/api/1.0/marketplace/songs/search",{title_term:e,contributors_term:t})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSharedWithEveryoneSelector=t.sharedDocumentRolesSelector=void 0;var r=o(12),n=o(8),i=o(48),a=o(34),s=o(17),l=(0,r.createSelector)(s.editorContentModelSelector,a.documentRolesSelector,function(e,t){for(var o=(0,i.hydrateIdList)(e.document_role_ids,t),r=[],a=[],s=null,l=0;l<o.length;l++){var c=o[l];null!==c.user_id&&c.role_name!=n.DOCUMENT_ROLE_AUTHOR?a.push(c):null!==c.group_id?r.push(c):c.everyone&&(s=c)}return{groupDocumentRoles:r,userDocumentRoles:a,everyoneDocumentRole:s}});t.sharedDocumentRolesSelector=l;var c=(0,r.createSelector)(l,function(e){return null!==e.everyoneDocumentRole});t.isSharedWithEveryoneSelector=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6);var n=function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.isSite=ko.computed(function(){return!o.session.community().default_community()}),this.isSSO=ko.computed(function(){return o.session.community()&&o.session.community().sso_allowed()}),this.isLoggedIn=ko.computed(function(){return!!o.session.current_user()}),this.isSiteAdmin=ko.computed(function(){return o.isLoggedIn()&&o.session.current_user().effective_admin()}),this.isSiteTeacher=ko.computed(function(){return o.isLoggedIn()&&null!=o.session.community_member()&&"instructor"==o.session.community_member().sso_user_role()}),this.isSiteStudent=ko.computed(function(){return o.isLoggedIn()&&null!=o.session.community_member()&&"student"==o.session.community_member().sso_user_role()}),this.isAtLeastSiteTeacher=ko.computed(function(){return o.isSiteAdmin()||o.isSiteTeacher()}),this.isNoteflightAdmin=ko.computed(function(){return o.isSiteAdmin()&&!o.isSite()})};t.default=n,r.Noteflight.Roles=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canadaStates=t.usStatesPlusPR=t.usStates=void 0;var r=[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"DC",label:"District of Columbia"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}];t.usStates=r;var n=r.slice(0,39).concat([{value:"PR",label:"Puerto Rico"}]).concat(r.slice(39,51));t.usStatesPlusPR=n;t.canadaStates=[{value:"AB",label:"Alberta"},{value:"BC",label:"British Columbia"},{value:"MB",label:"Manitoba"},{value:"NB",label:"New Brunswick"},{value:"NL",label:"Newfoundland and Labrador"},{value:"NS",label:"Nova Scotia"},{value:"NT",label:"Northwest Territories"},{value:"NU",label:"Nunavut"},{value:"ON",label:"Ontario"},{value:"PE",label:"Prince Edward Island"},{value:"QC",label:"Quebec"},{value:"SK",label:"Saskatchewan"},{value:"YT",label:"Yukon"}]},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STRIPE_CREDIT_CARD_STYLE=t.BUSINESS_TAX_ID_PLACEHOLDER_STRING=t.SSN_PLACEHOLDER_STRING=t.COMPANY_SELLER_TYPE=t.INDIVIDUAL_SELLER_TYPE=t.BANK_ACCOUNT_TYPE=t.CARD_TYPE=t.COMPANY_BANK_ACCOUNT_TYPE=t.INDIVIDUAL_BANK_ACCOUNT_TYPE=void 0;t.INDIVIDUAL_BANK_ACCOUNT_TYPE="individual";t.COMPANY_BANK_ACCOUNT_TYPE="company";t.CARD_TYPE="card";t.BANK_ACCOUNT_TYPE="bank_account";t.INDIVIDUAL_SELLER_TYPE="individual";t.COMPANY_SELLER_TYPE="company";t.SSN_PLACEHOLDER_STRING="****";t.BUSINESS_TAX_ID_PLACEHOLDER_STRING="**-*******";t.STRIPE_CREDIT_CARD_STYLE={base:{color:"#1px solid #0f0f0f",lineHeight:"20px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"13px","::placeholder":{color:"#a8a8a8"}},invalid:{color:"#f74e20",iconColor:"#f74e20"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(1)),n=c(o(117)),i=o(16),a=o(84),s=c(o(410)),l=c(o(54));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=p(this,f(t).call(this))).templateName=ko.observable("content/react"),e.resource=ko.observable(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,l.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"initialize",value:function(){}},{key:"onNavigate",value:function(){this.initialize()}},{key:"mounted",value:function(){var e=(0,i.getApplicationStore)();n.default.render(r.default.createElement(s.default,{store:e,history:a.history}),document.getElementById("reactRoot"))}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCurrentTab=function(e){return{type:r.SET_CURRENT_TAB,id:e}},t.getTabs=function(){return{type:r.GET_TABS.REQUESTED}},t.getCarousel=function(){return{type:r.GET_CAROUSEL.REQUESTED}},t.getRecommended=function(e){return{type:r.GET_RECOMMENDED.REQUESTED,recommendations:e}},t.rrProductClicked=function(e){return{type:r.RR_PRODUCT_CLICKED.REQUESTED,url:e}},t.search=function(e){return{type:r.SEARCH.REQUESTED,params:e}},t.setSearchQuery=function(e){return{type:r.SET_SEARCH_QUERY,query:e}},t.setSearchTerm=function(e){return{type:r.SET_SEARCH_TERM,searchTerm:e}},t.setSearchFilters=function(e){return{type:r.SET_SEARCH_FILTERS,searchFilters:e}},t.resetSearch=function(e){return{type:r.RESET_SEARCH.REQUESTED,params:e}},t.playProductPreview=function(e){return{type:r.PLAY_PRODUCT_PREVIEW,productUuid:e}},t.stopProductPreview=function(){return{type:r.STOP_PRODUCT_PREVIEW}},t.getProductPreview=function(e,t){return{type:r.GET_PRODUCT_PREVIEW.REQUESTED,url:e,productUuid:t}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(52))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"renderElements",value:function(){var e=this,t=this.props.renderer,o=0;return this.props.models.map(function(n){var i=n.id||n.external_id||n.uuid,s=0===o,l=o===e.props.models.length-1;return o++,r.default.createElement(t,a({isFirst:s,isLast:l,positionInArray:o-1,key:i},n))})}},{key:"renderHeader",value:function(){var e=this.props.headerRenderer;if(e)return r.default.createElement(e,null)}},{key:"render",value:function(){return r.default.createElement("div",{className:"gridContainer ".concat(this.props.styleClasses)},this.renderHeader(),this.renderElements())}}]),t}();t.default=d,d.propTypes={renderer:n.default.func.isRequired,headerRenderer:n.default.func,models:n.default.arrayOf(n.default.shape({id:n.default.oneOfType([n.default.string,n.default.number])}))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.AudioPreview=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=f(o(18)),a=f(o(4)),s=o(5),l=o(97),c=o(0),u=o(6),d=o(16),p=o(36);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y={loadAssetFunc:d.asset,instrumentBase:u.NF.config.instrumentPrefix,basicPerformance:u.NF.slowAudio,premium:!0,preview:!0},_=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?v(e):t}(this,g(t).call(this,e)),y.manifestLocation=(0,d.asset)("instruments/manifest.xml"),o.nfSynthesisContext=nfsyn.SynthesisContextSingleton.getInstance(y),o.handlePlayClick=o.handlePlayClick.bind(v(v(o))),o.handleStopClick=o.handleStopClick.bind(v(v(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,r.Component),function(e,t,o){t&&m(e.prototype,t),o&&m(e,o)}(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.productPlayingUuid==this.props.id,o=e.productPlayingUuid==e.id;o&&this.startProductPreview(e.currentPreview),t&&!o&&this.stopProductPreview()}},{key:"componentDidMount",value:function(){(0,p.initializeTippy)(p.originalBadgeHint)}},{key:"componentWillUnmount",value:function(){this.props.productPlayingUuid==this.props.id&&(this.stopProductPreview(),this.props.stopProductPreview())}},{key:"isPlaying",value:function(){return this.props.productPlayingUuid==this.props.id}},{key:"getProductPreview",value:function(){var e=this;this.nfSynthesisContext.startSound(function(){e.props.getProductPreview(e.props.url,e.props.id)})}},{key:"startProductPreview",value:function(e){var t=this;try{this.nfSequencer=new nfsyn.Sequencer(this.nfSynthesisContext,this.nfSynthesisContext.manifest,e,{loopStart:-1,loopEnd:-1});for(var o=[],r=function(r){o.push(new Promise(function(o){t.nfSynthesisContext.setSynthesizerForPart(e.parts[r],o)}))},n=0;n<e.parts.length;n++)r(n);this.nfSequencer.startPlaying=this.nfSequencer.startPlaying.bind(this.nfSequencer),Promise.all(o).then(this.nfSequencer.startPlaying)}catch(e){a.default.publish(s.REPORTER_ADD_ERROR,{code:"scorePreviewNotPlayable",message:(0,c.resource)("errors.scorePreviewNotPlayable")})}}},{key:"stopProductPreview",value:function(){this.nfSequencer&&this.nfSequencer.stop()}},{key:"handlePlayClick",value:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.getProductPreview()}},{key:"handleStopClick",value:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.stopProductPreview(),this.props.stopProductPreview()}},{key:"renderAudioPreview",value:function(){return this.isPlaying()?r.default.createElement("div",{className:"audioPreview playing",onClick:this.handleStopClick}):this.props.hasCustomAudioMedia?r.default.createElement("div",{className:"audioPreview notPlaying tippy","data-tippy-content":(0,c.resource)("hint.customAudioInScore"),onClick:this.handlePlayClick}):null==this.props.url?r.default.createElement("div",{className:"audioPreview noPlay tippy","data-tippy-content":(0,c.resource)("hint.previewNotAvailable")}):r.default.createElement("div",{className:"audioPreview notPlaying",onClick:this.handlePlayClick})}},{key:"render",value:function(){return this.renderAudioPreview()}}]),t}();t.AudioPreview=_,_.propTypes={id:i.default.string.isRequired,hasCustomAudioMedia:i.default.bool};var S=(0,n.connect)(function(e){return{productPlayingUuid:e.marketplace.productPlayingUuid,currentPreview:e.marketplace.currentPreview}},{playProductPreview:l.playProductPreview,stopProductPreview:l.stopProductPreview,getProductPreview:l.getProductPreview})(_);t.default=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getApplicationEditor=function(){if(null===U)throw"ScoreEditorModel singleton called too early!";return U},t.setApplicationEditor=j,t.default=B;var r=D(o(4)),n=o(6),i=x(o(30)),a=x(o(56)),s=o(8),l=o(5),c=D(o(200)),u=D(o(266)),d=D(o(472)),p=D(o(125)),f=D(o(474)),h=D(o(475)),m=D(o(558)),g=D(o(559)),b=D(o(561)),v=o(16),y=o(27),_=o(3),S=o(14),w=o(19),k=o(0),E=o(2),P=o(31),C=o(110),T=o(562),R=o(46),O=o(59),M=o(17),A=o(281),N=D(o(282)),I=D(o(616));function x(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}function D(e){return e&&e.__esModule?e:{default:e}}var F=10,L=10,U=null;function j(e){null!==U&&"test"!==n.NF.environment&&console.warn("ScoreEditorModel singleton was overridden."),U=e}function B(){var e=this,t=this;j(t),t.scoreId=n.ko.observable(),t.openSellingDialog=n.ko.observable(),t.openPurchasingDialog=n.ko.observable(),t.hidePurchaseButton=n.ko.observable(!1),t.initializeConnectedProperties=function(){t.author=n.ko.observable(),t.contentId=n.ko.observable(),t.contentType=n.ko.observable(),t.contentFullUrl=n.ko.observable(),t.contentSlug=n.ko.observable(),t.contentPolicy=n.ko.observable(),t.contentModel=n.ko.observable(),t.sourceProduct=n.ko.observable(),t.authorizedName=n.ko.observable(),t.purchasedQuantity=n.ko.observable(),t.ensembleSizeMax=n.ko.observable(),t.isLoggedIn=n.ko.observable(),t.isEditingProduct=n.ko.observable(),t.currentUser=n.ko.observable(),t.currentUserIsAuthor=n.ko.observable(),t.currentUserIsProductOwner=n.ko.observable(),t.currentUserIsPreviewingProduct=n.ko.observable(),t.shouldRenderMarketplaceProductFooter=n.ko.observable(),t.contentModel.subscribe(function(e){e&&e.source_score_id&&t.scoreId(e.source_score_id)}),(0,S.connect)(M.editorSelector,{})(t)},t.initializeConnectedProperties(),t.makeRRCalls=function(){t.contentType()!==s.PRODUCT||null!==t.currentUser()&&0!==t.purchasedQuantity()||localStorage.getItem("productPurchasing-".concat(t.contentId()))||(0,R.rrProductPage)(t.contentId(),t.contentModel().title)},t.makeRRCalls(),t.html5Editor=n.ko.observable(),t.score=n.ko.observable(),t.overrideScoreContentUri=n.ko.observable(),t.html5EditorReady=n.ko.observable(!1),t.html5EditorReady.subscribe(function(e){e&&t.editorInitializedCallback()}),t.marketplaceSellable=n.ko.computed(function(){return t.isLoggedIn()&&n.NF.session.current_user().has_seller_account()&&t.score()&&t.score().userIsAuthor()}),t.marketplaceBreadcrumb=n.ko.computed(function(){return e.currentUserIsPreviewingProduct()?new m.default:null}),t.newlyPublishedProduct=n.ko.observable(!1),t.marketplaceProductFooter=n.ko.computed(function(){if(t.shouldRenderMarketplaceProductFooter()||t.currentUserIsProductOwner()||t.contentPolicy()&&t.contentPolicy().is_product_copy&&t.purchasedQuantity()>0){var e=t.ensembleSizeMax()?t.purchasedQuantity()*t.ensembleSizeMax():null,o=e?(0,k.pluralize)("content.authorizedPerformers.onScore.upTo",e):(0,k.resource)("content.authorizedPerformers.onScore.maxSize");return"".concat((0,k.resource)("content.authorizedBy",t.authorizedName())," ").concat(o.toLowerCase(),".")}return null}),t.applyMarketplaceProductFooter=function(){t.marketplaceProductFooter()&&t.html5Editor().incrementalSaveManager.scoreEditListener.whileIgnoringModelEvents(function(){t.html5Editor().controller.setScoreProperty("footer",t.marketplaceProductFooter())})},t.scoreDetailsPanel=n.ko.observable(),t.session=n.NF.session,t.loginViewModel=new p.default,t.detailView=!0,t.scoreTemplateURL=n.ko.observable(),t.scoreImportType=n.ko.observable(),t.nfDebug=n.ko.observable(),t.mixer=n.ko.observable(),t.instrumentsPanel=n.ko.observable(),t.formattingPanel=n.ko.observable(),t.errors=n.ko.observableArray(),t.demo=n.ko.observable(!1),t.params=n.ko.observable(),t.scorePopulated=null,t.disableNavigation=n.ko.observable(!1),t.templateName=n.ko.observable("content/editor"),t.targetHelpInSeparateWindow=n.ko.observable(!0),t.showMixer=n.ko.observable(!1),t.showInstruments=n.ko.observable(!1),t.showMediaSyncEditor=n.ko.observable(!1),t.showFormatting=n.ko.observable(!1),t.showFormatting.subscribe(function(e){e?(t.formattingPanel().initializePanelWithCurrentView(),t.formattingPanel().saveCurrentView()):t.formattingPanel().applylastView()}),t.headerPaletteLeft=n.ko.observable(),t.headerPaletteRight=n.ko.observable(),t.customHeaderPalette=n.ko.observable(),t.isShowingLargeSideBar=n.ko.computed(function(){return t.showMixer()||t.showInstruments()}),t.isShowingVeryLargeSideBar=n.ko.computed(function(){return t.showFormatting()}),t.isShowingSmallSideBar=n.ko.computed(function(){return t.scoreDetailsPanel()&&t.scoreDetailsPanel().showScoreDetails()}),t.forceManualScrolling=n.ko.observable(!1),t.showPianoKeyboard=n.ko.observable(!1),t.showSectionsMenuPanel=n.ko.computed(function(){return!!t.customHeaderPalette()&&t.customHeaderPalette().menuOpen()}),t.viewer=n.ko.observable(!1),t.showEmbedPurchaseButton=n.ko.computed(function(){return t.viewer()&&t.contentType()==s.PRODUCT&&!t.hidePurchaseButton()}),t.productEmbedBottomContainer=new I.default((0,E.path)("productPreview",{uuid:this.contentId(),slug:this.contentSlug(),openPurchasingDialog:!0})),t.userId=n.ko.computed(function(){return t.score()&&t.score().author().external_id()}),r.default.subscribe(l.STOCK_IMAGE_COVER_ART_SELECTED,function(e,o){t.score().coverArt().id(o.cover_art_id),t.forceSave()}),r.default.subscribe(l.SCORE_REQUIRE_SAVE,function(){t.requireSave()}),r.default.subscribe(l.SCORE_SET_TITLE,function(e,o){t.html5Editor().scoreApi.setScoreTitle(o),t.updateStoreScore({title:o})}),r.default.subscribe(l.SCORE_SET_DESCRIPTION,function(e,o){t.score().description(o),t.updateStoreScore({description:o})}),r.default.subscribe(l.SCORE_SET_FACETS,function(e,o){t.score().genre(o.genre),t.score().difficultyLevel(o.difficulty_level),t.score().format(o.format),t.updateStoreScore({metadata:Object.assign({},t.contentModel().metadata,o)})}),r.default.subscribe(l.SCORE_FETCH_DATA,function(e,o){t.fetchScoreData(o)}),t.updateStoreScore=function(e){(0,v.getApplicationStore)().dispatch({type:i.UPDATE_MODELS.SUCCEEDED,modelsType:"scores",models:[Object.assign({id:t.contentModel().id},e)]})},t.notifyAppcuesOfNewScore=function(e){e.isNewlyCreatedScore()&&O.AppCuesEventTracker.trackScoreCreated(e.external_id())},r.default.subscribe(l.SCORE_SAVED,function(e,o){t.notifyAppcuesOfNewScore(o)}),t.initializeHtml5Editor=function(){t.html5Editor()&&(t.html5Editor().initialize(),t.initializeWindow())},t.getScoreData=function(e){$.when(t.scoreDataDeferred()).then(e)},t.scoreAppUri=function(e){var t=window.location.pathname+window.location.search;return(t=t.replace(/[\?\&]app=[^\?\&\#]*/g,""))+(t.indexOf("?")>=0?"&":"?")+"app="+e},t.requiresSave=function(){return t.html5EditorReady()&&t.html5Editor().requiresSave()},t.forceSave=function(){t.requireSave(),t.saveScore()},r.default.subscribe(l.SCORE_FORCE_SAVE,t.forceSave.bind(this)),t.requireSave=function(){t.html5EditorReady()&&t.html5Editor().requiresSave(!0)},t.saveScore=function(){t.requiresSave()&&t.html5Editor().save()},t.beforeUnload=function(){return!t.viewer()&&t.contentPolicy().can_edit&&!t.demo()&&(t.requiresSave()||t.html5Editor()&&t.html5Editor().saving())?(0,k.resource)("editor.unsavedChanges"):t.demo()&&!(0,P.getCookie)("demoRedirect")?((new d.default).show(),(0,k.resource)("content.thanksForTryingDemo")):void 0},t.initializeWindow=function(){function e(){return t.isLoggedIn()?t.currentUser().id:""}function o(){return"_nf_pref_"+e()}function r(){return n.NF.hasStorage&&t.isLoggedIn()}window.noteflightSetUserPreferences=function(t){if(r())return localStorage.setItem(o(),JSON.stringify({prefs:t,user_id:e()}))},window.noteflightGetUserPreferences=function(){var e;if(r()){var t=localStorage.getItem(o());if(t){var n=JSON.parse(t);n&&(e=n.prefs)}}return e||{}}},t.configureAsDemo=function(e){e.data.document_role_ids=[],(0,v.getApplicationStore)().dispatch({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"contentPolicies",models:[(0,C.getDemoContentPolicy)(e.id())]}),(0,v.getApplicationStore)().dispatch({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"scores",models:[e.data]}),(0,v.getApplicationStore)().dispatch({type:a.LOAD_CONTENT.SUCCEEDED,contentId:e.id(),contentType:s.SCORE,isEditingProduct:!1}),e.score_contents_url(null),e.versions=n.ko.observableArray()},t.initializeScoreDetailsPanel=function(){t.scoreDetailsPanel(new h.default(t)),t.scoreDetailsPanel().initializeDependentSections()},t.editorInitializedCallback=function(){t.checkForProductRedirect(),t.initializeScoreDetailsPanel(),t.checkForNewlyPublishedProduct(),t.checkForBuyerSignIn(),t.checkForPurchaseDialog(),t.checkForSellingDetails(),t.updateCommentsAndFavs(t.score().data.comments,t.score().data.favorites),t.updateScoreVersions(t.score().data.versions)},t.updateCommentsAndFavs=function(e,o){e&&t.scoreDetailsPanel().commentsSection()&&$.each(e,function(e,o){var r=new n.NF.Comment(o);t.scorePopulated&&t.score().comments.push(r),t.scoreDetailsPanel().commentsSection().appendComment(r)}),o&&t.scoreDetailsPanel().socialStatsSection()&&$.each(o,function(e,o){var r=new n.NF.Favorite(o);t.scorePopulated&&t.score().favorites.push(r),t.scoreDetailsPanel().socialStatsSection().appendFavorite(r)})},t.updateScoreVersions=function(e){e&&$.each(e,function(e,o){var r=new n.NF.Version(o);t.scorePopulated&&t.score().versions.push(r)})},t.handleScoreData=function(e){if(t.scorePopulated=t.score(),t.scorePopulated)t.updateCommentsAndFavs(e.score_data.comments,e.score_data.favorites),t.updateScoreVersions(e.score_data.versions);else{var o=new c.default(e.score_data);t.demo()&&t.configureAsDemo(o),t.score(o)}},t.scoreDataUri=function(){return n.NF.scoreUri||window.location.protocol+"//"+window.location.host+"/score_data/"+t.scoreId()},t.scoreContentUri=function(){return t.overrideScoreContentUri()||n.NF.scoreContentUri||(t.viewer()?window.location.protocol+"//"+window.location.host+"/score_content/"+t.scoreId():"")},t.initializeFetchScoreMethods=function(){var e=new n.NF.ServiceReporterViewModel((0,k.resource)("editor.savingScore")),o=function(e){return e.score_data.score_latest_version&&(t.score().score_latest_version=new n.Noteflight.Version(e.score_data.score_latest_version)),t.score().versions_count(e.score_data.versions_count),!0},r={contentType:n.NF.FORM_CONTENT_TYPE,fail:t.handleSaveFailure};t.saveScoreData=n.NF.postService("/score_data/"+t.scoreId(),e,o,r),t.saveScoreCopy=n.NF.postService("/save_score_copy/"+t.scoreId(),e,function(e){o(e)&&e.score_data.view_score_uri&&!t.disableNavigation()&&(0,E.navigate)(e.score_data.view_score_uri)},r),t.fetchScoreData=n.NF.getService(t.scoreDataUri(),t,t.handleScoreData)},n.ko.computed(function(){!t.scoreId()||t.score()||t.errors().length||t.initializeFetchScoreMethods()}),t.showLogin=function(){t.loginViewModel.show()},t.handleSaveFailure=function(e){["authenticationRequired","writeRequiresLogin"].includes(e.code)&&t.showLogin()},t.scoreDataDeferred=function(){var e=$.Deferred();return e.done(function(e){t.handleScoreData(e)}),n.NF.firstResponse&&n.NF.scoreData?(n.NF.firstResponse=!1,e.resolve({score_data:n.NF.scoreData}),e):(n.NF.getService(t.scoreDataUri(),t,e.resolve)({nps:!0,archived:!0,template_copies:!0,facet:"comments,favorites",comments_limit:F,favorites_limit:L}),e)},n.ko.computed(function(){t.errors().length&&(0,_.standardAlertDialog)(t.errors()[0].message)}),t.editorTip=new A.TipViewModel([{resourcesKey:"tip.editorMenuTip"}],"_nf_tip_editor_menu.hidden","editorTip"),t.editorHeight=n.ko.observable("100%"),t.editorWidth=n.ko.observable("100%"),t.pianoKeyboardHeight=n.ko.observable("0px"),t.layoutPanels=function(){if(t.scoreDetailsPanel()){var e=(0,T.calculateRightPanelWidth)(t.scoreDetailsPanel().showScoreDetails(),t.showMixer(),t.showInstruments(),t.showFormatting(),n.NF.IsPhoneLayout()),o=(0,T.calculatePianoHeight)(t.showPianoKeyboard(),n.NF.IsPhoneLayout()),r=(0,T.calculateLowerPanelHeight)(o,t.showEmbedPurchaseButton()),i=(0,T.calculateScoreDetailsPanelBottomPosition)(t.showEmbedPurchaseButton());t.editorWidth("calc(100% - ".concat(e,"px)")),t.editorHeight("calc(100% - ".concat(r,"px")),t.pianoKeyboardHeight("".concat(o,"px")),t.scoreDetailsPanel().scoreDetailsPanelBottomPosition("".concat(i,"px")),t.html5Editor()&&t.html5Editor().resizeToFit()}},t.openCloseMixer=function(e,o){if(e){if(!t.html5Editor().scorePermissions.checkMixerPermissions())return!1;t.closeAllPanels(),t.mixer()||t.mixer(new n.NF.Mixer(t.html5Editor())),o&&t.mixer().changePage(o)}t.showMixer(e)},t.toggleMixer=function(){t.openCloseMixer(!t.showMixer())},t.openCloseInstruments=function(e){t.showInstruments()!=e&&(e&&(t.closeAllPanels(),t.instrumentsPanel()||t.instrumentsPanel(new u.default(t.html5Editor()))),t.showInstruments(e))},t.toggleFormatting=function(){t.openCloseFormatting(!t.showFormatting())},t.openCloseFormatting=function(e,o){t.showFormatting()==e&&t.formattingPanel()&&t.formattingPanel().docLayoutPage()==o||(e&&(t.closeAllPanels(),t.formattingPanel()||t.formattingPanel(new b.default(t.html5Editor())),o&&t.formattingPanel().docLayoutPage(o)),t.showFormatting(e))},t.toggleInstruments=function(){t.openCloseInstruments(!t.showInstruments())},t.openCloseMediaSyncEditor=function(e){t.showMediaSyncEditor()!=e&&(e?(t.closeAllPanels(),t.html5Editor().initializeMediaSyncEditor()):setTimeout(function(){t.html5Editor().createHiddenMediaSyncPlayer()},1e3),t.showMediaSyncEditor(e))},t.checkForNewlyPublishedProduct=function(){t.contentType()!==s.PRODUCT||t.isEditingProduct()||t.currentUserIsAuthor()&&n.NF.hasStorage&&localStorage.getItem("productPublished-".concat(t.contentId()))&&((new g.default).show(),localStorage.removeItem("productPublished-".concat(t.contentId())),t.newlyPublishedProduct(!0))},t.closeAllPanels=function(){t.openCloseMixer(!1),t.openCloseInstruments(!1),t.scoreDetailsPanel().openCloseScoreDetailsPanel(!1),t.openCloseMediaSyncEditor(!1),t.openCloseFormatting(!1)},n.ko.computed(function(){t.scoreDetailsPanel(),t.scoreDetailsPanel()&&t.scoreDetailsPanel().showScoreDetails(),t.showMixer(),t.showInstruments(),t.showPianoKeyboard(),t.layoutPanels(),t.html5EditorReady()&&t.html5Editor().scoreApi.centerCurrentPage()}),t.apiServer=null,t.showPlaybackControls=!0,t.showFullWindow=!0,t.setupEmbed=function(e){t.apiServer=new n.NF.EditorApiServer(t,e),t.showPlaybackControls="true"!=t.viewerParams.hidePlaybackControls,t.showFullWindow="true"!=t.viewerParams.hideFullWindow},t.setupHtml5Editor=function(){n.NF.hasAudio||t.viewer()||(0,y.crawler)()||(0,_.oneTimeAlert)("editor.noHtml5WebAudio"),t.html5Editor(new N.default(t)),t.html5Editor().active.subscribe(function(e){e&&(t.performViewModel=new f.default(t),t.applyMarketplaceProductFooter(),t.html5EditorReady(!0))}),t.demo()&&new d.default("welcome",{loadDemoCallback:t.loadNewScore}).show(),t.viewer()&&t.setupEmbed(!0),n.NF.appViewModel.currentCSSLayout.subscribe(t.layoutPanels)},t.loadNewScore=function(){t.getScoreData(t.html5Editor().loadNewScore)},t.hasMediaSync=function(){return!!t.html5Editor().scoreState.mediaSynced()},t.openScoreDetailsByDefault=function(e){return!e.isViewer&&(e.contentType===s.PRODUCT||e.isNewlyPublishedProduct||!e.canEdit&&!e.isPhoneLayout)||e.isViewer&&e.hasMediaSync},t.initializePanels=function(){var e=t.openScoreDetailsByDefault({isViewer:t.viewer(),contentType:t.contentType(),isNewlyPublishedProduct:t.newlyPublishedProduct(),canEdit:t.contentPolicy().can_edit,isPhoneLayout:n.NF.IsPhoneLayout(),hasMediaSync:t.hasMediaSync()});t.scoreDetailsPanel().openCloseScoreDetailsPanel(e),t.showPianoKeyboard((0,w.isTouchDevice)()&&!t.viewer()&&t.contentPolicy().can_edit),t.contentPolicy().can_edit&&!t.score().template()&&n.NF.flash&&n.NF.flash.lti_launch_params&&n.NF.appViewModel.headerViewModel.showLTIReplaceResultForm(n.NF.flash.lti_launch_params,t.saveScore),t.html5Editor().scoreState.mediaSynced()&&!t.showMediaSyncEditor()&&t.scoreDetailsPanel()&&!t.scoreDetailsPanel().showScoreDetails()&&t.html5Editor().createHiddenMediaSyncPlayer()},t.checkForProductRedirect=function(){t.contentType()===s.SCORE&&null!=t.contentModel().active_product_url&&(0,E.navigate)(t.contentModel().active_product_url)},t.checkForBuyerSignIn=function(){if(t.contentType()===s.PRODUCT&&!t.isEditingProduct()&&n.NF.hasStorage){var e=t.contentId(),o=parseInt(localStorage.getItem("productPurchasing-".concat(e)));if(!isNaN(o)){if(t.currentUserIsAuthor()||!t.isLoggedIn())return void localStorage.removeItem("productPurchasing-".concat(e));t.scoreDetailsPanel().showScorePurchaseModal({skipRR:!0}),t.currentUserIsProductOwner()?r.default.publish(l.BUYER_SIGN_IN_PRODUCT_OWNED):t.currentUserIsPreviewingProduct()&&r.default.publish(l.BUYER_SIGN_IN_PRODUCT_PREVIEW,{currentPurchaseQuantity:o})}localStorage.removeItem("productPurchasing-".concat(e))}},t.checkForPurchaseDialog=function(){t.openPurchasingDialog()&&t.scoreDetailsPanel().showScorePurchaseModal({skipRR:!0})},t.checkForSellingDetails=function(){t.openSellingDialog()&&t.scoreDetailsPanel().publishProductUpdatesSection().showSellScoreModal({showVersioning:!1})},t.onNavigate=function(){(n.NF.appViewModel.headerViewModel.suppressBanner(!0),t.viewerParams=n.NF.currentQueryParams,t.viewer()&&"false"==t.viewerParams.showHeader&&n.NF.appViewModel.showHeader(!1),t.setupHtml5Editor(),t.demo())&&$.ajax({url:"/content_item/demo_score_external_id",dataType:"text"}).done(function(e){e?t.scoreId(e):(0,_.standardAlertDialog)((0,k.resource)("editor.demoScoreIdNotDefined"))})}}n.NF.ScoreEditorModel=B,(0,E.addRoute)("demo","/demo#",B,{demo:!0}),(0,E.addRoute)("editScore","/scores/view/{scoreId}:?scoreTemplateURL::?scoreImportType::?nfDebug:#",B),(0,E.addRoute)("viewLibraryScore","/scores/library/{contentLibraryId}/{scoreId}#",B),(0,E.addRoute)("scoreViewer","/embed/{scoreId}#",B,{viewer:!0}),(0,E.addRoute)("productViewer","/marketplace/embed/{scoreId}/{slug}:?hidePurchaseButton:#",B,{viewer:!0}),(0,E.addRoute)("productPreview","/marketplace/{uuid}/{slug}:?openPurchasingDialog:#",B),(0,E.addRoute)("productEditing","/marketplace/{uuid}/{slug}/edit:?openSellingDialog:#",B)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(49),n=o(8),i=o(0);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contributors=ko.observableArray(o),this.firstContributor=ko.computed(function(){return t.contributors()?(0,r.firstContributor)(t.contributors()):null}),this.allFirstContributors=ko.computed(function(){return t.contributors()?(0,r.allFirstContributors)(t.contributors()).join(", "):null}),this.firstArranger=ko.computed(function(){return t.contributors()?(0,r.firstArranger)(t.contributors()):null}),this.firstComposerType=ko.computed(function(){return t.contributors()?(0,r.firstComposerType)(t.contributors()):null}),this.firstLyricistType=ko.computed(function(){return t.contributors()?(0,r.firstLyricistType)(t.contributors()):null}),this.firstArtistType=ko.computed(function(){return t.contributors()?(0,r.firstArtistType)(t.contributors()):null}),this.firstArrangerType=ko.computed(function(){return t.contributors()?(0,r.firstArrangerType)(t.contributors()):null}),this.composerAndArtist=ko.computed(function(){var e=(0,r.firstContributor)(t.contributors()),o=e?", ":"",n=(0,r.firstArranger)(t.contributors());return n&&(e="".concat(e).concat(o).concat((0,i.resource)("content.arr",n))),e})}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"extractComposers",value:function(){return(0,r.extractComposers)(this.contributors())}},{key:"extractLyricists",value:function(){return(0,r.extractLyricists)(this.contributors())}},{key:"extractArtist",value:function(){return(0,r.extractArtist)(this.contributors())}},{key:"clearContributors",value:function(e){for(var t=this.contributors().length-1;t>=0;t--){var o=!1;e==n.COMPOSER?o=(0,r.isComposer)(this.contributors()[t].role):e==n.LYRICIST&&(o=(0,r.isLyricist)(this.contributors()[t].role)),o&&this.contributors.splice(t,1)}}},{key:"addContributors",value:function(e){for(var t=0;t<e.length;t++)this.contributors.push(e[t])}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(6);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nextEnabled=n.ko.observable(!0),this.advanceButtonText=n.ko.observable((0,r.resource)("action.next")),this.showBackButton=n.ko.observable(!0)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"next",value:function(){return!0}},{key:"back",value:function(){return!0}}]),e}();t.default=a},function(e,t,o){e.exports=o(7)(628)},function(e,t,o){e.exports=o(7)(592)},function(e,t,o){e.exports=o(7)(594)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.workerPath=function(e){return n[e]},t.loadWorkerFile=function(e,t){var o=(0,r.asset)(e),n=new XMLHttpRequest;n.open("GET",o,!0),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t(n.responseText)},n.send()},t.getWorkerBlob=function(e){var t=null;try{t=new Blob([e],{type:"application/javascript"})}catch(o){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new window.BlobBuilder).append(e),t=t.getBlob()}return t},t.createWorkerWithBlob=function(e){return new Worker(URL.createObjectURL(e))};var r=o(16),n={recorderWorker:"js/recorder.js"}},function(e,t,o){"use strict";t.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},i=d(o(85)),a=d(o(147)),s=o(148),l=o(86),c=d(o(151)),u=o(152);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){try{return window.history.state||{}}catch(e){return{}}};t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.default)(u.canUseDOM,"Browser history needs a DOM");var t=window.history,o=(0,u.supportsHistory)(),d=!(0,u.supportsPopStateOnHashChange)(),f=e.forceRefresh,h=void 0!==f&&f,m=e.getUserConfirmation,g=void 0===m?u.getConfirmation:m,b=e.keyLength,v=void 0===b?6:b,y=e.basename?(0,l.stripTrailingSlash)((0,l.addLeadingSlash)(e.basename)):"",_=function(e){var t=e||{},o=t.key,r=t.state,n=window.location,a=n.pathname+n.search+n.hash;return(0,i.default)(!y||(0,l.hasBasename)(a,y),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+a+'" to begin with "'+y+'".'),y&&(a=(0,l.stripBasename)(a,y)),(0,s.createLocation)(a,r,o)},S=function(){return Math.random().toString(36).substr(2,v)},w=(0,c.default)(),k=function(e){n(F,e),F.length=t.length,w.notifyListeners(F.location,F.action)},E=function(e){(0,u.isExtraneousPopstateEvent)(e)||T(_(e.state))},P=function(){T(_(p()))},C=!1,T=function(e){C?(C=!1,k()):w.confirmTransitionTo(e,"POP",g,function(t){t?k({action:"POP",location:e}):R(e)})},R=function(e){var t=F.location,o=M.indexOf(t.key);-1===o&&(o=0);var r=M.indexOf(e.key);-1===r&&(r=0);var n=o-r;n&&(C=!0,N(n))},O=_(p()),M=[O.key],A=function(e){return y+(0,l.createPath)(e)},N=function(e){t.go(e)},I=0,x=function(e){1===(I+=e)?((0,u.addEventListener)(window,"popstate",E),d&&(0,u.addEventListener)(window,"hashchange",P)):0===I&&((0,u.removeEventListener)(window,"popstate",E),d&&(0,u.removeEventListener)(window,"hashchange",P))},D=!1,F={length:t.length,action:"POP",location:O,createHref:A,push:function(e,n){(0,i.default)(!("object"===(void 0===e?"undefined":r(e))&&void 0!==e.state&&void 0!==n),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var a=(0,s.createLocation)(e,n,S(),F.location);w.confirmTransitionTo(a,"PUSH",g,function(e){if(e){var r=A(a),n=a.key,s=a.state;if(o)if(t.pushState({key:n,state:s},null,r),h)window.location.href=r;else{var l=M.indexOf(F.location.key),c=M.slice(0,-1===l?0:l+1);c.push(a.key),M=c,k({action:"PUSH",location:a})}else(0,i.default)(void 0===s,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=r}})},replace:function(e,n){(0,i.default)(!("object"===(void 0===e?"undefined":r(e))&&void 0!==e.state&&void 0!==n),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var a=(0,s.createLocation)(e,n,S(),F.location);w.confirmTransitionTo(a,"REPLACE",g,function(e){if(e){var r=A(a),n=a.key,s=a.state;if(o)if(t.replaceState({key:n,state:s},null,r),h)window.location.replace(r);else{var l=M.indexOf(F.location.key);-1!==l&&(M[l]=a.key),k({action:"REPLACE",location:a})}else(0,i.default)(void 0===s,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(r)}})},go:N,goBack:function(){return N(-1)},goForward:function(){return N(1)},block:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=w.setPrompt(e);return D||(x(1),D=!0),function(){return D&&(D=!1,x(-1)),t()}},listen:function(e){var t=w.appendListener(e);return x(1),function(){x(-1),t()}}};return F}},function(e,t,o){e.exports=o(7)(688)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SET_STEP_STATUS=t.PREVIOUS_STEP=t.NEXT_STEP=t.REMOVE_WIZARD=t.CREATE_WIZARD=void 0;t.CREATE_WIZARD="WIZARD__CREATE_WIZARD";t.REMOVE_WIZARD="WIZARD__REMOVE_WIZARD";t.NEXT_STEP="WIZARD__NEXT_STEP";t.PREVIOUS_STEP="WIZARD__PREVIOUS_STEP";t.SET_STEP_STATUS="WIZARD__SET_STEP_STATUS"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultContentPolicy=function(e){return{id:e,can_comment:!1,can_copy:!1,can_edit:!1,can_export:!1,can_manage:!1,can_print:!1,can_sell:!1,can_share:!1,enable_ash_font:!1,enable_browse_and_search:!1,enable_color:!1,enable_content_injection:!1,enable_developer_features:!1,enable_metronome:!1,enable_midi:!1,enable_mixer:!1,enable_part_display:!1,enable_premium_instruments:!1,enable_prompt:!1,enable_recording:!1,enable_select_font:!1,enable_template_creation:!1,enable_transcriber:!1,enable_user_based_sharing:!1,is_content_library_copy:!1,is_content_library_master:!1,is_from_content_library:!1,is_product_copy:!1,preview:!1,user_role:null}},t.getDemoContentPolicy=function(e){return{id:e,can_comment:!1,can_copy:!1,can_edit:!0,can_export:!1,can_manage:!1,can_print:!1,can_sell:!1,can_share:!1,enable_ash_font:!0,enable_browse_and_search:!0,enable_color:!0,enable_content_injection:!1,enable_developer_features:!1,enable_metronome:!0,enable_midi:!0,enable_mixer:!0,enable_part_display:!0,enable_premium_instruments:!0,enable_prompt:!0,enable_recording:!0,enable_select_font:!0,enable_template_creation:!0,enable_transcriber:!0,enable_user_based_sharing:!1,is_content_library_copy:!1,is_content_library_master:!1,is_from_content_library:!1,is_product_copy:!1,preview:!1,user_role:r.DOCUMENT_ROLE_DEMO}},t.getViewerContentPolicy=function(e){return{id:e,can_comment:!1,can_copy:!1,can_edit:!1,can_export:!1,can_manage:!1,can_print:!0,can_sell:!1,can_share:!0,enable_ash_font:!0,enable_browse_and_search:!0,enable_color:!1,enable_content_injection:!1,enable_developer_features:!1,enable_metronome:!1,enable_midi:!1,enable_mixer:!1,enable_part_display:!1,enable_premium_instruments:!1,enable_prompt:!1,enable_recording:!1,enable_select_font:!1,enable_template_creation:!1,enable_transcriber:!1,enable_user_based_sharing:!1,is_content_library_copy:!1,is_content_library_master:!1,is_from_content_library:!1,is_product_copy:!1,preview:!1,user_role:r.DOCUMENT_ROLE_READER}};var r=o(8)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPhoneVerticalLayoutSelector=t.isPhoneLayoutOrSmallerSelector=t.isPhoneLayoutSelector=t.isMobileLayoutOrLargerSelector=t.isMobileOrSmallerLayoutSelector=t.isMobileLayoutSelector=t.isStandardOrLargerLayoutSelector=t.isStandardLayoutSelector=t.layoutSelector=t.heightSelector=t.widthSelector=void 0;var r=o(12),n=o(19),i=function(e){return e.layout.width};t.widthSelector=i;t.heightSelector=function(e){return e.layout.height};var a=(0,r.createSelector)(i,function(e){return(0,n.calculateLayout)(e)});t.layoutSelector=a;var s=(0,r.createSelector)(a,function(e){return e===n.STANDARD_LAYOUT});t.isStandardLayoutSelector=s;var l=(0,r.createSelector)(a,function(e){return e>=n.STANDARD_LAYOUT});t.isStandardOrLargerLayoutSelector=l;var c=(0,r.createSelector)(a,function(e){return e===n.MOBILE_LAYOUT});t.isMobileLayoutSelector=c;var u=(0,r.createSelector)(a,function(e){return e<=n.MOBILE_LAYOUT});t.isMobileOrSmallerLayoutSelector=u;var d=(0,r.createSelector)(a,function(e){return e>=n.MOBILE_LAYOUT});t.isMobileLayoutOrLargerSelector=d;var p=(0,r.createSelector)(a,function(e){return e===n.PHONE_LAYOUT});t.isPhoneLayoutSelector=p;var f=(0,r.createSelector)(a,function(e){return e<=n.PHONE_LAYOUT});t.isPhoneLayoutOrSmallerSelector=f;var h=(0,r.createSelector)(a,function(e){return e===n.PHONE_VERTICAL_LAYOUT});t.isPhoneVerticalLayoutSelector=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){ko.setTemplateEngine(function(e){return e.makeTemplateSource=function(e){return i[e]||(e.match(/^item:/)?i[e]=new ko.templateSources.ItemTemplate(e):i[e]=new ko.templateSources.AssetTemplate(e)),i[e]},e}(new ko.nativeTemplateEngine))};var r=function(e){return e&&e.__esModule?e:{default:e}}(o(35)),n=o(16);var i={},a={text:function(e){if(0===arguments.length)return this.loaded||this.getTemplate(Noteflight.config.manifest?Noteflight.session.locale():""),this.template();this.template(e)},data:function(e,t){if(1===arguments.length)return this.template.data[e];this.template.data[e]=t}};ko.templateSources.AssetTemplate=function(e){this.templateName=e,this.template=ko.observable(ko.templateSources.AssetTemplate.initialTemplate),this.template.data={},this.loaded=!1,this.inProgress=!1},ko.templateSources.AssetTemplate.initialTemplate="",ko.utils.extend(ko.templateSources.AssetTemplate.prototype,a),ko.utils.extend(ko.templateSources.AssetTemplate.prototype,{getTemplate:function(e){var t=this;if(!t.inProgress){t.inProgress=!0;var o="templates/",r="";e&&(o=o+"locale/"+e+"/",5==e.length?r=e.substring(0,2):2==e.length&&(r=""));var i=this.templateName.replace(/^asset:/,"");(0,n.loadAsset)(o+i+".html",{dataType:"text"}).done(function(e){t.loaded=!0,"development"==NF.environment&&(e="\x3c!-- BEGIN template: "+i+"--\x3e"+e+"\x3c!-- END template: "+i+"--\x3e"),t.template(e)}).fail(function(o,n){404==o.status&&e?(t.inProgress=!1,t.getTemplate(r)):0!==o.status&&t.template('[<a href="'+o.url+'">'+t.templateName+"</a>: "+n+"("+o.status+")]")})}}}),ko.templateSources.ItemTemplate=function(e){this.templateName=e,this.template=ko.observable(ko.templateSources.ItemTemplate.initialTemplate),this.template.data={},this.loaded=!1,this.inProgress=!1},ko.templateSources.ItemTemplate.initialTemplate="",ko.utils.extend(ko.templateSources.ItemTemplate.prototype,a),ko.utils.extend(ko.templateSources.ItemTemplate.prototype,{getTemplate:function(e){var t=this;if(!t.inProgress){t.inProgress=!0;var o=this.templateName.replace(/^item:/,"");r.default.xhrRequest({url:"/content_item/"+encodeURIComponent(o),dataType:"text"}).done(function(e){t.loaded=!0,t.template(e)}).fail(function(e,o){t.template('[<a href="'+e.url+'">'+t.templateName+"</a>: "+o+"("+e.status+")]")})}}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tracker=r.Noteflight.config.googleAnalyticsTracker||"UA-5131908-1",this.initializeGoogleAnalytics()}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"initializeGoogleAnalytics",value:function(){!function(e,t,o,r,n,i,a){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(o),a=t.getElementsByTagName(o)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",a.parentNode.insertBefore(i,a)}(window,document,"script",0,"ga"),ga("create",this.tracker,"auto"),ga("require","ecommerce");var e="Guest";NF.session.current_user()&&(e=NF.session.current_user().has_premium_features()?"Premium":"Basic"),ga("set","dimension1",e)}},{key:"trackEvent",value:function(e,t,o,r){try{ga("send","event",e,t,o,r)}catch(e){}}},{key:"setPage",value:function(e){try{ga("set",{page:e})}catch(e){}}},{key:"addTransaction",value:function(e,t,o){try{ga("ecommerce:addTransaction",{id:e,revenue:t,tax:o})}catch(e){}}},{key:"addItem",value:function(e,t,o,r){try{ga("ecommerce:addItem",{id:e,name:t,price:o,quantity:r})}catch(e){}}},{key:"sendTransaction",value:function(){try{ga("ecommerce:send")}catch(e){}}},{key:"trackEcommerceEvent",value:function(e,t,o,r){this.addTransaction(e,o,r),this.addItem(e,t,o,1),this.sendTransaction()}},{key:"trackOutboundLink",value:function(e,t,o){arguments.length<3&&(o=null);try{ga("send","event",e,t)}catch(e){}o&&setTimeout(function(){document.location.href=o.href},500)}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.interpretRecurlyError=function(e){var t=null;switch(e.code){case"validation":t="number"==e.fields[0]?"errors.recurly.ccNumber":"errors.recurly.validation";break;case"invalid-parameter":"year"==e.fields[0]&&(t="errors.recurly.problemYear")}if(t)return(0,r.resource)(t);var o=e.message;return e.fields&&e.fields.length>0&&(o+=" ("+e.fields.join(", ")+")"),o};var r=o(0)},function(e,t,o){"use strict";function r(e,t,o,r){if(null===e)return null;arguments.length<2&&(t=!0),arguments.length<3&&(o="$"),arguments.length<4&&(r=!0);var n=(e=Number(e)).toFixed(2).split(".");return"0"==n[0]&&"$"==o&&r?n[1]+"":(n[0]=n[0].split("").reverse().join("").replace(/(\d{3})(?=\d)/g,"$1,").split("").reverse().join(""),t?o+n.join("."):o+n[0])}function n(e){var t={symbol:"$",dollars:0,cents:0},o=(e=Number(e)).toFixed(2).split(".");return t.dollars=o[0].split("").reverse().join("").replace(/(\d{3})(?=\d)/g,"$1,").split("").reverse().join(""),t.cents=o[1],t}Object.defineProperty(t,"__esModule",{value:!0}),t.formatCurrency=r,t.valueToCurrencyParts=n,Noteflight.formatCurrency=r,Noteflight.valueToCurrencyParts=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(4)),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(409)),i=o(5),a=u(o(194)),s=u(o(13)),l=o(3),c=u(o(35));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,o){return t&&f(e.prototype,t),o&&f(e,o),e}function m(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v="fc4b0906c4e04f407168397885d93ff5e15143d8b7b79ac1719c62232d4053fb",y="3634078d0d7e8267ff352c02e5b0c86488a32c0dc1c2c622b8ce00276975ffaf",_="https://www.noteflight.com/unsplash/callback",S=function(e){function t(e,o,a){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return p(this,t),(s=m(this,g(t).call(this))).title=ko.observable(e),s._type=o,s._apiCall=a,s._options=l,s._handleSelectedCallback=l.selectedCallback,s.searchText=ko.observable(""),s.images=ko.observableArray([]),s.selectedUrl=ko.observable(),s.downloadUrl=ko.observable(),s._currentPage=1,s._totalPages=1,s.copyingImage=ko.observable(!0),s._aspectRatio=l.aspectRatio||16/9,s.searching=ko.observable(!1),s._moreSearching=!1,s.hasSearched=ko.observable(!1),s._lastTimeout=-1,s.doneButtonEnabled=ko.computed(function(){return s.selectedUrl()&&!s.copyingImage()}),s.unsplash=new n.default({applicationId:v,secret:y,callbackUrl:_}),s._unsplashToken=null,r.default.subscribe(i.STOCK_IMAGE_SELECTED,function(e,t){s._unselectImagesExceptOne(t.fullUrl),s.selectedUrl(t.fullUrl),s.downloadUrl(t.downloadUrl)}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,s.default),h(t,[{key:"_newSearch",value:function(){this.searching()?this._moreSearching=!0:(this.images([]),this._currentPage=1,this.searchText().length<3?this._moreSearching=!1:this._search())}},{key:"_search",value:function(){var e=this;this.copyingImage(!1),this.searching(!0),this.unsplash.search.photos(this.searchText(),this._currentPage,21).then(n.toJson).then(function(t){e.searching(!1),e.hasSearched(!0),e._totalPages=t.total_pages;for(var o=0;o<t.results.length;o++)e.images.push(new w(t.results[o]));e._moreSearching&&(e._moreSearching=!1,e._newSearch())})}},{key:"scrolled",value:function(){if(!(this._currentPage>=this._totalPages||this.searching())){var e=$(".imagePicker .results")[0].scrollHeight,t=$(".imagePicker .results").height();$(".imagePicker .results").scrollTop()<.9*(e-t)||(this._currentPage++,this._search())}}},{key:"_saveImage",value:function(e){r.default.publish(i.STOCK_IMAGE_UPLOADING),NF.apiService[this._apiCall]("",this._handleImageSaved.bind(this),{data:e})}},{key:"select",value:function(){this.cancel(),c.default.xhrRequest({url:this.downloadUrl(),dataType:"text",data:{client_id:v,client_secret:y,redirect_uri:_}}),new a.default(this._saveImage.bind(this),{imageUrl:this.selectedUrl(),aspectRatio:this._aspectRatio}).show()}},{key:"_unselectImagesExceptOne",value:function(e){for(var t=0;t<this.images().length;t++)this.images()[t].isThisMe(e)||this.images()[t].unselect()}},{key:"handleKeyUp",value:function(e,t){13!=t.keyCode&&(clearTimeout(this._lastTimeout),this._lastTimeout=setTimeout(this._newSearch.bind(this),500))}},{key:"doOk",value:function(){return this.selectedUrl()&&this.select(),!1}},{key:"_handleImageSaved",value:function(e){r.default.publish(i.STOCK_IMAGE_UPLOADED,{type:this._type}),this._handleSelectedCallback&&this._handleSelectedCallback(e)}},{key:"show",value:function(){(0,l.createAndShowDialog)({viewModel:this,templateName:"dialogs/imagePicker"})}}]),t}();t.default=S;var w=function(){function e(t){var o=this;p(this,e),this.downloadUrl=ko.observable(t.links.download_location),this.smallUrl=ko.observable(t.urls.small),this.fullUrl=ko.observable(t.urls.full),this.photographer=ko.observable(t.user.name),this.photographerUrl=ko.observable(t.user.links.html),this.attributionHtml=ko.computed(function(){return'<a class="standardLink" href="'.concat(o.photographerUrl(),'?utm_source=noteflight&utm_medium=referral&utm_campaign=api-credit" target="_blank">').concat(o.photographer(),'</a> / <a class="standardLink" href="https://www.unsplash.com?utm_source=noteflight&utm_medium=referral&utm_campaign=api-credit" target="_blank">Unsplash</a>')}),this.selected=ko.observable(!1)}return h(e,[{key:"isThisMe",value:function(e){return e==this.fullUrl()}},{key:"select",value:function(){this.selected(!0),r.default.publish(i.STOCK_IMAGE_SELECTED,{fullUrl:this.fullUrl(),downloadUrl:this.downloadUrl()})}},{key:"unselect",value:function(){this.selected(!1)}}]),e}()},function(e,t,o){e.exports=o(7)(669)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),i=o(28);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,c(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"renderOverlay",value:function(){if(!this.props.overlay)return null;var e=(0,i.cssFriendlify)(this.props.overlay);return r.default.createElement("div",{className:"coverArtOverlay ".concat(e)})}},{key:"renderInsideChildren",value:function(){return"phoneListSize"==this.props.size?null:this.props.children}},{key:"renderOutsideChildren",value:function(){return"phoneListSize"!=this.props.size?null:this.props.children}},{key:"render",value:function(){return r.default.createElement("div",{className:"coverArt ".concat(this.props.size)},r.default.createElement("div",{className:"coverArtImage image",style:{backgroundImage:"url("+this.props.backgroundImageUrl+")"}},this.renderOverlay(),this.renderInsideChildren()," "),this.renderOutsideChildren()," ")}}]),t}();t.default=d,d.propTypes={backgroundImageUrl:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCollection=function(e){return{type:r.GET_COLLECTION.REQUESTED,id:e}},t.getCollections=function(e){return{type:r.GET_COLLECTIONS.REQUESTED,collectionType:e}},t.addToCollection=function(e,t,o){return{type:r.ADD_TO_COLLECTION.REQUESTED,ids:e,collectionId:t,collectionType:o}},t.removeFromCollection=function(e,t,o){return{type:r.REMOVE_FROM_COLLECTION.REQUESTED,ids:e,collectionId:t,collectionType:o}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(65))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setContextMenuState=function(e,t){return{type:r.SET_CONTEXT_MENU_STATE,id:e,state:t}},t.closeAllContextMenus=function(){return{type:r.CLOSE_ALL_CONTEXT_MENUS}},t.changeCommunity=function(e,t){return{type:r.CHANGE_COMMUNITY.REQUESTED,hostname:e,destination:t}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(68))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSectionPosition=function(e){if(!i[e])return-1;return i[e].position},t.isSectionSearchable=function(e){if(!i[e])return!1;return!!i[e].searchable},t.isRangeEnabled=function(e){if(!i[e])return!1;return!!i[e].range},t.isSectionValid=a,t.getSectionInfo=function(e){return i[e]},t.invalidElement=s,t.validFilterElement=function(e,t,o){return!s(t)&&0!==o&&a(e)&&(!i[e].invalidKeys||!i[e].invalidKeys.includes(t))},t.instrumentFilterName=l,t.openingKeyFilterName=c,t.trueFalseFilterName=u,t.getFilterElementName=function(e,t){if(i[t].nameGeneration)return i[t].nameGeneration(e,t);return(0,r.resource)("".concat((0,n.camelCase)(t),".").concat(e))},t.getElementsSortOptions=function(e){if(i[e])return i[e].sortOptions;return null},t.MAX_ELEMENTS_PER_SECTION=void 0;var r=o(0),n=o(28);t.MAX_ELEMENTS_PER_SECTION=5;var i={instrument_names:{position:0,searchable:!0,clipAt:15,nameGeneration:l},genre:{position:1},format:{position:2},key_signatures:{position:3,nameGeneration:c},duration:{position:4,range:!0},ensemble_size_id:{position:5,sortOptions:{sortByName:!0}},difficulty_level:{position:6,invalidKeys:[0]},sellable_arrangements:{position:7,nameGeneration:u}};function a(e){return!!i[e]}function s(e){return void 0===e||null===e||""===e.toString().trim()}function l(e){if(!e)return"";var t="genericInstrument.".concat(e);return(0,r.hasResource)(t)?(0,r.resource)(t):(0,r.resource)("instruments.name.".concat((0,n.getStringForResourcesKey)(e)))}function c(e){if(!e)return"";var t=e.split("/")[0],o=t,n=t.split(".");2==n.length&&(o=n[0]+"."+n[1]);var i=e.split("/")[1].toLowerCase();return(0,r.resource)("note."+o)+" "+(0,r.resource)("mode."+i)}function u(e,t){var o=e;return"true"!=e&&"false"!=e&&(o=e?"true":"false"),(0,r.resource)("".concat((0,n.camelCase)(t),".").concat(o))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=s(o(18)),i=s(o(431)),a=o(0);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"renderOptions",value:function(){return this.props.options.map(function(e){var t=(0,a.hasResource)(e.label)?(0,a.resource)(e.label):e.label;return r.default.createElement("option",{key:e.value,value:e.value},t)})}},{key:"render",value:function(){var e=this.props.value?this.props.value:"";return r.default.createElement(i.default,{label:this.props.label,subLabel:this.props.subLabel},r.default.createElement("div",{className:"select"},r.default.createElement("select",{name:this.props.name,value:e,onChange:this.props.changeHandler,disabled:this.props.notActive},this.renderOptions())))}}]),t}();t.default=f,f.propTypes={label:n.default.string,subLabel:n.default.string,name:n.default.string.isRequired,value:n.default.oneOfType([n.default.string,n.default.number]),changeHandler:n.default.func.isRequired,options:n.default.arrayOf(n.default.shape({value:n.default.oneOfType([n.default.string,n.default.number]),label:n.default.string})),notActive:n.default.bool}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterSection=t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(6),i=o(5),a=o(2),s=o(0),l=o(15),c=o(28),u=o(121);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,o){return t&&p(e.prototype,t),o&&p(e,o),e}var h=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this.title=ko.observable((0,s.resource)(o.title||"content.filter")),this.titleColor=ko.observable(o.titleColor||"black"),this.titleCallback=o.titleCallback?o.titleCallback:function(){},this.callback=o.callback,this.scoresPath=o.scoresPath||n.NF.paths.publicSearch,this.sections=ko.observableArray([]),this.selection={},o.listenToUpdatedAggregations&&r.default.subscribe(i.FILTER_UPDATE_AGGREGATIONS,function(e,o){t.populateFilterSelectionFromUrl(o.searchParams),t.populateFilter(o.aggregations)})}return f(e,[{key:"updateUrl",value:function(e,t){var o="";e&&(o="keyword:"+e);var r=this.filterParamsForUrl;r.length>0&&(o&&(o+="&"),o+=r),0===o.length?t&&t():(0,a.navigate)(this.scoresPath({searchQuery:o}))}},{key:"updateSelectedElements",value:function(){this.selection={};for(var e=0;e<this.sections().length;e++){var t=this.sections()[e].name();this.selection[t]||(this.selection[t]=[]),this.selection[t]=this.sections()[e].nameOfSelectedElements()}this.callback&&this.callback({selection:this.selection,sections:this.sections()})}},{key:"populateFilterSelectionFromUrl",value:function(e){for(var t in this.selection={},e)if((0,u.isSectionValid)(t)){this.selection[t]=[];for(var o=0;o<e[t].length;o++){var r=e[t][o];this.selection[t].push(r)}}}},{key:"populateFilter",value:function(e){if(e){for(var t in this.sections([]),e){var o=(0,u.getSectionInfo)(t);if(o){var r=new m(t,o.position,{clipAt:o.clipAt,searchable:o.searchable});this.sections.push(r);for(var n=0;n<e[t].length;n++){var i=e[t][n];if((0,u.validFilterElement)(t,i.key,i.doc_count)){var a=new g(t,this.updateSelectedElements.bind(this)),s=(i.key_as_string||i.key).toString();a.name(s),a.total(i.doc_count),this.selection[t]&&-1!=this.selection[t].indexOf(s)&&a.selected(!0),r.addElement(a)}}r.sortElements(o.sortOptions),r.isEmpty()&&this.sections.splice(-1)}}this.sections.sort(function(e,t){return e.position()<t.position()?-1:1})}}},{key:"clear",value:function(){this.sections([])}},{key:"_showDefaultInfoCallback",value:function(e){this.populateFilter(e.aggregations)}},{key:"_showDefaultInfo",value:function(){n.NF.apiService.searchScores("",this._showDefaultInfoCallback.bind(this),{term:null})}},{key:"_showDefaultProducts",value:function(){n.NF.apiService.searchProducts("",this._showDefaultInfoCallback.bind(this),{term:null})}},{key:"initialize",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).searchProducts?this._showDefaultProducts():this._showDefaultInfo()}},{key:"filterParams",get:function(){var e=[];for(var t in this.selection)for(var o=0;o<this.selection[t].length;o++)if(!(0,u.isRangeEnabled)(t)){var r={};r[t]=this.selection[t][o],e.push(r)}return{filters:e}}},{key:"rangeParams",get:function(){var e=[];for(var t in this.selection)for(var o=0;o<this.selection[t].length;o++)if((0,u.isRangeEnabled)(t)){var r={};r[t]=this.selection[t][o],e.push(r)}return{ranges:e}}},{key:"filterParamsForUrl",get:function(){for(var e="",t=0,o=0;o<this.sections().length;o++)for(var r=this.sections()[o],n=0;n<r.selectedElements.length;n++)t>0&&(e+="&"),e+=r.name()+":"+encodeURIComponent(r.selectedElements[n].name()),t++;return e}},{key:"selectedElements",get:function(){for(var e=[],t=0;t<this.sections().length;t++){var o=this.sections()[t];e=e.concat(o.selectedElements)}return e}},{key:"noFiltersApplied",get:function(){return 0===this.selectedElements.length}}]),e}();t.default=h;var m=function(){function e(t,o,r){var n=this;d(this,e),this.name=ko.observable(t),this.position=ko.observable(o),this.searchable=ko.observable(r.searchable||!1),this.showSearch=ko.observable(!1),this.facetSearchText=ko.observable(),this.facetSearchText.subscribe(function(e){n.elementsToShow([]);for(var t=(0,c.getStringToCompare)(e),o=0;o<n.elements().length;o++){var r=n.elements()[o];(0,c.getStringToCompare)(r.nameToShow()).includes(t)&&n.elementsToShow.push(r)}n.sortElements()}),this.clipAt=ko.observable(r.clipAt||-1),this.nameToShow=ko.computed(function(){return(0,s.resource)("filter."+(0,c.camelCase)(n.name()))}),this.elements=ko.observableArray([]),this.elementsToShow=ko.observableArray([]),this.exceedsStd=ko.computed(function(){return n.elementsToShow().length>u.MAX_ELEMENTS_PER_SECTION}),this.collapsed=ko.observable(!0),this.showMoreOrLessText=ko.computed(function(){return n.collapsed()?(0,s.resource)("search.showMore"):(0,s.resource)("search.showLess")}),this.isEmpty=ko.computed(function(){return 0===n.elements().length}),this.nameOfSelectedElements=ko.computed(function(){for(var e=[],t=0;t<n.elements().length;t++)n.elements()[t].selected()&&e.push(n.elements()[t].name());return e})}return f(e,[{key:"handleSearchClick",value:function(){this.toggleShowSearch()}},{key:"handleSearchForMore",value:function(){this.showSearch(!0)}},{key:"handleClearSearch",value:function(){this.clearSearch()}},{key:"clearSearch",value:function(){this.facetSearchText("")}},{key:"toggleShowSearch",value:function(){this.showSearch(!this.showSearch())}},{key:"toggleCollapsed",value:function(){this.collapsed(!this.collapsed())}},{key:"addElement",value:function(e){this.elements.push(e),this.elementsToShow.push(e)}},{key:"sortElements",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sortByName?this.elementsToShow.sort(function(e,t){return e.name()<t.name()?-1:1}):this.elementsToShow.sort(function(e,t){return e.total()==t.total()?e.selected()!=t.selected()?t.selected()?1:-1:e.nameToShow()<t.nameToShow()?-1:1:t.total()-e.total()})}},{key:"selectedElements",get:function(){for(var e=[],t=0;t<this.elements().length;t++)this.elements()[t].selected()&&e.push(this.elements()[t]);return e}}]),e}();t.FilterSection=m;var g=function(){function e(t,o){var r=this;d(this,e),this.sectionName=t,this.callback=o,this.total=ko.observable(),this.selected=ko.observable(!1),this.name=ko.observable(),this.nameToShow=ko.computed(function(){return(0,u.getFilterElementName)(r.name(),r.sectionName)}),this.nameToShowWithTotal=ko.computed(function(){return r.formatName(r.nameToShow())})}return f(e,[{key:"formatName",value:function(e){return this.total()?'<label class="elementName marginRight5">'.concat(e,'</label> <label class="elementNumber">(').concat((0,l.formatCommas)(this.total()),")</label>"):""}},{key:"select",value:function(){this.selected(!0),this.callback&&this.callback()}},{key:"unselect",value:function(){this.selected(!1),this.callback&&this.callback(this)}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(4)),n=o(5),i=s(o(470)),a=o(28);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){var o=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable(i.id),this.scoreId=ko.observable(i.scoreId),this.size=ko.observable(i.size),this.needsImageRefresh=ko.observable(!1),this.imageUploader=ko.observable(),this.directUrl=ko.observable(t),this.overlayClassName=ko.observable((0,a.cssFriendlify)(i.overlay)),this.url=ko.computed(function(){return o._createImageUploader(o.directUrl()),o.directUrl()}),this.backgroundImageUrl=ko.computed(function(){return"url('".concat(o.url(),"')")}),r.default.subscribe(n.STOCK_IMAGE_COVER_ART_SELECTED,function(e,t){o.directUrl(t.cover_art_url)}),r.default.subscribe(n.SCORE_IMAGE_GENERATED,function(e,t){o.directUrl(t.cover_art_url)}),r.default.subscribe(n.SCORE_SAVED,function(e,t){r.default.publish(n.SCORE_COVER_ART_REGENERATED)})}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"_createImageUploader",value:function(e){var t={imageId:this.id,imageUrl:ko.observable(e)};this.imageUploader(new i.default(t))}},{key:"clone",value:function(){return new e(this.directUrl(),{scoreId:this.scoreId()})}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=m(o(4)),n=o(6),i=o(5),a=m(o(42)),s=m(o(13)),l=m(o(61)),c=o(2),u=o(0),d=o(14),p=o(17),f=o(31),h=o(3);function m(e){return e&&e.__esModule?e:{default:e}}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=v(this,y(t).call(this))).initializeObservables(),e.initializeConnectedProperties(),e.initializeComputeds(),e.initializeSubscribers(),e.options=o,e.callback=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,s.default),function(e,t,o){t&&b(e.prototype,t),o&&b(e,o)}(t,[{key:"initializeObservables",value:function(){var e=this;this.reporter=new a.default({}),this.username=n.ko.observable(""),this.password=n.ko.observable(""),this.email=n.ko.observable(""),this.code=n.ko.observable(""),this.requiresCode=n.ko.observable(null),this.codeSelect=n.ko.observable(!1),this.showForgotPassword=n.ko.observable(!1),this.outdatedPassword=n.ko.observable(!1),this.emailSent=n.ko.observable(!1),this.isManagedCommunity=n.ko.observable(n.NF.session.community().managed()),this.isSsoCommunity=n.ko.observable(n.NF.session.community().sso_allowed()),this.googleClassroomCommunity=n.ko.observable(n.NF.session.community().is_google_classroom()),this.dialogWidthClass=n.ko.computed(function(){return e.googleClassroomCommunity()||e.isManagedCommunity()||e.showForgotPassword()?"":"prettyWide"})}},{key:"initializeConnectedProperties",value:function(){this.contentId=n.ko.observable(),(0,d.connect)(p.productIdSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.loginEnabled=n.ko.computed(function(){return e.username().length>0}),this.forgotEnabled=n.ko.computed(function(){return e.email().length>0&&!e.emailSent()}),this.canShowForgotPassword=n.ko.computed(function(){return!e.isSsoCommunity()})}},{key:"initializeSubscribers",value:function(){var e=this;this.username.subscribe(function(){e.requiresCode(null)}),this.password.subscribe(function(){e.requiresCode(null)})}},{key:"login",value:function(){var e=this;r.default.publish(i.REPORTER_CLEAR_ERRORS),this._needsTwoFactorCheck()?n.NF.apiService.checkTwoFactor((0,u.resource)("session.loggingIn"),function(t){e.requiresCode(t.code_required),e._twoFactorOk()?e._doLogin():e.codeSelect(!0)},{signon:this.username(),password:this.password()},{}):this._doLogin()}},{key:"_doLogin",value:function(){var e=this,t={signon:this.username(),password:this.password(),code:this.code()};this.options.getPurchaseHistory&&(t.product_uuid=this.contentId()),n.NF.apiService.loginUser({text:(0,u.resource)("session.loggingIn"),fullScreen:!0,withBackground:!0,doNotShowDefaultError:!0},function(t){return e._handleDoLoginSuccess(t)},t,{fail:function(t){t.code&&"passwordAlgorithmUnsupported"===t.code?(e.outdatedPassword(!0),e.toggleForgotPassword()):e.reporter.addError(t)}})}},{key:"_handleDoLoginSuccess",value:function(e){r.default.publish(i.REPORTER_REMOVE,{fullScreen:!0}),n.NF.analytics.trackEvent("webapp","login_r3"),n.NF.currentQueryParams.requested_uri?(0,c.navigate)(n.NF.currentQueryParams.requested_uri):this.callback?(this.callback(e),this.options.closeDialog&&this.cancel()):n.NF.reloadWindow()}},{key:"doOk",value:function(){return this.login(),!1}},{key:"doCancel",value:function(){return this.showForgotPassword(!1),!0}},{key:"_needsTwoFactorCheck",value:function(){return null==this.requiresCode()}},{key:"_twoFactorOk",value:function(){return!1===this.requiresCode()||!0===this.requiresCode()&&this.code().length>0}},{key:"_referringHostname",value:function(){var e=window.location.hostname;return window.location.port.length>0&&(e=e+":"+window.location.port),e}},{key:"loginWithFacebook",value:function(){(0,f.verifyCookiesEnabled)()&&(0,c.navigate)("/auth/facebook/?return_to="+window.location+"&referringHostname="+this._referringHostname())}},{key:"loginWithGoogle",value:function(){(0,f.verifyCookiesEnabled)()&&(0,c.navigate)(l.default.getAuthLink({referringHostname:this._referringHostname(),returnTo:window.location}))}},{key:"handleKeyUp",value:function(e,t){if(void 0!==t.keyCode)switch(t.keyCode.toString()){case"13":this.showForgotPassword()?this.forgotPassword():this.login();break;case"27":this.cancel();break;default:r.default.publish(i.REPORTER_CLEAR_ERRORS)}return!0}},{key:"showSignUpDialog",value:function(){this.cancel(),Noteflight.appViewModel.showSignupForm()}},{key:"toggleForgotPassword",value:function(){r.default.publish(i.REPORTER_CLEAR_ERRORS),this.showForgotPassword(!this.showForgotPassword())}},{key:"forgotPassword",value:function(){var e=this;n.NF.isValidEmail(this.email())?n.NF.apiService.resetPassword({text:(0,u.resource)("session.requestingPassword"),fullScreen:!0,withBackground:!0,doNotShowDefaultError:!0},function(){r.default.publish(i.REPORTER_CLEAR_ERRORS),e.emailSent(!0)},{email:this.email()},{fail:function(t){e.reporter.addError(t)}}):this.reporter.addError({code:"invalidEmail",message:(0,u.resource)("errors.invalidEmail")})}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.callback=e,(0,h.createAndShowDialog)({viewModel:this,templateName:"dialogs/login"})}}]),t}();t.default=S},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={pending:0,in_progress:1,complete:2,failed:3},i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateCallbacks=[],this.completeCallbacks=[],this.errorCallbacks=[],this.delay=0,this.endpoint=null,this.status="pending",this.jobId=null,this.workDone=!1}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"pollJobs",value:function(){var e=this.jobId?{job_id:this.jobId}:{};this.endpoint("",this.handleResponse.bind(this),e)}},{key:"handleResponse",value:function(e){var t=this,o=e.job?[e.job]:e.jobs;if(!o.reduce(function(e,t){return e||"failed"==t.status},!1)||(this.errorCallbacks.forEach(function(e){return e(o)}),!this.jobId)){this.updateCallbacks.forEach(function(e){return e(o)});var r=!0;for(var i in o)if(n[o[i].status]<2){r=!1,this.workDone=!0;break}if(r)return this.completeCallbacks.forEach(function(e){return e(o,t.workDone)}),this.delay=0,this.jobId=null,void(this.workDone=!1);this.delay=Math.min(this.delay+1,8),setTimeout(this.pollJobs.bind(this),1e3*Math.pow(2,this.delay))}}},{key:"onUpdate",value:function(e){return this.updateCallbacks.push(e),this}},{key:"onComplete",value:function(e){return this.completeCallbacks.push(e),this}},{key:"onError",value:function(e){return this.errorCallbacks.push(e),this}},{key:"startPolling",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.jobId=e,this.endpoint=null===e?NF.apiService.pollJobs:NF.apiService.pollJob,this.pollJobs(),this}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=f(o(101)),n=f(o(128)),i=f(o(124)),a=f(o(279)),s=o(49),l=o(254),c=o(2),u=o(36),d=o(15),p=o(0);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=p.resource,this.song=t.song,this.contributorsList=new r.default(t.contributors),this.audioPreviewUrl=ko.observable(t.audio_preview_url),this.author=ko.observable(t.author?new Noteflight.User(t.author):null),this.averageRating=ko.observable(t.average_rating),this.coverArt=ko.observable(new i.default(t.cover_art_url,{size:"medium",overlay:t.cover_art_directive})),this.coverArtViewModel=ko.observable({coverArt:this.coverArt,size:ko.observable(this.coverArt().size()),editable:ko.observable(!1)}),this.created=ko.observable(t.created),this.currency=ko.observable(t.currency),this.description=ko.observable(t.description),this.favoritesCount=ko.observable(t.favorites_count),this.format=ko.observable(t.metadata?t.metadata.format:null),this.hasAudioPreview=ko.observable(t.has_audio_preview),this.hasCustomAudioMedia=ko.observable(t.has_custom_audio_media),this.id=ko.observable(t.uuid),this.instrumentNames=ko.observable(t.metadata?t.metadata.instrument_names:null),this.marketplaceUrl=ko.observable(t.marketplace_url),this.previewUrl=ko.observable(t.preview_url),this.previewType=ko.observable(t.preview_type),this.authorizedName=ko.observable(t.authorized_name),this.ensembleSizeMax=ko.observable(t.ensemble_size_max),this.ensembleSizeName=ko.observable(t.ensemble_size_name),this.minimumInitialPurchaseAmount=ko.observable(t.minimum_initial_purchase_amount),this.purchasedQuantity=ko.observable(t.purchased_quantity),this.official=ko.observable(t.official),this.price=ko.observable(t.price),this.reviewsCount=ko.observable(t.reviews_count),this.scoreUrl=ko.observable(t.score_url),this.sellerId=ko.observable(t.seller_id),this.status=ko.observable(t.status),this.slug=ko.observable(t.slug),this.title=ko.observable(t.title),this.type=ko.observable(t.type),this.updated=ko.observable(t.updated),this.uuid=ko.observable(t.uuid),this.viewsCount=ko.observable(t.views_count),this.archived=ko.observable(!1),this.collections=ko.observableArray(),this.priceToShow=ko.observable((0,d.formatPriceInCents)(t.price,{currency:t.currency,showDouble0ForCents:!0})),this.stars=ko.observable(new n.default({stars:t.average_rating,size:"small"})),this.audioPreview=new a.default({url:this.audioPreviewUrl(),hasCustomAudioMedia:this.hasCustomAudioMedia()}),this.createComputeds(),(0,u.initializeTippy)(u.originalBadgeHint)}return function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(e,[{key:"createComputeds",value:function(){var e=this;this.viewsCountAdjusted=ko.computed(function(){return e.viewsCount()?(0,d.abbreviateNumber)(e.viewsCount()):""}),this.favesCountAdjusted=ko.computed(function(){return e.favoritesCount()?(0,d.abbreviateNumber)(e.favoritesCount()):""}),this.hasRatings=ko.computed(function(){return e.averageRating()>0}),this.firstContributor=ko.computed(function(){return(0,s.firstContributor)(e.contributorsList.contributors())}),this.firstArranger=ko.computed(function(){return(0,s.firstArranger)(e.contributorsList.contributors())}),this.formatString=ko.computed(function(){return(0,l.createFormatString)(e.format(),e.instrumentNames())})}},{key:"goToProduct",value:function(){(0,c.navigate)(this.marketplaceUrl())}}]),e}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;!function(e){e&&e.__esModule}(o(4));var r=o(15);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this._counter=0,this.id=(0,r.generateUUID)(),this.total=ko.observable(t.stars||0),this._lastTotalSelected=this.total(),this._editable=ko.observable(t.editable||!1),this.size=ko.observable(t.size||"normal"),this.selected=ko.observableArray(),this.half=ko.observableArray(),this.empty=ko.observableArray(),this._starClickCallback=this._starClickCallback.bind(this),this._starHoverCallback=this._starHoverCallback.bind(this),this._starOutCallback=this._starOutCallback.bind(this),this._callbacks={clickCallback:this._starClickCallback,hoverCallback:this._starHoverCallback,outCallback:this._starOutCallback},this._initialize()}return a(e,[{key:"_starHoverCallback",value:function(e){this.total()!=e.starId+1&&this._setDisplayTotal(e.starId+1)}},{key:"_starClickCallback",value:function(e){this.setTotalSelected(e.starId+1),this._lastTotalSelected=this.total()}},{key:"_starOutCallback",value:function(e){this._setDisplayTotal(this._lastTotalSelected)}},{key:"_checkIfOut",value:function(){var e=this;$(".stars.big")[0].matches(":hover")?setTimeout(function(){e._checkIfOut()},20):this._setDisplayTotal(this._lastTotalSelected)}},{key:"hover",value:function(){this._editable()&&this._checkIfOut()}},{key:"_calculateSelected",value:function(){this.selected([]);for(var e=Math.floor(this.total()),t=0;t<e;t++)this.selected.push(new l(this._counter,this.id,Object.assign({},{editable:this._editable()},this._callbacks))),this._counter++}},{key:"_calculateHalf",value:function(){this.half([]),this.total()-this.selected().length>=.5&&(this.half.push(new l(this._counter,this.id,Object.assign({},{editable:this._editable()},this._callbacks))),this._counter++)}},{key:"_calculateEmpty",value:function(){this.empty([]);var e=5-this.selected().length;this.half().length>0&&e--;for(var t=0;t<e;t++)this.empty.push(new l(this._counter,this.id,Object.assign({},{editable:this._editable()},this._callbacks))),this._counter++}},{key:"setTotalSelected",value:function(e){this.total(e),this._lastTotalSelected=e,this._updateCounters()}},{key:"_setDisplayTotal",value:function(e){this.total(e),this._updateCounters()}},{key:"_updateCounters",value:function(){this._counter=0,this._calculateSelected(),this._calculateHalf(),this._calculateEmpty()}},{key:"_initialize",value:function(){this._updateCounters(),this._setDisplayTotal(this._lastTotalSelected)}}]),e}();t.default=s;var l=function(){function e(t,o,r){var i=this;n(this,e),this.id=ko.observable(t),this._parentId=o,this.isEditable=ko.observable(r.editable),this._isHovered=ko.observable(!1),this._clickCallback=r.clickCallback,this._hoverCallback=r.hoverCallback,this._outCallback=r.outCallback,this.isHighlighted=ko.computed(function(){return i.isEditable()&&i._isHovered()})}return a(e,[{key:"click",value:function(){this.isEditable()&&this._clickCallback({starId:this.id()})}},{key:"hover",value:function(){this._isHovered(!0),this.isEditable()&&this._hoverCallback({starId:this.id()})}},{key:"out",value:function(){this._isHovered(!1),this.isEditable()&&this._outCallback({starId:this.id()})}}]),e}()},function(e,t,o){(function(r){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=Object({NODE_ENV:"production"}).DEBUG),e}(t=e.exports=o(567)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+t.humanize(this.diff),!o)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++n)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}).call(this,o(208))},function(e,t){t.encode=function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t.length&&(t+="&"),t+=encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t},t.decode=function(e){for(var t={},o=e.split("&"),r=0,n=o.length;r<n;r++){var i=o[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t){e.exports=function(e,t){var o=function(){};o.prototype=t.prototype,e.prototype=new o,e.prototype.constructor=e}},function(e,t,o){(function(r){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=Object({NODE_ENV:"production"}).DEBUG),e}(t=e.exports=o(582)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+t.humanize(this.diff),!o)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++n)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}).call(this,o(208))},function(e,t,o){e.exports=o(7)(104)},function(e,t,o){e.exports=o(7)(406)},function(e,t,o){e.exports=o(7)(330)},function(e,t,o){e.exports=o(7)(597)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(o){return!!e.data(o,t)}}):function(t,o,r){return!!e.data(t,r[3])}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.focusable=function(t,o){var r,n,i,a,s,l=t.nodeName.toLowerCase();return"area"===l?(n=(r=t.parentNode).name,!(!t.href||!n||"map"!==r.nodeName.toLowerCase())&&(i=e("img[usemap='#"+n+"']")).length>0&&i.is(":visible")):(/^(input|select|textarea|button|object)$/.test(l)?(a=!t.disabled)&&(s=e(t).closest("fieldset")[0])&&(a=!s.disabled):a="a"===l&&t.href||o,a&&e(t).is(":visible")&&function(e){for(var t=e.css("visibility");"inherit"===t;)e=e.parent(),t=e.css("visibility");return"hidden"!==t}(e(t)))},e.extend(e.expr[":"],{focusable:function(t){return e.ui.focusable(t,null!=e.attr(t,"tabindex"))}}),e.ui.focusable})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.escapeSelector=function(){var e=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(t){return t.replace(e,"\\$1")}}()})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.fn.scrollParent=function(t){var o=this.css("position"),r="absolute"===o,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,i=this.parents().filter(function(){var t=e(this);return(!r||"static"!==t.css("position"))&&n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==o&&i.length?i:e(this[0].ownerDocument||document)}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(50),o(137),o(228),o(63),o(229),o(140),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){(this.helper||this.element).is(".ui-draggable-dragging")?this.destroyOnClear=!0:(this._removeHandleClassName(),this._mouseDestroy())},_mouseCapture:function(t){var o=this.options;return!(this.helper||o.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blurActiveElement(t),this._blockFrames(!0===o.iframeFix?"iframe":o.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var o=e.ui.safeActiveElement(this.document[0]);e(t.target).closest(o).length||e.ui.safeBlur(o)},_mouseStart:function(t){var o=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,o){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!o){var r=this._uiHash();if(!1===this._trigger("drag",t,r))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var o=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==o._trigger("stop",t)&&o._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var o=this.options,r=e.isFunction(o.helper),n=r?e(o.helper.apply(this.element[0],[t])):"clone"===o.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===o.appendTo?this.element[0].parentNode:o.appendTo),r&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),o=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==o&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,o,r,n=this.options,i=this.document[0];this.relativeContainer=null,n.containment?"window"!==n.containment?"document"!==n.containment?n.containment.constructor!==Array?("parent"===n.containment&&(n.containment=this.helper[0].parentNode),(r=(o=e(n.containment))[0])&&(t=/(scroll|auto)/.test(o.css("overflow")),this.containment=[(parseInt(o.css("borderLeftWidth"),10)||0)+(parseInt(o.css("paddingLeft"),10)||0),(parseInt(o.css("borderTopWidth"),10)||0)+(parseInt(o.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(o.css("borderRightWidth"),10)||0)-(parseInt(o.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(o.css("borderBottomWidth"),10)||0)-(parseInt(o.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=o)):this.containment=n.containment:this.containment=[0,0,e(i).width()-this.helperProportions.width-this.margins.left,(e(i).height()||i.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||i.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t||(t=this.position);var o="absolute"===e?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*o+this.offset.parent.top*o-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*o,left:t.left+this.offset.relative.left*o+this.offset.parent.left*o-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*o}},_generatePosition:function(e,t){var o,r,n,i,a=this.options,s=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return s&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),o=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):o=this.containment,e.pageX-this.offset.click.left<o[0]&&(l=o[0]+this.offset.click.left),e.pageY-this.offset.click.top<o[1]&&(c=o[1]+this.offset.click.top),e.pageX-this.offset.click.left>o[2]&&(l=o[2]+this.offset.click.left),e.pageY-this.offset.click.top>o[3]&&(c=o[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,c=o?n-this.offset.click.top>=o[1]||n-this.offset.click.top>o[3]?n:n-this.offset.click.top>=o[1]?n-a.grid[1]:n+a.grid[1]:n,i=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=o?i-this.offset.click.left>=o[0]||i-this.offset.click.left>o[2]?i:i-this.offset.click.left>=o[0]?i-a.grid[0]:i+a.grid[0]:i),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,o,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[o,r,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,o,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,o,r){var n=e.extend({},o,{item:r.element});r.sortables=[],e(r.options.connectToSortable).each(function(){var o=e(this).sortable("instance");o&&!o.options.disabled&&(r.sortables.push(o),o.refreshPositions(),o._trigger("activate",t,n))})},stop:function(t,o,r){var n=e.extend({},o,{item:r.element});r.cancelHelperRemoval=!1,e.each(r.sortables,function(){this.isOver?(this.isOver=0,r.cancelHelperRemoval=!0,this.cancelHelperRemoval=!1,this._storedCSS={position:this.placeholder.css("position"),top:this.placeholder.css("top"),left:this.placeholder.css("left")},this._mouseStop(t),this.options.helper=this.options._helper):(this.cancelHelperRemoval=!0,this._trigger("deactivate",t,n))})},drag:function(t,o,r){e.each(r.sortables,function(){var n=!1,i=this;i.positionAbs=r.positionAbs,i.helperProportions=r.helperProportions,i.offset.click=r.offset.click,i._intersectsWith(i.containerCache)&&(n=!0,e.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==i&&this._intersectsWith(this.containerCache)&&e.contains(i.element[0],this.element[0])&&(n=!1),n})),n?(i.isOver||(i.isOver=1,r._parent=o.helper.parent(),i.currentItem=o.helper.appendTo(i.element).data("ui-sortable-item",!0),i.options._helper=i.options.helper,i.options.helper=function(){return o.helper[0]},t.target=i.currentItem[0],i._mouseCapture(t,!0),i._mouseStart(t,!0,!0),i.offset.click.top=r.offset.click.top,i.offset.click.left=r.offset.click.left,i.offset.parent.left-=r.offset.parent.left-i.offset.parent.left,i.offset.parent.top-=r.offset.parent.top-i.offset.parent.top,r._trigger("toSortable",t),r.dropped=i.element,e.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,i.fromOutside=r),i.currentItem&&(i._mouseDrag(t),o.position=i.position)):i.isOver&&(i.isOver=0,i.cancelHelperRemoval=!0,i.options._revert=i.options.revert,i.options.revert=!1,i._trigger("out",t,i._uiHash(i)),i._mouseStop(t,!0),i.options.revert=i.options._revert,i.options.helper=i.options._helper,i.placeholder&&i.placeholder.remove(),o.helper.appendTo(r._parent),r._refreshOffsets(t),o.position=r._generatePosition(t,!0),r._trigger("fromSortable",t),r.dropped=!1,e.each(r.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,o,r){var n=e("body"),i=r.options;n.css("cursor")&&(i._cursor=n.css("cursor")),n.css("cursor",i.cursor)},stop:function(t,o,r){var n=r.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,o,r){var n=e(o.helper),i=r.options;n.css("opacity")&&(i._opacity=n.css("opacity")),n.css("opacity",i.opacity)},stop:function(t,o,r){var n=r.options;n._opacity&&e(o.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,o){o.scrollParentNotHidden||(o.scrollParentNotHidden=o.helper.scrollParent(!1)),o.scrollParentNotHidden[0]!==o.document[0]&&"HTML"!==o.scrollParentNotHidden[0].tagName&&(o.overflowOffset=o.scrollParentNotHidden.offset())},drag:function(t,o,r){var n=r.options,i=!1,a=r.scrollParentNotHidden[0],s=r.document[0];a!==s&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(r.overflowOffset.top+a.offsetHeight-t.pageY<n.scrollSensitivity?a.scrollTop=i=a.scrollTop+n.scrollSpeed:t.pageY-r.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=i=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(r.overflowOffset.left+a.offsetWidth-t.pageX<n.scrollSensitivity?a.scrollLeft=i=a.scrollLeft+n.scrollSpeed:t.pageX-r.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=i=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(s).scrollTop()<n.scrollSensitivity?i=e(s).scrollTop(e(s).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(s).scrollTop())<n.scrollSensitivity&&(i=e(s).scrollTop(e(s).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(s).scrollLeft()<n.scrollSensitivity?i=e(s).scrollLeft(e(s).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(s).scrollLeft())<n.scrollSensitivity&&(i=e(s).scrollLeft(e(s).scrollLeft()+n.scrollSpeed)))),!1!==i&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,o,r){var n=r.options;r.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),o=t.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:o.top,left:o.left})})},drag:function(t,o,r){var n,i,a,s,l,c,u,d,p,f,h=r.options,m=h.snapTolerance,g=o.offset.left,b=g+r.helperProportions.width,v=o.offset.top,y=v+r.helperProportions.height;for(p=r.snapElements.length-1;p>=0;p--)c=(l=r.snapElements[p].left-r.margins.left)+r.snapElements[p].width,d=(u=r.snapElements[p].top-r.margins.top)+r.snapElements[p].height,b<l-m||g>c+m||y<u-m||v>d+m||!e.contains(r.snapElements[p].item.ownerDocument,r.snapElements[p].item)?(r.snapElements[p].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[p].item})),r.snapElements[p].snapping=!1):("inner"!==h.snapMode&&(n=Math.abs(u-y)<=m,i=Math.abs(d-v)<=m,a=Math.abs(l-b)<=m,s=Math.abs(c-g)<=m,n&&(o.position.top=r._convertPositionTo("relative",{top:u-r.helperProportions.height,left:0}).top),i&&(o.position.top=r._convertPositionTo("relative",{top:d,left:0}).top),a&&(o.position.left=r._convertPositionTo("relative",{top:0,left:l-r.helperProportions.width}).left),s&&(o.position.left=r._convertPositionTo("relative",{top:0,left:c}).left)),f=n||i||a||s,"outer"!==h.snapMode&&(n=Math.abs(u-v)<=m,i=Math.abs(d-y)<=m,a=Math.abs(l-g)<=m,s=Math.abs(c-b)<=m,n&&(o.position.top=r._convertPositionTo("relative",{top:u,left:0}).top),i&&(o.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top),a&&(o.position.left=r._convertPositionTo("relative",{top:0,left:l}).left),s&&(o.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left)),!r.snapElements[p].snapping&&(n||i||a||s||f)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[p].item})),r.snapElements[p].snapping=n||i||a||s||f)}}),e.ui.plugin.add("draggable","stack",{start:function(t,o,r){var n,i=r.options,a=e.makeArray(e(i.stack)).sort(function(t,o){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(o).css("zIndex"),10)||0)});a.length&&(n=parseInt(e(a[0]).css("zIndex"),10)||0,e(a).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+a.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,o,r){var n=e(o.helper),i=r.options;n.css("zIndex")&&(i._zIndex=n.css("zIndex")),n.css("zIndex",i.zIndex)},stop:function(t,o,r){var n=r.options;n._zIndex&&e(o.helper).css("zIndex",n._zIndex)}}),e.ui.draggable})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(351),o(352),o(45),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var e,t=this._super()||{};return this.isInput=this.element.is("input"),null!=(e=this.element[0].disabled)&&(t.disabled=e),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(t.label=this.originalLabel),t},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(t){t.keyCode===e.ui.keyCode.SPACE&&(t.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(t,o){var r="iconPosition"!==t,n=r?this.options.iconPosition:o,i="top"===n||"bottom"===n;this.icon?r&&this._removeClass(this.icon,null,this.options.icon):(this.icon=e("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),r&&this._addClass(this.icon,null,o),this._attachIcon(n),i?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(e){this.icon[/^(?:end|bottom)/.test(e)?"before":"after"](this.iconSpace)},_attachIcon:function(e){this.element[/^(?:end|bottom)/.test(e)?"append":"prepend"](this.icon)},_setOptions:function(e){var t=void 0===e.showLabel?this.options.showLabel:e.showLabel,o=void 0===e.icon?this.options.icon:e.icon;t||o||(e.showLabel=!0),this._super(e)},_setOption:function(e,t){"icon"===e&&(t?this._updateIcon(e,t):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===e&&this._updateIcon(e,t),"showLabel"===e&&(this._toggleClass("ui-button-icon-only",null,!t),this._updateTooltip()),"label"===e&&(this.isInput?this.element.val(t):(this.element.html(t),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(e,t),"disabled"===e&&(this._toggleClass(null,"ui-state-disabled",t),this.element[0].disabled=t,t&&this.element.blur())},refresh:function(){var e=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOptions({disabled:e}),this._updateTooltip()}}),!1!==e.uiBackCompat&&(e.widget("ui.button",e.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(e,t){"text"!==e?("showLabel"===e&&(this.options.text=t),"icon"===e&&(this.options.icons.primary=t),"icons"===e&&(t.primary?(this._super("icon",t.primary),this._super("iconPosition","beginning")):t.secondary&&(this._super("icon",t.secondary),this._super("iconPosition","end"))),this._superApply(arguments)):this._super("showLabel",t)}}),e.fn.button=function(t){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?t.apply(this,arguments):(e.ui.checkboxradio||e.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(e.fn.button),e.fn.buttonset=function(){return e.ui.controlgroup||e.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),e.ui.button})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e,n;function i(e){return e.replace(/<[^>]*>?/gi,c)}"object"===r(t)?(e=t,n=o(144).Converter):(e=window.Markdown,n=e.Converter),e.getSanitizingConverter=function(){var e=new n;return e.hooks.chain("postConversion",i),e.hooks.chain("postConversion",u),e};var a=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,s=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,l=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i;function c(e){return e.match(a)||e.match(s)||e.match(l)?e:""}function u(e){if(""==e)return"";var t,o,r=/<\/?\w+[^>]*(\s|$|>)/g,n=e.toLowerCase().match(r),i=(n||[]).length;if(0==i)return e;for(var a,s=[],l=[],c=!1,u=0;u<i;u++)if(t=n[u].replace(/<\/?(\w+).*/,"$1"),!(s[u]||"<p><img><br><li><hr>".search("<"+t+">")>-1)){if(o=n[u],a=-1,!/^<\//.test(o))for(var d=u+1;d<i;d++)if(!s[d]&&n[d]=="</"+t+">"){a=d;break}-1==a?c=l[u]=!0:s[a]=!0}if(!c)return e;u=0;return e=e.replace(r,function(e){var t=l[u]?"":e;return u++,t})}}()},function(e,t,o){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n;n="object"===r(t)?t:{},function(){function e(e){return e}function t(e){return!1}function o(){}function r(){}o.prototype={chain:function(t,o){var r=this[t];if(!r)throw new Error("unknown hook "+t);this[t]=r===e?o:function(e){return o(r(e))}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(t){this[t]=e},addFalse:function(e){this[e]=t}},n.HookCollection=o,r.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},n.Converter=function(){var e,t,n,i,a=this.hooks=new o;function s(e){return e=(e=(e=(e=(e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l)).replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l)).replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l)).replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,l)).replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l)}function l(e,t){var o=t;return o=(o=o.replace(/^\n+/,"")).replace(/\n+$/g,""),o="\n\n~K"+(n.push(o)-1)+"K\n\n"}function c(e,t){return e=function(e,t){for(var o=(e=(e=e.replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{1,}/g),r=[],i=/~K(\d+)K/,a=o.length,s=0;s<a;s++){var l=o[s];i.test(l)?r.push(l):/\S/.test(l)&&(l=(l=u(l)).replace(/^([ \t]*)/g,"<p>"),l+="</p>",r.push(l))}if(!t){a=r.length;for(var s=0;s<a;s++)for(var c=!0;c;)c=!1,r[s]=r[s].replace(/~K(\d+)K/g,function(e,t){return c=!0,n[t]})}return r.join("\n\n")}(e=s(e=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var o=t;return function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"}("<blockquote>\n"+(o=(o=(o=c(o=(o=(o=o.replace(/^[ \t]*>[ \t]?/gm,"~0")).replace(/~0/g,"")).replace(/^[ \t]+$/gm,""))).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var o=t;return o=(o=o.replace(/^  /gm,"~0")).replace(/~0/g,"")}))+"\n</blockquote>")})}(e=function(e){return e=(e=(e+="~0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,o){var r=t,n=o;return"\n\n"+(r="<pre><code>"+(r=(r=(r=_(r=b(y(r)))).replace(/^\n+/g,"")).replace(/\n+$/g,""))+"\n</code></pre>")+"\n\n"+n})).replace(/~0/,"")}(e=h(e=(e=(e=(e=function(e){return e=(e=(e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+u(t)+"</h1>\n\n"})).replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+u(t)+"</h2>\n\n"})).replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,o){var r=t.length;return"<h"+r+">"+u(o)+"</h"+r+">\n\n"})}(e)).replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n")).replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,"<hr />\n")).replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n"))))),t)}function u(e){return e=(e=function(e){return e=(e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4")).replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}(e=v(e=(e=function(e){return e=(e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4")).replace(/<((https?|ftp):[^'">\s]+)>/gi,function(e,t){return'<a href="'+t+'">'+a.plainLinkText(t)+"</a>"})}(e=function(e){return e=(e=(e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,d)).replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,d)).replace(/(\[([^\[\]]+)\])()()()()()/g,d)}(e=function(e){return e=(e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f)).replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f)}(e=function(e){return e=(e=e.replace(/\\(\\)/g,k)).replace(/\\([`*_{}\[\]()>#+-.!])/g,k)}(e=function(e){return e=e.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=w(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}(e=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,o,r,n){var i=r;return t+"<code>"+(i=(i=b(i=(i=i.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""))).replace(/:\/\//g,"~P"))+"</code>"})}(e))))))).replace(/~P/g,"://")))).replace(/  +\n/g," <br>\n")}function d(o,r,n,i,a,s,l,c){void 0==c&&(c="");var u=r,d=n.replace(/:\/\//g,"~P"),f=i.toLowerCase(),h=a,m=c;if(""==h)if(""==f&&(f=d.toLowerCase().replace(/ ?\n/g," ")),h="#"+f,void 0!=e.get(f))h=e.get(f),void 0!=t.get(f)&&(m=t.get(f));else{if(!(u.search(/\(\s*\)$/m)>-1))return u;h=""}var g='<a href="'+(h=w(h=function(e){if(!e)return"";var t=e.length;return e.replace(S,function(o,r){return"~D"==o?"%24":":"!=o||r!=t-1&&!/[0-9\/]/.test(e.charAt(r+1))?"%"+o.charCodeAt(0).toString(16):":"})}(h),"*_"))+'"';return""!=m&&(g+=' title="'+(m=w(m=p(m),"*_"))+'"'),g+=">"+d+"</a>"}function p(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function f(o,r,n,i,a,s,l,c){var u=r,d=n,f=i.toLowerCase(),h=a,m=c;if(m||(m=""),""==h){if(""==f&&(f=d.toLowerCase().replace(/ ?\n/g," ")),h="#"+f,void 0==e.get(f))return u;h=e.get(f),void 0!=t.get(f)&&(m=t.get(f))}d=w(p(d),"*_[]()");var g='<img src="'+(h=w(h,"*_"))+'" alt="'+d+'"';return g+=' title="'+(m=w(m=p(m),"*_"))+'"',g+=" />"}function h(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return i?e=e.replace(t,function(e,t,o){var r=t,n=o.search(/[*+-]/g)>-1?"ul":"ol",i=g(r,n);return i="<"+n+">"+(i=i.replace(/\s+$/,""))+"</"+n+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,o,r){var n=t,i=o,a=r.search(/[*+-]/g)>-1?"ul":"ol",s=g(i,a);return s=n+"<"+a+">\n"+s+"</"+a+">\n"})),e=e.replace(/~0/,"")}a.addNoop("plainLinkText"),a.addNoop("preConversion"),a.addNoop("postConversion"),this.makeHtml=function(o){if(e)throw new Error("Recursive call to converter.makeHtml");return e=new r,t=new r,n=[],i=0,o=(o=(o=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var o=parseInt(t);return String.fromCharCode(o)})}(o=c(o=function(o){return o=o.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(o,r,n,i,a,s){return r=r.toLowerCase(),e.set(r,v(n)),a?i:(s&&t.set(r,s.replace(/"/g,"&quot;")),"")})}(o=s(o=(o=_(o="\n\n"+(o=(o=(o=(o=(o=a.preConversion(o)).replace(/~/g,"~T")).replace(/\$/g,"~D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n"))+"\n\n")).replace(/^[ \t]+$/gm,"")))))).replace(/~D/g,"$$")).replace(/~T/g,"~"),o=a.postConversion(o),n=t=e=null,o};var m={ol:"\\d+[.]",ul:"[*+-]"};function g(e,t){i++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var o=m[t],r=new RegExp("(^[ \\t]*)("+o+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+o+")[ \\t]+))","gm"),n=!1;return e=(e=e.replace(r,function(e,t,o,r){var i=r,a=/\n\n$/.test(i);return i=a||i.search(/\n{2,}/)>-1||n?c(y(i),!0):u(i=(i=h(y(i))).replace(/\n$/,"")),n=a,"<li>"+i+"</li>\n"})).replace(/~0/g,""),i--,e}function b(e){return e=w(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),"*_{}[]\\",!1)}function v(e){return e=(e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function y(e){return e=(e=e.replace(/^(\t|[ ]{1,4})/gm,"~0")).replace(/~0/g,"")}function _(e){if(!/\t/.test(e))return e;var t,o=["    ","   ","  "," "],r=0;return e.replace(/[\n\t]/g,function(e,n){return"\n"===e?(r=n+1,e):(t=(n-r)%4,r=n+1,o[t])})}var S=/(?:["'*()[\]:]|~D)/g;function w(e,t,o){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";o&&(r="\\\\"+r);var n=new RegExp(r,"g");return e=e.replace(n,k)}function k(e,t){return"~E"+t.charCodeAt(0)+"E"}}}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowDimensions=function(e,t){return{type:r.UPDATE_WINDOW_DIMENSIONS,width:e,height:t}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(83))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureStore=t.history=void 0;var r=o(40),n=c(o(107)),i=o(51),a=c(o(108)),s=c(o(153)),l=c(o(167));function c(e){return e&&e.__esModule?e:{default:e}}var u=(0,n.default)();t.history=u;t.configureStore=function(e){var t=[],o=[],n=(0,a.default)();t.push(n);var c=(0,i.routerMiddleware)(u);t.push(c),o.push(r.applyMiddleware.apply(void 0,t));var d=r.compose.apply(void 0,o),p=(0,r.createStore)(s.default,e,d);return n.run(l.default),p}},function(e,t,o){e.exports=o(7)(120)},function(e,t,o){"use strict";t.__esModule=!0,t.locationsAreEqual=t.createLocation=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},n=s(o(149)),i=s(o(150)),a=o(86);function s(e){return e&&e.__esModule?e:{default:e}}t.createLocation=function(e,t,o,i){var s=void 0;"string"==typeof e?(s=(0,a.parsePath)(e)).state=t:(void 0===(s=r({},e)).pathname&&(s.pathname=""),s.search?"?"!==s.search.charAt(0)&&(s.search="?"+s.search):s.search="",s.hash?"#"!==s.hash.charAt(0)&&(s.hash="#"+s.hash):s.hash="",void 0!==t&&void 0===s.state&&(s.state=t));try{s.pathname=decodeURI(s.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+s.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return o&&(s.key=o),i?s.pathname?"/"!==s.pathname.charAt(0)&&(s.pathname=(0,n.default)(s.pathname,i.pathname)):s.pathname=i.pathname:s.pathname||(s.pathname="/"),s},t.locationsAreEqual=function(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash&&e.key===t.key&&(0,i.default)(e.state,t.state)}},function(e,t,o){e.exports=o(7)(385)},function(e,t,o){e.exports=o(7)(386)},function(e,t,o){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(85));t.default=function(){var e=null,t=[];return{setPrompt:function(t){return(0,r.default)(null==e,"A history supports only one prompt at a time"),e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,o,n,i){if(null!=e){var a="function"==typeof e?e(t,o):e;"string"==typeof a?"function"==typeof n?n(a,i):((0,r.default)(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),i(!0)):i(!1!==a)}else i(!0)},appendListener:function(e){var o=!0,r=function(){o&&e.apply(void 0,arguments)};return t.push(r),function(){o=!1,t=t.filter(function(e){return e!==r})}},notifyListeners:function(){for(var e=arguments.length,o=Array(e),r=0;r<e;r++)o[r]=arguments[r];t.forEach(function(e){return e.apply(void 0,o)})}}}},function(e,t,o){"use strict";t.__esModule=!0;t.canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement),t.addEventListener=function(e,t,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent("on"+t,o)},t.removeEventListener=function(e,t,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent("on"+t,o)},t.getConfirmation=function(e,t){return t(window.confirm(e))},t.supportsHistory=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},t.supportsPopStateOnHashChange=function(){return-1===window.navigator.userAgent.indexOf("Trident")},t.supportsGoWithoutReloadUsingHash=function(){return-1===window.navigator.userAgent.indexOf("Firefox")},t.isExtraneousPopstateEvent=function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(40),n=o(51),i=b(o(154)),a=b(o(155)),s=b(o(156)),l=b(o(157)),c=b(o(158)),u=b(o(159)),d=b(o(160)),p=b(o(161)),f=b(o(162)),h=b(o(163)),m=b(o(166)),g=b(o(71));function b(e){return e&&e.__esModule?e:{default:e}}var v=(0,r.combineReducers)({account:i.default,collection:a.default,communityPage:s.default,editor:l.default,generic:c.default,layout:u.default,marketplace:d.default,models:p.default,router:n.routerReducer,session:f.default,sharing:h.default,songCatalog:m.default,wizards:g.default});t.default=v},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e,t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=i)switch(i.type){case r.UPDATE_PROFILE.REQUESTED:return Object.assign({},o,{updating:!0});case r.UPDATE_PROFILE.SUCCEEDED:return Object.assign({},o,{updating:!1});case r.RETRIEVE_SELLER_ACCOUNT.SUCCEEDED:return Object.assign({},o,{hasSellerAccount:!!i.sellerAccount,sellerVerificationRequired:i.sellerAccount&&i.sellerAccount.verification_requested,sellerVerificationNeeded:i.sellerAccount&&i.sellerAccount.verification_needed,sellerVerificationComplete:i.sellerAccount&&i.sellerAccount.verification_requested&&!i.sellerAccount.verification_needed&&"pending"!==i.sellerAccount.legal_entity.verification.status});case r.RETRIEVE_SELLER_PAYOUT_DESTINATION.SUCCEEDED:return e=i.sellerPayoutDestination,t=i.payoutStatus,Object.assign({},o,{marketplaceInfoRetrieved:!0,marketplacePayoutInfoComplete:t&&0===t.error_codes.length&&e.last4.length>0});case r.RETRIEVE_SELLER_PAYOUT_DESTINATION.FAILED:return Object.assign({},o,{marketplaceInfoRetrieved:!0});case r.PAYMENT_INFO.SUCCEEDED:return Object.assign({},o,{paymentInfoRetrieved:!0,subscriptions:i.paymentInfo.subscriptions,credits:i.paymentInfo.credits,quotes:i.paymentInfo.quotes,invoices:i.paymentInfo.invoices,accountInfo:i.paymentInfo.account_info,summary:i.paymentInfo.summary,coupons:i.paymentInfo.coupons});case r.SITE_OWNER_EMAIL.SUCCEEDED:return Object.assign({},o,{siteOwnerEmail:i.siteOwnerEmail});case r.RETRIEVE_AUTHORIZED_APPS.SUCCEEDED:return Object.assign({},o,{authorizedApps:i.authorizedApps});case r.RETRIEVE_AUTHORIZED_APPS.FAILED:return Object.assign({},o,{});case r.REMOVE_AUTHORIZED_APP.SUCCEEDED:return Object.assign({},o,{authorizedApps:i.authorizedApps});case r.REMOVE_AUTHORIZED_APP.FAILED:return Object.assign({},o,{})}return o},t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(64));var n={updating:!1,hasSellerAccount:!1,sellerVerificationRequired:!1,sellerVerificationNeeded:!1,sellerVerificationComplete:!1,paymentInfoRetrieved:!1,marketplaceInfoRetrieved:!1,marketplacePayoutInfoComplete:!1,subscriptions:null,credits:null,quotes:null,invoices:null,accountInfo:null,summary:null,coupons:null,siteOwnerEmail:null,authorizedApps:null};t.defaultState=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e,t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=null;switch(i.type){case r.GET_COLLECTION.REQUESTED:return Object.assign({},o,{loading:!0});case r.GET_COLLECTION.SUCCEEDED:return(a=Object.assign({},o.collectionsById))[i.collection.id]=i.collection,Object.assign({},o,{collectionsById:a,loading:!1,currentCollectionId:i.collection.id});case r.GET_COLLECTION.FAILED:return Object.assign({},o,{collection:null,loading:!1});case r.GET_COLLECTIONS.SUCCEEDED:e=[],t={};for(var s=0;s<i.collection.length;s++){var l=i.collection[s];t[l.id]=l,e.push(l.id)}return Object.assign({},o,{collectionsById:t,currentUserCollectionsIds:e});case r.ADD_TO_COLLECTION.SUCCEEDED:case r.REMOVE_FROM_COLLECTION.SUCCEEDED:return(a=Object.assign({},o.collectionsById))[i.collection.id]=i.collection,Object.assign({},o,{collectionsById:a})}return o},t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(65));var n={loading:!0,relatedScores:[],collectionsById:{},currentCollectionId:null,currentUserCollectionsIds:[]};t.defaultState=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultState=i,t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==t){if(r.LIST_FAVORITES.isTypeFor(t.type))return Object.assign({},e,{favoritesList:(0,n.default)(r.LIST_FAVORITES,e.favoritesList,t)});if(r.LIST_SCORES.isTypeFor(t.type))return Object.assign({},e,{scoresList:(0,n.default)(r.LIST_SCORES,e.scoresList,t)});if(r.LIST_USER_GROUPS.isTypeFor(t.type))return Object.assign({},e,{userGroupsList:(0,n.default)(r.LIST_USER_GROUPS,e.userGroupsList,t)});if(r.LIST_GROUPS.isTypeFor(t.type))return Object.assign({},e,{groupsList:(0,n.default)(r.LIST_GROUPS,e.groupsList,t)})}return e};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(66)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(87));function i(){return{favoritesList:(0,n.default)(),scoresList:(0,n.default)(),userGroupsList:(0,n.default)(),groupsList:(0,n.default)()}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==t)switch(t.type){case r.LOAD_CONTENT.SUCCEEDED:return Object.assign({},e,{contentId:t.contentId,contentType:t.contentType,contentFullUrl:t.contentFullUrl,contentSlug:t.contentSlug,isEditingProduct:t.isEditingProduct});case r.EDITOR_READY:return Object.assign({},e,{ready:!0});case n.FOLLOW_USER.REQUESTED:case n.UNFOLLOW_USER.REQUESTED:return Object.assign({},e,{followBusy:!0});case n.FOLLOW_USER.SUCCEEDED:case n.UNFOLLOW_USER.SUCCEEDED:case n.FOLLOW_USER.FAILED:case n.UNFOLLOW_USER.FAILED:return Object.assign({},e,{followBusy:!1});case n.LOAD_FOLLOWERS_COUNT.SUCCEEDED:return Object.assign({},e,{followersCount:t.followersCount})}return e},t.defaultState=void 0;var r=i(o(56)),n=i(o(67));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var a={contentId:null,contentType:null,contentFullUrl:null,contentSlug:null,isEditingProduct:!1,ready:!1,followBusy:!1,followersCount:0};t.defaultState=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.SET_CONTEXT_MENU_STATE:return Object.assign({},e,{contextMenusById:Object.assign({},e.contextMenusById,function(e,t,o){t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o;return e}({},t.id,t.state))});case r.CLOSE_ALL_CONTEXT_MENUS:return Object.assign({},e,{contextMenusById:{}});case r.CHANGE_COMMUNITY.SUCCEEDED:return Object.assign({},e,{communityChangeUrl:t.communityChangeUrl})}return e};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(68));var n={contextMenusById:{},communityChangeUrl:null}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.UPDATE_WINDOW_DIMENSIONS:return Object.assign({},e,{width:t.width,height:t.height})}return e};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(83));var n={width:window.innerWidth,height:window.innerHeight}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e,t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(i.type){case r.GET_TABS.SUCCEEDED:return e=i.tabs,t=e.length>0?e[0].id:0,Object.assign({},o,{tabs:e,currentTabId:t});case r.GET_CAROUSEL.SUCCEEDED:return Object.assign({},o,{carouselCollections:i.carouselCollections});case r.GET_RECOMMENDED.SUCCEEDED:return Object.assign({},o,{recommendedTitle:i.title,recommendedIds:i.ids});case r.SET_CURRENT_TAB:return Object.assign({},o,{currentTabId:i.id});case r.SEARCH.REQUESTED:return Object.assign({},o,{loading:!0});case r.SEARCH.SUCCEEDED:return Object.assign({},o,{products:o.products.concat(i.products),aggregations:i.aggregations,loading:!1,startIndex:i.shown,count:i.count});case r.RESET_SEARCH.REQUESTED:return Object.assign({},o,{loading:!0});case r.RESET_SEARCH.SUCCEEDED:return Object.assign({},o,{products:i.products,aggregations:i.aggregations,loading:!1,startIndex:i.shown,count:i.count});case r.SET_SEARCH_QUERY:return Object.assign({},o,{query:i.query});case r.SET_SEARCH_TERM:return Object.assign({},o,{searchTerm:i.searchTerm});case r.SET_SEARCH_FILTERS:return Object.assign({},o,{searchFilters:i.searchFilters});case r.PLAY_PRODUCT_PREVIEW:return Object.assign({},o,{productPlayingUuid:i.productUuid});case r.STOP_PRODUCT_PREVIEW:return Object.assign({},o,{productPlayingUuid:null,currentPreview:null});case r.GET_PRODUCT_PREVIEW.SUCCEEDED:return Object.assign({},o,{productPlayingUuid:i.productUuid,currentPreview:i.preview})}return o},t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(52));var n={tabs:[],currentTabId:1,carouselCollections:[],products:[],loading:!1,query:"",searchTerm:null,searchFilters:[],startIndex:0,count:0,aggregations:{},relatedScores:[],loadingRelatedScores:!1,productPlayingUuid:null,currentPreview:null,recommendedTitle:"",recommendedIds:[]};t.defaultState=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultState=s,t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.LOAD_MODELS.SUCCEEDED:return Object.assign({},e,a({},t.modelsType,(0,i.addMapElementsById)(e[t.modelsType],t.models,!0)));case r.UPDATE_MODELS.SUCCEEDED:return Object.assign({},e,a({},t.modelsType,(0,i.updateMapElementsById)(e[t.modelsType],t.models)));case r.REMOVE_MODELS.SUCCEEDED:return Object.assign({},e,a({},t.modelsType,(0,i.removeMapElementsById)(e[t.modelsType],t.modelIds)))}return e};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(30)),n=o(8),i=o(88);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(){for(var e={},t=0;t<n.storeModelTypes.length;t++){e[n.storeModelTypes[t]]={}}return e}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=t)switch(t.type){case r.LOAD_SESSION.SUCCEEDED:return Object.assign({},e,{communityId:t.communityId,communityMemberId:t.communityMemberId,userId:t.userId,environment:t.environment})}return e},t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(89));var n={communityId:null,communityMemberId:null,userId:null,environment:null};t.defaultState=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=t){if(i.SEARCH_GROUPS.isTypeFor(t.type))return Object.assign({},e,{groupList:(0,s.default)(i.SEARCH_GROUPS,e.groupList,t)});if(i.SEARCH_USERS.isTypeFor(t.type))return Object.assign({},e,{userList:(0,s.default)(i.SEARCH_USERS,e.userList,t)});if(i.SEARCH_SONGS.isTypeFor(t.type))return Object.assign({},e,{songList:(0,s.default)(i.SEARCH_SONGS,e.songList,t)});switch(t.type){case i.UPDATE_SCORE_SHARING.SUCCEEDED:return d();case i.ADD_SONG:return function(e,t){return Object.assign({},e,{selectedSongIds:(0,r.default)(u(e.selectedSongIds).concat([t.songId]))})}(e,t);case i.REMOVE_SONG:return function(e,t){return Object.assign({},e,{selectedSongIds:(0,n.default)(u(e.selectedSongIds),t.songId)})}(e,t);case i.ADD_BLACKBOX_SONG:return function(e,t){var o=u(e.blackboxSongs);return o.push(t.blackboxSong),Object.assign({},e,{blackboxSongs:o})}(e,t);case i.REMOVE_BLACKBOX_SONG:return function(e,t){var o=u(e.blackboxSongs);return o.splice(t.index,1),Object.assign({},e,{blackboxSongs:o})}(e,t);case i.ADD_GROUP_SHARE:return function(e,t){var o=(0,r.default)(u(e.sharedGroupIds).concat([t.id])),n=Object.assign({},e.sharedGroupPermissionsById,c({},t.id,t.permissions));return Object.assign({},e,{sharedGroupIds:o,sharedGroupPermissionsById:n})}(e,t);case i.REMOVE_GROUP_SHARE:return function(e,t){var o=(0,n.default)(e.sharedGroupIds,t.id),r=Object.assign({},e.sharedGroupPermissionsById);return delete r[t.id],Object.assign({},e,{sharedGroupIds:o,sharedGroupPermissionsById:r})}(e,t);case i.UPDATE_GROUP_SHARE:return function(e,t){var o=Object.assign({},e.sharedGroupPermissionsById,c({},t.id,t.permissions));return Object.assign({},e,{sharedGroupPermissionsById:o})}(e,t);case i.ADD_USER_SHARE:return function(e,t){var o=(0,r.default)(u(e.sharedUserIds).concat([t.id])),n=Object.assign({},e.sharedUserPermissionsById,c({},t.id,t.permissions));return Object.assign({},e,{sharedUserIds:o,sharedUserPermissionsById:n})}(e,t);case i.REMOVE_USER_SHARE:return function(e,t){var o=(0,n.default)(e.sharedUserIds,t.id),r=Object.assign({},e.sharedUserPermissionsById);return delete r[t.id],Object.assign({},e,{sharedUserIds:o,sharedUserPermissionsById:r})}(e,t);case i.UPDATE_USER_SHARE:return function(e,t){var o=Object.assign({},e.sharedUserPermissionsById,c({},t.id,t.permissions));return Object.assign({},e,{sharedUserPermissionsById:o})}(e,t);case i.UPDATE_SHARING_PROPERTIES:return function(e,t){return Object.assign({},e,t.properties)}(e,t)}}return e},t.getDefaultState=void 0;var r=l(o(164)),n=l(o(165)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(69)),a=o(8),s=l(o(87));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d=function(){return{groupList:(0,s.default)(),userList:(0,s.default)(),songList:(0,s.default)(),everyoneRole:null,sharedGroupIds:[],sharedGroupPermissionsById:{},sharedUserIds:[],sharedUserPermissionsById:{},searchable:!1,template:!1,copyable:!1,authorship:a.ORIGINAL_AUTHORSHIP,selectedSongIds:[],blackboxSongs:[],isSharedByDefault:!1,loaded:!1}};t.getDefaultState=d},function(e,t,o){e.exports=o(7)(620)},function(e,t,o){e.exports=o(7)(621)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(t.type){case r.SONG_SEARCH.REQUESTED:return Object.assign({},e,{title:t.title,contributors:t.contributors});case r.SONG_SEARCH.SUCCEEDED:if(t.title==e.title&&t.contributors==e.contributors)return Object.assign({},e,{songsFoundIds:t.ids})}return e},t.defaultState=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(70));var n={songsFoundIds:[],title:null,contributors:null};t.defaultState=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=h;var r=o(23),n=p(o(168)),i=p(o(172)),a=p(o(176)),s=p(o(178)),l=p(o(180)),c=p(o(182)),u=p(o(184)),d=p(o(185));function p(e){return e&&e.__esModule?e:{default:e}}var f=regeneratorRuntime.mark(h);function h(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.all)([(0,c.default)(),(0,n.default)(),(0,i.default)(),(0,s.default)(),(0,l.default)(),(0,a.default)(),(0,d.default)(),(0,u.default)()]);case 2:case"end":return e.stop()}},f,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=o(23),n=s(o(67)),i=s(o(30)),a=s(o(169));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var l=regeneratorRuntime.mark(p),c=regeneratorRuntime.mark(f),u=regeneratorRuntime.mark(h),d=regeneratorRuntime.mark(m);function p(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(a.followUser,e.userId);case 3:return t.next=5,h(e);case 5:return t.next=7,(0,r.put)({type:i.UPDATE_MODELS.SUCCEEDED,modelsType:"users",models:[{id:e.userId,following:!0}]});case 7:return t.next=9,(0,r.put)({type:n.FOLLOW_USER.SUCCEEDED,userId:e.userId});case 9:t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,(0,r.put)({type:n.FOLLOW_USER.FAILED,message:t.t0.message});case 15:case"end":return t.stop()}},l,this,[[0,11]])}function f(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(a.unfollowUser,e.userId);case 3:return t.next=5,h(e);case 5:return t.next=7,(0,r.put)({type:i.UPDATE_MODELS.SUCCEEDED,modelsType:"users",models:[{id:e.userId,following:!1}]});case 7:return t.next=9,(0,r.put)({type:n.UNFOLLOW_USER.SUCCEEDED,userId:e.userId});case 9:t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(0),t.next=15,(0,r.put)({type:n.UNFOLLOW_USER.FAILED,message:t.t0.message});case 15:case"end":return t.stop()}},c,this,[[0,11]])}function h(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.loadFollowersCount,e.userId);case 3:return t=o.sent,o.next=6,(0,r.put)({type:n.LOAD_FOLLOWERS_COUNT.SUCCEEDED,followersCount:t.followersCount});case 6:o.next=12;break;case 8:return o.prev=8,o.t0=o.catch(0),o.next=12,(0,r.put)({type:n.LOAD_FOLLOWERS_COUNT.FAILED,message:o.t0.message});case 12:case"end":return o.stop()}},u,this,[[0,8]])}function m(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(n.FOLLOW_USER.REQUESTED,p);case 2:return e.next=4,(0,r.takeEvery)(n.UNFOLLOW_USER.REQUESTED,f);case 4:return e.next=6,(0,r.takeEvery)(n.LOAD_FOLLOWERS_COUNT.REQUESTED,h);case 6:case"end":return e.stop()}},d,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.followUser=function(e){return(0,r.jsonPost)("/api/1.0/activity_stream/follow_user",{user_id:e})},t.unfollowUser=function(e){return(0,r.jsonPost)("/api/1.0/activity_stream/unfollow_user",{user_id:e})},t.loadFollowersCount=function(e){return(0,r.jsonPost)("/api/1.0/activity_stream/followees_followers",{user_id:e})};var r=o(24)},function(e,t,o){o(171),e.exports=self.fetch.bind(self)},function(e,t){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},n=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=s(e),t=l(t);var o=this.map[e];this.map[e]=o?o+","+t:t},u.prototype.delete=function(e){delete this.map[s(e)]},u.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},u.prototype.set=function(e,t){this.map[s(e)]=l(t)},u.prototype.forEach=function(e,t){for(var o in this.map)this.map.hasOwnProperty(o)&&e.call(t,this.map[o],o,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,o){e.push(o)}),c(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,o){e.push([o,t])}),c(e)},t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},m.call(g.prototype),m.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];v.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=u,e.Request=g,e.Response=v,e.fetch=function(e,o){return new Promise(function(r,n){var i=new g(e,o),a=new XMLHttpRequest;a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:function(e){var t=new u;return e.split(/\r?\n/).forEach(function(e){var o=e.split(":"),r=o.shift().trim();if(r){var n=o.join(":").trim();t.append(r,n)}}),t}(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;r(new v(t,e))},a.onerror=function(){n(new TypeError("Network request failed"))},a.ontimeout=function(){n(new TypeError("Network request failed"))},a.open(i.method,i.url,!0),"include"===i.credentials&&(a.withCredentials=!0),"responseType"in a&&t.blob&&(a.responseType="blob"),i.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var o={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(o[Symbol.iterator]=function(){return o}),o}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise(function(t,o){e.onload=function(){t(e.result)},e.onerror=function(){o(e.error)}})}function f(e){var t=new FileReader,o=p(t);return t.readAsArrayBuffer(e),o}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e))this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!n(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=h(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,o=p(t);return t.readAsText(e),o}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),o=new Array(t.length),r=0;r<t.length;r++)o[r]=String.fromCharCode(t[r]);return o.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(e,t){var o=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=function(e){var t=e.toUpperCase();return i.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function b(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var o=e.split("="),r=o.shift().replace(/\+/g," "),n=o.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}}),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=d;var r=o(23),n=o(2),i=s(o(68)),a=s(o(175));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var l=regeneratorRuntime.mark(u),c=regeneratorRuntime.mark(d);function u(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.changeCommunity,e.hostname,e.destination);case 3:t=o.sent,(0,n.navigate)(t.url),o.next=11;break;case 7:return o.prev=7,o.t0=o.catch(0),o.next=11,(0,r.put)({type:i.CHANGE_COMMUNITY.FAILED,message:o.t0.message});case 11:case"end":return o.stop()}},l,this,[[0,7]])}function d(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(i.CHANGE_COMMUNITY.REQUESTED,u);case 2:case"end":return e.stop()}},c,this)}},function(e,t,o){e.exports=o(7)(590)},function(module,exports,__webpack_require__){"use strict";var _application=__webpack_require__(16),_cbSplit;function loadFile(e,t,o){$.ajax({url:NF.asset(e),async:!0,cache:t.cache,contentType:"text/plain;charset="+t.encoding,dataType:"text",success:function(e){o.resolve(e)},error:function(e){o.resolve("")}})}function parseData(data,mode){for(var parsed="",parameters=data.split(/\n/),regPlaceHolder=/(\{\d+\})/g,regRepPlaceHolder=/\{(\d+)\}/g,unicodeRE=/(\\u.{4})/gi,i=0;i<parameters.length;i++)if(parameters[i]=parameters[i].replace(/^\s\s*/,"").replace(/\s\s*$/,""),parameters[i].length>0&&"#"!=parameters[i].match("^#")){var pivot=parameters[i].indexOf("="),pair=[parameters[i].substr(0,pivot),parameters[i].substr(pivot+1)];if(pair.length>0){for(var name=unescape(pair[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),value=1==pair.length?"":pair[1];"\\"==value.match(/\\$/);)value=value.substring(0,value.length-1),value+=parameters[++i].replace(/\s\s*$/,"");if(value=value.replace(/^\s\s*/,"").replace(/\s\s*$/,""),"map"==mode||"both"==mode){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches)for(var u=0;u<unicodeMatches.length;u++)value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));$.i18n.map[name]=value}if("vars"==mode||"both"==mode)if(value=value.replace(/"/g,'\\"'),checkKeyNamespace(name),regPlaceHolder.test(value)){for(var parts=value.split(regPlaceHolder),first=!0,fnArgs="",usedArgs=[],p=0;p<parts.length;p++)!regPlaceHolder.test(parts[p])||0!=usedArgs.length&&-1!=usedArgs.indexOf(parts[p])||(first||(fnArgs+=","),fnArgs+=parts[p].replace(regRepPlaceHolder,"v$1"),usedArgs.push(parts[p]),first=!1);parsed+=name+"=function("+fnArgs+"){";var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+="return "+fnExpr+";};"}else parsed+=name+'="'+value+'";'}}eval(parsed)}function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key))for(var fullname="",names=key.split(/\./),i=0;i<names.length;i++)i>0&&(fullname+="."),fullname+=names[i],eval("typeof "+fullname+' == "undefined"')&&eval(fullname+"={};")}function getFiles(e){return e&&e.constructor==Array?e:[e]}function normaliseLanguageCode(e){return(e=e.toLowerCase()).length>3&&(e=e.substring(0,3)+e.substring(3).toUpperCase()),e}function unescapeUnicode(e){var t=[],o=parseInt(e.substr(2),16);o>=0&&o<Math.pow(2,16)&&t.push(o);for(var r="",n=0;n<t.length;++n)r+=String.fromCharCode(t[n]);return r}$.i18n={},$.i18n.map={},$.i18n.properties=function(e){null!==(e=$.extend({name:"Messages",language:"",path:"",mode:"vars",cache:!1,encoding:"UTF-8",callback:null},e)).language&&""!=e.language||(e.language=$.i18n.browserLang()),null===e.language&&(e.language="");var t=[];function o(){var e=$.Deferred();return t.push(e),e}for(var r=getFiles(e.name),n=0;n<r.length;n++)loadFile(e.path+r[n]+".properties",e,o()),$.each([2,5,7],function(t,i){if(e.language.length>=i){var a=e.path+r[n]+"_"+e.language.substring(0,i)+".properties";(0,_application.assetExists)(a)&&loadFile(a,e,o())}});$.when.apply($,t).then(function(){for(var t=arguments,o=0;o<t.length;o++)parseData(t[o],e.mode);e.callback&&e.callback()})},$.i18n.prop=function(e){var t,o,r=$.i18n.map[e];if(null==r)return"["+e+"]";if(2==arguments.length&&$.isArray(arguments[1])&&(t=arguments[1]),"string"==typeof r){for(o=0;-1!=(o=r.indexOf("\\",o));)r="t"==r.charAt(o+1)?r.substring(0,o)+"\t"+r.substring(2+o++):"r"==r.charAt(o+1)?r.substring(0,o)+"\r"+r.substring(2+o++):"n"==r.charAt(o+1)?r.substring(0,o)+"\n"+r.substring(2+o++):"f"==r.charAt(o+1)?r.substring(0,o)+"\f"+r.substring(2+o++):"\\"==r.charAt(o+1)?r.substring(0,o)+"\\"+r.substring(2+o++):r.substring(0,o)+r.substring(o+1);var n,i,a=[];for(o=0;o<r.length;)if("'"==r.charAt(o))if(o==r.length-1)r=r.substring(0,o);else if("'"==r.charAt(o+1))r=r.substring(0,o)+r.substring(++o);else{for(n=o+2;-1!=(n=r.indexOf("'",n));){if(n==r.length-1||"'"!=r.charAt(n+1)){r=r.substring(0,o)+r.substring(o+1,n)+r.substring(n+1),o=n-1;break}r=r.substring(0,n)+r.substring(++n)}-1==n&&(r=r.substring(0,o)+r.substring(o+1))}else if("{"==r.charAt(o)){if(-1==(n=r.indexOf("}",o+1)))o++;else if(i=parseInt(r.substring(o+1,n)),!isNaN(i)&&i>=0)""!=(s=r.substring(0,o))&&a.push(s),a.push(i),o=0,r=r.substring(n+1);else o=n+1}else o++;""!=r&&a.push(r),r=a,$.i18n.map[e]=a}if(0==r.length)return"";if(1==r.length&&"string"==typeof r[0])return r[0];var s="";for(o=0;o<r.length;o++)"string"==typeof r[o]?s+=r[o]:t&&r[o]<t.length?s+=t[r[o]]:!t&&r[o]+1<arguments.length?s+=arguments[r[o]+1]:s+="{"+r[o]+"}";return s},$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage)},_cbSplit||(_cbSplit=function(e,t,o){if("[object RegExp]"!==Object.prototype.toString.call(t))return void 0===_cbSplit._nativeSplit?e.split(t,o):_cbSplit._nativeSplit.call(e,t,o);var r,n,i,a,s=[],l=0,c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"");t=RegExp(t.source,c+"g");if(e+="",_cbSplit._compliantExecNpcg||(r=RegExp("^"+t.source+"$(?!\\s)",c)),void 0===o||+o<0)o=1/0;else if(!(o=Math.floor(+o)))return[];for(;(n=t.exec(e))&&!((i=n.index+n[0].length)>l&&(s.push(e.slice(l,n.index)),!_cbSplit._compliantExecNpcg&&n.length>1&&n[0].replace(r,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(n[e]=void 0)}),n.length>1&&n.index<e.length&&Array.prototype.push.apply(s,n.slice(1)),a=n[0].length,l=i,s.length>=o));)t.lastIndex===n.index&&t.lastIndex++;return l===e.length?!a&&t.test("")||s.push(""):s.push(e.slice(l)),s.length>o?s.slice(0,o):s},_cbSplit._compliantExecNpcg=void 0===/()??/.exec("")[1],_cbSplit._nativeSplit=String.prototype.split),String.prototype.split=function(e,t){return _cbSplit(this,e,t)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeCommunity=function(e,t){return(0,r.jsonPost)("/client/1.0/change_community",{hostname:e,destination:t})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=O;var r=o(23),n=d(o(177)),i=d(o(52)),a=d(o(30)),s=o(90),l=o(46),c=o(31),u=o(8);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var p=regeneratorRuntime.mark(S),f=regeneratorRuntime.mark(w),h=regeneratorRuntime.mark(k),m=regeneratorRuntime.mark(E),g=regeneratorRuntime.mark(P),b=regeneratorRuntime.mark(C),v=regeneratorRuntime.mark(T),y=regeneratorRuntime.mark(R),_=regeneratorRuntime.mark(O);function S(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(n.getTabs);case 3:return e=t.sent,t.next=6,(0,r.put)({type:i.GET_TABS.SUCCEEDED,tabs:e.tabs});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:i.GET_TABS.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},p,this,[[0,8]])}function w(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(n.getCarousel);case 3:return e=t.sent,t.next=6,(0,r.put)({type:i.GET_CAROUSEL.SUCCEEDED,carouselCollections:e.collections});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:i.GET_CAROUSEL.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},f,this,[[0,8]])}function k(e){var t,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,t=e.title,s.next=4,(0,r.call)(n.getRecommended,e.recommendations);case 4:return o=s.sent,s.next=7,(0,r.put)({type:a.LOAD_MODELS.SUCCEEDED,modelsType:"products",models:o});case 7:return s.next=9,(0,r.put)({type:i.GET_RECOMMENDED.SUCCEEDED,title:t,ids:o.map(function(e){return e.id})});case 9:s.next=15;break;case 11:return s.prev=11,s.t0=s.catch(0),s.next=15,(0,r.put)({type:i.GET_RECOMMENDED.FAILED,message:s.t0.message});case 15:case"end":return s.stop()}},h,this,[[0,11]])}function E(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!NF.session.rrFind()){o.next=7;break}return o.next=4,(0,r.call)(R,e.params);case 4:t=o.sent,o.next=10;break;case 7:return o.next=9,(0,r.call)(n.search,e.params);case 9:t=o.sent;case 10:return o.next=12,(0,r.put)({type:i.SEARCH.SUCCEEDED,products:t.products,aggregations:t.aggregations,count:t.count,shown:t.shown});case 12:return o.next=14,(0,s.addProductImpressions)(t.products);case 14:o.next=20;break;case 16:return o.prev=16,o.t0=o.catch(0),o.next=20,(0,r.put)({type:i.SEARCH.FAILED,message:o.t0.message});case 20:case"end":return o.stop()}},m,this,[[0,16]])}function P(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,e.params.start_index=0,!NF.session.rrFind()){o.next=8;break}return o.next=5,(0,r.call)(R,e.params);case 5:t=o.sent,o.next=11;break;case 8:return o.next=10,(0,r.call)(n.search,e.params);case 10:t=o.sent;case 11:return o.next=13,(0,r.put)({type:i.RESET_SEARCH.SUCCEEDED,products:t.products,aggregations:t.aggregations,count:t.count,shown:t.shown});case 13:return o.next=15,(0,s.addProductImpressions)(t.products);case 15:o.next=21;break;case 17:return o.prev=17,o.t0=o.catch(0),o.next=21,(0,r.put)({type:i.RESET_SEARCH.FAILED,message:o.t0.message});case 21:case"end":return o.stop()}},g,this,[[0,17]])}function C(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(n.getProductPreview,e.url);case 3:return t=o.sent,o.next=6,(0,r.put)({type:i.GET_PRODUCT_PREVIEW.SUCCEEDED,preview:t,productUuid:e.productUuid});case 6:o.next=12;break;case 8:return o.prev=8,o.t0=o.catch(0),o.next=12,(0,r.put)({type:i.GET_PRODUCT_PREVIEW.FAILED,message:o.t0.message});case 12:case"end":return o.stop()}},b,this,[[0,8]])}function T(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(n.rrProductClicked,e.url);case 3:t.next=9;break;case 5:return t.prev=5,t.t0=t.catch(0),t.next=9,(0,r.put)({type:i.RR_PRODUCT_CLICKED.FAILED,message:t.t0.message});case 9:case"end":return t.stop()}},v,this,[[0,5]])}function R(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,r.call)(n.searchWithFind,e);case 2:return t=(t=o.sent).placements[0],o.next=6,(0,r.call)(n.getFound,t.docs);case 6:return t.products=o.sent,t.aggregations=(0,l.convertFacetsToAggregations)(t.facets),t.count=t.numFound,t.shown=e.start_index+t.products.length,localStorage.setItem("rr_add_to_cart_params",t.addtoCartParams),(0,c.setCookie)("rr_rcs",t.rcs,31536e6,u.COOKIE_DOMAIN,"/"),o.abrupt("return",t);case 13:case"end":return o.stop()}},y,this)}function O(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(i.GET_TABS.REQUESTED,S);case 2:return e.next=4,(0,r.takeEvery)(i.GET_CAROUSEL.REQUESTED,w);case 4:return e.next=6,(0,r.takeEvery)(i.GET_RECOMMENDED.REQUESTED,k);case 6:return e.next=8,(0,r.takeEvery)(i.SEARCH.REQUESTED,E);case 8:return e.next=10,(0,r.takeEvery)(i.RESET_SEARCH.REQUESTED,P);case 10:return e.next=12,(0,r.takeEvery)(i.GET_PRODUCT_PREVIEW.REQUESTED,C);case 12:return e.next=14,(0,r.takeEvery)(i.RR_PRODUCT_CLICKED.REQUESTED,T);case 14:case"end":return e.stop()}},_,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTabs=function(){return(0,r.get)("/api/1.0/marketplace/tabs",{})},t.getCarousel=function(){return(0,r.get)("/api/1.0/marketplace/carousel",{})},t.getRecommended=function(e){return(0,r.jsonPost)("/api/1.0/marketplace/recommended",{recommendations:e})},t.getFound=function(e){return(0,r.jsonPost)("/api/1.0/marketplace/found",{found:e})},t.search=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsonPost)("/api/1.0/marketplace/products/search",e)},t.searchWithFind=function(e){return(0,r.get)((0,n.buildFindUrl)(e),{})},t.getProductPreview=function(e){return(0,r.getPakoCompressed)(e,{})},t.rrProductClicked=function(e){return(0,r.getAndIgnoreResponse)(e)};var r=o(24),n=o(46)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=v;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(23),i=o(5),a=l(o(179)),s=l(o(65));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var c=regeneratorRuntime.mark(h),u=regeneratorRuntime.mark(m),d=regeneratorRuntime.mark(g),p=regeneratorRuntime.mark(b),f=regeneratorRuntime.mark(v);function h(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,n.call)(a.getCollection,e.id);case 3:return t=o.sent,o.next=6,(0,n.put)({type:s.GET_COLLECTION.SUCCEEDED,collection:t.collection});case 6:o.next=12;break;case 8:return o.prev=8,o.t0=o.catch(0),o.next=12,(0,n.put)({type:s.GET_COLLECTION.FAILED,message:o.t0.message});case 12:case"end":return o.stop()}},c,this,[[0,8]])}function m(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,n.call)(a.getCollections,e.collectionType);case 3:return t=o.sent,o.next=6,(0,n.put)({type:s.GET_COLLECTIONS.SUCCEEDED,collection:t.collections});case 6:r.default.publish(i.COLLECTIONS_USER_COLLECTIONS_FETCHED,{collections:t.collections}),o.next=13;break;case 9:return o.prev=9,o.t0=o.catch(0),o.next=13,(0,n.put)({type:s.GET_COLLECTIONS.FAILED,message:o.t0.message});case 13:case"end":return o.stop()}},u,this,[[0,9]])}function g(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,n.call)(a.addToCollection,e.ids,e.collectionId,e.collectionType);case 3:return t=o.sent,o.next=6,(0,n.put)({type:s.ADD_TO_COLLECTION.SUCCEEDED,collection:t.collection,count:t.count});case 6:r.default.publish(i.COLLECTIONS_ITEMS_ADDED,{collection:t.collection}),o.next=13;break;case 9:return o.prev=9,o.t0=o.catch(0),o.next=13,(0,n.put)({type:s.ADD_TO_COLLECTION.FAILED,message:o.t0.message});case 13:case"end":return o.stop()}},d,this,[[0,9]])}function b(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,n.call)(a.removeFromCollection,e.ids,e.collectionId,e.collectionType);case 3:return t=o.sent,o.next=6,(0,n.put)({type:s.REMOVE_FROM_COLLECTION.SUCCEEDED,collection:t.collection,count:t.count});case 6:r.default.publish(i.COLLECTIONS_ITEMS_REMOVED,{collection:t.collection}),o.next=13;break;case 9:return o.prev=9,o.t0=o.catch(0),o.next=13,(0,n.put)({type:s.REMOVE_FROM_COLLECTION.FAILED,message:o.t0.message});case 13:case"end":return o.stop()}},p,this,[[0,9]])}function v(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.takeEvery)(s.GET_COLLECTION.REQUESTED,h);case 2:return e.next=4,(0,n.takeEvery)(s.GET_COLLECTIONS.REQUESTED,m);case 4:return e.next=6,(0,n.takeEvery)(s.ADD_TO_COLLECTION.REQUESTED,g);case 6:return e.next=8,(0,n.takeEvery)(s.REMOVE_FROM_COLLECTION.REQUESTED,b);case 8:case"end":return e.stop()}},f,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCollection=function(e){return(0,r.jsonPost)("/api/1.0/collection/info",{collection_id:e})},t.getCollections=function(e){return(0,r.jsonPost)("/api/1.0/collections/list",{collection_type:e})},t.getRelatedScores=function(e){return(0,r.jsonPost)("/api/1.0/collection/related_scores",{collection_id:e})},t.addToCollection=function(e,t,o){return(0,r.jsonPost)("/api/1.0/collections/add",{ids:e,collection_id:t,collection_type:o})},t.removeFromCollection=function(e,t,o){return(0,r.jsonPost)("/api/1.0/collections/remove_items",{score_ids:e,collection_id:t,collection_type:o})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=b;var r=o(23),n=s(o(66)),i=s(o(30)),a=s(o(181));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var l=regeneratorRuntime.mark(f),c=regeneratorRuntime.mark(h),u=regeneratorRuntime.mark(m),d=regeneratorRuntime.mark(g),p=regeneratorRuntime.mark(b);function f(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.listFavorites,e.age,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"scores",models:t.scores});case 6:return o.next=8,(0,r.put)({type:n.LIST_FAVORITES.SUCCEEDED,ids:t.scores.map(function(e){return e.id}),count:t.count,remaining:t.remaining,shown:t.shown,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:n.LIST_FAVORITES.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},l,this,[[0,10]])}function h(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.listScores,e.order,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"scores",models:t.scores});case 6:return o.next=8,(0,r.put)({type:n.LIST_SCORES.SUCCEEDED,ids:t.scores.map(function(e){return e.id}),count:t.count,remaining:t.remaining,shown:t.shown,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:n.LIST_SCORES.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},c,this,[[0,10]])}function m(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.listUserGroups,e.userId,e.order,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"groups",models:t.groups});case 6:return o.next=8,(0,r.put)({type:n.LIST_USER_GROUPS.SUCCEEDED,ids:t.groups.map(function(e){return e.id}),count:t.count,remaining:t.remaining,shown:t.shown,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:n.LIST_USER_GROUPS.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},u,this,[[0,10]])}function g(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(a.listGroups,e.order,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:i.LOAD_MODELS.SUCCEEDED,modelsType:"groups",models:t.groups});case 6:return o.next=8,(0,r.put)({type:n.LIST_GROUPS.SUCCEEDED,ids:t.groups.map(function(e){return e.id}),count:t.count,remaining:t.remaining,shown:t.shown,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:n.LIST_GROUPS.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},d,this,[[0,10]])}function b(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(n.LIST_FAVORITES.REQUESTED,f);case 2:return e.next=4,(0,r.takeEvery)(n.LIST_SCORES.REQUESTED,h);case 4:return e.next=6,(0,r.takeEvery)(n.LIST_USER_GROUPS.REQUESTED,m);case 6:return e.next=8,(0,r.takeEvery)(n.LIST_GROUPS.REQUESTED,g);case 8:case"end":return e.stop()}},p,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listFavorites=function(e,t,o){return(0,r.get)("/api/1.0/scores/favorites",{age:e,start_index:t,max_count:o})},t.listScores=function(e,t,o){return(0,r.get)("/api/1.0/scores",{order:e,start_index:t,max_count:o})},t.listUserGroups=function(e,t,o,n){return(0,r.jsonPost)("/api/1.0/groups",{max_count:n,order:t,start_index:o,user_id:e})},t.listGroups=function(e,t,o){return(0,r.jsonPost)("/api/1.0/groups",{max_count:o,order:e,start_index:t,user_id:null})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=w;var r=o(23),n=a(o(64)),i=a(o(183));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var s=regeneratorRuntime.mark(m),l=regeneratorRuntime.mark(g),c=regeneratorRuntime.mark(b),u=regeneratorRuntime.mark(v),d=regeneratorRuntime.mark(y),p=regeneratorRuntime.mark(_),f=regeneratorRuntime.mark(S),h=regeneratorRuntime.mark(w);function m(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(i.updateProfile,e.profile,e.external_id);case 3:return t.next=5,(0,r.put)({type:n.UPDATE_PROFILE.SUCCEEDED});case 5:t.next=11;break;case 7:return t.prev=7,t.t0=t.catch(0),t.next=11,(0,r.put)({type:n.UPDATE_PROFILE.FAILED,message:t.t0.message});case 11:case"end":return t.stop()}},s,this,[[0,7]])}function g(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(i.retrieveSellerAccount);case 3:return e=t.sent,t.next=6,(0,r.put)({type:n.RETRIEVE_SELLER_ACCOUNT.SUCCEEDED,sellerAccount:e});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:n.RETRIEVE_SELLER_ACCOUNT.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},l,this,[[0,8]])}function b(){var e,t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(i.retrieveSellerPayoutDestination);case 3:if(e=o.sent,t=null,!e){o.next=9;break}return o.next=8,(0,r.call)(i.checkSellerPayoutDestinationStatus);case 8:t=o.sent;case 9:return o.next=11,(0,r.put)({type:n.RETRIEVE_SELLER_PAYOUT_DESTINATION.SUCCEEDED,sellerPayoutDestination:e,payoutStatus:t});case 11:o.next=17;break;case 13:return o.prev=13,o.t0=o.catch(0),o.next=17,(0,r.put)({type:n.RETRIEVE_SELLER_PAYOUT_DESTINATION.FAILED,message:o.t0.message});case 17:case"end":return o.stop()}},c,this,[[0,13]])}function v(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(i.paymentInfo);case 3:return e=t.sent,t.next=6,(0,r.put)({type:n.PAYMENT_INFO.SUCCEEDED,paymentInfo:e});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:n.PAYMENT_INFO.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},u,this,[[0,8]])}function y(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(i.siteOwnerEmail);case 3:return e=t.sent,t.next=6,(0,r.put)({type:n.SITE_OWNER_EMAIL.SUCCEEDED,siteOwnerEmail:e.email});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:n.SITE_OWNER_EMAIL.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},d,this,[[0,8]])}function _(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.call)(i.retrieveAuthorizedApps);case 3:return e=t.sent,t.next=6,(0,r.put)({type:n.RETRIEVE_AUTHORIZED_APPS.SUCCEEDED,authorizedApps:e});case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(0),t.next=12,(0,r.put)({type:n.RETRIEVE_AUTHORIZED_APPS.FAILED,message:t.t0.message});case 12:case"end":return t.stop()}},p,this,[[0,8]])}function S(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(i.removeAuthorizedApp,e.appId);case 3:return t=o.sent,o.next=6,(0,r.put)({type:n.REMOVE_AUTHORIZED_APP.SUCCEEDED,authorizedApps:t});case 6:o.next=12;break;case 8:return o.prev=8,o.t0=o.catch(0),o.next=12,(0,r.put)({type:n.REMOVE_AUTHORIZED_APP.FAILED,message:o.t0.message});case 12:case"end":return o.stop()}},f,this,[[0,8]])}function w(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(n.UPDATE_PROFILE.REQUESTED,m);case 2:return e.next=4,(0,r.takeEvery)(n.RETRIEVE_SELLER_ACCOUNT.REQUESTED,g);case 4:return e.next=6,(0,r.takeEvery)(n.RETRIEVE_SELLER_PAYOUT_DESTINATION.REQUESTED,b);case 6:return e.next=8,(0,r.takeEvery)(n.PAYMENT_INFO.REQUESTED,v);case 8:return e.next=10,(0,r.takeEvery)(n.SITE_OWNER_EMAIL.REQUESTED,y);case 10:return e.next=12,(0,r.takeEvery)(n.RETRIEVE_AUTHORIZED_APPS.REQUESTED,_);case 12:return e.next=14,(0,r.takeEvery)(n.REMOVE_AUTHORIZED_APP.REQUESTED,S);case 14:case"end":return e.stop()}},h,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProfile=function(e,t){return(0,r.jsonPost)("/api/1.0/members/edit_profile",{user:{profile:e},user_id:t})},t.retrieveSellerAccount=function(){return(0,r.jsonPost)("/api/1.0/seller/retrieve_account",{})},t.retrieveSellerPayoutDestination=function(){return(0,r.jsonPost)("/api/1.0/seller/retrieve_payout_destination",{})},t.checkSellerPayoutDestinationStatus=function(){return(0,r.jsonPost)("/api/1.0/seller/check_payout_destination_status",{})},t.paymentInfo=function(){return(0,r.jsonPost)("/api/1.0/payment_info",{})},t.siteOwnerEmail=function(){return(0,r.jsonPost)("/communities/site_owner_email",{})},t.retrieveAuthorizedApps=function(){return(0,r.jsonPost)("/api/1.0/oauth_authorized_applications",{})},t.removeAuthorizedApp=function(e){return(0,r.jsonPost)("/api/1.0/oauth_authorized_applications/remove",{app_id:e})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=d;var r=o(23),n=s(o(30)),i=s(o(70)),a=s(o(91));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var l=regeneratorRuntime.mark(u),c=regeneratorRuntime.mark(d);function u(e){var t,o,s;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,(0,r.call)(a.songSearch,e.title,e.contributors);case 3:for(t=l.sent,o=[],s=0;s<t.songs.length;s++)t.songs[s].id=t.songs[s].uuid,o.push(t.songs[s].id);return l.next=8,(0,r.put)({type:n.LOAD_MODELS.SUCCEEDED,modelsType:"songs",models:t.songs});case 8:return l.next=10,(0,r.put)({type:i.SONG_SEARCH.SUCCEEDED,ids:t.songs.map(function(e){return e.id}),title:e.title,contributors:e.contributors});case 10:l.next=16;break;case 12:return l.prev=12,l.t0=l.catch(0),l.next=16,(0,r.put)({type:i.SONG_SEARCH.FAILED,message:l.t0.message});case 16:case"end":return l.stop()}},l,this,[[0,12]])}function d(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(i.SONG_SEARCH.REQUESTED,u);case 2:case"end":return e.stop()}},c,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=k;var r=o(23),n=f(o(30)),i=f(o(69)),a=o(47),s=f(o(186)),l=f(o(91)),c=o(3),u=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),d=o(5),p=o(0);function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}var h=regeneratorRuntime.mark(y),m=regeneratorRuntime.mark(_),g=regeneratorRuntime.mark(S),b=regeneratorRuntime.mark(w),v=regeneratorRuntime.mark(k);function y(){var e,t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,u.default.publish(d.REPORTER_ADD,{text:(0,p.resource)("action.updating")}),o.next=4,(0,r.select)(a.sharingParametersSelector);case 4:return e=o.sent,o.next=7,(0,r.call)(s.updateScoreSharing,e.scoreId,e.everyoneRole,e.groups,e.users,e.searchable,e.copyable,e.template,e.authorship,e.songs);case 7:return t=o.sent,o.next=10,(0,r.put)({type:n.LOAD_MODELS.SUCCEEDED,modelsType:"documentRoles",models:t.document_roles});case 10:return o.next=12,(0,r.put)({type:n.LOAD_MODELS.SUCCEEDED,modelsType:"songs",models:t.songs});case 12:return o.next=14,(0,r.put)({type:n.UPDATE_MODELS.SUCCEEDED,modelsType:"scores",models:[t.score]});case 14:return o.next=16,(0,r.put)({type:i.UPDATE_SCORE_SHARING.SUCCEEDED});case 16:u.default.publish(d.REPORTER_REMOVE),(0,c.cancelAndCloseCurrentModalDialog)(),o.next=24;break;case 20:return o.prev=20,o.t0=o.catch(0),o.next=24,(0,r.put)({type:i.UPDATE_SCORE_SHARING.FAILED,message:o.t0.message});case 24:case"end":return o.stop()}},h,this,[[0,20]])}function _(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(s.searchGroups,e.query,e.userId,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:n.LOAD_MODELS.SUCCEEDED,modelsType:"groups",models:t.groups});case 6:return o.next=8,(0,r.put)({type:i.SEARCH_GROUPS.SUCCEEDED,ids:t.groups.map(function(e){return e.id}),count:t.count,shown:t.shown,remaining:t.remaining,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:i.SEARCH_GROUPS.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},m,this,[[0,10]])}function S(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(s.searchUsers,e.query,e.order,e.startIndex,e.maxCount);case 3:return t=o.sent,o.next=6,(0,r.put)({type:n.LOAD_MODELS.SUCCEEDED,modelsType:"users",models:t.users});case 6:return o.next=8,(0,r.put)({type:i.SEARCH_USERS.SUCCEEDED,ids:t.users.map(function(e){return e.id}),count:t.count,shown:t.shown,remaining:t.remaining,firstPage:0==e.startIndex});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:i.SEARCH_USERS.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},g,this,[[0,10]])}function w(e){var t;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.call)(l.songSearch,e.title,e.contributors);case 3:return t=o.sent,o.next=6,(0,r.put)({type:n.UPDATE_MODELS.SUCCEEDED,modelsType:"songs",models:t.songs});case 6:return o.next=8,(0,r.put)({type:i.SEARCH_SONGS.SUCCEEDED,ids:t.songs.map(function(e){return e.id}),count:t.count,shown:t.shown,remaining:t.remaining,firstPage:!0});case 8:o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(0),o.next=14,(0,r.put)({type:i.SEARCH_SONGS.FAILED,message:o.t0.message});case 14:case"end":return o.stop()}},b,this,[[0,10]])}function k(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.takeEvery)(i.SEARCH_GROUPS.REQUESTED,_);case 2:return e.next=4,(0,r.takeEvery)(i.SEARCH_USERS.REQUESTED,S);case 4:return e.next=6,(0,r.takeEvery)(i.SEARCH_SONGS.REQUESTED,w);case 6:return e.next=8,(0,r.takeEvery)(i.UPDATE_SCORE_SHARING.REQUESTED,y);case 8:case"end":return e.stop()}},v,this)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateScoreSharing=function(e,t,o,n,i,a,s,l,c){return(0,r.jsonPost)("/api/1.0/scores/sharing",{score_id:e,everyone:t,groups:o,users:n,searchable:i,copyable:a,template:s,authorship:l,songs:c})},t.searchGroups=function(e,t,o,n){return(0,r.jsonPost)("/api/1.0/groups",{query:e,user_id:t,start_index:o,max_count:n,only_active:!0,only_interest:!0})},t.searchUsers=function(e,t,o,n){return(0,r.get)("/api/1.0/users",{query:e,order:t,start_index:o,max_count:n,exclude_current_user:!0})};var r=o(24)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(0);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.show=ko.observable(!1),this.message=ko.observable(),this.messageDescription=ko.observable(),this.withBackground=ko.observable(),this.hideCancel=ko.observable(),this.continueText=ko.observable(),this.continueCallback=null,this.hasContinueCallback=ko.observable(!1),this.cancelCallback=null}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"populate",value:function(e){this.message(e.message),this.messageDescription(e.messageDescription),this.withBackground(e.withBackground),this.continueText(e.continueText||(0,i.resource)("action.continue")),this.hideCancel(e.hideCancel||!1),this.continueCallback=e.continueCallback,this.hasContinueCallback(!!e.continueCallback),this.cancelCallback=e.cancelCallback}},{key:"handleContinue",value:function(){this.continueCallback&&this.continueCallback(),r.default.publish(n.REPORTER_CLEAR_ERRORS)}},{key:"handleCancel",value:function(){this.cancelCallback&&this.cancelCallback(),r.default.publish(n.REPORTER_CLEAR_ERRORS)}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appViewModelSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentTypeSelector,function(e){return{contentType:e}});t.appViewModelSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBinding=function(e,t,o,i){if("function"==typeof e[t.property])t.isFunction?e[t.property](o[t.property]()):e[t.property](o[t.property]);else{if(void 0===t.customValue?e[t.property]=ko.observable(e.editor.scoreState[t.property]()):e[t.property]=ko.observable(t.customValue),t.permission&&!e.editor.contentPolicy()[t.permission])return!1;t.throttle?(e["".concat(t.property,"Action")]=ko.computed(e[t.property]).extend({throttle:n}),e["".concat(t.property,"Action")].subscribe(function(){e["".concat(t.property,"Event")]()}),e["".concat(t.property,"Step")]=ko.observable(t.step),e["".concat(t.property,"Min")]=ko.observable(t.min),e["".concat(t.property,"Max")]=ko.observable(t.max),e["".concat(t.property,"MinInPixels")]=ko.observable(t.minInPixels),e["".concat(t.property,"MaxInPixels")]=ko.observable(t.maxInPixels)):e[t.property].subscribe(function(){e["".concat(t.property,"Event")]()})}t.customFunction||(e.editor.scoreState[t.property].subscribe(function(){e[t.property](e.editor.scoreState[t.property]())}),e["".concat(t.property,"Event")]=function(){if(!t.checkPermission||!e[t.checkPermission]||e[t.checkPermission]()){var r;r=t.isFunction?o[t.property]():o[t.property];var n=e[t.property]();t.throttle&&(n=parseFloat(n)),r!==n&&(e.editor.controller.document.undoHistory.openGroup(t.property),i(t,n))}});e["".concat(t.property,"TextToShow")]=ko.computed(function(){return-1==e[t.property]()?(0,r.resource)("content.multi"):"".concat(e[t.property]()," px")})},t.createBasicBinding=function(e,t){e[t.property]=ko.observable(t.path[t.property]),e[t.property].subscribe(function(){t.path[t.property]=e[t.property]()})};var r=o(0),n=350},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){for(var e=[],t=0;t<a.length;t++){for(var o=a[t],r=!1,n=0;n<e.length;n++)if(e[n].code()==o.family){r=!0,e[n].addInstrument(o.code);break}if(!r){var i=new s(o.family);i.addInstrument(o.code),e.push(i)}}return e};var r=o(0);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=[{code:"guitar",family:"pluckedString"},{code:"bass_guitar",family:"pluckedString"},{code:"ukulele",family:"pluckedString"},{code:"banjo",family:"pluckedString"},{code:"harp",family:"pluckedString"},{code:"violin",family:"bowedString"},{code:"viola",family:"bowedString"},{code:"cello",family:"bowedString"},{code:"double_bass",family:"bowedString"},{code:"piano",family:"keyboard"},{code:"organ",family:"keyboard"},{code:"percussion",family:"percussion"},{code:"drum_set",family:"percussion"},{code:"flute",family:"wind"},{code:"oboe",family:"wind"},{code:"clarinet",family:"wind"},{code:"saxophone",family:"wind"},{code:"french_horn",family:"brass"},{code:"trumpet",family:"brass"},{code:"trombone",family:"brass"},{code:"euphonium",family:"brass"},{code:"tuba",family:"brass"},{code:"soprano",family:"voice"},{code:"alto",family:"voice"},{code:"tenor",family:"voice"},{code:"bass",family:"voice"},{code:"other_instrument",family:"other"}],s=function(){function e(t){var o=this;i(this,e),this.code=ko.observable(t),this.instruments=ko.observableArray([]),this.name=ko.computed(function(){return(0,r.resource)("instrumentFamily."+o.code())})}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"addInstrument",value:function(e){this.instruments.push(new function e(t){var o=this;i(this,e),this.code=ko.observable(t),this.name=ko.computed(function(){return(0,r.resource)("instruments.name."+o.code())})}(e))}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadMedia=n,t.audioBufferToWav=function(e){var t=$.Deferred(),o=null;return(0,r.loadWorkerFile)((0,r.workerPath)("recorderWorker"),function(n){o=n,function(){var n=(0,r.getWorkerBlob)(o),i=(0,r.createWorkerWithBlob)(n),a=[e.getChannelData(0)];e.numberOfChannels>1&&a.push(e.getChannelData(1)),i.postMessage({command:"init",config:{sampleRate:e.sampleRate,numChannels:e.numberOfChannels}}),i.onmessage=function(e){t.resolve(e.data)},i.postMessage({command:"record",buffer:a}),i.postMessage({command:"exportWAV",type:"audio/wav"})}()}),t},t.wavToArrayBuffer=function(e){var t=$.Deferred(),o=new FileReader;return o.onload=function(){t.resolve(this.result)},o.readAsArrayBuffer(e),t};o(0),function(e){e&&e.__esModule}(o(238));var r=o(106);function n(e,t,o,r,n){var i,a,s=function(e){n(e)},l=function(){if(4==i.readyState){var e=i.status;if(!(e>=200&&e<=399))return;Noteflight.getService(a,r,s)()}},c=function(e){a=e.uploaded_url;var r=e.form_data.params,n=new FormData;for(var s in r){var c=r[s];n.append(s,c)}var u=new Blob([o],{type:t.content_type});n.append("file",u),(i=new XMLHttpRequest).onreadystatechange=l,i.open(e.form_data.method,e.form_data.action,!0),i.send(n)};!function(){var n=t;n.score_id=e,n.max_size=o.byteLength;NF.apiService.mediaPrepareUpload(r,c,n)}()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getYoutubeVideoId=function(e){var t=e.match(/(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/?.*(?:watch|embed)?(?:.*v=|v\/|\/)([\w\-_]+)/);if(t&&2==t.length)return t[1];return null},t.usernamePattern=function(e){return/^[a-zA-Z0-9\- ]+$/.test(e)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(407)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable(""),this.brand=ko.observable(""),this.expirationYear=ko.observable(""),this.expirationMonth=ko.observable(""),this.last4=ko.observable(""),this.inactive=ko.observable(!1),this.address=new r.default,this.showButtons=ko.observable(!0),this.cardEndingInText=ko.computed(function(){return(0,n.resource)("content.cardEndingInText",t.brand(),t.last4())}),this.creditCardPlaceholder=ko.computed(function(){return"XXXX-XXXX-XXXX-".concat(t.last4())})}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"expirationDate",value:function(){return"".concat(this.expirationMonth()," / ").concat(this.expirationYear().toString().slice(2,4))}},{key:"clone",value:function(){var t=new e;return t.id(this.id()),t.brand(this.brand()),t.expirationYear(this.expirationYear()),t.expirationMonth(this.expirationMonth()),t.last4(this.last4()),t.address=this.address.clone(),t}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o(408)),n=a(o(13)),i=o(3);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,u(t).call(this)))._callback=e,r._cancelCallback=o.cancelCallback,r.title=ko.observable(o.title||"content.imageEditor"),r._aspectRatio=o.aspectRatio||1,r.showSpinner=ko.observable(!1),r.imageUrl=ko.observable(),r.imageFromUnsplash=ko.observable(!1),r.imagePresent=ko.observable(!1),r._cropper=null,r.okEnabled=ko.observable(!0),o.imageUrl&&r.setImage(o.imageUrl),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"setImage",value:function(e){this.showSpinner(!0),this.imageUrl(e),this.imagePresent(!0),this._createCropper(),e.includes("unsplash")&&this.imageFromUnsplash(!0)}},{key:"_createCropper",value:function(){var e=this;this.okEnabled(!0);var t=document.getElementById("imageCropper");t&&0!==t.width&&0!==t.height?this._cropper=new r.default(t,{aspectRatio:this._aspectRatio,ready:function(){e.showSpinner(!1),e.okEnabled(!0)}}):setTimeout(function(){e._createCropper()},1e3)}},{key:"doOk",value:function(){if(!this._cropper.getCroppedCanvas())return!1;this.okEnabled(!1);var e=this._cropper.getCroppedCanvas().toDataURL("image/jpeg");return this._callback(e),!0}},{key:"doCancel",value:function(){return this._cancelCallback&&this._cancelCallback(),!0}},{key:"moveMode",value:function(){this._cropper.setDragMode("move")}},{key:"cropMode",value:function(){this._cropper.setDragMode("crop")}},{key:"zoomIn",value:function(){this._cropper.zoom(.2)}},{key:"zoomOut",value:function(){this._cropper.zoom(-.2)}},{key:"show",value:function(){return(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/imageEditor"}),this}}]),t}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedSwitch=void 0;var r=o(10),n=o(76),i=(0,r.connect)(function(e){return{location:e.router.location}})(n.Switch);t.ConnectedSwitch=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"render",value:function(){for(var e=[],t=[],o=[],n=0;n<this.selected;n++)e.push(r.default.createElement("i",{key:n,className:"fa fa-star","aria-hidden":"true"}));for(var i=0;i<this.half;i++)t.push(r.default.createElement("i",{key:i,className:"fa fa-star-half-o","aria-hidden":"true"}));for(var a=0;a<this.empty;a++)o.push(r.default.createElement("i",{key:a,className:"fa fa-star-o emptyStar","aria-hidden":"true"}));return r.default.createElement("div",{className:"stars ".concat(this.props.size)},e,t,o)}},{key:"selected",get:function(){return Math.floor(this.props.total)}},{key:"half",get:function(){return this.props.total-this.selected>.5?1:0}},{key:"empty",get:function(){return 5-this.selected-this.half}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this))).new=ko.observable(e.new||!1),o.callback=e.callback,o.id=e.id||null,o.title=ko.observable(e.title),o.description=ko.observable(e.description),o.public=ko.observable(e.public||!1),o.showSearch=ko.observable(e.query||!1),o.query=ko.observable(e.query),o.buttonLabel=ko.observable(e.buttonLabel||"content.viewMore"),o.isMarketplaceCollection=ko.observable(e.isMarketplaceCollection||!1),o.rawButtonLabel=ko.observable(o.buttonLabel()),o.displayedButtonLabel=ko.computed(function(){return(0,n.hasResource)(o.rawButtonLabel())?(0,n.resource)(o.rawButtonLabel()):"No matching resource string! The button will not be localized."}),o.dialogTitle=ko.computed(function(){return o.new()?"content.newCollection":"content.editCollection"}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"_collectionSaved",value:function(e){this.cancel(),this.callback&&this.callback(e.collection)}},{key:"save",value:function(){var e=this.showSearch()?this.query():"",t=this.showSearch()?this.buttonLabel():"",o={name:this.title(),description:this.description(),collection_id:this.id,public:this.public(),query:e,is_marketplace_collection:this.isMarketplaceCollection(),button_label:t};this.new()?NF.apiService.newCollection((0,n.resource)("listing.creatingCollection"),this._collectionSaved.bind(this),o):NF.apiService.updateCollection((0,n.resource)("action.updatingCollection"),this._collectionSaved.bind(this),o)}},{key:"show",value:function(){return(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/collectionDetails"}),this}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(36),i=o(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"componentDidMount",value:function(){(0,n.initializeTippy)(n.originalBadgeHint)}},{key:"render",value:function(){return r.default.createElement("div",{className:"officialBadge tippy","data-tippy-content":(0,i.resource)("content.originalWork")},r.default.createElement("span",{className:"fa-stack"},r.default.createElement("i",{className:"fa fa-certificate fa-stack-2x"}),r.default.createElement("i",{className:"fa fa fa-check fa-stack-1x fa-inverse"})))}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("div",{className:"spinnerContainer"},r.default.createElement("div",{className:"svgSpinner"}))}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(o(124)),n=o(201),i=o(15),a=o(6),s=o(28),l=o(264),c=p(o(43)),u=p(o(265)),d=p(o(202));function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=["genre","difficulty_level","duration","format","key_signature","custom_audio_media","hlc_grade","hlc_genre","hlc_format","hlc_arranger","hlc_audioref","hlc_contests"],m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.id=a.ko.observable(t.external_id),this.title=a.ko.observable(),this.description=a.ko.observable(),this.composer=a.ko.observable(),this.archived=a.ko.observable(!1),this.author=a.ko.observable(),this.updated=a.ko.observable(),this.collections=a.ko.observableArray(),this.comments=a.ko.observableArray(),this.favorites=a.ko.observableArray(),this.versions=a.ko.observableArray(),this.views_count=a.ko.observable(),this.favorites_count=a.ko.observable(),this.comments_count=a.ko.observable(),this.version=a.ko.observable(),this.contentLibraryId=a.ko.observable(),this.google_course_work_id=a.ko.observable(!1),this.google_course_id=a.ko.observable(!1),this.cover_art_url=a.ko.observable(),this.cover_art_id=a.ko.observable(),this.cover_art_directive=a.ko.observable(),this.coverArt=a.ko.observable(),this.external_id=a.ko.observable(),this.hasAudioPreview=a.ko.observable(t.has_audio_preview),this.hasCustomAudioMedia=a.ko.observable(t.has_custom_audio_media),this.audioPreviewPath=a.ko.observable(t.audio_preview_path),this.in_favorites=a.ko.observable(!1),this.order=a.ko.observable(-1),this.template=a.ko.observable(!1),this.searchable=a.ko.observable(!1),this.premium_instruments=a.ko.observable(!1),this.copyable=a.ko.observable(!1),this.everyone_role=a.ko.observable(),this.full_product_url=a.ko.observable(),this.full_source_product_url=a.ko.observable(),this.active_product_url=a.ko.observable(),this.source_product_url=a.ko.observable(),this.versions_count=a.ko.observable(0);var o={author:{create:function(e){return a.ko.observable(new c.default(e.data))}},comments:{create:function(e){return new d.default(e.data)}},favorites:{create:function(e){return new u.default(e.data)}},versions:{create:function(e){return new l.Version(e.data)}},score_latest_version:{create:function(e){return new l.Version(e.data)}}};a.ko.mapping.fromJS(t,o,this),this.createObservables(),this.createComputeds(),this._initialize()}return function(e,t,o){t&&f(e.prototype,t),o&&f(e,o)}(e,[{key:"createObservables",value:function(){for(var e=0;e<h.length;e++){this[(0,s.camelCase)(h[e])]=a.ko.observable(this._getFromMetadata(h[e]))}}},{key:"createComputeds",value:function(){var e=this;this.viewsCountAdjusted=a.ko.computed(function(){return e.views_count()?(0,i.abbreviateNumber)(e.views_count()):""}),this.favesCountAdjusted=a.ko.computed(function(){return e.favorites_count()?(0,i.abbreviateNumber)(e.favorites_count()):""}),this.commentsCountAdjusted=a.ko.computed(function(){return e.comments_count()?(0,i.abbreviateNumber)(e.comments_count()):""}),this.isGoogleCourseWork=a.ko.computed(function(){return!(!e.google_course_work_id()||!e.google_course_id())}),this.isNewlyCreatedScore=a.ko.computed(function(){return!(!e.versions_count||1!==e.versions_count())}),this.scoreType=a.ko.computed(function(){return e.template()?"template":e.searchable()?"public":e.everyone_role()&&"none"!=e.everyone_role()?"shared":"private"}),this.userIsAuthor=a.ko.computed(function(){return a.NF.session.current_user()&&e.author()&&a.NF.session.current_user().external_id()==e.author().external_id()}),this.versionId=a.ko.computed(function(){return e.version()?e.version().version_id():e.versions_count&&e.versions_count()}),this.historical=a.ko.computed(function(){return e.version()&&e.versions_count&&e.version().version_id()!=e.versions_count()})}},{key:"_initialize",value:function(){this.coverArt(new r.default(this.cover_art_url(),{id:this.cover_art_id(),overlay:this.cover_art_directive()}))}},{key:"_getFromMetadata",value:function(e){return void 0!==this.metadata&&this.metadata.hasOwnProperty(e)?this.metadata[e]():null}},{key:"_now",value:function(){return(new Date).getTime()}},{key:"_localDraftKey",value:function(){return"_nf_draft_"+this.external_id()}},{key:"_isLocalDraftKey",value:function(e){return e.match(/^_nf_draft_/)}},{key:"hasLocalDraft",value:function(){if(a.NF.hasStorage&&a.NF.session.current_user()){var e=localStorage.getItem(this._localDraftKey());if(e){var t=a.ko.mapping.fromJSON(e);return!t.user_id||t.user_id()==a.NF.session.current_user().external_id()}}return!1}},{key:"hasUnsavedChanges",value:function(){return this.hasLocalEdits()||this.hasLocalDraft()}},{key:"_localEditsKey",value:function(){return"_nf_localEdits_"+this.external_id()}},{key:"_isLocalEditsKey",value:function(e){return e.match(/^_nf_localEdits_/)}},{key:"hasLocalEdits",value:function(){var e=localStorage.getItem(this._localEditsKey());if(e){var t=JSON.parse(e);return null!=t.draft||t.edits.length>0}return!1}},{key:"reapLocalEdits",value:function(){var e=[];if(a.NF.hasStorage)for(var t=0,o=localStorage.length;t<o;++t){var r=localStorage.key(t),n=null;if(this._isLocalEditsKey(r)&&r!=this._localEditsKey()?n=function(e){return e.updatedAt}:this._isLocalDraftKey(r)&&r!=this._localDraftKey()&&(n=function(e){return e.timestamp}),n){var i=null;try{i=n(JSON.parse(localStorage.getItem(r)))}catch(e){}(!i||this._now()-i>2592e6)&&e.push(r)}}if(e.length)for(var s=0,l=e.length;s<l;++s)localStorage.removeItem(e[s])}},{key:"getMetadata",value:function(){for(var e={},t=0;t<h.length;t++){var o=(0,s.camelCase)(h[t]);this[o]()&&(e[h[t]]=this[o]())}return e}},{key:"fromLibrary",value:function(){return this.from_library&&null!=this.from_library()}},{key:"fromInactiveLibrary",value:function(){return this.from_library&&"inactive"==this.from_library()}},{key:"scoreViewURI",value:function(){return this.contentLibraryId()?a.NF.paths.viewLibraryScore({scoreId:this.external_id(),contentLibraryId:this.contentLibraryId()}):a.NF.paths.editScore({scoreId:this.external_id()})}},{key:"restrictFormat",value:function(){return!!n.LARGE_FORMATS.includes(this.format())&&(this.format(null),!0)}}]),e}();t.default=m,a.Noteflight.Score=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreFacets=t.LARGE_FORMATS=t.FORMATS=void 0;var r=o(0);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=["rock","pop","classical","jazz","hipHop","contest","worship","film","musicals","games","latin","standards","country","folk","blues","opera","world","children","christmas","wedding","holiday"],a=["solo","duet","smallEnsemble","largeEnsemble","concertBand","jazzEnsemble","orchestra","pianoVocal","pianoVocalGuitar","leadSheet","worksheet","etude","other","choral","choralSatb","choral4","choralSab","choralSsa","choral3","choral2","choralTtbb","choralUnison"];t.FORMATS=a;t.LARGE_FORMATS=["largeEnsemble","concertBand","orchestra"];var s=[10,20,30],l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.genres=ko.observableArray([]),this.difficultyLevels=ko.observableArray([]),this.formats=ko.observableArray([]),this.resource=r.resource,this.initializeFacets()}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"alphabetizeGenres",value:function(){for(var e=0;e<i.length;e++)this.genres.push({label:(0,r.resource)("genre."+i[e]),value:i[e]});this.genres.sort(function(e,t){return e.label===t.label?0:e.label<t.label?-1:1})}},{key:"initializeFacets",value:function(){this.alphabetizeGenres();for(var e=0;e<s.length;e++)this.difficultyLevels.push({label:(0,r.resource)("difficultyLevel."+s[e]),value:s[e]});for(var t=0;t<a.length;t++)this.formats.push({label:(0,r.resource)("format."+a[t]),value:a[t]})}}]),e}();t.ScoreFacets=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(20),n=function(e){return e&&e.__esModule?e:{default:e}}(o(43)),i=o(6);var a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o={author:{create:function(e){return i.ko.observable(new n.default(e.data))}}};i.ko.mapping.fromJS(t,o,this),this.createdDate=(0,r.observableRelativeTime)(this.created()),this.blocked_at||(this.blocked_at=i.ko.observable()),this.blockedDate=(0,r.observableRelativeTime)(this.blocked_at())};t.default=a,i.NF.Comment=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scorePurchaseFormSignInSelector=t.scorePurchaseFormShoppingCartSelector=t.scorePurchaseSelector=void 0;var r=o(12),n=o(17),i=o(41),a=(0,r.createSelector)(n.editorContentModelSelector,n.editorPurchaseInfoSelector,i.currentUserSelector,function(e,t,o){return{contentModel:e,purchaseInfo:t,currentUser:o}});t.scorePurchaseSelector=a;var s=(0,r.createSelector)(n.editorContentModelSelector,n.editorPurchaseInfoSelector,function(e,t){return{contentModel:e,purchaseInfo:t}});t.scorePurchaseFormShoppingCartSelector=s;var l=(0,r.createSelector)(n.editorContentIdSelector,n.editorAuthorSelector,function(e,t){return{contentId:e,author:t}});t.scorePurchaseFormSignInSelector=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(o(4)),n=p(o(13)),i=o(2),a=o(0),s=o(8),l=p(o(42)),c=o(5),u=o(31),d=o(3);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=m(this,g(t).call(this)),self.reporter=new l.default,e.initializeObservables(),e.initializeComputeds(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,n.default),function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(t,[{key:"initializeObservables",value:function(){var e=this;this.email=ko.observable(""),this.emailSentAgain=ko.observable(!1),this.emailAlreadyExists=ko.observable(),this.emailContainsInvalidCharacters=ko.observable(),this.captchaCompleted=ko.observable(!1),this.termsAccepted=ko.observable(!1),this.acceptTermsError=ko.observable(!1),this.showEmailError=ko.observable(!1),this.emailErrorMessage=ko.observable(""),this.showCaptchaError=ko.observable(!1),this.signupComplete=ko.observable(!1),this.email.subscribe(function(){e.showEmailError(!1),e.emailCheck()}),this.termsAccepted.subscribe(function(t){t&&e.acceptTermsError(!1)}),this.captchaCompleted.subscribe(function(t){t&&e.showCaptchaError(!1)})}},{key:"initializeComputeds",value:function(){this.separatorClass=ko.computed(function(){return NF.IsPhoneLayout()?"":"loginOrSeparatorContainerVertical"})}},{key:"createCaptcha",value:function(){var e=this;setTimeout(function(){window.grecaptcha.render("reCaptcha",{sitekey:s.GOOGLE_SITE_KEY,callback:function(t){NF.apiService.recaptchaVerification((0,a.resource)("action.validating"),function(t){t?e.captchaCompleted(!0):r.default.publish(c.REPORTER_ADD_ERROR,{code:"resource.errorsValidating",message:(0,a.resource)("errors.errorValidating")})},{token:t},{})}})},50)}},{key:"showLoginDialog",value:function(){this.cancel(),Noteflight.appViewModel.showLoginForm()}},{key:"signupWithGoogle",value:function(){return!(!this.validateTermsAcceptance()||!(0,u.verifyCookiesEnabled)())&&(NF.analytics.trackEvent("conversion","signup_click_google",NF.currentRouteName),(0,i.navigate)("/auth/google/?external_sign_up=true"),!0)}},{key:"signupWithFacebook",value:function(){return!(!this.validateTermsAcceptance()||!(0,u.verifyCookiesEnabled)())&&(NF.analytics.trackEvent("conversion","signup_click_facebook",NF.currentRouteName),(0,i.navigate)("/auth/facebook/?external_sign_up=true"),!0)}},{key:"signup",value:function(){r.default.publish(c.REPORTER_REMOVE),this.validateEmail()&&this.validateTermsAcceptance()&&this.validateCaptchaCompletion()&&(this.sendEmail(),this.signupComplete()||(this.signupComplete(!0),NF.analytics.trackEvent("conversion","signup_email",NF.currentRouteName)))}},{key:"sendEmail",value:function(){NF.apiService.signupEmail((0,a.resource)("session.sendingEmail"),function(){r.default.publish(c.REPORTER_REMOVE)},{email:this.email()},{})}},{key:"sendEmailAgain",value:function(){this.emailSentAgain(!0),this.signup()}},{key:"handleKeyUp",value:function(e,t){if(void 0!==t.keyCode)switch(t.keyCode.toString()){case"13":this.captchaCompleted()&&this.signup();break;case"27":this.cancel();break;default:r.default.publish(c.REPORTER_REMOVE)}return!0}},{key:"initialize",value:function(){this.createCaptcha()}},{key:"validateEmail",value:function(){return this.email().trim()?NF.isValidEmail(this.email().trim())?this.emailAlreadyExists()?(this.showEmailError(!0),this.emailErrorMessage((0,a.resource)("errors.emailAlreadyExists")),!1):!this.emailContainsInvalidCharacters()||(this.showEmailError(!0),this.emailErrorMessage((0,a.resource)("errors.emailContainsInvalidCharacters")),!1):(this.showEmailError(!0),this.emailErrorMessage((0,a.resource)("errors.invalidEmail")),!1):(this.showEmailError(!0),this.emailErrorMessage((0,a.resource)("errors.missingEmailAddress")),!1)}},{key:"validateTermsAcceptance",value:function(){return!!this.termsAccepted()||(this.acceptTermsError(!0),!1)}},{key:"validateCaptchaCompletion",value:function(){return!!this.captchaCompleted()||(this.showCaptchaError(!0),!1)}},{key:"emailCheck",value:function(){var e=this;NF.apiService.checkEmailUseability("",function(t){e.emailAlreadyExists(t.email_taken),e.emailContainsInvalidCharacters(t.invalid_chars)},{email:this.email()},{})}},{key:"show",value:function(){(0,d.createAndShowDialog)({viewModel:this,templateName:"dialogs/signup"})}}]),t}();t.default=v},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.PureComponent),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("div",{className:"inputWithLabel"},r.default.createElement("input",{name:this.props.inputId,type:"checkbox",checked:this.props.checked,id:this.props.inputId,onChange:this.props.changeHandler}),r.default.createElement("label",{className:"checkboxDescription",htmlFor:this.props.inputId},this.props.label))}}]),t}();t.default=u,u.propTypes={inputId:n.default.string.isRequired,label:n.default.string.isRequired,checked:n.default.bool.isRequired,changeHandler:n.default.func.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=a(o(18)),i=a(o(205));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this,e))).state={open:o.props.openByDefault},o.handleCheckboxChange=o.handleCheckboxChange.bind(d(d(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"handleCheckboxChange",value:function(e){if(this.props.usable){var t=e.target.checked;this.setState({open:t}),void 0!==this.props.changeHandler&&this.props.changeHandler(t)}else this.props.unusableHandler()}},{key:"renderSection",value:function(){return this.state.open?r.default.createElement("div",{className:"checkboxSectionContent"},this.props.children):null}},{key:"render",value:function(){return r.default.createElement("div",{className:"checkboxSection"},r.default.createElement(i.default,{inputId:this.props.checkboxId,checked:this.state.open,label:this.props.label,changeHandler:this.handleCheckboxChange}),this.renderSection())}}]),t}();t.default=p,p.defaultProps={usable:!0},p.propTypes={checkboxId:n.default.string.isRequired,label:n.default.string.isRequired,openByDefault:n.default.bool,usable:n.default.bool,changeHandler:n.default.func,unusableHandler:n.default.func}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatComposerField=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===e.length&&0===t.length)return"";var o=!0;if(e.length==t.length){for(var i=0;i<e.length;i++)if(e[i]!=t[i]){o=!1;break}}else o=!1;if(o)return n("Words and Music by ".concat(e.join(", ")));var a="";(0,r.arrayHasContent)(e)&&(a=n("Music by ".concat(e.join(", "))),(0,r.arrayHasContent)(t)&&(a+="\n"));(0,r.arrayHasContent)(t)&&(a+=n("Words by ".concat(t.join(", "))));return a},t.splitStringIntoMultipleLines=n;var r=o(28);function n(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,o=Math.ceil(e.length/t),r=Math.ceil(e.length/o),n=e.split(" "),i="",a=0,s=0;s<n.length;s++){var l=n[s];0!==a&&(i+=" ",a+=1),i+=l,(a+=l.length)>=r&&s<n.length-1&&(i+="\n",a=0)}return i}},function(e,t,o){e.exports=o(7)(36)},function(e,t){var o=1e3,r=60*o,n=60*r,i=24*n,a=365.25*i;function s(e,t,o){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+o:Math.ceil(e/t)+" "+o+"s"}e.exports=function(e,t){t=t||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*a;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?function(e){return s(e,i,"day")||s(e,n,"hour")||s(e,r,"minute")||s(e,o,"second")||e+" ms"}(e):function(e){if(e>=i)return Math.round(e/i)+"d";if(e>=n)return Math.round(e/n)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,o){var r=o(568)("socket.io-parser"),n=o(78),i=o(570),a=o(284),s=o(285);function l(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=l,t.Decoder=d;var c=t.ERROR+'"encode error"';function u(e){var o=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(o+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(o+=e.nsp+","),null!=e.id&&(o+=e.id),null!=e.data){var n=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===n)return c;o+=n}return r("encoded %j as %s",e,o),o}function d(){this.reconstructor=null}function p(e){this.reconPack=e,this.buffers=[]}function f(e){return{type:t.ERROR,data:"parser error: "+e}}l.prototype.encode=function(e,o){(r("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){i.removeBlobs(e,function(e){var o=i.deconstructPacket(e),r=u(o.packet),n=o.buffers;n.unshift(r),t(n)})}(e,o):o([u(e)])},n(d.prototype),d.prototype.add=function(e){var o;if("string"==typeof e)o=function(e){var o=0,n={type:Number(e.charAt(0))};if(null==t.types[n.type])return f("unknown packet type "+n.type);if(t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type){for(var i="";"-"!==e.charAt(++o)&&(i+=e.charAt(o),o!=e.length););if(i!=Number(i)||"-"!==e.charAt(o))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(o+1))for(n.nsp="";++o;){var s=e.charAt(o);if(","===s)break;if(n.nsp+=s,o===e.length)break}else n.nsp="/";var l=e.charAt(o+1);if(""!==l&&Number(l)==l){for(n.id="";++o;){var s=e.charAt(o);if(null==s||Number(s)!=s){--o;break}if(n.id+=e.charAt(o),o===e.length)break}n.id=Number(n.id)}if(e.charAt(++o)){var c=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(o)),u=!1!==c&&(n.type===t.ERROR||a(c));if(!u)return f("invalid payload");n.data=c}return r("decoded %s as %j",e,n),n}(e),t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type?(this.reconstructor=new p(o),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",o)):this.emit("decoded",o);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(o=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",o))}},d.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},p.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=i.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,o){(function(t){var r=o(573);e.exports=function(e){var o=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!o||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!o)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,o(37))},function(e,t,o){var r=o(79),n=o(78);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=i,n(i.prototype),i.prototype.onError=function(e,t){var o=new Error(e);return o.type="TransportError",o.description=t,this.emit("error",o),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calibratedLatencyGetter=function(){return f},t.default=void 0;var r=o(0),n=o(60),i=o(237),a=o(8),s=function(e){return e&&e.__esModule?e:{default:e}}(o(13));function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=0,h=function(e){function t(e,o){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this))).editor=e,i.title=o,i.calibrator=null,i.showPrompt=ko.observable(!0),i.enabled=ko.observable(!1),i.canceled=ko.observable(!1),i.calibrated=ko.observable(!1),i.startButtonVisible=ko.observable(!0),i.skipButtonVisible=ko.observable(!0),i.doneButtonVisible=ko.observable(!1),i.tryAgainButtonVisible=ko.observable(!1),i.latencyText=ko.observable((0,r.resource)("content.calibrateLat.prepare")),i.currentDevice=ko.observable("--"),(0,n.getCurrentInputDevice)(function(e){this.currentDevice(e.label)}.bind(p(p(i)))),i.isMicText=ko.computed(function(){return(0,r.resource)("content.calibrateLat.isMicDevice",i.currentDevice())}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,s.default),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"init",value:function(){this.calibrator=(0,i.createLatencyCalibrator)(this.editor.scoreApi.getSynthesisContext().context)}},{key:"start",value:function(){this.startButtonVisible(!1),this.skipButtonVisible(!0),this.doneButtonVisible(!1),this.tryAgainButtonVisible(!1),this.latencyText((0,r.resource)("content.calibrateLat.calibrating")),this.calibrator.startCalibration(),this.calibrator.onComplete=this.postCalibration.bind(this)}},{key:"done",value:function(){this.cancel()}},{key:"cancelDialog",value:function(){this.cancel()}},{key:"cancelTest",value:function(){this.showPrompt(!1),this.storeLatency(0),this.canceled(!0)}},{key:"enableTest",value:function(){this.showPrompt(!1),this.enabled(!0)}},{key:"postCalibration",value:function(e){var t;e.success?(this.storeLatency(e.latency),this.doneButtonVisible(!0),this.skipButtonVisible(!1),t="success"):(this.tryAgainButtonVisible(!0),t="failure"),this.latencyText((0,r.resource)("content.calibrateLat.".concat(t)))}},{key:"storeLatency",value:function(e){NF.hasStorage&&localStorage.setItem(a.CALIBRATED_LATENCY_STORAGE_KEY,e),f=e}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(57);var r=function(e){return e&&e.__esModule?e:{default:e}}(o(304)),n=o(8),i=o(0);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s={public:"access.openDetail",members_only:"access.membersOnlyDetail"},l={open:"admission.openDetail",approval_required:"admission.approvalRequiredDetail",invitation_only:"admission.invitationOnlyDetail",assignment:"admission.assignmentDetail"},c=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group=t,this.groupLogo=new r.default(t.group_logo_id()),this.groupLogo.groupId(t.id());var n=null===this.group.id()?"action.creating":"action.saving";this.serviceReporter=new Noteflight.ServiceReporterViewModel((0,i.resource)(n)),this.group.name.subscribe(function(e){o.serviceReporter.clearErrors()}),this.initializePolicySelectors()}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"initializePolicySelectors",value:function(){var e=this;this.accessOptions=ko.observableArray([{value:"public",label:(0,i.resource)("access.open")},{value:"members_only",label:(0,i.resource)("access.membersOnly")}]),this.admissionOptions=NF.session.community().default_community()?ko.observableArray([{value:"open",label:(0,i.resource)("admission.open")},{value:"approval_required",label:(0,i.resource)("admission.approvalRequired")},{value:"invitation_only",label:(0,i.resource)("admission.invitationOnly")}]):ko.observableArray([{value:"open",label:(0,i.resource)("admission.open")},{value:"assignment",label:(0,i.resource)("admission.assignment")}]),this.accessDetail=ko.computed(function(){var t=s[e.group.access_policy()];return t?(0,i.resource)(t):""}),this.admissionDetail=ko.computed(function(){var t=l[e.group.admission_policy()];return t?(0,i.resource)(t):""})}},{key:"validateGroup",value:function(){return this.serviceReporter.init(),this.serviceReporter.clearErrors(),this.group.name(this.group.name().trim()),this.group.name().length<n.GROUP_NAME_MIN?(this.serviceReporter.errors.push({message:(0,i.resource)("errors.groupNameTooShort")}),!1):!(this.group.name().length>n.GROUP_NAME_MAX)||(this.serviceReporter.errors.push({message:(0,i.resource)("errors.groupNameTooLong")}),!1)}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.groupId=ko.observable(null),this.name=ko.observable(""),this.description=ko.observable(""),this.logo_id=ko.observable(null),this.hostname=ko.observable(""),this.sso_username=ko.observable(""),this.default_proxy_url=ko.observable(""),this.allow_anonymous_view=ko.observable(!1),this.sso_key=ko.observable("implement me"),this.courses=ko.observableArray([]),ko.mapping.fromJS(t,{},this),this.originalName=ko.observable(this.name()),this.nameChanged=ko.computed(function(){return o.originalName()!=o.name()}),this.logo=ko.computed(function(){return o.logo_id()?"".concat("/api/1.0/groups/:group_id/logo").concat(o.logo_id()):"".concat(NF.asset("images/defaultGroup.png"))})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(57);var r=o(8),n=o(5),i=function(e){return e&&e.__esModule?e:{default:e}}(o(304)),a=o(0);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.site=t,this.createNewSite=ko.observable(null===this.site.groupId()),this.groupLogo=new i.default(this.site.groupId()),this.site.groupId()?this.groupLogo.createImageUploader(this.groupLogo.url()):this.groupLogo.createImageUploader(NF.asset("images/defaultGroup.png")),this.ssoSite=ko.computed(function(){return o.createNewSite()&&NF.session.current_user()?NF.session.current_user().sso_enabled():o.site.site_type()==r.SITE_TYPE_LTI}),this.site.name().length>0&&this.site.hostname(this.generateHostname(this.site.name())),this.site.name.subscribe(function(e){PubSub.publish(n.REPORTER_CLEAR_ERRORS),o.site.hostname(o.generateHostname(e)),o.site.site_type()!=r.SITE_TYPE_LTI&&o.site.site_type()!=r.SITE_TYPE_GC||o.site.sso_username(o.generateOwnerUsername(e))}),this.showNameWarning=ko.computed(function(){return!o.createNewSite()&&o.site.nameChanged()}),this.showGoogleClassroomFields=ko.computed(function(){return NF.session.community_member().connected_to_google()&&NF.session.current_user().sso_enabled()&&o.site.site_type()==r.SITE_TYPE_GC}),this.showSsoReadOnlyFields=ko.computed(function(){return!o.createNewSite()&&o.site.site_type==r.SITE_TYPE_LTI}),this.memberCount=ko.computed(function(){return NF.session.current_user()&&NF.session.current_user().max_total_scc_member_count?NF.session.current_user().max_total_scc_member_count():0})}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"generateHostname",value:function(e){if(!e)return"";var t=NF.slugify(e);return this.site.site_type()==r.SITE_TYPE_LTI?t+NF.config.ssoHostnameSuffix:this.site.site_type()==r.SITE_TYPE_GC?t+NF.config.gcHostnameSuffix:t+NF.config.sccHostnameSuffix}},{key:"generateOwnerUsername",value:function(e){return"".concat(e," Admin")}},{key:"validateSite",value:function(){if(PubSub.publish(n.REPORTER_CLEAR_ERRORS),this.site.name(this.site.name().trim()),this.site.name().length<r.GROUP_NAME_MIN)return PubSub.publish(n.REPORTER_ADD_ERROR,{code:"errors.groupNameTooShort",message:(0,a.resource)("errors.groupNameTooShort")}),!1;if(this.site.name().length>r.GROUP_NAME_MAX)return PubSub.publish(n.REPORTER_ADD_ERROR,{code:"errors.groupNameTooLong",message:(0,a.resource)("errors.groupNameTooLong")}),!1;if(this.site.site_type()==r.SITE_TYPE_LTI){if(!this.site.default_proxy_url())return PubSub.publish(n.REPORTER_ADD_ERROR,{code:"errors.loginURLofLMSSystemRequired",message:(0,a.resource)("errors.loginURLofLMSSystemRequired")}),!1;var e=this.site.default_proxy_url();/^https?:\/\//i.test(e)||this.site.default_proxy_url("http://"+e)}return!0}}]),e}();t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCommunityGroup=S,t.GroupsListingViewModel=t.GroupsViewModel=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(62)),n=o(16),i=o(2),a=o(0);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,o){return t&&c(e.prototype,t),o&&c(e,o),e}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?m(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e){function t(){var e;return l(this,t),e=d(this,p(t).call(this)),(0,n.setTitleAndMeta)(m(m(e)),"title.groups","meta.groups"),e.activeHeaderTag("community"),e.doesSearch(!0),e.showSearchBarForMobile(!0),e.groupsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.yourGroups"}],"_nf_tip_your_groups.hidden"),e.lastState=null,e.lastSearchTarget=null,e.searching=ko.observable(!1),e.searchConfiguration={group:4,score:2,marketplace_with_contribs:2},e.initializeObservables(),e.initializeComputeds(),e}return f(t,Noteflight.GenericPageViewModel),u(t,[{key:"initializeObservables",value:function(){this.templateName=ko.observable("content/groups"),this.hideNewGroup=ko.observable(!1),this.name=ko.observable("groups"),this.communityGroup=ko.observable(new r.default(S())),this.currentListing=ko.observable(null),this.state=ko.observable(""),this.allListing=new y(this),this.yourListing=new _(this)}},{key:"initializeComputeds",value:function(){var e=this;this.label=ko.computed(function(){if(e.currentListing())return e.currentListing().title()}),this.searchForTitle=ko.computed(function(){return(0,a.resource)("content.searchFor",e.searchTarget())}),ko.computed(function(){e.searchTarget(),e.state(),e.searchTarget()==e.lastSearchTarget&&e.state()==e.lastState||(e.lastSearchTarget=e.searchTarget(),e.lastState=e.state(),e.updateListing(),e.currentListing()&&(e.currentListing().clear(),e.currentListing().activate()))}).extend({throttle:10})}},{key:"search",value:function(e){e?(0,i.navigate)(this.currentListing().searchPath({searchTarget:e})):this.clearSearch()}},{key:"clearSearch",value:function(){this.searchTarget(null),(0,i.navigate)(this.currentListing().rootPath())}},{key:"updateListing",value:function(){switch(this.state()){case"all":case"allFiltered":this.allListing.switching(!0),this.currentListing(this.allListing);break;case"yours":case"yoursFiltered":this.yourListing.switching(!0),this.currentListing(this.yourListing)}}},{key:"onNavigate",value:function(){}},{key:"checkAtBottom",value:function(e,t){this.currentListing()&&this.currentListing().checkAtBottom(e,t)}}]),t}();t.GroupsViewModel=g;var b=function(){function e(t,o){l(this,e),this.group=o,this.initializeComputeds()}return u(e,[{key:"initializeComputeds",value:function(){var e=this;this.groupURL=ko.computed(function(){return(0,i.path)("viewGroup",{groupId:e.group.id()})})}},{key:"goToGroup",value:function(){return(0,i.navigate)((0,i.path)("viewGroup",{groupId:this.group.id()}))}}]),e}(),v=function(e){function t(e){var o;return l(this,t),(o=d(this,p(t).call(this))).parent=e,o.virginal=!0,o.listingFragment="fragments/groupsListing",o.fetchParams={},o.fetching=ko.observable(!1),o.loadingMessage=(0,a.resource)("action.loading"),o.savedSortOrder=null,o.switching=ko.observable(!1),o.count=ko.observable(0),o.remaining=ko.observable(0),o.startIndex=ko.observable(0),o.sortOrder=ko.observable(),o.sortable=ko.observable(!0),o.groups=ko.observableArray(),o.showCreateNewGroup=ko.computed(function(){return o.parent&&o.parent.currentListing()&&!o.parent.hideNewGroup()&&(NF.session.community().default_community()||NF.session.community().permissions.can_create_group())}),o.sortOrder.subscribe(function(e){o.readyToShow()&&!o.switching()&&o.reset()}),o.switching.subscribe(function(e){e&&(o.savedSortOrder=o.sortOrder())}),o}return f(t,Noteflight.ColumnLayoutViewModel),u(t,[{key:"checkAtBottom",value:function(e,t){this.remaining()&&!this.fetching()&&($(t.target).find(".moreItems").position().top-$(t.target).scrollTop()<=$(t.target).outerHeight()&&this.fetchGroups())}},{key:"createNewGroupUrl",value:function(){return Noteflight.paths.newGroup()}},{key:"processFetchedData",value:function(e){for(var t=0;t<e.groups.length;t++)(NF.session.community().default_community()||"community"!=e.groups[t].group_type)&&this.groups.push(new b(this,new r.default(e.groups[t])));this.fetching(!1),this.count(e.count),this.remaining(e.remaining),this.startIndex(Math.min(this.startIndex()+36,this.count()))}},{key:"fetchGroups",value:function(){var e={start_index:this.startIndex(),max_count:36,order:this.sortOrder()};this.parent&&this.parent.searchTarget()&&(e.query=this.parent.searchTarget()),$.extend(e,this.fetchParams),"function"==typeof this.targetId&&(e.user_id=this.targetId()),this.fetching(!0),NF.apiService.fetchAllGroups((0,a.resource)("action.loading"),this.processFetchedData.bind(this),e)}},{key:"clear",value:function(){this.groups.removeAll(),this.startIndex(0),this.remaining(0),this.virginal=!0}},{key:"reset",value:function(){this.clear(),this.fetchGroups(),this.virginal=!1}},{key:"activate",value:function(){this.sortOrder(this.savedSortOrder),this.virginal&&this.reset(),this.switching(!1),this.readyToShow(!0)}}]),t}();t.GroupsListingViewModel=v;var y=function(e){function t(e){var o;return l(this,t),(o=d(this,p(t).call(this,e))).parent=e,o.name="allGroups",o.listingType="public",o.fetchParams={},o.readyToShow=ko.observable(!1),o.sortOrder("popular"),o.sortOptions=ko.observableArray([{order:"title",label:(0,a.resource)("order.title")},{order:"most_recent",label:(0,a.resource)("order.mostRecent")},{order:"popular",label:(0,a.resource)("order.popular")}]),o.targetId=ko.computed(function(){if(o.parent.userId)return o.parent.userId()}),o.tabHref=ko.computed(function(){return o.parent.searchTarget()?o.searchPath({searchTarget:o.parent.searchTarget()}):o.rootPath()}),o.title=ko.computed(function(){return NF.session.community().default_community()?(0,a.resource)("content.noteflightGroupsTitle"):(0,a.resource)("content.communityGroupsTitle",NF.session.community().name())}),o}return f(t,v),u(t,[{key:"rootPath",value:function(){return Noteflight.paths.groups()}},{key:"searchPath",value:function(e){return Noteflight.paths.searchAllGroups(e)}}]),t}(),_=function(e){function t(e){var o;return l(this,t),(o=d(this,p(t).call(this,e))).parent=e,o.name="yourGroups",o.listingType="personal",o.fetchParams={user_id:NF.session.current_user()?NF.session.current_user().external_id():null},o.readyToShow=ko.observable(!1),o.sortOrder("title"),o.sortOptions=ko.observableArray([{order:"title",label:(0,a.resource)("order.title")},{order:"most_recent",label:(0,a.resource)("order.mostRecent")},{order:"popular",label:(0,a.resource)("order.popular")}]),o.tabHref=ko.observable(o.rootPath()),o.title=ko.computed(function(){return NF.session.community().default_community()?(0,a.resource)("content.myGroups"):(0,a.resource)("content.myClassesAndGroups")}),o}return f(t,v),u(t,[{key:"rootPath",value:function(){return Noteflight.paths.yourGroups()}}]),t}();function S(){if(!NF.session.user_groups)return null;var e=NF.session.user_groups.groups();if(e)for(var t=0;t<e.length;t++)if(e[t].is_community_group())return e[t];return null}Noteflight.getCommunityGroup=S,(0,i.addRoute)("groups","/groups#/all",g,{state:"all",searchTarget:null,searching:!1}),(0,i.addRouteAlias)("r2","groups","/groups#"),(0,i.addRoute)("yourGroups","/groups#/yours",g,{state:"yours",searchTarget:null,searching:!1}),(0,i.addRoute)("searchAllGroups","/groups_search:?searchTarget:#",g,{state:"allFiltered",searching:!0})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(62)),n=o(2);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a={openingKey:"hlcOpeningKey",format:"hlcFormat",genre:"hlcGenre",audioref:"hlcAudioref",arranger:"hlcArranger",contest:"hlcContest",libraryGrade:"hlcGrade"},s=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ko.mapping.fromJS(t,{},this);var r=this.tags.columns();this.tags.columns([]),r.forEach(function(e){o.tags.columns.push(a[e]||e)}),this.instanceGroup=null,this.formattedMemberCount=null,this.deleted=null,this.archived=null,this.parseMasterGroup(t.master_group),this.parseInstanceGroup(t.instance_group),this.isActiveMember=ko.observable(t.permissions.active_library_member||!1),this.isAdmin=ko.observable(t.permissions.is_admin||!1),this.canAddMembers=ko.observable(t.permissions.can_add_members||!1),this.path=ko.observable(this.id?(0,n.path)("viewLibrary",{libraryId:this.id()}):null),this.purchased=ko.observable(t.allowed_user_count>0),this.gated=ko.observable(t.gated),this.canAddMembersButIsNotMember=ko.computed(function(){return NF.roles.isAtLeastSiteTeacher()&&!o.isActiveMember()&&o.purchased()}),this.camelCaseName=ko.computed(function(){return o.name.replace(/\s(.)/g,function(e){return e.toUpperCase()}).replace(/\s/g,"").replace(/^(.)/,function(e){return e.toLowerCase()})})}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"parseMasterGroup",value:function(e){this.masterGroup=new r.default(e),this.name=this.masterGroup.name(),this.imageURL=this.masterGroup.imageURL}},{key:"parseInstanceGroup",value:function(e){e&&(this.instanceGroup=new r.default(e),this.formattedMemberCount=this.instanceGroup.formattedMemberCount,this.deleted=this.instanceGroup.deleted,this.archived=this.instanceGroup.archived)}},{key:"updateInstanceGroup",value:function(e){ko.mapping.fromJS(e,{},this.instanceGroup)}},{key:"navigateToPurchase",value:function(){var e="/commerce/purchase_learn?url_years=1&url_cls="+this.code()+"%2C10";Noteflight.appViewModel.changeCommunity(NF.defaultHostname,e)}}]),e}();t.default=s},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partItem=t,this.track=null,this.username=ko.observable(),this.avatarUri=ko.observable(),this.showInfoButton=ko.observable(!1),this.showDeleteButton=ko.observable(!1),this.showEditButton=ko.observable(!1),this.isInfoShown=ko.observable(!1),this.type=ko.observable(),this.muted=ko.observable(!1),this.isWaveformShown=ko.observable(!1),this.clips=ko.observableArray([]),this.lastRecorded=ko.observable(),this.showToggleWaveform=ko.observable(!1)}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"toggleShowTrackInfo",value:function(){throw"not implemented"}},{key:"deleteTrack",value:function(){throw"not implemented"}},{key:"editTrack",value:function(){throw"not implemented"}},{key:"toggleTrack",value:function(){throw"not implemented"}},{key:"toggleWaveform",value:function(){throw"not implemented"}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductPalette=t.ProductOwnedPaletteConfig=t.ProductOwnedHeaderPaletteRightConfig=t.ProductOwnedHeaderPaletteLeftConfig=t.ProductPreviewHeaderPaletteRightConfig=t.ProductPreviewHeaderPaletteLeftConfig=void 0;var r=o(6),n=o(2),i=o(0),a=o(19),s=o(14),l=o(221);t.ProductPreviewHeaderPaletteLeftConfig={controls:[{id:"marketplace",type:"urlButton",route:"marketplace",visibleFunction:"currentUserIsPreviewingProduct",invisibleFunction:"embedded",styleClasses:"horizontalButton"},{type:"separator"},{id:"beginning",type:"actionButton",actionFunction:"beginningPlayScore",visibleFunction:"scorePlaying"},{id:"play",type:"actionButton",actionFunction:"playScore",visibleFunction:"showPlayButton"},{id:"pause",type:"actionButton",actionFunction:"pausePlayScore",visibleFunction:"showPauseButton"},{id:"stop",type:"actionButton",actionFunction:"stopPlayScore",visibleFunction:"scorePlaying"}]};t.ProductPreviewHeaderPaletteRightConfig={controls:[{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled",anonymousDropClass:"hideAt350"},{id:"fullScreen",type:"actionButton",actionFunction:"productToggleFullScreen",toggleIconClasses:["expand","compress"],invisibleFunction:"hideFullScreen"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",visibleFunction:"showScoreDetailsPanelButton",invisibleFunction:"scorePlaying"}]};t.ProductOwnedHeaderPaletteLeftConfig={controls:[{id:"beginning",type:"actionButton",actionFunction:"beginningPlayScore",visibleFunction:"scorePlaying"},{id:"play",type:"actionButton",actionFunction:"playScore",visibleFunction:"showPlayButton"},{id:"pause",type:"actionButton",actionFunction:"pausePlayScore",visibleFunction:"showPauseButton"},{id:"stop",type:"actionButton",actionFunction:"stopPlayScore",visibleFunction:"scorePlaying"}]};t.ProductOwnedHeaderPaletteRightConfig={controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",visibleFunction:"showInstrumentsButton",dropClass:"hideAt400"},{id:"view",type:"viewControl",anonymousDropClass:"hideAt450"},{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled",anonymousDropClass:"hideAt350"},{id:"fullScreen",type:"actionButton",actionFunction:"productToggleFullScreen",toggleIconClasses:["expand","compress"]},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",visibleFunction:"showScoreDetailsPanelButton",anonymousDropClass:"hideAt400"}]};t.ProductOwnedPaletteConfig={sections:[{id:"score",expanded:!0,controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments"},{id:"concertPitch",type:"toggleButton",valueFunction:"concertPitch",actionFunction:"doEditorAction"},{id:"toggleFormattingPanel",type:"toggleButton",valueFunction:"showFormatting"},{type:"separator"},{id:"pageSetup",type:"actionButton",actionFunction:"doEditorAction"},{id:"print",type:"actionButton",actionFunction:"doEditorAction"},{id:"export",type:"actionButton",actionFunction:"doEditorAction"},{id:"saveCopy",type:"actionButton",actionFunction:"createProductCopy"}]},{id:"pitch",expanded:!0,showOnMobile:!1,controls:[{id:"transpose",type:"actionButton",actionFunction:"transpose"}]},{id:"sound",expanded:!0,showOnMobile:!1,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome"},{id:"performanceSpeed",type:"percentControl",buttonImageCSS:"speedAmount",min:50,max:200,step:5,valueFunction:"performanceSpeed"}]},{id:"view",expanded:!0,showOnMobile:!1,controls:[{id:"view",type:"viewControl",userGuideGroup:"viewPalette"},{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled"},{type:"separator"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",invisibleFunction:"embedded"},{type:"separator"},{id:"fullScreen",type:"actionButton",actionFunction:"productToggleFullScreen",toggleIconClasses:["expand","compress"]},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"},{id:"pageTurner",type:"actionButton",actionFunction:"doEditorAction"}]}]};t.ProductPalette=function(e,t){var o=this;o.editor=t,o.scorePlaying=t.scoreState.isPlaying,o.scorePaused=t.scoreState.isPaused,o.showPlayButton=r.ko.computed(function(){return!o.editor.scoreState.isPlaying()||o.editor.scoreState.isPaused()}),o.showPauseButton=r.ko.computed(function(){return o.editor.scoreState.isPlaying()&&!o.editor.scoreState.isPaused()}),Noteflight.ScoreCommonPalette.call(o,e,o.editor),o.initializeConnectedProperties=function(){o.contentId=r.ko.observable(),o.currentUserIsPreviewingProduct=r.ko.observable(),(0,s.connect)(l.productPaletteSelector,{})(o)},o.initializeConnectedProperties(),o.hideFullScreen=r.ko.computed(function(){return(0,a.isPhoneLayoutOrSmaller)()}),o.showScoreDetailsPanelButton=r.ko.computed(function(){return!o.currentUserIsPreviewingProduct()||!NF.appViewModel.fullscreen()&&((0,a.isMobileOrSmallerLayout)()||o.editor.scoreEditor.contentPolicy().can_edit)}),o.playScore=function(){o.scorePlaying()||o.scorePaused()?o.editor.scoreApi.resume():o.editor.scoreApi.play()},o.pausePlayScore=function(){o.editor.scoreApi.pause()},o.stopPlayScore=function(){o.editor.scoreApi.stop()},o.transpose=function(){o.editor.scoreDialogs.transpose()},o.productToggleFullScreen=function(){var e=!NF.appViewModel.fullscreen();NF.appViewModel.fullscreen(e),o.toggleFullScreen(e),o.showScoreDetails(!e)},o.createProductCopy=function(){NF.apiService.createProductCopy((0,i.resource)("action.copying"),function(e){return(0,n.navigate)(e.view_score_uri)},{uuid:o.contentId()},{fail:function(){}})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paletteHonchoSelector=t.scoreCommonPaletteSelector=t.productPaletteSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentIdSelector,n.currentUserIsPreviewingProductSelector,function(e,t){return{contentId:e,currentUserIsPreviewingProduct:t}});t.productPaletteSelector=i;var a=(0,r.createSelector)(n.editorIsEditingProductSelector,function(e){return{isEditingProduct:e}});t.scoreCommonPaletteSelector=a;var s=(0,r.createSelector)(n.editorIsEditingProductSelector,n.editorContentTypeSelector,n.currentUserIsAuthorSelector,n.currentUserIsProductOwnerSelector,n.currentUserIsPreviewingProductSelector,function(e,t,o,r,n){return{isEditingProduct:e,contentType:t,currentUserIsAuthor:o,currentUserIsProductOwner:r,currentUserIsPreviewingProduct:n}});t.paletteHonchoSelector=s},,function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(345),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.formResetMixin={_formResetHandler:function(){var t=e(this);setTimeout(function(){var o=t.data("ui-form-reset-instances");e.each(o,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var e=this.form.data("ui-form-reset-instances")||[];e.length||this.form.on("reset.ui-form-reset",this._formResetHandler),e.push(this),this.form.data("ui-form-reset-instances",e)}},_unbindFormResetHandler:function(){if(this.form.length){var t=this.form.data("ui-form-reset-instances");t.splice(e.inArray(this,t),1),t.length?this.form.data("ui-form-reset-instances",t):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(139)],void 0===(i="function"==typeof(r=function(e){return e.fn.labels=function(){var t,o,r,n,i;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),(r=this.attr("id"))&&(t=this.eq(0).parents().last(),i=t.add(t.length?t.siblings():this.siblings()),o="label[for='"+e.ui.escapeSelector(r)+"']",n=n.add(i.find(o).addBack(o))),this.pushStack(n))}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(138)],void 0===(i="function"==typeof(r=function(e){return e.extend(e.expr[":"],{tabbable:function(t){var o=e.attr(t,"tabindex"),r=null!=o;return(!r||o>=0)&&e.ui.focusable(t,r)}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.plugin={add:function(t,o,r){var n,i=e.ui[t].prototype;for(n in r)i.plugins[n]=i.plugins[n]||[],i.plugins[n].push([o,r[n]])},call:function(e,t,o,r){var n,i=e.plugins[t];if(i&&(r||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;n<i.length;n++)e.options[i[n][0]]&&i[n][1].apply(e.element,o)}}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(50),o(223),o(228),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,o){if("hidden"===e(t).css("overflow"))return!1;var r,n=o&&"left"===o?"scrollLeft":"scrollTop";return t[n]>0||(t[n]=1,r=t[n]>0,t[n]=0,r)},_create:function(){var t,o=this.options,r=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!o.aspectRatio,aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),o.autoHide&&e(this.element).on("mouseenter",function(){o.disabled||(r._removeClass("ui-resizable-autohide"),r._handles.show())}).on("mouseleave",function(){o.disabled||r.resizing||(r._addClass("ui-resizable-autohide"),r._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,o=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(o(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),o(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,o,r,n,i,a=this.options,s=this;if(this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),r=this.handles.split(","),this.handles={},o=0;o<r.length;o++)n="ui-resizable-"+(t=e.trim(r[o])),i=e("<div>"),this._addClass(i,"ui-resizable-handle "+n),i.css({zIndex:a.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(i);this._renderAxis=function(t){var o,r,n,i;for(o in t=t||this.element,this.handles)this.handles[o].constructor===String?this.handles[o]=this.element.children(this.handles[o]).first().show():(this.handles[o].jquery||this.handles[o].nodeType)&&(this.handles[o]=e(this.handles[o]),this._on(this.handles[o],{mousedown:s._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(r=e(this.handles[o],this.element),i=/sw|ne|nw|se|n|s/.test(o)?r.outerHeight():r.outerWidth(),n=["padding",/ne|nw|n/.test(o)?"Top":/se|sw|s/.test(o)?"Bottom":/^e$/.test(o)?"Right":"Left"].join(""),t.css(n,i),this._proportionallyResize()),this._handles=this._handles.add(this.handles[o])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){s.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=i&&i[1]?i[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var o,r,n=!1;for(o in this.handles)((r=e(this.handles[o])[0])===t.target||e.contains(r,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var o,r,n,i=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),o=this._num(this.helper.css("left")),r=this._num(this.helper.css("top")),i.containment&&(o+=e(i.containment).scrollLeft()||0,r+=e(i.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:o,top:r},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof i.aspectRatio?i.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var o,r,n=this.originalMousePosition,i=this.axis,a=t.pageX-n.left||0,s=t.pageY-n.top||0,l=this._change[i];return this._updatePrevProperties(),!!l&&(o=l.apply(this,[t,a,s]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(o=this._updateRatio(o,t)),o=this._respectSize(o,t),this._updateCache(o),this._propagate("resize",t),r=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(r)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var o,r,n,i,a,s,l,c=this.options;return this._helper&&(n=(r=(o=this._proportionallyResizeElements).length&&/textarea/i.test(o[0].nodeName))&&this._hasScroll(o[0],"left")?0:this.sizeDiff.height,i=r?0:this.sizeDiff.width,a={width:this.helper.width()-i,height:this.helper.height()-n},s=parseFloat(this.element.css("left"))+(this.position.left-this.originalPosition.left)||null,l=parseFloat(this.element.css("top"))+(this.position.top-this.originalPosition.top)||null,c.animate||this.element.css(e.extend(a,{top:l,left:s})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,o,r,n,i,a=this.options;i={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=i.minHeight*this.aspectRatio,r=i.minWidth/this.aspectRatio,o=i.maxHeight*this.aspectRatio,n=i.maxWidth/this.aspectRatio,t>i.minWidth&&(i.minWidth=t),r>i.minHeight&&(i.minHeight=r),o<i.maxWidth&&(i.maxWidth=o),n<i.maxHeight&&(i.maxHeight=n)),this._vBoundaries=i},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,o=this.size,r=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(o.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(o.height-e.height),e.left=t.left+(o.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,o=this.axis,r=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,i=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,a=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,s=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(o),u=/nw|ne|n/.test(o);return i&&(e.width=t.minWidth),a&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),i&&c&&(e.left=s-t.minWidth),r&&c&&(e.left=s-t.maxWidth),a&&u&&(e.top=l-t.minHeight),n&&u&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,o=[],r=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)o[t]=parseFloat(r[t])||0,o[t]+=parseFloat(n[t])||0;return{height:o[0]+o[2],width:o[1]+o[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,o=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:o.height()-this.outerDimensions.height||0,width:o.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,o=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++o.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var o=this.originalSize;return{left:this.originalPosition.left+t,width:o.width-t}},n:function(e,t,o){var r=this.originalSize;return{top:this.originalPosition.top+o,height:r.height-o}},s:function(e,t,o){return{height:this.originalSize.height+o}},se:function(t,o,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,o,r]))},sw:function(t,o,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,o,r]))},ne:function(t,o,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,o,r]))},nw:function(t,o,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,o,r]))}},_propagate:function(t,o){e.ui.plugin.call(this,t,[o,this.ui()]),"resize"!==t&&this._trigger(t,o,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var o=e(this).resizable("instance"),r=o.options,n=o._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),a=i&&o._hasScroll(n[0],"left")?0:o.sizeDiff.height,s=i?0:o.sizeDiff.width,l={width:o.size.width-s,height:o.size.height-a},c=parseFloat(o.element.css("left"))+(o.position.left-o.originalPosition.left)||null,u=parseFloat(o.element.css("top"))+(o.position.top-o.originalPosition.top)||null;o.element.animate(e.extend(l,u&&c?{top:u,left:c}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseFloat(o.element.css("width")),height:parseFloat(o.element.css("height")),top:parseFloat(o.element.css("top")),left:parseFloat(o.element.css("left"))};n&&n.length&&e(n[0]).css({width:r.width,height:r.height}),o._updateCache(r),o._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,o,r,n,i,a,s,l=e(this).resizable("instance"),c=l.options,u=l.element,d=c.containment,p=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;p&&(l.containerElement=e(p),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),o=[],e(["Top","Right","Left","Bottom"]).each(function(e,r){o[e]=l._num(t.css("padding"+r))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-o[3],width:t.innerWidth()-o[1]},r=l.containerOffset,n=l.containerSize.height,i=l.containerSize.width,a=l._hasScroll(p,"left")?p.scrollWidth:i,s=l._hasScroll(p)?p.scrollHeight:n,l.parentData={element:p,left:r.left,top:r.top,width:a,height:s}))},resize:function(t){var o,r,n,i,a=e(this).resizable("instance"),s=a.options,l=a.containerOffset,c=a.position,u=a._aspectRatio||t.shiftKey,d={top:0,left:0},p=a.containerElement,f=!0;p[0]!==document&&/static/.test(p.css("position"))&&(d=l),c.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-d.left),u&&(a.size.height=a.size.width/a.aspectRatio,f=!1),a.position.left=s.helper?l.left:0),c.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),u&&(a.size.width=a.size.height*a.aspectRatio,f=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),i=/relative|absolute/.test(a.containerElement.css("position")),n&&i?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),o=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-d.left:a.offset.left-l.left)),r=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-d.top:a.offset.top-l.top)),o+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-o,u&&(a.size.height=a.size.width/a.aspectRatio,f=!1)),r+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-r,u&&(a.size.width=a.size.height*a.aspectRatio,f=!1)),f||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),o=t.options,r=t.containerOffset,n=t.containerPosition,i=t.containerElement,a=e(t.helper),s=a.offset(),l=a.outerWidth()-t.sizeDiff.width,c=a.outerHeight()-t.sizeDiff.height;t._helper&&!o.animate&&/relative/.test(i.css("position"))&&e(this).css({left:s.left-n.left-r.left,width:l,height:c}),t._helper&&!o.animate&&/static/.test(i.css("position"))&&e(this).css({left:s.left-n.left-r.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance").options;e(t.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,o){var r=e(this).resizable("instance"),n=r.options,i=r.originalSize,a=r.originalPosition,s={height:r.size.height-i.height||0,width:r.size.width-i.width||0,top:r.position.top-a.top||0,left:r.position.left-a.left||0};e(n.alsoResize).each(function(){var t=e(this),r=e(this).data("ui-resizable-alsoresize"),n={},i=t.parents(o.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(i,function(e,t){var o=(r[t]||0)+(s[t]||0);o&&o>=0&&(n[t]=o||null)}),t.css(n)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),o=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:o.height,width:o.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,o=e(this).resizable("instance"),r=o.options,n=o.size,i=o.originalSize,a=o.originalPosition,s=o.axis,l="number"==typeof r.grid?[r.grid,r.grid]:r.grid,c=l[0]||1,u=l[1]||1,d=Math.round((n.width-i.width)/c)*c,p=Math.round((n.height-i.height)/u)*u,f=i.width+d,h=i.height+p,m=r.maxWidth&&r.maxWidth<f,g=r.maxHeight&&r.maxHeight<h,b=r.minWidth&&r.minWidth>f,v=r.minHeight&&r.minHeight>h;r.grid=l,b&&(f+=c),v&&(h+=u),m&&(f-=c),g&&(h-=u),/^(se|s|e)$/.test(s)?(o.size.width=f,o.size.height=h):/^(ne)$/.test(s)?(o.size.width=f,o.size.height=h,o.position.top=a.top-p):/^(sw)$/.test(s)?(o.size.width=f,o.size.height=h,o.position.left=a.left-d):((h-u<=0||f-c<=0)&&(t=o._getPaddingPlusBorderDimensions(this)),h-u>0?(o.size.height=h,o.position.top=a.top-p):(h=u-t.height,o.size.height=h,o.position.top=a.top+i.height-h),f-c>0?(o.size.width=f,o.position.left=a.left-d):(f=c-t.width,o.size.width=f,o.position.left=a.left+i.width-f))}}),e.ui.resizable})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(45),o(81),o(63),o(82),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var o=e(t.target),r=e(e.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&o.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),o.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&r.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var o=e(t.target).closest(".ui-menu-item"),r=e(t.currentTarget);o[0]===r[0]&&(this._removeClass(r.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(t,r))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var o=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,o)},blur:function(t){this._delay(function(){var o=!e.contains(this.element[0],e.ui.safeActiveElement(this.document[0]));o&&this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){var t=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),o=t.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),o.children().each(function(){var t=e(this);t.data("ui-menu-submenu-caret")&&t.remove()})},_keydown:function(t){var o,r,n,i,a=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:a=!1,r=this.previousFilter||"",i=!1,n=t.keyCode>=96&&t.keyCode<=105?(t.keyCode-96).toString():String.fromCharCode(t.keyCode),clearTimeout(this.filterTimer),n===r?i=!0:n=r+n,o=this._filterMenuItems(n),(o=i&&-1!==o.index(this.active.next())?this.active.nextAll(".ui-menu-item"):o).length||(n=String.fromCharCode(t.keyCode),o=this._filterMenuItems(n)),o.length?(this.focus(t,o),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&t.preventDefault()},_activate:function(e){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,o,r,n,i,a=this,s=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),r=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),o=t.prev(),r=e("<span>").data("ui-menu-submenu-caret",!0);a._addClass(r,"ui-menu-icon","ui-icon "+s),o.attr("aria-haspopup","true").prepend(r),t.attr("aria-labelledby",o.attr("id"))}),this._addClass(r,"ui-menu","ui-widget ui-widget-content ui-front"),t=l.add(this.element),(o=t.find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);a._isDivider(t)&&a._addClass(t,"ui-menu-divider","ui-widget-content")}),n=o.not(".ui-menu-item, .ui-menu-divider"),i=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(i,"ui-menu-item-wrapper"),o.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){if("icons"===e){var o=this.element.find(".ui-menu-icon");this._removeClass(o,null,this.options.icons.submenu)._addClass(o,null,t.submenu)}this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",String(e)),this._toggleClass(null,"ui-state-disabled",!!e)},focus:function(e,t){var o,r,n;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),r=this.active.children(".ui-menu-item-wrapper"),this._addClass(r,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(o=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(o),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var o,r,n,i,a,s;this._hasScroll()&&(o=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-o-r,i=this.activeMenu.scrollTop(),a=this.activeMenu.height(),s=t.outerHeight(),n<0?this.activeMenu.scrollTop(i+n):n+s>a&&this.activeMenu.scrollTop(i+n-a+s))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",e,{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var o=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(o)},collapseAll:function(t,o){clearTimeout(this.timer),this.timer=this._delay(function(){var r=o?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this._removeClass(r.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=r},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,o){var r;this.active&&(r="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.find(this.options.items)[t]()),this.focus(o,r)},nextPage:function(t){var o,r,n;this.active?this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(o=e(this)).offset().top-r-n<0}),this.focus(t,o)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())):this.next(t)},previousPage:function(t){var o,r,n;this.active?this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(o=e(this)).offset().top-r+n>0}),this.focus(t,o)):this.focus(t,this.activeMenu.find(this.options.items).first())):this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var o={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,o)},_filterMenuItems:function(t){var o=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),r=new RegExp("^"+o,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return r.test(e.trim(e(this).children(".ui-menu-item-wrapper").text()))})}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("size",function(t,o){var r,n,i,a=e(this),s=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=t.mode,d="effect"!==u,p=t.scale||"both",f=t.origin||["middle","center"],h=a.css("position"),m=a.position(),g=e.effects.scaledDimensions(a),b=t.from||g,v=t.to||e.effects.scaledDimensions(a,0);e.effects.createPlaceholder(a),"show"===u&&(i=b,b=v,v=i),n={from:{y:b.height/g.height,x:b.width/g.width},to:{y:v.height/g.height,x:v.width/g.width}},"box"!==p&&"both"!==p||(n.from.y!==n.to.y&&(b=e.effects.setTransition(a,l,n.from.y,b),v=e.effects.setTransition(a,l,n.to.y,v)),n.from.x!==n.to.x&&(b=e.effects.setTransition(a,c,n.from.x,b),v=e.effects.setTransition(a,c,n.to.x,v))),"content"!==p&&"both"!==p||n.from.y!==n.to.y&&(b=e.effects.setTransition(a,s,n.from.y,b),v=e.effects.setTransition(a,s,n.to.y,v)),f&&(r=e.effects.getBaseline(f,g),b.top=(g.outerHeight-b.outerHeight)*r.y+m.top,b.left=(g.outerWidth-b.outerWidth)*r.x+m.left,v.top=(g.outerHeight-v.outerHeight)*r.y+m.top,v.left=(g.outerWidth-v.outerWidth)*r.x+m.left),a.css(b),"content"!==p&&"both"!==p||(l=l.concat(["marginTop","marginBottom"]).concat(s),c=c.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var o=e(this),r=e.effects.scaledDimensions(o),i={height:r.height*n.from.y,width:r.width*n.from.x,outerHeight:r.outerHeight*n.from.y,outerWidth:r.outerWidth*n.from.x},a={height:r.height*n.to.y,width:r.width*n.to.x,outerHeight:r.height*n.to.y,outerWidth:r.width*n.to.x};n.from.y!==n.to.y&&(i=e.effects.setTransition(o,l,n.from.y,i),a=e.effects.setTransition(o,l,n.to.y,a)),n.from.x!==n.to.x&&(i=e.effects.setTransition(o,c,n.from.x,i),a=e.effects.setTransition(o,c,n.to.x,a)),d&&e.effects.saveStyle(o),o.css(i),o.animate(a,t.duration,t.easing,function(){d&&e.effects.restoreStyle(o)})})),a.animate(v,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){var t=a.offset();0===v.opacity&&a.css("opacity",b.opacity),d||(a.css("position","static"===h?"relative":h).offset(t),e.effects.saveStyle(a)),o()}})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29),o(232)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("scale",function(t,o){var r=e(this),n=t.mode,i=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"effect"!==n?0:100),a=e.extend(!0,{from:e.effects.scaledDimensions(r),to:e.effects.scaledDimensions(r,i,t.direction||"both"),origin:t.origin||["middle","center"]},t);t.fade&&(a.from.opacity=1,a.to.opacity=0),e.effects.effect.size.call(this,a,o)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(15);function i(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){var o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable((0,n.generateUUID)()),this.text=(0,r.resource)(t),this.show=ko.observable(!1),this.hintPosition=ko.observable(a.hintPosition||"top"),this.parseAsHtml=ko.observable(a.html||!1),this.sticky=ko.observable(a.sticky||!1),this.wide=ko.observable(a.wide||!1),Array.isArray(t)&&(this.text=r.resource.apply(void 0,i(t)));var s=void 0===a.visibility||a.visibility;this.hintVisibility=ko.observable(s),this._calculateHintBodyPosition=this._calculateHintBodyPosition.bind(this),this.show.subscribe(function(e){e&&setTimeout(function(){o._calculateHintBodyPosition()},10)})}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"_calculateHintBodyPosition",value:function(){var e=$("#".concat(this.id())).find(".hint");this.wide()?e.css("width",170):e.css("width","unset");var t=e.offset().left+e.outerWidth()>visualViewport.width,o=e.offset().left<0,r=e.offset().top;t&&e.offset({top:r,left:visualViewport.width-e.outerWidth()}),o&&e.offset({top:r,left:0})}}]),e}();t.default=s,Noteflight.Hint=s},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.PageableViewModel=void 0,Noteflight.ColumnLayoutViewModel=function(e,t){var o=this;o.minColumnWidth=e,o.pixelWidth=ko.observable(0),o.columnCount=ko.computed(function(){return Math.floor(o.pixelWidth()/o.minColumnWidth)}),o.columnsCSS=ko.computed(function(){return"columns"+(o.columnCount()>8?8:o.columnCount())}),o.scaleFactor=ko.computed(function(){return o.columnCount()?o.pixelWidth()/(o.minColumnWidth*o.columnCount()):1}),o.setPixelWidth=function(e){o.pixelWidth(Math.floor($(t).width())-1)},$(window).on("resize",o.setPixelWidth)};var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.remaining=ko.observable(),this.count=ko.observable(0),this.startIndex=ko.observable(0),this.sortOrder=ko.observable("most_recent"),this.busy=ko.observable()}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"paginationCallback",value:function(){throw"paginationCallback not overwritten"}},{key:"checkAtBottom",value:function(e,t){this.remaining()&&!this.busy()&&($(t.target).find(".moreItems").position().top-$(t.target).scrollTop()<=$(t.target).outerHeight()&&this.paginationCallback())}}]),e}();t.PageableViewModel=n,Noteflight.PageableViewModel=function(e){var t=this;t.checkAtBottom=function(o,r){t.remaining()&&!t.busy()&&($(r.target).find(".moreItems").position().top-$(r.target).scrollTop()<=$(r.target).outerHeight()&&e())}}},function(e,t,o){e.exports=o(7)(691)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLatencyCalibrator=function(e){var t,o,n,i,a,s,l=e.sampleRate,c=.2,u=1,d=1,p=d+u/2,f=c+d+2*u,h=Math.floor(.03*l),m=Math.floor(l/1e3),g=1e3,b=30,v=!0;function y(){i.disconnect(),o&&"function"==typeof o.disconnect&&o.disconnect()}function _(){a.shutDown(),y(),function(){var e=function(e){var t=w(0,e),o=w(p,e),r=(o+t)/2;v=o>=2*t;for(var n=p*l;n>=0;n-=m){var i=n/l;if(w(i,e)<=r)return i}}(a.buffer),t=v,o=s+d,r=e+s,i=Math.round(1e3*(r-o))/1e3;(isNaN(i)||i<0)&&(i=0,t=!1);"function"==typeof n&&n({latency:i,success:t})}()}function S(r){(t=e.createBiquadFilter()).type="bandpass",t.frequency.value=g,t.Q.value=b,a=function(e){var t=e.createScriptProcessor(1024);return t.buffer=[],t.startTime=1/0,t.onaudioprocess=function(t){if(!(e.currentTime<this.startTime))for(var o=t.inputBuffer.getChannelData(0),r=0;r<o.length;r++)this.buffer.push(o[r])},t.shutDown=function(){this.disconnect(),this.onaudioprocess=null},t}(e),(o=e.createMediaStreamSource(r)).connect(t),t.connect(a),a.connect(e.destination),s=e.currentTime+c,a.startTime=s,function(t){(i=e.createOscillator()).connect(e.destination),i.type="sine",i.frequency.value=g,i.start(t),i.stop(t+u)}(s+d),setTimeout(_,1e3*f)}function w(e,t){for(var o,r=Math.floor(e*l),n=Math.max(Math.floor(r-h/2),0),i=Math.min(Math.floor(n+h),t.length-1),a=0,s=n;s<=i;s++)o=t[s],a+=o*o;return Math.sqrt(a/(i-n))}return{set onComplete(e){n=e},startCalibration:function(){(0,r.getMicStream)(S)},shutDown:y}};var r=o(60)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var r=o(6);function n(e,t,o,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this;t||(t="header/serviceReporter"),o||"test"==r.NF.environment||(o="body"),a.actionLabel=ko.observable(e),a.actionReporter=null,a.busy=ko.observable(!1),a.busyCounter=ko.observable(0),a.errors=ko.observableArray(),a.immediate=ko.observable(!1),a.small=ko.observable(!1),a.marginTop=ko.observable(i.marginTop?i.marginTop:"15px"),a.showErrorsInBackground=ko.observable(!0),a.clearErrors=function(){a.errors([])},a.busyThrottled=ko.computed(a.busy).extend({throttle:250}),a.init=function(){if(a.actionReporter)$(a.actionReporter).show();else{a.clearErrors();var e=$('<div class="serviceReporter" data-bind="template: \''+t+"'\">");a.actionReporter=e[0],$(o).append(e),ko.applyBindings(a,a.actionReporter)}},a.hasErrors=function(){return a.errors().length>0},a.hide=function(){a.clearErrors(),a.actionReporter&&(ko.removeNode(a.actionReporter),a.actionReporter=null)},a.hideNoRemove=function(){a.actionReporter&&$(a.actionReporter).hide()},a.busy.subscribe(function(e){a.busy()&&a.init(),a.busy()||0!==a.errors().length||a.hide()}),n&&a.errors.subscribe(function(e){$.each(e,function(e,t){n(t)})})}r.Noteflight.ServiceReporterViewModel=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMicCalibrator=function(e){var t,o=!1,i=.96,a=3,s=.5,l=.8,c=n(s),u=n(l),d=-40,p=0,f=0,h=e.createScriptProcessor(512),m=0,g=0,b="idle",v=null;function y(t){!function(t){g=function(e){if(e.length){for(var t,o=0,r=0;r<e.length;r++)t=e[r],o+=t*t;return Math.sqrt(o/e.length)}}(t),m=Math.max(g,m*i),d=n(m),g>p&&"calibrating"==b&&(v=e.currentTime,f=n(p=g))}(t.inputBuffer.getChannelData(0)),o&&function(e){for(var t=0;t<e.outputBuffer.numberOfChannels;t++)for(var o=e.inputBuffer.getChannelData(t),r=e.outputBuffer.getChannelData(t),n=0;n<e.inputBuffer.length;n++)r[n]=o[n]}(t),"calibrating"==b&&e.currentTime-v>a&&(b=p<s?"tooLow":p>l?"tooHigh":"justRight")}function _(o){p=0,f=0,h.onaudioprocess=y,(t=e.createMediaStreamSource(o)).connect(h),h.connect(e.destination),v=e.currentTime,b="calibrating"}function S(e){(0,r.releaseMicStream)(),h.disconnect(),h.onaudioprocess=null,t&&"function"==typeof t.disconnect&&t.disconnect()}return{get dBs(){return d},get highestDBs(){return f},get lowLimitDBs(){return c},get highLimitDBs(){return u},get state(){return b},start:function(){"calibrating"==b&&S();(0,r.getMicStream)(_)},shutDown:S}};var r=o(60);function n(e){return Math.log(e)/Math.log(10)*20}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.languagesList=void 0;t.languagesList=[{name:"English (US)",languageCode:"en",locale:"en-US"},{name:"English",languageCode:"en",locale:"en-EN"},{name:"Deutsch",languageCode:"de",locale:"de"},{name:"Espaol (ES)",languageCode:"es",locale:"es-ES"},{name:"Espaol",languageCode:"es",locale:"es"},{name:"Franais",languageCode:"fr",locale:"fr"},{name:"",languageCode:"ja",locale:"ja"},{name:"Catal",languageCode:"ca",locale:"ca"},{name:" ()",languageCode:"zh-CN",locale:"zh-CN"},{name:" ()",languageCode:"zh-TW",locale:"zh-TW"},{name:"Slovenina",languageCode:"sk",locale:"sk"}]},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.valueToLabel=function(e){return(0,r.resource)("note."+n[e])};var r=o(0),n={0:"twoHundredFiftySixth",1:"oneHundredTwentyEighth",2:"sixtyFourth",3:"thirtySecond",4:"sixteenth",5:"eighth",6:"quarter",7:"half",8:"whole",9:"breve",10:"longa"}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.EDIT_CARD=t.ADD_CARD=void 0;var r=u(o(4)),n=o(6),i=u(o(243)),a=o(95),s=o(5),l=(o(94),o(0)),c=o(28);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p="addCard";t.ADD_CARD=p;var f="editCard";t.EDIT_CARD=f;var h=function(){function e(t){var o=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cardError=ko.observable(),this.saveCard=ko.observable(!0),this.customerCard=t,this.reporter=n.reporter,this.mode=ko.computed(function(){return o.customerCard&&o.customerCard.id()?f:p}),this.headerText=ko.computed(function(){return o.mode()===p?(0,l.resource)("content.addCard"):(0,l.resource)("content.editCard")}),this.allowedCountries=ko.observableArray(),this.originalCustomerCountry=this.customerCard.address.country(),this.countriesSet=ko.observable(!1),this.originalCustomerState=this.customerCard.address.state(),this._clearCardErrors=this._clearCardErrors.bind(this),this._addCardError=this._addCardError.bind(this),this.stripeSource=new i.default({style:a.STRIPE_CREDIT_CARD_STYLE,hidePostalCode:!0},"#cardElementCustomer",this._addCardError),r.default.subscribe(s.STRIPE_CARD_EDITING_NUMBER,this._clearCardErrors),this._fillAllowedCountries()}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"_addCardError",value:function(e){this.cardError(e),r.default.publish(s.CUSTOMER_CARD_UPDATE_FAILED)}},{key:"_clearCardErrors",value:function(){this.cardError("")}},{key:"_generateCardTokenOptions",value:function(){var e={};return e.name=this.customerCard.address.name().trim(),e.address_line1=this.customerCard.address.address1().trim(),this.customerCard.address.address2()&&this.customerCard.address.address2().length>0&&(e.address_line2=this.customerCard.address.address2().trim()),e.address_city=this.customerCard.address.city().trim(),e.address_state=this.customerCard.address.state().trim(),e.address_zip=this.customerCard.address.postalCode().trim(),e.address_country=this.customerCard.address.country().trim(),e}},{key:"_addNewCard",value:function(e){var t=this,o={token:e.id,save:this.saveCard()};n.NF.apiService.createCustomerCard({text:(0,l.resource)("action.saving"),doNotShowDefaultError:!!this.reporter,withBackground:!0,fullScreen:!0},function(e){r.default.publish(s.CUSTOMER_CARD_CREATED,e)},o,{fail:function(e){r.default.publish(s.CUSTOMER_CARD_CREATION_FAILED),t.reporter&&t.reporter.addError(e)}})}},{key:"_updateCard",value:function(e){var t={card_options:this._generateCardTokenOptions(),existing_card_id:this.customerCard.id()};n.NF.apiService.updateCustomerCard((0,l.resource)("action.saving"),function(e){r.default.publish(s.CUSTOMER_CARD_UPDATED,e)},t,{fail:function(){r.default.publish(s.CUSTOMER_CARD_UPDATE_FAILED)}})}},{key:"_fillAllowedCountries",value:function(){n.NF.apiService.getCountries("",this._handleCountriesData.bind(this))}},{key:"_handleCountriesData",value:function(e){for(var t=0;t<e.countries.length;t++)this.allowedCountries.push({value:e.countries[t].country_code,label:(0,l.resource)("country.".concat((0,c.camelCase)((0,c.getStringForResourcesKey)(e.countries[t].country_name))))}),this.allowedCountries.sort(function(e,t){return e.label===t.label?0:e.label<t.label?-1:1});this.originalCustomerCountry?(this.customerCard.address.country(this.originalCustomerCountry),this.customerCard.address.state(this.originalCustomerState)):this.customerCard.address.country("US"),this.countriesSet(!0)}},{key:"_publishCardAddress",value:function(){0===this.customerCard.address.validateAddress().length&&r.default.publish(s.CUSTOMER_CARD_ADDRESS_CHANGED,this.customerCard.address)}},{key:"initializeCardDisplay",value:function(){this.mode()===p&&this.stripeSource.initializeCardDisplay()}},{key:"uploadCard",value:function(){var e=this.customerCard.address.validate();if(e.length>0)return this.reporter?this.reporter.errorsReporter.addErrors(e):r.default.publish(s.REPORTER_ADD_ERRORS,e),r.default.publish(s.CUSTOMER_CARD_CREATION_FAILED),!1;this.mode()==p?this.stripeSource.generateCardToken(this._generateCardTokenOptions(),this._addNewCard.bind(this)):this.mode()==f&&this._updateCard()}},{key:"initState",value:function(){this.countriesSet()&&this.customerCard.address.state("")}}]),e}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(95);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stripe=window.Stripe(Noteflight.config.stripePublicKey),this.cardElement=null,this.cardOptions=t,this.cardSelector=o,this.errorCallback=r}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"initializeCardDisplay",value:function(){var e=this,t=this.stripe.elements();this.cardElement=t.create(i.CARD_TYPE,this.cardOptions),this.cardElement.mount(this.cardSelector),this.cardElement.addEventListener("change",function(t){var o=t.error;o?e.errorCallback.call(e,o.message):r.default.publish(n.STRIPE_CARD_EDITING_NUMBER)})}},{key:"generateCardToken",value:function(e,t){var o=this;this.stripe.createToken(this.cardElement,e).then(function(e){e.error?o.errorCallback(e.error.message):t(e.token)})}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(5),n=l(o(4)),i=l(o(13)),a=o(0),s=o(3);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,p(t).call(this))).customerCard=e,o.busy=ko.observable(!1),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,i.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"_markBusy",value:function(){this.busy(!0)}},{key:"_deleteCard",value:function(){var e=this,t={card_id:this.customerCard.id()};NF.apiService.deleteCustomerCard((0,a.resource)("action.deleting"),function(t){n.default.publish(r.CUSTOMER_CARD_DELETED,e.customerCard.id()),e.cancel()},t)}},{key:"show",value:function(){return(0,s.createAndShowDialog)({viewModel:this,templateName:"dialogs/deleteCustomerCard"}),this}},{key:"doOk",value:function(){return this._markBusy(),this._deleteCard(),!1}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(193)),n=o(5),i=s(o(4)),a=o(0);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.existingCards=ko.observableArray([]),this.selectedCard=ko.observable(),this._initializeSubscriptions()}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"_initializeSubscriptions",value:function(){var e=this;i.default.subscribe(n.CUSTOMER_CARDS_RETRIEVED,function(t,o){e._onCustomerCardRetrieved(o)})}},{key:"_onCustomerCardRetrieved",value:function(e){this._buildExistingCards(e),this.existingCards().length>0&&this.selectedCard(this.existingCards()[0].id())}},{key:"addExistingCard",value:function(e){var t=new r.default;t.id(e.id),t.brand(e.brand),t.expirationMonth(e.exp_month),t.expirationYear(e.exp_year),t.last4(e.last4),t.inactive("error"==e.status),t.address.setAddress(e.address),this.existingCards.push(t)}},{key:"_buildExistingCards",value:function(e){var t=this;this.existingCards([]),e.forEach(function(e){t.addExistingCard(e)})}},{key:"deleteCard",value:function(e){for(var t=0;t<this.existingCards().length;t++)if(this.existingCards()[t].id()==e){this.existingCards.splice(t,1);break}}},{key:"getCard",value:function(e){for(var t=0;t<this.existingCards().length;t++)if(this.existingCards()[t].id()==e)return this.existingCards()[t]}},{key:"replaceCard",value:function(e,t){this.deleteCard(e),this.addExistingCard(t),this.selectedCard()&&this.selectedCard()==e&&this.selectedCard(t.id)}},{key:"retrieveCards",value:function(){NF.apiService.retrieveCustomerCards((0,a.resource)("action.loading"),function(e){e&&e.cards&&Array.isArray(e.cards)&&i.default.publish(n.CUSTOMER_CARDS_RETRIEVED,e.cards)},{},{})}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmPasswordDialog=t.default=void 0;var r=g(o(4)),n=o(5),i=g(o(58)),a=o(8),s=g(o(190)),l=(g(o(75)),o(240)),c=g(o(13)),u=g(o(247)),d=g(o(248)),p=o(2),f=o(28),h=o(0),m=o(3);o(20);function g(e){return e&&e.__esModule?e:{default:e}}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,o){return t&&w(e.prototype,t),o&&w(e,o),e}var E="basic",P="use",C="locale",T="social",R=function(){function e(t){S(this,e),this.parent=t,this.errorsReporter=new i.default,this.session=Noteflight.session,this.currentUser=this.session.current_user(),this.communityMember=this.session.community_member(),this.autoGeneratedPassword=ko.observable(this.communityMember.auto_generated_password()),this.changedFields={basicProfile:{user:{profile:{}}},noteflightUse:{user:{profile:{}}},locationAndLanguage:{user:{profile:{}}},social:{user:{profile:{}}}},this.resource=h.resource,this.initializeObservables(),this.initializeComputeds(),this.imageUploaderAvatar=ko.observable(),this.imageUploaderHeader=ko.observable()}return k(e,[{key:"activate",value:function(){this.setUser(NF.session.current_user())}},{key:"initializeChanges",value:function(){this.initializeSubscribers(),this.changedFields={basicProfile:{user:{profile:{}}},noteflightUse:{user:{profile:{}}},locationAndLanguage:{user:{profile:{}}},social:{user:{profile:{}}}},this.imageUploaderAvatar(new u.default({imageId:this.user().profile().avatar_id,imageUrl:this.user().avatar,editable:!0,uploaderId:"avatarUploader",externalId:this.user().external_id()})),this.imageUploaderHeader(new d.default({imageId:this.user().profile().header_image_id,imageUrl:this.user().headerImage,editable:!0,isPremium:this.user().has_premium_features(),externalId:this.user().external_id()}))}},{key:"initializeObservables",value:function(){var e=this;this.user=ko.observable(),this.username=ko.observable(),this.password=ko.observable(this.autoGeneratedPassword()?"":"************"),this.passwordHasFocus=ko.observable(),this.resetPassword=ko.observable(!1),this.email=ko.observable(),this.firstName=ko.observable(),this.lastName=ko.observable(),this.aboutYou=ko.observable(),this.showUpdateBasicProfileButton=ko.observable(!1),this.composer=ko.observable(),this.performer=ko.observable(),this.educationalRole=ko.observable(),this.primaryInstrumentVal=ko.observable(""),this.primaryInstrument=ko.computed({read:function(){return e.primaryInstrumentVal()},write:function(t){e.primaryInstrumentVal(t),e.changedFields.noteflightUse.user.profile.primary_instrument=t,t&&"-1"!==t&&e.showUpdateNoteflightUseButton(!0)}}),this.instrumentFamilies=ko.observable((0,s.default)()),this.composerSkillLevel=ko.observable(),this.performerSkillLevel=ko.observable(),this.showUpdateNoteflightUseButton=ko.observable(!1),this.location=ko.observable(),this.country=ko.observable(),this.languagesList=ko.observableArray(l.languagesList),this.language=ko.observable(NF.session.locale()),this.showUpdateLocationAndLanguageButton=ko.observable(!1),this.facebookUsername=ko.observable(),this.twitterUsername=ko.observable(),this.instagramUsername=ko.observable(),this.showUpdateSocialLinksButton=ko.observable(!1),this.requiresPassword=ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.usernameCanBeEdited=ko.computed(function(){return!NF.roles.isSite()&&e.session.current_user().username_changes_remaining()>0&&e.session.current_user().verified()||NF.roles.isSite()&&NF.roles.isAtLeastSiteTeacher()}),this.passwordShown=ko.computed(function(){return!e.session.community().is_google_classroom()}),this.passwordCanBeEdited=ko.computed(function(){return!NF.roles.isSite()||!e.session.community().sso_allowed()&&!e.session.community().is_google_classroom()&&NF.roles.isAtLeastSiteTeacher()}),this.emailShown=ko.computed(function(){return!NF.roles.isSite()||NF.roles.isSiteAdmin()&&!e.parent.userId()}),this.emailCanBeEdited=ko.computed(function(){return!NF.roles.isSite()}),this.profileInfoShown=ko.computed(function(){return!NF.roles.isSite()}),this.requirePasswordShown=ko.computed(function(){return!e.session.community().is_google_classroom()&&e.parent.userId()&&NF.roles.isAtLeastSiteTeacher()}),this.adminSCCPassword=ko.computed(function(){return e.parent.userId()&&NF.roles.isAtLeastSiteTeacher()}),this.connectWithFacebookCompleted=ko.computed(function(){return e.communityMember.connected_to_facebook()}),this.connectWithGoogleCompleted=ko.computed(function(){return e.communityMember.connected_to_google()})}},{key:"initializeSubscribers",value:function(){var e=this;this.username.subscribe(function(t){e.autoGeneratedPassword()||NF.roles.isSite()&&(e.parent.userId()||!NF.roles.isAtLeastSiteTeacher())||e.requiresPassword(!0),e.changedFields.basicProfile.user.username=t.trim().replace(/ +/g," "),e.showUpdateBasicProfileButton(!0)}),this.email.subscribe(function(t){e.requiresPassword(!0),e.changedFields.basicProfile.user.email=t,e.showUpdateBasicProfileButton(!0)}),this.password.subscribe(function(t){(t&&"************"!=t||e.autoGeneratedPassword())&&(e.requiresPassword(!0),e.showUpdateBasicProfileButton(!0),e.changedFields.basicProfile.change_password=!0,e.changedFields.basicProfile.user.password=t)}),this.passwordHasFocus.subscribe(function(t){t?e.password(""):""!==e.password()||e.autoGeneratedPassword()||e.password("************")}),this.resetPassword.subscribe(function(t){e.changedFields.basicProfile.reset_password_required=t,e.changedFields.basicProfile.change_password=t,e.showUpdateBasicProfileButton(!0)}),this.firstName.subscribe(function(t){""===t&&(t=null),e.changedFields.basicProfile.user.profile.first_name=t,e.showUpdateBasicProfileButton(!0)}),this.lastName.subscribe(function(t){""===t&&(t=null),e.changedFields.basicProfile.user.profile.last_name=t,e.showUpdateBasicProfileButton(!0)}),this.aboutYou.subscribe(function(t){e.changedFields.basicProfile.user.profile.about_me=t,e.showUpdateBasicProfileButton(!0)}),this.composer.subscribe(function(t){e.changedFields.noteflightUse.user.profile.composer=t,e.showUpdateNoteflightUseButton(!0)}),this.performer.subscribe(function(t){e.changedFields.noteflightUse.user.profile.performer=t,e.showUpdateNoteflightUseButton(!0)}),this.educationalRole.subscribe(function(t){e.changedFields.noteflightUse.user.profile.educational_role=t,e.showUpdateNoteflightUseButton(!0)}),this.composerSkillLevel.subscribe(function(t){e.changedFields.noteflightUse.user.profile.composer_skill_level=t,e.showUpdateNoteflightUseButton(!0)}),this.performerSkillLevel.subscribe(function(t){e.changedFields.noteflightUse.user.profile.performer_skill_level=t,e.showUpdateNoteflightUseButton(!0)}),this.location.subscribe(function(t){e.changedFields.locationAndLanguage.user.profile.location=t,e.showUpdateLocationAndLanguageButton(!0)}),this.country.subscribe(function(t){e.changedFields.locationAndLanguage.user.profile.country=t,e.showUpdateLocationAndLanguageButton(!0)}),this.language.subscribe(function(t){e.changedFields.locationAndLanguage.user.profile.language=t,e.showUpdateLocationAndLanguageButton(!0)}),this.facebookUsername.subscribe(function(t){e.changedFields.social.user.profile.facebook_username=t,e.showUpdateSocialLinksButton(!0)}),this.twitterUsername.subscribe(function(t){e.changedFields.social.user.profile.twitter_username=t,e.showUpdateSocialLinksButton(!0)}),this.instagramUsername.subscribe(function(t){e.changedFields.social.user.profile.instagram_username=t,e.showUpdateSocialLinksButton(!0)})}},{key:"updateBasicProfile",value:function(){var e=this;r.default.publish(n.REPORTER_CLEAR_ERRORS);var t=this.changedFields.basicProfile;if(this.requiresPassword()){var o=new O(t,function(t){return e._doUpdateProfile(t,"basic")});if(t.user.password&&o.showNewPasswordField(!0),this.adminSCCPassword()&&o.adminSCCPassword(!0),!t.user.username||this.parent.userId()||!this.session.current_user().identified()||NF.roles.isSite()&&NF.roles.isAtLeastSiteTeacher()||o.showUsernameWarning(!0),t.user.email){if(!this.validateEmailAddress(t.user.email))return;o.showEmailWarning(!0)}o.show()}else this._doUpdateProfile(t,E)}},{key:"updateSocialLinks",value:function(){r.default.publish(n.REPORTER_CLEAR_ERRORS);var e=this.facebookUsername();e&&this.facebookUsername(e.substring(e.lastIndexOf("/")+1));var t=this.twitterUsername();t&&this.twitterUsername(t.substring(t.lastIndexOf("@")+1)),this._doUpdateProfile(this.changedFields.social,T)}},{key:"_doUpdateProfile",value:function(e,t){var o=this;e.user.profile.language?NF.locale(this.language()):e.user.profile.language=this.language(),e.to_password&&e.to_password!=this.password()&&r.default.publish(n.REPORTER_ADD_ERROR,{code:"passwordsMustMatch",message:(0,h.resource)("errors.passwordsMustMatch")}),this.password().length&&this.password().length<a.MIN_PASSWORD_LENGTH&&r.default.publish(n.REPORTER_ADD_ERROR,{code:"passwordTooShort",message:(0,h.resource)("errors.passwordTooShort",a.MIN_PASSWORD_LENGTH)}),this.password().length&&this.password().length>a.MAX_PASSWORD_LENGTH&&r.default.publish(n.REPORTER_ADD_ERROR,{code:"passwordTooLong",message:(0,h.resource)("errors.passwordTooLong",a.MAX_PASSWORD_LENGTH)}),this.errorsReporter.hasErrors()||(e.user_id=this.parent.userId(),t==E&&(this.parent.userId()||NF.roles.isSite()&&NF.roles.isAtLeastSiteTeacher())?(e.sso_username=e.user.username?e.user.username:this.username(),NF.apiService.adminProfile((0,h.resource)("account.savingInfo"),function(e){return o.updateCurrentUser(e,t)},e,{})):NF.apiService.editProfile((0,h.resource)("account.savingInfo"),function(e){return o.updateCurrentUser(e,t)},e,{}))}},{key:"validateEmailAddress",value:function(e){return(0,f.hasInvalidChars)(e)?(r.default.publish(n.REPORTER_ADD_ERROR,{code:"emailContainsInvalidCharacters",message:(0,h.resource)("errors.emailContainsInvalidCharacters")}),!1):!!NF.isValidEmail(e)||(r.default.publish(n.REPORTER_ADD_ERROR,{code:"invalidEmail",message:(0,h.resource)("errors.invalidEmail")}),!1)}},{key:"updateCurrentUser",value:function(e,t){this.parent.userId()||(this.session.current_user().update(e.user),this.session.current_user().profileChanged()),e.user.profile.language&&e.user.profile.language!=this.language()&&(this.language(e.user.profile.language),NF.locale(this.language()));var o=new NF.User(e.user);switch(this.user(o),t){case E:var r=this.email()?this.email():"";this.email(o.email?o.email():r),this.username(o.username()),this.aboutYou(o.profile().about_me()),this.firstName(o.profile().first_name()),this.lastName(o.profile().last_name()),this.requiresPassword(!1),this.changedFields.basicProfile={user:{profile:{}}},this.initializeSubscribers(),this.showUpdateBasicProfileButton(!1);break;case P:this.composer(o.profile().composer()),this.performer(o.profile().performer()),this.educationalRole(o.profile().educational_role()),this.primaryInstrumentVal(o.profile().primary_instrument()),this.composerSkillLevel(o.profile().composer_skill_level()),this.performerSkillLevel(o.profile().performer_skill_level()),this.changedFields.noteflightUse={user:{profile:{}}},this.initializeSubscribers(),this.showUpdateNoteflightUseButton(!1);break;case C:this.country(o.profile().country()),this.location(o.profile().location()),this.country(o.profile().country()),this.changedFields.locationAndLanguage={user:{profile:{}}},this.initializeSubscribers(),this.showUpdateLocationAndLanguageButton(!1);break;case T:this.facebookUsername(o.profile().facebook_username()),this.twitterUsername(o.profile().twitter_username()),this.instagramUsername(o.profile().instagram_username()),this.changedFields.social={user:{profile:{}}},this.initializeSubscribers(),this.showUpdateSocialLinksButton(!1);break;default:this.setUser(new NF.User(e.user))}}},{key:"setUser",value:function(e){this.user(e),this.email(e.email?e.email():""),this.username(e.username()),this.aboutYou(e.profile().about_me()),this.firstName(e.profile().first_name()),this.lastName(e.profile().last_name()),this.composer(e.profile().composer()),this.performer(e.profile().performer()),this.educationalRole(e.profile().educational_role()),this.primaryInstrumentVal(e.profile().primary_instrument()),this.composerSkillLevel(e.profile().composer_skill_level()),this.performerSkillLevel(e.profile().performer_skill_level()),this.location(e.profile().location()),this.country(e.profile().country()),this.language(NF.session.locale()),this.facebookUsername(e.profile().facebook_username()),this.twitterUsername(e.profile().twitter_username()),this.instagramUsername(e.profile().instagram_username()),this.requiresPassword(!1),this.initializeChanges()}},{key:"updateNoteflightUse",value:function(){r.default.publish(n.REPORTER_CLEAR_ERRORS),this.primaryInstrumentInitialized=!1,this._doUpdateProfile(this.changedFields.noteflightUse,P)}},{key:"updateLocationAndLanguage",value:function(){r.default.publish(n.REPORTER_CLEAR_ERRORS),this._doUpdateProfile(this.changedFields.locationAndLanguage,C)}},{key:"connectWithFacebook",value:function(){(0,p.navigate)("/auth/facebook/?return_to="+encodeURIComponent(window.location.href))}},{key:"connectWithGoogle",value:function(){(0,p.navigate)("/auth/google/?return_to="+encodeURIComponent(window.location.href))}},{key:"canDisconnectFromExternalProvider",value:function(){return!this.autoGeneratedPassword()||!!(this.autoGeneratedPassword()&&this.connectWithFacebookCompleted()&&this.connectWithGoogleCompleted())}},{key:"disconnectFromFacebook",value:function(){this.disconnectExternalProvider("facebook")}},{key:"disconnectFromGoogle",value:function(){this.disconnectExternalProvider("google")}},{key:"disconnectExternalProvider",value:function(e){var t=this;NF.apiService.disconnectExternalProvider("",function(e){t.reloadPage()},{provider:e})}},{key:"reloadPage",value:function(){location.reload()}}]),e}();t.default=R;var O=function(e){function t(e,o){var r;return S(this,t),(r=v(this,y(t).call(this))).callback=o,r.params=e,r.currentPassword=ko.observable(""),r.newPassword=ko.observable(),r.showNewPasswordField=ko.observable(!1),r.showUsernameWarning=ko.observable(!1),r.showEmailWarning=ko.observable(!1),r.adminSCCPassword=ko.observable(!1),r.usernameChangesLeft=NF.session.current_user().username_changes_remaining,r.showOldPasswordField=ko.computed(function(){return!r.adminSCCPassword()&&!NF.session.community_member().auto_generated_password()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,c.default),k(t,[{key:"doOk",value:function(){return this.callback&&(this.params.password=this.currentPassword(),this.params.to_password=this.newPassword(),this.callback(this.params)),!0}},{key:"show",value:function(){(0,m.createAndShowDialog)({viewModel:this,templateName:"dialogs/confirmProfileUpdate"})}}]),t}();t.ConfirmPasswordDialog=O},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(75));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,s(t).call(this,o))).endpointName("uploadAvatar"),e.pictureKey("avatar"),e.imageAPI="/client/1.0/avatar/",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"selectedCallback",value:function(e){NF.apiService.editProfile("",this.refreshImage.bind(this),{user:{profile:{},avatar_id:e.avatar_id},user_id:this.externalId},{})}},{key:"_croppingCancelCallback",value:function(){this.selectedCallback({avatar_id:this._oldImageId})}},{key:"_callbackNewImageUploaded",value:function(e,t){var o=t?this._letUserCropImage.bind(this):function(){};this._oldImageId=this.imageId(),this.imageId(e.avatar_id),this._updateProfile(this.id(),o),this._rawImageUrl("".concat(this.imageAPI).concat(this.imageId())),this.newImageUploaded(!0)}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a(o(4)),o(5);var r=a(o(116)),n=(a(o(32)),o(53),a(o(75))),i=o(0);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,o){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this,o))).endpointName("uploadHeaderImage"),e.pictureKey("header_image"),e.imageAPI="/client/1.0/header_image/",e._aspectRatio=16/9,e._removeImage=e._removeImage.bind(p(p(e))),e._choosePhotoHeader=e._choosePhotoHeader.bind(p(p(e))),e.contextMenuItems=ko.observableArray([{label:(0,i.resource)("action.upload"),action:e.uploadImage},{label:(0,i.resource)("action.chooseStockPhoto"),action:e._choosePhotoHeader},{label:(0,i.resource)("action.remove"),action:e._removeImage}]),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"_choosePhotoHeader",value:function(){this._canEditPremiumFeatures("headerImage")&&new r.default((0,i.resource)("action.changeHeader"),"header_image","uploadHeaderImageData",{selectedCallback:this.selectedCallback.bind(this)}).show()}},{key:"uploadImage",value:function(){this._canEditPremiumFeatures("headerImage")&&c(u(t.prototype),"uploadImage",this).call(this)}},{key:"_removeImage",value:function(){this._canEditPremiumFeatures("headerImage")&&NF.apiService.deleteHeaderImage("",this.refreshImage.bind(this),{user_id:this.externalId},{})}},{key:"selectedCallback",value:function(e){NF.apiService.editProfile("",this.refreshImage.bind(this),{user:{profile:{},header_image_id:e.header_image_id},user_id:this.externalId},{})}},{key:"_croppingCancelCallback",value:function(){this.selectedCallback({header_image_id:this._oldImageId})}},{key:"_callbackNewImageUploaded",value:function(e,t){var o=t?this._letUserCropImage.bind(this):function(){};this._oldImageId=this.imageId(),this.imageId(e.header_image_id),this._updateProfile(this.id(),o),this._rawImageUrl("".concat(this.imageAPI).concat(this.imageId())),this.newImageUploaded(!0)}}]),t}();t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this,e))).handleOnClick=o.handleOnClick.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"handleOnClick",value:function(){this.props.clickHandler(this.props.id)}},{key:"render",value:function(){var e=this.props.selected?"current":null;return r.default.createElement("li",{className:e,onClick:this.handleOnClick},r.default.createElement("a",null,this.props.name))}}]),t}();t.default=u,u.propTypes={name:n.default.string.isRequired,clickHandler:n.default.func.isRequired,selected:n.default.bool}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=u(o(18)),i=u(o(98)),a=o(251),s=o(19),l=o(6),c=u(o(256));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?m(e):t}(this,f(t).call(this))).state={elementsShown:!1,scrollLeft:0,sectionWidth:0},e.scrollRight=e.scrollRight.bind(m(m(e))),e.scrollLeft=e.scrollLeft.bind(m(m(e))),e.handleScroll=e.handleScroll.bind(m(m(e))),(0,l.$)(window).resize(function(){e.setState({sectionWidth:e.calculateSectionWidth()})}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r.Component),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"calculateSectionWidth",value:function(){return(0,l.$)("#".concat(this.marketplaceSectionId)).find(".gridContainer").width()}},{key:"handleScroll",value:function(e){this.setState({scrollLeft:e.target.scrollLeft})}},{key:"componentDidMount",value:function(){this.setState({elementsShown:!0,sectionWidth:this.calculateSectionWidth()})}},{key:"findScrollingNode",value:function(e){var t=e.closest(".sectionContainer");return(0,l.$)(t).children(".sectionContainerScrolling")}},{key:"scrollRight",value:function(e){this.findScrollingNode(e.target).animate({scrollLeft:"+=".concat(this.state.sectionWidth/2)},300,"swing")}},{key:"scrollLeft",value:function(e){this.findScrollingNode(e.target).animate({scrollLeft:"-=".concat(this.state.sectionWidth/2)},300,"swing")}},{key:"renderArrows",value:function(){return!(0,s.isPhoneLayoutOrSmaller)()&&this.state.elementsShown&&this.state.sectionWidth<this.gridWidth&&r.default.createElement("div",null,this.renderLeftArrow(),this.renderRightArrow())}},{key:"renderLeftArrow",value:function(){return this.state.scrollLeft>0&&r.default.createElement(c.default,{direction:"left",clickCallback:this.scrollLeft})}},{key:"renderRightArrow",value:function(){return this.state.scrollLeft+this.state.sectionWidth<this.gridWidth&&r.default.createElement(c.default,{direction:"right",clickCallback:this.scrollRight})}},{key:"render",value:function(){var e=(0,a.getRenderType)(this.props.type,"thumbnail");return e?r.default.createElement("div",{className:"sectionContainer",id:this.marketplaceSectionId},r.default.createElement("label",{className:"sectionTitle"},this.props.name),this.renderArrows(),r.default.createElement("div",{className:"sectionContainerScrolling",onScroll:this.handleScroll},r.default.createElement(i.default,{renderer:e,models:this.props.elements,styleClasses:"block"}))):null}},{key:"marketplaceSectionId",get:function(){return"marketplaceSection".concat(this.props.id)}},{key:"gridWidth",get:function(){return this.props.elements.length*(0,l.$)("#".concat(this.marketplaceSectionId)).find(".gridContainer").children().first().width()}}]),t}();t.default=g,g.propTypes={id:n.default.oneOfType([n.default.string,n.default.number]).isRequired,name:n.default.string.isRequired,elements:n.default.array.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCollectionTypeFromCollection=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=l[e.items[0].type];if(t)return o.list;return o.thumbnail},t.getRenderType=function(e,t){return l[e][t]};var r=s(o(414)),n=s(o(415)),i=s(o(252)),a=s(o(255));function s(e){return e&&e.__esModule?e:{default:e}}var l={CollectionCollection:{thumbnail:r.default,list:r.default},CollectionProduct:{thumbnail:i.default,list:a.default},CollectionDocument:{thumbnail:n.default,list:n.default}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Product=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=y(o(18)),a=o(6),s=o(15),l=o(49),c=o(0),u=o(119),d=o(120),p=o(97),f=y(o(118)),h=y(o(196)),m=y(o(416)),g=y(o(99)),b=y(o(198)),v=y(o(253));function y(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var P=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?E(e):t}(this,w(t).call(this,e))).handleOnClick=o.handleOnClick.bind(E(E(o))),o.toggleContextMenu=o.toggleContextMenu.bind(E(E(o))),o.handleCollectionIconClick=o.handleCollectionIconClick.bind(E(E(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,r.Component),function(e,t,o){t&&S(e.prototype,t),o&&S(e,o)}(t,[{key:"handleOnClick",value:function(){a.NF.session.rr()&&this.props.tracking_url&&this.props.rrProductClicked(this.props.tracking_url)}},{key:"toggleContextMenu",value:function(){this.props.setContextMenuState(this.props.uuid,!this.props.showContextMenu)}},{key:"handleCollectionIconClick",value:function(e){e.preventDefault(),this.props.closeAllContextMenus(),this.toggleContextMenu()}},{key:"renderCollectionIcon",value:function(){return a.NF.roles.isNoteflightAdmin()&&r.default.createElement("div",{className:"openContextMenu collectionIcon",onClick:this.handleCollectionIconClick})}},{key:"renderAudioPreview",value:function(){return r.default.createElement(g.default,{id:this.props.uuid,hasCustomAudioMedia:this.props.has_custom_audio_media,url:this.props.audio_preview_url})}},{key:"renderContextMenu",value:function(){return this.props.showContextMenu&&r.default.createElement(m.default,{uuid:this.props.uuid})}},{key:"renderStars",value:function(){return 0!==this.props.average_rating&&r.default.createElement("span",{className:"ratings"},r.default.createElement(h.default,{total:this.props.average_rating,size:"small"}),r.default.createElement("span",{className:"reviewCount"},(0,s.abbreviateNumber)(this.props.reviews_count)))}},{key:"renderOfficialBadge",value:function(){return this.props.official&&r.default.createElement(b.default,null)}},{key:"renderContributors",value:function(){return r.default.createElement("label",{className:"contributors ellipsify"},(0,l.firstContributor)(this.props.contributors))}},{key:"renderArranger",value:function(){var e=(0,l.firstArranger)(this.props.contributors);return e&&r.default.createElement("label",{className:"arranger ellipsify"},(0,c.resource)("content.arr",e))}},{key:"render",value:function(){var e=this.props.isLast?"last":"",t=this.props.productPlayingUuid==this.props.uuid?"darken":"";return r.default.createElement("a",{href:this.props.marketplace_url,onClick:this.handleOnClick},r.default.createElement("div",{className:"scoreThumbnail pointer ".concat(e)},r.default.createElement("div",{className:"coverArtContainer ".concat(e," ").concat(t)},r.default.createElement(f.default,{size:"phoneListSize",backgroundImageUrl:this.props.cover_art_url,overlay:this.props.cover_art_directive},this.renderAudioPreview())),this.renderCollectionIcon(),this.renderContextMenu(),r.default.createElement("div",{className:"scoreInfo pointer"},r.default.createElement("div",{className:"titleRow"},r.default.createElement("label",{className:"title ellipsify"},this.props.title),this.renderOfficialBadge()),this.renderContributors(),this.renderArranger(),r.default.createElement(v.default,{format:this.props.metadata.format,instruments:this.props.metadata.instrument_names}),r.default.createElement("label",{className:"price"},(0,s.formatPriceInCents)(this.props.price,{showDouble0ForCents:!1})),this.renderStars())))}}]),t}();t.Product=P,P.propTypes={title:i.default.string.isRequired};var C=(0,n.connect)(function(e,t){return{showContextMenu:e.generic.contextMenusById[t.uuid],productPlayingUuid:e.marketplace.productPlayingUuid}},{addToCollection:u.addToCollection,removeFromCollection:u.removeFromCollection,setContextMenuState:d.setContextMenuState,closeAllContextMenus:d.closeAllContextMenus,rrProductClicked:p.rrProductClicked})(P);t.default=C},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(254);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("label",{className:"format ellipsify pointer"},(0,n.createFormatString)(this.props.format,this.props.instruments))}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFormatString=function(e,t){return"".concat(function(e){if(e&&e!=i)return function(e){return l("format."+e,e)}(e);return""}(e)).concat(function(e,t){var o=function(e){if(e){var t=e.indexOf(i);if(-1!==t)return e.splice(t,1),0===e.length?e:(e.push(i),e)}return e}(function(e){if(e){var t,o=e.length,r=[],n={};for(t=0;t<o;t++)n[e[t]]=0;for(t in n)r.push(t);return r}}(e)),c=t!=i&&e&&0!==e.length?": ":"";if(o&&function(e){return s[e]}(t)){if(t==a&&o.length>1)return": ".concat((0,r.resource)("content.various"));var u=o.map(function(e){return function(e){if(e==i)return(0,r.resource)("content.other");return l("genericInstrument."+(0,n.getStringForResourcesKey)(e),e)}(e)});return"".concat(c).concat(u.join(", "))}return""}(t,e))};var r=o(0),n=o(28),i="other",a="smallEnsemble",s={solo:!0,duet:!0,smallEnsemble:!0,other:!0};function l(e,t){return(0,r.hasResource)(e)?(0,r.resource)(e):t}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ProductColumn=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=h(o(18)),a=h(o(118)),s=h(o(196)),l=h(o(99)),c=h(o(198)),u=o(0),d=o(2),p=o(15),f=o(49);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}(this,b(t).call(this,e))).handleOnClick=o.handleOnClick.bind(y(y(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,r.Component),function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(t,[{key:"handleOnClick",value:function(){(0,d.navigate)(this.props.marketplace_url)}},{key:"renderAudioPreview",value:function(){return r.default.createElement(l.default,{id:this.props.uuid,hasCustomAudioMedia:this.props.has_custom_audio_media,url:this.props.audio_preview_url})}},{key:"renderOfficialBadge",value:function(){return this.props.official&&r.default.createElement(c.default,null)}},{key:"renderStars",value:function(){return this.props.average_rating>0&&r.default.createElement("div",{className:"ratings right"},r.default.createElement(s.default,{total:this.props.average_rating,size:"small"}),r.default.createElement("span",{className:"reviewCount"},(0,p.abbreviateNumber)(this.props.reviews_count)))}},{key:"renderContributors",value:function(){var e=(0,f.firstContributor)(this.props.contributors),t=(0,f.firstArranger)(this.props.contributors);return t&&(e="".concat(e,", ").concat((0,u.resource)("content.arr",t))),r.default.createElement("div",{className:"ellipsify contributors"},e)}},{key:"render",value:function(){return r.default.createElement("a",{className:"noTextDecoration",href:this.props.marketplace_url},r.default.createElement("div",{className:"scoreItem withCoverArt",onClick:this.handleOnClick,"data-type":"CollectionDocument"},r.default.createElement(a.default,{size:"columnSize",backgroundImageUrl:this.props.cover_art_url,overlay:this.props.cover_art_directive},this.renderAudioPreview()),r.default.createElement("div",{className:"productBody"},r.default.createElement("div",{className:"topRow"},r.default.createElement("div",{className:"titleContainer"},r.default.createElement("div",{className:"title ellipsify"},this.props.title),this.renderOfficialBadge()),r.default.createElement("div",{className:"price right"},(0,p.formatPriceInCents)(this.props.price,{currency:this.props.currency,showDouble0ForCents:!1}))),r.default.createElement("div",{className:"bottomRow"},this.renderContributors(),this.renderStars()))))}}]),t}();t.ProductColumn=_,_.propTypes={title:i.default.string.isRequired};var S=(0,n.connect)(function(e){return{productPlayingUuid:e.marketplace.productPlayingUuid}},{})(_);t.default=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"render",value:function(){var e="".concat(this.props.direction,"Arrow"),t="fa-angle-".concat(this.props.direction);return r.default.createElement("div",{className:"scrollingArrow ".concat(e),onClick:this.props.clickCallback},r.default.createElement("i",{className:"fa ".concat(t),"aria-hidden":"true"}))}}]),t}();t.default=c,c.defaultProps={clickCallback:function(){},direction:"right"}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recommendedSelector=t.recommendedIdsSelector=t.recommendedTitleSelector=void 0;var r=o(12),n=o(34),i=function(e){return e.marketplace.recommendedTitle};t.recommendedTitleSelector=i;var a=function(e){return e.marketplace.recommendedIds};t.recommendedIdsSelector=a;var s=(0,r.createSelector)(i,a,n.productsSelector,function(e,t,o){return{recommendedTitle:e,recommended:t.map(function(e){return o[e]})}});t.recommendedSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(2),i=o(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"goToMarketplace",value:function(){(0,n.navigate)((0,n.path)("marketplace"))}},{key:"renderArrow",value:function(){return this.props.showArrow&&r.default.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})}},{key:"render",value:function(){return r.default.createElement("div",{className:"marketplaceLogoContainer",onClick:this.goToMarketplace},this.renderArrow(),r.default.createElement("div",{className:"marketplaceLogo"},r.default.createElement("span",null,(0,i.resource)("content.marketplace"))))}}]),t}();t.default=d,d.defaultProps={showArrow:!0}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCurrentSubscription=i,t.getCurrentCreditSubscription=a,t.figureOutCurrentSubscription=function(e,t){var o=i(e);o||(o=a(t))||(o={plan:{name:(0,n.resource)("content.noteflightBasic"),plan_code:"basic"},state:"active",add_ons:[]});return o},t.isBasicSubscription=function(e){if(!e)return!1;return e.plan.plan_code.match(/basic/)},t.isLearnSubscription=function(e){if(!e)return!1;return e.plan.plan_code.match(/learn/)},t.extractSubscriptionStartDate=function(e){if(!e||!e.current_period_started_at)return null;return(0,r.formatDate)(1e3*e.current_period_started_at)},t.extractSubscriptionEndDate=function(e){if(!e||!e.current_period_ends_at)return null;return(0,r.formatDate)(1e3*e.current_period_ends_at)};var r=o(20),n=o(0);function i(e){if(!e)return null;for(var t=0;t<e.length;t++){var o=e[t].state;e[t].plan;if("active"==o||"canceled"==o)return e[t]}return null}function a(e){if(!e)return null;for(var t=0;t<e.length;t++)if(e[t].active)return{plan:{name:(0,n.resource)("content."+e[t].type),plan_code:"complimentaryCredit"},state:"active",add_ons:[],current_period_started_at:e[t].start_date,current_period_ends_at:e[t].revoked_at||e[t].expiration_date||e[t].termination_date};return null}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(0),i=o(2),a=o(49);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this))).handleSongClick=e.handleSongClick.bind(d(d(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"handleSongClick",value:function(){this.props.handleClick(this.props.song.uuid,!this.props.checked)}},{key:"dummyFunction",value:function(){}},{key:"renderContributors",value:function(e){return(0,a.allFirstContributors)(e).join(", ")}},{key:"renderNonArrangeable",value:function(){return this.props.ignoreArrangeable||this.props.song.arrangeable?null:r.default.createElement("div",{className:"localLeft","data-bind":"hint: { resource: 'hint.copyrightDisabledBlurb', position: 'bottom', html: true, sticky: true }"},r.default.createElement("div",{className:"notArrangeableFakeButton tippy","data-tippy-content":(0,n.resource)("hint.copyrightDisabledBlurb")}))}},{key:"renderCheckbox",value:function(){return this.props.song.arrangeable||this.props.ignoreArrangeable?r.default.createElement("div",{className:"localLeft"},this.props.showCheckbox&&r.default.createElement("input",{type:"checkbox",className:"checkbox",checked:this.props.checked,onChange:this.dummyFunction})):null}},{key:"render",value:function(){return r.default.createElement("div",{className:"hintItem"},r.default.createElement("div",{className:"resultsItem",onClick:this.handleSongClick},this.renderNonArrangeable(),this.renderCheckbox(),r.default.createElement("div",{className:"inlineBlock workDetails"},r.default.createElement("div",{className:"workTitle"},this.props.song.title),r.default.createElement("div",{className:"workComposers ellipsify"},this.renderContributors(this.props.song.contributors))),this.props.song.public_domain&&r.default.createElement("div",{className:"publicDomain"},(0,n.resource)("content.publicDomain")),!this.props.song.public_domain&&this.props.song.has_active_products&&this.props.song.arrangeable&&this.props.showViewLink&&r.default.createElement("a",{href:(0,i.path)("marketplaceSearchQuery",{searchQuery:encodeURIComponent("keyword:".concat(this.props.song.title,"&song_id:").concat(this.props.song.uuid))}),className:"standardLink viewLink"},(0,n.resource)("action.view"))))}}]),t}();t.default=p,p.defaultProps={showViewLink:!0,showCheckbox:!1,ignoreArrangeable:!1}},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message="errors.".concat(t),this.show=ko.observable(!0)}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"onClick",value:function(){this.show(!1)}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=["bankAccountClosed","bankAccountFrozen","bankAccountRestricted","bankAccountOwnership","payoutCurrency","payoutDestinationCouldNotProcess","bankAccountDebitNotAuthorized","bankAccountInsufficientFunds","bankAccountAccountNumber","bankAccountNoAccount","payoutUnsupportedCard"];t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(190)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=n.resource,this.initializeObservables()}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"initializeObservables",value:function(){this.composer=ko.observable(),this.performer=ko.observable(),this.educationalRole=ko.observable(),this.primaryInstrument=ko.observable(),this.instrumentFamilies=ko.observable((0,r.default)()),this.composerSkillLevel=ko.observable(),this.performerSkillLevel=ko.observable()}},{key:"getInfo",value:function(){return{composer:this.composer(),performer:this.performer(),educational_role:this.educationalRole(),primary_instrument:this.primaryInstrument(),composer_skill_level:this.composerSkillLevel(),performer_skill_level:this.performerSkillLevel()}}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version=i;var r=o(20),n=o(6);function i(e){var t={creator:{create:function(e){return n.ko.observable(new n.Noteflight.User(e.data))}}};n.ko.mapping.fromJS(e,t,this),this.createdDate=this.created?(0,r.observableRelativeTime)(this.created()):null}n.Noteflight.Version=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(20),n=function(e){return e&&e.__esModule?e:{default:e}}(o(43)),i=o(6);var a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o={user:{create:function(e){return i.ko.observable(new n.default(e.data))}}};i.ko.mapping.fromJS(t,o,this),this.createdDate=(0,r.observableRelativeTime)(this.created())};t.default=a,i.NF.Favorite=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(19));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(e){var o;return a(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this))).editor=e,o.canEdit=ko.computed(function(){return e.contentPolicy().can_edit}),o.instruments=ko.observableArray([]),o.instrumentToMove=ko.observable(-1),o.score=o.editor.controller.score,o.staffChangeBinding=o.staffChangeBinding.bind(d(d(o))),o.score.addEventListener("staffChange",o.staffChangeBinding),o.initialize(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),l(t,[{key:"staffChangeBinding",value:function(){this.refreshInstrumentsList()}},{key:"moverClick",value:function(e){-1==this.instrumentToMove()?this.instrumentToMove(e.index):(this.instrumentToMove()!=e.index&&this.editor.scoreApi.movePart(this.instrumentToMove(),e.index),this.instrumentToMove(-1))}},{key:"refreshInstrumentsList",value:function(){var e=this;this.instruments([]);var t=0;this.score.parts.forEach(function(o){e.instruments.push(new f(e.editor,o,t,e)),t++}),this.canEdit()&&!n.isTouchDevice()&&setTimeout(function(){e.setupSortableElements()},1e3)}},{key:"setupSortableElements",value:function(){var e=this,t=null;$("#sortableInstruments").sortable({start:function(e,o){t=$(o.item).index()},update:function(o,r){var n=$(r.item).index();n!=t&&(e.editor.scoreApi.movePart(t,n),e.instrumentToMove(-1))}}),$("#sortableInstruments").disableSelection()}},{key:"initialize",value:function(){this.refreshInstrumentsList()}},{key:"showAllInstruments",value:function(){this.editor.controller.document.undoHistory.openGroup("showAllParts");for(var e=0;e<this.instruments().length;e++)this.instruments()[e].setVisibleImmediately(!0)}},{key:"selectInstrument",value:function(e){this.editor.scoreApi.selectPart(e)}},{key:"addInstrument",value:function(){this.canEdit()&&this.editor.addInstrument()}},{key:"removeInstrument",value:function(e){if(1==this.instruments().length)return!1;var t=this.visibleInstruments();1==t.length&&t[0]==e&&this.showAllInstruments(),this.editor.scoreApi.removeInstrument(e.part)}},{key:"editTuning",value:function(e){this.editor.scoreDialogs.editStringTuning(e)}},{key:"showOnlyOneInstrument",value:function(e){this.editor.controller.document.undoHistory.openGroup("showOnePart"),e.setVisibleImmediately(!0);for(var t=0;t<this.instruments().length;t++)this.instruments()[t]!=e&&this.instruments()[t].setVisibleImmediately(!1)}},{key:"checkShowOnlyButtons",value:function(){var e=this.visibleInstruments();if(e.length>1)for(var t=0;t<this.instruments().length;t++)this.instruments()[t].showOnlyChecked(!1);else 1==e.length&&e[0].showOnlyChecked("on")}},{key:"totalVisibleInstruments",value:function(){return this.visibleInstruments().length}},{key:"visibleInstruments",value:function(){for(var e=[],t=0;t<this.instruments().length;t++)this.instruments()[t]&&this.instruments()[t].visible()&&e.push(this.instruments()[t]);return e}}]),t}();t.default=p;var f=function(){function e(t,o,r,n){a(this,e),this.part=o,this.index=r,this.editor=t,this.dialog=n,this.initializeObservables(),this.initializeComputeds()}return l(e,[{key:"initializeObservables",value:function(){this.name=ko.observable(this.part.nameToShow),this.visible=ko.observable().extend({bindProperty:{source:this.part,property:"visible"}}),this.showOnlyChecked=ko.observable()}},{key:"initializeComputeds",value:function(){var e=this;this.isTabClef=ko.computed(function(){return e.part.staves[0].type.isTablature()}),ko.computed(function(){e.visible(),e.dialog.checkShowOnlyButtons()}).extend({throttle:10}),this.toggleShowEnabled=ko.computed(function(){return!e.visible()||e.dialog.totalVisibleInstruments()>1}),this.isTheMover=ko.computed(function(){return e.index==e.dialog.instrumentToMove()}),this.isAboveTheMover=ko.computed(function(){return e.dialog.instrumentToMove()>=0&&e.index<e.dialog.instrumentToMove()}),this.isBelowTheMover=ko.computed(function(){return e.dialog.instrumentToMove()>=0&&e.index>e.dialog.instrumentToMove()})}},{key:"setVisibleImmediately",value:function(e){this.part.visible=e}},{key:"select",value:function(){this.dialog.selectInstrument(this.part)}},{key:"edit",value:function(){this.dialog.selectInstrument(this.part),this.dialog.editor.changeParts()}},{key:"remove",value:function(){this.dialog.removeInstrument(this)}},{key:"editTuning",value:function(){this.isTabClef()&&this.dialog.editTuning(this.part)}},{key:"toggleShow",value:function(){if(this.visible()||0!==this.dialog.totalVisibleInstruments()){var e=this.visible()?"Show":"Hide";return this.editor.controller.document.undoHistory.openGroup(e+" Part"),this.part.visible=this.visible(),!0}this.visible(!0)}},{key:"showOnly",value:function(){return this.dialog.showOnlyOneInstrument(this),!0}},{key:"moverClick",value:function(){this.dialog.moverClick(this)}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=h(o(4)),n=h(o(204)),i=h(o(489)),a=o(2),s=o(0),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(28)),c=o(8),u=o(5),d=o(14),p=o(17),f=o(31);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}(this,b(t).call(this))).shoppingCartQuantity=e,o.username=ko.observable(""),o.password=ko.observable(""),o.usernameAlreadyExists=ko.observable(),o.usernameInvalidChars=ko.observable(),o.showUsernameError=ko.observable(!1),o.usernameErrorMessage=ko.observable(""),o.showPasswordError=ko.observable(!1),o.passwordErrorMessage=ko.observable(""),o.usernameAvailable=ko.computed(function(){return!o.usernameAlreadyExists()&&!o.usernameInvalidChars()}),o.usernameValidationUnderlay=new i.default(o.username,o.usernameAvailable),o.throttledUsername=ko.computed(function(){o.showUsernameError(!1),o.username().trim()&&o.usernameCheck()}).extend({throttle:20}),o.usernameInvalidChars.subscribe(function(e){e&&(o.showUsernameError(!0),o.usernameErrorMessage((0,s.resource)("errors.usernameFormat")))}),o.password.subscribe(function(){o.showPasswordError(!1)}),o.handleUsernameCheck=o.handleUsernameCheck.bind(y(y(o))),o.loginUser=o.loginUser.bind(y(y(o))),o.signupComplete=o.signupComplete.bind(y(y(o))),o.initializeConnectedProperties(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,n.default),function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.contentId=ko.observable(),(0,d.connect)(p.productIdSelector,{})(this)}},{key:"usernameCheck",value:function(){var e=this;NF.apiService.checkUsernameUseability((0,s.resource)("action.validating"),function(t){return e.handleUsernameCheck(t)},{username:this.username()},{})}},{key:"handleUsernameCheck",value:function(e){this.username()===e.username&&(this.usernameAlreadyExists(e.username_taken),this.usernameInvalidChars(e.invalid_chars),this.usernameInvalidChars.valueHasMutated())}},{key:"setReturnToTerms",value:function(){NF.hasStorage&&localStorage.setItem("productPurchasing-".concat(this.contentId()),this.shoppingCartQuantity())}},{key:"signupWithGoogle",value:function(){return!(!this.validateTermsAcceptance()||!(0,f.verifyCookiesEnabled)())&&(this.setReturnToTerms(),NF.analytics.trackEvent("conversion","signup_click_google",NF.currentRouteName),(0,a.navigate)("/auth/google/?external_sign_up=true&return_to="+window.location),!0)}},{key:"signupWithFacebook",value:function(){return!(!this.validateTermsAcceptance()||!(0,f.verifyCookiesEnabled)())&&(this.setReturnToTerms(),NF.analytics.trackEvent("conversion","signup_click_facebook",NF.currentRouteName),(0,a.navigate)("/auth/facebook/?external_sign_up=true&return_to="+window.location),!0)}},{key:"signup",value:function(){this.validateEmail()&&this.validateUsername()&&this.validatePassword()&&this.validateTermsAcceptance()&&this.validateCaptchaCompletion()&&(this.sendEmail(),this.registerUser(),NF.analytics.trackEvent("conversion","signup_email",NF.currentRouteName))}},{key:"registerUser",value:function(){this.setReturnToTerms();var e={email:this.email(),username:this.username(),password:this.password(),password_confirmation:this.password(),skip_email_check:!0,leave_anonymous:!0};NF.apiService.registerUser({text:(0,s.resource)("session.signingUp"),fullScreen:!0,withBackground:!0},this.loginUser,e,{})}},{key:"loginUser",value:function(){r.default.publish(u.REPORTER_REMOVE,{fullScreen:!0}),NF.apiService.loginUser({text:(0,s.resource)("session.loggingIn"),fullScreen:!0,withBackground:!0},function(e){NF.reloadWindow()},{signon:this.username(),password:this.password()},{})}},{key:"validateUsername",value:function(){var e=l.validateUsername(this.username()).error;return e?(this.showUsernameError(!0),this.usernameErrorMessage((0,s.resource)(e)),!1):!this.usernameInvalidChars()||(this.showUsernameError(!0),this.usernameErrorMessage((0,s.resource)("errors.usernameFormat")),!1)}},{key:"validatePassword",value:function(){var e=l.validatePassword(this.password()).error;if(e){switch(this.showPasswordError(!0),e){case"errors.passwordRequired":this.passwordErrorMessage((0,s.resource)(e));break;case"errors.passwordTooShort":this.passwordErrorMessage((0,s.resource)(e,c.MIN_PASSWORD_LENGTH));break;case"errors.passwordTooLong":this.passwordErrorMessage((0,s.resource)(e,c.MAX_PASSWORD_LENGTH))}return!1}return!0}}]),t}();t.default=_},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.course_id=t.course_id,this.id=t.id,this.title=t.title,this.materials=t.materials,this.creation_time=t.creation_time,this.update_time=t.update_time,this.state=t.state,this.late=t.late,this.work_type=t.work_type,this.due_date=t.due_date||null,this.due_time=t.due_time||null,this.description=t.description||null}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"validDueDate",value:function(){var e=new Date,t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),o=this.unpackDueDate();return null!=o&&!(o.getTime()<t.getTime())}},{key:"unpackDueDate",value:function(){if(this.due_date&&this.due_time){var e=new Date(Date.UTC(this.due_date.year,this.due_date.month-1,this.due_date.day,this.due_time.hours,this.due_time.minutes));return isNaN(e)?null:e}return null}}],[{key:"dueDateObject",value:function(e){return e?{year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate()}:null}},{key:"dueTimeObject",value:function(e){return{hours:e.getUTCHours(),minutes:e.getUTCMinutes(),seconds:0,nanos:0}}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SELLING=t.SHARING=void 0;var r=l(o(4)),n=l(o(13)),i=o(0),a=o(3),s=o(5);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h="sharing";t.SHARING=h;t.SELLING="selling";var m=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,p(t).call(this))).title=ko.observable(""),o.caller=ko.observable(e),o.instructions=o.caller()===h?(0,i.resource)("content.scoreTitlePrompt"):(0,i.resource)("content.scoreTitlePromptSelling"),o.hasDisplayed=ko.observable(!1),o.callback=null,o.initializeComputeds(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"initializeComputeds",value:function(){var e=this;this.saveEnabled=ko.computed(function(){return e.title().length>0})}},{key:"cancel",value:function(){(0,a.hideCurrentDialog)(this),null!=this.callback&&this.callback(!1)}},{key:"doOk",value:function(){return r.default.publish(s.SCORE_SET_TITLE,this.title().trim()),r.default.publish(s.SCORE_REQUIRE_SAVE),!0}},{key:"ok",value:function(){this.doOk()&&((0,a.hideCurrentDialog)(this),null!=this.callback&&this.callback(!0))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.callback=e,this.hasDisplayed(!0),(0,a.createAndShowDialog)({viewModel:this,templateName:"dialogs/scoreTitlePrompt"})}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createWizard=function(e,t,o){return{type:r.CREATE_WIZARD,id:e,currentStepId:t,steps:o}},t.removeWizard=function(e){return{type:r.REMOVE_WIZARD,id:e}},t.previousStep=function(e){return{type:r.PREVIOUS_STEP,id:e}},t.nextStep=function(e){return{type:r.NEXT_STEP,id:e}},t.setStepStatus=function(e,t,o){return{type:r.SET_STEP_STATUS,id:e,stepId:t,complete:o}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(109))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=s(o(18)),i=s(o(513)),a=o(0);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this,e))).handleInputClick=o.handleInputClick.bind(p(p(o))),o.handleWindowClick=o.handleWindowClick.bind(p(p(o))),o.handleChange=o.handleChange.bind(p(p(o))),o.resultsElement=null,o.inputElement=null,o.setResultsElementRef=function(e){o.resultsElement=e},o.setInputElementRef=function(e){o.inputElement=e},window.addEventListener("click",o.handleWindowClick),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.handleWindowClick)}},{key:"handleWindowClick",value:function(e){null!==this.resultsElement&&(this.resultsElement.contains(e.target)?this.props.results.length<1&&!this.props.loaded&&this.callFocusHandler(!0):e.target!==this.inputElement&&this.callFocusHandler(!1))}},{key:"handleInputClick",value:function(){this.props.results.length<1&&!this.props.loaded&&this.callFocusHandler(!0)}},{key:"handleChange",value:function(e){this.props.changeHandler(e)}},{key:"callFocusHandler",value:function(e){void 0!==this.props.focusHandler&&this.props.focusHandler(e)}},{key:"renderResults",value:function(){var e=this;if(this.props.results.length<1&&!this.props.loaded)return null;var t=this.props.results.map(function(t){return r.default.createElement(i.default,{key:t.id,id:t.id,name:t.name,imageUrl:t.imageUrl,clickHandler:e.props.resultClickHandler})});return t.length<1&&!this.props.loading&&(t=r.default.createElement("div",{className:"noResults"},(0,a.resource)("content.noResultsFor",this.props.query))),r.default.createElement("div",{className:"results",ref:this.setResultsElementRef},t)}},{key:"render",value:function(){return r.default.createElement("div",{className:"searchWithDropdownResults"},r.default.createElement("input",{type:"text",ref:this.setInputElementRef,name:this.props.name,value:this.props.query,placeholder:this.props.placeholder,onChange:this.handleChange,onClick:this.handleInputClick}),this.renderResults())}}]),t}();t.default=f,f.propTypes={name:n.default.string.isRequired,query:n.default.string.isRequired,placeholder:n.default.string,results:n.default.arrayOf(n.default.shape({id:n.default.oneOfType([n.default.string,n.default.number]).isRequired,name:n.default.string.isRequired,imageUrl:n.default.string.isRequired})).isRequired,loaded:n.default.bool,loading:n.default.bool,changeHandler:n.default.func.isRequired,resultClickHandler:n.default.func.isRequired,focusHandler:n.default.func}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=c(o(18)),i=o(36),a=o(0),s=c(o(122)),l=o(8);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this,e))).handleChange=o.handleChange.bind(h(h(o))),o.handleRemove=o.handleRemove.bind(h(h(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,r.Component),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"componentDidMount",value:function(){(0,i.initializeTippy)(i.defaultHint)}},{key:"handleChange",value:function(e){var t=e.target.value;this.props.changeHandler(this.props.id,t)}},{key:"handleRemove",value:function(){this.props.removeHandler(this.props.id)}},{key:"render",value:function(){var e={backgroundImage:"url('".concat(this.props.imageUrl,"')")},t=[{value:l.DOCUMENT_ROLE_READER,label:"editor.sharingInfo.roleReader"},{value:l.DOCUMENT_ROLE_REVIEWER,label:"editor.sharingInfo.roleCommenter"},{value:l.DOCUMENT_ROLE_COAUTHOR,label:"editor.sharingInfo.roleCoauthor"}],o=this.props.notActive?"notActive tippy":null,n=this.props.notActive?(0,a.resource)("hint.archivedGroup"):null;return r.default.createElement("div",{className:"sharedWith"},r.default.createElement("div",{className:"sharedContents "+o,"data-tippy-content":n},r.default.createElement("div",{className:"sharedWithImage",style:e}),r.default.createElement("span",{className:"sharedWithName"},this.props.name),r.default.createElement(s.default,{name:"role".concat(this.props.id),value:this.props.permissions,changeHandler:this.handleChange,options:t,notActive:this.props.notActive})),r.default.createElement("div",{className:"remove",onClick:this.handleRemove}))}}]),t}();t.default=m,m.propTypes={id:n.default.oneOfType([n.default.string,n.default.number]).isRequired,name:n.default.string.isRequired,imageUrl:n.default.string.isRequired,notActive:n.default.bool,permissions:n.default.string.isRequired,changeHandler:n.default.func.isRequired,removeHandler:n.default.func.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(14),n=o(0),i=o(520),a=function(e){return e&&e.__esModule?e:{default:e}}(o(101));function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="marketplace",c=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.commerceLinks=ko.observableArray([]),this.smdAssets=ko.observableArray([]),this.marketplaceAssets=ko.observableArray([]),this.logoType=ko.observable(l),this.marketplaceAssets.subscribe(function(){t.showLinks()}),this.smdAssets.subscribe(function(){t.showLinks()}),(0,r.connect)(i.commerceLinksSelector,{})(this),this.showLinks()}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"showLinks",value:function(){var e=this,t=[];this.marketplaceAssets().length>0?t=this.marketplaceAssets().map(function(t){var o=new a.default(t.contributors);return{title:e.formatTitle(t.title,o.firstContributor(),t.format),url:t.marketplace_url}}):this.smdAssets().length>0&&(t=this.smdAssets().map(function(t){return{title:e.formatTitle(t.title,t.contributors[0],t.format),url:t.smd_url}})).length>0&&this.logoType("smd"),this.commerceLinks(t)}},{key:"formatTitle",value:function(e,t,o){var r=[e];if(t&&r.push("/ ".concat(t)),null!=o){var i=null;(0,n.hasResource)("scoreFormat.".concat(o))?i=(0,n.resource)("scoreFormat.".concat(o)):(0,n.hasResource)("format.".concat(o))&&(i=(0,n.resource)("format.".concat(o))),i&&r.push("(".concat(i,")"))}return r.join(" ")}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ENSEMBLE_AND_PRICING=t.INSTRUMENTS_MAPPING=t.SCORE_DETAILS=t.SCORE_TEXT=t.COPYRIGHT_INFORMATION=void 0;var r=k(o(4)),n=k(o(126)),i=o(14),a=o(2),s=o(0),l=o(28),c=o(3),u=o(5),d=o(8),p=k(o(523)),f=k(o(524)),h=k(o(527)),m=k(o(528)),g=k(o(529)),b=k(o(531)),v=k(o(101)),y=k(o(275)),_=k(o(532)),S=o(534),w=o(100);function k(e){return e&&e.__esModule?e:{default:e}}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,o){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var M="copyrightInformation";t.COPYRIGHT_INFORMATION=M;var A="scoreText";t.SCORE_TEXT=A;var N="scoreDetails";t.SCORE_DETAILS=N;var I="instrumentsMapping";t.INSTRUMENTS_MAPPING=I;var x="pricingInformation";t.ENSEMBLE_AND_PRICING=x;var D=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?O(e):t}(this,T(t).call(this))).editor=(0,w.getApplicationEditor)(),e.score=e.editor.score(),e.scoreModel=e.editor.html5Editor().controller.score,e.options=o,e.originalTitle=e.scoreModel.title,e.originalComposer=e.scoreModel.composer,e.originalLyricist=e.scoreModel.lyricist,e.originalCopyright=e.scoreModel.copyright,e.readyToBeSold=!1,e._scoreModelToOverwrite=new $$nf.classes.com.noteflight.notation.model.Score,e._songInfo=new y.default,e._contributorsList=new v.default,e.royaltyAssignment=new _.default,e.handlePublishScoreSucceeded=e.handlePublishScoreSucceeded.bind(O(O(e))),e.handlePublishScoreFail=e.handlePublishScoreFail.bind(O(O(e))),e.initializeDefaultCopyrightSelection=e.initializeDefaultCopyrightSelection.bind(O(O(e))),e.copyrightViewModelOptions={updatingProduct:e.options.updatingProduct},e.scoreTextViewModelOptions={},e.scoreDetailsViewModelOptions={},e.ensembleAndPriceViewModelOptions={showVersioning:e.options.showVersioning,updatingProduct:e.options.updatingProduct},e.initializeObservables(),e.initializeConnectedProperties(),e.initializeComputeds(),e.initializeData(),e.copyrightViewModel=new f.default(e.title,e.scoreModel,e.isProductCopy,e.sourceProduct,e.selectedCopyrightOption,e.royaltyAssignment,e.copyrightViewModelOptions),e.scoreTextViewModel=new h.default(e.scoreModel,e.isProductCopy,e.scoreTextViewModelOptions),e.scoreDetailsViewModel=new m.default(e.score,e.copyrightViewModel.isArrangementAuthorship,e.scoreDetailsViewModelOptions),e.instrumentsMappingViewModel=new g.default(e.scoreModel),e.ensembleAndPriceViewModel=new b.default(e.selectedCopyrightOption,e.royaltyAssignment,e.isArrangementOfExternalCopyrightedWork,e.score.format,e.copyrightViewModel.isArrangementAuthorship,e.ensembleAndPriceViewModelOptions),e.selectedCopyrightOption.subscribe(function(){e._clearInfo()}),e.copyrightViewModel.initialCopyrightSelection.subscribe(function(){e._clearInfo(),e._resetScoreDetailsOptions()}),e.addWizardStep(M,e.copyrightViewModel,"fragments/sellScoreCopyright"),e.addWizardStep(A,e.scoreTextViewModel,"fragments/sellScoreText"),e.addWizardStep(N,e.scoreDetailsViewModel,"fragments/sellScoreDetails"),e.addWizardStep(I,e.instrumentsMappingViewModel,"fragments/instrumentsMapping"),e.addWizardStep(x,e.ensembleAndPriceViewModel,"fragments/sellScoreEnsembleAndPrice"),e.scoreSavedToken=r.default.subscribe(u.SCORE_SAVED,function(t,o){e.savingScore(!1),e.readyToBeSold&&e.doSellScore()}),r.default.subscribe(u.SCORE_PUBLISH_FAIL,function(){e.handlePublishScoreFail()}),e.scrollInlineErrorToken=r.default.subscribe(u.SCROLL_INLINE_ERROR,function(e,t){var o=t.id;$(".scrollableDialog").animate({scrollTop:t.position-$(".scrollableDialog").offset().top+$(".scrollableDialog").scrollTop()},"fast",function(){r.default.publish(u.SCROLL_INLINE_ERROR_SCROLLED,{id:o})})}),r.default.subscribe(u.SELLING_WORK_SELECTED,function(){e._resetScoreDetailsOptions()}),e.initialize(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,p.default),function(e,t,o){t&&P(e.prototype,t),o&&P(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.scoreId=ko.observable(),this.title=ko.observable(),this.sourceProduct=ko.observable(),this.sourceSong=ko.observable(),this.isProductCopy=ko.observable(),this.hasBeenPurchased=ko.observable(),this.sellableArrangements=ko.observable(),this.currentModel=ko.observable(),this.contentType=ko.observable(),(0,i.connect)(S.sellScoreSelector,{})(this)}},{key:"initializeObservables",value:function(){this.savingScore=ko.observable(!1),this.copyrightInformationSelected=ko.observable(!0),this.scoreTextSelected=ko.observable(!1),this.scoreDetailsSelected=ko.observable(!1),this.ensembleInformationSelected=ko.observable(!1),this.publishing=ko.observable(!1),this.selectedCopyrightOption=ko.observable()}},{key:"initializeComputeds",value:function(){var e=this;this.nextCanBeEnabled=ko.computed(function(){return!e.savingScore()&&!e.publishing()}),this.isArrangementOfCopyrightedWork=ko.computed(function(){return e.selectedCopyrightOption()===d.ARRANGEMENT_AUTHORSHIP||e.selectedCopyrightOption()===d.ARRANGEMENT_EXISTING_WORK}),this.isArrangementOfExternalCopyrightedWork=ko.computed(function(){return e.isArrangementOfCopyrightedWork()&&(e.royaltyAssignment.blackbox()||null!=e.royaltyAssignment.song()&&(null!=e.royaltyAssignment.song().catalogSongId()||e.royaltyAssignment.song().blackbox()&&e.royaltyAssignment.song().publicDomain()))})}},{key:"initializeData",value:function(){this.songInitialization(),this.initializeDefaultCopyrightSelection(),this.initializeProductPurchased(),this.initializeProductArrangeable(),this.initializeProductPrice(),this.initializeProductPreview(),this.initializeDefaultContributors()}},{key:"_resetScoreDetailsOptions",value:function(){this.scoreDetailsViewModelOptions.composers=null,this.scoreDetailsViewModelOptions.lyricists=null,this.scoreDetailsViewModelOptions.artist=null,this.scoreDetailsViewModelOptions.previewType=null}},{key:"songInitialization",value:function(){this.currentModel().official||null==this.sourceSong()||this.royaltyAssignment.updateFromSong(new y.default(this.sourceSong()))}},{key:"initializeProductPurchased",value:function(){this.ensembleAndPriceViewModelOptions.hasBeenPurchased=this.hasBeenPurchased()}},{key:"initializeProductArrangeable",value:function(){this.ensembleAndPriceViewModelOptions.sellableArrangements=this.sellableArrangements()}},{key:"initializeDefaultCopyrightSelection",value:function(){this.contentType()==d.PRODUCT&&!this.currentModel().official&&this.sourceSong()&&(this.copyrightViewModelOptions.initialCopyrightSelection=d.ARRANGEMENT_EXISTING_WORK,this.copyrightViewModelOptions.selectedCopyrightSelection=this.sourceSong().public_domain?d.PUBLIC_DOMAIN_AUTHORSHIP:d.ARRANGEMENT_AUTHORSHIP)}},{key:"initializeDefaultContributors",value:function(){if(this.contentType()==d.PRODUCT){var e=new v.default(this.currentModel().contributors);this.scoreTextViewModelOptions.arranger=e.firstArranger(),this.scoreDetailsViewModelOptions.composers=e.extractComposers(),this.scoreDetailsViewModelOptions.lyricists=e.extractLyricists(),this.scoreDetailsViewModelOptions.artist=e.extractArtist()}}},{key:"initializeProductPrice",value:function(){this.contentType()==d.PRODUCT&&(this.ensembleAndPriceViewModelOptions.price=this.currentModel().price/100)}},{key:"initializeProductPreview",value:function(){this.contentType()==d.PRODUCT&&(this.scoreDetailsViewModelOptions.previewType=this.currentModel().preview_type)}},{key:"_clearInfo",value:function(){this.scoreTextViewModel.clear(),this.scoreDetailsViewModel.clear(),this.revertEnforcedInformation()}},{key:"initialize",value:function(){this.selectStepByName(M)}},{key:"reset",value:function(){this.selectStepByName(M),this.copyrightViewModel.reset()}},{key:"_unsubscribe",value:function(){r.default.unsubscribe(this.scoreSavedToken),r.default.unsubscribe(this.scrollInlineErrorToken)}},{key:"revertEnforcedInformation",value:function(){this._scoreModelToOverwrite.title=this.originalTitle,this._scoreModelToOverwrite.composer=this.originalComposer,this._scoreModelToOverwrite.lyricist=this.originalLyricist,this._scoreModelToOverwrite.copyright=this.originalCopyright}},{key:"cancel",value:function(){this._unsubscribe(),this.reset(),C(T(t.prototype),"cancel",this).call(this)}},{key:"doOk",value:function(){return!1}},{key:"handleNextClick",value:function(){var e=this.currentStep().name();if(C(T(t.prototype),"handleNextClick",this).call(this)){NF.analytics.trackEvent("Marketplace","score_publish_wizard_next",e);var o=!this.copyrightViewModel.isArrangementAuthorship()&&!this.copyrightViewModel.isArrangement()&&!this.isProductCopy();switch(e){case M:this.copyrightViewModel.cleanUp(),this.copyrightViewModel.isOriginalWork()?(this._updateSongInfo(this.copyrightViewModel.extractSongInfo()),this.scoreTextViewModel.initialize(this.copyrightViewModel.isOriginalWork(),this.scoreModel),this._updateSongInfo(this.scoreTextViewModel.extractCopyright())):(this.isProductCopy()?(this._songInfo=new y.default(this.sourceSong()),this._updateContributorsInfo(this.sourceProduct().contributors)):(this._updateSongInfo(this.copyrightViewModel.extractSongInfo()),this._enforceComposerSize()),this._updateDataToOverwriteScoreModel(this.copyrightViewModel.extractScoreModelInfo()),this.scoreTextViewModel.initialize(this.copyrightViewModel.isOriginalWork(),this._scoreModelToOverwrite));break;case A:this._updateDataToOverwriteScoreModel(this.scoreTextViewModel.extractScoreModelInfo()),this.copyrightViewModel.isOriginalWork()?this.scoreDetailsViewModel.initialize(!0,o):this.isProductCopy()?this.scoreDetailsViewModel.initialize(!1,o,this._contributorsList,this.scoreTextViewModel.extractArranger()):this.scoreDetailsViewModel.initialize(!1,o,this._songInfo.contributorsList,this.scoreTextViewModel.extractArranger());break;case N:this.copyrightViewModel.isOriginalWork()&&this._updateSongInfo(this.scoreDetailsViewModel.extractSongInfo()),this._updateContributorsInfo(this.scoreDetailsViewModel.extractContributorsInfo()),r.default.publish(u.SCORE_FORCE_SAVE);break;case I:this.ensembleAndPriceViewModel.initialize();break;case x:this._prepareToSell()}}}},{key:"_enforceComposerSize",value:function(){this.scoreModel.staffMetrics.composerSize=Math.min(this.scoreModel.staffMetrics.pageTextPxToLines(12),this.scoreModel.staffMetrics.composerSize)}},{key:"handleBackClick",value:function(){this.readyToBeSold=!1,C(T(t.prototype),"handleBackClick",this).call(this)}},{key:"_updateDataToOverwriteScoreModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,l.isNullOrUndefined)(e.title)||(this._scoreModelToOverwrite.title=e.title),(0,l.isNullOrUndefined)(e.composer)||(this._scoreModelToOverwrite.composer=e.composer),(0,l.isNullOrUndefined)(e.lyricist)||(this._scoreModelToOverwrite.lyricist=e.lyricist),(0,l.isNullOrUndefined)(e.copyright)||(this._scoreModelToOverwrite.copyright=e.copyright)}},{key:"_updateContributorsInfo",value:function(e){this._contributorsList.contributors(e)}},{key:"_updateSongInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.uuid&&this._songInfo.uuid(e.uuid),e.title&&this._songInfo.title(e.title),e.credits&&this._songInfo.credits(e.credits),e.copyright&&this._songInfo.copyright(e.copyright),e.composers&&(this._songInfo.contributorsList.clearContributors(d.COMPOSER),this._songInfo.contributorsList.addContributors(e.composers)),e.lyricists&&(this._songInfo.contributorsList.clearContributors(d.LYRICIST),this._songInfo.contributorsList.addContributors(e.lyricists)),e.artist&&this._songInfo.contributorsList.addContributors([e.artist]),e.arrangeable&&this._songInfo.arrangeable(e.arrangeable)}},{key:"_prepareToSell",value:function(){this.scoreModel.title=this._scoreModelToOverwrite.title||this.scoreModel.title,this.scoreModel.composer=this._scoreModelToOverwrite.composer||this.scoreModel.composer,this.scoreModel.lyricist=this._scoreModelToOverwrite.lyricist||this.scoreModel.lyricist,this.scoreModel.copyright=this._scoreModelToOverwrite.copyright||this.scoreModel.copyright,this.readyToBeSold=!0,r.default.publish(u.SCORE_FORCE_SAVE)}},{key:"doSellScore",value:function(){var e={arrangeable:this.ensembleAndPriceViewModel.allowArrangements()||!!this._songInfo.arrangeable(),price:Math.round(100*this.ensembleAndPriceViewModel.priceForInput()),ensemble_size_id:this.ensembleAndPriceViewModel.selectedEnsembleSizeOption(),score_external_id:this.scoreId(),contributors:this._contributorsList.contributors(),song_uuid:this._songInfo.uuid(),song_title:this._songInfo.title(),credits:this._songInfo.credits(),copyright:this._songInfo.copyright(),version_description:this.ensembleAndPriceViewModel.versionDescription(),instrument_names:this.instrumentsMappingViewModel.instrumentNames(),preview_type:this.scoreDetailsViewModel.previewType(),is_public_domain:this.copyrightViewModel.isArrangementOfPublicDomain(),is_arrangement:this.copyrightViewModel.isArrangement(),minimum_purchase_quantity:this.ensembleAndPriceViewModel.finalPurchaseMinimum()};this.publishing(!0),this.publishScore(e,this.handlePublishScoreSucceeded)}},{key:"handlePublishScoreSucceeded",value:function(e){NF.analytics.trackEvent("Marketplace","score_publish",e.price/100),NF.hasStorage&&localStorage.setItem("productPublished-".concat(e.uuid),!0),(0,a.navigate)(e.marketplace_url)}},{key:"show",value:function(){return(0,c.createAndShowDialog)({viewModel:this,templateName:"dialogs/sellScore"}),this}},{key:"handlePublishScoreFail",value:function(){this.publishing(!1)}},{key:"publishScore",value:function(e){function t(t,o){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){function o(e){var o=e[0];"active"===o.result.status&&t(o.result)}new Promise(function(t){NF.apiService.publishScore({text:(0,s.resource)("action.publishing"),fullScreen:!0,withBackground:!0,doNotRemoveReporterAutomatically:!0},t,e,{fail:function(){r.default.publish(u.SCORE_PUBLISH_FAIL)}})}).then(function(i){(new n.default).startPolling(i.pollable_job_id).onComplete(o).onError(function(){r.default.publish(u.REPORTER_REMOVE,{fullScreen:!0}),r.default.publish(u.REPORTER_ADD_ERROR,{code:"publishingError",message:(0,s.resource)("content.publishingError"),messageDescription:(0,s.resource)("content.publishingErrorDescription"),fullScreen:!0,withBackground:!0,continueCallback:function(){publishScore(e,t)}})})})})}]),t}();t.default=D},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(101));t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uuid=ko.observable(t.uuid),this.title=ko.observable(t.title),this.publicDomain=ko.observable(t.public_domain),this.catalogSongId=ko.observable(t.catalog_song_id),this.arrangeable=ko.observable(t.arrangeable),this.credits=ko.observable(t.credits),this.copyright=ko.observable(t.copyright),this.url=ko.observable(t.url),this.blackbox=ko.observable(t.blackbox),this.contributorsList=new r.default(t.contributors),this.contributor=this.firstContributor}},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=t,this.key="_nf_dismissable_".concat(t),this.handleClick=this.handleClick.bind(this),this.show=ko.observable(!NF.hasStorage||!localStorage.getItem(this.key))}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"handleClick",value:function(){NF.hasStorage&&localStorage.setItem(this.key,!0),this.show(!1)}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.favorite=t,this.userLink=ko.computed(function(){return NF.paths.profile({userId:t.user().external_id()})})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tweetOnTwitter=function(e,t){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t)+" %23noteflight","_blank","height=300, width=500, resizable=no, scrollbars=yes, menubar=no, toolbar=no")}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(4)),n=l(o(55)),i=o(5),a=o(0),s=l(o(35));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=o.url,this.hasCustomAudioMedia=ko.observable(o.hasCustomAudioMedia),this.isPlaying=ko.observable(!1),this.handlePlayClick=this.handlePlayClick.bind(this),this.handleStopClick=this.handleStopClick.bind(this);var n={loadAssetFunc:NF.asset,instrumentBase:NF.config.instrumentPrefix,manifestLocation:NF.asset("instruments/manifest.xml"),basicPerformance:NF.slowAudio,premium:!0,preview:!0};this.nfSynthesisContext=nfsyn.SynthesisContextSingleton.getInstance(n),this.resource=a.resource,r.default.subscribe(i.AUDIO_PREVIEW_STOP,function(e,o){t.stopAudio()})}return function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(e,[{key:"playAudio",value:function(){var e=this;this.nfSynthesisContext.startSound(function(){var t=r.default.publish(i.AUDIO_PREVIEW_PLAYING);r.default.subscribe(i.AUDIO_PREVIEW_PLAYING,function(o,n){e.stopAudio(),r.default.unsubscribe(t)}),r.default.subscribe(i.SCORE_PLAYING,function(){e.stopAudio()}),s.default.xhrRequest({url:e.url,dataType:"text"}).done(function(t){t?e.doPlayAudioPreview(t):r.default.publish(i.REPORTER_ADD_ERROR,{code:"scorePreviewNotFound",message:(0,a.resource)("errors.scorePreviewNotFound")})})})}},{key:"doPlayAudioPreview",value:function(e){var t=this;try{!function(){var o=JSON.parse(n.default.inflate(e,{to:"string"}));t.nfSequencer=new nfsyn.Sequencer(t.nfSynthesisContext,t.nfSynthesisContext.manifest,o,{loopStart:-1,loopEnd:-1});for(var r=[],i=function(e){r.push(new Promise(function(r,n){t.nfSynthesisContext.setSynthesizerForPart(o.parts[e],r)}))},a=0;a<o.parts.length;a++)i(a);t.nfSequencer.startPlaying=t.nfSequencer.startPlaying.bind(t.nfSequencer),Promise.all(r).then(t.nfSequencer.startPlaying),t.isPlaying(!0)}()}catch(e){r.default.publish(i.REPORTER_ADD_ERROR,{code:"scorePreviewNotPlayable",message:(0,a.resource)("errors.scorePreviewNotPlayable")})}}},{key:"handlePlayClick",value:function(e,t){t&&t.stopPropagation(),this.playAudio()}},{key:"stopAudio",value:function(e,t){t&&t.stopPropagation(),this.nfSequencer&&this.nfSequencer.stop(),this.isPlaying(!1)}},{key:"handleStopClick",value:function(){this.stopAudio()}}]),e}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeReviewSelector=t.reviewsSelector=void 0;var r=o(12),n=o(17),i=o(41),a=(0,r.createSelector)(n.editorContentModelSelector,n.editorAuthorSelector,n.currentUserIsAuthorSelector,n.currentUserIsProductOwnerSelector,n.currentUserIsPreviewingProductSelector,function(e,t,o,r,n){return{contentModel:e,author:t,currentUserIsAuthor:o,currentUserIsProductOwner:r,currentUserIsPreviewingProduct:n}});t.reviewsSelector=a;var s=(0,r.createSelector)(n.editorContentModelSelector,i.currentUserSelector,function(e,t){return{contentModel:e,currentUser:t}});t.writeReviewSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TipViewModel=a;var r=o(19),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,o){var r=this;if(r.tip=e,r.tipStorageKey=t,r.tipClosed=ko.observable(!1),r.optionalCSS=ko.observable(""),arguments.length>2&&r.optionalCSS(o),r.visible=ko.computed(function(){if(!r.tip)return!1;if(NF.hasStorage&&"true"==localStorage.getItem(r.tipStorageKey))return!1;return!r.tipClosed()}),r.close=function(){NF.hasStorage&&localStorage.setItem(r.tipStorageKey,!0),r.tipClosed(!0)},r.tipElements=ko.observableArray(),r.tip)for(var n=0;n<r.tip.length;n++)r.tipElements().push(new s(r.tip[n])),r.tipElements()[n].initialize();r.spacing=ko.computed(function(){var e={};return r.tipElements().length>0&&(e["tipSpacing"+r.tipElements().length]=r.visible()&&!NF.IsPhoneLayout()),e})}Noteflight.TipViewModel=a;var s=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resourcesKey=ko.observable(),this.args=ko.observableArray([]),this.textToShow=ko.computed(function(){return o.args().length>0?(0,n.resource)(o.resourcesKey(),o.args()):null}),this.type=ko.observable("text"),ko.mapping.fromJS(t,{},this)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"initialize",value:function(){this.args.unshift((0,n.resource)((0,r.isTouchDevice)()?"tip.tap":"tip.click"))}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SHADOW_TOP_RIGHT_ASSET=t.SHADOW_TOP_LEFT_ASSET=t.SHADOW_TOP_ASSET=t.SHADOW_RIGHT_ASSET=t.SHADOW_PREVIEW_ASSET=t.SHADOW_LEFT_ASSET=t.SHADOW_BOTTOM_RIGHT_ASSET=t.SHADOW_BOTTOM_LEFT_ASSET=t.SHADOW_BOTTOM_ASSET=t.PREVIEW_WATERMARK_STARTING_PAGE=t.PREVIEW_WATERMARK_SCALE=t.PREVIEW_WATERMARK_ASSET=void 0;var r=x(o(563)),n=x(o(4)),i=x(o(55)),a=o(6),s=o(5),l=x(o(564)),c=x(o(296)),u=x(o(297)),d=x(o(298)),p=x(o(295)),f=x(o(194)),h=x(o(591)),m=x(o(592)),g=x(o(593)),b=x(o(595)),v=x(o(599)),y=x(o(600)),_=o(0),S=o(14),w=o(27),k=o(191),E=o(3),P=o(15),C=x(o(35)),T=o(601),R=o(603),O=o(17);o(604),o(605),o(606),o(607),o(608),o(609),o(610),o(611),o(612),o(613);var M=o(8),A=x(o(43)),N=x(o(614)),I=x(o(615));function x(e){return e&&e.__esModule?e:{default:e}}function D(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F={playFromMeasure:1,playFromSelection:1,resume:1,playSelection:1,togglePause:1};t.PREVIEW_WATERMARK_ASSET="images/for_preview_only.svg";t.PREVIEW_WATERMARK_SCALE=1;t.PREVIEW_WATERMARK_STARTING_PAGE=1;t.SHADOW_BOTTOM_ASSET="images/shadowBottom.png";t.SHADOW_BOTTOM_LEFT_ASSET="images/shadowBottomLeft.png";t.SHADOW_BOTTOM_RIGHT_ASSET="images/shadowBottomRight.png";t.SHADOW_LEFT_ASSET="images/shadowLeft.png";t.SHADOW_PREVIEW_ASSET="images/shadowPreview.png";t.SHADOW_RIGHT_ASSET="images/shadowRight.png";t.SHADOW_TOP_ASSET="images/shadowTop.png";t.SHADOW_TOP_LEFT_ASSET="images/shadowTopLeft.png";t.SHADOW_TOP_RIGHT_ASSET="images/shadowTopRight.png";var L=function(){function e(t){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),a.NF.session.remoteIsmEngaged()){var r=this.isDevEnvironment()?l.default.TYPES.SOCKET_IO:l.default.TYPES.MQTT;this.pubSubSession=new l.default(r,a.NF.incrementalSaveSession,a.NF.session.sv4_iot_url())}if(this.scoreApi=null,this.scoreState=null,this.scorePermissions=new g.default({}),this.scoreDialogs=null,this.RangeSelection=null,this.MeasurePosition=null,this.ScoreUser=null,this.scoreEditor=t,this.openAnnotations=[],this.canResize=!1,this.isViewerOnly=a.ko.observable(!1),this.score=this.scoreEditor.score,this.palette=a.ko.observable(),this.pianoKeyboard=a.ko.observable(),this.loadOptions={},this.pageIndex=a.ko.observable(0),this.requiresSave=a.ko.observable(!1),this.zoomed=a.ko.observable(!1),this.fit=a.ko.observable(),this.isFitDirty=a.ko.observable(!1),this.active=a.ko.observable(!1),this.saving=a.ko.observable(!1),this.savingCopy=a.ko.observable(!1),this.annotationDialogs=a.ko.observableArray(),this.throttledChange=a.ko.observable().extend({throttle:50}),this.throttledChange.subscribe(this.handleThrottleChange.bind(this)),this.lastTouchTime=0,this.currentAnnotationZIndex=1e3,this.webMidiConnector=null,this.midiInputManager=null,this.slowDevice=a.ko.observable(a.NF.slowAudio),this.loadingFromVersionHistory=a.ko.observable(!1),this.migratingOldDraft=a.ko.observable(!1),this.mutePartForRecording=a.ko.observable(!0),this.editorLoaded=!1,this.enableCheckSilentPlayback=!1,this.remainingMultipleFilesToLoad=a.ko.observable(!1),this.mediaSyncEditorPanel=a.ko.observable(null),this.youtubeScriptsLoaded=!1,this.mediaSyncViewer=a.ko.observable(null),this.mediaSyncViewerVisible=a.ko.observable(!1),this.mediaSyncPlayer=a.ko.observable(null),this.hiddenMediaSyncPlayer=a.ko.observable(null),this.hiddenMediaSyncPlayerVisible=a.ko.observable(!1),this.midiKeyboardPluggedIn=a.ko.observable(!1),this.webMidiEnabled=a.ko.observable(!1),this.scoreContentData=null,this.forceBenchMark=!1,this.scoreDuration=a.ko.observable(0),this.showStatistics=a.ko.observable(!1),this.showStatistics.subscribe(function(e){e&&o.scoreDuration(o.controller.calculateScoreDuration())}),this.scoreDurationToShow=a.ko.computed(function(){return(0,P.numberToTime)(o.scoreDuration())}),this.forceSaveWhenReady=!1,this.initialDisplayCallback=null,this.performanceSpeed=a.ko.observable(100),this.saveAside=a.ko.observable(!1),this.imageCropper=null,this.handleChange=this.handleChange.bind(this),this.handlePrintScore=this.handlePrintScore.bind(this),this.handleMajorNotationChange=this.handleMajorNotationChange.bind(this),this.handleWaveformsLoading=this.handleWaveformsLoading.bind(this),this.handleReadyToStartPlayback=this.handleReadyToStartPlayback.bind(this),this.handleErrorLoadingInstrument=this.handleErrorLoadingInstrument.bind(this),this.handleGeneratedScoreSaved=this.handleGeneratedScoreSaved.bind(this),this.handleChange=this.handleChange.bind(this),this.editTimeSignature=this.editTimeSignature.bind(this),this.handleTooManyMeasuresToPlay=this.handleTooManyMeasuresToPlay.bind(this),this.handleTooManyTempoChangeMarkings=this.handleTooManyTempoChangeMarkings.bind(this),this.handleUndoChange=this.handleUndoChange.bind(this),this.handlePageFlow=this.handlePageFlow.bind(this),this.handleStripFlow=this.handleStripFlow.bind(this),this.handleAnnotation=this.handleAnnotation.bind(this),this.handleInstrumentLoad=this.handleInstrumentLoad.bind(this),this.onScriptsLoaded=this.onScriptsLoaded.bind(this),this.loadScore=this.loadScore.bind(this),this.loadNewScore=this.loadNewScore.bind(this),this.loadEditor=this.loadEditor.bind(this),n.default.subscribe(s.SCORE_GENERATE_IMAGE,function(e,t){o.generateScoreImage()}),n.default.subscribe(s.SCORE_IS_ABOUT_TO_PLAY,function(e,t){t?n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("content.preparingPlayback")}):n.default.publish(s.REPORTER_REMOVE)}),n.default.subscribe(s.SCORE_IS_SYNC_MEDIA_PLAYING,function(e,t){o.controller&&(o.controller.isSyncMediaPlaying=t)}),n.default.subscribe(s.AUDIO_PREVIEW_PLAYING,function(){o.scoreApi&&o.scoreApi.stop()}),a.Noteflight.currentQueryParams.generateScoreRendering){var i=JSON.parse(a.Noteflight.currentQueryParams.generateScoreRendering);this.generateScoreRendering=new y.default(i),this.generateScoreRendering.startTimeout(),this.scoreEditor.overrideScoreContentUri(this.generateScoreRendering.input.url)}else this.generateScoreRendering=null;this.resizeNotifier=a.ko.observable().extend({throttle:100}),a.ko.computed(function(){o.resizeNotifier(),o.fit(),o.canResize&&o.resizeWithPageIndex(),o.isFitDirty(!1)}).extend({throttle:120})}return function(e,t,o){t&&D(e.prototype,t),o&&D(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentPolicy=a.ko.observable(),this.contentModel=a.ko.observable(),this.contentType=a.ko.observable(),this.isLoggedIn=a.ko.observable(),this.isEditingProduct=a.ko.observable(),this.currentUserIsAuthor=a.ko.observable(),this.currentUserIsProductOwner=a.ko.observable(),this.currentUserIsPreviewingProduct=a.ko.observable(),this.isTestEnvironment=a.ko.observable(),this.isDevEnvironment=a.ko.observable(),(0,S.connect)(O.editorSelector,{setEditorReady:R.setEditorReady})(this)}},{key:"initialize",value:function(){n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("editor.loadingScore"),fullScreen:!0,useCss:!0}),this.isTestEnvironment()||a.NF.loadScripts([a.NF.asset("js/editor.js")],this.onScriptsLoaded)}},{key:"onScriptsLoaded",value:function(){var e=this;$$nf.resourceHook=function(t,o,r){var n=o||[];return n.unshift(t),_.resource.apply(e,n)},$$nf.alertHook=E.standardAlertDialog,this.RangeSelection=$$nf.classes.com.noteflight.notation.document.RangeSelection,this.MeasurePosition=$$nf.classes.com.noteflight.notation.model.MeasurePosition,this.ScoreUser=$$nf.classes.com.noteflight.notation.document.ScoreUser,this.scorePermissions.scriptsLoaded();var t=!1;this.scoreEditor.viewer()||this.scoreEditor.demo()||this.contentType()===M.PRODUCT||this.generateScoreRendering||(t=this.contentPolicy().user_role==M.DOCUMENT_ROLE_AUTHOR||this.contentPolicy().user_role==M.DOCUMENT_ROLE_COAUTHOR);var o={loadAssetFunc:a.NF.asset,instrumentPrefix:a.NF.config.instrumentPrefix,requireAudioElementHack:a.NF.iOS&&a.NF.iOSVersion<=6.1,userInfo:this.getUserInfo(),basicPerformance:a.NF.slowAudio,viewer:this.scoreEditor.viewer(),ismEnabled:t,remoteIsmEngaged:a.NF.session.remoteIsmEngaged(),buildScoreAsSoonAsPossible:this.scoreEditor.buildScoreAsSoonAsPossible&&this.scoreEditor.buildScoreAsSoonAsPossible()};o.useLocalStorageForIncrementalSaving=a.NF.hasStorage;var r=this.contentPolicy().is_product_copy||this.isEditingProduct()&&this.contentModel().metadata.authorship!=M.ORIGINAL_AUTHORSHIP;if(o.lockTitle=r,o.lockComposer=r,o.lockLyricist=r,o.lockCopyright=r,o.showArranger=this.contentPolicy().is_product_copy,o.hideScore=(0,w.crawler)(),a.NF.session.remoteIsmEngaged()&&(o.scoreEditSessionData=this.pubSubSession.sessionInfo,o.pubSubClient=this.pubSubSession.client),this.scoreEditor.viewer()){if(!this.scoreEditor.viewerParams.ignoreDisplayMode){var n=this.contentType()==M.PRODUCT?M.PAGE_VIEW_VALUE:M.STRIP_VIEW_VALUE;switch(this.scoreEditor.viewerParams.displayMode){case M.PAGE_VIEW_VALUE:o.fit=M.PAGE_VIEW_VALUE;break;case M.FLOW_VIEW_VALUE:o.fit=M.FLOW_VIEW_VALUE;break;case M.PERFORM_VIEW_VALUE:o.fit=M.PERFORM_VIEW_VALUE;break;case M.STRIP_VIEW_VALUE:o.fit=M.STRIP_VIEW_VALUE;break;default:o.fit=n}}o.scale=parseFloat(this.scoreEditor.viewerParams.scale||"1"),o.transparentPlaybackCursor=this.scoreEditor.viewerParams.hidePlaybackCursor||!1,o.playback=this.scoreEditor.viewerParams.playback,o.enableClientApi=!0,o.isViewerOnly=this.scoreEditor.viewerParams.isViewerOnly,o.hidePlaybackControls=this.scoreEditor.viewerParams.hidePlaybackControls,o.disableNotationInteraction=this.scoreEditor.viewerParams.disableNotationInteraction,o.watermark=this.scoreEditor.viewerParams.watermark,o.watermarkScale=parseFloat(this.scoreEditor.viewerParams.watermarkScale||"1"),o.preview=this.scoreEditor.viewerParams.preview,o.footer=this.scoreEditor.viewerParams.footer,o.customCssClass=this.scoreEditor.viewerParams.customCssClass,o.svgContextOptions=this.scoreEditor.svgContextOptions,this.scoreEditor.viewerParams.performanceBenchmarking&&(this.forceBenchMark=!0),this.loadOptions=this.scoreEditor.viewerParams.loadOptions}o.shadowBottom=a.NF.asset("images/shadowBottom.png"),o.shadowBottomLeft=a.NF.asset("images/shadowBottomLeft.png"),o.shadowBottomRight=a.NF.asset("images/shadowBottomRight.png"),o.shadowLeft=a.NF.asset("images/shadowLeft.png"),o.shadowPreview=a.NF.asset("images/shadowPreview.png"),o.shadowRight=a.NF.asset("images/shadowRight.png"),o.shadowTop=a.NF.asset("images/shadowTop.png"),o.shadowTopLeft=a.NF.asset("images/shadowTopLeft.png"),o.shadowTopRight=a.NF.asset("images/shadowTopRight.png"),this.contentType()===M.PRODUCT&&!this.isEditingProduct()&&this.currentUserIsPreviewingProduct()&&(o.fit="paginated",o.showEndOfPreviewText=this.contentModel().preview_type!=M.PRODUCT_PREVIEW_TYPE_FULL,this.contentModel().preview_type==M.PRODUCT_PREVIEW_TYPE_FULL&&(o.watermark=a.NF.asset("images/for_preview_only.svg"),o.watermarkScale=1,o.watermarkStartingPage=1)),this.element=$("#html5Editor"),this.element.bind("noteflight.editorReady",this.editorReady.bind(this)).bind("noteflight.clientApiEvent",this.dispatchNoteflightEvent.bind(this)).jsnoteflight(o),a.NF.session.remoteIsmEngaged()?(this.incrementalSaveManager=this.jsflightController().incrementalSaveManager,this.pubSubSession.initializeReconnectListener(this)):this.incrementalSaveManager=this.jsflightController().incrementalLocalSaveManager,this.initializeVisibilityChange(),this.editorLoaded=!0}},{key:"initializeVisibilityChange",value:function(){if(a.NF.iOS){var e=null,t=null;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document.addEventListener(t,function(){document[e]&&this.requiresSave()&&this.doSave(this.scoreEditor.saveScoreData)},!1)}}},{key:"handleThrottleChange",value:function(){var e=this;if(this.pianoKeyboard()){var t,o=this.controller.document.firstSelectedNoteSet;if(o)this.controller.document.selection.includes(o)?t=o.notes:(t=[],$.each(o.notes,function(o,r){e.controller.document.selection.includes(r)&&t.push(r)})),this.pianoKeyboard().selectNotes(o.measure,o.notes,t);else this.pianoKeyboard().selectNotes(null,[],[])}this.palette()&&this.palette().updatePalette&&this.palette().updatePalette()}},{key:"handleGeneratedScoreSaved",value:function(e){n.default.publish(s.STOCK_IMAGE_UPLOADED),n.default.publish(s.SCORE_IMAGE_GENERATED,e),this.score().coverArt().id(e.cover_art_id),this.save()}},{key:"generateScoreImage",value:function(){var e=this;this.scoreApi.setAutoScale(!0),this.scoreApi.resizeToFitScore(),this.scoreApi.forceFirstMeasuresToBeShown(),this.imageCropper=new f.default(this.saveCroppedImage.bind(this),{title:"action.changeCoverArt"}).show(),setTimeout(function(){e.domToImageGeneration()},500)}},{key:"saveCroppedImage",value:function(e){n.default.publish(s.STOCK_IMAGE_UPLOADING),a.NF.apiService.uploadCoverArtData("",this.handleGeneratedScoreSaved,{data:e})}},{key:"domToImageGeneration",value:function(){var e=this,t=this.scoreApi.getAutoScale(),o=this.controller.score.viewScale,n=!1;var i=document.getElementById("scoreContainer"),a=800;this.controller.score.displayModeHasPages&&(a=$("#scoreContainer").width()),r.default.toPng(i,{filter:function(e){if("g"==e.tagName&&e.id.indexOf("PageView")>=0){if(n)return!1;n=!0}return!0},height:a,width:a,bgcolor:"#ffffff"}).then(function(r){e.scoreApi.setAutoScale(t),e.controller.score.viewScale=o,e.scoreApi.resizeToFitScore(),e.imageCropper.setImage(r)})}},{key:"jsflightController",value:function(){return this.element?this.element.data("jsnoteflight"):null}},{key:"getUserInfo",value:function(){if(null!==a.NF.session.current_user()){var e=a.NF.session.current_user();return new this.ScoreUser(e.username(),e.external_id(),e.homepage_uri(),e.avatar_uri(),e.premium_member(),e.identified())}return new this.ScoreUser("Noteflight","0","/","/images/noteflight_avatar.png",!1,!1)}},{key:"dispatchNoteflightEvent",value:function(e,t){this.scoreEditor.apiServer&&this.scoreEditor.apiServer.dispatchMessage({kind:"noteflightEvent",event:t})}},{key:"scoreContentDeferred",value:function(){var e=this,t=$.Deferred();return this.loadScoreFromUrl(this.scoreEditor.scoreContentUri(),t.resolve,t.reject),t.then(function(t){e.scoreContentData=t}),t}},{key:"_prepareScorePermissions",value:function(){this.scorePermissions.score=this.score,this.scorePermissions.viewer=this.scoreEditor.viewer,this.scorePermissions.demo=this.scoreEditor.demo,this.scorePermissions.controller=this.controller,this.scorePermissions.viewerParams=this.scoreEditor.viewerParams,this.scorePermissions.activate(),n.default.publish(s.APPCUES_IDENTIFY,{isScoreAuthor:this.scorePermissions.ownsTheScore()})}},{key:"editorReady",value:function(){var e=this;if(this.element.jsnoteflight("togglePerformanceBenchmarking",a.Noteflight.currentQueryParams.performanceBenchmarking),this.element.jsnoteflight("togglePerfBenchSimpleOutput",a.Noteflight.currentQueryParams.perfBenchSimpleOutput),this.element.jsnoteflight("togglePerfBenchSilentMode",a.Noteflight.currentQueryParams.perfBenchSilentMode),this.element.jsnoteflight("setPerfBenchClassWhitelist",a.Noteflight.currentQueryParams.perfBenchClassWhitelist),this.element.jsnoteflight("setPerfBenchMethodWhitelist",a.Noteflight.currentQueryParams.perfBenchMethodWhitelist),this.element.jsnoteflight("setPerfBenchClassBlacklist",a.Noteflight.currentQueryParams.perfBenchClassBlacklist),this.element.jsnoteflight("setPerfBenchMethodBlacklist",a.Noteflight.currentQueryParams.perfBenchMethodBlacklist),this.element.jsnoteflight("recordControllerActions",a.Noteflight.currentQueryParams.recordControllerActions),this.element.jsnoteflight("recordScoreEdits",a.Noteflight.currentQueryParams.recordScoreEdits),this.element.jsnoteflight("simultaneousEditing",a.Noteflight.currentQueryParams.simultaneousEditing),this.element.data("jsnoteflight").initialDisplayCallback=this.initialDisplayCallback,this.forceBenchMark&&this.element.jsnoteflight("togglePerfBenchSilentMode",!0),this.isViewerOnly())this.loadScoreFromUrl(this.score().score_contents_url());else{if(this.scoreEditor.demo())return;this.scoreEditor.scoreContentUri()?$.when(this.scoreEditor.scoreDataDeferred(),this.scoreContentDeferred()).then(function(){e.parseScoreContent()},function(){e.generateScoreRendering?e.generateScoreRendering.notifyScoreRenderingError():e.loadNewScore()}):this.scoreEditor.getScoreData(this.loadNewScore)}}},{key:"resizeWithPageIndex",value:function(){this.element.jsnoteflight("resizeToFit",this.fit()),this.dispatchNoteflightEvent({},{type:"scoreViewResize",timestamp:(new Date).getTime()})}},{key:"setFitMode",value:function(e){e!=this.fit()&&(this.fit(e),this.isFitDirty(!0))}},{key:"resizeToFit",value:function(){this.resizeNotifier({})}},{key:"loadScore",value:function(e){this.doLoadScore(e)}},{key:"loadNewScore",value:function(){var e=this.contentPolicy().enable_part_display,t=$$nf.synthesis.contextOptions.instrumentBase,o=a.NF.asset("instruments/templates/basic.xml");if(this._prepareScorePermissions(),this.scoreEditor.scoreTemplateURL())this.loadScoreFromUrl(this.scoreEditor.scoreTemplateURL(),void 0,void 0,{importFormat:this.scoreEditor.scoreImportType()});else if(e||!a.Noteflight.iOS){var r=new a.Noteflight.NewScoreDialog(this,t,this.loadScoreFromUrl.bind(this),this.scoreLoaded.bind(this),e,o);n.default.publish(s.REPORTER_REMOVE,{fullScreen:!0}),(0,E.createAndShowDialog)({viewModel:r,templateName:"score/newScore",callback:"scrollToIndex"})}else this.loadScoreFromUrl(o)}},{key:"doLoadScore",value:function(e){e?this.loadScoreFromUrl(e):this.loadNewScore()}},{key:"loadScoreFromUrl",value:function(e,t,o){var r=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.jsflightController().pushTimer("html5Editor","loadXML",!1,!0),t||(t=this.saveScoreContent.bind(this));var i="text";n.importFormat&&"midi"==n.importFormat&&(i="arraybuffer"),C.default.xhrRequest({url:e,type:"GET",dataType:i}).done(function(e){r.jsflightController().popTimer("html5Editor","loadXML",!1,!0),"arraybuffer"==i&&(e=new Uint8Array(e)),t(e)}).fail(o)}},{key:"saveScoreContent",value:function(e){this.scoreContentData=e,this.parseScoreContent()}},{key:"offerLocalSaves",value:function(e,t){var o=new I.default(e,t.accept,t.reject);(0,E.createAndShowDialog)({viewModel:o,templateName:"score/localSaves"})}},{key:"hasRemoteIncrementalEdits",value:function(){if(!a.NF.incrementalSaveSession)return!1;var e=a.NF.incrementalSaveSession.score_edits;return e.length&&(e.length>1||!e[0].fullSaveEditNumber)}},{key:"getLocalDraft",value:function(e){if(a.NF.hasStorage&&this.contentPolicy().can_edit){var t=localStorage.getItem(e._localDraftKey());if(t){var o=a.ko.mapping.fromJSON(t);if(!o.user_id||o.user_id()==a.NF.session.current_user().external_id())return{score:new Score(o.score),timestamp:o.timestamp(),content:o.content()}}}return null}},{key:"saveLocalDraft",value:function(e,t){if(a.Noteflight.hasStorage&&this.contentPolicy().can_edit)try{return localStorage.setItem(t._localDraftKey(),a.ko.mapping.toJSON({version:"3.0",score:t,timestamp:t._now(),content:e,user_id:a.NF.session.current_user()&&a.NF.session.current_user().external_id()}))}catch(e){}}},{key:"deleteLocalDraft",value:function(e){a.NF.hasStorage&&this.contentPolicy().can_edit&&localStorage.removeItem(e._localDraftKey())}},{key:"parseScoreContent",value:function(){var e=this;if(this.isViewerOnly()||null!=this.generateScoreRendering)this.scoreLoaded(this.scoreContentData,this.loadOptions);else if(this.loadingFromVersionHistory())this.parseScoreContent2();else{var t=this.incrementalSaveManager,o=this.score().external_id(),r=this.score().score_latest_version,n=r?r.version_id():null,i=this.getLocalDraft(this.score());t.loadingScore(o,n),a.NF.session.remoteIsmEngaged()?this.parseScoreContent2():t.hasLocalEdits?(i&&this.deleteLocalDraft(this.score()),t.localEditsOutOfDate||this.hasRemoteIncrementalEdits()?this.contentPolicy().can_copy?p.default.offerSaveAside(t.localEditsUpdatedAt,{accept:function(){e.saveAside(!0),e.parseScoreContent2()},reject:function(){t.localSavesRejected(),e.parseScoreContent2()}}):(t.localSavesRejected(),this.parseScoreContent2()):this.offerLocalSaves(t.localEditsUpdatedAt,{accept:function(){e.parseScoreContent2()},reject:function(){t.localSavesRejected(),e.parseScoreContent2()}})):i?this.useLocalDraft(i):this.parseScoreContent2()}}},{key:"parseScoreContent2",value:function(){var e=this.incrementalSaveManager;this.loadingFromVersionHistory()?(this.loadingFromVersionHistory(!1),e.loadingFromVersionHistory=!0):(!this.hasRemoteIncrementalEdits()&&e.hasLocalDraft&&(this.scoreContentData=e.localDraft),(!a.NF.session.remoteIsmEngaged()&&e.hasLocalEdits||a.NF.session.remoteIsmEngaged()&&this.hasRemoteIncrementalEdits())&&(this.forceSaveWhenReady=!0)),this.scoreLoaded(this.scoreContentData,this.loadOptions)}},{key:"headerMayHaveChangedHeight",value:function(){a.NF.appViewModel.headerMayHaveChangedHeight(),this.scoreState.isPerformMode()&&this.resizeToFit()}},{key:"loadEditor",value:function(e){var t=this;if(this.scoreLoadedCallback&&(this.scoreLoadedCallback(e),this.scoreLoadedCallback=null),e.score){n.default.publish(s.REPORTER_REMOVE,{fullScreen:!0}),this.controller=this.element.jsnoteflight("scoreController"),this.documentController=this.element.jsnoteflight("documentController"),this.scoreDocumentView=this.element.data("jsnoteflight").scoreDocumentView,this.performanceSpeed(100*Math.pow(2,this.controller.speedAdjustment)),this.performanceSpeed.subscribe(function(e){t.controller.speedAdjustment=Math.log2(e/100)});var o=this.controller.score;if(this.score().external_id){var r=this.generateScoreRendering?this.generateScoreRendering.scoreId:this.score().external_id();o.scoreId=r}var i=o.getTracksUserIds();if(i.length>0&&a.NF.apiService.getUserInfo((0,_.resource)("action.gettingTracksInfo"),function(e){for(var r=e.users_info,n=0;n<r.length;n++)if(r[n]){var i=new A.default(r[n]),a=new t.ScoreUser;a.username=i.username(),a.userId=i.userExternalId(),a.avatarUri=i.avatar(),o.setTracksUserInformation(a)}},{external_ids:i}),this.forceManualScrolling=a.ko.observable().extend({bindProperty:{source:this.element.data("jsnoteflight").scoreDocumentView,property:"forceManualScrolling"}}),this.forceManualScrolling.subscribe(function(e){t.scoreEditor.forceManualScrolling(e)}),this.forceSaveWhenReady&&(this.forceSaveWhenReady=!1,this.controller.document.markUnsaved()),this.updateRequiresSave(),this.scorePermissions.controller=this.controller,this.scoreState=new m.default({controller:this.controller}),this.scoreApi=new h.default({score:this.score,controller:this.controller,jsflightController:this.element.data("jsnoteflight"),documentController:this.documentController,scoreDocumentView:this.scoreDocumentView,scoreState:this.scoreState,scorePermissions:this.scorePermissions}),this.scoreDialogs=new b.default({html5Editor:this,documentController:this.documentController,scorePermissions:this.scorePermissions,scoreApi:this.scoreApi}),window.nfeditor=this,this.scorePermissions.canEdit()||(this.scoreApi.setBuildWhileIdle(!0),this.scoreApi.buildScoreAsSoonAsPossible(!0)),o.hasTracks&&this.scorePermissions.canEdit()&&o.toggleAudioWaveforms(),this.element.jsnoteflight("setPremiumInstruments",this.scorePermissions.canUsePremiumInstruments()),this.controller.document.editable&&this.score().premium_instruments()&&!this.scoreEditor.viewer()&&!this.contentPolicy().enable_premium_instruments&&(0,E.standardAlertDialog)((0,_.resource)("alerts/noCrescendoBasicInstrumentsOnly")),this.controller.performer.instrumentResolver.premium=this.score().premium_instruments(),this.documentController.performer.instrumentResolver.premium=this.score().premium_instruments(),this.controller.mapMidiPatches(),this.controller.addEventListener("addSelection",this.handleChange),this.controller.addEventListener("removeSelection",this.handleChange),this.controller.addEventListener("printScore",this.handlePrintScore),this.controller.addEventListener("majorNotationChange",this.handleMajorNotationChange),this.controller.addEventListener("waveformsLoading",this.handleWaveformsLoading),this.controller.addEventListener("readyToStartPlayback",this.handleReadyToStartPlayback),this.controller.addEventListener("tipEvent",this.handleTipEvent),this.controller.score.addEventListener("errorLoadingInstrument",this.handleErrorLoadingInstrument),this.controller.document.addEventListener("validate",this.handleChange),this.controller.document.addEventListener("sequenceChange",this.handleChange),this.controller.addEventListener("timeSignatureDialog",this.editTimeSignature),this.controller.addEventListener("tooManyMeasuresToPlay",this.handleTooManyMeasuresToPlay),this.controller.addEventListener("tooManyTempoChangeMarkings",this.handleTooManyTempoChangeMarkings),this.controller.document.undoHistory.addEventListener("undoHistoryChange",this.handleUndoChange),this.documentController.addEventListener("reportPageFlow",this.handlePageFlow),this.documentController.addEventListener("reportStripFlow",this.handleStripFlow),this.documentController.addEventListener("editAnnotation",this.handleAnnotation),this.controller.performer.addEventListener("instrumentLoad",this.handleInstrumentLoad),this.score().title.extend({bindProperty:{source:this.controller.score,property:"title"}}),this.score().composer.extend({bindProperty:{source:this.controller.score,property:"composer"}}),this.fit(this.element.jsnoteflight("getFitMode")),this.canResize=!0,this.active(!0),this.setEditorReady(!0),this.scoreState.updateDisplayModeState(),a.NF.appViewModel.showHeader()&&this.palette(new a.Noteflight.PaletteHoncho(this)),a.Noteflight.IsPhoneLayout()&&(this.scoreApi.setAutoScale(!0),this.scoreApi.resizeToFitScore()),this.pianoKeyboard(new a.Noteflight.PianoKeyboard(this,"#noteInput")),this.isViewerOnly()&&"function"==typeof console.log&&console.log(a.NF.appViewModel.viewerVersion()),this.remainingMultipleFilesToLoad()?this.saveScoreCopy():this.score().score_contents_url()||!this.scoreEditor.demo||this.scoreEditor.demo()||this.score().versions()&&this.score().versions().length||this.save(),this.scoreEditor.initializePanels(),!this.scoreEditor.viewer()){this.webMidiConnector=new a.Noteflight.WebMidiConnector(this).initialize();var l=$$nf.classes.com.noteflight.notation.editor.MidiInputManager;this.midiInputManager=new l(this.documentController)}if($$nf.synthesis.context.setScore(this.controller.score),this.perfUtil=$$nf.classes.com.noteflight.utils.PerfUtil,this.saveAside())new p.default(this).save();this.migratingOldDraft()&&(this.incrementalSaveManager.createLocalDraft(),this.migratingOldDraft(!1)),this.generateScoreRendering&&(this.downloadFullRenderingInfo(),this.generateScoreRendering.resetTimeout())}}},{key:"downloadFullRenderingInfo",value:function(){var e=this;this.generateScoreRendering.downloadFullRenderingInfo(function(){e.generateScoreRendering.hasPurchasedProductInfo&&(e.scoreEditor.purchasedQuantity(e.generateScoreRendering.purchasedQuantity),e.scoreEditor.authorizedName(e.generateScoreRendering.authorizedName),e.scoreEditor.ensembleSizeMax(e.generateScoreRendering.ensembleSizeMax),e.scoreEditor.shouldRenderMarketplaceProductFooter(!0),e.scoreEditor.applyMarketplaceProductFooter()),e.startGenerateScoreRendering()})}},{key:"debugScore",value:function(){var e=!1;return this.scoreEditor.nfDebug()&&(e=!0===this.scoreEditor.nfDebug()),!0===a.NF.config.editorDebug||e}},{key:"startGenerateScoreRendering",value:function(){var e=this;switch(console.log("generateScoreRendering - startGenerateScoreRendering",this.generateScoreRendering,this.generateScoreRendering.rendering_type),this.generateScoreRendering.resetTimeout(),this.generateScoreRendering.rendering_type){case"pdf":console.log("generateScoreRendering - startGenerateScoreRendering"),this.print({renderingPdf:!0,includeFullScore:!0,onStateChange:function(t,o){if("ready"==t){var r=o.doc.output("blob");e.generateScoreRendering.resetTimeout(),e.generateScoreRendering.uploadScoreRendering(r,function(){o.close()})}},onPageIndexChange:function(t){e.generateScoreRendering.resetTimeout()}})}}},{key:"scoreLoaded",value:function(e,t,o){var r=this;this.jsflightController().scoreUserObject=this.getUserInfo(),this._prepareScorePermissions(),this.scoreLoadedCallback=o,$(window).resize(function(){r.resizeToFit(),r.palette()&&r.palette().handleWindowResize()}),t||(t={}),$.extend(t,{permissions:this.scorePermissions.documentPermissions()}),this.scorePermissions.isPreview()&&(t.preview=!0),this.score().reapLocalEdits(),t.premium=this.scorePermissions.canUsePremiumInstruments(),t.errorOnFail=this.debugScore(),this.jsflightController().addEventListener("scoreLoadingError",this.handleScoreLoadingError),this.jsflightController().loadScore(e,t,this.loadEditor)}},{key:"handleScoreLoadingError",value:function(){this.generateScoreRendering&&this.generateScoreRendering.notifyScoreRenderingError(),n.default.publish(s.REPORTER_REMOVE,{fullScreen:!0}),(0,E.hideCurrentDialog)(),n.default.publish(s.REPORTER_ADD_ERROR,{code:"scoreLoading",message:(0,_.resource)("errors.scoreLoading"),fullScreen:!0,withBackground:!1,continueText:(0,_.resource)("action.retryText"),hideCancel:!0,continueCallback:this.handleReloadScore})}},{key:"handleReloadScore",value:function(){location.reload()}},{key:"scrollKeyboardLeft",value:function(){this.pianoKeyboard()&&this.pianoKeyboard().scrollLeft()}},{key:"scrollKeyboardRight",value:function(){this.pianoKeyboard()&&this.pianoKeyboard().scrollRight()}},{key:"scoreXml",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(new XMLSerializer).serializeToString(this.element.jsnoteflight("saveScore",e).dom[0])}},{key:"save",value:function(){this.originalTitle=null,this.score().duration(Math.round(this.controller.calculateScoreDuration())),this.doSave(this.scoreEditor.saveScoreData)}},{key:"showPartsOnly",value:function(e){this.controller.showPartsOnly(e)}},{key:"showAllParts",value:function(){this.controller.showAllParts()}},{key:"prepareScoreTitleForCopy",value:function(){this.contentPolicy().is_product_copy||(this.controller.score.title=(0,_.resource)("editor/copyOf",[this.score().title()||(0,_.resource)("score.untitled")]))}},{key:"saveScoreCopy",value:function(){var e=this;this.scorePermissions.canMakeItCopyable()&&(this.score().userIsAuthor()&&!this.remainingMultipleFilesToLoad()&&(this.savingCopy(!0),this.originalTitle=this.controller.score.title,this.incrementalSaveManager.scoreEditListener.whileIgnoringModelEvents(function(){e.prepareScoreTitleForCopy()})),this.doSave(this.scoreEditor.saveScoreCopy,{savingACopy:!0}))}},{key:"print",value:function(e){if(this.generateScoreRendering&&"pdf"==this.generateScoreRendering.renderingType)this.scoreDialogs.printIndividualParts(e);else switch(this.contentType()){case M.SCORE:this.scorePermissions.canPrint()&&this.scorePermissions.checkPrintingSupported()&&this.element&&this.element.jsnoteflight("documentController")&&this.scoreDialogs.printScore(e);break;case M.PRODUCT:this.currentUserIsPreviewingProduct()||this.scoreDialogs.printScore(e)}}},{key:"buildRequestData",value:function(){return{facet:"summary",score_contents:this.scoreXml(),title:this.score().title()||(0,_.resource)("score.untitled"),composer:this.score().composer(),description:this.score().description(),tags:this.score().tags(),version:this.score().versions_count().toString(),premium_instruments:a.NF.session.current_user().has_premium_features(),metadata:this.getMetadata(),cover_art_id:this.score().coverArt().id(),audio_preview:this.getAudioPreview()}}},{key:"doSave",value:function(e){var t=this,o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).savingACopy||!1;this.saving()||(this.saving(!0),n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("content.preparingScore")}),setTimeout(function(){t.updateRequiresSave();var r=t.incrementalSaveManager,i=function(){n.default.publish(s.REPORTER_REMOVE);var o=t.buildRequestData(),i=function(){r.scoreEditListener?r.scoreEditListener.whileIgnoringModelEvents(function(){t.originalTitle&&(t.controller.score.title=t.originalTitle,t.originalTitle=null)}):t.originalTitle&&(t.controller.score.title=t.originalTitle,t.originalTitle=null)};e(o,{done:function(){if(t.savingCopy())t.savingCopy(!1);else{var e=t.score().score_latest_version.version_id();r.scoreSaved(e)}t.controller.document.markSaved(),t.deleteLocalDraft(t.score()),i();var l=o.score_contents.length;a.NF.analytics.trackEvent("behavior","score_save","",l),n.default.publish(s.SCORE_SAVED,t.score()),t.controller.validateViewCache()},fail:function(){if(t.scorePermissions.canMakeItCopyable()){if(t.errors&&t.errors().length)for(var e=0;e<t.errors().length;e++)if("midairCollision"==t.errors()[e].code){p.default.offerSaveAside(r.localEditsUpdatedAt,{accept:function(){new p.default(t).save()},reject:function(){r.localSavesRejected(),location.reload(!0)}});break}}else i()},always:function(){t.saving(!1),t.updateRequiresSave()}})};r&&r.enabled||t.isEditingProduct()?t.uploadNewAudioMediaFiles(i):(t.scorePermissions.canMakeItCopyable()?r.lastWriteAt?p.default.offerSaveAside(r.lastWriteAt,{accept:function(){new p.default(t).save()},reject:function(){location.reload(!0)}}):o?i():t.contentType()===M.PRODUCT?(0,E.standardAlertDialog)((0,_.resource)("editor.savingDisabledProductAlert")):(0,E.standardAlertDialog)((0,_.resource)("editor.savingDisabledCopyAllowed")):(0,E.standardAlertDialog)((0,_.resource)("editor.savingDisabledAlert")),t.saving(!1))},1))}},{key:"uploadNewAudioMediaFiles",value:function(e){var t=0,o=0,r=this.controller.score,i=r.unpersistedAudioMedias,l=function(n,i){var s={content_type:"audio/wav",channel_count:n.channelCount,sample_rate:n.sampleRate,duration:n.duration};(0,k.uploadMedia)(r.scoreId,s,i,new a.Noteflight.ServiceReporterViewModel((0,_.resource)("action.uploadingWavFile")),function(r){!function(r,n){r.mediaFileId=n.media_file_id,r.mediaId=n.media_id,r.contentType=n.contentType,++t==o&&e()}(n,r)})};i.length>0?(n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("action.uploadingWavFile")}),i.forEach(function(e){o++,(0,k.audioBufferToWav)(e.mediaFileData).then(k.wavToArrayBuffer).then(function(t){l(e,t)})})):e()}},{key:"startSound",value:function(e){$$nf.synthesis.context.startSound(e)}},{key:"audioContextResumed",value:function(){return $$nf.synthesis.context.audioContextResumed}},{key:"handleChange",value:function(e){this.throttledChange({})}},{key:"handlePrintScore",value:function(e){var t=e.options?e.options:{};this.scoreDialogs.printScore(t)}},{key:"getMetadata",value:function(){var e=this.score().getMetadata();return e.custom_audio_media=this.audioMediaMetadata(),e.key_signature=e.key_signature||this.scoreApi.getOpeningKeySignature(),e}},{key:"audioMediaMetadata",value:function(){var e="none";return this.controller.score.partsWithAudioMedias.length>0&&this.controller.score.synchronizedTrack?e="mixed":this.controller.score.synchronizedTrack?e="synced_media":this.controller.score.partsWithAudioMedias.length>0&&(e="recording"),e}},{key:"getAudioPreview",value:function(){var e=this.element.jsnoteflight("getStandingWaveJson",!0);return e&&"null"!=e?i.default.deflate(e,{to:"string"}):null}},{key:"notifyWarningIfTracksInScore",value:function(e){if(this.isViewerOnly())return!1;var t="alert.editingScoreWithTracks";if(!(0,E.checkIfOneTimePerScoreAlertHasBeenShown)(t,this.score().external_id())){var o=this.controller.score.partsWithAudioMedias;if(o.length>0){if(!e)return(0,E.oneTimePerScoreAlert)(t,this.score().external_id()),!0;for(var r=0;r<o.length;r++)if(-1!=e.indexOf(o[r]))return(0,E.oneTimePerScoreAlert)(t,this.score().external_id()),!0}}return!1}},{key:"notifyWarningIfMediaSyncedInScore",value:function(){if(!this.isViewerOnly()){this.controller.score.synchronizedTrack&&!(0,E.checkIfOneTimePerScoreAlertHasBeenShown)("alert.editingScoreWithSyncedMedia",this.score().external_id())&&(0,E.oneTimePerScoreAlert)("alert.editingScoreWithSyncedMedia",this.score().external_id())}}},{key:"handleTooManyMeasuresToPlay",value:function(e){(0,E.oneTimePerScoreAlert)("errors.tooManyMeasuresToPlay",this.score().external_id())}},{key:"handleTooManyTempoChangeMarkings",value:function(e){(0,E.oneTimePerScoreAlert)("errors.tooManyTempoChangeMarkings",this.score().external_id())}},{key:"handleMajorNotationChange",value:function(e){this.showStatistics()&&this.scoreDuration(this.controller.calculateScoreDuration());var t=e.options?e.options.parts:null;this.notifyWarningIfTracksInScore(t)||this.notifyWarningIfMediaSyncedInScore()}},{key:"updateRequiresSave",value:function(){this.requiresSave(this.controller.document.requiresSave&&!this.saving())}},{key:"handleUndoChange",value:function(e){this.updateRequiresSave()}},{key:"addReporterError",value:function(e){n.default.publish(s.REPORTER_CLEAR_ERRORS),n.default.publish(s.REPORTER_ADD_ERROR,{message:e,code:e})}},{key:"handleErrorLoadingInstrument",value:function(e){this.isViewerOnly()||this.addReporterError((0,_.resource)("errors.errorloadingInstrumentFrom",e.kind))}},{key:"handleInstrumentLoad",value:function(e){n.default.publish(s.REPORTER_REMOVE),e.numLoaded<e.numInstruments&&n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("editor.loadingInstrument",e.instrumentName,Math.min(e.numLoaded+1,e.numInstruments),e.numInstruments)})}},{key:"handlePageFlow",value:function(e){n.default.publish(s.REPORTER_REMOVE),e.index>=0&&n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("editor.buildingPage",e.index)})}},{key:"handleStripFlow",value:function(e){n.default.publish(s.REPORTER_REMOVE),e.index>=0&&n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("editor.buildingMeasure",e.index)})}},{key:"handleWaveformsLoading",value:function(e){n.default.publish(s.REPORTER_ADD,{text:(0,_.resource)("editor.loadingWaveforms")})}},{key:"calculateAnnotationXPosition",value:function(e){var t=e+32;return t+265>Math.max($("#scoreContainer").width(),$("#html5Editor").width())&&(t=e-265-12),t}},{key:"setAnnotationPosition",value:function(e,t){var o=this.element.data("jsnoteflight").scoreDocumentView.getAnnotationPosition(e),r=o.x+$("#scoreContainer").position().left+$("#html5Editor").scrollLeft(),n=o.y+$("#scoreContainer").position().top+$("#html5Editor").scrollTop();t.positionX(this.calculateAnnotationXPosition(r).toString()+"px"),t.positionY(Math.max(0,n-215).toString()+"px")}},{key:"repositionAnnotations",value:function(){for(var e=0;e<this.annotationDialogs().length;e++){var t=this.annotationDialogs()[e].annotationObject;this.setAnnotationPosition(t,this.annotationDialogs()[e].annotationJsModel)}}},{key:"handleAnnotation",value:function(e){var t=e.parent,o=t.username+t.created.toString(),r=new a.Noteflight.Annotation(t,this.controller);this.setAnnotationPosition(t,r),-1==$.inArray(o,this.openAnnotations)&&(this.openAnnotations.push(o),this.annotationDialogs.push(new v.default(this,r,t,this.openAnnotations)))}},{key:"makeItDraggable",value:function(e){1===e.nodeType&&$(e).draggable()}},{key:"addUndoHistoryGroup",value:function(e){this.controller.document.undoHistory.openGroup(e)}},{key:"needsToForceSilentPlayback",value:function(e){return this.enableCheckSilentPlayback&&!a.NF.appViewModel.showHeader()&&!this.audioContextResumed()&&(a.NF.iOS||a.NF.embedded&&a.NF.chrome)&&F[e]}},{key:"invokeApiMethod",value:function(e,t){var o=this;if(!this.needsToForceSilentPlayback(e))return this.element.jsnoteflight("invokeApiMethod",e,t);this.scoreDialogs.showForceSilentPlayback(function(){o.invokeApiMethod(e,t)})}},{key:"handleReadyToStartPlayback",value:function(e){var t=this,o=null,r=function(){t.controller.score.synchronizedTrack&&t.controller.score.synchronizedTrack.muted&&o&&o.mute(),t.controller.startPlaybackNow()},n=e.startMeasureIndex;this.controller.score.synchronizedTrack?(o=this.getMediaSyncPlayer()).playAndStop(this.controller.measureIndexToTime(n),r):r()}},{key:"handleTipEvent",value:function(e){(0,T.showEditorTip)(e.key)}},{key:"getFirstPartPageOrientation",value:function(){return this.controller.getFirstPartPageOrientation}},{key:"signedViewUrl",value:function(){a.Noteflight.postService("/score/signed_score_view_uri",this,function(e){alert(e.signed_url)})({id:this.scoreEditor.scoreId(),score_view_uri:window.location.href})}},{key:"getMeasureNumberByIndex",value:function(e){return this.controller.getMeasureNumberByIndex(e)}},{key:"stopAudioRecording",value:function(){this.controller.stopAudioRecording()}},{key:"canRecordingModeBeUsed",value:function(){return!!this.scorePermissions.checkRecordingPermissions()&&(!!a.NF.supportsAudioRecording||(0,E.standardAlertDialog)((0,_.resource)("errors.noAudioRecordingSupported")))}},{key:"transcribingModeCanBeUsed",value:function(){return!!this.scorePermissions.checkTranscribingPermissions()&&(this.webMidiEnabled()?this.midiKeyboardPluggedIn()?(this.controller.document.selection||(this.controller.document.selection=new this.RangeSelection(this.controller.score,new this.MeasurePosition(0,0),new this.MeasurePosition(1,0),[this.controller.score.staves[0]])),!0):((0,E.standardAlertDialog)((0,_.resource)("alert.noMidiDeviceConnected")),!1):((0,E.standardAlertDialog)((0,_.resource)("alert.howToRecordMidi")),!1))}},{key:"editTimeSignature",value:function(){var e=this.controller.timeSignatureSelection,t=this.controller.score.systemStaff.getMeasureAt(e.startIndex).timeSignature;new d.default(this,(0,_.resource)("editorDialog.editTimeSignature"),t).show()}},{key:"getMediaSyncPlayer",value:function(){return this.mediaSyncPlayer()||this.mediaSyncPlayer(new u.default(this)),this.mediaSyncPlayer()}},{key:"createHiddenMediaSyncPlayer",value:function(){this.scoreState.mediaSynced()&&(this.hiddenMediaSyncPlayer(this.getMediaSyncPlayer()),this.hiddenMediaSyncPlayerVisible(!0),this.hiddenMediaSyncPlayer().loadMedia())}},{key:"killHiddenMediaSyncPlayer",value:function(){this.scoreState.mediaSynced()&&(this.hiddenMediaSyncPlayer(this.getMediaSyncPlayer()),this.hiddenMediaSyncPlayerVisible(!1),this.hiddenMediaSyncPlayer().mediaLoaded()&&this.hiddenMediaSyncPlayer().destroy())}},{key:"showMediaSyncViewerIfNeeded",value:function(){this.scoreState.mediaSynced()&&(this.killHiddenMediaSyncPlayer(),this.mediaSyncViewer(this.getMediaSyncPlayer()),this.mediaSyncViewerVisible(!0),this.mediaSyncViewer().loadMedia())}},{key:"destroyMediaSyncViewerIfNeeded",value:function(){this.controller&&this.scoreState.mediaSynced()&&null!==this.mediaSyncViewer()&&(this.mediaSyncViewerVisible(!1),this.mediaSyncViewer().destroy(),this.createHiddenMediaSyncPlayer())}},{key:"initializeMediaSyncEditor",value:function(){this.killHiddenMediaSyncPlayer(),this.mediaSyncEditorPanel()||this.mediaSyncEditorPanel(new c.default(this))}},{key:"removeMediaSync",value:function(){this.controller.document.undoHistory.openGroup("Remove media sync"),this.getMediaSyncPlayer().removeAudioVideo()}},{key:"markNextMediaSyncMeasure",value:function(){this.mediaSyncEditorPanel()&&this.mediaSyncEditorPanel().markMeasure()}},{key:"editMediaSync",value:function(){this.scoreEditor.openCloseMediaSyncEditor(!0)}},{key:"changeParts",value:function(){$$nf.synthesis.context.manifest.loaded&&this.scoreDialogs.changeParts()}},{key:"addInstrument",value:function(){this.addPart(this.controller.score.staves.length,(0,_.resource)("content.addInstrument"))}},{key:"addPart",value:function(e,t){e<0||e>this.controller.score.staves.length||this.scoreDialogs.addPart(e,t)}},{key:"useLocalDraft",value:function(e){var t=this,o=new N.default(e,function(e){t.migratingOldDraft(!0),t.scoreLoaded(e.content),t.deleteLocalDraft(t.score()),t.forceSaveWhenReady=!0},function(){t.deleteLocalDraft(t.score()),t.parseScoreContent2()});(0,E.createAndShowDialog)({viewModel:o,templateName:"score/localDraft"})}},{key:"benchmark",value:function(e){var t=this.element.data("jsnoteflight"),o=t.scoreDocumentView._scoreView.layout,r=t.scoreDocumentView.viewContext,n=o.score,i=(new Date).getTime(),a=function(t,o,r){if(!e||e==t){i=(new Date).getTime();for(var n=0;n<o;n++)r();console.log(((new Date).getTime()-i)/o,t)}};console.log("starting benchmark"),a("nothing",1e5,function(){});var s=$$nf.classes.com.noteflight.notation.model.Score,l=$$nf.classes.Number,c=($$nf.classes.Object,$$nf.classes.String),u=($$nf.classes.int,$$nf.classes.uint),d=$$nf.classes.Boolean;a("coerceObject",1e5,function(){$$nf.coerce(n,s)}),a("coerceString",1e5,function(){$$nf.coerce("xyz",c)}),a("coerceInt",1e5,function(){$$nf.coerce(123,u)}),a("coerceNumber",1e5,function(){$$nf.coerce("123",l)}),a("coerceBoolean",1e5,function(){$$nf.coerce(!0,d)}),a("buildLayouts",5,function(){o.rebuildSystemMeasureLayouts(0)}),a("validateLayouts",5,function(){o.rebuildSystemMeasureLayouts(0);for(var e=0;e<n.numMeasures;){var t=Math.min(e+4,n.numMeasures);o.createSystemLayout(e,t,!0,!1,"paginated");e=t}}),a("justifyLayouts",5,function(){o.rebuildSystemMeasureLayouts(0);for(var e=0;e<n.numMeasures;){var t=Math.min(e+4,n.numMeasures),r=o.createSystemLayout(e,t,!0,!1,"paginated");o.justifySystemLayout(r),e=t}}),a("buildView",5,function(){o.createDisplayObject(r)})}}]),e}();t.default=L},function(e,t){var o=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var a=o.exec(e||""),s={},l=14;l--;)s[r[l]]=a[l]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},function(e,t){var o={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==o.call(e)}},function(e,t,o){(function(t){e.exports=function(e){return o&&t.Buffer.isBuffer(e)||r&&(e instanceof t.ArrayBuffer||n(e))};var o="function"==typeof t.Buffer&&"function"==typeof t.Buffer.isBuffer,r="function"==typeof t.ArrayBuffer,n=r&&"function"==typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}).call(this,o(37))},function(e,t,o){var r=o(571),n=o(292),i=o(78),a=o(210),s=o(293),l=o(294),c=o(129)("socket.io-client:manager"),u=o(291),d=o(587),p=Object.prototype.hasOwnProperty;function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var o=t.parser||a;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=f,f.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},f.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},i(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(e,t){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=r(this.uri,this.opts);var o=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=s(o,"open",function(){n.onopen(),e&&e()}),a=s(o,"error",function(t){if(c("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var o=new Error("Connection error");o.data=t,e(o)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;c("connect attempt will timeout after %d",l);var u=setTimeout(function(){c("connect attempt timed out after %d",l),i.destroy(),o.close(),o.emit("error","timeout"),n.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(i),this.subs.push(a),this},f.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(s(e,"data",l(this,"ondata"))),this.subs.push(s(e,"ping",l(this,"onping"))),this.subs.push(s(e,"pong",l(this,"onpong"))),this.subs.push(s(e,"error",l(this,"onerror"))),this.subs.push(s(e,"close",l(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",l(this,"ondecoded")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){c("error",e),this.emitAll("error",e)},f.prototype.socket=function(e,t){var o=this.nsps[e];if(!o){o=new n(this,e,t),this.nsps[e]=o;var r=this;o.on("connecting",i),o.on("connect",function(){o.id=r.generateId(e)}),this.autoConnect&&i()}function i(){~u(r.connecting,o)||r.connecting.push(o)}return o},f.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},f.prototype.packet=function(e){c("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(o){for(var r=0;r<o.length;r++)t.engine.write(o[r],e.options);t.encoding=!1,t.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){c("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var o=setTimeout(function(){e.skipReconnect||(c("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(c("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(c("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(o)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,o){(function(e){var r=o(211),n=o(574),i=o(583),a=o(584);t.polling=function(t){var o=!1,a=!1,s=!1!==t.jsonp;if(e.location){var l="https:"===location.protocol,c=location.port;c||(c=l?443:80),o=t.hostname!==location.hostname||c!==t.port,a=t.secure!==l}if(t.xdomain=o,t.xscheme=a,"open"in new r(t)&&!t.forceJSONP)return new n(t);if(!s)throw new Error("JSONP disabled");return new i(t)},t.websocket=a}).call(this,o(37))},function(e,t,o){var r=o(212),n=o(130),i=o(79),a=o(131),s=o(290),l=o(132)("engine.io-client:polling");e.exports=u;var c=null!=new(o(211))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),r.call(this,e)}a(u,r),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function o(){l("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(l("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){l("pre-pause polling complete"),--r||o()})),this.writable||(l("we are currently writing - waiting to pause"),r++,this.once("drain",function(){l("pre-pause writing complete"),--r||o()}))}else o()},u.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;l("polling got data %s",e);i.decodePayload(e,this.socket.binaryType,function(e,o,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){l("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(l("transport open - closing"),t()):(l("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var o=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,o)})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",o="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=n.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(o=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+o+this.path+e}},function(e,t,o){(function(t){var r=o(576),n=Object.prototype.toString,i="function"==typeof t.Blob||"[object BlobConstructor]"===n.call(t.Blob),a="function"==typeof t.File||"[object FileConstructor]"===n.call(t.File);e.exports=function e(o){if(!o||"object"!=typeof o)return!1;if(r(o)){for(var n=0,s=o.length;n<s;n++)if(e(o[n]))return!0;return!1}if("function"==typeof t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(o)||"function"==typeof t.ArrayBuffer&&o instanceof ArrayBuffer||i&&o instanceof Blob||a&&o instanceof File)return!0;if(o.toJSON&&"function"==typeof o.toJSON&&1===arguments.length)return e(o.toJSON(),!0);for(var l in o)if(Object.prototype.hasOwnProperty.call(o,l)&&e(o[l]))return!0;return!1}}).call(this,o(37))},function(e,t,o){"use strict";var r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,a={},s=0,l=0;function c(e){var t="";do{t=n[e%i]+t,e=Math.floor(e/i)}while(e>0);return t}function u(){var e=c(+new Date);return e!==r?(s=0,r=e):e+"."+c(s++)}for(;l<i;l++)a[n[l]]=l;u.encode=c,u.decode=function(e){var t=0;for(l=0;l<e.length;l++)t=t*i+a[e.charAt(l)];return t},e.exports=u},function(e,t){var o=[].indexOf;e.exports=function(e,t){if(o)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,o){var r=o(210),n=o(78),i=o(586),a=o(293),s=o(294),l=o(129)("socket.io-client:socket"),c=o(130),u=o(289);e.exports=f;var d={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=n.prototype.emit;function f(e,t,o){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},o&&o.query&&(this.query=o.query),this.io.autoConnect&&this.open()}n(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",s(this,"onopen")),a(e,"packet",s(this,"onpacket")),a(e,"close",s(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},f.prototype.send=function(){var e=i(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(d.hasOwnProperty(e))return p.apply(this,arguments),this;var t=i(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?r.BINARY_EVENT:r.EVENT,data:t,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?c.encode(this.query):this.query;l("sending connect packet with query %s",e),this.packet({type:r.CONNECT,query:e})}else this.packet({type:r.CONNECT})},f.prototype.onclose=function(e){l("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];l("emitting event %j",t),null!=e.id&&(l("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,o=!1;return function(){if(!o){o=!0;var n=i(arguments);l("sending ack %j",n),t.packet({type:u(n)?r.BINARY_ACK:r.ACK,id:e,data:n})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(l("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):l("bad ack %s",e.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t,o){return e.on(t,o),{destroy:function(){e.removeListener(t,o)}}}},function(e,t){var o=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=o.call(arguments,2);return function(){return t.apply(e,r.concat(o.call(arguments)))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(0),i=o(3),a=o(20);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.ism=t.incrementalSaveManager,this.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("action.saving"))}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"saveAsideHandler",value:function(e){e.score_data.view_score_uri&&(0,r.navigate)(e.score_data.view_score_uri)}},{key:"save",value:function(){var e=NF.postService("/save_score_copy/"+this.ism.scoreId,this.serviceReporter,this.saveAsideHandler,{contentType:NF.FORM_CONTENT_TYPE});this.doSave(e)}},{key:"doSave",value:function(e){var t=this;this.editor.saving(!0),this.editor.updateRequiresSave();this.editor.uploadNewAudioMediaFiles(function(){t.serviceReporter.immediate(!0),t.serviceReporter.busy(!0),t.serviceReporter.actionLabel((0,n.resource)("content.preparingScore"));var o=t.editor.scoreXml();t.serviceReporter.busy(!1);var r={facet:"summary",score_contents:o,title:t.editor.score().title()||(0,n.resource)("score.untitled"),composer:t.editor.score().composer(),description:t.editor.score().description(),tags:t.editor.score().tags(),version:t.editor.score().versions_count().toString(),premium_instruments:t.editor.score().premium_instruments()},a=function(){t.editor.originalTitle&&(t.editor.controller.score.title=t.editor.originalTitle,t.editor.originalTitle=null)};e(r,{done:function(){var e=t.editor.score().score_latest_version.version_id();t.ism.scoreSaved(e),t.editor.controller.document.markSaved(),a();var r=o.length;NF.analytics.trackEvent("behavior","save_aside","",r)},fail:function(){a(),t.ism.hasLocalEdits&&(0,i.standardAlertDialog)((0,n.resource)("editor.remoteSaveFailed"))},always:function(){t.editor.saving(!1),t.editor.updateRequiresSave(),t.editor.saveAside(!1)}})})}}],[{key:"offerSaveAside",value:function(e,t){var o=new function(){i.DialogViewModel.call(this),this.title=(0,n.resource)("editor.saveAsideTitle"),this.message=(0,n.resource)("editor.saveAside",(0,a.formatRelativeTime)(e)),this.accept=function(){(0,i.hideCurrentDialog)(),t.accept&&t.accept()},this.reject=function(){(0,i.hideCurrentDialog)(),t.reject&&t.reject()}};(0,i.createAndShowDialog)({viewModel:o,templateName:"score/saveAside"})}}]),e}();t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(8),n=o(0),i=o(3),a=o(15);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,o){return t&&l(e.prototype,t),o&&l(e,o),e}var u=function(){function e(t){s(this,e),this.editor=t,this.initializeObservables(),this.initializeComputeds(),this.initializeSubscribers(),this.adjustLayout=this.adjustLayout.bind(this)}return c(e,[{key:"initializeObservables",value:function(){this.showEmbed=ko.observable(!1),this.audioVideoUrl=ko.observable(""),this.oldAudioVideoUrl=ko.observable(),this.audioVideoPlayer=ko.observable(null),this.step=ko.observable(0),this.marks=ko.observableArray([]),this.keyboardControlsShown=ko.observable(!1),this.zoomLevel=ko.observable(1),this.startBarTime=ko.observable(0),this.songDuration=ko.observable(0),this.syncedBar=ko.observable(),this.invalidUrl=ko.observable(!1),this.showSyncEditor=ko.observable(!1),this.useDraftSynchronizedTrack=ko.observable(!1),this.layoutType=ko.observable(),this.currentSize=this.layoutType()}},{key:"initializeComputeds",value:function(){var e=this;ko.computed(function(){e.audioVideoPlayer()&&e.audioVideoPlayer().temporalMapEntries(),e.renderMarks()}).extend({throttle:1}),ko.computed(function(){var t=e.audioVideoPlayer(),o=e.useDraftSynchronizedTrack();null!=t&&t.useDraftSynchronizedTrack(o)}),this.zoomLevelText=ko.computed(function(){return e.zoomLevel().toString()+"x"}),this.endBarTime=ko.computed(function(){if(e.audioVideoPlayer()&&e.audioVideoPlayer().mediaLoaded()&&0!==e.songDuration()){var t=e.startBarTime()+e.songDuration()/e.zoomLevel();return t>e.songDuration()&&(e.startBarTime(e.songDuration()*(1-1/e.zoomLevel())),t=e.songDuration()),t}return 0}),this.endBarTimeToShow=ko.computed(function(){return(0,a.numberToTime)(e.endBarTime())}),this.showLeftOffsetButton=ko.computed(function(){return 0!==e.startBarTime()}),this.showRightOffsetButton=ko.computed(function(){return e.endBarTime()<e.songDuration()}),this.currentTime=ko.computed(function(){if(e.audioVideoPlayer())return e.audioVideoPlayer().currentTime()}),this.urlChanged=ko.computed(function(){return e.audioVideoUrl()!=e.oldAudioVideoUrl()}),this.normalLayout=ko.computed(function(){return"normal"===e.layoutType()}),this.changeSize=ko.computed(function(){return e.currentSize!==e.layoutType()&&(e.currentSize=e.layoutType(),!0)})}},{key:"initializeSubscribers",value:function(){var e=this;this.zoomLevel.subscribe(function(){e.renderMarks()}),this.startBarTime.subscribe(function(){e.renderMarks()})}},{key:"getSongDuration",value:function(){var e=this;setTimeout(function(){e.audioVideoPlayer()&&e.audioVideoPlayer().mediaLoaded()&&e.audioVideoPlayer().duration(e.songDuration),0===e.songDuration()&&e.getSongDuration()},200)}},{key:"populateAllEntries",value:function(){this.marks([]);var e=new d(null,"cursor",this);e.state("cursor"),this.marks.push(e),e.initialize();for(var t=0;t<this.audioVideoPlayer().temporalMapEntries().length;t++){var o=this.audioVideoPlayer().temporalMapEntries()[t],r=new d(o,t,this);this.marks.push(r),r.initialize()}}},{key:"renderMarks",value:function(){if(this.audioVideoPlayer()){if(0===this.marks().length)return void this.populateAllEntries();for(var e=0;e<this.audioVideoPlayer().temporalMapEntries().length;e++){var t=this.audioVideoPlayer().temporalMapEntries()[e],o=this.marks().length>e+1?this.marks()[e+1]:null;if(null!=o){if(t.markTime==o.entry.markTime)continue;return void this.populateAllEntries()}var r=new d(t,e+1,this);this.marks.push(r),r.initialize()}this.marks().length-1!=this.audioVideoPlayer().temporalMapEntries().length&&this.populateAllEntries()}}},{key:"doLoadMedia",value:function(e){var t=this,o=!0;return this.audioVideoPlayer(this.editor.getMediaSyncPlayer()),this.audioVideoPlayer().templateReady(),this.audioVideoPlayer().updateEntriesList(),this.audioVideoPlayer().loadMedia(e,{beforeEmbedCreationCallback:function(){t.showEmbed(!0),t.audioVideoPlayer().layoutType(t.layoutType())},errorCallback:function(){o=!1,t.invalidUrl(!0)}}),o}},{key:"loadMedia",value:function(){return this.oldAudioVideoUrl(this.audioVideoUrl()),this.doLoadMedia(this.audioVideoUrl())}},{key:"initializeWithSyncedMedia",value:function(){var e=this,t=this.editor.scoreState.mediaSynced();this.audioVideoUrl(t.audioUrl),this.oldAudioVideoUrl(this.audioVideoUrl()),this.doLoadMedia(null),setTimeout(function(){e.audioVideoPlayer().updateEntriesList()},50)}},{key:"doDeleteMedia",value:function(){this.editor.scoreApi.playAll(),this.audioVideoPlayer().removeAudioVideo(),this.resetVars(),this.editor.controller.document.undoHistory.openGroup("Remove Sync Track"),this.editor.controller.score.saveDraftSynchronizedTrack()}},{key:"deleteMedia",value:function(){var e=this;(0,i.okCancel)((0,n.resource)("content.confirmDeleteMediaSync"),function(){e.doDeleteMedia()})}},{key:"handleKeyPressedLoadText",value:function(e,t){return 13==t.keyCode&&0===this.step()&&this.loadMediaAndNextStep(),!0}},{key:"playMedia",value:function(){this.audioVideoPlayer().playToSyncMedia()}},{key:"pauseMedia",value:function(){this.audioVideoPlayer().pause()}},{key:"jumpToBeginning",value:function(){this.audioVideoPlayer().jumpToBeginning()}},{key:"seekTo",value:function(e){this.audioVideoPlayer().seekTo(e)}},{key:"zoomIn",value:function(){this.zoomLevel(2*this.zoomLevel()),this.zoomLevel()>8&&(this.zoomLevel(1),this.startBarTime(0))}},{key:"moreOffset",value:function(){if(!(this.endBarTime()>=this.songDuration())){var e=Math.min(this.songDuration(),this.startBarTime()+(this.endBarTime()-this.startBarTime())/10);this.startBarTime(e)}}},{key:"lessOffset",value:function(){var e=Math.max(0,this.startBarTime()-(this.endBarTime()-this.startBarTime())/10);this.startBarTime(e)}},{key:"markMeasure",value:function(){this.clearMarksStartingAtCurrentTime(),this.audioVideoPlayer().markNextMeasure()}},{key:"clearMarksStartingAtCurrentTime",value:function(){this.audioVideoPlayer().clearMeasuresStartingAtCurrentTime()}},{key:"nextStep",value:function(){this.step(this.step()+1)}},{key:"nextStepIfSameUrl",value:function(){this.urlChanged()||this.nextStep()}},{key:"loadMediaAndNextStep",value:function(){if(this.audioVideoUrl()){if(this.invalidUrl(!1),this.showEmbed()){var e=this.audioVideoUrl();this.doDeleteMedia(),this.audioVideoUrl(e)}this.loadMedia()&&this.nextStep(),this.getSongDuration(),this.editor.scoreApi.soloMediaTrack()}}},{key:"previousStep",value:function(){this.step(Math.max(0,this.step()-1))}},{key:"getBarWidth",value:function(){return $("#syncProgressBar").width()}},{key:"initializeSyncedBar",value:function(){this.syncedBar(new p(this))}},{key:"updateMeasureMark",value:function(e,t,o){this.audioVideoPlayer().updateMeasureMark(e,t,o)}},{key:"destroy",value:function(){this.audioVideoPlayer()&&this.audioVideoPlayer().destroy(),this.showSyncEditor(!1),this.editor.scoreState.isSyncMediaPlaying(!1),this.marks([])}},{key:"close",value:function(){var e=this;this.editor.controller.score.isDraftSynchronizedTrackChanged()?(0,i.okCancel)((0,n.resource)("content.confirmDiscardMediaSync"),function(){e.doClose()}):this.doClose()}},{key:"doClose",value:function(){this.editor.controller.score.discardDraftSynchronizedTrack(),this.useDraftSynchronizedTrack(!1),this.editor.scoreEditor.openCloseMediaSyncEditor(!1)}},{key:"done",value:function(){var e=this.editor.controller.score;e.isDraftSynchronizedTrackChanged()&&(this.editor.controller.document.undoHistory.openGroup("Edit Sync Track"),e.saveDraftSynchronizedTrack()),this.close()}},{key:"fadeIn",value:function(){var e=this;setTimeout(function(){e.showSyncEditor(!0)},100)}},{key:"resetVars",value:function(){this.step(0),this.audioVideoUrl(""),this.showEmbed(!1),this.songDuration(0)}},{key:"_calculateLayout",value:function(){$(window).width()>=r.DESKTOP_SIZE?this.layoutType("normal"):this.layoutType("compressed")}},{key:"adjustLayout",value:function(){this.close()}},{key:"initialize",value:function(){this.editor.controller.score.createDraftSynchronizedTrack(),this.useDraftSynchronizedTrack(!0),this.marks([]),this._calculateLayout(),this.editor.scoreState.mediaSynced()?(this.step(1),this.initializeWithSyncedMedia()):this.resetVars(),this.getSongDuration(),this.initializeSyncedBar(),this.fadeIn(),$(window).on("resize",this.adjustLayout)}}]),e}();t.default=u;var d=function(){function e(t,o,r){var i=this;s(this,e),this.entry=t,this.id=ko.observable("mark-"+o),this.syncEditor=r,this.state=ko.observable("unselected"),this.draggingTime=ko.observable(0),this.measureIndex=ko.computed(function(){return"cursor"!=i.state()&&i.entry?i.entry.measureIndex:null}),this.measureIndexToShow=ko.computed(function(){return null===i.measureIndex()?"...":i.syncEditor.editor.getMeasureNumberByIndex(i.measureIndex())}),this.time=ko.computed(function(){return 0!==i.draggingTime()?i.draggingTime():"cursor"==i.state()?i.syncEditor.currentTime():i.entry?i.entry.markTime:0}),this.timeToShow=ko.computed(function(){return"cursor"==i.state()?(0,a.numberToTime)(i.time()):""}),this.showInfo=ko.observable(!1),this.infoToShow=ko.computed(function(){return(0,n.resource)("content.markTime",(0,a.numberToTime)(i.time()))}),this.visible=ko.computed(function(){return i.time()>=i.syncEditor.startBarTime()&&i.time()<=i.syncEditor.endBarTime()}),this.position=ko.computed(function(){var e=i.time()-i.syncEditor.startBarTime(),t=i.syncEditor.endBarTime()-i.syncEditor.startBarTime();return e*i.syncEditor.getBarWidth()/t}),this.offset=ko.computed(function(){return i.position().toString()+"px"}),this.selected=ko.computed(function(){return i.showInfo()&&"cursor"!=i.state()})}return c(e,[{key:"toggleShowInfo",value:function(){this.showInfo(!this.showInfo())}},{key:"positionToSeconds",value:function(e){var t=this.syncEditor.startBarTime();return t+(this.syncEditor.endBarTime()-t)*e/this.syncEditor.getBarWidth()}},{key:"handleDragged",value:function(e,t){"cursor"==this.state()?this.syncEditor.seekTo(this.positionToSeconds(t.position.left)):this.syncEditor.updateMeasureMark(this.measureIndex(),this.entry.markTime,this.positionToSeconds(t.position.left))}},{key:"makeMarkDraggable",value:function(){var e=this;$("#"+this.id()).draggable({axis:"x",containment:"#syncProgressBar",stop:function(t,o){e.handleDragged(t,o),setTimeout(function(){e.draggingTime(0)},200)},drag:function(t,o){e.draggingTime(e.positionToSeconds(o.position.left))}})}},{key:"initialize",value:function(){var e=this;setTimeout(function(){e.makeMarkDraggable()},50)}}]),e}(),p=function e(t){var o=this;s(this,e),this.syncEditor=t,this.firstMark=ko.computed(function(){if(!(o.syncEditor.marks().length<=1))return o.syncEditor.marks()[1]}),this.cursor=ko.computed(function(){if(0!==o.syncEditor.marks().length)return o.syncEditor.marks()[0]}),this.leftPosition=ko.computed(function(){var e=o.firstMark();return e?Math.max(0,e.position()):0}),this.offset=ko.computed(function(){return o.leftPosition().toString()+"px"}),this.rightPosition=ko.computed(function(){var e=o.cursor();return e?Math.min(o.syncEditor.getBarWidth(),e.position()):0}),this.width=ko.computed(function(){return o.firstMark()?o.rightPosition()-o.leftPosition():0}),this.visible=ko.computed(function(){return o.width()>0})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(192),n=function(e){return e&&e.__esModule?e:{default:e}}(o(589));function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,o){return t&&a(e.prototype,t),o&&a(e,o),e}window.SC=n.default;var l="#jquery_jplayer_1",c=function(){function e(t){i(this,e),this.editor=t,this.AudioTrackMediator=$$nf.classes.com.noteflight.notation.view.popup.AudioTrackMediator,this.TemporalMapEntry=$$nf.classes.com.noteflight.notation.performance.TemporalMapEntry,this.Score=$$nf.classes.com.noteflight.notation.model.Score,this.FormParser=$$nf.classes.com.noteflight.notation.performance.FormParser,this.mediator=new this.AudioTrackMediator(this.editor.documentController),this.intervalId=-1,this.positionIntervalId=-1,this.isPlaying=!1,this.isCursorHidden=!0,this.previousCurrentTime=0,this.mediaPlayer=null,this.isTemplateReady=!1,this.editingMedia=!1,this.createEventHandlers(),this.initializeObservables(),this.initializeSubscribers()}return s(e,[{key:"createEventHandlers",value:function(){this.handleStartPlaying=this.handleStartPlaying.bind(this),this.handleStopPlaying=this.handleStopPlaying.bind(this),this.handlePausePlaying=this.handlePausePlaying.bind(this),this.handleResumePlaying=this.handleResumePlaying.bind(this),this.handleBeginningPlaying=this.handleBeginningPlaying.bind(this)}},{key:"initializeObservables",value:function(){var e=this;this.audioVideoType=ko.observable(""),this.mediaType=ko.observable(""),this.audioVideoUrl=ko.observable(),this.mediaLoaded=ko.observable(!1),this.soundcloudLoaded=ko.observable(!1);var t=this.editor.controller.score.synchronizedTrack,o=t&&t.audioUrl.includes("soundcloud.com")?t.audioUrl:"https://soundcloud.com/noteflight_nf/empty";this.soundcloudPlayerSrc=ko.observable("".concat(document.location.protocol,"//w.soundcloud.com/player/?url=").concat(o,"?show_user=false&show_artwork=false")),this.canEdit=this.editor.scorePermissions.canEdit,this.measureClicking=ko.observable(this.mediator.enableNotationInPlayback),this.measuresList=ko.observableArray(),this.seconds=ko.observable(""),this.showSyncDialog=ko.observable(!0),this.currentTime=ko.observable(0),this.temporalMapEntries=ko.observableArray([]),this.useDraftSynchronizedTrack=ko.observable(!1),ko.computed(function(){var t=e.useDraftSynchronizedTrack();e.mediator.useDraftSynchronizedTrack=t}),this.layoutType=ko.observable("normal"),this.normalLayout=ko.computed(function(){return"normal"===e.layoutType()})}},{key:"initializeSubscribers",value:function(){var e=this;this.mediaLoaded.subscribe(function(t){t&&e.startGettingCurrentTime()})}},{key:"templateReady",value:function(){this.isTemplateReady=!0}},{key:"updateEntriesList",value:function(){this.temporalMapEntries([]);var e=this.synchronizedTrack;if(null!=e)for(var t=this.editor.controller.score.numMeasures,o=0;o<e.temporalMap.length;o++)null!=e.temporalMap.startTimes[o]&&(e.temporalMap._entries[o].measureIndex>=t?e.temporalMap.removeEntryAt(o):this.temporalMapEntries.push({markTime:e.temporalMap.startTimes[o]+this.mediator.temporalMap.offset,measureIndex:e.temporalMap.getEntryAt(o).measureIndex}))}},{key:"setPosition",value:function(){if(this.editingMedia){var e=this.currentTime();if(0===e)this.isCursorHidden||(this.editor.documentController.hidePositionCursor(),this.isCursorHidden=!0);else{this.previousCurrentTime!=e&&(this.editor.scoreState.isSyncMediaPlaying()||(this.editor.scoreState.isSyncMediaPlaying(!0),this.editor.scoreState.isPaused(!1))),this.previousCurrentTime=e;var t=e-this.mediator.temporalMap.offset;this.editor.controller.performer.playbackTimePosition=t,this.mediator.seekPosition=t,this.isCursorHidden=!1}}else this.stopUpdatingPosition()}},{key:"startUpdatingPosition",value:function(){var e=this;this.intervalId=setInterval(function(){e.setPosition()},50)}},{key:"stopUpdatingPosition",value:function(){clearInterval(this.intervalId)}},{key:"playToSyncMedia",value:function(){this.editingMedia=!0,this.editor.controller.useSyncedTemporalMap(),this.startUpdatingPosition(),this.play()}},{key:"play",value:function(){this.mediaPlayer.play()}},{key:"pause",value:function(){this.mediaPlayer.pause()}},{key:"stop",value:function(){this.mediaPlayer.stop()}},{key:"mute",value:function(){this.mediaPlayer.mute()}},{key:"unMute",value:function(){this.mediaPlayer.unMute()}},{key:"jumpToBeginning",value:function(){this.mediaPlayer.seekTo(0)}},{key:"seekTo",value:function(e){this.mediaPlayer.seekTo(e)}},{key:"duration",value:function(e){this.mediaPlayer.duration(e)}},{key:"destroy",value:function(){this.stopGettingCurrentTime(),this.mediaLoaded(!1),this.mediaPlayer.destroy(),this.removeListeners(),this.stopUpdatingPosition(),this.stopGettingCurrentTime(),this.editor.scoreState.isSyncMediaPlaying(!1)}},{key:"setListeners",value:function(){this.editor.controller.performer.addEventListener("synchronizedMediaPlay",this.handleStartPlaying),this.editor.controller.performer.addEventListener("synchronizedMediaStop",this.handleStopPlaying),this.editor.controller.performer.addEventListener("synchronizedMediaPause",this.handlePausePlaying),this.editor.controller.performer.addEventListener("synchronizedMediaResume",this.handleResumePlaying),this.editor.controller.performer.addEventListener("synchronizedMediaStartFromBeginning",this.handleBeginningPlaying)}},{key:"removeListeners",value:function(){this.editor.controller.performer.removeEventListener("synchronizedMediaPlay",this.handleStartPlaying),this.editor.controller.performer.removeEventListener("synchronizedMediaStop",this.handleStopPlaying),this.editor.controller.performer.removeEventListener("synchronizedMediaPause",this.handlePausePlaying),this.editor.controller.performer.removeEventListener("synchronizedMediaResume",this.handleResumePlaying),this.editor.controller.performer.removeEventListener("synchronizedMediaStartFromBeginning",this.handleBeginningPlaying)}},{key:"startGettingCurrentTime",value:function(){var e=this;this.positionIntervalId=setInterval(function(){e.getCurrentTime()},100)}},{key:"parseUrlAndCreatePlayer",value:function(e){return this.mediaType("audio"),-1!=e.indexOf("//soundcloud.com")?new d(this):-1!=e.indexOf(".mp3")||-1!=e.indexOf(".m4a")?new u(this):(this.mediaType("video"),-1!=e.indexOf(".m4v")||-1!=e.indexOf(".ogv")||-1!=e.indexOf(".mp4")?new u(this):(-1!=e.indexOf("youtu.be")&&(e="https://www.youtube.com/v/"+(0,r.getYoutubeVideoId)(e),this.audioVideoUrl(e)),-1!=e.indexOf("youtube.com")?new p(this):(this.mediaType(""),null)))}},{key:"initializeMarksArray",value:function(){this.measuresList([]);var e=this.synchronizedTrack;if(null!==e)for(var t=0;t<e.temporalMap.length;t++)null!==e.temporalMap.startTimes[t]&&this.measuresList.push({markTime:e.temporalMap.startTimes[t],measureIndex:e.temporalMap.getEntryAt(t).measureIndex})}},{key:"setUpMediator",value:function(){this.mediator.loadTrack(this.audioVideoUrl(),!0),this.mediator.loaded=!0}},{key:"loadMedia",value:function(e,t){var o=this;if(this.isTemplateReady){if(t=void 0===t?{}:t,this.mediaLoaded(!1),e?this.audioVideoUrl(e):this.audioVideoUrl(this.synchronizedTrack.audioUrl),this.mediaPlayer=this.parseUrlAndCreatePlayer(this.audioVideoUrl()),this.mediaPlayer)return this.mediaPlayer.url=this.audioVideoUrl(),this.audioVideoType(this.mediaPlayer.type()),t.beforeEmbedCreationCallback&&t.beforeEmbedCreationCallback(),e&&this.setUpMediator(),this.setListeners(),this.initializeMarksArray(),new Promise(function(e,t){setTimeout(function(){e(o.mediaPlayer.doLoadMedia())},1e3)});t.errorCallback&&t.errorCallback()}else setTimeout(function(){o.loadMedia(e,t)},200)}},{key:"stopGettingCurrentTime",value:function(){clearInterval(this.positionIntervalId)}},{key:"getTimeToSeekTo",value:function(e){if(!(e<0))return void 0===e&&(e=this.seconds()),e=parseFloat(e.toString().replace(",","."),!0)}},{key:"playAndStop",value:function(e,t){var o=this;this.mute(),this.seekTo(e),this.play(),this.seekTo(e),setTimeout(function(){o.pause(),o.seekTo(e),o.unMute(),setTimeout(function(){t()},200)},200)}},{key:"handleStartPlaying",value:function(e){var t=this;this.editingMedia=!1,this.seekTo(e.pos.toString()),setTimeout(function(){t.play()},1e3*nfsyn.WARM_UP_DELAY)}},{key:"handlePausePlaying",value:function(){this.editor.controller.allowPlaySynchronizedMedia()&&this.pause()}},{key:"handleStopPlaying",value:function(){this.editor.controller.allowPlaySynchronizedMedia()&&this.stop()}},{key:"handleResumePlaying",value:function(){this.editor.controller.allowPlaySynchronizedMedia()&&this.play()}},{key:"handleBeginningPlaying",value:function(){this.mediaPlayer.seekTo(0)}},{key:"clearMeasuresStartingAtCurrentTime",value:function(){this.clearMeasures(this.currentTime()-this.mediator.temporalMap.offset)}},{key:"clearMeasures",value:function(e){if(this.editor.documentController.scoreDocument.editable&&null!==this.synchronizedTrack){for(;this.mediator.temporalMap.length>0&&this.mediator.temporalMap.getEntryAt(this.mediator.temporalMap.length-1).onset>e;)this.mediator.temporalMap.removeEntryAt(this.mediator.temporalMap.length-1);this.mediator.updateTemporalMap(),this.updateEntriesList(),this.editor.documentController.controller.clearSelection()}}},{key:"setStartPoint",value:function(){this.removeTemporalMapEntries(),this.markMeasure(0,-1)}},{key:"removeTemporalMapEntries",value:function(){if(this.editor.documentController.scoreDocument.editable){for(;this.mediator.temporalMap.length>0;)this.mediator.temporalMap.removeEntryAt(this.mediator.temporalMap.length-1);this.mediator.updateTemporalMap()}}},{key:"updateMeasureMark",value:function(e,t,o){this.markMeasure(e,t,o)}},{key:"markNextMeasure",value:function(){var e=new this.FormParser(this.editor.controller.score).getMeasureIndices()[this.mediator.temporalMap.length];void 0!==e&&this.markMeasure(e,-1)}},{key:"selectMeasureInScore",value:function(e){var t=this.editor.controller.score;e<t.numMeasures&&this.editor.documentController.controller.selectMeasure(t.systemStaff.getMeasureAt(e))}},{key:"markMeasure",value:function(e,t,o){if(!this.editor.documentController.scoreDocument.editable)return-1;var r=!0,n=this.editor.controller.score,i=this.mediator.temporalMap.length,a=void 0!==o?o:this.currentTime();0!==i&&(a-=this.mediator.temporalMap.offset);var s=null,l=null;if(-1!=t){t-=this.mediator.temporalMap.offset,r=!1;for(var c=!1,u=0;u<this.mediator.temporalMap.length;u++)if(this.mediator.temporalMap.getEntryAt(u).onset==t){c=!0;break}if(!c)return-1;var d=this.mediator.temporalMap.getEntryAt(u);if(u>=1){if(s=this.mediator.temporalMap.getEntryAt(u-1),null===(l=n.systemStaff.getMeasureAt(s.measureIndex)))return-1;if(!(a>s.onset))return-100;d.onset=a,s.timescale=(d.onset-s.onset)/l.duration,this.mediator.temporalMap.updateEntryAt(u-1,s)}if(u<i-1){var p=this.mediator.temporalMap.getEntryAt(u+1),f=this.editor.controller.score.systemStaff.getMeasureAt(d.measureIndex);if(null===f)return-1;if(p.onset>=a)d.onset=a,d.timescale=(p.onset-d.onset)/f.duration,this.mediator.temporalMap.updateEntryAt(u,d);else{var h=u-1>=0?this.mediator.temporalMap.getEntryAt(u-1).onset:-1;this.clearMeasures(h),r=!0}}else 0===u&&(d.onset=a,this.mediator.temporalMap.updateEntryAt(u,d));this.mediator.updateTemporalMap()}if(i=this.mediator.temporalMap.length,r){var m=a;0===i&&(m=void 0!==o?o:this.currentTime());var g=new this.TemporalMapEntry(e,m,0,0,0);if(i>0){if(s=this.mediator.temporalMap.getEntryAt(i-1),null===(l=n.systemStaff.getMeasureAt(s.measureIndex)))return-1;if(g.onset<=s.onset)return-100;s.timescale=(g.onset-s.onset)/l.duration,g.timescale=s.timescale}this.mediator.temporalMap.appendEntry(g)}return this.mediator.temporalMap.adjustTo0(),this.selectMeasureInScore(e),this.updateEntriesList(),a}},{key:"returnPressed",value:function(e,t){return 13==t.keyCode&&e(),!0}},{key:"prepareDataToDestroyAudioVideo",value:function(){this.mediator.unloadTrack(),this.downloadingMedia=!1}},{key:"removeAudioVideo",value:function(){this.stopUpdatingPosition(),this.stopGettingCurrentTime(),this.audioVideoUrl(""),this.clearMeasures(0),this.prepareDataToDestroyAudioVideo(),this.mediaPlayer&&this.mediaPlayer.destroy(),this.mediaType(""),this.editor.scoreState.isSyncMediaPlaying(!1),this.editor.documentController.scrolling=!1}},{key:"handleGetCurrentTime",value:function(e){null===this.mediaPlayer&&e(0),this.mediaPlayer.getCurrentTime(e)}},{key:"getCurrentTime",value:function(){this.handleGetCurrentTime(this.currentTime)}},{key:"synchronizedTrack",get:function(){return this.useDraftSynchronizedTrack()?this.editor.controller.score.draftSynchronizedTrack:this.editor.controller.score.synchronizedTrack}}]),e}();t.default=c;var u=function(){function e(t){i(this,e),this.audioVideoPlayer=t,this.url=null,this.audioPlayer=$(l),this.audioPlayerData=null,this.jPlayerInterval=-1,this.type=ko.observable("jplayer"),this.jPlayerExtension=ko.observable("")}return s(e,[{key:"jPlayerAction",value:function(e,t){void 0===t?$(l).jPlayer(e):$(l).jPlayer(e,t)}},{key:"destroy",value:function(){this.jPlayerAction("destroy")}},{key:"duration",value:function(e){e($(l).data().jPlayer.status.duration)}},{key:"doLoadMedia",value:function(){var e=this,t=this.url;this.audioPlayer=$(l),this.setJPlayerExtension(t),this.myControl={progress:$(".jp-progress-slider"),volume:$(".jp-volume-slider")};var o={ready:function(o){var r={};r[e.jPlayerExtension()]=t,"mp4"==e.jPlayerExtension()&&(r.m4v=t),e.audioPlayer.jPlayer("setMedia",r),e.jPlayerInterval=setInterval(function(){void 0===$(l).data().jPlayer?clearInterval(e.jPlayerInterval):0!==$(l).data().jPlayer.status.duration&&(e.play(),e.stop(),clearInterval(e.jPlayerInterval),e.audioVideoPlayer.mediaLoaded(!0))},100)},timeupdate:function(t){e.myControl.progress.slider("value",t.jPlayer.status.currentPercentAbsolute)},swfPath:"/assets/lib",supplied:this.jPlayerExtension(),cssSelectorAncestor:"#jp_container_1",wmode:"window",keyEnabled:!0};"mp3"!=this.jPlayerExtension()&&"m4a"!=this.jPlayerExtension()&&("mp4"==this.jPlayerExtension()&&(o.supplied="m4v"),this.audioVideoPlayer.normalLayout()?o.size={width:"290px",height:"165px",cssClass:"jpVideo360p"}:o.size={width:"123px",height:"73px",ccsClass:"jpVideo360p"}),this.audioPlayer.jPlayer(o),this.audioPlayerData=this.audioPlayer.data("jPlayer"),this.myControl.progress.slider({animate:"fast",max:100,range:"min",step:.1,value:0,slide:function(t,o){var r=e.audioPlayerData.status.seekPercent;r>0?e.audioPlayer.jPlayer("playHead",o.value*(100/r)):setTimeout(function(){e.myControl.progress.slider("value",0)},0)}})}},{key:"play",value:function(){this.audioVideoPlayer.isPlaying||(this.audioVideoPlayer.isPlaying=!0,this.jPlayerAction("play"))}},{key:"pause",value:function(){this.audioVideoPlayer.isPlaying&&(this.audioVideoPlayer.isPlaying=!1,this.jPlayerAction("pause"))}},{key:"stop",value:function(){this.audioVideoPlayer.isPlaying&&(this.audioVideoPlayer.isPlaying=!1,this.jPlayerAction("stop"))}},{key:"mute",value:function(){this.jPlayerAction("mute",!0)}},{key:"unMute",value:function(){this.jPlayerAction("mute",!1)}},{key:"seekTo",value:function(e){e=this.audioVideoPlayer.getTimeToSeekTo(e),this.jPlayerAction("pause",e)}},{key:"getCurrentTime",value:function(e){var t=0;$(l).data("jPlayer")&&$(l).data("jPlayer").status&&(t=$(l).data("jPlayer").status.currentTime),e(t)}},{key:"setJPlayerExtension",value:function(e){this.jPlayerExtension(e.substring(e.lastIndexOf(".")+1))}}]),e}(),d=function(){function e(t){i(this,e),this.audioVideoPlayer=t,this.url=null,this.soundCloudWidget=null,this.type=ko.observable("soundcloud"),this.doneLoading=this.doneLoading.bind(this)}return s(e,[{key:"destroy",value:function(){}},{key:"doLoadMedia",value:function(){o(590),this.soundCloudWidget=n.default.Widget(document.getElementById("sc-widget")),n.default.initialize({client_id:"id"});var e=this.url.replace("/download.mp3","");this.soundCloudWidget.load(e,{callback:this.doneLoading})}},{key:"doneLoading",value:function(){var e=this;this.audioVideoPlayer.soundcloudLoaded(!0),this.audioVideoPlayer.mediaLoaded(!0),$("#sc-widget").attr("tabindex","-1"),this.audioVideoPlayer.isPlaying||(this.play(),setTimeout(function(){e.stop()},300))}},{key:"play",value:function(){this.audioVideoPlayer.isPlaying=!0,this.soundCloudWidget.play()}},{key:"pause",value:function(){this.audioVideoPlayer.isPlaying=!1,this.soundCloudWidget.pause()}},{key:"stop",value:function(){this.audioVideoPlayer.isPlaying=!1,this.soundCloudWidget.pause()}},{key:"mute",value:function(){this.soundCloudWidget.setVolume(0)}},{key:"unMute",value:function(){this.soundCloudWidget.setVolume(100)}},{key:"seekTo",value:function(e){e=this.audioVideoPlayer.getTimeToSeekTo(e),this.soundCloudWidget.seekTo(1e3*e)}},{key:"duration",value:function(e){this.soundCloudWidget.getDuration(function(t){e(t/1e3)})}},{key:"getCurrentTime",value:function(e){this.soundCloudWidget?this.soundCloudWidget.getPosition(function(t){e(t/1e3)}):e(0)}}]),e}(),p=function(){function e(t){i(this,e),this.audioVideoPlayer=t,this.url=null,this.playAfterLoading=!1,this.player=null,this.type=ko.observable("youtube"),this.playerLoaded=ko.observable(!1)}return s(e,[{key:"duration",value:function(e){var t=0;this.playerLoaded()&&(t=this.player.getDuration()),e(t)}},{key:"getYoutubeId",value:function(e){return(0,r.getYoutubeVideoId)(e)}},{key:"onPlayerReady",value:function(e){var t=this;e.target.playVideo(),e.target.pauseVideo(),setTimeout(function(){e.target.playVideo(),e.target.pauseVideo(),t.playerLoaded(!0)},1e3)}},{key:"create",value:function(){var e,t,o=this;this.audioVideoPlayer.normalLayout()?(e="162",t="270"):(e="73",t="123"),this.player=new YT.Player("player",{height:e,width:t,videoId:this.getYoutubeId(this.url),events:{onReady:function(e){$("#player").attr("tabindex","-1"),o.onPlayerReady(e)}},playerVars:{controls:0,autoplay:0,playsinline:1}}),this.audioVideoPlayer.mediaLoaded(!0)}},{key:"destroy",value:function(){this.player&&(this.player.destroy(),this.player=null,this.playerLoaded(!1))}},{key:"doLoadMedia",value:function(){var e=this;this.audioVideoPlayer.editor.youtubeScriptsLoaded?this.create():(NF.loadScript("//www.youtube.com/iframe_api"),window.onYouTubeIframeAPIReady=function(){e.create()},this.audioVideoPlayer.editor.youtubeScriptsLoaded=!0)}},{key:"play",value:function(){this.audioVideoPlayer.isPlaying=!0,this.player&&this.player.playVideo()}},{key:"pause",value:function(){this.audioVideoPlayer.isPlaying=!1,this.player&&this.player.pauseVideo()}},{key:"stop",value:function(){this.pause(),this.seekTo("0")}},{key:"mute",value:function(){this.player&&this.player.mute()}},{key:"unMute",value:function(){this.player&&this.player.unMute()}},{key:"seekTo",value:function(e){e=this.audioVideoPlayer.getTimeToSeekTo(e),this.player&&this.player.seekTo(e)}},{key:"getCurrentTime",value:function(e){if(null===this.player)e(0);else try{e(this.player.getCurrentTime())}catch(t){e(0)}}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(4)),n=o(5),i=l(o(13)),a=o(0),s=o(3);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,o,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=d(this,p(t).call(this))).editor=e,n.title=o,n.TimeSignature=$$nf.classes.com.noteflight.notation.model.TimeSignature,n.beats=ko.observable(r.beats),n.beatType=ko.observable(r.beatType),n.timeSymbol=ko.observable(r.timeSymbol||"custom"),n.mode=ko.observable("normal"),n.visibility=ko.observable(r.visibility),n.beatTypes=[2,4,8,16,32,64,128],n.applyingChange=ko.observable(!1),n.timeSymbol.subscribe(function(e){switch(e){case n.TimeSignature.COMMON_TIME_SYMBOL:n.beats(4),n.beatType(4);break;case n.TimeSignature.CUT_TIME_SYMBOL:n.beats(2),n.beatType(2)}}),n.beatsGlyphArray=ko.computed(function(){return n.makeGlyphArray(n.beats())}),n.beatTypeGlyphArray=ko.computed(function(){return n.makeGlyphArray(n.beatType())}),n.timeNames=[{name:(0,a.resource)("timeSignature.commonTime"),code:"common"},{name:(0,a.resource)("timeSignature.cutTime"),code:"cut"},{name:(0,a.resource)("timeSignature.customTime"),code:null}],n.types=[{name:(0,a.resource)("timeSignature.normal"),code:"normal"},{name:(0,a.resource)("timeSignature.pickup"),code:"pickup"}],n.visibilities=[{name:(0,a.resource)("timeSignature.default"),code:"default"},{name:(0,a.resource)("timeSignature.shown"),code:"shown"},{name:(0,a.resource)("timeSignature.hidden"),code:"hidden"}],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,i.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"createGlyphClass",value:function(e){return"number"+e}},{key:"makeGlyphArray",value:function(e){var t=this;return e.toString().split("").map(function(e){return t.createGlyphClass(e)})}},{key:"isCustomTimeType",value:function(){return this.beats()!=this.beatType()||!(this.beatType()%2==0&&this.beats()%2==0)||this.beatType()>4}},{key:"setMode",value:function(e){return function(){this.mode(e)}}},{key:"setVisibility",value:function(e){return function(){this.visibility(e)}}},{key:"_handleTimeSignatureChanged",value:function(){this.editor.controller.removeEventListener("timeSignatureApplied",this._handleTimeSignatureChanged.bind(this)),r.default.publish(n.REPORTER_REMOVE)}},{key:"_applyTimeSignature",value:function(){this.editor.controller.addEventListener("timeSignatureApplied",this._handleTimeSignatureChanged.bind(this));var e=new this.TimeSignature(parseInt(this.beats(),10),parseInt(this.beatType(),10));"custom"==this.timeSymbol()&&this.timeSymbol(null),e.timeSymbol=this.timeSymbol(),e.hidden="hidden"==this.mode(),e.visibility=this.visibility(),this.editor.controller.document.undoHistory.openGroup("Change Time Signature"),this.editor.controller.changeTimeSignature(e,"pickup"!=this.mode()),(0,s.hideCurrentDialog)()}},{key:"doOk",value:function(){var e=this;r.default.publish(n.REPORTER_ADD,{text:(0,a.resource)("action.loading")}),this.applyingChange(!0),setTimeout(function(){e._applyTimeSignature()},50)}},{key:"show",value:function(){(0,s.createAndShowDialog)({viewModel:this,templateName:"score/timeSignature"})}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MAXIMUM_INTERVAL_LENGTH=t.MINIMUM_INTERVAL_LENGTH=void 0;var r=s(o(58)),n=s(o(13)),i=o(0),a=o(15);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}t.MINIMUM_INTERVAL_LENGTH=1;t.MAXIMUM_INTERVAL_LENGTH=15;var f=[0,2,4,5,7,9,11],h=[1,4,5],m=[2,3,6,7],g=function(e){function t(e,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,d(t).call(this))).editor=e,n.title=o,n._intervalText="",n._direction="up",n._intervalType="",n._totalOctaves=0,n._intervalInFirstOctave=0,n._lastInterval="",n.errorsReporter=new r.default,n.initializeObservables(),n.initializeSubscribers(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n.default),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"initializeObservables",value:function(){this.transpositionType=ko.observable(),this.interval=ko.observable(),this.isFormOk=ko.observable(!1),this.transpositionDirection=ko.observable("up"),this.intervalTermination=ko.observable(),this.diminished=ko.observable(!1),this.minor=ko.observable(!1),this.perfect=ko.observable(!1),this.major=ko.observable(!1),this.augmented=ko.observable(!1),this.showKeyChange=ko.observable(!1),this.doKeyChange=ko.observable(!0),this.intervalTypeValue=ko.observable()}},{key:"initializeSubscribers",value:function(){var e=this;this.interval.subscribe(function(){return e.checkInterval()}),this.transpositionDirection.subscribe(function(){return e.checkEverythingSelected()}),this.intervalTypeValue.subscribe(function(){return e.checkEverythingSelected()})}},{key:"checkInterval",value:function(){this._intervalText=this.interval(),this._intervalText!=this._lastInterval&&(this._lastInterval=this._intervalText,this.uncheckIntervalTypes(),this.errorsReporter.clearErrors(),""===this._intervalText?(this.disableForm(),this.showKeyChange(!1)):this.validateIntervalText()&&(this.checkEverythingSelected(),this.showHideTranspositionTypes(),this.setIntervalTermination(),this.showKeyChange(!0)))}},{key:"validateIntervalText",value:function(){var e=!0;return(0,a.areOnlyNumbers)(this._intervalText)?this.checkIntervalMaximumNumber()?this.checkIntervalMinimumNumber()||(this.errorsReporter.addError({code:"errors.noValidValue",message:(0,i.resource)("errors.noValidValue")}),e=!1):(this.errorsReporter.addError({code:"errors.intervalTooBig",message:(0,i.resource)("errors.intervalTooBig")}),e=!1):(this.errorsReporter.addError({code:"errors.onlyNumbers",message:(0,i.resource)("errors.onlyNumbers")}),e=!1),e||this.disableForm(),e}},{key:"disableForm",value:function(){this.disableAllTranspositionTypes(),this.isFormOk(!1)}},{key:"checkIntervalMaximumNumber",value:function(){return this._intervalText<=15}},{key:"checkIntervalMinimumNumber",value:function(){return this._intervalText>=1}},{key:"showHideTranspositionTypes",value:function(){var e=this._intervalText-1;this._totalOctaves=Math.floor(e/7),this._intervalInFirstOctave=e%7+1,1==this._intervalText?(this.diminished(!1),this.minor(!1),this.perfect(!1),this.major(!1)):h.indexOf(this._intervalInFirstOctave)>-1?(this.diminished(!0),this.minor(!1),this.perfect(!0),this.major(!1)):(this.diminished(!0),this.minor(!0),this.perfect(!1),this.major(!0)),this.augmented(!0)}},{key:"uncheckIntervalTypes",value:function(){this.intervalTypeValue(!1)}},{key:"checkEverythingSelected",value:function(){var e=!0;return this.intervalTypeValue()||(e=!1),""===this.interval()&&(e=!1),this.isFormOk(e),!0}},{key:"disableAllTranspositionTypes",value:function(){this.diminished(!1),this.minor(!1),this.perfect(!1),this.major(!1),this.augmented(!1)}},{key:"getDirection",value:function(){this._direction=this.transpositionDirection()}},{key:"getIntervalSign",value:function(){return"up"==this._direction?1:-1}},{key:"getIntervalType",value:function(){this._intervalType=this.intervalTypeValue()}},{key:"getIntervalTypePitches",value:function(){var e=0;return"diminished"==this._intervalType&&(e=m.indexOf(this._intervalInFirstOctave)>-1?-2:-1),"minor"==this._intervalType&&(e=-1),"augmented"==this._intervalType&&(e=1),e}},{key:"getChromaticPitches",value:function(){return 12*this._totalOctaves+f[this._intervalInFirstOctave-1]+this.getIntervalTypePitches()}},{key:"getNewKey",value:function(e){var t=this.getChromaticPitches()*this.getIntervalSign();return e.keySignature.transposeByInterval(t)}},{key:"changeKeySignature",value:function(){for(var e=this.editor.controller.selection.selectedMeasures,t=e.startIndex;t<e.endIndex;t++){var o=this.editor.controller.score.systemStaff.getMeasureAt(t),r=this.getNewKey(o);o.keySignature=r,null!=o.keySignatureNotation&&(o.removeElement(o.keySignatureNotation),null!=o.barlineNotation&&(o.barlineNotation.type="single"));var n=!0,i=!1,a=void 0;try{for(var s,l=this.editor.controller.score.staves[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value,u=c.getMeasureAt(t);0===t||c.getMeasureAt(t-1);u.keySignature=r,c.improveSpelling(t,!0)}}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}this.editor.controller.score.defaultSystemMeasureNotations(t,!0),this.editor.controller.score.defaultSystemMeasureNotations(t+1,!0)}}},{key:"transpose",value:function(){this.getDirection(),this.getIntervalType();var e=(this._intervalInFirstOctave-1)*this.getIntervalSign(),t=this.getChromaticPitches()*this.getIntervalSign();this.editor.controller.document.undoHistory.openGroup("Apply transposition"),this.editor.controller.transposeSelectionInterval(e.toString()+":"+t.toString()),this.doKeyChange()&&this.changeKeySignature(),this.editor.scoreApi.ensureSelectionVisible()}},{key:"doOk",value:function(){return!!this.isFormOk()&&(this.transpose(),!0)}},{key:"setIntervalTermination",value:function(){var e=(0,i.resource)("transpose.intervalTermination."+this._intervalText.toString());-1!=e.indexOf("[transpose.intervalTermination")&&(e=this._intervalText.toString()),this.intervalTermination(e)}},{key:"selectAllInput",value:function(){$("#interval").select()}},{key:"preventDefault",value:function(e,t){e.preventDefault()}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(60);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,l(t).call(this))).editor=e,r.title=o,r.inputDevices=ko.observableArray(),r.selectedDevice=ko.observable(),(0,n.getInputDevices)({success:function(e){r.inputDevices(e),r.selectedDevice(r.currentDevice(e)),r.selectedDevice.subscribe(r.useDevice)},failure:function(){r.inputDevices([{label:"Default",deviceId:"default"}])}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"currentDevice",value:function(e){for(var t=(0,n.retrieveDeviceId)(),o=0;o<e.length;o++){var r=e[o];if(r.deviceId==t)return r}}},{key:"useDevice",value:function(e){(0,n.getMicStream)(function(){},e.deviceId)}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExportScoreDialog=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(104)),n=o(14),i=o(596),a=o(0),s=o(3);var l=function(e){this.name=ko.observable(e.name),this.value=ko.observable(e.value),this.cssId=ko.observable("export"+e.value),this.selected=ko.observable(!1)};t.ExportScoreDialog=function(e,t){var o=this;o.resource=a.resource,o.initializeConnectedProperties=function(){o.isProductCopy=ko.observable(),(0,n.connect)(i.exportScoreDialogSelector,{})(o)},o.initializeConnectedProperties();var c=$$nf.classes.com.noteflight.notation.editor.ScoreExport;s.DialogViewModel.call(this),o.editor=e,o.title=t,o.state=ko.observable("chooseFormat");var u="MusicXML",d="MIDI",p="WAVaudio",f="MP3audio",h="NoteflightXML",m="PDF",g="PartsPDF",b="FullAndIndividualPDF",v="PlaybackMeasures",y="StandingWaveJson",_="Soundtrap",S=[];o.editor.scorePermissions.canPrint()&&S.push(new l({name:(0,a.resource)("content.exportToPDF"),value:m}),new l({name:(0,a.resource)("content.exportIndividualPartsToPDF"),value:g}),new l({name:(0,a.resource)("content.fullAndIndividualToPDF"),value:b})),o.editor.scorePermissions.canExport()&&(S.push(new l({name:(0,a.resource)("content.exportFormatMusicXML"),value:u}),new l({name:(0,a.resource)("content.exportFormatMIDI"),value:d}),new l({name:(0,a.resource)("content.exportFormatSoundtrap"),value:_})),NF.hasOfflineAudioContext&&(S.push(new l({name:(0,a.resource)("content.exportFormatWAVaudio"),value:p})),S.push(new l({name:(0,a.resource)("content.exportFormatMP3"),value:f}))),NF.session.current_user()&&NF.session.current_user().has_premium_features()&&S.push(new l({name:(0,a.resource)("content.exportFormatNoteflightXML"),value:h})),o.editor.scorePermissions.areDeveloperFeaturesEnabled()&&(S.push(new l({name:(0,a.resource)("content.playbackMeasures"),value:v})),S.push(new l({name:(0,a.resource)("content.standingWaveJson"),value:y})))),o.exportFormatList=ko.observableArray(S),o.exportFormat=ko.observable(),o.formatListSelectionChanged=function(e){o.exportFormat()&&o.exportFormat().selected(!1),e&&(e.selected(!0),o.exportFormat(e))},o.formatListSelectionChanged(o.exportFormatList()[0]);var w=[{name:ko.observable((0,a.resource)("content.exportFormatMIDIForPerformance")),value:ko.observable(c.MIDI_OPTIMIZE_FOR_PERFORMANCE)},{name:ko.observable((0,a.resource)("content.exportFormatMIDIForImport")),value:ko.observable(c.MIDI_OPTIMIZE_FOR_SCORE)}];o.midiOptions=ko.observableArray(w),o.currentMidiOption=ko.observable(c.MIDI_OPTIMIZE_FOR_PERFORMANCE),o.exportToMidiOptionsVisible=ko.computed(function(){return"chooseFormat"==o.state()&&o.exportFormat()&&o.exportFormat().value()==d}),o.downloadLinkData=ko.observable(),o.downloadLinkFilename=ko.observable(),o.exportScore=function(){switch(NF.analytics.trackEvent("webapp","export_score",o.exportFormat().value()),o.state()){case"chooseFormat":switch(o.exportFormat().value()){case u:o.exportMusicXML();break;case d:o.exportMIDI();break;case p:o.exportWAVaudio();break;case f:o.exportMP3audio();break;case h:o.exportNoteflightXML();break;case m:o.exportToPDF();break;case g:o.exportIndividualPartsToPDF();break;case b:o.exportFullAndIndividualPartsToPDF();break;case v:o.exportPlaybackMeasures();break;case y:o.exportStandingWaveJson();break;case _:o.exportSoundtrap()}break;case"downloadLinkShowing":(0,s.hideCurrentDialog)()}},o.doOk=function(){return o.exportScore(),!1},o.exportMusicXML=function(){var t=e.element.jsnoteflight("getMusicXML");o.saveResult(t,".xml","application/xml",!0)},o.exportMIDI=function(){var t={midiOptimization:o.currentMidiOption()},r=e.element.jsnoteflight("exportToMidi",t);r?o.saveResult(r,".mid","audio/midi",!1):o.state("emptyFile")},o.exportWAVaudio=function(){var t=e.controller.createWav.bind(e.controller);o.exportAudio(t,".wav","audio/wav")},o.exportMP3audio=function(){var t=e.controller.createMP3.bind(e.controller);o.exportAudio(t,".mp3","audio/mpeg")},o.exportAudio=function(e,t,r){o.state("preparingFile"),e(function(e){e?o.saveResult(e,t,r,!1):o.state("error")})},o.exportNoteflightXML=function(){var t=e.element.jsnoteflight("saveScore").toXMLString();o.saveResult(t,".xml","application/xml",!0)},o.exportPlaybackMeasures=function(){var t=e.element.jsnoteflight("getPlaybackMeasures");o.saveResult(t,".txt","application/txt",!0)},o.exportStandingWaveJson=function(){var t=e.element.jsnoteflight("getStandingWaveJson");o.saveResult(t,".json","application/json",!0)},o.exportSoundtrap=function(){var t={midiOptimization:o.currentMidiOption()},r=e.element.jsnoteflight("exportToMidi",t);NF.apiService.uploadMidi((0,a.resource)("session.loggingIn"),function(t){var o=t.url,r=e.documentController.scoreDocument.score.title,n="https://www.soundtrap.com/publicapi/import/midi1?"+$.param({title:r,url:o});window.location=n},{midi:JSON.stringify(r)},{})},o.exportToPDF=function(){e.print(),o.cancel()},o.exportIndividualPartsToPDF=function(){e.scoreDialogs.printIndividualParts(),o.cancel()},o.exportFullAndIndividualPartsToPDF=function(){e.scoreDialogs.printIndividualParts({includeFullScore:!0}),o.cancel()},o.saveResult=function(e,t,n,i){if(NF.hasSaveAs){if(i){for(var a=(e=unescape(encodeURIComponent(e))).length,s=new Uint8Array(new ArrayBuffer(a)),l=0;l<a;l++)s[l]=e.charCodeAt(l);e=s}e=Array.isArray(e)?e:[e];var c=new Blob(e,{type:n});r.default.saveAs(c,o.editor.score().title()+t),o.state("fileSaved")}else o.showDownloadLink(e,t,n,i)},o.showDownloadLink=function(e,t,r,n){n||(e=String.fromCharCode.apply(null,e)),o.editor.score().title()?o.downloadLinkFilename(o.editor.score().title()+t):o.downloadLinkFilename((0,a.resource)("content.exportDefaultFileName",t));var i=e;n&&(i=unescape(encodeURIComponent(e))),o.downloadLinkData("data:"+r+";base64,"+btoa(i)),o.state("downloadLinkShowing")}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNotification=function(e){return s(i,e)},t.getNotification=function(e){return s(n,e)},t.dismissNotification=function(e){return s(a,e)},t.NOT_ENOUGH_MEASURE_REPEAT_SPACE=t.REPOSITIONED_SYSTEM_TEXT=t.INVALID_REPEAT_TEXT=t.SCORE_PUBLISHED=void 0;var r=o(24);t.SCORE_PUBLISHED="score_published";t.INVALID_REPEAT_TEXT="invalid_repeat_text";t.REPOSITIONED_SYSTEM_TEXT="repositioned_system_text";t.NOT_ENOUGH_MEASURE_REPEAT_SPACE="not_enough_measure_repeat_space";var n="/api/1.0/notifications/info",i="/api/1.0/notifications/create",a="/api/1.0/notifications/dismiss";function s(e,t){return(0,r.jsonPost)(e,{key:t}).then(function(e){return e.notification})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(4)),n=u(o(62)),i=u(o(214)),a=o(5),s=o(2),l=o(0),c=o(3);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group=t,this.groupForm=null,this.editGroup=null,this.templateName=ko.observable("group/editGroup"),this.readyToShow=ko.observable(!1),this.busy=ko.observable(!1),this.handleUpdateGroupSuccess=this.handleUpdateGroupSuccess.bind(this)}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"activate",value:function(){this.editGroup=new n.default({id:this.group().id(),name:this.group().name(),overview_all:this.group().overview_all(),overview_members:this.group().overview_members(),access_policy:this.group().access_policy(),admission_policy:this.group().admission_policy(),group_logo_id:this.group().group_logo_id(),is_community_group:this.group().is_community_group()}),this.groupForm=new i.default(this.editGroup),this.readyToShow(!0)}},{key:"goToOverviewPage",value:function(){NF.location.setUri((0,s.path)("viewGroup",{groupId:this.editGroup.id()}))}},{key:"checkForPolicyChange",value:function(e){this.isLessRestrictiveGroup(this.editGroup.access_policy())?(0,c.okCancel)((0,l.resource)("content.lessRestrictiveGroupQuestion"),e):e()}},{key:"isLessRestrictiveGroup",value:function(e){return"public"!=this.group().access_policy()&&"public"==e}},{key:"handleUpdateGroupSuccess",value:function(e){r.default.publish(a.GROUP_UPDATED,e.group),this.goToOverviewPage(),this.readyToShow(!1),this.busy(!1)}},{key:"handleSubmitClick",value:function(){var e=this;this.groupForm.validateGroup()&&this.checkForPolicyChange(function(){e.busy(!0),function(e,t,o){NF.apiService.updateGroup(t,o,{id:e.id(),name:e.name(),overview_all:e.overview_all(),overview_members:e.overview_members(),access_policy:e.access_policy(),admission_policy:e.admission_policy(),group_logo_id:e.group_logo_id()})}(e.editGroup,(0,l.resource)("content.updatingGroup"),e.handleUpdateGroupSuccess)})}},{key:"handleCancelClick",value:function(){this.goToOverviewPage(),this.readyToShow(!1)}}]),e}();t.default=p,Noteflight.EditGroupViewModel=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(4)),n=o(5),i=s(o(624)),a=o(53);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editable=ko.observable(!1),this.id=ko.observable(t),this.id.subscribe(function(){o._updateProfileEpoch()}),this.groupId=ko.observable(t),this.needsImageRefresh=ko.observable(!1),this.imageUploader=ko.observable(),this.url=ko.computed(function(){if(o.groupId()){var e="/api/1.0/groups/"+o.groupId()+"/logo";return(0,a.profileEpoch)()&&(e+="?"+(0,a.profileEpoch)()),o.createImageUploader(e),e}}),this.backgroundImageUrl=ko.computed(function(){return"url('".concat(o.url(),"')")}),this.size=ko.observable("big"),r.default.subscribe(n.STOCK_IMAGE_GROUP_LOGO_SELECTED,function(e,t){o.needsImageRefresh(!0)}),r.default.subscribe(n.GROUP_LOGO_IMAGE_GENERATED,function(e,t){o.needsImageRefresh(!0)}),r.default.subscribe(n.GROUP_SAVED,function(e,t){o.needsImageRefresh()&&(o.needsImageRefresh(!1),o._updateProfileEpoch(),r.default.publish(n.GROUP_LOGO_IMAGE_GENERATED))})}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"createImageUploader",value:function(e){var t={imageId:this.id,imageUrl:ko.observable(e),aspectRatio:16/9};this.imageUploader(new i.default(t))}},{key:"_updateProfileEpoch",value:function(){(0,a.updateProfileEpoch)(!0)}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(4)),n=c(o(215)),i=c(o(216)),a=o(5),s=o(2),l=o(0);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t,o){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateCallback=o,this.site=t,this.siteForm=null,this.editSite=null,this.templateName=ko.observable("site/editSite"),this.readyToShow=ko.observable(!1),this.serviceReporter=new Noteflight.ServiceReporterViewModel((0,l.resource)("content.updatingSite")),this.handleUpdateSiteSuccess=this.handleUpdateSiteSuccess.bind(this),this.disableSave=ko.computed(function(){return!n.readyToShow()||n.serviceReporter.busy()}),r.default.subscribe(a.STOCK_IMAGE_GROUP_LOGO_SELECTED,function(e,t){t.group_logo_id&&n.editSite.logo_id(t.group_logo_id)})}return function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(e,[{key:"activate",value:function(){this.editSite=new n.default({groupId:this.site.groupId(),name:this.site.name(),description:this.site.description(),allow_anonymous_view:this.site.allow_anonymous_view(),logo_id:this.site.logo_id(),site_type:this.site.site_type(),sso_username:this.site.sso_username(),courses:this.site.courses()}),this.siteForm=new i.default(this.editSite),this.readyToShow(!0)}},{key:"goToOverviewPage",value:function(){NF.location.setUri((0,s.path)("viewGroup",{groupId:this.editSite.groupId()})),this.readyToShow(!1)}},{key:"handleUpdateSiteSuccess",value:function(e){r.default.publish(a.SITE_UPDATED,e),e.community.hostname==NF.session.community().hostname()&&this.goToOverviewPage()}},{key:"handleSubmitClick",value:function(){this.siteForm.validateSite()&&function(e,t,o){NF.apiService.updateSite(t,o,{name:e.name(),description:e.description(),default_proxy_url:e.default_proxy_url(),allow_anonymous_view:e.allow_anonymous_view(),logo_id:e.logo_id(),sso_username:e.sso_username(),site_type:e.site_type(),courses:e.courses()})}(this.editSite,this.serviceReporter,this.handleUpdateSiteSuccess)}},{key:"handleCancelClick",value:function(){this.goToOverviewPage()}}]),e}();t.default=d,Noteflight.EditSiteViewModel=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(13)),n=c(o(627)),i=c(o(126)),a=o(2),s=o(0),l=o(3);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=[],r=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return o}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},(o=f(this,h(t).call(this))).type=e.type,o.groupIds=e.groupIds,o.onCommit=function(){},o.initializeObservables(),o.initializeComputeds(),o.redirectAfterCommit=e.redirectAfterCommit,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,r.default),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"initializeObservables",value:function(){this.communityMembersAdded=ko.observable(0),this.communityMembersRemoved=ko.observable(0),this.communityMembersUpdated=ko.observable(0),this.addedList=ko.observableArray([]),this.removedList=ko.observableArray([]),this.warningMessages=ko.observableArray([]),this.okayEnabled=ko.observable(!0),this.cancelEnabled=ko.observable(!0),this.loading=ko.observable(!1),this.error=ko.observable(!1),this.abortSyncing=ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.toBeAdded=ko.computed(function(){return(0,s.pluralize)("content.syncClassroom.toBeAdded",e.communityMembersAdded())}),this.toBeRemoved=ko.computed(function(){return(0,s.pluralize)("content.syncClassroom.toBeRemoved",e.communityMembersRemoved())}),this.toBeUpdated=ko.computed(function(){return(0,s.pluralize)("content.syncClassroom.toBeUpdated",e.communityMembersUpdated())}),this.areListsEmpty=ko.computed(function(){return 0===e.addedList().length&&0===e.removedList().length})}},{key:"_resetObservables",value:function(){this.communityMembersAdded(0),this.communityMembersRemoved(0),this.communityMembersUpdated(0),this.addedList([]),this.removedList([]),this.warningMessages([]),this.okayEnabled(!0),this.cancelEnabled(!0),this.abortSyncing(!1)}},{key:"show",value:function(){(0,l.createAndShowDialog)({viewModel:this,templateName:"dialogs/syncClassroom",modal:!0})}},{key:"cancelSyncing",value:function(){this.abortSyncing(!0),this.cancel()}},{key:"previewRequestInfo",value:function(){switch(this.type){case"community":return["googleClassroomSyncCommunityPreview",{}];case"group":return["googleClassroomSyncGroupPreview",{groupId:this.groupIds[0]}];case"manage_courses":return["googleClassroomSyncCommunityPreview",{groupIds:this.groupIds}]}}},{key:"commitRequestInfo",value:function(){switch(this.type){case"community":return["googleClassroomCommitCommunitySync",{}];case"group":return["googleClassroomCommitGroupSync",{groupId:this.groupIds[0]}];case"manage_courses":return["googleClassroomManageCourses",{groupIds:this.groupIds}]}}},{key:"beginSync",value:function(e){var t=this;this._resetObservables(),this.okayEnabled(!1),this.cancelEnabled(!0),this.loading(!0),this.error(!1),this.showSyncDelta({courses:[],new_community_members:[],removed_community_members:[],updated_community_members:[],warnings:[]}),this.onCommit=e;var o=d(this.previewRequestInfo(),2),r=o[0],n=o[1];NF.apiService[r]((0,s.resource)("content.gc.syncClassroomDelta"),function(e){return t.beginPolling(e.job.id)},n,{})}},{key:"beginPolling",value:function(e){var t=this;this.abortSyncing()||(new i.default).onComplete(function(e,o){t.okayEnabled(!0),t.showSyncDelta(e[0].result),t.loading(!1)}).onError(function(){t.cancelEnabled(!0),t.loading(!1),t.error(!0),t.okayEnabled(!1)}).startPolling(e)}},{key:"showSyncDelta",value:function(e){var t=this,o=[],r=[],n=Object.values(e.courses);["community","manage_courses"].includes(this.type)?(o=this.addedCourses(n),r=this.removedCourses(n)):(o=this.addedMembers(n[0]),r=this.removedMembers(n[0]));this.addedList(o),this.removedList(r),this.communityMembersAdded(e.new_community_members.length),this.communityMembersRemoved(e.removed_community_members.length),this.communityMembersUpdated(e.updated_community_members.length);var i=e.warnings.map(function(e){"error"==e.severity&&t.okayEnabled(!1);var o="content.gc.".concat(e.resource);return e.resource_args.unshift(o),(0,s.hasResource)(o)?s.resource.apply(NF,e.resource_args):s.pluralize.apply(NF,e.resource_args)});this.warningMessages(i),this.show()}},{key:"addedCourses",value:function(e){return e.filter(function(e){return e.added.length||e.updated.length}).map(function(e){return new n.default({name:e.course_name,count:e.added.length+e.updated.length})})}},{key:"removedCourses",value:function(e){return e.filter(function(e){return e.removed.length}).map(function(e){return new n.default({name:e.course_name,count:e.removed.length})})}},{key:"addedMembers",value:function(e){return e?e.added.concat(e.updated).filter(function(e,t,o){return o.indexOf(e)===t}).map(function(e){return new n.default({name:e.name})}):[]}},{key:"removedMembers",value:function(e){return e?e.removed.map(function(e){return new n.default({name:e.name})}):[]}},{key:"okay",value:function(){this.okayEnabled(!1),this.cancelEnabled(!1);var e=d(this.commitRequestInfo(),2),t=e[0],o=e[1];NF.apiService[t]((0,s.resource)("content.gc.syncClassroomCommit"),this.postCommit.bind(this),o,{})}},{key:"postCommit",value:function(e){this.ok(),this.redirectAfterCommit&&(0,a.navigate)(this.redirectAfterCommit),this.onCommit(e)}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(0),i=o(15);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),e}var c=function(){function e(){var t=this;a(this,e),this.title=ko.computed(function(){return(0,n.resource)(NF.session.current_user()?"content.upgrade":"content.joinNoteflight")}),this.plans=ko.observableArray([]),this.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("action.loadingInfo")),this.subscriptionPlansService=Noteflight.postService("/api/1.0/subscription_plans",this.serviceReporter,function(e){var o=t.getPlanByCode("premium");o.setPrice(e.plans.crescendo_monthly.initial_charge,"monthly"),o.setPrice(e.standard_plan.initial_charge,"yearly"),e.promoted_plan&&o.setPrice(e.promoted_plan.initial_charge,"yearly")}),this.initialize()}return l(e,[{key:"getPlanByCode",value:function(e){for(var t=0;t<this.plans().length;t++)if(this.plans()[t].code()==e)return this.plans()[t]}},{key:"initialize",value:function(){NF.session.community().default_community()||(0,r.navigate)(NF.paths.loggedInHome());for(var e=0;e<p.length;e++)this.plans.push(new d(p[e]));var t=new Noteflight.CustomTeacherPlanViewModel(1,10,1,!1);this.getPlanByCode("learn").setPrice(t.renewal_charge()),this.subscriptionPlansService()}}]),e}();t.default=c;var u=function(){function e(t,o){var r=this;a(this,e),this.priceCode=o.code,this.planCode=t,this.purchasePath=o.purchasePath,this.discount=ko.computed(function(){return o.discount?r.addPriceCode("plans."+r.planCode+".discount"):null}),this.priceIsText=ko.observable(o.isText),this.priceText=ko.observable("plans."+this.planCode+".priceText"),this.symbol=ko.observable("$"),this.dollars=ko.observable(""),this.cents=ko.observable(""),this.renewalFrequency=ko.observable("plans."+o.frequency),this.purchaseText=ko.computed(function(){return r.addPriceCode("plans."+r.planCode+".purchaseText")}),this.buttonTopLine=ko.observable("plans."+this.planCode+".buttonTopLine"),this.buttonBottomLine=ko.computed(function(){var e=r.symbol()+r.dollars();return r.cents()>0&&(e+="."+r.cents()),(0,n.resource)(r.addPriceCode("plans."+r.planCode+".buttonBottomLine"),e)}),this.showPurchaseButton=ko.computed(function(){return o.showButtonIfLoggedIn||!NF.session.current_user()})}return l(e,[{key:"addPriceCode",value:function(e){return this.priceCode&&(e+="_"+this.priceCode),e}},{key:"purchaseAction",value:function(){"signup"==this.purchasePath?Noteflight.appViewModel.showSignupForm():(0,r.navigate)((0,r.path)(this.purchasePath))}}]),e}(),d=function(){function e(t){var o=this;a(this,e),this.info=t,this.code=ko.observable(t.code),this.name=ko.observable("plans."+this.code()),this.description=ko.observable("plans."+this.code()+".description"),this.featuresDescription=ko.observable("plans."+this.code()+".featuresDescription"),this.prices=ko.observableArray([]),this.features=ko.observableArray([]),this.showLearnMore=ko.observable(t.showLearnMore),this.showPriceFromText=ko.computed(function(){return"learn"==o.code()}),this.initialize()}return l(e,[{key:"goToLearnMore",value:function(){(0,r.navigate)((0,r.path)(this.info.learnMorePath))}},{key:"setPrice",value:function(e,t){var o;if(1==this.prices().length)o=this.prices()[0];else for(var r=0;r<this.prices().length;r++)if(this.prices()[r].priceCode==t){o=this.prices()[r];break}if(o){var n=(0,i.getUnitsAndCentsFromPrice)(e);o.dollars(n[0]),o.cents(n[1])}}},{key:"initialize",value:function(){for(var e=0;e<this.info.prices.length;e++)this.prices.push(new u(this.code(),this.info.prices[e]));var t=!0,o=!1,r=void 0;try{for(var n,i=this.info.features[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var a=n.value;this.features.push({text:"plans."+this.code()+"."+a})}}catch(e){o=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(o)throw r}}}}]),e}(),p=[{code:"basic",showLearnMore:!1,features:["musicAnywhereAnytime","purchaseMarketplace","publicShare","print","devices","importExport","connect","joinGroups"],prices:[{isText:!0,action:"",buttonVisible:!1,purchasePath:"signup",showButtonIfLoggedIn:!1}]},{code:"premium",showLearnMore:!0,features:["unlimitedScores","sellMarketplace","instrumentsNumber","printParts","record","partFormatting","audioReverb","midiTranscription","groups","privateShare","templates","collections","scoreFont","colorHide"],learnMorePath:"premium",prices:[{isText:!1,frequency:"perMonth",action:"",buttonVisible:!0,code:"monthly",purchasePath:"commerceFormMonthly",showButtonIfLoggedIn:!0},{frequency:"perYear",isText:!1,action:"",buttonVisible:!0,code:"yearly",discount:!0,purchasePath:"commerceFormAnnual",showButtonIfLoggedIn:!0}]},{code:"learn",showLearnMore:!0,features:["secure","allPremium","createClasses","lessonTemplates","includedLessons","contentLibraries","googleClassroom","ltis"],learnMorePath:"learn",prices:[{frequency:"perYear",isText:!1,action:"",buttonVisible:!0,purchasePath:"commerceFormLearn",showButtonIfLoggedIn:!0}]}]},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(1147);var r=o(20);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}var s=function(){function e(){n(this,e),this.listType=ko.observable("messages"),this.busy=ko.observable(!1),this.remaining=ko.observable(!0),this.chatsList=ko.observableArray([]),this.chatsList.push(new l(this)),this.currentChat=this.chatsList()[0],this.messagesList=ko.observableArray([]),Noteflight.PageableViewModel.call(this,this.fetchMessages)}return a(e,[{key:"activate",value:function(){this.currentChat.initialize()}},{key:"fetchMessages",value:function(){this.currentChat.fetchMessages()}}]),e}();t.default=s;var l=function(){function e(t){n(this,e),this.parent=t,this.initialized=!1,this.fetchingNewMessages=!1,this.minAccountAlertId=Number.MAX_VALUE,this.messagesList=ko.observableArray([]),this.fetchOldMessagesService=Noteflight.postService("/api/1.0/members/messages",this,this.handleSystemMessages)}return a(e,[{key:"initialize",value:function(){this.initialized||(this.loadSystemMessages(),this.initialized=!0)}},{key:"doHandleSystemMessages",value:function(e){for(var t=0;t<e.alerts.length;t++){var o=new c(e.alerts[t]);this.minAccountAlertId=Math.min(o.id(),this.minAccountAlertId),o&&this.messagesList.push(new u(o))}}},{key:"handleSystemMessages",value:function(e){this.parent.messagesNotRead(this.parent.messagesNotRead()-e.alerts.length),this.doHandleSystemMessages(e),this.parent.busy(!1),this.parent.remaining(e.remaining)}},{key:"loadSystemMessages",value:function(){this.parent.busy()||(this.parent.busy(!0),this.fetchOldMessagesService({}))}},{key:"fetchMessages",value:function(){if(!this.parent.busy()){this.parent.busy(!0);var e={};this.minAccountAlertId!=Number.MAX_VALUE&&(e.account_alert_before_id=this.minAccountAlertId),this.fetchOldMessagesService(e)}}}]),e}(),c=function e(t){n(this,e),ko.mapping.fromJS(t,null,this),this.alertViewModel=ko.observable(new Noteflight.AlertViewModel(t)),this.text=ko.observable(),this.createdDate=(0,r.observableRelativeTime)(this.date())},u=function e(t){var o=this;n(this,e),this.message=ko.observable(t),this.messageAuthorProfileLink=ko.observable(""),this.author=ko.observable(new d),this.hideMessage=ko.computed(function(){var e=o.message().type();return"RenewalPaymentFailureAccountAlert"==e&&!o.message().subscription||"RenewalReminderAccountAlert"==e&&!o.message().subscription||"FirstPaymentFailureAccountAlert"==e&&!o.message().subscription||"ExpiringCreditAccountAlert"==e||"PaymentFailureAccountAlert"==e})},d=function e(){var t=this;n(this,e),this.username=ko.observable("Noteflight"),this.avatar=ko.observable(NF.asset("images/messages_avatar.png")),this.avatarUrl=ko.computed(function(){return"url('".concat(t.avatar(),"')")})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(15);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a={commentsByScore:"fa-comment",commentsByTimeframe:"fa-comment",favoritesByScore:"fa-heart",favoritesByTimeframe:"fa-heart",viewsByScore:"fa-eye",viewsByTimeframe:"fa-eye"},s=function(){function e(t,o,i){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable(t),this.data=o,this.period=i,this.total=ko.observable(0),this.title=ko.observable((0,r.resource)("content.".concat(this.id()))),this.formattedTotal=ko.computed(function(){return(0,n.formatCommas)(s.total())}),this.icon=ko.computed(function(){return a[s.id()]}),this.chartLabels=[],this.chartData=[]}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"doCreateChart",value:function(){}},{key:"createChart",value:function(){document.getElementById(this.id())?this.doCreateChart():setTimeout(this.createChart.bind(this),10)}},{key:"initialize",value:function(){this.createChart(this.data)}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o(43)),i=o(0);function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userModel=null,this.lastVisit=ko.observable(),this.role=ko.observable(),this.totalPublicScores=ko.observable(""),this.createdDate=ko.observable(),this.selected=ko.observable(!1),this.isNotRemovable=ko.observable(!1),this.isClickable=ko.observable(!1),this.isBeingEdited=ko.observable(!1),this.showContextMenuButton=ko.observable(!1),this.contextMenuItems=ko.observable(),this.showBlacklistWarning=ko.observable(!1),this.blacklistedDate=ko.observable(!1),this.blacklistedBy=ko.observable(),this.blacklistedComment=ko.observable(),this.requestText=ko.observable(),this.roleText=ko.computed(function(){return(0,i.resource)("content.".concat(t.role()))})}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"goToUser",value:function(){(0,r.navigate)(this.userModel.profilePage())}},{key:"selectMousedown",value:function(){}},{key:"selectMouseup",value:function(){}},{key:"selectTouchstart",value:function(){}},{key:"selectTouchend",value:function(){}},{key:"swallowClick",value:function(){}}],[{key:"createMemberFromCommunityMember",value:function(t){var o=new e;return o.userModel=new n.default({username:t.username,external_id:t.external_id,created:null}),o.totalPublicScores(t.searchable_scores),o}},{key:"createMemberFromUser",value:function(t){var o=new e;return o.userModel=t,o}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(6),i=o(5),a=o(0);var s=5;function l(e){var t=this;t.data=e,t.current_user=ko.observable(),t.community=ko.observable(),t.community_member=ko.observable(),t.locale=ko.observable(),t.show_reminders=ko.observable();var o={current_user:{create:function(e){return new n.Noteflight.User(e.data)}}};t.update=function(e){ko.mapping.fromJS(e,o,t)},e&&t.update(e),t.canShare=ko.computed(function(){return t.current_user()&&t.current_user().identified()}),t.canUpgrade=ko.computed(function(){return t.current_user()&&!t.current_user().premium_member()&&t.community().default_community()});var l=function(e,o){var r=0;if(t.current_user()&&n.Noteflight.config.settings&&n.Noteflight.config.settings[e]){var i=e+"-exclude";if(t.community().default_community()&&n.Noteflight.config.settings[i])for(var a=0;a<n.Noteflight.config.settings[i].length;a++)if(n.Noteflight.config.settings[i][a]==t.current_user().username())return!1;if(n.Noteflight.config.settings[e].length&&"*"==NF.config.settings[e][0])return!0;if(t.community().default_community()){for(r=0;r<n.Noteflight.config.settings[e].length;r++)if(NF.config.settings[e][r]==t.current_user().username())return!0}else{for(r=0;r<n.Noteflight.config.settings[e].length;r++){var s=n.Noteflight.config.settings[e][r].toLowerCase();if(-1!=s.indexOf("community-")){var l=s.substring("community-".length,s.length);if(t.community().name().toLowerCase()==l)return!0}}}}else if(o&&!t.current_user()&&n.Noteflight.config.settings&&n.Noteflight.config.settings[e]&&n.Noteflight.config.settings[e].length&&"*"==n.Noteflight.config.settings[e][0])return!0;return!1};t.showGatedFeature=l,t.sellerFeaturesTweaker=ko.observable(),t.refreshSellerFeatures=function(){t.sellerFeaturesTweaker.notifySubscribers()},t.showSellerFeatures=ko.computed(function(){return t.community()&&t.community().default_community()}),t.showPublicCollections=ko.computed(function(){return l("publicCollections",!0)}),t.allowLargeEnsembles=ko.computed(function(){return l("allowLargeEnsembles",!0)}),t.allowLogin=ko.computed(function(){return t.community().default_community()||t.community().managed()||t.community().sso_allowed()}),t.allowSignup=ko.computed(function(){return t.community().default_community()}),t.remoteIsmEngaged=ko.computed(function(){return l("remoteIsmEngagedUsers",!0)&&"score"==NF.editor.contentType}),t.rr=ko.computed(function(){return l("richRelevance",!0)}),t.rrRecommend=ko.computed(function(){return t.rr()&&l("rrRecommend",!0)}),t.rrFind=ko.computed(function(){return t.rr()&&l("rrFind",!0)}),r.default.subscribe(i.GROUP,function(e,o){t.updateUserGroups()}),r.default.subscribe(i.SITE_UPDATED,function(e,o){t.updateSite(o)}),t.updateSite=function(e){e.community.hostname!=NF.session.community().hostname()?NF.location.setUri(decodeURI(e.url)):(t.current_user().username(e.community_member.sso_username),t.community().allow_anonymous_view(e.community.allow_anonymous_view))},t.updateUserGroups=function(){NF.apiService.fetchAllGroups((0,a.resource)("action.loading"),function(e){t.user_groups.groups(ko.mapping.fromJS(e.groups)()),t.user_groups.count(e.count)},{max_count:s,order:"last_visited_at",user_id:NF.session.current_user().external_id()})}}n.Noteflight.Session=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(313),n=o(19),i=s(o(42)),a=s(o(35));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c={yourhome:r.PrivateHomeSection,score:r.PublicScoreSection,group:r.GroupSection,communitymember:r.MemberSection,marketplace_with_contribs:r.ProductSection},u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reporter=new i.default,this.isMobileLayout=n.isMobileLayout,this.initializeObservables(),this.initializeComputeds(),this.searchConfiguration={yourhome:3,score:3,group:1,communitymember:1},this.debouncedSearch=a.default.debounce(this.search,250),setTimeout(function(){$("body").click(function(e){e.target.closest("div.searchWrapper")||t.active(!1)})},1)}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"initializeObservables",value:function(){this.forceShowSearchBar=ko.observable(!1),this.sections=ko.observableArray([]),this.searchText=ko.observable(""),this.fullWidthInput=ko.observable(!0),this.selectedElement=ko.observable(0),this.searchPlaceholder=ko.observable("palette.search"),this.active=ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.resultsShown=ko.computed(function(){return 0!==e.sections().length&&0!==e.sections()[0].elements().length}),ko.computed(function(){e.fullWidthInput(!(0,n.isPhoneLayoutOrSmaller)())})}},{key:"getSuggestions",value:function(){this.searchEngine(this.searchText()),NF.analytics.trackEvent("Search","suggestion",this.searchText())}},{key:"updateSearch",value:function(e){this.clearSections();var t=e.results;for(var o in this.searchConfiguration)if((NF.session.current_user()||"yourhome"!=o)&&(NF.session.showSellerFeatures()||"marketplace_with_contribs"!=o)){var r=new c[o](o);if(this.sections.push(r),r.createElement(this.searchText()),void 0!==t[o])for(var n=0,i=t[o],a=0;a<i.length;a++)if(!r.containsElement(i[a].title,i[a].type)){if("yourhome"==o)switch(i[a].document_type){case"score":r.createElement(i[a].title);break;case"marketplace::interactivescoreproduct":r.createForSaleElement(i[a].title);break;case"marketplace::purchasedproduct":r.createPurchasedProductElement(i[a].title)}else r.createElement(i[a].title);if(++n==this.searchConfiguration[o])break}}this.unselectAllElements(),this.selectedElement(0),this.selectElement(this.selectedElement())}},{key:"searchEngine",value:function(e){var t=this,o={};for(var r in this.searchConfiguration)("yourhome"!=r||NF.session.current_user())&&(o[r]=2*this.searchConfiguration[r]);NF.apiService.searchSuggestions("",function(e){t.updateSearch(e)},{term:e,search_types:o})}},{key:"selectElement",value:function(e){for(var t=0,o=0;o<this.sections().length;o++){var r=this.sections()[o];if(this.selectedElement()<t+r.totalElements)return void r.selectElement(this.selectedElement()-t);t+=r.totalElements}}},{key:"unselectAllElements",value:function(){for(var e=0;e<this.sections().length;e++)this.sections()[e].unselectAllElements()}},{key:"searchSelectedElement",value:function(){if(0!==this.sections().length){for(var e=0,t=0;t<this.sections().length;t++){var o=this.sections()[t];if(this.selectedElement()<e+o.totalElements)return void o.searchSelectedElement();e+=o.totalElements}this.searchText("")}}},{key:"search",value:function(){this.active(!0),this.getSuggestions()}},{key:"searchWithNoSelection",value:function(){(new(c[Object.keys(this.searchConfiguration)[0]])).searchInSection(this.searchText()),this.searchText("")}},{key:"handleKeyUp",value:function(e,t){13==t.keyCode&&this.searchText().length>0?this.searchSelectedElement():40==t.keyCode?(this.selectedElement(this.selectedElement()+1),this.selectedElement()>=this.totalElements&&this.selectedElement(0),this.unselectAllElements(),this.selectElement(this.selectedElement())):38==t.keyCode?(this.selectedElement(this.selectedElement()-1),this.selectedElement()<0&&this.selectedElement(this.totalElements-1),this.unselectAllElements(),this.selectElement(this.selectedElement())):(this.updateSearch({results:{}}),this.debouncedSearch())}},{key:"selectAllText",value:function(){return $("#searchString").select(),!0}},{key:"clearSections",value:function(){for(var e=0;e<this.sections().length;e++)this.sections()[e].clearElements();this.sections([])}},{key:"totalElements",get:function(){for(var e=0,t=0;t<this.sections().length;t++)e+=this.sections()[t].totalElements;return e}}]),e}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreEditorSection=t.ProductSection=t.MemberSection=t.GroupSection=t.PurchasedProductSection=t.ForSaleSection=t.PrivateHomeSection=t.PublicScoreSection=void 0;var r=o(314),n=o(2);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,o){return t&&d(e.prototype,t),o&&d(e,o),e}var f=function(){function e(t){u(this,e),this.title=ko.computed(function(){return"section."+t}),this.elements=ko.observableArray([]),this.path="publicSearch"}return p(e,[{key:"createElement",value:function(e){throw"not overwritten"}},{key:"clearElements",value:function(){this.elements([])}},{key:"addElement",value:function(e){this.elements.push(e)}},{key:"containsElement",value:function(e,t){for(var o=e.toLowerCase(),r=0;r<this.elements().length;r++)if(this.elements()[r].name().toLowerCase()==o)return!t||this.elements()[r].type==t;return!1}},{key:"searchSelectedElement",value:function(){for(var e=0;e<this.elements().length;e++)this.elements()[e].selected()&&this.elements()[e].handleClick()}},{key:"selectElement",value:function(e){this.elements()[e].select()}},{key:"unselectAllElements",value:function(){for(var e=0;e<this.elements().length;e++)this.elements()[e].unselect()}},{key:"searchInSection",value:function(e){(0,n.navigate)(NF.paths[this.path]({searchTarget:e}))}},{key:"totalElements",get:function(){return this.elements().length}}]),e}(),h=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="publicSearch",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.PublicScoreSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.PublicScoreSection=h;var m=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="privateSearch",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.PrivateScoreSearchItem;return this.elements.push(t),t.name(e),t}},{key:"createForSaleElement",value:function(e){var t=new r.ForSaleSearchItem;return this.elements.push(t),t.name(e),t}},{key:"createPurchasedProductElement",value:function(e){var t=new r.PurchasedProductSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.PrivateHomeSection=m;var g=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="privateSearch",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.ForSaleSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.ForSaleSection=g;var b=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="privateSearch",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.PurchasedProductSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.PurchasedProductSection=b;var v=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="searchAllGroups",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.GroupSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.GroupSection=v;var y=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="publicMembersSearch",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.MemberSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.MemberSection=y;var _=function(e){function t(e){var o;return u(this,t),(o=a(this,s(t).call(this,e))).path="marketplaceSearchQuery",o}return l(t,f),p(t,[{key:"createElement",value:function(e){var t=new r.ProductSearchItem;return this.elements.push(t),t.name(e),t}}]),t}();t.ProductSection=_;var S=function(e){function t(e){return u(this,t),a(this,s(t).call(this,e))}return l(t,f),p(t,[{key:"searchInSection",value:function(){}}]),t}();t.ScoreEditorSection=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HelpItemHelpCenter=t.HelpItemUserGuide=t.HelpItemMenu=t.HelpItem=t.ProductSearchItem=t.MemberSearchItem=t.GroupSearchItem=t.PurchasedProductSearchItem=t.ForSaleSearchItem=t.PrivateScoreSearchItem=t.PublicScoreSearchItem=t.SearchItem=void 0;var r=o(5),n=o(1200),i=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),a=o(2),s=o(0),l=o(28),c=o(74);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,o){return t&&g(e.prototype,t),o&&g(e,o),e}var v=function(){function e(){var t=this;m(this,e),this.name=ko.observable(""),this.where=ko.observable(""),this.text=ko.computed(function(){return(0,l.escapeHtml)(t.name())+' <label class="resultsLocation standardLink">'+(0,l.escapeHtml)(t.where())+"</label>"}),this.selected=ko.observable(!1),this.type=ko.observable(""),this.disabled=ko.observable(!1),this.css=ko.computed(function(){return"searchItem-"+t.type()})}return b(e,[{key:"select",value:function(){this.selected(!0)}},{key:"unselect",value:function(){this.selected(!1)}},{key:"handleClick",value:function(){throw"not overwritten"}},{key:"handleMouseover",value:function(){}},{key:"sanitizeString",value:function(e){return encodeURIComponent(e)}}]),e}();t.SearchItem=v;var y=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("score"),e.where((0,s.resource)("content.inPublicScores")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.publicSearch({searchQuery:"keyword:"+this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_SCORE,{}),NF.appViewModel.searchViewModel().active(!1),NF.analytics.trackEvent("Search","public_score",this.sanitizeString(this.name()))}}]),t}();t.PublicScoreSearchItem=y;var _=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("score"),e.where((0,s.resource)("content.inYourScores")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.privateSearch({searchTarget:this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_SCORE,{}),NF.analytics.trackEvent("Search","private_score",this.sanitizeString(this.name()))}}]),t}();t.PrivateScoreSearchItem=_;var S=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("product"),e.where((0,s.resource)("content.inScoresForSale")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.privateMarketplaceSearch({searchTarget:this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_SCORE,{}),NF.analytics.trackEvent("Search","for_sale_product",this.sanitizeString(this.name()))}}]),t}();t.ForSaleSearchItem=S;var w=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("product"),e.where((0,s.resource)("content.inPurchasedScores")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.privatePurchasedSearch({searchTarget:this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_SCORE,{}),NF.analytics.trackEvent("Search","purchased_product",this.sanitizeString(this.name()))}}]),t}();t.PurchasedProductSearchItem=w;var k=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("group"),e.where((0,s.resource)("content.inGroups")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.searchAllGroups({searchTarget:this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_GROUP,{}),NF.analytics.trackEvent("Search","group",this.sanitizeString(this.name()))}}]),t}();t.GroupSearchItem=k;var E=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("member"),e.where((0,s.resource)("content.inMembers")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){(0,a.navigate)(NF.paths.publicMembersSearch({searchTarget:this.sanitizeString(this.name())})),i.default.publish(r.SEARCH_MEMBER,{}),NF.analytics.trackEvent("Search","member",this.sanitizeString(this.name()))}}]),t}();t.MemberSearchItem=E;var P=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this))).type("product"),e.where((0,s.resource)("content.inMarketplace")),e}return f(t,v),b(t,[{key:"handleClick",value:function(){var e="keyword:".concat(this.sanitizeString(this.name()));(0,a.navigate)(NF.paths.marketplaceSearchQuery({searchQuery:e})),i.default.publish(r.SEARCH_PRODUCT,{}),NF.analytics.trackEvent("Search","product",this.sanitizeString(this.name()))}}]),t}();t.ProductSearchItem=P;var C=function(e){function t(e,o,r){var n;return m(this,t),(n=d(this,p(t).call(this))).item=e,n.menuSection=o,n.scoreEditorModel=r,n.id=ko.observable(n.item?n.item.id():""),n.name=ko.observable(n.item?(0,s.resource)("palette."+n.item.id()):""),n.comparableName=(0,l.getStringToCompare)(n.name()),n.text=ko.computed(function(){return""}),n.type=ko.observable(),n.css=ko.observable(""),n.disabled=ko.observable(!1),n.menuSectionName=ko.observable(n.menuSection?(0,s.resource)("palette.section."+n.menuSection.id()):""),n.aliases=[],n.initialize(),n}return f(t,v),b(t,[{key:"matches",value:function(e){if(!this.id())return!1;var t=NF.getStringToCompare(e);if(-1!=this.comparableName.indexOf(t))return!0;for(var o=0;o<this.aliases.length;o++)if(-1!=this.aliases[o].indexOf(t))return!0;return!1}},{key:"createAliases",value:function(){var e=this;n.ALIASES[this.id()]&&$.each(n.ALIASES[this.id()],function(t,o){e.aliases.push(NF.getStringToCompare((0,s.resource)("palette.alias."+o)))})}},{key:"handleMouseover",value:function(){return!0}},{key:"closeCurrentMenu",value:function(){i.default.publish(r.SEARCH_EDITORHELP,{}),this.scoreEditorModel.customHeaderPalette().hideHelpPointer()}},{key:"closeAllMenus",value:function(){i.default.publish(r.SEARCH_EDITORHELP,{}),this.scoreEditorModel.customHeaderPalette().hideHelpPointer(),this.scoreEditorModel.customHeaderPalette().closeMenu()}},{key:"initialize",value:function(){this.createAliases()}}]),t}();t.HelpItem=C;var T=function(e){function t(e,o,r){var n;return m(this,t),(n=d(this,p(t).call(this,e,o,r))).type("paletteButton"),n.css=ko.computed(function(){return n.item.buttonImageCSS?"popupButtonImage "+n.item.buttonImageCSS():n.item.css()+" "+n.item.id()}),n.disabled=n.item.disabled,n.text=ko.computed(function(){var e=n.menuSectionName()+"<label class='resultsSeparator'> > </label>"+n.name();return n.item.shortcut()&&(e+=" <label class='shortcut'>("+n.item.shortcut()+")</label>"),e}),n}return f(t,C),b(t,[{key:"handleMouseover",value:function(){return this.scoreEditorModel.customHeaderPalette().showMenuItem(this,this.menuSection),NF.analytics.trackEvent("Search","editor_help_show_tooltip",this.name()),!0}},{key:"applyAction",value:function(){this.disabled()||(this.item.clicked(),n.DO_NOT_CLOSE_EDITOR_MENU[this.id()]?this.closeCurrentMenu():this.closeAllMenus(),NF.analytics.trackEvent("Search","editor_help_apply_action",this.name()))}},{key:"handleClick",value:function(){return this.applyAction(),!0}}]),t}();t.HelpItemMenu=T;var R=function(e){function t(e,o,r){var n;return m(this,t),(n=d(this,p(t).call(this,e,o,r))).type=ko.observable("userGuide"),n.css("userGuide"),n.text=ko.computed(function(){return n.name()+' <label class="resultsLocation standardLink">'+(0,s.resource)("content.inUserGuide")+"</label>"}),n}return f(t,C),b(t,[{key:"handleClick",value:function(){this.closeAllMenus();var e="/guide#action-"+this.id();return this.item.userGuideGroup&&(e="/guide#"+this.item.userGuideGroup()),window.open(e,"_blank"),NF.analytics.trackEvent("Search","editor_user_guide",this.name()),!0}}]),t}();t.HelpItemUserGuide=R;var O=function(e){function t(){var e;return m(this,t),(e=d(this,p(t).call(this,null,null,null))).text=ko.observable((0,s.resource)("content.findAnswersToQuestions")),e.type=ko.observable("helpCenter"),e.css=ko.observable("helpCenter"),e}return f(t,C),b(t,[{key:"handleClick",value:function(){return window.open(c.HELP_CENTER_LINK,"_blank"),NF.analytics.trackEvent("Search","editor_help_center"),!0}}]),t}();t.HelpItemHelpCenter=O},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(15);t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audioClip=t,this.startTime=ko.observable((0,r.roundNumber)(this.audioClip.trackStartTime,2)),this.endTime=ko.observable((0,r.roundNumber)(this.audioClip.trackEndTime,2))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),Noteflight.PalettePopupControl.call(e,"popupEditorHelp","popupEditorHelp","palette/editorHelp"),e.searchViewModel=ko.observable(new n.default(this.controller().scoreEditor)),e.initialize=function(){e.searchViewModel().initialize()},r.default.subscribe(i.SEARCH_EDITORHELP,function(t,o){e.hidePopup()})};var r=a(o(4)),n=a(o(1230)),i=o(5);function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(o(1237)),n=i(o(1239));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mixer=t,this.editor=o,this.part=r,this.controller=this.editor.controller,this.partName=ko.observable(),this.tracks=ko.observableArray([]),this.Score=$$nf.classes.com.noteflight.notation.model.Score}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"selectNoteflightTrack",value:function(){this.controller.document.undoHistory.openGroup("selectTrack"),this.controller.toggleNoteflightTrack(this.part)}},{key:"selectRecordingTrack",value:function(e){this.controller.document.undoHistory.openGroup("selectTrack"),this.controller.toggleTrack(e.track)}},{key:"deleteTrack",value:function(e){this.controller.document.undoHistory.openGroup("deleteTrack","deleteTrack"),this.controller.deleteTrack(e.track),2==this.tracks().length&&this.selectNoteflightTrack()}},{key:"removeMediaSync",value:function(){this.editor.removeMediaSync()}},{key:"editMediaSync",value:function(){this.editor.editMediaSync()}},{key:"toggleWaveform",value:function(){this.controller.toggleShowAudioWaveform(this.part)}},{key:"initializePartTrackItem",value:function(){this.tracks.push(new r.default(this));for(var e=this.part.recordedAudioTracks,t=0;t<e.length;t++)this.tracks.push(new n.default(this,e[t]))}}],[{key:"createPartTrackItem",value:function(t,o,r){var n=new e(t,o,r);return n.partName(r.nameToShow),n.initializePartTrackItem(),n}}]),e}();t.default=s},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,o){"use strict";o(343),o(391),o(4727),o(4739),o(4741),o(4743),o(4750),o(1608),o(234),o(59),o(5311),o(1609),o(1610),o(1611),o(1612),o(1613),o(1614),o(1615),o(1616),o(1617),o(1618),o(1619),o(1607),o(1620),o(1621),o(1622),o(1606)},function(e,t,o){"use strict";o(344),o(374),o(375),o(376),o(377),o(378)},function(e,t,o){"use strict";o(134),o(6),o(26),o(81),o(137),o(223),o(138),o(224),o(346),o(45),o(225),o(140),o(226),o(82),o(50),o(141),o(347),o(230),o(348),o(349),o(231),o(350),o(142),o(353),o(354),o(355),o(356),o(357),o(29),o(358),o(359),o(360),o(361),o(362),o(363),o(364),o(365),o(232),o(233),o(366),o(367),o(368),o(369),o(370),o(371),o(372);var r=function(e){return e&&e.__esModule?e:{default:e}}(o(105));o(373),window.hasher=r.default},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){return e.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):e(this[0].form)}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11)],void 0===(i="function"==typeof(r=function(e){"1.7"===e.fn.jquery.substring(0,3)&&(e.each(["Width","Height"],function(t,o){var r="Width"===o?["Left","Right"]:["Top","Bottom"],n=o.toLowerCase(),i={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function a(t,o,n,i){return e.each(r,function(){o-=parseFloat(e.css(t,"padding"+this))||0,n&&(o-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(o-=parseFloat(e.css(t,"margin"+this))||0)}),o}e.fn["inner"+o]=function(t){return void 0===t?i["inner"+o].call(this):this.each(function(){e(this).css(n,a(this,t)+"px")})},e.fn["outer"+o]=function(t,r){return"number"!=typeof t?i["outer"+o].call(this,t):this.each(function(){e(this).css(n,a(this,t,!0,r)+"px")})}}),e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(141),o(50),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,o=this.options,r=o.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(r)?r:function(e){return e.is(r)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},this._addToManager(o.scope),o.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t)},_setOption:function(t,o){if("accept"===t)this.accept=e.isFunction(o)?o:function(e){return e.is(o)};else if("scope"===t){var r=e.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(o)}this._super(t,o)},_activate:function(t){var o=e.ui.ddmanager.current;this._addActiveClass(),o&&this._trigger("activate",t,this.ui(o))},_deactivate:function(t){var o=e.ui.ddmanager.current;this._removeActiveClass(),o&&this._trigger("deactivate",t,this.ui(o))},_over:function(t){var o=e.ui.ddmanager.current;o&&(o.currentItem||o.element)[0]!==this.element[0]&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(o)))},_out:function(t){var o=e.ui.ddmanager.current;o&&(o.currentItem||o.element)[0]!==this.element[0]&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(o)))},_drop:function(o,r){var n=r||e.ui.ddmanager.current,i=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var r=e(this).droppable("instance");if(r.options.greedy&&!r.options.disabled&&r.options.scope===n.options.scope&&r.accept.call(r.element[0],n.currentItem||n.element)&&t(n,e.extend(r,{offset:r.element.offset()}),r.options.tolerance,o))return i=!0,!1}),!i&&!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",o,this.ui(n)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var t=e.ui.intersect=function(){function e(e,t,o){return e>=t&&e<t+o}return function(t,o,r,n){if(!o.offset)return!1;var i=(t.positionAbs||t.position.absolute).left+t.margins.left,a=(t.positionAbs||t.position.absolute).top+t.margins.top,s=i+t.helperProportions.width,l=a+t.helperProportions.height,c=o.offset.left,u=o.offset.top,d=c+o.proportions().width,p=u+o.proportions().height;switch(r){case"fit":return c<=i&&s<=d&&u<=a&&l<=p;case"intersect":return c<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<d&&u<a+t.helperProportions.height/2&&l-t.helperProportions.height/2<p;case"pointer":return e(n.pageY,u,o.proportions().height)&&e(n.pageX,c,o.proportions().width);case"touch":return(a>=u&&a<=p||l>=u&&l<=p||a<u&&l>p)&&(i>=c&&i<=d||s>=c&&s<=d||i<c&&s>d);default:return!1}}}();return e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,o){var r,n,i=e.ui.ddmanager.droppables[t.options.scope]||[],a=o?o.type:null,s=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;r<i.length;r++)if(!(i[r].options.disabled||t&&!i[r].accept.call(i[r].element[0],t.currentItem||t.element))){for(n=0;n<s.length;n++)if(s[n]===i[r].element[0]){i[r].proportions().height=0;continue e}i[r].visible="none"!==i[r].element.css("display"),i[r].visible&&("mousedown"===a&&i[r]._activate.call(i[r],o),i[r].offset=i[r].element.offset(),i[r].proportions({width:i[r].element[0].offsetWidth,height:i[r].element[0].offsetHeight}))}},drop:function(o,r){var n=!1;return e.each((e.ui.ddmanager.droppables[o.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t(o,this,this.options.tolerance,r)&&(n=this._drop.call(this,r)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,r)))}),n},dragStart:function(t,o){t.element.parentsUntil("body").on("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,o)})},drag:function(o,r){o.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(o,r),e.each(e.ui.ddmanager.droppables[o.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,i,a,s=t(o,this,this.options.tolerance,r),l=!s&&this.isover?"isout":s&&!this.isover?"isover":null;l&&(this.options.greedy&&(i=this.options.scope,(a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===i})).length&&((n=e(a[0]).droppable("instance")).greedyChild="isover"===l)),n&&"isover"===l&&(n.isover=!1,n.isout=!0,n._out.call(n,r)),this[l]=!0,this["isout"===l?"isover":"isout"]=!1,this["isover"===l?"_over":"_out"].call(this,r),n&&"isout"===l&&(n.isout=!1,n.isover=!0,n._over.call(n,r)))}})},dragStop:function(t,o){t.element.parentsUntil("body").off("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,o)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.ui.droppable})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(50),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.selectable",e.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t.elementPos=e(t.element[0]).offset(),t.selectees=e(t.options.filter,t.element[0]),t._addClass(t.selectees,"ui-selectee"),t.selectees.each(function(){var o=e(this),r=o.offset(),n={left:r.left-t.elementPos.left,top:r.top-t.elementPos.top};e.data(this,"selectable-item",{element:this,$element:o,left:n.left,top:n.top,right:n.left+o.outerWidth(),bottom:n.top+o.outerHeight(),startselected:!1,selected:o.hasClass("ui-selected"),selecting:o.hasClass("ui-selecting"),unselecting:o.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=e("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(t){var o=this,r=this.options;this.opos=[t.pageX,t.pageY],this.elementPos=e(this.element[0]).offset(),this.options.disabled||(this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||t.ctrlKey||(o._removeClass(r.$element,"ui-selected"),r.selected=!1,o._addClass(r.$element,"ui-unselecting"),r.unselecting=!0,o._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().addBack().each(function(){var r,n=e.data(this,"selectable-item");if(n)return r=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),o._removeClass(n.$element,r?"ui-unselecting":"ui-selected")._addClass(n.$element,r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?o._trigger("selecting",t,{selecting:n.element}):o._trigger("unselecting",t,{unselecting:n.element}),!1}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var o,r=this,n=this.options,i=this.opos[0],a=this.opos[1],s=t.pageX,l=t.pageY;return i>s&&(o=s,s=i,i=o),a>l&&(o=l,l=a,a=o),this.helper.css({left:i,top:a,width:s-i,height:l-a}),this.selectees.each(function(){var o=e.data(this,"selectable-item"),c=!1,u={};o&&o.element!==r.element[0]&&(u.left=o.left+r.elementPos.left,u.right=o.right+r.elementPos.left,u.top=o.top+r.elementPos.top,u.bottom=o.bottom+r.elementPos.top,"touch"===n.tolerance?c=!(u.left>s||u.right<i||u.top>l||u.bottom<a):"fit"===n.tolerance&&(c=u.left>i&&u.right<s&&u.top>a&&u.bottom<l),c?(o.selected&&(r._removeClass(o.$element,"ui-selected"),o.selected=!1),o.unselecting&&(r._removeClass(o.$element,"ui-unselecting"),o.unselecting=!1),o.selecting||(r._addClass(o.$element,"ui-selecting"),o.selecting=!0,r._trigger("selecting",t,{selecting:o.element}))):(o.selecting&&((t.metaKey||t.ctrlKey)&&o.startselected?(r._removeClass(o.$element,"ui-selecting"),o.selecting=!1,r._addClass(o.$element,"ui-selected"),o.selected=!0):(r._removeClass(o.$element,"ui-selecting"),o.selecting=!1,o.startselected&&(r._addClass(o.$element,"ui-unselecting"),o.unselecting=!0),r._trigger("unselecting",t,{unselecting:o.element}))),o.selected&&(t.metaKey||t.ctrlKey||o.startselected||(r._removeClass(o.$element,"ui-selected"),o.selected=!1,r._addClass(o.$element,"ui-unselecting"),o.unselecting=!0,r._trigger("unselecting",t,{unselecting:o.element})))))}),!1}},_mouseStop:function(t){var o=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");o._removeClass(r.$element,"ui-unselecting"),r.unselecting=!1,r.startselected=!1,o._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");o._removeClass(r.$element,"ui-selecting")._addClass(r.$element,"ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,o._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(50),o(137),o(227),o(140),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,o){return e>=t&&e<t+o},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,o){var r=null,n=!1,i=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,i.widgetName+"-item")===i)return r=e(this),!1}),e.data(t.target,i.widgetName+"-item")===i&&(r=e(t.target)),!r||this.options.handle&&!o&&(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(n=!0)}),!n)||(this.currentItem=r,this._removeCurrentsFromItems(),0)))},_mouseStart:function(t,o,r){var n,i,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(i=this.document.find("body"),this.storedCursor=i.css("cursor"),i.css("cursor",a.cursor),this.storedStylesheet=e("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(i)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var o,r,n,i,a=this.options,s=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+a.scrollSpeed:t.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+a.scrollSpeed:t.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(t.pageY-this.document.scrollTop()<a.scrollSensitivity?s=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<a.scrollSensitivity&&(s=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),t.pageX-this.document.scrollLeft()<a.scrollSensitivity?s=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(s=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),!1!==s&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),o=this.items.length-1;o>=0;o--)if(r=this.items[o],n=r.item[0],(i=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&!(n===this.currentItem[0]||this.placeholder[1===i?"next":"prev"]()[0]===n||e.contains(this.placeholder[0],n)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],n))){if(this.direction=1===i?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,o){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,n=this.placeholder.offset(),i=this.options.axis,a={};i&&"x"!==i||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),i&&"y"!==i||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,o);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var o=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(o).each(function(){var o=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);o&&r.push((t.key||o[1]+"[]")+"="+(t.key&&t.expression?o[1]:o[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var o=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},o.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,o=t+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,i=e.left,a=i+e.width,s=e.top,l=s+e.height,c=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||r+c>s&&r+c<l,p="y"===this.options.axis||t+u>i&&t+u<a,f=d&&p;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?f:i<t+this.helperProportions.width/2&&o-this.helperProportions.width/2<a&&s<r+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t,o,r="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=r&&n;return!!i&&(t=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection(),this.floating?"right"===o||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),o=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&o||"left"===n&&!o:r&&("down"===r&&t||"up"===r&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var o,r,n,i,a=[],s=[],l=this._connectWith();if(l&&t)for(o=l.length-1;o>=0;o--)for(n=e(l[o],this.document[0]),r=n.length-1;r>=0;r--)(i=e.data(n[r],this.widgetFullName))&&i!==this&&!i.options.disabled&&s.push([e.isFunction(i.options.items)?i.options.items.call(i.element):e(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i]);function c(){a.push(this)}for(s.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),o=s.length-1;o>=0;o--)s[o][0].each(c);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var o=0;o<t.length;o++)if(t[o]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var o,r,n,i,a,s,l,c,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],p=this._connectWith();if(p&&this.ready)for(o=p.length-1;o>=0;o--)for(n=e(p[o],this.document[0]),r=n.length-1;r>=0;r--)(i=e.data(n[r],this.widgetFullName))&&i!==this&&!i.options.disabled&&(d.push([e.isFunction(i.options.items)?i.options.items.call(i.element[0],t,{item:this.currentItem}):e(i.options.items,i.element),i]),this.containers.push(i));for(o=d.length-1;o>=0;o--)for(a=d[o][1],s=d[o][0],r=0,c=s.length;r<c;r++)(l=e(s[r])).data(this.widgetName+"-item",a),u.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var o,r,n,i;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),o=this.items.length-1;o>=0;o--)(r=this.items[o]).instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=n.outerWidth(),r.height=n.outerHeight()),i=n.offset(),r.left=i.left,r.top=i.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(o=this.containers.length-1;o>=0;o--)i=this.containers[o].element.offset(),this.containers[o].containerCache.left=i.left,this.containers[o].containerCache.top=i.top,this.containers[o].containerCache.width=this.containers[o].element.outerWidth(),this.containers[o].containerCache.height=this.containers[o].element.outerHeight();return this},_createPlaceholder:function(t){var o,r=(t=t||this).options;r.placeholder&&r.placeholder.constructor!==String||(o=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+r+">",t.document[0]);return t._addClass(n,"ui-sortable-placeholder",o||t.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===r?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===r?t._createTrPlaceholder(t.currentItem,n):"img"===r&&n.attr("src",t.currentItem.attr("src")),o||n.css("visibility","hidden"),n},update:function(e,n){o&&!r.forcePlaceholderSize||(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,o){var r=this;t.children().each(function(){e("<td>&#160;</td>",r.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(o)})},_contactContainers:function(t){var o,r,n,i,a,s,l,c,u,d,p=null,f=null;for(o=this.containers.length-1;o>=0;o--)if(!e.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(p&&e.contains(this.containers[o].element[0],p.element[0]))continue;p=this.containers[o],f=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",t,this._uiHash(this)),this.containers[o].containerCache.over=0);if(p)if(1===this.containers.length)this.containers[f].containerCache.over||(this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1);else{for(n=1e4,i=null,u=p.floating||this._isFloating(this.currentItem),a=u?"left":"top",s=u?"width":"height",d=u?"pageX":"pageY",r=this.items.length-1;r>=0;r--)e.contains(this.containers[f].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(l=this.items[r].item.offset()[a],c=!1,t[d]-l>this.items[r][s]/2&&(c=!0),Math.abs(t[d]-l)<n&&(n=Math.abs(t[d]-l),i=this.items[r],this.direction=c?"up":"down"));if(!i&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[f])return void(this.currentContainer.containerCache.over||(this.containers[f]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));i?this._rearrange(t,i,null,!0):this._rearrange(t,null,this.containers[f].element,!0),this._trigger("change",t,this._uiHash()),this.containers[f]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[f],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1}},_createHelper:function(t){var o=this.options,r=e.isFunction(o.helper)?e(o.helper.apply(this.element[0],[t,this.currentItem])):"clone"===o.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),r[0].style.width&&!o.forceHelperSize||r.width(this.currentItem.width()),r[0].style.height&&!o.forceHelperSize||r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,o,r,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],o=e(n.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[o.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,o.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,o.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,o.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,o){o||(o=this.position);var r="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(n[0].tagName);return{top:o.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:n.scrollTop())*r,left:o.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:n.scrollLeft())*r}},_generatePosition:function(t){var o,r,n=this.options,i=t.pageX,a=t.pageY,s="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(s[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(i=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(i=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(o=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?o-this.offset.click.top>=this.containment[1]&&o-this.offset.click.top<=this.containment[3]?o:o-this.offset.click.top>=this.containment[1]?o-n.grid[1]:o+n.grid[1]:o,r=this.originalPageX+Math.round((i-this.originalPageX)/n.grid[0])*n.grid[0],i=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-n.grid[0]:r+n.grid[0]:r)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:s.scrollTop()),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:s.scrollLeft())}},_rearrange:function(e,t,o,r){o?o[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var o,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(o in this._storedCSS)"auto"!==this._storedCSS[o]&&"static"!==this._storedCSS[o]||(this._storedCSS[o]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();function n(e,t,o){return function(r){o._trigger(e,r,t._uiHash(t))}}for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),o=this.containers.length-1;o>=0;o--)t||r.push(n("deactivate",this,this.containers[o])),this.containers[o].containerCache.over&&(r.push(n("out",this,this.containers[o])),this.containers[o].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(o=0;o<r.length;o++)r[o].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var o=t||this;return{helper:o.helper,placeholder:o.placeholder||e([]),position:o.position,originalPosition:o.originalPosition,offset:o.positionAbs,item:o.currentItem,sender:t?t.element:null}}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(231),o(45),o(81),o(63),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,o,r,n=this.element[0].nodeName.toLowerCase(),i="textarea"===n,a="input"===n;this.isMultiLine=i||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[i||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,r=!0,void(o=!0);t=!1,r=!1,o=!1;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t=!0,this._move("previousPage",n);break;case i.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case i.UP:t=!0,this._keyEvent("previous",n);break;case i.DOWN:t=!0,this._keyEvent("next",n);break;case i.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case i.TAB:this.menu.active&&this.menu.select(n);break;case i.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:o=!0,this._searchTimeout(n)}},keypress:function(r){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||r.preventDefault());if(!o){var n=e.ui.keyCode;switch(r.keyCode){case n.PAGE_UP:this._move("previousPage",r);break;case n.PAGE_DOWN:this._move("nextPage",r);break;case n.UP:this._keyEvent("previous",r);break;case n.DOWN:this._keyEvent("next",r)}}},input:function(e){if(r)return r=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=e("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==e.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(t,o){var r,n;if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});n=o.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),(r=o.item.attr("aria-label")||n.value)&&e.trim(r).length&&(this.liveRegion.children().hide(),e("<div>").text(r).appendTo(this.liveRegion))},menuselect:function(t,o){var r=o.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=r})),!1!==this._trigger("select",t,{item:r})&&this._value(r.value),this.term=this._value(),this.close(t),this.selectedItem=r}}),this.liveRegion=e("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(t){var o=this.menu.element[0];return t.target===this.element[0]||t.target===o||e.contains(o,t.target)},_closeOnClickOutside:function(e){this._isEventTargetInWidget(e)||this.close()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,o,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(o,r){r(e.ui.autocomplete.filter(t,o.term))}):"string"==typeof this.options.source?(o=this.options.source,this.source=function(t,n){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:o,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),o=this.menu.element.is(":visible"),r=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;t&&(!t||o||r)||(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var o=this.menu.element.empty();this._renderMenu(o,t),this.isNewMenu=!0,this.menu.refresh(),o.show(),this._resizeMenu(),o.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,o){var r=this;e.each(o,function(e,o){r._renderItemData(t,o)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,o){return e("<li>").append(e("<div>").text(o.label)).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())},_isContentEditable:function(e){if(!e.length)return!1;var t=e.prop("contentEditable");return"inherit"===t?this._isContentEditable(e.parent()):"true"===t}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,o){var r=new RegExp(e.ui.autocomplete.escapeRegex(o),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var o;this._superApply(arguments),this.options.disabled||this.cancelSearch||(o=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(o).appendTo(this.liveRegion))}}),e.ui.autocomplete})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(26)],void 0===(i="function"==typeof(r=function(e){var t=/ui-corner-([a-z]){2,6}/g;return e.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var t=this,o=[];e.each(this.options.items,function(r,n){var i,a={};if(n)return"controlgroupLabel"===r?((i=t.element.find(n)).each(function(){var t=e(this);t.children(".ui-controlgroup-label-contents").length||t.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),t._addClass(i,null,"ui-widget ui-widget-content ui-state-default"),void(o=o.concat(i.get()))):void(e.fn[r]&&(a=t["_"+r+"Options"]?t["_"+r+"Options"]("middle"):{classes:{}},t.element.find(n).each(function(){var n=e(this),i=n[r]("instance"),s=e.widget.extend({},a);if("button"!==r||!n.parent(".ui-spinner").length){i||(i=n[r]()[r]("instance")),i&&(s.classes=t._resolveClassesValues(s.classes,i)),n[r](s);var l=n[r]("widget");e.data(l[0],"ui-controlgroup-data",i||n[r]("instance")),o.push(l[0])}})))}),this.childWidgets=e(e.unique(o)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(t){this.childWidgets.each(function(){var o=e(this),r=o.data("ui-controlgroup-data");r&&r[t]&&r[t]()})},_updateCornerClass:function(e,t){var o=this._buildSimpleOptions(t,"label").classes.label;this._removeClass(e,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(e,null,o)},_buildSimpleOptions:function(e,t){var o="vertical"===this.options.direction,r={classes:{}};return r.classes[t]={middle:"",first:"ui-corner-"+(o?"top":"left"),last:"ui-corner-"+(o?"bottom":"right"),only:"ui-corner-all"}[e],r},_spinnerOptions:function(e){var t=this._buildSimpleOptions(e,"ui-spinner");return t.classes["ui-spinner-up"]="",t.classes["ui-spinner-down"]="",t},_buttonOptions:function(e){return this._buildSimpleOptions(e,"ui-button")},_checkboxradioOptions:function(e){return this._buildSimpleOptions(e,"ui-checkboxradio-label")},_selectmenuOptions:function(e){var t="vertical"===this.options.direction;return{width:!!t&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(t?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(t?"top":"left")},last:{"ui-selectmenu-button-open":t?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(t?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[e]}},_resolveClassesValues:function(o,r){var n={};return e.each(o,function(i){var a=r.options.classes[i]||"";a=e.trim(a.replace(t,"")),n[i]=(a+" "+o[i]).replace(/\s+/g," ")}),n},_setOption:function(e,t){"direction"===e&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(e,t),"disabled"!==e?this.refresh():this._callChildMethod(t?"disable":"enable")},refresh:function(){var t,o=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),t=this.childWidgets,this.options.onlyVisible&&(t=t.filter(":visible")),t.length&&(e.each(["first","last"],function(e,r){var n=t[r]().data("ui-controlgroup-data");if(n&&o["_"+n.widgetName+"Options"]){var i=o["_"+n.widgetName+"Options"](1===t.length?"only":r);i.classes=o._resolveClassesValues(i.classes,n),n.element[n.widgetName](i)}else o._updateCornerClass(t[r](),r)}),this._callChildMethod("refresh"))}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(139),o(224),o(225),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.checkboxradio",[e.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var t,o,r=this,n=this._super()||{};return this._readType(),o=this.element.labels(),this.label=e(o[o.length-1]),this.label.length||e.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){r.originalLabel+=3===this.nodeType?e(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),null!=(t=this.element[0].disabled)&&(n.disabled=t),n},_create:function(){var e=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),e&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var t=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===t&&/radio|checkbox/.test(this.type)||e.error("Can't create checkboxradio on element.nodeName="+t+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var t=this.element[0].name,o="input[name='"+e.ui.escapeSelector(t)+"']";return t?(this.form.length?e(this.form[0].elements).filter(o):e(o).filter(function(){return 0===e(this).form().length})).not(this.element):e([])},_toggleClasses:function(){var t=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",t)._toggleClass(this.icon,null,"ui-icon-blank",!t),"radio"===this.type&&this._getRadioGroup().each(function(){var t=e(this).checkboxradio("instance");t&&t._removeClass(t.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(e,t){if("label"!==e||t){if(this._super(e,t),"disabled"===e)return this._toggleClass(this.label,null,"ui-state-disabled",t),void(this.element[0].disabled=t);this.refresh()}},_updateIcon:function(t){var o="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=e("<span>"),this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(o+=t?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,t?"ui-icon-blank":"ui-icon-check")):o+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",o),t||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var e=this.label.contents().not(this.element[0]);this.icon&&(e=e.not(this.icon[0])),this.iconSpace&&(e=e.not(this.iconSpace[0])),e.remove(),this.label.append(this.options.label)},refresh:function(){var e=this.element[0].checked,t=this.element[0].disabled;this._updateIcon(e),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),null!==this.options.label&&this._updateLabel(),t!==this.options.disabled&&this._setOptions({disabled:t})}}]),e.ui.checkboxradio})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(142),o(141),o(50),o(230),o(138),o(45),o(81),o(63),o(229),o(226),o(82),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var o=e(this).css(t).offset().top;o<0&&e(this).css("top",t.top-o)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var o=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||e.ui.safeBlur(e.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){o._trigger("close",t)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,o){var r=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),i=Math.max.apply(null,n);return i>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",i+1),r=!0),r&&!o&&this._trigger("focus",t),r},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(e.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).trigger("focus")},_keepFocus:function(t){function o(){var t=e.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),o.call(this),this._delay(o)},_createWrapper:function(){this.uiDialog=e("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var o=this.uiDialog.find(":tabbable"),r=o.filter(":first"),n=o.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==r[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.trigger("focus")}),t.preventDefault()):(this._delay(function(){r.trigger("focus")}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:e("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(t,"ui-dialog-title"),this._title(t),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title?e.text(this.options.title):e.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var t=this,o=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(o)||e.isArray(o)&&!o.length?this._removeClass(this.uiDialog,"ui-dialog-buttons"):(e.each(o,function(o,r){var n,i;r=e.isFunction(r)?{click:r,text:o}:r,r=e.extend({type:"button"},r),n=r.click,i={icon:r.icon,iconPosition:r.iconPosition,showLabel:r.showLabel,icons:r.icons,text:r.text},delete r.click,delete r.icon,delete r.iconPosition,delete r.showLabel,delete r.icons,"boolean"==typeof r.text&&delete r.text,e("<button></button>",r).button(i).appendTo(t.uiButtonSet).on("click",function(){n.apply(t.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,o=this.options;function r(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(o,n){t._addClass(e(this),"ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",o,r(n))},drag:function(e,o){t._trigger("drag",e,r(o))},stop:function(n,i){var a=i.offset.left-t.document.scrollLeft(),s=i.offset.top-t.document.scrollTop();o.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(s>=0?"+":"")+s,of:t.window},t._removeClass(e(this),"ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",n,r(i))}})},_makeResizable:function(){var t=this,o=this.options,r=o.resizable,n=this.uiDialog.css("position"),i="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";function a(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:o.maxWidth,maxHeight:o.maxHeight,minWidth:o.minWidth,minHeight:this._minHeight(),handles:i,start:function(o,r){t._addClass(e(this),"ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",o,a(r))},resize:function(e,o){t._trigger("resize",e,a(o))},stop:function(r,n){var i=t.uiDialog.offset(),s=i.left-t.document.scrollLeft(),l=i.top-t.document.scrollTop();o.height=t.uiDialog.height(),o.width=t.uiDialog.width(),o.position={my:"left top",at:"left"+(s>=0?"+":"")+s+" top"+(l>=0?"+":"")+l,of:t.window},t._removeClass(e(this),"ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",r,a(n))}}).css("position",n)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),o=e.inArray(this,t);-1!==o&&t.splice(o,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var o=this,r=!1,n={};e.each(t,function(e,t){o._setOption(e,t),e in o.sizeRelatedOptions&&(r=!0),e in o.resizableRelatedOptions&&(n[e]=t)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(t,o){var r,n,i=this.uiDialog;"disabled"!==t&&(this._super(t,o),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:e("<a>").text(""+this.options.closeText).html()}),"draggable"===t&&((r=i.is(":data(ui-draggable)"))&&!o&&i.draggable("destroy"),!r&&o&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&((n=i.is(":data(ui-resizable)"))&&!o&&i.resizable("destroy"),n&&"string"==typeof o&&i.resizable("option","handles",o),n||!1===o||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,o,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),o="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-e):"none","auto"===r.height?this.element.css({minHeight:t,maxHeight:o,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(e,t){"dialogClass"===e&&this.uiDialog.removeClass(this.options.dialogClass).addClass(t),this._superApply(arguments)}}),e.ui.dialog})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(50),o(45),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.slider",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,o,r=this.options,n=this.element.find(".ui-slider-handle"),i=[];for(o=r.values&&r.values.length||1,n.length>o&&(n.slice(o).remove(),n=n.slice(0,o)),t=n.length;t<o;t++)i.push("<span tabindex='0'></span>");this.handles=n.add(e(i.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t).attr("tabIndex",0)})},_createRange:function(){var t=this.options;t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=e("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==t.range&&"max"!==t.range||this._addClass(this.range,"ui-slider-range-"+t.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(t){var o,r,n,i,a,s,l,c=this,u=this.options;return!u.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),o={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(o),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var o=Math.abs(r-c.values(t));(n>o||n===o&&(t===c._lastChangedValue||c.values(t)===u.min))&&(n=o,i=e(this),a=t)}),!1!==this._start(t,a)&&(this._mouseSliding=!0,this._handleIndex=a,this._addClass(i,null,"ui-state-active"),i.trigger("focus"),s=i.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-s.left-i.width()/2,top:t.pageY-s.top-i.height()/2-(parseInt(i.css("borderTopWidth"),10)||0)-(parseInt(i.css("borderBottomWidth"),10)||0)+(parseInt(i.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,a,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},o=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,o),!1},_mouseStop:function(e){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,o,r,n,i;return"horizontal"===this.orientation?(t=this.elementSize.width,o=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,o=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(r=o/t)>1&&(r=1),r<0&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),i=this._valueMin()+r*n,this._trimAlignValue(i)},_uiHash:function(e,t,o){var r={handle:this.handles[e],handleIndex:e,value:void 0!==t?t:this.value()};return this._hasMultipleValues()&&(r.value=void 0!==t?t:this.values(e),r.values=o||this.values()),r},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(e,t){return this._trigger("start",e,this._uiHash(t))},_slide:function(e,t,o){var r,n=this.value(),i=this.values();this._hasMultipleValues()&&(r=this.values(t?0:1),n=this.values(t),2===this.options.values.length&&!0===this.options.range&&(o=0===t?Math.min(r,o):Math.max(r,o)),i[t]=o),o!==n&&!1!==this._trigger("slide",e,this._uiHash(t,o,i))&&(this._hasMultipleValues()?this.values(t,o):this.value(o))},_stop:function(e,t){this._trigger("stop",e,this._uiHash(t))},_change:function(e,t){this._keySliding||this._mouseSliding||(this._lastChangedValue=t,this._trigger("change",e,this._uiHash(t)))},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,o){var r,n,i;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(o),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this._hasMultipleValues()?this._values(t):this.value();for(r=this.options.values,n=arguments[0],i=0;i<r.length;i+=1)r[i]=this._trimAlignValue(n[i]),this._change(null,i);this._refreshValue()},_setOption:function(t,o){var r,n=0;switch("range"===t&&!0===this.options.range&&("min"===o?(this.options.value=this._values(0),this.options.values=null):"max"===o&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),this._super(t,o),t){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(o),this.handles.css("horizontal"===o?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=n-1;r>=0;r--)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(e){this._super(e),this._toggleClass(null,"ui-state-disabled",!!e)},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,o,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this._hasMultipleValues()){for(o=this.options.values.slice(),r=0;r<o.length;r+=1)o[r]=this._trimAlignValue(o[r]);return o}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,o=(e-this._valueMin())%t,r=e-o;return 2*Math.abs(o)>=t&&(r+=o>0?t:-t),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),o=this.options.step,r=Math.round((e-t)/o)*o;(e=r+t)>this.options.max&&(e-=o),this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),o=t.indexOf(".");return-1===o?0:t.length-o-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(e){"vertical"===e&&this.range.css({width:"",left:""}),"horizontal"===e&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var t,o,r,n,i,a=this.options.range,s=this.options,l=this,c=!this._animateOff&&s.animate,u={};this._hasMultipleValues()?this.handles.each(function(r){o=(l.values(r)-l._valueMin())/(l._valueMax()-l._valueMin())*100,u["horizontal"===l.orientation?"left":"bottom"]=o+"%",e(this).stop(1,1)[c?"animate":"css"](u,s.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===r&&l.range.stop(1,1)[c?"animate":"css"]({left:o+"%"},s.animate),1===r&&l.range[c?"animate":"css"]({width:o-t+"%"},{queue:!1,duration:s.animate})):(0===r&&l.range.stop(1,1)[c?"animate":"css"]({bottom:o+"%"},s.animate),1===r&&l.range[c?"animate":"css"]({height:o-t+"%"},{queue:!1,duration:s.animate}))),t=o}):(r=this.value(),n=this._valueMin(),i=this._valueMax(),o=i!==n?(r-n)/(i-n)*100:0,u["horizontal"===this.orientation?"left":"bottom"]=o+"%",this.handle.stop(1,1)[c?"animate":"css"](u,s.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:o+"%"},s.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:100-o+"%"},s.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:o+"%"},s.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:100-o+"%"},s.animate))},_handleEvents:{keydown:function(t){var o,r,n,i=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(e(t.target),null,"ui-state-active"),!1===this._start(t,i)))return}switch(n=this.options.step,o=r=this._hasMultipleValues()?this.values(i):this.value(),t.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(o+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(o-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===this._valueMax())return;r=this._trimAlignValue(o+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===this._valueMin())return;r=this._trimAlignValue(o-n)}this._slide(t,i,r)},keyup:function(t){var o=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,o),this._change(t,o),this._removeClass(e(t.target),null,"ui-state-active"))}}})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(142),o(11),o(45),o(63),o(26)],void 0===(i="function"==typeof(r=function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}return e.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t=this._super(),o=this.element;return e.each(["min","max","step"],function(e,r){var n=o.attr(r);null!=n&&n.length&&(t[r]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){var o;function r(){this.element[0]===e.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=o,this._delay(function(){this.previous=o}))}o=this.element[0]===e.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),t.preventDefault(),r.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,r.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(t){var o=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,o.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-o.page,t),!0}return!1},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(e,t,o){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,o)},e),this._spin(t*this.options.step,o)},_spin:function(e,t){var o=this.value()||0;this.counter||(this.counter=1),o=this._adjustValue(o+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:o})||(this._value(o),this.counter++)},_increment:function(t){var o=this.options.incremental;return o?e.isFunction(o)?o(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),o=t.indexOf(".");return-1===o?0:t.length-o-1},_adjustValue:function(e){var t,o,r=this.options;return o=e-(t=null!==r.min?r.min:0),e=t+(o=Math.round(o/r.step)*r.step),e=parseFloat(e.toFixed(this._precision())),null!==r.max&&e>r.max?r.max:null!==r.min&&e<r.min?r.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){var o,r,n;if("culture"===e||"numberFormat"===e)return o=this._parse(this.element.val()),this.options[e]=t,void this.element.val(this._format(o));"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(r=this.buttons.first().find(".ui-icon"),this._removeClass(r,null,this.options.icons.up),this._addClass(r,null,t.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,t.down)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable")},_setOptions:t(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var o;""!==e&&null!==(o=this._parse(e))&&(t||(o=this._adjustValue(o)),e=this._format(o)),this.element.val(e),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}}),!1!==e.uiBackCompat&&e.widget("ui.spinner",e.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),e.ui.spinner})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(139),o(45),o(63),o(82),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var o,r;o=t.href.replace(e,""),r=location.href.replace(e,"");try{o=decodeURIComponent(o)}catch(e){}try{r=decodeURIComponent(r)}catch(e){}return t.hash.length>1&&o===r}}(),_create:function(){var t=this,o=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,o.collapsible),this._processTabs(),o.active=this._initialActive(),e.isArray(o.disabled)&&(o.disabled=e.unique(o.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(o.active):this.active=e(),this._refresh(),this.active.length&&this.load(o.active)},_initialActive:function(){var t=this.options.active,o=this.options.collapsible,r=location.hash.substring(1);return null===t&&(r&&this.tabs.each(function(o,n){if(e(n).attr("aria-controls")===r)return t=o,!1}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&-1!==t||(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!o&&0),!o&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var o=e(e.ui.safeActiveElement(this.document[0])).closest("li"),r=this.tabs.index(o),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r!==this.options.active&&r);default:return}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,n),t.ctrlKey||t.metaKey||(o.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,o){for(var r=this.tabs.length-1;-1!==e.inArray((t>r&&(t=0),t<0&&(t=r),t),this.options.disabled);)t=o?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).trigger("focus"),e},_setOption:function(e,t){"active"!==e?(this._super(e,t),"collapsible"===e&&(this._toggleClass("ui-tabs-collapsible",null,t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._activate(t)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,o=this.tablist.children(":has(a[href])");t.disabled=e.map(o.filter(".ui-state-disabled"),function(e){return o.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,o=this.tabs,r=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=e(),this.anchors.each(function(o,r){var n,i,a,s=e(r).uniqueId().attr("id"),l=e(r).closest("li"),c=l.attr("aria-controls");t._isLocal(r)?(a=(n=r.hash).substring(1),i=t.element.find(t._sanitizeSelector(n))):(n="#"+(a=l.attr("aria-controls")||e({}).uniqueId()[0].id),(i=t.element.find(n)).length||(i=t._createPanel(a)).insertAfter(t.panels[o-1]||t.tablist),i.attr("aria-live","polite")),i.length&&(t.panels=t.panels.add(i)),c&&l.data("ui-tabs-aria-controls",c),l.attr({"aria-controls":a,"aria-labelledby":s}),i.attr("aria-labelledby",s)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),o&&(this._off(o.not(this.tabs)),this._off(r.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(t){var o,r,n;for(e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1),n=0;r=this.tabs[n];n++)o=e(r),!0===t||-1!==e.inArray(n,t)?(o.attr("aria-disabled","true"),this._addClass(o,null,"ui-state-disabled")):(o.removeAttr("aria-disabled"),this._removeClass(o,null,"ui-state-disabled"));this.options.disabled=t,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===t)},_setupEvents:function(t){var o={};t&&e.each(t.split(" "),function(e,t){o[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,o),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var o,r=this.element.parent();"fill"===t?(o=r.height(),o-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");"absolute"!==r&&"fixed"!==r&&(o-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){o-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,o-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(o=0,this.panels.each(function(){o=Math.max(o,e(this).height("").height())}).height(o))},_eventHandler:function(t){var o=this.options,r=this.active,n=e(t.currentTarget).closest("li"),i=n[0]===r[0],a=i&&o.collapsible,s=a?e():this._getPanelForTab(n),l=r.length?this._getPanelForTab(r):e(),c={oldTab:r,oldPanel:l,newTab:a?e():n,newPanel:s};t.preventDefault(),n.hasClass("ui-state-disabled")||n.hasClass("ui-tabs-loading")||this.running||i&&!o.collapsible||!1===this._trigger("beforeActivate",t,c)||(o.active=!a&&this.tabs.index(n),this.active=i?e():n,this.xhr&&this.xhr.abort(),l.length||s.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),s.length&&this.load(this.tabs.index(n),t),this._toggle(t,c))},_toggle:function(t,o){var r=this,n=o.newPanel,i=o.oldPanel;function a(){r.running=!1,r._trigger("activate",t,o)}function s(){r._addClass(o.newTab.closest("li"),"ui-tabs-active","ui-state-active"),n.length&&r.options.show?r._show(n,r.options.show,a):(n.show(),a())}this.running=!0,i.length&&this.options.hide?this._hide(i,this.options.hide,function(){r._removeClass(o.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),s()}):(this._removeClass(o.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),i.hide(),s()),i.attr("aria-hidden","true"),o.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),n.length&&i.length?o.oldTab.attr("tabIndex",-1):n.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),n.attr("aria-hidden","false"),o.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var o,r=this._findActive(t);r[0]!==this.active[0]&&(r.length||(r=this.active),o=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:o,currentTarget:o,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+e.ui.escapeSelector(t)+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var t=e(this),o=t.data("ui-tabs-aria-controls");o?t.attr("aria-controls",o).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var o=this.options.disabled;!1!==o&&(void 0===t?o=!1:(t=this._getIndex(t),o=e.isArray(o)?e.map(o,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,o){return o!==t?o:null})),this._setOptionDisabled(o))},disable:function(t){var o=this.options.disabled;if(!0!==o){if(void 0===t)o=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,o))return;o=e.isArray(o)?e.merge([t],o).sort():[t]}this._setOptionDisabled(o)}},load:function(t,o){t=this._getIndex(t);var r=this,n=this.tabs.eq(t),i=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),s={tab:n,panel:a},l=function(e,t){"abort"===t&&r.panels.stop(!1,!0),r._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr};this._isLocal(i[0])||(this.xhr=e.ajax(this._ajaxSettings(i,o,s)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){a.html(e),r._trigger("load",o,s),l(n,t)},1)}).fail(function(e,t){setTimeout(function(){l(e,t)},1)})))},_ajaxSettings:function(t,o,r){var n=this;return{url:t.attr("href").replace(/#.*$/,""),beforeSend:function(t,i){return n._trigger("beforeLoad",o,e.extend({jqXHR:t,ajaxSettings:i},r))}}},_getPanelForTab:function(t){var o=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+o))}}),!1!==e.uiBackCompat&&e.widget("ui.tabs",e.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),e.ui.tabs})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(45),o(81),o(82),o(11),o(26)],void 0===(i="function"==typeof(r=function(e){return e.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(t,o){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(o),t.data("ui-tooltip-id",o).attr("aria-describedby",e.trim(r.join(" ")))},_removeDescribedBy:function(t){var o=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(o,r);-1!==n&&r.splice(n,1),t.removeData("ui-tooltip-id"),(r=e.trim(r.join(" ")))?t.attr("aria-describedby",r):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=e([])},_setOption:function(t,o){var r=this;this._super(t,o),"content"===t&&e.each(this.tooltips,function(e,t){r._updateContent(t.element)})},_setOptionDisabled:function(e){this[e?"_disable":"_enable"]()},_disable:function(){var t=this;e.each(this.tooltips,function(o,r){var n=e.Event("blur");n.target=n.currentTarget=r.element[0],t.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var t=e(this);if(t.is("[title]"))return t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}),this.disabledTitles=e([])},open:function(t){var o=this,r=e(t?t.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&r.parents().each(function(){var t,r=e(this);r.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,o.close(t,!0)),r.attr("title")&&(r.uniqueId(),o.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))}),this._registerCloseHandlers(t,r),this._updateContent(r,t))},_updateContent:function(e,t){var o,r=this.options.content,n=this,i=t?t.type:null;if("string"==typeof r||r.nodeType||r.jquery)return this._open(t,e,r);(o=r.call(e[0],function(o){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=i),this._open(t,e,o))})}))&&this._open(t,e,o)},_open:function(t,o,r){var n,i,a,s,l=e.extend({},this.options.position);function c(e){l.of=e,i.is(":hidden")||i.position(l)}r&&((n=this._find(o))?n.tooltip.find(".ui-tooltip-content").html(r):(o.is("[title]")&&(t&&"mouseover"===t.type?o.attr("title",""):o.removeAttr("title")),n=this._tooltip(o),i=n.tooltip,this._addDescribedBy(o,i.attr("id")),i.find(".ui-tooltip-content").html(r),this.liveRegion.children().hide(),(s=e("<div>").html(i.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),s.removeAttr("id").find("[id]").removeAttr("id"),s.appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:c}),c(t)):i.position(e.extend({of:o},this.options.position)),i.hide(),this._show(i,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){i.is(":visible")&&(c(l.of),clearInterval(a))},e.fx.interval)),this._trigger("open",t,{tooltip:i})))},_registerCloseHandlers:function(t,o){var r={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var r=e.Event(t);r.currentTarget=o[0],this.close(r,!0)}}};o[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(this._find(o).tooltip)}),t&&"mouseover"!==t.type||(r.mouseleave="close"),t&&"focusin"!==t.type||(r.focusout="close"),this._on(!0,o,r)},close:function(t){var o,r=this,n=e(t?t.currentTarget:this.element),i=this._find(n);i?(o=i.tooltip,i.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),i.hiding=!0,o.stop(!0),this._hide(o,this.options.hide,function(){r._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,o){e(o.element).attr("title",o.title),delete r.parents[t]}),i.closing=!0,this._trigger("close",t,{tooltip:o}),i.hiding||(i.closing=!1))):n.removeData("ui-tooltip-open")},_tooltip:function(t){var o=e("<div>").attr("role","tooltip"),r=e("<div>").appendTo(o),n=o.uniqueId().attr("id");return this._addClass(r,"ui-tooltip-content"),this._addClass(o,"ui-tooltip","ui-widget ui-widget-content"),o.appendTo(this._appendTo(t)),this.tooltips[n]={element:t,tooltip:o}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_appendTo:function(e){var t=e.closest(".ui-front, dialog");return t.length||(t=this.document[0].body),t},_destroy:function(){var t=this;e.each(this.tooltips,function(o,r){var n=e.Event("blur"),i=r.element;n.target=n.currentTarget=i[0],t.close(n,!0),e("#"+o).remove(),i.data("ui-tooltip-title")&&(i.attr("title")||i.attr("title",i.data("ui-tooltip-title")),i.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget("ui.tooltip",e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}}),e.ui.tooltip})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("blind","hide",function(t,o){var r={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=e(this),i=t.direction||"up",a=n.cssClip(),s={clip:e.extend({},a)},l=e.effects.createPlaceholder(n);s.clip[r[i][0]]=s.clip[r[i][1]],"show"===t.mode&&(n.cssClip(s.clip),l&&l.css(e.effects.clipToBox(s)),s.clip=a),l&&l.animate(e.effects.clipToBox(s),t.duration,t.easing),n.animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("bounce",function(t,o){var r,n,i,a=e(this),s=t.mode,l="hide"===s,c="show"===s,u=t.direction||"up",d=t.distance,p=t.times||5,f=2*p+(c||l?1:0),h=t.duration/f,m=t.easing,g="up"===u||"down"===u?"top":"left",b="up"===u||"left"===u,v=0,y=a.queue().length;for(e.effects.createPlaceholder(a),i=a.css(g),d||(d=a["top"===g?"outerHeight":"outerWidth"]()/3),c&&((n={opacity:1})[g]=i,a.css("opacity",0).css(g,b?2*-d:2*d).animate(n,h,m)),l&&(d/=Math.pow(2,p-1)),(n={})[g]=i;v<p;v++)(r={})[g]=(b?"-=":"+=")+d,a.animate(r,h,m).animate(n,h,m),d=l?2*d:d/2;l&&((r={opacity:0})[g]=(b?"-=":"+=")+d,a.animate(r,h,m)),a.queue(o),e.effects.unshift(a,y,f+1)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("clip","hide",function(t,o){var r,n={},i=e(this),a=t.direction||"vertical",s="both"===a,l=s||"horizontal"===a,c=s||"vertical"===a;r=i.cssClip(),n.clip={top:c?(r.bottom-r.top)/2:r.top,right:l?(r.right-r.left)/2:r.right,bottom:c?(r.bottom-r.top)/2:r.bottom,left:l?(r.right-r.left)/2:r.left},e.effects.createPlaceholder(i),"show"===t.mode&&(i.cssClip(n.clip),n.clip=r),i.animate(n,{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("drop","hide",function(t,o){var r,n=e(this),i=t.mode,a="show"===i,s=t.direction||"left",l="up"===s||"down"===s?"top":"left",c="up"===s||"left"===s?"-=":"+=",u="+="===c?"-=":"+=",d={opacity:0};e.effects.createPlaceholder(n),r=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,d[l]=c+r,a&&(n.css(d),d[l]=u+r,d.opacity=1),n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("explode","hide",function(t,o){var r,n,i,a,s,l,c=t.pieces?Math.round(Math.sqrt(t.pieces)):3,u=c,d=e(this),p=t.mode,f="show"===p,h=d.show().css("visibility","hidden").offset(),m=Math.ceil(d.outerWidth()/u),g=Math.ceil(d.outerHeight()/c),b=[];function v(){b.push(this),b.length===c*u&&(d.css({visibility:"visible"}),e(b).remove(),o())}for(r=0;r<c;r++)for(a=h.top+r*g,l=r-(c-1)/2,n=0;n<u;n++)i=h.left+n*m,s=n-(u-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-n*m,top:-r*g}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:m,height:g,left:i+(f?s*m:0),top:a+(f?l*g:0),opacity:f?0:1}).animate({left:i+(f?0:s*m),top:a+(f?0:l*g),opacity:f?1:0},t.duration||500,t.easing,v)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("fade","toggle",function(t,o){var r="show"===t.mode;e(this).css("opacity",r?0:1).animate({opacity:r?1:0},{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("fold","hide",function(t,o){var r=e(this),n=t.mode,i="show"===n,a="hide"===n,s=t.size||15,l=/([0-9]+)%/.exec(s),c=!!t.horizFirst,u=c?["right","bottom"]:["bottom","right"],d=t.duration/2,p=e.effects.createPlaceholder(r),f=r.cssClip(),h={clip:e.extend({},f)},m={clip:e.extend({},f)},g=[f[u[0]],f[u[1]]],b=r.queue().length;l&&(s=parseInt(l[1],10)/100*g[a?0:1]),h.clip[u[0]]=s,m.clip[u[0]]=s,m.clip[u[1]]=0,i&&(r.cssClip(m.clip),p&&p.css(e.effects.clipToBox(m)),m.clip=f),r.queue(function(o){p&&p.animate(e.effects.clipToBox(h),d,t.easing).animate(e.effects.clipToBox(m),d,t.easing),o()}).animate(h,d,t.easing).animate(m,d,t.easing).queue(o),e.effects.unshift(r,b,4)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("highlight","show",function(t,o){var r=e(this),n={backgroundColor:r.css("backgroundColor")};"hide"===t.mode&&(n.opacity=0),e.effects.saveStyle(r),r.css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(n,{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29),o(233)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("puff","hide",function(t,o){var r=e.extend(!0,{},t,{fade:!0,percent:parseInt(t.percent,10)||150});e.effects.effect.scale.call(this,r,o)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("pulsate","show",function(t,o){var r=e(this),n=t.mode,i="show"===n,a="hide"===n,s=i||a,l=2*(t.times||5)+(s?1:0),c=t.duration/l,u=0,d=1,p=r.queue().length;for(!i&&r.is(":visible")||(r.css("opacity",0).show(),u=1);d<l;d++)r.animate({opacity:u},c,t.easing),u=1-u;r.animate({opacity:u},c,t.easing),r.queue(o),e.effects.unshift(r,p,l+1)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("shake",function(t,o){var r=1,n=e(this),i=t.direction||"left",a=t.distance||20,s=t.times||3,l=2*s+1,c=Math.round(t.duration/l),u="up"===i||"down"===i?"top":"left",d="up"===i||"left"===i,p={},f={},h={},m=n.queue().length;for(e.effects.createPlaceholder(n),p[u]=(d?"-=":"+=")+a,f[u]=(d?"+=":"-=")+2*a,h[u]=(d?"-=":"+=")+2*a,n.animate(p,c,t.easing);r<s;r++)n.animate(f,c,t.easing).animate(h,c,t.easing);n.animate(f,c,t.easing).animate(p,c/2,t.easing).queue(o),e.effects.unshift(n,m,l+1)})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){return e.effects.define("slide","show",function(t,o){var r,n,i=e(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},s=t.mode,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",u="up"===l||"left"===l,d=t.distance||i["top"===c?"outerHeight":"outerWidth"](!0),p={};e.effects.createPlaceholder(i),r=i.cssClip(),n=i.position()[c],p[c]=(u?-1:1)*d+n,p.clip=i.cssClip(),p.clip[a[l][1]]=p.clip[a[l][0]],"show"===s&&(i.cssClip(p.clip),i.css(c,p[c]),p.clip=r,p[c]=n),i.animate(p,{queue:!1,duration:t.duration,easing:t.easing,complete:o})})})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){var r,n,i;n=[o(9),o(11),o(29)],void 0===(i="function"==typeof(r=function(e){var t;return!1!==e.uiBackCompat&&(t=e.effects.define("transfer",function(t,o){e(this).transfer(t,o)})),t})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";var r,n,i;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n=[o(9)],void 0===(i="function"==typeof(r=function(e,t){e.fn.jPlayer=function(o){var r="string"==typeof o,n=Array.prototype.slice.call(arguments,1),i=this;return o=!r&&n.length?e.extend.apply(null,[!0,o].concat(n)):o,r&&"_"===o.charAt(0)?i:(r?this.each(function(){var r=e(this).data("jPlayer"),a=r&&e.isFunction(r[o])?r[o].apply(r,n):r;if(a!==r&&a!==t)return i=a,!1}):this.each(function(){var t=e(this).data("jPlayer");t?t.option(o||{}):e(this).data("jPlayer",new e.jPlayer(o,this))}),i)},e.jPlayer=function(t,o){if(arguments.length){this.element=e(o),this.options=e.extend(!0,{},this.options,t);var r=this;this.element.bind("remove.jPlayer",function(){r.destroy()}),this._init()}},"function"!=typeof e.fn.stop&&(e.fn.stop=function(){}),e.jPlayer.emulateMethods="load play pause",e.jPlayer.emulateStatus="src readyState networkState currentTime duration paused ended playbackRate",e.jPlayer.emulateOptions="muted volume",e.jPlayer.reservedEvent="ready flashreset resize repeat error warning",e.jPlayer.event={},e.each("ready flashreset resize repeat click error warning loadstart progress suspend abort emptied stalled play pause loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange".split(" "),function(){e.jPlayer.event[this]="jPlayer_"+this}),e.jPlayer.htmlEvent="loadstart abort emptied stalled loadedmetadata loadeddata canplay canplaythrough".split(" "),e.jPlayer.pause=function(){e.each(e.jPlayer.prototype.instances,function(e,t){t.data("jPlayer").status.srcSet&&t.jPlayer("pause")})},e.jPlayer.timeFormat={showHour:!1,showMin:!0,showSec:!0,padHour:!1,padMin:!0,padSec:!0,sepHour:":",sepMin:":",sepSec:""};var o=function(){this.init()};o.prototype={init:function(){this.options={timeFormat:e.jPlayer.timeFormat}},time:function(e){var t=new Date(1e3*(e&&"number"==typeof e?e:0)),o=t.getUTCHours();return e=this.options.timeFormat.showHour?t.getUTCMinutes():t.getUTCMinutes()+60*o,t=this.options.timeFormat.showMin?t.getUTCSeconds():t.getUTCSeconds()+60*e,o=this.options.timeFormat.padHour&&10>o?"0"+o:o,e=this.options.timeFormat.padMin&&10>e?"0"+e:e,t=this.options.timeFormat.padSec&&10>t?"0"+t:t,o=""+(this.options.timeFormat.showHour?o+this.options.timeFormat.sepHour:""),o+=this.options.timeFormat.showMin?e+this.options.timeFormat.sepMin:"",o+=this.options.timeFormat.showSec?t+this.options.timeFormat.sepSec:""}};var r=new o;e.jPlayer.convertTime=function(e){return r.time(e)},e.jPlayer.uaBrowser=function(e){return e=e.toLowerCase(),{browser:(e=/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(e)||[])[1]||"",version:e[2]||"0"}},e.jPlayer.uaPlatform=function(e){var t=e.toLowerCase();return e=/(ipad|iphone|ipod|android|blackberry|playbook|windows ce|webos)/.exec(t)||[],t=/(ipad|playbook)/.exec(t)||!/(mobile)/.exec(t)&&/(android)/.exec(t)||[],e[1]&&(e[1]=e[1].replace(/\s/g,"_")),{platform:e[1]||"",tablet:t[1]||""}},e.jPlayer.browser={},e.jPlayer.platform={};var n=e.jPlayer.uaBrowser(navigator.userAgent);n.browser&&(e.jPlayer.browser[n.browser]=!0,e.jPlayer.browser.version=n.version),(n=e.jPlayer.uaPlatform(navigator.userAgent)).platform&&(e.jPlayer.platform[n.platform]=!0,e.jPlayer.platform.mobile=!n.tablet,e.jPlayer.platform.tablet=!!n.tablet),e.jPlayer.getDocMode=function(){var t;return e.jPlayer.browser.msie&&(document.documentMode?t=document.documentMode:(t=5,document.compatMode&&"CSS1Compat"===document.compatMode&&(t=7))),t},e.jPlayer.browser.documentMode=e.jPlayer.getDocMode(),e.jPlayer.nativeFeatures={init:function(){var e,t,o=document,r=o.createElement("video"),n={w3c:"fullscreenEnabled fullscreenElement requestFullscreen exitFullscreen fullscreenchange fullscreenerror".split(" "),moz:"mozFullScreenEnabled mozFullScreenElement mozRequestFullScreen mozCancelFullScreen mozfullscreenchange mozfullscreenerror".split(" "),webkit:" webkitCurrentFullScreenElement webkitRequestFullScreen webkitCancelFullScreen webkitfullscreenchange ".split(" "),webkitVideo:"webkitSupportsFullscreen webkitDisplayingFullscreen webkitEnterFullscreen webkitExitFullscreen  ".split(" ")},i=["w3c","moz","webkit","webkitVideo"];for(this.fullscreen=r={support:{w3c:!!o[n.w3c[0]],moz:!!o[n.moz[0]],webkit:"function"==typeof o[n.webkit[3]],webkitVideo:"function"==typeof r[n.webkitVideo[2]]},used:{}},e=0,t=i.length;e<t;e++){var a=i[e];if(r.support[a]){r.spec=a,r.used[a]=!0;break}}if(r.spec){var s=n[r.spec];r.api={fullscreenEnabled:!0,fullscreenElement:function(e){return(e=e||o)[s[1]]},requestFullscreen:function(e){return e[s[2]]()},exitFullscreen:function(e){return(e=e||o)[s[3]]()}},r.event={fullscreenchange:s[4],fullscreenerror:s[5]}}else r.api={fullscreenEnabled:!1,fullscreenElement:function(){return null},requestFullscreen:function(){},exitFullscreen:function(){}},r.event={}}},e.jPlayer.nativeFeatures.init(),e.jPlayer.focus=null,e.jPlayer.keyIgnoreElementNames="INPUT TEXTAREA";var i=function(t){var o,r=e.jPlayer.focus;r&&(e.each(e.jPlayer.keyIgnoreElementNames.split(/\s+/g),function(e,r){if(t.target.nodeName.toUpperCase()===r.toUpperCase())return o=!0,!1}),o||e.each(r.options.keyBindings,function(o,n){if(n&&t.which===n.key&&e.isFunction(n.fn))return t.preventDefault(),n.fn(r),!1}))};e.jPlayer.keys=function(t){e(document.documentElement).unbind("keydown.jPlayer"),t&&e(document.documentElement).bind("keydown.jPlayer",i)},e.jPlayer.keys(!0),e.jPlayer.prototype={count:0,version:{script:"2.5.0",needFlash:"2.5.0",flash:"unknown"},options:{swfPath:"js",solution:"html, flash",supplied:"mp3",preload:"metadata",volume:.8,muted:!1,playbackRate:1,defaultPlaybackRate:1,minPlaybackRate:.5,maxPlaybackRate:4,wmode:"opaque",backgroundColor:"#000000",cssSelectorAncestor:"#jp_container_1",cssSelector:{videoPlay:".jp-video-play",play:".jp-play",pause:".jp-pause",stop:".jp-stop",seekBar:".jp-seek-bar",playBar:".jp-play-bar",mute:".jp-mute",unmute:".jp-unmute",volumeBar:".jp-volume-bar",volumeBarValue:".jp-volume-bar-value",volumeMax:".jp-volume-max",playbackRateBar:".jp-playback-rate-bar",playbackRateBarValue:".jp-playback-rate-bar-value",currentTime:".jp-current-time",duration:".jp-duration",fullScreen:".jp-full-screen",restoreScreen:".jp-restore-screen",repeat:".jp-repeat",repeatOff:".jp-repeat-off",gui:".jp-gui",noSolution:".jp-no-solution"},smoothPlayBar:!1,fullScreen:!1,fullWindow:!1,autohide:{restored:!1,full:!0,fadeIn:200,fadeOut:600,hold:1e3},loop:!1,repeat:function(t){t.jPlayer.options.loop?e(this).unbind(".jPlayerRepeat").bind(e.jPlayer.event.ended+".jPlayer.jPlayerRepeat",function(){e(this).jPlayer("play")}):e(this).unbind(".jPlayerRepeat")},nativeVideoControls:{},noFullWindow:{msie:/msie [0-6]\./,ipad:/ipad.*?os [0-4]\./,iphone:/iphone/,ipod:/ipod/,android_pad:/android [0-3]\.(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/},noVolume:{ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/},timeFormat:{},keyEnabled:!1,audioFullScreen:!1,keyBindings:{play:{key:32,fn:function(e){e.status.paused?e.play():e.pause()}},fullScreen:{key:13,fn:function(e){(e.status.video||e.options.audioFullScreen)&&e._setOption("fullScreen",!e.options.fullScreen)}},muted:{key:8,fn:function(e){e._muted(!e.options.muted)}},volumeUp:{key:38,fn:function(e){e.volume(e.options.volume+.1)}},volumeDown:{key:40,fn:function(e){e.volume(e.options.volume-.1)}}},verticalVolume:!1,verticalPlaybackRate:!1,globalVolume:!1,idPrefix:"jp",noConflict:"jQuery",emulateHtml:!1,consoleAlerts:!0,errorAlerts:!1,warningAlerts:!1},optionsAudio:{size:{width:"0px",height:"0px",cssClass:""},sizeFull:{width:"0px",height:"0px",cssClass:""}},optionsVideo:{size:{width:"480px",height:"270px",cssClass:"jp-video-270p"},sizeFull:{width:"100%",height:"100%",cssClass:"jp-video-full"}},instances:{},status:{src:"",media:{},paused:!0,format:{},formatType:"",waitForPlay:!0,waitForLoad:!0,srcSet:!1,video:!1,seekPercent:0,currentPercentRelative:0,currentPercentAbsolute:0,currentTime:0,duration:0,videoWidth:0,videoHeight:0,readyState:0,networkState:0,playbackRate:1,ended:0},internal:{ready:!1},solution:{html:!0,flash:!0},format:{mp3:{codec:'audio/mpeg; codecs="mp3"',flashCanPlay:!0,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:!0,media:"audio"},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',flashCanPlay:!1,media:"audio"},m3ua:{codec:"audio/mpegurl",flashCanPlay:!1,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis, opus"',flashCanPlay:!1,media:"audio"},flac:{codec:"audio/x-flac",flashCanPlay:!1,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:!1,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:!1,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:!0,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!0,media:"video"},m3u8v:{codec:'application/vnd.apple.mpegurl; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!1,media:"video"},m3uv:{codec:"audio/mpegurl",flashCanPlay:!1,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:!1,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:!1,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:!0,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"video"}},_init:function(){var o=this;if(this.element.empty(),this.status=e.extend({},this.status),this.internal=e.extend({},this.internal),this.options.timeFormat=e.extend({},e.jPlayer.timeFormat,this.options.timeFormat),this.internal.cmdsIgnored=e.jPlayer.platform.ipad||e.jPlayer.platform.iphone||e.jPlayer.platform.ipod,this.internal.domNode=this.element.get(0),this.options.keyEnabled&&!e.jPlayer.focus&&(e.jPlayer.focus=this),this.formats=[],this.solutions=[],this.require={},this.htmlElement={},this.html={},this.html.audio={},this.html.video={},this.flash={},this.css={},this.css.cs={},this.css.jq={},this.ancestorJq=[],this.options.volume=this._limitValue(this.options.volume,0,1),e.each(this.options.supplied.toLowerCase().split(","),function(t,r){var n=r.replace(/^\s+|\s+$/g,"");if(o.format[n]){var i=!1;e.each(o.formats,function(e,t){if(n===t)return i=!0,!1}),i||o.formats.push(n)}}),e.each(this.options.solution.toLowerCase().split(","),function(t,r){var n=r.replace(/^\s+|\s+$/g,"");if(o.solution[n]){var i=!1;e.each(o.solutions,function(e,t){if(n===t)return i=!0,!1}),i||o.solutions.push(n)}}),this.internal.instance="jp_"+this.count,this.instances[this.internal.instance]=this.element,this.element.attr("id")||this.element.attr("id",this.options.idPrefix+"_jplayer_"+this.count),this.internal.self=e.extend({},{id:this.element.attr("id"),jq:this.element}),this.internal.audio=e.extend({},{id:this.options.idPrefix+"_audio_"+this.count,jq:t}),this.internal.video=e.extend({},{id:this.options.idPrefix+"_video_"+this.count,jq:t}),this.internal.flash=e.extend({},{id:this.options.idPrefix+"_flash_"+this.count,jq:t,swf:this.options.swfPath+(".swf"!==this.options.swfPath.toLowerCase().slice(-4)?(this.options.swfPath&&"/"!==this.options.swfPath.slice(-1)?"/":"")+"Jplayer.swf":"")}),this.internal.poster=e.extend({},{id:this.options.idPrefix+"_poster_"+this.count,jq:t}),e.each(e.jPlayer.event,function(e,r){o.options[e]!==t&&(o.element.bind(r+".jPlayer",o.options[e]),o.options[e]=t)}),this.require.audio=!1,this.require.video=!1,e.each(this.formats,function(e,t){o.require[o.format[t].media]=!0}),this.options=this.require.video?e.extend(!0,{},this.optionsVideo,this.options):e.extend(!0,{},this.optionsAudio,this.options),this._setSize(),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this.status.noVolume=this._uaBlocklist(this.options.noVolume),e.jPlayer.nativeFeatures.fullscreen.api.fullscreenEnabled&&this._fullscreenAddEventListeners(),this._restrictNativeVideoControls(),this.htmlElement.poster=document.createElement("img"),this.htmlElement.poster.id=this.internal.poster.id,this.htmlElement.poster.onload=function(){o.status.video&&!o.status.waitForPlay||o.internal.poster.jq.show()},this.element.append(this.htmlElement.poster),this.internal.poster.jq=e("#"+this.internal.poster.id),this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),this.internal.poster.jq.hide(),this.internal.poster.jq.bind("click.jPlayer",function(){o._trigger(e.jPlayer.event.click)}),this.html.audio.available=!1,this.require.audio&&(this.htmlElement.audio=document.createElement("audio"),this.htmlElement.audio.id=this.internal.audio.id,this.html.audio.available=!!this.htmlElement.audio.canPlayType&&this._testCanPlayType(this.htmlElement.audio)),this.html.video.available=!1,this.require.video&&(this.htmlElement.video=document.createElement("video"),this.htmlElement.video.id=this.internal.video.id,this.html.video.available=!!this.htmlElement.video.canPlayType&&this._testCanPlayType(this.htmlElement.video)),this.flash.available=this._checkForFlash(10.1),this.html.canPlay={},this.flash.canPlay={},e.each(this.formats,function(e,t){o.html.canPlay[t]=o.html[o.format[t].media].available&&""!==o.htmlElement[o.format[t].media].canPlayType(o.format[t].codec),o.flash.canPlay[t]=o.format[t].flashCanPlay&&o.flash.available}),this.html.desired=!1,this.flash.desired=!1,e.each(this.solutions,function(t,r){if(0===t)o[r].desired=!0;else{var n=!1,i=!1;e.each(o.formats,function(e,t){o[o.solutions[0]].canPlay[t]&&("video"===o.format[t].media?i=!0:n=!0)}),o[r].desired=o.require.audio&&!n||o.require.video&&!i}}),this.html.support={},this.flash.support={},e.each(this.formats,function(e,t){o.html.support[t]=o.html.canPlay[t]&&o.html.desired,o.flash.support[t]=o.flash.canPlay[t]&&o.flash.desired}),this.html.used=!1,this.flash.used=!1,e.each(this.solutions,function(t,r){e.each(o.formats,function(e,t){if(o[r].support[t])return o[r].used=!0,!1})}),this._resetActive(),this._resetGate(),this._cssSelectorAncestor(this.options.cssSelectorAncestor),this.html.used||this.flash.used?this.css.jq.noSolution.length&&this.css.jq.noSolution.hide():(this._error({type:e.jPlayer.error.NO_SOLUTION,context:"{solution:'"+this.options.solution+"', supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SOLUTION,hint:e.jPlayer.errorHint.NO_SOLUTION}),this.css.jq.noSolution.length&&this.css.jq.noSolution.show()),this.flash.used){var r,n="jQuery="+encodeURI(this.options.noConflict)+"&id="+encodeURI(this.internal.self.id)+"&vol="+this.options.volume+"&muted="+this.options.muted;if(e.jPlayer.browser.msie&&(9>Number(e.jPlayer.browser.version)||9>e.jPlayer.browser.documentMode)){n=['<param name="movie" value="'+this.internal.flash.swf+'" />','<param name="FlashVars" value="'+n+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+this.options.backgroundColor+'" />','<param name="wmode" value="'+this.options.wmode+'" />'],r=document.createElement('<object id="'+this.internal.flash.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="0" height="0" tabindex="-1"></object>');for(var i=0;i<n.length;i++)r.appendChild(document.createElement(n[i]))}else i=function(e,t,o){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",o),e.appendChild(r)},(r=document.createElement("object")).setAttribute("id",this.internal.flash.id),r.setAttribute("name",this.internal.flash.id),r.setAttribute("data",this.internal.flash.swf),r.setAttribute("type","application/x-shockwave-flash"),r.setAttribute("width","1"),r.setAttribute("height","1"),r.setAttribute("tabindex","-1"),i(r,"flashvars",n),i(r,"allowscriptaccess","always"),i(r,"bgcolor",this.options.backgroundColor),i(r,"wmode",this.options.wmode);this.element.append(r),this.internal.flash.jq=e(r)}this.status.playbackRateEnabled=!(!this.html.used||this.flash.used)&&this._testPlaybackRate("audio"),this._updatePlaybackRate(),this.html.used&&(this.html.audio.available&&(this._addHtmlEventListeners(this.htmlElement.audio,this.html.audio),this.element.append(this.htmlElement.audio),this.internal.audio.jq=e("#"+this.internal.audio.id)),this.html.video.available&&(this._addHtmlEventListeners(this.htmlElement.video,this.html.video),this.element.append(this.htmlElement.video),this.internal.video.jq=e("#"+this.internal.video.id),this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):this.internal.video.jq.css({width:"0px",height:"0px"}),this.internal.video.jq.bind("click.jPlayer",function(){o._trigger(e.jPlayer.event.click)}))),this.options.emulateHtml&&this._emulateHtmlBridge(),this.html.used&&!this.flash.used&&setTimeout(function(){o.internal.ready=!0,o.version.flash="n/a",o._trigger(e.jPlayer.event.repeat),o._trigger(e.jPlayer.event.ready)},100),this._updateNativeVideoControls(),this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),e.jPlayer.prototype.count++},destroy:function(){this.clearMedia(),this._removeUiClass(),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(""),this.css.jq.duration.length&&this.css.jq.duration.text(""),e.each(this.css.jq,function(e,t){t.length&&t.unbind(".jPlayer")}),this.internal.poster.jq.unbind(".jPlayer"),this.internal.video.jq&&this.internal.video.jq.unbind(".jPlayer"),this._fullscreenRemoveEventListeners(),this===e.jPlayer.focus&&(e.jPlayer.focus=null),this.options.emulateHtml&&this._destroyHtmlBridge(),this.element.removeData("jPlayer"),this.element.unbind(".jPlayer"),this.element.empty(),delete this.instances[this.internal.instance]},enable:function(){},disable:function(){},_testCanPlayType:function(e){try{return e.canPlayType(this.format.mp3.codec),!0}catch(e){return!1}},_testPlaybackRate:function(e){e=document.createElement("string"==typeof e?e:"audio");try{return"playbackRate"in e&&(e.playbackRate=.5,.5===e.playbackRate)}catch(e){return!1}},_uaBlocklist:function(t){var o=navigator.userAgent.toLowerCase(),r=!1;return e.each(t,function(e,t){if(t&&t.test(o))return r=!0,!1}),r},_restrictNativeVideoControls:function(){this.require.audio&&this.status.nativeVideoControls&&(this.status.nativeVideoControls=!1,this.status.noFullWindow=!0)},_updateNativeVideoControls:function(){this.html.video.available&&this.html.used&&(this.htmlElement.video.controls=this.status.nativeVideoControls,this._updateAutohide(),this.status.nativeVideoControls&&this.require.video?(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})):this.status.waitForPlay&&this.status.video&&(this.internal.poster.jq.show(),this.internal.video.jq.css({width:"0px",height:"0px"})))},_addHtmlEventListeners:function(t,o){var r=this;t.preload=this.options.preload,t.muted=this.options.muted,t.volume=this.options.volume,this.status.playbackRateEnabled&&(t.defaultPlaybackRate=this.options.defaultPlaybackRate,t.playbackRate=this.options.playbackRate),t.addEventListener("progress",function(){o.gate&&(r.internal.cmdsIgnored&&0<this.readyState&&(r.internal.cmdsIgnored=!1),r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.progress))},!1),t.addEventListener("timeupdate",function(){o.gate&&(r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.timeupdate))},!1),t.addEventListener("durationchange",function(){o.gate&&(r._getHtmlStatus(t),r._updateInterface(),r._trigger(e.jPlayer.event.durationchange))},!1),t.addEventListener("play",function(){o.gate&&(r._updateButtons(!0),r._html_checkWaitForPlay(),r._trigger(e.jPlayer.event.play))},!1),t.addEventListener("playing",function(){o.gate&&(r._updateButtons(!0),r._seeked(),r._trigger(e.jPlayer.event.playing))},!1),t.addEventListener("pause",function(){o.gate&&(r._updateButtons(!1),r._trigger(e.jPlayer.event.pause))},!1),t.addEventListener("waiting",function(){o.gate&&(r._seeking(),r._trigger(e.jPlayer.event.waiting))},!1),t.addEventListener("seeking",function(){o.gate&&(r._seeking(),r._trigger(e.jPlayer.event.seeking))},!1),t.addEventListener("seeked",function(){o.gate&&(r._seeked(),r._trigger(e.jPlayer.event.seeked))},!1),t.addEventListener("volumechange",function(){o.gate&&(r.options.volume=t.volume,r.options.muted=t.muted,r._updateMute(),r._updateVolume(),r._trigger(e.jPlayer.event.volumechange))},!1),t.addEventListener("ratechange",function(){o.gate&&(r.options.defaultPlaybackRate=t.defaultPlaybackRate,r.options.playbackRate=t.playbackRate,r._updatePlaybackRate(),r._trigger(e.jPlayer.event.ratechange))},!1),t.addEventListener("suspend",function(){o.gate&&(r._seeked(),r._trigger(e.jPlayer.event.suspend))},!1),t.addEventListener("ended",function(){o.gate&&(e.jPlayer.browser.webkit||(r.htmlElement.media.currentTime=0),r.htmlElement.media.pause(),r._updateButtons(!1),r._getHtmlStatus(t,!0),r._updateInterface(),r._trigger(e.jPlayer.event.ended))},!1),t.addEventListener("error",function(){o.gate&&(r._updateButtons(!1),r._seeked(),r.status.srcSet&&(clearTimeout(r.internal.htmlDlyCmdId),r.status.waitForLoad=!0,r.status.waitForPlay=!0,r.status.video&&!r.status.nativeVideoControls&&r.internal.video.jq.css({width:"0px",height:"0px"}),r._validString(r.status.media.poster)&&!r.status.nativeVideoControls&&r.internal.poster.jq.show(),r.css.jq.videoPlay.length&&r.css.jq.videoPlay.show(),r._error({type:e.jPlayer.error.URL,context:r.status.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL})))},!1),e.each(e.jPlayer.htmlEvent,function(n,i){t.addEventListener(this,function(){o.gate&&r._trigger(e.jPlayer.event[i])},!1)})},_getHtmlStatus:function(e,t){var o=0,r=0,n=0,i=0;isFinite(e.duration)&&(this.status.duration=e.duration),o=e.currentTime,r=0<this.status.duration?100*o/this.status.duration:0,"object"===a(e.seekable)&&0<e.seekable.length?(n=0<this.status.duration?100*e.seekable.end(e.seekable.length-1)/this.status.duration:100,i=0<this.status.duration?100*e.currentTime/e.seekable.end(e.seekable.length-1):0):(n=100,i=r),t&&(r=i=o=0),this.status.seekPercent=n,this.status.currentPercentRelative=i,this.status.currentPercentAbsolute=r,this.status.currentTime=o,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=e.readyState,this.status.networkState=e.networkState,this.status.playbackRate=e.playbackRate,this.status.ended=e.ended},_resetStatus:function(){this.status=e.extend({},this.status,e.jPlayer.prototype.status)},_trigger:function(t,o,r){(t=e.Event(t)).jPlayer={},t.jPlayer.version=e.extend({},this.version),t.jPlayer.options=e.extend(!0,{},this.options),t.jPlayer.status=e.extend(!0,{},this.status),t.jPlayer.html=e.extend(!0,{},this.html),t.jPlayer.flash=e.extend(!0,{},this.flash),o&&(t.jPlayer.error=e.extend({},o)),r&&(t.jPlayer.warning=e.extend({},r)),this.element.trigger(t)},jPlayerFlashEvent:function(t,o){if(t===e.jPlayer.event.ready)if(this.internal.ready){if(this.flash.gate){if(this.status.srcSet){var r=this.status.currentTime,n=this.status.paused;this.setMedia(this.status.media),this.volumeWorker(this.options.volume),0<r&&(n?this.pause(r):this.play(r))}this._trigger(e.jPlayer.event.flashreset)}}else this.internal.ready=!0,this.internal.flash.jq.css({width:"0px",height:"0px"}),this.version.flash=o.version,this.version.needFlash!==this.version.flash&&this._error({type:e.jPlayer.error.VERSION,context:this.version.flash,message:e.jPlayer.errorMsg.VERSION+this.version.flash,hint:e.jPlayer.errorHint.VERSION}),this._trigger(e.jPlayer.event.repeat),this._trigger(t);if(this.flash.gate)switch(t){case e.jPlayer.event.progress:case e.jPlayer.event.timeupdate:this._getFlashStatus(o),this._updateInterface(),this._trigger(t);break;case e.jPlayer.event.play:this._seeked(),this._updateButtons(!0),this._trigger(t);break;case e.jPlayer.event.pause:case e.jPlayer.event.ended:this._updateButtons(!1),this._trigger(t);break;case e.jPlayer.event.click:this._trigger(t);break;case e.jPlayer.event.error:this.status.waitForLoad=!0,this.status.waitForPlay=!0,this.status.video&&this.internal.flash.jq.css({width:"0px",height:"0px"}),this._validString(this.status.media.poster)&&this.internal.poster.jq.show(),this.css.jq.videoPlay.length&&this.status.video&&this.css.jq.videoPlay.show(),this.status.video?this._flash_setVideo(this.status.media):this._flash_setAudio(this.status.media),this._updateButtons(!1),this._error({type:e.jPlayer.error.URL,context:o.src,message:e.jPlayer.errorMsg.URL,hint:e.jPlayer.errorHint.URL});break;case e.jPlayer.event.seeking:this._seeking(),this._trigger(t);break;case e.jPlayer.event.seeked:this._seeked(),this._trigger(t);break;case e.jPlayer.event.ready:break;default:this._trigger(t)}return!1},_getFlashStatus:function(e){this.status.seekPercent=e.seekPercent,this.status.currentPercentRelative=e.currentPercentRelative,this.status.currentPercentAbsolute=e.currentPercentAbsolute,this.status.currentTime=e.currentTime,this.status.duration=e.duration,this.status.videoWidth=e.videoWidth,this.status.videoHeight=e.videoHeight,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_updateButtons:function(e){e===t?e=!this.status.paused:this.status.paused=!e,this.css.jq.play.length&&this.css.jq.pause.length&&(e?(this.css.jq.play.hide(),this.css.jq.pause.show()):(this.css.jq.play.show(),this.css.jq.pause.hide())),this.css.jq.restoreScreen.length&&this.css.jq.fullScreen.length&&(this.status.noFullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.hide()):this.options.fullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.show()):(this.css.jq.fullScreen.show(),this.css.jq.restoreScreen.hide())),this.css.jq.repeat.length&&this.css.jq.repeatOff.length&&(this.options.loop?(this.css.jq.repeat.hide(),this.css.jq.repeatOff.show()):(this.css.jq.repeat.show(),this.css.jq.repeatOff.hide()))},_updateInterface:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.width(this.status.seekPercent+"%"),this.css.jq.playBar.length&&(this.options.smoothPlayBar?this.css.jq.playBar.stop().animate({width:this.status.currentPercentAbsolute+"%"},250,"linear"):this.css.jq.playBar.width(this.status.currentPercentRelative+"%")),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(this._convertTime(this.status.currentTime)),this.css.jq.duration.length&&this.css.jq.duration.text(this._convertTime(this.status.duration))},_convertTime:o.prototype.time,_seeking:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.addClass("jp-seeking-bg")},_seeked:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.removeClass("jp-seeking-bg")},_resetGate:function(){this.html.audio.gate=!1,this.html.video.gate=!1,this.flash.gate=!1},_resetActive:function(){this.html.active=!1,this.flash.active=!1},_escapeHtml:function(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")},_qualifyURL:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this._escapeHtml(e)+'">x</a>',t.firstChild.href},_absoluteMediaUrls:function(t){var o=this;return e.each(t,function(e,r){o.format[e]&&(t[e]=o._qualifyURL(r))}),t},setMedia:function(t){var o=this,r=!1,n=this.status.media.poster!==t.poster;this._resetMedia(),this._resetGate(),this._resetActive(),t=this._absoluteMediaUrls(t),e.each(this.formats,function(n,i){var a="video"===o.format[i].media;if(e.each(o.solutions,function(e,n){if(o[n].support[i]&&o._validString(t[i])){var s="html"===n;return a?(s?(o.html.video.gate=!0,o._html_setVideo(t),o.html.active=!0):(o.flash.gate=!0,o._flash_setVideo(t),o.flash.active=!0),o.css.jq.videoPlay.length&&o.css.jq.videoPlay.show(),o.status.video=!0):(s?(o.html.audio.gate=!0,o._html_setAudio(t),o.html.active=!0):(o.flash.gate=!0,o._flash_setAudio(t),o.flash.active=!0),o.css.jq.videoPlay.length&&o.css.jq.videoPlay.hide(),o.status.video=!1),r=!0,!1}}),r)return!1}),r?(this.status.nativeVideoControls&&this.html.video.gate||!this._validString(t.poster)||(n?this.htmlElement.poster.src=t.poster:this.internal.poster.jq.show()),this.status.srcSet=!0,this.status.media=e.extend({},t),this._updateButtons(!1),this._updateInterface()):this._error({type:e.jPlayer.error.NO_SUPPORT,context:"{supplied:'"+this.options.supplied+"'}",message:e.jPlayer.errorMsg.NO_SUPPORT,hint:e.jPlayer.errorHint.NO_SUPPORT})},_resetMedia:function(){this._resetStatus(),this._updateButtons(!1),this._updateInterface(),this._seeked(),this.internal.poster.jq.hide(),clearTimeout(this.internal.htmlDlyCmdId),this.html.active?this._html_resetMedia():this.flash.active&&this._flash_resetMedia()},clearMedia:function(){this._resetMedia(),this.html.active?this._html_clearMedia():this.flash.active&&this._flash_clearMedia(),this._resetGate(),this._resetActive()},load:function(){this.status.srcSet?this.html.active?this._html_load():this.flash.active&&this._flash_load():this._urlNotSetError("load")},focus:function(){this.options.keyEnabled&&(e.jPlayer.focus=this)},play:function(e){e="number"==typeof e?e:NaN,this.status.srcSet?(this.focus(),this.html.active?this._html_play(e):this.flash.active&&this._flash_play(e)):this._urlNotSetError("play")},videoPlay:function(){this.play()},pause:function(e){e="number"==typeof e?e:NaN,this.status.srcSet?this.html.active?this._html_pause(e):this.flash.active&&this._flash_pause(e):this._urlNotSetError("pause")},tellOthers:function(t,o){var r=this,n="function"==typeof o,i=Array.prototype.slice.call(arguments);"string"==typeof t&&(n&&i.splice(1,1),e.each(this.instances,function(){r.element!==this&&(n&&!o.call(this.data("jPlayer"),r)||this.jPlayer.apply(this,i))}))},pauseOthers:function(e){this.tellOthers("pause",function(){return this.status.srcSet},e)},stop:function(){this.status.srcSet?this.html.active?this._html_pause(0):this.flash.active&&this._flash_pause(0):this._urlNotSetError("stop")},playHead:function(e){e=this._limitValue(e,0,100),this.status.srcSet?this.html.active?this._html_playHead(e):this.flash.active&&this._flash_playHead(e):this._urlNotSetError("playHead")},_muted:function(e){this.mutedWorker(e),this.options.globalVolume&&this.tellOthers("mutedWorker",function(){return this.options.globalVolume},e)},mutedWorker:function(t){this.options.muted=t,this.html.used&&this._html_setProperty("muted",t),this.flash.used&&this._flash_mute(t),this.html.video.gate||this.html.audio.gate||(this._updateMute(t),this._updateVolume(this.options.volume),this._trigger(e.jPlayer.event.volumechange))},mute:function(e){e=e===t||!!e,this._muted(e)},unmute:function(e){e=e===t||!!e,this._muted(!e)},_updateMute:function(e){e===t&&(e=this.options.muted),this.css.jq.mute.length&&this.css.jq.unmute.length&&(this.status.noVolume?(this.css.jq.mute.hide(),this.css.jq.unmute.hide()):e?(this.css.jq.mute.hide(),this.css.jq.unmute.show()):(this.css.jq.mute.show(),this.css.jq.unmute.hide()))},volume:function(e){this.volumeWorker(e),this.options.globalVolume&&this.tellOthers("volumeWorker",function(){return this.options.globalVolume},e)},volumeWorker:function(t){t=this._limitValue(t,0,1),this.options.volume=t,this.html.used&&this._html_setProperty("volume",t),this.flash.used&&this._flash_volume(t),this.html.video.gate||this.html.audio.gate||(this._updateVolume(t),this._trigger(e.jPlayer.event.volumechange))},volumeBar:function(t){if(this.css.jq.volumeBar.length){var o=e(t.currentTarget),r=o.offset(),n=t.pageX-r.left,i=o.width();t=o.height()-t.pageY+r.top,o=o.height(),this.options.verticalVolume?this.volume(t/o):this.volume(n/i)}this.options.muted&&this._muted(!1)},volumeBarValue:function(){},_updateVolume:function(e){e===t&&(e=this.options.volume),e=this.options.muted?0:e,this.status.noVolume?(this.css.jq.volumeBar.length&&this.css.jq.volumeBar.hide(),this.css.jq.volumeBarValue.length&&this.css.jq.volumeBarValue.hide(),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.hide()):(this.css.jq.volumeBar.length&&this.css.jq.volumeBar.show(),this.css.jq.volumeBarValue.length&&(this.css.jq.volumeBarValue.show(),this.css.jq.volumeBarValue[this.options.verticalVolume?"height":"width"](100*e+"%")),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.show())},volumeMax:function(){this.volume(1),this.options.muted&&this._muted(!1)},_cssSelectorAncestor:function(t){var o=this;this.options.cssSelectorAncestor=t,this._removeUiClass(),this.ancestorJq=t?e(t):[],t&&1!==this.ancestorJq.length&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.ancestorJq.length+" found for cssSelectorAncestor.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT}),this._addUiClass(),e.each(this.options.cssSelector,function(e,t){o._cssSelector(e,t)}),this._updateInterface(),this._updateButtons(),this._updateAutohide(),this._updateVolume(),this._updateMute()},_cssSelector:function(t,o){var r=this;"string"==typeof o?e.jPlayer.prototype.options.cssSelector[t]?(this.css.jq[t]&&this.css.jq[t].length&&this.css.jq[t].unbind(".jPlayer"),this.options.cssSelector[t]=o,this.css.cs[t]=this.options.cssSelectorAncestor+" "+o,this.css.jq[t]=o?e(this.css.cs[t]):[],this.css.jq[t].length&&this.css.jq[t].bind("click.jPlayer",function(o){o.preventDefault(),r[t](o),e(this).blur()}),o&&1!==this.css.jq[t].length&&this._warning({type:e.jPlayer.warning.CSS_SELECTOR_COUNT,context:this.css.cs[t],message:e.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.css.jq[t].length+" found for "+t+" method.",hint:e.jPlayer.warningHint.CSS_SELECTOR_COUNT})):this._warning({type:e.jPlayer.warning.CSS_SELECTOR_METHOD,context:t,message:e.jPlayer.warningMsg.CSS_SELECTOR_METHOD,hint:e.jPlayer.warningHint.CSS_SELECTOR_METHOD}):this._warning({type:e.jPlayer.warning.CSS_SELECTOR_STRING,context:o,message:e.jPlayer.warningMsg.CSS_SELECTOR_STRING,hint:e.jPlayer.warningHint.CSS_SELECTOR_STRING})},seekBar:function(t){if(this.css.jq.seekBar.length){var o=e(t.currentTarget),r=o.offset();t=t.pageX-r.left,o=o.width(),this.playHead(100*t/o)}},playBar:function(){},playbackRate:function(e){this._setOption("playbackRate",e)},playbackRateBar:function(t){if(this.css.jq.playbackRateBar.length){var o=e(t.currentTarget),r=o.offset(),n=t.pageX-r.left,i=o.width();t=o.height()-t.pageY+r.top,o=o.height(),this.playbackRate((this.options.verticalPlaybackRate?t/o:n/i)*(this.options.maxPlaybackRate-this.options.minPlaybackRate)+this.options.minPlaybackRate)}},playbackRateBarValue:function(){},_updatePlaybackRate:function(){var e=(this.options.playbackRate-this.options.minPlaybackRate)/(this.options.maxPlaybackRate-this.options.minPlaybackRate);this.status.playbackRateEnabled?(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.show(),this.css.jq.playbackRateBarValue.length&&(this.css.jq.playbackRateBarValue.show(),this.css.jq.playbackRateBarValue[this.options.verticalPlaybackRate?"height":"width"](100*e+"%"))):(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.hide(),this.css.jq.playbackRateBarValue.length&&this.css.jq.playbackRateBarValue.hide())},repeat:function(){this._loop(!0)},repeatOff:function(){this._loop(!1)},_loop:function(t){this.options.loop!==t&&(this.options.loop=t,this._updateButtons(),this._trigger(e.jPlayer.event.repeat))},currentTime:function(){},duration:function(){},gui:function(){},noSolution:function(){},option:function(o,r){var n=o;if(0===arguments.length)return e.extend(!0,{},this.options);if("string"==typeof o){var i=o.split(".");if(r===t){for(var n=e.extend(!0,{},this.options),a=0;a<i.length;a++){if(n[i[a]]===t)return this._warning({type:e.jPlayer.warning.OPTION_KEY,context:o,message:e.jPlayer.warningMsg.OPTION_KEY,hint:e.jPlayer.warningHint.OPTION_KEY}),t;n=n[i[a]]}return n}for(var a=n={},s=0;s<i.length;s++)s<i.length-1?(a[i[s]]={},a=a[i[s]]):a[i[s]]=r}return this._setOptions(n),this},_setOptions:function(t){var o=this;return e.each(t,function(e,t){o._setOption(e,t)}),this},_setOption:function(t,o){var r=this;switch(t){case"volume":this.volume(o);break;case"muted":this._muted(o);break;case"globalVolume":this.options[t]=o;break;case"cssSelectorAncestor":this._cssSelectorAncestor(o);break;case"cssSelector":e.each(o,function(e,t){r._cssSelector(e,t)});break;case"playbackRate":this.options[t]=o=this._limitValue(o,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("playbackRate",o),this._updatePlaybackRate();break;case"defaultPlaybackRate":this.options[t]=o=this._limitValue(o,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("defaultPlaybackRate",o),this._updatePlaybackRate();break;case"minPlaybackRate":this.options[t]=o=this._limitValue(o,.1,this.options.maxPlaybackRate-.1),this._updatePlaybackRate();break;case"maxPlaybackRate":this.options[t]=o=this._limitValue(o,this.options.minPlaybackRate+.1,16),this._updatePlaybackRate();break;case"fullScreen":if(this.options[t]!==o){var n=e.jPlayer.nativeFeatures.fullscreen.used.webkitVideo;(!n||n&&!this.status.waitForPlay)&&(n||(this.options[t]=o),o?this._requestFullscreen():this._exitFullscreen(),n||this._setOption("fullWindow",o))}break;case"fullWindow":this.options[t]!==o&&(this._removeUiClass(),this.options[t]=o,this._refreshSize());break;case"size":this.options.fullWindow||this.options[t].cssClass===o.cssClass||this._removeUiClass(),this.options[t]=e.extend({},this.options[t],o),this._refreshSize();break;case"sizeFull":this.options.fullWindow&&this.options[t].cssClass!==o.cssClass&&this._removeUiClass(),this.options[t]=e.extend({},this.options[t],o),this._refreshSize();break;case"autohide":this.options[t]=e.extend({},this.options[t],o),this._updateAutohide();break;case"loop":this._loop(o);break;case"nativeVideoControls":this.options[t]=e.extend({},this.options[t],o),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this._restrictNativeVideoControls(),this._updateNativeVideoControls();break;case"noFullWindow":this.options[t]=e.extend({},this.options[t],o),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this._restrictNativeVideoControls(),this._updateButtons();break;case"noVolume":this.options[t]=e.extend({},this.options[t],o),this.status.noVolume=this._uaBlocklist(this.options.noVolume),this._updateVolume(),this._updateMute();break;case"emulateHtml":this.options[t]!==o&&((this.options[t]=o)?this._emulateHtmlBridge():this._destroyHtmlBridge());break;case"timeFormat":this.options[t]=e.extend({},this.options[t],o);break;case"keyEnabled":this.options[t]=o,o||this!==e.jPlayer.focus||(e.jPlayer.focus=null);break;case"keyBindings":this.options[t]=e.extend(!0,{},this.options[t],o);break;case"audioFullScreen":this.options[t]=o}return this},_refreshSize:function(){this._setSize(),this._addUiClass(),this._updateSize(),this._updateButtons(),this._updateAutohide(),this._trigger(e.jPlayer.event.resize)},_setSize:function(){this.options.fullWindow?(this.status.width=this.options.sizeFull.width,this.status.height=this.options.sizeFull.height,this.status.cssClass=this.options.sizeFull.cssClass):(this.status.width=this.options.size.width,this.status.height=this.options.size.height,this.status.cssClass=this.options.size.cssClass),this.element.css({width:this.status.width,height:this.status.height})},_addUiClass:function(){this.ancestorJq.length&&this.ancestorJq.addClass(this.status.cssClass)},_removeUiClass:function(){this.ancestorJq.length&&this.ancestorJq.removeClass(this.status.cssClass)},_updateSize:function(){this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),!this.status.waitForPlay&&this.html.active&&this.status.video||this.html.video.available&&this.html.used&&this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):!this.status.waitForPlay&&this.flash.active&&this.status.video&&this.internal.flash.jq.css({width:this.status.width,height:this.status.height})},_updateAutohide:function(){var e=this,t=function(){e.css.jq.gui.fadeIn(e.options.autohide.fadeIn,function(){clearTimeout(e.internal.autohideId),e.internal.autohideId=setTimeout(function(){e.css.jq.gui.fadeOut(e.options.autohide.fadeOut)},e.options.autohide.hold)})};this.css.jq.gui.length&&(this.css.jq.gui.stop(!0,!0),clearTimeout(this.internal.autohideId),this.element.unbind(".jPlayerAutohide"),this.css.jq.gui.unbind(".jPlayerAutohide"),this.status.nativeVideoControls?this.css.jq.gui.hide():this.options.fullWindow&&this.options.autohide.full||!this.options.fullWindow&&this.options.autohide.restored?(this.element.bind("mousemove.jPlayer.jPlayerAutohide",t),this.css.jq.gui.bind("mousemove.jPlayer.jPlayerAutohide",t),this.css.jq.gui.hide()):this.css.jq.gui.show())},fullScreen:function(){this._setOption("fullScreen",!0)},restoreScreen:function(){this._setOption("fullScreen",!1)},_fullscreenAddEventListeners:function(){var t=this,o=e.jPlayer.nativeFeatures.fullscreen;o.api.fullscreenEnabled&&o.event.fullscreenchange&&("function"!=typeof this.internal.fullscreenchangeHandler&&(this.internal.fullscreenchangeHandler=function(){t._fullscreenchange()}),document.addEventListener(o.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1))},_fullscreenRemoveEventListeners:function(){var t=e.jPlayer.nativeFeatures.fullscreen;this.internal.fullscreenchangeHandler&&document.addEventListener(t.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1)},_fullscreenchange:function(){this.options.fullScreen&&!e.jPlayer.nativeFeatures.fullscreen.api.fullscreenElement()&&this._setOption("fullScreen",!1)},_requestFullscreen:function(){var t=this.ancestorJq.length?this.ancestorJq[0]:this.element[0],o=e.jPlayer.nativeFeatures.fullscreen;o.used.webkitVideo&&(t=this.htmlElement.video),o.api.fullscreenEnabled&&o.api.requestFullscreen(t)},_exitFullscreen:function(){var t,o=e.jPlayer.nativeFeatures.fullscreen;o.used.webkitVideo&&(t=this.htmlElement.video),o.api.fullscreenEnabled&&o.api.exitFullscreen(t)},_html_initMedia:function(t){var o=e(this.htmlElement.media).empty();e.each(t.track||[],function(e,t){var r=document.createElement("track");r.setAttribute("kind",t.kind?t.kind:""),r.setAttribute("src",t.src?t.src:""),r.setAttribute("srclang",t.srclang?t.srclang:""),r.setAttribute("label",t.label?t.label:""),t.def&&r.setAttribute("default",t.def),o.append(r)}),this.htmlElement.media.src=this.status.src,"none"!==this.options.preload&&this._html_load(),this._trigger(e.jPlayer.event.timeupdate)},_html_setFormat:function(t){var o=this;e.each(this.formats,function(e,r){if(o.html.support[r]&&t[r])return o.status.src=t[r],o.status.format[r]=!0,o.status.formatType=r,!1})},_html_setAudio:function(e){this._html_setFormat(e),this.htmlElement.media=this.htmlElement.audio,this._html_initMedia(e)},_html_setVideo:function(e){this._html_setFormat(e),this.status.nativeVideoControls&&(this.htmlElement.video.poster=this._validString(e.poster)?e.poster:""),this.htmlElement.media=this.htmlElement.video,this._html_initMedia(e)},_html_resetMedia:function(){this.htmlElement.media&&(this.htmlElement.media.id!==this.internal.video.id||this.status.nativeVideoControls||this.internal.video.jq.css({width:"0px",height:"0px"}),this.htmlElement.media.pause())},_html_clearMedia:function(){this.htmlElement.media&&(this.htmlElement.media.src="about:blank",this.htmlElement.media.load())},_html_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.htmlElement.media.load()),clearTimeout(this.internal.htmlDlyCmdId)},_html_play:function(e){var t=this,o=this.htmlElement.media;if(this._html_load(),isNaN(e))o.play();else{this.internal.cmdsIgnored&&o.play();try{if(o.seekable&&!("object"===a(o.seekable)&&0<o.seekable.length))throw 1;o.currentTime=e,o.play()}catch(o){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.play(e)},250))}}this._html_checkWaitForPlay()},_html_pause:function(e){var t=this,o=this.htmlElement.media;if(0<e?this._html_load():clearTimeout(this.internal.htmlDlyCmdId),o.pause(),!isNaN(e))try{if(o.seekable&&!("object"===a(o.seekable)&&0<o.seekable.length))throw 1;o.currentTime=e}catch(o){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.pause(e)},250))}0<e&&this._html_checkWaitForPlay()},_html_playHead:function(e){var t=this,o=this.htmlElement.media;this._html_load();try{if("object"===a(o.seekable)&&0<o.seekable.length)o.currentTime=e*o.seekable.end(o.seekable.length-1)/100;else{if(!(0<o.duration)||isNaN(o.duration))throw"e";o.currentTime=e*o.duration/100}}catch(o){return void(this.internal.htmlDlyCmdId=setTimeout(function(){t.playHead(e)},250))}this.status.waitForLoad||this._html_checkWaitForPlay()},_html_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})))},_html_setProperty:function(e,t){this.html.audio.available&&(this.htmlElement.audio[e]=t),this.html.video.available&&(this.htmlElement.video[e]=t)},_flash_setAudio:function(t){var o=this;try{e.each(this.formats,function(e,r){if(o.flash.support[r]&&t[r]){switch(r){case"m4a":case"fla":o._getMovie().fl_setAudio_m4a(t[r]);break;case"mp3":o._getMovie().fl_setAudio_mp3(t[r]);break;case"rtmpa":o._getMovie().fl_setAudio_rtmp(t[r])}return o.status.src=t[r],o.status.format[r]=!0,o.status.formatType=r,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(e){this._flashError(e)}},_flash_setVideo:function(t){var o=this;try{e.each(this.formats,function(e,r){if(o.flash.support[r]&&t[r]){switch(r){case"m4v":case"flv":o._getMovie().fl_setVideo_m4v(t[r]);break;case"rtmpv":o._getMovie().fl_setVideo_rtmp(t[r])}return o.status.src=t[r],o.status.format[r]=!0,o.status.formatType=r,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(e){this._flashError(e)}},_flash_resetMedia:function(){this.internal.flash.jq.css({width:"0px",height:"0px"}),this._flash_pause(NaN)},_flash_clearMedia:function(){try{this._getMovie().fl_clearMedia()}catch(e){this._flashError(e)}},_flash_load:function(){try{this._getMovie().fl_load()}catch(e){this._flashError(e)}this.status.waitForLoad=!1},_flash_play:function(e){try{this._getMovie().fl_play(e)}catch(e){this._flashError(e)}this.status.waitForLoad=!1,this._flash_checkWaitForPlay()},_flash_pause:function(e){try{this._getMovie().fl_pause(e)}catch(e){this._flashError(e)}0<e&&(this.status.waitForLoad=!1,this._flash_checkWaitForPlay())},_flash_playHead:function(e){try{this._getMovie().fl_play_head(e)}catch(e){this._flashError(e)}this.status.waitForLoad||this._flash_checkWaitForPlay()},_flash_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.flash.jq.css({width:this.status.width,height:this.status.height})))},_flash_volume:function(e){try{this._getMovie().fl_volume(e)}catch(e){this._flashError(e)}},_flash_mute:function(e){try{this._getMovie().fl_mute(e)}catch(e){this._flashError(e)}},_getMovie:function(){return document[this.internal.flash.id]},_getFlashPluginVersion:function(){var e,t=0;if(window.ActiveXObject)try{if(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){var o=e.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),t=parseInt(o[0],10)+"."+parseInt(o[1],10))}}catch(e){}else navigator.plugins&&0<navigator.mimeTypes.length&&(e=navigator.plugins["Shockwave Flash"])&&(t=navigator.plugins["Shockwave Flash"].description.replace(/.*\s(\d+\.\d+).*/,"$1"));return 1*t},_checkForFlash:function(e){var t=!1;return this._getFlashPluginVersion()>=e&&(t=!0),t},_validString:function(e){return e&&"string"==typeof e},_limitValue:function(e,t,o){return e<t?t:e>o?o:e},_urlNotSetError:function(t){this._error({type:e.jPlayer.error.URL_NOT_SET,context:t,message:e.jPlayer.errorMsg.URL_NOT_SET,hint:e.jPlayer.errorHint.URL_NOT_SET})},_flashError:function(t){var o;o=this.internal.ready?"FLASH_DISABLED":"FLASH",this._error({type:e.jPlayer.error[o],context:this.internal.flash.swf,message:e.jPlayer.errorMsg[o]+t.message,hint:e.jPlayer.errorHint[o]}),this.internal.flash.jq.css({width:"1px",height:"1px"})},_error:function(t){this._trigger(e.jPlayer.event.error,t),this.options.errorAlerts&&this._alert("Error!"+(t.message?"\n"+t.message:"")+(t.hint?"\n"+t.hint:"")+"\nContext: "+t.context)},_warning:function(o){this._trigger(e.jPlayer.event.warning,t,o),this.options.warningAlerts&&this._alert("Warning!"+(o.message?"\n"+o.message:"")+(o.hint?"\n"+o.hint:"")+"\nContext: "+o.context)},_alert:function(e){e="jPlayer "+this.version.script+" : id='"+this.internal.self.id+"' : "+e,this.options.consoleAlerts?console&&console.log&&console.log(e):alert(e)},_emulateHtmlBridge:function(){var t=this;e.each(e.jPlayer.emulateMethods.split(/\s+/g),function(e,o){t.internal.domNode[o]=function(e){t[o](e)}}),e.each(e.jPlayer.event,function(o,r){var n=!0;e.each(e.jPlayer.reservedEvent.split(/\s+/g),function(e,t){if(t===o)return n=!1}),n&&t.element.bind(r+".jPlayer.jPlayerHtml",function(){t._emulateHtmlUpdate();var e=document.createEvent("Event");e.initEvent(o,!1,!0),t.internal.domNode.dispatchEvent(e)})})},_emulateHtmlUpdate:function(){var t=this;e.each(e.jPlayer.emulateStatus.split(/\s+/g),function(e,o){t.internal.domNode[o]=t.status[o]}),e.each(e.jPlayer.emulateOptions.split(/\s+/g),function(e,o){t.internal.domNode[o]=t.options[o]})},_destroyHtmlBridge:function(){var t=this;this.element.unbind(".jPlayerHtml"),e.each((e.jPlayer.emulateMethods+" "+e.jPlayer.emulateStatus+" "+e.jPlayer.emulateOptions).split(/\s+/g),function(e,o){delete t.internal.domNode[o]})}},e.jPlayer.error={FLASH:"e_flash",FLASH_DISABLED:"e_flash_disabled",NO_SOLUTION:"e_no_solution",NO_SUPPORT:"e_no_support",URL:"e_url",URL_NOT_SET:"e_url_not_set",VERSION:"e_version"},e.jPlayer.errorMsg={FLASH:"jPlayer's Flash fallback is not configured correctly, or a command was issued before the jPlayer Ready event. Details: ",FLASH_DISABLED:"jPlayer's Flash fallback has been disabled by the browser due to the CSS rules you have used. Details: ",NO_SOLUTION:"No solution can be found by jPlayer in this browser. Neither HTML nor Flash can be used.",NO_SUPPORT:"It is not possible to play any media format provided in setMedia() on this browser using your current options.",URL:"Media URL could not be loaded.",URL_NOT_SET:"Attempt to issue media playback commands, while no media url is set.",VERSION:"jPlayer "+e.jPlayer.prototype.version.script+" needs Jplayer.swf version "+e.jPlayer.prototype.version.needFlash+" but found "},e.jPlayer.errorHint={FLASH:"Check your swfPath option and that Jplayer.swf is there.",FLASH_DISABLED:"Check that you have not display:none; the jPlayer entity or any ancestor.",NO_SOLUTION:"Review the jPlayer options: support and supplied.",NO_SUPPORT:"Video or audio formats defined in the supplied option are missing.",URL:"Check media URL is valid.",URL_NOT_SET:"Use setMedia() to set the media URL.",VERSION:"Update jPlayer files."},e.jPlayer.warning={CSS_SELECTOR_COUNT:"e_css_selector_count",CSS_SELECTOR_METHOD:"e_css_selector_method",CSS_SELECTOR_STRING:"e_css_selector_string",OPTION_KEY:"e_option_key"},e.jPlayer.warningMsg={CSS_SELECTOR_COUNT:"The number of css selectors found did not equal one: ",CSS_SELECTOR_METHOD:"The methodName given in jPlayer('cssSelector') is not a valid jPlayer method.",CSS_SELECTOR_STRING:"The methodCssSelector given in jPlayer('cssSelector') is not a String or is empty.",OPTION_KEY:"The option requested in jPlayer('option') is undefined."},e.jPlayer.warningHint={CSS_SELECTOR_COUNT:"Check your css selector and the ancestor.",CSS_SELECTOR_METHOD:"Check your method name.",CSS_SELECTOR_STRING:"Check your css selector is a string.",OPTION_KEY:"Check your option name."}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){"use strict";Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}},Date.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,o=Date.CultureInfo.abbreviatedMonthNames,r=e.toLowerCase(),n=0;n<t.length;n++)if(t[n].toLowerCase()==r||o[n].toLowerCase()==r)return n;return-1},Date.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,o=Date.CultureInfo.abbreviatedDayNames,r=(Date.CultureInfo.shortestDayNames,e.toLowerCase()),n=0;n<t.length;n++)if(t[n].toLowerCase()==r||o[n].toLowerCase()==r)return n;return-1},Date.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.getTimezoneOffset=function(e,t){return t?Date.CultureInfo.abbreviatedTimeZoneDST[e.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[e.toUpperCase()]},Date.getTimezoneAbbreviation=function(e,t){var o,r=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(o in r)if(r[o]===e)return o;return null},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.compareTo=function(e){if(isNaN(this))throw new Error(this);if(e instanceof Date&&!isNaN(e))return this>e?1:this<e?-1:0;throw new TypeError(e)},Date.prototype.equals=function(e){return 0===this.compareTo(e)},Date.prototype.between=function(e,t){var o=this.getTime();return o>=e.getTime()&&o<=t.getTime()},Date.prototype.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},Date.prototype.addSeconds=function(e){return this.addMilliseconds(1e3*e)},Date.prototype.addMinutes=function(e){return this.addMilliseconds(6e4*e)},Date.prototype.addHours=function(e){return this.addMilliseconds(36e5*e)},Date.prototype.addDays=function(e){return this.addMilliseconds(864e5*e)},Date.prototype.addWeeks=function(e){return this.addMilliseconds(6048e5*e)},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this},Date.prototype.addYears=function(e){return this.addMonths(12*e)},Date.prototype.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return(t.millisecond||t.milliseconds)&&this.addMilliseconds(t.millisecond||t.milliseconds),(t.second||t.seconds)&&this.addSeconds(t.second||t.seconds),(t.minute||t.minutes)&&this.addMinutes(t.minute||t.minutes),(t.hour||t.hours)&&this.addHours(t.hour||t.hours),(t.month||t.months)&&this.addMonths(t.month||t.months),(t.year||t.years)&&this.addYears(t.year||t.years),(t.day||t.days)&&this.addDays(t.day||t.days),this},Date._validate=function(e,t,o,r){if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(e<t||e>o)throw new RangeError(e+" is not a valid value for "+r+".");return!0},Date.validateMillisecond=function(e){return Date._validate(e,0,999,"milliseconds")},Date.validateSecond=function(e){return Date._validate(e,0,59,"seconds")},Date.validateMinute=function(e){return Date._validate(e,0,59,"minutes")},Date.validateHour=function(e){return Date._validate(e,0,23,"hours")},Date.validateDay=function(e,t,o){return Date._validate(e,1,Date.getDaysInMonth(t,o),"days")},Date.validateMonth=function(e){return Date._validate(e,0,11,"months")},Date.validateYear=function(e){return Date._validate(e,1,9999,"seconds")},Date.prototype.set=function(e){var t=e;return t.millisecond||0===t.millisecond||(t.millisecond=-1),t.second||0===t.second||(t.second=-1),t.minute||0===t.minute||(t.minute=-1),t.hour||0===t.hour||(t.hour=-1),t.day||0===t.day||(t.day=-1),t.month||0===t.month||(t.month=-1),t.year||0===t.year||(t.year=-1),-1!=t.millisecond&&Date.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),-1!=t.second&&Date.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),-1!=t.minute&&Date.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),-1!=t.hour&&Date.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),-1!==t.month&&Date.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),-1!=t.year&&Date.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),-1!=t.day&&Date.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return e%4==0&&e%100!=0||e%400==0},Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})},Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})},Date.prototype.moveToDayOfWeek=function(e,t){var o=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===o?o+=7*(t||1):o)},Date.prototype.moveToMonth=function(e,t){var o=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===o?o+=12*(t||1):o)},Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)},Date.prototype.getWeekOfYear=function(e){var t=this.getFullYear(),o=this.getMonth(),r=this.getDate(),n=e||Date.CultureInfo.firstDayOfWeek,i=8-new Date(t,0,1).getDay();8==i&&(i=1);var a=(Date.UTC(t,o,r,0,0,0)-Date.UTC(t,0,1,0,0,0))/864e5+1,s=Math.floor((a-i+7)/7);if(s===n){t--;var l=8-new Date(t,0,1).getDay();s=2==l||8==l?53:52}return s},Date.prototype.isDST=function(){return console.log("isDST"),"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]},Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())},Date.prototype.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),o=-6*Number(e)/10;return this.addMinutes(o-t),this},Date.prototype.setTimezone=function(e){return this.setTimezoneOffset(Date.getTimezoneOffset(e))},Date.prototype.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return t<0?(e=(t-1e4).toString())[0]+e.substr(2):"+"+(e=(t+1e4).toString()).substr(1)},Date.prototype.getDayName=function(e){return e?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]},Date.prototype.getMonthName=function(e){return e?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]},Date.prototype._toString=Date.prototype.toString,Date.prototype.toString=function(e){var t=this,o=function(e){return 1==e.toString().length?"0"+e:e};return e?e.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(e){switch(e){case"hh":return o(t.getHours()<13?t.getHours():t.getHours()-12);case"h":return t.getHours()<13?t.getHours():t.getHours()-12;case"HH":return o(t.getHours());case"H":return t.getHours();case"mm":return o(t.getMinutes());case"m":return t.getMinutes();case"ss":return o(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return t.getFullYear();case"yy":return t.getFullYear().toString().substring(2,4);case"dddd":return t.getDayName();case"ddd":return t.getDayName(!0);case"dd":return o(t.getDate());case"d":return t.getDate().toString();case"MMMM":return t.getMonthName();case"MMM":return t.getMonthName(!0);case"MM":return o(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()},Date.now=function(){return new Date},Date.today=function(){return Date.now().clearTime()},Date.prototype._orient=1,Date.prototype.next=function(){return this._orient=1,this},Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){return this._orient=-1,this},Date.prototype._is=!1,Date.prototype.is=function(){return this._is=!0,this},Number.prototype._dateElement="day",Number.prototype.fromNow=function(){var e={};return e[this._dateElement]=this,Date.now().add(e)},Number.prototype.ago=function(){var e={};return e[this._dateElement]=-1*this,Date.now().add(e)},function(){for(var e,t=Date.prototype,o=Number.prototype,r="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),n="january february march april may june july august september october november december".split(/\s/),i="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),a=function(e){return function(){return this._is?(this._is=!1,this.getDay()==e):this.moveToDayOfWeek(e,this._orient)}},s=0;s<r.length;s++)t[r[s]]=t[r[s].substring(0,3)]=a(s);for(var l=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},c=0;c<n.length;c++)t[n[c]]=t[n[c].substring(0,3)]=l(c);for(var u=function(e){return function(){return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},d=function(e){return function(){return this._dateElement=e,this}},p=0;p<i.length;p++)t[e=i[p].toLowerCase()]=t[e+"s"]=u(i[p]),o[e]=o[e+"s"]=d(e)}(),Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")},Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)},Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)},Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)},Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)},Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(o){var r=o.match(t);if(r)return[r[0],o.substring(r[0].length)];throw new e.Exception(o)}},token:function(e){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var o=[],r=null;t.length;){try{r=e.call(this,t)}catch(e){o.push(r[0]),t=r[1];continue}break}return[o,t]}},many:function(e){return function(t){for(var o=[],r=null;t.length;){try{r=e.call(this,t)}catch(e){return[o,t]}o.push(r[0]),t=r[1]}return[o,t]}},optional:function(e){return function(t){var o=null;try{o=e.call(this,t)}catch(e){return[null,t]}return[o[0],o[1]]}},not:function(t){return function(o){try{t.call(this,o)}catch(e){return[null,o]}throw new e.Exception(o)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var e=arguments[0],o=Array.prototype.slice.call(arguments,1),r=[],n=0;n<e.length;n++)r.push(t.each(e[n],o));return r},cache:function(t){var o={},r=null;return function(n){try{r=o[n]=o[n]||t.call(this,n)}catch(e){r=o[n]=e}if(r instanceof e.Exception)throw r;return r}},any:function(){var t=arguments;return function(o){for(var r=null,n=0;n<t.length;n++)if(null!=t[n]){try{r=t[n].call(this,o)}catch(e){r=null}if(r)return r}throw new e.Exception(o)}},each:function(){var t=arguments;return function(o){for(var r=[],n=null,i=0;i<t.length;i++)if(null!=t[i]){try{n=t[i].call(this,o)}catch(t){throw new e.Exception(o)}r.push(n[0]),o=n[1]}return[r,o]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(o,r,n){return r=r||t.rtoken(/^\s*/),n=n||null,1==o.length?o[0]:function(t){for(var i=null,a=null,s=[],l=0;l<o.length;l++){try{i=o[l].call(this,t)}catch(e){break}s.push(i[0]);try{a=r.call(this,i[1])}catch(e){a=null;break}t=a[1]}if(!i)throw new e.Exception(t);if(a)throw new e.Exception(a[1]);if(n)try{i=n.call(this,i[1])}catch(t){throw new e.Exception(i[1])}return[s,i?i[1]:t]}},between:function(e,o,n){n=n||e;var i=t.each(t.ignore(e),o,t.ignore(n));return function(e){var t=i.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,o,r){return o=o||t.rtoken(/^\s*/),r=r||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(o)),e.slice(-1),t.ignore(r)):t.each(t.many(t.each(e,t.ignore(o))),px,t.ignore(r))},set:function(o,r,n){return r=r||t.rtoken(/^\s*/),n=n||null,function(i){for(var a=null,s=null,l=null,c=null,u=[[],i],d=!1,p=0;p<o.length;p++){l=null,s=null,a=null,d=1==o.length;try{a=o[p].call(this,i)}catch(e){continue}if(c=[[a[0]],a[1]],a[1].length>0&&!d)try{l=r.call(this,a[1])}catch(e){d=!0}else d=!0;if(d||0!==l[1].length||(d=!0),!d){for(var f=[],h=0;h<o.length;h++)p!=h&&f.push(o[h]);(s=t.set(f,r).call(this,l[1]))[0].length>0&&(c[0]=c[0].concat(s[0]),c[1]=s[1])}if(c[1].length<u[1].length&&(u=c),0===u[1].length)break}if(0===u[0].length)return u;if(n){try{l=n.call(this,u[1])}catch(t){throw new e.Exception(u[1])}u[1]=l[1]}return u}},forward:function(e,t){return function(o){return e[t].call(this,o)}},replace:function(e,t){return function(o){var r=e.call(this,o);return[t,r[1]]}},process:function(e,t){return function(o){var r=e.call(this,o);return[t.call(this,r[0]),r[1]]}},min:function(t,o){return function(r){var n=o.call(this,r);if(n[0].length<t)throw new e.Exception(r);return n}}},o=function(e){return function(){var t=null,o=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var r=0,n=t.shift();r<n.length;r++)return t.unshift(n[r]),o.push(e.apply(null,t)),t.shift(),o}},n="optional not ignore cache".split(/\s/),i=0;i<n.length;i++)t[n[i]]=o(t[n[i]]);for(var a=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),l=0;l<s.length;l++)t[s[l]]=a(t[s[l]])}(),function(){Date.Grammar={},Date.Translator={hour:function(e){return function(){this.hour=Number(e)}},minute:function(e){return function(){this.minute=Number(e)}},second:function(e){return function(){this.second=Number(e)}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?Date.getMonthNumberFromName(e):Number(e)-1}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(e){e=e instanceof Array?e:[e];var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth(),this.day=1,this.hour=0,this.minute=0,this.second=0;for(var o=0;o<e.length;o++)e[o]&&e[o].call(this);if(this.hour="p"==this.meridian&&this.hour<13?this.hour+12:this.hour,this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(e){if(0===(e=e instanceof Array?function e(t){for(var o=[],r=0;r<t.length;r++)t[r]instanceof Array?o=o.concat(e(t[r])):t[r]&&o.push(t[r]);return o}(e):[e]).length)return null;for(var t=0;t<e.length;t++)"function"==typeof e[t]&&e[t].call(this);if(this.now)return new Date;var o,r,n,i=Date.today();return!(null==this.days&&!this.orient&&!this.operator)?(n="past"==this.orient||"subtract"==this.operator?-1:1,this.weekday&&(this.unit="day",o=Date.getDayNumberFromName(this.weekday)-i.getDay(),r=7,this.days=o?(o+n*r)%r:n*r),this.month&&(this.unit="month",o=this.month-i.getMonth(),r=12,this.months=o?(o+n*r)%r:n*r,this.month=null),this.unit||(this.unit="day"),null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value=7*this.value),this[this.unit+"s"]=this.value*n),i.add(this)):(this.meridian&&this.hour&&(this.hour=this.hour<13&&"p"==this.meridian?this.hour+12:this.hour),this.weekday&&!this.day&&(this.day=i.addDays(Date.getDayNumberFromName(this.weekday)-i.getDay()).getDate()),this.month&&!this.day&&(this.day=1),i.set(this))}};var e,t=Date.Parsing.Operators,o=Date.Grammar,r=Date.Translator;o.datePartDelimiter=t.rtoken(/^([\s\-\.\,\/\x27]+)/),o.timePartDelimiter=t.stoken(":"),o.whiteSpace=t.rtoken(/^\s*/),o.generalDelimiter=t.rtoken(/^(([\s\,]|at|on)+)/);var n={};o.ctoken=function(e){var o=n[e];if(!o){for(var r=Date.CultureInfo.regexPatterns,i=e.split(/\s+/),a=[],s=0;s<i.length;s++)a.push(t.replace(t.rtoken(r[i[s]]),i[s]));o=n[e]=t.any.apply(null,a)}return o},o.ctoken2=function(e){return t.rtoken(Date.CultureInfo.regexPatterns[e])},o.h=t.cache(t.process(t.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),r.hour)),o.hh=t.cache(t.process(t.rtoken(/^(0[0-9]|1[0-2])/),r.hour)),o.H=t.cache(t.process(t.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),r.hour)),o.HH=t.cache(t.process(t.rtoken(/^([0-1][0-9]|2[0-3])/),r.hour)),o.m=t.cache(t.process(t.rtoken(/^([0-5][0-9]|[0-9])/),r.minute)),o.mm=t.cache(t.process(t.rtoken(/^[0-5][0-9]/),r.minute)),o.s=t.cache(t.process(t.rtoken(/^([0-5][0-9]|[0-9])/),r.second)),o.ss=t.cache(t.process(t.rtoken(/^[0-5][0-9]/),r.second)),o.hms=t.cache(t.sequence([o.H,o.mm,o.ss],o.timePartDelimiter)),o.t=t.cache(t.process(o.ctoken2("shortMeridian"),r.meridian)),o.tt=t.cache(t.process(o.ctoken2("longMeridian"),r.meridian)),o.z=t.cache(t.process(t.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),r.timezone)),o.zz=t.cache(t.process(t.rtoken(/^(\+|\-)\s*\d\d\d\d/),r.timezone)),o.zzz=t.cache(t.process(o.ctoken2("timezone"),r.timezone)),o.timeSuffix=t.each(t.ignore(o.whiteSpace),t.set([o.tt,o.zzz])),o.time=t.each(t.optional(t.ignore(t.stoken("T"))),o.hms,o.timeSuffix),o.d=t.cache(t.process(t.each(t.rtoken(/^([0-2]\d|3[0-1]|\d)/),t.optional(o.ctoken2("ordinalSuffix"))),r.day)),o.dd=t.cache(t.process(t.each(t.rtoken(/^([0-2]\d|3[0-1])/),t.optional(o.ctoken2("ordinalSuffix"))),r.day)),o.ddd=o.dddd=t.cache(t.process(o.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),o.M=t.cache(t.process(t.rtoken(/^(1[0-2]|0\d|\d)/),r.month)),o.MM=t.cache(t.process(t.rtoken(/^(1[0-2]|0\d)/),r.month)),o.MMM=o.MMMM=t.cache(t.process(o.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),r.month)),o.y=t.cache(t.process(t.rtoken(/^(\d\d?)/),r.year)),o.yy=t.cache(t.process(t.rtoken(/^(\d\d)/),r.year)),o.yyy=t.cache(t.process(t.rtoken(/^(\d\d?\d?\d?)/),r.year)),o.yyyy=t.cache(t.process(t.rtoken(/^(\d\d\d\d)/),r.year)),e=function(){return t.each(t.any.apply(null,arguments),t.not(o.ctoken2("timeContext")))},o.day=e(o.d,o.dd),o.month=e(o.M,o.MMM),o.year=e(o.yyyy,o.yy),o.orientation=t.process(o.ctoken("past future"),function(e){return function(){this.orient=e}}),o.operator=t.process(o.ctoken("add subtract"),function(e){return function(){this.operator=e}}),o.rday=t.process(o.ctoken("yesterday tomorrow today now"),r.rday),o.unit=t.process(o.ctoken("minute hour day week month year"),function(e){return function(){this.unit=e}}),o.value=t.process(t.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),o.expression=t.set([o.rday,o.operator,o.value,o.unit,o.orientation,o.ddd,o.MMM]),e=function(){return t.set(arguments,o.datePartDelimiter)},o.mdy=e(o.ddd,o.month,o.day,o.year),o.ymd=e(o.ddd,o.year,o.month,o.day),o.dmy=e(o.ddd,o.day,o.month,o.year),o.date=function(e){return(o[Date.CultureInfo.dateElementOrder]||o.mdy).call(this,e)},o.format=t.process(t.many(t.any(t.process(t.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(e){if(o[e])return o[e];throw Date.Parsing.Exception(e)}),t.process(t.rtoken(/^[^dMyhHmstz]+/),function(e){return t.ignore(t.stoken(e))}))),function(e){return t.process(t.each.apply(null,e),r.finishExact)});var i={},a=function(e){return i[e]=i[e]||o.format(e)[0]};o.formats=function(e){if(e instanceof Array){for(var o=[],r=0;r<e.length;r++)o.push(a(e[r]));return t.any.apply(null,o)}return a(e)},o._formats=o.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]),o._start=t.process(t.set([o.date,o.time,o.expression],o.generalDelimiter,o.whiteSpace),r.finish),o.start=function(e){try{var t=o._formats.call({},e);if(0===t[1].length)return t}catch(e){}return o._start.call({},e)}}(),Date._parse=Date.parse,Date.parse=function(e){var t=null;if(!e)return null;try{t=Date.Grammar.start.call({},e)}catch(e){return null}return 0===t[1].length?t[0]:null},Date.getParseFunction=function(e){var t=Date.Grammar.formats(e);return function(e){var o=null;try{o=t.call({},e)}catch(e){return null}return 0===o[1].length?o[0]:null}},Date.parseExact=function(e,t){return Date.getParseFunction(t)(e)}},function(e,t,o){!function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var o=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(r)}}if(e.support.touch="ontouchend"in document,e.support.touch){var o,r=e.ui.mouse.prototype,n=r._mouseInit,i=r._mouseDestroy;r._touchStart=function(e){!o&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(o=!0,this._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},r._touchMove=function(e){o&&(this._touchMoved=!0,t(e,"mousemove"))},r._touchEnd=function(e){o&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),o=!1)},r._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),n.call(t)},r._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),i.call(t)}}}(o(9))},function(module,exports,__webpack_require__){var jQuery=__webpack_require__(9);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _qq=_qq||{},_qq=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o),function(){_qq(e).detach(t,o)}},detach:function(t,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.attachEvent&&e.detachEvent("on"+t,o),this},contains:function(t){return e==t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){return null!=t.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),_qq.extend(e.style,t),this},hasClass:function(t){return new RegExp("(^| )"+t+"( |$)").test(e.className)},addClass:function(t){return _qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var o=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(o," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var o=[],r=e.getElementsByTagName("*"),n=r.length,i=0;i<n;i++)_qq(r[i]).hasClass(t)&&o.push(r[i]);return o},children:function(){for(var t=[],o=e.firstChild;o;)1==o.nodeType&&t.push(o),o=o.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return _qq(e).setText("")}}};_qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},_qq.isObject=function(e){"use strict";return null!==e&&e&&"object"===_typeof(e)&&e.constructor===Object},_qq.extend=function(e,t,o){"use strict";var r;for(r in t)t.hasOwnProperty(r)&&(o&&_qq.isObject(t[r])?(void 0===e[r]&&(e[r]={}),_qq.extend(e[r],t[r],!0)):e[r]=t[r])},_qq.indexOf=function(e,t,o){if(e.indexOf)return e.indexOf(t,o);o=o||0;var r=e.length;for(o<0&&(o+=r);o<r;o++)if(o in e&&e[o]===t)return o;return-1},_qq.getUniqueId=function(){var e=0;return function(){return e++}}(),_qq.ie=function(){return-1!=navigator.userAgent.indexOf("MSIE")},_qq.ie10=function(){return-1!=navigator.userAgent.indexOf("MSIE 10")},_qq.safari=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Apple")},_qq.chrome=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Google")},_qq.firefox=function(){return-1!=navigator.userAgent.indexOf("Mozilla")&&void 0!=navigator.vendor&&""==navigator.vendor},_qq.windows=function(){return"Win32"==navigator.platform},_qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},_qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var o=e.firstChild;return e.removeChild(o),o}}(),_qq.obj2url=function(e,t,o){var r=[],n="&",i=function(e,o){var n=t?/\[\]$/.test(t)?t:t+"["+o+"]":o;"undefined"!=n&&"undefined"!=o&&r.push("object"===_typeof(e)?_qq.obj2url(e,n,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(n)+"="+encodeURIComponent(e()):encodeURIComponent(n)+"="+encodeURIComponent(e))};if(!o&&t)n=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(_qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&void 0!==e)for(var a=0,s=e.length;a<s;++a)i(e[a],a);else if(void 0!==e&&null!==e&&"object"===_typeof(e))for(var a in e)i(e[a],a);else r.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return t?r.join(n):r.join(n).replace(/^&/,"").replace(/%20/g,"+")},_qq.DisposeSupport={_disposers:[],dispose:function(){for(var e;e=this._disposers.shift();)e()},addDisposer:function(e){this._disposers.push(e)},_attach:function(){this.addDisposer(_qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))}},_qq.UploadButton=function(e){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},_qq.extend(this._options,e),_qq.extend(this,_qq.DisposeSupport),this._element=this._options.element,_qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},_qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&_qq(this._input).remove(),_qq(this._element).removeClass(this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),this._options.acceptFiles&&e.setAttribute("accept",this._options.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),_qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return this._attach(e,"change",function(){t._options.onChange(e)}),this._attach(e,"mouseover",function(){_qq(t._element).addClass(t._options.hoverClass)}),this._attach(e,"mouseout",function(){_qq(t._element).removeClass(t._options.hoverClass)}),this._attach(e,"focus",function(){_qq(t._element).addClass(t._options.focusClass)}),this._attach(e,"blur",function(){_qq(t._element).removeClass(t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},_qq.FineUploaderBasic=function(e){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},customHeaders:{},forceMultipart:!1,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:!0},callbacks:{onSubmit:function(e,t){},onComplete:function(e,t,o){},onCancel:function(e,t){},onUpload:function(e,t,o){},onProgress:function(e,t,o,r){},onError:function(e,t,o){},onAutoRetry:function(e,t,o){},onManualRetry:function(e,t){},onValidate:function(e){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"}},_qq.extend(this._options,e,!0),this._wrapCallbacks(),_qq.extend(this,_qq.DisposeSupport),this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},_qq.FineUploaderBasic.prototype={log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&_qq.log("[FineUploader] "+e,t):_qq.log("[FineUploader] "+e)},setParams:function(e){this._options.request.params=e},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){"use strict";for(;this._storedFileIds.length;)this._filesInProgress++,this._handler.upload(this._storedFileIds.shift(),this._options.request.params)},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(e){return!!this._onBeforeManualRetry(e)&&(this._handler.retry(e),!0)},cancel:function(e){this._handler.cancel(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset()},_createUploadButton:function(e){var t=this,o=new _qq.UploadButton({element:e,multiple:this._options.multiple&&_qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(e){t._onInputChange(e)}});return this.addDisposer(function(){o.dispose()}),o},_createUploadHandler:function(){var e,t=this;return e=_qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm",new _qq[e]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,onProgress:function(e,o,r,n){t._onProgress(e,o,r,n),t._options.callbacks.onProgress(e,o,r,n)},onComplete:function(e,o,r,n){t._onComplete(e,o,r,n),t._options.callbacks.onComplete(e,o,r)},onCancel:function(e,o){t._onCancel(e,o),t._options.callbacks.onCancel(e,o)},onUpload:function(e,o,r){t._onUpload(e,o,r),t._options.callbacks.onUpload(e,o,r)},onAutoRetry:function(e,o,r,n){return t._preventRetries[e]=r[t._options.retry.preventRetryResponseProperty],!!t._shouldAutoRetry(e,o,r)&&(t._maybeParseAndSendUploadError(e,o,r,n),t._options.callbacks.onAutoRetry(e,o,t._autoRetries[e]+1),t._onBeforeAutoRetry(e,o),t._retryTimeouts[e]=setTimeout(function(){t._onAutoRetry(e,o,r)},1e3*t._options.retry.autoAttemptDelay),!0)}})},_preventLeaveInProgress:function(){var e=this;this._attach(window,"beforeunload",function(t){if(e._filesInProgress)return(t=t||window.event).returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_onSubmit:function(e,t){this._options.autoUpload&&this._filesInProgress++},_onProgress:function(e,t,o,r){},_onComplete:function(e,t,o,r){this._filesInProgress--,this._maybeParseAndSendUploadError(e,t,o,r)},_onCancel:function(e,t){clearTimeout(this._retryTimeouts[e]);var o=_qq.indexOf(this._storedFileIds,e);this._options.autoUpload||o<0?this._filesInProgress--:this._options.autoUpload||this._storedFileIds.splice(o,1)},_onUpload:function(e,t,o){},_onInputChange:function(e){this._handler instanceof _qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t,o){this.log("Retrying "+t+"..."),this._autoRetries[e]++,this._handler.retry(e)},_shouldAutoRetry:function(e,t,o){return!(this._preventRetries[e]||!this._options.retry.enableAuto)&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)},_onBeforeManualRetry:function(e){if(this._preventRetries[e])return this.log("Retries are forbidden for id "+e,"warn"),!1;if(this._handler.isValid(e)){var t=this._handler.getName(e);return!1!==this._options.callbacks.onManualRetry(e,t)&&(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),this._filesInProgress++,!0)}return this.log("'"+e+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(e,t,o,r){if(!o.success)if(r&&200!==r.status&&!o.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status);else{var n=o.error?o.error:"Upload failure reason unknown";this._options.callbacks.onError(e,t,n)}},_uploadFileList:function(e){var t,o,r;if((t=this._getValidationDescriptors(e)).length>1&&(r=!1===this._options.callbacks.onValidate(t)),!r)if(e.length>0){for(o=0;o<e.length;o++)if(this._validateFile(e[o]))this._uploadFile(e[o]);else if(this._options.validation.stopOnFirstInvalidFile)return}else this._error("noFilesError","")},_uploadFile:function(e){var t=this._handler.add(e),o=this._handler.getName(t);!1!==this._options.callbacks.onSubmit(t,o)&&(this._onSubmit(t,o),this._options.autoUpload?this._handler.upload(t,this._options.request.params):this._storeFileForLater(t))},_storeFileForLater:function(e){this._storedFileIds.push(e)},_validateFile:function(e){var t,o,r;return o=(t=this._getValidationDescriptor(e)).name,r=t.size,!1!==this._options.callbacks.onValidate([t])&&(this._isAllowedExtension(o)?0===r?(this._error("emptyError",o),!1):r&&this._options.validation.sizeLimit&&r>this._options.validation.sizeLimit?(this._error("sizeError",o),!1):!(r&&r<this._options.validation.minSizeLimit)||(this._error("minSizeError",o),!1):(this._error("typeError",o),!1))},_error:function(e,t){var o=this._options.messages[e];function r(e,t){o=o.replace(e,t)}var n=this._options.validation.allowedExtensions.join(", ");return r("{file}",this._formatFileName(t)),r("{extensions}",n),r("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),r("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit)),this._options.callbacks.onError(null,t,o),o},_formatFileName:function(e){return e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",o=this._options.validation.allowedExtensions;if(!o.length)return!0;for(var r=0;r<o.length;r++)if(o[r].toLowerCase()==t)return!0;return!1},_formatSize:function(e){var t=-1;do{e/=1024,t++}while(e>99);return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]},_wrapCallbacks:function(){var e,t;for(var o in e=this,t=function(t,o,r){try{return o.apply(e,r)}catch(o){e.log("Caught exception in '"+t+"' callback - "+o,"error")}},this._options.callbacks)!function(){var r=e._options.callbacks[o];e._options.callbacks[o]=function(){return t(o,r,arguments)}}()},_parseFileName:function(e){return e.value?e.value.replace(/.*(\/|\\)/,""):null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},_parseFileSize:function(e){var t;return e.value||(t=null!==e.fileSize&&void 0!==e.fileSize?e.fileSize:e.size),t},_getValidationDescriptor:function(e){var t,o,r;return r={},t=this._parseFileName(e),o=this._parseFileSize(e),r.name=t,o&&(r.size=o),r},_getValidationDescriptors:function(e){var t,o;for(o=[],t=0;t<e.length;t++)o.push(e[t]);return o}},_qq.FineUploader=function(e){_qq.FineUploaderBasic.apply(this,arguments),_qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Change",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop picture here",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>')+(this._options.listElement?"":'<ul class="qq-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You can only have one picture"},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},showMessage:function(e){alert(e)}},!0),_qq.extend(this._options,e,!0),this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._setupDragDrop()},_qq.extend(_qq.FineUploader.prototype,_qq.FineUploaderBasic.prototype),_qq.extend(_qq.FineUploader.prototype,{clearStoredFiles:function(){_qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(e){this._setupExtraDropzone(e)},removeExtraDropzone:function(e){var t=this._options.dragAndDrop.extraDropzones;for(var o in t)if(t[o]===e)return this._options.dragAndDrop.extraDropzones.splice(o,1)},getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},reset:function(){_qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._setupDragDrop()},_leaving_document_out:function(e){return(_qq.chrome()||_qq.safari()&&_qq.windows())&&0==e.clientX&&0==e.clientY||_qq.firefox()&&!e.relatedTarget},_storeFileForLater:function(e){_qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var t=this.getItemByFileId(e);_qq(this._find(t,"spinner")).hide()},_find:function(e,t){var o=_qq(e).getByClass(this._options.classes[t])[0];if(!o)throw new Error("element not found "+t);return o},_setupExtraDropzone:function(e){this._options.dragAndDrop.extraDropzones.push(e),this._setupDropzone(e)},_setupDropzone:function(e){var t=this,o=new _qq.UploadDropZone({element:e,onEnter:function(o){_qq(e).addClass(t._classes.dropActive),o.stopPropagation()},onLeave:function(e){},onLeaveNotDescendants:function(o){_qq(e).removeClass(t._classes.dropActive)},onDrop:function(o){t._options.dragAndDrop.hideDropzones&&_qq(e).hide(),_qq(e).removeClass(t._classes.dropActive),o.dataTransfer.files.length>1&&!t._options.multiple?t._error("tooManyFilesError",""):t._uploadFileList(o.dataTransfer.files)}});this.addDisposer(function(){o.dispose()}),this._options.dragAndDrop.hideDropzones&&_qq(e).hide()},_setupDragDrop:function(){var e,t;e=this,this._options.dragAndDrop.disableDefaultDropzone||(t=this._find(this._element,"drop"),this._options.dragAndDrop.extraDropzones.push(t));var o,r=this._options.dragAndDrop.extraDropzones;for(o=0;o<r.length;o++)this._setupDropzone(r[o]);this._options.dragAndDrop.disableDefaultDropzone||_qq.ie()&&!_qq.ie10()||this._attach(document,"dragenter",function(n){if(!_qq(t).hasClass(e._classes.dropDisabled))for(t.style.display="block",o=0;o<r.length;o++)r[o].style.display="block"}),this._attach(document,"dragleave",function(t){if(e._options.dragAndDrop.hideDropzones&&_qq.FineUploader.prototype._leaving_document_out(t))for(o=0;o<r.length;o++)_qq(r[o]).hide()}),_qq(document).attach("drop",function(t){if(e._options.dragAndDrop.hideDropzones)for(o=0;o<r.length;o++)_qq(r[o]).hide();t.preventDefault()})},_onSubmit:function(e,t){_qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,o,r){var n,i,a,s,l,c;_qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments),n=this.getItemByFileId(e),i=this._find(n,"progressBar"),s=Math.round(o/r*100),o===r?(l=this._find(n,"cancel"),_qq(l).hide(),_qq(i).hide(),_qq(this._find(n,"statusText")).setText(this._options.text.waitingForResponse),a=this._formatSize(r)):(a=this._formatProgress(o,r),_qq(i).css({display:"block"})),_qq(i).css({width:s+"%"}),c=this._find(n,"size"),_qq(c).css({display:"inline"}),_qq(c).setText(a)},_onComplete:function(e,t,o,r){_qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var n=this.getItemByFileId(e);_qq(this._find(n,"statusText")).clearText(),_qq(n).removeClass(this._classes.retrying),_qq(this._find(n,"progressBar")).hide(),this._options.disableCancelForFormUploads&&!_qq.UploadHandlerXhr.isSupported()||_qq(this._find(n,"cancel")).hide(),_qq(this._find(n,"spinner")).hide(),o.success?(_qq(n).addClass(this._classes.success),this._classes.successIcon&&(this._find(n,"finished").style.display="inline-block",_qq(n).addClass(this._classes.successIcon))):(_qq(n).addClass(this._classes.fail),this._classes.failIcon&&(this._find(n,"finished").style.display="inline-block",_qq(n).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[e]&&_qq(n).addClass(this._classes.retryable),this._controlFailureTextDisplay(n,o))},_onUpload:function(e,t,o){_qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var r=this.getItemByFileId(e);this._showSpinner(r)},_onBeforeAutoRetry:function(e){var t,o,r,n,i,a;_qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),t=this.getItemByFileId(e),o=this._find(t,"progressBar"),this._showCancelLink(t),o.style.width=0,_qq(o).hide(),this._options.retry.showAutoRetryNote&&(r=this._find(t,"statusText"),n=this._autoRetries[e]+1,i=this._options.retry.maxAutoAttempts,a=(a=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,n)).replace(/\{maxAuto\}/g,i),_qq(r).setText(a),1===n&&_qq(t).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){if(_qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var t=this.getItemByFileId(e);return this._find(t,"progressBar").style.width=0,_qq(t).removeClass(this._classes.fail),this._showSpinner(t),this._showCancelLink(t),!0}return!1},_addToList:function(e,t){var o=_qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!_qq.UploadHandlerXhr.isSupported()){var r=this._find(o,"cancel");_qq(r).remove()}o.qqFileId=e;var n=this._find(o,"file");_qq(n).setText(this._formatFileName(t)),_qq(this._find(o,"size")).hide(),this._options.multiple||this._clearList(),this._listElement.appendChild(o)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var e=this,t=this._listElement;this._attach(t,"click",function(t){var o=(t=t||window.event).target||t.srcElement;if(_qq(o).hasClass(e._classes.cancel)||_qq(o).hasClass(e._classes.retry)){_qq.preventDefault(t);for(var r=o.parentNode;void 0==r.qqFileId;)r=o=o.parentNode;_qq(o).hasClass(e._classes.cancel)?(e.cancel(r.qqFileId),_qq(r).remove()):(_qq(r).removeClass(e._classes.retryable),e.retry(r.qqFileId))}})},_formatProgress:function(e,t){var o=this._options.text.formatProgress;function r(e,t){o=o.replace(e,t)}return r("{percent}",Math.round(e/t*100)),r("{total_size}",this._formatSize(t)),o},_controlFailureTextDisplay:function(e,t){var o,r,n,i,a;o=this._options.failedUploadTextDisplay.mode,r=this._options.failedUploadTextDisplay.maxChars,n=this._options.failedUploadTextDisplay.responseProperty,"custom"===o?((i=t[n])?i.length>r&&(a=i.substring(0,r)+"..."):(i=this._options.text.failUpload,this.log("'"+n+"' is not a valid property on the server response.","warn")),_qq(this._find(e,"statusText")).setText(a||i),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,i)):"default"===o?_qq(this._find(e,"statusText")).setText(this._options.text.failUpload):"none"!==o&&this.log("failedUploadTextDisplay.mode value of '"+o+"' is not valid","warn")},_showTooltip:function(e,t){e.title=t},_showSpinner:function(e){this._find(e,"spinner").style.display="inline-block"},_showCancelLink:function(e){this._options.disableCancelForFormUploads&&!_qq.UploadHandlerXhr.isSupported()||(this._find(e,"cancel").style.display="inline")},_error:function(e,t){var o=_qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(o)}}),_qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},_qq.extend(this._options,e),_qq.extend(this,_qq.DisposeSupport),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},_qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return _qq.safari()||_qq.firefox()&&_qq.windows()},_disableDropOutside:function(e){_qq.UploadDropZone.dropOutsideDisabled||(this._dragover_should_be_canceled?_qq(document).attach("dragover",function(e){e.preventDefault()}):_qq(document).attach("dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),_qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;e._attach(e._element,"dragover",function(t){if(e._isValidFileDrag(t)){var o=_qq.ie()?null:t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"==o||"linkMove"==o?"move":"copy",t.stopPropagation(),t.preventDefault()}}),e._attach(e._element,"dragenter",function(t){e._isValidFileDrag(t)&&e._options.onEnter(t)}),e._attach(e._element,"dragleave",function(t){if(e._isValidFileDrag(t)){e._options.onLeave(t);var o=document.elementFromPoint(t.clientX,t.clientY);_qq(this).contains(o)||e._options.onLeaveNotDescendants(t)}}),e._attach(e._element,"drop",function(t){e._isValidFileDrag(t)&&(t.preventDefault(),e._options.onDrop(t))})},_isValidFileDrag:function(e){if(_qq.ie()&&!_qq.ie10())return!1;var t=e.dataTransfer,o=_qq.safari(),r=!!_qq.ie10()||"none"!=t.effectAllowed;return t&&r&&(t.files||!o&&t.types.contains&&t.types.contains("Files"))}},_qq.UploadHandlerAbstract=function(e){this._options={debug:!1,endpoint:"/upload.php",maxConnections:999,log:function(e,t){},onProgress:function(e,t,o,r){},onComplete:function(e,t,o,r){},onCancel:function(e,t){},onUpload:function(e,t,o){},onAutoRetry:function(e,t,o,r){}},_qq.extend(this._options,e),this._queue=[],this._params=[],this.log=this._options.log},_qq.UploadHandlerAbstract.prototype={add:function(e){},upload:function(e,t){var o=this._queue.push(e),r={};_qq.extend(r,t),this._params[e]=r,o<=this._options.maxConnections&&this._upload(e,this._params[e])},retry:function(e){_qq.indexOf(this._queue,e)>=0?this._upload(e,this._params[e]):this.upload(e,this._params[e])},cancel:function(e){this.log("Cancelling "+e),this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(e){},getSize:function(e){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler"),this._queue=[],this._params=[]},_upload:function(e){},_cancel:function(e){},_dequeue:function(e){var t=_qq.indexOf(this._queue,e);this._queue.splice(t,1);var o=this._options.maxConnections;if(this._queue.length>=o&&t<o){var r=this._queue[o-1];this._upload(r,this._params[r])}},isValid:function(e){}},_qq.UploadHandlerForm=function(e){_qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={},this._detach_load_events={}},_qq.extend(_qq.UploadHandlerForm.prototype,_qq.UploadHandlerAbstract.prototype),_qq.extend(_qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name",this._options.inputName);var t="qq-upload-handler-iframe"+_qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&_qq(e).remove(),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},isValid:function(e){return void 0!==this._inputs[e]},reset:function(){_qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._inputs={},this._detach_load_events={}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e],delete this._detach_load_events[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),_qq(t).remove())},_upload:function(e,t){this._options.onUpload(e,this.getName(e),!1);var o=this._inputs[e];if(!o)throw new Error("file with passed id was not added, or already uploaded or cancelled");var r=this.getName(e),n=this._createIframe(e),i=this._createForm(n,t);i.appendChild(o);var a=this;return this._attachLoadEvent(n,function(){a.log("iframe loaded");var t=a._getIframeContentJSON(n);setTimeout(function(){a._detach_load_events[e](),delete a._detach_load_events[e],_qq(n).remove()},1),!t.success&&a._options.onAutoRetry(e,r,t)||(a._options.onComplete(e,r,t),a._dequeue(e))}),this.log("Sending upload request for "+e),i.submit(),_qq(i).remove(),e},_attachLoadEvent:function(e,t){var o=this;this._detach_load_events[e.id]=_qq(e).attach("load",function(){if(o.log("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(e){o.log("Error when attempting to access iframe during handling of upload response ("+e+")","error")}t()}})},_getIframeContentJSON:function _getIframeContentJSON(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response,innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+innerHTML),innerHTML&&innerHTML.match(/^<pre/i)&&(innerHTML=doc.body.firstChild.firstChild.nodeValue),response=eval("("+innerHTML+")")}catch(e){this.log("Error when attempting to parse form upload response ("+e+")","error"),response={success:!1}}return response},_createIframe:function(e){var t=_qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var o=this._options.demoMode?"GET":"POST",r=_qq.toElement('<form method="'+o+'" enctype="multipart/form-data"></form>'),n=_qq.obj2url(t,this._options.endpoint);return r.setAttribute("action",n),r.setAttribute("target",e.name),r.style.display="none",document.body.appendChild(r),r}}),_qq.UploadHandlerXhr=function(e){_qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},_qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==(new XMLHttpRequest).upload},_qq.extend(_qq.UploadHandlerXhr.prototype,_qq.UploadHandlerAbstract.prototype),_qq.extend(_qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){var t=this._files[e];return null!==t.fileName&&void 0!==t.fileName?t.fileName:t.name},getSize:function(e){var t=this._files[e];return null!=t.fileSize?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},isValid:function(e){return void 0!==this._files[e]},reset:function(){_qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},_upload:function(e,t){this._options.onUpload(e,this.getName(e),!0);var o=this._files[e],r=this.getName(e);this.getSize(e);this._loaded[e]=0;var n=this._xhrs[e]=new XMLHttpRequest,i=this;n.upload.onprogress=function(t){t.lengthComputable&&(i._loaded[e]=t.loaded,i._options.onProgress(e,r,t.loaded,t.total))},n.onreadystatechange=function(){4==n.readyState&&i._onComplete(e,n)},t=t||{};var a=_qq.obj2url(t,this._options.endpoint),s=this._options.demoMode?"GET":"POST";if(n.open(s,a,!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("X-File-Name",encodeURIComponent(r)),n.setRequestHeader("Cache-Control","no-cache"),this._options.forceMultipart){var l=new FormData;l.append(this._options.inputName,o),o=l}else n.setRequestHeader("Content-Type","application/octet-stream"),n.setRequestHeader("X-Mime-Type",o.type);for(key in this._options.customHeaders)n.setRequestHeader(key,this._options.customHeaders[key]);this.log("Sending upload request for "+e),n.send(o)},_onComplete:function _onComplete(id,xhr){"use strict";if(this._files[id]){var name=this.getName(id),size=this.getSize(id),response;this._options.onProgress(id,name,size,size),this.log("xhr - server response received for "+id),this.log("responseText = "+xhr.responseText);try{response="function"==typeof JSON.parse?JSON.parse(xhr.responseText):eval("("+xhr.responseText+")")}catch(e){this.log("Error when attempting to parse xhr response text ("+e+")","error"),response={}}(200===xhr.status&&response.success||!this._options.onAutoRetry(id,name,response,xhr))&&(this._options.onComplete(id,name,response,xhr),this._xhrs[id]=null,this._dequeue(id))}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}}),function(e){"use strict";var t,o,r,n,i,a,s,l,c,u;a=["uploaderType"],r=function(e){if(e){var r=l(e);s(r),"basic"===i("uploaderType")?t(new _qq.FineUploaderBasic(r)):t(new _qq.FineUploader(r))}return o},n=function(e,t){var r=o.data("fineuploader");if(!t)return void 0===r?null:r[e];void 0===r&&(r={}),r[e]=t,o.data("fineuploader",r)},t=function(e){return n("uploader",e)},i=function(e,t){return n(e,t)},s=function(t){var r=t.callbacks={};e.each((new _qq.FineUploaderBasic)._options.callbacks,function(e,t){var n,i;n=(n=/^on(\w+)/.exec(e)[1]).substring(0,1).toLowerCase()+n.substring(1),i=o,r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.triggerHandler(n,e)}})},l=function(t,r){var n,s;if(n=void 0===r?"basic"!==t.uploaderType?{element:o[0]}:{}:r,e.each(t,function(t,o){e.inArray(t,a)>=0?i(t,o):o instanceof e?n[t]=o[0]:e.isPlainObject(o)?(n[t]={},l(o,n[t])):e.isArray(o)?(s=[],e.each(o,function(t,o){o instanceof e?e.merge(s,o):s.push(o)}),n[t]=s):n[t]=o}),void 0===r)return n},c=function(o){return"string"===e.type(o)&&!o.match(/^_/)&&void 0!==t()[o]},u=function(e){return t()[e].apply(t(),Array.prototype.slice.call(arguments,1))},e.fn.fineUploader=function(n){return o=this,t()&&c(n)?u.apply(this,arguments):"object"!==_typeof(n)&&n?(e.error("Method "+n+" does not exist on jQuery.fineUploader"),this):r.apply(this,arguments)}}(jQuery)},function(e,t,o){(function(){"use strict";var e=o(106);!function(t){var o=function(t,o){var r=o||{},n=r.bufferLen||4096,i=r.numChannels||2;this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,n,i,i);var a=(0,e.createWorkerWithBlob)(r.blob);a.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:i}});var s,l=!1;this.node.onaudioprocess=function(e){if(l){for(var t=[],o=0;o<i;o++)t.push(e.inputBuffer.getChannelData(o));a.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},this.record=function(){l=!0},this.stop=function(){l=!1},this.clear=function(){a.postMessage({command:"clear"})},this.getBuffer=function(e){s=e||r.callback,a.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(s=e||r.callback,t=t||r.type||"audio/wav",!s)throw new Error("Callback not set");a.postMessage({command:"exportWAV",type:t})},a.onmessage=function(e){var t=e.data;s(t)},t.connect(this.node),this.node.connect(this.context.destination)};o.forceDownload=function(e,o){var r=(t.URL||t.webkitURL).createObjectURL(e),n=t.document.createElement("a");n.href=r,n.download=o||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),n.dispatchEvent(i)},t.Recorder=o}(window)}).call(window)},function(e,t,o){var r,n,i,a=o(9);n=[o(9)],void 0===(i="function"==typeof(r=function(e){var t=e.ajaxSettings;t.responseFields.native="responseNative",t.converters["* native"]=!0;var o={},r=0,n={0:200,1223:204},i={},s=a.ajaxSettings.xhr();window.ActiveXObject&&e(window).on("unload",function(){for(var e in i)i[e]()}),o.cors=!!s&&"withCredentials"in s,o.ajax=s=!!s,e.ajaxTransport("native",function(e){var t;if(o.cors||s&&!e.crossDomain)return{send:function(o,a){var s,l=e.xhr(),c=++r,u={};if(l.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)l[s]=e.xhrFields[s];for(s in e.mimeType&&l.overrideMimeType&&l.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)l.setRequestHeader(s,o[s]);t=function(e){return function(){t&&(delete i[c],t=l.onload=l.onerror=null,"abort"===e?l.abort():"error"===e?a(l.status,l.statusText):(l.response&&(u.native=l.response),a(n[l.status]||l.status,l.statusText,u,l.getAllResponseHeaders())))}},l.onload=t(),l.onerror=t("error"),t=i[c]=t("abort");try{l.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),e.getNative=function(t,o){return e.ajax({dataType:"native",url:t,xhrFields:{responseType:"arraybuffer"},success:o})}})?r.apply(t,n):r)||(e.exports=i)},function(e,t,o){o(9);!function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t={autoShow:!1,autoHide:!1,autoPick:!1,inline:!1,container:null,trigger:null,language:"",format:"mm/dd/yyyy",date:null,startDate:null,endDate:null,startView:0,weekStart:0,yearFirst:!1,yearSuffix:"",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],itemTag:"li",mutedClass:"muted",pickedClass:"picked",disabledClass:"disabled",highlightedClass:"highlighted",template:'<div class="datepicker-container"><div class="datepicker-panel" data-view="years picker"><ul><li data-view="years prev">&lsaquo;</li><li data-view="years current"></li><li data-view="years next">&rsaquo;</li></ul><ul data-view="years"></ul></div><div class="datepicker-panel" data-view="months picker"><ul><li data-view="year prev">&lsaquo;</li><li data-view="year current"></li><li data-view="year next">&rsaquo;</li></ul><ul data-view="months"></ul></div><div class="datepicker-panel" data-view="days picker"><ul><li data-view="month prev">&lsaquo;</li><li data-view="month current"></li><li data-view="month next">&rsaquo;</li></ul><ul data-view="week"></ul><ul data-view="days"></ul></div></div>',offset:10,zIndex:1e3,filter:null,show:null,hide:null,pick:null},o="undefined"!=typeof window?window:{},r="datepicker",n="click.datepicker",i="datepicker-hide",a={},s={DAYS:0,MONTHS:1,YEARS:2},l=Object.prototype.toString;function c(e){return"string"==typeof e}var u=Number.isNaN||o.isNaN;function d(e){return"number"==typeof e&&!u(e)}function p(e){return void 0===e}function f(e){return"date"===function(e){return l.call(e).slice(8,-1).toLowerCase()}(e)}function h(e,t){for(var o=arguments.length,r=Array(o>2?o-2:0),n=2;n<o;n++)r[n-2]=arguments[n];return function(){for(var o=arguments.length,n=Array(o),i=0;i<o;i++)n[i]=arguments[i];return e.apply(t,r.concat(n))}}function m(e){return'[data-view="'+e+'"]'}function g(e,t){return[31,function(e){return e%4==0&&e%100!=0||e%400==0}(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]}function b(e,t,o){return Math.min(o,g(e,t))}var v=/(y|m|d)+/g,y=/\d+/g,_={show:function(){this.built||this.build(),this.shown||this.trigger("show.datepicker").isDefaultPrevented()||(this.shown=!0,this.$picker.removeClass(i).on(n,e.proxy(this.click,this)),this.showView(this.options.startView),this.inline||(e(window).on("resize.datepicker",this.onResize=h(this.place,this)),e(document).on(n,this.onGlobalClick=h(this.globalClick,this)),e(document).on("keyup.datepicker",this.onGlobalKeyup=h(this.globalKeyup,this)),this.place()))},hide:function(){this.shown&&(this.trigger("hide.datepicker").isDefaultPrevented()||(this.shown=!1,this.$picker.addClass(i).off(n,this.click),this.inline||(e(window).off("resize.datepicker",this.onResize),e(document).off(n,this.onGlobalClick),e(document).off("keyup.datepicker",this.onGlobalKeyup))))},toggle:function(){this.shown?this.hide():this.show()},update:function(){var e=this.getValue();e!==this.oldValue&&(this.setDate(e,!0),this.oldValue=e)},pick:function(e){var t=this.$element,o=this.date;this.trigger("pick.datepicker",{view:e||"",date:o}).isDefaultPrevented()||(o=this.formatDate(this.date),this.setValue(o),this.isInput&&(t.trigger("input"),t.trigger("change")))},reset:function(){this.setDate(this.initialDate,!0),this.setValue(this.initialValue),this.shown&&this.showView(this.options.startView)},getMonthName:function(t,o){var r=this.options,n=r.monthsShort,i=r.months;return e.isNumeric(t)?t=Number(t):p(o)&&(o=t),!0===o&&(i=n),i[d(t)?t:this.date.getMonth()]},getDayName:function(t,o,r){var n=this.options,i=n.days;return e.isNumeric(t)?t=Number(t):(p(r)&&(r=o),p(o)&&(o=t)),r?i=n.daysMin:o&&(i=n.daysShort),i[d(t)?t:this.date.getDay()]},getDate:function(e){var t=this.date;return e?this.formatDate(t):new Date(t)},setDate:function(t,o){var r=this.options.filter;if(f(t)||c(t)){if(t=this.parseDate(t),e.isFunction(r)&&!1===r.call(this.$element,t))return;this.date=t,this.viewDate=new Date(t),o||this.pick(),this.built&&this.render()}},setStartDate:function(e){(f(e)||c(e))&&(this.startDate=this.parseDate(e),this.built&&this.render())},setEndDate:function(e){(f(e)||c(e))&&(this.endDate=this.parseDate(e),this.built&&this.render())},parseDate:function(t){var o=this.format,r=[];if(f(t))return new Date(t.getFullYear(),t.getMonth(),t.getDate());c(t)&&(r=t.match(y)||[]),t=new Date;var n=o.parts.length,i=t.getFullYear(),a=t.getDate(),s=t.getMonth();return r.length===n&&e.each(r,function(e,t){var r=parseInt(t,10)||1;switch(o.parts[e]){case"dd":case"d":a=r;break;case"mm":case"m":s=r-1;break;case"yy":i=2e3+r;break;case"yyyy":i=r}}),new Date(i,s,a)},formatDate:function(t){var o=this.format,r="";if(f(t)){var n=t.getFullYear(),i={d:t.getDate(),m:t.getMonth()+1,yy:n.toString().substring(2),yyyy:n};i.dd=(i.d<10?"0":"")+i.d,i.mm=(i.m<10?"0":"")+i.m,r=o.source,e.each(o.parts,function(e,t){r=r.replace(t,i[t])})}return r},destroy:function(){this.unbind(),this.unbuild(),this.$element.removeData(r)}},S={click:function(t){var o=e(t.target),r=this.options,n=this.viewDate,i=this.format;if(t.stopPropagation(),t.preventDefault(),!o.hasClass("disabled")){var a=o.data("view"),l=n.getFullYear(),c=n.getMonth(),u=n.getDate();switch(a){case"years prev":case"years next":l="years prev"===a?l-10:l+10,this.viewDate=new Date(l,c,b(l,c,u)),this.renderYears();break;case"year prev":case"year next":l="year prev"===a?l-1:l+1,this.viewDate=new Date(l,c,b(l,c,u)),this.renderMonths();break;case"year current":i.hasYear&&this.showView(s.YEARS);break;case"year picked":i.hasMonth?this.showView(s.MONTHS):(o.addClass(r.pickedClass).siblings().removeClass(r.pickedClass),this.hideView()),this.pick("year");break;case"year":l=parseInt(o.text(),10),this.date=new Date(l,c,b(l,c,u)),i.hasMonth?(this.viewDate=new Date(this.date),this.showView(s.MONTHS)):(o.addClass(r.pickedClass).siblings().removeClass(r.pickedClass),this.hideView()),this.pick("year");break;case"month prev":case"month next":(c="month prev"===a?c-1:c+1)<0?(l-=1,c+=12):c>11&&(l+=1,c-=12),this.viewDate=new Date(l,c,b(l,c,u)),this.renderDays();break;case"month current":i.hasMonth&&this.showView(s.MONTHS);break;case"month picked":i.hasDay?this.showView(s.DAYS):(o.addClass(r.pickedClass).siblings().removeClass(r.pickedClass),this.hideView()),this.pick("month");break;case"month":c=e.inArray(o.text(),r.monthsShort),this.date=new Date(l,c,b(l,c,u)),i.hasDay?(this.viewDate=new Date(l,c,b(l,c,u)),this.showView(s.DAYS)):(o.addClass(r.pickedClass).siblings().removeClass(r.pickedClass),this.hideView()),this.pick("month");break;case"day prev":case"day next":case"day":"day prev"===a?c-=1:"day next"===a&&(c+=1),u=parseInt(o.text(),10),this.date=new Date(l,c,u),this.viewDate=new Date(l,c,u),this.renderDays(),"day"===a&&this.hideView(),this.pick("day");break;case"day picked":this.hideView(),this.pick("day")}}},globalClick:function(e){for(var t=e.target,o=this.element,r=this.$trigger,n=r[0],i=!0;t!==document;){if(t===n||t===o){i=!1;break}t=t.parentNode}i&&this.hide()},keyup:function(){this.update()},globalKeyup:function(e){var t=e.target,o=e.key,r=e.keyCode;this.isInput&&t!==this.element&&this.shown&&("Tab"===o||9===r)&&this.hide()}},w={render:function(){this.renderYears(),this.renderMonths(),this.renderDays()},renderWeek:function(){var t=this,o=[],r=this.options,n=r.weekStart,i=r.daysMin;n=parseInt(n,10)%7,i=i.slice(n).concat(i.slice(0,n)),e.each(i,function(e,r){o.push(t.createItem({text:r}))}),this.$week.html(o.join(""))},renderYears:function(){var e=this.options,t=this.startDate,o=this.endDate,r=e.disabledClass,n=e.filter,i=e.yearSuffix,a=this.viewDate.getFullYear(),s=new Date,l=s.getFullYear(),c=this.date.getFullYear(),u=[],d=!1,p=!1,f=void 0;for(f=-5;f<=6;f+=1){var h=new Date(a+f,1,1),m=!1;t&&(m=h.getFullYear()<t.getFullYear(),-5===f&&(d=m)),!m&&o&&(m=h.getFullYear()>o.getFullYear(),6===f&&(p=m)),!m&&n&&(m=!1===n.call(this.$element,h));var g=a+f===c,b=g?"year picked":"year";u.push(this.createItem({picked:g,disabled:m,muted:-5===f||6===f,text:a+f,view:m?"year disabled":b,highlighted:h.getFullYear()===l}))}this.$yearsPrev.toggleClass(r,d),this.$yearsNext.toggleClass(r,p),this.$yearsCurrent.toggleClass(r,!0).html(a+-5+i+" - "+(a+6)+i),this.$years.html(u.join(""))},renderMonths:function(){var t=this.options,o=this.startDate,r=this.endDate,n=this.viewDate,i=t.disabledClass||"",a=t.monthsShort,s=e.isFunction(t.filter)&&t.filter,l=n.getFullYear(),c=new Date,u=c.getFullYear(),d=c.getMonth(),p=this.date.getFullYear(),f=this.date.getMonth(),h=[],m=!1,g=!1,b=void 0;for(b=0;b<=11;b+=1){var v=new Date(l,b,1),y=!1;o&&(m=v.getFullYear()===o.getFullYear(),y=m&&v.getMonth()<o.getMonth()),!y&&r&&(g=v.getFullYear()===r.getFullYear(),y=g&&v.getMonth()>r.getMonth()),!y&&s&&(y=!1===s.call(this.$element,v));var _=l===p&&b===f,S=_?"month picked":"month";h.push(this.createItem({disabled:y,picked:_,highlighted:l===u&&v.getMonth()===d,index:b,text:a[b],view:y?"month disabled":S}))}this.$yearPrev.toggleClass(i,m),this.$yearNext.toggleClass(i,g),this.$yearCurrent.toggleClass(i,m&&g).html(l+t.yearSuffix||""),this.$months.html(h.join(""))},renderDays:function(){var e=this.$element,t=this.options,o=this.startDate,r=this.endDate,n=this.viewDate,i=this.date,a=t.disabledClass,s=t.filter,l=t.monthsShort,c=t.weekStart,u=t.yearSuffix,d=n.getFullYear(),p=n.getMonth(),f=new Date,h=f.getFullYear(),m=f.getMonth(),b=f.getDate(),v=i.getFullYear(),y=i.getMonth(),_=i.getDate(),S=void 0,w=void 0,k=void 0,E=[],P=d,C=p,T=!1;0===p?(P-=1,C=11):C-=1,S=g(P,C);var R=new Date(d,p,1);for((k=R.getDay()-parseInt(c,10)%7)<=0&&(k+=7),o&&(T=R.getTime()<=o.getTime()),w=S-(k-1);w<=S;w+=1){var O=new Date(P,C,w),M=!1;o&&(M=O.getTime()<o.getTime()),!M&&s&&(M=!1===s.call(e,O)),E.push(this.createItem({disabled:M,highlighted:P===h&&C===m&&O.getDate()===b,muted:!0,picked:P===v&&C===y&&w===_,text:w,view:"day prev"}))}var A=[],N=d,I=p,x=!1;11===p?(N+=1,I=0):I+=1,S=g(d,p),k=42-(E.length+S);var D=new Date(d,p,S);for(r&&(x=D.getTime()>=r.getTime()),w=1;w<=k;w+=1){var F=new Date(N,I,w),L=N===v&&I===y&&w===_,U=!1;r&&(U=F.getTime()>r.getTime()),!U&&s&&(U=!1===s.call(e,F)),A.push(this.createItem({disabled:U,picked:L,highlighted:N===h&&I===m&&F.getDate()===b,muted:!0,text:w,view:"day next"}))}var j=[];for(w=1;w<=S;w+=1){var B=new Date(d,p,w),V=!1;o&&(V=B.getTime()<o.getTime()),!V&&r&&(V=B.getTime()>r.getTime()),!V&&s&&(V=!1===s.call(e,B));var H=d===v&&p===y&&w===_,G=H?"day picked":"day";j.push(this.createItem({disabled:V,picked:H,highlighted:d===h&&p===m&&B.getDate()===b,text:w,view:V?"day disabled":G}))}this.$monthPrev.toggleClass(a,T),this.$monthNext.toggleClass(a,x),this.$monthCurrent.toggleClass(a,T&&x).html(t.yearFirst?d+u+" "+l[p]:l[p]+" "+d+u),this.$days.html(E.join("")+j.join("")+A.join(""))}},k=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),E="datepicker-top-left",P="datepicker-bottom-left",C=[E,"datepicker-top-right",P,"datepicker-bottom-right"].join(" "),T=function(){function o(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.$element=e(r),this.element=r,this.options=e.extend({},t,a[n.language],n),this.built=!1,this.shown=!1,this.isInput=!1,this.inline=!1,this.initialValue="",this.initialDate=null,this.startDate=null,this.endDate=null,this.init()}return k(o,[{key:"init",value:function(){var t=this.$element,o=this.options,r=o.startDate,n=o.endDate,i=o.date;this.$trigger=e(o.trigger),this.isInput=t.is("input")||t.is("textarea"),this.inline=o.inline&&(o.container||!this.isInput),this.format=function(t){var o=String(t).toLowerCase(),r=o.match(v);if(!r||0===r.length)throw new Error("Invalid date format.");return t={source:o,parts:r},e.each(r,function(e,o){switch(o){case"dd":case"d":t.hasDay=!0;break;case"mm":case"m":t.hasMonth=!0;break;case"yyyy":case"yy":t.hasYear=!0}}),t}(o.format);var a=this.getValue();this.initialValue=a,this.oldValue=a,i=this.parseDate(i||a),r&&(r=this.parseDate(r),i.getTime()<r.getTime()&&(i=new Date(r)),this.startDate=r),n&&(n=this.parseDate(n),r&&n.getTime()<r.getTime()&&(n=new Date(r)),i.getTime()>n.getTime()&&(i=new Date(n)),this.endDate=n),this.date=i,this.viewDate=new Date(i),this.initialDate=new Date(this.date),this.bind(),(o.autoShow||this.inline)&&this.show(),o.autoPick&&this.pick()}},{key:"build",value:function(){if(!this.built){this.built=!0;var t=this.$element,o=this.options,r=e(o.template);this.$picker=r,this.$week=r.find(m("week")),this.$yearsPicker=r.find(m("years picker")),this.$yearsPrev=r.find(m("years prev")),this.$yearsNext=r.find(m("years next")),this.$yearsCurrent=r.find(m("years current")),this.$years=r.find(m("years")),this.$monthsPicker=r.find(m("months picker")),this.$yearPrev=r.find(m("year prev")),this.$yearNext=r.find(m("year next")),this.$yearCurrent=r.find(m("year current")),this.$months=r.find(m("months")),this.$daysPicker=r.find(m("days picker")),this.$monthPrev=r.find(m("month prev")),this.$monthNext=r.find(m("month next")),this.$monthCurrent=r.find(m("month current")),this.$days=r.find(m("days")),this.inline?e(o.container||t).append(r.addClass("datepicker-inline")):(e(document.body).append(r.addClass("datepicker-dropdown")),r.addClass(i)),this.renderWeek()}}},{key:"unbuild",value:function(){this.built&&(this.built=!1,this.$picker.remove())}},{key:"bind",value:function(){var t=this.options,o=this.$element;e.isFunction(t.show)&&o.on("show.datepicker",t.show),e.isFunction(t.hide)&&o.on("hide.datepicker",t.hide),e.isFunction(t.pick)&&o.on("pick.datepicker",t.pick),this.isInput&&o.on("keyup.datepicker",e.proxy(this.keyup,this)),this.inline||(t.trigger?this.$trigger.on(n,e.proxy(this.toggle,this)):this.isInput?o.on("focus.datepicker",e.proxy(this.show,this)):o.on(n,e.proxy(this.show,this)))}},{key:"unbind",value:function(){var t=this.$element,o=this.options;e.isFunction(o.show)&&t.off("show.datepicker",o.show),e.isFunction(o.hide)&&t.off("hide.datepicker",o.hide),e.isFunction(o.pick)&&t.off("pick.datepicker",o.pick),this.isInput&&t.off("keyup.datepicker",this.keyup),this.inline||(o.trigger?this.$trigger.off(n,this.toggle):this.isInput?t.off("focus.datepicker",this.show):t.off(n,this.show))}},{key:"showView",value:function(e){var t=this.$yearsPicker,o=this.$monthsPicker,r=this.$daysPicker,n=this.format;if(n.hasYear||n.hasMonth||n.hasDay)switch(Number(e)){case s.YEARS:o.addClass(i),r.addClass(i),n.hasYear?(this.renderYears(),t.removeClass(i),this.place()):this.showView(s.DAYS);break;case s.MONTHS:t.addClass(i),r.addClass(i),n.hasMonth?(this.renderMonths(),o.removeClass(i),this.place()):this.showView(s.YEARS);break;default:t.addClass(i),o.addClass(i),n.hasDay?(this.renderDays(),r.removeClass(i),this.place()):this.showView(s.MONTHS)}}},{key:"hideView",value:function(){!this.inline&&this.options.autoHide&&this.hide()}},{key:"place",value:function(){if(!this.inline){var t=this.$element,o=this.options,r=this.$picker,n=e(document).outerWidth(),i=e(document).outerHeight(),a=t.outerWidth(),s=t.outerHeight(),l=r.width(),c=r.height(),d=t.offset(),p=d.left,f=d.top,h=parseFloat(o.offset),m=E;u(h)&&(h=10),f>c&&f+s+c>i?(f-=c+h,m=P):f+=s+h,p+l>n&&(p+=a-l,m=m.replace("left","right")),r.removeClass(C).addClass(m).css({top:f,left:p,zIndex:parseInt(o.zIndex,10)})}}},{key:"trigger",value:function(t,o){var r=e.Event(t,o);return this.$element.trigger(r),r}},{key:"createItem",value:function(t){var o=this.options,r=o.itemTag,n={text:"",view:"",muted:!1,picked:!1,disabled:!1,highlighted:!1},i=[];return e.extend(n,t),n.muted&&i.push(o.mutedClass),n.highlighted&&i.push(o.highlightedClass),n.picked&&i.push(o.pickedClass),n.disabled&&i.push(o.disabledClass),"<"+r+' class="'+i.join(" ")+'" data-view="'+n.view+'">'+n.text+"</"+r+">"}},{key:"getValue",value:function(){var e=this.$element;return this.isInput?e.val():e.text()}},{key:"setValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.$element;this.isInput?t.val(e):t.text(e)}}],[{key:"setDefaults",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.extend(t,a[o.language],o)}}]),o}();if(e.extend&&e.extend(T.prototype,w,S,_),e.fn){var R=e.fn.datepicker;e.fn.datepicker=function(t){for(var o=arguments.length,n=Array(o>1?o-1:0),i=1;i<o;i++)n[i-1]=arguments[i];var a=void 0;return this.each(function(o,i){var s=e(i),l=s.data(r);if(!l){if(/destroy/.test(t))return;var u=e.extend({},s.data(),e.isPlainObject(t)&&t);l=new T(i,u),s.data(r,l)}if(c(t)){var d=l[t];e.isFunction(d)&&(a=d.apply(l,n))}}),p(a)?this:a},e.fn.datepicker.Constructor=T,e.fn.datepicker.languages=a,e.fn.datepicker.setDefaults=T.setDefaults,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=R,this}}}(o(9))},function(e,t,o){var r={"./Resources.properties":379,"./Resources_ca.properties":380,"./Resources_de.properties":381,"./Resources_en-US.properties":382,"./Resources_en.properties":383,"./Resources_es-ES.properties":384,"./Resources_es.properties":385,"./Resources_fr.properties":386,"./Resources_ja.properties":387,"./Resources_sk-SK.properties":388,"./Resources_zh-CN.properties":389,"./Resources_zh-TW.properties":390};function n(e){var t=i(e);return o(t)}function i(e){var t=r[e];if(!(t+1)){var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return t}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=378},function(e,t,o){e.exports=o.p+"resources/Resources-0b523ff70ed30f7d12570dd15f9c344b.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_ca-317f88203d78b93ac1dbe34d8a78068d.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_de-0f2c506335afd64575f10ad2d36cc721.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_en-US-ce80256949fd940e4a527711e4365d67.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_en-3d0b9db64d008e8f8aa8f3d726a3ec93.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_es-ES-dea8ce238d1376a10e7b86afc02b72d0.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_es-db84642ec9676a20b74eddf0702cb22d.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_fr-2be53a5cd47cf1948baddd88dd11973c.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_ja-9ceb589ffbc437d5d8f827d9c8973976.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_sk-SK-da5ea314b25bb26bdcbffe27b2132272.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_zh-CN-b558d92249f7add48cfb8377c44e6ff4.properties"},function(e,t,o){e.exports=o.p+"resources/Resources_zh-TW-e315f27a70c840aac2a582d1f0652395.properties"},function(e,t,o){"use strict";o(392),o(393),o(73),o(16),o(395),o(396),o(235),o(397),o(398),o(399),o(0),o(2),o(19),o(400),o(8),o(401),o(404),o(1173),o(1179),o(1181),o(112),o(1262)},function(e,t,o){"use strict";var r=o(6);r.ko.extenders.bindProperty=function(e,t){return e._bindPropertyHandler=function(o){o.property===t.property&&e(o.newValue)},t.source.addEventListener("propertyChange",e._bindPropertyHandler),e(t.source[t.property]),e},r.ko.extenders.unbindProperty=function(e,t){return t.source.removeEventListener("propertyChange",e._bindPropertyHandler),e._bindPropertyHandler=null,e},r.ko.extenders.maxDigits=function(e,t){var o=r.ko.computed({read:e,write:function(o){var r,n=e();o&&("number"==typeof o&&(o=o.toString()),r=o.replace(/\D/g,"").substring(0,t)),r!=n?e(r):o!=n&&e.notifySubscribers(r)}}).extend({notify:"always"});return o(e()),o},r.ko.extenders.maxDigitsAndValue=function(e,t){var o=r.ko.computed({read:e,write:function(o){var r,n=e();o&&("number"==typeof o&&(o=o.toString()),r=(r=o.replace(/\D/g,"").substring(0,t.maxDigits))>t.maxValue?t.maxValue:r),r!=n?e(r):o!=n&&e.notifySubscribers(r)}}).extend({notify:"always"});return o(e()),o}},function(e,t,o){"use strict";var r=o(16),n=o(27),i=o(0),a=o(15),s=c(o(394)),l=c(o(234));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(){return-1==(0,n.IEVersion)()||(0,n.IEVersion)()>=11}ko.bindingHandlers.create={init:function(e,t,o,r){var n=t()||{};if("function"!=typeof n)throw new Error("The value for a create binding must be a function");n.call(r,e)}},ko.bindingHandlers.createAndDestroy={init:function(e,t,o,r){var n=t()||{};if("function"!=typeof n)throw new Error("The value for a create binding must be a function");n.call(r,e),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){n.call(r,e)})}},ko.bindingHandlers.destroy={init:function(e,t,o,r){var n=t()||{};if("function"!=typeof n)throw new Error("The value for a create binding must be a function");ko.utils.domNodeDisposal.addDisposeCallback(e,function(){n.call(r,e)})}},ko.bindingHandlers.css2=ko.bindingHandlers.css,ko.bindingHandlers.drawer={init:function(e,t){var o=ko.unwrap(t()),r=$(e);o?r.show():r.hide()},update:function(e,t){var o=ko.unwrap(t()),r=$(e);o?r.slideDown("fast"):r.slideUp("fast")}},ko.bindingHandlers.initFocus={init:function(e,t){t(),$(e).focus()}},ko.bindingHandlers.addClass={update:function(e,t){var o=t(),r=ko.utils.unwrapObservable(o);$(e).addClass(r)}},ko.bindingHandlers.fadeVisible={init:function(e,t){var o=t();$(e).toggle(ko.unwrap(o))},update:function(e,t){var o=t();ko.unwrap(o)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.fadeIn={init:function(e,t){var o=t();$(e).toggle(ko.unwrap(o))},update:function(e,t){var o=t();ko.unwrap(o)?$(e).fadeIn():$(e).hide()}},ko.bindingHandlers.option={update:function(e,t){var o=ko.utils.unwrapObservable(t());ko.selectExtensions.writeValue(e,o)}},ko.bindingHandlers.placeholder={init:function(e,t){var o=t().resource,r=o?(0,i.resource)(ko.utils.unwrapObservable(o)):t().text();if(d())$(e).attr("placeholder",r);else{var n=$('<div class="placeholder">'+r+"</div>"),a=$(e).parent().append(n);$(a).click(function(){$(e).focus()})}},update:function(e,t){if(!d()){var o=t().value,r=ko.utils.unwrapObservable(o),n=$(e).siblings("div");r&&r.length?$(n).css("display","none"):$(n).css("display","block")}}},ko.bindingHandlers.indeterminate={update:function(e,t){e.indeterminate=t()}},ko.bindingHandlers.scrollTo={update:function(e,t){if(ko.utils.unwrapObservable(t())){var o=(e=$(e)).parent().closest("div"),r=o.scrollTop(),n=e.position().top,i=o.outerHeight()-e.outerHeight();(n<0||n>i)&&(r+=n,n>0&&i>0&&(r-=i)),o.scrollTop(r)}}},ko.bindingHandlers.hint={init:function(e,t){var o=t()||{},r={hintPosition:o.position,visibility:o.visible,html:o.html,sticky:o.sticky,wide:o.wide},n=$('<div class="hintContainer" data-bind="template: \'menu/hint\'"></div>'),i=new l.default(o.resource,r),a=o.position,s=o.sticky;function c(){i.show(!0);var t=$(e).offset(),o=$(e).height(),r=0;r="bottom"==a?t.top+o+5:t.top-n.outerHeight()-5,i.hintVisibility()||n.css("visibility","hidden");var s=t.left+$(e).outerWidth()/2-n.outerWidth()/2;return n.css("left",s),n.css("top",r),!0}ko.applyBindings(i,n[0]),$("body").append(n),s?$(e).hover(c,function(){return!0}):$(e).hover(c,function(){return i.show(!1),!0}),$(e).click(c),$(n).attr("id",i.id()),$(function(){$("body").mousedown(function(e){var t=$("#".concat(i.id()));e.target.id==i.id()||t.has(e.target).length||i.show(!1)})})}},ko.bindingHandlers.inlineError={init:function(e,t){var o=t()||{},r=o.resource,n=o.observableText,i=o.visible,l=o.maxWidth,c=o.scrollingNotRequired,u=o.css,d=(0,a.generateUUID)(),p=$("<div id='".concat(d,'\' class="inlineErrorContainer" data-bind="template: \'notifications/inlineError\'"></div>')),f=new s.default(d,i,e,p,{resourceText:r,observableText:n,maxWidth:l,scrollingNotRequired:c,css:u});ko.applyBindings(f,p[0]),$("body").append(p),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){p.remove()})}};var p=function(e,t,o){var r,n=o(),i="";if("object"==u(n)){for(var a in i=n,n)n[a]=ko.utils.unwrapObservable(n[a]);r=t.apply(this,n)}else r=t(ko.utils.unwrapObservable(n)),i=ko.utils.unwrapObservable(n);$(e).attr("data-resource",i),$(e).html(r)};ko.bindingHandlers.resourceIfFound={update:function(e,t){!function(e,t,o){var n,a=o(),s="";if("object"==u(a))if(s=a,(0,i.hasResource)(ko.utils.unwrapObservable(a[0]))){for(var l=0;l<a.length;l++)l>0&&(a[l]=(0,r.safeValueExtractionFromObservableObject)(i.resource,ko.utils.unwrapObservable(a[l])));n=t.apply(this,a)}else n=s;else(0,i.hasResource)(ko.utils.unwrapObservable(a))?(n=t(ko.utils.unwrapObservable(a)),s=ko.utils.unwrapObservable(a)):(n=ko.utils.unwrapObservable(a),s=ko.utils.unwrapObservable(a));$(e).attr("data-resource",s),$(e).html(n)}(e,i.resource,t)}},ko.bindingHandlers.resource={update:function(e,t){p(e,i.resource,t)}},ko.bindingHandlers.pluralize={update:function(e,t){p(e,i.pluralize,t)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(0),a=o(8);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t,o,a,s,l){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.visible=o,this.elementToPointAt=a,this.errorElement=s,this.resourceKey=l.resourceText,this.observableText=l.observableText,this.maxWidth=l.maxWidth||"1000px",this.scrollingNotRequired=l.scrollingNotRequired,this.css=l.css,this.textToShow=ko.computed(function(){return c.resourceKey?(0,i.resource)(c.resourceKey):c.observableText()}),this.handleClick=this.handleClick.bind(this),this.visible.subscribe(function(e){e&&setTimeout(function(){var e=$("#".concat(t));if(e){var o=r.default.subscribe(n.SCROLL_INLINE_ERROR_SCROLLED,function(e,t){t.id==c.id&&c.calculateErrorPosition(),r.default.unsubscribe(o)});if(c.scrollingNotRequired&&c.calculateErrorPosition(),e.length>0){var i=$(c.elementToPointAt).offset().top-50;r.default.publish(n.SCROLL_INLINE_ERROR,{position:i,id:c.id})}}},50)})}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"calculateErrorPosition",value:function(){var e=$(this.elementToPointAt).offset(),t=$(this.elementToPointAt).outerHeight(),o=e.left+$(this.elementToPointAt).outerWidth()/2-Math.min(this.errorElement.outerWidth(),$(this.elementToPointAt).width())/2,r=e.top+t;if(this.errorElement.css("left",o),this.errorElement.css("top",r),this.errorElement.css("max-width",$(this.elementToPointAt).width()),this.errorElement.css("z-index",a.Z_INDEX_1000),this.css)for(var n=0;n<this.css.length;n++)this.errorElement.css(this.css[n].property,this.css[n].value)}},{key:"handleClick",value:function(){this.visible(!1)}}]),e}();t.default=l},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.CSEElement=null,Noteflight.prepareCSE=function(e){var t=function(){Noteflight.CSEElement=google.search.cse.element.render({div:"searchresults",tag:"searchresults-only"}),e()};Noteflight.CSEElement?e():window.__gcse?t():document.getElementById("searchresults")&&(window.__gcse={parseTags:"explicit",callback:function(){t()}},Noteflight.loadScript("http://www.google.com/cse/cse.js?cx="+Noteflight.config.googleCSE))},Noteflight.queryCSE=function(e){""===e?($("#searchresults").hide(),$("#mainContent").show(),Noteflight.CSEElement&&Noteflight.CSEElement.clearAllResults()):Noteflight.prepareCSE(function(){$("#searchresults").show(),$("#mainContent").hide(),Noteflight.CSEElement.execute(e)})},Noteflight.CSESearch=function(){var e=this;e.searchText=ko.observable(""),e.search=function(t){Noteflight.session.community().default_community()?(e.searchText(t),Noteflight.queryCSE(t)):(0,n.standardAlertDialog)((0,r.resource)("search.privateSites"))},e.clearSearch=function(){e.search("")},e.initSearch=function(){Noteflight.CSEElement=null,Noteflight.prepareCSE(function(){})}}},function(e,t,o){"use strict";var r=null;ko.bindingHandlers.drag={init:function(e,t,o,n){var i={helper:"clone",revert:!0,revertDuration:0,start:function(){r=ko.utils.unwrapObservable(t().value)},cursor:"default"};$(e).draggable(i).disableSelection()}},ko.bindingHandlers.drop={init:function(e,t,o,n){var i={drop:function(e,o){t().value(r)}};$(e).droppable(i)}}},function(e,t,o){"use strict";o(8);var r=o(19),n=function(e){return e&&e.__esModule?e:{default:e}}(o(236));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}ko.bindingHandlers.contextMenu={update:function(e,t,o,r){var a=t()||{};if("object"!=i(a))throw new Error("The value for a contextMenu binding must be an object");var s=a.items.call(r);if(s&&s.length){var l=ko.utils.unwrapObservable(a.template)||"menu/context",c=$('<div class="contextMenu" data-bind="template: \''+l+"'\">");!function(e,t,o){var r=t[0];ko.applyBindings(o,r),e[0]._tippy&&e[0]._tippy.destroy(),setTimeout(function(){(0,n.default)(e[0],{content:r.innerHTML,animation:"fade",flipOnUpdate:!0,arrow:!0,interactive:!0,trigger:"click",onShow:function(e){if(e.reference.classList.contains("noContextMenu"))return!1},onShown:function(e){$(e.popper).find(".contextMenuItem").each(function(t,r){var n=o.items().find(function(e){return e.id()==r.id});$(r).off("click").on("click",function(){n.action(),e.hide()})})}})},100)}($(e),c,new function(e,t){this.items=ko.observableArray(t);for(var o=0;o<this.items().length;o++)this.items()[o].id=ko.observable(o)}(r,s))}}};var a=null;function s(){a&&(ko.removeNode(a),a=null)}var l=40;function c(e,t,o,r){a=t[0],ko.applyBindings(o,a),$("body").append(t),t.offset(function(e,t,o){var r=0,n=0;return o&&(r=o.left||0,n=o.top||0),t.find(".infoPopupBottom").css("left",t.outerWidth()-r-l-3),{left:e.offset().left-t.outerWidth()+r+l,top:e.offset().top-t.outerHeight()+n}}(e,t,r))}var u=function(e,t,o,r){var n=ko.utils.unwrapObservable(o.html);if(!n.length)return!0;var i=$('<div class="infoPopup" data-bind="template: \'fragments/infoPopup\'">');return s(),c($(t),i,new function(e,t){this.html=ko.observable(t)}(r,n),ko.utils.unwrapObservable(o.offset)),!0},d=!0;ko.bindingHandlers.infoPopup={init:function(e,t,o,n){var a=t()||{};if("object"!=i(a))throw new Error("The value for a infoPopup binding must be an object");d&&(u(0,e,a,n),s(),d=!1),(0,r.isTouchDevice)()?$(e).click(function(t){u(0,e,a,n)}):($(e).mouseover(function(t){u(0,e,a,n)}),$(e).mouseout(function(e){return s(),!0}))}},$(function(){$("body").mousedown(s),(0,r.isTouchDevice)()&&window.addEventListener("touchmove",s,!1)})},function(e,t,o){"use strict";Noteflight.SelectionItem=function(e){var t=this;t.selectionList=e,t.selected=ko.observable(!1),t.justSelected=ko.observable(!1),t.updateOnItemSelection=!1,ko.computed(function(){t.selected(),t.updateOnItemSelection&&t.selectionList.updateOnItemSelection&&t.selectionList.updateSelection()}),t.updateOnItemSelection=!0,t.selectMousedown=function(e,o){return o.shiftKey?(t.selectionList.extendSelection(this),t.justSelected(!0)):t.selected()?t.justSelected(!1):t.selectionList.editingList()?(t.selectionList.toggleSelection(t),t.justSelected(!0)):(t.selectOnly(),t.justSelected(!0)),!0},t.selectMouseup=function(e,o){return t.justSelected()||(t.selectionList.editingList()?t.selectionList.toggleSelection(t):t.selectionList.selectNone()),!0},t.selectTouchstart=function(e,o){return t.selectMousedown(e,o)},t.selectTouchend=function(e,o){return t.selectMouseup(e,o)},t.selectOnly=function(){return t.selectionList.selectOnly(t),!0},t.toggleSelect=function(){t.selectionList.toggleSelection(t)}},Noteflight.SelectionList=function(e){var t=this;t.items=e,t.selectedItems=ko.observableArray(),t.lastSelectedItem=ko.observable(),t.updateOnItemSelection=!0,t.editingList=ko.observable(!1),t.hasSelection=ko.computed(function(){return t.selectedItems().length>0}),t.selectedItem=function(){return 0===t.selectedItems().length?null:t.selectedItems()[0]},t.clearSelectedItemsList=function(){for(var e=0;e<t.selectedItems().length;e++)t.selectedItems()[e].selected(!1);t.selectedItems([])},t.updateSelection=function(){var e=[];$.each(t.items(),function(t,o){o.selected()&&e.push(o)}),t.selectedItems(e),1==e.length&&t.lastSelectedItem(e[0])};var o=function(e){return function(){t.updateOnItemSelection=!1,e.apply(t,arguments),t.updateOnItemSelection=!0}};t.selectOnly=o(function(e){t.selectNone(),e.selected(!0),t.selectedItems([e]),t.lastSelectedItem(e)}),t.selectNone=o(function(e){$.each(t.selectedItems(),function(e,t){t.selected(!1)}),t.lastSelectedItem(null),t.selectedItems([])}),t.selectAll=o(function(e){$.each(t.items(),function(e,t){t.selected(!0)}),t.lastSelectedItem(t.items()[0]),t.selectedItems(t.items())}),t.extendSelection=o(function(e){if(t.lastSelectedItem()){var o=t.items().indexOf(t.lastSelectedItem()),r=t.items().indexOf(e);if(o>=0&&r>=0){for(var n=Math.min(o,r),i=Math.max(o,r),a=0;a<t.items().length;a++)t.items()[a].selected(a>=n&&a<=i);t.updateSelection()}}}),t.toggleSelection=o(function(e){e.selected(!e.selected()),t.updateSelection()}),ko.computed(function(){t.items(),t.updateSelection()}),t.startEditing=function(){t.editingList(!0)},t.stopEditing=function(){t.editingList(!1),t.selectNone()}}},function(e,t,o){"use strict";var r=o(0),n="GET",i="application/json";Noteflight.JSON_CONTENT_TYPE=i,Noteflight.FORM_CONTENT_TYPE="application/x-www-form-urlencoded",Noteflight.service=function(e,t,o,a){function s(){return a.type===n}return t&&(t.errors=t.errors||ko.observableArray(),t.busy=t.busy||ko.observable(!1),t.clearErrors=function(){t.errors([])}),function(e,n){t&&(t.busy()||t.clearErrors()),e=$.extend({},e,a.params,s()?null:{authenticity_token:Noteflight.authenticityToken}),s()||a.contentType!==i||(e=ko.toJSON(e));var l=$.extend({},a,{data:e}),c=function(){$.ajax(l).done(function(e){o&&o.call(t,e),n&&n.done&&n.done.call(t,e)}).fail(function(e,o){var i=[];switch(e.status){case 0:i=[{code:"serverNotReachable",message:"The server could not be reached"}];break;case 422:case 400:var s=$.parseJSON(e.responseText);i=s.errors||s.error||[],Array.isArray(i)||(i=[i]);break;case 403:i=[{code:"permissionDenied",message:"No permission to access service"}];break;case 404:i=[{code:"notFound",message:"Location not found"}];break;case 500:i=[{code:"internalServerError",message:"Internal server error"}];break;default:i=[{code:"httpError",message:"HTTP Error "+e.status.toString()}]}$.each(i,function(e,t){!function(e){if(e.code){var t="errors."+e.code;(0,r.hasResource)(t)&&(e.message=(0,r.resource)(t,e.message))}e.message||(e.message=(0,r.resource)("errors.unexpectedError")),e.messageIsHtml=!!e.messageIsHtml}(t)}),a.fail&&a.fail(i[0]),t&&(t.errors(t.errors().concat(i)),n&&n.fail&&n.fail.call(t,i)),n&&n.onFail&&n.onFail(i)}).always(function(){a.always&&a.always(),n&&n.always&&n.always.call(t)})};Noteflight.config.serviceDelay?setTimeout(c,1e3*Noteflight.config.serviceDelay):c()}},Noteflight.postService=function(e,t,o,r){return Noteflight.service(e,t,o,$.extend({url:e,type:"POST",contentType:i,dataType:"json"},r))},Noteflight.postServicePDF=function(e,t,o,r){return Noteflight.service(e,t,o,$.extend({url:e,type:"POST",contentType:i,processData:!1,dataType:"native",xhrFields:{responseType:"arraybuffer"}},r))},Noteflight.getService=function(e,t,o,r){return Noteflight.service(e,t,o,$.extend({url:e,type:n,dataType:"json"},r))}},function(e,t,o){"use strict";var r=o(2),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(0)),i=function(e){return e&&e.__esModule?e:{default:e}}(o(35)),a=o(114);var s={"errors.purchaseStartDate":!0,"errors.purchaseOldStartDate":!0};Noteflight.HeardAboutUsOptions=function(){var e=this;e.heardAboutUsOptions=ko.observableArray([{value:"No answer",label:""},{value:"Online search",label:n.resource("heardAboutUs.onlineSearch")},{value:"Word of mouth",label:n.resource("heardAboutUs.wordOfMouth")},{value:"News article",label:n.resource("heardAboutUs.newsArticle")},{value:"Conference",label:n.resource("heardAboutUs.conference")},{value:"W.W. Norton",label:n.resource("heardAboutUs.wwNorton")},{value:"Other",label:n.resource("heardAboutUs.other")}]),e.heardAboutUs=ko.observable(""),e.setHeardAboutUs=function(t){for(var o=0;o<e.heardAboutUsOptions().length;o++)if(e.heardAboutUsOptions()[o].value==t){e.heardAboutUs(t);break}}},Noteflight.ContentLibraryForPurchase=function(e){var t=this;t.name=ko.observable(e.name),t.code=ko.observable(e.code),t.quantity=ko.observable(e.quantity||0),t.minQuantity=ko.observable(e.used||0),t.alreadyPurchased=ko.observable(e.quantity>0||!1),t.tooFewUsers=ko.computed(function(){return t.quantity()<t.minQuantity()})},Noteflight.ContentLibraryForPurchase.toJson=function(e){var t=[];return e.forEach(function(e){parseInt(e.quantity())>0&&t.push({code:e.code(),name:e.name(),quantity:parseInt(e.quantity())})}),JSON.stringify(t)},Noteflight.PlanOptions=function(){var e=this;e.premiumPlanMonthlyValue="sp_crescendo_monthly",e.learnPlanValue="sp_learn_1year",e.premiumPlanValue="crescendo",e.learnPlanName=n.resource("plans.learn"),e.premiumPlanName=n.resource("plans.premiumAnnual"),e.premiumPlanMonthlyName=n.resource("plans.premiumMonthly"),e.premiumPlans=[e.premiumPlanValue,e.premiumPlanMonthlyValue],e.oldLearnPlans=["sp_k12_classroom","sp_private_studio","sp_k12_teacher"],e.customLearnPlans=["sp_custom_1year","sp_custom_2year","sp_custom_3year","sp_custom_4year","sp_custom_5year"],e.changeLearnPlans={sp_custom_1year:"sp_learn_1year",sp_custom_2year:"sp_learn_2year",sp_custom_3year:"sp_learn_3year",sp_custom_4year:"sp_learn_4year",sp_custom_5year:"sp_learn_5year"},e.learnPlans=[e.learnPlanValue,"sp_learn_2year","sp_learn_3year","sp_learn_4year","sp_learn_5year"].concat(e.oldLearnPlans),e.planDurationMapping={sp_learn_1year:1,sp_learn_2year:2,sp_learn_3year:3,sp_learn_4year:4,sp_learn_5year:5,sp_custom_1year:1,sp_custom_2year:2,sp_custom_3year:3,sp_custom_4year:4,sp_custom_5year:5,sp_k12_classroom:1,sp_private_studio:1,sp_k12_teacher:1},e.plans=ko.observableArray([{value:e.premiumPlanMonthlyValue,label:e.premiumPlanMonthlyName},{value:e.premiumPlanValue,label:e.premiumPlanName},{value:e.learnPlanValue,label:e.learnPlanName}]),e.selectedPlan=ko.observable(e.plans()[0].value),e.planNameMapping={crescendo:"crescendo",sp_crescendo_monthly:"crescendo_monthly",sp_learn_1year:"learn_1year",sp_learn_2year:"learn_2year",sp_learn_3year:"learn_3year",sp_learn_4year:"learn_4year",sp_learn_5year:"learn_5year"},e.selectedNumLearnYears=ko.observable(1),e.numLearnYearsInt=ko.computed(function(){return parseInt(e.selectedNumLearnYears(),10)}),e.isPremiumPlan=function(t){return e.premiumPlans.indexOf(t)>-1},e.isLearnPlan=function(t){return e.learnPlans.indexOf(t)>-1},e.isOldLearnPlan=function(t){return e.oldLearnPlans.indexOf(t)>-1},e.learnPlanForDuration=function(t){return t>5?null:e.learnPlans[t-1]},e.durationForLearnPlan=function(t){return e.planDurationMapping[t]},e.planCodeToInternalName=function(t){return e.planNameMapping[t]},e.planLocalizedBillingUnits=ko.computed(function(){return e.selectedPlan()&&e.selectedPlan()==e.premiumPlanMonthlyValue?n.resource("content.month"):n.resource("content.year")}),e.planPrice=ko.computed(function(){var t=0,o=2;return e.selectedPlan()?(e.isLearnPlan(e.selectedPlan())?(1==e.numLearnYearsInt()?t=49:2==e.numLearnYearsInt()?(t=93.1,o=3.8):3==e.numLearnYearsInt()?(t=139.65,o=5.7):4==e.numLearnYearsInt()?(t=186.2,o=7.6):5==e.numLearnYearsInt()&&(t=232.75,o=9.5),e.numLearnUsers()&&(t+=o*e.numLearnUsers())):t=e.selectedPlan()==e.premiumPlanMonthlyValue?7.95:49,Number(t.toFixed(2))):t}),e.addError=function(t,o){return(!o||!s[t[0]])&&(e.serviceReporter.errors.push({message:n.resource.apply(this,t)}),!0)},e.validatePlanFields=function(t){if((e.selectedPlan()||!e.addError(["errors.noPlan"],t))&&(e.quoteValidation(),e.selectedStartDateChoice()||t||!e.addError(["errors.noStartDate"]))){if(e.startOnSpecificDate()&&e.showLearnOptions()){var o=function(e){return Math.floor(e/864e5)},r=Date.parse(e.startDate());if(null===r){if(e.addError(["errors.purchaseStartDate"],t))return}else if(o(r)-o(new Date)<1&&e.addError(["errors.purchaseOldStartDate"],t))return}if(!(e.hasSubscription()&&!e.hasFutureSubscription()&&e.startChangeImmediately()&&e.currentPlan()&&e.isLearnPlan(e.currentPlan())&&!e.isLearnPlan(e.selectedPlan())&&e.addError(["errors.subscriptionDowngradeNotPermitted"],t))&&e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())){if((!e.selectedNumLearnYears()||e.numLearnYearsInt()<1||e.numLearnYearsInt()>5)&&e.addError(["errors.numLearnYears",1,5],t))return;if((!e.numLearnUsers()||e.numLearnUsers()<10)&&e.addError(["errors.numLearnUsers",10],t))return;if(e.hasSubscription()&&!e.hasFutureSubscription()&&!e.isPremiumPlan(e.currentPlan())){if(e.currentLtiIntegration()!=e.ltiIntegration()&&!e.startOnNextRenewal()&&e.addError(["errors.subscriptionSsoChangeNotPermitted"],t))return;if(e.startChangeImmediately()){if(e.currentNumLearnUsers()&&e.currentNumLearnUsers()>e.numLearnUsers()&&e.addError(["errors.subscriptionUsersChangeNotPermitted"],t))return;if(e.currentNumLearnYears()&&e.currentNumLearnYears()>e.numLearnYearsInt()&&e.addError(["errors.subscriptionYearsChangeNotPermitted"],t))return}}}}}},Noteflight.CommerceStatusModel=function(e,t,o){var r=this;r.serviceReporter=e,r.quotes=ko.observableArray([]),r.subscriptions=ko.observableArray([]),r.accountInfo=ko.observable(),r.summary=ko.observable(),r.invoices=ko.observableArray([]),r.credits=ko.observableArray([]),r.processFetchedData=function(e){r.quotes(e.quotes),r.subscriptions(e.subscriptions),r.accountInfo(e.account_info),r.summary(e.summary),r.invoices(e.invoices),r.credits(e.credits),t.call()},r.onPaymentError=function(e){o.call()},r.fetchUserInfo=function(){NF.apiService.paymentContextService(r.serviceReporter,r.processFetchedData,null,{fail:r.onPaymentError})},r.openQuotes=function(){for(var e=[],t=0;t<r.quotes().length;t++){var o=r.quotes()[t];null===o.subscribed_at&&e.push(o)}return e},r.taxExempt=function(){return!!(r.accountInfo()&&r.accountInfo().billing_info&&r.accountInfo().tax_exempt)},r.findQuoteForQuoteNumber=function(e){for(var t=r.openQuotes(),o=0;o<t.length;o++)if(null!==t[o].quote_number&&t[o].quote_number.toLowerCase()==e.toLowerCase())return t[o];return null},r.existingSubscription=function(){return r.recentNonExpiredSub()},r.recurlySub=function(){return r.subscriptions()&&r.subscriptions().length>0?r.subscriptions()[0]:null},r.recentNonExpiredSub=function(){if(!r.subscriptions())return null;for(var e=0;e<r.subscriptions().length;e++){var t=r.subscriptions()[e];if("expired"!=t.state)return t}},r.studentsForPlan=function(e){for(var t=0;t<e.add_ons.length;t++){var o=e.add_ons[t];if("students_per_site"==o.add_on_code)return o.quantity}return null},r.ltiIntegrationForPlan=function(e){for(var t=0;t<e.add_ons.length;t++){if("sso_enabled"==e.add_ons[t].add_on_code)return!0}return!1}},Noteflight.QuoteSubmitterModel=function(){var e=this;e.submitQuoteComplete=function(t){var o=t.print_quote_url,n=t.purchase_quote_url;e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1),(0,r.navigate)((0,r.path)("quoteConfirm",{printQuoteUrl:encodeURIComponent(o),purchaseQuoteUrl:encodeURIComponent(n),quoteNumber:t.quote_number}))},e.quoteError=function(t){e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)},e.submitQuoteRequest=function(){if(e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()+1),e.validateAddressFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else if(e.validatePlanFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else if(e.validateClFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else{var t={sites:1,students_per_site:e.numLearnUsers(),years:e.selectedNumLearnYears(),sso_enabled:e.ltiIntegration(),first_name:e.firstName(),last_name:e.lastName(),role:e.role(),cc_emails:e.billingEmail(),coupon_code:e.couponCode(),school_name:e.company(),school_address1:e.address1(),school_address2:e.address2(),country:e.country(),city:e.city(),state:e.state(),zip:e.zip(),tax_exempt:e.taxExempt(),tax_id:e.taxId(),phone:e.phone(),heard_about_us:e.heardAboutUs(),questions:e.questions()};e.startOnSpecificDate()&&(t.starts_at=e.startDate()),e.startOnNextRenewal()&&(t.timeframe="renewal"),e.startChangeImmediately()&&(t.timeframe="now"),t.content_libraries=e.clsToJson(),NF.apiService.requestQuote(e.serviceReporter,e.submitQuoteComplete,t,{fail:e.quoteError})}}},Noteflight.PricingModel=function(){var e=this;e.initializeRecurlyPricing=function(){return recurly.Pricing()},e.getProratedPricing=function(t,o){var r={},n=e.selectedPlan();e.isPremiumPlan(e.selectedPlan())?r.scc_plan_name=e.planCodeToInternalName(e.selectedPlan()):(r.sites=1,r.students_per_site=e.numLearnUsers(),r.years=e.selectedNumLearnYears(),r.sso_enabled=e.ltiIntegration(),e.isLearnPlan(n)&&(r.content_libraries=e.clsToJson())),r.collection_method=e.currentCollectionMethod(),r.timeframe="now",NF.apiService.previewSubscriptionModification(e.serviceReporter,t,r)},e.getNewPricing=function(t,o){var r=e.initializeRecurlyPricing(),n=e.selectedPlan();if(e.isLearnPlan(n)){var i=e.selectedNumLearnYears();n=e.learnPlanForDuration(i)}r=r.plan(n,{quantity:1}).currency("USD"),e.isLearnPlan(n)&&(r=r.addon("students_per_site",{quantity:e.numLearnUsers()}),e.ltiIntegration()&&(r=r.addon("sso_enabled",{quantity:1})),e.clsToJson().forEach(function(e){r=r.addon("cl_"+e.code,{quantity:e.quantity})})),e.couponCode()&&(r=r.coupon(e.couponCode())),r=(r=r.address({country:e.country(),postal_code:e.zip()})).catch(o).done(t)},e.pricingError=function(t){e.addError([(0,a.interpretRecurlyError)(t)]),e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)},e.displayCouponInfo=function(t){var o=t.coupon;o&&o.valid_coupon_code?(e.couponDescription(n.resource("content.couponDescription",o.description)),e.validCouponCode(!0)):o&&!o.valid_coupon_code?(e.couponDescription(n.resource("content.invalidCouponCode")),e.validCouponCode(!1)):(e.couponDescription(null),e.validCouponCode(!1))},e.updateCouponInfo=function(){NF.apiService.couponInfo(e.serviceReporter,e.displayCouponInfo,{coupon_code:e.couponCode()})},e.displayPricing=function(t){if(Object.keys(t).length>0){if(e.currentSubtotal(t.currency.symbol+t.now.subtotal),e.taxExempt()){e.currentTax("$0.00");var o=t.now.total-t.now.tax;e.currentTotal(t.currency.symbol+o.toFixed(2))}else e.currentTax(t.currency.symbol+t.now.tax),e.currentTotal(t.currency.symbol+t.now.total);e.currentCredits(t.currency.symbol+t.now.discount),e.showCredits(t.now.discount<0)}else e.currentSubtotal("$0.00"),e.currentTax("$0.00"),e.currentTotal("$0.00"),e.currentCredits("$0.00");e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1),e.couponCode()?e.updateCouponInfo():(e.couponDescription(null),e.validCouponCode(!1))},e.updatePricing=function(){if(e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()+1),e.pricingUpdatesEnabled())if(e.clearReporterErrors(),e.validatePlanFields(!0),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else if(e.validateClFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else{!function(t,o){e.hasSubscription()&&!e.hasFutureSubscription()&&e.startChangeImmediately()?e.getProratedPricing(t,o):e.getNewPricing(t,o)}(e.displayPricing,e.pricingError)}else e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)}},Noteflight.CommerceCountryStateViewModel=function(){var e=this;e.country=ko.observable("US"),e.state=ko.observable(),e.stateCode=ko.computed(function(){if(!e.state())return null;if("US"!=e.country())return e.state();for(var t=e.state().trim().toUpperCase(),o=null,r=0;r<NF.states.length;r++){if(t==NF.states[r].code){o=NF.states[r].code;break}for(var n=0;n<NF.states[r].strings.length;n++)if(t==NF.states[r].strings[n]){o=NF.states[r].code;break}}return null!=o&&e.state(o),o})},Noteflight.BasicFields=function(){var e=this;e.startingEmail=function(){return NF.session.current_user()?NF.session.current_user().email():""},e.firstName=ko.observable(""),e.lastName=ko.observable(""),e.company=ko.observable(""),e.address1=ko.observable(""),e.address2=ko.observable(""),e.city=ko.observable(""),e.zip=ko.observable(""),e.email=ko.observable(e.startingEmail()),e.phone=ko.observable(""),Noteflight.CommerceCountryStateViewModel.call(this),Noteflight.HeardAboutUsOptions.call(this),e.billingEmail=ko.observable(""),e.questions=ko.observable(""),e.role=ko.observable(""),e.validateAddressFields=function(){if(e.firstName())if(e.lastName()){if(e.billingEmail()){var t=[],o=e.billingEmail().split(",");if(o.length>0){for(var r=0;r<o.length;r++){if(!NF.isValidEmail(o[r].trim()))return void e.addError(["errors.ccEmailInvalid"]);t[r]=o[r].trim()}e.billingEmail(t.join(","))}}if(e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())){if(!e.address1())return void e.addError(["errors.schoolAddressRequired"]);if(!e.country())return void e.addError(["errors.schoolCountryRequired"]);if(!e.city())return void e.addError(["errors.schoolCityRequired"]);if("US"==e.country()&&!e.state())return void e.addError(["errors.schoolStateRequired"]);if("US"==e.country()&&!e.stateCode())return void e.addError(["errors.validUSStateRequired"]);if(!e.zip())return void e.addError(["errors.schoolZipRequired"]);if(!e.company())return void e.addError(["errors.schoolNameRequired"]);if(e.requestingQuote()&&e.company().length>50)return void e.serviceReporter.errors.push({message:n.resource("errors.schoolNameTooLong")});if(!e.role())return void e.addError(["errors.roleRequired"])}else{if(!e.address1())return void e.addError(["errors.addressRequired"]);if(!e.country())return void e.addError(["errors.countryRequired"]);if(!e.city())return void e.addError(["errors.cityRequired"]);if("US"==e.country()&&!e.state())return void e.addError(["errors.stateRequired"]);if("US"==e.country()&&!e.stateCode())return void e.addError(["errors.validUSStateRequired"]);if(!e.zip())return void e.addError(["errors.zipRequired"])}}else e.addError(["errors.lastNameRequired"]);else e.addError(["errors.firstNameRequired"])}},Noteflight.CommerceFormPricingListeners=function(){var e=this;e.debouncedPricingUpdate=i.default.debounce(e.updatePricing,500),e.selectedPlan.subscribe(function(t){e.debouncedPricingUpdate()}),e.selectedStartDateChoice.subscribe(function(t){e.debouncedPricingUpdate()}),e.numLearnUsers.subscribe(function(t){e.debouncedPricingUpdate()}),e.selectedNumLearnYears.subscribe(function(t){e.debouncedPricingUpdate()}),e.zip.subscribe(function(t){e.debouncedPricingUpdate()}),e.country.subscribe(function(t){e.debouncedPricingUpdate()}),e.couponCode.subscribe(function(t){e.debouncedPricingUpdate()}),e.startDate.subscribe(function(t){e.debouncedPricingUpdate()}),e.taxExempt.subscribe(function(t){e.debouncedPricingUpdate()})},Noteflight.PurchaseModel=function(){var e=this;e.purchaseComplete=function(t){NF.analytics.trackEvent("conversion","purchase",e.selectedPlan(),Math.round(e.currentSubtotal().split("$")[1])),NF.analytics.trackEcommerceEvent(NF.session.current_user().userExternalId()+"_"+(new Date).getTime(),e.selectedPlan(),e.currentSubtotal(),e.currentTax()),e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1),e.isLearnPlan(e.selectedPlan())&&e.hasSubscription()&&e.currentPlan()&&e.isLearnPlan(e.currentPlan())?(0,r.navigate)((0,r.path)("learnPurchaseRenew")):e.isLearnPlan(e.selectedPlan())?(0,r.navigate)((0,r.path)("learnPurchaseConfirm")):(0,r.navigate)((0,r.path)("premiumPurchaseConfirm"))},e.startPurchase=function(){if(e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()+1),e.validateAddressFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else if(e.validatePlanFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else if(e.validateClFields(),e.serviceReporter.hasErrors())e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1);else{if(e.taxExempt()&&!e.taxId()&&e.addError(["errors.noTaxId"]),e.payingByPo()&&e.isLearnPlan(e.selectedPlan()))e.poNumber().length||e.addError(["errors.purchaseOrderRequired"]);else{var t=e.ccViewModel.validateInput();t&&e.addError([t])}e.serviceReporter.hasErrors()?e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1):e.payingByCc()&&!e.ccViewModel.useExistingCard()?e.acquireToken():e.doPurchase(null)}},e.acquireToken=function(){var t={first_name:e.firstName(),last_name:e.lastName(),address1:e.address1(),address2:e.address2(),city:e.city(),state:e.state(),postal_code:e.zip(),country:e.country(),number:e.ccViewModel.number(),month:e.ccViewModel.month(),year:e.ccViewModel.year(),cvv:e.ccViewModel.cvv()};recurly.token(t,e.recurlyCreateTokenComplete)},e.recurlyCreateTokenComplete=function(t,o){t?(e.addError([(0,a.interpretRecurlyError)(t)]),e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)):(e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1),e.doPurchase(o))},e.fillPersonalInfo=function(){return{cc_emails:e.billingEmail(),first_name:e.firstName(),last_name:e.lastName(),company_name:e.company(),tax_exempt:e.taxExempt(),address1:e.address1(),address2:e.address2(),city:e.city(),state:e.state(),postal_code:e.zip(),phone:e.phone(),country:e.country()}},e.onPurchaseError=function(){e.serviceReporter.hasErrors()&&e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)},e.doPurchase=function(t){var o={};if(e.payingByCc()?(t&&(o.recurly_token_id=t.id),o.collection_method="automatic"):o.collection_method="manual",o.personal=e.fillPersonalInfo(),e.isLearnPlan(e.selectedPlan())?(o.sites=1,o.students_per_site=e.numLearnUsers(),o.years=e.selectedNumLearnYears(),o.sso_enabled=e.ltiIntegration(),e.payingByPo()&&(o.po_number=e.poNumber()),e.haveQuote()&&e.quoteNumber().length&&(o.quote_number=e.quoteNumber())):o.scc_plan_name=e.planCodeToInternalName(e.selectedPlan()),e.startOnSpecificDate())o.starts_at=e.startDate();else if(e.hasFutureSubscription()&&e.startChangeImmediately()){var r=new Date;o.starts_at=r.getUTCFullYear().toString()+"-"+(r.getUTCMonth()+1).toString()+"-"+r.getUTCDate().toString()}e.startOnNextRenewal()?o.timeframe="renewal":o.timeframe="now",(e.showCouponField()||e.useHiddenCoupon()&&e.validCouponCode())&&(o.coupon_code=e.couponCode()),o.content_libraries=e.clsToJson(),NF.apiService.commerceFormPurchase(e.serviceReporter,e.purchaseComplete,o,{fail:e.onPurchaseError})}},Noteflight.CommerceFormURLProcessor=function(){var e=this;e.url_users=ko.observable(""),e.url_years=ko.observable(""),e.url_sso_enabled=ko.observable(""),e.url_coupon_code=ko.observable(""),e.url_quote=ko.observable(!1),e.url_need_quote=ko.observable(!1),e.url_quote_number=ko.observable(""),e.url_cls=ko.observable(""),e.url_plan=ko.observable(""),e.fillFromUrl=function(){var t=ko.observable(!1);if(t.subscribe(function(t){t&&e.selectedPlan(e.learnPlanValue)}),e.url_plan()&&("annual"==e.url_plan()?e.selectedPlan(e.premiumPlanValue):"monthly"==e.url_plan()?e.selectedPlan(e.premiumPlanMonthlyValue):"learn"==e.url_plan()&&e.selectedPlan(e.learnPlanValue)),e.url_years()&&(e.selectedNumLearnYears(e.url_years()),t(!0)),e.url_users()&&(e.numLearnUsers(e.url_users()),t(!0)),e.url_sso_enabled()&&(e.ltiIntegration(!0),t(!0)),e.url_quote()&&(e.haveQuote(!0),e.purchaseType("haveQuote"),t(!0)),e.url_need_quote()&&(e.purchaseType("needQuote"),t(!0)),e.url_quote_number()&&(e.haveQuote(!0),t(!0),e.quoteNumber(e.url_quote_number()),e.haveQuote(!0),e.purchaseType("haveQuote"),NF.session.current_user()&&e.fillFromQuote()),e.url_coupon_code()&&e.couponCode(e.url_coupon_code()),e.url_cls()&&t()){var o=decodeURIComponent(e.url_cls()).split(",");if(o.length>0&&o.length%2==0)for(var r=0;r<o.length;){var n=o[r],i=parseInt(o[r+1]);if(null==e.contentLibraryViewModelForCode(n)&&e.canAddAnotherContentLibrary())e.addLibrary(n).quantity(i);r+=2}}}},Noteflight.CommerceFormContentLibraryViewModel=function(e,t){var o=this,r={1:3,2:5.7,3:8.55,4:11.4,5:14.25};o.form=ko.observable(e),o.selectedLibrary=ko.observable(t),o.selectedLibrary.subscribe(function(t){e.debouncedPricingUpdate()}),o.hasLibrary=ko.observable(!1),o.quantity=ko.observable(),o.quantity.subscribe(function(t){e.debouncedPricingUpdate()}),o.hasQuantity=ko.computed(function(){return null!=o.quantity()}),o.quantityInt=ko.computed(function(){return o.hasQuantity()?parseInt(o.quantity(),10):null}),o.defaultMinQuantity=ko.observable(),o.currentQuantity=ko.observable(),o.minQuantity=ko.computed(function(){return o.hasLibrary()&&o.form().addonsLocked()?o.currentQuantity():o.defaultMinQuantity()}),o.maxQuantity=ko.computed(function(){return o.form().numLearnUsers()}),o.librarySelected=ko.computed(function(){return null!=o.selectedLibrary()}),o.tooFew=ko.computed(function(){return o.hasQuantity()&&null!=o.minQuantity()&&o.quantityInt()<o.minQuantity()}),o.tooMany=ko.computed(function(){return null!=o.hasQuantity()&&null!=o.maxQuantity()&&o.quantityInt()>o.maxQuantity()}),o.isValid=ko.computed(function(){return o.librarySelected()&&o.hasQuantity()&&!o.tooFew()&&!o.tooMany()}),o.price=ko.computed(function(){if(o.librarySelected()&&o.hasQuantity()&&o.quantity()>0){var e=r[o.form().selectedNumLearnYears()];return void 0===e?null:o.quantityInt()*e}return null}),o.priceFormatted=ko.computed(function(){return o.price()&&NF.formatCurrency(o.price())}),o.availableLibraries=ko.computed(function(){var e=[];return o.form().contentLibraries().forEach(function(t){var r=!1;o.form().contentLibraryViewModels().forEach(function(e){e!=o&&e.selectedLibrary()==t.code()&&(r=!0)}),r||e.push(t)}),e}),o.remove=function(){o.form().removeLibrary(o)},o.locked=ko.computed(function(){return!(!o.hasLibrary()||!o.form().addonsLocked())}),o.canRemove=ko.computed(function(){return!o.locked()}),o.canChangeLibrary=ko.computed(function(){return!o.locked()}),o.getSelectedLibraryName=function(){for(var e=o.form().contentLibraries(),t=0;t<e.length;t++){var r=e[t];if(o.selectedLibrary()==r.code())return r.name()}return null},o.toJson=function(){return{code:o.selectedLibrary(),name:o.getSelectedLibraryName(),quantity:o.quantityInt()}}},Noteflight.QuoteOptions=function(){var e=this;this.quoteNumber=ko.observable(""),this.haveQuote=ko.observable(!1),this.purchaseType=ko.observable("buyNow").extend({notify:"always"}),this.purchaseTypes=ko.observableArray(["buyNow","haveQuote","needQuote"]),this.switchPurchaseType=function(t){switch(t){case"buyNow":e.haveQuote(!1),e.selectedPaymentType(e.payByCcName);break;case"haveQuote":e.haveQuote(!0),e.selectedPaymentType(e.payByPoName),e.selectedPoOptions(e.havePo);break;case"needQuote":e.haveQuote(!1),e.selectedPaymentType(e.payByPoName),e.selectedPoOptions(e.noPo)}},this.purchaseType.subscribe(this.switchPurchaseType.bind(this)),this.needQuoteTextVisible=ko.computed(function(){return"needQuote"==e.purchaseType()}),this.haveQuote.subscribe(function(t){e.clearCurrentQuote(),e.clearReporterErrors()}),this.quoteValidation=function(t){e.haveQuote()&&e.quoteNumber()&&e.quoteNumber().length>0&&!e.commerceData.findQuoteForQuoteNumber(e.quoteNumber())&&e.addError(["errors.quoteNotFound"],t)}},Noteflight.CommerceFormContentLibraries=function(){var e=this;e.contentLibraries=ko.observableArray([]),e.contentLibraryViewModels=ko.observableArray([]),e.activeContentLibraries=ko.computed(function(){var t=[];return e.contentLibraries().forEach(function(e){e.alreadyPurchased()&&t.push(e)}),t}),e.activeContentLibraryViewModels=ko.computed(function(){var t=[];return e.contentLibraryViewModels().forEach(function(e){e.librarySelected()&&t.push(e)}),t}),e.clsHaveChanged=ko.computed(function(){return e.activeContentLibraries().length!=e.activeContentLibraryViewModels().length||!e.activeContentLibraries().every(function(t){var o=e.contentLibraryViewModelForCode(t.code());return null!=o&&o.quantity()==t.quantity()})}),e.initializeContentLibraryViewModels=function(){e.contentLibraries().forEach(function(t){if(t.alreadyPurchased()){var o=e.contentLibraryViewModelForCode(t.code());null==o?((o=new Noteflight.CommerceFormContentLibraryViewModel(e)).defaultMinQuantity(10),o.quantity(t.quantity()),o.currentQuantity(t.quantity()),o.selectedLibrary(t.code()),o.hasLibrary(!0),e.contentLibraryViewModels.push(o)):o.quantity()<t.quantity()&&o.quantity(t.quantity())}}),e.hasContentLibraryViewModels()&&!1===e.showContentLibraries()&&e.toggleShowContentLibraries()},e.contentLibrariesForPurchaseComplete=function(t){var o=t.content_libraries.map(function(e){return new Noteflight.ContentLibraryForPurchase(e)});e.contentLibraries(o),e.initializeContentLibraryViewModels(),e.contentLibraryStateComplete(!0)},e.initializeContentLibraries=function(){var t={};e.hasFutureSubscription()&&(t.source="commerce"),NF.apiService.contentLibrariesForPurchase(e,e.contentLibrariesForPurchaseComplete,t)},e.addLibrary=function(t){var o=new Noteflight.CommerceFormContentLibraryViewModel(e,t);return o.defaultMinQuantity(10),o.quantity(10),e.contentLibraryViewModels.push(o),e.showContentLibraries()||e.toggleShowContentLibraries(),o},e.removeLibrary=function(t){e.contentLibraryViewModels.remove(t),0===e.contentLibraryViewModels().length&&e.showContentLibraries(!1),e.debouncedPricingUpdate()},e.removeAllLibraries=function(){for(;e.contentLibraryViewModels().length>0;)e.removeLibrary(e.contentLibraryViewModels()[0])},e.getLoneUnselectedLibrary=function(){return 1==e.contentLibraryViewModels().length&&null==e.contentLibraryViewModels()[0].selectedLibrary()?e.contentLibraryViewModels()[0]:null},e.hasContentLibraryViewModels=ko.computed(function(){return e.contentLibraryViewModels().length>0}),e.contentLibraryViewModelForCode=function(t){var o=null;return e.contentLibraryViewModels().forEach(function(e){e.selectedLibrary()==t&&(o=e)}),o},e.canHideContentLibraries=ko.computed(function(){return!e.hasContentLibraryViewModels()||null!=e.getLoneUnselectedLibrary()}),e.toggleShowContentLibraries=function(){if(e.showContentLibraries()){if(e.canHideContentLibraries()){e.showContentLibraries(!1);var t=e.getLoneUnselectedLibrary();t&&e.removeLibrary(t)}}else e.hasContentLibraryViewModels()||e.addLibrary(),e.showContentLibraries(!0)},e.canAddAnotherContentLibrary=ko.computed(function(){return!(e.contentLibraryViewModels().length>=e.contentLibraries().length)&&e.contentLibraryViewModels().every(function(e){return e.librarySelected()})}),e.reInitContentLibraries=function(){e.addonsLocked()&&e.activeContentLibraries().length>0&&e.initializeContentLibraryViewModels()},e.clsToJson=function(){var t=[];return e.contentLibraryViewModels().forEach(function(e){e.librarySelected()&&e.quantity()>0&&t.push(e.toJson())}),t},e.contentLibrariesPrice=function(){var t=0;return e.contentLibraryViewModels().forEach(function(e){e.price()&&(t+=e.price())}),t},e.validateClFields=function(){if(e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())){for(var t=e.clsToJson(),o=0;o<t.length;o++){var r=t[o];if(r.quantity<10||r.quantity>e.numLearnUsers())return void e.addError(["errors.invalidQuantityContentLibrary"])}if(e.hasSubscription()&&e.startChangeImmediately()&&!e.hasFutureSubscription())for(var n=e.activeContentLibraries(),i=0;i<n.length;i++){var a=e.activeContentLibraries()[i],s=e.contentLibraryViewModelForCode(a.code());if(null==s||s.quantity()<a.quantity())return void e.addError(["errors.contentLibraryChangeNotPermitted"])}}}},Noteflight.CommerceFormViewModel=function(){var e=this;e.refundGracePeriodDays=30,e.pricingUpdatesEnabled=ko.observable(!1),e.showCommerceForm=ko.observable(!1),e.userStateComplete=ko.observable(!1),e.contentLibraryStateComplete=ko.observable(!1),e.showCommerceForm=ko.computed(function(){return e.userStateComplete()&&e.contentLibraryStateComplete()}),e.onNavigate=function(){NF.session.community().default_community()||(0,r.navigate)(NF.paths.loggedInHome())},e.showCommerceForm.subscribe(function(t){!0===t&&(e.fillFromUrl(),e.pricingUpdatesEnabled(!0),e.selectedNumLearnYears()&&e.selectedNumLearnYears()>1&&e.toggleShowMultiYearDiscount(),e.ltiIntegration()&&e.toggleShowLmsIntegration()),e.updatePricing()}),e.serviceReporter=new Noteflight.ServiceReporterViewModel(n.resource("action.updating")),e.serviceReporter.init(),e.clearReporterErrors=function(){e.serviceReporter.clearErrors()},e.templateName=ko.observable("commerce/commerceForm"),Noteflight.GenericPageViewModel.call(e),e.activeHeaderTag("upgrade"),Noteflight.BasicFields.call(this),Noteflight.PlanOptions.call(this),Noteflight.QuoteSubmitterModel.call(this),Noteflight.PricingModel.call(this),Noteflight.PurchaseModel.call(this),Noteflight.CommerceFormContentLibraries.call(this),Noteflight.CommerceFormURLProcessor.call(this),Noteflight.QuoteOptions.call(this),e.resource=n.resource,e.payByCcName=n.resource("plans.byCC"),e.payByPoName=n.resource("plans.byPO"),e.havePo=n.resource("plans.havePO"),e.noPo=n.resource("plans.noPO"),e.startImmediately=n.resource("plans.startImmediately"),e.startSpecific=n.resource("plans.startSpecific"),e.whenPoProvided=n.resource("plans.startPO"),e.onNextRenewal=n.resource("plans.startRenewal"),e.purchase=n.resource("plans.purchase"),e.requestQuote=n.resource("plans.learn.getAQuote"),e.currentSubtotal=ko.observable(""),e.currentTax=ko.observable(""),e.currentTotal=ko.observable(""),e.currentCredits=ko.observable(""),e.showCredits=ko.observable(!1),e.showCouponField=ko.observable(!1),e.useHiddenCoupon=ko.observable(!1),e.couponDescription=ko.observable(),e.validCouponCode=ko.observable(!1),e.currentNumLearnUsers=ko.observable(0),e.currentLtiIntegration=ko.observable(!1),e.currentNumLearnYears=ko.observable(0),e.currentPlan=ko.observable(""),e.currentCollectionMethod=ko.observable(""),e.currentRenewalDate=ko.observable(""),e.currentStartDate=ko.observable(""),e.hasFutureSubscription=ko.observable(!1),e.setCurrentRenewalDate=function(t){e.currentRenewalDate(t.getUTCMonth()+1+"/"+t.getUTCDate()+"/"+t.getUTCFullYear())},e.numLearnUsers=ko.observable(10),e.numLearnUsersInt=function(){return parseInt(e.numLearnUsers(),10)},e.ltiIntegration=ko.observable(!1),e.taxExempt=ko.observable(!1),e.taxId=ko.observable(""),e.showTaxExemptFlag=ko.computed(function(){if(!e.isLearnPlan(e.selectedPlan()))return!1;if("US"===e.country()){var t=Noteflight.states.find(function(t){return t.code===e.state()});return t&&t.taxed}var o=Noteflight.countries.find(function(t){return t.countryCode===e.country()});return o&&o.taxed}),e.toggleShowMultiYearDiscount=function(){e.showMultiYearDiscount(!e.showMultiYearDiscount())},e.toggleShowLmsIntegration=function(){e.showLmsIntegration(!e.showLmsIntegration())},e.showContentLibraries=ko.observable(!1),e.showMultiYearDiscount=ko.observable(!1),e.showLmsIntegration=ko.observable(!1),e.showMultiYearDiscountAmount=ko.computed(function(){return!0}),e.ccViewModel=new Noteflight.PurchaseMethodCreditCardRecurlyViewModel(e.serviceReporter),e.selectedPaymentType=ko.observable(e.payByCcName),e.selectedPaymentType.subscribe(function(t){t===e.payByPoName&&"buyNow"===e.purchaseType()&&e.selectedPoOptions(e.havePo)}),e.couponCode=ko.observable(""),e.poOptions=ko.observableArray([e.havePo,e.noPo]),e.selectedPoOptions=ko.observable(e.poOptions()[1]),e.poNumber=ko.observable(""),e.selectedStartDateChoice=ko.observable(!1),e.startDateYear=ko.observable(""),e.startDateMonth=ko.observable(""),e.startDateDay=ko.observable(""),e.limitInteger=function(e,t){return isNaN(parseInt(e))?null:e.toString().length>t?parseInt(e.toString().substr(0,t)):null},e.startDateYear.subscribe(function(t){var o=e.limitInteger(t,2);o&&e.startDateYear(o)}),e.startDateMonth.subscribe(function(t){var o=e.limitInteger(t,2);o&&e.startDateMonth(o)}),e.startDateDay.subscribe(function(t){var o=e.limitInteger(t,2);o&&e.startDateDay(o)}),e.startDate=ko.computed(function(){return"20"+e.startDateYear()+"-"+e.startDateMonth()+"-"+e.startDateDay()}),e.setStartDate=function(t){e.startDateYear(parseInt(t.getUTCFullYear().toString().substr(2,2))),e.startDateMonth(t.getUTCMonth()+1),e.startDateDay(t.getUTCDate())},e.requestingQuote=function(){return e.selectedPaymentType()==e.payByPoName&&e.selectedPoOptions()==e.noPo},e.payingByCc=function(){return e.selectedPaymentType()==e.payByCcName},e.payingByPo=function(){return e.selectedPaymentType()==e.payByPoName&&e.selectedPoOptions()==e.havePo},e.hasSubscription=ko.computed(function(){return e.currentPlan().length>0}),e.startOnSpecificDate=function(){return e.selectedStartDateChoice()==e.startSpecific},e.startOnNextRenewal=function(){return e.selectedStartDateChoice()==e.onNextRenewal},e.startChangeImmediately=function(){return e.selectedStartDateChoice()==e.startImmediately},e.addonsLocked=function(){return!e.hasFutureSubscription()&&!(!(e.hasSubscription()&&e.currentPlan()&&e.isLearnPlan(e.currentPlan()))||e.startOnNextRenewal())},e.minUsers=ko.computed(function(){return e.addonsLocked()?e.currentNumLearnUsers():10}),e.minYears=ko.computed(function(){return e.addonsLocked()?e.currentNumLearnYears():1}),e.maxYears=ko.computed(function(){return 5}),e.tooFewUsers=ko.computed(function(){return e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())&&e.numLearnUsersInt()&&e.numLearnUsersInt()<e.minUsers()}),e.tooFewYears=ko.computed(function(){return e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())&&e.selectedNumLearnYears()&&e.numLearnYearsInt()<e.minYears()}),e.tooManyYears=ko.computed(function(){return e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())&&e.selectedNumLearnYears()&&e.numLearnYearsInt()>e.maxYears()}),e.showCCOptions=ko.computed(function(){return e.payingByCc()}),e.showPOInfo=ko.computed(function(){return e.selectedPaymentType()==e.payByPoName}),e.showPONumber=ko.computed(function(){return!e.requestingQuote()}),e.showStartDateSpecific=ko.computed(function(){return e.startOnSpecificDate()}),e.showLearnOptions=ko.computed(function(){return e.isLearnPlan(e.selectedPlan())}),e.showHeardAboutUs=ko.computed(function(){return!(e.hasSubscription()||!e.selectedPlan()||!e.isLearnPlan(e.selectedPlan()))}),e.showQuestionsComments=ko.computed(function(){return e.requestingQuote()}),e.showAdditionalBillingEmails=ko.computed(function(){return e.selectedPlan()&&e.isLearnPlan(e.selectedPlan())}),e.showBillingFields=ko.computed(function(){return NF.roles.isLoggedIn()}),e.planHeaderText=ko.computed(function(){return e.url_need_quote()?n.resource("content.planHeader.quote"):e.hasSubscription()?n.resource("content.planHeader.modify"):e.isLearnPlan(e.selectedPlan())?n.resource("content.planHeader.learn"):e.selectedPlan()==e.premiumPlanValue?n.resource("content.planHeader.premium"):n.resource("content.planHeader.premiumMonthly")}),e.shouldShowLearnLoginText=ko.computed(function(){return e.isLearnPlan(e.selectedPlan())}),e.shouldShowPremiumLoginText=ko.computed(function(){return!e.isLearnPlan(e.selectedPlan())}),e.showLoginForm=function(){Noteflight.appViewModel.showLoginForm()},e.showSignupForm=function(){Noteflight.appViewModel.showSignupForm()},e.paymentWindowText=ko.computed(function(){return e.startChangeImmediately()&&e.hasSubscription()?e.isLearnPlan(e.selectedPlan())?n.resource("plans.modifyLearn"):n.resource("plans.modifyPremium"):""}),e.paymentTypeText=ko.computed(function(){return e.hasSubscription()&&e.startChangeImmediately()?e.requestingQuote()?n.resource("plans.modifyQuote"):n.resource("plans.modifyPayment"):""}),e.submitValue=ko.computed(function(){return e.requestingQuote()?e.requestQuote:e.purchase}),e.formattedPlanPrice=ko.computed(function(){return e.planPrice()&&NF.formatCurrency(e.planPrice())}),e.planTotal=ko.computed(function(){return e.isLearnPlan(e.selectedPlan())?e.planPrice()+e.contentLibrariesPrice():e.planPrice()}),e.formattedPlanTotal=ko.computed(function(){return e.planTotal()&&NF.formatCurrency(e.planTotal())}),e.determineUserState=function(){var t=e.commerceData.accountInfo(),o=e.commerceData.existingSubscription();if(o&&"sp_premium_trial"==o.plan.plan_code&&(o=!1),o){if(e.taxExempt(e.commerceData.taxExempt()),e.changeLearnPlans[o.plan.plan_code]&&(o.plan.plan_code=e.changeLearnPlans[o.plan.plan_code]),e.isLearnPlan(o.plan.plan_code)?e.selectedPlan(e.learnPlanValue):e.selectedPlan(o.plan.plan_code),e.currentPlan(e.selectedPlan()),"future"==o.state){e.hasFutureSubscription(!0);var r=new Date(1e3*o.activated_at);r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),e.setStartDate(r),e.currentStartDate(r),e.startDateChoice().indexOf(e.startSpecific)>-1&&e.selectedStartDateChoice(e.startSpecific)}var n=new Date(1e3*o.current_period_ends_at);if(n=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),e.setCurrentRenewalDate(n),e.currentCollectionMethod(o.collection_method),e.isLearnPlan(e.selectedPlan())){if(e.isOldLearnPlan(o.plan.plan_code)){var i=10;e.commerceData.summary()&&e.commerceData.summary().current_users>10&&(i=e.commerceData.summary().current_users),e.currentNumLearnUsers(i)}else e.currentNumLearnUsers(e.commerceData.studentsForPlan(o));e.numLearnUsers(e.currentNumLearnUsers()),e.currentNumLearnYears(e.durationForLearnPlan(o.plan.plan_code)),e.selectedNumLearnYears(e.currentNumLearnYears()),e.currentLtiIntegration(e.commerceData.ltiIntegrationForPlan(o)),e.ltiIntegration(e.currentLtiIntegration())}"manual"==o.collection_method?(e.selectedPaymentType(e.payByPoName),e.selectedPoOptions(e.noPo)):(e.selectedPaymentType(e.payByCcName),t.billing_info&&t.billing_info.month&&t.billing_info.year&&t.billing_info.last_four&&(e.ccViewModel.month(t.billing_info.month),e.ccViewModel.year(t.billing_info.year.toString().substr(2,2)),e.ccViewModel.existingNumber("XXXX-XXXX-XXXX-"+t.billing_info.last_four),e.ccViewModel.useExistingCard(!0)))}else e.showCouponField(!0);t&&(t.billing_info&&(e.firstName(t.billing_info.first_name),e.lastName(t.billing_info.last_name),e.company(t.billing_info.company),e.address1(t.billing_info.address1),e.address2(t.billing_info.address2),e.city(t.billing_info.city),void 0===t.billing_info.country?e.country("US"):e.country(t.billing_info.country),e.state(t.billing_info.state),e.zip(t.billing_info.zip),e.phone(t.billing_info.phone),e.billingEmail(t.cc_emails),t.billing_info&&t.billing_info.month&&t.billing_info.year&&t.billing_info.last_four&&(e.ccViewModel.month(t.billing_info.month),e.ccViewModel.year(t.billing_info.year.toString().substr(2,2)),e.ccViewModel.existingNumber("XXXX-XXXX-XXXX-"+t.billing_info.last_four),e.ccViewModel.useExistingCard(!0))),t.tax_exempt&&"boolean"==typeof t&&e.taxExempt(t.tax_exempt)),e.userStateComplete(!0),e.initializeContentLibraries()},e.useExistingBillingInfo=ko.computed(function(){return e.payingByCc()&&e.ccViewModel.useExistingCard()}),e.enterNewCard=function(){e.ccViewModel.month(""),e.ccViewModel.year(""),e.ccViewModel.cvv(""),e.ccViewModel.number(""),e.ccViewModel.useExistingCard(!1)},e.paymentContextError=function(e){},e.commerceData=new Noteflight.CommerceStatusModel(e.serviceReporter,e.determineUserState,e.paymentContextError),e.commerceData.fetchUserInfo(),e.clearCurrentQuote=function(){e.quoteNumber("")},e.fillFromQuote=function(){if(0!==e.quoteNumber().length){e.clearReporterErrors(),e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()+1);var t=e.commerceData.findQuoteForQuoteNumber(e.quoteNumber());if(null!==t){if(e.firstName(t.first_name),e.lastName(t.last_name),e.company(t.school_name),e.country(t.country),e.address1(t.school_address1),e.address2(t.school_address2),e.city(t.city),e.state(t.state),e.zip(t.zip),e.phone(t.phone),e.role(t.role),e.billingEmail(t.cc_emails),e.couponCode(t.coupon_code),e.taxExempt(t.tax_exempt),e.taxId(t.tax_id),(t.years||t.students_per_site)&&(e.numLearnUsers(t.students_per_site),e.selectedNumLearnYears(t.years),e.selectedPlan(e.learnPlanValue),e.ltiIntegration(t.sso_enabled)),t.starts_at){var o=new Date(1e3*t.starts_at);e.setStartDate(o),e.startDateChoice().indexOf(e.startSpecific)>-1&&e.selectedStartDateChoice(e.startSpecific)}t.timeframe&&"renewal"===t.timeframe&&e.selectedStartDateChoice(e.onNextRenewal),e.removeAllLibraries(),t.content_libraries&&(t.content_libraries.forEach(function(t){e.addLibrary(t.code).quantity(t.max_users)}),e.activeContentLibraryViewModels().length>0&&!1===e.showContentLibraries()&&e.toggleShowContentLibraries()),e.setHeardAboutUs(t.heard_about_us),e.selectedPaymentType(e.payByPoName),e.selectedPoOptions(e.havePo)}else e.addError(["errors.quoteNotFound"]);e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)}},e.startDateChoice=ko.computed(function(){var t=[];return e.requestingQuote()&&!e.hasSubscription()?(t.push(e.whenPoProvided),t.push(e.startSpecific),t.indexOf(e.selectedStartDateChoice())<0&&e.selectedStartDateChoice(null)):(t.push(e.startImmediately),e.hasSubscription()&&!e.hasFutureSubscription()?(t.push(e.onNextRenewal),t.indexOf(e.selectedStartDateChoice())<0&&e.selectedStartDateChoice(null)):(t.push(e.startSpecific),t.indexOf(e.selectedStartDateChoice())<0&&e.selectedStartDateChoice(null))),t}),e.payBy=ko.computed(function(){var t=[];return t.push(e.payByCcName),e.isLearnPlan(e.selectedPlan())&&t.push(e.payByPoName),t}),Noteflight.CommerceFormPricingListeners.call(this),e.changeMade=function(){if(e.requestingQuote()){if(e.hasSubscription&&!e.startChangeImmediately())return!0;if(!e.hasSubscription())return!0}if(!e.hasSubscription())return!0;if(e.currentPlan()!=e.selectedPlan())return!0;if(e.hasFutureSubscription()){var t=new Date(e.currentStartDate()),o=new Date(e.startDate());if(t.getTime()!=o.getTime()||e.startChangeImmediately())return!0}if(e.isLearnPlan(e.selectedPlan())){if(e.numLearnUsers()!=e.currentNumLearnUsers()||e.selectedNumLearnYears()!=e.currentNumLearnYears())return!0;if(e.clsHaveChanged())return!0}return!1},e.submitReady=ko.computed(function(){return!(e.serviceReporter.busyCounter()>0)&&!1!==e.changeMade()}),e.evaluateSubmit=function(){e.serviceReporter.busyCounter()>0||(e.clearReporterErrors(),e.requestingQuote()?e.submitQuoteRequest():e.startPurchase())},e.checkPromotedPlan=function(){Noteflight.postService("/api/1.0/subscription_plans",this.serviceReporter,function(t){t.promotion_coupon_code&&(e.showCouponField(!1),e.useHiddenCoupon(!0),e.couponCode(t.promotion_coupon_code),e.updatePricing())})()},e.initialize=function(){e.checkPromotedPlan(),Noteflight.configureRecurly()},e.initialize()},Noteflight.PurchaseConfirmation=function(){var e=this;e.templateName=ko.observable("commerce/purchaseConfirmation"),Noteflight.GenericPageViewModel.call(e),e.actionMap={newLearn:n.resource("content.purchase.learnSuccess"),renewLearn:n.resource("content.purchase.learnRenew"),premium:n.resource("content.purchase.premiumSuccess")},e.action=ko.observable(""),e.displayText=ko.computed(function(){return e.actionMap[e.action()]})},Noteflight.QuoteConfirmation=function(){var e=this;e.templateName=ko.observable("commerce/quoteConfirmation"),Noteflight.GenericPageViewModel.call(e),e.printQuoteUrl=ko.observable(""),e.purchaseQuoteUrl=ko.observable(""),e.quoteNumber=ko.observable(""),e.decodedUrl=ko.computed(function(){return decodeURIComponent(e.printQuoteUrl())}),e.decodedPurchaseUrl=ko.computed(function(){return decodeURIComponent(e.purchaseQuoteUrl())})},(0,r.addRoute)("commerceFormLearn","/commerce/purchase_learn:?url_users::?url_years::?url_sso_enabled::?url_coupon_code::?url_cls::?url_quote::?url_need_quote::?url_quote_number:#",Noteflight.CommerceFormViewModel,{url_plan:"learn"}),(0,r.addRoute)("commerceFormMonthly","/commerce/purchase_monthly:?url_users::?url_years::?url_sso_enabled::?url_coupon_code::?url_cls::?url_quote::?url_need_quote::?url_quote_number:#",Noteflight.CommerceFormViewModel,{url_plan:"monthly"}),(0,r.addRoute)("commerceFormAnnual","/commerce/purchase_annual:?url_users::?url_years::?url_sso_enabled::?url_coupon_code::?url_cls::?url_quote::?url_need_quote::?url_quote_number:#",Noteflight.CommerceFormViewModel,{url_plan:"annual"}),(0,r.addRoute)("quotePrintLearn","/commerce/print_quote:?quote_id:#",{},{}),(0,r.addRoute)("quoteConfirm","/commerce/quote/confirmation:?printQuoteUrl::?purchaseQuoteUrl::?quoteNumber:#",Noteflight.QuoteConfirmation),(0,r.addRoute)("learnPurchaseConfirm","/commerce/purchase_learn/confirmation_new#",Noteflight.PurchaseConfirmation,{action:"newLearn"}),(0,r.addRoute)("learnPurchaseRenew","/commerce/purchase_learn/confirmation_renewal#",Noteflight.PurchaseConfirmation,{action:"renewLearn"}),(0,r.addRoute)("premiumPurchaseConfirm","/commerce/purchase_premium/confirmation#",Noteflight.PurchaseConfirmation,{action:"premium"})},function(e,t,o){"use strict";o(60),o(189),o(115),o(20),o(190),o(113),o(237),o(191),o(239),o(31);var r=o(402);o(240),o(241),o(15),o(35),o(192),o(93),o(28),o(106),window.nfsyn=r.nfsyn},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nfsyn=void 0;var r=o(16),n=o(3),i=function(e){return e&&e.__esModule?e:{default:e}}(o(35));var a=o(403),s={};t.nfsyn=s;$.extend(s,{DECIBELS_PER_DECADE:20,MINIMUM_SIGNAL:1/65536,MINIMUM_CONTROL:1/128,PLAYBACK_STOP_DECAY:.1,EXPORT_AUDIO_SAMPLE_RATE:44100,EXPORT_AUDIO_DECAY_EXTRA_TIME:2,WARM_UP_DELAY:.3}),s.globalSynthesisParameters={reverbBuffer:{},partsXmlSpecification:{}},s.SynthesisContextSingleton=function(){var e;return{getInstance:function(t){return e||(e=new s.SynthesisContext(t)),e},clear:function(){e=null}}}(),s.SynthesisContext=function(e){var t=this;if(t.options=e,$.extend(this,e),this.active=!1,this.paused=!1,this.pausedTime=0,t.manifest=new s.InstrumentManifest(t,e),this.loadsStarted=0,this.loadsFinished=0,this.loadedCallbacks=[],this.loadingProgressCallbacks=[],this.audioContextResumed=!1,this.tooManyContexts=!1,this.reverbState=0,this.bufferedReverbType=null,this.latencyOffset=navigator.userAgent.match(/Android/)?.25:0,NF.hasAudio){try{if(this.offline){var o=e.sampleRate?e.sampleRate:s.EXPORT_AUDIO_SAMPLE_RATE;this.context=new OfflineAudioContext(2,(this.totalTime+s.WARM_UP_DELAY+s.EXPORT_AUDIO_DECAY_EXTRA_TIME)*o,o)}else{var i=window.AudioContext;if(i||((0,r.debug)("Falling back to deprecated webkitAudioContext"),i=window.webkitAudioContext),this.context=new i,null===this.context)return}}catch(e){return console.log("nfsyn.SynthesisContext ERROR!"),console.log(e),void(e instanceof DOMException&&"Failed to construct 'AudioContext': The number of hardware contexts provided (6) is greater than or equal to the maximum bound (6)."==e.message?this.tooManyContexts=!0:(0,n.standardAlertDialog)(e))}t.manifest.promise().done(function(){t.active=!0,"function"==typeof t.onLoad&&t.onLoad()}),this.compressor=this.context.createDynamicsCompressor(),this.compressor.threshold.value=-24,this.compressor.ratio.value=12,this.compressor.knee.value=30,this.compressor.attack.value=.003,this.compressor.release.value=.25,this.compressor.connect(this.context.destination);var a=this.context.createBufferSource();void 0===a.loopStart?(0,r.debug)("This AudioContext does not support looping."):this.supportsLooping=!0;var l=a.constructor.prototype;l.start?this.supportsStart=!0:((0,r.debug)("patching start/stop"),l.start=l.noteOn,l.stop=l.noteOff);var c=this.context.constructor.prototype;c.createGain||((0,r.debug)("patching createGain"),c.createGain=c.createGainNode);var u=this.context.createGain().gain.constructor.prototype;u.setTargetAtTime||((0,r.debug)("patching setTargetAtTime"),u.setTargetAtTime=u.setTargetValueAtTime),this.reverb=this.context.createConvolver(),this.wetGain=this.context.createGain(),this.wetGain.gain.value=0,this.masterGain=this.context.createGain(),this.dryGain=this.context.createGain(),this.metronomeGain=this.context.createGain(),this.destination=this.masterGain,this.score=null,this.scoreMix=null,this.getOriginalNameByUri=function(e){var o=this.manifest.getInstrumentByUri(t.premium,e);if(o)return o.getNameInPartDefaults()},this.getGenericInstrumentKeyByUri=function(e){var o=this.manifest.getInstrumentByUri(t.premium,e);if(o)return o.getGenericInstrument()},this.scoreMixBinding=function(){t.setMasterGain(t.scoreMix.masterGain),t.applyReverbImpulse(t.scoreMix.reverbType),t.setReverbLevel(t.scoreMix.reverbLevel)},this.staffChangeBinding=function(){t.scoreMixBinding();for(var e=t.score.parts,o=0;o<e.length;o++)t.setSynthesizerForPart(e[o])},this.setPremiumInstruments=function(e){t.premium=e,t.options.premium=e}}},s.SynthesisContext.prototype.setSynthesizerForPart=function(e,t){var o=this;if(!e.synthesizer){var r=this.manifest.getInstrumentByUri(o.premium,e.instrumentUri);if(r){var n=r.createInstrument(e);e.synthesizer=n,this.incLoading(),n.load(function(){o.decLoading(),t&&t()})}else e.dispatchErrorLoadingInstrument(e.instrumentUri)}},s.SynthesisContext.prototype.setScoreMix=function(e){this.scoreMix!=e&&(this.scoreMix&&this.scoreMix.removeEventListener("propertyChange",this.scoreMixBinding),this.scoreMix=e,this.scoreMix.addEventListener("propertyChange",this.scoreMixBinding),this.scoreMixBinding())},s.SynthesisContext.prototype.setScore=function(e){this.active&&this.score!=e&&(this.score&&this.score.removeEventListener("staffChange",this.staffChangeBinding),this.score=e,this.score.addEventListener("staffChange",this.staffChangeBinding),this.setScoreMix(e.mix),this.staffChangeBinding())},s.SynthesisContext.prototype.updateAllPartsInstruments=function(){for(var e=this.score,t=0;t<e.parts.length;t++){var o=e.parts[t],r=this.manifest.getInstrumentByUri(this.premium,o.instrumentUri);r&&s.globalSynthesisParameters.partsXmlSpecification.hasOwnProperty(r.getUri())&&(o.synthesizer=r.createInstrument(o,this),o.synthesizer.parseSpecification(s.globalSynthesisParameters.partsXmlSpecification[r.getUri()]),o.synthesizer.updateGain())}},s.SynthesisContext.prototype.incLoading=function(){this.loadsStarted++},s.SynthesisContext.prototype.decLoading=function(){this.loadsFinished++;for(var e=0;e<this.loadingProgressCallbacks.length;e++)this.loadingProgressCallbacks[e](this.loadsFinished,this.loadsStarted);if(this.loadsFinished>=this.loadsStarted){for(this.loadsStarted=this.loadsFinished=0,this.loadingProgressCallbacks=[],e=0;e<this.loadedCallbacks.length;e++)this.loadedCallbacks[e]();this.loadedCallbacks=[]}},s.SynthesisContext.prototype.whenLoaded=function(e,t){if(this.active)if(this.loadsFinished<this.loadsStarted){this.loadedCallbacks.push(e),t&&this.loadingProgressCallbacks.push(t);for(var o=0;o<this.loadingProgressCallbacks.length;o++)this.loadingProgressCallbacks[o](this.loadsFinished,this.loadsStarted)}else e()},s.SynthesisContext.prototype.getReverbUrl=function(e){return NF.asset("instruments/reverb/".concat(e,".wav"))},s.SynthesisContext.prototype.wireForNoReverb=function(){-1!=this.reverbState&&((0,r.debug)("disabling reverb"),this.masterGain.disconnect(),this.masterGain.connect(this.compressor),this.reverbState=-1)},s.SynthesisContext.prototype.wireForReverb=function(){1!=this.reverbState&&((0,r.debug)("Wiring for reverb"),this.masterGain.disconnect(),this.reverb.connect(this.wetGain),this.wetGain.connect(this.compressor),this.masterGain.connect(this.reverb),this.masterGain.connect(this.dryGain),this.dryGain.connect(this.compressor),this.metronomeGain.connect(this.compressor),this.reverbState=1)},s.SynthesisContext.prototype.applyReverbImpulse=function(e,t){var o=this,n=t||function(){};function i(){o.wireForReverb(),o.decLoading(),n()}if(!e||o.basicPerformance)o.wireForNoReverb(),n();else if(e==o.bufferedReverbType)o.wireForReverb(),n();else{var a=o.getReverbUrl(e);o.incLoading(),o.bufferedReverbType=e;var l=!0;if(s.globalSynthesisParameters.reverbBuffer.hasOwnProperty(e)){var c=s.globalSynthesisParameters.reverbBuffer[e];c.sampleRate==o.context.sampleRate&&(o.setReverbBuffer(c),i(),l=!1)}l&&s.utils.loadAudioBuffer(a,o.context,function(t){(0,r.debug)("Reverb impulse response "+a+" loaded."),s.globalSynthesisParameters.reverbBuffer[e]=t,o.setReverbBuffer(t),i()},function(e){(0,r.debug)("Loading reverb impulse response "+a+" failed: "+e),o.wireForNoReverb(),o.decLoading(),n()})}},s.SynthesisContext.prototype.setReverbBuffer=function(e){this.reverb&&this.reverb.buffer&&(this.reverb=this.context.createConvolver(),this.reverbState=0),this.reverb.buffer=e},s.SynthesisContext.prototype.setMasterGain=function(e){this.masterGain&&(this.masterGain.gain.value=s.utils.decibelsToFactor(e),this.metronomeGain.gain.value=s.utils.decibelsToFactor(e))},s.SynthesisContext.prototype.setReverbLevel=function(e){var t=s.utils.decibelsToFactor(e);this.wetGain.gain.value=t,this.dryGain.gain.value=Math.sqrt(1-t*t)},s.SynthesisContext.prototype.startSound=function(e){var t=this;this.active&&(this.audioContextResumed?e&&e():this.context.resume().then(function(){t.audioContextResumed=!0,e&&e()}))},s.SynthesisContext.prototype.loadAudioMedias=function(e){var t=this;this.getPartsAudioMedias(e).forEach(function(e){var o=function o(r){e.removeEventListener("audioMediaLoaded",o),e.removeEventListener("audioMediaLoadError",o),t.decLoading()};(e.notLoaded||e.loading)&&(e.addEventListener("audioMediaLoaded",o),e.addEventListener("audioMediaLoadError",o),t.incLoading(),e.loadingComplete||e.load())})},s.SynthesisContext.prototype.getPartsAudioMedias=function(e){for(var t=[],o=0;o<e.length;o++)for(var r=e[o].recordedAudioTracks,n=0;n<r.length;n++){var i=r[n];if(i.playbackEnabled)for(var a=i.audioClips,s=0;s<a.length;s++){var l=a[s].audioMedia;t.indexOf(l)<0&&t.push(l)}}return t},s.SynthesisContext.prototype.loadAudioMedia=function(e){var t=this.score.scoreId,o=e.mediaFileId,n="/api/1.0/media_file/contents?score_id="+t+"&media_file_id="+e.mediaFileId;s.utils.loadAudioBuffer(n,this.context,function(t){e.mediaFileData=t,e.notifyLoaded()},function(n){alert("Audio data loading error."),(0,r.debug)("Loading media file "+o+" for score "+t+" failed: "+n),e.notifyLoadError()})},s.utils={parseProperty:function(e,t,o,r,n){t.children(o).each(function(){r[n||o]=e($(this).text())})},parseStringProperty:function(e,t,o,r){e.children(t).each(function(){o[r||t]=$(this).text()})},parseNote:function(e){var t=[0,2,4,5,7,9,11]["CDEFGAB".indexOf(e.charAt(0))];return"#"==(e=e.substring(1)).charAt(0)?(t++,e=e.substring(1)):"b"==e.charAt(0)&&(t--,e=e.substring(1)),t+=12*Number(e)},decibelsToFactor:function(e){return Math.exp(e*Math.LN10/s.DECIBELS_PER_DECADE)},factorToDecibels:function(e){return Math.log(e)*Math.LOG10E*s.DECIBELS_PER_DECADE},loadAudioBuffer:function(e,t,o,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",r=r||alert,n.onload=function(){if(n.status>=400)r("HTTP error fetching "+e+": "+n.status+" "+n.statusText);else try{t.decodeAudioData(n.response,o,function(){r("error decoding file data "+e)})}catch(t){r("error decoding file data "+e+": "+t.message)}},n.onerror=function(){r("HTTP error fetching "+e+": "+n.status+" "+n.statusText)},n.send()}},s.instrumentZoneCache={},s.SampledInstrument=function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this;this.part=o,this.descriptor=t,this.preview=r,this.location=NF.asset("instruments/".concat(t.getSpecifications()[0].location)),this.baseUri=this.location.replace(/[^\/]+$/,""),this.baseUri=this.baseUri.slice(this.baseUri.indexOf("instruments")),this.sampleRate=t.getSpecifications()[0].sampleRate,this.synth=e,this.zones=[],this.loaded=!1,this.numLoaded=0,this.masterTuning=0,this.gain=1,this.release=0,this.clipAttack=.04,this.clipRelease=.04,this.instrumentName=t.getName(),this.info={chordTimeSkew:0,supportedArticulations:[]},this.loadCallbacks=[],this.loading=!1;var i=this.isMetronome()?this.synth.metronomeGain:this.synth.destination;this.pannerNode=this.synth.context.createGain(),this.panMerger=this.synth.context.createChannelMerger(2),1==t.getSpecifications()[0].channels&&(this.panGainL=this.synth.context.createGain(),this.panGainR=this.synth.context.createGain(),this.pannerNode.connect(this.panGainL),this.pannerNode.connect(this.panGainR),this.panGainL.connect(this.panMerger,0,0),this.panGainR.connect(this.panMerger,0,1),this.panMerger.connect(i),this.track=this.enabledTrack(o),this.mixSource=this.track||this.part,this.partBinding=function(){n.pannerNode.gain.value=n.part.muted?0:s.utils.decibelsToFactor(n.mixSource.gain);var e=(n.mixSource.pan+1)*Math.PI/4;n.panGainL.gain.value=Math.cos(e)+1e-10,n.panGainR.gain.value=Math.sin(e)+1e-10}),2==t.getSpecifications()[0].channels&&(this.panLeftToLeftGain=this.synth.context.createGain(),this.panLeftToRightGain=this.synth.context.createGain(),this.panRightToRightGain=this.synth.context.createGain(),this.panRightToLeftGain=this.synth.context.createGain(),this.panSplitter=this.synth.context.createChannelSplitter(2),this.pannerNode.connect(this.panSplitter),this.panSplitter.connect(this.panLeftToLeftGain,0),this.panSplitter.connect(this.panLeftToRightGain,0),this.panSplitter.connect(this.panRightToLeftGain,1),this.panSplitter.connect(this.panRightToRightGain,1),this.panLeftToLeftGain.connect(this.panMerger,0,0),this.panLeftToRightGain.connect(this.panMerger,0,1),this.panRightToLeftGain.connect(this.panMerger,0,0),this.panRightToRightGain.connect(this.panMerger,0,1),this.panMerger.connect(i),this.partBinding=function(){var e,t,r;n.pannerNode.gain.value=n.part.muted?0:s.utils.decibelsToFactor(n.mixSource.gain),o.pan>0?(e=n.mixSource.pan*Math.PI/2,t=Math.cos(e)+1e-10,r=Math.sin(e)+1e-10,n.panLeftToLeftGain.gain.value=t,n.panRightToLeftGain.gain.value=0,n.panLeftToRightGain.gain.value=r,n.panRightToRightGain.gain.value=1):(e=(n.mixSource.pan+1)*Math.PI/2,t=Math.cos(e)+1e-10,r=Math.sin(e)+1e-10,n.panLeftToLeftGain.gain.value=1,n.panRightToLeftGain.gain.value=t,n.panLeftToRightGain.gain.value=0,n.panRightToRightGain.gain.value=r)}),this.createScheduledNotesGain(),this.part.addEventListener&&this.part.addEventListener("propertyChange",this.partBinding),this.partBinding(),this.playingNotes={}},s.SampledInstrument.prototype.enabledTrack=function(e){for(var t=0;t<e.audioTracks.length;t++){var o=e.audioTracks[t];if(o.playbackEnabled)return o}return null},s.SampledInstrument.prototype.isMetronome=function(){return this.descriptor.getUri().indexOf("metronome")>-1},s.SampledInstrument.prototype.load=function(e){var t=this;t.loaded?e():(t.loadCallbacks.push(e),t.loading||(t.loading=!0,$.ajax({url:t.location,dataType:"xml"}).done(function(e){s.globalSynthesisParameters.partsXmlSpecification.hasOwnProperty(t.descriptor.getUri())||(s.globalSynthesisParameters.partsXmlSpecification[t.descriptor.getUri()]=e),t.parseSpecification(e),t.isMetronome()||t.updateGain(),$.each(t.zones,function(e,o){o.load(function(){++t.numLoaded==t.zones.length&&(t.loaded=!0,$.each(t.loadCallbacks,function(e,t){t()}),t.loadCallbacks=[])})})}).fail(function(){t.part.dispatchErrorLoadingInstrument(t.location)})))},s.SampledInstrument.prototype.parseSpecification=function(e){var t=this,o=$(e).find("wavInstrumentSpecification");s.utils.parseProperty(parseFloat,o,"tuning",t,"masterTuning"),s.utils.parseProperty(parseFloat,o,"release",t),s.utils.parseProperty(function(e){return s.utils.decibelsToFactor(parseFloat(e))},o,"gain",t),s.utils.parseProperty(parseFloat,o,"chordTimeSkew",t.info),o.find("zone").each(function(e,o){$(o);var r=new s.SampledInstrumentZone(t);r.parseZone(o);var n=s.instrumentZoneCache[r.cacheKey()];n?r=n:s.instrumentZoneCache[r.cacheKey()]=r,t.zones.push(r)})},s.SampledInstrument.prototype.scheduleNote=function(e,t,o,r,n,i){var a=this.createNote(e,t,o,r,n,i,this.scheduledNotesGain);return a?a.gainNode:null},s.SampledInstrument.prototype.scheduleClip=function(e,t){var o=this.synth.context.createBufferSource();o.buffer=t.audioMedia.mediaFileData;var r=this.synth.context.createGain();return r.gain.value=0,r.gain.setValueAtTime(s.MINIMUM_SIGNAL,e),r.gain.exponentialRampToValueAtTime(1,e+this.clipAttack),r.gain.setValueAtTime(1,e+t.mediaDuration-this.clipRelease),r.gain.exponentialRampToValueAtTime(s.MINIMUM_SIGNAL,e+t.mediaDuration),o.connect(r),r.connect(this.scheduledNotesGain),o.start(e,t.startOffset,t.mediaDuration),r},s.SampledInstrument.prototype.noteOn=function(e,t,o,r){var n=this.createNote(this.synth.context.currentTime,-1,e,t,o,r,this.pannerNode);if(!n)return null;var i=this.playingNotes[e];return i||(i=this.playingNotes[e]=[]),i.push(n),n},s.SampledInstrument.prototype.noteOff=function(e){var t=this.playingNotes[e],o=t&&t.pop();o&&this.endNoteNow(o)},s.SampledInstrument.prototype.endNoteAt=function(e,t){e.pitchSource.stop(t+this.release),this.release>0&&e.gainNode.gain.setTargetAtTime(0,t,this.release/-Math.log(s.MINIMUM_SIGNAL))},s.SampledInstrument.prototype.endNoteNow=function(e){this.endNoteAt(e,this.synth.context.currentTime)},s.SampledInstrument.prototype.createNote=function(e,t,o,n,i,a,l){var c=this.getNoteZone(o,n,i);if(!c&&i&&"normal"!=i&&(c=this.getNoteZone(o,n,"normal")),!c)return(0,r.debug)("No zone available for pitch/vel/articulation",o,n,i),null;var u=c.getShiftForNote(o),d=this.synth.context.createBufferSource();c.loopEnd>0&&(this.synth.supportsLooping?(d.loop=!0,d.loopStart=c.loopStart/c.sampleRate,d.loopEnd=c.loopEnd/c.sampleRate):(-1==t&&(t=5),c.ensureDuration(t*u))),d.buffer=c.buffer,d.playbackRate.value=u,this.synth.supportsStart?d.start(e,c.start/c.sampleRate):d.start(e);var p=this.synth.context.createGain(),f=s.utils.decibelsToFactor(.25*n-32)*c.gain;if(p.gain.value=f,c.loopDecay>0&&p.gain.setTargetAtTime(0,e+c.loopStart/c.sampleRate,c.loopDecay/-Math.log(s.MINIMUM_SIGNAL)),d.connect(p),a){a.sort(function(e,t){return e.startTime-t.startTime});for(var h=o,m=u,g=0;g<a.length;g++){var b=a[g];switch(b.modulation.name){case"bend":case"slide":var v=b.modulation.maxValue+o,y=c.getShiftForNote(v);d.playbackRate.setValueAtTime(m,b.startTime),d.playbackRate.exponentialRampToValueAtTime(y,b.endTime),h=v,m=y;break;case"vibrato":var _=b.endTime-b.startTime,S=2*b.modulation.frequency*_,w=1/(2*b.modulation.frequency),k=b.startTime,E=b.modulation.maxValue/2,P=c.getShiftForNote(h+E),C=c.getShiftForNote(h-E),T=0;d.playbackRate.setValueAtTime(m,k);for(var R=0;R<S;R++)T=R%2==0?P:C,d.playbackRate.exponentialRampToValueAtTime(T,k),k+=w;d.playbackRate.exponentialRampToValueAtTime(m,k)}}}p.connect(l);var O={pitchSource:d,gainNode:p};return-1!=t&&this.endNoteAt(O,e+t),O},s.SampledInstrument.prototype.getNoteZone=function(e,t,o){for(var r=0;r<this.zones.length;r++){var n=this.zones[r];if(n.match(e,t,o))return n}return null},s.SampledInstrument.prototype.isPitched=function(){return!this.descriptor.isUnpitched()},s.SampledInstrument.prototype.muteScheduledNotes=function(){var e=this.synth.context.currentTime,t=this.scheduledNotesGain.gain;t.cancelScheduledValues(e),t.setValueAtTime(1,e);for(var o=1;o<5;o++)t.exponentialRampToValueAtTime(s.MINIMUM_SIGNAL,e+s.PLAYBACK_STOP_DECAY*o);this.createScheduledNotesGain()},s.SampledInstrument.prototype.createScheduledNotesGain=function(){this.scheduledNotesGain=this.synth.context.createGain(),this.isMetronome()||this.updateGain(),this.scheduledNotesGain.connect(this.pannerNode)},s.SampledInstrument.prototype.updateGain=function(){this.scheduledNotesGain.gain.setValueAtTime(this.gain,this.synth.context.currentTime)},s.SampledInstrumentZone=function(e){this.instrument=e,this.minVelocity=0,this.maxVelocity=127,this.tuning=0,this.gain=1,this.start=0,this.loopDecay=0,this.loopStart=0,this.loopEnd=0,this.articulation="normal",this.sampleRate=e.sampleRate,this.loaded=!1,this.loading=!1,this.loadCallbacks=[]},s.SampledInstrumentZone.prototype.location=function(){var e=this.uri;return this.instrument.preview&&(e=("preview/"+this.uri).replace("wav","mp3")),NF.asset(this.instrument.baseUri+e)},s.SampledInstrumentZone.prototype.cacheKey=function(){var e="["+this.lowPitch+","+this.highPitch+"]";return this.instrument.baseUri+(this.name||this.uri)+e},s.SampledInstrumentZone.prototype.load=function(e){var t=this;t.loaded?e():(t.loadCallbacks.push(e),t.loading||(t.loading=!0,s.utils.loadAudioBuffer(t.location(),t.instrument.synth.context,function(e){if(t.buffer=e,t.start&&!t.instrument.synth.supportsStart){for(var o=t.instrument.synth.context.createBuffer(t.buffer.numberOfChannels,t.buffer.length-t.start,t.buffer.sampleRate),r=0;r<t.buffer.numberOfChannels;r++)o.getChannelData(r).set(t.buffer.getChannelData(r).subarray(t.start));t.buffer=o,t.loopEnd>0&&(t.loopStart-=t.start,t.loopEnd-=t.start)}t.loaded=!0,$.each(t.loadCallbacks,function(e,o){o(t)}),t.loadCallbacks=[]},function(e){alert("Instrument loading error."),(0,r.debug)("Loading instrument sample "+t.location()+" failed: "+e)})))},s.SampledInstrumentZone.prototype.ensureDuration=function(e){if(!(0===this.loopEnd||this.buffer.duration>=e)){for(var t=this.loopEnd-this.loopStart,o=0,r=1,n=this.loopStart+t;n<Math.ceil(e*this.buffer.sampleRate);)n+=r*t,r*=2,o++;for(var i=this.instrument.synth.context.createBuffer(this.buffer.numberOfChannels,n,this.buffer.sampleRate),a=0;a<this.buffer.numberOfChannels;a++)i.getChannelData(a).set(this.buffer.getChannelData(a));for(;o>0;){for(a=0;a<this.buffer.numberOfChannels;a++)i.getChannelData(a).set(i.getChannelData(a).subarray(this.loopStart,this.loopEnd),this.loopEnd);this.loopEnd+=t,t*=2,o--}this.buffer=i}},s.SampledInstrumentZone.prototype.parseZone=function(e){var t=$(e);s.utils.parseStringProperty(t,"name",this),s.utils.parseStringProperty(t,"articulation",this),s.utils.parseStringProperty(t,"uri",this),s.utils.parseProperty(parseInt,t,"sampleRate",this),s.utils.parseProperty(parseInt,t,"minVelocity",this),s.utils.parseProperty(parseInt,t,"maxVelocity",this),s.utils.parseProperty(parseFloat,t,"loopDecay",this),s.utils.parseProperty(parseFloat,t,"tuning",this),s.utils.parseProperty(parseFloat,t,"gain",this),s.utils.parseProperty(s.utils.parseNote,t,"rootPitch",this),s.utils.parseProperty(s.utils.parseNote,t,"lowPitch",this),s.utils.parseProperty(s.utils.parseNote,t,"highPitch",this),s.utils.parseProperty(parseInt,t,"start",this),s.utils.parseProperty(parseInt,t,"loopStart",this),s.utils.parseProperty(parseInt,t,"loopEnd",this)},s.SampledInstrumentZone.prototype.getShiftForNote=function(e){var t=this.tuning+this.instrument.masterTuning+100*(e-this.rootPitch);return Math.exp(Math.LN2*t/1200)},s.SampledInstrumentZone.prototype.match=function(e,t,o){return(o||"normal")==this.articulation&&e>=this.lowPitch&&e<=this.highPitch},s.InstrumentManifest=function(e,t){this.synth=e,this.options=t,this.premium={list:[],map:{},groupsList:[]},this.basic={list:[],map:{},groupsList:[]},this.loaded=!1,this._parsedGroupsList=!1},s.InstrumentManifest.prototype.promise=function(){var e=this,t=e._deferred;if(!t){var o=e.options.manifestLocation;e._deferred=t=$.Deferred(),i.default.xhrRequest({url:o,dataType:"xml"}).done(function(o){"undefined"!=typeof $$nf&&(e.xml=$$nf.classes.XML.fromDOM(o.firstChild)),e.parseManifest(o),e.loaded=!0,t.resolve(e)}).fail(function(){alert("Could not load instrument manifest at "+o),t.reject()})}return t},s.InstrumentManifest.prototype.parseManifest=function(e){var t=this;t.$xml=$(e);var o=null;t.$xml.find("instrumentLibrary").each(function(e,r){var n=$(r);o="true"==n.attr("premium")?t.premium:t.basic,n.find("instrument").each(function(e,r){var n=new s.InstrumentDescriptor(t,r);o.list.push(n),o.map[n.getUri()]=n;for(var i=n.getAliases(),a=0;a<i.length;a++)o.map[i[a]]=n})})},s.InstrumentManifest.prototype.getInstrumentByUri=function(e,t){for(var o=(e?this.premium:this.basic).map;;){if(o[t])return o[t];var r=t.lastIndexOf("/");if(r<0)break;t=t.substring(0,r)}return o.default},s.InstrumentManifest.prototype.getGroupsList=function(e){var t=this,o=null;return t._parsedGroupsList||(t.$xml.find("instrumentLibrary").each(function(e,r){var n=$(r);o="true"==n.attr("premium")?t.premium:t.basic,n.find("groupsList group").each(function(e,t){o.groupsList.push({name:$(t).text()})})}),t._parsedGroupsList=!0),e?t.premium.groupsList:t.basic.groupsList},s.InstrumentDescriptor=function(e,t){this.manifest=e,this.$xml=$(t),this.classic="true"==this.$xml.attr("classic")},s.InstrumentDescriptor.prototype.createInstrument=function(e,t){var o=e||new $$nf.classes.com.noteflight.notation.model.Part,r=t||this.manifest.synth;return o.synthesizer=new s.SampledInstrument(r,this,o,this.manifest.options.preview),o.synthesizer},s.InstrumentDescriptor.prototype.getName=function(){return void 0===this._name&&(this._name=this.$xml.find("name").first().text()),this._name},s.InstrumentDescriptor.prototype.getShortName=function(){return void 0===this._shortName&&(this._shortName=this.$xml.find("shortName").first().text()),this._shortName},s.InstrumentDescriptor.prototype.getDescription=function(){return void 0===this._description&&(this._description=this.$xml.find("description").first().text()),this._description},s.InstrumentDescriptor.prototype.getGenericInstrument=function(){return void 0===this._genericInstrument&&(this._genericInstrument=this.$xml.find("genericInstrument").first().text()),this._genericInstrument},s.InstrumentDescriptor.prototype.getGroups=function(){var e=this;return void 0===e._groups&&(e._groups=[],e.$xml.find("group").each(function(t,o){e._groups.push($(o).text())})),e._groups},s.InstrumentDescriptor.prototype.getUri=function(){return void 0===this._uri&&(this._uri=this.$xml.find("uri").first().text()),this._uri},s.InstrumentDescriptor.prototype.getAliases=function(){var e=this;return void 0===e._aliases&&(e._aliases=[],e.$xml.find("alias").each(function(t,o){e._aliases.push($(o).text())})),e._aliases},s.InstrumentDescriptor.prototype.getSpecifications=function(){var e=this;return void 0===e._specifications&&(e._specifications=[],e.$xml.find("specification").each(function(t,o){var r=e.parseSpecification(o);e._specifications.push(r)})),e._specifications},s.InstrumentDescriptor.prototype.getPartDefaults=function(){return void 0===this._partDefaults&&(this._partDefaults=this.$xml.find("partDefaults").first().get(0)),this._partDefaults},s.InstrumentDescriptor.prototype.getNameInPartDefaults=function(){return void 0===this._nameInPartDefaults&&(this._nameInPartDefaults=this.$xml.find("partDefaults name").first().text()),this._nameInPartDefaults},s.InstrumentDescriptor.prototype.isUnpitched=function(){if(void 0===this._unpitched){var e=$(this.getPartDefaults()).find("sign").text();this._unpitched="percussion"==e||"percussion2"==e}return this._unpitched},s.InstrumentDescriptor.prototype.parseSpecification=function(e){var t=$(e);return{descriptor:this,type:t.find("type").text(),location:t.find("location").text(),bitsPerSample:t.find("bitsPerSample").text(),sampleRate:t.find("sampleRate").text(),channels:t.find("channels").text()}},s.Sequencer=function(e,t,o,r){this.synth=e,this.manifest=t,this.sequence=o,this.scheduledNotes=[];var n=this,i=0;if(o.noteTimes?this.noteTimes=o.noteTimes:this.noteTimes=$.map(o.performance.elements,function(e){var t=e.onset+e.duration;return i=Math.max(i,t),{startTime:n.scorePositionToTime(e.onset),endTime:n.scorePositionToTime(t)}}),this.endTick=i,this.playWindow=2,this.playWindowInterval=.5,this.playbackSpeed=1,this.pitchShift=0,this.sequenceStart=0,this.sequenceEnd=0,this.playing=!1,this.premium=!0,this.options=r||{},"number"!=typeof this.options.loopStart||this.options.loopStart<0||void 0!==this.options.loopEnd&&"number"!=typeof this.options.loopEnd||this.options.loopEnd<=0||this.options.loopStart>=this.options.loopEnd||void 0!==this.options.loopLimit&&"number"!=typeof this.options.loopLimit||this.options.loopLimit<=1)this.loopLimit=0,this.loopStart=0,this.loopEnd=0;else{this.loopStartTick=this.options.loopStart,this.loopStart=n.scorePositionToTime(this.loopStartTick),this.loopEndTick=void 0===this.options.loopEnd?this.endTick:this.options.loopEnd,this.loopEnd=n.scorePositionToTime(this.loopEndTick),this.loopLimit=void 0===this.options.loopLimit?this.options.loopLimit=1/0:this.options.loopLimit,this.loopStartIndex=this.noteTimes.length,this.loopEndIndex=0;for(var a=0;a<this.noteTimes.length;a++){var s=this.noteTimes[a];this.loopStartIndex==this.noteTimes.length&&s.startTime>=this.loopStart&&(this.loopStartIndex=a),s.startTime<this.loopEnd&&(this.loopEndIndex=a+1)}}this.startingLoopRepetition=0,o.scoreMix&&(this.synth.setMasterGain(o.scoreMix.masterGain),this.synth.applyReverbImpulse(o.scoreMix.reverbType),this.synth.setReverbLevel(o.scoreMix.reverbLevel))},s.Sequencer.prototype.perform=function(){var e=this;this.synth.paused=!1,this.synth.whenLoaded(function(){e.startPlaying()})},s.Sequencer.prototype.timeOffset=function(){return this.synth.active?this.synth.paused?this.synth.pausedTime:this.timeOffsetAndLoopRep(!0).timeOffset:0},s.Sequencer.prototype.setPausedTime=function(e){this.synth.pausedTime=e},s.Sequencer.prototype.timeOffsetAndLoopRep=function(e){var t=e?this.synth.latencyOffset:0,o=(this.synth.context.currentTime-t-this.startTime)/this.playbackSpeed,r=0;return this.loopLimit&&o>this.loopStart&&(r=Math.floor((o-this.loopStart)/(this.loopEnd-this.loopStart)),o-=(r=Math.min(r,this.loopLimit-1))*(this.loopEnd-this.loopStart)),{timeOffset:o,loopRep:r}},s.Sequencer.prototype.setPlaybackSpeed=function(e){var t=this.timeOffsetAndLoopRep();this.stop(),this.startingLoopRepetition=t.loopRep,this.sequenceStart=t.timeOffset,this.playbackSpeed=e,this.startPlaying()},s.Sequencer.prototype.setPitchShift=function(e){this.pitchShift=e,this.setPlaybackSpeed(this.playbackSpeed)},s.Sequencer.prototype.stopPlayback=function(){this.haltPlayback(),$.each(this.sequence.parts,function(e,t){t.synthesizer.muteScheduledNotes()})},s.Sequencer.prototype.stop=function(){this.stopPlayback(),this.synth.paused=!1},s.Sequencer.prototype.pause=function(){this.stopPlayback(),this.synth.paused=!0},s.Sequencer.prototype.prepareToResumePlayback=function(){this.synth.paused=!1},s.Sequencer.prototype.prepareElementsToPlay=function(){this.startTime=this.synth.context.currentTime+s.WARM_UP_DELAY,this.startTime-=(this.sequenceStart+(this.loopEnd-this.loopStart)*this.startingLoopRepetition)*this.playbackSpeed,this.loopTimeShift=0,this.loopCount=1,this.index=0,this.loopStartRestartNotes=[]},s.Sequencer.prototype.startPlaying=function(){if(this.synth.active){this.prepareElementsToPlay();var e=this;this.playWindowHandle=setInterval(function(){e.playNextWindow()},1e3*this.playWindowInterval),this.playNextWindow(),this.playing=!0}},s.Sequencer.prototype.haltPlayback=function(){this.playing&&(clearInterval(this.playWindowHandle),this.playing=!1)},s.Sequencer.prototype.createWav=function(e,t){var o=this;this.renderOfflineAudio(e,function(e){o.exportWav(e,t)})},s.Sequencer.prototype.createMP3=function(e,t){var o=this;this.renderOfflineAudio(e,function(e){o.exportMP3(e,t)})},s.Sequencer.prototype.renderOfflineAudio=function(e,t){var o=this,n=this.synth.context;this.loadInstruments(function(){o.synth.compressor.disconnect(),o.synth.compressor.connect(n.destination),o.prepareElementsToPlay(),o.playNextWindow(e),n.startRendering().then(t).catch(function(e){(0,r.debug)("Rendering failed: "+e),t(null)})})},s.Sequencer.prototype.exportWav=function(e,t){var o=function(e,t){for(var o=e.length+t.length,r=new Float32Array(o),n=0,i=0;n<o;)r[n++]=e[i],r[n++]=t[i],i++;return r}(e.getChannelData(0),e.getChannelData(1));t(this.encodeWAV(o))},s.Sequencer.prototype.encodeWAV=function(e){var t=new ArrayBuffer(44+2*e.length),o=new DataView(t);function r(e,t,o){for(var r=0;r<o.length;r++)e.setUint8(t+r,o.charCodeAt(r))}return r(o,0,"RIFF"),o.setUint32(4,32+2*e.length,!0),r(o,8,"WAVE"),r(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,2,!0),o.setUint32(24,s.EXPORT_AUDIO_SAMPLE_RATE,!0),o.setUint32(28,4*s.EXPORT_AUDIO_SAMPLE_RATE,!0),o.setUint16(32,4,!0),o.setUint16(34,16,!0),r(o,36,"data"),o.setUint32(40,2*e.length,!0),function(e,t,o){for(var r=0;r<o.length;r++,t+=2){var n=Math.max(-1,Math.min(1,o[r]));e.setInt16(t,n<0?32768*n:32767*n,!0)}}(o,44,e),o},s.Sequencer.prototype.amplifyBuffer=function(e){for(var t=[],o=0;o<e.numberOfChannels;o++){for(var r=e.getChannelData(o),n=new Float32Array(r.length),i=0;i<r.length;i++)n[i]=32767.5*r[i];t.push(n)}return t},s.Sequencer.prototype.exportMP3=function(e,t){var o=new a.Mp3Encoder(e.numberOfChannels,e.sampleRate,128),r=[],n=this.amplifyBuffer(e),i=0;!function a(){if(i<e.length){var s=n.map(function(e){return e.subarray(i,i+1152)}),l=o.encodeBuffer.apply(o,s);if(l.length>0&&r.push(l),(i+=1152)%11520==0)return setTimeout(a,0);a()}else!function(){var e=o.flush();e.length>0&&r.push(e),t(r)}()}()},s.Sequencer.prototype.scorePositionToTime=function(e){return this.sequence.scorePositionMap?this.sequence.scorePositionMap.scorePositionToTime(e):e},s.Sequencer.prototype.playNextWindow=function(e){for(var t=this.sequence.performance.elements,o=e||this.synth.context.currentTime-this.startTime+this.playWindow,r=0;r<this.scheduledNotes.length;){var n=this.scheduledNotes[r];n.endTime<this.synth.context.currentTime?(n.gainNode.disconnect(),this.scheduledNotes.splice(r,1)):r++}for(;;){if(this.index>=t.length&&this.loopCount>=this.loopLimit)return void this.haltPlayback();var i=t[this.index],a=this.noteTimes[this.index];if(i&&this.loopLimit&&a.startTime>=this.loopEnd&&this.loopCount<this.loopLimit&&(i=null),i){var s=a.startTime*this.playbackSpeed;if(s+this.loopTimeShift>o)return;var l=a.endTime*this.playbackSpeed;if(this.loopLimit&&(a.startTime<this.loopStart&&a.endTime>this.loopStart&&this.loopStartRestartNotes.push({noteTimes:a,note:i}),a.startTime<this.loopEnd&&a.endTime>this.loopEnd&&this.loopCount<this.loopLimit&&(l=this.loopEnd*this.playbackSpeed)),this.sequenceEnd>0&&s>=this.sequenceEnd)return void this.haltPlayback();this.scheduleElement(i,s,l),this.index++}if(this.index>=this.loopEndIndex&&this.loopCount<this.loopLimit){if(this.loopEnd*this.playbackSpeed+this.loopTimeShift>o)return;this.loopTimeShift+=(this.loopEnd-this.loopStart)*this.playbackSpeed,this.index=this.loopStartIndex,this.loopCount++;for(var c=0;c<this.loopStartRestartNotes.length;c++){var u=this.loopStartRestartNotes[c],d=u.noteTimes.endTime;this.loopCount<this.loopLimit&&d>this.loopEnd&&(d=this.loopEnd),this.scheduleElement(u.note,this.loopStart*this.playbackSpeed,d*this.playbackSpeed)}}}},s.Sequencer.prototype.scheduleElement=function(e,t,o){"undefined"!=typeof $$nf&&e instanceof $$nf.classes.com.noteflight.performance.PerformableClip?this.scheduleClip(e,t,o):this.scheduleNote(e,t,o)},s.Sequencer.prototype.scheduleNote=function(e,t,o){var r=this.synth.context.currentTime-this.startTime,n=t+this.loopTimeShift,i=o-t,a=null;if(e.pitchModulations){a=[];for(var s=0;s<e.pitchModulations.length;s++){var l=this.synth.preview?e.modulationsList[s].modEndTime:this.scorePositionToTime(e.onset+e.pitchModulations[s].endTime)*this.playbackSpeed,c=this.synth.preview?e.modulationsList[s].modStartTime:this.scorePositionToTime(e.onset+e.pitchModulations[s].startTime)*this.playbackSpeed;a.push({startTime:this.startTime+c+this.loopTimeShift,endTime:this.startTime+l+this.loopTimeShift,modulation:e.pitchModulations[s]})}}if(n+i>r){var u=this.sequence.parts[e.channel].synthesizer,d=e.tunedOrdinal;u.isPitched()&&(d+=this.pitchShift);var p=u.scheduleNote(this.startTime+n,i,d,e.velocity,e.articulationValue||(e.articulation?e.articulation.value:"normal"),a);p&&this.scheduledNotes.push({gainNode:p,endTime:this.startTime+n+i+u.release})}},s.Sequencer.prototype.scheduleClip=function(e,t,o){var r=this.sequence.parts[e.channel].synthesizer,n=this.startTime+t+this.loopTimeShift,i=r.scheduleClip(n,e);i&&this.scheduledNotes.push({gainNode:i,endTime:this.startTime+e.onset+this.loopTimeShift+e.duration})},s.Sequencer.prototype.modulationCopy=function(e){return $.extend({},e)},s.Sequencer.prototype.loadInstruments=function(e,t){var o=this;$.each(this.sequence.parts,function(e,t){o.synth.setSynthesizerForPart(t)}),o.synth.loadAudioMedias(this.sequence.parts),this.synth.whenLoaded(e,t)}},function(e,t){function o(){function e(e){return new Int8Array(e)}function t(e){return new Int16Array(e)}function r(e){return new Int32Array(e)}function n(e){return new Float32Array(e)}function i(e){return new Float64Array(e)}function a(e){if(1==e.length)return n(e[0]);var t=e[0];e=e.slice(1);for(var o=[],r=0;r<t;r++)o.push(a(e));return o}function s(e){if(1==e.length)return r(e[0]);var t=e[0];e=e.slice(1);for(var o=[],n=0;n<t;n++)o.push(s(e));return o}function l(e){if(1==e.length)return t(e[0]);var o=e[0];e=e.slice(1);for(var r=[],n=0;n<o;n++)r.push(l(e));return r}function c(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var o=[],r=0;r<t;r++)o.push(c(e));return o}var u={fill:function(e,t,o,r){if(2==arguments.length)for(var n=0;n<e.length;n++)e[n]=arguments[1];else for(n=t;n<o;n++)e[n]=r}},d={arraycopy:function(e,t,o,r,n){for(var i=t+n;t<i;)o[r++]=e[t++]}},p={};function f(e){this.ordinal=e}p.SQRT2=1.4142135623730951,p.FAST_LOG10=function(e){return Math.log10(e)},p.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},f.short_block_allowed=new f(0),f.short_block_coupled=new f(1),f.short_block_dispensed=new f(2),f.short_block_forced=new f(3);var h={};function m(e){this.ordinal=e}h.MAX_VALUE=3.4028235e38,m.vbr_off=new m(0),m.vbr_mt=new m(1),m.vbr_rh=new m(2),m.vbr_abr=new m(3),m.vbr_mtrh=new m(4),m.vbr_default=m.vbr_mtrh;function g(e){var t=e;this.ordinal=function(){return t}}function b(){var e=null;function t(e){this.bits=0|e}this.qupvt=null,this.setModules=function(t){this.qupvt=t,e=t};var o=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function n(e,t,o,r,n,i){var a=.5946/t;for(e>>=1;0!=e--;)n[i++]=a>o[r++]?0:1,n[i++]=a>o[r++]?0:1}function i(t,o,r,n,i,a){var s=(t>>=1)%2;for(t>>=1;0!=t--;){var l,c,u,d,p,f,h,m;l=r[n++]*o,c=r[n++]*o,p=0|l,u=r[n++]*o,f=0|c,d=r[n++]*o,h=0|u,l+=e.adj43[p],m=0|d,c+=e.adj43[f],i[a++]=0|l,u+=e.adj43[h],i[a++]=0|c,d+=e.adj43[m],i[a++]=0|u,i[a++]=0|d}0!=s&&(p=0|(l=r[n++]*o),f=0|(c=r[n++]*o),l+=e.adj43[p],c+=e.adj43[f],i[a++]=0|l,i[a++]=0|c)}var a=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function s(e,t,o,r){var n=function(e,t,o){var r=0,n=0;do{var i=e[t++],a=e[t++];r<i&&(r=i),n<a&&(n=a)}while(t<o);return r<n&&(r=n),r}(e,t,o);switch(n){case 0:return n;case 1:return function(e,t,o,r){var n=0,i=w.ht[1].hlen;do{var a=2*e[t+0]+e[t+1];t+=2,n+=i[a]}while(t<o);return r.bits+=n,1}(e,t,o,r);case 2:case 3:return function(e,t,o,r,n){var i,a,s=0,l=w.ht[r].xlen;a=2==r?w.table23:w.table56;do{var c=e[t+0]*l+e[t+1];t+=2,s+=a[c]}while(t<o);return i=65535&s,(s>>=16)>i&&(s=i,r++),n.bits+=s,r}(e,t,o,a[n-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,o,r,n){var i=0,a=0,s=0,l=w.ht[r].xlen,c=w.ht[r].hlen,u=w.ht[r+1].hlen,d=w.ht[r+2].hlen;do{var p=e[t+0]*l+e[t+1];t+=2,i+=c[p],a+=u[p],s+=d[p]}while(t<o);var f=r;return i>a&&(i=a,f++),i>s&&(i=s,f=r+2),n.bits+=i,f}(e,t,o,a[n-1],r);default:if(n>C.IXMAX_VAL)return r.bits=C.LARGE_BITS,-1;var i,s;for(n-=15,i=24;i<32&&!(w.ht[i].linmax>=n);i++);for(s=i-8;s<24&&!(w.ht[s].linmax>=n);s++);return function(e,t,o,r,n,i){var a,s=65536*w.ht[r].xlen+w.ht[n].xlen,l=0;do{var c=e[t++],u=e[t++];0!=c&&(c>14&&(c=15,l+=s),c*=16),0!=u&&(u>14&&(u=15,l+=s),c+=u),l+=w.largetbl[c]}while(t<o);return a=65535&l,(l>>=16)>a&&(l=a,r=n),i.bits+=l,r}(e,t,o,s,i,r)}}function l(e,o,r,n,i,a,l,c){for(var u=o.big_values,d=2;d<A.SBMAX_l+1;d++){var p=e.scalefac_band.l[d];if(p>=u)break;var f=i[d-2]+o.count1bits;if(r.part2_3_length<=f)break;var h=new t(f),m=s(n,p,u,h);f=h.bits,r.part2_3_length<=f||(r.assign(o),r.part2_3_length=f,r.region0_count=a[d-2],r.region1_count=d-2-a[d-2],r.table_select[0]=l[d-2],r.table_select[1]=c[d-2],r.table_select[2]=m)}}this.noquant_count_bits=function(e,o,r){var n=o.l3_enc,i=Math.min(576,o.max_nonzero_coeff+2>>1<<1);for(null!=r&&(r.sfb_count1=0);i>1&&0==(n[i-1]|n[i-2]);i-=2);o.count1=i;for(var a=0,l=0;i>3;i-=4){var c;if((2147483647&(n[i-1]|n[i-2]|n[i-3]|n[i-4]))>1)break;c=2*(2*(2*n[i-4]+n[i-3])+n[i-2])+n[i-1],a+=w.t32l[c],l+=w.t33l[c]}var u=a;if(o.count1table_select=0,a>l&&(u=l,o.count1table_select=1),o.count1bits=u,o.big_values=i,0==i)return u;if(o.block_type==A.SHORT_TYPE)(a=3*e.scalefac_band.s[3])>o.big_values&&(a=o.big_values),l=o.big_values;else if(o.block_type==A.NORM_TYPE){if(a=o.region0_count=e.bv_scf[i-2],l=o.region1_count=e.bv_scf[i-1],l=e.scalefac_band.l[a+l+2],a=e.scalefac_band.l[a+1],l<i){var d=new t(u);o.table_select[2]=s(n,l,i,d),u=d.bits}}else o.region0_count=7,o.region1_count=A.SBMAX_l-1-7-1,(a=e.scalefac_band.l[8])>(l=i)&&(a=l);if(a=Math.min(a,i),l=Math.min(l,i),0<a){d=new t(u);o.table_select[0]=s(n,0,a,d),u=d.bits}if(a<l){d=new t(u);o.table_select[1]=s(n,a,l,d),u=d.bits}if(2==e.use_best_huffman&&(o.part2_3_length=u,best_huffman_divide(e,o),u=o.part2_3_length),null!=r&&o.block_type==A.NORM_TYPE){for(var p=0;e.scalefac_band.l[p]<o.big_values;)p++;r.sfb_count1=p}return u},this.count_bits=function(t,o,r,a){var s=r.l3_enc,l=C.IXMAX_VAL/e.IPOW20(r.global_gain);if(r.xrpow_max>l)return C.LARGE_BITS;if(function(t,o,r,a,s){var l,c,d,p=0,f=0,h=0,m=0,g=o,b=0,v=g,y=0,_=t,S=0;for(d=null!=s&&a.global_gain==s.global_gain,c=a.block_type==A.SHORT_TYPE?38:21,l=0;l<=c;l++){var w=-1;if((d||a.block_type==A.NORM_TYPE)&&(w=a.global_gain-(a.scalefac[l]+(0!=a.preflag?e.pretab[l]:0)<<a.scalefac_scale+1)-8*a.subblock_gain[a.window[l]]),d&&s.step[l]==w)0!=f&&(i(f,r,_,S,v,y),f=0),0!=h&&(n(h,r,_,S,v,y),h=0);else{var k,E=a.width[l];if(p+a.width[l]>a.max_nonzero_coeff&&(k=a.max_nonzero_coeff-p+1,u.fill(o,a.max_nonzero_coeff,576,0),(E=k)<0&&(E=0),l=c+1),0==f&&0==h&&(v=g,y=b,_=t,S=m),null!=s&&s.sfb_count1>0&&l>=s.sfb_count1&&s.step[l]>0&&w>=s.step[l]?(0!=f&&(i(f,r,_,S,v,y),f=0,v=g,y=b,_=t,S=m),h+=E):(0!=h&&(n(h,r,_,S,v,y),h=0,v=g,y=b,_=t,S=m),f+=E),E<=0){0!=h&&(n(h,r,_,S,v,y),h=0),0!=f&&(i(f,r,_,S,v,y),f=0);break}}l<=c&&(b+=a.width[l],m+=a.width[l],p+=a.width[l])}0!=f&&(i(f,r,_,S,v,y),f=0),0!=h&&(n(h,r,_,S,v,y),h=0)}(o,s,e.IPOW20(r.global_gain),r,a),0!=(2&t.substep_shaping))for(var c=0,d=r.global_gain+r.scalefac_scale,p=.634521682242439/e.IPOW20(d),f=0;f<r.sfbmax;f++){var h,m=r.width[f];if(0==t.pseudohalf[f])c+=m;else for(h=c,c+=m;h<c;++h)s[h]=o[h]>=p?s[h]:0}return this.noquant_count_bits(t,r,a)},this.best_huffman_divide=function(e,o){var n=new T,i=o.l3_enc,a=r(23),c=r(23),u=r(23),d=r(23);if(o.block_type!=A.SHORT_TYPE||1!=e.mode_gr){n.assign(o),o.block_type==A.NORM_TYPE&&(!function(e,o,r,n,i,a,l){for(var c=o.big_values,u=0;u<=22;u++)n[u]=C.LARGE_BITS;for(u=0;u<16;u++){var d=e.scalefac_band.l[u+1];if(d>=c)break;var p=0,f=new t(p),h=s(r,0,d,f);p=f.bits;for(var m=0;m<8;m++){var g=e.scalefac_band.l[u+m+2];if(g>=c)break;var b=p,v=s(r,d,g,f=new t(b));b=f.bits,n[u+m]>b&&(n[u+m]=b,i[u+m]=u,a[u+m]=h,l[u+m]=v)}}}(e,o,i,a,c,u,d),l(e,n,o,i,a,c,u,d));var p=n.big_values;if(!(0==p||(i[p-2]|i[p-1])>1||(p=o.count1+2)>576)){n.assign(o),n.count1=p;for(var f=0,h=0;p>n.big_values;p-=4){var m=2*(2*(2*i[p-4]+i[p-3])+i[p-2])+i[p-1];f+=w.t32l[m],h+=w.t33l[m]}if(n.big_values=p,n.count1table_select=0,f>h&&(f=h,n.count1table_select=1),n.count1bits=f,n.block_type==A.NORM_TYPE)l(e,n,o,i,a,c,u,d);else{if(n.part2_3_length=f,(f=e.scalefac_band.l[8])>p&&(f=p),f>0){var g=new t(n.part2_3_length);n.table_select[0]=s(i,0,f,g),n.part2_3_length=g.bits}if(p>f){g=new t(n.part2_3_length);n.table_select[1]=s(i,f,p,g),n.part2_3_length=g.bits}o.part2_3_length>n.part2_3_length&&o.assign(n)}}}};var c=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],p=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],f=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],h=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];b.slen1_tab=f,b.slen2_tab=h,this.best_scalefac_store=function(t,o,r,n){var i,a,s,l,u=n.tt[o][r],d=0;for(s=0,i=0;i<u.sfbmax;i++){var m=u.width[i];for(s+=m,l=-m;l<0&&0==u.l3_enc[l+s];l++);0==l&&(u.scalefac[i]=d=-2)}if(0==u.scalefac_scale&&0==u.preflag){var g=0;for(i=0;i<u.sfbmax;i++)u.scalefac[i]>0&&(g|=u.scalefac[i]);if(0==(1&g)&&0!=g){for(i=0;i<u.sfbmax;i++)u.scalefac[i]>0&&(u.scalefac[i]>>=1);u.scalefac_scale=d=1}}if(0==u.preflag&&u.block_type!=A.SHORT_TYPE&&2==t.mode_gr){for(i=11;i<A.SBPSY_l&&!(u.scalefac[i]<e.pretab[i]&&-2!=u.scalefac[i]);i++);if(i==A.SBPSY_l){for(i=11;i<A.SBPSY_l;i++)u.scalefac[i]>0&&(u.scalefac[i]-=e.pretab[i]);u.preflag=d=1}}for(a=0;a<4;a++)n.scfsi[r][a]=0;for(2==t.mode_gr&&1==o&&n.tt[0][r].block_type!=A.SHORT_TYPE&&n.tt[1][r].block_type!=A.SHORT_TYPE&&(!function(e,t){for(var o,r=t.tt[1][e],n=t.tt[0][e],i=0;i<w.scfsi_band.length-1;i++){for(o=w.scfsi_band[i];o<w.scfsi_band[i+1]&&!(n.scalefac[o]!=r.scalefac[o]&&r.scalefac[o]>=0);o++);if(o==w.scfsi_band[i+1]){for(o=w.scfsi_band[i];o<w.scfsi_band[i+1];o++)r.scalefac[o]=-1;t.scfsi[e][i]=1}}var a=0,s=0;for(o=0;o<11;o++)-1!=r.scalefac[o]&&(s++,a<r.scalefac[o]&&(a=r.scalefac[o]));for(var l=0,u=0;o<A.SBPSY_l;o++)-1!=r.scalefac[o]&&(u++,l<r.scalefac[o]&&(l=r.scalefac[o]));for(i=0;i<16;i++)if(a<c[i]&&l<p[i]){var d=f[i]*s+h[i]*u;r.part2_length>d&&(r.part2_length=d,r.scalefac_compress=i)}}(r,n),d=0),i=0;i<u.sfbmax;i++)-2==u.scalefac[i]&&(u.scalefac[i]=0);0!=d&&(2==t.mode_gr?this.scale_bitcount(u):this.scale_bitcount_lsf(t,u))};var m=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],g=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],v=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(t){var o,r,n,i=0,a=0,s=t.scalefac;if(t.block_type==A.SHORT_TYPE)n=m,0!=t.mixed_block_flag&&(n=g);else if(n=v,0==t.preflag){for(r=11;r<A.SBPSY_l&&!(s[r]<e.pretab[r]);r++);if(r==A.SBPSY_l)for(t.preflag=1,r=11;r<A.SBPSY_l;r++)s[r]-=e.pretab[r]}for(r=0;r<t.sfbdivide;r++)i<s[r]&&(i=s[r]);for(;r<t.sfbmax;r++)a<s[r]&&(a=s[r]);for(t.part2_length=C.LARGE_BITS,o=0;o<16;o++)i<c[o]&&a<p[o]&&t.part2_length>n[o]&&(t.part2_length=n[o],t.scalefac_compress=o);return t.part2_length==C.LARGE_BITS};var y=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(t,o){var n,i,a,s,l,c,u,p,f=r(4),h=o.scalefac;for(n=0!=o.preflag?2:0,u=0;u<4;u++)f[u]=0;if(o.block_type==A.SHORT_TYPE){i=1;var m=e.nr_of_sfb_block[n][i];for(p=0,a=0;a<4;a++)for(s=m[a]/3,u=0;u<s;u++,p++)for(l=0;l<3;l++)h[3*p+l]>f[a]&&(f[a]=h[3*p+l])}else{i=0;m=e.nr_of_sfb_block[n][i];for(p=0,a=0;a<4;a++)for(s=m[a],u=0;u<s;u++,p++)h[p]>f[a]&&(f[a]=h[p])}for(c=!1,a=0;a<4;a++)f[a]>y[n][a]&&(c=!0);if(!c){var g,b,v,S;for(o.sfb_partition_table=e.nr_of_sfb_block[n][i],a=0;a<4;a++)o.slen[a]=_[f[a]];switch(g=o.slen[0],b=o.slen[1],v=o.slen[2],S=o.slen[3],n){case 0:o.scalefac_compress=(5*g+b<<4)+(v<<2)+S;break;case 1:o.scalefac_compress=400+(5*g+b<<2)+v;break;case 2:o.scalefac_compress=500+3*g+b;break;default:d.err.printf("intensity stereo not implemented yet\n")}}if(!c)for(o.part2_length=0,a=0;a<4;a++)o.part2_length+=o.slen[a]*o.sfb_partition_table[a];return c};var _=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var r,n=0;e.scalefac_band.l[++n]<t;);for(r=o[n][0];e.scalefac_band.l[r+1]>t;)r--;for(r<0&&(r=o[n][0]),e.bv_scf[t-2]=r,r=o[n][1];e.scalefac_band.l[r+e.bv_scf[t-2]+2]>t;)r--;r<0&&(r=o[n][1]),e.bv_scf[t-1]=r}}}function v(){var e=64.82,t=(v.YULE_ORDER,.95),o=(v.MAX_SAMP_FREQ,v.RMS_WINDOW_TIME_NUMERATOR),r=v.RMS_WINDOW_TIME_DENOMINATOR,n=(v.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),i=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function a(e,t,o,r,n,i){for(;0!=n--;)o[r]=1e-10+e[t+0]*i[0]-o[r-1]*i[1]+e[t-1]*i[2]-o[r-2]*i[3]+e[t-2]*i[4]-o[r-3]*i[5]+e[t-3]*i[6]-o[r-4]*i[7]+e[t-4]*i[8]-o[r-5]*i[9]+e[t-5]*i[10]-o[r-6]*i[11]+e[t-6]*i[12]-o[r-7]*i[13]+e[t-7]*i[14]-o[r-8]*i[15]+e[t-8]*i[16]-o[r-9]*i[17]+e[t-9]*i[18]-o[r-10]*i[19]+e[t-10]*i[20],++r,++t}function s(e,t,o,r,n,i){for(;0!=n--;)o[r]=e[t+0]*i[0]-o[r-1]*i[1]+e[t-1]*i[2]-o[r-2]*i[3]+e[t-2]*i[4],++r,++t}function l(e){return e*e}this.InitGainAnalysis=function(e,t){return function(e,t){for(var n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;switch(0|t){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return e.sampleWindow=0|(t*o+r-1)/r,e.lsum=0,e.rsum=0,e.totsamp=0,u.ill(e.A,0),INIT_GAIN_ANALYSIS_OK}(e,t)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,u.fill(e.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,t,o,r,c,u,p){var f,h,m,g,b,y,_;if(0==u)return GAIN_ANALYSIS_OK;switch(_=0,b=u,p){case 1:r=t,c=o;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(u<MAX_ORDER?(d.arraycopy(t,o,e.linprebuf,MAX_ORDER,u),d.arraycopy(r,c,e.rinprebuf,MAX_ORDER,u)):(d.arraycopy(t,o,e.linprebuf,MAX_ORDER,MAX_ORDER),d.arraycopy(r,c,e.rinprebuf,MAX_ORDER,MAX_ORDER));b>0;){y=b>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:b,_<MAX_ORDER?(f=e.linpre+_,h=e.linprebuf,m=e.rinpre+_,g=e.rinprebuf,y>MAX_ORDER-_&&(y=MAX_ORDER-_)):(f=o+_,h=t,m=c+_,g=r),a(h,f,e.lstepbuf,e.lstep+e.totsamp,y,n[e.reqindex]),a(g,m,e.rstepbuf,e.rstep+e.totsamp,y,n[e.reqindex]),s(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,y,i[e.reqindex]),s(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,y,i[e.reqindex]),f=e.lout+e.totsamp,h=e.loutbuf,m=e.rout+e.totsamp,g=e.routbuf;for(var S=y%8;0!=S--;)e.lsum+=l(h[f++]),e.rsum+=l(g[m++]);for(S=y/8;0!=S--;)e.lsum+=l(h[f+0])+l(h[f+1])+l(h[f+2])+l(h[f+3])+l(h[f+4])+l(h[f+5])+l(h[f+6])+l(h[f+7]),f+=8,e.rsum+=l(g[m+0])+l(g[m+1])+l(g[m+2])+l(g[m+3])+l(g[m+4])+l(g[m+5])+l(g[m+6])+l(g[m+7]),m+=8;if(b-=y,_+=y,e.totsamp+=y,e.totsamp==e.sampleWindow){var w=10*v.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),k=w<=0?0:0|w;k>=e.A.length&&(k=e.A.length-1),e.A[k]++,e.lsum=e.rsum=0,d.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),d.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),d.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),d.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return u<MAX_ORDER?(d.arraycopy(e.linprebuf,u,e.linprebuf,0,MAX_ORDER-u),d.arraycopy(e.rinprebuf,u,e.rinprebuf,0,MAX_ORDER-u),d.arraycopy(t,o,e.linprebuf,MAX_ORDER-u,u),d.arraycopy(r,c,e.rinprebuf,MAX_ORDER-u,u)):(d.arraycopy(t,o+u-MAX_ORDER,e.linprebuf,0,MAX_ORDER),d.arraycopy(r,c+u-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(o){for(var r=function(o,r){var n,i=0;for(n=0;n<r;n++)i+=o[n];if(0==i)return GAIN_NOT_ENOUGH_SAMPLES;var a=0|Math.ceil(i*(1-t));for(n=r;n-- >0&&!((a-=o[n])<=0););return e-n/v.STEPS_per_dB}(o.A,o.A.length),n=0;n<o.A.length;n++)o.B[n]+=o.A[n],o.A[n]=0;for(n=0;n<MAX_ORDER;n++)o.linprebuf[n]=o.lstepbuf[n]=o.loutbuf[n]=o.rinprebuf[n]=o.rstepbuf[n]=o.routbuf[n]=0;return o.totsamp=0,o.lsum=o.rsum=0,r}}function y(){var t,o,r;this.setModules=function(e,n,i){t=e,o=n,r=i};var n=y.NUMTOCENTRIES,i=y.MAXFRAMESIZE,a=n+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,s=128,l=64,c=32,p=null,h="Xing",g="Info",b=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function v(e,t){var o=255&e[t+0];return o<<=8,o|=255&e[t+1],o<<=8,o|=255&e[t+2],o<<=8,o|=255&e[t+3]}function _(e,t,o){e[t+0]=255&o>>24,e[t+1]=255&o>>16,e[t+2]=255&o>>8,e[t+3]=255&o}function S(e,t,o){e[t+0]=255&o>>8,e[t+1]=255&o}function k(e,t,o){return 255&(e<<t|o&~(-1<<t))}function E(e,o){var r=e.internal_flags;o[0]=k(o[0],8,255),o[1]=k(o[1],3,7),o[1]=k(o[1],1,e.out_samplerate<16e3?0:1),o[1]=k(o[1],1,e.version),o[1]=k(o[1],2,1),o[1]=k(o[1],1,e.error_protection?0:1),o[2]=k(o[2],4,r.bitrate_index),o[2]=k(o[2],2,r.samplerate_index),o[2]=k(o[2],1,0),o[2]=k(o[2],1,e.extension),o[3]=k(o[3],2,e.mode.ordinal()),o[3]=k(o[3],2,r.mode_ext),o[3]=k(o[3],1,e.copyright),o[3]=k(o[3],1,e.original),o[3]=k(o[3],2,e.emphasis),o[0]=255;var n,i,a=241&o[1];n=1==e.version?s:e.out_samplerate<16e3?c:l,e.VBR==m.vbr_off&&(n=e.brate),i=e.free_format?0:255&16*t.BitrateIndex(n,e.version,e.out_samplerate),1==e.version?(o[1]=255&(10|a),a=13&o[2],o[2]=255&(i|a)):(o[1]=255&(2|a),a=13&o[2],o[2]=255&(i|a))}function P(e,t){return t=t>>8^b[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,o=w.bitrate_table[e.version][t.bitrate_index];!function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var o=1;o<e.size;o+=2)e.bag[o/2]=e.bag[o];e.want*=2,e.pos/=2}}(t.VBR_seek_table,o)},this.getVbrTag=function(e){var t=new VBRTagData,o=0;t.flags=0;var r=e[o+1]>>3&1,i=e[o+2]>>2&3,a=e[o+3]>>6&3,s=e[o+2]>>4&15;if(s=w.bitrate_table[r][s],e[o+1]>>4==14?t.samprate=w.samplerate_table[2][i]:t.samprate=w.samplerate_table[r][i],!function(e,t){return new String(e,t,h.length(),p).equals(h)||new String(e,t,g.length(),p).equals(g)}(e,o+=0!=r?3!=a?36:21:3!=a?21:13))return null;o+=4,t.hId=r;var l=t.flags=v(e,o);if(o+=4,0!=(1&l)&&(t.frames=v(e,o),o+=4),0!=(2&l)&&(t.bytes=v(e,o),o+=4),0!=(4&l)){if(null!=t.toc)for(var c=0;c<n;c++)t.toc[c]=e[o+c];o+=n}t.vbrScale=-1,0!=(8&l)&&(t.vbrScale=v(e,o),o+=4),t.headersize=72e3*(r+1)*s/t.samprate;var u=e[(o+=21)+0]<<4;u+=e[o+1]>>4;var d=(15&e[o+1])<<8;return d+=255&e[o+2],(u<0||u>3e3)&&(u=-1),(d<0||d>3e3)&&(d=-1),t.encDelay=u,t.encPadding=d,t},this.InitVbrTag=function(t){var r,n=t.internal_flags;r=1==t.version?s:t.out_samplerate<16e3?c:l,t.VBR==m.vbr_off&&(r=t.brate);var u=72e3*(t.version+1)*r/t.out_samplerate,d=n.sideinfo_len+a;if(n.VBR_seek_table.TotalFrameSize=u,u<d||u>i)t.bWriteVbrTag=!1;else{n.VBR_seek_table.nVbrNumFrames=0,n.VBR_seek_table.nBytesWritten=0,n.VBR_seek_table.sum=0,n.VBR_seek_table.seen=0,n.VBR_seek_table.want=1,n.VBR_seek_table.pos=0,null==n.VBR_seek_table.bag&&(n.VBR_seek_table.bag=new int[400],n.VBR_seek_table.size=400);var p=e(i);E(t,p);for(var f=n.VBR_seek_table.TotalFrameSize,h=0;h<f;++h)o.add_dummy_byte(t,255&p[h],1)}},this.updateMusicCRC=function(e,t,o,r){for(var n=0;n<r;++n)e[0]=P(t[o+n],e[0])},this.getLameTagFrame=function(t,i){var a=t.internal_flags;if(!t.bWriteVbrTag)return 0;if(a.Class_ID!=D.LAME_ID)return 0;if(a.VBR_seek_table.pos<=0)return 0;if(i.length<a.VBR_seek_table.TotalFrameSize)return a.VBR_seek_table.TotalFrameSize;u.fill(i,0,a.VBR_seek_table.TotalFrameSize,0),E(t,i);var s=e(n);if(t.free_format)for(var l=1;l<n;++l)s[l]=255&255*l/100;else!function(e,t){if(!(e.pos<=0))for(var o=1;o<n;++o){var r=o/n,i=0|Math.floor(r*e.pos);i>e.pos-1&&(i=e.pos-1);var a=0|256*e.bag[i]/e.sum;a>255&&(a=255),t[o]=255&a}}(a.VBR_seek_table,s);var c=a.sideinfo_len;t.error_protection&&(c-=2),t.VBR==m.vbr_off?(i[c++]=255&g.charAt(0),i[c++]=255&g.charAt(1),i[c++]=255&g.charAt(2),i[c++]=255&g.charAt(3)):(i[c++]=255&h.charAt(0),i[c++]=255&h.charAt(1),i[c++]=255&h.charAt(2),i[c++]=255&h.charAt(3)),_(i,c,15),_(i,c+=4,a.VBR_seek_table.nVbrNumFrames),c+=4;var p=a.VBR_seek_table.nBytesWritten+a.VBR_seek_table.TotalFrameSize;_(i,c,0|p),c+=4,d.arraycopy(s,0,i,c,s.length),c+=s.length,t.error_protection&&o.CRC_writeheader(a,i);var b=0;for(l=0;l<c;l++)b=P(i[l],b);return c+=function(e,t,o,n,i){var a,s,l,c,u,d=e.internal_flags,p=0,h=e.encoder_delay,m=e.encoder_padding,g=100-10*e.VBR_q-e.quality,b=r.getLameVeryShortVersion(),v=[1,5,3,2,4,0,3],y=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),w=0,k=0,E=e.internal_flags.noise_shaping,C=0,T=0,R=0,O=0!=(1&e.exp_nspsytune),M=0!=(2&e.exp_nspsytune),A=!1,N=!1,I=e.internal_flags.nogap_total,x=e.internal_flags.nogap_current,D=e.ATHtype;switch(e.VBR){case vbr_abr:u=e.VBR_mean_bitrate_kbps;break;case vbr_off:u=e.brate;break;default:u=e.VBR_min_bitrate_kbps}switch(a=0+(e.VBR.ordinal()<v.length?v[e.VBR.ordinal()]:0),d.findReplayGain&&(d.RadioGain>510&&(d.RadioGain=510),d.RadioGain<-510&&(d.RadioGain=-510),k=8192,k|=3072,d.RadioGain>=0?k|=d.RadioGain:(k|=512,k|=-d.RadioGain)),d.findPeakSample&&(w=Math.abs(0|d.PeakSample/32767*Math.pow(2,23)+.5)),-1!=I&&(x>0&&(N=!0),x<I-1&&(A=!0)),c=D+((O?1:0)<<4)+((M?1:0)<<5)+((A?1:0)<<6)+((N?1:0)<<7),g<0&&(g=0),e.mode){case MONO:C=0;break;case STEREO:C=1;break;case DUAL_CHANNEL:C=2;break;case JOINT_STEREO:C=e.force_ms?4:3;break;case NOT_SET:default:C=7}R=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==f.short_block_forced||e.short_blocks==f.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==D||e.in_samplerate<=32e3)&&(T=1),s=E+(C<<2)+(T<<5)+(R<<6),l=d.nMusicCRC,_(o,n+p,g),p+=4;for(var F=0;F<9;F++)o[n+p+F]=255&b.charAt(F);o[n+(p+=9)]=255&a,o[n+ ++p]=255&y,_(o,n+ ++p,w),S(o,n+(p+=4),k),S(o,n+(p+=2),0),o[n+(p+=2)]=255&c,o[n+ ++p]=u>=255?255:255&u,o[n+ ++p]=255&h>>4,o[n+p+1]=255&(h<<4)+(m>>8),o[n+p+2]=255&m,o[n+(p+=3)]=255&s,p++,o[n+p++]=0,S(o,n+p,e.preset),_(o,n+(p+=2),t),S(o,n+(p+=4),l),p+=2;for(var L=0;L<p;L++)i=P(o[n+L],i);return S(o,n+p,i),p+=2}(t,p,i,c,b),a.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(t,o){if(t.internal_flags.VBR_seek_table.pos<=0)return-1;if(o.seek(o.length()),0==o.length())return-1;var r=function(t){t.seek(0);var o=e(10);return t.readFully(o),new String(o,"ISO-8859-1").startsWith("ID3")?0:((127&o[6])<<21|(127&o[7])<<14|(127&o[8])<<7|127&o[9])+o.length}(o);o.seek(r);var n=e(i),a=getLameTagFrame(t,n);return a>n.length?-1:a<1?0:(o.write(n,0,a),0)}}function _(){var t=this,o=32773,n=null,i=null,s=null,l=null;this.setModules=function(e,t,o,r){n=e,i=t,s=o,l=r};var c=null,p=0,f=0,h=0;function m(e){d.arraycopy(e.header[e.w_ptr].buf,0,c,f,e.sideinfo_len),f+=e.sideinfo_len,p+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&I.MAX_HEADER_BUF-1}function g(e,t,o){for(;o>0;){var r;0==h&&(h=8,f++,e.header[e.w_ptr].write_timing==p&&m(e),c[f]=0),o-=r=Math.min(o,h),h-=r,c[f]|=t>>o<<h,p+=r}}function y(e,t,o){for(;o>0;){var r;0==h&&(h=8,c[++f]=0),o-=r=Math.min(o,h),h-=r,c[f]|=t>>o<<h,p+=r}}function _(e,t){var o,r=e.internal_flags;if(t>=8&&(g(r,76,8),t-=8),t>=8&&(g(r,65,8),t-=8),t>=8&&(g(r,77,8),t-=8),t>=8&&(g(r,69,8),t-=8),t>=32){var n=s.getLameShortVersion();if(t>=32)for(o=0;o<n.length&&t>=8;++o)t-=8,g(r,n.charAt(o),8)}for(;t>=1;t-=1)g(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1}function S(e,t,o){for(var r=e.header[e.h_ptr].ptr;o>0;){var n=Math.min(o,8-(7&r));o-=n,e.header[e.h_ptr].buf[r>>3]|=t>>o<<8-(7&r)-n,r+=n}e.header[e.h_ptr].ptr=r}function k(e,t){e<<=8;for(var r=0;r<8;r++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=o);return t}function E(e,t){var o,r=w.ht[t.count1table_select+32],n=0,i=t.big_values,a=t.big_values;for(o=(t.count1-t.big_values)/4;o>0;--o){var s=0,l=0;0!=t.l3_enc[i+0]&&(l+=8,t.xr[a+0]<0&&s++),0!=t.l3_enc[i+1]&&(l+=4,s*=2,t.xr[a+1]<0&&s++),0!=t.l3_enc[i+2]&&(l+=2,s*=2,t.xr[a+2]<0&&s++),0!=t.l3_enc[i+3]&&(l++,s*=2,t.xr[a+3]<0&&s++),i+=4,a+=4,g(e,s+r.table[l],r.hlen[l]),n+=r.hlen[l]}return n}function P(e,t,o,r,n){var i=w.ht[t],a=0;if(0==t)return a;for(var s=o;s<r;s+=2){var l=0,c=0,u=i.xlen,d=i.xlen,p=0,f=n.l3_enc[s],h=n.l3_enc[s+1];if(0!=f&&(n.xr[s]<0&&p++,l--),t>15){if(f>14)p|=f-15<<1,c=u,f=15;if(h>14)p<<=u,p|=h-15,c+=u,h=15;d=16}0!=h&&(p<<=1,n.xr[s+1]<0&&p++,l--),f=f*d+h,c-=l,l+=i.hlen[f],g(e,i.table[f],l),g(e,p,c),a+=l+c}return a}function C(e,t){var o=3*e.scalefac_band.s[3];o>t.big_values&&(o=t.big_values);var r=P(e,t.table_select[0],0,o,t);return r+=P(e,t.table_select[1],o,t.big_values,t)}function T(e,t){var o,r,n,i;o=t.big_values;var a=t.region0_count+1;return n=e.scalefac_band.l[a],a+=t.region1_count+1,i=e.scalefac_band.l[a],n>o&&(n=o),i>o&&(i=o),r=P(e,t.table_select[0],0,n,t),r+=P(e,t.table_select[1],n,i,t),r+=P(e,t.table_select[2],i,o,t)}function R(){this.total=0}function O(e,o){var r,n,i,a,s,l=e.internal_flags;return s=l.w_ptr,-1==(a=l.h_ptr-1)&&(a=I.MAX_HEADER_BUF-1),r=l.header[a].write_timing-p,o.total=r,r>=0&&(n=1+a-s,a<s&&(n=1+a-s+I.MAX_HEADER_BUF),r-=8*n*l.sideinfo_len),r+=i=t.getframebits(e),o.total+=i,o.total%8!=0?o.total=1+o.total/8:o.total=o.total/8,o.total+=f+1,r<0&&d.err.println("strange error flushing buffer ... \n"),r}this.getframebits=function(e){var t,o=e.internal_flags;return t=0!=o.bitrate_index?w.bitrate_table[e.version][o.bitrate_index]:e.brate,8*(0|72e3*(e.version+1)*t/e.out_samplerate+o.padding)},this.CRC_writeheader=function(e,t){var o=65535;o=k(255&t[2],o),o=k(255&t[3],o);for(var r=6;r<e.sideinfo_len;r++)o=k(255&t[r],o);t[4]=byte(o>>8),t[5]=byte(255&o)},this.flush_bitstream=function(e){var t,o,r=e.internal_flags,i=r.h_ptr-1;if(-1==i&&(i=I.MAX_HEADER_BUF-1),t=r.l3_side,!((o=O(e,new R))<0)){if(_(e,o),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var a=n.GetTitleGain(r.rgdata);r.RadioGain=0|Math.floor(10*a+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,o){for(var r,n=e.internal_flags;o-- >0;)for(y(0,t,8),r=0;r<I.MAX_HEADER_BUF;++r)n.header[r].write_timing+=8},this.format_bitstream=function(e){var t,o=e.internal_flags;t=o.l3_side;var r=this.getframebits(e);_(e,t.resvDrain_pre),function(e,t){var o,r,n,i=e.internal_flags;if(o=i.l3_side,i.header[i.h_ptr].ptr=0,u.fill(i.header[i.h_ptr].buf,0,i.sideinfo_len,0),e.out_samplerate<16e3?S(i,4094,12):S(i,4095,12),S(i,e.version,1),S(i,1,2),S(i,e.error_protection?0:1,1),S(i,i.bitrate_index,4),S(i,i.samplerate_index,2),S(i,i.padding,1),S(i,e.extension,1),S(i,e.mode.ordinal(),2),S(i,i.mode_ext,2),S(i,e.copyright,1),S(i,e.original,1),S(i,e.emphasis,2),e.error_protection&&S(i,0,16),1==e.version){for(S(i,o.main_data_begin,9),2==i.channels_out?S(i,o.private_bits,3):S(i,o.private_bits,5),n=0;n<i.channels_out;n++){var a;for(a=0;a<4;a++)S(i,o.scfsi[n][a],1)}for(r=0;r<2;r++)for(n=0;n<i.channels_out;n++)S(i,(s=o.tt[r][n]).part2_3_length+s.part2_length,12),S(i,s.big_values/2,9),S(i,s.global_gain,8),S(i,s.scalefac_compress,4),s.block_type!=A.NORM_TYPE?(S(i,1,1),S(i,s.block_type,2),S(i,s.mixed_block_flag,1),14==s.table_select[0]&&(s.table_select[0]=16),S(i,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),S(i,s.table_select[1],5),S(i,s.subblock_gain[0],3),S(i,s.subblock_gain[1],3),S(i,s.subblock_gain[2],3)):(S(i,0,1),14==s.table_select[0]&&(s.table_select[0]=16),S(i,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),S(i,s.table_select[1],5),14==s.table_select[2]&&(s.table_select[2]=16),S(i,s.table_select[2],5),S(i,s.region0_count,4),S(i,s.region1_count,3)),S(i,s.preflag,1),S(i,s.scalefac_scale,1),S(i,s.count1table_select,1)}else for(S(i,o.main_data_begin,8),S(i,o.private_bits,i.channels_out),r=0,n=0;n<i.channels_out;n++){var s;S(i,(s=o.tt[r][n]).part2_3_length+s.part2_length,12),S(i,s.big_values/2,9),S(i,s.global_gain,8),S(i,s.scalefac_compress,9),s.block_type!=A.NORM_TYPE?(S(i,1,1),S(i,s.block_type,2),S(i,s.mixed_block_flag,1),14==s.table_select[0]&&(s.table_select[0]=16),S(i,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),S(i,s.table_select[1],5),S(i,s.subblock_gain[0],3),S(i,s.subblock_gain[1],3),S(i,s.subblock_gain[2],3)):(S(i,0,1),14==s.table_select[0]&&(s.table_select[0]=16),S(i,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),S(i,s.table_select[1],5),14==s.table_select[2]&&(s.table_select[2]=16),S(i,s.table_select[2],5),S(i,s.region0_count,4),S(i,s.region1_count,3)),S(i,s.scalefac_scale,1),S(i,s.count1table_select,1)}e.error_protection&&CRC_writeheader(i,i.header[i.h_ptr].buf);var l=i.h_ptr;i.h_ptr=l+1&I.MAX_HEADER_BUF-1,i.header[i.h_ptr].write_timing=i.header[l].write_timing+t,i.h_ptr==i.w_ptr&&d.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,r);var n=8*o.sideinfo_len;if(n+=function(e){var t,o,r,n,i=0,a=e.internal_flags,s=a.l3_side;if(1==e.version)for(t=0;t<2;t++)for(o=0;o<a.channels_out;o++){var l=s.tt[t][o],c=b.slen1_tab[l.scalefac_compress],u=b.slen2_tab[l.scalefac_compress];for(n=0,r=0;r<l.sfbdivide;r++)-1!=l.scalefac[r]&&(g(a,l.scalefac[r],c),n+=c);for(;r<l.sfbmax;r++)-1!=l.scalefac[r]&&(g(a,l.scalefac[r],u),n+=u);l.block_type==A.SHORT_TYPE?n+=C(a,l):n+=T(a,l),i+=n+=E(a,l)}else for(t=0,o=0;o<a.channels_out;o++){var d,p,f=0;if(n=0,r=0,p=0,(l=s.tt[t][o]).block_type==A.SHORT_TYPE){for(;p<4;p++){var h=l.sfb_partition_table[p]/3,m=l.slen[p];for(d=0;d<h;d++,r++)g(a,Math.max(l.scalefac[3*r+0],0),m),g(a,Math.max(l.scalefac[3*r+1],0),m),g(a,Math.max(l.scalefac[3*r+2],0),m),f+=3*m}n+=C(a,l)}else{for(;p<4;p++)for(h=l.sfb_partition_table[p],m=l.slen[p],d=0;d<h;d++,r++)g(a,Math.max(l.scalefac[r],0),m),f+=m;n+=T(a,l)}i+=f+(n+=E(a,l))}return i}(e),_(e,t.resvDrain_post),n+=t.resvDrain_post,t.main_data_begin+=(r-n)/8,O(e,new R)!=o.ResvSize&&d.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=o.ResvSize&&(d.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,o.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*o.sideinfo_len,n-t.resvDrain_post-8*o.sideinfo_len,n,n%8,r),d.err.println("This is a fatal error.  It has several possible causes:"),d.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),d.err.println(" 9%%  Your system is overclocked"),d.err.println(" 1%%  bug in LAME encoding library"),o.ResvSize=8*t.main_data_begin),p>1e9){var i;for(i=0;i<I.MAX_HEADER_BUF;++i)o.header[i].write_timing-=p;p=0}return 0},this.copy_buffer=function(e,t,o,s,u){var p=f+1;if(p<=0)return 0;if(0!=s&&p>s)return-1;if(d.arraycopy(c,0,t,o,p),f=-1,h=0,0!=u){var m=r(1);if(m[0]=e.nMusicCRC,l.updateMusicCRC(m,t,o,p),e.nMusicCRC=m[0],p>0&&(e.VBR_seek_table.nBytesWritten+=p),e.decode_on_the_fly)for(var g,b=a([2,1152]),y=p,_=-1;0!=_;)if(_=i.hip_decode1_unclipped(e.hip,t,o,y,b[0],b[1]),y=0,-1==_&&(_=0),_>0){if(e.findPeakSample){for(g=0;g<_;g++)b[0][g]>e.PeakSample?e.PeakSample=b[0][g]:-b[0][g]>e.PeakSample&&(e.PeakSample=-b[0][g]);if(e.channels_out>1)for(g=0;g<_;g++)b[1][g]>e.PeakSample?e.PeakSample=b[1][g]:-b[1][g]>e.PeakSample&&(e.PeakSample=-b[1][g])}if(e.findReplayGain&&n.AnalyzeSamples(e.rgdata,b[0],0,b[1],0,_,e.channels_out)==v.GAIN_ANALYSIS_ERROR)return-6}}return p},this.init_bit_stream_w=function(t){c=e(D.LAME_MAXMP3BUFFER),t.h_ptr=t.w_ptr=0,t.header[t.h_ptr].write_timing=0,f=-1,h=0,p=0}}function S(e,t,o,r){this.xlen=e,this.linmax=t,this.table=o,this.hlen=r}g.STEREO=new g(0),g.JOINT_STEREO=new g(1),g.DUAL_CHANNEL=new g(2),g.MONO=new g(3),g.NOT_SET=new g(4),v.STEPS_per_dB=100,v.MAX_dB=120,v.GAIN_NOT_ENOUGH_SAMPLES=-24601,v.GAIN_ANALYSIS_ERROR=0,v.GAIN_ANALYSIS_OK=1,v.INIT_GAIN_ANALYSIS_ERROR=0,v.INIT_GAIN_ANALYSIS_OK=1,v.YULE_ORDER=10,v.MAX_ORDER=v.YULE_ORDER,v.MAX_SAMP_FREQ=48e3,v.RMS_WINDOW_TIME_NUMERATOR=1,v.RMS_WINDOW_TIME_DENOMINATOR=20,v.MAX_SAMPLES_PER_WINDOW=v.MAX_SAMP_FREQ*v.RMS_WINDOW_TIME_NUMERATOR/v.RMS_WINDOW_TIME_DENOMINATOR+1,y.NUMTOCENTRIES=100,y.MAXFRAMESIZE=2880,_.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},_.NEQ=function(e,t){return!_.EQ(e,t)};var w={};function k(e){this.bits=e}function E(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}function P(e,t,o,n){this.l=r(1+A.SBMAX_l),this.s=r(1+A.SBMAX_s),this.psfb21=r(1+A.PSFB21),this.psfb12=r(1+A.PSFB12);var i=this.l,a=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],d.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),d.arraycopy(this.arrS,0,a,0,Math.min(this.arrS.length,this.s.length)),d.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),d.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function C(){var e=null,t=null,o=null;function i(e){return d[e+C.Q_MAX2]}this.setModules=function(r,n,i){e=r,t=n,o=i},this.IPOW20=function(e){return f[e]};var a=C.IXMAX_VAL+2,s=C.Q_MAX,l=C.Q_MAX2,c=(C.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var u=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=u,this.sfBandIndex=[new P([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new P([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var d=n(s+l+1),f=n(s),g=n(a),b=n(a);function v(e,t){var r=o.ATHformula(t,e);return r-=c,r=Math.pow(10,r/10+e.ATHlower)}function y(e){this.s=e}this.adj43=b,this.iteration_init=function(t){var o,r=t.internal_flags,n=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,n.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,o=e.internal_flags.ATH.psfb21,r=e.internal_flags.ATH.s,n=e.internal_flags.ATH.psfb12,i=e.internal_flags,a=e.out_samplerate,s=0;s<A.SBMAX_l;s++){var l=i.scalefac_band.l[s],c=i.scalefac_band.l[s+1];t[s]=h.MAX_VALUE;for(var u=l;u<c;u++){var d=v(e,u*a/1152);t[s]=Math.min(t[s],d)}}for(s=0;s<A.PSFB21;s++)for(l=i.scalefac_band.psfb21[s],c=i.scalefac_band.psfb21[s+1],o[s]=h.MAX_VALUE,u=l;u<c;u++)d=v(e,u*a/1152),o[s]=Math.min(o[s],d);for(s=0;s<A.SBMAX_s;s++){for(l=i.scalefac_band.s[s],c=i.scalefac_band.s[s+1],r[s]=h.MAX_VALUE,u=l;u<c;u++)d=v(e,u*a/384),r[s]=Math.min(r[s],d);r[s]*=i.scalefac_band.s[s+1]-i.scalefac_band.s[s]}for(s=0;s<A.PSFB12;s++){for(l=i.scalefac_band.psfb12[s],c=i.scalefac_band.psfb12[s+1],n[s]=h.MAX_VALUE,u=l;u<c;u++)d=v(e,u*a/384),n[s]=Math.min(n[s],d);n[s]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(e.noATH){for(s=0;s<A.SBMAX_l;s++)t[s]=1e-20;for(s=0;s<A.PSFB21;s++)o[s]=1e-20;for(s=0;s<A.SBMAX_s;s++)r[s]=1e-20;for(s=0;s<A.PSFB12;s++)n[s]=1e-20}i.ATH.floor=10*Math.log10(v(e,-1))}(t),g[0]=0,o=1;o<a;o++)g[o]=Math.pow(o,4/3);for(o=0;o<a-1;o++)b[o]=o+1-Math.pow(.5*(g[o]+g[o+1]),.75);for(b[o]=.5,o=0;o<s;o++)f[o]=Math.pow(2,-.1875*(o-210));for(o=0;o<=s+l;o++)d[o]=Math.pow(2,.25*(o-210-l));var i,c,u,p;for(e.huffman_init(r),(o=t.exp_nspsytune>>2&63)>=32&&(o-=64),i=Math.pow(10,o/4/10),(o=t.exp_nspsytune>>8&63)>=32&&(o-=64),c=Math.pow(10,o/4/10),(o=t.exp_nspsytune>>14&63)>=32&&(o-=64),u=Math.pow(10,o/4/10),(o=t.exp_nspsytune>>20&63)>=32&&(o-=64),p=u*Math.pow(10,o/4/10),o=0;o<A.SBMAX_l;o++){m=o<=6?i:o<=13?c:o<=20?u:p,r.nsPsy.longfact[o]=m}for(o=0;o<A.SBMAX_s;o++){var m;m=o<=5?i:o<=10?c:o<=11?u:p,r.nsPsy.shortfact[o]=m}}},this.on_pe=function(e,o,n,i,a,s){var l,c,u=e.internal_flags,d=0,p=r(2),f=new k(d),h=t.ResvMaxBits(e,i,f,s),m=(d=f.bits)+h;for(m>I.MAX_BITS_PER_GRANULE&&(m=I.MAX_BITS_PER_GRANULE),l=0,c=0;c<u.channels_out;++c)n[c]=Math.min(I.MAX_BITS_PER_CHANNEL,d/u.channels_out),p[c]=0|n[c]*o[a][c]/700-n[c],p[c]>3*i/4&&(p[c]=3*i/4),p[c]<0&&(p[c]=0),p[c]+n[c]>I.MAX_BITS_PER_CHANNEL&&(p[c]=Math.max(0,I.MAX_BITS_PER_CHANNEL-n[c])),l+=p[c];if(l>h)for(c=0;c<u.channels_out;++c)p[c]=h*p[c]/l;for(c=0;c<u.channels_out;++c)n[c]+=p[c],h-=p[c];for(l=0,c=0;c<u.channels_out;++c)l+=n[c];if(l>I.MAX_BITS_PER_GRANULE){for(c=0;c<u.channels_out;++c)n[c]*=I.MAX_BITS_PER_GRANULE,n[c]/=l,n[c]}return m},this.reduce_side=function(e,t,o,r){var n=.33*(.5-t)/.5;n<0&&(n=0),n>.5&&(n=.5);var i=0|.5*n*(e[0]+e[1]);i>I.MAX_BITS_PER_CHANNEL-e[0]&&(i=I.MAX_BITS_PER_CHANNEL-e[0]),i<0&&(i=0),e[1]>=125&&(e[1]-i>125?(e[0]<o&&(e[0]+=i),e[1]-=i):(e[0]+=e[1]-125,e[1]=125)),(i=e[0]+e[1])>r&&(e[0]=r*e[0]/i,e[1]=r*e[1]/i)},this.athAdjust=function(e,t,o){var r=90.30873362,n=p.FAST_LOG10_X(t,10),i=e*e,a=0;return n-=o,i>1e-20&&(a=1+p.FAST_LOG10_X(i,10/r)),a<0&&(a=0),n*=a,n+=o+r-94.82444863,Math.pow(10,.1*n)},this.calc_xmin=function(e,t,o,r){var n,i=0,a=e.internal_flags,s=0,l=0,c=a.ATH,u=o.xr,d=e.VBR==m.vbr_mtrh?1:0,p=a.masking_lower;for(e.VBR!=m.vbr_mtrh&&e.VBR!=m.vbr_mt||(p=1),n=0;n<o.psy_lmax;n++){w=(S=e.VBR==m.vbr_rh||e.VBR==m.vbr_mtrh?athAdjust(c.adjust,c.l[n],c.floor):c.adjust*c.l[n])/(b=o.width[n]),k=2.220446049250313e-16,T=b>>1,C=0;do{C+=R=u[s]*u[s],k+=R<w?R:w,C+=O=u[++s]*u[s],k+=O<w?O:w,s++}while(--T>0);if(C>S&&l++,n==A.SBPSY_l)k<(P=S*a.nsPsy.longfact[n])&&(k=P);if(0!=d&&(S=k),!e.ATHonly)if((E=t.en.l[n])>0)P=C*t.thm.l[n]*p/E,0!=d&&(P*=a.nsPsy.longfact[n]),S<P&&(S=P);r[i++]=0!=d?S:S*a.nsPsy.longfact[n]}var f=575;if(o.block_type!=A.SHORT_TYPE)for(var h=576;0!=h--&&_.EQ(u[h],0);)f=h;o.max_nonzero_coeff=f;for(var g=o.sfb_smin;n<o.psymax;g++,n+=3){var b,v,y;for(y=e.VBR==m.vbr_rh||e.VBR==m.vbr_mtrh?athAdjust(c.adjust,c.s[g],c.floor):c.adjust*c.s[g],b=o.width[n],v=0;v<3;v++){var S,w,k,E,P,C=0,T=b>>1;w=y/b,k=2.220446049250313e-16;do{var R,O;C+=R=u[s]*u[s],k+=R<w?R:w,C+=O=u[++s]*u[s],k+=O<w?O:w,s++}while(--T>0);if(C>y&&l++,g==A.SBPSY_s)k<(P=y*a.nsPsy.shortfact[g])&&(k=P);if(S=0!=d?k:y,!e.ATHonly&&!e.ATHshort)if((E=t.en.s[g][v])>0)P=C*t.thm.s[g][v]*p/E,0!=d&&(P*=a.nsPsy.shortfact[g]),S<P&&(S=P);r[i++]=0!=d?S:S*a.nsPsy.shortfact[g]}e.useTemporal&&(r[i-3]>r[i-3+1]&&(r[i-3+1]+=(r[i-3]-r[i-3+1])*a.decay),r[i-3+1]>r[i-3+2]&&(r[i-3+2]+=(r[i-3+1]-r[i-3+2])*a.decay))}return l},this.calc_noise_core=function(e,t,o,r){var i=0,a=t.s,s=e.l3_enc;if(a>e.count1)for(;0!=o--;){c=e.xr[a],a++,i+=c*c,c=e.xr[a],a++,i+=c*c}else if(a>e.big_values){var l=n(2);for(l[0]=0,l[1]=r;0!=o--;){c=Math.abs(e.xr[a])-l[s[a]],a++,i+=c*c,c=Math.abs(e.xr[a])-l[s[a]],a++,i+=c*c}}else for(;0!=o--;){var c;c=Math.abs(e.xr[a])-g[s[a]]*r,a++,i+=c*c,c=Math.abs(e.xr[a])-g[s[a]]*r,a++,i+=c*c}return t.s=a,i},this.calc_noise=function(e,t,o,r,n){var a,s,l=0,c=0,d=0,f=0,h=0,m=-20,g=0,b=e.scalefac,v=0;for(r.over_SSD=0,a=0;a<e.psymax;a++){var _,S=e.global_gain-(b[v++]+(0!=e.preflag?u[a]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[a]],w=0;if(null!=n&&n.step[a]==S)w=n.noise[a],g+=e.width[a],o[l++]=w/t[c++],w=n.noise_log[a];else{var k,E=i(S);if(s=e.width[a]>>1,g+e.width[a]>e.max_nonzero_coeff)s=(k=e.max_nonzero_coeff-g+1)>0?k>>1:0;var P=new y(g);w=this.calc_noise_core(e,P,s,E),g=P.s,null!=n&&(n.step[a]=S,n.noise[a]=w),w=o[l++]=w/t[c++],w=p.FAST_LOG10(Math.max(w,1e-20)),null!=n&&(n.noise_log[a]=w)}if(null!=n&&(n.global_gain=e.global_gain),h+=w,w>0)_=Math.max(0|10*w+.5,1),r.over_SSD+=_*_,d++,f+=w;m=Math.max(m,w)}return r.over_count=d,r.tot_noise=h,r.over_noise=f,r.max_noise=m,d},this.set_pinfo=function(e,t,o,r,i){var a,s,l,c,d,p=e.internal_flags,f=0==t.scalefac_scale?.5:1,h=t.scalefac,m=n(R.SFBMAX),g=n(R.SFBMAX),b=new E;calc_xmin(e,o,t,m),calc_noise(t,m,g,b,null);var v=0;for(s=t.sfb_lmax,t.block_type!=A.SHORT_TYPE&&0==t.mixed_block_flag&&(s=22),a=0;a<s;a++){var y=p.scalefac_band.l[a],_=(S=p.scalefac_band.l[a+1])-y;for(c=0;v<S;v++)c+=t.xr[v]*t.xr[v];c/=_,d=1e15,p.pinfo.en[r][i][a]=d*c,p.pinfo.xfsf[r][i][a]=d*m[a]*g[a]/_,o.en.l[a]>0&&!e.ATHonly?c/=o.en.l[a]:c=0,p.pinfo.thr[r][i][a]=d*Math.max(c*o.thm.l[a],p.ATH.l[a]),p.pinfo.LAMEsfb[r][i][a]=0,0!=t.preflag&&a>=11&&(p.pinfo.LAMEsfb[r][i][a]=-f*u[a]),a<A.SBPSY_l&&(p.pinfo.LAMEsfb[r][i][a]-=f*h[a])}if(t.block_type==A.SHORT_TYPE)for(s=a,a=t.sfb_smin;a<A.SBMAX_s;a++){y=p.scalefac_band.s[a],_=(S=p.scalefac_band.s[a+1])-y;for(var S,w=0;w<3;w++){for(c=0,l=y;l<S;l++)c+=t.xr[v]*t.xr[v],v++;c=Math.max(c/_,1e-20),d=1e15,p.pinfo.en_s[r][i][3*a+w]=d*c,p.pinfo.xfsf_s[r][i][3*a+w]=d*m[s]*g[s]/_,o.en.s[a][w]>0?c/=o.en.s[a][w]:c=0,(e.ATHonly||e.ATHshort)&&(c=0),p.pinfo.thr_s[r][i][3*a+w]=d*Math.max(c*o.thm.s[a][w],p.ATH.s[a]),p.pinfo.LAMEsfb_s[r][i][3*a+w]=-2*t.subblock_gain[w],a<A.SBPSY_s&&(p.pinfo.LAMEsfb_s[r][i][3*a+w]-=f*h[s]),s++}}p.pinfo.LAMEqss[r][i]=t.global_gain,p.pinfo.LAMEmainbits[r][i]=t.part2_3_length+t.part2_length,p.pinfo.LAMEsfbits[r][i]=t.part2_length,p.pinfo.over[r][i]=b.over_count,p.pinfo.max_noise[r][i]=10*b.max_noise,p.pinfo.over_noise[r][i]=10*b.over_noise,p.pinfo.tot_noise[r][i]=10*b.tot_noise,p.pinfo.over_SSD[r][i]=b.over_SSD}}function T(){this.xr=n(576),this.l3_enc=r(576),this.scalefac=r(R.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=r(3),this.subblock_gain=r(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=r(R.SFBMAX),this.window=r(R.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=r(4),this.max_nonzero_coeff=0;var e=this;function t(e){return new Int32Array(e)}this.assign=function(o){e.xr=function(e){return new Float32Array(e)}(o.xr),e.l3_enc=t(o.l3_enc),e.scalefac=t(o.scalefac),e.xrpow_max=o.xrpow_max,e.part2_3_length=o.part2_3_length,e.big_values=o.big_values,e.count1=o.count1,e.global_gain=o.global_gain,e.scalefac_compress=o.scalefac_compress,e.block_type=o.block_type,e.mixed_block_flag=o.mixed_block_flag,e.table_select=t(o.table_select),e.subblock_gain=t(o.subblock_gain),e.region0_count=o.region0_count,e.region1_count=o.region1_count,e.preflag=o.preflag,e.scalefac_scale=o.scalefac_scale,e.count1table_select=o.count1table_select,e.part2_length=o.part2_length,e.sfb_lmax=o.sfb_lmax,e.sfb_smin=o.sfb_smin,e.psy_lmax=o.psy_lmax,e.sfbmax=o.sfbmax,e.psymax=o.psymax,e.sfbdivide=o.sfbdivide,e.width=t(o.width),e.window=t(o.window),e.count1bits=o.count1bits,e.sfb_partition_table=o.sfb_partition_table.slice(0),e.slen=t(o.slen),e.max_nonzero_coeff=o.max_nonzero_coeff}}w.t1HB=[1,1,1,0],w.t2HB=[1,2,1,3,1,1,3,2,0],w.t3HB=[3,2,1,1,1,1,3,2,0],w.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],w.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],w.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],w.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],w.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],w.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],w.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],w.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],w.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],w.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],w.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],w.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],w.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],w.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],w.t1l=[1,4,3,5],w.t2l=[1,4,7,4,5,7,6,7,8],w.t3l=[2,3,7,4,4,7,6,7,8],w.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],w.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],w.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],w.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],w.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],w.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],w.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],w.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],w.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],w.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],w.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],w.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],w.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],w.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],w.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],w.ht=[new S(0,0,null,null),new S(2,0,w.t1HB,w.t1l),new S(3,0,w.t2HB,w.t2l),new S(3,0,w.t3HB,w.t3l),new S(0,0,null,null),new S(4,0,w.t5HB,w.t5l),new S(4,0,w.t6HB,w.t6l),new S(6,0,w.t7HB,w.t7l),new S(6,0,w.t8HB,w.t8l),new S(6,0,w.t9HB,w.t9l),new S(8,0,w.t10HB,w.t10l),new S(8,0,w.t11HB,w.t11l),new S(8,0,w.t12HB,w.t12l),new S(16,0,w.t13HB,w.t13l),new S(0,0,null,w.t16_5l),new S(16,0,w.t15HB,w.t15l),new S(1,1,w.t16HB,w.t16l),new S(2,3,w.t16HB,w.t16l),new S(3,7,w.t16HB,w.t16l),new S(4,15,w.t16HB,w.t16l),new S(6,63,w.t16HB,w.t16l),new S(8,255,w.t16HB,w.t16l),new S(10,1023,w.t16HB,w.t16l),new S(13,8191,w.t16HB,w.t16l),new S(4,15,w.t24HB,w.t24l),new S(5,31,w.t24HB,w.t24l),new S(6,63,w.t24HB,w.t24l),new S(7,127,w.t24HB,w.t24l),new S(8,255,w.t24HB,w.t24l),new S(9,511,w.t24HB,w.t24l),new S(11,2047,w.t24HB,w.t24l),new S(13,8191,w.t24HB,w.t24l),new S(0,0,w.t32HB,w.t32l),new S(0,0,w.t33HB,w.t33l)],w.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],w.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],w.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],w.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],w.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],w.scfsi_band=[0,6,11,16,21],C.Q_MAX=257,C.Q_MAX2=116,C.LARGE_BITS=1e5,C.IXMAX_VAL=8206;var R={};function O(){var e,t,o;this.rv=null,this.qupvt=null;var i,a=new function(){this.setModules=function(e,t){}};function s(e){this.ordinal=e}function l(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function c(e){return p.FAST_LOG10(.368+.632*e*e*e)}function f(e,t,o,r,n){var i;switch(e){default:case 9:t.over_count>0?(i=o.over_SSD<=t.over_SSD,o.over_SSD==t.over_SSD&&(i=o.bits<t.bits)):i=o.max_noise<0&&10*o.max_noise+o.bits<=10*t.max_noise+t.bits;break;case 0:i=o.over_count<t.over_count||o.over_count==t.over_count&&o.over_noise<t.over_noise||o.over_count==t.over_count&&_.EQ(o.over_noise,t.over_noise)&&o.tot_noise<t.tot_noise;break;case 8:o.max_noise=function(e,t){for(var o=1e-37,r=0;r<t.psymax;r++)o+=c(e[r]);return Math.max(1e-20,o)}(n,r);case 1:i=o.max_noise<t.max_noise;break;case 2:i=o.tot_noise<t.tot_noise;break;case 3:i=o.tot_noise<t.tot_noise&&o.max_noise<t.max_noise;break;case 4:i=o.max_noise<=0&&t.max_noise>.2||o.max_noise<=0&&t.max_noise<0&&t.max_noise>o.max_noise-.2&&o.tot_noise<t.tot_noise||o.max_noise<=0&&t.max_noise>0&&t.max_noise>o.max_noise-.2&&o.tot_noise<t.tot_noise+t.over_noise||o.max_noise>0&&t.max_noise>-.05&&t.max_noise>o.max_noise-.1&&o.tot_noise+o.over_noise<t.tot_noise+t.over_noise||o.max_noise>0&&t.max_noise>-.1&&t.max_noise>o.max_noise-.15&&o.tot_noise+o.over_noise+o.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:i=o.over_noise<t.over_noise||_.EQ(o.over_noise,t.over_noise)&&o.tot_noise<t.tot_noise;break;case 6:i=o.over_noise<t.over_noise||_.EQ(o.over_noise,t.over_noise)&&(o.max_noise<t.max_noise||_.EQ(o.max_noise,t.max_noise)&&o.tot_noise<=t.tot_noise);break;case 7:i=o.over_count<t.over_count||o.over_noise<t.over_noise}return 0==t.over_count&&(i=i&&o.bits<t.bits),i}function h(e,t,r,n,a){var s=e.internal_flags;!function(e,t,o,r,n){var i,a=e.internal_flags;i=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var s=0,l=0;l<t.sfbmax;l++)s<o[l]&&(s=o[l]);var c=a.noise_shaping_amp;switch(3==c&&(c=n?2:1),c){case 2:break;case 1:s>1?s=Math.pow(s,.5):s*=.95;break;case 0:default:s>1?s=1:s*=.95}var u=0;for(l=0;l<t.sfbmax;l++){var d,p=t.width[l];if(u+=p,!(o[l]<s)){if(0!=(2&a.substep_shaping)&&(a.pseudohalf[l]=0==a.pseudohalf[l]?1:0,0==a.pseudohalf[l]&&2==a.noise_shaping_amp))return;for(t.scalefac[l]++,d=-p;d<0;d++)r[u+d]*=i,r[u+d]>t.xrpow_max&&(t.xrpow_max=r[u+d]);if(2==a.noise_shaping_amp)return}}}(e,t,r,n,a);var c=l(t);return!c&&(!(c=2==s.mode_gr?i.scale_bitcount(t):i.scale_bitcount_lsf(s,t))||(s.noise_shaping>1&&(u.fill(s.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var r=0,n=0;n<e.sfbmax;n++){var i=e.width[n],a=e.scalefac[n];if(0!=e.preflag&&(a+=o.pretab[n]),r+=i,0!=(1&a)){a++;for(var s=-i;s<0;s++)t[r+s]*=1.2968395546510096,t[r+s]>e.xrpow_max&&(e.xrpow_max=t[r+s])}e.scalefac[n]=a>>1}e.preflag=0,e.scalefac_scale=1}(t,n),c=!1):t.block_type==A.SHORT_TYPE&&s.subblock_gain>0&&(c=function(e,t,r){var n,i=t.scalefac;for(n=0;n<t.sfb_lmax;n++)if(i[n]>=16)return!0;for(var a=0;a<3;a++){var s=0,l=0;for(n=t.sfb_lmax+a;n<t.sfbdivide;n+=3)s<i[n]&&(s=i[n]);for(;n<t.sfbmax;n+=3)l<i[n]&&(l=i[n]);if(!(s<16&&l<8)){if(t.subblock_gain[a]>=7)return!0;t.subblock_gain[a]++;var c=e.scalefac_band.l[t.sfb_lmax];for(n=t.sfb_lmax+a;n<t.sfbmax;n+=3){var u=t.width[n],d=i[n];if((d-=4>>t.scalefac_scale)>=0)i[n]=d,c+=3*u;else{i[n]=0;var p=210+(d<<t.scalefac_scale+1);h=o.IPOW20(p),c+=u*(a+1);for(var f=-u;f<0;f++)r[c+f]*=h,r[c+f]>t.xrpow_max&&(t.xrpow_max=r[c+f]);c+=u*(3-a-1)}}var h=o.IPOW20(202);for(c+=t.width[n]*(a+1),f=-t.width[n];f<0;f++)r[c+f]*=h,r[c+f]>t.xrpow_max&&(t.xrpow_max=r[c+f])}}return!1}(s,t,n)||l(t))),c||(c=2==s.mode_gr?i.scale_bitcount(t):i.scale_bitcount_lsf(s,t)),!c))}this.setModules=function(r,n,s,l){e=r,t=n,this.rv=n,o=s,this.qupvt=s,i=l,a.setModules(o,i)},this.ms_convert=function(e,t){for(var o=0;o<576;++o){var r=e.tt[t][0].xr[o],n=e.tt[t][1].xr[o];e.tt[t][0].xr[o]=(r+n)*(.5*p.SQRT2),e.tt[t][1].xr[o]=(r-n)*(.5*p.SQRT2)}},this.init_xrpow=function(e,t,o){var r=0,n=0|t.max_nonzero_coeff;if(t.xrpow_max=0,u.fill(o,n,576,0),(r=function(e,t,o,r){r=0;for(var n=0;n<=o;++n){var i=Math.abs(e.xr[n]);r+=i,t[n]=Math.sqrt(i*Math.sqrt(i)),t[n]>e.xrpow_max&&(e.xrpow_max=t[n])}return r}(t,o,n,r))>1e-20){var i=0;0!=(2&e.substep_shaping)&&(i=1);for(var a=0;a<t.psymax;a++)e.pseudohalf[a]=i;return!0}return u.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=A.SBPSY_l,t.sfb_smin=A.SBPSY_s,t.psy_lmax=e.sfb21_extra?A.SBMAX_l:A.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var r=0;r<A.SBMAX_l;r++)t.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],t.window[r]=3;if(t.block_type==A.SHORT_TYPE){var i=n(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?A.SBMAX_s:A.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(A.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var a=e.scalefac_band.l[t.sfb_lmax];d.arraycopy(t.xr,0,i,0,576);for(r=t.sfb_smin;r<A.SBMAX_s;r++)for(var s=e.scalefac_band.s[r],l=e.scalefac_band.s[r+1],c=0;c<3;c++)for(var p=s;p<l;p++)t.xr[a++]=i[3*p+c];var f=t.sfb_lmax;for(r=t.sfb_smin;r<A.SBMAX_s;r++)t.width[f]=t.width[f+1]=t.width[f+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],t.window[f]=0,t.window[f+1]=1,t.window[f+2]=2,f+=3}t.count1bits=0,t.sfb_partition_table=o.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,u.fill(t.scalefac,0),function(e,t){var r=e.ATH,n=t.xr;if(t.block_type!=A.SHORT_TYPE)for(var i=!1,a=A.PSFB21-1;a>=0&&!i;a--){var s=e.scalefac_band.psfb21[a],l=e.scalefac_band.psfb21[a+1],c=o.athAdjust(r.adjust,r.psfb21[a],r.floor);e.nsPsy.longfact[21]>1e-12&&(c*=e.nsPsy.longfact[21]);for(var u=l-1;u>=s;u--){if(!(Math.abs(n[u])<c)){i=!0;break}n[u]=0}}else for(var d=0;d<3;d++)for(i=!1,a=A.PSFB12-1;a>=0&&!i;a--){l=(s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*d+(e.scalefac_band.psfb12[a]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[a+1]-e.scalefac_band.psfb12[a]);var p=o.athAdjust(r.adjust,r.psfb12[a],r.floor);for(e.nsPsy.shortfact[12]>1e-12&&(p*=e.nsPsy.shortfact[12]),u=l-1;u>=s;u--){if(!(Math.abs(n[u])<p)){i=!0;break}n[u]=0}}}(e,t)},s.BINSEARCH_NONE=new s(0),s.BINSEARCH_UP=new s(1),s.BINSEARCH_DOWN=new s(2),this.trancate_smallspectrums=function(e,t,r,a){var s=n(R.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=A.SHORT_TYPE)&&0==(128&e.substep_shaping)){o.calc_noise(t,r,s,new E,null);for(var l=0;l<576;l++){var c=0;0!=t.l3_enc[l]&&(c=Math.abs(t.xr[l])),a[l]=c}l=0;var d=8;t.block_type==A.SHORT_TYPE&&(d=6);do{var p,f,h,m,g=t.width[d];if(l+=g,!(s[d]>=1||(u.sort(a,l-g,g),_.EQ(a[l-1],0)))){p=(1-s[d])*r[d],f=0,m=0;do{var b;for(h=1;m+h<g&&!_.NEQ(a[m+l-g],a[m+l+h-g]);h++);if(p<(b=a[m+l-g]*a[m+l-g]*h)){0!=m&&(f=a[m+l-g-1]);break}p-=b,m+=h}while(m<g);if(!_.EQ(f,0))do{Math.abs(t.xr[l-g])<=f&&(t.l3_enc[l-g]=0)}while(--g>0)}}while(++d<t.psymax);t.part2_3_length=i.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,a,l,c,u){var p=e.internal_flags,g=new T,b=n(576),v=n(R.SFBMAX),y=new E,_=new function(){this.global_gain=0,this.sfb_count1=0,this.step=r(39),this.noise=n(39),this.noise_log=n(39)},S=9999999,w=!1,k=!1,P=0;if(function(e,t,o,r,n){var a,l=e.CurrentStep[r],c=!1,u=e.OldValue[r],d=s.BINSEARCH_NONE;for(t.global_gain=u,o-=t.part2_length;;){var p;if(a=i.count_bits(e,n,t,null),1==l||a==o)break;a>o?(d==s.BINSEARCH_DOWN&&(c=!0),c&&(l/=2),d=s.BINSEARCH_UP,p=l):(d==s.BINSEARCH_UP&&(c=!0),c&&(l/=2),d=s.BINSEARCH_DOWN,p=-l),t.global_gain+=p,t.global_gain<0&&(t.global_gain=0,c=!0),t.global_gain>255&&(t.global_gain=255,c=!0)}for(;a>o&&t.global_gain<255;)t.global_gain++,a=i.count_bits(e,n,t,null);e.CurrentStep[r]=u-t.global_gain>=4?4:2,e.OldValue[r]=t.global_gain,t.part2_3_length=a}(p,t,u,c,l),0==p.noise_shaping)return 100;o.calc_noise(t,a,v,y,_),y.bits=t.part2_3_length,g.assign(t);var C=0;for(d.arraycopy(l,0,b,0,576);!w;){do{var O,M=new E,N=255;if(O=0!=(2&p.substep_shaping)?20:3,p.sfb21_extra){if(v[g.sfbmax]>1)break;if(g.block_type==A.SHORT_TYPE&&(v[g.sfbmax+1]>1||v[g.sfbmax+2]>1))break}if(!h(e,g,v,l,k))break;0!=g.scalefac_scale&&(N=254);var I=u-g.part2_length;if(I<=0)break;for(;(g.part2_3_length=i.count_bits(p,l,g,_))>I&&g.global_gain<=N;)g.global_gain++;if(g.global_gain>N)break;if(0==y.over_count){for(;(g.part2_3_length=i.count_bits(p,l,g,_))>S&&g.global_gain<=N;)g.global_gain++;if(g.global_gain>N)break}if(o.calc_noise(g,a,v,M,_),M.bits=g.part2_3_length,0!=(f(t.block_type!=A.SHORT_TYPE?e.quant_comp:e.quant_comp_short,y,M,g,v)?1:0))S=t.part2_3_length,y=M,t.assign(g),C=0,d.arraycopy(l,0,b,0,576);else if(0==p.full_outer_loop){if(++C>O&&0==y.over_count)break;if(3==p.noise_shaping_amp&&k&&C>30)break;if(3==p.noise_shaping_amp&&k&&g.global_gain-P>15)break}}while(g.global_gain+g.scalefac_scale<255);3==p.noise_shaping_amp?k?w=!0:(g.assign(t),d.arraycopy(b,0,l,0,576),C=0,P=g.global_gain,k=!0):w=!0}return e.VBR==m.vbr_rh||e.VBR==m.vbr_mtrh?d.arraycopy(b,0,l,0,576):0!=(1&p.substep_shaping)&&trancate_smallspectrums(p,t,a,l),y.over_count},this.iteration_finish_one=function(e,o,r){var n=e.l3_side,a=n.tt[o][r];i.best_scalefac_store(e,o,r,n),1==e.use_best_huffman&&i.best_huffman_divide(e,a),t.ResvAdjust(e,a)},this.VBR_encode_granule=function(e,t,o,r,i,a,s){var l,c=e.internal_flags,p=new T,f=n(576),h=s,m=s+1,g=(s+a)/2,b=0,v=c.sfb21_extra;u.fill(p.l3_enc,0);do{c.sfb21_extra=!(g>h-42)&&v,outer_loop(e,t,o,r,i,g)<=0?(b=1,m=t.part2_3_length,p.assign(t),d.arraycopy(r,0,f,0,576),l=(s=m-32)-a,g=(s+a)/2):(l=s-(a=g+32),g=(s+a)/2,0!=b&&(b=2,t.assign(p),d.arraycopy(f,0,r,0,576)))}while(l>12);c.sfb21_extra=v,2==b&&d.arraycopy(p.l3_enc,0,t.l3_enc,0,576)},this.get_framebits=function(o,r){var n=o.internal_flags;n.bitrate_index=n.VBR_min_bitrate;var i=e.getframebits(o);n.bitrate_index=1,i=e.getframebits(o);for(var a=1;a<=n.VBR_max_bitrate;a++){n.bitrate_index=a;var s=new k(i);r[a]=t.ResvFrameBegin(o,s),i=s.bits}},this.VBR_old_prepare=function(e,r,n,i,a,s,l,c,u){var d,p=e.internal_flags,f=0,h=1,m=0;p.bitrate_index=p.VBR_max_bitrate;var g=t.ResvFrameBegin(e,new k(0))/p.mode_gr;get_framebits(e,s);for(var b=0;b<p.mode_gr;b++){var v=o.on_pe(e,r,c[b],g,b,0);p.mode_ext==A.MPG_MD_MS_LR&&(ms_convert(p.l3_side,b),o.reduce_side(c[b],n[b],g,v));for(var y=0;y<p.channels_out;++y){var _=p.l3_side.tt[b][y];_.block_type!=A.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-r[b][y]/300))-.05,d=p.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-r[b][y]/300))-.14,d=p.PSY.mask_adjust_short-f),p.masking_lower=Math.pow(10,.1*d),init_outer_loop(p,_),u[b][y]=o.calc_xmin(e,i[b][y],_,a[b][y]),0!=u[b][y]&&(h=0),l[b][y]=126,m+=c[b][y]}}for(b=0;b<p.mode_gr;b++)for(y=0;y<p.channels_out;y++)m>s[p.VBR_max_bitrate]&&(c[b][y]*=s[p.VBR_max_bitrate],c[b][y]/=m),l[b][y]>c[b][y]&&(l[b][y]=c[b][y]);return h},this.bitpressure_strategy=function(e,t,o,r){for(var n=0;n<e.mode_gr;n++)for(var i=0;i<e.channels_out;i++){for(var a=e.l3_side.tt[n][i],s=t[n][i],l=0,c=0;c<a.psy_lmax;c++)s[l++]*=1+.029*c*c/A.SBMAX_l/A.SBMAX_l;if(a.block_type==A.SHORT_TYPE)for(c=a.sfb_smin;c<A.SBMAX_s;c++)s[l++]*=1+.029*c*c/A.SBMAX_s/A.SBMAX_s,s[l++]*=1+.029*c*c/A.SBMAX_s/A.SBMAX_s,s[l++]*=1+.029*c*c/A.SBMAX_s/A.SBMAX_s;r[n][i]=0|Math.max(o[n][i],.9*r[n][i])}},this.VBR_new_prepare=function(e,r,n,i,a,s){var l,c=e.internal_flags,u=1,d=0,p=0;if(e.free_format){c.bitrate_index=0;f=new k(d);l=t.ResvFrameBegin(e,f),d=f.bits,a[0]=l}else{c.bitrate_index=c.VBR_max_bitrate;var f=new k(d);t.ResvFrameBegin(e,f),d=f.bits,get_framebits(e,a),l=a[c.VBR_max_bitrate]}for(var h=0;h<c.mode_gr;h++){o.on_pe(e,r,s[h],d,h,0),c.mode_ext==A.MPG_MD_MS_LR&&ms_convert(c.l3_side,h);for(var m=0;m<c.channels_out;++m){var g=c.l3_side.tt[h][m];c.masking_lower=Math.pow(10,.1*c.PSY.mask_adjust),init_outer_loop(c,g),0!=o.calc_xmin(e,n[h][m],g,i[h][m])&&(u=0),p+=s[h][m]}}for(h=0;h<c.mode_gr;h++)for(m=0;m<c.channels_out;m++)p>l&&(s[h][m]*=l,s[h][m]/=p);return u},this.calc_target_bits=function(r,n,i,a,s,l){var c,u,d,p,f=r.internal_flags,h=f.l3_side,m=0;f.bitrate_index=f.VBR_max_bitrate;var g=new k(m);for(l[0]=t.ResvFrameBegin(r,g),m=g.bits,f.bitrate_index=1,m=e.getframebits(r)-8*f.sideinfo_len,s[0]=m/(f.mode_gr*f.channels_out),m=r.VBR_mean_bitrate_kbps*r.framesize*1e3,0!=(1&f.substep_shaping)&&(m*=1.09),m/=r.out_samplerate,m-=8*f.sideinfo_len,m/=f.mode_gr*f.channels_out,(c=.93+.07*(11-r.compression_ratio)/5.5)<.9&&(c=.9),c>1&&(c=1),u=0;u<f.mode_gr;u++){var b=0;for(d=0;d<f.channels_out;d++){if(a[u][d]=int(c*m),n[u][d]>700){var v=int((n[u][d]-700)/1.4),y=h.tt[u][d];a[u][d]=int(c*m),y.block_type==A.SHORT_TYPE&&v<m/2&&(v=m/2),v>3*m/2?v=3*m/2:v<0&&(v=0),a[u][d]+=v}a[u][d]>I.MAX_BITS_PER_CHANNEL&&(a[u][d]=I.MAX_BITS_PER_CHANNEL),b+=a[u][d]}if(b>I.MAX_BITS_PER_GRANULE)for(d=0;d<f.channels_out;++d)a[u][d]*=I.MAX_BITS_PER_GRANULE,a[u][d]/=b}if(f.mode_ext==A.MPG_MD_MS_LR)for(u=0;u<f.mode_gr;u++)o.reduce_side(a[u],i[u],m*f.channels_out,I.MAX_BITS_PER_GRANULE);for(p=0,u=0;u<f.mode_gr;u++)for(d=0;d<f.channels_out;d++)a[u][d]>I.MAX_BITS_PER_CHANNEL&&(a[u][d]=I.MAX_BITS_PER_CHANNEL),p+=a[u][d];if(p>l[0])for(u=0;u<f.mode_gr;u++)for(d=0;d<f.channels_out;d++)a[u][d]*=l[0],a[u][d]/=p}}function M(){this.thm=new N,this.en=new N}function A(){var e=A.FFTOFFSET,t=A.MPG_MD_MS_LR,o=null;this.psy=null;var i=null,s=null,l=null;this.setModules=function(e,t,r,n){o=e,this.psy=t,i=t,s=n,l=r};var f=new function(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*p.SQRT2*.5/2384e-9,.017876148*p.SQRT2*.5/2384e-9,.003134727*p.SQRT2*.5/2384e-9,.002457142*p.SQRT2*.5/2384e-9,971317e-9*p.SQRT2*.5/2384e-9,218868e-9*p.SQRT2*.5/2384e-9,101566e-9*p.SQRT2*.5/2384e-9,13828e-9*p.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],t=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],o=t[A.SHORT_TYPE],r=t[A.SHORT_TYPE],i=t[A.SHORT_TYPE],a=t[A.SHORT_TYPE],s=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function l(t,o,r){for(var n,i,a,s=10,l=o+238-14-286,c=-15;c<0;c++){var u,d,f;u=e[s+-10],d=t[l+-224]*u,f=t[o+224]*u,u=e[s+-9],d+=t[l+-160]*u,f+=t[o+160]*u,u=e[s+-8],d+=t[l+-96]*u,f+=t[o+96]*u,u=e[s+-7],d+=t[l+-32]*u,f+=t[o+32]*u,u=e[s+-6],d+=t[l+32]*u,f+=t[o+-32]*u,u=e[s+-5],d+=t[l+96]*u,f+=t[o+-96]*u,u=e[s+-4],d+=t[l+160]*u,f+=t[o+-160]*u,u=e[s+-3],d+=t[l+224]*u,f+=t[o+-224]*u,u=e[s+-2],d+=t[o+-256]*u,f-=t[l+256]*u,u=e[s+-1],d+=t[o+-192]*u,f-=t[l+192]*u,u=e[s+0],d+=t[o+-128]*u,f-=t[l+128]*u,u=e[s+1],d+=t[o+-64]*u,f-=t[l+64]*u,u=e[s+2],d+=t[o+0]*u,f-=t[l+0]*u,u=e[s+3],d+=t[o+64]*u,f-=t[l+-64]*u,u=e[s+4],d+=t[o+128]*u,f-=t[l+-128]*u,u=e[s+5],d+=t[o+192]*u,u=(f-=t[l+-192]*u)-(d*=e[s+6]),r[30+2*c]=f+d,r[31+2*c]=e[s+7]*u,s+=18,o--,l++}f=t[o+-16]*e[s+-10],d=t[o+-32]*e[s+-2],f+=(t[o+-48]-t[o+16])*e[s+-9],d+=t[o+-96]*e[s+-1],f+=(t[o+-80]+t[o+48])*e[s+-8],d+=t[o+-160]*e[s+0],f+=(t[o+-112]-t[o+80])*e[s+-7],d+=t[o+-224]*e[s+1],f+=(t[o+-144]+t[o+112])*e[s+-6],d-=t[o+32]*e[s+2],f+=(t[o+-176]-t[o+144])*e[s+-5],d-=t[o+96]*e[s+3],f+=(t[o+-208]+t[o+176])*e[s+-4],d-=t[o+160]*e[s+4],f+=(t[o+-240]-t[o+208])*e[s+-3],n=(d-=t[o+224])-f,i=d+f,f=r[14],d=r[15]-f,r[31]=i+f,r[30]=n+d,r[15]=n-d,r[14]=i-f,a=r[28]-r[0],r[0]+=r[28],r[28]=a*e[s+-36+7],a=r[29]-r[1],r[1]+=r[29],r[29]=a*e[s+-36+7],a=r[26]-r[2],r[2]+=r[26],r[26]=a*e[s+-72+7],a=r[27]-r[3],r[3]+=r[27],r[27]=a*e[s+-72+7],a=r[24]-r[4],r[4]+=r[24],r[24]=a*e[s+-108+7],a=r[25]-r[5],r[5]+=r[25],r[25]=a*e[s+-108+7],a=r[22]-r[6],r[6]+=r[22],r[22]=a*p.SQRT2,a=r[23]-r[7],r[7]+=r[23],r[23]=a*p.SQRT2-r[7],r[7]-=r[6],r[22]-=r[7],r[23]-=r[22],a=r[6],r[6]=r[31]-a,r[31]=r[31]+a,a=r[7],r[7]=r[30]-a,r[30]=r[30]+a,a=r[22],r[22]=r[15]-a,r[15]=r[15]+a,a=r[23],r[23]=r[14]-a,r[14]=r[14]+a,a=r[20]-r[8],r[8]+=r[20],r[20]=a*e[s+-180+7],a=r[21]-r[9],r[9]+=r[21],r[21]=a*e[s+-180+7],a=r[18]-r[10],r[10]+=r[18],r[18]=a*e[s+-216+7],a=r[19]-r[11],r[11]+=r[19],r[19]=a*e[s+-216+7],a=r[16]-r[12],r[12]+=r[16],r[16]=a*e[s+-252+7],a=r[17]-r[13],r[13]+=r[17],r[17]=a*e[s+-252+7],a=-r[20]+r[24],r[20]+=r[24],r[24]=a*e[s+-216+7],a=-r[21]+r[25],r[21]+=r[25],r[25]=a*e[s+-216+7],a=r[4]-r[8],r[4]+=r[8],r[8]=a*e[s+-216+7],a=r[5]-r[9],r[5]+=r[9],r[9]=a*e[s+-216+7],a=r[0]-r[12],r[0]+=r[12],r[12]=a*e[s+-72+7],a=r[1]-r[13],r[1]+=r[13],r[13]=a*e[s+-72+7],a=r[16]-r[28],r[16]+=r[28],r[28]=a*e[s+-72+7],a=-r[17]+r[29],r[17]+=r[29],r[29]=a*e[s+-72+7],a=p.SQRT2*(r[2]-r[10]),r[2]+=r[10],r[10]=a,a=p.SQRT2*(r[3]-r[11]),r[3]+=r[11],r[11]=a,a=p.SQRT2*(-r[18]+r[26]),r[18]+=r[26],r[26]=a-r[18],a=p.SQRT2*(-r[19]+r[27]),r[19]+=r[27],r[27]=a-r[19],a=r[2],r[19]-=r[3],r[3]-=a,r[2]=r[31]-a,r[31]+=a,a=r[3],r[11]-=r[19],r[18]-=a,r[3]=r[30]-a,r[30]+=a,a=r[18],r[27]-=r[11],r[19]-=a,r[18]=r[15]-a,r[15]+=a,a=r[19],r[10]-=a,r[19]=r[14]-a,r[14]+=a,a=r[10],r[11]-=a,r[10]=r[23]-a,r[23]+=a,a=r[11],r[26]-=a,r[11]=r[22]-a,r[22]+=a,a=r[26],r[27]-=a,r[26]=r[7]-a,r[7]+=a,a=r[27],r[27]=r[6]-a,r[6]+=a,a=p.SQRT2*(r[0]-r[4]),r[0]+=r[4],r[4]=a,a=p.SQRT2*(r[1]-r[5]),r[1]+=r[5],r[5]=a,a=p.SQRT2*(r[16]-r[20]),r[16]+=r[20],r[20]=a,a=p.SQRT2*(r[17]-r[21]),r[17]+=r[21],r[21]=a,a=-p.SQRT2*(r[8]-r[12]),r[8]+=r[12],r[12]=a-r[8],a=-p.SQRT2*(r[9]-r[13]),r[9]+=r[13],r[13]=a-r[9],a=-p.SQRT2*(r[25]-r[29]),r[25]+=r[29],r[29]=a-r[25],a=-p.SQRT2*(r[24]+r[28]),r[24]-=r[28],r[28]=a-r[24],a=r[24]-r[16],r[24]=a,a=r[20]-a,r[20]=a,a=r[28]-a,r[28]=a,a=r[25]-r[17],r[25]=a,a=r[21]-a,r[21]=a,a=r[29]-a,r[29]=a,a=r[17]-r[1],r[17]=a,a=r[9]-a,r[9]=a,a=r[25]-a,r[25]=a,a=r[5]-a,r[5]=a,a=r[21]-a,r[21]=a,a=r[13]-a,r[13]=a,a=r[29]-a,r[29]=a,a=r[1]-r[0],r[1]=a,a=r[16]-a,r[16]=a,a=r[17]-a,r[17]=a,a=r[8]-a,r[8]=a,a=r[9]-a,r[9]=a,a=r[24]-a,r[24]=a,a=r[25]-a,r[25]=a,a=r[4]-a,r[4]=a,a=r[5]-a,r[5]=a,a=r[20]-a,r[20]=a,a=r[21]-a,r[21]=a,a=r[12]-a,r[12]=a,a=r[13]-a,r[13]=a,a=r[28]-a,r[28]=a,a=r[29]-a,r[29]=a,a=r[0],r[0]+=r[31],r[31]-=a,a=r[1],r[1]+=r[30],r[30]-=a,a=r[16],r[16]+=r[15],r[15]-=a,a=r[17],r[17]+=r[14],r[14]-=a,a=r[8],r[8]+=r[23],r[23]-=a,a=r[9],r[9]+=r[22],r[22]-=a,a=r[24],r[24]+=r[7],r[7]-=a,a=r[25],r[25]+=r[6],r[6]-=a,a=r[4],r[4]+=r[27],r[27]-=a,a=r[5],r[5]+=r[26],r[26]-=a,a=r[20],r[20]+=r[11],r[11]-=a,a=r[21],r[21]+=r[10],r[10]-=a,a=r[12],r[12]+=r[19],r[19]-=a,a=r[13],r[13]+=r[18],r[18]-=a,a=r[28],r[28]+=r[3],r[3]-=a,a=r[29],r[29]+=r[2],r[2]-=a}function c(e,o){for(var r=0;r<3;r++){var n,i,a,s,l,c;i=(s=e[o+6]*t[A.SHORT_TYPE][0]-e[o+15])+(n=e[o+0]*t[A.SHORT_TYPE][2]-e[o+9]),a=s-n,l=(s=e[o+15]*t[A.SHORT_TYPE][0]+e[o+6])+(n=e[o+9]*t[A.SHORT_TYPE][2]+e[o+0]),c=-s+n,n=2.069978111953089e-11*(e[o+3]*t[A.SHORT_TYPE][1]-e[o+12]),s=2.069978111953089e-11*(e[o+12]*t[A.SHORT_TYPE][1]+e[o+3]),e[o+0]=1.90752519173728e-11*i+n,e[o+15]=1.90752519173728e-11*-l+s,a=.8660254037844387*a*1.907525191737281e-11,l=.5*l*1.907525191737281e-11+s,e[o+3]=a-l,e[o+6]=a+l,i=.5*i*1.907525191737281e-11-n,c=.8660254037844387*c*1.907525191737281e-11,e[o+9]=i+c,e[o+12]=i-c,o++}}function f(e,t,o){var n,i,a,s,l,c,u,d,p,f,h,m,g,b,v,y,_,S;a=o[17]-o[9],l=o[15]-o[11],c=o[14]-o[12],u=o[0]+o[8],d=o[1]+o[7],p=o[2]+o[6],f=o[3]+o[5],e[t+17]=u+p-f-(d-o[4]),i=(u+p-f)*r[19]+(d-o[4]),n=(a-l-c)*r[18],e[t+5]=n+i,e[t+6]=n-i,s=(o[16]-o[10])*r[18],d=d*r[19]+o[4],n=a*r[12]+s+l*r[13]+c*r[14],i=-u*r[16]+d-p*r[17]+f*r[15],e[t+1]=n+i,e[t+2]=n-i,n=a*r[13]-s-l*r[14]+c*r[12],i=-u*r[17]+d-p*r[15]+f*r[16],e[t+9]=n+i,e[t+10]=n-i,n=a*r[14]-s+l*r[12]-c*r[13],i=u*r[15]-d+p*r[16]-f*r[17],e[t+13]=n+i,e[t+14]=n-i,h=o[8]-o[0],g=o[6]-o[2],b=o[5]-o[3],v=o[17]+o[9],y=o[16]+o[10],_=o[15]+o[11],S=o[14]+o[12],e[t+0]=v+_+S+(y+o[13]),n=(v+_+S)*r[19]-(y+o[13]),i=(h-g+b)*r[18],e[t+11]=n+i,e[t+12]=n-i,m=(o[7]-o[1])*r[18],y=o[13]-y*r[19],n=v*r[15]-y+_*r[16]+S*r[17],i=h*r[14]+m+g*r[12]+b*r[13],e[t+3]=n+i,e[t+4]=n-i,n=-v*r[17]+y-_*r[15]-S*r[16],i=h*r[13]+m-g*r[14]-b*r[12],e[t+7]=n+i,e[t+8]=n-i,n=-v*r[16]+y-_*r[17]-S*r[15],i=h*r[12]-m+g*r[13]-b*r[14],e[t+15]=n+i,e[t+16]=n-i}this.mdct_sub48=function(e,r,p){for(var h=r,m=286,g=0;g<e.channels_out;g++){for(var b=0;b<e.mode_gr;b++){for(var v,y=e.l3_side.tt[b][g],_=y.xr,S=0,w=e.sb_sample[g][1-b],k=0,E=0;E<9;E++)for(l(h,m,w[k]),l(h,m+32,w[k+1]),k+=2,m+=64,v=1;v<32;v+=2)w[k-1][v]*=-1;for(v=0;v<32;v++,S+=18){var P=y.block_type,C=e.sb_sample[g][b],T=e.sb_sample[g][1-b];if(0!=y.mixed_block_flag&&v<2&&(P=0),e.amp_filter[v]<1e-12)u.fill(_,S+0,S+18,0);else{if(e.amp_filter[v]<1)for(E=0;E<18;E++)T[E][s[v]]*=e.amp_filter[v];if(P==A.SHORT_TYPE){for(E=-3;E<0;E++){var R=t[A.SHORT_TYPE][E+3];_[S+3*E+9]=C[9+E][s[v]]*R-C[8-E][s[v]],_[S+3*E+18]=C[14-E][s[v]]*R+C[15+E][s[v]],_[S+3*E+10]=C[15+E][s[v]]*R-C[14-E][s[v]],_[S+3*E+19]=T[2-E][s[v]]*R+T[3+E][s[v]],_[S+3*E+11]=T[3+E][s[v]]*R-T[2-E][s[v]],_[S+3*E+20]=T[8-E][s[v]]*R+T[9+E][s[v]]}c(_,S)}else{var O=n(18);for(E=-9;E<0;E++){var M,N;M=t[P][E+27]*T[E+9][s[v]]+t[P][E+36]*T[8-E][s[v]],N=t[P][E+9]*C[E+9][s[v]]-t[P][E+18]*C[8-E][s[v]],O[E+9]=M-N*o[3+E+9],O[E+18]=M*o[3+E+9]+N}f(_,S,O)}}if(P!=A.SHORT_TYPE&&0!=v)for(E=7;E>=0;--E){var I,x;I=_[S+E]*i[20+E]+_[S+-1-E]*a[28+E],x=_[S+E]*a[28+E]-_[S+-1-E]*i[20+E],_[S+-1-E]=I,_[S+E]=x}}}if(h=p,m=286,1==e.mode_gr)for(var D=0;D<18;D++)d.arraycopy(e.sb_sample[g][1][D],0,e.sb_sample[g][0][D],0,32)}}};this.lame_encode_mp3_frame=function(u,p,h,b,v,y){var _,S=c([2,2]);S[0][0]=new M,S[0][1]=new M,S[1][0]=new M,S[1][1]=new M;var w,k=c([2,2]);k[0][0]=new M,k[0][1]=new M,k[1][0]=new M,k[1][1]=new M;var E,P,C,T=[null,null],R=u.internal_flags,O=a([2,4]),N=[.5,.5],I=[[0,0],[0,0]],x=[[0,0],[0,0]];if(T[0]=p,T[1]=h,0==R.lame_encode_frame_init&&function(e,t){var o,r,i=e.internal_flags;if(0==i.lame_encode_frame_init){var a,s,l=n(2014),c=n(2014);for(i.lame_encode_frame_init=1,a=0,s=0;a<286+576*(1+i.mode_gr);++a)a<576*i.mode_gr?(l[a]=0,2==i.channels_out&&(c[a]=0)):(l[a]=t[0][s],2==i.channels_out&&(c[a]=t[1][s]),++s);for(r=0;r<i.mode_gr;r++)for(o=0;o<i.channels_out;o++)i.l3_side.tt[r][o].block_type=A.SHORT_TYPE;f.mdct_sub48(i,l,c)}}(u,T),R.padding=0,(R.slot_lag-=R.frac_SpF)<0&&(R.slot_lag+=u.out_samplerate,R.padding=1),0!=R.psymodel){var D=[null,null],F=0,L=r(2);for(C=0;C<R.mode_gr;C++){for(P=0;P<R.channels_out;P++)D[P]=T[P],F=576+576*C-A.FFTOFFSET;if(0!=(u.VBR==m.vbr_mtrh||u.VBR==m.vbr_mt?i.L3psycho_anal_vbr(u,D,F,C,S,k,I[C],x[C],O[C],L):i.L3psycho_anal_ns(u,D,F,C,S,k,I[C],x[C],O[C],L)))return-4;for(u.mode==g.JOINT_STEREO&&(N[C]=O[C][2]+O[C][3],N[C]>0&&(N[C]=O[C][3]/N[C])),P=0;P<R.channels_out;P++){var U=R.l3_side.tt[C][P];U.block_type=L[P],U.mixed_block_flag=0}}}else for(C=0;C<R.mode_gr;C++)for(P=0;P<R.channels_out;P++)R.l3_side.tt[C][P].block_type=A.NORM_TYPE,R.l3_side.tt[C][P].mixed_block_flag=0,x[C][P]=I[C][P]=700;if(function(e){var t,o;if(0!=e.ATH.useAdjust)if(o=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(o+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(o+=o,t+=t),2==e.mode_gr&&(o=Math.max(o,t)),o*=.5,(o*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*o+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}(R),f.mdct_sub48(R,T[0],T[1]),R.mode_ext=A.MPG_MD_LR_LR,u.force_ms)R.mode_ext=A.MPG_MD_MS_LR;else if(u.mode==g.JOINT_STEREO){var j=0,B=0;for(C=0;C<R.mode_gr;C++)for(P=0;P<R.channels_out;P++)j+=x[C][P],B+=I[C][P];if(j<=1*B){var V=R.l3_side.tt[0],H=R.l3_side.tt[R.mode_gr-1];V[0].block_type==V[1].block_type&&H[0].block_type==H[1].block_type&&(R.mode_ext=A.MPG_MD_MS_LR)}}if(R.mode_ext==t?(w=k,E=x):(w=S,E=I),u.analysis&&null!=R.pinfo)for(C=0;C<R.mode_gr;C++)for(P=0;P<R.channels_out;P++)R.pinfo.ms_ratio[C]=R.ms_ratio[C],R.pinfo.ms_ener_ratio[C]=N[C],R.pinfo.blocktype[C][P]=R.l3_side.tt[C][P].block_type,R.pinfo.pe[C][P]=E[C][P],d.arraycopy(R.l3_side.tt[C][P].xr,0,R.pinfo.xr[C][P],0,576),R.mode_ext==t&&(R.pinfo.ers[C][P]=R.pinfo.ers[C][P+2],d.arraycopy(R.pinfo.energy[C][P+2],0,R.pinfo.energy[C][P],0,R.pinfo.energy[C][P].length));if(u.VBR==m.vbr_off||u.VBR==m.vbr_abr){var G,q;for(G=0;G<18;G++)R.nsPsy.pefirbuf[G]=R.nsPsy.pefirbuf[G+1];for(q=0,C=0;C<R.mode_gr;C++)for(P=0;P<R.channels_out;P++)q+=E[C][P];for(R.nsPsy.pefirbuf[18]=q,q=R.nsPsy.pefirbuf[9],G=0;G<9;G++)q+=(R.nsPsy.pefirbuf[G]+R.nsPsy.pefirbuf[18-G])*A.fircoef[G];for(q=3350*R.mode_gr*R.channels_out/q,C=0;C<R.mode_gr;C++)for(P=0;P<R.channels_out;P++)E[C][P]*=q}if(R.iteration_loop.iteration_loop(u,E,N,w),o.format_bitstream(u),_=o.copy_buffer(R,b,v,y,1),u.bWriteVbrTag&&s.addVbrFrame(u),u.analysis&&null!=R.pinfo){for(P=0;P<R.channels_out;P++){var z;for(z=0;z<e;z++)R.pinfo.pcmdata[P][z]=R.pinfo.pcmdata[P][z+u.framesize];for(z=e;z<1600;z++)R.pinfo.pcmdata[P][z]=T[P][z-e]}l.set_frame_pinfo(u,w)}return function(e){var t,o;for(e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(o=0;o<e.channels_out;++o){var r=0|e.l3_side.tt[t][o].block_type;0!=e.l3_side.tt[t][o].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}(R),_}}function N(){this.l=n(A.SBMAX_l),this.s=a([A.SBMAX_s,3]);var e=this;this.assign=function(t){d.arraycopy(t.l,0,e.l,0,A.SBMAX_l);for(var o=0;o<A.SBMAX_s;o++)for(var r=0;r<3;r++)e.s[o][r]=t.s[o][r]}}function I(){var t=40;function o(){this.write_timing=0,this.ptr=0,this.buf=e(t)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=a([2,I.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[r(4),r(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new T},this.ms_ratio=n(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=r(2),this.CurrentStep=r(2),this.masking_lower=0,this.bv_scf=r(576),this.pseudohalf=r(R.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*I.BPC+1),this.itime=i(2),this.sideinfo_len=0,this.sb_sample=a([2,2,18,A.SBLIMIT]),this.amp_filter=n(32),this.header=new Array(I.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new P,this.minval_l=n(A.CBANDS),this.minval_s=n(A.CBANDS),this.nb_1=a([4,A.CBANDS]),this.nb_2=a([4,A.CBANDS]),this.nb_s1=a([4,A.CBANDS]),this.nb_s2=a([4,A.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=n(4),this.loudness_sq=a([2,2]),this.loudness_sq_save=n(2),this.mld_l=n(A.SBMAX_l),this.mld_s=n(A.SBMAX_s),this.bm_l=r(A.SBMAX_l),this.bo_l=r(A.SBMAX_l),this.bm_s=r(A.SBMAX_s),this.bo_s=r(A.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=s([A.CBANDS,2]),this.s3ind_s=s([A.CBANDS,2]),this.numlines_s=r(A.CBANDS),this.numlines_l=r(A.CBANDS),this.rnumlines_l=n(A.CBANDS),this.mld_cb_l=n(A.CBANDS),this.mld_cb_s=n(A.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=n(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=r(2),this.nsPsy=new function(){this.last_en_subshort=a([4,9]),this.lastAttacks=r(4),this.pefirbuf=n(19),this.longfact=n(A.SBMAX_l),this.shortfact=n(A.SBMAX_s),this.attackthre=0,this.attackthre_s=0},this.VBR_seek_table=new function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=s([16,5]),this.bitrate_blockType_Hist=s([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var l=0;l<this.en.length;l++)this.en[l]=new N;for(l=0;l<this.thm.length;l++)this.thm[l]=new N;for(l=0;l<this.header.length;l++)this.header[l]=new o}function x(){var e=new function(){var e=n(A.BLKSIZE),t=n(A.BLKSIZE_s/2),o=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(e,t,r){var n,i,a,s=0,l=t+(r<<=1);n=4;do{var c,u,d,f,h,m,g;g=n>>1,m=(h=n<<1)+(f=n),n=h<<1,a=(i=t)+g;do{k=e[i+0]-e[i+f],w=e[i+0]+e[i+f],T=e[i+h]-e[i+m],P=e[i+h]+e[i+m],e[i+h]=w-P,e[i+0]=w+P,e[i+m]=k-T,e[i+f]=k+T,k=e[a+0]-e[a+f],w=e[a+0]+e[a+f],T=p.SQRT2*e[a+m],P=p.SQRT2*e[a+h],e[a+h]=w-P,e[a+0]=w+P,e[a+m]=k-T,e[a+f]=k+T,a+=n,i+=n}while(i<l);for(u=o[s+0],c=o[s+1],d=1;d<g;d++){var b,v;b=1-2*c*c,v=2*c*u,i=t+d,a=t+f-d;do{var y,_,S,w,k,E,P,C,T,R;_=v*e[i+f]-b*e[a+f],y=b*e[i+f]+v*e[a+f],k=e[i+0]-y,w=e[i+0]+y,E=e[a+0]-_,S=e[a+0]+_,_=v*e[i+m]-b*e[a+m],y=b*e[i+m]+v*e[a+m],T=e[i+h]-y,P=e[i+h]+y,R=e[a+h]-_,C=e[a+h]+_,_=c*P-u*R,y=u*P+c*R,e[i+h]=w-y,e[i+0]=w+y,e[a+m]=E-_,e[a+f]=E+_,_=u*C-c*T,y=c*C+u*T,e[a+h]=S-y,e[a+0]=S+y,e[i+m]=k-_,e[i+f]=k+_,a+=n,i+=n}while(i<l);u=(b=u)*o[s+0]-c*o[s+1],c=b*o[s+1]+c*o[s+0]}s+=2}while(n<r)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,o,n,a,s){for(var l=0;l<3;l++){var c=A.BLKSIZE_s/2,u=65535&192*(l+1),d=A.BLKSIZE_s/8-1;do{var p,f,h,m,g,b=255&i[d<<2];f=(p=t[b]*a[n][s+b+u])-(g=t[127-b]*a[n][s+b+u+128]),p+=g,m=(h=t[b+64]*a[n][s+b+u+64])-(g=t[63-b]*a[n][s+b+u+192]),h+=g,c-=4,o[l][c+0]=p+h,o[l][c+2]=p-h,o[l][c+1]=f+m,o[l][c+3]=f-m,f=(p=t[b+1]*a[n][s+b+u+1])-(g=t[126-b]*a[n][s+b+u+129]),p+=g,m=(h=t[b+65]*a[n][s+b+u+65])-(g=t[62-b]*a[n][s+b+u+193]),h+=g,o[l][c+A.BLKSIZE_s/2+0]=p+h,o[l][c+A.BLKSIZE_s/2+2]=p-h,o[l][c+A.BLKSIZE_s/2+1]=f+m,o[l][c+A.BLKSIZE_s/2+3]=f-m}while(--d>=0);r(o[l],c,A.BLKSIZE_s/2)}},this.fft_long=function(t,o,n,a,s){var l=A.BLKSIZE/8-1,c=A.BLKSIZE/2;do{var u,d,p,f,h,m=255&i[l];d=(u=e[m]*a[n][s+m])-(h=e[m+512]*a[n][s+m+512]),u+=h,f=(p=e[m+256]*a[n][s+m+256])-(h=e[m+768]*a[n][s+m+768]),p+=h,o[0+(c-=4)]=u+p,o[c+2]=u-p,o[c+1]=d+f,o[c+3]=d-f,d=(u=e[m+1]*a[n][s+m+1])-(h=e[m+513]*a[n][s+m+513]),u+=h,f=(p=e[m+257]*a[n][s+m+257])-(h=e[m+769]*a[n][s+m+769]),p+=h,o[c+A.BLKSIZE/2+0]=u+p,o[c+A.BLKSIZE/2+2]=u-p,o[c+A.BLKSIZE/2+1]=d+f,o[c+A.BLKSIZE/2+3]=d-f}while(--l>=0);r(o,c,A.BLKSIZE/2)},this.init_fft=function(o){for(var r=0;r<A.BLKSIZE;r++)e[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/A.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/A.BLKSIZE);for(r=0;r<A.BLKSIZE_s/2;r++)t[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/A.BLKSIZE_s))}},t=2.302585092994046,o=2,i=16,s=2,l=16,c=.34,d=1/217621504/(A.BLKSIZE/2),b=.3,v=21,y=.2302585093;function _(e){return e}function S(e,t){for(var o=0,r=0;r<A.BLKSIZE/2;++r)o+=e[r]*t.ATH.eql_w[r];return o*=d}function w(t,o,r,n,i,a,s,l,c,u,d){var f=t.internal_flags;if(c<2)e.fft_long(f,n[i],c,u,d),e.fft_short(f,a[s],c,u,d);else if(2==c){for(var h=A.BLKSIZE-1;h>=0;--h){var m=n[i+0][h],g=n[i+1][h];n[i+0][h]=(m+g)*p.SQRT2*.5,n[i+1][h]=(m-g)*p.SQRT2*.5}for(var b=2;b>=0;--b)for(h=A.BLKSIZE_s-1;h>=0;--h){m=a[s+0][b][h],g=a[s+1][b][h];a[s+0][b][h]=(m+g)*p.SQRT2*.5,a[s+1][b][h]=(m-g)*p.SQRT2*.5}}o[0]=_(n[i+0][0]),o[0]*=o[0];for(h=A.BLKSIZE/2-1;h>=0;--h){var v=n[i+0][A.BLKSIZE/2-h],y=n[i+0][A.BLKSIZE/2+h];o[A.BLKSIZE/2-h]=_(.5*(v*v+y*y))}for(b=2;b>=0;--b){r[b][0]=a[s+0][b][0],r[b][0]*=r[b][0];for(h=A.BLKSIZE_s/2-1;h>=0;--h){v=a[s+0][b][A.BLKSIZE_s/2-h],y=a[s+0][b][A.BLKSIZE_s/2+h];r[b][A.BLKSIZE_s/2-h]=_(.5*(v*v+y*y))}}var w=0;for(h=11;h<A.HBLKSIZE;h++)w+=o[h];if(f.tot_ener[c]=w,t.analysis){for(h=0;h<A.HBLKSIZE;h++)f.pinfo.energy[l][c][h]=f.pinfo.energy_save[c][h],f.pinfo.energy_save[c][h]=o[h];f.pinfo.pe[l][c]=f.pe[c]}2==t.athaa_loudapprox&&c<2&&(f.loudness_sq[l][c]=f.loudness_sq_save[c],f.loudness_sq_save[c]=S(o,f))}var k,E,P,C=8,T=23,R=15,O=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];var M=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],N=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],I=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function x(e,t,o,r,n,i){var a;if(t>e){if(!(t<e*E))return e+t;a=t/e}else{if(e>=t*E)return e+t;a=e/t}if(e+=t,r+3<=6){if(a>=k)return e;var s=0|p.FAST_LOG10_X(a,16);return e*N[s]}var l,c;s=0|p.FAST_LOG10_X(a,16);return t=0!=i?n.ATH.cb_s[o]*n.ATH.adjust:n.ATH.cb_l[o]*n.ATH.adjust,e<P*t?e>t?(l=1,s<=13&&(l=I[s]),c=p.FAST_LOG10_X(e/t,10/15),e*((M[s]-l)*c+l)):s>13?e:e*I[s]:e*M[s]}var D=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function F(e,t,o){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=o&&o<=2){if(r>=k)return e+t;var n=0|p.FAST_LOG10_X(r,16);return(e+t)*D[n]}return r<E?e+t:(e<t&&(e=t),e)}function L(e,t,o,r,n){var i,a,s=0,l=0;for(i=a=0;i<A.SBMAX_s;++a,++i){for(var c=e.bo_s[i],u=e.npart_s,d=c<u?c:u;a<d;)s+=t[a],l+=o[a],a++;if(e.en[r].s[i][n]=s,e.thm[r].s[i][n]=l,a>=u){++i;break}var p=e.PSY.bo_s_weight[i],f=1-p;s=p*t[a],l=p*o[a],e.en[r].s[i][n]+=s,e.thm[r].s[i][n]+=l,s=f*t[a],l=f*o[a]}for(;i<A.SBMAX_s;++i)e.en[r].s[i][n]=0,e.thm[r].s[i][n]=0}function U(e,t,o,r){var n,i,a=0,s=0;for(n=i=0;n<A.SBMAX_l;++i,++n){for(var l=e.bo_l[n],c=e.npart_l,u=l<c?l:c;i<u;)a+=t[i],s+=o[i],i++;if(e.en[r].l[n]=a,e.thm[r].l[n]=s,i>=c){++n;break}var d=e.PSY.bo_l_weight[n],p=1-d;a=d*t[i],s=d*o[i],e.en[r].l[n]+=a,e.thm[r].l[n]+=s,a=p*t[i],s=p*o[i]}for(;n<A.SBMAX_l;++n)e.en[r].l[n]=0,e.thm[r].l[n]=0}function j(e,t,o,r,n,i){var a,c,u=e.internal_flags;for(c=a=0;c<u.npart_s;++c){for(var d=0,p=0,f=u.numlines_s[c],h=0;h<f;++h,++a){var m=t[i][a];d+=m,p<m&&(p=m)}o[c]=d}for(a=c=0;c<u.npart_s;c++){var g=u.s3ind_s[c][0],b=u.s3_ss[a++]*o[g];for(++g;g<=u.s3ind_s[c][1];)b+=u.s3_ss[a]*o[g],++a,++g;var v=s*u.nb_s1[n][c];if(r[c]=Math.min(b,v),u.blocktype_old[1&n]==A.SHORT_TYPE){v=l*u.nb_s2[n][c];var y=r[c];r[c]=Math.min(v,y)}u.nb_s2[n][c]=u.nb_s1[n][c],u.nb_s1[n][c]=b}for(;c<=A.CBANDS;++c)o[c]=0,r[c]=0}function B(e,t,o){return o>=1?e:o<=0?t:t>0?Math.pow(e/t,o)*t:0}var V=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function H(e,o){for(var r=309.07,n=0;n<A.SBMAX_s-1;n++)for(var i=0;i<3;i++){var a=e.thm.s[n][i];if(a>0){var s=a*o,l=e.en.s[n][i];l>s&&(r+=l>1e10*s?V[n]*(10*t):V[n]*p.FAST_LOG10(l/s))}}return r}var G=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function q(e,o){for(var r=281.0575,n=0;n<A.SBMAX_l-1;n++){var i=e.thm.l[n];if(i>0){var a=i*o,s=e.en.l[n];s>a&&(r+=s>1e10*a?G[n]*(10*t):G[n]*p.FAST_LOG10(s/a))}}return r}function z(e,t,o,r,n){var i,a;for(i=a=0;i<e.npart_l;++i){var s,l=0,c=0;for(s=0;s<e.numlines_l[i];++s,++a){var u=t[a];l+=u,c<u&&(c=u)}o[i]=l,r[i]=c,n[i]=l*e.rnumlines_l[i]}}function W(e,t,o,r){var n=O.length-1,i=0,a=o[i]+o[i+1];a>0?((s=t[i])<t[i+1]&&(s=t[i+1]),(l=0|(a=20*(2*s-a)/(a*(e.numlines_l[i]+e.numlines_l[i+1]-1))))>n&&(l=n),r[i]=l):r[i]=0;for(i=1;i<e.npart_l-1;i++){var s,l;if((a=o[i-1]+o[i]+o[i+1])>0)(s=t[i-1])<t[i]&&(s=t[i]),s<t[i+1]&&(s=t[i+1]),(l=0|(a=20*(3*s-a)/(a*(e.numlines_l[i-1]+e.numlines_l[i]+e.numlines_l[i+1]-1))))>n&&(l=n),r[i]=l;else r[i]=0}(a=o[i-1]+o[i])>0?((s=t[i-1])<t[i]&&(s=t[i]),(l=0|(a=20*(2*s-a)/(a*(e.numlines_l[i-1]+e.numlines_l[i]-1))))>n&&(l=n),r[i]=l):r[i]=0}var Y=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];function $(t,o,r,n,i,a,s,l){var c=t.internal_flags;if(n<2)e.fft_long(c,s[l],n,o,r);else if(2==n)for(var u=A.BLKSIZE-1;u>=0;--u){var d=s[l+0][u],f=s[l+1][u];s[l+0][u]=(d+f)*p.SQRT2*.5,s[l+1][u]=(d-f)*p.SQRT2*.5}a[0]=_(s[l+0][0]),a[0]*=a[0];for(u=A.BLKSIZE/2-1;u>=0;--u){var h=s[l+0][A.BLKSIZE/2-u],m=s[l+0][A.BLKSIZE/2+u];a[A.BLKSIZE/2-u]=_(.5*(h*h+m*m))}var g=0;for(u=11;u<A.HBLKSIZE;u++)g+=a[u];if(c.tot_ener[n]=g,t.analysis){for(u=0;u<A.HBLKSIZE;u++)c.pinfo.energy[i][n][u]=c.pinfo.energy_save[n][u],c.pinfo.energy_save[n][u]=a[u];c.pinfo.pe[i][n]=c.pe[n]}}function K(t,o,r,n,i,a,s,l){var c=t.internal_flags;if(0==i&&n<2&&e.fft_short(c,s[l],n,o,r),2==n)for(var u=A.BLKSIZE_s-1;u>=0;--u){var d=s[l+0][i][u],f=s[l+1][i][u];s[l+0][i][u]=(d+f)*p.SQRT2*.5,s[l+1][i][u]=(d-f)*p.SQRT2*.5}a[i][0]=s[l+0][i][0],a[i][0]*=a[i][0];for(u=A.BLKSIZE_s/2-1;u>=0;--u){var h=s[l+0][i][A.BLKSIZE_s/2-u],m=s[l+0][i][A.BLKSIZE_s/2+u];a[i][A.BLKSIZE_s/2-u]=_(.5*(h*h+m*m))}}function X(e,t,o,r){var n=e.internal_flags;2==e.athaa_loudapprox&&o<2&&(n.loudness_sq[t][o]=n.loudness_sq_save[o],n.loudness_sq_save[o]=S(r,n))}this.L3psycho_anal_ns=function(e,t,s,l,c,d,p,h,y,_){var S,k,E,P,C,T,R,M,N,I,D=e.internal_flags,F=a([2,A.BLKSIZE]),V=a([2,3,A.BLKSIZE_s]),G=n(A.CBANDS+1),$=n(A.CBANDS+1),K=n(A.CBANDS+2),X=r(2),Q=r(2),J=a([2,576]),Z=r(A.CBANDS+2),ee=r(A.CBANDS+2);for(u.fill(ee,0),S=D.channels_out,e.mode==g.JOINT_STEREO&&(S=4),N=e.VBR==m.vbr_off?0==D.ResvMax?0:D.ResvSize/D.ResvMax*.5:e.VBR==m.vbr_rh||e.VBR==m.vbr_mtrh||e.VBR==m.vbr_mt?.6:1,k=0;k<D.channels_out;k++){var te=t[k],oe=s+576-350-v+192;for(P=0;P<576;P++){var re,ne;for(re=te[oe+P+10],ne=0,C=0;C<(v-1)/2-1;C+=2)re+=Y[C]*(te[oe+P+C]+te[oe+P+v-C]),ne+=Y[C+1]*(te[oe+P+C+1]+te[oe+P+v-C-1]);J[k][P]=re+ne}c[l][k].en.assign(D.en[k]),c[l][k].thm.assign(D.thm[k]),S>2&&(d[l][k].en.assign(D.en[k+2]),d[l][k].thm.assign(D.thm[k+2]))}for(k=0;k<S;k++){var ie,ae=n(12),se=[0,0,0,0],le=n(12),ce=1,ue=n(A.CBANDS),de=n(A.CBANDS),pe=[0,0,0,0],fe=n(A.HBLKSIZE),he=a([3,A.HBLKSIZE_s]);for(P=0;P<3;P++)ae[P]=D.nsPsy.last_en_subshort[k][P+6],le[P]=ae[P]/D.nsPsy.last_en_subshort[k][P+4],se[0]+=ae[P];if(2==k)for(P=0;P<576;P++){var me,ge;me=J[0][P],ge=J[1][P],J[0][P]=me+ge,J[1][P]=me-ge}var be=J[1&k],ve=0;for(P=0;P<9;P++){for(var ye=ve+64,_e=1;ve<ye;ve++)_e<Math.abs(be[ve])&&(_e=Math.abs(be[ve]));D.nsPsy.last_en_subshort[k][P]=ae[P+3]=_e,se[1+P/3]+=_e,_e>ae[P+3-2]?_e/=ae[P+3-2]:_e=ae[P+3-2]>10*_e?ae[P+3-2]/(10*_e):0,le[P+3]=_e}if(e.analysis){var Se=le[0];for(P=1;P<12;P++)Se<le[P]&&(Se=le[P]);D.pinfo.ers[l][k]=D.pinfo.ers_save[k],D.pinfo.ers_save[k]=Se}for(ie=3==k?D.nsPsy.attackthre_s:D.nsPsy.attackthre,P=0;P<12;P++)0==pe[P/3]&&le[P]>ie&&(pe[P/3]=P%3+1);for(P=1;P<4;P++){(se[P-1]>se[P]?se[P-1]/se[P]:se[P]/se[P-1])<1.7&&(pe[P]=0,1==P&&(pe[0]=0))}for(0!=pe[0]&&0!=D.nsPsy.lastAttacks[k]&&(pe[0]=0),3!=D.nsPsy.lastAttacks[k]&&pe[0]+pe[1]+pe[2]+pe[3]==0||(ce=0,0!=pe[1]&&0!=pe[0]&&(pe[1]=0),0!=pe[2]&&0!=pe[1]&&(pe[2]=0),0!=pe[3]&&0!=pe[2]&&(pe[3]=0)),k<2?Q[k]=ce:0==ce&&(Q[0]=Q[1]=0),y[k]=D.tot_ener[k],w(e,fe,he,F,1&k,V,1&k,l,k,t,s),z(D,fe,G,ue,de),W(D,ue,de,Z),M=0;M<3;M++){var we,ke;for(j(e,he,$,K,k,M),L(D,$,K,k,M),R=0;R<A.SBMAX_s;R++){if(ke=D.thm[k].s[R][M],ke*=.8,pe[M]>=2||1==pe[M+1]){var Ee=0!=M?M-1:2;_e=B(D.thm[k].s[R][Ee],ke,.6*N);ke=Math.min(ke,_e)}if(1==pe[M]){Ee=0!=M?M-1:2,_e=B(D.thm[k].s[R][Ee],ke,b*N);ke=Math.min(ke,_e)}else if(0!=M&&3==pe[M-1]||0==M&&3==D.nsPsy.lastAttacks[k]){Ee=2!=M?M+1:0,_e=B(D.thm[k].s[R][Ee],ke,b*N);ke=Math.min(ke,_e)}we=ae[3*M+3]+ae[3*M+4]+ae[3*M+5],6*ae[3*M+5]<we&&(ke*=.5,6*ae[3*M+4]<we&&(ke*=.5)),D.thm[k].s[R][M]=ke}}for(D.nsPsy.lastAttacks[k]=pe[2],T=0,E=0;E<D.npart_l;E++){for(var Pe=D.s3ind[E][0],Ce=G[Pe]*O[Z[Pe]],Te=D.s3_ll[T++]*Ce;++Pe<=D.s3ind[E][1];)Ce=G[Pe]*O[Z[Pe]],Te=x(Te,D.s3_ll[T++]*Ce,Pe,Pe-E,D,0);Te*=.158489319246111,D.blocktype_old[1&k]==A.SHORT_TYPE?K[E]=Te:K[E]=B(Math.min(Te,Math.min(o*D.nb_1[k][E],i*D.nb_2[k][E])),Te,N),D.nb_2[k][E]=D.nb_1[k][E],D.nb_1[k][E]=Te}for(;E<=A.CBANDS;++E)G[E]=0,K[E]=0;U(D,G,K,k)}(e.mode!=g.STEREO&&e.mode!=g.JOINT_STEREO||e.interChRatio>0&&function(e,t){var o=e.internal_flags;if(o.channels_out>1){for(var r=0;r<A.SBMAX_l;r++){var n=o.thm[0].l[r],i=o.thm[1].l[r];o.thm[0].l[r]+=i*t,o.thm[1].l[r]+=n*t}for(r=0;r<A.SBMAX_s;r++)for(var a=0;a<3;a++)n=o.thm[0].s[r][a],i=o.thm[1].s[r][a],o.thm[0].s[r][a]+=i*t,o.thm[1].s[r][a]+=n*t}}(e,e.interChRatio),e.mode==g.JOINT_STEREO)&&(!function(e){for(var t=0;t<A.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var o=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],o));o=e.mld_l[t]*e.en[2].l[t];var n=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],o));e.thm[2].l[t]=r,e.thm[3].l[t]=n}for(t=0;t<A.SBMAX_s;t++)for(var i=0;i<3;i++)e.thm[0].s[t][i]>1.58*e.thm[1].s[t][i]||e.thm[1].s[t][i]>1.58*e.thm[0].s[t][i]||(o=e.mld_s[t]*e.en[3].s[t][i],r=Math.max(e.thm[2].s[t][i],Math.min(e.thm[3].s[t][i],o)),o=e.mld_s[t]*e.en[2].s[t][i],n=Math.max(e.thm[3].s[t][i],Math.min(e.thm[2].s[t][i],o)),e.thm[2].s[t][i]=r,e.thm[3].s[t][i]=n)}(D),I=e.msfix,Math.abs(I)>0&&function(e,t,o){var r=t,n=Math.pow(10,o);t*=2,r*=2;for(var i=0;i<A.SBMAX_l;i++)u=e.ATH.cb_l[e.bm_l[i]]*n,(s=Math.min(Math.max(e.thm[0].l[i],u),Math.max(e.thm[1].l[i],u)))*t<(l=Math.max(e.thm[2].l[i],u))+(c=Math.max(e.thm[3].l[i],u))&&(l*=d=s*r/(l+c),c*=d),e.thm[2].l[i]=Math.min(l,e.thm[2].l[i]),e.thm[3].l[i]=Math.min(c,e.thm[3].l[i]);for(n*=A.BLKSIZE_s/A.BLKSIZE,i=0;i<A.SBMAX_s;i++)for(var a=0;a<3;a++){var s,l,c,u,d;u=e.ATH.cb_s[e.bm_s[i]]*n,(s=Math.min(Math.max(e.thm[0].s[i][a],u),Math.max(e.thm[1].s[i][a],u)))*t<(l=Math.max(e.thm[2].s[i][a],u))+(c=Math.max(e.thm[3].s[i][a],u))&&(l*=d=s*t/(l+c),c*=d),e.thm[2].s[i][a]=Math.min(e.thm[2].s[i][a],l),e.thm[3].s[i][a]=Math.min(e.thm[3].s[i][a],c)}}(D,I,e.ATHlower*D.ATH.adjust));for(function(e,t,o,r){var n=e.internal_flags;e.short_blocks!=f.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var i=0;i<n.channels_out;i++)r[i]=A.NORM_TYPE,e.short_blocks==f.short_block_dispensed&&(t[i]=1),e.short_blocks==f.short_block_forced&&(t[i]=0),0!=t[i]?n.blocktype_old[i]==A.SHORT_TYPE&&(r[i]=A.STOP_TYPE):(r[i]=A.SHORT_TYPE,n.blocktype_old[i]==A.NORM_TYPE&&(n.blocktype_old[i]=A.START_TYPE),n.blocktype_old[i]==A.STOP_TYPE&&(n.blocktype_old[i]=A.SHORT_TYPE)),o[i]=n.blocktype_old[i],n.blocktype_old[i]=r[i]}(e,Q,_,X),k=0;k<S;k++){var Re,Oe,Me,Ae=0;k>1?(Re=h,Ae=-2,Oe=A.NORM_TYPE,_[0]!=A.SHORT_TYPE&&_[1]!=A.SHORT_TYPE||(Oe=A.SHORT_TYPE),Me=d[l][k-2]):(Re=p,Ae=0,Oe=_[k],Me=c[l][k]),Oe==A.SHORT_TYPE?Re[Ae+k]=H(Me,D.masking_lower):Re[Ae+k]=q(Me,D.masking_lower),e.analysis&&(D.pinfo.pe[l][k]=Re[Ae+k])}return 0};var Q=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];function J(e,t,o){if(0==o)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function Z(e,t){for(var o=0;o<e.npart_l;o++)e.nb_2[t][o]=e.nb_1[t][o],e.nb_1[t][o]=0}function ee(e,t,o,r,i,a){var s,l,c,u=e.internal_flags,d=new float[A.CBANDS],p=n(A.CBANDS),f=new int[A.CBANDS];for(c=l=0;c<u.npart_s;++c){var h=0,m=0,g=u.numlines_s[c];for(s=0;s<g;++s,++l){var b=t[a][l];h+=b,m<b&&(m=b)}o[c]=h,d[c]=m,p[c]=h/g}for(;c<A.CBANDS;++c)d[c]=0,p[c]=0;for(function(e,t,o,r){var n=O.length-1,i=0,a=o[i]+o[i+1];for(a>0?((s=t[i])<t[i+1]&&(s=t[i+1]),(l=0|(a=20*(2*s-a)/(a*(e.numlines_s[i]+e.numlines_s[i+1]-1))))>n&&(l=n),r[i]=l):r[i]=0,i=1;i<e.npart_s-1;i++){var s,l;(a=o[i-1]+o[i]+o[i+1])>0?((s=t[i-1])<t[i]&&(s=t[i]),s<t[i+1]&&(s=t[i+1]),(l=0|(a=20*(3*s-a)/(a*(e.numlines_s[i-1]+e.numlines_s[i]+e.numlines_s[i+1]-1))))>n&&(l=n),r[i]=l):r[i]=0}(a=o[i-1]+o[i])>0?((s=t[i-1])<t[i]&&(s=t[i]),(l=0|(a=20*(2*s-a)/(a*(e.numlines_s[i-1]+e.numlines_s[i]-1))))>n&&(l=n),r[i]=l):r[i]=0}(u,d,p,f),l=c=0;c<u.npart_s;c++){var v,y,_,S,w,k=u.s3ind_s[c][0],E=u.s3ind_s[c][1];for(v=f[k],y=1,S=u.s3_ss[l]*o[k]*O[f[k]],++l,++k;k<=E;)v+=f[k],y+=1,S=F(S,_=u.s3_ss[l]*o[k]*O[f[k]],k-c),++l,++k;S*=w=.5*O[v=(1+2*v)/(2*y)],r[c]=S,u.nb_s2[i][c]=u.nb_s1[i][c],u.nb_s1[i][c]=S,_=d[c],_*=u.minval_s[c],_*=w,r[c]>_&&(r[c]=_),u.masking_lower>1&&(r[c]*=u.masking_lower),r[c]>o[c]&&(r[c]=o[c]),u.masking_lower<1&&(r[c]*=u.masking_lower)}for(;c<A.CBANDS;++c)o[c]=0,r[c]=0}function te(e,t,a,s,l){var c,u=n(A.CBANDS),d=n(A.CBANDS),p=r(A.CBANDS+2);z(e,t,a,u,d),W(e,u,d,p);var f=0;for(c=0;c<e.npart_l;c++){var h,m,g,v=e.s3ind[c][0],y=e.s3ind[c][1],_=0,S=0;for(_=p[v],S+=1,m=e.s3_ll[f]*a[v]*O[p[v]],++f,++v;v<=y;)_+=p[v],S+=1,m=F(m,h=e.s3_ll[f]*a[v]*O[p[v]],v-c),++f,++v;if(m*=g=.5*O[_=(1+2*_)/(2*S)],e.blocktype_old[1&l]==A.SHORT_TYPE){var w=o*e.nb_1[l][c];s[c]=w>0?Math.min(m,w):Math.min(m,a[c]*b)}else{var k=i*e.nb_2[l][c],E=o*e.nb_1[l][c];k<=0&&(k=m),E<=0&&(E=m),w=e.blocktype_old[1&l]==A.NORM_TYPE?Math.min(E,k):E,s[c]=Math.min(m,w)}e.nb_2[l][c]=e.nb_1[l][c],e.nb_1[l][c]=m,h=u[c],h*=e.minval_l[c],h*=g,s[c]>h&&(s[c]=h),e.masking_lower>1&&(s[c]*=e.masking_lower),s[c]>a[c]&&(s[c]=a[c]),e.masking_lower<1&&(s[c]*=e.masking_lower)}for(;c<A.CBANDS;++c)a[c]=0,s[c]=0}function oe(e,t,o,r,n,i,a){for(var s,l,c=2*i,u=i>0?Math.pow(10,n):1,d=0;d<a;++d){var p=e[2][d],f=e[3][d],h=t[0][d],m=t[1][d],g=t[2][d],b=t[3][d];if(h<=1.58*m&&m<=1.58*h){var v=o[d]*f,y=o[d]*p;l=Math.max(g,Math.min(b,v)),s=Math.max(b,Math.min(g,y))}else l=g,s=b;if(i>0){var _,S,w=r[d]*u;if(_=Math.min(Math.max(h,w),Math.max(m,w)),(S=(g=Math.max(l,w))+(b=Math.max(s,w)))>0&&_*c<S){var k=_*c/S;g*=k,b*=k}l=Math.min(g,l),s=Math.min(b,s)}l>p&&(l=p),s>f&&(s=f),t[2][d]=l,t[3][d]=s}}function re(e,t){var o;return(o=e>=0?27*-e:e*t)<=-72?0:Math.exp(o*y)}function ne(e){var t,o,r=0;for(r=0;re(r,e)>1e-20;r-=1);for(n=r,i=0;Math.abs(i-n)>1e-12;)re(r=(i+n)/2,e)>0?i=r:n=r;t=n;var n,i;r=0;for(r=0;re(r,e)>1e-20;r+=1);for(n=0,i=r;Math.abs(i-n)>1e-12;)re(r=(i+n)/2,e)>0?n=r:i=r;o=i;var a,s=0;for(a=0;a<=1e3;++a){s+=re(r=t+a*(o-t)/1e3,e)}return 1001/(s*(o-t))}function ie(e){var t,o,r,n;return t=e,o=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((n=t-.5)*n-2*n):0,(r=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((o+r)*y),t/=.6609193)}function ae(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function se(e,t,o,i,a,s,l,u,d,p,f,h){var m,g=n(A.CBANDS+1),b=u/(h>15?1152:384),v=r(A.HBLKSIZE);u/=d;var y=0,_=0;for(m=0;m<A.CBANDS;m++){var S;for(M=ae(u*y),g[m]=u*y,S=y;ae(u*S)-M<c&&S<=d/2;S++);for(e[m]=S-y,_=m+1;y<S;)v[y++]=m;if(y>d/2){y=d/2,++m;break}}g[m]=u*y;for(var w=0;w<h;w++){var k,E,P,C,T;P=p[w],C=p[w+1],(k=0|Math.floor(.5+f*(P-.5)))<0&&(k=0),(E=0|Math.floor(.5+f*(C-.5)))>d/2&&(E=d/2),o[w]=(v[k]+v[E])/2,t[w]=v[E];var R=b*C;l[w]=(R-g[t[w]])/(g[t[w]+1]-g[t[w]]),l[w]<0?l[w]=0:l[w]>1&&(l[w]=1),T=ae(u*p[w]*f),T=Math.min(T,15.5)/15.5,s[w]=Math.pow(10,1.25*(1-Math.cos(Math.PI*T))-2.5)}y=0;for(var O=0;O<_;O++){var M,N,I=e[O];M=ae(u*y),N=ae(u*(y+I-1)),i[O]=.5*(M+N),M=ae(u*(y-.5)),N=ae(u*(y+I-.5)),a[O]=N-M,y+=I}return _}function le(e,t,o,r,i,s){var l,c=a([A.CBANDS,A.CBANDS]),u=0;if(s)for(var d=0;d<t;d++)for(l=0;l<t;l++){var p=ie(o[d]-o[l])*r[l];c[d][l]=p*i[d]}else for(l=0;l<t;l++){var f=15+Math.min(21/o[l],12),h=ne(f);for(d=0;d<t;d++){p=h*re(o[d]-o[l],f)*r[l];c[d][l]=p*i[d]}}for(d=0;d<t;d++){for(l=0;l<t&&!(c[d][l]>0);l++);for(e[d][0]=l,l=t-1;l>0&&!(c[d][l]>0);l--);e[d][1]=l,u+=e[d][1]-e[d][0]+1}var m=n(u),g=0;for(d=0;d<t;d++)for(l=e[d][0];l<=e[d][1];l++)m[g++]=c[d][l];return m}function ce(e){var t=ae(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function ue(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,o,i,s,l,c,u,d,p){var h=e.internal_flags,m=n(A.HBLKSIZE),y=a([3,A.HBLKSIZE_s]),_=a([2,A.BLKSIZE]),S=a([2,3,A.BLKSIZE_s]),w=a([4,A.CBANDS]),k=a([4,A.CBANDS]),E=a([4,3]),P=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],C=r(2),T=e.mode==g.JOINT_STEREO?4:h.channels_out;!function(e,t,o,r,i,s,l,c,u,d){for(var p=a([2,576]),f=e.internal_flags,h=f.channels_out,m=e.mode==g.JOINT_STEREO?4:h,b=0;b<h;b++){firbuf=t[b];for(var y=o+576-350-v+192,_=0;_<576;_++){var S,w;S=firbuf[y+_+10],w=0;for(var k=0;k<(v-1)/2-1;k+=2)S+=Q[k]*(firbuf[y+_+k]+firbuf[y+_+v-k]),w+=Q[k+1]*(firbuf[y+_+k+1]+firbuf[y+_+v-k-1]);p[b][_]=S+w}i[r][b].en.assign(f.en[b]),i[r][b].thm.assign(f.thm[b]),m>2&&(s[r][b].en.assign(f.en[b+2]),s[r][b].thm.assign(f.thm[b+2]))}for(b=0;b<m;b++){var E=n(12),P=n(12),C=[0,0,0,0],T=p[1&b],R=0,O=3==b?f.nsPsy.attackthre_s:f.nsPsy.attackthre,M=1;if(2==b)for(_=0,k=576;k>0;++_,--k){var A=p[0][_],N=p[1][_];p[0][_]=A+N,p[1][_]=A-N}for(_=0;_<3;_++)P[_]=f.nsPsy.last_en_subshort[b][_+6],E[_]=P[_]/f.nsPsy.last_en_subshort[b][_+4],C[0]+=P[_];for(_=0;_<9;_++){for(var I=R+64,x=1;R<I;R++)x<Math.abs(T[R])&&(x=Math.abs(T[R]));f.nsPsy.last_en_subshort[b][_]=P[_+3]=x,C[1+_/3]+=x,x>P[_+3-2]?x/=P[_+3-2]:x=P[_+3-2]>10*x?P[_+3-2]/(10*x):0,E[_+3]=x}for(_=0;_<3;++_){var D=P[3*_+3]+P[3*_+4]+P[3*_+5],F=1;6*P[3*_+5]<D&&(F*=.5,6*P[3*_+4]<D&&(F*=.5)),c[b][_]=F}if(e.analysis){var L=E[0];for(_=1;_<12;_++)L<E[_]&&(L=E[_]);f.pinfo.ers[r][b]=f.pinfo.ers_save[b],f.pinfo.ers_save[b]=L}for(_=0;_<12;_++)0==u[b][_/3]&&E[_]>O&&(u[b][_/3]=_%3+1);for(_=1;_<4;_++){var U=C[_-1],j=C[_];Math.max(U,j)<4e4&&U<1.7*j&&j<1.7*U&&(1==_&&u[b][0]<=u[b][_]&&(u[b][0]=0),u[b][_]=0)}u[b][0]<=f.nsPsy.lastAttacks[b]&&(u[b][0]=0),3!=f.nsPsy.lastAttacks[b]&&u[b][0]+u[b][1]+u[b][2]+u[b][3]==0||(M=0,0!=u[b][1]&&0!=u[b][0]&&(u[b][1]=0),0!=u[b][2]&&0!=u[b][1]&&(u[b][2]=0),0!=u[b][3]&&0!=u[b][2]&&(u[b][3]=0)),b<2?d[b]=M:0==M&&(d[0]=d[1]=0),l[b]=f.tot_ener[b]}}(e,t,o,i,s,l,d,E,P,C),function(e,t){var o=e.internal_flags;e.short_blocks!=f.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<o.channels_out;r++)e.short_blocks==f.short_block_dispensed&&(t[r]=1),e.short_blocks==f.short_block_forced&&(t[r]=0)}(e,C);for(var R=0;R<T;R++){$(e,t,o,R,i,m,_,M=1&R),X(e,i,R,m),0!=C[M]?te(h,m,w[R],k[R],R):Z(h,R)}C[0]+C[1]==2&&e.mode==g.JOINT_STEREO&&oe(w,k,h.mld_cb_l,h.ATH.cb_l,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_l);for(R=0;R<T;R++){0!=C[M=1&R]&&U(h,w[R],k[R],R)}for(var O=0;O<3;O++){for(R=0;R<T;++R){0!=C[M=1&R]?J(h,R,O):(K(e,t,o,R,O,y,S,M),ee(e,y,w[R],k[R],R,O))}C[0]+C[1]==0&&e.mode==g.JOINT_STEREO&&oe(w,k,h.mld_cb_s,h.ATH.cb_s,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_s);for(R=0;R<T;++R){0==C[M=1&R]&&L(h,w[R],k[R],R,O)}}for(R=0;R<T;R++){var M;if(0==C[M=1&R])for(var N=0;N<A.SBMAX_s;N++){var I=n(3);for(O=0;O<3;O++){var x=h.thm[R].s[N][O];if(x*=.8,P[R][O]>=2||1==P[R][O+1]){var D=0!=O?O-1:2,F=B(h.thm[R].s[N][D],x,.36);x=Math.min(x,F)}else if(1==P[R][O]){D=0!=O?O-1:2,F=B(h.thm[R].s[N][D],x,.6*b);x=Math.min(x,F)}else if(0!=O&&3==P[R][O-1]||0==O&&3==h.nsPsy.lastAttacks[R]){D=2!=O?O+1:0,F=B(h.thm[R].s[N][D],x,.6*b);x=Math.min(x,F)}x*=E[R][O],I[O]=x}for(O=0;O<3;O++)h.thm[R].s[N][O]=I[O]}}for(R=0;R<T;R++)h.nsPsy.lastAttacks[R]=P[R][2];!function(e,t,o){for(var r=e.internal_flags,n=0;n<r.channels_out;n++){var i=A.NORM_TYPE;0!=t[n]?r.blocktype_old[n]==A.SHORT_TYPE&&(i=A.STOP_TYPE):(i=A.SHORT_TYPE,r.blocktype_old[n]==A.NORM_TYPE&&(r.blocktype_old[n]=A.START_TYPE),r.blocktype_old[n]==A.STOP_TYPE&&(r.blocktype_old[n]=A.SHORT_TYPE)),o[n]=r.blocktype_old[n],r.blocktype_old[n]=i}}(e,C,p);for(R=0;R<T;R++){var j,V,G,z;R>1?(j=u,V=-2,G=A.NORM_TYPE,p[0]!=A.SHORT_TYPE&&p[1]!=A.SHORT_TYPE||(G=A.SHORT_TYPE),z=l[i][R-2]):(j=c,V=0,G=p[R],z=s[i][R]),G==A.SHORT_TYPE?j[V+R]=H(z,h.masking_lower):j[V+R]=q(z,h.masking_lower),e.analysis&&(h.pinfo.pe[i][R]=j[V+R])}return 0},this.psymodel_init=function(o){var r,i=o.internal_flags,a=!0,s=13,l=0,c=0,u=-8.25,d=-4.5,p=n(A.CBANDS),f=n(A.CBANDS),g=n(A.CBANDS),b=o.out_samplerate;switch(o.experimentalZ){default:case 0:a=!0;break;case 1:a=o.VBR!=m.vbr_mtrh&&o.VBR!=m.vbr_mt;break;case 2:a=!1;break;case 3:s=8,l=-1.75,c=-.0125,u=-8.25,d=-2.25}for(i.ms_ener_ratio_old=.25,i.blocktype_old[0]=i.blocktype_old[1]=A.NORM_TYPE,r=0;r<4;++r){for(var v=0;v<A.CBANDS;++v)i.nb_1[r][v]=1e20,i.nb_2[r][v]=1e20,i.nb_s1[r][v]=i.nb_s2[r][v]=1;for(var y=0;y<A.SBMAX_l;y++)i.en[r].l[y]=1e20,i.thm[r].l[y]=1e20;for(v=0;v<3;++v){for(y=0;y<A.SBMAX_s;y++)i.en[r].s[y][v]=1e20,i.thm[r].s[y][v]=1e20;i.nsPsy.lastAttacks[r]=0}for(v=0;v<9;v++)i.nsPsy.last_en_subshort[r][v]=10}for(i.loudness_sq_save[0]=i.loudness_sq_save[1]=0,i.npart_l=se(i.numlines_l,i.bo_l,i.bm_l,p,f,i.mld_l,i.PSY.bo_l_weight,b,A.BLKSIZE,i.scalefac_band.l,A.BLKSIZE/1152,A.SBMAX_l),r=0;r<i.npart_l;r++){var _=l;p[r]>=s&&(_=c*(p[r]-s)/(24-s)+l*(24-p[r])/(24-s)),g[r]=Math.pow(10,_/10),i.numlines_l[r]>0?i.rnumlines_l[r]=1/i.numlines_l[r]:i.rnumlines_l[r]=0}i.s3_ll=le(i.s3ind,i.npart_l,p,f,g,a);var S;v=0;for(r=0;r<i.npart_l;r++){M=h.MAX_VALUE;for(var w=0;w<i.numlines_l[r];w++,v++){var O=b*v/(1e3*A.BLKSIZE);N=this.ATHformula(1e3*O,o)-20,N=Math.pow(10,.1*N),M>(N*=i.numlines_l[r])&&(M=N)}i.ATH.cb_l[r]=M,(M=20*p[r]/10-20)>6&&(M=100),M<-15&&(M=-15),M-=8,i.minval_l[r]=Math.pow(10,M/10)*i.numlines_l[r]}for(i.npart_s=se(i.numlines_s,i.bo_s,i.bm_s,p,f,i.mld_s,i.PSY.bo_s_weight,b,A.BLKSIZE_s,i.scalefac_band.s,A.BLKSIZE_s/384,A.SBMAX_s),v=0,r=0;r<i.npart_s;r++){var M;_=u;p[r]>=s&&(_=d*(p[r]-s)/(24-s)+u*(24-p[r])/(24-s)),g[r]=Math.pow(10,_/10),M=h.MAX_VALUE;for(w=0;w<i.numlines_s[r];w++,v++){var N;O=b*v/(1e3*A.BLKSIZE_s);N=this.ATHformula(1e3*O,o)-20,N=Math.pow(10,.1*N),M>(N*=i.numlines_s[r])&&(M=N)}i.ATH.cb_s[r]=M,M=7*p[r]/12-7,p[r]>12&&(M*=1+3.1*Math.log(1+M)),p[r]<12&&(M*=1+2.3*Math.log(1-M)),M<-15&&(M=-15),M-=8,i.minval_s[r]=Math.pow(10,M/10)*i.numlines_s[r]}i.s3_ss=le(i.s3ind_s,i.npart_s,p,f,g,a),k=Math.pow(10,(C+1)/16),E=Math.pow(10,(T+1)/16),P=Math.pow(10,R/10),e.init_fft(i),i.decay=Math.exp(-1*t/(.01*b/192)),S=3.5,0!=(2&o.exp_nspsytune)&&(S=1),Math.abs(o.msfix)>0&&(S=o.msfix),o.msfix=S;for(var I=0;I<i.npart_l;I++)i.s3ind[I][1]>i.npart_l-1&&(i.s3ind[I][1]=i.npart_l-1);var x=576*i.mode_gr/b;if(i.ATH.decay=Math.pow(10,-1.2*x),i.ATH.adjust=.01,i.ATH.adjustLimit=1,-1!=o.ATHtype){var D=o.out_samplerate/A.BLKSIZE,F=0;for(O=0,r=0;r<A.BLKSIZE/2;++r)O+=D,i.ATH.eql_w[r]=1/Math.pow(10,this.ATHformula(O,o)/10),F+=i.ATH.eql_w[r];for(F=1/F,r=A.BLKSIZE/2;--r>=0;)i.ATH.eql_w[r]*=F}for(I=v=0;I<i.npart_s;++I)for(r=0;r<i.numlines_s[I];++r)++v;for(I=v=0;I<i.npart_l;++I)for(r=0;r<i.numlines_l[I];++r)++v;for(v=0,r=0;r<i.npart_l;r++){O=b*(v+i.numlines_l[r]/2)/(1*A.BLKSIZE);i.mld_cb_l[r]=ce(O),v+=i.numlines_l[r]}for(;r<A.CBANDS;++r)i.mld_cb_l[r]=1;for(v=0,r=0;r<i.npart_s;r++){O=b*(v+i.numlines_s[r]/2)/(1*A.BLKSIZE_s);i.mld_cb_s[r]=ce(O),v+=i.numlines_s[r]}for(;r<A.CBANDS;++r)i.mld_cb_s[r]=1;return 0},this.ATHformula=function(e,t){var o;switch(t.ATHtype){case 0:o=ue(e,9);break;case 1:o=ue(e,-1);break;case 2:o=ue(e,0);break;case 3:o=ue(e,1)+6;break;case 4:o=ue(e,t.ATHcurve);break;default:o=ue(e,0)}return o}}function D(){var e=this;D.V9=410,D.V8=420,D.V7=430,D.V6=440,D.V5=450,D.V4=460,D.V3=470,D.V2=480,D.V1=490,D.V0=500,D.R3MIX=1e3,D.STANDARD=1001,D.EXTREME=1002,D.INSANE=1003,D.STANDARD_FAST=1004,D.EXTREME_FAST=1005,D.MEDIUM=1006,D.MEDIUM_FAST=1007;var t,o,i,a,c;D.LAME_MAXMP3BUFFER=147456;var u,p,h,b=new x;function y(){this.lowerlimit=0}function S(e,t){this.lowpass=t}this.enc=new A,this.setModules=function(e,r,n,s,l,d,f,m,g){t=e,o=r,i=n,a=s,c=l,u=d,f,p=m,h=g,this.enc.setModules(o,b,a,u)};var E=4294479419;function P(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function C(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:return t.version=0,0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0,0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function T(e,t,o){o<16e3&&(t=2);for(var r=w.bitrate_table[t][1],n=2;n<=14;n++)w.bitrate_table[t][n]>0&&Math.abs(w.bitrate_table[t][n]-e)<Math.abs(r-e)&&(r=w.bitrate_table[t][n]);return r}function O(e,t,o){o<16e3&&(t=2);for(var r=0;r<=14;r++)if(w.bitrate_table[t][r]>0&&w.bitrate_table[t][r]==e)return r;return-1}function M(t,o){var r=[new S(8,2e3),new S(16,3700),new S(24,3900),new S(32,5500),new S(40,7e3),new S(48,7500),new S(56,1e4),new S(64,11e3),new S(80,13500),new S(96,15100),new S(112,15600),new S(128,17e3),new S(160,17500),new S(192,18600),new S(224,19400),new S(256,19700),new S(320,20500)],n=e.nearestBitrateFullIndex(o);t.lowerlimit=r[n].lowpass}function N(e){var t=A.BLKSIZE+e.framesize-A.FFTOFFSET;return t=Math.max(t,512+e.framesize-32)}function F(t,o,r,n,i,a){var s=e.enc.lame_encode_mp3_frame(t,o,r,n,i,a);return t.frameNum++,s}function L(){this.n_in=0,this.n_out=0}function U(){this.num_used=0}function j(e,t,o){var r=Math.PI*t;(e/=o)<0&&(e=0),e>1&&(e=1);var n=e-.5,i=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(n)<1e-9?r/Math.PI:i*Math.sin(o*r*n)/(Math.PI*o*n)}function B(e,t,o,r,i,a,s,l,c){var u,d,p=e.internal_flags,f=0,h=e.out_samplerate/function e(t,o){return 0!=o?e(o,t%o):t}(e.out_samplerate,e.in_samplerate);h>I.BPC&&(h=I.BPC);var m=Math.abs(p.resample_ratio-Math.floor(.5+p.resample_ratio))<1e-4?1:0,g=1/p.resample_ratio;g>1&&(g=1);var b=31;0==b%2&&--b;var v=(b+=m)+1;if(0==p.fill_buffer_resample_init){for(p.inbuf_old[0]=n(v),p.inbuf_old[1]=n(v),u=0;u<=2*h;++u)p.blackfilt[u]=n(v);for(p.itime[0]=0,p.itime[1]=0,f=0;f<=2*h;f++){var y=0,_=(f-h)/(2*h);for(u=0;u<=b;u++)y+=p.blackfilt[f][u]=j(u-_,g,b);for(u=0;u<=b;u++)p.blackfilt[f][u]/=y}p.fill_buffer_resample_init=1}var S=p.inbuf_old[c];for(d=0;d<r;d++){var w,k;if(w=d*p.resample_ratio,b+(f=0|Math.floor(w-p.itime[c]))-b/2>=s)break;_=w-p.itime[c]-(f+b%2*.5);k=0|Math.floor(2*_*h+h+.5);var E=0;for(u=0;u<=b;++u){var P=u+f-b/2;E+=(P<0?S[v+P]:i[a+P])*p.blackfilt[k][u]}t[o+d]=E}if(l.num_used=Math.min(s,b+f-b/2),p.itime[c]+=l.num_used-d*p.resample_ratio,l.num_used>=v)for(u=0;u<v;u++)S[u]=i[a+l.num_used+u-v];else{var C=v-l.num_used;for(u=0;u<C;++u)S[u]=S[u+l.num_used];for(f=0;u<v;++u,++f)S[u]=i[a+f]}return d}function V(e,t,o,r,n,i){var a=e.internal_flags;if(a.resample_ratio<.9999||a.resample_ratio>1.0001)for(var s=0;s<a.channels_out;s++){var l=new U;i.n_out=B(e,t[s],a.mf_size,e.framesize,o[s],r,n,l,s),i.n_in=l.num_used}else{i.n_out=Math.min(e.framesize,n),i.n_in=i.n_out;for(var c=0;c<i.n_out;++c)t[0][a.mf_size+c]=o[0][r+c],2==a.channels_out&&(t[1][a.mf_size+c]=o[1][r+c])}}this.lame_init=function(){var e=new function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=g.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null};return 0!=function(e){var t;return e.class_id=E,t=e.internal_flags=new I,e.mode=g.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=m.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=A.ENCDELAY+A.POSTDELAY,e.encoder_padding=0,t.mf_size=A.ENCDELAY-A.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}(e)?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],o=0,r=0,n=0,i=0;i=t[16],n=16,r=t[16],o=16;for(var a=0;a<16;a++)if(Math.max(e,t[a+1])!=e){i=t[a+1],n=a+1,r=t[a],o=a;break}return i-e>e-r?o:n},this.lame_init_params=function(e){var l=e.internal_flags;if(l.Class_ID=0,null==l.ATH&&(l.ATH=new function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=n(A.SBMAX_l),this.s=n(A.SBMAX_s),this.psfb21=n(A.PSFB21),this.psfb12=n(A.PSFB12),this.cb_l=n(A.CBANDS),this.cb_s=n(A.CBANDS),this.eql_w=n(A.BLKSIZE/2)}),null==l.PSY&&(l.PSY=new function(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=n(A.SBMAX_l),this.bo_s_weight=n(A.SBMAX_s)}),null==l.rgdata&&(l.rgdata=new function(){this.linprebuf=n(2*v.MAX_ORDER),this.linpre=0,this.lstepbuf=n(v.MAX_SAMPLES_PER_WINDOW+v.MAX_ORDER),this.lstep=0,this.loutbuf=n(v.MAX_SAMPLES_PER_WINDOW+v.MAX_ORDER),this.lout=0,this.rinprebuf=n(2*v.MAX_ORDER),this.rinpre=0,this.rstepbuf=n(v.MAX_SAMPLES_PER_WINDOW+v.MAX_ORDER),this.rstep=0,this.routbuf=n(v.MAX_SAMPLES_PER_WINDOW+v.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=r(0|v.STEPS_per_dB*v.MAX_dB),this.B=r(0|v.STEPS_per_dB*v.MAX_dB)}),l.channels_in=e.num_channels,1==l.channels_in&&(e.mode=g.MONO),l.channels_out=e.mode==g.MONO?1:2,l.mode_ext=A.MPG_MD_MS_LR,e.mode==g.MONO&&(e.force_ms=!1),e.VBR==m.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==m.vbr_off||e.VBR==m.vbr_mtrh||e.VBR==m.vbr_mt||(e.free_format=!1),e.VBR==m.vbr_off&&0==e.brate&&_.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==m.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*l.channels_out/(1e3*e.compression_ratio),l.samplerate_index=C(e.out_samplerate,e),e.free_format||(e.brate=T(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var S=16e3;switch(e.VBR){case m.vbr_off:M(N=new y,e.brate),S=N.lowerlimit;break;case m.vbr_abr:var N;M(N=new y,e.VBR_mean_bitrate_kbps),S=N.lowerlimit;break;case m.vbr_rh:var I=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var D=I[e.VBR_q],F=I[e.VBR_q+1],L=e.VBR_q_frac;S=linear_int(D,F,L)}else S=19500;break;default:I=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){D=I[e.VBR_q],F=I[e.VBR_q+1],L=e.VBR_q_frac;S=linear_int(D,F,L)}else S=19500}e.mode!=g.MONO||e.VBR!=m.vbr_off&&e.VBR!=m.vbr_abr||(S*=1.5),e.lowpassfreq=0|S}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=function(e,t){var o=44100;return t>=48e3?o=48e3:t>=44100?o=44100:t>=32e3?o=32e3:t>=24e3?o=24e3:t>=22050?o=22050:t>=16e3?o=16e3:t>=12e3?o=12e3:t>=11025?o=11025:t>=8e3&&(o=8e3),-1==e?o:(e<=15960&&(o=44100),e<=15250&&(o=32e3),e<=11220&&(o=24e3),e<=9970&&(o=22050),e<=7230&&(o=16e3),e<=5420&&(o=12e3),e<=4510&&(o=11025),e<=3970&&(o=8e3),t<o?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:o)}(0|e.lowpassfreq,e.in_samplerate)),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==m.vbr_off&&(e.compression_ratio=16*e.out_samplerate*l.channels_out/(1e3*e.brate)),e.VBR==m.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*l.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,l.findPeakSample=!1),l.findReplayGain=e.findReplayGain,l.decode_on_the_fly=e.decode_on_the_fly,l.decode_on_the_fly&&(l.findPeakSample=!0),l.findReplayGain&&t.InitGainAnalysis(l.rgdata,e.out_samplerate)==v.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(l.decode_on_the_fly&&!e.decode_only&&(null!=l.hip&&h.hip_decode_exit(l.hip),l.hip=h.hip_decode_init()),l.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*l.mode_gr,e.encoder_delay=A.ENCDELAY,l.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case m.vbr_mt:case m.vbr_rh:case m.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case m.vbr_abr:e.compression_ratio=16*e.out_samplerate*l.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*l.channels_out/(1e3*e.brate)}if(e.mode==g.NOT_SET&&(e.mode=g.JOINT_STEREO),e.highpassfreq>0?(l.highpass1=2*e.highpassfreq,e.highpasswidth>=0?l.highpass2=2*(e.highpassfreq+e.highpasswidth):l.highpass2=2*e.highpassfreq,l.highpass1/=e.out_samplerate,l.highpass2/=e.out_samplerate):(l.highpass1=0,l.highpass2=0),e.lowpassfreq>0?(l.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(l.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),l.lowpass1<0&&(l.lowpass1=0)):l.lowpass1=2*e.lowpassfreq,l.lowpass1/=e.out_samplerate,l.lowpass2/=e.out_samplerate):(l.lowpass1=0,l.lowpass2=0),function(e){var t=e.internal_flags,o=32,r=-1;if(t.lowpass1>0){for(var n=999,i=0;i<=31;i++)(c=i/31)>=t.lowpass2&&(o=Math.min(o,i)),t.lowpass1<c&&c<t.lowpass2&&(n=Math.min(n,i));t.lowpass1=999==n?(o-.75)/31:(n-.75)/31,t.lowpass2=o/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,d.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){var a=-1;for(i=0;i<=31;i++)(c=i/31)<=t.highpass1&&(r=Math.max(r,i)),t.highpass1<c&&c<t.highpass2&&(a=Math.max(a,i));t.highpass1=r/31,t.highpass2=-1==a?(r+.75)/31:(a+.75)/31}for(i=0;i<32;i++){var s,l,c=i/31;s=t.highpass2>t.highpass1?P((t.highpass2-c)/(t.highpass2-t.highpass1+1e-20)):1,l=t.lowpass2>t.lowpass1?P((c-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[i]=s*l}}(e),l.samplerate_index=C(e.out_samplerate,e),l.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==m.vbr_off){if(e.free_format)l.bitrate_index=0;else if(e.brate=T(e.brate,e.version,e.out_samplerate),l.bitrate_index=O(e.brate,e.version,e.out_samplerate),l.bitrate_index<=0)return e.internal_flags=null,-1}else l.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=l.pinfo&&(e.bWriteVbrTag=!1),o.init_bit_stream_w(l);for(var U,j=l.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),B=0;B<A.SBMAX_l+1;B++)l.scalefac_band.l[B]=a.sfBandIndex[j].l[B];for(B=0;B<A.PSFB21+1;B++){var V=(l.scalefac_band.l[22]-l.scalefac_band.l[21])/A.PSFB21,H=l.scalefac_band.l[21]+B*V;l.scalefac_band.psfb21[B]=H}l.scalefac_band.psfb21[A.PSFB21]=576;for(B=0;B<A.SBMAX_s+1;B++)l.scalefac_band.s[B]=a.sfBandIndex[j].s[B];for(B=0;B<A.PSFB12+1;B++){V=(l.scalefac_band.s[13]-l.scalefac_band.s[12])/A.PSFB12,H=l.scalefac_band.s[12]+B*V;l.scalefac_band.psfb12[B]=H}for(l.scalefac_band.psfb12[A.PSFB12]=192,1==e.version?l.sideinfo_len=1==l.channels_out?21:36:l.sideinfo_len=1==l.channels_out?13:21,e.error_protection&&(l.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&p.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=s([16,5]),t.bitrate_blockType_Hist=s([16,6]),t.PeakSample=0,e.bWriteVbrTag&&u.InitVbrTag(e)}(e),l.Class_ID=E,U=0;U<19;U++)l.nsPsy.pefirbuf[U]=700*l.mode_gr*l.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),e.VBR){case m.vbr_mt:e.VBR=m.vbr_mtrh;case m.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),i.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),l.PSY.mask_adjust=e.maskingadjust,l.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?l.sfb21_extra=!1:l.sfb21_extra=e.out_samplerate>44e3,l.iteration_loop=new VBRNewIterationLoop(c);break;case m.vbr_rh:i.apply_preset(e,500-10*e.VBR_q,0),l.PSY.mask_adjust=e.maskingadjust,l.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?l.sfb21_extra=!1:l.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),l.iteration_loop=new VBROldIterationLoop(c);break;default:var G;l.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(G=e.VBR)==m.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),i.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=G,l.PSY.mask_adjust=e.maskingadjust,l.PSY.mask_adjust_short=e.maskingadjust_short,G==m.vbr_off?l.iteration_loop=new function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,o,i){var a,s=e.internal_flags,l=n(R.SFBMAX),c=n(576),u=r(2),d=0,p=s.l3_side,f=new k(d);this.quantize.rv.ResvFrameBegin(e,f),d=f.bits;for(var h=0;h<s.mode_gr;h++){a=this.quantize.qupvt.on_pe(e,t,u,d,h,h),s.mode_ext==A.MPG_MD_MS_LR&&(this.quantize.ms_convert(s.l3_side,h),this.quantize.qupvt.reduce_side(u,o[h],d,a));for(var m=0;m<s.channels_out;m++){var g,b,v=p.tt[h][m];v.block_type!=A.SHORT_TYPE?(g=0,b=s.PSY.mask_adjust-g):(g=0,b=s.PSY.mask_adjust_short-g),s.masking_lower=Math.pow(10,.1*b),this.quantize.init_outer_loop(s,v),this.quantize.init_xrpow(s,v,c)&&(this.quantize.qupvt.calc_xmin(e,i[h][m],v,l),this.quantize.outer_loop(e,v,l,c,m,u[m])),this.quantize.iteration_finish_one(s,h,m)}}this.quantize.rv.ResvFrameEnd(s,d)}}(c):l.iteration_loop=new ABRIterationLoop(c)}if(e.VBR!=m.vbr_off){if(l.VBR_min_bitrate=1,l.VBR_max_bitrate=14,e.out_samplerate<16e3&&(l.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=T(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),l.VBR_min_bitrate=O(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),l.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=T(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),l.VBR_max_bitrate=O(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),l.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=w.bitrate_table[e.version][l.VBR_min_bitrate],e.VBR_max_bitrate_kbps=w.bitrate_table[e.version][l.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(w.bitrate_table[e.version][l.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(w.bitrate_table[e.version][l.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(l.PSY.mask_adjust+=e.tune_value_a,l.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),e.athaa_type<0?l.ATH.useAdjust=3:l.ATH.useAdjust=e.athaa_type,l.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=f.short_block_allowed),e.short_blocks!=f.short_block_allowed||e.mode!=g.JOINT_STEREO&&e.mode!=g.STEREO||(e.short_blocks=f.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=x.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=x.NSATTACKTHRE_S),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),l.slot_lag=l.frac_SpF=0,e.VBR==m.vbr_off&&(l.slot_lag=l.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),a.iteration_init(e),b.psymodel_init(e),0},this.lame_encode_flush=function(e,t,r,n){var i,a,s,c,u=e.internal_flags,d=l([2,1152]),f=0,h=u.mf_samples_to_encode-A.POSTDELAY,m=N(e);if(u.mf_samples_to_encode<1)return 0;for(i=0,e.in_samplerate!=e.out_samplerate&&(h+=16*e.out_samplerate/e.in_samplerate),(s=e.framesize-h%e.framesize)<576&&(s+=e.framesize),e.encoder_padding=s,c=(h+s)/e.framesize;c>0&&f>=0;){var g=m-u.mf_size,b=e.frameNum;g*=e.in_samplerate,(g/=e.out_samplerate)>1152&&(g=1152),g<1&&(g=1),a=n-i,0==n&&(a=0),r+=f=this.lame_encode_buffer(e,d[0],d[1],g,t,r,a),i+=f,c-=b!=e.frameNum?1:0}if(u.mf_samples_to_encode=0,f<0)return f;if(a=n-i,0==n&&(a=0),o.flush_bitstream(e),(f=o.copy_buffer(u,t,r,a,1))<0)return f;if(r+=f,a=n-(i+=f),0==n&&(a=0),e.write_id3tag_automatic){if(p.id3tag_write_v1(e),(f=o.copy_buffer(u,t,r,a,0))<0)return f;i+=f}return i},this.lame_encode_buffer=function(e,r,i,a,s,l,c){var u=e.internal_flags,d=[null,null];if(u.Class_ID!=E)return-3;if(0==a)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=n(t),e.in_buffer_1=n(t),e.in_buffer_nsamples=t)}(u,a),d[0]=u.in_buffer_0,d[1]=u.in_buffer_1;for(var p=0;p<a;p++)d[0][p]=r[p],u.channels_in>1&&(d[1][p]=i[p]);return function(e,r,n,i,a,s,l){var c,u,d,p,f,h=e.internal_flags,m=0,g=[null,null],b=[null,null];if(h.Class_ID!=E)return-3;if(0==i)return 0;if((f=o.copy_buffer(h,a,s,l,0))<0)return f;if(s+=f,m+=f,b[0]=r,b[1]=n,_.NEQ(e.scale,0)&&_.NEQ(e.scale,1))for(u=0;u<i;++u)b[0][u]*=e.scale,2==h.channels_out&&(b[1][u]*=e.scale);if(_.NEQ(e.scale_left,0)&&_.NEQ(e.scale_left,1))for(u=0;u<i;++u)b[0][u]*=e.scale_left;if(_.NEQ(e.scale_right,0)&&_.NEQ(e.scale_right,1))for(u=0;u<i;++u)b[1][u]*=e.scale_right;if(2==e.num_channels&&1==h.channels_out)for(u=0;u<i;++u)b[0][u]=.5*(b[0][u]+b[1][u]),b[1][u]=0;p=N(e),g[0]=h.mfbuf[0],g[1]=h.mfbuf[1];var y=0;for(;i>0;){var S=[null,null],w=0,k=0;S[0]=b[0],S[1]=b[1];var P=new L;if(V(e,g,S,y,i,P),w=P.n_in,k=P.n_out,h.findReplayGain&&!h.decode_on_the_fly&&t.AnalyzeSamples(h.rgdata,g[0],h.mf_size,g[1],h.mf_size,k,h.channels_out)==v.GAIN_ANALYSIS_ERROR)return-6;if(i-=w,y+=w,h.channels_out,h.mf_size+=k,h.mf_samples_to_encode<1&&(h.mf_samples_to_encode=A.ENCDELAY+A.POSTDELAY),h.mf_samples_to_encode+=k,h.mf_size>=p){var C=l-m;if(0==l&&(C=0),(c=F(e,g[0],g[1],a,s,C))<0)return c;for(s+=c,m+=c,h.mf_size-=e.framesize,h.mf_samples_to_encode-=e.framesize,d=0;d<h.channels_out;d++)for(u=0;u<h.mf_size;u++)g[d][u]=g[d][u+e.framesize]}}return m}(e,d[0],d[1],a,s,l,c)}}function F(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function L(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}R.SFBMAX=3*A.SBMAX_s,A.ENCDELAY=576,A.POSTDELAY=1152,A.MDCTDELAY=48,A.FFTOFFSET=224+A.MDCTDELAY,A.DECDELAY=528,A.SBLIMIT=32,A.CBANDS=64,A.SBPSY_l=21,A.SBPSY_s=12,A.SBMAX_l=22,A.SBMAX_s=13,A.PSFB21=6,A.PSFB12=6,A.BLKSIZE=1024,A.HBLKSIZE=A.BLKSIZE/2+1,A.BLKSIZE_s=256,A.HBLKSIZE_s=A.BLKSIZE_s/2+1,A.NORM_TYPE=0,A.START_TYPE=1,A.SHORT_TYPE=2,A.STOP_TYPE=3,A.MPG_MD_LR_LR=0,A.MPG_MD_LR_I=1,A.MPG_MD_MS_LR=2,A.MPG_MD_MS_I=3,A.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5],I.MFSIZE=3456+A.ENCDELAY-A.MDCTDELAY,I.MAX_HEADER_BUF=256,I.MAX_BITS_PER_CHANNEL=4095,I.MAX_BITS_PER_GRANULE=7680,I.BPC=320,F.RIFF=L("RIFF"),F.WAVE=L("WAVE"),F.fmt_=L("fmt "),F.data=L("data"),F.readHeader=function(e){var t=new F,o=e.getUint32(0,!1);if(F.RIFF==o){e.getUint32(4,!0);if(F.WAVE==e.getUint32(8,!1)&&F.fmt_==e.getUint32(12,!1)){var r=e.getUint32(16,!0),n=20;switch(r){case 16:case 18:t.channels=e.getUint16(n+2,!0),t.sampleRate=e.getUint32(n+4,!0);break;default:throw"extended fmt chunk not implemented"}n+=r;for(var i=F.data,a=0;i!=o&&(o=e.getUint32(n,!1),a=e.getUint32(n+4,!0),i!=o);)n+=a+8;return t.dataLen=a,t.dataOffset=n+8,t}}},R.SFBMAX=3*A.SBMAX_s,o.Mp3Encoder=function(t,o,r){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,o=44100,r=128);var n=new D,i=new function(){this.setModules=function(e,t){}},a=new v,s=new _,l=new function(){function e(e,t,o,r,n,i,a,s,l,c,u,d,p,f,h){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=o,this.expY=r,this.st_lrm=n,this.st_s=i,this.masking_adj=a,this.masking_adj_short=s,this.ath_lower=l,this.ath_curve=c,this.ath_sensitivity=u,this.interch=d,this.safejoint=p,this.sfb21mod=f,this.msfix=h}function t(e,t,o,r,n,i,a,s,l,c,u,d,p,f){this.quant_comp=t,this.quant_comp_s=o,this.safejoint=r,this.nsmsfix=n,this.st_lrm=i,this.st_s=a,this.nsbass=s,this.scale=l,this.masking_adj=c,this.ath_lower=u,this.ath_curve=d,this.interch=p,this.sfscale=f}var o;this.setModules=function(e){o=e};var r=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],n=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function i(e,t,o){var i=e.VBR==m.vbr_rh?r:n,a=e.VBR_q_frac,s=i[t],l=i[t+1],c=s;s.st_lrm=s.st_lrm+a*(l.st_lrm-s.st_lrm),s.st_s=s.st_s+a*(l.st_s-s.st_s),s.masking_adj=s.masking_adj+a*(l.masking_adj-s.masking_adj),s.masking_adj_short=s.masking_adj_short+a*(l.masking_adj_short-s.masking_adj_short),s.ath_lower=s.ath_lower+a*(l.ath_lower-s.ath_lower),s.ath_curve=s.ath_curve+a*(l.ath_curve-s.ath_curve),s.ath_sensitivity=s.ath_sensitivity+a*(l.ath_sensitivity-s.ath_sensitivity),s.interch=s.interch+a*(l.interch-s.interch),s.msfix=s.msfix+a*(l.msfix-s.msfix),function(e,t){0>t&&(t=0),9<t&&(t=9),e.VBR_q=t,e.VBR_q_frac=0}(e,c.vbr_q),0!=o?e.quant_comp=c.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=c.quant_comp),0!=o?e.quant_comp_short=c.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=c.quant_comp_s),0!=c.expY&&(e.experimentalY=0!=c.expY),0!=o?e.internal_flags.nsPsy.attackthre=c.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=c.st_lrm),0!=o?e.internal_flags.nsPsy.attackthre_s=c.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=c.st_s),0!=o?e.maskingadjust=c.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=c.masking_adj),0!=o?e.maskingadjust_short=c.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=c.masking_adj_short),0!=o?e.ATHlower=-c.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-c.ath_lower/10),0!=o?e.ATHcurve=c.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=c.ath_curve),0!=o?e.athaa_sensitivity=c.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(0!=o?e.interChRatio=c.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=c.interch)),c.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|c.sfb21mod<<20),0!=o?e.msfix=c.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=c.msfix),0==o&&(e.VBR_q=t,e.VBR_q_frac=a)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function s(e,t,r){var n=t,i=o.nearestBitrateFullIndex(t);if(e.VBR=m.vbr_abr,e.VBR_mean_bitrate_kbps=n,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),a[i].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),a[i].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(a[i].nsbass)>0){var s=int(4*a[i].nsbass);s<0&&(s+=64),e.exp_nspsytune=e.exp_nspsytune|s<<2}return 0!=r?e.quant_comp=a[i].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=a[i].quant_comp),0!=r?e.quant_comp_short=a[i].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=a[i].quant_comp_s),0!=r?e.msfix=a[i].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=a[i].nsmsfix),0!=r?e.internal_flags.nsPsy.attackthre=a[i].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=a[i].st_lrm),0!=r?e.internal_flags.nsPsy.attackthre_s=a[i].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=a[i].st_s),0!=r?e.scale=a[i].scale:Math.abs(e.scale- -1)>0||(e.scale=a[i].scale),0!=r?e.maskingadjust=a[i].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=a[i].masking_adj),a[i].masking_adj>0?0!=r?e.maskingadjust_short=.9*a[i].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*a[i].masking_adj):0!=r?e.maskingadjust_short=1.1*a[i].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*a[i].masking_adj),0!=r?e.ATHlower=-a[i].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-a[i].ath_lower/10),0!=r?e.ATHcurve=a[i].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=a[i].ath_curve),0!=r?e.interChRatio=a[i].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=a[i].interch),t}this.apply_preset=function(e,t,o){switch(t){case D.R3MIX:t=D.V3,e.VBR=m.vbr_mtrh;break;case D.MEDIUM:t=D.V4,e.VBR=m.vbr_rh;break;case D.MEDIUM_FAST:t=D.V4,e.VBR=m.vbr_mtrh;break;case D.STANDARD:t=D.V2,e.VBR=m.vbr_rh;break;case D.STANDARD_FAST:t=D.V2,e.VBR=m.vbr_mtrh;break;case D.EXTREME:t=D.V0,e.VBR=m.vbr_rh;break;case D.EXTREME_FAST:t=D.V0,e.VBR=m.vbr_mtrh;break;case D.INSANE:return t=320,e.preset=t,s(e,t,o),e.VBR=m.vbr_off,t}switch(e.preset=t,t){case D.V9:return i(e,9,o),t;case D.V8:return i(e,8,o),t;case D.V7:return i(e,7,o),t;case D.V6:return i(e,6,o),t;case D.V5:return i(e,5,o),t;case D.V4:return i(e,4,o),t;case D.V3:return i(e,3,o),t;case D.V2:return i(e,2,o),t;case D.V1:return i(e,1,o),t;case D.V0:return i(e,0,o),t}return 8<=t&&t<=320?s(e,t,o):(e.preset=0,t)}},c=new C,u=new O,d=new y,p=new function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},f=new function(){this.setModules=function(e,t){}},h=new function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,o){var r,n=t.internal_flags,i=n.l3_side,a=e.getframebits(t);o.bits=(a-8*n.sideinfo_len)/n.mode_gr;var s=2048*n.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=r-a,n.ResvMax>s&&(n.ResvMax=s),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var l=o.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return l>r&&(l=r),i.resvDrain_pre=0,null!=n.pinfo&&(n.pinfo.mean_bits=o.bits/2,n.pinfo.resvsize=n.ResvSize),l},this.ResvMaxBits=function(e,t,o,r){var n,i=e.internal_flags,a=i.ResvSize,s=i.ResvMax;0!=r&&(a+=t),0!=(1&i.substep_shaping)&&(s*=.9),o.bits=t,10*a>9*s?(n=a-9*s/10,o.bits+=n,i.substep_shaping|=128):(n=0,i.substep_shaping&=127,e.disable_reservoir||0!=(1&i.substep_shaping)||(o.bits-=.1*t));var l=a<6*i.ResvMax/10?a:6*i.ResvMax/10;return(l-=n)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var o,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var n=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(o=e.ResvSize%8)&&(n+=o),(o=e.ResvSize-n-e.ResvMax)>0&&(n+=o);var i=Math.min(8*r.main_data_begin,n)/8;r.resvDrain_pre+=8*i,n-=8*i,e.ResvSize-=8*i,r.main_data_begin-=i,r.resvDrain_post+=n,e.ResvSize-=n}},S=new b,w=new function(){this.setModules=function(e,t,o){}},k=new function(){};n.setModules(a,s,l,c,u,d,p,f,k),s.setModules(a,k,p,d),f.setModules(s,p),l.setModules(n),u.setModules(s,h,c,S),c.setModules(S,h,n.enc.psy),h.setModules(s),S.setModules(c),d.setModules(n,s,p),i.setModules(w,k),w.setModules(p,f,l);var E=n.lame_init();E.num_channels=t,E.in_samplerate=o,E.brate=r,E.mode=g.STEREO,E.quality=3,E.bWriteVbrTag=!1,E.disable_reservoir=!0,E.write_id3tag_automatic=!1,n.lame_init_params(E);var P=1152,T=0|1.25*P+7200,R=e(T);this.encodeBuffer=function(o,r){1==t&&(r=o),o.length>P&&(P=o.length,R=e(T=0|1.25*P+7200));var i=n.lame_encode_buffer(E,o,r,o.length,R,0,T);return new Int8Array(R.subarray(0,i))},this.flush=function(){var e=n.lame_encode_flush(E,R,0,T);return new Int8Array(R.subarray(0,e))}},o.WavHeader=F}o(),e.exports=o},function(e,t,o){"use strict";o(405),o(459),o(460),o(464),o(465),o(466),o(467),o(468),o(469),o(100),o(617),o(618),o(54),o(619),o(620),o(623),o(217),o(629),o(1126),o(1127),o(1130),o(1140),o(1141),o(1144),o(296),o(297),o(1145),o(1146),o(1152),o(1155),o(1156),o(1157),o(1158),o(1159),o(1160),o(1162),o(1163),o(1164),o(1165),o(1166),o(1167),o(1168),o(1169),o(1170),o(1171)},function(e,t,o){"use strict";var r=y(o(4)),n=y(o(406)),i=o(3),a=y(o(246)),s=y(o(58)),l=y(o(96)),c=y(o(450)),u=y(o(452)),d=y(o(454)),p=y(o(456)),f=o(5),h=o(8),m=y(o(262)),g=(o(94),o(2)),b=o(0),v=y(o(32));function y(e){return e&&e.__esModule?e:{default:e}}Noteflight.ChangePasswordDialog=function(e,t){var o=this;i.DialogViewModel.call(o),o.success=ko.observable(!1),o.forceReset=ko.observable(e),o.password=ko.observable(""),o.newPassword=ko.observable(""),o.newPassword2=ko.observable(""),o.busy=ko.observable(!1),o.errorsReporter=new s.default,o.show=function(){(0,i.createAndShowDialog)({viewModel:o,templateName:"dialogs/changePassword"})},o.cancel=function(){(0,i.hideCurrentDialog)(),t&&t(o.success())},o.passwordChanged=function(){o.success(!0),o.busy(!1)},o.changePassword=function(){var e=!1;o.errorsReporter.clearErrors(),o.newPassword()!=o.newPassword2()&&(o.errorsReporter.addError({code:"errors.passwordsMustMatch",message:(0,b.resource)("errors.passwordsMustMatch")}),e=!0),o.newPassword().length<h.MIN_PASSWORD_LENGTH&&(o.errorsReporter.addError({code:"errors.passwordTooShort",message:(0,b.resource)("errors.passwordTooShort",h.MIN_PASSWORD_LENGTH)}),e=!0),o.newPassword().length>h.MAX_PASSWORD_LENGTH&&(o.errorsReporter.addError({code:"errors.passwordTooLong",message:(0,b.resource)("errors.passwordTooLong",h.MAX_PASSWORD_LENGTH)}),e=!0),e||(o.busy(!0),NF.apiService.changePasswordService((0,b.resource)("action.updating"),o.passwordChanged,{password:o.password(),to_password:o.newPassword()}))},o.password.subscribe(function(){r.default.publish(f.REPORTER_CLEAR_ERRORS)}),o.newPassword.subscribe(function(){r.default.publish(f.REPORTER_CLEAR_ERRORS)}),o.newPassword2.subscribe(function(){r.default.publish(f.REPORTER_CLEAR_ERRORS)})},Noteflight.EditIdentityViewModel=function(){var e=this;if(e.session=Noteflight.session,e.session.current_user()){var t=e.session.current_user();e.email=ko.observable(t.email()),e.userName=ko.observable(t.identified()?t.username():""),e.password=ko.observable("password")}e.updateCurrentUser=function(t){e.session.current_user().update(t.user)},e.handleKeyUp=function(e,t){"13"!=t.keyCode&&r.default.publish(f.REPORTER_CLEAR_ERRORS)},e.updateProfile=function(){r.default.publish(f.REPORTER_CLEAR_ERRORS);var t=!1;e.userName().trim()||(r.default.publish(f.REPORTER_ADD_ERROR,{code:"userNameRequired",message:(0,b.resource)("errors.userNameRequired")}),$("#userName").focus(),t=!0),t||NF.apiService.editProfile((0,b.resource)("account.savingInfo"),e.updateCurrentUser,{user:{username:e.session.current_user().identified()?null:e.userName().trim().replace(/ +/g," "),user_id:e.session.current_user().external_id()}},{})},e.showDeleteAccountDialog=function(){(new DeleteAccountDialog).show()}},Noteflight.AccountViewModel=function(){var e=this;if(e.session=Noteflight.session,e.templateName=ko.observable("content/account"),e.state=ko.observable(),e.ready=ko.observable(!1),e.busy=ko.observable(!1),e.currentListing=null,e.hasPayoutProblems=ko.observable(!1),e.siteNavigator=g.siteNavigator,Noteflight.GenericPageViewModel.call(e),e.userId=ko.observable(),e.user=ko.observable(),e.loaded=ko.observable(!1),e.accountInfo=ko.observable(),e.gotAccountInfoService=function(t){e.loaded(!0),e.accountInfo(t.account_info),e.busy(!1)},e.stateViewModelMap={accountDetails:new l.default,editProfile:new a.default(e),viewStatus:new Noteflight.AccountStatusViewModel(e),deleteAccount:new Noteflight.EditIdentityViewModel},!NF.roles.isSite()){var t={sellingSetup:new p.default,sellingPayoutDestinationSetup:new c.default,sellingSetupLanding:new d.default,sellingPayouts:new u.default,customerWallet:new n.default};e.stateViewModelMap=Object.assign({},e.stateViewModelMap,t)}e.processUserData=function(t){e.user(new Noteflight.User(t.user)),e.stateViewModelMap.editProfile.setUser(e.user())},e.init=function(){NF.checkUserVerified((0,b.resource)("action.editAccount")),e.checkPayoutProblems()},e.onNavigate=function(){e.userId()?e.user()||NF.apiService.getUserService((0,b.resource)("action.loading"),e.processUserData,{user_id:e.userId()},{}):e.loaded()||e.busy()||(e.busy(!0),NF.apiService.accountInfoService((0,b.resource)("action.loading"),e.gotAccountInfoService),NF.apiService.paymentContextService(e,e.paymentInfoReceived)),NF.IsPhoneLayout()||"root"==e.state()&&(e.session.current_user().verified()?e.state("accountDetails"):e.state("viewStatus")),e.stateViewModelMap[e.state()]&&(e.currentListing=e.stateViewModelMap[e.state()],e.currentListing.activate&&e.currentListing.activate()),e.ready(!0)},e.checkCanSellScores=function(){return!!NF.session.current_user().premium_member()||((0,v.default)((0,b.resource)("account.marketplaceSelling"),(0,b.resource)("action.sellScores"),"marketplace_selling",{cancelPath:NF.paths.accountDetails()}),!1)},e.checkPayoutProblems=function(){NF.session.current_user()&&NF.session.current_user().has_seller_account()&&NF.session.community().default_community()&&NF.apiService.checkSellerPayoutDestinationStatus("",function(t){var o=t.error_codes.filter(function(e){return m.default.includes(e)});e.hasPayoutProblems(!!o.length)})},e.pathForSellingSetup=ko.computed(function(){return e.session.current_user().has_seller_account()?(0,g.path)("sellingSetupLanding"):(0,g.path)("sellingSetup")});var o={accountDetails:"account.accountDetails",adminIdentity:"account.identity",editProfile:"account.editProfile",viewStatus:"account.status",sellingSetup:"account.sellingSetupVerbose",customerWallet:"account.wallet",sellingPayoutDestinationSetup:"account.sellingSetupVerbose",sellingSetupLanding:"account.sellingSetupVerbose",sellingPayouts:"account.payouts"};e.title=ko.computed(function(){var t=o[e.state()];if(t)return(0,b.resource)(t)}),e.showSellerFeatures=ko.computed(function(){return NF.session.showSellerFeatures()}),e.paymentInfoReceived=function(t){e.stateViewModelMap.viewStatus.data(t)},e.onScroll=function(t,o){e.currentListing.onScroll&&e.currentListing.onScroll(t,o)}},(0,g.addRoute)("viewStatusDefault","/account#",Noteflight.AccountViewModel,{ready:!1,state:"viewStatus"}),(0,g.addRoute)("accountDetails","/account#/details",Noteflight.AccountViewModel,{ready:!1,state:"root"}),(0,g.addRoute)("sellingSetupLandingRedirection","/selling_setup_landing#",Noteflight.AccountViewModel,{state:"root"}),(0,g.addRoute)("editIdentity","/account#/edit_identity",Noteflight.AccountViewModel,{ready:!1,state:"editIdentity"}),(0,g.addRoute)("adminIdentity","/account/{userId}#/edit_identity",Noteflight.AccountViewModel,{ready:!1,state:"adminIdentity"}),(0,g.addRoute)("editProfile","/account#/edit_profile",Noteflight.AccountViewModel,{ready:!1,state:"editProfile"}),(0,g.addRouteAlias)("r2","editProfile","/users/edit_profile#"),(0,g.addRoute)("adminProfile","/account/{userId}#/edit_profile",Noteflight.AccountViewModel,{ready:!1,state:"editProfile"}),(0,g.addRoute)("viewStatus","/account#/view_status",Noteflight.AccountViewModel,{ready:!1,state:"viewStatus"}),(0,g.addRouteAlias)("r2","viewStatus","/commerce/my_account#"),(0,g.addRoute)("sellingSetupLanding","/account#/selling_setup_landing",Noteflight.AccountViewModel,{ready:!1,state:"sellingSetupLanding"}),(0,g.addRouteAlias)("r2","sellingSetupLanding","/account/selling_setup_landing#"),(0,g.addRoute)("sellingSetup","/account#/selling_setup",Noteflight.AccountViewModel,{ready:!1,state:"sellingSetup"}),(0,g.addRouteAlias)("r2","sellingSetup","/account/selling_setup#"),(0,g.addRoute)("sellingPayoutDestinationSetup","/account#/selling_payout_destination_setup",Noteflight.AccountViewModel,{ready:!1,state:"sellingPayoutDestinationSetup"}),(0,g.addRoute)("sellingPayouts","account#/selling_payouts",Noteflight.AccountViewModel,{ready:!1,state:"sellingPayouts"}),(0,g.addRoute)("customerWallet","/account#/wallet",Noteflight.AccountViewModel,{ready:!1,state:"customerWallet"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(5),n=(o(94),o(0)),i=d(o(4)),a=d(o(242)),s=d(o(244)),l=d(o(245)),c=d(o(193)),u=o(3);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.customerCardDisplay=new l.default,this.customerCardEditForm=new a.default(new c.default),this.showCardForm=ko.observable(!1),this.ready=ko.observable(!1),this.busy=ko.observable(!1),this.saveButton=ko.computed(function(){return t.customerCardEditForm.customerCard.id()?(0,n.resource)("action.updateCard"):(0,n.resource)("action.saveCard")}),this._markReady=this._markReady.bind(this),this._markUnbusy=this._markUnbusy.bind(this),this._initializeSubscriptions()}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"_initializeSubscriptions",value:function(){var e=this;i.default.subscribe(r.CUSTOMER_CARDS_RETRIEVED,this._markReady),i.default.subscribe(r.CUSTOMER_CARD_UPDATED,function(t,o){e.customerCardDisplay.replaceCard(e.customerCardEditForm.customerCard.id(),o.card),e._markUnbusy(),e.showCardForm(!1)}),i.default.subscribe(r.CUSTOMER_CARD_CREATED,function(t,o){e.customerCardDisplay.addExistingCard(o.card),e._markUnbusy(),e.showCardForm(!1)}),i.default.subscribe(r.CUSTOMER_CARD_UPDATE_FAILED,this._markUnbusy),i.default.subscribe(r.CUSTOMER_CARD_CREATION_FAILED,this._markUnbusy),i.default.subscribe(r.REPORTER_ADD_ERRORS,this._markUnbusy),i.default.subscribe(r.CUSTOMER_CARD_DELETED,function(t,o){e.customerCardDisplay.deleteCard(o)})}},{key:"_markReady",value:function(){this.ready(!0)}},{key:"_markBusy",value:function(){this.busy(!0)}},{key:"_markUnbusy",value:function(){this.busy(!1)}},{key:"addCard",value:function(){this.customerCardEditForm=new a.default(new c.default),this.showCardForm(!0)}},{key:"editCard",value:function(e,t){this.customerCardEditForm=new a.default(t),this.showCardForm(!0)}},{key:"deleteCard",value:function(e,t){var o=t.clone();o.showButtons(!1),(0,u.createAndShowDialog)({viewModel:new s.default(o),templateName:"dialogs/deleteCustomerCard"})}},{key:"initializeForm",value:function(){this.customerCardDisplay.retrieveCards()}},{key:"doOk",value:function(){i.default.publish(r.REPORTER_CLEAR_ERRORS),this._markBusy(),this.customerCardEditForm.uploadCard()}},{key:"cancel",value:function(){this.showCardForm(!1)}}]),e}();t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(94);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=ko.observable(""),this.address1=ko.observable(""),this.address2=ko.observable(""),this.city=ko.observable(""),this.postalCode=ko.observable(""),this.state=ko.observable(""),this.country=ko.observable(""),this.showStatesDropdown=ko.computed(function(){return"US"==t.country()||"CA"==t.country()}),this.statesDropdown=ko.computed(function(){return"US"==t.country()?n.usStatesPlusPR:"CA"==t.country()?n.canadaStates:null})}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"setAddress",value:function(e){this.name(e.name),this.address1(e.line1),this.address2(e.line2),this.city(e.city),this.postalCode(e.postal_code),this.state(e.state),this.country(e.country)}},{key:"validate",value:function(){var e=[];return(!this.name()||this.name().length<1)&&e.push({code:"missingName",message:(0,r.resource)("errors.missingName")}),e=e.concat(this.validateAddress())}},{key:"validateAddress",value:function(){var e=[];return(!this.address1()||this.address1().length<1||!this.city()||this.city().length<1||!this.state()||this.state().length<2||!this.country()||this.country().length<2||!this.postalCode()||this.postalCode().length<5&&"US"==this.country())&&e.push({code:"invalidAddress",message:(0,r.resource)("errors.invalidAddress")}),e}},{key:"clone",value:function(){var t=new e;return t.name(this.name()),t.address1(this.address1()),t.address2(this.address2()),t.city(this.city()),t.postalCode(this.postalCode()),t.state(this.state()),t.country(this.country()),t}}]),e}();t.default=a},function(e,t,o){e.exports=o(7)(589)},function(e,t,o){e.exports=o(7)(693)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(76),a=o(51),s=m(o(411)),l=o(195),c=m(o(412)),u=m(o(426)),d=m(o(435)),p=m(o(436)),f=m(o(442)),h=m(o(445));function m(e){return e&&e.__esModule?e:{default:e}}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,y(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,r.Component),function(e,t,o){t&&b(e.prototype,t),o&&b(e,o)}(t,[{key:"render",value:function(){return r.default.createElement(n.Provider,{store:this.props.store},r.default.createElement("div",{className:"noteflightReact"},r.default.createElement(a.ConnectedRouter,{history:this.props.history},r.default.createElement(l.ConnectedSwitch,null,r.default.createElement(i.Route,{exact:!0,path:"/marketplace",component:c.default}),r.default.createElement(i.Route,{path:"/marketplace/search",component:u.default}),r.default.createElement(i.Route,{exact:!0,path:"/marketplace/song_catalog",component:f.default}),r.default.createElement(i.Route,{exact:!0,path:"/collection/:id",component:d.default}),r.default.createElement(i.Route,{exact:!0,path:"/account",component:p.default}),r.default.createElement(i.Route,{exact:!0,path:"/community",component:h.default}),r.default.createElement(i.Route,{path:"*",component:s.default})))))}}]),t}();t.default=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("div",{className:"noMatch"},"The page you were looking for doesn't exist.")}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Marketplace=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=_(o(4));o(413);var a=o(97),s=_(o(249)),l=_(o(98)),c=_(o(250)),u=_(o(419)),d=_(o(420)),p=_(o(422)),f=o(0),h=o(2),m=o(6),g=_(o(256)),b=_(o(423)),v=o(19),y=o(5);function _(e){return e&&e.__esModule?e:{default:e}}function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var C=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?P(e):t}(this,k(t).call(this,e))).state={filterOpen:!(0,v.isPhoneLayoutOrSmaller)()},o._carouselSelector=null,o.handleTabClick=o.handleTabClick.bind(P(P(o))),o.startCarouselMovement=o.startCarouselMovement.bind(P(P(o))),o.handleScrollLeft=o.handleScrollLeft.bind(P(P(o))),o.handleScrollRight=o.handleScrollRight.bind(P(P(o))),i.default.subscribe(y.FILTER_TOGGLE,function(e,t){o.setState({filterOpen:t.open})}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,r.Component),function(e,t,o){t&&w(e.prototype,t),o&&w(e,o)}(t,[{key:"handleTabClick",value:function(e){this.props.setCurrentTab(e)}},{key:"componentDidMount",value:function(){this.props.getCarousel(),this.props.getTabs(),this.startCarouselMovement();var e={term:"",max_count:36,start_index:0};this.props.search(e)}},{key:"moveCarouselRight",value:function(){this.carouselSelector.slick("slickNext")}},{key:"moveCarouselLeft",value:function(){this.carouselSelector.slick("slickPrev")}},{key:"handleBrowseClick",value:function(){m.NF.analytics.trackEvent("Marketplace","browseAllScoresButton"),(0,h.navigate)((0,h.path)("marketplaceSearch"))}},{key:"handleScrollLeft",value:function(){this.moveCarouselLeft()}},{key:"handleScrollRight",value:function(){this.moveCarouselRight()}},{key:"startCarouselMovement",value:function(){0!=this.props.carouselCollections.length?(this.carouselSelector.slick({dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:1e4}),this.carouselSelector.on("beforeChange",this.handleBeforeCarouselMovement),this.carouselSelector.on("afterChange",this.handleAfterCarouselMovement)):setTimeout(this.startCarouselMovement,200)}},{key:"navigateToAllScores",value:function(){(0,h.navigate)((0,h.path)("marketplaceSearch"))}},{key:"renderTabs",value:function(){var e=this;return this.props.tabs.map(function(t){var o=e.props.currentTabId==t.id;return r.default.createElement(s.default,{key:t.id,id:t.id,name:t.name,selected:o,clickHandler:e.handleTabClick})})}},{key:"renderCarousel",value:function(){var e=this.props.carouselCollections.map(function(e,t){var o="/collections/image/".concat(e.id);return r.default.createElement("div",{key:e.id,onClick:function(){(0,h.navigate)((0,h.path)("collectionPage",{id:e.id}))},className:"carouselItem"},r.default.createElement("div",{className:"carouselImage carouselImage".concat(t),style:{backgroundImage:"url("+o+")"}},r.default.createElement("div",{className:"textContainer"},r.default.createElement("label",{className:"marketplaceTitle"},e.name),r.default.createElement("label",{className:"marketplaceDescription"},e.description))))});return r.default.createElement("div",{className:"carouselContainer"},r.default.createElement("div",{className:"allCarouselItemsContainer"},e),(0,v.isMobileOrSmallerLayout)()?null:this.renderLeftArrow(),(0,v.isMobileOrSmallerLayout)()?null:this.renderRightArrow())}},{key:"renderLeftArrow",value:function(){return r.default.createElement(g.default,{direction:"left",clickCallback:this.handleScrollLeft})}},{key:"renderRightArrow",value:function(){return r.default.createElement(g.default,{direction:"right",clickCallback:this.handleScrollRight})}},{key:"renderRecommendations",value:function(){return this.props.tabs.length>0&&this.props.selectedTab==this.props.tabs[0]&&r.default.createElement(d.default,null)}},{key:"renderSectionsContent",value:function(){return this.props.selectedTab&&r.default.createElement(l.default,{renderer:c.default,models:this.props.selectedTab.sections,styleClasses:"block"})}},{key:"renderLoadingText",value:function(){return!this.props.selectedTab&&r.default.createElement("div",{className:"noScores"},(0,f.resource)("action.loading"))}},{key:"renderBrowseAllButton",value:function(){return r.default.createElement("div",{className:"browseButton"},r.default.createElement("button",{className:"premiumColorsInverse withShadow",onClick:this.handleBrowseClick},(0,f.resource)("content.viewAllScores")))}},{key:"render",value:function(){var e=this.props.selectedTab?1==this.props.selectedTab.sections.length?"flow":"strip":"",t=(0,v.isPhoneLayoutOrSmaller)()?"":"reducedWidth marginTop23";return m.NF.session.showSellerFeatures()&&r.default.createElement("div",null,r.default.createElement("div",{className:"marketplace scrollingPage modernForm paddingForPhone"},r.default.createElement("div",{className:"relative"},r.default.createElement("div",{className:"header headerBanner"},this.renderCarousel()),r.default.createElement("div",{className:"contentContainer"},r.default.createElement("div",{className:t},(0,v.isPhoneLayoutOrSmaller)()?this.renderBrowseAllButton():null,this.props.tabs.length>1?r.default.createElement("div",{className:"scoresBody"},r.default.createElement("div",{className:"subNavCategories"},r.default.createElement("ul",{className:"subNavList"},this.renderTabs()))):null,r.default.createElement("div",null,this.renderLoadingText(),r.default.createElement("div",{className:"sectionsContainer ".concat(e)},this.renderRecommendations(),this.renderSectionsContent()))),(0,v.isPhoneLayoutOrSmaller)()?null:this.renderBrowseAllButton(),!(0,v.isPhoneLayoutOrSmaller)()&&this.state.filterOpen?r.default.createElement(b.default,{sections:this.props.aggregations,title:"content.viewAllScores",titleColor:"colorPremium",titleClickCallback:this.navigateToAllScores}):null),r.default.createElement(u.default,null),r.default.createElement(p.default,null))))}},{key:"carouselSelector",get:function(){return this._carouselSelector||(this._carouselSelector=$(".allCarouselItemsContainer")),this._carouselSelector}}]),t}();t.Marketplace=C;var T=(0,n.connect)(function(e){for(var t=null,o=0;o<e.marketplace.tabs.length;o++)if(e.marketplace.tabs[o].id==e.marketplace.currentTabId){t=e.marketplace.tabs[o];break}return{currentTabId:e.marketplace.currentTabId,tabs:e.marketplace.tabs,carouselCollections:e.marketplace.carouselCollections,selectedTab:t,aggregations:e.marketplace.aggregations}},{setCurrentTab:a.setCurrentTab,getTabs:a.getTabs,getCarousel:a.getCarousel,search:a.search})(C);t.default=T},function(e,t,o){e.exports=o(7)(690)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),i=o(2);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,l(t).call(this,e))).handleOnClick=o.handleOnClick.bind(u(u(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"handleOnClick",value:function(){(0,i.navigate)(this.props.url)}},{key:"render",value:function(){var e={backgroundImage:'url("/collections/image/'.concat(this.props.id,'")')},t=this.props.isFirst?"first":"",o=this.props.isLast?"last":"";return r.default.createElement("div",{className:"collectionCard ".concat(t," ").concat(o),style:e,onClick:this.handleOnClick},r.default.createElement("label",{className:"name"},this.props.name),r.default.createElement("label",{className:"description"},this.props.description),r.default.createElement("div",{className:"darkLayer topDown"}))}}]),t}();t.default=d,d.propTypes={name:n.default.string.isRequired,id:n.default.number.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=l(o(18)),i=o(2),a=l(o(118)),s=l(o(99));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?f(e):t}(this,d(t).call(this,e))).handleOnClick=o.handleOnClick.bind(f(f(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.Component),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"handleOnClick",value:function(){(0,i.navigate)(this.props.url)}},{key:"renderAudioPreview",value:function(){return r.default.createElement(s.default,{id:this.props.id,hasCustomAudioMedia:this.props.has_custom_audio_media,url:this.props.audio_preview_path})}},{key:"render",value:function(){var e=this.props.isFirst?"first":"",t=this.props.isLast?"last":"";return r.default.createElement("div",{className:"scoreThumbnail ".concat(e," ").concat(t)},r.default.createElement("div",{className:"coverArtContainer ".concat(t),onClick:this.handleOnClick},r.default.createElement(a.default,{size:"phoneListSize",backgroundImageUrl:this.props.cover_art_url},this.renderAudioPreview())),r.default.createElement("div",{className:"scoreInfo"},r.default.createElement("div",{className:"titleRow"},r.default.createElement("div",{className:"title ellipsify"},this.props.title)),r.default.createElement("a",{href:this.props.author.homepage_uri,className:"standardLink"},r.default.createElement("div",{className:"author ellipsify"},this.props.author.username))))}}]),t}();t.default=h,h.propTypes={title:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ProductContextMenu=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=p(o(18)),a=o(0),s=p(o(417)),l=p(o(418)),c=p(o(197)),u=o(119),d=o(120);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var v={left:40,top:164},y=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?b(e):t}(this,m(t).call(this))).addToNewCollection=e.addToNewCollection.bind(b(b(e))),e.collectionCreated=e.collectionCreated.bind(b(b(e))),e.addProductToCollection=e.addProductToCollection.bind(b(b(e))),e.removeProductFromCollection=e.removeProductFromCollection.bind(b(b(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,r.Component),function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(t,[{key:"addProductToCollection",value:function(e){this.props.addToCollection([this.props.uuid],e.id,"CollectionProduct")}},{key:"removeProductFromCollection",value:function(e){this.props.removeFromCollection([this.props.uuid],e.id,"CollectionProduct")}},{key:"closeContextMenu",value:function(){this.props.setContextMenuState(this.props.uuid,!1)}},{key:"addToNewCollection",value:function(){this.closeContextMenu(),new c.default({callback:this.collectionCreated,new:!0}).show()}},{key:"collectionCreated",value:function(e){this.addProductToCollection(e),this.props.getCollections("CollectionProduct")}},{key:"renderAddToCollectionItem",value:function(){return r.default.createElement(l.default,{key:"0",id:this.props.uuid,isFirst:"isFirst",clickCallback:this.addToNewCollection,label:(0,a.resource)("action.createNewCollection")})}},{key:"renderCollections",value:function(){var e=this,t=0;return this.props.collections.map(function(o){t++;for(var n=!1,i=0;i<o.items.length;i++)if(o.items[i].uuid==e.props.uuid){n=!0;break}var a=n?e.removeProductFromCollection:e.addProductToCollection,s=n?"cross":"plus";return r.default.createElement(l.default,{key:t,label:o.name,icon:s,clickCallback:function(){e.closeContextMenu(),a(o)}})})}},{key:"render",value:function(){return r.default.createElement(s.default,{offset:v},this.renderAddToCollectionItem(),this.renderCollections())}}]),t}();t.ProductContextMenu=y,y.propTypes={uuid:i.default.string.isRequired};var _=(0,n.connect)(function(e){for(var t=[],o=e.collection.currentUserCollectionsIds,r=0;r<o.length;r++)t.push(e.collection.collectionsById[o[r]]);return{collections:t}},{getCollections:u.getCollections,addToCollection:u.addToCollection,removeFromCollection:u.removeFromCollection,setContextMenuState:d.setContextMenuState})(y);t.default=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"render",value:function(){var e={top:"".concat(this.props.offset.top,"px"),left:"".concat(this.props.offset.left,"px")};return r.default.createElement("div",{className:"contextMenu",style:e},r.default.createElement("div",{className:""},r.default.createElement("div",{className:"arrowUp center"}),r.default.createElement("div",{className:"contextMenuItems react ".concat(this.props.orientation)},this.props.children)))}}]),t}();t.default=c,c.defaultProps={orientation:"vertical",arrowPosition:"top",offset:{left:0,top:0}},c.propTypes={}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u={plus:"plus-circle",cross:"times-circle"},d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this,e))).handleClick=o.handleClick.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"renderIcon",value:function(){return u[this.props.icon]?r.default.createElement("i",{className:"fa fa-".concat(u[this.props.icon])}):null}},{key:"handleClick",value:function(e){e&&e.preventDefault(),this.props.clickCallback()}},{key:"render",value:function(){var e=u[this.props.icon]?"itemWithIcon":"";return r.default.createElement("div",{className:"contextMenuItem ".concat(this.props.isFirst),onClick:this.handleClick},this.renderIcon(),r.default.createElement("label",{className:e},this.props.label))}}]),t}();t.default=d,d.defaultProps={isFirst:!1,icon:""},d.propTypes={clickCallback:n.default.func.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(2),i=o(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"goToSellerSignup",value:function(){(0,n.navigate)((0,n.path)("sellingSetupLandingRedirection"))}},{key:"render",value:function(){return r.default.createElement("div",{className:"marketing"},r.default.createElement("div",{className:"buyAdaptSell"},(0,i.resource)("content.buyAdaptSell")),r.default.createElement("div",{className:"illustrationContainer"},r.default.createElement("a",{href:(0,n.path)("marketplaceSearch")},r.default.createElement("div",{className:"illustrationUnit buy"},r.default.createElement("div",{className:"illustration"}),r.default.createElement("div",{className:"text"},(0,i.resource)("content.marketingSectionBuy")))),r.default.createElement("a",{href:"/marketplace-purchasing-and-selling"},r.default.createElement("div",{className:"illustrationUnit adapt"},r.default.createElement("div",{className:"illustration"}),r.default.createElement("div",{className:"text"},(0,i.resource)("content.marketingSectionAdapt")))),r.default.createElement("a",{href:"/marketplace-selling-and-purchasing"},r.default.createElement("div",{className:"illustrationUnit sell"},r.default.createElement("div",{className:"illustration"}),r.default.createElement("div",{className:"text"},(0,i.resource)("content.marketingSectionSell"))))),r.default.createElement("button",{className:"actionButton premiumColors withShadow withPaddingEverywhere",onClick:this.goToSellerSignup},(0,i.resource)("action.signUpToSell")))}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Recommendations=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(46),a=o(421),s=o(97),l=u(o(199)),c=u(o(250));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,h(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,r.Component),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"componentDidMount",value:function(){(0,i.rrHomePage)()}},{key:"render",value:function(){return NF.session.rrRecommend()?this.props.recommended.length>0?r.default.createElement("div",{className:"recommendationsContainer"},r.default.createElement(c.default,{id:"recommendations",name:this.props.recommendedTitle,elements:this.props.recommended,type:"CollectionProduct"})):r.default.createElement("div",{className:"recommendationsContainer spinnerContainer"},r.default.createElement(l.default,null)):null}}]),t}();t.Recommendations=g;var b=(0,n.connect)(a.recommendationsSelector,{getRecommended:s.getRecommended})(g);t.default=b},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recommendationsSelector=void 0;var r=o(12),n=o(257),i=(0,r.createSelector)(n.recommendedSelector,function(e){return e});t.recommendationsSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(16),i=o(0),a=o(2),s=o(74);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=[{code:"en-US",language:"English (US)"},{code:"en",language:"English"},{code:"de",language:"Deutsch"},{code:"es-ES",language:"Espaol (ES)"},{code:"es",language:"Espaol"},{code:"fr",language:"Franais"},{code:"ja",language:""},{code:"ca",language:"Catal"},{code:"zh-CN",language:" ()"},{code:"zn-TW",language:" ()"}],h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this,e))).state={locale:"en-US"},o.updateLocale=o.updateLocale.bind(p(p(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"componentDidMount",value:function(){"en-US"===(0,n.locale)()?this.setState({locale:"en-US"}):"en"==(0,n.languageCode)()&&"en-US"!=(0,n.locale)()?this.setState({locale:"en"}):"de"==(0,n.languageCode)()?this.setState({locale:"de"}):"es-ES"==(0,n.locale)()?this.setState({locale:"es-ES"}):"es"==(0,n.languageCode)()&&"es-ES"!=(0,n.locale)()?this.setState({locale:"es"}):"fr"==(0,n.languageCode)()?this.setState({locale:"fr"}):"ja"==(0,n.languageCode)()?this.setState({locale:"ja"}):"ca"==(0,n.languageCode)()?this.setState({locale:"ca"}):"zh-CN"==(0,n.locale)()?this.setState({locale:"zh-CN"}):"zh-TW"==(0,n.locale)()&&this.setState({locale:"zh-TW"})}},{key:"updateLocale",value:function(e){(0,n.locale)(e.target.getAttribute("value")),this.setState({locale:e.target.getAttribute("value")})}},{key:"renderHelp",value:function(){return r.default.createElement("div",{className:"infoSection"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},(0,i.resource)("siteSidebar.help")),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",target:"_blank",href:s.HELP_CENTER_LINK},(0,i.resource)("menu.info.helpCenter"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",target:"_blank",href:(0,a.path)("help")},(0,i.resource)("menu.info.usersGuide"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",target:"_blank",href:s.FAQ_LINK},(0,i.resource)("menu.info.faq"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",target:"_blank",href:s.BLOG_LINK},(0,i.resource)("menu.info.blog"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",target:"_blank",href:s.SUPPORT_LINK},(0,i.resource)("menu.info.support"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({className:"infoNavItem",target:"_blank",href:s.FEEDBACK_LINK},"target","_blank"),(0,i.resource)("menu.info.feedback")))))}},{key:"renderGeneral",value:function(){return r.default.createElement("div",{className:"infoSection"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},"Noteflight"),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("plans")},(0,i.resource)("menu.plans"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("premium")},(0,i.resource)("menu.premium"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("learn")},(0,i.resource)("menu.learn"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("higherEd")},(0,i.resource)("menu.info.higherEd"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("requestGiftCardDirect")},(0,i.resource)("menu.giftCard"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("partners")},(0,i.resource)("menu.info.partners"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("developers")},(0,i.resource)("menu.info.developers")))))}},{key:"renderMarketplace",value:function(){return r.default.createElement("div",{className:"infoSection"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},(0,i.resource)("content.marketplace")),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("marketplace")},(0,i.resource)("content.noteflightMarketplace"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("songCatalog")},(0,i.resource)("content.marketplaceSongCatalog"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/marketplace-purchasing-and-selling"},(0,i.resource)("content.purchasingGuide"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/marketplace-selling-and-purchasing"},(0,i.resource)("content.sellingGuide")))))}},{key:"renderCompany",value:function(){return r.default.createElement("div",{className:"infoSection",id:"companyInfoList"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},(0,i.resource)("siteSidebar.company")),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/company/about"},(0,i.resource)("menu.info.about"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/company/team"},(0,i.resource)("menu.info.team"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/company/jobs"},(0,i.resource)("menu.info.jobs"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"http://notes.noteflight.com/category/news/press/"},(0,i.resource)("menu.info.press"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("siteHome")},(0,i.resource)("menu.info.home")))))}},{key:"renderLegal",value:function(){return r.default.createElement("div",{className:"infoSection"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},(0,i.resource)("siteSidebar.legal")),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("terms")},(0,i.resource)("menu.info.terms"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("privacy")},(0,i.resource)("menu.info.privacy"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:(0,a.path)("copyright")},(0,i.resource)("menu.info.copyright"))),r.default.createElement("li",{className:"infoListItem"},r.default.createElement("a",{className:"infoNavItem",href:"/legal/marketplace"},(0,i.resource)("content.marketplaceTOS")))))}},{key:"renderLanguages",value:function(){return r.default.createElement("div",{className:"infoSection"},r.default.createElement("ul",null,r.default.createElement("div",{className:"columnHeader"},(0,i.resource)("userSidebar.language")),this.renderLocales()))}},{key:"renderLocales",value:function(){var e=this;return f.map(function(t,o){return r.default.createElement("li",{className:"infoListItem",key:o},r.default.createElement("a",{className:"infoNavItem pointer ".concat(e.state.locale===t.code?"selected":""),value:t.code,onClick:e.updateLocale},t.language))})}},{key:"renderSocial",value:function(){return r.default.createElement("div",null,r.default.createElement("div",{className:"socialBits"},r.default.createElement("a",{className:"twitterCircle",href:"http://twitter.com/noteflight",target:"_blank"}),r.default.createElement("a",{className:"facebookCircle",href:"http://www.facebook.com/Noteflight",target:"_blank"})))}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement("div",{className:"siteHome footer marginTop100"},r.default.createElement("div",{className:"section6 unsetBackgroundColor"},r.default.createElement("div",{className:"section6LogoContainer"},r.default.createElement("div",{className:"section6Logo"}),r.default.createElement("div",{className:"hlAffiliation"},(0,i.resource)("menu.hlAffiliation"))),r.default.createElement("div",{className:"infoStuff"},this.renderHelp(),this.renderGeneral(),this.renderMarketplace(),this.renderCompany(),this.renderLegal(),this.renderLanguages(),this.renderSocial()),r.default.createElement("div",{className:"copyright"},(0,i.resource)("content.noteflightCopyright",(0,n.currentYear)())),r.default.createElement("div",{className:"clearFloat"}))))}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(0),i=o(121),a=function(e){return e&&e.__esModule?e:{default:e}}(o(424));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this))).handleTitleClickCallback=e.handleTitleClickCallback.bind(d(d(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"handleTitleClickCallback",value:function(){this.props.titleClickCallback&&this.props.titleClickCallback()}},{key:"renderSections",value:function(){var e=Object.entries(this.props.sections);if(0===e.length)return null;e.sort(function(e,t){return(0,i.getSectionPosition)(e[0])<(0,i.getSectionPosition)(t[0])?-1:1});for(var t=[],o=0;o<e.length;o++){var n=e[o],s=n[0],l=n[1];(0,i.isSectionValid)(s)&&t.push(r.default.createElement(a.default,{key:s,name:s,elements:l}))}return t}},{key:"render",value:function(){var e=this.props.titleClickCallback?"pointer":"";return r.default.createElement("div",{className:"filterPanel modernForm medium"},r.default.createElement("div",{className:"filterHeader"},r.default.createElement("label",{onClick:this.handleTitleClickCallback,className:"title ".concat(this.props.titleColor," ").concat(e)},(0,n.resource)(this.props.title))),this.renderSections())}}]),t}();t.default=p,p.defaultProps={clickCallback:function(){},titleClickCallback:void 0,sections:{},title:"content.filter",titleColor:"black"},p.propTypes={}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=c(o(18)),i=o(0),a=o(28),s=o(121),l=c(o(425));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this))).state={collapsed:!0,isSearchable:!1,showSearch:!1,searchQuery:""},e.toggleCollapsed=e.toggleCollapsed.bind(h(h(e))),e.handleSearchChange=e.handleSearchChange.bind(h(h(e))),e.toggleShowSearch=e.toggleShowSearch.bind(h(h(e))),e.handleClearSearch=e.handleClearSearch.bind(h(h(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,r.Component),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"componentDidMount",value:function(){this.setState({isSearchable:(0,s.isSectionSearchable)(this.props.name)})}},{key:"toggleCollapsed",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"toggleShowSearch",value:function(){this.setState({showSearch:!this.state.showSearch})}},{key:"handleSearchChange",value:function(e){this.setState({searchQuery:e.target.value})}},{key:"handleClearSearch",value:function(){this.setState({searchQuery:""})}},{key:"sortElements",value:function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).sortByName?e.sort(function(e,t){return e.name<t.name?-1:1}):e.sort(function(e,t){return e.total==t.total?e.selected!=t.selected?t.selected?1:-1:e.name<t.name?-1:1:t.total-e.total})}},{key:"renderElements",value:function(){for(var e=this,t=[],o=0;o<this.props.elements.length;o++){var n=this.props.elements[o];if((0,s.validFilterElement)(this.props.name,n.key,n.doc_count)){if(this.state.searchQuery){var c=(0,s.getFilterElementName)(n.key,this.props.name);if(!(0,a.getStringToCompare)(c).includes((0,a.getStringToCompare)(this.state.searchQuery)))continue}t.push(r.default.createElement(l.default,{key:o,element:n,sectionName:this.props.name}))}}var u=(0,s.getElementsSortOptions)(this.props.name);u&&this.sortElements(t,u);var d=this.state.collapsed?(0,i.resource)("search.showMore"):(0,i.resource)("search.showLess"),p=this.state.collapsed?"collapsed":"";return r.default.createElement("div",null,this.state.showSearch?r.default.createElement("div",{className:"relative"},r.default.createElement("input",{type:"text",className:"fullWidthInput searchInput",onChange:function(t){e.handleSearchChange(t)},value:this.state.searchQuery}),this.state.searchQuery?r.default.createElement("i",{className:"clearSearchButton fa fa-times-circle","aria-hidden":"true",onClick:this.handleClearSearch}):""):"",r.default.createElement("div",{className:"elementsContainer ".concat(p)},t),this.props.elements.length>s.MAX_ELEMENTS_PER_SECTION?r.default.createElement("div",null,r.default.createElement("label",{className:"colorPremium text showMoreOrLess",onClick:this.toggleCollapsed,dangerouslySetInnerHTML:{__html:d}})):null)}},{key:"render",value:function(){return r.default.createElement("div",{className:"filterSection",key:this.props.name},r.default.createElement("label",{className:"title marginRight10"},(0,i.resource)("filter."+(0,a.camelCase)(this.props.name))),this.state.isSearchable?r.default.createElement("i",{className:"searchableIcon fa fa-search","aria-hidden":"true",onClick:this.toggleShowSearch}):"",this.renderElements())}}]),t}();t.default=m,m.propTypes={name:n.default.string.isRequired,elements:n.default.array.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),i=o(15),a=o(121),s=o(2);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this))).search=e.search.bind(p(p(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"search",value:function(){var e="".concat(this.props.sectionName,":").concat(encodeURIComponent(this.props.element.key));(0,s.navigate)((0,s.path)("marketplaceSearchQuery",{searchQuery:encodeURI(e)}))}},{key:"renderElementName",value:function(){var e=(0,a.getFilterElementName)(this.props.element.key,this.props.sectionName);return r.default.createElement("div",{onClick:this.search},r.default.createElement("label",{className:"elementName marginRight5"},e),r.default.createElement("label",{className:"elementNumber"},"(",(0,i.formatCommas)(this.props.element.doc_count),")"))}},{key:"render",value:function(){return r.default.createElement("div",{className:"filterElement"},r.default.createElement("label",{className:"text"},this.renderElementName()))}}]),t}();t.default=f,f.propTypes={sectionName:n.default.string.isRequired,element:n.default.object.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MarketplaceSearch=t.PRODUCT_VIEW_TYPE_KEY=void 0;var r,n=R(o(4)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),a=o(10),s=o(119),l=o(120),c=o(97),u=o(8),d=o(5),p=R(o(98)),f=R(o(427)),h=R(o(258)),m=R(o(252)),g=R(o(255)),b=R(o(429)),v=R(o(430)),y=R(o(432)),_=R(o(433)),S=o(6),w=o(27),k=o(0),E=o(2),P=o(28),C=o(19),T=R(o(123));function R(e){return e&&e.__esModule?e:{default:e}}function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var D=(x(r={},u.THUMBNAIL,m.default),x(r,u.LIST,b.default),x(r,u.GRID,g.default),r);t.PRODUCT_VIEW_TYPE_KEY="_nf_products_view_type";var F=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?I(e):t}(this,A(t).call(this,e))).collectionsFetched=!1,o.state={currentOrder:o.defaultOrder(),viewType:o.calculateViewType(),filterOpen:!0},o.lastSearchQuery=null,o.lastSearchKeyword=null,o.updateUrlFromExternalFilter=o.updateUrlFromExternalFilter.bind(I(I(o))),o.handleFilterChange=o.handleFilterChange.bind(I(I(o))),o.handleOrderChange=o.handleOrderChange.bind(I(I(o))),o.handleViewTypeChange=o.handleViewTypeChange.bind(I(I(o))),o.handleClearKeyword=o.handleClearKeyword.bind(I(I(o))),o.handleLoadMore=o.handleLoadMore.bind(I(I(o))),o.filter=new T.default({callback:o.handleFilterChange,scoresPath:S.NF.paths.marketplaceSearchQuery}),n.default.subscribe(d.FILTER_SELECTION,function(e,t){o.updateUrlFromExternalFilter(t.sections)}),n.default.subscribe(d.FILTER_TOGGLE,function(e,t){o.setState({filterOpen:t.open})}),n.default.subscribe(d.WINDOW_RESIZED,function(){o.setState({viewType:o.calculateViewType()})}),n.default.subscribe(d.SEARCH_QUERY_BROADCAST,function(e,t){o.props.setSearchQuery(t);var r=o.extractKeywordFromQuery()!=o.lastSearchKeyword?o.defaultOrder():o.state.currentOrder;o.setState({currentOrder:r},function(){o.search({reset:!0})})}),o.handleWindowClick=o.handleWindowClick.bind(I(I(o))),(0,S.$)(window).click(o.handleWindowClick),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,i.Component),function(e,t,o){t&&M(e.prototype,t),o&&M(e,o)}(t,[{key:"calculateViewType",value:function(){var e=u.THUMBNAIL;if((0,w.hasStorage)()){var t=localStorage.getItem("_nf_products_view_type");void 0!==D[t]&&(e=t)}return(0,C.isMobileOrSmallerLayout)()&&(e=u.GRID),e}},{key:"handleWindowClick",value:function(e){var t=e.target;-1==t.className.indexOf("openContextMenu")&&0===(0,S.$)(t).parents(".contextMenu").length&&this.props.closeAllContextMenus()}},{key:"defaultOrder",value:function(){this.props.query&&this.props.query!=u.PRODUCT_DEFAULT_QUERY?u.MOST_RELEVANT:u.MOST_RECENT}},{key:"componentDidMount",value:function(){n.default.publish(d.SEARCH_QUERY_REQUESTED,{}),S.NF.roles.isNoteflightAdmin()&&!this.collectionsFetched&&(this.collectionsFetched=!0,this.props.getCollections("CollectionProduct"))}},{key:"componentDidUpdate",value:function(e){var t=this;if(e.loading&&!this.props.loading){n.default.publish(d.FILTER_UPDATE_AGGREGATIONS,{searchParams:this.getSearchParamsFromQuery(),aggregations:this.props.aggregations}),this.populateInternalFilter(this.props.aggregations);var o=e.query||u.PRODUCT_DEFAULT_QUERY;if(this.lastSearchQuery!=this.props.query){var r=this.extractKeywordFromQuery(this.getSearchParamsFromQuery(o)),i=this.extractKeywordFromQuery(this.getSearchParamsFromQuery(this.props.query)),a=this.extractOrderFromQuery(this.getSearchParamsFromQuery(this.props.query));!i||o!=u.PRODUCT_DEFAULT_QUERY&&r?a?this.setState({currentOrder:a},function(){t.search({reset:!0})}):this.search({reset:!0}):this.setState({currentOrder:this.defaultOrder()},function(){t.search({reset:!0})})}}}},{key:"updateUrlFromExternalFilter",value:function(e){this.filter.sections(e),this.updateUrl(this.extractKeywordFromQuery())}},{key:"populateInternalFilter",value:function(e){this.filter.populateFilterSelectionFromUrl(this.getSearchParamsFromQuery()),this.filter.populateFilter(e),this.props.setSearchFilters(this.filter.selectedElements)}},{key:"getSearchParamsFromQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,P.getSearchParametersFromQuery)(decodeURIComponent(e||this.props.query))}},{key:"extractKeywordFromQuery",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||this.getSearchParamsFromQuery();return e.keyword?e.keyword[0]:null}},{key:"extractOrderFromQuery",value:function(){var e=this.getSearchParamsFromQuery();return e.order?e.order[0]:null}},{key:"extractFromUrl",value:function(e){return this.getSearchParamsFromQuery()[e]}},{key:"search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.extractKeywordFromQuery(),o=this.getSearchParamsFromQuery();this.filter.populateFilterSelectionFromUrl(o),this.props.setSearchTerm(t),this.lastSearchKeyword=t,this.lastSearchQuery=this.props.query;var r={term:t,filters:this.filter.filterParams.filters,ranges:this.filter.rangeParams.ranges,max_count:36,start_index:this.props.startIndex,order:this.state.currentOrder,song_id:o.song_id?o.song_id[0]:null};if(e.reset)this.props.resetSearch(r);else{if(S.NF.session.rrFind()&&"development"==S.NF.environment)return;this.props.search(r)}}},{key:"updateUrl",value:function(e){var t=this;this.filter.updateUrl(e,function(){(0,E.navigate)(t.clearSearchPath())})}},{key:"handleLoadMore",value:function(){this.props.count>this.props.startIndex&&this.search()}},{key:"handleFilterChange",value:function(){this.updateUrl(this.extractKeywordFromQuery())}},{key:"handleClearKeyword",value:function(){this.updateUrl(null)}},{key:"handleOrderChange",value:function(e){var t=this;this.setState({currentOrder:e},function(){t.search({reset:!0})})}},{key:"handleViewTypeChange",value:function(e){!(0,w.hasStorage)()||e!=u.THUMBNAIL&&e!=u.LIST||localStorage.setItem("_nf_products_view_type",e),this.setState({viewType:e})}},{key:"clearSearchPath",value:function(){return(0,E.path)("marketplaceSearch")}},{key:"renderLoadingText",value:function(){return this.props.loading&&i.default.createElement("div",{className:"itemsControl"},i.default.createElement("span",{className:"itemsControlBusy"},(0,k.resource)("action.loading")))}},{key:"renderNoProductsText",value:function(){return!this.props.loading&&0===this.props.products.length&&i.default.createElement("div",{className:"noScores"},(0,k.resource)("content.noScores"))}},{key:"renderSorting",value:function(){return this.props.products.length>0&&i.default.createElement(v.default,{order:this.state.currentOrder,keyword:this.extractKeywordFromQuery(),viewType:this.state.viewType,viewChangeCallback:this.handleViewTypeChange,orderChangeCallback:this.handleOrderChange})}},{key:"renderContent",value:function(){if(0===this.props.products.length&&this.props.loading)return null;var e=D[this.state.viewType],t=this.state.viewType===u.LIST?y.default:null,o=this.state.viewType===u.GRID?"grid":"block";return i.default.createElement(p.default,{renderer:e,headerRenderer:t,models:this.props.products,styleClasses:"min190 ".concat(o)})}},{key:"render",value:function(){var e=this.state.filterOpen?"filterOpen":"";return S.NF.session.showSellerFeatures()&&i.default.createElement(f.default,{className:"marketplaceSearch",loadHandler:this.handleLoadMore,shown:this.props.startIndex,count:this.props.count},i.default.createElement("div",{className:"marketplaceSearch scoresContainer scrollingPage paddingForPhone modernForm small ".concat(e)},i.default.createElement("div",{className:"bodyPart clearFloat"},i.default.createElement("div",{className:"rightSide leftSide"},i.default.createElement("div",{className:"subNavBar clearFloat"},i.default.createElement("div",{className:"subNavCategories searchTermHeader"},i.default.createElement("ul",{className:"subNavList block"},i.default.createElement(h.default,null),i.default.createElement("div",{className:"inlineBlock searchTargets"},i.default.createElement(_.default,{keyword:this.props.searchTerm,clearKeywordCallback:this.handleClearKeyword,noFiltersRedirectionPath:this.clearSearchPath(),filterElements:this.props.searchFilters})))),this.renderSorting())),i.default.createElement("div",{className:"results"},this.renderNoProductsText(),this.renderContent(),this.renderLoadingText()))))}}]),t}();t.MarketplaceSearch=F;var L=(0,a.connect)(function(e){return{query:e.marketplace.query,searchTerm:e.marketplace.searchTerm,products:e.marketplace.products,aggregations:e.marketplace.aggregations,searchFilters:e.marketplace.searchFilters,loading:e.marketplace.loading,startIndex:e.marketplace.startIndex,count:e.marketplace.count,order:e.marketplace.order}},{search:c.search,getCollections:s.getCollections,setSearchQuery:c.setSearchQuery,setSearchTerm:c.setSearchTerm,setSearchFilters:c.setSearchFilters,resetSearch:c.resetSearch,closeAllContextMenus:l.closeAllContextMenus})(F);t.default=L},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(428));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this,e))).state={loadMore:!1},o.calculateScroll=(0,n.default)(o.calculateScroll.bind(c(c(o))),500),o.handleScroll=o.handleScroll.bind(c(c(o))),o.handleLoadMoreClick=o.handleLoadMoreClick.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"componentWillReceiveProps",value:function(e){e.shown!=this.props.shown||e.count!=this.props.count?this.setState({loadMore:e.count>e.shown}):0!=e.shown&&e.shown<e.count&&this.loadMoreElementsToFillScreen(this.props.className)}},{key:"loadMoreElementsToFillScreen",value:function(e){var t=$(".".concat(e)).height(),o=$(".".concat(e," .grid"));o.offset()&&(o.offset().top+o.height()-400<t&&this.props.loadHandler())}},{key:"calculateScroll",value:function(e,t,o){var r=this,n=t-400<e+o;this.state.loadMore&&n&&this.setState({loadMore:!1},function(){r.props.loadHandler()})}},{key:"handleScroll",value:function(e){e.persist(),this.calculateScroll(e.nativeEvent.target.scrollTop,e.nativeEvent.target.scrollHeight,e.nativeEvent.target.clientHeight)}},{key:"handleLoadMoreClick",value:function(){var e=this;this.setState({loadMore:!1},function(){e.props.loadHandler()})}},{key:"render",value:function(){return r.default.createElement("div",{className:"page infinite",onScroll:this.handleScroll},this.props.children)}}]),t}();t.default=u},function(e,t,o){e.exports=o(7)(619)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=f(o(18)),i=f(o(196)),a=o(0),s=o(2),l=f(o(99)),c=f(o(198)),u=f(o(253)),d=o(15),p=o(49);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?v(e):t}(this,g(t).call(this,e))).handleOnClick=o.handleOnClick.bind(v(v(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,r.Component),function(e,t,o){t&&m(e.prototype,t),o&&m(e,o)}(t,[{key:"handleOnClick",value:function(){(0,s.navigate)(this.props.marketplace_url)}},{key:"elementVisibility",value:function(e){var t={visibility:"visible"},o={visibility:"hidden"};switch(e){case"ratings":return this.props.average_rating>0?t:o;case"faves":return this.props.favorites_count>0?t:o;case"views":return this.props.views_count>0?t:o}}},{key:"renderAudioPreview",value:function(){return r.default.createElement(l.default,{view:"list",id:this.props.uuid,hasCustomAudioMedia:this.props.has_custom_audio_media,url:this.props.audio_preview_url})}},{key:"renderOfficialBadge",value:function(){return this.props.official&&r.default.createElement(c.default,null)}},{key:"renderContributors",value:function(){var e=(0,p.firstContributor)(this.props.contributors),t=e?", ":"",o=(0,p.firstArranger)(this.props.contributors);return o&&(e="".concat(e).concat(t).concat((0,a.resource)("content.arr",o))),r.default.createElement("label",{className:"contributors ellipsify"},e)}},{key:"render",value:function(){return r.default.createElement("a",{className:"noTextDecoration",href:this.props.marketplace_url},r.default.createElement("div",{className:"scoreRow productRow clearFloat"},r.default.createElement("div",{className:"scoreBody",onClick:this.handleOnClick},this.renderAudioPreview(),r.default.createElement("div",{className:"title"},r.default.createElement("label",{className:"productTitle ellipsify"},this.props.title),this.renderOfficialBadge()),this.renderContributors(),r.default.createElement(u.default,{format:this.props.metadata.format,instruments:this.props.metadata.instrument_names}),r.default.createElement("label",{className:"price"},(0,d.formatPriceInCents)(this.props.price,{currency:this.props.currency,showDouble0ForCents:!0})),r.default.createElement("div",{className:"productSocialBits"},r.default.createElement("div",{className:"ratings",style:this.elementVisibility("ratings")},r.default.createElement(i.default,{total:this.props.average_rating,size:"small"}),r.default.createElement("span",{className:"reviewCount"},(0,d.abbreviateNumber)(this.props.reviews_count))),r.default.createElement("div",{className:"productSocialBit",style:this.elementVisibility("faves")},r.default.createElement("i",{className:"fa fa-heart","aria-hidden":"true"}),r.default.createElement("span",{className:"socialCount"},(0,d.abbreviateNumber)(this.props.favorites_count))),r.default.createElement("div",{className:"productSocialBit",style:this.elementVisibility("views")},r.default.createElement("i",{className:"fa fa-eye","aria-hidden":"true"}),r.default.createElement("span",{className:"socialCount"},(0,d.abbreviateNumber)(this.props.views_count)))))))}}]),t}();t.default=y,y.propTypes={title:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=s(o(18)),i=s(o(122)),a=o(8);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=[a.THUMBNAIL,a.LIST],h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this,e))).handleViewTypeChange=o.handleViewTypeChange.bind(p(p(o))),o.handleSelectChange=o.handleSelectChange.bind(p(p(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"handleViewTypeChange",value:function(e){for(var t=e.target.classList,o=0;o<t.length;o++)if(f.includes(t[o])){this.props.viewChangeCallback(t[o]);break}}},{key:"renderViewType",value:function(){var e=this.props.viewType==a.THUMBNAIL?"selected":"",t=this.props.viewType==a.LIST?"selected":"";return!NF.IsPhoneLayout()&&r.default.createElement("div",{className:"scoresViewTypes"},r.default.createElement("div",{className:"scoresViewType thumbnail ".concat(e),onClick:this.handleViewTypeChange}),r.default.createElement("div",{className:"scoresViewType list ".concat(t),onClick:this.handleViewTypeChange}))}},{key:"handleSelectChange",value:function(e){var t=e.target.value;this.props.orderChangeCallback(t)}},{key:"render",value:function(){var e=a.PRODUCT_SORT_OPTIONS.slice(this.props.keyword?0:1);return r.default.createElement("div",{className:"subNavFilters right inlineFlex searchSortWrapper"},this.renderViewType(),r.default.createElement("div",{className:"select inline autoWidth"},r.default.createElement(i.default,{name:"order",value:this.props.order,changeHandler:this.handleSelectChange,options:e})))}}]),t}();t.default=h,h.propTypes={orderChangeCallback:n.default.func.isRequired,viewChangeCallback:n.default.func.isRequired,order:n.default.string,viewType:n.default.string}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.PureComponent),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"renderLabel",value:function(){return this.props.label||this.props.subLabel?r.default.createElement("div",{className:"inputDescription"},this.props.label," ",this.renderSubLabel()):null}},{key:"renderSubLabel",value:function(){return this.props.subLabel?r.default.createElement("span",{className:"detail"},this.props.subLabel):null}},{key:"render",value:function(){return r.default.createElement("div",{className:"formRow"},r.default.createElement("label",null,this.renderLabel(),this.props.children))}}]),t}();t.default=u,u.propTypes={label:n.default.string,subLabel:n.default.string}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"render",value:function(){return n.default.createElement("div",{className:"productListHeader clearFloat"},n.default.createElement("div",{className:"productListHeaderItem title"},(0,r.resource)("content.title")),n.default.createElement("div",{className:"productListHeaderItem artistWriter"},(0,r.resource)("content.artistWriter")),n.default.createElement("div",{className:"productListHeaderItem arrangement"},(0,r.resource)("content.arrangement")),n.default.createElement("div",{className:"productListHeaderItem price"},(0,r.resource)("content.price")),n.default.createElement("div",{className:"productListHeaderItem social"}))}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=a(o(18)),i=a(o(434));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this,e))).handleClearKeyword=o.handleClearKeyword.bind(d(d(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"handleClearKeyword",value:function(){this.props.clearKeywordCallback()}},{key:"renderKeyword",value:function(){return this.props.keyword&&r.default.createElement(i.default,{key:0,name:this.props.keyword,clickCallback:this.handleClearKeyword})}},{key:"renderFilters",value:function(){var e=0;return this.props.filterElements.map(function(t){return e++,r.default.createElement(i.default,{key:e,name:t.nameToShow(),clickCallback:t.unselect.bind(t)})})}},{key:"render",value:function(){return r.default.createElement("div",{className:"inline"},this.renderKeyword(),this.renderFilters())}}]),t}();t.default=p,p.defaultProps={filterElements:[]},p.propTypes={keyword:n.default.string,filterElements:n.default.array,clearKeywordCallback:n.default.func.isRequired,noFiltersRedirectionPath:n.default.string}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("li",{className:"searchTarget current"},r.default.createElement("a",null,this.props.name),r.default.createElement("div",{className:"close",onClick:this.props.clickCallback}))}}]),t}();t.default=u,u.propTypes={name:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CollectionPage=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(0),a=o(19),s=o(2),l=p(o(98)),c=p(o(258)),u=o(119),d=o(251);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var v=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?b(e):t}(this,m(t).call(this,e))).handleBrowseClick=o.handleBrowseClick.bind(b(b(o))),o.handleViewMore=o.handleViewMore.bind(b(b(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,r.Component),function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(t,[{key:"componentDidMount",value:function(){this.props.getCollection(this.props.match.params.id)}},{key:"handleBrowseClick",value:function(){(0,s.navigate)((0,s.path)("marketplaceSearch"))}},{key:"handleViewMore",value:function(){(0,s.navigate)(this.props.collection.query)}},{key:"renderMarketplaceLogo",value:function(){return this.props.collection.is_marketplace_collection&&r.default.createElement(c.default,null)}},{key:"renderCollectionContent",value:function(){if(0==this.props.collection.items.length)return r.default.createElement("div",{className:"noScores"},(0,i.resource)("content.noScores"));var e=(0,d.extractCollectionTypeFromCollection)(this.props.collection,(0,a.isPhoneLayoutOrSmaller)()),t=(0,a.isPhoneLayoutOrSmaller)()?"min355":"min190";return r.default.createElement("div",{className:"sectionsContainer flow block"},r.default.createElement(l.default,{renderer:e,models:this.props.collection.items,styleClasses:"grid ".concat(t)}))}},{key:"renderViewMore",value:function(){if(this.props.collection.query){var e=this.props.collection.button_label;return(0,i.hasResource)(e)&&(e=(0,i.resource)(e)),e&&r.default.createElement("div",{className:"buttonsWrapper centered"},r.default.createElement("button",{className:"premiumColorsInverse withShadow",onClick:this.handleViewMore},e))}}},{key:"renderPageContent",value:function(){if(this.props.loading)return r.default.createElement("div",{className:"noScores"},(0,i.resource)("action.loading"));var e="/collections/image/".concat(this.props.match.params.id);return r.default.createElement("div",null,r.default.createElement("div",{className:"header headerBanner",style:{backgroundImage:"url("+e+")"}},r.default.createElement("div",{className:"darkLayer"}),this.renderMarketplaceLogo(),r.default.createElement("div",{className:"textContainer"},r.default.createElement("label",{className:"collectionName"},this.props.collection.name),r.default.createElement("label",{className:"collectionDescription"},this.props.collection.description))),r.default.createElement("div",{className:"body"},this.renderCollectionContent(),this.renderViewMore()))}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement("div",{className:"collection scrollingPage modernForm"},this.renderPageContent()))}}]),t}();t.CollectionPage=v;var y=(0,n.connect)(function(e){return{collection:e.collection.collectionsById[e.collection.currentCollectionId],loading:e.collection.loading}},{getCollection:u.getCollection})(v);t.default=y},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.AccountDetails=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(437),a=o(120),s=o(438),l=m(o(199)),c=o(6),u=o(0),d=o(20),p=o(16),f=o(2),h=m(o(441));function m(e){return e&&e.__esModule?e:{default:e}}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var S=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?_(e):t}(this,v(t).call(this,e))).state={wantsEmail:c.NF.session.current_user().profile().receive_news(),saveNotificationsEnabled:!1},o.handleNotificationsChange=o.handleNotificationsChange.bind(_(_(o))),o.handleClickSaveNotifications=o.handleClickSaveNotifications.bind(_(_(o))),o.handleMarketplaceViewDetailsClick=o.handleMarketplaceViewDetailsClick.bind(_(_(o))),o.handleDeleteAccountClick=o.handleDeleteAccountClick.bind(_(_(o))),o.handleEditProfileClick=o.handleEditProfileClick.bind(_(_(o))),o.handleUpgradePlanClick=o.handleUpgradePlanClick.bind(_(_(o))),o.handlePaymentDetailsClick=o.handlePaymentDetailsClick.bind(_(_(o))),o.handleSiteAdminContactClick=o.handleSiteAdminContactClick.bind(_(_(o))),o.handleRemoveAuthorizedApp=o.handleRemoveAuthorizedApp.bind(_(_(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,r.Component),function(e,t,o){t&&b(e.prototype,t),o&&b(e,o)}(t,[{key:"componentDidMount",value:function(){this.props.retrieveSellerAccount(),this.props.retrieveSellerPayoutDestination(),this.props.paymentInfo(),this.props.retrieveAuthorizedApps()}},{key:"componentDidUpdate",value:function(e){this.props.communityChangeUrl&&this.props.communityChangeUrl!==e.communityChangeUrl&&(0,f.navigate)(this.props.communityChangeUrl),this.props.siteOwnerEmail&&this.props.siteOwnerEmail!==e.siteOwnerEmail&&(0,f.navigate)("mailto:"+this.props.siteOwnerEmail)}},{key:"handleNotificationsChange",value:function(){this.setState({saveNotificationsEnabled:!0,wantsEmail:!this.state.wantsEmail})}},{key:"handleClickSaveNotifications",value:function(){this.setState({saveNotificationsEnabled:!1}),this.props.updateProfile({receive_news:this.state.wantsEmail},c.NF.session.current_user().external_id())}},{key:"handleMarketplaceViewDetailsClick",value:function(){(0,f.navigate)((0,f.path)("sellingSetupLandingRedirection"))}},{key:"handleEditProfileClick",value:function(){(0,f.navigate)((0,f.path)("editProfile"))}},{key:"handleUpgradePlanClick",value:function(){this.props.isDefaultCommunity?(0,f.navigate)("/commerce/purchase_learn"):this.props.changeCommunity(this.props.defaultCommunityHostname,"/commerce/purchase_learn")}},{key:"handlePaymentDetailsClick",value:function(){this.props.isDefaultCommunity?(0,f.navigate)((0,f.path)("viewStatus")):this.props.changeCommunity(this.props.defaultCommunityHostname,(0,f.path)("viewStatus"))}},{key:"handleSiteAdminContactClick",value:function(){this.props.retrieveSiteOwnerEmail()}},{key:"handleDeleteAccountClick",value:function(){(new h.default).show()}},{key:"handleRemoveAuthorizedApp",value:function(e){this.props.removeAuthorizedApp(e)}},{key:"renderSubscriptionStartDate",value:function(){return this.props.subscriptionStartDate&&r.default.createElement("div",{dangerouslySetInnerHTML:{__html:(0,u.resource)("content.startDateDay",this.props.subscriptionStartDate)}})}},{key:"renderSubscriptionEndDate",value:function(){return this.props.subscriptionEndDate&&r.default.createElement("div",{dangerouslySetInnerHTML:{__html:(0,u.resource)("content.renewalDate",this.props.subscriptionEndDate)}})}},{key:"renderSiteInfo",value:function(){return this.props.isLearn&&r.default.createElement("div",{className:"formRow"},r.default.createElement("label",{className:"formLabel bold"},(0,u.resource)("content.included")),r.default.createElement("div",{dangerouslySetInnerHTML:{__html:(0,u.resource)("content.maxNumOfSiteUsers",this.props.currentUsers,this.props.maxUsers)}}),this.renderContentLibraries())}},{key:"renderPaymentDetailsLink",value:function(){return!this.props.isBasic&&r.default.createElement("a",{onClick:this.handlePaymentDetailsClick,className:"standardLink"},(0,u.resource)("action.viewPaymentDetails"))}},{key:"renderSiteAdminContactLink",value:function(){if(!this.props.isDefaultCommunity&&this.props.isSiteTeacher)return r.default.createElement("div",null,r.default.createElement("label",{onClick:this.handleSiteAdminContactClick,dangerouslySetInnerHTML:{__html:(0,u.resource)("action.contactSiteAdmin")}}))}},{key:"renderPlanSection",value:function(){return this.props.currentSubscription?r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("content.plan")),r.default.createElement("div",{className:"infoWrapper"},this.props.paymentInfoRetrieved?r.default.createElement("div",null,r.default.createElement("div",{className:"planName"},this.props.isDefaultCommunity?this.props.currentSubscription.plan.name:"Noteflight Learn"),r.default.createElement("div",{className:"formRow"},this.renderSubscriptionStartDate(),this.renderSubscriptionEndDate()),this.renderSiteInfo(),this.renderSiteAdminContactLink(),this.renderUpgradePlanButton()):r.default.createElement(l.default,null))):null}},{key:"renderUpgradePlanButton",value:function(){if(this.props.isDefaultCommunity||!this.props.isDefaultCommunity&&this.props.isSiteAdmin)return r.default.createElement("div",{className:"buttonsWrapper"},r.default.createElement("button",{className:"right premiumColors",onClick:this.handleUpgradePlanClick},(0,u.resource)("action.upgradeYourPlan")),this.renderPaymentDetailsLink(),r.default.createElement("div",{className:"clearFloat"}))}},{key:"renderContentLibraries",value:function(){return this.props.contentLibraries?this.props.contentLibraries.map(function(e){var t="contentLibrary.".concat(e.code);return r.default.createElement("div",{key:e.code},r.default.createElement("label",{className:"marginRight5"},(0,u.resource)(t)),r.default.createElement("label",{className:"formLabel",dangerouslySetInnerHTML:{__html:(0,u.resource)("content.maxNumOfUsers",e.current_users,e.max_users)}}))}):null}},{key:"renderMarketplaceIdentityInfo",value:function(){return this.props.sellerVerificationRequired?this.props.sellerVerificationNeeded?r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle error marginRight15"},r.default.createElement("i",{className:"fa fa-exclamation","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.marketplaceVerificationNeeded"))):this.props.sellerVerificationComplete?r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle checked marginRight15"},r.default.createElement("i",{className:"fa fa-check","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.marketplaceVerificationValidated"))):r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle error marginRight15"},r.default.createElement("i",{className:"fa fa-exclamation","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.marketplaceVerifictionPending"))):null}},{key:"renderMarketplaceSellerInfo",value:function(){return this.props.hasSellerAccount&&r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle checked marginRight15"},r.default.createElement("i",{className:"fa fa-check","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.yourSellerInfoIsComplete")))}},{key:"renderMarketplacePayoutInfo",value:function(){return this.props.hasSellerAccount&&(this.props.marketplacePayoutInfoComplete?r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle checked marginRight15"},r.default.createElement("i",{className:"fa fa-check","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.yourMarketplaceInfoIsComplete"))):r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"circle error marginRight15"},r.default.createElement("i",{className:"fa fa-exclamation","aria-hidden":"true"})),r.default.createElement("span",null,(0,u.resource)("content.yourMarketplaceInfoIsIncomplete"))))}},{key:"renderMarketplaceSection",value:function(){return c.NF.session.showSellerFeatures()&&this.props.isDefaultCommunity?r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.marketplaceSelling")),r.default.createElement("div",{className:"infoWrapper"},this.props.marketplaceInfoRetrieved?r.default.createElement("div",null,this.renderMarketplaceIdentityInfo(),this.renderMarketplaceSellerInfo(),this.renderMarketplacePayoutInfo(),!this.props.hasSellerAccount&&r.default.createElement("span",null,(0,u.resource)("content.signUpToSell")),r.default.createElement("div",{className:"buttonsWrapper"},r.default.createElement("button",{className:"right premiumColors",onClick:this.handleMarketplaceViewDetailsClick},(0,u.resource)("action.viewDetails")),r.default.createElement("div",{className:"clearFloat"}))):r.default.createElement(l.default,null))):null}},{key:"renderNotifications",value:function(){if(this.props.isDefaultCommunity)return r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.notifications")),r.default.createElement("div",{className:"infoWrapper"},r.default.createElement("div",{className:"formRow"},r.default.createElement("input",{id:"wantsEmail",type:"checkbox",className:"checboxInput marginRight5",checked:this.state.wantsEmail,onChange:this.handleNotificationsChange}),r.default.createElement("label",{htmlFor:"wantsEmail"},(0,u.resource)("content.wantsEmail"))),this.state.saveNotificationsEnabled&&r.default.createElement("div",{className:"buttonsWrapper"},r.default.createElement("button",{className:"right premiumColors",onClick:this.handleClickSaveNotifications},(0,u.resource)("action.update")),r.default.createElement("div",{className:"clearFloat"}))))}},{key:"renderFullLocation",value:function(){return c.NF.session.current_user().fullLocation()&&r.default.createElement("div",null,r.default.createElement("span",{className:"marginRight5"},(0,u.resource)("content.location"),":"),r.default.createElement("span",{className:"bold"},c.NF.session.current_user().fullLocation()))}},{key:"renderAboutMe",value:function(){return c.NF.session.current_user().profile().about_me()&&r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"bold"},(0,u.resource)("content.bio")),r.default.createElement("div",{dangerouslySetInnerHTML:{__html:(0,p.markdownToHtml)(c.NF.session.current_user().profile().about_me())}}))}},{key:"renderProfileSection",value:function(){return c.NF.session.current_user()&&r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.profileSummary")),r.default.createElement("div",{className:"infoWrapper"},r.default.createElement("div",{className:"formRow"},r.default.createElement("div",null,r.default.createElement("span",{className:"marginRight5"},(0,u.resource)("content.username"),":"),r.default.createElement("span",{className:"bold"},c.NF.session.current_user().username())),r.default.createElement("div",null,r.default.createElement("span",{className:"marginRight5"},(0,u.resource)("content.joinedOnly"),":"),r.default.createElement("span",{className:"bold"},(0,d.formatDate)(c.NF.session.current_user().created()))),this.renderFullLocation()),this.renderAboutMe(),r.default.createElement("div",{className:"buttonsWrapper"},r.default.createElement("button",{className:"right premiumColors",onClick:this.handleEditProfileClick},(0,u.resource)("action.editProfileCaps")),r.default.createElement("a",{href:(0,f.path)("profile",{userId:c.NF.session.current_user().external_id()}),className:"standardLink"},(0,u.resource)("action.viewProfile")),r.default.createElement("div",{className:"clearFloat"}))))}},{key:"renderDeleteAcccountSection",value:function(){return this.props.isDefaultCommunity?this.renderDeleteAccountButton():!this.props.isDefaultCommunity&&this.props.isSiteAdmin?this.renderDeleteAccountLearnAdmin():null}},{key:"renderDeleteAccountButton",value:function(){return r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.deleteAccount")),r.default.createElement("div",{className:"infoWrapper"},r.default.createElement("div",{className:"formRow",dangerouslySetInnerHTML:{__html:(0,u.resource)("content.deleteAccountText")}}),r.default.createElement("div",{className:"buttonsWrapper"},r.default.createElement("button",{className:"right premiumColors",onClick:this.handleDeleteAccountClick},(0,u.resource)("action.deleteAccount")),r.default.createElement("div",{className:"clearFloat"}))))}},{key:"renderDeleteAccountLearnAdmin",value:function(){return r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.deleteAccount")),r.default.createElement("div",{className:"infoWrapper"},r.default.createElement("div",{className:"formRow",dangerouslySetInnerHTML:{__html:(0,u.resource)("content.deleteAccountLearnText")}})))}},{key:"renderAuthorizedAppsSection",value:function(){var e=this;return this.props.authorizedApps&&0!=this.props.authorizedApps.length?r.default.createElement("div",{className:"sectionInRow"},r.default.createElement("div",{className:"title"},(0,u.resource)("account.connectedApplications")),this.props.authorizedApps.map(function(t){return e.renderAuthorizedApp(t)})):null}},{key:"renderAuthorizedApp",value:function(e){var t=this;return r.default.createElement("div",{key:e.app_id,className:"infoWrapper"},r.default.createElement("div",{className:"formRow oauthRequestAccess connectedApps columnsContainer"},r.default.createElement("div",{className:"column column1 marginRight10"},r.default.createElement("div",{className:"oauthImageLink ".concat(e.app_name)}),r.default.createElement("label",{className:"orangeText bold"},(0,u.resource)("oauth.appNames.".concat(e.app_name)))),r.default.createElement("div",{className:"column column2 marginRight10"},e.scopes.map(function(e){return t.renderScope(e)})),r.default.createElement("div",{className:"column column3 marginRight10"},(0,d.formatDate)(e.created_at)),r.default.createElement("div",{className:"column column4"},r.default.createElement("div",null,r.default.createElement("button",{className:"right premiumColors",onClick:function(){return t.handleRemoveAuthorizedApp(e.app_id)}},(0,u.resource)("action.remove")),r.default.createElement("div",{className:"clearFloat"})))))}},{key:"renderScope",value:function(e){return r.default.createElement("div",{key:e},(0,u.resource)("content.oauth.scopes.".concat(e)))}},{key:"render",value:function(){return r.default.createElement("div",null,r.default.createElement("div",{className:"accountProfile accountDetails modernForm medium"},r.default.createElement("div",{className:"columnsContainer section paddingLeft0 paddingRight0 doubleWidth flex"},r.default.createElement("div",{className:"firstColumn"},this.renderPlanSection(),this.renderMarketplaceSection(),this.renderNotifications()),r.default.createElement("div",{className:"secondColumn"},this.renderProfileSection(),this.renderDeleteAcccountSection(),this.renderAuthorizedAppsSection()))))}}]),t}();t.AccountDetails=S;var w=(0,n.connect)(s.accountDetailsSelector,{updateProfile:i.updateProfile,retrieveSellerAccount:i.retrieveSellerAccount,retrieveSellerPayoutDestination:i.retrieveSellerPayoutDestination,paymentInfo:i.paymentInfo,changeCommunity:a.changeCommunity,retrieveSiteOwnerEmail:i.retrieveSiteOwnerEmail,retrieveAuthorizedApps:i.retrieveAuthorizedApps,removeAuthorizedApp:i.removeAuthorizedApp})(S);t.default=w},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProfile=function(e,t){return{type:r.UPDATE_PROFILE.REQUESTED,profile:e,externalId:t}},t.retrieveSellerAccount=function(){return{type:r.RETRIEVE_SELLER_ACCOUNT.REQUESTED}},t.retrieveSellerPayoutDestination=function(){return{type:r.RETRIEVE_SELLER_PAYOUT_DESTINATION.REQUESTED}},t.checkSellerPayoutDestinationStatus=function(){return{type:r.CHECK_SELLER_PAYOUT_DESTINATION_STATUS.REQUESTED}},t.paymentInfo=function(){return{type:r.PAYMENT_INFO.REQUESTED}},t.retrieveSiteOwnerEmail=function(){return{type:r.SITE_OWNER_EMAIL.REQUESTED}},t.retrieveAuthorizedApps=function(){return{type:r.RETRIEVE_AUTHORIZED_APPS.REQUESTED}},t.removeAuthorizedApp=function(e){return{type:r.REMOVE_AUTHORIZED_APP.REQUESTED,appId:e}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(64))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accountDetailsSelector=t.accountSelector=void 0;var r=o(12),n=o(259),i=o(41),a=o(439),s=o(440),l=function(e){return e.account};t.accountSelector=l;var c=(0,r.createSelector)(i.isDefaultCommunitySelector,l,i.isSiteStudentSelector,i.isSiteTeacherSelector,i.isSiteAdminSelector,a.communityChangeSelector,s.defaultCommunityHostnameSelector,function(e,t,o,r,i,a,s){var l=(0,n.figureOutCurrentSubscription)(t.subscriptions,t.credits),c=(0,n.isBasicSubscription)(l),u=(0,n.isLearnSubscription)(l),d=null,p=null;l&&(d=(0,n.extractSubscriptionStartDate)(l),p=(0,n.extractSubscriptionEndDate)(l));var f=null,h=null,m=null;return t.summary&&(h=t.summary.current_users,f=t.summary.max_users,m=t.summary.content_libraries),{isDefaultCommunity:e,defaultCommunityHostname:s,isSiteStudent:o,isSiteTeacher:r,isSiteAdmin:i,hasSellerAccount:t.hasSellerAccount,sellerVerificationComplete:t.sellerVerificationComplete,sellerVerificationRequired:t.sellerVerificationRequired,sellerVerificationNeeded:t.sellerVerificationNeeded,marketplacePayoutInfoComplete:t.marketplacePayoutInfoComplete,paymentInfoRetrieved:t.paymentInfoRetrieved,marketplaceInfoRetrieved:t.marketplaceInfoRetrieved,communityChangeUrl:a,siteOwnerEmail:t.siteOwnerEmail,currentSubscription:l,subscriptionStartDate:d,subscriptionEndDate:p,currentUsers:h,maxUsers:f,contentLibraries:m,isBasic:c,isLearn:u,authorizedApps:t.authorizedApps}});t.accountDetailsSelector=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.communityChangeSelector=void 0;t.communityChangeSelector=function(e){return e.generic.communityChangeUrl}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultCommunityHostnameSelector=t.defaultCommunitySelector=void 0;var r=o(12),n=o(34),i=(0,r.createSelector)(n.communitiesSelector,function(e){for(var t in e)if(e[t].default_community)return e[t]});t.defaultCommunitySelector=i;var a=(0,r.createSelector)(i,function(e){if(e)return e.hostname});t.defaultCommunityHostnameSelector=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(4)),n=c(o(13)),i=o(0),a=o(2),s=o(5),l=o(3);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this))).success=ko.observable(!1),e.busy=ko.observable(!1),e.password=ko.observable(""),e.password.subscribe(function(){r.default.publish(s.REPORTER_CLEAR_ERRORS)}),e.accountDeleted=e.accountDeleted.bind(h(h(e))),e.onFail=e.onFail.bind(h(h(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"accountDeleted",value:function(e){this.busy(!1),this.success(!0)}},{key:"onFail",value:function(){this.busy(!1)}},{key:"doCancel",value:function(){return this.hide(),!0}},{key:"deleteAccount",value:function(){this.busy(!0),r.default.publish(s.REPORTER_CLEAR_ERRORS),NF.apiService.deleteAccountService((0,i.resource)("action.deleting"),this.accountDeleted,{password:this.password()},{fail:this.onFail})}},{key:"redirectToHomePage",value:function(){(0,a.navigate)((0,a.path)("loggedInHome"))}},{key:"show",value:function(){return(0,l.createAndShowDialog)({viewModel:this,templateName:"dialogs/deleteAccount"}),this}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SongCatalog=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(443),a=f(o(260)),s=o(6),l=o(0),c=o(2),u=o(36),d=f(o(35)),p=o(444);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?v(e):t}(this,g(t).call(this,e))).state={title:"",contributors:""},o.handleTitleChange=o.handleTitleChange.bind(v(v(o))),o.handleContributorsChange=o.handleContributorsChange.bind(v(v(o))),o.search=o.search.bind(v(v(o))),o.debouncedSearch=d.default.debounce(o.search,250),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,r.Component),function(e,t,o){t&&m(e.prototype,t),o&&m(e,o)}(t,[{key:"componentDidUpdate",value:function(e){this.props.songsFound!=e.songsFound&&(0,u.initializeTippy)()}},{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value},this.debouncedSearch)}},{key:"handleContributorsChange",value:function(e){this.setState({contributors:e.target.value},this.debouncedSearch)}},{key:"handleSignupButton",value:function(){s.NF.analytics.trackEvent("Marketplace","signup","song_catalog"),s.NF.appViewModel.showSignupForm()}},{key:"search",value:function(){this.props.songSearch(this.state.title,this.state.contributors)}},{key:"renderHeader",value:function(){return r.default.createElement("div",{className:"header headerBanner"},r.default.createElement("div",{className:"titleWrapper centeredPageWithMaxWidth"},r.default.createElement("span",null,(0,l.resource)("content.noteflightMarketplace")),r.default.createElement("span",null,(0,l.resource)("content.songCatalog"))))}},{key:"renderSignupButton",value:function(){return!s.NF.session.current_user()&&r.default.createElement("div",{className:"buttonsWrapper centered"},r.default.createElement("button",{className:"premiumColorsInverse withShadow withPaddingEverywhere",onClick:this.handleSignupButton},(0,l.resource)("action.signupToSell")))}},{key:"renderSongResults",value:function(){if(!this.state.title&&!this.state.contributors)return null;var e=this.props.songsFound.map(function(e){return r.default.createElement(a.default,{song:e,key:e.id})});return r.default.createElement("div",{className:"workSearchResults modernLook"},r.default.createElement("div",{className:"searchedWorks"},e))}},{key:"renderBody",value:function(){return r.default.createElement("div",{className:"body centeredPageWithMaxWidth songMatching"},r.default.createElement("span",{className:"descriptionText withPadding"},(0,l.resource)("content.songCatalogDescription")),r.default.createElement("div",{className:"songSearchContainer"},r.default.createElement("span",{className:"songSearchContainerTitle"},(0,l.resource)("content.searchToFindSong")),r.default.createElement("div",{className:"columnsContainer"},r.default.createElement("div",{className:"firstColumn"},r.default.createElement("div",{className:"songInputs"},r.default.createElement("i",{className:"searchableIcon fa fa-search","aria-hidden":"true"}),r.default.createElement("input",{type:"text",value:this.state.title,placeholder:(0,l.resource)("content.enterTitle"),onChange:this.handleTitleChange})),r.default.createElement("div",{className:"songInputs"},r.default.createElement("i",{className:"searchableIcon fa fa-search","aria-hidden":"true"}),r.default.createElement("input",{type:"text",value:this.state.contributors,placeholder:(0,l.resource)("content.enterArtistsComposersSongwriters"),onChange:this.handleContributorsChange})),this.renderSongResults()),r.default.createElement("div",{className:"secondColumn"},r.default.createElement("span",{className:"songSearchContainerDescription descriptionText",dangerouslySetInnerHTML:{__html:(0,l.resource)("content.songNotPresentInCatalog",(0,c.path)("marketplaceSearchQuery",{searchQuery:"sellable_arrangements:true"}))}})))),this.renderSignupButton())}},{key:"render",value:function(){return r.default.createElement("div",{className:"scrollingPage modernForm small songCatalog paddingForPhone"},this.renderHeader(),this.renderBody())}}]),t}();t.SongCatalog=y;var _=(0,n.connect)(p.songsFoundSelector,{songSearch:i.songSearch})(y);t.default=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.songSearch=function(e,t){return{type:r.SONG_SEARCH.REQUESTED,title:e,contributors:t}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(70))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.songsFoundSelector=t.songsFoundIdsSelector=void 0;var r=o(12),n=o(34),i=o(48),a=function(e){return e.songCatalog.songsFoundIds};t.songsFoundIdsSelector=a;var s=(0,r.createSelector)(a,n.songsSelector,function(e,t){return{songsFound:(0,i.hydrateIdList)(e,t)}});t.songsFoundSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.CommunityPage=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=y(o(18)),a=o(8),s=o(446),l=y(o(98)),c=y(o(249)),u=y(o(447)),d=y(o(448)),p=y(o(199)),f=o(19),h=o(6),m=o(0),g=o(2),b=o(449),v=y(o(32));function y(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var P=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?E(e):t}(this,w(t).call(this,e))).state={currentScoresTabId:h.NF.session.community().default_community()?a.RECENT_FAVES:a.RECENT_SCORES,currentGroupsTabId:h.NF.session.current_user()?a.MY_GROUPS:a.ALL_GROUPS},o.handleScoresTabClick=o.handleScoresTabClick.bind(E(E(o))),o.handleGroupsTabClick=o.handleGroupsTabClick.bind(E(E(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,r.Component),function(e,t,o){t&&S(e.prototype,t),o&&S(e,o)}(t,[{key:"componentDidMount",value:function(){this.getScoresCurrentView(),this.getGroupsCurrentView()}},{key:"componentDidUpdate",value:function(e,t){this.state.currentScoresTabId!=t.currentScoresTabId&&this.getScoresCurrentView(),this.state.currentGroupsTabId!=t.currentGroupsTabId&&this.getGroupsCurrentView()}},{key:"getScoresCurrentView",value:function(){this.state.currentScoresTabId==a.RECENT_FAVES?this.props.listFavorites(a.WEEK):this.state.currentScoresTabId==a.ALL_TIME_FAVES?this.props.listFavorites(a.ALL):this.props.listScores()}},{key:"getGroupsCurrentView",value:function(){var e=h.NF.session.community().default_community()?12:99999;this.state.currentGroupsTabId==a.MY_GROUPS?this.props.listUserGroups(h.NF.session.current_user().external_id(),a.TITLE,e):this.props.listGroups(a.POPULAR,e)}},{key:"handleScoresTabClick",value:function(e){this.setState({currentScoresTabId:e})}},{key:"handleGroupsTabClick",value:function(e){this.setState({currentGroupsTabId:e})}},{key:"handleCreateGroupClick",value:function(){h.NF.session.current_user().has_premium_features()?(0,g.navigate)((0,g.path)("newGroup")):(0,v.default)((0,m.resource)("action.newGroupTitle"),(0,m.resource)("action.newGroup"),"new_group")}},{key:"getScoresToShow",value:function(){switch(this.state.currentScoresTabId){case a.RECENT_FAVES:case a.ALL_TIME_FAVES:return this.props.favoritesList;case a.RECENT_SCORES:return this.props.scoresList}}},{key:"getScoresLoadingFlagToShow",value:function(){switch(this.state.currentScoresTabId){case a.RECENT_FAVES:case a.ALL_TIME_FAVES:return this.props.favoritesListLoaded;case a.RECENT_SCORES:return this.props.scoresListLoaded}}},{key:"renderScores",value:function(){var e=this.getScoresToShow();return this.getScoresLoadingFlagToShow()?0==e.length?r.default.createElement("div",{className:"noScores"},(0,m.resource)("content.noScores")):r.default.createElement(l.default,{renderer:u.default,models:e,styleClasses:"grid communityScores"}):r.default.createElement(p.default,null)}},{key:"renderGroups",value:function(){var e=this.state.currentGroupsTabId==a.MY_GROUPS?this.props.userGroupsList:this.props.groupsList,t=(0,f.isPhoneLayoutOrSmaller)()?"min176":"min270";return r.default.createElement("div",{id:"groupsList"},r.default.createElement("div",{className:"clearFloat"},0==e.length?r.default.createElement(p.default,null):r.default.createElement(l.default,{renderer:d.default,models:e,styleClasses:"grid ".concat(t)})))}},{key:"renderPublicScoresSection",value:function(){return r.default.createElement("div",{className:"scoresSection"},r.default.createElement("span",{className:"pageSectionTitle"},(0,m.resource)("content.publicScores")),r.default.createElement("div",{className:"subNavCategories noFloat"},r.default.createElement("ul",{className:"subNavList"},!h.NF.session.community().default_community()&&r.default.createElement(c.default,{id:a.RECENT_SCORES,name:(0,m.resource)("content.recentScores"),selected:this.state.currentScoresTabId==a.RECENT_SCORES,clickHandler:this.handleScoresTabClick}),h.NF.session.community().default_community()&&r.default.createElement("div",null,r.default.createElement(c.default,{id:a.RECENT_FAVES,name:(0,m.resource)("content.popular"),selected:this.state.currentScoresTabId==a.RECENT_FAVES,clickHandler:this.handleScoresTabClick}),r.default.createElement(c.default,{id:a.ALL_TIME_FAVES,name:(0,m.resource)("content.allTime"),selected:this.state.currentScoresTabId==a.ALL_TIME_FAVES,clickHandler:this.handleScoresTabClick}))),(0,f.isPhoneLayoutOrSmaller)()?null:r.default.createElement("a",{className:"standardLink right",href:(0,g.path)("allScores")},(0,m.resource)("content.viewAllPublicScores"))),(0,f.isPhoneLayoutOrSmaller)()?r.default.createElement("a",{className:"standardLink topRightLink",href:(0,g.path)("allScores")},(0,m.resource)("action.viewAll")):null,r.default.createElement("div",{className:"clearFloat"},this.renderScores()))}},{key:"renderCreateGroupLink",value:function(){return h.NF.session.current_user()&&(h.NF.session.community().permissions.can_create_group()||h.NF.session.community().default_community())&&r.default.createElement("div",{id:"createGroupButton",className:"standardLink inline",onClick:this.handleCreateGroupClick},r.default.createElement("i",{className:"orangeText marginRight10 fa fa-plus-circle","aria-hidden":"true"}),r.default.createElement("span",null,(0,m.resource)("action.createAGroup")))}},{key:"renderGroupsSubNavList",value:function(){return r.default.createElement("div",null,h.NF.session.current_user()?r.default.createElement(c.default,{id:a.MY_GROUPS,name:(0,m.resource)("content.myGroups"),selected:this.state.currentGroupsTabId==a.MY_GROUPS,clickHandler:this.handleGroupsTabClick}):null,r.default.createElement(c.default,{id:a.ALL_GROUPS,name:(0,m.resource)("content.communityGroupsTitleWithoutClasses",h.NF.session.community().name()),selected:this.state.currentGroupsTabId==a.ALL_GROUPS,clickHandler:this.handleGroupsTabClick}))}},{key:"renderGroupsSection",value:function(){var e=this.state.currentGroupsTabId==a.MY_GROUPS?"personal":"public";return r.default.createElement("div",{className:"groupsSection ".concat(e)},r.default.createElement("span",{className:"pageSectionTitle"},(0,m.resource)("content.groups")),r.default.createElement("div",{className:"subNavCategories noFloat"},r.default.createElement("ul",{className:"subNavList"},this.renderGroupsSubNavList()),this.renderCreateGroupLink(),(0,f.isPhoneLayoutOrSmaller)()?null:r.default.createElement("a",{className:"standardLink right",href:(0,g.path)("groups")},(0,m.resource)("content.viewAllGroups"))),(0,f.isPhoneLayoutOrSmaller)()?r.default.createElement("a",{className:"standardLink topRightLink",href:(0,g.path)("groups")},(0,m.resource)("action.viewAll")):null,this.renderGroups())}},{key:"render",value:function(){return r.default.createElement("div",{className:"community scrollingPage modernForm paddingForPhone"},r.default.createElement("div",{className:"communitySection"},this.renderPublicScoresSection()),r.default.createElement("div",{className:"communitySection noBorder"},this.renderGroupsSection()))}}]),t}();t.CommunityPage=P,P.propTypes={userGroupsList:i.default.arrayOf(i.default.object).isRequired,groupsList:i.default.arrayOf(i.default.object).isRequired,favoritesList:i.default.arrayOf(i.default.object).isRequired,scoresList:i.default.arrayOf(i.default.object).isRequired,favoritesListLoaded:i.default.bool.isRequired,scoresListLoaded:i.default.bool.isRequired,groupsListLoaded:i.default.bool.isRequired,userGroupsListLoaded:i.default.bool.isRequired,listFavorites:i.default.func.isRequired,listScores:i.default.func.isRequired,listUserGroups:i.default.func.isRequired,listGroups:i.default.func.isRequired};var C=(0,n.connect)(b.communityPageSelector,{listFavorites:s.listFavorites,listScores:s.listScores,listUserGroups:s.listUserGroups,listGroups:s.listGroups})(P);t.default=C},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listFavorites=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.ALL,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.MAX_PER_PAGE,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{type:r.LIST_FAVORITES.REQUESTED,age:e,maxCount:t,startIndex:o}},t.listScores=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.MOST_RECENT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.MAX_PER_PAGE,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{type:r.LIST_SCORES.REQUESTED,order:e,maxCount:t,startIndex:o}},t.listUserGroups=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.MAX_PER_PAGE,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{type:r.LIST_USER_GROUPS.REQUESTED,userId:e,order:t,maxCount:o,startIndex:i}},t.listGroups=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.MAX_PER_PAGE,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{type:r.LIST_GROUPS.REQUESTED,order:e,maxCount:t,startIndex:o}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(66)),n=o(8)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=u(o(18)),i=o(2),a=o(15),s=u(o(118)),l=o(0),c=u(o(99));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?m(e):t}(this,f(t).call(this,e))).handleOnClick=o.handleOnClick.bind(m(m(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r.Component),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"handleOnClick",value:function(){(0,i.navigate)(this.props.url)}},{key:"renderAudioPreview",value:function(){return r.default.createElement(c.default,{id:this.props.id,hasCustomAudioMedia:this.props.has_custom_audio_media,url:this.props.audio_preview_path})}},{key:"render",value:function(){var e=this.props.favorites_count>0?(0,a.abbreviateNumber)(this.props.favorites_count):"",t=this.props.views_count>0?(0,a.abbreviateNumber)(this.props.views_count):"",o=this.props.comments_count>0?(0,a.abbreviateNumber)(this.props.comments_count):"";return r.default.createElement("div",{className:"scoreItem withCoverArt","data-type":"CollectionDocument"},r.default.createElement("div",{className:"left"},r.default.createElement(s.default,{size:"",backgroundImageUrl:this.props.cover_art_url},this.renderAudioPreview())),r.default.createElement("span",{className:"defaultCursor"},r.default.createElement("div",{className:"scoreBody",onClick:this.handleOnClick},r.default.createElement("div",{className:"socialBits floatRight"},r.default.createElement("div",null,r.default.createElement("div",{className:"socialBit faves ".concat(0===this.props.favorites_count?"filler":"")},e),r.default.createElement("div",{className:"socialBit views ".concat(0===this.props.views_count?"filler":"")},t),r.default.createElement("div",{className:"socialBit comments ".concat(0===this.props.comments_count?"filler":"")},o))),r.default.createElement("div",{className:"title"},r.default.createElement("span",null,this.props.title),r.default.createElement("a",{href:this.props.author.homepage_uri,className:"author"},r.default.createElement("span",{className:"marginRight5 marginLeft5"},(0,l.resource)("content.authorPrefix")),r.default.createElement("span",{className:"standardLink"},this.props.author.username))),r.default.createElement("div",{className:"date"}),r.default.createElement("div",{className:"composer"},this.props.composer)),this.props.premium_instruments?r.default.createElement("div",{className:"premium"}):null))}}]),t}();t.default=g,g.propTypes={title:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),i=o(2),a=o(0),s=o(16);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}o(57);var f=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this,e))).handleCardClick=o.handleCardClick.bind(p(p(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"handleCardClick",value:function(){(0,i.navigate)((0,i.path)("viewGroup",{groupId:this.props.id}))}},{key:"renderImage",value:function(){var e=null==this.props.group_logo_id?(0,s.asset)("images/defaultGroup.png"):"/api/1.0/group_logos/".concat(this.props.group_logo_id),t={backgroundImage:"url('".concat(e,"')"),opacity:this.props.archived||this.props.deleted_at?.2:1};return r.default.createElement("div",{className:"image",style:t})}},{key:"renderGoogleClassroomIcon",value:function(){return NF.session.community().is_google_classroom()&&r.default.createElement("div",{className:"googleClassroomGroupIcon small"})}},{key:"renderMemberCount",value:function(){var e=this.props.member_count<1e3?this.props.member_count:Number(this.props.member_count).toLocaleString((0,s.languageCode)()),t=(0,a.pluralize)("content.memberCount",e);return r.default.createElement("div",{className:"memberCount"},t)}},{key:"renderOverview",value:function(){return r.default.createElement("div",{className:"groupDescription",dangerouslySetInnerHTML:{__html:this.props.overview_all}})}},{key:"renderNewActivity",value:function(){return this.props.new_activity&&r.default.createElement("div",{className:"newStuff"},(0,a.resource)("listing.activityNew"))}},{key:"render",value:function(){return r.default.createElement("div",{className:"listingItemContainer"},r.default.createElement("a",{className:"noTextDecoration",href:(0,i.path)("viewGroup",{groupId:this.props.id})},r.default.createElement("div",{className:"groupListingItem"},this.renderImage(),r.default.createElement("div",{className:"content"},this.renderGoogleClassroomIcon(),r.default.createElement("div",{className:"title ellipsify ".concat(NF.session.community().is_google_classroom()?"googleGroup":"")},(0,a.resourceIfFound)(this.props.name)),this.renderMemberCount(),this.renderOverview()),this.renderNewActivity())))}}]),t}();t.default=f,f.propTypes={member_count:n.default.number.isRequired,id:n.default.number.isRequired,group_logo_id:n.default.number,archived:n.default.bool.isRequired,deleted_at:n.default.number,name:n.default.string.isRequired,overview_all:n.default.string.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.communityPageSelector=t.scoresListSelector=t.favoritesListSelector=t.groupsListSelector=t.userGroupsListSelector=void 0;var r=o(12),n=o(34),i=o(48),a=function(e){return e.communityPage.userGroupsList};t.userGroupsListSelector=a;var s=function(e){return e.communityPage.groupsList};t.groupsListSelector=s;var l=function(e){return e.communityPage.favoritesList};t.favoritesListSelector=l;var c=function(e){return e.communityPage.scoresList};t.scoresListSelector=c;var u=(0,r.createSelector)(n.scoresSelector,n.groupsSelector,a,s,l,c,function(e,t,o,r,n,a){return{userGroupsList:(0,i.hydrateIdList)(o.ids,t),groupsList:(0,i.hydrateIdList)(r.ids,t),favoritesList:(0,i.hydrateIdList)(n.ids,e),scoresList:(0,i.hydrateIdList)(a.ids,e),favoritesListLoaded:n.loaded,scoresListLoaded:a.loaded,groupsListLoaded:r.loaded,userGroupsListLoaded:o.loaded}});t.communityPageSelector=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(o(4)),n=o(5),i=d(o(451)),a=o(95),s=d(o(243)),l=o(2),c=o(0),u=o(3);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.existingDestination=ko.observable(!1),this.cardError=ko.observable(""),this.stripe=Stripe(Noteflight.config.stripePublicKey),this.stripeSource=new s.default({style:a.STRIPE_CREDIT_CARD_STYLE,hidePostalCode:!0},"#cardElement",this.cardError.bind(this)),this.stripeToken=ko.observable(""),this.bankAccount=new i.default,this.payoutMethod=ko.observable(""),this.busy=ko.observable(!1),this.payoutMethod.subscribe(function(e){e==a.CARD_TYPE&&t._initializeCardForm()}),this.allowedPayoutMethods=[{value:a.BANK_ACCOUNT_TYPE,label:(0,c.resource)("content.commerce.directDeposit")},{value:a.CARD_TYPE,label:(0,c.resource)("content.commerce.debitCard")}],r.default.subscribe(n.STRIPE_CARD_EDITING_NUMBER,this._clearCardErrors.bind(this)),this.cardFormInitializationCheck=this.cardFormInitializationCheck.bind(this),this._initializeComputeds()}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"_initializeComputeds",value:function(){var e=this;this.isBankAccount=ko.computed(function(){return"bank_account"==e.payoutMethod()}),this.isDebitCard=ko.computed(function(){return e.payoutMethod()==a.CARD_TYPE})}},{key:"_clearErrors",value:function(){r.default.publish(n.REPORTER_CLEAR_ERRORS)}},{key:"_clearCardErrors",value:function(){this.cardError("")}},{key:"_markUnbusy",value:function(){this.busy(!1)}},{key:"_markBusy",value:function(){this.busy(!0)}},{key:"_initializeCardForm",value:function(){this.stripeSource.initializeCardDisplay()}},{key:"_generateBankToken",value:function(e){var t=this;this.stripe.createToken("bank_account",{country:"us",currency:"usd",routing_number:Noteflight.cleanLTR(this.bankAccount.routingCode().trim()),account_number:this.bankAccount.accountNumber().trim(),account_holder_name:this.bankAccount.nameOnAccount().trim(),account_holder_type:this.bankAccount.accountType()}).then(function(o){o.error?r.default.publish(n.REPORTER_ADD_ERROR,{message:o.error.message,code:"bankTokenError"}):e.call(t,o.token)})}},{key:"_save",value:function(e){this.stripeToken(e.id),this.existingDestination()?this._editPayoutDestination():this._saveNewPayoutDestination()}},{key:"_generateCardTokenOptions",value:function(){return{currency:"usd",address_country:"US"}}},{key:"_generateTokenAndSave",value:function(){this.isBankAccount()?this._generateBankToken(this._save):this.stripeSource.generateCardToken(this._generateCardTokenOptions(),this._save.bind(this))}},{key:"_buildSaveParams",value:function(){return{token:this.stripeToken()}}},{key:"_setFields",value:function(e){this.payoutMethod(e.type),this.isBankAccount()&&(this.bankAccount.nameOnAccount(e.account_holder_name),this.bankAccount.routingCode(e.routing_number),this.bankAccount.accountType(e.account_holder_type))}},{key:"_findExistingSellerAccount",value:function(){var e=this;this._markBusy(),NF.apiService.retrieveSellerAccount((0,c.resource)("action.loading"),function(t){t&&Object.keys(t).length>0?e._findExistingPayoutDestination():(e._markUnbusy(),(0,l.navigate)((0,l.path)("sellingSetup")))},{},{fail:this._markUnbusy.bind(this)})}},{key:"_findExistingPayoutDestination",value:function(){var e=this;NF.apiService.retrieveSellerPayoutDestination((0,c.resource)("action.loading"),function(t){t&&Object.keys(t).length>0&&(e.existingDestination(!0),e._setFields(t)),e._markUnbusy()},{},{fail:this._markUnbusy.bind(this)})}},{key:"_editPayoutDestination",value:function(){var e=this;this._markBusy();var t=this._buildSaveParams();NF.apiService.updateSellerPayoutDestination((0,c.resource)("action.saving"),function(t){e._markUnbusy(),(0,l.navigate)((0,l.path)("sellingSetupLanding"))},t,{fail:this._markUnbusy.bind(this)})}},{key:"_saveNewPayoutDestination",value:function(){var e=this;this._markBusy();var t=this._buildSaveParams();NF.apiService.createSellerPayoutDestination((0,c.resource)("action.saving"),function(t){e._markUnbusy(),NF.session.current_user().has_payout_destination(!0),r.default.publish(n.SELLER_SIGNUP_HAS_ACCOUNT),(0,l.navigate)((0,l.path)("sellingSetupLanding"))},t,{fail:this._markUnbusy.bind(this)})}},{key:"_deleteSellerAccount",value:function(){var e=this;this._markBusy(),NF.apiService.deleteSellerAccount((0,c.resource)("action.deleting"),function(t){e._markUnbusy(),r.default.publish(n.SELLER_SIGNUP_RESET),NF.session.current_user().has_seller_account(!1),(0,l.navigate)((0,l.path)("sellingSetup"))},{},{fail:this._markUnbusy.bind(this)})}},{key:"cardFormInitializationCheck",value:function(){this.payoutMethod()==a.CARD_TYPE&&this._initializeCardForm()}},{key:"goBack",value:function(){(0,l.navigate)((0,l.path)("sellingSetup"))}},{key:"cancel",value:function(){this.existingDestination()?(0,l.navigate)((0,l.path)("sellingSetupLanding")):(0,u.okCancel)((0,c.resource)("content.commerce.confirmCancelSellerSetup"),this._deleteSellerAccount.bind(this),"dialogs/okBack")}},{key:"doOk",value:function(){if(this._clearErrors(),this.isBankAccount()){var e=this.bankAccount.validate();if(e.length>0)return r.default.publish(n.REPORTER_ADD_ERRORS,e),!1}this._generateTokenAndSave()}},{key:"activate",value:function(){this._findExistingSellerAccount()}}]),e}();t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(95),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nameOnAccount=ko.observable(""),this.routingCode=ko.observable(""),this.accountNumber=ko.observable(""),this.allowedAccountTypes=[{value:r.COMPANY_BANK_ACCOUNT_TYPE,label:(0,n.resource)("content.commerce.companyPlain")},{value:r.INDIVIDUAL_BANK_ACCOUNT_TYPE,label:(0,n.resource)("content.commerce.individualPlain")}],this.accountType=ko.observable(this.allowedAccountTypes[1].value),this.errors=ko.observableArray([])}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"validate",value:function(){var e=[];return(!this.nameOnAccount()||this.nameOnAccount().length<1)&&e.push({code:"invalidNameOnBankAccount",message:(0,n.resource)("errors.invalidNameOnBankAccount")}),(!this.routingCode()||this.routingCode().length<1)&&e.push({code:"invalidBankRoutingNumber",message:(0,n.resource)("errors.invalidBankRoutingNumber")}),(!this.accountNumber()||this.accountNumber().length<1)&&e.push({code:"invalidBankAccountNumber",message:(0,n.resource)("errors.invalidBankAccountNumber")}),(!this.accountType()||this.accountType().length<1)&&e.push({code:"invalidBankAccountType",message:(0,n.resource)("errors.invalidBankAccountType")}),e}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(453),n=c(o(261)),i=c(o(262)),a=o(0),s=o(20),l=o(19);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.transactions=ko.observableArray([]),this.currentBalance=ko.observable(0),this.currentBalanceSymbol=ko.observable("$"),this.currentBalanceDollars=ko.observable("0"),this.currentBalanceCents=ko.observable(".00"),this.pendingFunds=ko.observable("$0.00"),this.payoutErrors=ko.observableArray([]),this.nextPayoutDate=ko.observable(""),this.showNote=ko.observable(!0),this.fetching=ko.observable(!1),this.count=ko.observable(0),this.remaining=ko.observable(!0),this.startIndex=ko.observable(0),this.isMobileLayout=l.isMobileLayout}return function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(e,[{key:"onScroll",value:function(e,t){this.remaining()&&!this.fetching()&&($(t.target).find(".moreItems").position().top-$(t.target).scrollTop()<=$(t.target).outerHeight()&&this.fetchPayouts())}},{key:"fetchPayouts",value:function(){var e={start_index:this.startIndex(),max_count:20};this.fetching(!0),this._retrievePayoutInformation(e)}},{key:"_retrievePayoutInformation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.retrieveSellerPayouts((0,a.resource)("action.loading"),function(t){e._handleData(t)},t)}},{key:"_handleData",value:function(e){this.fetching(!1),this._setCurrentBalance(e.account_balance/100),this.pendingFunds(Noteflight.formatCurrency(e.pending_funds/100,!0,"$",!1)),this.nextPayoutDate((0,s.formatDate)(e.next_payout_date,{monthLong:!0})),this.showNote(e.next_payout_conditional);for(var t=e.transactions,o=0;o<t.length;o++){var n=new r.Transaction(t[o]);this.transactions.push(n)}this.count(e.count),this.remaining(e.remaining),this.startIndex(Math.min(this.startIndex()+20,this.count()))}},{key:"_checkPayoutDestinationHealth",value:function(){var e=this;NF.session.current_user().has_payout_destination()&&NF.apiService.checkSellerPayoutDestinationStatus((0,a.resource)("action.loading"),function(t){t&&t.error_codes&&e.payoutErrors(t.error_codes.filter(function(e){return i.default.includes(e)}).map(function(e){return new n.default(e)}))},{})}},{key:"_setCurrentBalance",value:function(e){this.currentBalance(Noteflight.formatCurrency(e));var t=Noteflight.valueToCurrencyParts(e);this.currentBalanceSymbol(t.symbol),this.currentBalanceDollars(t.dollars),this.currentBalanceCents("."+t.cents)}},{key:"activate",value:function(){this.transactions([]),this.count(0),this.remaining(!0),this.startIndex(0),this._retrievePayoutInformation(),this._checkPayoutDestinationHealth()}}]),e}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=t.BALANCE=t.YOURS=t.PAYOUT_FAILED=t.PAYOUT=t.REFUND=t.COMMISSION=t.SALE=void 0;var r=o(0),n=o(20);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a="sale";t.SALE=a;t.COMMISSION="commission";t.REFUND="refund";t.PAYOUT="payout";t.PAYOUT_FAILED="payout_failed";var s="yours";t.YOURS=s;var l="balance";t.BALANCE=l;var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=t.sale_amount;Number.isInteger(o)&&(o/=100);var r=t.seller_amount;Number.isInteger(r)&&(r/=100);var i=t.acct_balance;Number.isInteger(i)&&(i/=100),this.type=t.type,this.pending=t.pending,this.date=(0,n.formatDate)(t.date),this.description=this._setDescription(this.type),this.detail=t.detail,this.saleAmount=this.formatMoney(o,a),this.yourAmount=this.formatMoney(r,s),this.acctBalance=this.formatMoney(i,l)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"formatMoney",value:function(e,t){var o=Noteflight.formatCurrency(e,!0,"$",!1);return this.type!=a&&"commission"!=this.type||!this.pending||t==l&&(o=""),"refund"==this.type&&(t==a?o="":t==s&&(o=this._parenthesize(o))),"payout"!=this.type&&"payout_failed"!=this.type||(t==a&&(o=""),t==s&&(o=this._parenthesize(o))),o}},{key:"_parenthesize",value:function(e){return"("+e+")"}},{key:"_setDescription",value:function(e){switch(e){case a:return(0,r.resource)("content.commerce.sale");case"commission":return(0,r.resource)("content.commerce.commission");case"refund":return(0,r.resource)("content.commerce.refund");case"payout":return(0,r.resource)("content.commerce.payout");case"payout_failed":return(0,r.resource)("content.commerce.payoutFailed")}}}]),e}();t.Transaction=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VERIFICATION_DOCUMENT=t.PERSONAL_ID_NUMBER=void 0;var r=d(o(4)),n=d(o(261)),i=o(455),a=o(5),s=o(2),l=o(0),c=o(36),u=o(15);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.PERSONAL_ID_NUMBER="legal_entity.personal_id_number";t.VERIFICATION_DOCUMENT="legal_entity.verification.document";var f=["jpg","png"],h=["invalidCurrencyPayoutDestination","invalidCountryPayoutDestination","bankAccountAccountNumber","bankAccountNoAccount","bankAccountValidation","bankAccountClosed","bankAccountDebitNotAuthorized","bankAccountFrozen","bankAccountInsufficientFunds","bankAccountOwnership","bankAccountRestricted","payoutCurrency","payoutUnsupportedCard","payoutDestinationCouldNotProcess","payoutDestinationGeneralError"],m=["errors.bankAccountAccountNumber","errors.bankAccountNoAccount"],g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=l.resource,this.firstName=ko.observable(""),this.lastName=ko.observable(""),this.address=ko.observable(""),this.accountType=ko.observable(""),this.verificationRequested=ko.observable(!1),this.verificationFieldsNeeded=ko.observableArray([]),this.verificationNeededBy=ko.observable(""),this.verificationStatus=ko.observable(""),this.personalIdNumberSubmitted=ko.observable(!1),this.verificationDocumentSubmitted=ko.observable(!1),this.address1=ko.observable(""),this.address2=ko.observable(""),this.city=ko.observable(""),this.postalCode=ko.observable(""),this.state=ko.observable(""),this.phoneNumber=ko.observable(""),this.payoutMethod=ko.observable(""),this.bankAccountType=ko.observable(""),this.bankName=ko.observable(""),this.nameOnAccount=ko.observable(""),this.routingCode=ko.observable(""),this.accountNumber=ko.observable(""),this.cardNumber=ko.observable(""),this.cardBrand=ko.observable(""),this.expirationMonth=ko.observable(""),this.expirationYear=ko.observable(""),this.verificationPersonalIdNumber=ko.observable(""),this.displayedSSN=ko.observable(""),this.verificationDocument=ko.observable(""),this.invalidPersonalIdNumber=ko.observable(!1),this.invalidFileType=ko.observable(!1),this.accountReady=ko.observable(!1),this.payoutDestinationReady=ko.observable(!1),this.payoutDestinationErrors=ko.observableArray([]),this._initializeComputeds(),this.scrollInlineErrorToken=r.default.subscribe(a.SCROLL_INLINE_ERROR,function(e,t){r.default.publish(a.SCROLL_INLINE_ERROR_SCROLLED,{id:t.id})})}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"_checkRedirect",value:function(){NF.session.current_user()&&NF.session.current_user().has_seller_account()||(0,s.navigate)((0,s.path)("sellingSetup"))}},{key:"_initializeComputeds",value:function(){var e=this;this.ready=ko.computed(function(){return e.accountReady()&&e.payoutDestinationReady()}),this.ready.subscribe(function(e){e&&(0,c.initializeTippy)()}),this.hasBankAccount=ko.computed(function(){return!!(e.accountNumber()&&e.accountNumber().length>0)}),this.hasDebitCard=ko.computed(function(){return!!(e.cardNumber()&&e.cardNumber().length>0)}),this.showPayoutDestinationError=ko.computed(function(){return e.payoutDestinationErrors().length||!(e.hasBankAccount()||e.hasDebitCard())}),this.accountIncomplete=ko.computed(function(){return!e.hasBankAccount()&&!e.hasDebitCard()||e.payoutDestinationErrors().length>0}),this.verificationNeeded=ko.computed(function(){return e.verificationFieldsNeeded().length>0&&null!==e.verificationNeededBy()}),this.verified=ko.computed(function(){return!e.verificationNeeded()&&"pending"!=e.verificationStatus()}),this.verificationPersonalIdNumberNeeded=ko.computed(function(){return e.verificationFieldsNeeded().includes("legal_entity.personal_id_number")&&null!==e.verificationNeededBy()}),this.displayedSSN.subscribe(function(t){e.verificationPersonalIdNumber((0,u.stripToNumbers)(t))}),this.verificationDocumentNeeded=ko.computed(function(){return e.verificationFieldsNeeded().includes("legal_entity.verification.document")&&null!==e.verificationNeededBy()}),this.verificationDocument.subscribe(function(){e._validateVerificationDocument()}),this.address=ko.computed(function(){var t=e.address1();return e.address2()&&e.address2().length>0&&(t+=", ".concat(e.address2(),",")),t+=" ".concat(e.city(),", ").concat(e.state()," ").concat(e.postalCode())}),this.expirationDate=ko.computed(function(){return e.expirationMonth()&&e.expirationMonth().toString().length>0&&e.expirationYear()&&e.expirationYear().toString().length>0?e.expirationMonth().toString()+"/"+e.expirationYear().toString():""}),this.showBankAccountErrors=ko.computed(function(){return e.payoutDestinationErrors().some(function(e){return m.includes(e.message)})})}},{key:"_setAccountFields",value:function(e){this.firstName(e.legal_entity.first_name),this.lastName(e.legal_entity.last_name),"individual"==e.legal_entity.type?this.accountType((0,l.resource)("content.commerce.individual")):this.accountType((0,l.resource)("content.commerce.company")),this.address1(e.legal_entity.address.line1),e.legal_entity.address.line2&&e.legal_entity.address.line2.length>0&&this.address2(e.legal_entity.address.line2),this.city(e.legal_entity.address.city),this.state(e.legal_entity.address.state),this.postalCode(e.legal_entity.address.postal_code),this.phoneNumber((0,u.formatUSPhoneNumber)(e.support_phone)),this.verificationRequested(e.verification_requested),this.verificationFieldsNeeded(e.verification_fields_needed),this.verificationNeededBy(e.verification_needed_by),this.verificationStatus(e.legal_entity.verification.status),this.personalIdNumberSubmitted(e.personal_id_number_submitted),this.verificationDocumentSubmitted(e.verification_document_submitted)}},{key:"_setPayoutDestinationFields",value:function(e){"bank_account"==e.type?(this.payoutMethod((0,l.resource)("content.commerce.directDeposit")),this.bankAccountType(e.account_holder_type),this.bankName(e.bank_name),this.nameOnAccount(e.account_holder_name),this.routingCode(e.routing_number),this.accountNumber("****"+e.last4)):(this.payoutMethod((0,l.resource)("content.commerce.debitCard")),this.expirationMonth(e.exp_month),this.expirationYear(e.exp_year),this.cardNumber("****"+e.last4),this.cardBrand(e.brand))}},{key:"_checkPayoutDestinationHealth",value:function(){var e=this;NF.session.current_user().has_payout_destination()&&NF.apiService.checkSellerPayoutDestinationStatus((0,l.resource)("action.loading"),function(t){t&&t.error_codes&&e.payoutDestinationErrors(t.error_codes.filter(function(e){return h.includes(e)}).map(function(e){return new n.default(e)})),e.payoutDestinationReady(!0)},{})}},{key:"_retrieveSellerAccount",value:function(){var e=this;NF.apiService.retrieveSellerAccount("",function(t){t&&Object.keys(t).length>0&&e._setAccountFields(t),e.accountReady(!0)},{})}},{key:"_retrievePayoutDestination",value:function(){var e=this;NF.session.current_user().has_payout_destination()?NF.apiService.retrieveSellerPayoutDestination((0,l.resource)("action.loading"),function(t){t&&Object.keys(t).length>0&&(e._setPayoutDestinationFields(t),e._checkPayoutDestinationHealth())},{}):this.payoutDestinationReady(!0)}},{key:"editAccount",value:function(){(0,s.navigate)((0,s.path)("sellingSetup"))}},{key:"editPayoutDestination",value:function(){(0,s.navigate)((0,s.path)("sellingPayoutDestinationSetup"))}},{key:"handleSSNKeyUp",value:function(){var e=(0,u.liveFormatSSN)(document.getElementById("displayedSSN").value);document.getElementById("displayedSSN").value=e}},{key:"handleFileSelect",value:function(e,t){this.verificationDocument(t.target.files[0])}},{key:"submitSellerVerification",value:function(){var e=[];if(r.default.publish(a.REPORTER_CLEAR_ERRORS),this.verificationPersonalIdNumberNeeded()){if(!this._validatePersonalIdNumber())return;e.push(this._savePersonalIdNumber()),r.default.publish(a.REPORTER_ADD,{text:(0,l.resource)("action.saving")})}if(this.verificationDocumentNeeded()){if(!this._validateVerificationDocument())return;e.push(this._saveVerificationDocument()),r.default.publish(a.REPORTER_ADD,{text:(0,l.resource)("action.saving")})}return Promise.all(e).then(this._verifySuccess).catch(this._verifyFail)}},{key:"_savePersonalIdNumber",value:function(){return(0,i.tokenizePIN)(this.verificationPersonalIdNumber()).then(i.updateAccountPIN)}},{key:"_saveVerificationDocument",value:function(){return(0,i.uploadID)(this.verificationDocument()).then(i.addIDToAccount)}},{key:"_verifySuccess",value:function(e){window.location.reload()}},{key:"_verifyFail",value:function(e){r.default.publish(a.REPORTER_REMOVE),r.default.publish(a.REPORTER_ADD_ERROR,{message:(0,l.resource)("errors.identityVerification"),code:"piiError"})}},{key:"_validatePersonalIdNumber",value:function(){var e=/[0-9]{9}/.test(this.verificationPersonalIdNumber());return e||this.invalidPersonalIdNumber(!0),e}},{key:"_validateVerificationDocument",value:function(){if(""===this.verificationDocument())return this.invalidFileType(!0),!1;var e=this.verificationDocument().name.split(".").pop().toLowerCase(),t=!f.includes(e),o=this.verificationDocument().size/1e6>8;return this.invalidFileType(t||o),!this.invalidFileType()}},{key:"activate",value:function(){this._checkRedirect(),NF.session.current_user()&&NF.session.current_user().has_seller_account()&&NF.session.community().default_community()&&(this._retrieveSellerAccount(),this._retrievePayoutDestination()),(0,c.initializeTippy)()}}]),e}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tokenizePIN=function(e){var t=Stripe(Noteflight.config.stripePublicKey);return new Promise(function(o,r){t.createToken("pii",{personal_id_number:e}).then(function(e){if(e.error)return r(e.error);o(e.token)})})},t.updateAccountPIN=function(e){return new Promise(function(t,o){NF.apiService.updateSellerPersonalIdNumber("",t,{token:e.id},{fail:o})})},t.uploadID=function(e){var t=new FormData;return t.append("file",e),t.append("purpose","identity_document"),new Promise(function(e,o){$.ajax({url:r,data:t,headers:{Authorization:"Bearer "+Noteflight.config.stripePublicKey},cache:!1,contentType:!1,processData:!1,type:"POST"}).done(e).fail(o)})},t.addIDToAccount=function(e){return new Promise(function(t,o){NF.apiService.updateSellerVerificationDocument("",t,{file_id:e.id},{fail:o})})};var r="https://uploads.stripe.com/v1/files"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyAndSecurity=t.default=void 0;var r=b(o(4)),n=o(5),i=b(o(457)),a=b(o(13)),s=b(o(458)),l=b(o(32)),c=o(94),u=o(19),d=o(2),p=o(15),f=o(0),h=o(36),m=o(3),g=o(20);function b(e){return e&&e.__esModule?e:{default:e}}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,o){return t&&k(e.prototype,t),o&&k(e,o),e}var P=function(){function e(){var t=this;w(this,e),this.legalEntity=new s.default,this.dob=new i.default,this.phoneNumber=ko.observable(""),this.displayedPhoneNumber=ko.observable(""),this.displayedBusinessTaxId=ko.observable(""),this.isMobileLayout=u.isMobileLayout,this.searchingForUser=ko.observable(!0),this.showDescriptionPage=ko.observable(!0),this.existingAccount=ko.observable(!1),this.startedAsCompany=ko.observable(!1),this.hasBusinessName=ko.observable(!1),this.busy=ko.observable(!1),this.allowedCountries=ko.observableArray([{value:"US",label:(0,f.resource)("country.unitedStates")}]),this.allowedDays=ko.observableArray([]);var o=[{value:1,label:(0,f.resource)("date.monthLong.0")},{value:2,label:(0,f.resource)("date.monthLong.1")},{value:3,label:(0,f.resource)("date.monthLong.2")},{value:4,label:(0,f.resource)("date.monthLong.3")},{value:5,label:(0,f.resource)("date.monthLong.4")},{value:6,label:(0,f.resource)("date.monthLong.5")},{value:7,label:(0,f.resource)("date.monthLong.6")},{value:8,label:(0,f.resource)("date.monthLong.7")},{value:9,label:(0,f.resource)("date.monthLong.8")},{value:10,label:(0,f.resource)("date.monthLong.9")},{value:11,label:(0,f.resource)("date.monthLong.10")},{value:12,label:(0,f.resource)("date.monthLong.11")}];this.allowedMonths=ko.observableArray(o),this.dob.month.subscribe(function(e){t._recalculateAvailableDays()}),this.dob.year.subscribe(function(e){t._recalculateAvailableDays()}),this.displayedPhoneNumber.subscribe(function(e){t.displayedPhoneNumber((0,p.formatUSPhoneNumber)(e)),t.phoneNumber((0,p.stripToNumbers)(t.displayedPhoneNumber()))}),this.displayedBusinessTaxId.subscribe(function(e){t.legalEntity.businessTaxIdIsPlaceholder()?t.legalEntity.businessTaxId(t.displayedBusinessTaxId()):(t.displayedBusinessTaxId((0,p.liveFormatTaxId)(e)),t.legalEntity.businessTaxId((0,p.stripToNumbers)(t.displayedBusinessTaxId())))}),this.allowedUSStates=ko.observableArray(c.usStatesPlusPR),this.hasSellerAccountOnPageLoad=ko.observable(!1),this._userStateChecked=!1,this.verified=ko.observable(!1),this.lockedFieldHint=ko.computed(function(){return t.verified()?(0,f.resource)("errors.lockedAccountField"):null}),r.default.subscribe(n.SELLER_SIGNUP_RESET,function(e,o){t._resetSellerSignup()}),r.default.subscribe(n.SELLER_SIGNUP_HAS_ACCOUNT,function(e,o){t.hasSellerAccountOnPageLoad(!0)}),this._initializeComputeds()}return E(e,[{key:"_initializeComputeds",value:function(){var e=this;this.showBusinessName=ko.computed(function(){return e.legalEntity.isCompany()||e.hasBusinessName()})}},{key:"startSignupProcess",value:function(){if(!NF.session.current_user()||!NF.session.current_user().premium_member())return(0,l.default)((0,f.resource)("account.marketplaceSelling"),(0,f.resource)("action.sellScores"),"marketplace_selling"),!1;this.hideDescription(),NF.analytics.trackEvent("Marketplace","user_selling_profile_setup","get_started")}},{key:"hideDescription",value:function(){this.showDescriptionPage(!1)}},{key:"_recalculateAvailableDays",value:function(){var e=[];(0,g.daysForMonth)(this.dob.month(),this.dob.year()).forEach(function(t){e.push({value:t,label:t})}),this.allowedDays(e)}},{key:"_clearErrors",value:function(){r.default.publish(n.REPORTER_CLEAR_ERRORS)}},{key:"_markUnbusy",value:function(){this.busy(!1)}},{key:"_markBusy",value:function(){this.busy(!0)}},{key:"_buildSaveParams",value:function(){var e={legal_entity:{}};return e.legal_entity.first_name=this.legalEntity.firstName(),e.legal_entity.last_name=this.legalEntity.lastName(),e.legal_entity.type=this.legalEntity.type(),this.showBusinessName()&&(e.legal_entity.business_name=this.legalEntity.businessName()),this.legalEntity.isIndividual()?e.legal_entity.business_tax_id=null:this.legalEntity.businessTaxIdIsPlaceholder()||(e.legal_entity.business_tax_id=this.legalEntity.businessTaxId()),this.legalEntity.ssnIsPlaceholder()||(e.legal_entity.ssn_last_4=this.legalEntity.ssnLast4()),e.legal_entity.address={},e.legal_entity.address.line1=this.legalEntity.address1(),e.legal_entity.address.line2=this.legalEntity.address2(),e.legal_entity.address.city=this.legalEntity.city(),e.legal_entity.address.state=this.legalEntity.state(),e.legal_entity.address.country=this.legalEntity.country(),e.legal_entity.address.postal_code=this.legalEntity.postalCode(),e.legal_entity.dob={},e.legal_entity.dob.day=this.dob.day(),e.legal_entity.dob.month=this.dob.month(),e.legal_entity.dob.year=this.dob.year(),e.support_phone=this.phoneNumber(),e}},{key:"_setFields",value:function(e){this.legalEntity.firstName(e.legal_entity.first_name),this.legalEntity.lastName(e.legal_entity.last_name),this.legalEntity.type(e.legal_entity.type),this.legalEntity.isCompany()&&this.startedAsCompany(!0),this.legalEntity.businessName(e.legal_entity.business_name),this.legalEntity.businessName()&&this.legalEntity.businessName().length>0&&this.hasBusinessName(!0),e.legal_entity.business_tax_id_provided&&(this.legalEntity.setBusinessTaxIdPlaceholder(),this.displayedBusinessTaxId(this.legalEntity.businessTaxId())),e.legal_entity.ssn_last_4_provided&&this.legalEntity.setSsnPlaceholder(),this.legalEntity.address1(e.legal_entity.address.line1),this.legalEntity.address2(e.legal_entity.address.line2),this.legalEntity.city(e.legal_entity.address.city),this.legalEntity.state(e.legal_entity.address.state),this.legalEntity.country(e.legal_entity.address.country),this.legalEntity.postalCode(e.legal_entity.address.postal_code),this.phoneNumber(e.support_phone),this.phoneNumber()&&this.displayedPhoneNumber((0,p.formatUSPhoneNumber)(this.phoneNumber())),this.dob.day(e.legal_entity.dob.day),this.dob.month(e.legal_entity.dob.month),this.dob.year(e.legal_entity.dob.year),this.verified("verified"==e.legal_entity.verification.status),(0,h.initializeTippy)(h.sellerSignupHint)}},{key:"_clearFields",value:function(){this.legalEntity.type(this.legalEntity.allowedTypes[0]),this.legalEntity.address1(""),this.legalEntity.address2(""),this.legalEntity.city(""),this.legalEntity.postalCode(""),this.legalEntity.state(""),this.legalEntity.country(""),this.legalEntity.firstName(""),this.legalEntity.lastName(""),this.legalEntity.businessName(""),this.legalEntity.businessTaxId(""),this.legalEntity.ssnLast4(""),this.phoneNumber(""),this.displayedPhoneNumber(""),this.dob.day(""),this.dob.month(""),this.dob.year(""),this.verified(!1)}},{key:"_findExistingAccount",value:function(){var e=this;this._markBusy(),NF.apiService.retrieveSellerAccount((0,f.resource)("action.loading"),function(t){e.searchingForUser(!1),t&&Object.keys(t).length>0&&(e.existingAccount(!0),e.showDescriptionPage(!1),e._setFields(t)),e._markUnbusy()},{},{fail:this._markUnbusy.bind(this)})}},{key:"_editAccount",value:function(){var e=this;this._markBusy();var t=this._buildSaveParams();NF.apiService.updateSellerAccount((0,f.resource)("action.saving"),function(t){e._markUnbusy(),(0,d.navigate)((0,d.path)("sellingPayoutDestinationSetup"))},t,{fail:this._markUnbusy.bind(this)})}},{key:"_saveNewAccount",value:function(){var e=this;this._markBusy();var t=this._buildSaveParams();NF.apiService.createSellerAccount("",function(t){e._markUnbusy(),NF.session.current_user().has_seller_account(!0),(0,d.navigate)((0,d.path)("sellingPayoutDestinationSetup"))},t,{fail:this._markUnbusy.bind(this)})}},{key:"_deleteSellerAccount",value:function(){var e=this;this._markBusy(),NF.apiService.deleteSellerAccount((0,f.resource)("action.deleting"),function(t){e._markUnbusy(),r.default.publish(n.SELLER_SIGNUP_RESET)},{},{fail:this._markUnbusy.bind(this)})}},{key:"_resetSellerSignup",value:function(){this.showDescriptionPage(!0),this._clearFields(),this.existingAccount(!1),NF.session.current_user().has_seller_account(!1),(0,d.navigate)((0,d.path)("sellingSetup"))}},{key:"_validatePhoneNumber",value:function(){var e=[];return(!this.phoneNumber()||this.phoneNumber().length<10)&&e.push({code:"invalidPhoneNumber",message:(0,f.resource)("errors.invalidPhoneNumber")}),e}},{key:"cancel",value:function(){this.hasSellerAccountOnPageLoad()?(0,d.navigate)((0,d.path)("sellingSetupLanding")):this.existingAccount()?(0,m.okCancel)((0,f.resource)("content.commerce.confirmCancelSellerSetup"),this._deleteSellerAccount.bind(this),"dialogs/okBack"):r.default.publish(n.SELLER_SIGNUP_RESET)}},{key:"doOk",value:function(){this._clearErrors();var e=this.legalEntity.validate();return e.length>0?(r.default.publish(n.REPORTER_ADD_ERRORS,e),!1):(e=this.dob.validate()).length>0?(r.default.publish(n.REPORTER_ADD_ERRORS,e),!1):(e=this._validatePhoneNumber()).length>0?(r.default.publish(n.REPORTER_ADD_ERRORS,e),!1):void(this.existingAccount()?this._editAccount():this._saveNewAccount())}},{key:"activate",value:function(){NF.session.current_user().has_seller_account()&&!this._userStateChecked&&this.hasSellerAccountOnPageLoad(!0),this._userStateChecked=!0,this._findExistingAccount()}},{key:"showWhyWeNeedInfo",value:function(){(new C).show()}}]),e}();t.default=P;var C=function(e){function t(){return w(this,t),y(this,_(t).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,a.default),E(t,[{key:"show",value:function(){return(0,m.createAndShowDialog)({viewModel:this,templateName:"dialogs/privacyAndSecurity"}),this}}]),t}();t.PrivacyAndSecurity=C},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.month=ko.observable(""),this.year=ko.observable(""),this.day=ko.observable("")}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"_calculateAge",value:function(){var e=new Date,t=new Date(this.year(),this.month()-1,this.day()),o=e.getUTCFullYear()-t.getUTCFullYear(),r=e.getUTCMonth()-t.getUTCMonth();return(r<0||0===r&&e.getUTCDate()<t.getUTCDate())&&o--,o}},{key:"_isAdult",value:function(){return this._calculateAge()>=18}},{key:"_isTooOld",value:function(){return this._calculateAge()>110}},{key:"validate",value:function(){var e=[];return(isNaN(parseInt(this.year()))||isNaN(parseInt(this.month()))||isNaN(parseInt(this.day())))&&e.push({code:"invalidDate",message:(0,r.resource)("errors.invalidDate")}),this._isAdult()||e.push({code:"insufficientAge",message:(0,r.resource)("errors.insufficientAge")}),this._isTooOld()&&e.push({code:"tooOldToBeSeller",message:(0,r.resource)("errors.tooOldToBeSeller")}),e}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(95),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.allowedTypes=[r.INDIVIDUAL_SELLER_TYPE,r.COMPANY_SELLER_TYPE],this.type=ko.observable(t.type||r.INDIVIDUAL_SELLER_TYPE),this.address1=ko.observable(t.address1),this.address2=ko.observable(t.address1),this.city=ko.observable(t.city),this.postalCode=ko.observable(t.postal_code),this.state=ko.observable(t.state),this.country=ko.observable(t.country),this.firstName=ko.observable(t.first_name),this.lastName=ko.observable(t.last_name),this.businessName=ko.observable(t.business_name),this.businessTaxId=ko.observable(t.business_tax_id),this.ssnLast4=ko.observable(t.ssn_last_4),this._initializeComputeds()}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"_initializeComputeds",value:function(){var e=this;this.isIndividual=ko.computed(function(){return e.type()===r.INDIVIDUAL_SELLER_TYPE}),this.isCompany=ko.computed(function(){return e.type()===r.COMPANY_SELLER_TYPE}),this.ssnIsPlaceholder=ko.computed(function(){return e.ssnLast4()===r.SSN_PLACEHOLDER_STRING}),this.businessTaxIdIsPlaceholder=ko.computed(function(){return e.businessTaxId()===r.BUSINESS_TAX_ID_PLACEHOLDER_STRING})}},{key:"setSsnPlaceholder",value:function(){this.ssnLast4(r.SSN_PLACEHOLDER_STRING)}},{key:"setBusinessTaxIdPlaceholder",value:function(){this.businessTaxId(r.BUSINESS_TAX_ID_PLACEHOLDER_STRING)}},{key:"validate",value:function(){var e=[];return this.isCompany()&&((!this.businessName()||this.businessName().length<1)&&e.push({code:"missingBusinessName",message:(0,n.resource)("errors.missingBusinessName")}),this.businessTaxIdIsPlaceholder()||this.businessTaxId()&&9==this.businessTaxId().length||e.push({code:"invalidEin",message:(0,n.resource)("errors.invalidEin")})),(!this.type()||this.type().length<1||!this.allowedTypes.includes(this.type()))&&e.push({code:"invalidSellerType",message:(0,n.resource)("errors.invalidSellerType")}),(!this.ssnLast4()||this.ssnLast4().length<4)&&e.push({code:"invalidSSNLast4",message:(0,n.resource)("errors.invalidSSNLast4")}),(!this.firstName()||!this.lastName()||this.firstName().length<1||this.lastName().length<1)&&e.push({code:"missingName",message:(0,n.resource)("errors.missingName")}),(!this.address1()||this.address1().length<1||!this.city()||this.city().length<1||!this.state()||this.state().length<1||!this.country()||this.country().length<1||!this.postalCode()||this.postalCode().length<1)&&e.push({code:"invalidAddress",message:(0,n.resource)("errors.invalidAddress")}),e}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(o(4)),n=d(o(263)),i=o(2),a=o(0),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(28)),l=o(31),c=o(5),u=o(8);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.templateName=ko.observable("content/activateAccount"),this.session=Noteflight.session,this.doNotShowDefaultError=!0,r.default.publish(c.REPORTER_CLEAR_ERRORS),this.optionalInfo=new n.default,this.initializeObservables(),this.checkKey()}return function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(e,[{key:"initializeObservables",value:function(){var e=this;this.email=ko.observable(),this.username=ko.observable(""),this.password=ko.observable(""),this.emailKeyValid=ko.observable(!1),this.emailResent=ko.observable(!1),this.emailChecked=ko.observable(!1),this.keyExpired=ko.observable(!1),this.mandatoryOptionsFilled=ko.computed(function(){return""!==e.username()&&""!==e.password()}),this.accountExists=ko.observable(!1)}},{key:"populateInformation",value:function(e){this.email(e.email),this.emailKeyValid(!0),e.username&&(this.username(e.username),this.password("password"),this.accountExists(!0),this.optionalInfo.composer(e.composer),this.optionalInfo.performer(e.performer),this.optionalInfo.educationalRole(e.educational_role),this.optionalInfo.primaryInstrument(e.primary_instrument),this.optionalInfo.composerSkillLevel(e.composer_skill_level),this.optionalInfo.performerSkillLevel(e.performer_skill_level))}},{key:"checkKey",value:function(){var e=this;NF.apiService.checkSignupKey({text:(0,a.resource)("action.validating"),doNotShowDefaultError:!0},function(t){e.emailChecked(!0),e.populateInformation(t)},{key:NF.currentRouteParams.key},{fail:function(t){"expiredActivationKey"===t.code&&e.keyExpired(!0),e.emailChecked(!0)}})}},{key:"signupComplete",value:function(e){this.session.update(e),(0,l.getCookie)("premiumTrial")?(0,i.navigate)((0,i.path)("premiumTrialConfirmation")):(0,i.navigate)((0,i.path)("loggedInHome"))}},{key:"validateUsername",value:function(){var e=s.validateUsername(this.username()).error;return!e||(r.default.publish(c.REPORTER_ADD_ERROR,{message:(0,a.resource)(e),code:e}),!1)}},{key:"validatePassword",value:function(){var e=s.validatePassword(this.password()).error;if(e){switch(e){case"errors.passwordRequired":r.default.publish(c.REPORTER_ADD_ERROR,{message:(0,a.resource)(e),code:(0,a.resource)(e)});break;case"errors.passwordTooShort":r.default.publish(c.REPORTER_ADD_ERROR,{message:(0,a.resource)(e,u.MIN_PASSWORD_LENGTH),code:(0,a.resource)(e)});break;case"errors.passwordTooLong":r.default.publish(c.REPORTER_ADD_ERROR,{message:(0,a.resource)(e,u.MAX_PASSWORD_LENGTH),code:(0,a.resource)(e)})}return!1}return!0}},{key:"activate",value:function(){if(r.default.publish(c.REPORTER_CLEAR_ERRORS),this.validateUsername()&&this.validatePassword())if(this.email()&&0!==this.email().length){var e={email:this.email(),username:this.username(),password:this.password(),password_confirmation:this.password(),key:NF.currentRouteParams.key};e=$.extend(e,this.optionalInfo.getInfo()),this.registerUser(e),NF.analytics.trackEvent("conversion","signup",NF.currentRouteName)}else r.default.publish(c.REPORTER_ADD_ERROR,{message:(0,a.resource)("errors.emailRequired"),code:(0,a.resource)("errors.emailRequired")})}},{key:"registerUser",value:function(e){var t=this;NF.apiService.registerUser((0,a.resource)("session.signingUp"),function(e){return t.signupComplete(e)},e,{})}},{key:"update",value:function(){var e=this,t={key:NF.currentRouteParams.key};t.profile_options=this.optionalInfo.getInfo(),NF.apiService.editProfileFromActivationPage("",function(t){return e.signupComplete(t)},t,{})}},{key:"resendActivationEmail",value:function(){var e=this;r.default.publish(c.REPORTER_CLEAR_ERRORS),NF.apiService.signupEmail((0,a.resource)("session.sendingEmail"),function(){e.resendSuccess()},{email:this.email()},{})}},{key:"resendSuccess",value:function(){this.emailResent(!0)}}]),e}();t.default=f,(0,i.addRoute)("activate_account","/users/activate_account/{key}#",f,{})},function(e,t,o){"use strict";var r=f(o(104)),n=f(o(461)),i=f(o(462)),a=o(2),s=o(259),l=o(0),c=o(3),u=o(20),d=o(15),p=f(o(463));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return null===e?(0,l.resource)("content.unlimited"):0===e?null:e.toString()}Noteflight.AccountStatusViewModel=function(e){var t=this;t.parent=e,t.accountInfo=e.accountInfo,t.data=ko.observable(),t.billingInfoView=ko.computed(function(){return t.data()?new Noteflight.AccountStatusBillingInfoViewModel(t.data().account_info):null}),t.summaryView=ko.computed(function(){return t.data()?new Noteflight.AccountStatusSummaryViewModel(t.data().summary):null}),t.creditViews=ko.computed(function(){return t.data()?t.data().credits.map(function(e){return new Noteflight.AccountStatusCreditViewModel(e)}):[]}),t.couponView=ko.computed(function(){return t.data()?new Noteflight.AccountStatusCouponViewModel(t.data().coupons):null}),t.currentSubscriptionView=ko.computed(function(){if(t.data()){var e=(0,s.figureOutCurrentSubscription)(t.data().subscriptions,t.data().credits);return new Noteflight.AccountStatusSubscriptionViewModel(e,t.accountInfo)}}),t.futureSubscriptionViews=ko.computed(function(){var e=[];if(t.data())for(var o=0;o<t.data().subscriptions.length;o++)"future"==t.data().subscriptions[o].state&&e.push(new Noteflight.AccountStatusSubscriptionViewModel(t.data().subscriptions[o]));return e}),t.quoteViews=ko.computed(function(){return t.data()?t.data().quotes.map(function(e){return new Noteflight.AccountStatusQuoteViewModel(e)}):[]}),t.invoiceViews=ko.computed(function(){return t.data()?t.data().invoices.map(function(e){return new Noteflight.AccountStatusInvoiceViewModel(e)}):[]}),t.goToPlansPage=function(){(0,a.navigate)(NF.paths.infoPlans())},t.showInvoicesCoverFlag=ko.observable(!0),t.showInvoicesCover=ko.computed(function(){return t.showInvoicesCoverFlag()&&t.invoiceViews()&&t.invoiceViews().length>=5}),t.showAllInvoices=function(){t.showInvoicesCoverFlag(!1)}},Noteflight.AccountStatusBillingInfoViewModel=function(e){var t=this;function o(e){NF.apiService.updateBillingInfo((0,l.resource)("action.updating"),function(){t.updateBillingInfoComplete(e)},e,{})}function r(e,o,r){NF.apiService.updateBillingInfoWithToken((0,l.resource)("action.updating"),function(){r?r():t.updateCreditCardInfoComplete(o)},e,{})}function a(){NF.reloadWindow()}t.company=ko.observable(e.billing_info.company),t.firstName=ko.observable(e.billing_info.first_name),t.lastName=ko.observable(e.billing_info.last_name),t.address1=ko.observable(e.billing_info.address1),t.address2=ko.observable(e.billing_info.address2),t.city=ko.observable(e.billing_info.city),t.state=ko.observable(e.billing_info.state),t.zip=ko.observable(e.billing_info.zip),t.country=ko.observable(e.billing_info.country),t.countryName=ko.computed(function(){return NF.getCountryLabelByCode(t.country())}),t.phone=ko.observable(e.billing_info.phone),t.cardType=ko.observable(e.billing_info.card_type),t.lastFour=ko.observable(e.billing_info.last_four),t.month=ko.observable(e.billing_info.month),t.year=ko.observable(e.billing_info.year),t.expiredCC=ko.computed(function(){var e=(0,d.last2DigitsOfYear)((new Date).getFullYear());if((0,d.last2DigitsOfYear)(t.year())>e)return!1;var o=(new Date).getMonth()+1;return t.month()<o}),t.taxExempt=ko.observable(e.tax_exempt),t.email=ko.observable(e.email),t.updateBillingInfoComplete=function(e){ko.mapping.fromJS(e.billing_info,{},t),e.billing_info.first_name&&t.firstName(e.billing_info.first_name),e.billing_info.last_name&&t.lastName(e.billing_info.last_name)},t.updateCreditCardInfoComplete=function(e){t.lastFour(e.number().substr(e.number().length-4)),t.month(e.month()),t.year(e.year()),t.cardType("")},t.showBilling=ko.computed(function(){return t.email()}),t.accountHasBeenCleared=ko.computed(function(){return t.email()&&!t.firstName()}),t.changeBillingAddress=function(){var e=(0,c.createAndShowDialog)({viewModel:new n.default(o),templateName:"fragments/billingInfo"});t.populateBillingInfo(e)},t.changePaymentInfo=function(){(0,c.createAndShowDialog)({viewModel:new i.default(this,r),templateName:"fragments/creditCard"})},t.setBillingInfo=function(){(0,c.createAndShowDialog)({viewModel:new p.default(function(e,t){r(e,t,a)}),templateName:"fragments/billingInfoWithCreditCard"})},t.populateBillingInfo=function(e){e.first_name(t.firstName()),e.last_name(t.lastName()),e.address1(t.address1()),e.address2(t.address2()),e.city(t.city()),e.state(t.state()),e.postal_code(t.zip()),e.country(t.country())},t.cityStateZipInfo=ko.computed(function(){var e=t.city();return t.state()&&(e+=", "+t.state()),t.zip()&&(e+=" "+t.zip()),e})},Noteflight.AccountStatusSummaryViewModel=function(e){var t=this;t.currentUsers=ko.observable(e.current_users),t.isPremium=ko.observable(e.is_premium),t.maxSites=ko.observable(e.max_sites),t.maxUsers=ko.observable(e.max_users),t.ssoEnabled=ko.observable(e.sso_enabled),t.contentLibraries=ko.observableArray(e.content_libraries.map(function(e){return new Noteflight.AccountStatusSummaryContentLibraryViewModel(e)})),t.maxSitesStr=ko.computed(function(){return h(t.maxSites())}),t.maxUsersStr=ko.computed(function(){return h(t.maxUsers())})},Noteflight.AccountStatusSummaryContentLibraryViewModel=function(e){var t=this;t.code=ko.observable(e.code),t.maxUsers=ko.observable(e.max_users),t.currentUsers=ko.observable(e.current_users),t.name=ko.computed(function(){return(0,l.resource)("contentLibrary."+t.code())}),t.maxUsersStr=ko.computed(function(){return h(t.maxUsers())})},Noteflight.AccountStatusSubscriptionViewModel=function(e,t){var o=this;o.accountInfo=t,o.planName=ko.observable(e.plan.name),o.planCode=ko.observable(e.plan.plan_code),o.state=ko.observable(e.state),o.isBasic=ko.computed(function(){return-1!=o.planCode().toLowerCase().indexOf("basic")}),o.isTrial=ko.computed(function(){return o.planCode().includes("trial")});var r=new NF.PlanOptions;o.isLearn=ko.computed(function(){return-1!=r.learnPlans.indexOf(o.planCode())}),o.isCustomPlan=ko.computed(function(){return-1!=r.customLearnPlans.indexOf(o.planCode())||-1!=r.oldLearnPlans.indexOf(o.planCode())}),o.isComplimentaryCredit=ko.computed(function(){return"complimentaryCredit"==o.planCode()}),o.activatedAt=ko.observable(e.activated_at),o.currentPeriodStartedAt=ko.observable(e.current_period_started_at),o.currentPeriodEndsAt=ko.observable(e.current_period_ends_at),o.canceledAt=ko.observable(e.canceled_at),o.activatedAtDate=ko.computed(function(){return o.activatedAt()?(0,u.formatDate)(new Date(1e3*o.activatedAt())):null}),o.currentPeriodStartedAtDate=ko.computed(function(){return o.currentPeriodStartedAt()?(0,u.formatDate)(new Date(1e3*o.currentPeriodStartedAt())):null}),o.currentPeriodEndsAtDate=ko.computed(function(){return o.currentPeriodEndsAt()?(0,u.formatDate)(new Date(1e3*o.currentPeriodEndsAt())):null}),o.currentPeriodEndsInfo=ko.computed(function(){return o.isTrial()?(0,l.resource)("content.endingDate",o.currentPeriodEndsAtDate()):(0,l.resource)("content.renewalDate",o.currentPeriodEndsAtDate())}),o.canceledAtDate=ko.computed(function(){return o.canceledAt()?(0,u.formatDate)(new Date(1e3*o.canceledAt())):null}),o.autoRenewState=ko.computed(function(){return"active"==o.state()?"content.autoRenewOn":"content.autoRenewOff"}),o.showAutoRenewInfo=ko.computed(function(){return"complimentaryCredit"!=o.planCode()&&!o.isTrial()}),o.canBeTurnedOn=ko.computed(function(){return!("canceled"!=o.state()||o.isBasic()||o.isTrial()||o.isComplimentaryCredit()||o.isCustomPlan())}),o.canBeTurnedOff=ko.computed(function(){return"active"==o.state()&&!o.isBasic()&&!o.isTrial()&&!o.isComplimentaryCredit()}),o.pendingSubscription=ko.computed(function(){if(e.pending_subscription){var t=new NF.AccountStatusSubscriptionViewModel(e.pending_subscription,o.accountInfo);return t.activatedAt(o.currentPeriodEndsAt()),t}return null}),o.maxSites=ko.computed(function(){for(var t=0;t<e.add_ons.length;t++)if("num_sites"==e.add_ons[t].add_on_code)return e.add_ons[t].quantity;return 0}),o.maxSitesStr=ko.computed(function(){return h(o.maxSites())}),o.maxUsers=ko.computed(function(){for(var t=0;t<e.add_ons.length;t++)if("students_per_site"==e.add_ons[t].add_on_code)return e.add_ons[t].quantity;return 0}),o.maxUsersStr=ko.computed(function(){return h(o.maxUsers())}),o.contentLibraries=ko.computed(function(){for(var t=[],r=0;r<e.add_ons.length;r++){var n=e.add_ons[r];n.add_on_code.startsWith("cl_")&&t.push(new Noteflight.AccountStatusSubscriptionContentLibraryViewModel(n,o.accountInfo))}return t}),o.pendingChangeText=ko.computed(function(){if(o.activatedAt()){if(o.isLearn()){var e=o.contentLibraries(),t=0===e.length?"content.futureSubscriptionLearn":"content.futureSubscriptionLearnWithCL",r=(0,l.resource)(t,o.activatedAtDate(),o.maxUsersStr());if(e.length>0)for(var n=0;n<e.length;n++)n>0&&(r+=","),r+=" "+(0,l.resource)("contentLibrary."+e[n].code())+": "+e[n].maxUsersStr();return r}return(0,l.resource)("content.futureSubscription",o.planName(),o.activatedAtDate())}}),o.futureChangeText=ko.computed(function(){if(o.activatedAt())return(0,l.resource)("content.futureSubscription",o.planName(),o.activatedAtDate())}),o.cancelSubscriptionForRefund=function(){(0,c.okCancel)((0,l.resource)("content.refundQuestion"),function(){NF.apiService.terminateWithRefund((0,l.resource)("content.refundProcessing"),o.terminatedWithRefund)})},o.terminatedWithRefund=function(){NF.apiService.sessionService((0,l.resource)("content.refundProcessing"),function(e){NF.session.update(e)}),(0,c.standardAlertDialog)((0,l.resource)("content.refundProcessed"),o.goHome)},o.cancelFutureSubscription=function(){(0,c.okCancel)((0,l.resource)("content.cancelFutureQuestion"),function(){NF.apiService.cancelFuture((0,l.resource)("content.cancelFutureProcessing"),o.canceledFuture)})},o.turnAutoRenewOff=function(){(0,c.okCancel)((0,l.resource)("content.turnAutoRenewOffQuestion"),function(){NF.apiService.cancelSubscription((0,l.resource)("content.updatingAutoRenew"),o.autoRenewOffCompleted,{plan:o.planName()})})},o.turnAutoRenewOn=function(){(0,c.okCancel)((0,l.resource)("content.turnAutoRenewOnQuestion"),function(){NF.apiService.reactivateSubscription((0,l.resource)("content.updatingAutoRenew"),o.autoRenewOnCompleted,{plan:o.planName()})})},o.canceledFuture=function(){NF.apiService.sessionService((0,l.resource)("content.cancelFutureProcessing"),function(e){NF.session.update(e)}),(0,c.standardAlertDialog)((0,l.resource)("content.cancelFutureProcessed"),o.goHome)},o.autoRenewOnCompleted=function(){(0,c.standardAlertDialog)((0,l.resource)("content.autoRenewOnCompleted"),function(){o.state("active")})},o.autoRenewOffCompleted=function(){(0,c.standardAlertDialog)((0,l.resource)("content.autoRenewOffCompleted"),function(){o.state("canceled")})},o.goHome=function(){(0,a.navigate)(Noteflight.paths.loggedInHome())}},Noteflight.AccountStatusSubscriptionContentLibraryViewModel=function(e,t){var o=this;o.accountInfo=t,o.code=ko.observable(e.add_on_code.substring(3)),o.maxUsers=ko.observable(e.quantity),o.name=ko.computed(function(){return(0,l.resource)("contentLibrary."+o.code())}),o.maxUsersStr=ko.computed(function(){return h(o.maxUsers())})},Noteflight.AccountStatusCreditViewModel=function(e){var t=this;t.type=ko.observable(e.type),t.active=ko.observable(e.active),t.startAt=ko.observable(e.start_date),t.expireAt=ko.observable(e.expiration_date),t.terminateAt=ko.observable(e.termination_date),t.revokedAt=ko.observable(e.revoked_at),t.maxSites=ko.observable(e.max_sites),t.maxUsers=ko.observable(e.max_users),t.startAtDate=ko.computed(function(){return t.startAt()?(0,u.formatDate)(new Date(1e3*t.startAt())):null}),t.endAt=ko.computed(function(){return t.revokedAt()?t.revokedAt():t.expireAt()?t.expireAt():t.terminateAt()?t.terminateAt():null}),t.endAtDate=ko.computed(function(){return t.endAt()?(0,u.formatDate)(new Date(1e3*t.endAt())):null}),t.maxSitesStr=ko.computed(function(){return h(t.maxSites())}),t.maxUsersStr=ko.computed(function(){return h(t.maxUsers())}),t.contentLibraries=ko.observableArray(e.content_libraries.map(function(e){return new Noteflight.AccountStatusCreditContentLibraryViewModel(e)}))},Noteflight.AccountStatusCreditContentLibraryViewModel=function(e){var t=this;t.code=ko.observable(e.code),t.maxUsers=ko.observable(e.max_users),t.name=ko.computed(function(){return(0,l.resource)("contentLibrary."+t.code())}),t.maxUsersStr=ko.computed(function(){return h(t.maxUsers())})},Noteflight.AccountStatusQuoteViewModel=function(e){var t=this;t.quoteNumber=ko.observable(e.quote_number),t.createdAt=ko.observable(e.created_at),t.subscribedAt=ko.observable(e.subscribed_at),t.amount=ko.observable(e.total),t.amountStr=ko.computed(function(){return t.amount()&&NF.formatCurrency(t.amount()/100)}),t.purchaseQuoteUrl=ko.computed(function(){return NF.paths.commerceFormLearn({url_quote_number:e.quote_number})}),t.printQuoteUrl=ko.computed(function(){return NF.paths.quotePrintLearn({quote_id:e.external_id})}),t.createdAtDate=ko.computed(function(){return t.createdAt()?(0,u.formatDate)(new Date(1e3*t.createdAt())):null}),t.subscribedAtDate=ko.computed(function(){return t.subscribedAt()?(0,u.formatDate)(new Date(1e3*t.subscribedAt())):null}),t.contentLibraries=ko.observableArray(e.content_libraries.map(function(e){return new Noteflight.AccountStatusQuoteContentLibraryViewModel(e)}))},Noteflight.AccountStatusQuoteContentLibraryViewModel=function(e){var t=this;t.code=ko.observable(e.code),t.maxUsers=ko.observable(e.max_users),t.name=ko.computed(function(){return(0,l.resource)("contentLibrary."+t.code())}),t.maxUsersStr=ko.computed(function(){return h(t.maxUsers())})},Noteflight.AccountStatusInvoiceViewModel=function(e){var t=this;t.invoiceNumber=ko.observable(e.invoice_number),t.createdAt=ko.observable(e.created_at),t.closedAt=ko.observable(e.closed_at),t.state=ko.computed(function(){return(0,l.resource)("content.state."+e.state)}),t.poNumber=ko.observable(e.po_number),t.amount=ko.observable(e.total_in_cents),t.createdAtDate=ko.computed(function(){return t.createdAt()?(0,u.formatDate)(new Date(1e3*t.createdAt())):""}),t.closedAtDate=ko.computed(function(){return t.closedAt()?(0,u.formatDate)(new Date(1e3*t.closedAt())):""}),t.amountStr=ko.computed(function(){return t.amount()&&NF.formatCurrency(t.amount()/100)}),t.gotInvoice=function(e){var o=new Blob([e],{type:"application/pdf"});r.default.saveAs(o,"Noteflight-"+t.invoiceNumber()+".pdf")},t.viewInvoice=function(){Noteflight.postServicePDF("/api/1.0/recurly_subscription/recurly_get_invoice_PDF",new Noteflight.ServiceReporterViewModel((0,l.resource)("action.loading")),t.gotInvoice,{})({invoice_number:t.invoiceNumber()},{})}},Noteflight.AccountStatusCouponViewModel=function(e){var t=this;t.activeCouponDescription=ko.observable(""),ko.computed(function(){e.length&&t.activeCouponDescription((0,l.resource)("content.activeCoupon",e[0].description))}),t.couponCode=ko.observable(""),t.couponDescription=ko.observable(""),t.validCouponCode=ko.observable(!1),t.showCouponField=ko.observable(!1),t.showCouponLink=ko.computed(function(){return NF.session.current_user().has_premium_features()&&!NF.session.current_user().has_active_trial_subscription()&&!t.showCouponField()}),t.addOrChangeCoupon=ko.computed(function(){return t.activeCouponDescription()?(0,l.resource)("action.changeCoupon"):(0,l.resource)("action.addCoupon")}),t.addingCoupon=function(){t.showCouponField(!0)},t.cancelCouponInput=function(){t.showCouponField(!1)},t.closeDescription=function(){t.couponDescription("")},t.displayCouponInfo=function(e){var o=e.coupon;o&&o.valid_coupon_code?(t.couponDescription((0,l.resource)("content.accountCouponDescription",o.description)),t.validCouponCode(!0),t.couponCode(""),t.activeCouponDescription((0,l.resource)("content.activeCoupon",o.description))):o&&!o.valid_coupon_code?(t.couponDescription((0,l.resource)("content.invalidCouponCode")),t.validCouponCode(!1),t.couponCode("")):(t.couponDescription(null),t.validCouponCode(!1))},t.redeemCoupon=function(){t.activeCouponDescription()?(0,c.okCancel)((0,l.resource)("content.confirmOverwriteCoupon"),function(){NF.apiService.redeemRecurlyCoupon((0,l.resource)("content.addingCoupon"),t.displayCouponInfo,{coupon_code:t.couponCode()})}):NF.apiService.redeemRecurlyCoupon((0,l.resource)("content.addingCoupon"),t.displayCouponInfo,{coupon_code:t.couponCode()})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=this;n.DialogViewModel.call(this),Noteflight.BillingInfoRecurlyViewModel.call(t),t.ok=function(){t.validateForm()&&(e({billing_info:t.formattedJsonForRecurly()}),t.cancel())},t.resource=r.resource};var r=o(0),n=o(3)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=this;function a(e,r){e?(o.serviceReporter.errors.push({message:(0,i.interpretRecurlyError)(e)}),o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()-1)):(t({token:r.id},o),o.cancel())}o.billingInfo=e,n.DialogViewModel.call(this),o.serviceReporter=new Noteflight.ServiceReporterViewModel((0,r.resource)("action.updating")),Noteflight.PurchaseMethodCreditCardRecurlyViewModel.call(o,o.serviceReporter),o.ok=function(){o.validateForm()&&(Noteflight.configureRecurly(),recurly.token({number:o.number(),month:o.month(),year:o.year(),cvv:o.cvv(),first_name:o.billingInfo.firstName(),last_name:o.billingInfo.lastName(),address1:o.billingInfo.address1(),address2:o.billingInfo.address2(),city:o.billingInfo.city(),state:o.billingInfo.state(),postal_code:o.billingInfo.zip(),country:o.billingInfo.country()},a))}};var r=o(0),n=o(3),i=o(114)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(114),i=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),a=o(6);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=c(this,u(t).call(this))).callback=e,o.serviceReporter=new a.Noteflight.ServiceReporterViewModel((0,r.resource)("action.updating")),o.ccInfoData=new a.Noteflight.PurchaseMethodCreditCardRecurlyViewModel(o.serviceReporter),o.billingInfoData=new a.Noteflight.BillingInfoRecurlyViewModel,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"recurlyCreateTokenComplete",value:function(e,t){e?(this.serviceReporter.errors.push({message:(0,n.interpretRecurlyError)(e)}),this.serviceReporter.busyCounter(this.serviceReporter.busyCounter()-1)):(this.callback({token:t.id}),this.cancel())}},{key:"ok",value:function(){this.ccInfoData.validateForm()&&this.billingInfoData.validateForm()&&(a.Noteflight.configureRecurly(),recurly.token({number:this.ccInfoData.number(),month:this.ccInfoData.month(),year:this.ccInfoData.year(),cvv:this.ccInfoData.cvv(),first_name:this.billingInfoData.first_name(),last_name:this.billingInfoData.last_name(),address1:this.billingInfoData.address1(),address2:this.billingInfoData.address2(),city:this.billingInfoData.city(),state:this.billingInfoData.state(),postal_code:this.billingInfoData.postal_code(),country:this.billingInfoData.country()},this.recurlyCreateTokenComplete.bind(this)))}}]),t}();t.default=p},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.RedemptionPointViewModel=function(e,t){var o=this;o.parent=t,o.id=ko.observable(),o.name=ko.observable(),o.listing_id=ko.observable(),o.listing_metadata=ko.observable(),ko.mapping.fromJS(e,{},o),o.select=function(){o.parent.select(o)},o.isCurrent=ko.computed(function(){return o==o.parent.currentItem()}),o.title=ko.computed(function(){return o.listing_metadata().title()}),o.imageURL=ko.computed(function(){return"url(/content_packages/"+o.listing_id()+"/files/"+o.listing_metadata().image()+")"})},Noteflight.RedemptionPointsListViewModel=function(){var e=this;e.redemptionPointsList=ko.observableArray([]);var t={create:function(t){return new Noteflight.RedemptionPointViewModel(t.data,e)}};e.loadDataCompleteSubscribable=new ko.subscribable,e.loadData=function(){NF.apiService.listRedemptionPoints("",e.loadDataComplete)},e.loadDataComplete=function(o){ko.mapping.fromJS(o,t,e.redemptionPointsList),e.loadDataCompleteSubscribable.notifySubscribers(null,"loadDataComplete")},e.currentItem=ko.observable(null),e.select=function(t){e.currentItem(t)},e.selectFirstItem=function(){e.redemptionPointsList().length&&e.select(e.redemptionPointsList()[0])}},Noteflight.ActivateCodeViewModel=function(){var e=this;e.session=Noteflight.session,e.templateName=ko.observable("content/activateCode"),e.title=ko.observable((0,n.resource)("activate.title")),Noteflight.GenericPageViewModel.call(e),e.redemptionPoints=new NF.RedemptionPointsListViewModel,e.redemption_point_name=ko.observable(),e.submitted_redemption_point_name=ko.observable(),e.redemptionPoint=ko.observable(),e.redemptionPointsDataAvailable=ko.observable(),e.activation_code=ko.observable(""),e.userEnteredCode=ko.observable(""),e.successfullyRedeemed=ko.observable(!1),e.busy=ko.observable(0),e.errors=ko.observableArray(),e.enableRedeemButton=ko.computed(function(){return e.userEnteredCode().length&&e.redemptionPoints&&e.redemptionPoints.currentItem()}),e.clearErrors=function(){e.errors([])},e.redeemedArrangement=ko.observable(),e.showLogin=function(){Noteflight.appViewModel.showLoginForm()},e.showSignup=function(){Noteflight.appViewModel.showSignupForm()};var t=function(t){switch(t.business_arrangement.type){case"Workbook1Arrangement":e.redeemedArrangement(new Noteflight.RedeemedBookViewModel(t.business_arrangement));break;case"BoxProductArrangement":e.redeemedArrangement(new Noteflight.RedeemedBoxProductViewModel(t.business_arrangement));break;case"GiftCertArrangement":e.redeemedArrangement(new Noteflight.RedeemedGiftCertViewModel(t.business_arrangement));break;default:e.redeemedArrangement(new Noteflight.RedeemedArrangementViewModel(t.business_arrangement))}e.successfullyRedeemed(!0)};e.activateCode=function(){e.redemptionPoint()?e.submitted_redemption_point_name(e.redemptionPoint().name()):e.submitted_redemption_point_name(e.redemptionPoints.currentItem().name()),e.clearErrors(),function(o){o||(o={});var r=o.activation_code,n={redemption_point_name:e.redemptionPoints.currentItem().name(),code:r};NF.apiService.redeemRedemptionCodes("",t,n)}({activation_code:e.activation_code()})},e.redeemUserEnteredCode=function(){e.activation_code(e.userEnteredCode()),e.activateCode()},e.tryAgain=function(){e.userEnteredCode()?(e.clearErrors(),e.activation_code("")):(e.clearErrors(),e.userEnteredCode(e.activation_code()),e.activation_code(""))},e.onNavigate=function(){e.activation_code()&&(e.userEnteredCode(e.activation_code()),e.activation_code("")),e.redemptionPoints.loadDataCompleteSubscribable.subscribe(e.redemptionPointsDataLoaded,e,"loadDataComplete"),e.redemptionPoints.loadData()},e.redemptionPointsDataLoaded=function(){if(e.redemptionPointsDataAvailable(!0),e.redemptionPoints.selectFirstItem(),e.redemption_point_name())for(var t=0;t<e.redemptionPoints.redemptionPointsList().length;t++)if(e.redemptionPoints.redemptionPointsList()[t].name()==e.redemption_point_name()){e.redemptionPoint(e.redemptionPoints.redemptionPointsList()[t]);break}}},Noteflight.RedeemedBookViewModel=function(e){this.templateName=ko.observable("content/redeemedBook"),this.bookSummary=ko.observable(ko.mapping.fromJS(e.content_package,Noteflight.BookSummaryViewModel.booksMapping))},Noteflight.RedeemedBoxProductViewModel=function(e){var t=e.content_package;this.templateName=ko.observable("content/redeemedBoxProduct"),this.productName=ko.observable(t.listing_metadata.title),this.productImageURL=ko.observable("/content_packages/"+t.id+"/files/"+t.listing_metadata.image),this.onClick=function(){(0,r.navigate)("/")}},Noteflight.RedeemedGiftCertViewModel=function(e){var t=e.content_package;this.templateName=ko.observable("content/redeemedGiftCert"),this.productName=ko.observable(t.listing_metadata.title),this.productImageURL=ko.observable("/content_packages/"+t.id+"/files/"+t.listing_metadata.image),this.onClick=function(){(0,r.navigate)("/")}},Noteflight.RedeemedArrangementViewModel=function(e){this.templateName=ko.observable("content/redeemedArrangement"),this.businessArrangement=ko.observable(e)},(0,r.addRoute)("activateCodeForRedemptionPoint","/activate/{redemption_point_name}:?activation_code:#",Noteflight.ActivateCodeViewModel,{}),(0,r.addRoute)("activateCode","/activate:?activation_code:#",Noteflight.ActivateCodeViewModel,{}),(0,r.addRoute)("activateCodeForNoteflight","/redeem:?activation_code:#",Noteflight.ActivateCodeViewModel,{redemption_point_name:"noteflight"})},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.BookSummaryViewModel=function(e){var t=this;t.templateName=ko.observable("fragments/bookSummary"),t.expired=ko.observable(!1),ko.mapping.fromJS(e,{},this),t.typeLabel=ko.observable((0,n.resource)("activate.type_book")),t.bookImageURL=ko.computed(function(){return"/content_packages/"+t.id()+"/files/"+t.bookImage()}),t.redeemedURL=ko.computed(function(){return"/content_packages/view/"+t.id()}),t.onClick=function(){(0,r.navigate)(t.redeemedURL())}},Noteflight.BookSummaryViewModel.booksMapping={create:function(e){var t=e.data,o=t.listing_metadata;return o||(o={}),o.bookImage=o.image,o.id=t.id,o.content_type=t.content_type,new NF.BookSummaryViewModel(o)}}},function(e,t,o){"use strict";var r=o(2);Noteflight.ContentPackageViewModel=function(e){var t=this;t.id=ko.observable(),t.command=ko.observable(),t.templateName=ko.observable("content/contentPackage"),Noteflight.GenericPageViewModel.call(t),t.contentViewer=ko.observable(),t.contentTemplateName=ko.observable(),t.contentViewModel=ko.observable();var o=function(e){var o=e.content_type,r=Noteflight.UnknownContentPackageViewModel,n={"http://www.noteflight.com/content_types/workbook1/workingCopy":Noteflight.Workbook1WorkingCopyViewModel,"http://www.noteflight.com/content_types/workbook1/listing":Noteflight.Workbook1ListingViewModel}[o];n&&(r=n);var i=new r({id:e.id,command:t.command(),contentType:o,listingMetadata:e.listing_metadata}),a=i.templateName();t.contentTemplateName(a),t.contentViewModel(i),t.contentViewModel().activate()};t.onNavigate=function(){NF.apiService.getContentPackagesData("",o,{content_package_id:t.id()})}},(0,r.addRoute)("content_package_view","/content_packages/view/{id}#",Noteflight.ContentPackageViewModel,{}),(0,r.addRoute)("content_package_view_command","/content_packages/view/{id}#{command}",Noteflight.ContentPackageViewModel,{})},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.ConfirmIdentityViewModel=function(){var e=this;e.session=Noteflight.session,e.templateName=ko.observable("content/confirmIdentity"),Noteflight.GenericPageViewModel.call(e),e.userName=ko.observable(e.session.current_user()&&e.session.current_user().identified()?e.session.current_user().username():""),e.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("account.savingInfo")),e.updateCurrentUser=function(t){e.session.current_user().update(t.user),(0,r.navigate)((0,r.path)("editProfile"))},e.updateProfileService=function(t){Noteflight.apiService.verifyProfile(e.serviceReporter,e.updateCurrentUser,t)},e.init=function(){e.serviceReporter.init()},e.handleKeyUp=function(t,o){"13"!=o.keyCode&&e.serviceReporter.clearErrors()},e.saveUserName=function(){e.serviceReporter.clearErrors();var t=e.userName().trim().replace(/ +/g," ");t||(e.serviceReporter.errors.push({message:(0,n.resource)("errors.userNameRequired")}),$("#userName").focus(),$("#formPage").scrollTop(0)),0===e.serviceReporter.errors().length&&e.updateProfileService({user:{username:e.session.current_user().identified()?null:t}})}},Noteflight.VerificationFailureViewModel=function(){this.session=Noteflight.session,this.templateName=ko.observable("content/verificationFailure"),Noteflight.GenericPageViewModel.call(this)},(0,r.addRoute)("confirmIdentity","/users/confirm_identity#",Noteflight.ConfirmIdentityViewModel,{}),(0,r.addRoute)("verificationFailure","users/verification_failure#",Noteflight.VerificationFailureViewModel,{})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(2),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,o){return t&&d(e.prototype,t),o&&d(e,o),e}var f=function(){function e(){u(this,e),this.templateName=ko.observable("content/blank"),this.initialize()}return p(e,[{key:"initialize",value:function(){(new h).show()}}]),e}();t.default=f;var h=function(e){function t(e,o){var r;return u(this,t),(r=s(this,l(t).call(this))).currentUser=NF.session.current_user(),r.email=r.currentUser.email,r.avatarUrl=r.currentUser.avatar,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),p(t,[{key:"loginWithThisEmail",value:function(){var e=NF.currentQueryParams.redirect;e?(0,n.navigate)("/auth/connect?redirect=".concat(e)):(0,n.navigate)("/auth/connect")}},{key:"signupWithAnotherEmail",value:function(){var e=(0,n.path)("login")+"?show_signup_form=true";(0,n.navigate)("/logout?post_logout_url="+e)}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/confirmProvider"})}}]),t}();(0,n.addRoute)("confirm_external_provider_signup","/users/confirm_external_provider_signup/#",f,{})},function(e,t,o){"use strict";var r=o(2);Noteflight.DefaultContentViewModel=function(){this.templateName=ko.observable("content/default"),this.resource=ko.observable()},(0,r.addRoute)("manualReauthenticationComplete","/users/manual_reauthentication_complete#",Noteflight.DefaultContentViewModel,{resource:"content.manualReauthenticationComplete"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(4)),n=o(5),i=c(o(116)),a=(c(o(32)),o(53),c(o(75))),s=o(0),l=o(3);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this,o))).endpointName("uploadCoverArt"),e.pictureKey("cover_art"),e.imageAPI="/scores/cover_art/",e.editable(!0),e._choosePhotoCoverArt=e._choosePhotoCoverArt.bind(h(h(e))),e.contextMenuItems=ko.observableArray([{label:(0,s.resource)("action.upload"),action:e.uploadImage},{label:(0,s.resource)("action.chooseStockPhoto"),action:e._choosePhotoCoverArt},{label:(0,s.resource)("action.createFromScore"),action:e._generateFromScore}]),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,a.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"_choosePhotoCoverArt",value:function(){new i.default((0,s.resource)("action.changeCoverArt"),"cover_art","uploadCoverArtData",{selectedCallback:this.selectedCallback.bind(this),aspectRatio:1}).show()}},{key:"selectedCallback",value:function(e){r.default.publish(n.STOCK_IMAGE_COVER_ART_SELECTED,e)}},{key:"_generateFromScore",value:function(){NF.safari?(0,l.standardAlertDialog)((0,s.resource)("errors.featureNotAvailableInSafari")):r.default.publish(n.SCORE_GENERATE_IMAGE)}},{key:"refreshImage",value:function(){this._rawImageUrl(this._originalImageUrl())}},{key:"_croppingCancelCallback",value:function(){var e=this,t=r.default.subscribe(n.SCORE_SAVED,function(o,n){r.default.unsubscribe(t),e.refreshImage()});r.default.publish(n.STOCK_IMAGE_COVER_ART_SELECTED,{cover_art_id:this._oldImageId})}},{key:"_callbackNewImageUploaded",value:function(e,t){var o=t?this._letUserCropImage.bind(this):function(){};this._oldImageId=this.imageId(),this.imageId(e.cover_art_id),this._rawImageUrl(e.cover_art_url);var i=r.default.subscribe(n.SCORE_COVER_ART_REGENERATED,function(e,t){r.default.unsubscribe(i),o()});r.default.publish(n.STOCK_IMAGE_COVER_ART_SELECTED,e),this.newImageUploaded(!0)}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(43)),n=o(0),i=o(6);var a={firstFollowingsFollowers:{create:function(e){return new r.default(e.data)}}};t.default=function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.about_me=i.ko.observable(),this.location=i.ko.observable(),this.country=i.ko.observable(),i.ko.mapping.fromJS(t,{},this),this.followingsFollowersData=i.ko.observable(),this.followingsFollowers=i.ko.observable(),this.followersCount=i.ko.computed(function(){return o.followingsFollowers()?(0,n.pluralize)("content.followersWithCount",o.followingsFollowers().followersCount()):""}),this.followingsFollowersData.subscribe(function(e){o.followingsFollowers(i.ko.mapping.fromJS(e,a))})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),i=o(3),a=o(31);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=c(this,u(t).call(this))).welcome=ko.observable("welcome"==e),o.loadDemoCallback=r.loadDemoCallback,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"signupPremium",value:function(){(0,a.setCookie)("demoRedirect",!0,1e4,NF.COOKIE_DOMAIN,"/"),(0,r.navigate)(NF.paths.premiumTrial())}},{key:"loadDemo",value:function(){this.loadDemoCallback&&this.loadDemoCallback(),this.cancel()}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/demoAlert"})}}]),t}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(2),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,o){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,u(t).call(this))).authLink=e,r.onFail=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"submit",value:function(){(0,n.navigate)(this.authLink)}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/googleAuth"})}},{key:"cancel",value:function(){this.onFail&&this.onFail(),c(u(t.prototype),"cancel",this).call(this)}}]),t}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(19);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.showPerformArrows=t.html5Editor().scoreState.isPerformMode,this.fadePerform=ko.observable(!1),this.isFirstPage=ko.computed(function(){return!1}),this.isLastPage=ko.computed(function(){return!1}),ko.computed(function(){o.showPerformArrows()&&o.resetCountdownToPerformFadeOut()}),this._performFadeOutTimer=null,this._touchStartX=0,this._touchStartY=0,this._swipeProcessed=!1,this.MIN_SWIPE=10}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"resetCountdownToPerformFadeOut",value:function(){var e=this;clearTimeout(this._performFadeOutTimer),this._performFadeOutTimer=setTimeout(function(){e.fadePerform(!0)},1e4)}},{key:"fadePerformUI",value:function(e){clearTimeout(this._performFadeOutTimer),this.fadePerform(e)}},{key:"performPageForward",value:function(){this.editor.html5Editor().scoreApi.scrollToNextPage()}},{key:"performPageBack",value:function(){this.editor.html5Editor().scoreApi.scrollToPreviousPage()}},{key:"maskTouchStart",value:function(e,t){var o=t.originalEvent.changedTouches;o&&0!==o.length&&(this._touchStartX=o[0].clientX,this._touchStartY=o[0].clientY,_swipeProcessed=!1)}},{key:"maskTouchMove",value:function(e,t){var o=t.originalEvent.changedTouches;if(o&&0!==o.length){var r=o[0].clientX,n=o[0].clientY,i=r-this._touchStartX,a=n-this._touchStartY;Math.sqrt(i*i+a*a)>this.MIN_SWIPE&&(_swipeProcessed||(i+a>0?this.performPageBack():this.performPageForward(),_swipeProcessed=!0),t.preventDefault())}}},{key:"maskClick",value:function(e){this.fadePerformUI(!this.fadePerform())}},{key:"uiOver",value:function(){(0,r.isTouchDevice)()||this.fadePerformUI(!1)}},{key:"uiOut",value:function(){(0,r.isTouchDevice)()||this.fadePerformUI(!0)}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=P(o(476)),n=P(o(479)),i=P(o(481)),a=P(o(483)),s=P(o(485)),l=P(o(496)),c=P(o(521)),u=P(o(536)),d=P(o(538)),p=P(o(543)),f=P(o(545)),h=P(o(547)),m=P(o(549)),g=P(o(273)),b=P(o(553)),v=P(o(555)),y=o(8),_=o(557),S=o(14),w=o(0),k=P(o(124)),E=o(6);function P(e){return e&&e.__esModule?e:{default:e}}function C(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.initializeConnectedProperties(),this.showScoreDetails=E.ko.observable(!1),this.scoreDetailsPanelInitialized=!1,this.facebookShareCount=E.ko.observable(0),this.scoreDetailsPanelBottomPosition=E.ko.observable("0px"),this.initializeComputeds(),this.initializeSections(),this.handleFacebookSharing=this.handleFacebookSharing.bind(this),this.flagContextMenuItems=E.ko.observableArray([{label:(0,w.resource)("action.flagScore"),action:this.flagDocument}])}return function(e,t,o){t&&C(e.prototype,t),o&&C(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentPolicy=E.ko.observable(),this.editorReady=E.ko.observable(),this.isMobileOrSmallerLayout=E.ko.observable(),this.contentModel=E.ko.observable(),this.contentType=E.ko.observable(),this.isDefaultCommunity=E.ko.observable(),this.isEditingProduct=E.ko.observable(),this.isLoggedIn=E.ko.observable(),this.currentUserIsAuthor=E.ko.observable(),this.currentUserIsProductOwner=E.ko.observable(),this.currentUserIsPreviewingProduct=E.ko.observable(),(0,S.connect)(_.scoreDetailsPanelSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.showEditableFields=E.ko.computed(function(){return e.isLoggedIn()&&e.contentType()===y.SCORE}),this.hideCloseScoreDetailsPanelButton=E.ko.computed(function(){return!!e.currentUserIsPreviewingProduct()&&(!e.contentPolicy().can_edit&&!e.isMobileOrSmallerLayout())}),this.showEditableCoverArt=E.ko.computed(function(){return e.contentPolicy().can_edit&&!e.isEditingProduct()}),this.coverArtViewModel=E.ko.computed(function(){var t=e.contentPolicy().can_edit&&!e.isEditingProduct(),o=t?"medium":"big",r=new k.default(e.contentModel().cover_art_url,{id:e.contentModel().cover_art_id,overlay:e.contentModel().cover_art_directive});return{coverArt:E.ko.observable(r),editable:E.ko.observable(t),size:E.ko.observable(o)}})}},{key:"initializeSections",value:function(){var e,t=this;(this.authorInformationSection=E.ko.observable(new r.default),this.scoreInformationSection=E.ko.observable(new n.default),this.productInformationSection=E.ko.observable(),this.scoreFacets=new i.default,this.shareScoreSection=E.ko.observable(),this.sellScoreSection=E.ko.observable(),this.contentLibrarySection=E.ko.observable(),this.productActionSection=E.ko.observable(),this.saveProductCopySection=E.ko.observable(),this.socialStatsSection=E.ko.observable(),this.reviewsSection=E.ko.observable(),this.commentsSection=E.ko.observable(),this.publishProductUpdatesSection=E.ko.observable(),this.recommendedSection=E.ko.observable(),this.commerceLinks=new g.default,this.showCommerceLinksSection=E.ko.computed(function(){return t.shareScoreSection()&&t.shareScoreSection().showCommerceLinks()&&!t.contentPolicy().can_share}),this.contentType()===y.SCORE&&this.contentPolicy().is_from_content_library&&this.contentLibrarySection(new u.default),this.contentType()===y.PRODUCT&&(this.currentUserIsProductOwner()||this.currentUserIsAuthor()&&!this.isEditingProduct())&&this.saveProductCopySection(new p.default),this.isEditingProduct()&&this.publishProductUpdatesSection(new f.default(this.contentModel())),this.currentUserIsProductOwner()||this.isEditingProduct()||this.contentPolicy().is_product_copy||this.socialStatsSection(new d.default(this.editor)),this.contentType()===y.PRODUCT)?(this.editor.marketplaceBreadcrumb()&&this.editor.marketplaceBreadcrumb().searchQueryRoute()&&(e=this.editor.marketplaceBreadcrumb().searchQueryRoute()),this.editor.viewer()||this.productActionSection(new s.default(e)),E.NF.session.rrRecommend()&&this.currentUserIsPreviewingProduct()&&this.recommendedSection(new h.default),this.reviewsSection(new m.default),this.productInformationSection(new a.default)):this.commentsSection(new b.default);this.isShared=E.ko.computed(function(){return t.shareScoreSection()&&t.shareScoreSection().isShared()})}},{key:"initializeDependentSections",value:function(){this.shareScoreSection()||this.contentType()!==y.SCORE||(this.shareScoreSection(new l.default),this.shareScoreSection().initializeGoogleConnections()),this.contentPolicy().can_edit&&this.isDefaultCommunity()&&!this.isEditingProduct()&&this.sellScoreSection(new c.default(this.editor))}},{key:"initializeLayout",value:function(){this.editor.layoutPanels()}},{key:"openScoreDetailsPanel",value:function(){this.showScoreDetails(!0),this.scoreDetailsPanelInitialized||(this.initializeScoreDetailsPanel(),this.scoreDetailsPanelInitialized=!0),this.editorReady()&&this.editor.html5Editor().showMediaSyncViewerIfNeeded(),this.scoreInformationSection().getDescriptionHeight()}},{key:"initializeScoreDetailsPanel",value:function(){var e=this;this.editor.viewer()||setTimeout(function(){window.location.pathname.match(/^\/marketplace\/\w+\/?\w*\/\w*-?/)?E.NF.getFBShareCount(window.location.href,e.handleFacebookSharing):e.contentType()===y.SCORE&&E.NF.getFBShareCount(e.contentModel().view_score_uri,e.handleFacebookSharing)},1)}},{key:"showScorePurchaseModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.productActionSection()&&this.productActionSection().showScorePurchaseModalIfPossible(e)}},{key:"handleFacebookSharing",value:function(e){this.facebookShareCount(e)}},{key:"closeScoreDetailsPanel",value:function(){this.showScoreDetails(!1),this.editor.html5EditorReady()&&this.editor.html5Editor().destroyMediaSyncViewerIfNeeded()}},{key:"openCloseScoreDetailsPanel",value:function(e){this.showScoreDetails()!==e&&(e?(this.editor.closeAllPanels(),this.openScoreDetailsPanel()):this.closeScoreDetailsPanel())}},{key:"toggleScoreDetailsPanel",value:function(){this.openCloseScoreDetailsPanel(!this.showScoreDetails())}},{key:"flagDocument",value:function(){(new v.default).show()}}]),e}();t.default=T},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(477),n=o(8),i=o(14),a=o(0),s=o(478);function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),this.initializeComputeds(),this.contentPolicy().is_from_content_library||this.loadFollowersCount(this.author()?this.author().id:null)}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.author=ko.observable(),this.isAuthor=ko.observable(),this.contentPolicy=ko.observable(),this.contentType=ko.observable(),this.editorReady=ko.observable(),this.followBusy=ko.observable(),this.followersCount=ko.observable(),this.authorLink=ko.observable(),this.cssAuthorAvatarUrl=ko.observable(),this.canFollowAuthor=ko.observable(),this.isDefaultCommunity=ko.observable(),(0,i.connect)(s.authorInformationSectionSelector,{followUser:r.followUser,unfollowUser:r.unfollowUser,loadFollowersCount:r.loadFollowersCount})(this)}},{key:"handleFollowUserClick",value:function(){this.followUser(this.author()?this.author().id:null)}},{key:"handleUnfollowUserClick",value:function(){this.unfollowUser(this.author()?this.author().id:null)}},{key:"initializeComputeds",value:function(){var e=this;this.showAuthorInfo=ko.computed(function(){var t=!e.contentPolicy().can_manage&&!e.contentPolicy().is_from_content_library,o=e.contentType()===n.PRODUCT,r=!e.isDefaultCommunity()&&e.contentPolicy().can_manage&&!e.isAuthor();return t||o||r}),this.authorUsername=ko.computed(function(){return e.author()?e.author().username:""}),this.authorFollowersCount=ko.computed(function(){return(0,a.pluralize)("content.followersWithCount",e.followersCount())})}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.followUser=function(e){return{type:r.FOLLOW_USER.REQUESTED,userId:e}},t.unfollowUser=function(e){return{type:r.UNFOLLOW_USER.REQUESTED,userId:e}},t.loadFollowersCount=function(e){return{type:r.LOAD_FOLLOWERS_COUNT.REQUESTED,userId:e}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(67))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authorInformationSectionSelector=t.canFollowAuthorSelector=void 0;var r=o(12),n=o(17),i=o(41),a=o(43),s=(0,r.createSelector)(i.currentUserIdSelector,n.editorAuthorSelector,i.isDefaultCommunitySelector,function(e,t,o){return o&&null!==e&&!!t&&e!==t.id});t.canFollowAuthorSelector=s;var l=(0,r.createSelector)(n.editorAuthorSelector,n.editorContentPolicySelector,n.editorContentTypeSelector,n.editorReadySelector,n.editorFollowBusySelector,n.editorFollowersCountSelector,s,i.isDefaultCommunitySelector,i.currentUserIdSelector,function(e,t,o,r,n,i,s,l,c){return{author:e,contentPolicy:t,contentType:o,editorReady:r,followBusy:n,followersCount:i,canFollowAuthor:s,authorLink:e?(0,a.buildUserLink)(e.id):"",cssAuthorAvatarUrl:e?(0,a.buildCssAvatarUrl)(e.id):"",isDefaultCommunity:l,isAuthor:null!==c&&!!e&&c===e.id}});t.authorInformationSectionSelector=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(6),i=o(36),a=o(14),s=o(0),l=o(480),c=o(5);function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=s.resource,this.initializeConnectedProperties(),this.editingTitle=ko.observable(!1),this.editingDescription=ko.observable(!1),this.newTitleText=ko.observable(""),this.newDescriptionText=ko.observable(""),this.descriptionHeight=ko.observable(0),this.descriptionShortened=ko.observable(!0),this.initializeComputeds(),(0,i.initializeTippy)(i.originalBadgeHint)}return function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.isProductCopy=ko.observable(),this.canEdit=ko.observable(),this.editorReady=ko.observable(),this.isOfficialProduct=ko.observable(),this.canEditTitle=ko.observable(),this.contentModel=ko.observable(),this.currentUserIsAuthor=ko.observable(),(0,a.connect)(l.scoreInformationSectionSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.descriptionActionText=ko.computed(function(){return e.descriptionShortened()?"action.showMore":"action.showLess"}),this.showShowMoreDescription=ko.computed(function(){return null!=e.contentModel().description&&e.descriptionHeight()>90}),this.titleText=ko.computed(function(){return null!=e.contentModel().title?e.contentModel().title:(0,s.resource)("score.untitled")})}},{key:"editTitle",value:function(){this.canEditTitle()&&(this.newTitleText(this.contentModel().title),this.editingTitle(!0),(0,n.$)("#titleArea").focus())}},{key:"saveNewTitle",value:function(){if(this.editingTitle()){var e=this.contentModel().title!=this.newTitleText();this.editorReady()&&r.default.publish(c.SCORE_SET_TITLE,this.newTitleText().trim()),this.editingTitle(!1),e&&r.default.publish(c.SCORE_REQUIRE_SAVE)}}},{key:"checkTitleLetter",value:function(e,t){if(13!=t.charCode)return!0;e.saveNewTitle()}},{key:"editDescription",value:function(){if(!this.canEdit())return!0;this.newDescriptionText(this.contentModel().description),this.editingDescription(!0),(0,n.$)("#descriptionArea").focus()}},{key:"saveNewDescription",value:function(){if(this.editingDescription()){var e=this.contentModel().description!=this.newDescriptionText();this.editorReady()&&r.default.publish(c.SCORE_SET_DESCRIPTION,this.newDescriptionText().trim()),this.editingDescription(!1),this.getDescriptionHeight(),e&&r.default.publish(c.SCORE_REQUIRE_SAVE)}}},{key:"toggleDescriptionLength",value:function(){this.descriptionShortened(!this.descriptionShortened())}},{key:"getDescriptionHeight",value:function(){(0,n.$)("#scoreDescription")[0]&&this.descriptionHeight((0,n.$)("#scoreDescription")[0].scrollHeight)}}]),e}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scoreInformationSectionSelector=t.canEditTitleSelector=t.isOfficialProductSelector=void 0;var r=o(12),n=o(17),i=o(8),a=(0,r.createSelector)(n.editorContentModelSelector,n.editorContentTypeSelector,function(e,t){return t==i.PRODUCT&&e.official});t.isOfficialProductSelector=a;var s=(0,r.createSelector)(n.editorContentPolicySelector,n.editorIsEditingProductSelector,function(e,t){return e.can_edit&&!e.is_product_copy&&!t});t.canEditTitleSelector=s;var l=(0,r.createSelector)(n.editorContentModelSelector,n.editorContentPolicySelector,n.editorReadySelector,a,s,n.currentUserIsAuthorSelector,function(e,t,o,r,n,i){return{contentModel:e,isProductCopy:t.is_product_copy,canEdit:t.can_edit,editorReady:o,isOfficialProduct:r,canEditTitle:n,currentUserIsAuthor:i}});t.scoreInformationSectionSelector=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(0),i=o(14),a=o(201),s=o(482),l=o(5);function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=n.resource,this.initializeConnectedProperties(),this.scoreFacets=new a.ScoreFacets,this.showFacets=ko.computed(function(){return t.editorReady()&&(t.canEdit()||null!=t.contentModel().metadata.genre||null!=t.contentModel().metadata.difficulty_level||null!=t.contentModel().metadata.format)}),this.showEditableFacets=ko.computed(function(){return t.editorReady()&&t.canEdit()&&!t.isEditingProduct()}),this.showUneditableFacets=ko.computed(function(){return t.editorReady()&&!t.showEditableFacets()&&(null!=t.contentModel().metadata.genre||null!=t.contentModel().metadata.difficulty_level||null!=t.contentModel().metadata.format)})}return function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(e,[{key:"handleFacetChange",value:function(){r.default.publish(l.SCORE_SET_FACETS,{difficulty_level:this.contentModel().metadata.difficulty_level,genre:this.contentModel().metadata.genre,format:this.contentModel().metadata.format}),r.default.publish(l.SCORE_REQUIRE_SAVE)}},{key:"initializeConnectedProperties",value:function(){this.canEdit=ko.observable(),this.editorReady=ko.observable(),this.contentModel=ko.observable(),this.isEditingProduct=ko.observable(),this.contentType=ko.observable(),(0,i.connect)(s.facetsSectionSelector,{})(this)}}]),e}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.facetsSectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentModelSelector,n.editorContentTypeSelector,n.editorContentPolicySelector,n.editorReadySelector,n.editorIsEditingProductSelector,function(e,t,o,r,n){return{contentModel:e,contentType:t,canEdit:o.can_edit,editorReady:r,isEditingProduct:n}});t.facetsSectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(14),i=function(e){return e&&e.__esModule?e:{default:e}}(o(101)),a=o(484);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),this.initializeComputeds()}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.sourceProduct=ko.observable(),this.song=ko.observable(),this.contentModel=ko.observable(),(0,n.connect)(a.productInformationSectionSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.contributorsList=ko.computed(function(){return new i.default(e.contentModel().contributors)}),this.showArtist=ko.computed(function(){return null!=e.contributorsList().extractArtist()}),this.totalComposers=ko.computed(function(){return e.contributorsList().extractComposers().length}),this.showComposer=ko.computed(function(){return e.totalComposers()>0}),this.showArranger=ko.computed(function(){return null!==e.contributorsList().firstArranger()}),this.arrangerText=ko.computed(function(){return e.contributorsList().firstArranger()}),this.showSourceProduct=ko.computed(function(){return null!=e.sourceProduct()}),this.showSection=ko.computed(function(){return e.showArtist()||e.showComposer()||e.showSourceProduct()}),this.artistText=ko.computed(function(){return e.showArtist()?e.contributorsList().extractArtist().name:""}),this.composerText=ko.computed(function(){return e.showComposer()?e.contributorsList().extractComposers().map(function(e){return e.name}).join(", "):""}),this.originalText=ko.computed(function(){var t=e.composerText(),o=e.song()&&e.song().title||"",n="";if(e.sourceProduct()&&e.sourceProduct().metadata.format){var i="format.".concat(e.sourceProduct().metadata.format);n="(".concat((0,r.resource)(i),")")}return(0,r.resource)("content.product.original",o,t,n)}),this.originalPath=ko.computed(function(){return e.sourceProduct()&&e.sourceProduct().marketplace_url||""})}}]),e}();t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.productInformationSectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentModelSelector,n.editorSongSelector,n.editorSourceProductSelector,function(e,t,o){return{contentModel:e,song:t,sourceProduct:o}});t.productInformationSectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=m(o(4)),n=o(2),i=o(36),a=o(0),s=m(o(486)),l=m(o(493)),c=m(o(494)),u=o(5),d=o(14),p=o(495),f=o(115),h=o(6);function m(e){return e&&e.__esModule?e:{default:e}}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.returnUrl=o,this.initializeConnectedProperties(),this.initializeLayoutObservables(),this.initializeText(),this.resource=a.resource,r.default.subscribe(u.MARKETPLACE_PRODUCT_PURCHASED,function(e,o){t.totalEnsembleSize(o.totalEnsembleSize),t.buttonText((0,a.resource)("action.purchased")),t.purchaseButtonDisabled(!0)})}return function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentModel=h.ko.observable(),this.purchaseInfo=h.ko.observable(),this.isEditingProduct=h.ko.observable(),this.currentUserIsAuthor=h.ko.observable(),this.currentUserIsProductOwner=h.ko.observable(),this.currentUserIsPreviewingProduct=h.ko.observable(),(0,d.connect)(p.productActionSectionSelector,{})(this)}},{key:"initializeLayoutObservables",value:function(){this.hideBottom=h.ko.observable(this.currentUserIsProductOwner()||this.currentUserIsAuthor()&&!this.isEditingProduct()),this.showPricing=h.ko.observable(this.currentUserIsPreviewingProduct()||this.currentUserIsAuthor()||this.isEditingProduct()),this.addMoreStyling=h.ko.observable(this.currentUserIsProductOwner()),this.previewStyling=h.ko.observable(this.currentUserIsPreviewingProduct()||this.currentUserIsAuthor()||this.isEditingProduct()),this.purchaseButtonDisabled=h.ko.observable(!1),this.showPurchaseButton=h.ko.observable(this.currentUserIsPreviewingProduct()),this.showAddMoreButton=h.ko.observable(this.currentUserIsProductOwner()&&this.purchaseInfo().ensembleSizeMax),this.showStopSellingButton=h.ko.observable(this.currentUserIsAuthor()&&!this.isEditingProduct())}},{key:"initializeText",value:function(){var e=this;this.totalEnsembleSize=h.ko.observable(),this.purchaseInfo().purchasedQuantity>0?this.totalEnsembleSize(this.purchaseInfo().purchasedQuantity*this.purchaseInfo().ensembleSizeMax):this.totalEnsembleSize(this.purchaseInfo().ensembleSizeMax),this.scorePurchaseEnsembleSizeText=h.ko.observable(),this.purchaseInfo()&&(this.purchaseInfo().ensembleSizeMax?this.scorePurchaseEnsembleSizeText((0,a.pluralize)("content.purchaseDetails",this.totalEnsembleSize())):this.scorePurchaseEnsembleSizeText((0,a.resource)("content.purchaseDetails.max"))),this.totalEnsembleSizeText=h.ko.computed(function(){return e.totalEnsembleSize()?(0,a.pluralize)("content.authorizedPerformers.plain.upTo",e.totalEnsembleSize()):(0,a.resource)("content.authorizedPerformers.maxSize")}),this.pricingText=(0,f.formatCurrency)(this.contentModel().price/100),this.genreText=this.contentModel().metadata.genre?(0,a.resource)("genre.".concat(this.contentModel().metadata.genre)):"",this.difficultyText=this.contentModel().metadata.difficulty_level?(0,a.resource)("difficultyLevel.".concat(this.contentModel().metadata.difficulty_level)):"",this.hintVisible=this.purchaseInfo().ensembleSizeMax>0,this.buttonText=h.ko.observable(),this.currentUserIsProductOwner()?this.buttonText((0,a.resource)("action.addMore")):this.currentUserIsPreviewingProduct()&&this.buttonText((0,a.resource)("action.purchaseScore"));var t=this.contentModel().sellable_arrangements?(0,a.resource)("content.sellingDetails.arrangeable.allowed"):(0,a.resource)("content.sellingDetails.arrangeable.notAllowed");this.sellableArrangementsText=(0,a.resource)("content.sellingDetails.arrangeable",t)}},{key:"initialize",value:function(){(0,i.initializeTippy)()}},{key:"handleEditScore",value:function(){this.showEditProductOptions()}},{key:"showEditProductOptions",value:function(){new c.default(this.contentModel()).show()}},{key:"purchaseButtonClick",value:function(){this.showScorePurchaseModal()}},{key:"showScorePurchaseModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,s.default)(this.returnUrl,e)}},{key:"showScorePurchaseModalIfPossible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.currentUserIsAuthor()||this.currentUserIsProductOwner()||this.showScorePurchaseModal(e.skipRR)}},{key:"stopSelling",value:function(){new l.default({callback:this.doStopSelling.bind(this)}).show()}},{key:"doStopSelling",value:function(){h.NF.apiService.deactivateProduct("",this.handleStopSellingComplete,{uuid:this.contentModel().id},{})}},{key:"handleStopSellingComplete",value:function(e){h.NF.analytics.trackEvent("Marketplace","unpublish_product"),(0,n.navigate)(e.score_url)}}]),e}();t.default=b},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){(0,y.createAndShowDialog)({viewModel:new R(e,t),templateName:"dialogs/scorePurchase"})},t.ScorePurchaseForm=t.PURCHASE_CREATE_IDENTITY=t.PURCHASE_CREATE_ACCOUNT=t.PURCHASE_SIGN_IN=void 0;var r=S(o(13)),n=S(o(42)),i=S(o(4)),a=o(6),s=o(5),l=S(o(487)),c=S(o(267)),u=S(o(490)),d=S(o(491)),p=S(o(492)),f=o(14),h=o(2),m=o(0),g=o(90),b=o(46),v=o(59),y=o(3),_=o(203);function S(e){return e&&e.__esModule?e:{default:e}}function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}t.PURCHASE_SIGN_IN="purchaseSignIn";var T="purchaseCreateAccount";t.PURCHASE_CREATE_ACCOUNT=T;t.PURCHASE_CREATE_IDENTITY="purchaseCreateIdentity";var R=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?C(e):t}(this,E(t).call(this))).returnUrl=o,e.skipRR=r,e.createAccountForm=null,e.signInForm=null,e.createIdentityForm=null,e.scrollEnsembleDropdown=e.scrollEnsembleDropdown.bind(C(C(e))),e.handleMarketplaceProductPurchased=e.handleMarketplaceProductPurchased.bind(C(C(e))),e.handleBuyerSignInProductPreview=e.handleBuyerSignInProductPreview.bind(C(C(e))),e.handleBuyerSignInProductOwned=e.handleBuyerSignInProductOwned.bind(C(C(e))),e.initializeConnectedProperties(),e.reporter=new n.default({marginTop:"0px"}),e.ready=ko.observable(!1),e.showSignInCreateAccount=ko.observable(T),e.scorePurchased=ko.observable(!1),e.wallet=ko.observable(),e.shoppingCartQuantity=ko.observable(0),e.initializeComputeds(),e.initializeSubscribers(),e.initializeDialog(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,r.default),function(e,t,o){t&&k(e.prototype,t),o&&k(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.contentModel=ko.observable(),this.currentUser=ko.observable(),this.purchaseInfo=ko.observable(),(0,f.connect)(_.scorePurchaseSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.productPrice=ko.computed(function(){return e.contentModel().price/100}),this.totalEnsembleSize=ko.computed(function(){return(e.purchaseInfo().purchasedQuantity+e.shoppingCartQuantity())*e.purchaseInfo().ensembleSizeMax}),this.headerText=ko.computed(function(){return e.wallet()&&e.purchaseInfo().purchasedQuantity?(0,m.resource)("action.addMore"):(0,m.resource)("action.purchaseScore")}),this.readyForPurchase=ko.computed(function(){var t=e.wallet()&&e.wallet().customerCardDisplay.getCard(e.wallet().selectedCard()),o=t&&t.inactive();return(!e.wallet()||!e.wallet().busy())&&(!(o&&!e.wallet().cardToUpload())&&0!==e.shoppingCartQuantity())})}},{key:"initializeSubscribers",value:function(){var e=this;this.ready.subscribe(function(t){t&&setTimeout(e.scrollEnsembleDropdown,10)}),this.purchasedToken=i.default.subscribe(s.MARKETPLACE_PRODUCT_PURCHASED,this.handleMarketplaceProductPurchased),i.default.subscribe(s.BUYER_SIGN_IN_PRODUCT_PREVIEW,this.handleBuyerSignInProductPreview),i.default.subscribe(s.BUYER_SIGN_IN_PRODUCT_OWNED,this.handleBuyerSignInProductOwned)}},{key:"scrollEnsembleDropdown",value:function(){this.shoppingCart.availableEnsembleSizes().length>0&&this.shoppingCart.ensembleDropdownViewModel.scrollToSelection()}},{key:"handleMarketplaceProductPurchased",value:function(e,t){this.scorePurchased(!0),(0,g.productPurchased)(this.contentModel(),t.transaction,t.totalEnsembleSize)}},{key:"handleBuyerSignInProductPreview",value:function(e,t){this.shoppingCartQuantity(t.currentPurchaseQuantity)}},{key:"handleBuyerSignInProductOwned",value:function(e,t){this.shoppingCart.showAlreadyPurchasedAlert(!0)}},{key:"initializeDialog",value:function(){this.shoppingCart=new l.default(this.shoppingCartQuantity),null===this.currentUser()&&(this.showSignInForm=this.showSignInForm.bind(this),this.showCreateAccountForm=this.showCreateAccountForm.bind(this),this.createAccountForm=new c.default(this.shoppingCartQuantity),this.signInForm=new u.default(this.shoppingCartQuantity,{closeDialog:!1,getPurchaseHistory:!0})),null===this.currentUser()||this.currentUser().identified||(this.showSignInCreateAccount("purchaseCreateIdentity"),this.createIdentityForm=new d.default),null!==this.currentUser()&&this.wallet(new p.default(this.reporter,this.shoppingCartQuantity,this.totalEnsembleSize,this.productPrice,this.ready,this.scorePurchased)),(0,g.startProductCheckout)(this.contentModel()),this.skipRR||((0,b.rrAddToCartPage)(this.contentModel().id),(0,b.rrCartPage)(this.contentModel().id)),v.AppCuesEventTracker.trackProductPurchaseBegun(this.contentModel().id)}},{key:"validate",value:function(){return this.reporter.errorsReporter.clearErrors(),this.wallet().validate(),this.shoppingCartQuantity()||this.reporter.errorsReporter.addError({code:"selectQuantity",message:(0,m.resource)("errors.missingQuantity")}),!this.reporter.errorsReporter.hasErrors()}},{key:"showSignInForm",value:function(){this.showSignInCreateAccount("purchaseSignIn")}},{key:"showCreateAccountForm",value:function(){this.showSignInCreateAccount(T)}},{key:"goToPurchasedScore",value:function(){location.reload()}},{key:"continueShopping",value:function(){this.returnUrl&&this.returnUrl.length>0?(0,h.navigate)(this.returnUrl):(0,h.navigate)(a.NF.paths.marketplace())}},{key:"doCancel",value:function(){return this.wallet()&&(i.default.unsubscribe(this.wallet().cardCreateToken),i.default.unsubscribe(this.wallet().cardsRetrievedToken),i.default.unsubscribe(this.wallet().cardCreationFailedToken),i.default.unsubscribe(this.wallet().cardEditingToken),i.default.unsubscribe(this.wallet().addErrorsToken),i.default.unsubscribe(this.shoppingCart.cardAddressToken),i.default.unsubscribe(this.shoppingCart.cardSelectionToken)),i.default.unsubscribe(this.purchasedToken),this.scorePurchased()&&this.goToPurchasedScore(),!0}},{key:"doOk",value:function(){this.wallet()?this.validate()&&this.wallet().doOk():(this.showSignInCreateAccount()===T&&(a.NF.analytics.trackEvent("Marketplace","signup","product"),this.createAccountForm.signup()),"purchaseSignIn"===this.showSignInCreateAccount()&&this.signInForm.login(),"purchaseCreateIdentity"===this.showSignInCreateAccount()&&this.createIdentityForm.goToPurchase())}}]),t}();t.ScorePurchaseForm=R},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=f(o(4)),n=f(o(488)),i=o(5),a=o(0),s=o(15),l=o(14),c=o(203),u=o(49),d=f(o(124)),p=o(115);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.quantity=t,this.initializeConnectedProperties(),this.initializeScoreInformation(),this.initializeEnsembleSizeInformation(),this.initializeShoppingCart(),this.purchaseInfo().ensembleSizeMax&&this.purchaseInfo().purchasedQuantity||this.quantity(1),this.purchaseInfo().ensembleSizeMax&&(this.generateAvailableEnsembleSizes(this.availableEnsembleSizes),this.ensembleDropdownViewModel=new n.default(this.availableEnsembleSizes,this.quantity,this.ensembleSizeOptionsFull,"115px","23px",function(){}),this.quantity(this.availableEnsembleSizes()[0].value)),this._initializeSubscribers()}return function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentModel=ko.observable(),this.purchaseInfo=ko.observable(),(0,l.connect)(c.scorePurchaseFormShoppingCartSelector,{})(this)}},{key:"_initializeSubscribers",value:function(){var e=this;this.cardAddressToken=r.default.subscribe(i.CUSTOMER_CARD_ADDRESS_CHANGED,function(t,o){o.address1()&&o.city()&&o.country()&&o.postalCode()&&o.state()&&e._updateTaxRateWithAddress(o)}),this.cardSelectionToken=r.default.subscribe(i.CUSTOMER_CARD_SELECTED_CHANGED,function(t,o){e._updateTaxRateWithCard(o)})}},{key:"_updateTaxRateWithAddress",value:function(e){var t=this,o={address1:e.address1(),city:e.city(),state:e.state(),country:e.country(),postal_code:e.postalCode()};NF.apiService.taxLookupWithAddress("",function(e){t.taxRate(parseFloat(e.tax_rate))},o,{})}},{key:"_updateTaxRateWithCard",value:function(e){var t=this;NF.apiService.taxLookupWithCard("",function(e){t.taxRate(parseFloat(e.tax_rate))},{source_id:e},{})}},{key:"initializeScoreInformation",value:function(){this.scoreName=this.contentModel().title,this.scoreComposer=(0,u.firstContributor)(this.contentModel().contributors);var e=new d.default(this.contentModel().cover_art_url,{scoreId:this.contentModel().id});this.coverArtViewModel=ko.computed(function(){return{coverArt:ko.observable(e),editable:ko.observable(!1),size:ko.observable("small")}}),this.minimumInitialPurchaseAmount=ko.observable(this.contentModel().minimum_initial_purchase_amount),this.scorePrice=this.contentModel().price/100,this.scorePriceText=(0,p.formatCurrency)(this.scorePrice),this.taxRate=ko.observable(null)}},{key:"initializeEnsembleSizeInformation",value:function(){var e=this;this.availableEnsembleSizes=ko.observableArray(),this.noMoreEnsemblesAvailable=ko.computed(function(){return 1==e.availableEnsembleSizes().length&&0==e.availableEnsembleSizes()[0].value}),this.ensembleSizeOptionsFull=ko.observable(!1)}},{key:"initializeShoppingCart",value:function(){var e=this;this.showAlreadyPurchasedAlert=ko.observable(!1),this.subTotal=ko.computed(function(){return e.scorePrice*e.quantity()}),this.subTotalText=ko.computed(function(){return"$".concat((0,s.getFormattedPrice)(e.subTotal()))}),this.tax=ko.computed(function(){return null!==e.taxRate()?e.subTotal()*e.taxRate():0}),this.taxText=ko.computed(function(){return null!==e.taxRate()?"$".concat((0,s.getFormattedPrice)(e.tax())):"-"}),this.totalPrice=ko.computed(function(){return e.subTotal()+e.tax()}),this.totalPriceText=ko.computed(function(){return"$".concat((0,s.getFormattedPrice)(e.totalPrice()))}),this.totalEnsembleSize=ko.computed(function(){return(e.purchaseInfo().purchasedQuantity+e.quantity())*e.purchaseInfo().ensembleSizeMax}),this.totalEnsembleSizeText=ko.computed(function(){return e.totalEnsembleSize()?(0,a.pluralize)("content.authorizedPerformers",e.totalEnsembleSize()):(0,a.resource)("content.authorizedPerformers.maxSize.fullText")})}},{key:"generateAvailableEnsembleSizes",value:function(e){for(var t=Math.ceil(100/this.purchaseInfo().ensembleSizeMax),o=1===this.purchaseInfo().ensembleSizeMax?"content.authorizedPerformers.plain":"content.authorizedPerformers.plain.upTo",r=this.minimumPurchaseAmount()+this.purchaseInfo().purchasedQuantity;r<t+1;r++){var n=r-this.purchaseInfo().purchasedQuantity,i=r*this.purchaseInfo().ensembleSizeMax;e.push({value:n,label:(0,a.pluralize)(o,i)})}}},{key:"minimumPurchaseAmount",value:function(){return this.purchaseInfo().purchasedQuantity>0?0:this.minimumInitialPurchaseAmount()?this.minimumInitialPurchaseAmount():1}}]),e}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(15);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,o,n,i,a){var s=this,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=ko.observable("".concat((0,r.generateUUID)())),this.options=t,this.selected=o,this.fullSize=n,this.maxHeight=i,this.minHeight=a,this.selectCallback=l,this.initializeComputeds(),this.handleSelection=this.handleSelection.bind(this),this.scrollToSelection=this.scrollToSelection.bind(this),this.addHover=this.addHover.bind(this),this.removeHover=this.removeHover.bind(this),$(function(){$("body").mousedown(function(e){$(e.target).hasClass("optionWrapper")||$(e.target).parents(".optionWrapper").length||(s.fullSize(!1),s.scrollToSelection())})})}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"initializeComputeds",value:function(){var e=this;this.height=ko.computed(function(){return e.fullSize()?"unset":e.minHeight}),this.overflowY=ko.computed(function(){return e.fullSize()?"auto":"hidden"})}},{key:"handleSelection",value:function(e,t){var o=t||window.event,r=this._getOptionWrapper(o.target);if(r){this.fullSize(!0);var n=this.selected(),i=parseInt($(r).attr("value"));n!==i&&(this.selected(i),this.fullSize(!1),this.scrollToSelection(),this.removeHover(e,o)),this.selectCallback()}}},{key:"init",value:function(){var e=this;setTimeout(function(){e.scrollToSelection()},10)}},{key:"scrollToSelection",value:function(){var e=$("#".concat(this.id())),t=$(".optionWrapper.focus");e.length&&t.length&&e.scrollTop(t.offset().top-e.offset().top+e.scrollTop())}},{key:"addHover",value:function(e,t){var o=t||window.event;if(this.fullSize()){var r=this._getOptionWrapper(o.target);r&&$(r).css("background-color","#efeede")}}},{key:"removeHover",value:function(e,t){var o=t||window.event,r=this._getOptionWrapper(o.target);r&&$(r).css("background-color","unset")}},{key:"_getOptionWrapper",value:function(e){return $(e).hasClass("optionWrapper")||(e=$(e).parents(".optionWrapper")[0]),e||!1}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.value=t||ko.observable(!0),this.validationFlag=o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(14),n=o(203),i=function(e){return e&&e.__esModule?e:{default:e}}(o(125));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,o){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(o):n.value}})(e,t,o||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(e){function t(e){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?d(e):t}(this,c(t).call(this,r))).shoppingCartQuantity=e,o.callback=o.handleSignIn.bind(d(d(o))),o.initializeConnectedProperties(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,i.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.contentId=ko.observable(),this.author=ko.observable(),(0,r.connect)(n.scorePurchaseFormSignInSelector,{})(this)}},{key:"loginWithFacebook",value:function(){NF.hasStorage&&localStorage.setItem("productPurchasing-".concat(this.contentId()),this.shoppingCartQuantity()),l(c(t.prototype),"loginWithFacebook",this).call(this)}},{key:"loginWithGoogle",value:function(){NF.hasStorage&&localStorage.setItem("productPurchasing-".concat(this.contentId()),this.shoppingCartQuantity()),l(c(t.prototype),"loginWithGoogle",this).call(this)}},{key:"handleSignIn",value:function(e){if(e.login.current_user.external_id!=this.author().id)return NF.hasStorage?(localStorage.setItem("productPurchasing-".concat(this.contentId()),this.shoppingCartQuantity()),void NF.reloadWindow()):void 0;NF.reloadWindow()}}]),t}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(267)),n=o(0);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this))).originalEmail=NF.session.current_user().email(),e.originalEmail&&e.email(e.originalEmail),e.handleEditProfile=e.handleEditProfile.bind(c(c(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"params",value:function(){var e={user:{profile:{},username:this.username()},purchase_form_entrypoint:!0};return this.originalEmail||(e.user.email=this.email()),e}},{key:"validateIdentity",value:function(){return this.originalEmail?this.validateUsername():this.validateUsername()&&this.validateEmail()}},{key:"goToPurchase",value:function(){var e=this;this.validateIdentity()&&NF.apiService.editProfile({text:(0,n.resource)("account.savingInfo"),fullScreen:!0,withBackground:!0},function(t){return e.handleEditProfile(t)},this.params(),{})}},{key:"handleEditProfile",value:function(e){NF.session.current_user().username(e.user.username),NF.session.current_user().identified(!0)}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=g(o(4)),n=g(o(242)),i=g(o(244)),a=g(o(245)),s=g(o(193)),l=o(6),c=o(5),u=o(0),d=o(14),p=o(17),f=o(59),h=o(46),m=o(15);function g(e){return e&&e.__esModule?e:{default:e}}function b(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t,o,r,i,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reporter=t,this.quantity=o,this.totalEnsembleSize=r,this.scorePrice=i,this.ready=c,this.scorePurchased=u,this.customerCardDisplay=new a.default,this.customerCardCreationForm=new n.default(new s.default,{reporter:this.reporter}),this.busy=ko.observable(!1),this.idempotencyKey=(0,m.generateUUID)(),this.fullNameInProfile=ko.observable(l.NF.session.current_user()&&l.NF.session.current_user().profile().first_name()&&l.NF.session.current_user().profile().last_name()),this.firstName=ko.observable(l.NF.session.current_user()&&l.NF.session.current_user().profile().first_name()),this.lastName=ko.observable(l.NF.session.current_user()&&l.NF.session.current_user().profile().last_name()),this.showNewCardForm=ko.observable(!1),this.selectedCard=ko.observable(),this.cardToUpload=ko.observable(!1),this._initializeSubscriptions(),this.initializeConnectedProperties()}return function(e,t,o){t&&b(e.prototype,t),o&&b(e,o)}(e,[{key:"_initializeSubscriptions",value:function(){var e=this;this.cardsRetrievedToken=r.default.subscribe(c.CUSTOMER_CARDS_RETRIEVED,function(t,o){0===e.customerCardDisplay.existingCards().length?e.useDifferentCard():e.selectedCard(o[0].id),e._markReady()}),this.cardCreateToken=r.default.subscribe(c.CUSTOMER_CARD_CREATED,function(t,o){e._selectCardAndPurchase(o)}),this.cardCreationFailedToken=r.default.subscribe(c.CUSTOMER_CARD_CREATION_FAILED,function(t,o){e._markUnbusy(),$("#scorePurchase").scrollTop(0)}),this.cardEditingToken=r.default.subscribe(c.STRIPE_CARD_EDITING_NUMBER,function(t,o){e._markUnbusy()}),this.addErrorsToken=r.default.subscribe(c.REPORTER_ADD_ERRORS,function(t,o){e._markUnbusy()}),r.default.subscribe(c.CUSTOMER_CARD_UPDATED,function(t,o){e.customerCardDisplay.replaceCard(e.customerCardCreationForm.customerCard.id(),o.card),e._markUnbusy(),e.showNewCardForm(!1)}),r.default.subscribe(c.CUSTOMER_CARD_DELETED,function(t,o){e.customerCardDisplay.deleteCard(o)}),this.selectedCard.subscribe(function(){e.idempotencyKey=(0,m.generateUUID)(),e._publishCardSource()})}},{key:"initializeConnectedProperties",value:function(){this.contentId=ko.observable(),(0,d.connect)(p.productIdSelector,{})(this)}},{key:"_publishCardSource",value:function(){this.selectedCard()&&r.default.publish(c.CUSTOMER_CARD_SELECTED_CHANGED,this.selectedCard())}},{key:"_markUnbusy",value:function(){this.busy(!1)}},{key:"_markBusy",value:function(){this.busy(!0)}},{key:"_markReady",value:function(){this.ready(!0)}},{key:"_selectCardAndPurchase",value:function(e){e.saved&&this.customerCardDisplay.addExistingCard(e.card),this.cardToUpload(!1),this.selectedCard(e.card.id),this._purchase()}},{key:"doOk",value:function(){this.cardToUpload()?(this._markBusy(),this.customerCardCreationForm.uploadCard()):this._purchase()}},{key:"_purchase",value:function(){this._markBusy();var e=this._buildPurchaseParams();l.NF.apiService.purchaseProduct({text:(0,u.resource)("action.purchasing"),fullScreen:!0,withBackground:!0},this._handlePurchaseSuccess.bind(this),e,{fail:this._handlePurchaseError.bind(this)})}},{key:"_buildPurchaseParams",value:function(){return{card_id:this.selectedCard(),idempotency_key:this.idempotencyKey,product_uuid:this.contentId(),quantity:this.quantity(),first_name:this.firstName(),last_name:this.lastName()}}},{key:"_handlePurchaseSuccess",value:function(e){r.default.publish(c.REPORTER_REMOVE,{fullScreen:!0}),l.NF.analytics.trackEvent("Marketplace","score_purchase",this.scorePrice*this.quantity()),f.AppCuesEventTracker.trackProductPurchaseComplete(this.contentId()),(0,h.rrPurchaseCompletePage)(e.transaction.external_id,e.transaction.product.id,(0,m.formatPriceInCents)(e.transaction.product.price,{currency:""}),e.transaction.purchased_quantity),this._markUnbusy(),r.default.publish(c.MARKETPLACE_PRODUCT_PURCHASED,{totalEnsembleSize:this.totalEnsembleSize(),transaction:e.transaction}),this.scorePurchased(!0)}},{key:"_handlePurchaseError",value:function(e){var t=this;this._markUnbusy();var o="errors.generalPaymentProcessorError";Array.isArray(e)&&e[0].code&&(o="errors."+e[0].code),r.default.publish(c.REPORTER_REMOVE,{fullScreen:!0}),r.default.publish(c.REPORTER_ADD_ERROR,{code:"purchasingError",message:(0,u.resource)(o),fullScreen:!0,withBackground:!0,continueCallback:function(){t._purchase()},continueText:(0,u.resource)("action.retry")})}},{key:"editCard",value:function(e){this.customerCardCreationForm=new n.default(e,{reporter:this.reporter}),this.cardToUpload(!0),this.showNewCardForm(!0)}},{key:"removeCard",value:function(e){var t=e.clone();t.showButtons(!1),new i.default(t).show()}},{key:"useDifferentCard",value:function(){this.showNewCardForm(!0),this.cardToUpload(!0)}},{key:"cancelUseDifferentCard",value:function(){this.showNewCardForm(!1),this.cardToUpload(!1)}},{key:"retrieveCustomerCards",value:function(){this.customerCardDisplay.retrieveCards()}},{key:"validate",value:function(){this.firstName()&&this.lastName()&&!/^\s*$/.test(this.firstName())&&!/^\s*$/.test(this.lastName())||this.reporter.errorsReporter.addError({code:"missingName",message:(0,u.resource)("errors.missingName")}),this.selectedCard()||this.cardToUpload()||this.reporter.errorsReporter.addError({code:"selectCard",message:(0,u.resource)("errors.missingCard")})}}]),e}();t.default=v},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(3);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=s(this,l(t).call(this)))._callback=e.callback,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"doStopSelling",value:function(){this.cancel(),this._callback(),NF.analytics.trackEvent("Marketplace","score_unpublish")}},{key:"show",value:function(){(0,n.createAndShowDialog)({viewModel:this,templateName:"dialogs/stopSelling"})}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(3),i=function(e){return e&&e.__esModule?e:{default:e}}(o(13));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this))).product=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,i.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"handleUpdateSellingDetails",value:function(){NF.analytics.trackEvent("Marketplace","edit_selling_details"),(0,r.navigate)((0,r.path)("productEditing",{uuid:this.product.uuid,slug:this.product.slug,openSellingDialog:!0}))}},{key:"handleEditScore",value:function(){NF.analytics.trackEvent("Marketplace","edit_score"),(0,r.navigate)((0,r.path)("productEditing",{uuid:this.product.uuid,slug:this.product.slug}))}},{key:"show",value:function(){return(0,n.createAndShowDialog)({viewModel:this,templateName:"dialogs/editProductOptions"}),this}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.productActionSectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentModelSelector,n.editorPurchaseInfoSelector,n.editorIsEditingProductSelector,n.currentUserIsAuthorSelector,n.currentUserIsProductOwnerSelector,n.currentUserIsPreviewingProductSelector,function(e,t,o,r,n,i){return{contentModel:e,purchaseInfo:t,isEditingProduct:o,currentUserIsAuthor:r,currentUserIsProductOwner:n,currentUserIsPreviewingProduct:i}});t.productActionSectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=v(o(4)),n=o(8),i=o(0),a=o(14),s=o(6),l=o(497),c=o(498),u=v(o(501)),d=v(o(505)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(269)),f=v(o(506)),h=v(o(508)),m=v(o(273)),g=o(5),b=o(100);function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),this.score=(0,b.getApplicationEditor)().score(),this.googleClassroomTurnInViewModel=new u.default(this.score),this.googleClassroomScoreInfoViewModel=new d.default(this.score,this.canManage),this.googleClassroomCourseWorkCreationViewModel=new c.GoogleClassroomCourseWorkCreationViewModel(this.score,this.isShared),this.commerceLinks=new m.default,this.showRegularSharingInfo=s.ko.computed(function(){return t.canShare()&&!t.googleClassroomCourseWorkCreationViewModel.assignmentCreated()}),this.sharedWithEveryoneSummary=s.ko.computed(function(){if(!this.isSharedWithEveryone()||null==this.everyoneRole())return null;var e=this.isDefaultCommunity()?"editor.sharingInfo.everyone":"editor.sharingInfo.siteMembers",t=this.mapRoleNameToResource(this.everyoneRole().role_name),o=this.searchable()?"":".link";return(0,i.resource)(e+t+o)}.bind(this)),this.sharedGroupReaderSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.groups.view",t.sharedGroupReaderCount())}),this.sharedGroupReviewerSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.groups.comment",t.sharedGroupReviewerCount())}),this.sharedGroupCoauthorSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.groups.makeChanges",t.sharedGroupCoauthorCount())}),this.sharedUserReaderSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.individuals.view",t.sharedUserReaderCount())}),this.sharedUserReviewerSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.individuals.comment",t.sharedUserReviewerCount())}),this.sharedUserCoauthorSummary=s.ko.computed(function(){return(0,i.pluralize)("editor.sharingInfo.individuals.makeChanges",t.sharedUserCoauthorCount())}),this.expandable=s.ko.computed(function(){return t.canShare()}),this.expandShareScoreSection=s.ko.observable(!1),this.shareScoreSectionStatus=s.ko.computed(function(){return t.expandShareScoreSection()?"sectionUnexpand":"sectionExpand"}),this.shareButtonText=s.ko.computed(function(){var e=t.isShared()?"action.edit":"editorDialog.share";return(0,i.resource)(e)}),this.showCommerceLinks=s.ko.computed(function(){return t.isShared()&&t.hasCopyrightedSongs()})}return function(e,t,o){t&&y(e.prototype,t),o&&y(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.authorship=s.ko.observable(),this.canEdit=s.ko.observable(),this.canExport=s.ko.observable(),this.canManage=s.ko.observable(),this.canShare=s.ko.observable(),this.canShareWithIndividuals=s.ko.observable(),this.copyable=s.ko.observable(),this.effectiveRole=s.ko.observable(),this.everyoneRole=s.ko.observable(),this.hasCopyrightedSongs=s.ko.observable(),this.isDefaultCommunity=s.ko.observable(),this.isProductCopy=s.ko.observable(),this.isShared=s.ko.observable(),this.isSharedWithEveryone=s.ko.observable(),this.isSharedWithGroups=s.ko.observable(),this.isSharedWithUsers=s.ko.observable(),this.scoreTitle=s.ko.observable(),this.searchable=s.ko.observable(),this.sharedGroupCount=s.ko.observable(),this.sharedGroupReaderCount=s.ko.observable(),this.sharedGroupReviewerCount=s.ko.observable(),this.sharedGroupCoauthorCount=s.ko.observable(),this.sharedUserCount=s.ko.observable(),this.sharedUserReaderCount=s.ko.observable(),this.sharedUserReviewerCount=s.ko.observable(),this.sharedUserCoauthorCount=s.ko.observable(),this.template=s.ko.observable(),this.community=s.ko.observable(),(0,a.connect)(l.shareScoreSectionSelector,{})(this)}},{key:"initializeGoogleConnections",value:function(){this.community().is_google_classroom&&(s.NF.roles.isSiteStudent()&&this.score.isGoogleCourseWork()?this.googleClassroomTurnInViewModel.initializeGoogleConnections():s.NF.roles.isAtLeastSiteTeacher()&&(this.canManage()?this.googleClassroomCourseWorkCreationViewModel.initializeGoogleConnections():this.googleClassroomScoreInfoViewModel.initializeGoogleConnections()))}},{key:"mapRoleNameToResource",value:function(e){switch(e){case n.DOCUMENT_ROLE_READER:return".view";case n.DOCUMENT_ROLE_REVIEWER:return".comment";case n.DOCUMENT_ROLE_COAUTHOR:return".makeChanges"}return""}},{key:"toggleShareScoreSection",value:function(){this.expandShareScoreSection(!this.expandShareScoreSection())}},{key:"handleShareClick",value:function(){this.score.title()?new f.default(h.default).show():new p.default(p.SHARING).show(function(e){r.default.publish(g.SCORE_FORCE_SAVE),e&&new f.default(h.default).show()})}}]),e}();t.default=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shareScoreSectionSelector=t.sharingSummarySelector=void 0;var r=o(12),n=o(17),i=o(41),a=o(92),s=o(8);function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var c=(0,r.createSelector)(n.editorContentModelSelector,a.sharedDocumentRolesSelector,n.editorAuthorshipSelector,function(e,t,o){for(var r=0,n=0,i=0,a=0;a<t.groupDocumentRoles.length;a++){switch(t.groupDocumentRoles[a].role_name){case s.DOCUMENT_ROLE_COAUTHOR:i++;break;case s.DOCUMENT_ROLE_REVIEWER:n++;break;case s.DOCUMENT_ROLE_READER:r++}}for(var l=0,c=0,u=0,d=0;d<t.userDocumentRoles.length;d++){switch(t.userDocumentRoles[d].role_name){case s.DOCUMENT_ROLE_COAUTHOR:u++;break;case s.DOCUMENT_ROLE_REVIEWER:c++;break;case s.DOCUMENT_ROLE_READER:l++}}var p=t.groupDocumentRoles.length,f=t.userDocumentRoles.length,h=null!==t.everyoneDocumentRole,m=p>0,g=f>0;return{authorship:o,copyable:e.copyable,everyoneRole:t.everyoneDocumentRole,isShared:h||m||g,isSharedWithEveryone:h,isSharedWithGroups:m,isSharedWithUsers:g,searchable:e.searchable,sharedGroupCount:p,sharedGroupReaderCount:r,sharedGroupReviewerCount:n,sharedGroupCoauthorCount:i,sharedUserCount:f,sharedUserReaderCount:l,sharedUserReviewerCount:c,sharedUserCoauthorCount:u,template:e.template}});t.sharingSummarySelector=c;var u=(0,r.createSelector)(n.editorContentPolicySelector,n.editorContentModelSelector,i.isDefaultCommunitySelector,c,n.hasCopyrightedSongsSelector,i.sessionCommunitySelector,function(e,t,o,r,n,i){return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(t){l(e,t,o[t])})}return e}({canEdit:e.can_edit,canExport:e.can_export,canManage:e.can_manage,canShare:e.can_share,canShareWithIndividuals:e.enable_user_based_sharing,effectiveRole:e.user_role,isDefaultCommunity:o,isProductCopy:e.is_product_copy,scoreTitle:t.title,hasCopyrightedSongs:n,community:i},r)});t.shareScoreSectionSelector=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleClassroomCourseWorkCreationViewModel=t.GoogleClassroomClassViewModel=void 0;var r=u(o(268)),n=u(o(499)),i=u(o(61)),a=o(8),s=o(0),l=o(3),c=o(20);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function e(t,o,r){p(this,e),this.className=t,this.classId=o,this.groupId=r};t.GoogleClassroomClassViewModel=f;var h=function(){function e(t,o){var r=this;p(this,e),this.score=t,this.isScoreShared=o,this.assignmentCreated=ko.observable(this.score.isGoogleCourseWork()),this.googleClasses=ko.observableArray([]),this.googleClassroomCourseWorkModel=new n.default,this.selectedClass=ko.observable(),this.courseWorkTitle=ko.observable(""),this.description=ko.observable(),this.dueDateValue=ko.observable(),this.serviceReporter=new Noteflight.ServiceReporterViewModel((0,s.resource)("gc.loadingCourseWork")),this.permissions=ko.observable([{name:(0,s.resource)("editor.sharingInfo.templateGc"),value:"template"},{name:(0,s.resource)("editor.sharingInfo.roleCoauthor"),value:a.DOCUMENT_ROLE_COAUTHOR},{name:(0,s.resource)("editor.sharingInfo.roleCommenter"),value:a.DOCUMENT_ROLE_REVIEWER},{name:(0,s.resource)("editor.sharingInfo.roleReader"),value:a.DOCUMENT_ROLE_READER}]),this.selectedPermission=ko.observable(this.permissions()[0]),this.formReady=ko.observable(!1),this.showGoogleClassroomCourseWorkForm=ko.observable(!1),this.showGoogleClassroomCourseWorkForm.subscribe(function(e){e&&setTimeout(function(){r._initializeDatePicker()},100)}),this.resource=s.resource,this._initializeComputeds()}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"_doToggleShowGoogleClasroomCourseWorkForm",value:function(){this.showGoogleClassroomCourseWorkForm(!this.showGoogleClassroomCourseWorkForm())}},{key:"toggleShowGoogleClassroomCourseWorkForm",value:function(){var e=this;this.showGoogleClassroomCourseWorkForm()||!this.isScoreShared()||this.assignmentCreated()?this._doToggleShowGoogleClasroomCourseWorkForm():(0,l.showSimpleDialog)("content.scoreAccess","content.removeSharingSettingsWarning",function(){e._doToggleShowGoogleClasroomCourseWorkForm()},{okText:"action.continue"})}},{key:"removeAssignment",value:function(){var e=this,t={score_id:this.score.external_id(),searchable:this.score.searchable(),copyable:this.score.copyable(),template:!1,authorship:a.ORIGINAL_AUTHORSHIP,groups:[]},o=$.Deferred(),r=$.Deferred();$.when(o,r).then(function(){e.assignmentCreated(!1),e.googleClassroomCourseWorkModel.courseWork(null),e.score.google_course_work_id(null),e.score.google_course_id(null),e._doToggleShowGoogleClasroomCourseWorkForm()}),NF.apiService.scoreSharing(this.serviceReporter,o.resolve,t,{}),NF.apiService.deleteGoogleClassroomCourseWork(this.serviceReporter,r.resolve,{courseWorkId:this.score.google_course_work_id(),courseId:this.score.google_course_id(),scoreId:this.score.external_id()})}},{key:"_initializeComputeds",value:function(){var e=this;this.showGoogleClassroomCourseWorkButton=ko.computed(function(){return NF.roles.isAtLeastSiteTeacher()&&NF.session.community().is_google_classroom()&&!e.score.template_copy()}),this.displayedTitle=ko.computed(function(){if(e.googleClassroomCourseWorkModel.courseWork()&&e.googleClassroomCourseWorkModel.courseWork().title)return e.googleClassroomCourseWorkModel.courseWork().title}),this.validCourseWork=ko.computed(function(){return!!(void 0!==e.selectedClass()&&e.courseWorkTitle().length>0&&e.selectedPermission())}),this.alreadySaved=ko.computed(function(){return!(!e.googleClassroomCourseWorkModel.courseWork()||!e.googleClassroomCourseWorkModel.courseWork().id)}),this.dueDate=ko.computed({read:function(){return e.dueDateValue()?(0,c.formatDate)(e.dueDateValue()):(0,s.resource)("content.none")},write:function(t){e.dueDateValue(t)}})}},{key:"_initializePermissions",value:function(){if(this.selectedClass())if(this.score.template())this.selectedPermission(this._getPermissionWithValue("template"));else for(var e=0;e<this.score.roles().length;e++)this.score.roles()[e].group&&this.score.roles()[e].group.id()==this.selectedClass().groupId&&this.selectedPermission(this._getPermissionWithValue(this.score.roles()[e].role_name()))}},{key:"_getPermissionWithValue",value:function(e){for(var t=0;t<this.permissions().length;t++)if(this.permissions()[t].value==e)return this.permissions()[t];return null}},{key:"initializeGoogleConnections",value:function(){var e=i.default.getAuthLink({returnTo:window.location.pathname,googleClassroom:!0,referringHostname:!0});i.default.checkAuthorization(e).then(this._getClasses.bind(this))}},{key:"_initializeDatePicker",value:function(){var e=this,t=(0,c.getDefaultDatepickerOptions)();t.pick=function(t){e.dueDateValue(t.date)},$(".datepicker").datepicker(t)}},{key:"selectDueDate",value:function(e,t){t.stopPropagation(),$(".datepicker").datepicker("show")}},{key:"clearDueDate",value:function(){this.dueDateValue(null)}},{key:"saveGoogleClassroomCourseWork",value:function(){var e=this;if(this.serviceReporter.clearErrors(),!this.validCourseWork())return!1;var t="template"===this.selectedPermission().value?"coauthor":this.selectedPermission().value,o="template"===this.selectedPermission().value,r=[{role:t,id:this.selectedClass().groupId}],n={score_id:this.score.external_id(),searchable:this.score.searchable(),copyable:this.score.copyable(),template:o,authorship:a.ORIGINAL_AUTHORSHIP,groups:r},i=$.Deferred(),s=$.Deferred(),l=this.serviceReporter.actionLabel();this.serviceReporter.actionLabel(null),$.when(i,s).then(function(){e.toggleShowGoogleClassroomCourseWorkForm(),e.assignmentCreated(!0),e.score.isGoogleCourseWork(!0),e.serviceReporter.actionLabel(l)}),NF.apiService.scoreSharing(this.serviceReporter,function(){i.resolve()},n,{}),this.alreadySaved()?this.googleClassroomCourseWorkModel.updateCourseWork(this.score,this.courseWorkTitle(),this.description(),this.dueDateValue(),this.selectedClass().classId,function(){s.resolve()}):this.googleClassroomCourseWorkModel.saveCourseWork(this.score,this.courseWorkTitle(),this.description(),this.dueDateValue(),this.selectedClass().classId,function(){s.resolve()})}},{key:"_getClasses",value:function(){NF.apiService.fetchGoogleClassesForInstructor(this.serviceReporter,this._getClassesSuccess.bind(this),{},{})}},{key:"_getClassesSuccess",value:function(e){this._fillClasses(e),this.score.google_course_id()&&this.score.google_course_work_id()?this._getCourseWork():this.formReady(!0)}},{key:"_fillClasses",value:function(e){if(e.groups){var t=!0,o=!1,r=void 0;try{for(var n,i=e.groups[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var a=n.value,s=new f(a.name,a.course_id,a.id);this.googleClasses.push(s)}}catch(e){o=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(o)throw r}}}}},{key:"_getCourseWork",value:function(){var e=this;NF.apiService.getGoogleClassroomCourseWorkForScore(this.serviceReporter,this._courseWorkSuccess.bind(this),{courseId:this.score.google_course_id(),courseWorkId:this.score.google_course_work_id(),scoreId:this.score.external_id()},{fail:function(){e._courseWorkError()}})}},{key:"_courseWorkSuccess",value:function(e){var t=new r.default(e);if(this.googleClassroomCourseWorkModel.courseWork(t),this.dueDateValue(t.unpackDueDate()),this.googleClassroomCourseWorkModel.courseWork()){this.courseWorkTitle(this.googleClassroomCourseWorkModel.courseWork().title),this.description(this.googleClassroomCourseWorkModel.courseWork().description);var o=!0,n=!1,i=void 0;try{for(var a,s=this.googleClasses()[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var l=a.value;l.classId==this.googleClassroomCourseWorkModel.courseWork().course_id&&this.selectedClass(l)}}catch(e){n=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(n)throw i}}}this.selectedClass()&&this._initializePermissions(),this.formReady(!0)}},{key:"_courseWorkError",value:function(){this.serviceReporter.hasErrors()&&"googleCourseWorkRemoved"==this.serviceReporter.errors()[0].code&&this.formReady(!0)}}]),e}();t.GoogleClassroomCourseWorkCreationViewModel=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o(500)),n=a(o(268)),i=o(0);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.serviceReporter=new NF.ServiceReporterViewModel((0,i.resource)("editor.loading"),null,null,null,{marginTop:"0px"}),this.courseWork=ko.observable()}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"saveCourseWork",value:function(e,t,o,r,n,a){var s=this;if(this.serviceReporter.clearErrors(),this._generateCourseWorkObject(e,t,o,r),this.score=e,this.successCallback=a,this._validateCourseWork(),this.serviceReporter.hasErrors())return!1;var l={courseId:n,scoreId:e.external_id(),payload:this.courseWork()};NF.apiService.createGoogleClassroomCourseWork((0,i.resource)("gc.createCourseWork"),function(e){s._courseWorkSuccess(e,s.score,s.successCallback)},l,{})}},{key:"updateCourseWork",value:function(e,t,o,r,n,a){var s=this;if(this.serviceReporter.clearErrors(),this._generateCourseWorkObject(e,t,o,r),this.score=e,this.successCallback=a,this._validateCourseWork(),this.serviceReporter.hasErrors())return!1;var l=this._generateCourseWorkUpdate(),c={courseId:n,courseWorkId:this.courseWork().id,newValues:l};NF.apiService.updateGoogleClassroomCourseWork((0,i.resource)("gc.createCourseWork"),function(e){s._courseWorkSuccess(e,s.score,s.successCallback)},c,{})}},{key:"_validateCourseWork",value:function(){!this.courseWork().due_date||this.courseWork().validDueDate()||this.serviceReporter.errors.push({message:(0,i.resource)("errors.invalidGoogleClassroomDueDate")})}},{key:"_generateCourseWorkObject",value:function(e,t,o,i){var a={title:t,state:"PUBLISHED",work_type:"ASSIGNMENT",materials:[{link:r.default.linkFromScore(e)}]};o&&(a.description=o),i&&(a.due_date=n.default.dueDateObject(i),a.due_time=n.default.dueTimeObject(new Date(2e3,12,12,11,59))),this.courseWork()&&this.courseWork().id&&(a.id=this.courseWork().id),this.courseWork(new n.default(a))}},{key:"_generateCourseWorkUpdate",value:function(){return{title:this.courseWork().title,description:this.courseWork().description,due_date:this.courseWork().due_date,due_time:this.courseWork().due_time}}},{key:"_courseWorkSuccess",value:function(e,t,o){this.courseWork(new n.default(e)),t.google_course_id(e.course_id),t.google_course_work_id(e.id),o&&o()}}]),e}();t.default=l},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t.url,this.title=t.title,this.thumbnailUrl=t.thumbnailUrl}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,null,[{key:"linkFromScore",value:function(t){return new e({url:t.view_score_uri(),title:t.title()})}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(502)),n=s(o(504)),i=s(o(61)),a=o(0);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=t,this.courseWorkTitle=ko.observable(),this.description=ko.observable(),this.turnIn=new r.default,this._initializeObservables(),this._initializeComputeds(),this.turnInGoogleClassroomSubmission=function(){this.turnIn.turnIn(this.score)},this.reclaimGoogleClassroomSubmission=function(){this.turnIn.reclaim()}}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"_initializeObservables",value:function(){}},{key:"_initializeComputeds",value:function(){var e=this;this.turnInButtonLabel=ko.computed(function(){return e.score.template_copy()?(0,a.resource)("action.turnIn"):(0,a.resource)("action.markAsDone")}),this.showGoogleTurnInForm=ko.computed(function(){return e.score.isGoogleCourseWork()&&NF.roles.isSiteStudent()&&NF.session.community().is_google_classroom()}),this.readyToShow=ko.computed(function(){return!(!e.courseWorkTitle()||!e.turnIn.studentSubmission())}),this.canReclaim=ko.computed(function(){return e.turnIn.studentSubmission()&&e.turnIn.studentSubmission().canReclaim()}),this.canTurnIn=ko.computed(function(){return e.turnIn.studentSubmission()&&e.turnIn.studentSubmission().canTurnIn()})}},{key:"_doInitializeGoogleConnections",value:function(){this.score.isGoogleCourseWork()&&(this._getCourseWork(),this.score.google_submission_id()?this._getSubmission():this._findSubmission())}},{key:"initializeGoogleConnections",value:function(){var e=i.default.getAuthLink({returnTo:window.location.pathname,googleClassroom:!0,referringHostname:!0});i.default.checkAuthorization(e).then(this._doInitializeGoogleConnections.bind(this))}},{key:"_getCourseWork",value:function(){NF.apiService.getGoogleClassroomCourseWorkForScore((0,a.resource)("gc.loadingCourseWork"),this._courseWorkSuccess.bind(this),{courseId:this.score.google_course_id(),courseWorkId:this.score.google_course_work_id(),scoreId:this.score.external_id()},{})}},{key:"_courseWorkSuccess",value:function(e){this.courseWorkTitle(e.title),this.description(e.description)}},{key:"_getSubmission",value:function(){NF.apiService.getStudentSubmission((0,a.resource)("gc.loadingCourseWork"),this._getSubmissionSuccess.bind(this),{courseId:this.score.google_course_id(),courseWorkId:this.score.google_course_work_id(),submissionId:this.score.google_submission_id()},{})}},{key:"_findSubmission",value:function(){NF.apiService.findStudentSubmissionForCourseWork((0,a.resource)("gc.loadingCourseWork"),this._getSubmissionSuccess.bind(this),{courseId:this.score.google_course_id(),courseWorkId:this.score.google_course_work_id(),scoreId:this.score.external_id()},{})}},{key:"_getSubmissionSuccess",value:function(e){this.turnIn.studentSubmission(new n.default(e.submission)),this.turnIn.attached(e.attached)}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(503)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.studentSubmission=ko.observable(),this.attached=ko.observable(!1),this.errors=ko.observableArray([])}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"hasErrors",value:function(){return this.errors().length>0}},{key:"clearErrors",value:function(){this.errors([])}},{key:"turnIn",value:function(e){if(this.clearErrors(),this._validateTurnIn(),this.hasErrors())return!1;!this.attached()&&e.template_copy()?this._attachScore(e):this._turnInApiCall()}},{key:"_turnInApiCall",value:function(){var e=this,t={courseId:this.studentSubmission().course_id,courseWorkId:this.studentSubmission().course_work_id,submissionId:this.studentSubmission().id};NF.apiService.turnInGoogleClassroomSubmission((0,n.resource)("gc.turnInSubmission"),function(t){e._turnInSuccess()},t,{})}},{key:"_attachScore",value:function(e){var t=this,o={courseId:this.studentSubmission().course_id,courseWorkId:this.studentSubmission().course_work_id,submissionId:this.studentSubmission().id,scoreId:e.external_id(),link:r.default.linkFromScore(e)};NF.apiService.addGoogleSubmissionAttachment((0,n.resource)("gc.turnInSubmission"),function(e){t.attached(!0),t._turnInApiCall()},o,{})}},{key:"_turnInSuccess",value:function(){this.studentSubmission().state="TURNED_IN",this.studentSubmission.valueHasMutated()}},{key:"_validateTurnIn",value:function(){return this.studentSubmission()?!!this.studentSubmission().canTurnIn()||(this.errors.push({message:(0,n.resource)("errors.googleCourseWorkAlreadyTurnedIn")}),!1):(this.errors.push({message:(0,n.resource)("errors.googleCourseWorkNotFound")}),!1)}},{key:"reclaim",value:function(){var e=this;if(this.clearErrors(),this._validateReclaim(),this.hasErrors())return!1;var t={courseId:this.studentSubmission().course_id,courseWorkId:this.studentSubmission().course_work_id,submissionId:this.studentSubmission().id};NF.apiService.reclaimGoogleClassroomSubmission((0,n.resource)("gc.reclaimSubmission"),function(t){e._reclaimSuccess()},t,{})}},{key:"_reclaimSuccess",value:function(){this.studentSubmission().state="RECLAIMED_BY_STUDENT",this.studentSubmission.valueHasMutated()}},{key:"_validateReclaim",value:function(){return this.studentSubmission()?!!this.studentSubmission().canReclaim()||(this.errors.push({message:(0,n.resource)("errors.googleCourseWorkNotTurnedIn")}),!1):(this.errors.push({message:(0,n.resource)("errors.googleCourseWorkNotFound")}),!1)}}]),e}();t.default=a},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t.url}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,null,[{key:"linkFromScore",value:function(t){return new e({url:t.view_score_uri()})}}]),e}();t.default=n},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.course_id=t.course_id,this.course_work_id=t.course_work_id,this.id=t.id,this.creation_time=t.creation_time,this.update_time=t.update_time,this.state=t.state,this.late=t.late,this.course_work_type=t.course_work_type,this.assignment_submission=t.assignment_submission}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"canTurnIn",value:function(){return!(!this.state||"NEW"!=this.state&&"CREATED"!=this.state&&"RECLAIMED_BY_STUDENT"!=this.state&&"RETURNED"!=this.state)}},{key:"canReclaim",value:function(){return!(!this.state||"TURNED_IN"!=this.state)}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(61)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=t,this.ownsTheScore=o,this.courseWorkTitle=ko.observable(),this.description=ko.observable(),this._initializeComputeds()}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"_initializeComputeds",value:function(){var e=this;this.showGoogleScoreInfo=ko.computed(function(){return!e.ownsTheScore()&&e.score.isGoogleCourseWork()&&NF.roles.isAtLeastSiteTeacher()&&NF.session.community().is_google_classroom()})}},{key:"_doInitializeGoogleConnections",value:function(){this.score.isGoogleCourseWork()&&this._getCourseWork()}},{key:"initializeGoogleConnections",value:function(){var e=r.default.getAuthLink({returnTo:window.location.pathname,googleClassroom:!0,referringHostname:!0});r.default.checkAuthorization(e).then(this._doInitializeGoogleConnections.bind(this))}},{key:"_getCourseWork",value:function(){NF.apiService.getGoogleClassroomCourseWorkForScore((0,n.resource)("gc.loadingCourseWork"),this._courseWorkSuccess.bind(this),{courseId:this.score.google_course_id(),courseWorkId:this.score.google_course_work_id(),scoreId:this.score.external_id()},{})}},{key:"_courseWorkSuccess",value:function(e){this.courseWorkTitle(e.title),this.description(e.description)}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(1)),n=u(o(117)),i=o(16),a=o(84),s=o(3),l=u(o(13)),c=u(o(507));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=f(this,h(t).call(this))).component=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,l.default),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"mounted",value:function(e){var t=(0,i.getApplicationStore)(),o=this.component;n.default.render(r.default.createElement(c.default,{store:t,history:a.history},r.default.createElement(o,null)),e)}},{key:"show",value:function(){(0,s.createAndShowDialog)({viewModel:this,templateName:"dialogs/reactComponentDialog"})}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"render",value:function(){return r.default.createElement(n.Provider,{store:this.props.store},this.props.children)}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SharingDialog=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=v(o(18)),i=o(10),a=o(270),s=o(77),l=v(o(509)),c=v(o(515)),u=v(o(517)),d=v(o(518)),p=v(o(519)),f=o(8),h=o(3),m=o(0),g=o(71),b=o(47);function v(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var E=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?k(e):t}(this,S(t).call(this,e))).state={currentStepComplete:!1,pretendLastStep:!1},o.handleCancelClick=o.handleCancelClick.bind(k(k(o))),o.handleCompleteClick=o.handleCompleteClick.bind(k(k(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,r.Component),function(e,t,o){t&&_(e.prototype,t),o&&_(e,o)}(t,[{key:"componentDidMount",value:function(){this.initializeSharingProperties(),this.initializeSharingWizard()}},{key:"initializeSharingProperties",value:function(){for(var e=[],t={},o=0;o<this.props.groupDocumentRoles.length;o++){var r=this.props.groupDocumentRoles[o];e.push(r.group_id),t[r.group_id]=r.role_name}for(var n=[],i={},a=0;a<this.props.userDocumentRoles.length;a++){var s=this.props.userDocumentRoles[a];n.push(s.user_id),i[s.user_id]=s.role_name}var l=null!=this.props.everyoneDocumentRole?this.props.everyoneDocumentRole.role_name:null,c=this.props.contentModel.song_ids,u=null!=this.props.contentModel.metadata&&null!=this.props.contentModel.metadata.authorship?this.props.contentModel.metadata.authorship:f.ORIGINAL_AUTHORSHIP,d=null!==l||e.length>0||n.length>0;this.props.updateSharingProperties({copyable:this.props.contentModel.copyable,searchable:this.props.contentModel.searchable,template:this.props.contentModel.template,everyoneRole:l,sharedGroupIds:e,sharedGroupPermissionsById:t,sharedUserIds:n,sharedUserPermissionsById:i,selectedSongIds:c,authorship:u,isSharedByDefault:d,loaded:!0})}},{key:"componentWillReceiveProps",value:function(e){e.currentStepId==f.SHARING_OPTIONS?this.setState({currentStepComplete:e.sharingOptionsComplete,pretendLastStep:!e.isShared&&e.isSharedByDefault}):e.currentStepId==f.COPYRIGHT_INFO&&this.setState({currentStepComplete:e.copyrightInfoComplete,pretendLastStep:!1})}},{key:"initializeSharingWizard",value:function(){var e=[(0,g.createWizardStepState)(f.SHARING_OPTIONS,(0,m.resource)("editor.sharing.steps.sharingOptions"),!1)];this.props.isDefaultCommunity&&e.push((0,g.createWizardStepState)(f.COPYRIGHT_INFO,(0,m.resource)("editor.sharing.steps.copyrightInfo"),!1)),this.props.createWizard(f.SHARE_WIZARD,f.SHARING_OPTIONS,e)}},{key:"componentWillUnmount",value:function(){this.props.removeWizard(f.SHARE_WIZARD)}},{key:"handleCancelClick",value:function(e){(0,h.cancelAndCloseCurrentModalDialog)(e),this.props.removeWizard(f.SHARE_WIZARD)}},{key:"handleCompleteClick",value:function(){this.props.updateScoreSharing()}},{key:"render",value:function(){var e=this.props.isDefaultCommunity?"prettyWide":"";return r.default.createElement("div",{className:"sharingDialog dialog modernForm medium "+e},r.default.createElement("div",{className:"titleWrapper grayTitle draggable"},(0,m.resource)("content.sharingDetails")),r.default.createElement("div",{className:"body beigeBackground"},r.default.createElement("div",{className:"scrollableDialog"},r.default.createElement(p.default,{wizardId:f.SHARE_WIZARD}),r.default.createElement(u.default,{wizardId:f.SHARE_WIZARD},r.default.createElement(l.default,{key:f.SHARING_OPTIONS}),r.default.createElement(c.default,{key:f.COPYRIGHT_INFO})))),r.default.createElement("div",{className:"buttonsWrapper beigeBackground"},r.default.createElement(d.default,{wizardId:f.SHARE_WIZARD,currentStepComplete:this.state.currentStepComplete,pretendLastStep:this.state.pretendLastStep,cancelHandler:this.handleCancelClick,completeHandler:this.handleCompleteClick})),r.default.createElement("div",{className:"close",onClick:this.handleCancelClick}))}}]),t}();t.SharingDialog=E,E.defaultProps={wizardId:f.SHARE_WIZARD},E.propTypes={createWizard:n.default.func.isRequired,removeWizard:n.default.func.isRequired,updateSharingProperties:n.default.func.isRequired,updateScoreSharing:n.default.func.isRequired,contentModel:n.default.object.isRequired,currentStepId:n.default.string,wizardId:n.default.string.isRequired,isDefaultCommunity:n.default.bool.isRequired,isSharedByDefault:n.default.bool,isShared:n.default.bool,sharingOptionsComplete:n.default.bool,copyrightInfoComplete:n.default.bool,everyoneDocumentRole:n.default.shape({role_name:n.default.string}),groupDocumentRoles:n.default.arrayOf(n.default.shape({role_name:n.default.string.isRequired,group_id:n.default.number})),userDocumentRoles:n.default.arrayOf(n.default.shape({role_name:n.default.string.isRequired,user_id:n.default.string}))};var P=(0,i.connect)(b.sharingDialogSelector,{createWizard:a.createWizard,removeWizard:a.removeWizard,updateSharingProperties:s.updateSharingProperties,updateScoreSharing:s.updateScoreSharing})(E);P.defaultProps={wizardId:f.SHARE_WIZARD};var C=P;t.default=C},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(0),i=c(o(510)),a=c(o(511)),s=c(o(512)),l=c(o(514));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r.Component),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"render",value:function(){return r.default.createElement("div",{className:"sharingOptions"},r.default.createElement("label",{className:"inputDescription"},(0,n.resource)("editor.sharing.selectAccess")),r.default.createElement(a.default,null),r.default.createElement(s.default,null),r.default.createElement(l.default,null),r.default.createElement(i.default,null))}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ShareAdditionalAccess=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(77),a=function(e){return e&&e.__esModule?e:{default:e}}(o(205)),s=o(0),l=o(47);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?f(e):t}(this,d(t).call(this,e))).handleChange=o.handleChange.bind(f(f(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.Component),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"handleChange",value:function(e){var t=e.target.checked,o=e.target.name;this.props.updateSharingProperties(function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},o,t))}},{key:"renderCopyrightWarning",value:function(){return null===this.props.everyoneRole||this.props.isDefaultCommunity?null:r.default.createElement("div",{className:"copyrightWarning",dangerouslySetInnerHTML:{__html:(0,s.resource)("editor.sharing.copyrightNotice")}})}},{key:"renderActivityTemplate",value:function(){return this.props.canCreateTemplate?r.default.createElement(a.default,{inputId:"template",label:(0,s.resource)("editor.sharingInfo.template"),checked:this.props.template,changeHandler:this.handleChange}):null}},{key:"render",value:function(){return this.props.isShared?r.default.createElement("div",{className:"additionalAccess"},r.default.createElement("label",{className:"inputDescription"},(0,s.resource)("editor.sharingInfo.additionalPowers")),r.default.createElement(a.default,{inputId:"copyable",label:(0,s.resource)("editor.sharingInfo.copy"),checked:this.props.copyable,changeHandler:this.handleChange}),this.renderActivityTemplate(),this.renderCopyrightWarning()):null}}]),t}();t.ShareAdditionalAccess=h;var m=(0,n.connect)(l.shareAdditionalAccessSelector,{updateSharingProperties:i.updateSharingProperties})(h);t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ShareWithEveryoneSection=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=f(o(18)),i=o(10),a=o(77),s=f(o(206)),l=f(o(122)),c=f(o(205)),u=o(8),d=o(0),p=o(47);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?v(e):t}(this,g(t).call(this,e))).handleChange=o.handleChange.bind(v(v(o))),o.handleVisibleToggle=o.handleVisibleToggle.bind(v(v(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,r.Component),function(e,t,o){t&&m(e.prototype,t),o&&m(e,o)}(t,[{key:"handleChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.props.updateSharingProperties(function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},r,o))}},{key:"handleVisibleToggle",value:function(e){this.props.updateSharingProperties({everyoneRole:e?u.DOCUMENT_ROLE_READER:null,searchable:!1})}},{key:"render",value:function(){if(!this.props.loaded)return null;var e=NF.session.community().default_community()?(0,d.resource)("editor.sharingInfo.everyone"):(0,d.resource)("editor.sharingInfo.allSiteMembers"),t=[{value:u.DOCUMENT_ROLE_READER,label:"editor.sharingInfo.roleReader"},{value:u.DOCUMENT_ROLE_REVIEWER,label:"editor.sharingInfo.roleCommenter"},{value:u.DOCUMENT_ROLE_COAUTHOR,label:"editor.sharingInfo.roleCoauthor"}],o=null!==this.props.everyoneRole;return r.default.createElement(s.default,{openByDefault:o,checkboxId:"shareWithEveryone",label:e,changeHandler:this.handleVisibleToggle},r.default.createElement("div",{className:"shareWithEveryone"},r.default.createElement("div",{className:"anyoneContainer"},(0,d.resource)("content.anyoneCanSearch"),r.default.createElement(l.default,{name:"everyoneRole",value:this.props.everyoneRole,changeHandler:this.handleChange,options:t})),r.default.createElement(c.default,{inputId:"searchable",label:(0,d.resource)("editor.sharingInfo.searchable"),checked:this.props.searchable,changeHandler:this.handleChange})))}}]),t}();t.ShareWithEveryoneSection=y,y.propTypes={updateSharingProperties:n.default.func.isRequired,everyoneRole:n.default.string,searchable:n.default.bool.isRequired,loaded:n.default.bool.isRequired};var _=(0,i.connect)(p.shareWithEveryoneSelector,{updateSharingProperties:a.updateSharingProperties})(y);t.default=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(77),a=h(o(206)),s=h(o(271)),l=h(o(272)),c=o(8),u=o(6),d=o(0),p=h(o(35)),f=o(47);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}(this,b(t).call(this,e))).state={query:""},o.handleChange=o.handleChange.bind(y(y(o))),o.handleSearchResultClick=o.handleSearchResultClick.bind(y(y(o))),o.handleFocusChanged=o.handleFocusChanged.bind(y(y(o))),o.handleSectionOpenChange=o.handleSectionOpenChange.bind(y(y(o))),o.handleShareChange=o.handleShareChange.bind(y(y(o))),o.handleShareRemove=o.handleShareRemove.bind(y(y(o))),o.submit=p.default.debounce(o.submit,250).bind(y(y(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,r.Component),function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(t,[{key:"handleFocusChanged",value:function(e){e?this.submit():this.props.searchGroupsReset()}},{key:"handleChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},r,o),this.submit)}},{key:"handleSearchResultClick",value:function(e){this.props.addGroupShare(e,c.DOCUMENT_ROLE_READER),this.props.searchGroupsReset(),this.setState({query:""})}},{key:"handleSectionOpenChange",value:function(e){e||(this.props.searchGroupsReset(),this.props.updateSharingProperties({sharedGroupIds:[],sharedGroupPermissionsById:{}}),this.setState({query:""}))}},{key:"handleShareChange",value:function(e,t){this.props.updateGroupShare(e,t)}},{key:"handleShareRemove",value:function(e){this.props.removeGroupShare(e)}},{key:"submit",value:function(){this.state.query.length>2?this.props.searchGroups(this.state.query,u.NF.session.current_user().external_id(),0,c.MAX_PER_PAGE):this.props.searchGroupsReset()}},{key:"renderSharedGroups",value:function(){var e=this;return this.props.sharedGroups.map(function(t){var o=e.props.sharedGroupPermissionsById[t.id];return r.default.createElement(l.default,{key:t.id,id:t.id,name:t.name,imageUrl:t.imageUrl,notActive:!t.active,permissions:o,changeHandler:e.handleShareChange,removeHandler:e.handleShareRemove})})}},{key:"render",value:function(){if(!this.props.loaded)return null;var e=this.props.sharedGroups.length>0;return r.default.createElement(a.default,{openByDefault:e,checkboxId:"shareWithGroups",label:(0,d.resource)("editor.sharingInfo.groups"),changeHandler:this.handleSectionOpenChange},this.renderSharedGroups(),r.default.createElement(s.default,{name:"query",query:this.state.query,placeholder:(0,d.resource)("editor.sharingInfo.groupEnterName"),results:this.props.groups,loaded:this.props.groupsLoaded,loading:this.props.groupsLoading,changeHandler:this.handleChange,resultClickHandler:this.handleSearchResultClick,focusHandler:this.handleFocusChanged}))}}]),t}(),S=(0,n.connect)(f.shareWithGroupsSelector,{searchGroups:i.searchGroups,searchGroupsReset:i.searchGroupsReset,addGroupShare:i.addGroupShare,removeGroupShare:i.removeGroupShare,updateGroupShare:i.updateGroupShare,updateSharingProperties:i.updateSharingProperties})(_);t.default=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this,e))).handleClick=o.handleClick.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"handleClick",value:function(){this.props.clickHandler(this.props.id)}},{key:"render",value:function(){var e={backgroundImage:"url('".concat(this.props.imageUrl,"')")};return r.default.createElement("div",{className:"result",onClick:this.handleClick},r.default.createElement("div",{className:"resultImage",style:e}),r.default.createElement("span",{className:"resultName"},this.props.name))}}]),t}();t.default=u,u.propTypes={id:n.default.oneOfType([n.default.string,n.default.number]).isRequired,name:n.default.string.isRequired,imageUrl:n.default.string.isRequired,clickHandler:n.default.func.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=o(77),a=o(8),s=h(o(206)),l=h(o(271)),c=h(o(272)),u=o(0),d=h(o(35)),p=h(o(32)),f=o(47);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}(this,b(t).call(this,e))).state={query:""},o.handleChange=o.handleChange.bind(y(y(o))),o.handleSearchResultClick=o.handleSearchResultClick.bind(y(y(o))),o.handleFocusChanged=o.handleFocusChanged.bind(y(y(o))),o.handleSectionOpenChange=o.handleSectionOpenChange.bind(y(y(o))),o.handleShareChange=o.handleShareChange.bind(y(y(o))),o.handleShareRemove=o.handleShareRemove.bind(y(y(o))),o.handleUnusuableSection=o.handleUnusuableSection.bind(y(y(o))),o.submit=d.default.debounce(o.submit,250).bind(y(y(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,r.Component),function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(t,[{key:"handleFocusChanged",value:function(e){e?this.submit():this.props.searchUsersReset()}},{key:"handleChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},r,o),this.submit)}},{key:"handleSearchResultClick",value:function(e){this.props.addUserShare(e,a.DOCUMENT_ROLE_READER),this.props.searchUsersReset(),this.setState({query:""})}},{key:"handleSectionOpenChange",value:function(e){e||(this.props.searchUsersReset(),this.props.updateSharingProperties({sharedUserIds:[],sharedUserPermissionsById:{}}),this.setState({query:""}))}},{key:"handleUnusuableSection",value:function(){(0,p.default)((0,u.resource)("editor.sharing.shareWithIndividualsTitle"),(0,u.resource)("editor.sharing.shareWithIndividuals"),"share_with_individuals")}},{key:"handleShareChange",value:function(e,t){this.props.updateUserShare(e,t)}},{key:"handleShareRemove",value:function(e){this.props.removeUserShare(e)}},{key:"submit",value:function(){this.state.query.length>2?this.props.searchUsers(this.state.query,"username",0,a.MAX_PER_PAGE):this.props.searchUsersReset()}},{key:"renderSharedUsers",value:function(){var e=this;return this.props.sharedUsers.map(function(t){var o=e.props.sharedUserPermissionsById[t.id];return r.default.createElement(c.default,{key:t.id,id:t.id,name:t.name,imageUrl:t.imageUrl,permissions:o,changeHandler:e.handleShareChange,removeHandler:e.handleShareRemove})})}},{key:"render",value:function(){if(!this.props.loaded)return null;var e=this.props.sharedUsers.length>0;return r.default.createElement(s.default,{openByDefault:e,checkboxId:"shareWithUsers",label:(0,u.resource)("editor.sharingInfo.individuals"),changeHandler:this.handleSectionOpenChange,usable:this.props.canShareWithUsers,unusableHandler:this.handleUnusuableSection},this.renderSharedUsers(),r.default.createElement(l.default,{name:"query",query:this.state.query,placeholder:(0,u.resource)("editor.sharingInfo.individualEnterName"),results:this.props.users,loaded:this.props.usersLoaded,loading:this.props.usersLoading,changeHandler:this.handleChange,resultClickHandler:this.handleSearchResultClick,focusHandler:this.handleFocusChanged}))}}]),t}(),S=(0,n.connect)(f.shareWithUsersSelector,{searchUsers:i.searchUsers,searchUsersReset:i.searchUsersReset,addUserShare:i.addUserShare,removeUserShare:i.removeUserShare,updateUserShare:i.updateUserShare,updateSharingProperties:i.updateSharingProperties})(_);t.default=S},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SharingCopyrightInfo=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=g(o(18)),a=o(77),s=g(o(122)),l=g(o(260)),c=g(o(516)),u=o(8),d=o(0),p=g(o(35)),f=o(49),h=o(36),m=o(47);function g(e){return e&&e.__esModule?e:{default:e}}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function y(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var E=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?k(e):t}(this,S(t).call(this,e))).state={worksSearch:"",contributorsSearch:"",blackboxTitle:"",blackboxArtist:"",blackboxComposers:[""],blackboxCopyrightStatus:u.ARRANGEMENT_AUTHORSHIP,showBlackboxDetails:!1},o.debouncedSearch=p.default.debounce(o.search,250),o.handleClearTitle=o.handleClearTitle.bind(k(k(o))),o.handleClearContributor=o.handleClearContributor.bind(k(k(o))),o.handleAddBlackboxSong=o.handleAddBlackboxSong.bind(k(k(o))),o.handleRemoveBlackboxSong=o.handleRemoveBlackboxSong.bind(k(k(o))),o.handleAddComposer=o.handleAddComposer.bind(k(k(o))),o.handleRemoveComposer=o.handleRemoveComposer.bind(k(k(o))),o.handleBlackboxComposerChange=o.handleBlackboxComposerChange.bind(k(k(o))),o.handleRemoveSelectedSong=o.handleRemoveSelectedSong.bind(k(k(o))),o.handleChange=o.handleChange.bind(k(k(o))),o.handleSharingChange=o.handleSharingChange.bind(k(k(o))),o.handleSearchChange=o.handleSearchChange.bind(k(k(o))),o.handleSongClick=o.handleSongClick.bind(k(k(o))),o.toggleBlackboxDialog=o.toggleBlackboxDialog.bind(k(k(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,r.Component),function(e,t,o){t&&_(e.prototype,t),o&&_(e,o)}(t,[{key:"componentDidMount",value:function(){(0,h.initializeTippy)(h.originalBadgeHint)}},{key:"handleSharingChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.props.updateSharingProperties(y({},r,o))}},{key:"handleChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(y({},r,o))}},{key:"handleSearchChange",value:function(e){var t=e.target,o="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(y({},r,o),this.debouncedSearch)}},{key:"handleBlackboxComposerChange",value:function(e,t){var o=v(this.state.blackboxComposers);o[t]=e.target.value,this.setState({blackboxComposers:o})}},{key:"handleSongClick",value:function(e,t){t?this.props.addSong(e):this.props.removeSong(e)}},{key:"handleRemoveSelectedSong",value:function(e){this.props.removeSong(e)}},{key:"handleAddComposer",value:function(){this.setState({blackboxComposers:v(this.state.blackboxComposers).concat([""])})}},{key:"handleRemoveComposer",value:function(e){var t=v(this.state.blackboxComposers);t.splice(e,1),this.setState({blackboxComposers:t})}},{key:"handleAddBlackboxSong",value:function(){var e=[];this.state.blackboxArtist&&e.push({name:this.state.blackboxArtist,role:u.NF_ARTIST});for(var t=0;t<this.state.blackboxComposers.length;t++)e.push({name:this.state.blackboxComposers[t],role:u.NF_COMPOSER});this.props.addBlackboxSong({title:this.state.blackboxTitle,public_domain:this.state.blackboxCopyrightStatus==u.PUBLIC_DOMAIN_AUTHORSHIP,contributors:e}),this.clearBlackboxDialog(),this.toggleBlackboxDialog()}},{key:"handleRemoveBlackboxSong",value:function(e){this.props.removeBlackboxSong(parseInt(e))}},{key:"handleClearTitle",value:function(){this.setState({worksSearch:"",contributorsSearch:""}),this.props.songSearchReset()}},{key:"handleClearContributor",value:function(){this.setState({contributorsSearch:""},this.debouncedSearch)}},{key:"clearBlackboxDialog",value:function(){this.setState({blackboxTitle:"",blackboxArtist:"",blackboxComposers:[""]})}},{key:"search",value:function(){this.props.songSearch(this.state.worksSearch,this.state.contributorsSearch)}},{key:"toggleBlackboxDialog",value:function(){var e=!this.state.showBlackboxDetails;this.setState({showBlackboxDetails:e})}},{key:"renderSongResults",value:function(){var e=this;if(!this.state.worksSearch)return null;var t=this.props.songs.map(function(t){for(var o=!1,n=0;n<e.props.selectedSongs.length;n++)if(e.props.selectedSongs[n].uuid==t.uuid){o=!0;break}return r.default.createElement(l.default,{key:t.uuid,song:t,checked:o,handleClick:e.handleSongClick,showViewLink:!1,showCheckbox:!0,ignoreArrangeable:!0})});return r.default.createElement("div",null,t)}},{key:"renderNoResults",value:function(){return this.state.worksSearch&&0==this.props.songs.length&&r.default.createElement("div",{className:"noResultsContainer"},r.default.createElement("span",{className:"noResultsText"},(0,d.resource)("content.noResultsFor",this.state.worksSearch)),r.default.createElement("span",{className:"clarification"},(0,d.resource)("content.makeSureSpelling")))}},{key:"renderWorkFootnotes",value:function(){return this.state.showBlackboxDetails?null:r.default.createElement("div",null,this.renderPublicDomainFootnote(),this.renderCopyrightedFootnote())}},{key:"renderPublicDomainFootnote",value:function(){return!this.props.hasPublicDomainSongs&&this.props.hasCopyrightedSongs?null:r.default.createElement("div",{className:"copyrightInfoText",dangerouslySetInnerHTML:{__html:(0,d.resource)("editor.sharingInfo.authorship.footnote.publicDomain")}})}},{key:"renderCopyrightedFootnote",value:function(){return!this.props.hasCopyrightedSongs&&this.props.hasPublicDomainSongs?null:r.default.createElement("div",{className:"copyrightInfoText",dangerouslySetInnerHTML:{__html:(0,d.resource)("editor.sharingInfo.authorship.footnote.arrangement")}})}},{key:"renderSelectedSongs",value:function(){var e=this;if(this.state.showBlackboxDetails||0===this.props.selectedSongs.length&&0===this.props.blackboxSongs.length)return r.default.createElement("div",{className:"selectedSongsSpacer"});for(var t=this.props.selectedSongs.map(function(t){return r.default.createElement(c.default,{key:t.uuid,id:t.uuid,title:(0,f.songTextToShow)(t),removeHandler:e.handleRemoveSelectedSong})}),o=0;o<this.props.blackboxSongs.length;o++){var n=this.props.blackboxSongs[o];t.push(r.default.createElement(c.default,{key:o,id:"".concat(o),title:(0,f.songTextToShow)(n),removeHandler:this.handleRemoveBlackboxSong}))}var i=(0,d.resource)("content.sellingDetails.selectedWork");return this.props.hasCopyrightedSongs&&!this.props.hasPublicDomainSongs?i=(0,d.resource)("content.sellingDetails.selectedCopyrightedWork"):this.props.hasPublicDomainSongs&&!this.props.hasCopyrightedSongs&&(i=(0,d.resource)("content.sellingDetails.selectedPublicDomainWork")),r.default.createElement("div",null,r.default.createElement("div",{className:"songMatchingHeading"},i),r.default.createElement("div",{className:"selectedSongResults"},t))}},{key:"renderBlackboxDetails",value:function(){var e=this,t=this.state.blackboxComposers.map(function(t,o){return r.default.createElement("div",{key:"composer".concat(o),className:"inline"},r.default.createElement("input",{type:"text",className:"marginBottom10 roomForIcon marginRight10",onChange:function(t){e.handleBlackboxComposerChange(t,o)},value:t}),o==e.state.blackboxComposers.length-1&&r.default.createElement("i",{className:"colorPremium pointer fa fa-plus-circle","aria-hidden":"true",onClick:e.handleAddComposer}),o!=e.state.blackboxComposers.length-1&&r.default.createElement("i",{className:"colorBeige pointer fa fa-minus-circle","aria-hidden":"true",onClick:function(){e.handleRemoveComposer(o)}}))});return this.state.showBlackboxDetails&&r.default.createElement("div",{className:"blackboxDetailsBox"},r.default.createElement("span",{className:"title"},(0,d.resource)("content.enterDetailsRelatedWork")),r.default.createElement("i",{className:"closeButton pointer fa fa-times","aria-hidden":"true",onClick:this.toggleBlackboxDialog}),r.default.createElement("div",null,r.default.createElement("span",{className:"inputDescription"},(0,d.resource)("content.title")),r.default.createElement("input",{name:"blackboxTitle",type:"text",className:"marginBottom10",onChange:this.handleChange,value:this.state.blackboxTitle})),r.default.createElement("div",null,r.default.createElement("span",{className:"inputDescription inlineBlock"},(0,d.resource)("blackbox.prompt.artist")),r.default.createElement("div",{className:"formLabelHint"},(0,d.resource)("content.optional")),r.default.createElement("input",{name:"blackboxArtist",type:"text",className:"marginBottom10",onChange:this.handleChange,value:this.state.blackboxArtist})),r.default.createElement("div",null,r.default.createElement("span",{className:"inputDescription"},(0,d.resource)("blackbox.prompt.composer")),t),r.default.createElement("div",null,r.default.createElement("span",{className:"inputDescription"},(0,d.resource)("content.copyrightStatus")),r.default.createElement("div",{className:"marginBottom10"},r.default.createElement("input",{type:"radio",name:"blackboxCopyrightStatus",id:u.ARRANGEMENT_AUTHORSHIP,key:u.ARRANGEMENT_AUTHORSHIP,className:"copyrightRadioButton",onChange:this.handleChange,value:u.ARRANGEMENT_AUTHORSHIP,checked:this.state.blackboxCopyrightStatus==u.ARRANGEMENT_AUTHORSHIP}),r.default.createElement("label",{className:"radioOption",htmlFor:u.ARRANGEMENT_AUTHORSHIP},(0,d.resource)("content.copyrighted")),r.default.createElement("input",{type:"radio",name:"blackboxCopyrightStatus",id:u.PUBLIC_DOMAIN_AUTHORSHIP,key:u.PUBLIC_DOMAIN_AUTHORSHIP,className:"copyrightRadioButton",onChange:this.handleChange,value:u.PUBLIC_DOMAIN_AUTHORSHIP,checked:this.state.blackboxCopyrightStatus==u.PUBLIC_DOMAIN_AUTHORSHIP}),r.default.createElement("label",{className:"radioOption",htmlFor:u.PUBLIC_DOMAIN_AUTHORSHIP},(0,d.resource)("content.publicDomain")))),r.default.createElement("div",null,r.default.createElement("button",{className:"premiumColors mini right",disabled:""==this.state.blackboxTitle||""==this.state.blackboxComposers[0],onClick:this.handleAddBlackboxSong},(0,d.resource)("action.add")),r.default.createElement("div",{className:"clearFloat"})))}},{key:"renderBlackboxOption",value:function(){return this.state.worksSearch?r.default.createElement("div",{className:"blackboxedWork"},r.default.createElement("div",{className:"resultsItem blackbox",onClick:this.toggleBlackboxDialog},r.default.createElement("div",{className:"localLeft"},r.default.createElement("input",{type:"checkbox",className:"copyrightRadioButton",checked:this.state.showBlackboxDetails,onChange:this.toggleBlackboxDialog})),r.default.createElement("div",{className:"textWrapper inlineBlock"},r.default.createElement("div",null,(0,d.resource)("editor.sharing.worksSearch.cantFindUse"))))):null}},{key:"renderClearContributorButton",value:function(){return 0===this.state.contributorsSearch.length?null:r.default.createElement("i",{className:"fa fa-times-circle clearButton","aria-hidden":"true",onClick:this.handleClearContributor})}},{key:"renderContributorSearchInput",value:function(){return 0===this.props.songs.length&&0===this.state.contributorsSearch.length?null:r.default.createElement("div",{className:"totalResultsContainer"},r.default.createElement("input",{type:"text",name:"contributorsSearch",className:"refineWithContributor workSearchInput",onChange:this.handleSearchChange,value:this.state.contributorsSearch,placeholder:(0,d.resource)("content.enterComposerArtistRefine")}),this.renderClearContributorButton())}},{key:"renderSongMatching",value:function(){return this.props.authorship==u.ARRANGEMENT_AUTHORSHIP&&r.default.createElement("div",null,r.default.createElement("hr",{className:"modalSpacer"}),r.default.createElement("div",{className:"formRow"},r.default.createElement("div",{className:"columnsContainer copyrightInfoContainer"},r.default.createElement("div",{className:"firstColumn paddingRight20 songResults"},r.default.createElement("div",{className:"songMatchingHeading"},(0,d.resource)("editor.sharingInfo.selectWorks.prompt")),r.default.createElement("div",{className:"workSearchInputContainer"},r.default.createElement("div",{className:"fa fa-sm fa-search workSearchInputIcon"}),r.default.createElement("input",{className:"workSearchInput",name:"worksSearch",type:"text",value:this.state.worksSearch,placeholder:(0,d.resource)("content.enterTitle"),onChange:this.handleSearchChange}),this.state.worksSearch.length>0&&r.default.createElement("i",{className:"fa fa-times-circle clearButton","aria-hidden":"true",onClick:this.handleClearTitle})),r.default.createElement("div",{className:"workSearchResults modernLook"},this.renderContributorSearchInput(),r.default.createElement("div",{className:"searchedWorks"},this.renderSongResults(),this.renderNoResults(),this.renderBlackboxOption()))),r.default.createElement("div",{className:"secondColumn paddingRight20"},this.renderSelectedSongs(),this.renderWorkFootnotes(),this.renderBlackboxDetails()))))}},{key:"render",value:function(){var e=[{value:u.ORIGINAL_AUTHORSHIP,label:"editor.sharingInfo.origin.menuItem.original"},{value:u.ARRANGEMENT_AUTHORSHIP,label:"editor.sharingInfo.origin.menuItem.arrangementExistingWork"}];return r.default.createElement("div",{className:"dialogStepContent songMatching"},r.default.createElement("div",{className:"formRow"},r.default.createElement("label",{className:"songMatchingHeading marginRight10"},(0,d.resource)("content.sellingDetails.copyrightSelection")),r.default.createElement("div",{className:"hintButton inline tippy","data-tippy-content":(0,d.resource)("hint.copyrightBlurb")},r.default.createElement("span",{className:"fa fa-question-circle","aria-hidden":"true"})),r.default.createElement("span",{className:"copyrightHelp",dangerouslySetInnerHTML:{__html:(0,d.resource)("editor.sharing.copyrightHelp")}})),r.default.createElement("div",{className:"columnsContainer"},r.default.createElement("div",{className:"firstColumn paddingRight20"},r.default.createElement("div",{className:"songMatchingSubHeading"},(0,d.resource)("editor.sharingInfo.origin.menuPrompt")),r.default.createElement("div",{className:"select copyrightOptionsSelector"},r.default.createElement(s.default,{name:"authorship",value:this.props.authorship,changeHandler:this.handleSharingChange,options:e}))),r.default.createElement("div",{className:"secondColumn paddingRight20"})),this.renderSongMatching())}}]),t}();t.SharingCopyrightInfo=E,E.propTypes={songs:i.default.arrayOf(i.default.object).isRequired,songsLoaded:i.default.bool,selectedSongs:i.default.arrayOf(i.default.object).isRequired,blackboxSongs:i.default.arrayOf(i.default.object).isRequired,authorship:i.default.string.isRequired,hasCopyrightedSongs:i.default.bool,hasPublicDomainSongs:i.default.bool,addSong:i.default.func.isRequired,addBlackboxSong:i.default.func.isRequired,removeSong:i.default.func.isRequired,removeBlackboxSong:i.default.func.isRequired,songSearch:i.default.func.isRequired,songSearchReset:i.default.func.isRequired,updateSharingProperties:i.default.func.isRequired};var P=(0,n.connect)(m.sharingCopyrightInfoSelector,{addSong:a.addSong,addBlackboxSong:a.addBlackboxSong,removeSong:a.removeSong,removeBlackboxSong:a.removeBlackboxSong,songSearch:a.songSearch,songSearchReset:a.songSearchReset,updateSharingProperties:a.updateSharingProperties})(E);t.default=P},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=function(e){return e&&e.__esModule?e:{default:e}}(o(18));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this,e))).handleClick=o.handleClick.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.Component),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"handleClick",value:function(){this.props.removeHandler(this.props.id)}},{key:"render",value:function(){return r.default.createElement("div",{key:this.props.id,className:"sharingInfoWorksListItem"},r.default.createElement("span",{className:"royaltyAssignmentLink"},this.props.title),r.default.createElement("div",{className:"removeElementButton",onClick:this.handleClick}))}}]),t}();t.default=u,u.propTypes={id:n.default.string.isRequired,title:n.default.string.isRequired,removeHandler:n.default.func.isRequired}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WizardContent=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),a=o(72);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,u(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"renderSteps",value:function(){var e=this,t=[];return void 0!==this.props.children&&this.props.children.forEach(function(o){o.key==e.props.currentStepId&&t.push(o)}),t}},{key:"render",value:function(){return r.default.createElement("div",{className:"dialogStepContent"},this.renderSteps())}}]),t}();t.WizardContent=p,p.propTypes={wizardId:i.default.string.isRequired,currentStepId:i.default.string,stepIds:i.default.arrayOf(i.default.string).isRequired,stepsById:i.default.objectOf(i.default.shape({id:i.default.string.isRequired,label:i.default.string.isRequired,complete:i.default.bool.isRequired}))};var f=(0,n.connect)(a.activeWizardSelector,{})(p);t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WizardNavigation=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),a=o(270),s=o(0),l=o(72);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?f(e):t}(this,d(t).call(this,e))).handleBackClick=o.handleBackClick.bind(f(f(o))),o.handleNextClick=o.handleNextClick.bind(f(f(o))),o.handleCancelClick=o.handleCancelClick.bind(f(f(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.Component),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"handleBackClick",value:function(e){return this.props.previousStep(this.props.id),e.preventDefault(),!1}},{key:"handleNextClick",value:function(e){return this.props.isLastStep||this.props.pretendLastStep?this.props.completeHandler():this.props.nextStep(this.props.id),e.preventDefault(),!1}},{key:"handleCancelClick",value:function(e){return this.props.cancelHandler(e),e.preventDefault(),!1}},{key:"renderBackButton",value:function(){return this.props.isFirstStep?null:r.default.createElement("a",{className:"back",onClick:this.handleBackClick},(0,s.resource)("action.back"))}},{key:"renderNextButton",value:function(){var e=this.props.isLastStep||this.props.pretendLastStep?(0,s.resource)("action.save"):(0,s.resource)("action.next"),t=!this.props.currentStepComplete;return r.default.createElement("button",{id:"nextButton",className:"horizontalSpacing medium premiumColors",onClick:this.handleNextClick,disabled:t},e)}},{key:"renderCancelButton",value:function(){var e=(0,s.resource)("action.cancel");return r.default.createElement("button",{className:"horizontalSpacing medium grayColors",onClick:this.handleCancelClick},e)}},{key:"render",value:function(){return this.props.stepIds.length<1?null:r.default.createElement("div",{className:"wizardNavigation"},this.renderBackButton(),r.default.createElement("div",{className:"expander"}),this.renderCancelButton(),this.renderNextButton())}}]),t}();t.WizardNavigation=h,h.propTypes={id:i.default.string.isRequired,cancelHandler:i.default.func.isRequired,completeHandler:i.default.func.isRequired,isFirstStep:i.default.bool.isRequired,isLastStep:i.default.bool.isRequired,currentStep:i.default.shape({id:i.default.string.isRequired,label:i.default.string.isRequired,complete:i.default.bool.isRequired}),currentStepId:i.default.string,stepIds:i.default.arrayOf(i.default.string).isRequired,stepsById:i.default.objectOf(i.default.shape({id:i.default.string.isRequired,label:i.default.string.isRequired,complete:i.default.bool.isRequired})),nextStep:i.default.func.isRequired,previousStep:i.default.func.isRequired,currentStepComplete:i.default.bool.isRequired};var m=(0,n.connect)(l.wizardNavigationSelector,{nextStep:a.nextStep,previousStep:a.previousStep})(h);t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.WizardSteps=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(1)),n=o(10),i=function(e){return e&&e.__esModule?e:{default:e}}(o(18)),a=o(72);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,u(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"renderStepsConnector",value:function(){return this.props.isPhoneLayoutOrSmaller?r.default.createElement("div",{className:"stepsConnector"}):null}},{key:"renderSteps",value:function(){var e=this;return this.props.stepIds.map(function(t,o){var n=e.props.stepsById[t],i=e.props.currentStepId==n.id,a=e.props.isPhoneLayoutOrSmaller&&!i?"circle smallStepCircle":"circle",s=i?"step selected":"step";return e.props.isLastStep&&e.props.isPhoneLayoutOrSmaller&&(s+=" noMarginRight noFlexGrow"),r.default.createElement("div",{key:o,className:s},r.default.createElement("div",{className:a},r.default.createElement("div",{className:"stepNumber"},o+1)),e.renderStepLabel(n))})}},{key:"renderStepLabel",value:function(e){return this.props.isPhoneLayoutOrSmaller?null:r.default.createElement("div",{className:"stepLabel"},e.label)}},{key:"renderMobileStepLabel",value:function(){return this.props.isPhoneLayoutOrSmaller?r.default.createElement("div",{className:"stepLabel block"},this.props.currentStep.label):null}},{key:"render",value:function(){return this.props.stepIds.length<=1?null:r.default.createElement("div",{className:"formRow marginBottom20"},r.default.createElement("div",{className:"wizardSteps"},this.renderStepsConnector(),this.renderSteps()),this.renderMobileStepLabel())}}]),t}();t.WizardSteps=p,p.propTypes={wizardId:i.default.string.isRequired,isPhoneLayoutOrSmaller:i.default.bool.isRequired,currentStep:i.default.shape({id:i.default.string.isRequired,label:i.default.string.isRequired,complete:i.default.bool.isRequired}),isLastStep:i.default.bool.isRequired,currentStepId:i.default.string,stepIds:i.default.arrayOf(i.default.string).isRequired,stepsById:i.default.objectOf(i.default.shape({id:i.default.string.isRequired,label:i.default.string.isRequired,complete:i.default.bool.isRequired}))};var f=(0,n.connect)(a.wizardStepsSelector,{})(p);t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commerceLinksSelector=t.marketplaceAssetsSelector=t.smdAssetsSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorSongsSelector,function(e){for(var t=[],o=0;o<e.length;o++){var r=e[o];!r.public_domain&&Array.isArray(r.smd_assets)&&(t=t.concat(r.smd_assets))}return t});t.smdAssetsSelector=i;var a=(0,r.createSelector)(n.editorSongsSelector,function(e){for(var t=[],o=0;o<e.length;o++){var r=e[o];!r.public_domain&&Array.isArray(r.marketplace_assets)&&(t=t.concat(r.marketplace_assets))}return t});t.marketplaceAssetsSelector=a;var s=(0,r.createSelector)(i,a,function(e,t){return{smdAssets:e,marketplaceAssets:t}});t.commerceLinksSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=h(o(4)),n=o(2),i=o(14),a=o(0),s=o(522),l=h(o(274)),c=h(o(535)),u=h(o(32)),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(269)),p=o(5),f=o(6);function h(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.initializeConnectedProperties(),this.initializeObservables(),this.initializeComputeds()}return function(e,t,o){t&&m(e.prototype,t),o&&m(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.canSell=f.ko.observable(),(0,i.connect)(s.sellScoreSectionSelector,{})(this)}},{key:"initializeObservables",value:function(){this.score=this.editor.score,this.canSellScore=this.editor.marketplaceSellable,this.expandSellScoreSection=f.ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.sellScoreSectionStatus=f.ko.computed(function(){return e.expandSellScoreSection()?"sectionUnexpand":"sectionExpand"}),this.sellScoreSectionBottomBorder=f.ko.computed(function(){return e.expandSellScoreSection()?"sansBottom":""}),this.sellingSetupComplete=f.ko.computed(function(){return f.NF.session.current_user()&&f.NF.session.current_user().has_seller_account()&&f.NF.session.current_user().can_list_new_products()}),this.hasSellerAccount=f.ko.computed(function(){return e.score()&&f.NF.session.current_user()&&f.NF.session.current_user().has_seller_account()})}},{key:"toggleSellScoreSection",value:function(){this.expandSellScoreSection(!this.expandSellScoreSection())}},{key:"redirectToSellerSetup",value:function(){(0,n.navigate)(f.NF.paths.sellingSetup())}},{key:"redirectToSellerSetupLanding",value:function(){(0,n.navigate)(f.NF.paths.sellingSetupLanding())}},{key:"showDialog",value:function(){this.editor.html5Editor().scoreState.isPaginatedMode()||this.editor.html5Editor().scoreState.isPerformMode()?this.score().title()?this.showSellScoreModal():this.showScoreTitlePrompt():this.showFormatScorePrompt()}},{key:"showSellScoreModal",value:function(){f.NF.session.current_user().has_premium_features()?new l.default({showVersioning:!1,updatingProduct:!1}).show():(0,u.default)((0,a.resource)("action.sellScore"),(0,a.resource)("action.sellScores"),"sell_score")}},{key:"showScoreTitlePrompt",value:function(){var e=this;new d.default(d.SELLING).show(function(t){r.default.publish(p.SCORE_FORCE_SAVE),t&&e.showSellScoreModal()})}},{key:"showFormatScorePrompt",value:function(){(new c.default).show()}}]),e}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sellScoreSectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentPolicySelector,function(e){return{canSell:e.can_sell}});t.sellScoreSectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,s(t).call(this))).wizardSteps=ko.observableArray([]),e.currentStep=ko.observable(),e.nextCanBeEnabled=ko.observable(!0),e.nextEnabled=ko.computed(function(){if(e.nextCanBeEnabled()&&e.currentStep())return e.currentStep().viewModel.nextEnabled()}),e.advanceButtonText=ko.computed(function(){if(e.currentStep())return e.currentStep().viewModel.advanceButtonText()}),e.showBackButton=ko.computed(function(){if(e.currentStep())return e.currentStep().viewModel.showBackButton()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"selectStepByName",value:function(e){for(var t=0;t<this.wizardSteps().length;t++)if(this.wizardSteps()[t].name()==e){this.currentStep(this.wizardSteps()[t]);break}this._updateSelectedSteps()}},{key:"addWizardStep",value:function(e,t,o){this.wizardSteps.push({name:ko.observable(e),resource:ko.observable("wizardStep.".concat(e)),position:this.wizardSteps().length,selected:ko.observable(!1),viewModel:t,template:o})}},{key:"handleNextClick",value:function(){if(!this.currentStep())return!1;var e=this.wizardSteps().indexOf(this.currentStep());if(-1==e)return!1;var t=this.currentStep().viewModel.next();return t&&e<this.wizardSteps().length-1&&this.currentStep(this.wizardSteps()[e+1]),this._updateSelectedSteps(),t}},{key:"handleBackClick",value:function(){if(!this.currentStep())return!1;var e=this.wizardSteps().indexOf(this.currentStep());if(-1==e)return!1;var t=this.currentStep().viewModel.back();return t&&e>0&&this.currentStep(this.wizardSteps()[e-1]),this._updateSelectedSteps(),t}},{key:"_updateSelectedSteps",value:function(){for(var e=this.currentStep().position,t=0;t<this.wizardSteps().length;t++)this.wizardSteps()[t].selected(t<=e)}}]),t}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=h(o(4)),n=o(6),i=h(o(525)),a=h(o(102)),s=h(o(526)),l=h(o(276)),c=o(8),u=o(5),d=o(207),p=o(28),f=o(0);function h(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=function(e){function t(e,o,r,n,a,s){var c,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(c=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}(this,b(t).call(this))).resource=f.resource,c.title=e,c.scoreModel=o,c.isProductCopy=r,c.sourceProduct=n,c.selectedCopyrightOption=a,c.royaltyAssignment=s,c.options=u,c.editingProductNotification=new l.default("content.reivewScoreSellingDetailsEditing"),c.showBackButton(!1),c.initializeObservables(),c.initializeComputeds(),c.initializeSubscribers(),c._handleWorkSelected=c._handleWorkSelected.bind(y(y(c))),c.removeSelection=c.removeSelection.bind(y(y(c))),c._handleBlackboxSelected=c._handleBlackboxSelected.bind(y(y(c))),c._search=c._search.bind(y(y(c))),c.blackboxedWork=new i.default(c.title(),{selectionCallback:c._handleBlackboxSelected}),c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,a.default),function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(t,[{key:"initializeObservables",value:function(){this.updatingProduct=n.ko.observable(this.options.updatingProduct),this.worksSearch=n.ko.observable(""),this.contributorsSearch=n.ko.observable(""),this.selectedWorkId=n.ko.observable(0),this.searchedWorks=n.ko.observableArray([]),this.copyrightOptions=n.ko.observableArray(c.COPYRIGHT_OPTIONS),this.initialCopyrightSelection=n.ko.observable(),this.resetInitialCopyrightSelection(),this.acceptTerms=n.ko.observable(!1),this.acceptTermsError=n.ko.observable(!1)}},{key:"resetInitialCopyrightSelection",value:function(){var e=this.isProductCopy()?c.ARRANGEMENT_EXISTING_WORK:c.ORIGINAL_AUTHORSHIP,t=e;this.options.initialCopyrightSelection&&(e=this.options.initialCopyrightSelection),this.options.selectedCopyrightSelection&&(t=this.options.selectedCopyrightSelection),this.initialCopyrightSelection(e),this.selectedCopyrightOption(t)}},{key:"initializeComputeds",value:function(){var e=this;this.isArrangementAuthorship=n.ko.computed(function(){return e.selectedCopyrightOption()==c.ARRANGEMENT_AUTHORSHIP}),this.isArrangementOfPublicDomain=n.ko.computed(function(){return e.selectedCopyrightOption()==c.PUBLIC_DOMAIN_AUTHORSHIP}),this.isOriginalWork=n.ko.computed(function(){return e.initialCopyrightSelection()===c.ORIGINAL_AUTHORSHIP}),this.isArrangement=n.ko.computed(function(){return e.initialCopyrightSelection()===c.ARRANGEMENT_EXISTING_WORK}),this.fullCopyright=n.ko.computed(function(){var t=(0,f.resource)("editor.sharingInfo.origin.menuItem."+e.selectedCopyrightOption());return(0,f.resource)("content.sellingDetails.copyrightFull",t)}),this.throttledWorksSearch=n.ko.computed(this.worksSearch).extend({throttle:200}),this.throttledContributorsSearch=n.ko.computed(this.contributorsSearch).extend({throttle:200}),this.disableCopyrightSelection=n.ko.computed(function(){return e.isProductCopy()||!!e.sourceProduct()}),this.nextEnabled=n.ko.computed(function(){return e.isOriginalWork()||e.isProductCopy()||e.royaltyAssignment.ready()&&(e.isArrangementAuthorship()||e.isArrangementOfPublicDomain())})}},{key:"initializeSubscribers",value:function(){var e=this;this.initialCopyrightSelection.subscribe(function(t){e.selectedCopyrightOption(t)}),this.selectedCopyrightOption.subscribe(function(t){switch(t){case c.ARRANGEMENT_EXISTING_WORK:e._generateTextToSearch();break;case c.ORIGINAL_AUTHORSHIP:e.royaltyAssignment.reset(),e.selectedWorkId(null)}}),this.worksSearch.subscribe(function(t){e.blackboxedWork.text(t)}),this.throttledWorksSearch.subscribe(function(){e._search()}),this.throttledContributorsSearch.subscribe(function(){e._search()}),this.acceptTerms.subscribe(function(){e.acceptTermsError(!1)})}},{key:"_search",value:function(){var e=(0,p.prepareForElasticSearch)(this.worksSearch()),t=(0,p.prepareForElasticSearch)(this.contributorsSearch());(e||t)&&n.NF.apiService.worksSearch((0,f.resource)("action.loading"),this._handleWorksResults.bind(this),{title_term:e,contributors_term:t})}},{key:"clearTitle",value:function(){this.worksSearch("")}},{key:"clearContributor",value:function(){this.contributorsSearch("")}},{key:"extractScoreModelInfo",value:function(){if(this.isArrangement()&&this.isProductCopy())return{title:this.scoreModel.title,composer:this.scoreModel.composer,lyricist:this.scoreModel.lyricist,copyright:this.scoreModel.copyright};if(this.isArrangement()&&this.royaltyAssignment.blackbox())return{title:this.royaltyAssignment.blackboxModel.title(),composer:(0,d.formatComposerField)(this.royaltyAssignment.blackboxModel.extractComposerNames(),this.royaltyAssignment.blackboxModel.extractLyricistNames()),lyricist:""};if(this.isArrangement()){var e=this.royaltyAssignment.song(),t={title:e.title(),composer:e.credits(),lyricist:""};return e.publicDomain()||(t.copyright=e.copyright()),t}return{}}},{key:"extractSongInfo",value:function(){var e={};return this.isProductCopy()||(this.isArrangement()?this.royaltyAssignment.blackbox()?(e.title=this.royaltyAssignment.blackboxModel.title(),e.composers=this.royaltyAssignment.blackboxModel.extractComposers(),e.lyricists=this.royaltyAssignment.blackboxModel.extractLyricists(),e.artist=this.royaltyAssignment.blackboxModel.extractArtist(),e.credits=(0,d.formatComposerField)(this.royaltyAssignment.blackboxModel.extractComposerNames(),this.royaltyAssignment.blackboxModel.extractLyricistNames()),e.copyright=this.scoreModel.copyright,e.arrangeable=!0):(e.uuid=this.royaltyAssignment.song().uuid(),e.composers=this.royaltyAssignment.song().contributorsList.extractComposers(),e.lyricists=this.royaltyAssignment.song().contributorsList.extractLyricists(),e.artist=this.royaltyAssignment.song().contributorsList.extractArtist()):(e.title=this.scoreModel.title,e.credits=(0,d.formatComposerField)([this.scoreModel.composer],[this.scoreModel.lyricist]),e.copyright=this.scoreModel.copyright)),e}},{key:"_generateTextToSearch",value:function(){this.worksSearch("")}},{key:"reset",value:function(){this.resetInitialCopyrightSelection()}},{key:"_handleWorkSelected",value:function(e){e.arrangeable()&&(this.selectedWorkId(e.uuid()),this.royaltyAssignment.updateFromSong(e),this.selectedCopyrightOption(e.publicDomain()?c.PUBLIC_DOMAIN_AUTHORSHIP:c.ARRANGEMENT_AUTHORSHIP),r.default.publish(u.SELLING_WORK_SELECTED))}},{key:"removeSelection",value:function(){this.selectedWorkId(null),this.royaltyAssignment.reset()}},{key:"_handleBlackboxSelected",value:function(e){this.selectedWorkId(e),this.royaltyAssignment.prepareForBlackbox(this.worksSearch()),this.selectedCopyrightOption(null),r.default.publish(u.SELLING_WORK_SELECTED)}},{key:"_handleWorksResults",value:function(e){this.searchedWorks([]);for(var t=0;t<e.songs.length;t++)this.searchedWorks.push(new s.default(e.songs[t],{selectionCallback:this._handleWorkSelected}))}},{key:"cleanUp",value:function(){this.isProductCopy()||this.isArrangement()&&this.royaltyAssignment.blackbox()&&this.royaltyAssignment.blackboxModel.cleanUp()}},{key:"_clearErrors",value:function(){this.acceptTermsError(!1)}},{key:"_validate",value:function(){return!(!this.isOriginalWork()&&!this.acceptTerms())||(this.acceptTermsError(!0),!1)}},{key:"next",value:function(){return this._clearErrors(),this._validate()}}]),t}();t.default=_},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){var o=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.text=r.ko.observable(t),this.textToShow=r.ko.computed(function(){return'"'.concat(o.text(),'"')}),this.value=r.ko.observable(-1),this.show=r.ko.computed(function(){return null!=o.text()&&""!==o.text().trim()}),this.selectionCallback=n.selectionCallback,this.handleSelection=this.handleSelection.bind(this)}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"handleSelection",value:function(){return this.selectionCallback&&this.selectionCallback(this.value()),!0}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(275));function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.song=new r.default(t),this.selected=ko.observable(!1),this.selectionCallback=o.selectionCallback,this.handleSelection=this.handleSelection.bind(this)}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"handleSelection",value:function(){return this.selectionCallback&&this.selectionCallback(this.song),!0}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o(102)),n=a(o(276)),i=o(207);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e,o){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,u(t).call(this))).scoreModel=e,r.isProductCopy=o,r.options=n,r.initializeObservables(),r.initializeSubscribers(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"initializeObservables",value:function(){this.isOriginalWork=ko.observable(!1),this.infoNotification=new n.default("content.sellingDetailsNotification"),this.copyrightNotification=new n.default("content.sellingDetailsCopyrightInfo"),this.title=ko.observable(this.scoreModel.title),this.subtitle=ko.observable(this.scoreModel.subtitle),this.composer=ko.observable(this.scoreModel.composer),this.lyricist=ko.observable(this.scoreModel.lyricist),this.copyright=ko.observable(this.scoreModel.copyright),this.nextEnabled=ko.observable(!0),this.arrangedByFullName=ko.observable(this.options.arranger||""),this.showCopyrightNotification=ko.observable(!1),this.arrangerError=ko.observable(!1)}},{key:"initializeSubscribers",value:function(){var e=this;this.arrangedByFullName.subscribe(function(){e.arrangerError(!1)})}},{key:"initialize",value:function(e,t){this.isOriginalWork(e),this._updateData(t),this.showCopyrightNotification(!this.copyright()),this._setDefaultCopyrightIfNeeded()}},{key:"_setDefaultCopyrightIfNeeded",value:function(){if(!this.copyright()){var e=NF.session.current_user().seller_legal_entity;this.copyright("Copyright  ".concat((new Date).getFullYear()," ").concat(e.first_name()," ").concat(e.last_name(),". All Rights Reserved."))}}},{key:"clear",value:function(){this.arrangedByFullName(null)}},{key:"_updateData",value:function(e){this.title(e.title),this.composer(e.composer),this.lyricist(e.lyricist),this.copyright(e.copyright)}},{key:"_formatLyricistField",value:function(){if(this.arrangedByFullName())return(0,i.splitStringIntoMultipleLines)("Arranged by ".concat(this.arrangedByFullName()))}},{key:"extractScoreModelInfo",value:function(){return{lyricist:this._formatLyricistField(),copyright:this.copyright()}}},{key:"extractCopyright",value:function(){return{copyright:this.copyright()}}},{key:"extractArranger",value:function(){return this.arrangedByFullName()}},{key:"_clearErrors",value:function(){this.arrangerError(!1)}},{key:"_validate",value:function(){return!(!this.isOriginalWork()&&!this.arrangedByFullName())||(this.arrangerError(!0),!1)}},{key:"next",value:function(){return this._clearErrors(),this._validate()}}]),t}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(102)),n=o(201),i=o(207),a=o(8),s=o(0);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function(e){function t(e,o){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}(this,u(t).call(this))).resource=s.resource,r.score=e,r.isArrangementAuthorship=o,r.allowLargeEnsembles=ko.observable(NF.session.allowLargeEnsembles()),r.options=n,r.addNewComposer=r.addNewComposer.bind(p(p(r))),r.removeComposer=r.removeComposer.bind(p(p(r))),r.addNewLyricist=r.addNewLyricist.bind(p(p(r))),r.removeLyricist=r.removeLyricist.bind(p(p(r))),r.initializeObservables(),r.initializeComputeds(),r.initializeSubscribers(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"initializeObservables",value:function(){var e=this;this.isOriginalWork=ko.observable(!1),this.artist=ko.observable({name:ko.observable(),role:a.NF_ARTIST}),this.composers=ko.observableArray([]),this.lyricists=ko.observableArray([]),this.arranger=ko.observable({name:ko.observable(),role:a.NF_ARRANGER}),this.previewType=ko.observable(),this.canUseFullPreview=ko.observable(!1),this.scoreFacets=new n.ScoreFacets,this.format=ko.observable(),this.formats=ko.observableArray(this._createFormats()),this.score.format.subscribe(function(t){e.isArrangementAuthorship()&&!e.allowLargeEnsembles()&&e.score.restrictFormat()}),this.isArrangementAuthorship.subscribe(function(){e.formats(e._createFormats())}),this.genreError=ko.observable(!1),this.difficultyLevelError=ko.observable(!1),this.coverArtError=ko.observable(!1),this.formatError=ko.observable(!1),this.formatErrorText=ko.observable(""),this.previewTypeError=ko.observable(!1),this.disableArtist=ko.observable(!1),this.disableComposers=ko.observable(!1),this.disableLyricists=ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.coverArtViewModel=ko.computed(function(){return{coverArt:ko.observable(e.score.coverArt()),editable:ko.observable(!0),size:ko.observable("medium")}})}},{key:"initializeSubscribers",value:function(){var e=this;this.score.genre.subscribe(function(){e.genreError(!1)}),this.score.difficultyLevel.subscribe(function(){e.difficultyLevelError(!1)}),this.score.format.subscribe(function(){e.formatError(!1)}),this.score.coverArt().id.subscribe(function(){e.coverArtError(!1)}),this.previewType.subscribe(function(){e.previewTypeError(!1)})}},{key:"initialize",value:function(e,t,o,r){var n=this;(this.clear(),e?this.isOriginalWork(!0):(this.isOriginalWork(!1),this._updateDataFromElementWithContributorsList(o),this._updateArranger(r)),this.options.composers&&this._updateComposers(this.options.composers),this.options.lyricists&&this._updateLyricists(this.options.lyricists),this.options.artist&&this._updateArtist(this.options.artist.name),this.options.previewType&&this.previewType(this.options.previewType),this.formatErrorText((0,s.resource)("errors.formatNeeded")),this.isArrangementAuthorship()&&!this.allowLargeEnsembles())&&(this.score.restrictFormat()&&setTimeout(function(){n.formatErrorText((0,s.resource)("errors.formatNotValid")),n.formatError(!0)},200));this.canUseFullPreview(t),this.canUseFullPreview()||this.previewType("partial")}},{key:"clear",value:function(){this.composers([]),this.addNewComposer(),this.lyricists([]),this.addNewLyricist(),this.artist().name(""),this._updateArranger(""),this.disableArtist(!1),this.disableComposers(!1),this.disableLyricists(!1)}},{key:"_updateDataFromElementWithContributorsList",value:function(e){var t=e.extractArtist();t&&this._addArtist(t),this.composers([]);for(var o=e.extractComposers(),r=0;r<o.length;r++)this._addComposer(o[r]);this.lyricists([]);for(var n=e.extractLyricists(),i=0;i<n.length;i++)this._addLyricist(n[i]);this.disableComposers(!0),this.disableArtist(!0),this.disableLyricists(!0)}},{key:"_addArtist",value:function(e){this.artist({name:ko.observable(e.name),role:ko.observable(e.role)})}},{key:"_updateComposers",value:function(e){this.composers([]);for(var t=0;t<e.length;t++)this._addComposer(e[t])}},{key:"removeComposer",value:function(e){this.composers.remove(e)}},{key:"_addComposer",value:function(e){var t={name:ko.observable(e.name),role:e.role,composerError:ko.observable(!1)};t.name.subscribe(function(){t.composerError(!1)}),this.composers.push(t)}},{key:"addNewComposer",value:function(){this._addComposer({name:"",role:a.NF_COMPOSER})}},{key:"_updateLyricists",value:function(e){this.lyricists([]);for(var t=0;t<e.length;t++)this._addLyricist(e[t])}},{key:"removeLyricist",value:function(e){this.lyricists.remove(e)}},{key:"_addLyricist",value:function(e){this.lyricists.push({name:ko.observable(e.name),role:e.role})}},{key:"addNewLyricist",value:function(){this._addLyricist({name:"",role:a.NF_LYRICIST})}},{key:"_updateArranger",value:function(e){this.arranger().name(e)}},{key:"_updateArtist",value:function(e){this.artist().name(e)}},{key:"_extractComposers",value:function(){for(var e=[],t=0;t<this.composers().length;t++)this.composers()[t].name()&&e.push(this.composers()[t]);return e}},{key:"_extractComposerNames",value:function(){return this.composers().map(function(e){return e.name()})}},{key:"_extractLyricists",value:function(){for(var e=[],t=0;t<this.lyricists().length;t++)this.lyricists()[t].name()&&e.push(this.lyricists()[t]);return e}},{key:"_extractLyricistNames",value:function(){return this.lyricists().map(function(e){return e.name()})}},{key:"_createContributorsArray",value:function(){var e=this._extractComposers();return e=e.concat(this._extractLyricists()),this.artist().name()&&e.push(this.artist()),this.arranger().name()&&e.push(this.arranger()),e}},{key:"extractSongInfo",value:function(){return{credits:(0,i.formatComposerField)(this._extractComposerNames(),this._extractLyricistNames())}}},{key:"extractContributorsInfo",value:function(){return this._createContributorsArray()}},{key:"_setComposerErrorState",value:function(e){this.composers().length>0&&this.composers()[0].composerError(e)}},{key:"_clearErrors",value:function(){this._setComposerErrorState(!1),this.genreError(!1),this.difficultyLevelError(!1),this.coverArtError(!1),this.previewTypeError(!1)}},{key:"_validate",value:function(){return this.composers()[0]&&!this.composers()[0].name()?(this._setComposerErrorState(!0),!1):this.score.genre()?this.score.difficultyLevel()?this.score.format()?this.score.coverArt().id()?!!this.previewType()||(this.previewTypeError(!0),!1):(this.coverArtError(!0),!1):(this.formatError(!0),!1):(this.difficultyLevelError(!0),!1):(this.genreError(!0),!1)}},{key:"next",value:function(){return this._clearErrors(),this._validate()}},{key:"back",value:function(){return this._clearErrors(),!0}},{key:"_createFormats",value:function(){var e=this;return this.scoreFacets.formats().map(function(t){var o=e.isArrangementAuthorship()&&n.LARGE_FORMATS.includes(t.value)&&!e.allowLargeEnsembles(),r=Object.assign({disable:o},t);return o&&(r.label+=" ".concat((0,s.resource)("content.sellingDetails.ensembleSize.notAllowed"))),r})}},{key:"setOptionDisable",value:function(e,t){if(!t)return e;ko.applyBindingsToNode(e,{disable:t.disable},t)}}]),t}();t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstrumentMapping=t.default=void 0;var r=o(0),n=function(e){return e&&e.__esModule?e:{default:e}}(o(102)),i=o(15),a=o(530);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,o){return t&&c(e.prototype,t),o&&c(e,o),e}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var o;return l(this,t),(o=d(this,p(t).call(this))).scoreModel=e,o.mappings=ko.observableArray([]),o.initialize(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.default),u(t,[{key:"initialize",value:function(){for(var e=0;e<this.scoreModel.parts.length;e++){var t=new m(this.scoreModel.parts[e].nameToShow,this.scoreModel.parts[e].instrumentUri);t.initialize(),this.mappings.push(t)}}},{key:"instrumentNames",value:function(){for(var e=[],t=0;t<this.mappings().length;t++)e.push(this.mappings()[t].value);return e}},{key:"handleClick",value:function(e,t){if(!(-1!=t.target.className.indexOf("instrumentSearchBox")||$(t.target).parents(".instrumentSearchBox").length>0)){for(var o=0;o<this.mappings().length;o++)this.mappings()[o].clearResults();return!0}}}]),t}();t.default=h;var m=function(){function e(t,o){var r=this;l(this,e),this.partName=ko.observable(t),this.instrumentUri=o,this.editing=ko.observable(!0),this.mapping=ko.observable(""),this.value=null,this.results=ko.observableArray([]),this.uuid=ko.observable((0,i.generateUUID)()),this.searchInstrument=this.searchInstrument.bind(this),this.selectInstrumentCallback=this.selectInstrumentCallback.bind(this),this.updateResults=this.updateResults.bind(this),this.initialMatchCallback=this.initialMatchCallback.bind(this),this.mapping.subscribe(function(e){r.instrumentToSearch(e)}),this.instrumentToSearch=ko.observable().extend({throttle:200}),this.instrumentToSearch.subscribe(this.searchInstrument)}return u(e,[{key:"initialize",value:function(){var e=$$nf.synthesis.context.getOriginalNameByUri(this.instrumentUri)||"",t=(0,r.resource)("instruments.partName.".concat(NF.getStringForResourcesKey(e))),o=this._termDecision(this.partName(),t,this.instrumentUri);this.searchInstrument({term:o,callback:this.initialMatchCallback})}},{key:"_termDecision",value:function(e,t,o){var n=null;if(e==t)n=(0,r.resource)("genericInstrument.".concat($$nf.synthesis.context.getGenericInstrumentKeyByUri(o)));else{var i=a.HARDCODED_MAPPING[e.replace(/\./g,"")];i&&(n=i[o])}return n||(n=e),n}},{key:"initialMatchCallback",value:function(e){var t=e.results.localized_instrument;if(t){for(var o=0;o<t.length;o++)if(this.instrumentUri==t[o].uri)return void this.selectInstrumentCallback(new g(t[o].name,t[o].value));this.selectInstrumentCallback(new g(t[0].name,t[0].value))}}},{key:"handleKeydown",value:function(e,t){var o=this.instrumentHighlightedPosition(),r=t.keyCode;return 40==r||9==r&&!t.shiftKey?o++:38==r||9==r&&t.shiftKey?o--:13==r&&o&&this.selectInstrumentCallback(this.results()[o]),o<0&&(o=this.results().length-1),o>=this.results().length&&(o=0),this.highlightInstrument(o),!0}},{key:"instrumentHighlightedPosition",value:function(){for(var e=0;e<this.results().length;e++)if(this.results()[e].highlighted())return e;return-1}},{key:"unglighlghtAllInstruments",value:function(){for(var e=0;e<this.results().length;e++)this.results()[e].highlighted(!1)}},{key:"highlightInstrument",value:function(e){e<0||e>=this.results().length||(this.unglighlghtAllInstruments(),this.results()[e].highlighted(!0))}},{key:"searchInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.callback||this.updateResults,o=e.term||this.instrumentToSearch();o&&0!==o.trim().length?NF.apiService.searchInstruments((0,r.resource)("action.searching"),t,{term:o,locale:NF.locale()}):this.clear()}},{key:"selectInstrumentCallback",value:function(e){this.mapping(e.name()),this.value=e.value,this.editing(!1)}},{key:"editInstrument",value:function(){this.editing(!0),this.searchInstrument()}},{key:"clear",value:function(){this.mapping(""),this.value=null,this.editing(!0),this.results([])}},{key:"clearResults",value:function(){this.editing()&&this.clear()}},{key:"updateResults",value:function(e){this.results([]);var t=e.results.localized_instrument;if(t)for(var o=Math.min(4,t.length),n=0;n<o;n++)this.results.push(new g(t[n].name,t[n].value,this.selectInstrumentCallback));this.results.push(new g((0,r.resource)("content.other"),"other",this.selectInstrumentCallback));var i=$("#instrumentsMapping").parents(".scrollableDialog"),a=$("#".concat(this.uuid()));a.offset()&&a.offset().top-i.scrollTop()+(a.height()+200)>i.height()&&i.animate({scrollTop:a.offset().top},500)}}]),e}();t.InstrumentMapping=m;var g=function(){function e(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l(this,e),this.name=ko.observable(t),this.value=o,this.highlighted=ko.observable(!1),this.selectionCallback=r}return u(e,[{key:"handleSelect",value:function(){this.selectionCallback&&this.selectionCallback(this)}}]),e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HARDCODED_MAPPING=void 0;t.HARDCODED_MAPPING={Alto:{"vocal/choir/female/aah":"Alto Voice","vocal/choir/female/ooh":"Alto Voice","vocal/choir/female/ooo":"Alto Voice"},"Backup Vocals":{"percussion/pitched/piano/premium":"Voice"},"Baritone/Bass":{"vocal/choir/male/aah":"Bass Voice"},Bass:{"vocal/choir/male/aah":"Bass Voice","vocal/choir/male/ooh":"Bass Voice","vocal/choir/male/ooo":"Bass Voice"},"Bass I/Bass II":{"vocal/choir/male/aah":"Bass Voice"},"Bass Drum":{"percussion/unpitched/bass-drum/premium":"Drum Set"},"Clarinet in Eb":{"woodwind/clarinet/premium":"Clarinet"},"Clarinet in Bb 1,2":{"woodwind/clarinet/premium":"Clarinet"},"Classical Guitar":{"strings/guitar/acoustic/classical/premium":"Guitar","strings/guitar/acoustic/classical/premium/tab":"Guitar (Tab)"},Contrabassoon:{"woodwind/bassoon/premium":"Bassoon"},"Electric Guitar":{"strings/guitar/electric/clean/premium":"Guitar"},"Handbells I":{"percussion/pitched/piano/premium":"Handbells"},"Handbells II":{"percussion/pitched/piano/premium":"Handbells"},"Lead Vocals":{"percussion/pitched/piano/premium":"Voice"},"Lead Guitar":{"strings/guitar/acoustic/classical/premium":"Acoustic Guitar"},"Low Brass":{"brass/trombone/premium":"Trombone"},"Rhythm Guitar":{"strings/guitar/acoustic/classical/premium":"Acoustic Guitar"},Soprano:{"vocal/choir/female/aah":"Soprano Voice","vocal/choir/female/ooh":"Soprano Voice","vocal/choir/female/ooo":"Soprano Voice"},"Soprano I":{"vocal/choir/female/aah":"Soprano Voice"},"Soprano II":{"vocal/choir/female/aah":"Soprano Voice"},"Soprano/Alto":{"vocal/choir/female/aah":"Voice"},Tab:{"strings/guitar/acoustic/premium":"Guitar (Tab)"},Tenor:{"vocal/choir/male/aah":"Tenor Voice","vocal/choir/male/ooh":"Tenor Voice","vocal/choir/male/ooo":"Tenor Voice"},"Tenor I/Tenor II":{"vocal/choir/male/aah":"Tenor Voice"},"Tenor/Bass":{"vocal/choir/male/aah":"Voice"},"Tenor/Lead":{"vocal/choir/male/aah":"Tenor Voice"},Triangle:{"percussion/unpitched/sleighBell/basic":"Drum Set"},"Trumpet I":{"brass/trumpet/premium":"Trumpet/Cornet"},"Trumpet II":{"brass/trumpet/premium":"Trumpet/Cornet"},"Trumpet in Bb 1,2":{"brass/trumpet/premium":"Trumpet/Cornet"},"Trumpet in Bb 3":{"brass/trumpet/premium":"Trumpet/Cornet"},"Upright Bass":{"strings/bass/upright/premium":"Double Bass"},"Violin I":{"strings/violin/solo/premium":"Violin","strings/violin/ensemble/premium":"Violin"},"Violin II":{"strings/violin/solo/premium":"Violin","strings/violin/ensemble/premium":"Violin"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(102)),n=o(6),i=o(15),a=o(36),s=o(8),l=o(0);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,o,r,i,a){var s,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=d(this,p(t).call(this))).resource=l.resource,s.selectedCopyrightOption=e,s.royaltyAssignment=o,s.isArrangementOfExternalCopyrightedWork=r,s.format=i,s.options=c,s.isArrangementAuthorship=a,s.pricingMinimums=n.ko.observable({}),s.ensembleSizesMap=n.ko.observable({}),s.ready=n.ko.observable(!1),s.initializeObservables(),s.initializeComputeds(),s.initializeSubscribers(),s.ready.subscribe(function(e){e&&(s.fillEnsembleSizes(),s.pricingMinimum(s.getPricingMinimum()),s.getCommissionPercentage())}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,r.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"initializeObservables",value:function(){this.advanceButtonText=n.ko.observable(this.options.updatingProduct?(0,l.resource)("action.publishChanges"):(0,l.resource)("action.sellYourScore")),this.priceForInput=n.ko.observable(this.options.price||""),this.pricingMinimum=n.ko.observable(299),this.pricingMaximum=n.ko.observable(99999),this.showPricingWarning=n.ko.observable(!1),this.calculatedRoyaltyPercentage=n.ko.observable(0),this.showRoyalty=n.ko.observable(!1),this.allowArrangements=n.ko.observable(this.options.sellableArrangements||!1),this.disableArrangements=n.ko.observable(this.options.hasBeenPurchased),this.versionDescription=n.ko.observable(),this.showVersioning=n.ko.observable(this.options.showVersioning),this.minimumInitialPurchaseNumber=n.ko.observable(),this.selectedMinimumPurchaseNumber=n.ko.observable(),this.selectedEnsembleSizeOption=n.ko.observable()}},{key:"initializeComputeds",value:function(){var e=this;this.nextEnabled=n.ko.computed(function(){return!!e.priceForInput()}),this.ensembleSizeOptions=n.ko.computed(function(){return e.ready()?e.pricingMinimums().ensemble_sizes.map(function(e){var t=(0,l.resource)("content.sellingDetails.ensembleSize."+e.name);return e.disabled&&(t+=" ".concat((0,l.resource)("content.sellingDetails.ensembleSize.notAllowed"))),{value:e.id,label:t,disable:e.disabled}}):[]}),this.formattedPricingMinimum=n.ko.computed(function(){return(0,i.formatPriceInCents)(e.pricingMinimum())}),this.formattedPricingMaximum=n.ko.computed(function(){return(0,i.formatPriceInCents)(e.pricingMaximum())}),this.priceMinimumForInput=n.ko.computed(function(){return e.pricingMinimum()/100}),this.priceMaximumForInput=n.ko.computed(function(){return e.pricingMaximum()/100}),this.priceErrorText=n.ko.computed(function(){return e.priceForInput()>e.priceMaximumForInput()?(0,l.resource)("content.sellingDetails.pricing.tooExpensive",e.formattedPricingMaximum()):(0,l.resource)("content.sellingDetails.pricing.errorMessage",e.formattedPricingMinimum())}),this.displayedRoyaltyPercentage=n.ko.computed(function(){return 100*e.calculatedRoyaltyPercentage()*10/10}),this.pricingPlaceholder=n.ko.computed(function(){return(0,l.resource)("content.sellingDetails.pricing.placeholder",e.formattedPricingMinimum())}),this.calculatedRoyalty=n.ko.computed(function(){var t=e.calculatedRoyaltyPercentage()&&e.priceForInput()?e.priceForInput()*e.calculatedRoyaltyPercentage():0;return"".concat((0,i.formatPriceInCents)(100*t,{showDouble0ForCents:!0}))}),this.showArrangementOption=n.ko.computed(function(){return e.selectedCopyrightOption()===s.ORIGINAL_AUTHORSHIP}),this.fullEnsembleSize=n.ko.computed(function(){var t=e.ensembleSizeOptions().find(function(t){return t.value===e.selectedEnsembleSizeOption()});if(t)return t.label}),this.pricingString=n.ko.computed(function(){return e.priceForInput()?(0,l.resource)("content.sellingDetails.price","".concat(parseInt(e.priceForInput()).toFixed(2))):(0,l.resource)("content.sellingDetails.price","0.00")}),this.enforcePurchaseMinimum=n.ko.computed(function(){return!(!e.format()||!e.format().toLowerCase().startsWith("choral"))}),this.priceLabel=n.ko.computed(function(){return e.enforcePurchaseMinimum()?(0,l.resource)("content.sellingDetails.pricing.instructionMinimum"):(0,l.resource)("content.sellingDetails.pricing.instruction")}),this.finalPurchaseMinimum=n.ko.computed(function(){return e.selectedMinimumPurchaseNumber()&&e.selectedMinimumPurchaseNumber()>1?e.selectedMinimumPurchaseNumber():1}),this.initialPurchaseMinimums=n.ko.computed(function(){var t=[];if(e.minimumInitialPurchaseNumber())for(var o=e.minimumInitialPurchaseNumber();o<=20;o++)t.push({value:o,label:o.toString()+" "+(0,l.resource)("content.sellingDetails.performers")});return t})}},{key:"initializeSubscribers",value:function(){var e=this;this.selectedCopyrightOption.subscribe(function(){e.pricingMinimum(e.getPricingMinimum()),e.getCommissionPercentage()}),this.royaltyAssignment.song.subscribe(function(){e.getCommissionPercentage()}),this.royaltyAssignment.blackbox.subscribe(function(){e.getCommissionPercentage()}),this.selectedEnsembleSizeOption.subscribe(function(){e.pricingMinimum(e.getPricingMinimum())}),this.priceForInput.subscribe(function(t){e.showRoyalty(null!=t),e.showPricingWarning(!1)})}},{key:"initialize",value:function(){this.fillEnsembleSizes(),(0,a.initializeTippy)()}},{key:"fillEnsembleSizes",value:function(){var e=this,t={score_format:this.format(),is_copyrighted:this.isArrangementOfExternalCopyrightedWork()};n.NF.apiService.scoreProductPricing("",function(t){e.pricingMinimums(t);for(var o=0;o<t.ensemble_sizes.length;o++){var r=t.ensemble_sizes[o];e.ensembleSizesMap()[r.id]=r}e.minimumInitialPurchaseNumber(t.minimum_initial_purchase_amount),e.selectedEnsembleSizeOption(e.pricingMinimums().ensemble_sizes[0].id),e.ready(!0)},t)}},{key:"next",value:function(){return!!this.pricingCheck()||(this.showPricingWarning(!0),!1)}},{key:"getCommissionPercentage",value:function(){var e=this,t={is_public_domain:this.selectedCopyrightOption()===s.PUBLIC_DOMAIN_AUTHORSHIP,is_arrangement:this.selectedCopyrightOption()===s.ARRANGEMENT_AUTHORSHIP||this.selectedCopyrightOption()===s.ARRANGEMENT_EXISTING_WORK||this.selectedCopyrightOption()===s.PUBLIC_DOMAIN_AUTHORSHIP,is_blackbox:this.royaltyAssignment.blackbox()};this.royaltyAssignment&&this.royaltyAssignment.song()&&this.royaltyAssignment.song().uuid()&&(t.song_uuid=this.royaltyAssignment.song().uuid()),n.NF.apiService.sellerCommission("",function(t){e.calculatedRoyaltyPercentage(t.percentage)},t)}},{key:"getPricingMinimum",value:function(){var e=this.selectedCopyrightOption()!==s.ARRANGEMENT_AUTHORSHIP&&this.selectedCopyrightOption()!==s.ARRANGEMENT_EXISTING_WORK,t=!this.selectedEnsembleSizeOption();if(e||t)return this.pricingMinimums().min_price;for(var o=this.ensembleSizesMap()[this.selectedEnsembleSizeOption()].name,r=this.pricingMinimums().ensemble_sizes,n=0;n<r.length;n++)if(r[n].name===o)return r[n].min_price}},{key:"pricingCheck",value:function(){return this.priceForInput()<=this.priceMaximumForInput()&&this.priceForInput()>=this.priceMinimumForInput()}},{key:"closePricingError",value:function(){this.showPricingWarning(!1)}},{key:"setOptionDisable",value:function(e,t){if(!t)return e;n.ko.applyBindingsToNode(e,{disable:t.disable},t)}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(533);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.song=ko.observable(),this.text=ko.computed(function(){return t.song()?t.song().title():""}),this.url=ko.computed(function(){return t.song()?t.song().url():""}),this.blackboxModel=null,this.blackbox=ko.observable(!1),this.ready=ko.observable(!1)}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"updateFromSong",value:function(e){this.song(e),this.blackbox(!1),this.ready(!0)}},{key:"prepareForBlackbox",value:function(e){this.blackboxModel=new r.BlackboxingDialog(e),this.blackbox(!0),this.ready(!0)}},{key:"reset",value:function(){this.ready(!1),this.blackbox(!1),this.song(!1)}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){var r=new d(e,t,o);return(0,i.createAndShowDialog)({viewModel:r,templateName:"dialogs/blackboxing"}),r},t.BlackboxingDialog=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(8),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=function(e){function t(e,o,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,l(t).call(this))).okCallback=o,n.cancelCallback=r,n.title=ko.observable(e),n.artist=ko.observable(""),n.composers=ko.observableArray(),n.lyricists=ko.observableArray(),n.saveEnabled=ko.computed(function(){return n.title().length>0&&Math.max(n.artist().length,n.totalComposersLength())>0}),n.addComposer=n.addComposer.bind(u(u(n))),n.addLyricist=n.addLyricist.bind(u(u(n))),n.addComposer(),n.addLyricist(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"doOk",value:function(){return this.okCallback(this.formatText()),!0}},{key:"formatText",value:function(){var e=t.fixWhitespace(this.title().replace(/\//g,","));this.artist().length&&(e+=" ("+this.artist()+")");for(var o=this.composers(),r=0,n=o.length;r<n;++r){var i=t.fixWhitespace(o[r].name());i.length&&(e+=(0===r?" / ":" & ")+i)}return e}},{key:"extractArtist",value:function(){return{name:this.artist(),role:n.NF_ARTIST}}},{key:"extractComposers",value:function(){for(var e=[],t=0;t<this.composers().length;t++)e.push({name:this.composers()[t].name(),role:n.NF_COMPOSER});return e}},{key:"extractComposerNames",value:function(){return this.composers().map(function(e){return e.name()})}},{key:"extractLyricists",value:function(){for(var e=[],t=0;t<this.lyricists().length;t++)e.push({name:this.lyricists()[t].name(),role:n.NF_LYRICIST});return e}},{key:"extractLyricistNames",value:function(){return this.lyricists().map(function(e){return e.name()})}},{key:"addComposer",value:function(){var e=this.composers,t={name:ko.observable(""),remove:function(){e.remove(t)},role:n.NF_COMPOSER};e.push(t)}},{key:"addLyricist",value:function(){var e=this.lyricists,t={name:ko.observable(""),remove:function(){e.remove(t)},role:n.NF_LYRICIST};e.push(t)}},{key:"totalComposersLength",value:function(){for(var e=this.composers(),o=0,r=0;r<e.length;++r)o+=t.fixWhitespace(e[r].name()).length;return o}},{key:"cleanUp",value:function(){for(var e=this.composers().length-1;e>=0;e--){var t=this.composers()[e];""===t.name().trim()&&t.remove()}for(var o=this.lyricists().length-1;o>=0;o--){var r=this.lyricists()[o];""===r.name().trim()&&r.remove()}}},{key:"doCancel",value:function(){return this.cancelCallback(),!0}}],[{key:"fixWhitespace",value:function(e){return e.replace(/\s+/g," ").trim()}}]),t}();t.BlackboxingDialog=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sellScoreSelector=t.editorSourceSongSelector=void 0;var r=o(12),n=o(17),i=o(34),a=(0,r.createSelector)(i.songsSelector,n.editorSourceProductSelector,n.editorSongIdSelector,function(e,t,o){return null!=t?e[t.song_id]:null!=o?e[o]:null});t.editorSourceSongSelector=a;var s=(0,r.createSelector)(n.editorContentModelSelector,n.editorContentPolicySelector,n.editorSourceProductSelector,a,n.editorScoreIdSelector,n.editorContentTypeSelector,function(e,t,o,r,n,i){return{currentModel:e,title:e.title,hasBeenPurchased:e.has_been_purchased,sellableArrangements:e.sellable_arrangements,isProductCopy:t.is_product_copy,sourceProduct:o,sourceSong:r,scoreId:n,contentType:i}});t.sellScoreSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(3);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,l(t).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"show",value:function(){(0,n.createAndShowDialog)({viewModel:this,templateName:"dialogs/formatScoreBeforeSelling"})}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(0),i=o(537),a=o(14),s=o(6);function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),this.initializeComputeds()}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.isContentLibraryCopy=s.ko.observable(),this.isFromContentLibrary=s.ko.observable(),this.contentModel=s.ko.observable(),(0,a.connect)(i.contentLibrarySectionSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.showLibraryPod=s.ko.computed(function(){return e.isFromContentLibrary()}),this.contentLibraryCopy=s.ko.computed(function(){return e.showLibraryPod()&&e.isContentLibraryCopy()}),this.canCheckoutFromContentLibrary=s.ko.computed(function(){return e.isFromContentLibrary()&&null!=e.contentModel().content_library_checkout_uri}),this.couldJoinLibrary=s.ko.computed(function(){return e.contentModel().can_add_self_to_library}),this.libraryInfoText=s.ko.computed(function(){var e="editor.contentLibrary.view";return s.NF.session.current_user()&&s.NF.session.current_user().effective_admin()&&(e="editor.contentLibrary.adminView"),(0,n.resource)(e)})}},{key:"viewContentLibrary",value:function(){(0,r.navigate)(s.NF.paths.viewLibrary({libraryId:this.contentModel().content_library.id}))}},{key:"checkoutContentLibraryCopy",value:function(){this.canCheckoutFromContentLibrary()&&(0,r.navigate)(this.contentModel().content_library_checkout_uri)}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.contentLibrarySectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentPolicySelector,n.editorContentModelSelector,function(e,t){return{isContentLibraryCopy:e.is_content_library_copy,isFromContentLibrary:e.is_from_content_library,contentModel:t}});t.contentLibrarySectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=m(o(4)),n=m(o(277)),i=m(o(539)),a=m(o(540)),s=o(278),l=o(0),c=o(15),u=o(542),d=o(14),p=o(8),f=o(5),h=o(6);function m(e){return e&&e.__esModule?e:{default:e}}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.score=t.score,this.initializeConnectedProperties(),this.favorites=h.ko.observableArray(),this.listFavorites=h.ko.observable(!1),this.sharingMenuItems=h.ko.observableArray(),this.openEmbedDialog=this.openEmbedDialog.bind(this),this.copyURLToClipboard=this.copyURLToClipboard.bind(this),this.shareOnFacebook=this.shareOnFacebook.bind(this),this.tweetOnTwitter=this.tweetOnTwitter.bind(this),this.initializeComputeds(),this.myFavorite=new i.default(this)}return function(e,t,o){t&&g(e.prototype,t),o&&g(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentType=h.ko.observable(),this.currentUserIsAuthor=h.ko.observable(),this.isSharedWithEveryone=h.ko.observable(),(0,d.connect)(u.socialStatisticsSectionSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.sharingUrl=h.ko.computed(function(){if(e.score())return e.score().full_product_url()?e.score().full_product_url():e.score().view_score_uri()}),this.favoritesCount=h.ko.computed(function(){return e.score()&&(0,c.formatCommas)(e.score().favorites_count())}),this.commentsCount=h.ko.computed(function(){return e.score()&&(0,c.formatCommas)(e.score().comments_count())}),this.viewsCount=h.ko.computed(function(){return e.score()&&(0,c.formatCommas)(e.score().views_count())}),this.showCommentsCount=h.ko.computed(function(){return e.score()&&e.score().comments_count()}),this.showViewCount=h.ko.computed(function(){return e.score()&&e.score().views_count()>0}),this.hasMoreFavorites=h.ko.computed(function(){return e.favorites().length>0&&e.favorites().length<e.score().favorites_count()}),this.showCommentsStats=h.ko.computed(function(){return e.contentType()===p.SCORE}),this.canSocialize=h.ko.computed(function(){return h.NF.session.community().default_community()&&e.score()&&("public"==e.score().scoreType()||"shared"==e.score().scoreType())||e.contentType()===p.PRODUCT}),this.showSharePod=h.ko.computed(function(){var t=e.isSharedWithEveryone()&&!e.editor.viewer()&&e.score()&&!e.score().content_library||e.contentType()===p.PRODUCT;return e.sharingMenuItems.removeAll(),t&&e.makeSharingMenuItems(),t})}},{key:"faveClick",value:function(){this.score()&&(this.score().in_favorites()?this.myFavorite.removeFromFaves():this.myFavorite.addToFaves())}},{key:"toggleFaves",value:function(){this.listFavorites(!this.listFavorites())}},{key:"appendFavorite",value:function(e){this.favorites.push(new n.default(e))}},{key:"fetchMoreFavorites",value:function(){r.default.publish(f.SCORE_FETCH_DATA,{facet:"favorites",favorites_offset:this.favorites().length,favorites_limit:10})}},{key:"makeSharingMenuItems",value:function(){this.sharingMenuItems.push({label:(0,l.resource)("action.embedScore"),action:this.openEmbedDialog},{label:(0,l.resource)("action.copyLink"),action:this.copyURLToClipboard}),(this.canSocialize()||this.contentType()===p.PRODUCT)&&(this.sharingMenuItems.push({label:(0,l.resource)("action.shareOnFacebook"),action:this.shareOnFacebook}),this.sharingMenuItems.push({label:(0,l.resource)("action.shareOnTwitter"),action:this.tweetOnTwitter}))}},{key:"openEmbedDialog",value:function(){(new a.default).show()}},{key:"copyURLToClipboard",value:function(){var e=$("<input>");$("body").append(e),e.val(this.sharingUrl()).select(),document.execCommand("copy"),e.remove(),$("#copyConfirmation").slideDown("fast"),setTimeout(function(){$("#copyConfirmation").fadeOut("slow")},2e3)}},{key:"shareOnFacebook",value:function(){h.NF.shareOnFacebook(this.sharingUrl())}},{key:"tweetOnTwitter",value:function(){(0,s.tweetOnTwitter)(this.sharingUrl(),this.score()&&this.score().title())}}]),e}();t.default=b},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(277)),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socialStats=t,this.busy=ko.observable(!1),this.favorites=t.favorites,this.doAddFaves=this.doAddFaves.bind(this),this.doRemoveFaves=this.doRemoveFaves.bind(this)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"addToFaves",value:function(){!this.busy()&&NF.checkUserIdentified((0,n.resource)("action.addToFavesTitle"),(0,n.resource)("action.addToFavesAction"))&&(this.busy(!0),NF.apiService.addFavoriteToScore("",this.doAddFaves,{score_id:this.socialStats.editor.score().id()}))}},{key:"doAddFaves",value:function(e){var t=new NF.Favorite(e.favorite);this.socialStats.score().favorites.unshift(t),this.favorites.unshift(new r.default(t)),this.socialStats.score().in_favorites(!0),this.socialStats.score().favorites_count(this.socialStats.score().favorites_count()+1),this.busy(!1)}},{key:"removeFromFaves",value:function(){this.busy()||(this.busy(!0),NF.apiService.removeFavoriteFromScore("",this.doRemoveFaves,{score_ids:[this.socialStats.editor.score().id()]}))}},{key:"doRemoveFaves",value:function(){for(var e=this.favorites().length-1;e>=0;e--){var t=this.favorites()[e];t.favorite.user().external_id()==NF.session.current_user().external_id()&&(this.favorites.remove(t),this.socialStats.score().favorites.remove(t.favorite))}this.socialStats.score().in_favorites(!1),this.socialStats.score().favorites_count(this.socialStats.score().favorites_count()-1),this.busy(!1)}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3),a=o(14),s=o(8),l=o(541),c=o(100),u=o(6);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=f(this,h(t).call(this))).editor=(0,c.getApplicationEditor)(),e.score=e.editor.score(),e.title=(0,n.resource)("action.embedScore"),e.initializeConnectedProperties(),e.embedWidth=u.ko.observable(640),e.embedHeight=u.ko.observable(298),e.embedScale=u.ko.observable(1),e.embedId=u.ko.observable(""),e.embedAllowEditing=u.ko.observable(!1),e.hidePlaybackCursor=u.ko.observable(!1),e.showInPlaceEditing=u.ko.observable(e.contentType()!=s.PRODUCT),e.possibleViews=[{value:s.STRIP_VIEW_VALUE,label:(0,n.resource)("palette.viewStrip")},{value:s.PERFORM_VIEW_VALUE,label:(0,n.resource)("palette.viewPerform")},{value:s.PAGE_VIEW_VALUE,label:(0,n.resource)("palette.viewPaginated")},{value:s.FLOW_VIEW_VALUE,label:(0,n.resource)("palette.viewFlow")}],e.selectedView=u.ko.observable(),e.contentType()===s.PRODUCT?e.selectedView(s.PAGE_VIEW_VALUE):e.selectedView(e.editor.html5Editor().fit()),e.embedCode=u.ko.computed(function(){return e._getEmbedCode()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,r.default),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.contentType=u.ko.observable(),this.contentId=u.ko.observable(),this.contentFullUrl=u.ko.observable(),(0,a.connect)(l.embedDialogSelector,{})(this)}},{key:"_getEmbedCode",value:function(){var e=null;e=this.contentType()==s.PRODUCT?(e=this.contentFullUrl()).replace("/marketplace/","/marketplace/embed/"):(e=this.score.view_score_uri()).replace("/scores/view/","/embed/");var t="scale="+this.embedScale();this.contentType()==s.SCORE&&(t+="&displayMode="+this.selectedView(),this.embedAllowEditing()&&(t+="&role=template")),this.hidePlaybackCursor()&&(t+="&hidePlaybackCursor=true");var o='<iframe width="'+this.embedWidth()+'" height="'+this.embedHeight()+'"';return o+=' src="'+(e+"?"+t)+'"></iframe>'}},{key:"previewEmbed",value:function(){window.open().document.write(this._getEmbedCode())}},{key:"selectAllText",value:function(e,t){var o,r=t.target,n=document;n.body.createTextRange?((o=n.body.createTextRange()).moveToElementText(),o.select()):window.getSelection&&r.select()}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/embedDialog"})}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.embedDialogSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentIdSelector,n.editorContentTypeSelector,n.editorContentFullUrlSelector,function(e,t,o){return{contentId:e,contentType:t,contentFullUrl:o}});t.embedDialogSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.socialStatisticsSectionSelector=void 0;var r=o(12),n=o(17),i=o(92),a=(0,r.createSelector)(n.editorContentTypeSelector,n.currentUserIsAuthorSelector,i.isSharedWithEveryoneSelector,function(e,t,o){return{contentType:e,currentUserIsAuthor:t,isSharedWithEveryone:o}});t.socialStatisticsSectionSelector=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6),n=o(2),i=o(0),a=o(14),s=o(544);function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.busy=r.ko.observable(!1),this.initializeConnectedProperties(),this.handleCopySuccess=this.handleCopySuccess.bind(this)}return function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentModel=r.ko.observable(),this.isEditingProduct=r.ko.observable(),this.currentUserIsAuthor=r.ko.observable(),(0,a.connect)(s.saveProductCopySectionSelector,{})(this)}},{key:"handleCopySuccess",value:function(e){(0,n.navigate)(e.view_score_uri)}},{key:"createProductCopy",value:function(){var e=this;this.busy(!0),r.NF.apiService.createProductCopy((0,i.resource)("action.copying"),this.handleCopySuccess,{uuid:this.contentModel().id},{fail:function(){return e.busy(!1)}})}}]),e}();t.default=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveProductCopySectionSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentModelSelector,n.editorIsEditingProductSelector,n.currentUserIsAuthorSelector,function(e,t,o){return{contentModel:e,isEditingProduct:t,currentUserIsAuthor:o}});t.saveProductCopySectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(o(546)),n=i(o(274));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.product=t}return function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(e,[{key:"handlePublishChanges",value:function(){this.showSellScoreModal()}},{key:"showSellScoreModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=void 0===e.showVersioning||e.showVersioning;new n.default({showVersioning:t,updatingProduct:!0}).show()}},{key:"handleCancelEditing",value:function(){new r.default(this.product).show()}}]),e}();t.default=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this))).product=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,n.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"doOk",value:function(){(0,r.navigate)((0,r.path)("productPreview",{uuid:this.product.uuid,slug:this.product.slug}))}},{key:"show",value:function(){return(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/cancelProductEditing"}),this}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(127)),n=o(14),i=o(548),a=o(0);function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initializeConnectedProperties(),this.title=ko.observable((0,a.resource)("content.similarMusic")),this.recommendedProducts=ko.computed(function(){for(var e=[],o=0;o<t.recommended().length;o++){var n=new r.default(t.recommended()[o]);n.coverArtViewModel().size("productRecommended"),e.push(n)}return e})}return function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.recommendedTitle=ko.observable(),this.recommended=ko.observableArray([]),(0,n.connect)(i.recommendedSectionSelector,{})(this)}}]),e}();t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recommendedSectionSelector=void 0;var r=o(12),n=o(257),i=(0,r.createSelector)(n.recommendedSelector,function(e){return e});t.recommendedSectionSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6),n=p(o(550)),i=p(o(552)),a=p(o(128)),s=p(o(4)),l=o(5),c=o(0),u=o(14),d=o(280);function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resource=c.resource,this.initializeConnectedProperties(),this.initializeObservables(),this.initializeComputeds(),this.initializeSubscribers(),this._initialize(),this._gotReviews=this._gotReviews.bind(this)}return function(e,t,o){t&&f(e.prototype,t),o&&f(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.author=r.ko.observable(),this.contentModel=r.ko.observable(),this.currentUserIsAuthor=r.ko.observable(),this.currentUserIsProductOwner=r.ko.observable(),this.currentUserIsPreviewingProduct=r.ko.observable(),(0,u.connect)(d.reviewsSelector,{})(this)}},{key:"initializeObservables",value:function(){this.averageStars=r.ko.observable(new a.default),this.totalReviews=r.ko.observable(0),this.reviews=r.ko.observableArray(),this.userReview=r.ko.observable(),this.remaining=r.ko.observable(0),this.startIndex=r.ko.observable(0),this.showAllReviews=r.ko.observable(this.currentUserIsPreviewingProduct()||this.currentUserIsAuthor()),this.showUserReview=r.ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.numberReviews=r.ko.computed(function(){return(0,c.pluralize)("content.numberReviews",e.totalReviews())}),this.showWriteReviewLink=r.ko.computed(function(){return!e.currentUserIsAuthor()&&e.currentUserIsProductOwner()&&!e.userReview()}),this.showWriteReviewButton=r.ko.computed(function(){return e.currentUserIsPreviewingProduct()}),this.reviewsToShow=r.ko.computed(function(){return e.showUserReview()?[e.userReview()]:e.reviews()})}},{key:"initializeSubscribers",value:function(){var e=this;this.showAllReviews.subscribe(function(t){t&&e.showUserReview(!1)}),s.default.subscribe(l.REVIEWS_DELETED,function(t,o){e._deletedReview(o)})}},{key:"_initialize",value:function(){this.getReviews()}},{key:"getReviews",value:function(){var e={product_uuid:this.contentModel().id,start_index:this.startIndex(),max_count:10};r.NF.apiService.retrieveProductReviews((0,c.resource)("action.loading"),this._gotReviews.bind(this),e)}},{key:"writeReview",value:function(){new i.default({callback:this._createdReview.bind(this)}).show()}},{key:"showAllReviewsAction",value:function(){this.showAllReviews(!0)}},{key:"_gotReviews",value:function(e){this.averageStars().setTotalSelected(e.average_rating),this.totalReviews(e.count);for(var t=0;t<e.reviews.length;t++)this.reviews.push(new n.default(e.reviews[t],this.contentModel().id));e.user_review.length&&!this.userReview()&&(this.userReview(new n.default(e.user_review[0],this.contentModel().id)),this.showUserReview(!0),this.showAllReviews(!1)),this.remaining(e.remaining),this.startIndex(Math.min(this.startIndex()+10,this.totalReviews()))}},{key:"_createdReview",value:function(e){this.averageStars().setTotalSelected(e.average_rating),this.totalReviews(e.count);var t=new n.default(e.review,this.contentModel().id);this.userReview(t),this.showUserReview(!0),this.reviews.unshift(t),this.startIndex(Math.min(this.startIndex()+1,this.totalReviews()))}},{key:"_deletedReview",value:function(e){this.averageStars().setTotalSelected(e.average_rating),this.totalReviews(e.count),this.showUserReview(!1),this.userReview(null);var t=this.reviews().filter(function(t){return t.id!=e.review.id});this.reviews(t),this.startIndex(Math.min(this.startIndex()-1,this.totalReviews()))}}]),e}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(551)),n=u(o(128)),i=u(o(4)),a=o(5),s=o(0),l=o(3),c=o(20);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=240,f=function(){function e(t,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id,this.title=ko.observable(t.title),this.text=ko.observable(t.text),this.date=ko.observable((0,c.formatDate)(t.date)),this.user=ko.observable(t.user),this.stars=ko.observable(new n.default({stars:t.rating})),this.reviewerLink=NF.paths.profile({userId:this.user().external_id}),this.productUuid=o,this.showShowMore=ko.computed(function(){return!!r.text()&&r.text().length>p}),this.showingMore=ko.observable(!1),this.userIsReviewer=ko.computed(function(){return!!NF.session.current_user()&&r.user().external_id==NF.session.current_user().external_id()}),this._delete=this._delete.bind(this),this._doneDeleting=this._doneDeleting.bind(this),this._flag=this._flag.bind(this),this.contextMenuItems=ko.observableArray(this._setContextMenuItems())}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"_doneDeleting",value:function(e){i.default.publish(a.REVIEWS_DELETED,e)}},{key:"_delete",value:function(){var e=this;(0,l.okCancel)((0,s.resource)("content.deleteReviewAreYouSure"),function(){NF.apiService.deleteProductReview((0,s.resource)("action.deleting"),e._doneDeleting,{review_id:e.id,product_uuid:e.productUuid})})}},{key:"_flag",value:function(){var e={apiCall:"flagProductReview",title:(0,s.resource)("content.flagReview"),params:{review_id:this.id,product_uuid:this.productUuid}};new r.default(e).show()}},{key:"_setContextMenuItems",value:function(){var e=[];return(this.userIsReviewer()||NF.roles.isNoteflightAdmin())&&e.push({label:(0,s.resource)("action.delete"),action:this._delete}),this.userIsReviewer()||e.push({label:(0,s.resource)("action.flag"),action:this._flag}),e}},{key:"toggleShowMore",value:function(){this.showingMore(!this.showingMore())}}]),e}();t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this)))._apiCall=e.apiCall,o._params=e.params,o.title=ko.observable(e.title||(0,n.resource)("content.flagComment")),o.flagReason=ko.observable(),o._flagging=ko.observable(!1),o.flagButtonEnabled=ko.computed(function(){return!o._flagging()&&o.flagReason()&&o.flagReason().trim().length>10}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"flag",value:function(){this._flagging(!0);var e=Object.assign({},this._params);e.reason=this.flagReason,NF.apiService[this._apiCall]((0,n.resource)("action.flagging"),this.cancel.bind(this),e)}},{key:"show",value:function(){return(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/flag"}),this}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(13)),n=u(o(128)),i=o(0),a=o(3),s=o(14),l=o(280),c=o(6);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=f(this,h(t).call(this)))._callback=e.callback,o.initializeConnectedProperties(),o.initializeObservables(),o.initializeComputeds(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,r.default),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.currentUser=c.ko.observable(),this.contentModel=c.ko.observable(),(0,s.connect)(l.writeReviewSelector,{})(this)}},{key:"initializeObservables",value:function(){this.title=c.ko.observable(),this.text=c.ko.observable(""),this.stars=c.ko.observable(new n.default({editable:!0,size:"big"})),this.username=this.currentUser().username,this.textFocused=c.ko.observable(!1),this._posting=c.ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.postButtonEnabled=c.ko.computed(function(){return!e._posting()&&e.text().length>=10&&0!==e.stars().total()})}},{key:"post",value:function(){this._posting(!0),this.title()||this.title((0,i.resource)("content.stars.".concat(this.stars().total()))),c.NF.apiService.createProductReview((0,i.resource)("action.posting"),this._createdReview.bind(this),{rating:this.stars().total(),title:this.title(),body:this.text(),product_uuid:this.contentModel().id})}},{key:"_createdReview",value:function(e){this.cancel(),this._callback(e)}},{key:"doOk",value:function(){return!!this.postButtonEnabled()&&(this.post(),!0)}},{key:"needsEvent",value:function(e){return this.textFocused()&&13==e.keyCode}},{key:"show",value:function(){return(0,a.createAndShowDialog)({viewModel:this,templateName:"dialogs/writeReview"}),this}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(4)),n=o(0),i=u(o(554)),a=u(o(202)),s=o(5),l=o(100),c=o(6);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=(0,l.getApplicationEditor)(),this.score=this.editor.score,this.initializeObservables(),this.initializeComputeds(),this.doAddComment=this.doAddComment.bind(this)}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"initializeObservables",value:function(){this.comments=c.ko.observableArray(),this.newCommentText=c.ko.observable(""),this.showMarkdownLink=c.ko.observable(!1),this.showMarkdownTip=c.ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.canComment=c.ko.computed(function(){return e.editor.html5EditorReady()&&e.editor.html5Editor().scorePermissions.canComment()}),this.hasMoreComments=c.ko.computed(function(){return e.comments().length>0&&e.comments().length<e.score().comments_count()})}},{key:"addComment",value:function(){c.NF.checkUserIdentified((0,n.resource)("action.postCommentTitle"),(0,n.resource)("action.postCommentAction"))&&c.NF.postService("/scores/add_comment/"+this.editor.scoreId(),this.editor,this.doAddComment)({text:this.newCommentText()})}},{key:"doAddComment",value:function(e){var t=new a.default(e.comment);this.score().comments.unshift(t),this.comments.unshift(new i.default(this.editor,t)),this.score().comments_count(this.score().comments_count()+1),$("#commentArea").removeClass("withFocus"),this.newCommentText(""),this.showMarkdownLink(!1),this.showMarkdownTip(!1)}},{key:"appendComment",value:function(e){this.comments.push(new i.default(this.editor,e))}},{key:"fetchMoreComments",value:function(){r.default.publish(s.SCORE_FETCH_DATA,{facet:"comments",comments_offset:this.comments().length,comments_limit:10})}},{key:"commentGotFocus",value:function(){$("#commentArea").addClass("withFocus"),this.showMarkdownLink(!this.showMarkdownTip())}},{key:"showMarkdownTipClick",value:function(){this.showMarkdownLink(!1),this.showMarkdownTip(!0)}}]),e}();t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3),a=o(6);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,o){return t&&p(e.prototype,t),o&&p(e,o),e}var h=function(){function e(t,o){var r=this;d(this,e),this.editor=t,this.comment=o,this.busy=ko.observable(!1),this.canRemove=ko.computed(function(){return a.NF.session.current_user()&&(a.NF.session.current_user().effective_admin()||r.editor.score().userIsAuthor()||a.NF.session.current_user().external_id()==r.comment.author().external_id())}),this.isAdmin=ko.computed(function(){return a.NF.session.current_user()&&a.NF.session.current_user().effective_admin()}),this.canFlag=ko.computed(function(){return a.NF.session.canShare()}),this.html=ko.computed(function(){return a.NF.markdownToHtml(o.text())}),this.editorLink=ko.computed(function(){return a.NF.paths.profile({userId:o.author().external_id()})}),this.remove=this.remove.bind(this),this.block=this.block.bind(this),this.unblock=this.unblock.bind(this),this.flag=this.flag.bind(this),this.contextMenuItems=ko.computed(function(){var e=[];return r.canRemove()&&e.push({label:(0,n.resource)("action.delete"),action:r.remove}),r.isAdmin()&&(r.comment.blocked_at()?e.push({label:(0,n.resource)("action.unblock"),action:r.unblock}):e.push({label:(0,n.resource)("action.block"),action:r.block})),r.canFlag()&&e.push({label:(0,n.resource)("action.flag"),action:r.flag}),e})}return f(e,[{key:"_afterRemove",value:function(){this.editor.scoreDetailsPanel().commentsSection().comments.remove(this),this.editor.score().comments.remove(this.comment),this.editor.score().comments_count(this.editor.score().comments_count()-1)}},{key:"remove",value:function(){var e=a.NF.postService("/scores/block_comment/"+this.comment.external_id(),new a.NF.ServiceReporterViewModel((0,n.resource)("comment.blocking")),this._afterRemove.bind(this));this.isAdmin()&&(e=a.NF.postService("/scores/edit_comment/"+this.comment.external_id(),new a.NF.ServiceReporterViewModel((0,n.resource)("comment.removing")),this._afterRemove.bind(this))),e()}},{key:"block",value:function(){var e=this;a.NF.postService("/scores/block_comment/"+this.comment.external_id(),new a.NF.ServiceReporterViewModel((0,n.resource)("comment.blocking")),function(t){e.comment.blocked_at((new Date).getTime())})()}},{key:"unblock",value:function(){var e=this;a.NF.postService("/scores/unblock_comment/"+this.comment.external_id(),new a.NF.ServiceReporterViewModel((0,n.resource)("comment.unblocking")),function(t){e.comment.blocked_at(null)})()}},{key:"flag",value:function(){new m(this.comment).show()}}]),e}();t.default=h;var m=function(e){function t(e){var o;return d(this,t),(o=l(this,c(t).call(this))).comment=e,o.flagReason=ko.observable(""),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),f(t,[{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/flagComment"})}},{key:"flagComment",value:function(){(0,i.hideCurrentDialog)(),a.NF.postService("/api/1.0/posts/flag",new a.NF.ServiceReporterViewModel((0,n.resource)("comment.flagging")))({post_id:this.comment.post_id(),description:this.flagReason()})}}]),t}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(o(13)),n=o(0),i=o(5),a=o(3),s=p(o(4)),l=o(14),c=o(8),u=o(556),d=o(6);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v="inappropriateLanguage",y="inappropriateCoverArt",_="unattributedUseOther",S="unattributedUseMine",w="other",k=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=m(this,g(t).call(this))).flagPossibleReasons=[{value:v,label:(0,n.resource)("content.flagScore."+v)},{value:y,label:(0,n.resource)("content.flagScore."+y)},{value:_,label:(0,n.resource)("content.flagScore."+_)},{value:S,label:(0,n.resource)("content.flagScore."+S)},{value:w,label:(0,n.resource)("content.flagScore."+w)}],e._initializeConnectedProperties(),e._initializeObservables(),e._initializeComputeds(),e.resource=n.resource,s.default.subscribe(i.SCORE_FLAGGED,function(t,o){e.hide()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,r.default),function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(t,[{key:"_initializeConnectedProperties",value:function(){this.contentType=d.ko.observable(),this.contentModel=d.ko.observable(),(0,l.connect)(u.flagDocumentSelector,{})(this)}},{key:"_initializeObservables",value:function(){this.flagReason=d.ko.observable(""),this.details=d.ko.observable("")}},{key:"_initializeComputeds",value:function(){var e=this;this.showDmca=d.ko.computed(function(){return e.flagReason()===S}),this.canSubmit=d.ko.computed(function(){return e.details().trim().length>=10&&null!=e.flagReason()&&e.flagReason().length>0})}},{key:"flagDocument",value:function(){var e=this.contentType()===c.PRODUCT?this.contentModel().marketplace_url:this.contentModel().url;this.contentModel().active_product_url&&(e=this.contentModel().active_product_url);var t={url:e,reason:this.flagReason(),details:this.details()};d.NF.apiService.flagDocument((0,n.resource)("action.sending"),function(e){s.default.publish(i.SCORE_FLAGGED,e)},t)}},{key:"show",value:function(){(0,a.createAndShowDialog)({viewModel:this,templateName:"dialogs/flagDocument"})}},{key:"doOk",value:function(){return s.default.publish(i.REPORTER_CLEAR_ERRORS),this.flagDocument(),!1}}]),t}();t.default=k},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flagDocumentSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentTypeSelector,n.editorContentModelSelector,function(e,t){return{contentType:e,contentModel:t}});t.flagDocumentSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scoreDetailsPanelSelector=void 0;var r=o(12),n=o(17),i=o(111),a=o(41),s=(0,r.createSelector)(n.editorContentPolicySelector,n.editorReadySelector,i.isMobileOrSmallerLayoutSelector,n.editorContentModelSelector,n.editorContentTypeSelector,a.isDefaultCommunitySelector,a.isLoggedInSelector,n.editorIsEditingProductSelector,n.currentUserIsAuthorSelector,n.currentUserIsProductOwnerSelector,n.currentUserIsPreviewingProductSelector,function(e,t,o,r,n,i,a,s,l,c,u){return{contentPolicy:e,editorReady:t,isMobileOrSmallerLayout:o,contentModel:r,contentType:n,isDefaultCommunity:i,isLoggedIn:a,isEditingProduct:s,currentUserIsAuthor:l,currentUserIsProductOwner:c,currentUserIsPreviewingProduct:u}});t.scoreDetailsPanelSelector=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0);function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.searchQuery=ko.observable(),NF.hasStorage){var o=localStorage.getItem("marketplaceSearchQuery");this.searchQuery(o),localStorage.removeItem("marketplaceSearchQuery"),this.searchQuery()||localStorage.removeItem("rr_add_to_cart_params")}this.breadcrumbText=ko.computed(function(){return"all"===t.searchQuery()?(0,r.resource)("content.allScores"):(0,r.resource)("palette.searchResults")}),this.searchQueryRoute=ko.computed(function(){return NF.paths.marketplaceSearchQuery({searchQuery:t.searchQuery()})})}return function(e,t,o){t&&n(e.prototype,t),o&&n(e,o)}(e,[{key:"initialize",value:function(){NF.appViewModel.headerMayHaveChangedHeight()}}]),e}();t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),i=o(3),a=o(14),s=o(560),l=o(49),c=o(115);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=p(this,f(t).call(this))).initializeConnectedProperties(),e.initializeComputeds(),e.coverArtUrl="url('".concat(e.contentModel().cover_art_url,"')"),e.genreText=(0,r.resource)("genre.".concat(e.contentModel().metadata.genre)),e.difficultyText=(0,r.resource)("difficultyLevel.".concat(e.contentModel().metadata.difficulty_level)),e.price=(0,c.formatCurrency)(e.contentModel().price/100),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"initializeConnectedProperties",value:function(){this.contentModel=ko.observable(),this.sourceProduct=ko.observable(),this.author=ko.observable(),this.song=ko.observable(),this.authorLink=ko.observable(),this.ensembleSizeMax=ko.observable(),(0,a.connect)(s.newlyCreatedProductSelector,{})(this)}},{key:"initializeComputeds",value:function(){var e=this;this.ensembleSizeText=ko.computed(function(){return e.ensembleSizeMax()?(0,r.pluralize)("content.authorizedPerformers.bold.upTo",e.ensembleSizeMax()):(0,r.resource)("content.authorizedPerformers.bold.maxSize")}),this.sellableArrangementsText=ko.computed(function(){var t=e.contentModel().sellable_arrangements?(0,r.resource)("content.sellingDetails.arrangeable.allowed"):(0,r.resource)("content.sellingDetails.arrangeable.notAllowed");return(0,r.resource)("content.sellingDetails.arrangeable",t)}),this.showSourceProduct=ko.computed(function(){return null!=e.sourceProduct()}),this.sourceProductText=ko.computed(function(){var t=(0,l.extractComposers)(e.contentModel().contributors).map(function(e){return e.name}).join(", "),o="";if(e.showSourceProduct()&&e.sourceProduct().metadata.format){var n="format.".concat(e.sourceProduct().metadata.format);o="(".concat((0,r.resource)(n),")")}return(0,r.resource)("content.product.original",e.song().title,t,o)}),this.sourceProductPath=ko.computed(function(){return e.showSourceProduct()?e.sourceProduct().marketplace_url:""})}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/newlyPublishedProduct"})}}]),t}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newlyCreatedProductSelector=void 0;var r=o(12),n=o(17),i=o(43),a=(0,r.createSelector)(n.editorContentModelSelector,n.editorAuthorSelector,n.editorSongSelector,n.editorPurchaseInfoSelector,n.editorSourceProductSelector,function(e,t,o,r,n){return{contentModel:e,author:t,song:o,authorLink:(0,i.buildUserLink)(t.id),ensembleSizeMax:r.ensembleSizeMax,sourceProduct:n}});t.newlyCreatedProductSelector=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0),n=o(3),i=o(6),a=function(e){return e&&e.__esModule?e:{default:e}}(o(32)),s=o(36),l=o(19),c=o(189);function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d="score",p="allParts",f=["lyricsSize","performanceTextSize","chordSymbolSize"],h=["titleSize","subtitleSize","supertitleSize","composerSize","titlePagePromptSize","copyrightSize","pageNumberSize"],m=[{property:"scoreLineSpacing",throttle:!0,step:.1,min:2,max:12},{property:"staffSpacing",throttle:!0,step:.25,min:0,max:25},{property:"systemSpacing",throttle:!0,step:.25,min:0,max:25},{property:"systemStretch",throttle:!0,step:.25,min:0,max:25},{property:"titlePageFirstStaffPadding",throttle:!0,step:.25,min:0,max:50},{property:"musicFont",throttle:!1,customMethod:"setMusicFont",checkPermission:"changeFont"},{property:"layoutSpacing",throttle:!0,step:1,min:-20,max:20},{property:"indentationSpacing",throttle:!0,step:1,min:0,max:16},{property:"verticalAutoSpace",throttle:!1},{property:"centerChordSymbols",throttle:!1},{property:"keepChordSymbolsApart",throttle:!1},{property:"showMultipleHyphens",throttle:!1},{property:"hyphensMinPadding",throttle:!0},{property:"showBarNumbers",throttle:!1},{property:"showBarNumbersOnEachMeasure",throttle:!1},{property:"autoMultiMeasureRestCreation",throttle:!1,permission:"enable_part_display"},{property:"partDisplayRespectSystemBreaks",throttle:!1},{property:"titleSize",throttle:!0,step:1,minInPixels:10,maxInPixels:75,fontSizeRef:"creditFontSize"},{property:"subtitleSize",throttle:!0,step:1,minInPixels:10,maxInPixels:50,fontSizeRef:"creditFontSize"},{property:"supertitleSize",throttle:!0,step:1,minInPixels:10,maxInPixels:50,fontSizeRef:"creditFontSize"},{property:"composerSize",throttle:!0,step:1,minInPixels:10,maxInPixels:25,fontSizeRef:"creditFontSize"},{property:"titlePagePromptSize",throttle:!0,step:1,minInPixels:10,maxInPixels:25,fontSizeRef:"creditFontSize"},{property:"copyrightSize",throttle:!0,step:1,minInPixels:5,maxInPixels:10,fontSizeRef:"creditFontSize"},{property:"pageNumberSize",throttle:!0,step:1,minInPixels:5,maxInPixels:25,fontSizeRef:"creditFontSize"},{property:"lyricsSize",throttle:!0,step:1,minInPixels:6,maxInPixels:25,fontSizeRef:"baseFontSize"},{property:"performanceTextSize",throttle:!0,step:1,minInPixels:6,maxInPixels:25,fontSizeRef:"baseFontSize"},{property:"chordSymbolSize",throttle:!0,step:1,minInPixels:6,maxInPixels:25,fontSizeRef:"baseFontSize"},{property:"showCopyrightOnAllPages",throttle:!1},{property:"textProportional",throttle:!1},{property:"showBarNumbers",throttle:!1},{property:"showBarNumbersOnEachMeasure",throttle:!1},{property:"showPartNames",throttle:!1},{property:"showTabRhythm",throttle:!1},{property:"partNamePosition",throttle:!1},{property:"showPartNamesOnEveryPage",throttle:!1}],g=[{property:"pageMarginLeft",throttle:!0,step:1,minInPixels:0,maxInPixels:100},{property:"pageMarginRight",throttle:!0,step:1,minInPixels:0,maxInPixels:100},{property:"pageMarginTop",throttle:!0,step:1,minInPixels:0,maxInPixels:100},{property:"pageMarginBottom",throttle:!0,step:1,minInPixels:0,maxInPixels:100}],b=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.score=t.controller.score,this.resource=r.resource,this.defaultPartNamePlaceholder="(".concat((0,r.resource)("editor/placeholder.partName"),")"),this.docLayoutPage=ko.observable("general"),this.selectedParts=ko.observableArray([]),this.toBeSelectedParts=ko.observableArray([]),this.selectionType=ko.observable(),this.changeFontEnabled=ko.observable(this.editor.controller.document.editable),this._initialView=null,this.showInstrumentsDropdown=ko.computed(function(){return(0,l.isPhoneLayoutOrSmaller)()}),this._initializingBindings=!1,this.showFormattingHint=ko.observable(),this.partsDropdown=ko.observableArray([{name:(0,r.resource)("content.fullScore"),value:d}]),this.score.parts.length>1&&(this.partsDropdown.push({name:(0,r.resource)("content.parts"),value:p}),this.score.parts.forEach(function(e){o.partsDropdown.push({name:e.name,value:e})})),this.selectedPartInDropdown=ko.observable(),this.selectedPartInDropdown.subscribe(function(e){(0,l.isPhoneLayoutOrSmaller)()&&o.handleSelectView(e)}),this._currentStaffMetrics=null,this._currentPageMetrics=null,this.orientation=ko.observable(),this.pageSize=ko.observable(),this.modelsToUse=ko.computed(function(){for(var e=[],t=0;t<o.selectedParts().length;t++)e.push(o.selectedParts()[t]);return 0===e.length?[o.score]:e}),ko.computed(function(){if(0===o.modelsToUse().length)return null;for(var e=o.modelsToUse()[0].staffMetrics?o.modelsToUse()[0].staffMetrics.clone():o.score.staffMetrics.clone(),t=o.modelsToUse()[0].pageMetrics?o.modelsToUse()[0].pageMetrics.clone():o.score.pageMetrics.clone(),r=function(r){var n=o.modelsToUse()[r],i=n.staffMetrics?n.staffMetrics:o.score.staffMetrics,a=n.pageMetrics?n.pageMetrics:o.score.pageMetrics;m.forEach(function(t){e[t.property]!=i[t.property]&&(e[t.property]=-1)}),g.forEach(function(e){t[e.property]!=a[e.property]&&(t[e.property]=-1)})},n=0;n<o.modelsToUse().length;n++)r(n);o._currentStaffMetrics=e,o._currentPageMetrics=t,o.initializeBindings()}),this.parts=ko.observableArray(),this.partShown=ko.observable(),this.partsThatCouldBeShown=ko.computed(function(){var e=[];if(o.selectionType()==p)for(var t=0;t<o.parts().length;t++)o.parts()[t]!=o.partShown()&&e.push(o.parts()[t]);return e}),this.handleSelectView=this.handleSelectView.bind(this),this.updateStaffMetricsValue=this.updateStaffMetricsValue.bind(this),this.updatePageMetricsValue=this.updatePageMetricsValue.bind(this),this.handleShowPart=this.handleShowPart.bind(this),this.handleMouseOverParts=this.handleMouseOverParts.bind(this),this.handleMouseOutParts=this.handleMouseOutParts.bind(this),this.handleResetDefaults=this.handleResetDefaults.bind(this),this.doResetDefaults=this.doResetDefaults.bind(this),this.initTippy=this.initTippy.bind(this),this.initializeBindings(),this.initializePanelWithCurrentView()}return function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(e,[{key:"initializeBindings",value:function(){var e=this;this._initializingBindings=!0;var t=$$nf.classes.com.noteflight.notation.metrics.PageMetrics;m.forEach(function(t){(0,c.createBinding)(e,t,e._currentStaffMetrics,e.updateStaffMetricsValue)}),g.forEach(function(t){(0,c.createBinding)(e,t,e._currentPageMetrics,e.updatePageMetricsValue)}),h.forEach(function(t){e.createPixelConversion(t,"creditFontSize"),e.createOutOfBounds(t)}),f.forEach(function(t){e.createPixelConversion(t,"baseFontSize"),e.createOutOfBounds(t)}),this.textProportionalSubscription=this.textProportional.subscribe(function(t){h.forEach(function(o){e.proportionConversion(t,o)})}),this.musicFonts=[{name:"default",title:"action.standardFont"},{name:"jazzAsh",title:"action.jazzFont"}],this.partNamePositions=[{name:"staff",title:"content.partNextToTheStaff"},{name:"topLeftOfThePage",title:"content.partOnTheTopLeftOfThePage"}],this.pageSizes=t.pageSizeNames,this.orientation(this.score.effectivePageMetrics.orientation||t.PORTRAIT),this.pageSize(this.score.effectivePageMetrics.name),this.pageSize.subscribe(function(){e.applyPageSetup()}),this.orientation.subscribe(function(){e.applyPageSetup()}),this._initializingBindings=!1}},{key:"initializePanelWithCurrentView",value:function(){this.parts(this.score.parts),1===this.score.numVisibleParts&&this.score.totalParts>1?(this.selectionType("part"),this.selectedParts(this.score.visibleParts),this.partShown(this.score.visibleParts[0]),this.selectedPartInDropdown(this.score.visibleParts[0])):(this.selectionType(d),this.selectedParts([this.score]),this.partShown(null),this.selectedPartInDropdown(this.score))}},{key:"saveCurrentView",value:function(){this._initialView=this.score.visibleParts}},{key:"applylastView",value:function(){this.editor.showPartsOnly(this._initialView)}},{key:"cloneMetrics",value:function(e){e.staffMetrics||(e.staffMetrics=this.score.staffMetrics.clone()),e.pageMetrics||(e.pageMetrics=this.score.pageMetrics.clone())}},{key:"updateStaffMetricsValue",value:function(e,t){this.updateValue(e,t,"staffMetrics"),this._currentStaffMetrics[e.property]=t}},{key:"getPageMetricsToUpdate",value:function(){for(var e=[],t=0;t<this.selectedParts().length;t++)this.selectedParts()[t].pageMetrics||this.cloneMetrics(this.selectedParts()[t]),e.push(this.selectedParts()[t].pageMetrics);return e}},{key:"updatePageMetricsValue",value:function(e,t){this.updateValue(e,t,"pageMetrics"),this._currentPageMetrics[e.property]=t}},{key:"updateValue",value:function(e,t,o){if(!this._initializingBindings)for(var r=0;r<this.selectedParts().length;r++)this.selectedParts()[r][o]||this.cloneMetrics(this.selectedParts()[r]),e.customMethod?this.selectedParts()[r][o][e.customMethod](t):this.selectedParts()[r][o][e.property]=t}},{key:"applyPageSetup",value:function(){if(!this._initializingBindings){var e=this.getPageMetricsToUpdate();this.editor.controller.document.undoHistory.openGroup("Change Page Setup");for(var t=0;t<e.length;t++)e[t].updatePageSize(this.pageSize(),this.orientation());this.editor.resizeToFit()}}},{key:"createPixelConversion",value:function(e,t){var o=this;this["".concat(e,"InPixels")]=ko.computed({read:function(){return o.scoreLineSpacing(),Math.round(o[e]()*o._currentStaffMetrics[t])},write:function(r){o[e](r/o._currentStaffMetrics[t])}}),this[e+"InPixelsToShow"]=ko.computed(function(){return-1==o[e]()?(0,r.resource)("content.multi"):"".concat(o["".concat(e,"InPixels")]()," px")})}},{key:"getBindingForProperty",value:function(e){return m.find(function(t){return t.property===e})}},{key:"createOutOfBounds",value:function(e){var t=this,o=this.getBindingForProperty(e);this[o.property+"TooSmall"]=ko.computed(function(){return t.scoreLineSpacing(),t[o.property+"InPixels"]()<o.minInPixels}),this[o.property+"TooBig"]=ko.computed(function(){return t.scoreLineSpacing(),t[o.property+"InPixels"]()>o.maxInPixels}),this[o.property+"OutOfBounds"]=ko.computed(function(){return-1!=t[o.property]()&&(t[o.property+"TooBig"]()||t[o.property+"TooSmall"]())})}},{key:"proportionConversion",value:function(e,t){this._currentStaffMetrics[t]=e?this[t]()/this.scoreLineSpacing():this[t]()*this.scoreLineSpacing()}},{key:"handleSelectView",value:function(e){if(e==d||i.NF.session.current_user()&&i.NF.session.current_user().has_premium_features()){var t=null;if(this.partShown(null),e==d)(0,l.isPhoneLayoutOrSmaller)()||this.editor.showAllParts(),t=[this.score],this.selectionType(d);else if(e==p)(0,l.isPhoneLayoutOrSmaller)()||this.editor.showPartsOnly([this.score.parts[0]]),this.partShown(this.score.parts[0]),t=this.score.parts,this.selectionType(p);else{var o=e;t=[e],this.toBeSelectedParts().length>0&&(o=this.toBeSelectedParts()[0],t=this.toBeSelectedParts()),(0,l.isPhoneLayoutOrSmaller)()||this.editor.showPartsOnly([o]),this.partShown(o),this.selectionType("part")}this.selectedParts(t)}else(0,a.default)((0,r.resource)("action.formatParts"),(0,r.resource)("content.formatIndividualParts"),"score_formatting")}},{key:"handleShowPart",value:function(e,t){t.stopPropagation(),this.editor.showPartsOnly([e]),this.partShown(e)}},{key:"handleMouseOverParts",value:function(e,t){this.toBeSelectedParts([]);var o=[];if(t.shiftKey&&"part"==this.selectionType()&&this.selectedParts().length>0){for(var r=this.selectedParts()[0],n=this.parts().indexOf(r),i=this.parts().indexOf(r)<this.parts().indexOf(e);this.parts()[n]!=e;)o.push(this.parts()[n]),n=i?n+1:n-1;o.push(e),this.toBeSelectedParts(o)}else if((t.ctrlKey||t.metaKey)&&"part"==this.selectionType()&&this.selectedParts().length>0){var a=(o=this.selectedParts()).indexOf(e);-1!=a?o.splice(a,1):o.push(e),this.toBeSelectedParts(o)}}},{key:"handleMouseOutParts",value:function(){this.toBeSelectedParts([])}},{key:"handleResetDefaults",value:function(){(0,n.okCancel)((0,r.resource)("content.resetDefaultsWarning"),this.doResetDefaults)}},{key:"doResetDefaults",value:function(){this.score.initializeStaffMetrics(),this.score.initializePageMetrics();for(var e=0;e<this.parts().length;e++)this.parts()[e].staffMetrics=null,this.parts()[e].pageMetrics=null;this.initializeBindings()}},{key:"changeLayout",value:function(e){this.docLayoutPage(e)}},{key:"changeFont",value:function(){return this.editor.scorePermissions.checkChangeFontPermissions()}},{key:"checkToggleAutoMultiRestsPermission",value:function(){return this.editor.scorePermissions.checkAutoMultiRestPermissions()}},{key:"checkToggleMultiRestsPermission",value:function(){return this.editor.scorePermissions.checkMultiRestPermissions()}},{key:"selectAllMeasureNumberInput",value:function(){$("#measureNumber").select()}},{key:"selectAllHyphenMinPaddingInput",value:function(){$("#hyphensMinPadding").select()}},{key:"initTippy",value:function(){this.showFormattingHint(this.score.totalParts>1&&(0,n.oneTimeMessage)("formattingScoreHint")),this.showFormattingHint()&&(0,s.initializeTippy)(s.leftCueHint,{show:!0,maxWidth:"300px"})}}]),e}();t.default=b},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculatePianoHeight=function(e,t){var o=0;e&&(o=t?s:a);return o},t.calculateRightPanelWidth=function(e,t,o,a,s){var l=0;s||(e?l=r:t||o?l=n:a&&(l=i));return l},t.calculateLowerPanelHeight=function(e,t){var o=0;e&&(o+=e);t&&(o+=l);return o},t.calculateScoreDetailsPanelBottomPosition=function(e){var t=0;e&&(t=l);return t},t.PRODUCT_EMBED_BOTTOM_CONTAINER_HEIGHT=t.SCORE_EDITOR_PIANO_KEYBOARD_HEIGHT_PHONE=t.SCORE_EDITOR_PIANO_KEYBOARD_HEIGHT=t.VERY_LARGE_SIDE_BAR_WIDTH=t.LARGE_SIDE_BAR_WIDTH=t.SMALL_SIDE_BAR_WIDTH=void 0;var r=300;t.SMALL_SIDE_BAR_WIDTH=r;var n=350;t.LARGE_SIDE_BAR_WIDTH=n;var i=560;t.VERY_LARGE_SIDE_BAR_WIDTH=i;var a=151;t.SCORE_EDITOR_PIANO_KEYBOARD_HEIGHT=a;var s=74;t.SCORE_EDITOR_PIANO_KEYBOARD_HEIGHT_PHONE=s;var l=64;t.PRODUCT_EMBED_BOTTOM_CONTAINER_HEIGHT=l},function(e,t,o){e.exports=o(7)(591)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o(565)),n=a(o(588)),i=a(o(295));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),e}var c=function(){function e(t,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.library=this.libraryByType(t),this.sessionInfo=this.formatEditSessionData(o,r),this.client=this.connect()}return l(e,null,[{key:"TYPES",get:function(){return{MQTT:"mqtt",SOCKET_IO:"socketIo"}}}]),l(e,[{key:"libraryByType",value:function(t){switch(t){case e.TYPES.MQTT:return n.default;case e.TYPES.SOCKET_IO:return r.default}}},{key:"composeLastWill",value:function(e,t,o){return JSON.stringify({eventType:"lastWill",participantId:e,sessionId:t,scoreId:o})}},{key:"formatEditSessionData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{scoreId:e.external_id,lastWillPayload:this.composeLastWill(e.participant_id,e.session_id,e.external_id),lastWillTopic:e.last_will_topic,writeTopic:e.write_topic,readTopic:e.read_topic,sessionId:e.session_id,participantId:e.participant_id,connectionUrl:t||e.sv4_iot_url,latestEditSortKey:e.latest_edit_sort_key,scoreVersion:e.score_version}}},{key:"connect",value:function(){var t,o=this.sessionInfo;switch(this.type){case e.TYPES.SOCKET_IO:(t=this.library.connect("https://localhost:1234")).on("connect",function(){t.emit("lastWillTopic",o.lastWillPayload)});break;case e.TYPES.MQTT:(t=this.library.connect(o.connectionUrl,{clientId:o.participantId,will:{topic:o.lastWillTopic,payload:o.lastWillPayload}})).on("connect",function(){t.subscribe(o.writeTopic),t.subscribe(o.readTopic)})}return t}},{key:"initializeReconnectListener",value:function(t){var o=this;if(this.type!=e.TYPES.SOCKET_IO){var r=function(e){var o=t.incrementalSaveManager;this.closeSession(this.client),this.sessionInfo=this.formatEditSessionData(e),this.client=this.connect(),this.initializeReconnectListener(t),o.validateEdits(e.score_edits)?o.initializePubSub(this.client,this.sessionInfo):self.allowCopying()&&i.default.offerSaveAside(o.lastWriteAt,{accept:function(){new i.default(t).save()},reject:function(){location.reload(!0)}})}.bind(this);this.client.on("reconnect",function(){NF.apiService.iotReconnect("",r,{score_id:o.sessionInfo.scoreId,score_version:o.sessionInfo.scoreVersion,latest_edit_sort_key:o.sessionInfo.latestEditSortKey})})}}},{key:"closeSession",value:function(t){switch(this.type){case e.TYPES.MQTT:t.end();break;case e.TYPES.SOCKET_IO:t.close()}}}]),e}();t.default=c},function(e,t,o){var r=o(566),n=o(210),i=o(286),a=o(129)("socket.io-client");e.exports=t=l;var s=t.managers={};function l(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,n=r(e),l=n.source,c=n.id,u=n.path,d=s[c]&&u in s[c].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||d?(a("ignoring socket cache for %s",l),o=i(l,t)):(s[c]||(a("new io instance for %s",l),s[c]=i(l,t)),o=s[c]),n.query&&!t.query&&(t.query=n.query),o.socket(n.path,t)}t.protocol=n.protocol,t.connect=l,t.Manager=o(286),t.Socket=o(292)},function(e,t,o){(function(t){var r=o(283),n=o(129)("socket.io-client:url");e.exports=function(e,o){var i=e;o=o||t.location,null==e&&(e=o.protocol+"//"+o.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?o.protocol+e:o.host+e),/^(https?|wss?):\/\//.test(e)||(n("protocol-less url %s",e),e=void 0!==o?o.protocol+"//"+e:"https://"+e),n("parse %s",e),i=r(e));i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443"));i.path=i.path||"/";var a=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port,i.href=i.protocol+"://"+a+(o&&o.port===i.port?"":":"+i.port),i}}).call(this,o(37))},function(e,t,o){function r(e){var o;function r(){if(r.enabled){var e=r,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(o,r){if("%%"===o)return o;l++;var n=t.formatters[r];if("function"==typeof n){var i=a[l];o=n.call(e,i),a.splice(l,1),l--}return o}),t.formatArgs.call(e,a),(r.log||t.log||console.log.bind(console)).apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var o,r=0;for(o in e)r=(r<<5)-r+e.charCodeAt(o),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=n,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function n(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var o;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(o=0;o<n;o++)r[o]&&("-"===(e=r[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(o=0;o<t.instances.length;o++){var i=t.instances[o];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var o,r;for(o=0,r=t.skips.length;o<r;o++)if(t.skips[o].test(e))return!1;for(o=0,r=t.names.length;o<r;o++)if(t.names[o].test(e))return!0;return!1},t.humanize=o(209),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,o){(function(r){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=Object({NODE_ENV:"production"}).DEBUG),e}(t=e.exports=o(569)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+t.humanize(this.diff),!o)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++n)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}).call(this,o(208))},function(e,t,o){function r(e){var o;function r(){if(r.enabled){var e=r,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(o,r){if("%%"===o)return o;l++;var n=t.formatters[r];if("function"==typeof n){var i=a[l];o=n.call(e,i),a.splice(l,1),l--}return o}),t.formatArgs.call(e,a),(r.log||t.log||console.log.bind(console)).apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var o,r=0;for(o in e)r=(r<<5)-r+e.charCodeAt(o),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=n,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function n(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var o;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(o=0;o<n;o++)r[o]&&("-"===(e=r[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(o=0;o<t.instances.length;o++){var i=t.instances[o];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var o,r;for(o=0,r=t.skips.length;o<r;o++)if(t.skips[o].test(e))return!1;for(o=0,r=t.names.length;o<r;o++)if(t.names[o].test(e))return!0;return!1},t.humanize=o(209),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,o){(function(e){var r=o(284),n=o(285),i=Object.prototype.toString,a="function"==typeof e.Blob||"[object BlobConstructor]"===i.call(e.Blob),s="function"==typeof e.File||"[object FileConstructor]"===i.call(e.File);t.deconstructPacket=function(e){var t=[],o=e.data,i=e;return i.data=function e(t,o){if(!t)return t;if(n(t)){var i={_placeholder:!0,num:o.length};return o.push(t),i}if(r(t)){for(var a=new Array(t.length),s=0;s<t.length;s++)a[s]=e(t[s],o);return a}if("object"==typeof t&&!(t instanceof Date)){var a={};for(var l in t)a[l]=e(t[l],o);return a}return t}(o,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,o){if(!t)return t;if(t&&t._placeholder)return o[t.num];if(r(t))for(var n=0;n<t.length;n++)t[n]=e(t[n],o);else if("object"==typeof t)for(var i in t)t[i]=e(t[i],o);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var o=0,i=e;!function e(l,c,u){if(!l)return l;if(a&&l instanceof Blob||s&&l instanceof File){o++;var d=new FileReader;d.onload=function(){u?u[c]=this.result:i=this.result,--o||t(i)},d.readAsArrayBuffer(l)}else if(r(l))for(var p=0;p<l.length;p++)e(l[p],p,l);else if("object"==typeof l&&!n(l))for(var f in l)e(l[f],f,l)}(i),o||t(i)}}).call(this,o(37))},function(e,t,o){e.exports=o(572),e.exports.parser=o(79)},function(e,t,o){(function(t){var r=o(287),n=o(78),i=o(132)("engine.io-client:socket"),a=o(291),s=o(79),l=o(283),c=o(130);function u(e,o){if(!(this instanceof u))return new u(e,o);o=o||{},e&&"object"==typeof e&&(o=e,e=null),e?(e=l(e),o.hostname=e.host,o.secure="https"===e.protocol||"wss"===e.protocol,o.port=e.port,e.query&&(o.query=e.query)):o.host&&(o.hostname=l(o.host).host),this.secure=null!=o.secure?o.secure:t.location&&"https:"===location.protocol,o.hostname&&!o.port&&(o.port=this.secure?"443":"80"),this.agent=o.agent||!1,this.hostname=o.hostname||(t.location?location.hostname:"localhost"),this.port=o.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=o.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==o.upgrade,this.path=(o.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!o.forceJSONP,this.jsonp=!1!==o.jsonp,this.forceBase64=!!o.forceBase64,this.enablesXDR=!!o.enablesXDR,this.timestampParam=o.timestampParam||"t",this.timestampRequests=o.timestampRequests,this.transports=o.transports||["polling","websocket"],this.transportOptions=o.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=o.policyPort||843,this.rememberUpgrade=o.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=o.onlyBinaryUpgrades,this.perMessageDeflate=!1!==o.perMessageDeflate&&(o.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=o.pfx||null,this.key=o.key||null,this.passphrase=o.passphrase||null,this.cert=o.cert||null,this.ca=o.ca||null,this.ciphers=o.ciphers||null,this.rejectUnauthorized=void 0===o.rejectUnauthorized||o.rejectUnauthorized,this.forceNode=!!o.forceNode;var r="object"==typeof t&&t;r.global===r&&(o.extraHeaders&&Object.keys(o.extraHeaders).length>0&&(this.extraHeaders=o.extraHeaders),o.localAddress&&(this.localAddress=o.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=u,u.priorWebsocketSuccess=!1,n(u.prototype),u.protocol=s.protocol,u.Socket=u,u.Transport=o(212),u.transports=o(287),u.parser=o(79),u.prototype.createTransport=function(e){i('creating transport "%s"',e);var t=function(e){var t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}(this.query);t.EIO=s.protocol,t.transport=e;var o=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new r[e]({query:t,socket:this,agent:o.agent||this.agent,hostname:o.hostname||this.hostname,port:o.port||this.port,secure:o.secure||this.secure,path:o.path||this.path,forceJSONP:o.forceJSONP||this.forceJSONP,jsonp:o.jsonp||this.jsonp,forceBase64:o.forceBase64||this.forceBase64,enablesXDR:o.enablesXDR||this.enablesXDR,timestampRequests:o.timestampRequests||this.timestampRequests,timestampParam:o.timestampParam||this.timestampParam,policyPort:o.policyPort||this.policyPort,pfx:o.pfx||this.pfx,key:o.key||this.key,passphrase:o.passphrase||this.passphrase,cert:o.cert||this.cert,ca:o.ca||this.ca,ciphers:o.ciphers||this.ciphers,rejectUnauthorized:o.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:o.perMessageDeflate||this.perMessageDeflate,extraHeaders:o.extraHeaders||this.extraHeaders,forceNode:o.forceNode||this.forceNode,localAddress:o.localAddress||this.localAddress,requestTimeout:o.requestTimeout||this.requestTimeout,protocols:o.protocols||void 0})},u.prototype.open=function(){var e;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},u.prototype.setTransport=function(e){i("setting transport %s",e.name);var t=this;this.transport&&(i("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},u.prototype.probe=function(e){i('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),o=!1,r=this;function n(){if(r.onlyBinaryUpgrades){var n=!this.supportsBinary&&r.transport.supportsBinary;o=o||n}o||(i('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(n){if(!o)if("pong"===n.type&&"probe"===n.data){if(i('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;u.priorWebsocketSuccess="websocket"===t.name,i('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){o||"closed"!==r.readyState&&(i("changing transport and sending upgrade packet"),p(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{i('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,r.emit("upgradeError",a)}}))}function a(){o||(o=!0,p(),t.close(),t=null)}function s(o){var n=new Error("probe error: "+o);n.transport=t.name,a(),i('probe transport "%s" failed because of error: %s',e,o),r.emit("upgradeError",n)}function l(){s("transport closed")}function c(){s("socket closed")}function d(e){t&&e.name!==t.name&&(i('"%s" works - aborting "%s"',e.name,t.name),a())}function p(){t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",l),r.removeListener("close",c),r.removeListener("upgrading",d)}u.priorWebsocketSuccess=!1,t.once("open",n),t.once("error",s),t.once("close",l),this.once("close",c),this.once("upgrading",d),t.open()},u.prototype.onOpen=function(){if(i("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){i("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},u.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(i('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else i('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},u.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){i("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},u.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(i("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(e,t,o){return this.sendPacket("message",e,t,o),this},u.prototype.sendPacket=function(e,t,o,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof o&&(r=o,o=null),"closing"!==this.readyState&&"closed"!==this.readyState){(o=o||{}).compress=!1!==o.compress;var n={type:e,data:t,options:o};this.emit("packetCreate",n),this.writeBuffer.push(n),r&&this.once("flush",r),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),i("socket closing - telling transport to close"),e.transport.close()}function o(){e.removeListener("upgrade",o),e.removeListener("upgradeError",o),t()}function r(){e.once("upgrade",o),e.once("upgradeError",o)}return this},u.prototype.onError=function(e){i("socket error %j",e),u.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},u.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){i('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},u.prototype.filterUpgrades=function(e){for(var t=[],o=0,r=e.length;o<r;o++)~a(this.transports,e[o])&&t.push(e[o]);return t}}).call(this,o(37))},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,o){(function(t){var r=o(211),n=o(288),i=o(78),a=o(131),s=o(132)("engine.io-client:polling-xhr");function l(){}function c(e){if(n.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var o="https:"===location.protocol,r=location.port;r||(r=o?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==o}}function u(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function d(){for(var e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}e.exports=c,e.exports.Request=u,a(c,n),c.prototype.supportsBinary=!0,c.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new u(e)},c.prototype.doWrite=function(e,t){var o="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:o}),n=this;r.on("success",t),r.on("error",function(e){n.onError("xhr post error",e)}),this.sendXhr=r},c.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},i(u.prototype),u.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var o=this.xhr=new r(e),n=this;try{s("xhr open %s: %s",this.method,this.uri),o.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&o.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?o.setRequestHeader("Content-type","application/octet-stream"):o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{o.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in o&&(o.withCredentials=!0),this.requestTimeout&&(o.timeout=this.requestTimeout),this.hasXDR()?(o.onload=function(){n.onLoad()},o.onerror=function(){n.onError(o.responseText)}):o.onreadystatechange=function(){if(2===o.readyState)try{var e=o.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(o.responseType="arraybuffer")}catch(e){}4===o.readyState&&(200===o.status||1223===o.status?n.onLoad():setTimeout(function(){n.onError(o.status)},0))},s("xhr data %s",this.data),o.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}t.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},u.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},u.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=l:this.xhr.onreadystatechange=l,e)try{this.xhr.abort()}catch(e){}t.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},u.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",d):t.addEventListener&&t.addEventListener("beforeunload",d,!1))}).call(this,o(37))},function(e,t){e.exports=Object.keys||function(e){var t=[],o=Object.prototype.hasOwnProperty;for(var r in e)o.call(e,r)&&t.push(r);return t}},function(e,t){var o={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==o.call(e)}},function(e,t){e.exports=function(e,t,o){var r=e.byteLength;if(t=t||0,o=o||r,e.slice)return e.slice(t,o);if(t<0&&(t+=r),o<0&&(o+=r),o>r&&(o=r),t>=r||t>=o||0===r)return new ArrayBuffer(0);for(var n=new Uint8Array(e),i=new Uint8Array(o-t),a=t,s=0;a<o;a++,s++)i[s]=n[a];return i.buffer}},function(e,t){function o(){}e.exports=function(e,t,r){var n=!1;return r=r||o,i.count=e,0===e?t():i;function i(e,o){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(n=!0,t(e),t=r):0!==i.count||n||t(null,o)}}},function(e,t,o){(function(e,r){var n;!function(i){var a=t,s=(e&&e.exports,"object"==typeof r&&r);s.global!==s&&s.window;var l,c,u,d=String.fromCharCode;function p(e){for(var t,o,r=[],n=0,i=e.length;n<i;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<i?56320==(64512&(o=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&o)+65536):(r.push(t),n--):r.push(t);return r}function f(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function h(e,t){return d(e>>t&63|128)}function m(e,t){if(0==(4294967168&e))return d(e);var o="";return 0==(4294965248&e)?o=d(e>>6&31|192):0==(4294901760&e)?(f(e,t)||(e=65533),o=d(e>>12&15|224),o+=h(e,6)):0==(4292870144&e)&&(o=d(e>>18&7|240),o+=h(e,12),o+=h(e,6)),o+=d(63&e|128)}function g(){if(u>=c)throw Error("Invalid byte index");var e=255&l[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function b(e){var t,o;if(u>c)throw Error("Invalid byte index");if(u==c)return!1;if(t=255&l[u],u++,0==(128&t))return t;if(192==(224&t)){if((o=(31&t)<<6|g())>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&t)){if((o=(15&t)<<12|g()<<6|g())>=2048)return f(o,e)?o:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(o=(7&t)<<18|g()<<12|g()<<6|g())>=65536&&o<=1114111)return o;throw Error("Invalid UTF-8 detected")}var v={version:"2.1.2",encode:function(e,t){for(var o=!1!==(t=t||{}).strict,r=p(e),n=r.length,i=-1,a="";++i<n;)a+=m(r[i],o);return a},decode:function(e,t){var o=!1!==(t=t||{}).strict;l=p(e),c=l.length,u=0;for(var r,n=[];!1!==(r=b(o));)n.push(r);return function(e){for(var t,o=e.length,r=-1,n="";++r<o;)(t=e[r])>65535&&(n+=d((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=d(t);return n}(n)}};void 0===(n=function(){return v}.call(t,o,t,e))||(e.exports=n)}()}).call(this,o(133)(e),o(37))},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(256),r=0;r<e.length;r++)o[e.charCodeAt(r)]=r;t.encode=function(t){var o,r=new Uint8Array(t),n=r.length,i="";for(o=0;o<n;o+=3)i+=e[r[o]>>2],i+=e[(3&r[o])<<4|r[o+1]>>4],i+=e[(15&r[o+1])<<2|r[o+2]>>6],i+=e[63&r[o+2]];return n%3==2?i=i.substring(0,i.length-1)+"=":n%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,n,i,a,s=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),d=new Uint8Array(u);for(t=0;t<l;t+=4)r=o[e.charCodeAt(t)],n=o[e.charCodeAt(t+1)],i=o[e.charCodeAt(t+2)],a=o[e.charCodeAt(t+3)],d[c++]=r<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&a;return u}}()},function(e,t,o){(function(t){var o=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),n=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=o&&o.prototype.append&&o.prototype.getBlob;function a(e){for(var t=0;t<e.length;t++){var o=e[t];if(o.buffer instanceof ArrayBuffer){var r=o.buffer;if(o.byteLength!==r.byteLength){var n=new Uint8Array(o.byteLength);n.set(new Uint8Array(r,o.byteOffset,o.byteLength)),r=n.buffer}e[t]=r}}}function s(e,t){t=t||{};var r=new o;a(e);for(var n=0;n<e.length;n++)r.append(e[n]);return t.type?r.getBlob(t.type):r.getBlob()}function l(e,t){return a(e),new Blob(e,t||{})}e.exports=r?n?t.Blob:l:i?s:void 0}).call(this,o(37))},function(e,t,o){function r(e){var o;function r(){if(r.enabled){var e=r,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(o,r){if("%%"===o)return o;l++;var n=t.formatters[r];if("function"==typeof n){var i=a[l];o=n.call(e,i),a.splice(l,1),l--}return o}),t.formatArgs.call(e,a),(r.log||t.log||console.log.bind(console)).apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var o,r=0;for(o in e)r=(r<<5)-r+e.charCodeAt(o),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=n,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function n(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var o;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(o=0;o<n;o++)r[o]&&("-"===(e=r[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(o=0;o<t.instances.length;o++){var i=t.instances[o];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var o,r;for(o=0,r=t.skips.length;o<r;o++)if(t.skips[o].test(e))return!1;for(o=0,r=t.names.length;o<r;o++)if(t.names[o].test(e))return!0;return!1},t.humanize=o(209),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,o){(function(t){var r=o(288),n=o(131);e.exports=c;var i,a=/\n/g,s=/\\n/g;function l(){}function c(e){r.call(this,e),this.query=this.query||{},i||(t.___eio||(t.___eio=[]),i=t.___eio),this.index=i.length;var o=this;i.push(function(e){o.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){o.script&&(o.script.onerror=l)},!1)}n(c,r),c.prototype.supportsBinary=!1,c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},c.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var o=document.getElementsByTagName("script")[0];o?o.parentNode.insertBefore(t,o):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},c.prototype.doWrite=function(e,t){var o=this;if(!this.form){var r,n=document.createElement("form"),i=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=l,n.method="POST",n.setAttribute("accept-charset","utf-8"),i.name="d",n.appendChild(i),document.body.appendChild(n),this.form=n,this.area=i}function c(){u(),t()}function u(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=o.iframeId,r.src="javascript:0"}r.id=o.iframeId,o.form.appendChild(r),o.iframe=r}this.form.action=this.uri(),u(),e=e.replace(s,"\\\n"),this.area.value=e.replace(a,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,o(37))},function(e,t,o){(function(t){var r,n=o(212),i=o(79),a=o(130),s=o(131),l=o(290),c=o(132)("engine.io-client:websocket"),u=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{r=o(585)}catch(e){}var d=u;function p(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=u&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(d=r),n.call(this,e)}d||"undefined"!=typeof window||(d=r),e.exports=p,s(p,n),p.prototype.name="websocket",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,o={agent:this.agent,perMessageDeflate:this.perMessageDeflate};o.pfx=this.pfx,o.key=this.key,o.passphrase=this.passphrase,o.cert=this.cert,o.ca=this.ca,o.ciphers=this.ciphers,o.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(o.headers=this.extraHeaders),this.localAddress&&(o.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new d(e,t):new d(e):new d(e,t,o)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},p.prototype.write=function(e){var o=this;this.writable=!1;for(var r=e.length,n=0,a=r;n<a;n++)!function(e){i.encodePacket(e,o.supportsBinary,function(n){if(!o.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),o.perMessageDeflate)("string"==typeof n?t.Buffer.byteLength(n):n.length)<o.perMessageDeflate.threshold&&(i.compress=!1)}try{o.usingBrowserWebSocket?o.ws.send(n):o.ws.send(n,i)}catch(e){c("websocket closed before onclose event")}--r||s()})}(e[n]);function s(){o.emit("flush"),setTimeout(function(){o.writable=!0,o.emit("drain")},0)}},p.prototype.onClose=function(){n.prototype.onClose.call(this)},p.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",o="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(o=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=l()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+o+this.path+e},p.prototype.check=function(){return!(!d||"__initialize"in d&&this.name===p.prototype.name)}}).call(this,o(37))},function(e,t){},function(e,t){e.exports=function(e,t){for(var o=[],r=(t=t||0)||0;r<e.length;r++)o[r-t]=e[r];return o}},function(e,t){function o(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=o,o.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),o=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-o:e+o}return 0|Math.min(e,this.max)},o.prototype.reset=function(){this.attempts=0},o.prototype.setMin=function(e){this.ms=e},o.prototype.setMax=function(e){this.max=e},o.prototype.setJitter=function(e){this.jitter=e}},function(e,t,o){e.exports=o(7)(622)},function(e,t,o){(function(t,o){e.exports=function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){(function(t){"use strict";var r=o(4),n=o(8),i=o(3),a=o(9),s=o(2).Promise,l=o(16),c=o(17);e.exports=t.SC={initialize:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i.set("oauth_token",e.oauth_token),i.set("client_id",e.client_id),i.set("redirect_uri",e.redirect_uri),i.set("baseURL",e.baseURL),i.set("connectURL",e.connectURL)},get:function(e,t){return r.request("GET",e,t)},post:function(e,t){return r.request("POST",e,t)},put:function(e,t){return r.request("PUT",e,t)},delete:function(e){return r.request("DELETE",e)},upload:function(e){return r.upload(e)},connect:function(e){return a(e)},isConnected:function(){return void 0!==i.get("oauth_token")},oEmbed:function(e,t){return r.oEmbed(e,t)},resolve:function(e){return r.resolve(e)},Recorder:l,Promise:s,stream:function(e,t){return c(e,t)},connectCallback:function(){n.notifyDialog(this.location)}}}).call(t,function(){return this}())},function(e,t){e.exports=function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports={SCAudio:o(1),SCAudioPublicApiStreamURLRetriever:o(9),MaestroCore:o(2),MaestroLoaders:o(8),MaestroHTML5Player:o(7),MaestroHLSMSEPlayer:o(3)}},function(e,t,o){e.exports=function(e,t,o,r,n,i){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=95)}([function(t,o){t.exports=e},function(e,t,o){"use strict";var r=o(4);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,o){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,o){"use strict";e.exports=o(64)()?Symbol:o(66)},function(e,t,o){"use strict";var r=o(17)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,o){"use strict";var r=o(9),n=o(19),i=o(50),a=o(22);(e.exports=function(e,t){var o,i,s,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(o=s=!0,i=!1):(o=a.call(e,"c"),i=a.call(e,"e"),s=a.call(e,"w")),c={value:t,configurable:o,enumerable:i,writable:s},l?r(n(l),c):c}).gs=function(e,t,o){var s,l,c,u;return"string"!=typeof e?(c=o,o=t,t=e,e=null):c=arguments[3],null==t?t=void 0:i(t)?null==o?o=void 0:i(o)||(c=o,o=void 0):(c=t,t=o=void 0),null==e?(s=!0,l=!1):(s=a.call(e,"c"),l=a.call(e,"e")),u={get:t,set:o,configurable:s,enumerable:l},c?r(n(c),u):u}},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t,o){void 0===o&&(o="API error.");var r=e.call(this,o)||this;return r.statusCode=t,r}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.API_ERROR."+(this.statusCode||"TIMEOUT")},t.prototype.getStatusCode=function(){return this.statusCode},t}(n.errors.PlayerFatalError);t.ApiError=i},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call(function(){return arguments}());e.exports=function(e){return r.call(e)===n}},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===n)||!1}},function(e,t,o){"use strict";e.exports=o(45)()?Object.assign:o(46)},function(e,t,o){"use strict";e.exports=o(20)()?Object.setPrototypeOf:o(21)},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t){return e.call(this,t||"There was no format available that a player was able to play.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.NOT_SUPPORTED_ERROR"},t}(n.errors.PlayerFatalError);t.NotSupportedError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildFadeIn=function(e){return new r({startPos:0,endPos:e,startLevel:0,endLevel:1,fromEnd:!1})},t.buildFadeOut=function(e){return new r({startPos:e,endPos:0,startLevel:1,endLevel:0,fromEnd:!0})};var r=function(){function e(e){var t=e.startPos,o=e.endPos,r=e.startLevel,n=e.endLevel,i=e.fromEnd,a=void 0!==i&&i;if(t<0)throw new Error("startPos invalid.");if(o<0||!a&&o<t||a&&t<o)throw new Error("endPos invalid.");if(r<0||r>1)throw new Error("startLevel invalid.");if(n<0||n>1)throw new Error("endLevel invalid.");this._startPos=t,this._endPos=o,this._startLevel=r,this._endLevel=n,this._fromEnd=a}return e.prototype.calculate=function(e,t){var o=this._fromEnd?t-500-this._startPos:this._startPos,r=this._fromEnd?t-500-this._endPos:this._endPos;if(e<o)return{level:this._startLevel,nextCalculatePosition:o-e};if(e<=r){var n=(e-o)/(r-o),i=Math.cos(n*Math.PI)/-2+.5,a=this._startLevel+(this._endLevel-this._startLevel)*i;return{level:a,nextCalculatePosition:e}}return{level:this._endLevel,nextCalculatePosition:1/0}},e}();t.Fade=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.BaseStreamUrlRetriever=r},function(e,t,o){"use strict";function r(e,t,o){return Math.min(t,Math.max(e,o))}var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),a=o(12),s=i.eventDispatcher.EventDispatcher,l=i.helpers.Promise,c=i.helpers.deferred.buildDeferred,u=function(e){function t(t,o){var r=e.call(this,t)||this;return r._onPreloadingEnabled=new s,r._onPreloadingDisabled=new s,r._onConnectionRequired=new s,r._onConnectionRecovered=new s,r._volumeAutomators=[],r._volumeScale=1,r._userVolume=1,r._volumeAutomationSupported=!1,r._timer=null,r._pauseFadeTimer=null,r._pauseFadeDeferred=null,r._pauseFade=null,r._connectionRequired=!1,r._connectionLossTimer=null,r.onPreloadingEnabled=r._onPreloadingEnabled.getHandle(),r.onPreloadingDisabled=r._onPreloadingDisabled.getHandle(),r.onConnectionRequired=r._onConnectionRequired.getHandle(),r.onConnectionRecovered=r._onConnectionRecovered.getHandle(),r._reloadStreamUrls=o,r._pausedMaxBufferLength=t.pausedMaxBufferLength,r._playingMaxBufferLength=t.playingMaxBufferLength,r._preloadingEnabled=t.preloadingEnabled,r.onPlayerProvided.subscribe(function(){return r._updateMaxBufferLength()}),r.onChange.subscribe(function(e){r.isDead()||((!1===e.playing||e.positionJumped||e.stalled||e.ended)&&r._completePauseFade(),r._pauseFade&&(!1===e.actuallyPlaying||e.ended)&&(r.removeVolumeAutomator(r._pauseFade),r._pauseFade=null),(e.positionJumped||void 0!==e.actuallyPlaying||void 0!==e.stalled)&&r._updateVolume(),void 0!==e.playing&&r._updateMaxBufferLength(),void 0!==e.loading&&r._calculateIfConnectionRequired())}),window.addEventListener("online",function(){return r._calculateIfConnectionRequired()}),window.addEventListener("offline",function(){return r._calculateIfConnectionRequired()}),r._calculateIfConnectionRequired(),r}return n(t,e),t.prototype.reload=function(){this._ensureNotDead(),this._reloadStreamUrls()},t.prototype.enablePreloading=function(){this.isDead()||this._preloadingEnabled||(this._preloadingEnabled=!0,this._updateMaxBufferLength(),this._onPreloadingEnabled.dispatch(void 0))},t.prototype.disablePreloading=function(){this.isDead()||this._preloadingEnabled&&(this._preloadingEnabled=!1,this._updateMaxBufferLength(),this._onPreloadingDisabled.dispatch(void 0))},t.prototype.isPreloadingEnabled=function(){return this._preloadingEnabled},t.prototype.pauseAfterFade=function(e){var t=this;if(this._ensureNotDead(),this._pauseFadeDeferred)return this._pauseFadeDeferred.promise;if(!this.isPlaying()||!this.isActuallyPlaying())return l.resolve(this.pause());var o=c();this._pauseFadeDeferred=o;var r=this.getPosition();if(this._pauseFade)throw new Error("Fade should not already be assigned.");return this._pauseFade=new a.Fade({startPos:r,endPos:r+e,startLevel:1,endLevel:0}),this.addVolumeAutomator(this._pauseFade),this._pauseFadeTimer=window.setTimeout(function(){t._pauseFadeDeferred=null,o.resolve(t.pause())},e+50),o.promise},t.prototype.isConnectionRequired=function(){return this._connectionRequired},t.prototype.getVolume=function(){return this._volumeAutomationSupported?this._userVolume:e.prototype.getVolume.call(this)},t.prototype.addVolumeAutomator=function(e){var t=this._volumeAutomators.indexOf(e);t<0&&(this._volumeAutomators.push(e),this._updateVolume())},t.prototype.removeVolumeAutomator=function(e){var t=this._volumeAutomators.indexOf(e);t>=0&&(this._volumeAutomators.splice(t,1),this._updateVolume())},t.prototype._triggerError=function(t){e.prototype._triggerError.call(this,t)},t.prototype.providePlayer=function(t,o,r){void 0===r&&(r=!0),this._volumeAutomationSupported=r,e.prototype.providePlayer.call(this,t,o)},t.prototype._setVolume=function(e){this._userVolume=e,this._calculateAndSetVolume()},t.prototype._kill=function(){this._timer&&window.clearTimeout(this._timer),null!==this._connectionLossTimer&&window.clearTimeout(this._connectionLossTimer),this._abortPauseFade(),e.prototype._kill.call(this)},t.prototype._calculateIfConnectionRequired=function(){var e=this,t=this.isLoading()&&"navigator"in window&&!window.navigator.onLine;t?null===this._connectionLossTimer&&(this._connectionLossTimer=window.setTimeout(function(){e._connectionLossTimer=null,e._connectionRequired=!0,e._onConnectionRequired.dispatch(void 0)},1500)):this._connectionRequired?(this._connectionRequired=!1,this._onConnectionRecovered.dispatch(void 0)):null!==this._connectionLossTimer&&(window.clearTimeout(this._connectionLossTimer),this._connectionLossTimer=null)},t.prototype._completePauseFade=function(){if(this._pauseFadeDeferred){this._pauseFadeTimer&&window.clearTimeout(this._pauseFadeTimer);var e=this._pauseFadeDeferred;this._pauseFadeDeferred=null,e.resolve(this.pause())}},t.prototype._abortPauseFade=function(){this._pauseFadeTimer&&(window.clearTimeout(this._pauseFadeTimer),this._pauseFadeTimer=null),this._pauseFadeDeferred&&(this._pauseFadeDeferred.reject(new Error("Player was killed.")),this._pauseFadeDeferred=null)},t.prototype._updateVolume=function(){var e=this;if(this._volumeAutomationSupported){this._ensureNotDead(),this._timer&&(window.clearTimeout(this._timer),this._timer=null);var t=this.getDuration();if(null!==t){var o=this._volumeAutomators,n=this.getPosition(),i=1/0,a=1;o.forEach(function(e){var o=e.calculate(n,t),s=o.nextCalculatePosition,l=o.level;a*=r(0,1,l),s<i&&(i=s)}),this._volumeScale!==a&&(this._volumeScale=a,this._calculateAndSetVolume()),i<1/0&&this.isActuallyPlaying()&&!this.isStalled()&&(this._timer=window.setTimeout(function(){e._timer=null,e._updateVolume()},r(100,5e3,i-this.getPosition())))}}},t.prototype._calculateAndSetVolume=function(){this._volumeAutomationSupported?e.prototype._setVolume.call(this,this._userVolume*this._volumeScale):e.prototype._setVolume.call(this,this._userVolume)},t.prototype._updateMaxBufferLength=function(){var e=this.getPlayer(),t=e&&e.getBufferController();t&&(this.isPlaying()?t.setMaxBufferLength(this._playingMaxBufferLength):t.setMaxBufferLength(this._preloadingEnabled?this._pausedMaxBufferLength:0))},t}(i.ProxyPlayer);t.Player=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(88);t.renditions=r.renditions},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.statusCode=e}return e.prototype.getStatusCode=function(){return this.statusCode},e}();t.RequestError=r},function(e,t,o){"use strict";e.exports=function(){}},function(e,t,o){"use strict";var r=o(4),n={function:!0,object:!0};e.exports=function(e){return r(e)&&n[typeof e]||!1}},function(e,t,o){"use strict";var r=o(4),n=Array.prototype.forEach,i=Object.create;e.exports=function(e){var t=i(null);return n.call(arguments,function(e){r(e)&&function(e,t){var o;for(o in e)t[o]=e[o]}(Object(e),t)}),t}},function(e,t,o){"use strict";var r=Object.create,n=Object.getPrototypeOf,i={};e.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&n(e(t(null),i))===i}},function(e,t,o){"use strict";var r,n=o(18),i=o(1),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(i(e),null===t||n(t))return e;throw new TypeError("Prototype must be null or an object")},e.exports=function(e){var t,o;return e?(2===e.level?e.set?(o=e.set,t=function(e,t){return o.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,o){var n;return r(t,o),(n=a.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===o&&(o=e.nullPolyfill),t.__proto__=o,n&&s(e.nullPolyfill,"__proto__",l),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),o={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{(e=r.set).call(t,o)}catch(e){}if(Object.getPrototypeOf(t)===o)return{set:e,level:2}}return t.__proto__=o,Object.getPrototypeOf(t)===o?{level:2}:((t={}).__proto__=o,Object.getPrototypeOf(t)===o&&{level:1})}()),o(48)},function(e,t,o){"use strict";e.exports=o(56)()?String.prototype.contains:o(57)},function(e,t,o){"use strict";var r=o(7),n=o(8),i=o(59),a=o(62),s=o(63),l=o(3).iterator;e.exports=function(e){return"function"==typeof s(e)[l]?e[l]():r(e)?new i(e):n(e)?new a(e):new i(e)}},function(e,t,o){"use strict";var r,n=o(34),i=o(9),a=o(2),s=o(1),l=o(5),c=o(33),u=o(3),d=Object.defineProperty,p=Object.defineProperties;e.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");p(this,{__list__:l("w",s(e)),__context__:l("w",t),__nextIndex__:l("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,p(r.prototype,i({_next:l(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:l(function(e){return this.__list__[e]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},c({_onAdd:l(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void d(this,"__redo__",l("c",[e]));this.__redo__.forEach(function(t,o){t>=e&&(this.__redo__[o]=++t)},this),this.__redo__.push(e)}}),_onDelete:l(function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,o){t>e&&(this.__redo__[o]=--t)},this)))}),_onClear:l(function(){this.__redo__&&n.call(this.__redo__),this.__nextIndex__=0})}))),d(r.prototype,u.iterator,l(function(){return this}))},function(e,t,o){"use strict";function r(e){return e.match(a)[0]}function n(e,t){if(t instanceof e.errors.RetrievalError){var o=t.getCause();if(o instanceof e.retrievalErrors.UnacceptableResponseStatusCodeError)return 403===o.getStatusCode()}return!1}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),a=/^[^\?#]*/;t.isErrorWhichShouldTriggerURLRefresh=n,t.takeControlHLSMSEPlayer=function(e,t,o,a,s,l,c,u,d){d=i.logger.prefixLogger(d,"HLSMSEPlayer Controller");var p=null,f=r(u);o.onChange.subscribe(function(e){var t=e.dead;t&&p&&(d.debug("Aborting URL retrieve because player was killed."),p.abort())}),o.onError.subscribe(function(t){if(!(t instanceof i.errors.NotSupportedError)){if(a){if(t instanceof i.errors.URLUpdateError)return d.error("URL refresh failed for some reason.",t),void s({retryPlayer:!0});if(n(e,t))return p?void d.debug("Got a 403 status code, but URL refresh already in progress."):(d.info("Got a 403 status code. Peforming a URL refresh..."),void(p=c.getUrl()).whenComplete().then(function(e){if(e){var t=e.url,n=e.rendition;r(t)!==f||JSON.stringify(l)!==JSON.stringify(n)?(d.warn("Got a new URL but the rendition did not match the original."),s({retryPlayer:!1})):(p=null,d.info("Got a new URL. Updating..."),o.getUrlController().updateUrl(t))}else d.warn("Could not get a new URL."),s({retryPlayer:!1})}).catch(function(e){d.error("Unexpected error when trying to retrieve a new URL.",e),s({retryPlayer:!1})}))}d.error("Unexpected player error.",t),s({retryPlayer:!1})}}),t.providePlayer(o)}},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(6),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.GEOBLOCKED_ERROR"},t}(n.ApiError);t.GeoBlockedError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(11),i=function(e){function t(){return e.call(this,"There were no stream URLs.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.NO_STREAMS"},t}(n.NotSupportedError);t.NoStreamsError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(6),i=function(e){function t(){return e.call(this,null,"Request timed out too many times.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.TIMED_OUT_ERROR"},t}(n.ApiError);t.TimedOutError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(6),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.UNAVAILABLE_ERROR"},t}(n.ApiError);t.UnavailableError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(6),n=o(26),i=o(11),a=o(28),s=o(29),l=o(27);!function(e){e.ApiError=r.ApiError,e.GeoBlockedError=n.GeoBlockedError,e.NotSupportedError=i.NotSupportedError,e.TimedOutError=a.TimedOutError,e.UnavailableError=s.UnavailableError,e.NoStreamsError=l.NoStreamsError}(t.errors||(t.errors={}))},function(e,t,o){"use strict";function r(){return H||(function(e){e.load()}(H=document.createElement("audio")),H)}function n(e){var t=B.exec(e);return t&&t[0]||""}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),a=o(94),s=o(13),l=o(12),c=o(73),u=o(78),d=o(14),p=o(16),f=o(26),h=o(6),m=o(29),g=o(11),b=o(28),v=o(76),y=o(25),_=o(75),S=o(15),w=o(77),k=o(80),E=o(72),P=o(74),C=i.helpers.abortableJob.AbortableJob,T=i.helpers.retry,R=T.retry,O=T.buildExponentialDelayCalculator,M=o(27),A=o(79),N=void 0;try{N=o(93)}catch(e){}var I=void 0;try{I=o(92)}catch(e){}var x=void 0;try{x=o(91)}catch(e){}var D=void 0;try{D=o(90)}catch(e){}var F=N?N.HTML5Player:null,L=I?I.HLSMSEPlayer:null,U=x?x.FlipperPlayer:null,j=D?D.ChromecastPlayer:null,B=/^[^?#]*/,V=Object.keys(S.renditions).map(function(e){return S.renditions[e]}),H=null,G=null,q={},z=-1,W=[],Y=1,$=!1,K=new P.CacheManager(15e7,i.logger.noOpLogger);t.setGlobalVolume=function(e){if("number"!=typeof e)throw new Error("level must be a number.");if(e<0||e>1)throw new Error("Invalid volume level.");Y=e,W.forEach(function(t){return t.setVolume(e)})},t.getGlobalVolume=function(){return Y},t.setGlobalMuted=function(e){if("boolean"!=typeof e)throw new Error("muteEnabled must be a boolean.");$=e,W.forEach(function(t){return t.setMuted(e)})},t.getGlobalMuted=function(){return $},t.activateAudioElement=function(){r()},t.buildPlayer=function(e){function t(){return Ce?P(Ce):null}function o(){if(Me&&window.clearTimeout(Me),Se.debug("Performing retrieve."),Re)throw new Error("Player job already running. Only one instance of the job is allowed at once.");if(ke.isDead())throw new Error("Proxy is dead.");var e=new C(function(){function e(){function e(e){if(!c&&!r&&(c=!0,Se.debug("Player releasing control.",e),t.abort(e),!ke.isDead()))if(e&&e.retryPlayer){var n=Ae.getDelay();n>0?(Se.debug("Waiting "+n+" ms."),Me=window.setTimeout(function(){return o()},n)):o()}else o()}var n=Pe&&Pe[0];if(!n)throw new Error("No player to build.");if(!Te)throw new Error("No rendition.");var a=Te.url,s=Te.rendition,l=new i.Descriptor(a,s.maestroProtocol,s.maestroFormat,s.maestroSegmentFormat),c=!1;Se.debug("Building player...");var u=void 0,d=void 0;try{d=n(l,Te,e)}catch(e){u=e}void 0===d?(Se.error("Exception occurred whilst building player.",u),e()):null===d?(Se.debug("Player not supported for current descriptor."),e()):(Ee.set(d,Te),Ce=d,Se.debug("Built player."),Ce.isDead()?(Se.debug("Player died during construction."),e()):(K.addPlayer(Ce),Ce.onChange.subscribe(function(t){var o=t.dead;o&&(Se.debug("Player died."),e())})))}var r=!1,n=null;return function t(){function o(e){if(e!==i.helpers.abortableJob.abortedError)if(e instanceof p.RequestError){var t=e.getStatusCode();switch(t){case 401:ke._triggerError(new f.GeoBlockedError(t,"Geoblocked (logged out)."));break;case 403:ke._triggerError(new f.GeoBlockedError(t,"Geoblocked (logged in)."));break;case 404:ke._triggerError(new m.UnavailableError(t,"Track unavailable."));break;case null:throw new Error("Status code should not be null.");default:ke._triggerError(new h.ApiError(t))}}else e===i.helpers.retry.noMoreAttemptsError?ke._triggerError(new b.TimedOutError):(Se.error("Unexpected error.",e),ke._triggerError(new i.errors.PlayerFatalError("An unexpected error occurred.",e)))}(n=R(function(){return new C(function(){var e=B.getUrl();Se.debug("Retrieving a URL...");var t=e.whenComplete().then(function(e){return e?Se.debug("Retrieved URL.",{rendition:e.rendition,bitrate:e.bitrate}):Se.debug("No URL provided."),e&&V.indexOf(e.rendition)<0?(Se.warn("Unknown rendition. Skipping...",e.rendition),{success:!1}):{result:e,success:!0}}).catch(function(e){if(e instanceof p.RequestError){var t=e.getStatusCode();if(null===t||0===t)return null===t?Se.warn("Timed out when retrieving URL. Will retry."):Se.warn("Network error when retrieving URL. Will retry."),{success:!1}}throw e!==i.helpers.abortableJob.abortedError&&Se.error("Error retrieving URL.",e),e});return{result:t,abort:function(){return e.abort()}}})},he)).onCompletion(function(r){if(r)try{Te=r,Pe||(Pe=function(){var e=[];return j&&T.indexOf(j)>=0&&(Se.debug("ChromecastPlayer found.",D.version),be?e.push(function(e){var t=new j(e,{name:ve,castContext:be,logger:se});return ke.providePlayer(t,{syncPosition:!1,syncVolume:!1},!1),t}):Se.warn("Could not construct chromecast player because context not provided.")),U&&T.indexOf(U)>=0&&(Se.debug("FlipperPlayer found.",x.version),e.push(function(e){var t=new U(e,{name:ve,logger:se});return _.takeControlFlipperPlayer(ke,t,Se,Oe||void 0),t})),L&&T.indexOf(L)>=0&&(Se.debug("HLSMSEPlayer found.",I.version),e.push(function(e,t,o){var r=new L(e,{name:ve,playlistLoader:a.stringLoader,segmentLoader:a.arrayBufferLoader,keyLoader:a.arrayBufferLoader,logger:se});return S(r,function(){return o()}),y.takeControlHLSMSEPlayer(I,ke,r,ge,o,t.rendition,B,t.url,Se),r})),F&&T.indexOf(F)>=0&&(Se.debug("HTML5Player found.",N.version),e.push(function(e,t,o){var r,n=t.timeRetrieved;if(ge&&("hls"===e.getProtocol().name||void 0===n))return null;if(ge){if(void 0===n)throw new Error("Expecting timeUrlRetrieved to be set.");r={urlExpires:!0,timeUrlRetrieved:n}}else r={urlExpires:!1};var i=new F(e,{name:ve,logger:se});return S(i,function(){return o()}),v.takeControlHTML5Player(N,ke,i,r,o,Se),i})),e}());var n=Pe[0];n?e():(Se.debug("Excluding rendition.",r.rendition),B.excludeRendition(r.rendition),Pe=null,t())}catch(e){o(e)}else Te?(Se.error("There were no stream formats that were supported."),ke._triggerError(new g.NotSupportedError)):(Se.error("There were no streams available."),ke._triggerError(new M.NoStreamsError))}),n.onError(o)}(),{result:i.helpers.deferred.buildDeferred().promise,abort:function(e){r=!0,Se.info("Player job aborted.",e),Re=null,n&&n.abort(),Pe&&(e&&e.retryPlayer?Se.debug("Player might be used again for current rendition."):(Se.debug("Player will not be used again for current rendition."),Pe.shift()),ke.getPlayer()&&ke.removePlayer(),Ce&&(Ce.kill(),Ce=null),Te=null)}}}),t=e.run();return Re=t}function S(e,t){function o(){var t=e.getMediaElement();t&&t!==H&&(Se.debug("Revoking audio element that was created internally because player is ready now."),e.revokeMediaElement())}function n(){var o=e.getMediaElement();if(o&&o!==H&&(Se.debug("Revoking audio element that was created internally, even though player is not ready."),e.revokeMediaElement()),!e.getMediaElement()){G&&!G.isDead()&&(Se.info("Revoking audio element from a player."),G.isPlaying()&&Se.warn("The audio element is being revoked from a player which is playing. Only one player should be playing at once."),G.revokeMediaElement()),G=e,Se.info("Providing audio element to a different player.");var n=q={};e.provideMediaElement(r()).catch(function(o){e.isDead()||q!==n||(Se.error("An unexpected error occurred when trying to provide the audio element to a player.",o),t())})}}e.isReady()?o():e.onReady.subscribe(o),ke.onPlayIntent.subscribe(function(){e.isDead()||n()}),ke.isPlaying()&&(e.isDead()||n())}function P(e){var t=Ee.get(e);if(!t)return null;var o=function(e){return e.constructor===F}(e)?"MaestroHTML5":function(e){return e.constructor===L}(e)?"MaestroHLSMSE":function(e){return e.constructor===U}(e)?"MaestroFlipper":function(e){return e.constructor===j}(e)?"MaestroChromecast":null;if(!o)throw new Error("Unknown player.");return{name:o,bitrate:t.bitrate,protocol:t.rendition.scProtocol,host:function(e){var t=e.split("//",2);return 1===t.length?t[0].split("/",1)[0]:t[1]?t[1].split("/",1)[0]:""}(t.url),url:n(t.url),format:t.rendition.scFormat}}var T=e.playerClasses,B=e.streamUrlRetriever,X=e.duration,Q=void 0===X?null:X,J=e.preloadingEnabled,Z=void 0!==J&&J,ee=e.pausedMaxBufferLength,te=void 0===ee?2e3:ee,oe=e.playingMaxBufferLength,re=void 0===oe?9e4:oe,ne=e.fadeOutDuration,ie=void 0===ne?0:ne,ae=e.logger,se=void 0===ae?i.logger.noOpLogger:ae,le=e.audioPerformanceReporter,ce=e.audioReporter,ue=e.audioCheckpointInterval,de=void 0===ue?3e4:ue,pe=e.errorReporter,fe=e.urlProviderRetryDelayCalculator,he=void 0===fe?O():fe,me=e.streamUrlsExpire,ge=void 0===me||me,be=e.chromecastContext;if(!(B instanceof s.BaseStreamUrlRetriever))throw new Error("StreamUrlRetriever invalid.");if(null!==Q&&("number"!=typeof Q||Q<0))throw new Error("duration invalid.");if("boolean"!=typeof Z)throw new Error("preloadingEnabled invalid.");if(null!==te&&("number"!=typeof te||te<0))throw new Error("pausedMaxBufferLength invalid.");if(null!==re&&("number"!=typeof re||re<0))throw new Error("playingMaxBufferLength invalid.");if(null!==ie&&("number"!=typeof ie||ie<0))throw new Error("fadeOutDuration invalid.");if(null!==se&&"function"!=typeof se&&"object"!=typeof se)throw new Error("logger invalid.");if(void 0!==ce&&"function"!=typeof ce)throw new Error("audioReporter invalid.");if(null!==de&&("number"!=typeof de||de<0))throw new Error("audioCheckpointInterval invalid.");if(void 0!==le&&"function"!=typeof le)throw new Error("audioPerformanceReporter invalid.");if(void 0!==pe&&"function"!=typeof pe)throw new Error("errorReporter invalid.");if(void 0!==he&&"function"!=typeof he)throw new Error("retryDelayCalculator invalid.");var ve="SCAudio-"+ ++z,ye=B.getTrackId();null!==ye&&(ve+="-"+ye);var _e=new k.LogCollector;se=i.logger.cloneLogger(_e,se);var Se=i.logger.prefixLogger(se,ve),we=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",o=0;o<20;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();Se.info("Building player...",{ua:navigator.userAgent,logId:we});var ke=new d.Player({name:ve+"-Proxy",logger:se,mediaSessionEnabled:!0,pausedMaxBufferLength:te,playingMaxBufferLength:re,preloadingEnabled:Z},function(){Re?(Se.debug("Reloading stream URLs..."),Se.debug("Aborting player job that is in progress."),Re.abort(),Pe=null,o()):Se.debug("Reload requested, but not reloading as there is nothing to reload.")});W.push(ke),ke.setVolume(Y),ke.setMuted($),ie>0&&ke.addVolumeAutomator(l.buildFadeOut(ie));var Ee=new A.SCWeakMap,Pe=null,Ce=null,Te=null,Re=null,Oe=null,Me=null,Ae=new w.DecayingExponentialDelayCalculator;if(le&&(Oe=new c.AudioPerformanceEventGenerator(ke,le,Se,t)),ce&&new E.AudioEventGenerator(ke,ce,de,Se,t),pe&&new u.ErrorEventGenerator(ke,_e,we,ye,pe,Se,P,I||null,ge),ke.onChange.subscribe(function(e){var t=e.dead,o=e.playing;if(t)Se.info("Player killed."),W.splice(W.indexOf(ke),1),Re&&Re.abort(),Me&&window.clearTimeout(Me);else if(!0===o){var n=T.some(function(e){return function(e){return e===F||e===L}(e)});n&&r()}}),null!==Q&&(Se.debug("Setting initial duration.",Q),ke.setInitialDuration(Q)),Z)Se.debug("Preloading is enabled, so performing retrieve immediately."),o();else{Se.debug("Preloading is disabled, so deferring retrieve until either a play intent or preloading is enabled.");var Ne=function(){Ie.remove(),xe.remove(),Se.debug("Preloading now enabled or received a play request. Peforming retrieve."),o()},Ie=ke.onPreloadingEnabled.subscribe(Ne),xe=ke.onPlayIntent.subscribe(Ne)}return ke}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(12);!function(e){e.Fade=r.Fade,e.buildFadeIn=r.buildFadeIn,e.buildFadeOut=r.buildFadeOut}(t.volumeAutomation||(t.volumeAutomation={}))},function(e,t,o){"use strict";var r,n=o(47),i=o(19),a=o(2),s=o(54),l=o(2),c=o(1),u=Function.prototype.bind,d=Object.defineProperty,p=Object.prototype.hasOwnProperty;r=function(e,t,o){var r,i=c(t)&&l(t.value);return delete(r=n(t)).writable,delete r.value,r.get=function(){return!o.overwriteDefinition&&p.call(this,e)?i:(t.value=u.call(i,o.resolveContext?o.resolveContext(this):this),d(this,e,t),this[e])},r},e.exports=function(e){var t=i(arguments[1]);return null!=t.resolveContext&&a(t.resolveContext),s(e,function(e,o){return r(o,e,t)})}},function(e,t,o){"use strict";var r=o(1);e.exports=function(){return r(this).length=0,this}},function(e,t,o){"use strict";e.exports=o(36)()?Array.from:o(37)},function(e,t,o){"use strict";e.exports=function(){var e,t,o=Array.from;return"function"==typeof o&&(t=o(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},function(e,t,o){"use strict";var r=o(3).iterator,n=o(7),i=o(38),a=o(43),s=o(2),l=o(1),c=o(4),u=o(8),d=Array.isArray,p=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},h=Object.defineProperty;e.exports=function(e){var t,o,m,g,b,v,y,_,S,w,k=arguments[1],E=arguments[2];if(e=Object(l(e)),c(k)&&s(k),this&&this!==Array&&i(this))t=this;else{if(!k){if(n(e))return 1!==(b=e.length)?Array.apply(null,e):((g=new Array(1))[0]=e[0],g);if(d(e)){for(g=new Array(b=e.length),o=0;o<b;++o)g[o]=e[o];return g}}g=[]}if(!d(e))if(void 0!==(S=e[r])){for(y=s(S).call(e),t&&(g=new t),_=y.next(),o=0;!_.done;)w=k?p.call(k,E,_.value,o):_.value,t?(f.value=w,h(g,o,f)):g[o]=w,_=y.next(),++o;b=o}else if(u(e)){for(b=e.length,t&&(g=new t),o=0,m=0;o<b;++o)w=e[o],o+1<b&&(v=w.charCodeAt(0))>=55296&&v<=56319&&(w+=e[++o]),w=k?p.call(k,E,w,m):w,t?(f.value=w,h(g,m,f)):g[m]=w,++m;b=m}if(void 0===b)for(b=a(e.length),t&&(g=new t(b)),o=0;o<b;++o)w=k?p.call(k,E,e[o],o):e[o],t?(f.value=w,h(g,o,f)):g[o]=w;return t&&(f.value=null,g.length=b),g}},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call(o(17));e.exports=function(e){return"function"==typeof e&&r.call(e)===n}},function(e,t,o){"use strict";e.exports=o(40)()?Math.sign:o(41)},function(e,t,o){"use strict";e.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},function(e,t,o){"use strict";e.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},function(e,t,o){"use strict";var r=o(39),n=Math.abs,i=Math.floor;e.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?r(e)*i(n(e)):e}},function(e,t,o){"use strict";var r=o(42),n=Math.max;e.exports=function(e){return n(0,r(e))}},function(e,t,o){"use strict";var r=o(2),n=o(1),i=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(o,c){var u,d=arguments[2],p=arguments[3];return o=Object(n(o)),r(c),u=s(o),p&&u.sort("function"==typeof p?i.call(p,o):void 0),"function"!=typeof e&&(e=u[e]),a.call(e,u,function(e,r){return l.call(o,e)?a.call(c,d,o[e],e,o,r):t})}}},function(e,t,o){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,o){"use strict";var r=o(51),n=o(1),i=Math.max;e.exports=function(e,t){var o,a,s,l=i(arguments.length,2);for(e=Object(n(e)),s=function(r){try{e[r]=t[r]}catch(e){o||(o=e)}},a=1;a<l;++a)t=arguments[a],r(t).forEach(s);if(void 0!==o)throw o;return e}},function(e,t,o){"use strict";var r=o(35),n=o(9),i=o(1);e.exports=function(e){var t=Object(i(e)),o=arguments[1],a=Object(arguments[2]);if(t!==e&&!o)return t;var s={};return o?r(o,function(t){(a.ensure||t in e)&&(s[t]=e[t])}):n(s,e),s}},function(e,t,o){"use strict";var r,n=Object.create;o(20)()||(r=o(21)),e.exports=function(){var e,t,o;return r?1!==r.level?n:(e={},t={},o={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){return"__proto__"===e?void(t[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0}):void(t[e]=o)}),Object.defineProperties(e,t),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:e}),function(t,o){return n(null===t?e:t,o)}):n}()},function(e,t,o){"use strict";e.exports=o(44)("forEach")},function(e,t,o){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,o){"use strict";e.exports=o(52)()?Object.keys:o(53)},function(e,t,o){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,o){"use strict";var r=o(4),n=Object.keys;e.exports=function(e){return n(r(e)?Object(e):e)}},function(e,t,o){"use strict";var r=o(2),n=o(49),i=Function.prototype.call;e.exports=function(e,t){var o={},a=arguments[2];return r(t),n(e,function(e,r,n,s){o[r]=i.call(t,a,e,r,n,s)}),o}},function(e,t,o){"use strict";var r=o(18);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,o){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,o){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,o){"use strict";var r=Object.create(null),n=Math.random;e.exports=function(){var e;do{e=n().toString(36).slice(2)}while(r[e]);return e}},function(e,t,o){"use strict";var r,n=o(10),i=o(22),a=o(5),s=o(3),l=o(24),c=Object.defineProperty;r=e.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");l.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",c(this,"__kind__",a("",t))},n&&n(r,l),delete r.prototype.constructor,r.prototype=Object.create(l.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),c(r.prototype,s.toStringTag,a("c","Array Iterator"))},function(e,t,o){"use strict";var r=o(7),n=o(2),i=o(8),a=o(23),s=Array.isArray,l=Function.prototype.call,c=Array.prototype.some;e.exports=function(e,t){var o,u,d,p,f,h,m,g,b=arguments[2];if(s(e)||r(e)?o="array":i(e)?o="string":e=a(e),n(t),d=function(){p=!0},"array"!==o)if("string"!==o)for(u=e.next();!u.done;){if(l.call(t,b,u.value,d),p)return;u=e.next()}else for(h=e.length,f=0;f<h&&(m=e[f],f+1<h&&(g=m.charCodeAt(0))>=55296&&g<=56319&&(m+=e[++f]),l.call(t,b,m,d),!p);++f);else c.call(e,function(e){return l.call(t,b,e,d),p})}},function(e,t,o){"use strict";var r=o(7),n=o(4),i=o(8),a=o(3).iterator,s=Array.isArray;e.exports=function(e){return!(!n(e)||!s(e)&&!i(e)&&!r(e)&&"function"!=typeof e[a])}},function(e,t,o){"use strict";var r,n=o(10),i=o(5),a=o(3),s=o(24),l=Object.defineProperty;r=e.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),l(this,"__length__",i("",e.length))},n&&n(r,s),delete r.prototype.constructor,r.prototype=Object.create(s.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t,o=this.__list__[e];return this.__nextIndex__===this.__length__?o:(t=o.charCodeAt(0))>=55296&&t<=56319?o+this.__list__[this.__nextIndex__++]:o})}),l(r.prototype,a.toStringTag,i("c","String Iterator"))},function(e,t,o){"use strict";var r=o(61);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},function(e,t,o){"use strict";var r={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!r[typeof Symbol.iterator]&&!!r[typeof Symbol.toPrimitive]&&!!r[typeof Symbol.toStringTag]}},function(e,t,o){"use strict";e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},function(e,t,o){"use strict";var r,n,i,a,s=o(5),l=o(67),c=Object.create,u=Object.defineProperties,d=Object.defineProperty,p=Object.prototype,f=c(null);if("function"==typeof Symbol){r=Symbol;try{String(r()),a=!0}catch(e){}}var h=function(){var e=c(null);return function(t){for(var o,r,n=0;e[t+(n||"")];)++n;return e[t+=n||""]=!0,d(p,o="@@"+t,s.gs(null,function(e){r||(r=!0,d(this,o,s(e)),r=!1)})),o}}();i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return n(e)},e.exports=n=function e(t){var o;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?r(t):(o=c(i.prototype),t=void 0===t?"":String(t),u(o,{__description__:s("",t),__name__:s("",h(t))}))},u(n,{for:s(function(e){return f[e]?f[e]:f[e]=n(String(e))}),keyFor:s(function(e){var t;for(t in l(e),f)if(f[t]===e)return t}),hasInstance:s("",r&&r.hasInstance||n("hasInstance")),isConcatSpreadable:s("",r&&r.isConcatSpreadable||n("isConcatSpreadable")),iterator:s("",r&&r.iterator||n("iterator")),match:s("",r&&r.match||n("match")),replace:s("",r&&r.replace||n("replace")),search:s("",r&&r.search||n("search")),species:s("",r&&r.species||n("species")),split:s("",r&&r.split||n("split")),toPrimitive:s("",r&&r.toPrimitive||n("toPrimitive")),toStringTag:s("",r&&r.toStringTag||n("toStringTag")),unscopables:s("",r&&r.unscopables||n("unscopables"))}),u(i.prototype,{constructor:s(n),toString:s("",function(){return this.__name__})}),u(n.prototype,{toString:s(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:s(function(){return l(this)})}),d(n.prototype,n.toPrimitive,s("",function(){var e=l(this);return"symbol"==typeof e?e:e.toString()})),d(n.prototype,n.toStringTag,s("c","Symbol")),d(i.prototype,n.toStringTag,s("c",n.prototype[n.toStringTag])),d(i.prototype,n.toPrimitive,s("c",n.prototype[n.toPrimitive]))},function(e,t,o){"use strict";var r=o(65);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},function(e,t,o){"use strict";e.exports=o(69)()?WeakMap:o(71)},function(e,t,o){"use strict";e.exports=function(){var e,t;if("function"!=typeof WeakMap)return!1;try{e=new WeakMap([[t={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(e)&&"function"==typeof e.set&&e.set({},1)===e&&"function"==typeof e.delete&&"function"==typeof e.has&&"one"===e.get(t)}},function(e,t,o){"use strict";e.exports="function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)},function(e,t,o){"use strict";var r,n=o(10),i=o(55),a=o(1),s=o(58),l=o(5),c=o(23),u=o(60),d=o(3).toStringTag,p=o(70),f=Array.isArray,h=Object.defineProperty,m=Object.prototype.hasOwnProperty,g=Object.getPrototypeOf;e.exports=r=function(){var e,t=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return e=p&&n&&WeakMap!==r?n(new WeakMap,g(this)):this,null!=t&&(f(t)||(t=c(t))),h(e,"__weakMapData__",l("c","$weakMap$"+s())),t?(u(t,function(t){a(t),e.set(t[0],t[1])}),e):e},p&&(n&&n(r,WeakMap),r.prototype=Object.create(WeakMap.prototype,{constructor:l(r)})),Object.defineProperties(r.prototype,{delete:l(function(e){return!!m.call(i(e),this.__weakMapData__)&&(delete e[this.__weakMapData__],!0)}),get:l(function(e){if(m.call(i(e),this.__weakMapData__))return e[this.__weakMapData__]}),has:l(function(e){return m.call(i(e),this.__weakMapData__)}),set:l(function(e,t){return h(i(e),this.__weakMapData__,l("c",t)),this}),toString:l(function(){return"[object WeakMap]"})}),h(r.prototype,d,l("c","WeakMap"))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=1e3,i=function(){function e(e,t,o,i,a){this._checkpointTimer=null,this._logger=r.logger.prefixLogger(i,"AudioEventGenerator"),this._player=e,this._eventReporter=t,this._checkpointInterval=null!==o?Math.max(n,o):null,this._getPlayerDetails=a,this._startReporting()}return e.prototype._startReporting=function(){var e=this,t=this._player;t.onChange.subscribe(function(o){var r=o.actuallyPlaying,n=o.ended;!0===r&&!t.isEnded()||!1===n&&t.isActuallyPlaying()?(null===e._checkpointInterval||e._checkpointTimer||(e._checkpointTimer=window.setInterval(function(){e._reportEvent("checkpoint")},e._checkpointInterval)),e._reportEvent("play")):(!1===r&&!t.isEnded()||!0===n&&t.isActuallyPlaying())&&(e._checkpointTimer&&(window.clearInterval(e._checkpointTimer),e._checkpointTimer=null),e._reportEvent("pause"))})},e.prototype._reportEvent=function(e){var t=this._getPlayerDetails();if(t){var o=this._player.getDuration();if(null===o)throw new Error("Duration should exist now.");var r={type:e,position:this._player.getPosition(),duration:o,playerType:t.name};this._logger.debug("Generated audio event.",r),this._eventReporter(r)}else this._logger.warn("Cannot report event because there is no player.",e)},e}();t.AudioEventGenerator=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(89),i=function(){function e(e,t,o,n){this._logger=r.logger.prefixLogger(o,"AudioPerformanceEventGenerator"),this._player=e,this._eventReporter=t,this._getPlayerDetails=n,this._measureGeneralEvents()}return e.prototype.reportManualEvent=function(e){this._logger.debug("Reporting manual audio performance event.",e),this._eventReporter(e)},e.prototype._measureGeneralEvents=function(){var e=this,t=this._player,o=null,r=null,i=null,a=null,s=!0;t.onChange.subscribe(function(l){var c=l.playing,u=l.actuallyPlaying,d=l.seeking,p=l.stalled,f=l.ended;if(t.isDead())a&&window.clearTimeout(a);else{!0===c&&(o||((o=new n.Timer).start(),a=window.setTimeout(function(){e._reportEvent("longInitialBuffering",0)},3e4),0===t.getPosition()&&(s=!1))),!1===c&&(a&&window.clearTimeout(a),o&&!o.isComplete()&&(o=null)),!0===u&&o&&!o.isComplete()&&(o.stop(),a&&window.clearTimeout(a),e._reportEvent("play",o.getTime())),!0===d&&t.isReady()&&(r=new n.Timer).start(),!1===d&&r&&(r.stop(),e._reportEvent("seek",r.getTime())),!0===p&&t.isPlaying()&&o&&o.isComplete()&&((i=new n.Timer).start(),e._reportEvent("rebufferingStart",0)),!1===p&&i&&(i.stop(),e._reportEvent("rebufferingEnd",i.getTime()),i=null),!0!==f||s||(e._reportEvent("uninterruptedPlay",0),s=!0);var h=t.getSeekState(),m=h&&"IN_PROGRESS"===h.state;!m&&!0===p&&t.isActuallyPlaying()&&(s=!0)}})},e.prototype._reportEvent=function(e,t){var o=this._getPlayerDetails();if(o){var r={type:e,latency:t,protocol:o.protocol,playerType:o.name,host:o.host,bitrate:o.bitrate,format:o.format||void 0};this._logger.debug("Generated audio performance event.",r),this._eventReporter(r)}else this._logger.warn("Cannot report event because there is no player.",e,t)},e}();t.AudioPerformanceEventGenerator=i},function(e,t,o){"use strict";function r(e,t){var o=e.getMemoryCacheController();o&&o.setMaxCacheSize(t)}Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(){function e(e,t){this._maxCacheSize=e,this._players=[],this._updateTimer=null,this._logger=n.logger.prefixLogger(t,"CacheManager"),this._logger.debug("Initialized with cache size "+e+" bytes.")}return e.prototype.addPlayer=function(e){var t=this;if(this._logger.debug("Adding player to cache manager."),e.isDead())this._logger.debug("Player was dead.");else{var o=this._players;e.onChange.subscribe(function(r){var n=r.playing,i=r.dead;!0===i?(t._logger.debug("Removing player that became dead."),o.splice(o.indexOf(e),1),t._update()):!0===n?(t._logger.debug("Updating because player started playing."),o.splice(o.indexOf(e),1),o.unshift(e),t._update()):!1===n&&(t._logger.debug("Updating because player became paused."),t._update())}),e.isPlaying()?o.unshift(e):o.push(e),this._update()}},e.prototype._update=function(){var e=this;if(this._updateTimer&&(window.clearTimeout(this._updateTimer),this._updateTimer=null),0!==this._players.length){var t=this._players.reduce(function(e,t){return t.isPlaying()?e.playingPlayers.push(t):e.pausedPlayers.push(t),e},{playingPlayers:[],pausedPlayers:[]}),o=t.playingPlayers,n=t.pausedPlayers,i=o.reduce(function(e,t){return e+(t.getMemoryCacheUsage()||0)},0),a=n.reduce(function(e,t){return e+(t.getMemoryCacheUsage()||0)},0);if(i>this._maxCacheSize){this._logger.debug("All playing players are using more than the max cache size. Cleaning...",i,this._maxCacheSize);var s=this._maxCacheSize/o.length;o.forEach(function(e){return r(e,s)}),n.forEach(function(e){return r(e,0)})}else this._logger.debug("Recalculating cache sizes...",i+a,this._maxCacheSize),o.concat(n).reduce(function(t,o){return r(o,Math.max(0,e._maxCacheSize-t)),t+(o.getMemoryCacheUsage()||0)},0);this._updateTimer=window.setTimeout(function(){return e._update()},2e4)}else this._logger.debug("There are no longer any players to manage.")},e}();t.CacheManager=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0);t.takeControlFlipperPlayer=function(e,t,o,n){o=r.logger.prefixLogger(o,"FlipperPlayer Controller"),n&&t.onAudioPerformanceEvent.subscribe(function(e){var t=e.protocol,r=e.type,i=e.latency,a=e.player_type,s=e.host,l=e.bitrate,c=e.format,u="Flipper";if(a===u){var d={protocol:t,type:r,latency:i,playerType:u,host:s,bitrate:l,format:c};n.reportManualEvent(d)}else o.warn("Ignoring audio performance event from flipper because the player_type was incorrect.",a)}),e.providePlayer(t)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.time.now;t.takeControlHTML5Player=function(e,t,o,i,a,s){function l(){var e=o.getDuration(),t=c();if(null!==e&&null!==t){var r=e-o.getPosition();n()+r>t&&(s.info("Releasing control because stream URL would expire before reaching end."),a({retryPlayer:!0}))}}function c(){if(!i.urlExpires)return null;var e=o.getDuration();return null===e?null:i.timeUrlRetrieved+e+105e3}s=r.logger.prefixLogger(s,"HTML5Player Controller"),o.onError.subscribe(function(t){t instanceof r.errors.NotSupportedError||(t instanceof e.errors.NetworkError&&function(){var e=c();return null!==e&&e<=n()}()?(s.info("Releasing control as a network error occurred, and the URL has expired."),a({retryPlayer:!0})):(s.error("Unexpected player error.",t),a({retryPlayer:!1})))}),i.urlExpires&&(o.onPlayIntent.subscribe(function(){return l()}),o.onSeekIntent.subscribe(function(){return l()})),t.providePlayer(o)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._delayFactor=0,this._lastRequestTime=0}return e.prototype.getDelay=function(){var e=Date.now()-this._lastRequestTime;return this._lastRequestTime=Date.now(),this._delayFactor=Math.max(0,this._delayFactor-e/15e3),this._delayFactor+=1,Math.pow(2,this._delayFactor)},e}();t.DecayingExponentialDelayCalculator=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(25),i=function(){function e(e,t,o,n,i,a,s,l,c){this._logger=r.logger.prefixLogger(a,"ErrorGenerator"),this._player=e,this._logCollector=t,this._logId=o,this._trackId=n,this._eventReporter=i,this._getPlayerDetails=s,this._MaestroHLSMSEPlayer=l,this._streamUrlsExpire=c,this._listenForErrors()}return e.prototype._listenForErrors=function(){var e=this;this._player.onError.subscribe(function(t){t instanceof r.errors.PlayerFatalError&&e._reportEvent(t.getCode(),null)});var t=this._player.getDuration();this._player.onDurationChange.subscribe(function(o){null!==t&&Math.abs(o-t)>1e3&&(e._logger.warn("Duration changed more than 1000ms.",t,o),e._reportEvent("DURATION_MISMATCH",e._player)),t=o}),this._player.onPlayerProvided.subscribe(function(t){t.onError.subscribe(function(o){if(!(e._streamUrlsExpire&&e._MaestroHLSMSEPlayer&&n.isErrorWhichShouldTriggerURLRefresh(e._MaestroHLSMSEPlayer,o))){var i=o.getCode();o instanceof r.errors.NotSupportedError||e._reportEvent(i,t)}})})},e.prototype._reportEvent=function(e,t){var o=t&&this._getPlayerDetails(t)||void 0,r={errorCode:e,log:this._logCollector.getLog(),logId:this._logId,trackId:this._trackId,protocol:o&&o.protocol,playerType:o?o.name:"MaestroUnknown",host:o&&o.host,bitrate:o&&o.bitrate,format:o&&(o.format||void 0),url:o&&o.url};this._logger.debug("Generated audio error event.",r),this._eventReporter(r)},e}();t.ErrorEventGenerator=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(68),n=function(){function e(){this._map=new r}return e.prototype.get=function(e){return this._map.get(e)},e.prototype.set=function(e,t){this._map.set(e,t)},e.prototype.has=function(e){return this._map.has(e)},e.prototype.delete=function(e){return this._map.delete(e)},e}();t.SCWeakMap=n},function(e,t,o){"use strict";function r(e){return e.map(function(e){try{return JSON.stringify(e)}catch(e){return"<unavailable>"}})}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e=200),this._bufferSize=e,this._log=[]}return e.prototype.getLog=function(){return this._log},e.prototype.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this._push({level:"debug",msg:e,data:r(t),time:Date.now()})},e.prototype.info=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this._push({level:"info",msg:e,data:r(t),time:Date.now()})},e.prototype.warn=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this._push({level:"warn",msg:e,data:r(t),time:Date.now()})},e.prototype.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this._push({level:"error",msg:e,data:r(t),time:Date.now()})},e.prototype._push=function(e){this._log.push(e)>this._bufferSize&&this._log.shift()},e}();t.LogCollector=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiMobile={scProtocol:"sc.api-mobile",maestroProtocol:{name:"sc.api-mobile"},maestroFormat:{}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedHlsMp3={scProtocol:"encrypted-hls",scFormat:"mp3",maestroProtocol:{name:"hls"},maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedHlsOpus={scProtocol:"encrypted-hls",scFormat:"opus",maestroProtocol:{name:"hls"},maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsMp3={scProtocol:"hls",scFormat:"mp3",maestroProtocol:{name:"hls"},maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsOpus={scProtocol:"hls",scFormat:"opus",maestroProtocol:{name:"hls"},maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.httpMp3={scProtocol:"http",scFormat:"mp3",maestroProtocol:{name:"http"},maestroFormat:{mimeType:"audio/mpeg"}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maestroChromecast={scProtocol:"maestro.chromecast",maestroProtocol:{name:"maestro.chromecast"},maestroFormat:{}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(86),n=o(84),i=o(82),a=o(81),s=o(87),l=o(85),c=o(83);t.renditions={httpMp3:r.httpMp3,hlsMp3:n.hlsMp3,encryptedHlsMp3:i.encryptedHlsMp3,hlsOpus:l.hlsOpus,encryptedHlsOpus:c.encryptedHlsOpus,apiMobile:a.apiMobile,maestroChromecast:s.maestroChromecast}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.time.now,i=function(){function e(){this._start=null,this._end=null}return e.prototype.start=function(){if(this.isComplete())throw new Error("Timer completed.");this._start=n()},e.prototype.isComplete=function(){return null!==this._end},e.prototype.stop=function(){if(null===this._start)throw new Error("Not started.");this._end=n()},e.prototype.getTime=function(){if(null===this._end)throw new Error("Not completed.");return this._end-this._start},e}();t.Timer=i},function(e,o){if(void 0===t){var r=new Error('Cannot find module "@sc/maestro-chromecast-player"');throw r.code="MODULE_NOT_FOUND",r}e.exports=t},function(e,t){if(void 0===o){var r=new Error('Cannot find module "@sc/maestro-flipper-player"');throw r.code="MODULE_NOT_FOUND",r}e.exports=o},function(e,t){if(void 0===r){var o=new Error('Cannot find module "@sc/maestro-hls-mse-player"');throw o.code="MODULE_NOT_FOUND",o}e.exports=r},function(e,t){if(void 0===n){var o=new Error('Cannot find module "@sc/maestro-html5-player"');throw o.code="MODULE_NOT_FOUND",o}e.exports=n},function(e,t){e.exports=i},function(e,t,o){"use strict";function r(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),t.version="12.0.0",t.buildNumber=404;var n=o(32);t.volumeAutomation=n.volumeAutomation;var i=o(13);t.BaseStreamUrlRetriever=i.BaseStreamUrlRetriever;var a=o(16);t.RequestError=a.RequestError;var s=o(14);t.Player=s.Player;var l=o(15);t.renditions=l.renditions,r(o(30)),r(o(31))}])}(o(2),function(){try{return o(!function(){var e=new Error('Cannot find module "@sc/maestro-chromecast-player"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}}(),function(){try{return o(!function(){var e=new Error('Cannot find module "@sc/maestro-flipper-player"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}}(),function(){try{return o(3)}catch(e){}}(),function(){try{return o(7)}catch(e){}}(),o(8))},function(e,t,o){e.exports=function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=39)}([function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(4),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"PLAYER_FATAL_ERROR"},t}(n.PlayerError);t.PlayerFatalError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(8),n=function(){function e(){this._listeners=[],this.dispatch=this.dispatch.bind(this)}return e.prototype.subscribe=function(e){var t=this,o={fn:e,payloads:[]};return this._listeners.push(o),{remove:function(){var e=t._listeners.indexOf(o);return e>=0&&(t._listeners.splice(e,1),!0)},retrieve:function(){return t._dispatchListenerPayloads(o)}}},e.prototype.dispatch=function(e,t){var o=this,n="number"==typeof t?{time:t}:t||{},i=void 0!==n.time?n.time:r.now(),a=this._listeners;a.forEach(function(t){return t.payloads.push({time:i,payload:e})});var s=!1;do{s=!a.some(function(e){var t=e.fn,r=e.payloads,n=r.shift();return!!n&&(o._callHandler(t,n),!0)})}while(!s)},e.prototype.getHandle=function(){return{subscribe:this.subscribe.bind(this)}},e.prototype._dispatchListenerPayloads=function(e){for(var t=e.fn,o=e.payloads;;){var r=o.shift();if(!r)break;this._callHandler(t,r)}},e.prototype._callHandler=function(e,t){try{e(t.payload,t.time)}catch(e){window.setTimeout(function(){throw e},0)}},e}();t.EventDispatcher=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(12);t.buildDeferred=function(){var e,t,o=!1;return{promise:new r.Promise(function(o,r){e=o,t=r}),resolve:function(t){o||(o=!0,e(t))},reject:function(e){o||(o=!0,t(e))},isSettled:function(){return o}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(19),n=r.isIE();t.noOpLogger={debug:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o]},error:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o]},info:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o]},warn:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o]}},t.consoleLogger={debug:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r;n?console.log(e,t):(r=console.debug||console.log).call.apply(r,[console,e].concat(t))},error:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r;n?console.log(e,t):(r=console.error||console.log).call.apply(r,[console,e].concat(t))},info:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r;n?console.log(e,t):(r=console.info||console.log).call.apply(r,[console,e].concat(t))},warn:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r;n?console.log(e,t):(r=console.warn||console.log).call.apply(r,[console,e].concat(t))}},t.prefixLogger=function(e,t){return{debug:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.debug.apply(e,["["+t+"] "+o].concat(r))},error:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.error.apply(e,["["+t+"] "+o].concat(r))},info:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.info.apply(e,["["+t+"] "+o].concat(r))},warn:function(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.warn.apply(e,["["+t+"] "+o].concat(r))}}},t.cloneLogger=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{debug:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return e.forEach(function(e){return e.debug.apply(e,[t].concat(o))})},error:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return e.forEach(function(e){return e.error.apply(e,[t].concat(o))})},info:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return e.forEach(function(e){return e.info.apply(e,[t].concat(o))})},warn:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return e.forEach(function(e){return e.warn.apply(e,[t].concat(o))})}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._msg=e,this._cause=t}return e.prototype.getCode=function(){return"PLAYER_ERROR"},e.prototype.getMsg=function(){return this._msg},e.prototype.getCause=function(){return this._cause},e}();t.PlayerError=r},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(16),i=function(e){function t(t,o,r){return void 0===r&&(r="The player that the proxy was controlling had a fatal error."),e.call(this,t,o,r)||this}return r(t,e),t.prototype.getCode=function(){return"PROXY_PLAYER_PROVIDED_PLAYER_FATAL_ERROR"},t}(n.ProxyProvidedPlayerError);t.ProxyProvidedPlayerFatalError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deferException=function(e){try{e()}catch(e){window.setTimeout(function(){throw e},0)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(e,t){var o=void 0;return e.some(function(e){return!!t(e)&&(o=e,!0)}),o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Date.now();t.now=function(){return"performance"in window&&window.performance.now?window.performance.now():Date.now()-r}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(15),i=o(1),a=o(2),s=o(7),l=o(8),c=o(11),u=o(3),d=o(35),p=o(13),f=o(14),h="undefined"!=typeof navigator&&"mediaSession"in navigator,m=h?navigator.mediaSession:null,g=function(){function e(e){var t=this;this._stateManager=new d.StateManager({actuallyPlaying:!1,ended:!1,loading:!1,playing:!1,playDeferred:null,pauseDeferred:null,ready:!1,seeking:!1,seek:null,positionJumped:null,stalled:!0,duration:null,dead:!1,state:c.State.PAUSED,fatalError:null,errorOccurred:null,position:0},{afterUpdate:function(e,o){return t._afterUpdate(e,o)},afterDispatches:function(){return t._afterDispatches()},beforeUpdate:function(e){if(!e.dead){var o=t._getPosition(),r=e.duration;if(o<0)throw t._logger.error("Player provided invalid position.",o,r),t._triggerError(new f.ImplementationError("Player provided a position that was invalid.")),new Error("Player provided invalid position.");if(null!==r&&o>r)throw t._logger.error("Player provided invalid position.",o,r),t._triggerError(new f.ImplementationError("Player provided a position that was invalid.")),new Error("Player provided invalid position.");e.position=o,t._updateEndedInState(e)}}}),this._onError=new i.EventDispatcher,this._errors=[],this._loadingDelayTimer=null,this._stalled=!1,this._queuedDuration=null,this._readyDeferred=a.buildDeferred(),this._queuedSeekDeferreds=[],this._lastPlayError=null,this._lastPauseError=null,this._lastPlayedPosition=null,this._listenTimeBase=0,this._timePlaybackStarted=null,this._positionAfterLastUpdate=0;var o=e.name;return this._logger=u.prefixLogger(e.logger,"BasePlayer"+(o?"-"+o:"")),this._mediaSessionEnabled=!!e.mediaSessionEnabled,e.loadingDelay&&e.loadingDelay<0?void this._triggerError(new p.DependencyError("loadingDelay must be >= 0.")):(this._loadingDelay=void 0!==e.loadingDelay?e.loadingDelay:400,this.onError=this._onError.getHandle(),this.whenReady=this._readyDeferred.promise,this._stateManager.subscribe(function(e,o){return t._onChange(e,o)}),this._stateManager.subscribe(function(e,o){var r=e.playing,n=e.actuallyPlaying,i=o.dead;if(!i&&void 0!==r&&n!==r)try{t._handlePlayPauseChange(r)}catch(e){t._triggerError(new f.ImplementationError("Exception occurred whilst handling play/pause change.",e))}}),this._stateManager.subscribe(function(e,o){var r=e.seek,n=o.dead;if(!n&&r&&"IN_PROGRESS"===r.state)try{t._handleSeekChange(r.position)}catch(e){t._triggerError(new f.ImplementationError("Exception occurred whilst handling seek change.",e))}}),this._registerMediaSessionActionHandlers(),this._notifyMediaSessionPaused(),this.onChange=this._buildEventHandle(function(e,o){var r=o.ready;if(void 0!==r&&!0!==r)throw new Error("Ready state is invalid.");var n=o.duration;if(void 0!==n&&null===n)throw new Error("Duration state is invalid.");var i=o.dead;if(void 0!==i&&!0!==i)throw new Error("Dead state is invalid.");var a={ready:r,ended:o.ended,duration:n,playing:o.playing,actuallyPlaying:o.actuallyPlaying,stalled:o.stalled,loading:o.loading,playRejection:!1===o.playing&&t._lastPlayError||void 0,pauseRejection:!0===o.playing&&t._lastPauseError||void 0,seeking:o.seeking,seek:o.seek||void 0,positionJumped:void 0!==o.positionJumped||void 0,state:o.state,fatalError:o.fatalError||void 0,dead:i};Object.keys(a).some(function(e){return void 0!==a[e]})&&e(a)}),this.onDurationChange=this._buildEventHandle(function(e,t){var o=t.duration;void 0!==o&&null!==o&&e(o)}),this.onReady=this._buildEventHandle(function(e,t){var o=t.ready;!0===o&&e(void 0)}),this.onStateChange=this._buildEventHandle(function(e,t){var o=t.state;void 0!==o&&e(o)}),this.onPlay=this._buildEventHandle(function(e,t){var o=t.actuallyPlaying;!0===o&&e(void 0)}),this.onPlayIntent=this._buildEventHandle(function(e,t){var o=t.playing;!0===o&&e(void 0)}),this.onPlayRejection=this._buildEventHandle(function(e,o){var r=o.playing;!1===r&&t._lastPlayError&&e(t._lastPlayError)}),this.onPause=this._buildEventHandle(function(e,t){var o=t.actuallyPlaying;!1===o&&e(void 0)}),this.onPauseIntent=this._buildEventHandle(function(e,t){var o=t.playing;!1===o&&e(void 0)}),this.onPauseRejection=this._buildEventHandle(function(e,o){var r=o.playing;!0===r&&t._lastPauseError&&e(t._lastPauseError)}),this.onSeek=this._buildEventHandle(function(e,t){var o=t.seek;o&&"COMPLETED"===o.state&&e(void 0)}),this.onSeekIntent=this._buildEventHandle(function(e,t){var o=t.seeking;!0===o&&e(void 0)}),this.onSeekRejection=this._buildEventHandle(function(e,t){var o=t.seek;o&&"ERROR"===o.state&&e(o.error)}),this.onPositionJumped=this._buildEventHandle(function(e,t){var o=t.positionJumped;void 0!==o&&e(void 0)}),this.onEnded=this._buildEventHandle(function(e,t){var o=t.ended;!0===o&&e(void 0)}),this.onLeftEnded=this._buildEventHandle(function(e,t){var o=t.ended;!1===o&&e(void 0)}),this.onStallStart=this._buildEventHandle(function(e,t){var o=t.stalled;!0===o&&e(void 0)}),this.onStallEnd=this._buildEventHandle(function(e,t){var o=t.stalled;!1===o&&e(void 0)}),this.onLoadStart=this._buildEventHandle(function(e,t){var o=t.loading;!0===o&&e(void 0)}),void(this.onLoadEnd=this._buildEventHandle(function(e,t){var o=t.loading;!1===o&&e(void 0)})))}return e.prototype.isReady=function(){return this._stateManager.getState().ready},e.prototype.getPosition=function(){return this._getPositionOrPositionSeekingTo()},e.prototype.getLastPlayedPosition=function(){var e=this._stateManager.getState(),t=e.actuallyPlaying,o=e.stalled;return t&&!o?this.getPosition():this._lastPlayedPosition},e.prototype.getListenTime=function(){var e=this._stateManager.getState(),t=e.actuallyPlaying,o=e.ended,r=this._listenTimeBase;return t&&!o&&(r+=l.now()-this._timePlaybackStarted),r},e.prototype.isStalled=function(){return this._stateManager.getState().stalled},e.prototype.isLoading=function(){return this._stateManager.getState().loading},e.prototype.isPlaying=function(){return this._stateManager.getState().playing},e.prototype.isActuallyPlaying=function(){return this._stateManager.getState().actuallyPlaying},e.prototype.isEnded=function(){return this._stateManager.getState().ended},e.prototype.getState=function(){return this._stateManager.getState().state},e.prototype.getUrlController=function(){return null},e.prototype.getBufferController=function(){return null},e.prototype.getMemoryCacheMaxSize=function(){return null},e.prototype.getMemoryCacheUsage=function(){return null},e.prototype.getMemoryCacheController=function(){return null},e.prototype.getFatalError=function(){return this._stateManager.getState().fatalError},e.prototype.isDead=function(){return this._stateManager.getState().dead},e.prototype.getDuration=function(){var e=this._stateManager.getState(),t=e.ready,o=e.duration;return t?o:null},e.prototype.setVolume=function(e){if(e<0||e>1)throw new Error("Volume must be >= 0 and <= 1.");this._setVolume(e)},e.prototype.getCurrentBufferedTimeRange=function(){var e=this.getBufferedTimeRanges();if(!e)return null;var t=this.getPosition();return s.find(e,function(e){return e.containsTime(t)})||null},e.prototype.play=function(){var e=this;this._ensureNotDead(),this._logger.debug("play() called.");var t=a.buildDeferred();return this._stateManager.update(function(o){o.playing?e._logger.debug("Intent is already to be playing."):(e._logger.debug("Requesting play."),o.playing=!0,e._lastPlayError=null),o.playDeferred&&!o.playDeferred.isSettled()||(o.playDeferred=a.buildDeferred()),t.resolve(o.playDeferred.promise)}),t.promise},e.prototype.pause=function(){var e=this;this._ensureNotDead(),this._logger.debug("pause() called.");var t=a.buildDeferred();return this._stateManager.update(function(o){o.playing?(e._logger.debug("Requesting pause."),o.playing=!1,e._lastPauseError=null):e._logger.debug("Intent is already to be paused."),o.pauseDeferred&&!o.pauseDeferred.isSettled()||(o.pauseDeferred=a.buildDeferred()),t.resolve(o.pauseDeferred.promise)}),t.promise},e.prototype.seek=function(e){var t=this;this._ensureNotDead(),this._logger.debug("seek() called.",e);var o=a.buildDeferred();return this._stateManager.update(function(r){if(e<0)t._logger.warn("Rejecting seek immediately as the position was negative."),o.reject(new Error("You were attempting to seek to a negative time."));else if(null!==r.duration&&e>r.duration)t._logger.warn("Rejecting seek immediately as the duration is now known, and the requested positon was past it."),o.reject(new Error("You were attempting to seek past the end of the media."));else{r.stalled||!r.actuallyPlaying||r.seek&&"IN_PROGRESS"===r.seek.state||(t._lastPlayedPosition=t._getPositionOrPositionSeekingTo());var n=a.buildDeferred();r.seek&&"IN_PROGRESS"===r.seek.state&&r.seek.position===e?t._logger.debug("Seek already requested to the same position.",e):(t._logger.debug("Requesting seek.",e),r.seeking=!0,r.seek={state:"IN_PROGRESS",position:e},r.positionJumped=Object.create(null)),t._queuedSeekDeferreds.push({position:e,deferred:n}),o.resolve(n.promise)}}),o.promise},e.prototype.getSeekState=function(){return this._stateManager.getState().seek},e.prototype.kill=function(){var e=this;this._stateManager.update(function(t){t.dead||(e._logger.debug("kill() called."),t.dead=!0)})},e.prototype._update=function(e){this._stateManager.update(function(){return e&&e()})},e.prototype._ensureNotDead=function(){if(this._stateManager.getState().dead)throw new Error("Player is dead.")},e.prototype._notifyStalled=function(e){this._ensureNotDead(),this._stalled!==e&&(this._logger.debug("notifyStalled() called.",e),this._stalled=e,this._stateManager.update())},e.prototype._getQueuedSeekPosition=function(){var e=this.getSeekState();return e&&"IN_PROGRESS"===e.state?e.position:null},e.prototype._provideDuration=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(o){if(o.duration!==e){var r=t._getPositionOrPositionSeekingTo();if(e<0||o.ready&&r>e)throw t._triggerError(new f.ImplementationError("Attempt to update duration to an invalid value.")),new Error("Duration cannot be less than the current position.");t._logger.debug("provideDuration() called.",e),o.ready?o.duration=e:t._queuedDuration=e}})},e.prototype._notifyPlaying=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(o){if(!o.ready)throw t._triggerError(new f.ImplementationError("Attempt to register playback as started before ready.")),new Error("Player must be ready first.");e!==o.actuallyPlaying&&(t._logger.debug("notifyPlaying() called.",e),e||o.seeking||o.stalled||(t._lastPlayedPosition=t._getPositionOrPositionSeekingTo()),o.actuallyPlaying=o.playing=e,e?t._lastPlayError=null:t._lastPauseError=null)})},e.prototype._notifyPlayRejection=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(o){if(!o.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject a play request before player ready.")),new Error("Player must be ready first.");if(o.actuallyPlaying||!o.playing)throw t._triggerError(new f.ImplementationError("Attempt to reject a play request when not valid.")),new Error("Playing state is incorrect.");t._logger.debug("notifyPlayRejection() called.",e),o.playing=!1,t._lastPlayError=e})},e.prototype._notifyPauseRejection=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(o){if(!o.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject pause request before player ready.")),new Error("Player must be ready first.");if(!o.actuallyPlaying||o.playing)throw t._triggerError(new f.ImplementationError("Attempt to reject pause request when not valid.")),new Error("Playing state is incorrect.");t._logger.debug("notifyPauseRejection() called.",e),o.playing=!0,t._lastPauseError=e})},e.prototype._notifySeekRejection=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(o){if(!o.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request before player ready.")),new Error("Player must be ready first.");if(!o.seek||"IN_PROGRESS"!==o.seek.state)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request when none requested.")),new Error("A seek hasn't been requested.");if(null!==o.duration&&o.position>o.duration)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request after duration changed below current position.")),new Error("Attempt to reject seek request after duration changed below current position.");t._logger.debug("notifySeekRejection() called.",e),o.seeking=!1,o.seek={state:"ERROR",error:e},o.positionJumped=Object.create(null)})},e.prototype._signalReady=function(){var e=this;this._ensureNotDead(),this._stateManager.update(function(t){if(t.ready)throw e._triggerError(new f.ImplementationError("Attempt to signal ready twice.")),new Error("Ready already signalled.");if(null===e._queuedDuration)throw e._triggerError(new f.ImplementationError("Attempt to signal ready when duration unknown.")),new Error("Duration is still unknown.");e._logger.debug("signalReady() called."),t.ready=!0,t.duration=e._queuedDuration,t.seek&&"IN_PROGRESS"===t.seek.state&&t.seek.position>t.duration&&(t.seeking=!1,t.seek={state:"ERROR",error:new Error("You were attempting to seek past the end of the media.")})})},e.prototype._signalSeekComplete=function(){var e=this;this._ensureNotDead(),this._stateManager.update(function(t){if(!t.ready)throw e._triggerError(new f.ImplementationError("Attempt to signal seek as complete before player ready.")),new Error("Player must be ready first.");if(!t.seek||"IN_PROGRESS"!==t.seek.state)throw e._triggerError(new f.ImplementationError("Attempt to signal seek as complete when none requested.")),new Error("There shouldn't be a seek in progress.");var o=t.duration;if(t.seek&&"IN_PROGRESS"===t.seek.state&&t.seek.position>o)throw new Error("Seek cannot have completed given it was to a time greater than the duration.");e._logger.debug("signalSeekComplete() called."),t.seek={state:"COMPLETED",position:t.seek.position},t.seeking=!1,t.position=t.seek.position})},e.prototype._triggerError=function(e){var t=this;this._stateManager.update(function(o){var i=!1;if(o.ready&&e instanceof n.NotSupportedError&&(e=new f.ImplementationError("Invalid NotSupportedError."),i=!0),e instanceof r.PlayerFatalError?(e instanceof n.NotSupportedError?t._logger.info("NotSupportedError occurred.",e):t._logger.error("Fatal error occurred.",e),o.fatalError?t._logger.warn("A fatal error already occurred.",o.fatalError):o.fatalError=e,t._errors.push(e),o.errorOccurred=Object.create(null),o.dead=!0):(t._logger.warn("Non-fatal error occurred.",e),t._errors.push(e),o.errorOccurred=Object.create(null)),i)throw new Error("Not supported errors are only valid before the player is ready.")})},e.prototype._buildEventHandle=function(e){var t=this;return{subscribe:function(o){var r=function(e){return o(e,l.now())};return t._stateManager.subscribe(function(t){e(r,t)})}}},e.prototype._finalizeState=function(e){this._updateEndedInState(e);var t=this._getPositionOrPositionSeekingTo();if(e.dead)this._lastPlayError=new Error("Player was killed."),e.loading=!1,this._clearLoadingDelay(),e.stalled=!0,e.actuallyPlaying=!1,e.playing=!1,e.state=c.State.DEAD;else{var o=!e.ended&&(!e.ready||this._stalled||!(!e.seek||"IN_PROGRESS"!==e.seek.state));o&&!e.stalled&&!e.seeking&&e.actuallyPlaying&&(this._lastPlayedPosition=t),e.stalled=o;var r=!e.ended&&(e.playing||e.actuallyPlaying)&&(e.stalled||e.playing!==e.actuallyPlaying);r?this._loadingDelay?this._scheduleLoadingDelay():e.loading=!0:(e.loading=!1,this._clearLoadingDelay()),this._positionAfterLastUpdate!==t&&(this._positionAfterLastUpdate=t,e.playing||e.actuallyPlaying||(e.positionJumped=Object.create(null))),e.state=this._calculateState(e)}},e.prototype._updateEndedInState=function(e){e.ended=e.ready&&this._getPositionOrPositionSeekingTo()===e.duration},e.prototype._scheduleLoadingDelay=function(){var e=this;this._loadingDelayTimer||(this._loadingDelayTimer=window.setTimeout(function(){e._stateManager.update(function(e){return e.loading=!0})},this._loadingDelay))},e.prototype._clearLoadingDelay=function(){this._loadingDelayTimer&&(window.clearTimeout(this._loadingDelayTimer),this._loadingDelayTimer=null)},e.prototype._getPositionOrPositionSeekingTo=function(){this._stateManager.update();var e=this._stateManager.getState();return e.seek&&"IN_PROGRESS"===e.seek.state?e.seek.position:e.ready&&null!==e.duration?e.position:0},e.prototype._calculateState=function(e){var t=e.dead,o=e.loading,r=e.playing,n=e.ended;return t?c.State.DEAD:o?c.State.LOADING:r&&!n?c.State.PLAYING:c.State.PAUSED},e.prototype._registerMediaSessionActionHandlers=function(){var e=this;this._mediaSessionEnabled&&m&&(m.setActionHandler("play",function(){e.isDead()||e.play()}),m.setActionHandler("pause",function(){e.isDead()||e.pause()}),m.setActionHandler("seekbackward",function(){e.isDead()||e.seek(Math.max(0,e.getPosition()-5e3))}),m.setActionHandler("seekforward",function(){e.isDead()||e.seek(Math.min(e.getDuration()||0,e.getPosition()+5e3))}))},e.prototype._notifyMediaSessionPlaying=function(){this._mediaSessionEnabled&&m&&(m.playbackState="playing")},e.prototype._notifyMediaSessionPaused=function(){this._mediaSessionEnabled&&m&&(m.playbackState="paused")},e.prototype._afterUpdate=function(e,t){(t.beforeUpdate||t.update.length>0)&&(this._logger.error("Errors occurred during state update. Killing player.",t),this._triggerError(new r.PlayerFatalError("Errors occurred during state update.",t))),this._finalizeState(e)},e.prototype._afterDispatches=function(){var e=this,t=this._errors;this._errors=[],t.forEach(function(t){return e._onError.dispatch(t)})},e.prototype._onChange=function(e,t){var o=this,r=e.ready,n=e.dead,i=e.fatalError,a=e.playing,s=e.actuallyPlaying,c=e.ended;if(!0===r&&(this._logger.debug("Resolving ready deferred."),this._readyDeferred.resolve(void 0)),!0===s&&this._registerMediaSessionActionHandlers(),!0===a?this._notifyMediaSessionPlaying():!1===a&&this._notifyMediaSessionPaused(),t.pauseDeferred&&!t.pauseDeferred.isSettled()&&t.playing){var u=this._lastPauseError||new Error("Pause request aborted.");this._logger.debug("Rejecting pause deferred.",u),t.pauseDeferred.reject(u)}if(t.playDeferred&&!t.playDeferred.isSettled()&&!t.playing){var u=this._lastPlayError||new Error("Play request aborted.");this._logger.debug("Rejecting play deferred.",u),t.playDeferred.reject(u)}if(t.playDeferred&&!t.playDeferred.isSettled()&&t.actuallyPlaying&&(this._logger.debug("Resolving play deferred."),t.playDeferred.resolve(void 0)),!t.pauseDeferred||t.pauseDeferred.isSettled()||t.actuallyPlaying||(this._logger.debug("Resolving pause deferred."),t.pauseDeferred.resolve(void 0)),!0===s&&!t.ended||!1===c&&t.actuallyPlaying?this._timePlaybackStarted=l.now():(!1===s&&!t.ended||!0===c&&t.actuallyPlaying)&&(this._listenTimeBase+=l.now()-this._timePlaybackStarted,this._timePlaybackStarted=null),this._queuedSeekDeferreds=this._queuedSeekDeferreds.filter(function(e){var r=e.position,n=e.deferred;if(t.seek)if("IN_PROGRESS"!==t.seek.state){if(!t.stalled||"ERROR"===t.seek.state)return"ERROR"!==t.seek.state?(o._logger.debug("Resolving seek()."),n.resolve(void 0)):(o._logger.debug("Rejecting seek().",t.seek.error),n.reject(t.seek.error)),!1}else if("IN_PROGRESS"!==t.seek.state||t.seek.position!==r)return o._logger.debug("Rejecting seek() because another seek was requested.",r),n.reject(new Error("Seek request aborted because another seek was requested to a different position.")),!1;return!0}),!0===n){this._logger.debug("Calling _kill() on player.");try{this._kill(),this._logger.info("Player killed.")}catch(e){this._triggerError(new f.ImplementationError("Exception occurred in _kill().",e)),this._logger.error("Exception when implementation was being killed.",e)}if(!t.ready){var u=i||new Error("Player was killed.");this._logger.debug("Rejecting whenReady."),this._readyDeferred.reject(u)}this._queuedSeekDeferreds.forEach(function(e){var t=e.position,r=e.deferred,n=i||new Error("Seek aborted as player killed.");o._logger.debug("Rejecting seek().",t),r.reject(n)}),this._stateManager.kill(),this._logger.debug("Player dead.")}},e}();t.BasePlayer=g},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(9),i=o(4),a=o(0),s=o(3),l=o(1),c=o(16),u=o(5),d=function(e){function t(t){var o=e.call(this,t)||this;return o._onProvidedPlayerError=new l.EventDispatcher,o._errorHandler=null,o._changeHandler=null,o._player=null,o._instanceLock=null,o._lastPlayerPosition=0,o._volume=1,o._muted=!1,o._synced=!1,o._unsyncInProgress=!1,o._logger=s.prefixLogger(o._logger,"ProxyPlayerBase"),o.onProvidedPlayerError=o._onProvidedPlayerError.getHandle(),o}return r(t,e),t.prototype.getVolume=function(){return this._player&&this._synced?this._player.getVolume():this._volume},t.prototype.getMuted=function(){return this._player&&this._synced?this._player.getMuted():this._muted},t.prototype.setMuted=function(e){return this._player&&this._synced?this._player.setMuted(e):void(this._muted=e)},t.prototype.getBufferedTimeRanges=function(){return this._player&&this._synced?this._player.getBufferedTimeRanges():null},t.prototype.getCurrentBufferedTimeRange=function(){return this._player&&this._synced?this._player.getCurrentBufferedTimeRange():null},t.prototype.getMaxBufferLength=function(){return this._player&&this._synced?this._player.getMaxBufferLength():null},t.prototype._providePlayer=function(e,t){if(void 0===t&&(t={syncPosition:!0,syncVolume:!0}),this._ensureNotDead(),this._player)throw new Error("A player has already been provided.");this._logger.debug("providePlayer() called."),this._instanceLock=Object.create(null),this._player=e,this._sync(t)},t.prototype._removePlayer=function(){if(this._ensureNotDead(),!this._player)throw new Error("There is no player to remove.");if(this._unsyncInProgress)throw new Error("Player is currently unsyncing.");this._logger.debug("removePlayer() called."),this._instanceLock=null,this._unsync(),this._player=null,this.isReady()&&!this.isDead()&&this._notifyStalled(!0)},t.prototype._setInitialDuration=function(e){var t=this;if(this._ensureNotDead(),e<0)throw new Error("Cannot set duration to a value < 0.");null===this.getDuration()&&this._update(function(){t._ensureBelowPosition(e),t._provideDuration(e),t.isReady()||(t._signalReady(),t._handleSkippedSeek())})},t.prototype._triggerError=function(t){e.prototype._triggerError.call(this,t)},t.prototype._getPlayer=function(){return this.isDead()?null:this._player},t.prototype._setVolume=function(e){return this._player&&this._synced?this._player.setVolume(e):void(this._volume=e)},t.prototype._handlePlayPauseChange=function(e){var t=this._player;t&&(e?this._playAndHandleAbort(t):this._pauseAndHandleAbort(t))},t.prototype._handleSeekChange=function(e){var t=this._player;t&&this._synced&&t.seek(e)},t.prototype._getPosition=function(){if(this._player&&this._synced){if(!this._changeHandler)throw new Error("Handler should exist.");if(this._changeHandler.retrieve(),this._synced)return this._player.getPosition()}return this._lastPlayerPosition},t.prototype._kill=function(){if(this._player&&!this._player.isDead()){if(!this._changeHandler)throw new Error("Handler should exist.");if(this._changeHandler.retrieve(),this._synced&&(this._player.kill(),this._synced))throw new Error("Unsync should have happened.")}this._player=null},t.prototype._handleSkippedSeek=function(){if(this._player&&this._synced){var e=this.getSeekState(),t=this._player.getSeekState();!e||"IN_PROGRESS"!==e.state||t&&"IN_PROGRESS"===t.state||(this._logger.debug("Signalling seek as complete on proxy because provided player isn't seeking."),this._signalSeekComplete())}},t.prototype._ensureBelowPosition=function(e){this.getPosition()>e&&(this._logger.debug("Capping position.",e),this.seek(e),this.isReady()&&(this._lastPlayerPosition=e,this._signalSeekComplete()))},t.prototype._sync=function(e){var t=this,o=this._player;if(!o)throw new Error("Player should have become available by now.");return this._logger.debug("Syncing...",this.isPlaying(),this.isActuallyPlaying()),o.isDead()?void this._logger.debug("Provided player is dead."):(this._errorHandler=o.onError.subscribe(function(e){e instanceof a.PlayerFatalError?t._onProvidedPlayerError.dispatch(new u.ProxyProvidedPlayerFatalError(e,o)):(t._triggerError(e),t._onProvidedPlayerError.dispatch(new c.ProxyProvidedPlayerError(e,o)))}),this._changeHandler=o.onChange.subscribe(function(e){t._update(function(){if(t._logger.debug("Handling changes.",e),e.dead)return t._logger.debug("Player has gone to DEAD state."),t._unsync(),void(t.isDead()||e.fatalError&&t._handleFatalError(e.fatalError,o));if(void 0!==e.duration&&(t._ensureBelowPosition(e.duration),t._provideDuration(e.duration),t.isReady()||(t._signalReady(),t._handleSkippedSeek(),t._notifyStalled(o.isStalled()))),e.seek){var r=t.getSeekState();r&&"IN_PROGRESS"===r.state&&("COMPLETED"===e.seek.state&&r.position===e.seek.position?t._signalSeekComplete():"COMPLETED"===e.seek.state&&r.position!==e.seek.position?t._notifySeekRejection(new Error("Another seek occurred to a different position.")):"IN_PROGRESS"===e.seek.state&&r.position!==e.seek.position?t.seek(e.seek.position):"ERROR"===e.seek.state&&t._notifySeekRejection(e.seek.error))}void 0!==e.stalled&&t._notifyStalled(e.stalled),!1===e.playing&&e.playRejection?t.isActuallyPlaying()?(t._triggerError(new i.PlayerError("Paused because a player was provided that refused to play.")),t._notifyPlaying(!1)):t._notifyPlayRejection(e.playRejection):!1===e.playing&&(o.isActuallyPlaying()?t.pause():void 0===e.actuallyPlaying&&t.isReady()&&t._notifyPlaying(!1)),!0===e.playing&&e.pauseRejection?t._notifyPauseRejection(e.pauseRejection):!0===e.playing&&t.play(),void 0!==e.actuallyPlaying&&t._notifyPlaying(e.actuallyPlaying)})}),void this._update(function(){var r=t._instanceLock;try{if(t._notifyStalled(o.isStalled()),!t.isReady()&&o.isReady()){t._logger.debug("Provided player is already ready. Making proxy player ready.");var n=o.getDuration();t._ensureBelowPosition(n),t._provideDuration(n),t._signalReady()}if(e.syncVolume&&(o.setVolume(t._volume),o.setMuted(t._muted),t._instanceLock!==r))return;var i=t.getSeekState();if(e.syncPosition){t._logger.debug("Seeking to match position.");var s=t.getPosition();o.getPosition()!==s?o.seek(s):(t._logger.debug("Skipping seek because already at same position."),t.isReady()&&i&&"IN_PROGRESS"===i.state&&t._signalSeekComplete())}else if(i&&"IN_PROGRESS"===i.state)t._logger.debug("Seeking to match position because a seek has been queued."),o.seek(t.getPosition());else{var l=o.getSeekState();l&&"IN_PROGRESS"===l.state&&(t._logger.debug("Seeking on proxy to match seek that is in progress on provided player."),t.seek(l.position))}if(t._instanceLock!==r)return;if(o.isActuallyPlaying()?(t._logger.debug("Provided player is already playing."),t._notifyPlaying(!0)):o.isPlaying()?(t._logger.debug("Provided player is preparing to play."),t.play()):t.isPlaying()?(t._logger.debug("Calling play() on provided player to match proxy."),t._playAndHandleAbort(o)):t.isReady()&&t.isActuallyPlaying()&&(t._logger.debug("Switching to paused state, as provided player and proxy intended state is paused."),t._notifyPlaying(!1)),t._instanceLock!==r)return;t._synced=!0}catch(e){t._triggerError(new a.PlayerFatalError("Unexpected error occurred whilst syncing.",e))}}))},t.prototype._playAndHandleAbort=function(e){var t=this._instanceLock;this._logger.debug("Calling play() on provided player."),e.play(),this._instanceLock===t&&!e.isPlaying()&&this.isPlaying()&&(this._logger.debug("Provided player was not playing after play() call completed."),this.isActuallyPlaying()?(this._triggerError(new i.PlayerError("Paused because a player was provided that refused to play.")),this._notifyPlaying(!1)):this.pause())},t.prototype._pauseAndHandleAbort=function(e){var t=this._instanceLock;this._logger.debug("Calling pause() on provided player."),e.pause(),this._instanceLock===t&&e.isPlaying()&&!this.isPlaying()&&(this._logger.debug("Provided player was not paused after pause() call completed."),this.play())},t.prototype._unsync=function(){if(this._logger.debug("Unsyncing..."),this._changeHandler&&(this._changeHandler.remove(),this._changeHandler=null),this._errorHandler&&(this._errorHandler.remove(),this._errorHandler=null),this._synced){this._synced=!1,this._unsyncInProgress=!0;var e=this._player;if(e)try{this._volume=e.getVolume(),this._muted=e.getMuted(),this._lastPlayerPosition=e.getPosition()}catch(e){this._logger.error("Error whilst unsyncing.",e)}this._unsyncInProgress=!1,this._logger.debug("Unsynced.",this.isPlaying(),this.isActuallyPlaying())}else this._logger.debug("Unsynced. (Sync never completed)")},t}(n.BasePlayer);t.ProxyPlayerBase=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LOADING=0]="LOADING",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.DEAD=3]="DEAD"}(t.State||(t.State={}))},function(e,t,o){(function(t,r){
/*!
		 * @overview es6-promise - a tiny implementation of Promises/A+.
		 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
		 * @license   Licensed under MIT license
		 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
		 * @version   4.0.5
		 */
!function(t,o){e.exports=o()}(0,function(){"use strict";function e(e){return"function"==typeof e}function n(){var e=setTimeout;return function(){return e(i,1)}}function i(){for(var e=0;e<k;e+=2){var t=N[e],o=N[e+1];t(o),N[e]=void 0,N[e+1]=void 0}k=0}function a(e,t){var o=arguments,r=this,n=new this.constructor(l);void 0===n[x]&&y(n);var i=r._state;return i?function(){var e=o[i-1];C(function(){return v(i,n,e,r._result)})}():m(r,n,e,t),n}function s(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(l);return d(t,e),t}function l(){}function c(e){try{return e.then}catch(e){return U.error=e,U}}function u(t,o,r){o.constructor===t.constructor&&r===a&&o.constructor.resolve===s?function(e,t){t._state===F?f(e,t._result):t._state===L?h(e,t._result):m(t,void 0,function(t){return d(e,t)},function(t){return h(e,t)})}(t,o):r===U?h(t,U.error):void 0===r?f(t,o):e(r)?function(e,t,o){C(function(e){var r=!1,n=function(e,t,o,r){try{e.call(t,o,r)}catch(e){return e}}(o,t,function(o){r||(r=!0,t!==o?d(e,o):f(e,o))},function(t){r||(r=!0,h(e,t))},e._label);!r&&n&&(r=!0,h(e,n))},e)}(t,o,r):f(t,o)}function d(e,t){e===t?h(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?u(e,t,c(t)):f(e,t)}function p(e){e._onerror&&e._onerror(e._result),g(e)}function f(e,t){e._state===D&&(e._result=t,e._state=F,0!==e._subscribers.length&&C(g,e))}function h(e,t){e._state===D&&(e._state=L,e._result=t,C(p,e))}function m(e,t,o,r){var n=e._subscribers,i=n.length;e._onerror=null,n[i]=t,n[i+F]=o,n[i+L]=r,0===i&&e._state&&C(g,e)}function g(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var r=void 0,n=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],n=t[a+o],r?v(o,r,n,i):n(i);e._subscribers.length=0}}function b(){this.error=null}function v(t,o,r,n){var i=e(r),a=void 0,s=void 0,l=void 0,c=void 0;if(i){if((a=function(e,t){try{return e(t)}catch(e){return j.error=e,j}}(r,n))===j?(c=!0,s=a.error,a=null):l=!0,o===a)return void h(o,new TypeError("A promises callback cannot return that same promise."))}else a=n,l=!0;o._state!==D||(i&&l?d(o,a):c?h(o,s):t===F?f(o,a):t===L&&h(o,a))}function y(e){e[x]=B++,e._state=void 0,e._result=void 0,e._subscribers=[]}function _(e,t){this._instanceConstructor=e,this.promise=new e(l),this.promise[x]||y(this.promise),w(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}function S(e){this[x]=B++,this._result=this._state=void 0,this._subscribers=[],l!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof S?function(e,t){try{t(function(t){d(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var w=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},k=0,E=void 0,P=void 0,C=function(e,t){N[k]=e,N[k+1]=t,2===(k+=2)&&(P?P(i):I())},T="undefined"!=typeof window?window:void 0,R=T||{},O=R.MutationObserver||R.WebKitMutationObserver,M="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3),I=void 0;I=M?function(){return t.nextTick(i)}:O?function(){var e=0,t=new O(i),o=document.createTextNode("");return t.observe(o,{characterData:!0}),function(){o.data=e=++e%2}}():A?function(){var e=new MessageChannel;return e.port1.onmessage=i,function(){return e.port2.postMessage(0)}}():void 0===T?function(){try{var e=o(38);return void 0!==(E=e.runOnLoop||e.runOnContext)?function(){E(i)}:n()}catch(e){return n()}}():n();var x=Math.random().toString(36).substring(16),D=void 0,F=1,L=2,U=new b,j=new b,B=0;return _.prototype._enumerate=function(){for(var e=this.length,t=this._input,o=0;this._state===D&&o<e;o++)this._eachEntry(t[o],o)},_.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,r=o.resolve;if(r===s){var n=c(e);if(n===a&&e._state!==D)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(o===S){var i=new o(l);u(i,e,n),this._willSettleAt(i,t)}else this._willSettleAt(new o(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},_.prototype._settledAt=function(e,t,o){var r=this.promise;r._state===D&&(this._remaining--,e===L?h(r,o):this._result[t]=o),0===this._remaining&&f(r,this._result)},_.prototype._willSettleAt=function(e,t){var o=this;m(e,void 0,function(e){return o._settledAt(F,t,e)},function(e){return o._settledAt(L,t,e)})},S.all=function(e){return new _(this,e).promise},S.race=function(e){var t=this;return new t(w(e)?function(o,r){for(var n=e.length,i=0;i<n;i++)t.resolve(e[i]).then(o,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},S.resolve=s,S.reject=function(e){var t=new this(l);return h(t,e),t},S._setScheduler=function(e){P=e},S._setAsap=function(e){C=e},S._asap=C,S.prototype={constructor:S,then:a,catch:function(e){return this.then(null,e)}},S.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var o=null;try{o=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===o&&!t.cast)return}e.Promise=S},S.Promise=S,S})}).call(t,o(27),o(37))},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"DEPENDENCY_ERROR"},t}(n.PlayerFatalError);t.DependencyError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t,o){return e.call(this,t,o)||this}return r(t,e),t.prototype.getCode=function(){return"IMPLEMENTATION_ERROR"},t}(n.PlayerFatalError);t.ImplementationError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t){return e.call(this,t||"The player cannot play the provided descriptor.")||this}return r(t,e),t.prototype.getCode=function(){return"NOT_SUPPORTED_ERROR"},t}(n.PlayerFatalError);t.NotSupportedError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(4),i=function(e){function t(t,o,r){void 0===r&&(r="The player that the proxy was controlling had an error.");var n=e.call(this,r)||this;return n._providedPlayerError=t,n._providedPlayer=o,n}return r(t,e),t.prototype.getCode=function(){return"PROXY_PLAYER_PROVIDED_PLAYER_ERROR"},t.prototype.getProvidedPlayerError=function(){return this._providedPlayerError},t.prototype.getProvidedPlayer=function(){return this._providedPlayer},t}(n.PlayerError);t.ProxyProvidedPlayerError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),n=o(18);t.abortedError=new Error("Job aborted.");var i=function(){function e(e,t){void 0===t&&(t={}),this._job=e,this._opts=t,this._counter=0,this._jobControl=null,this._promise=null,this._jobCompleted=!1}return e.prototype.run=function(){var e=this;this._jobControl||(this._jobControl=this._job(),this._promise=this._jobControl.result,n.always(this._promise,function(){e._jobCompleted=!0,!1===e._opts.storeResult&&(e._jobCompleted=!1,e._promise=null,e._jobControl=null)}));var o=this._promise;this._counter++;var i=r.buildDeferred(),a=!1,s=!1,l=[],c=[];return n.always(o,function(){s||(a=!0,e._counter--)}),o.then(function(e){s||(l.forEach(function(t){try{t(e)}catch(e){window.setTimeout(function(){throw e},0)}}),i.resolve(e))},function(e){s||(c.forEach(function(t){return t(e)}),i.reject(e))}),{whenComplete:function(){return i.promise},onCompletion:function(e){l.push(e)},onError:function(e){c.push(e)},hasCompleted:function(){return a},abort:function(o){s||a||(s=!0,0==--e._counter&&!e._jobCompleted&&e._jobControl&&e._jobControl.abort&&(e._jobControl.abort(o),e._promise=null,e._jobControl=null),c.forEach(function(e){return e(t.abortedError)}),i.reject(t.abortedError))}}},e}();t.AbortableJob=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.always=function(e,t){return e.then(t,t)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="undefined"!=typeof navigator?navigator.userAgent:"",n=!/chrome|opera/i.test(r)&&/safari/i.test(r),i=r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0,a=r.indexOf("Edge/")>=0,s=r.toLowerCase().indexOf("firefox")>=0,l=/version\/(\d+)\.(\d+)/i,c=/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)/;t.isSafari=function(){return n},t.isFirefox=function(){return s},t.getSafariVersion=function(){var e=navigator.appVersion.match(l);if(e&&e.length>=3){var t=parseInt(e[1],10),o=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(o))return{major:t,minor:o}}return null},t.isIE=function(){return i},t.isEdge=function(){return a},t.getChromeVersion=function(){var e=navigator.appVersion.match(c);if(e&&e.length>=3){var t=parseInt(e[1],10),o=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(o))return{major:t,minor:o}}return null}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(6),n=function(){function e(e,t){this._inCallback=!1,this._onExit=e,this._onEnter=t||null}return e.prototype.enter=function(e){var t=this;if(this._inCallback)return e?e(this._onEnterResultRetriever):void 0;this._inCallback=!0;var o=[],n=!1;this._onEnter&&(this._onEnterResultRetriever={getResult:function(e){n?r.deferException(function(){return e(t._onEnterError,t._onEnterResult)}):o.push(e)}});try{var i=e?e(this._onEnterResultRetriever):void 0;if(this._onEnter){this._onEnterError=void 0,this._onEnterResult=void 0;try{this._onEnterResult=this._onEnter()}catch(e){this._onEnterError=e}n=!0,o.forEach(function(e){return r.deferException(function(){return e(t._onEnterError,t._onEnterResult)})})}return i}finally{this._inCallback=!1,r.deferException(function(){return t._onExit(t._onEnterError,t._onEnterResult)})}},e}();t.OnExit=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,o,r){void 0===r&&(r={}),this._url=e,this._protocol=t,this._format=o,this._segmentFormat=r}return e.prototype.getUrl=function(){return this._url},e.prototype.getProtocol=function(){return this._protocol},e.prototype.getFormat=function(){return this._format},e.prototype.getSegmentFormat=function(){return this._segmentFormat},e}();t.Descriptor=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(13),n=o(15),i=o(28),a=o(14),s=o(5),l=o(4),c=o(0);!function(e){e.PlayerError=l.PlayerError,e.PlayerFatalError=c.PlayerFatalError,e.DependencyError=r.DependencyError,e.NotSupportedError=n.NotSupportedError,e.URLUpdateError=i.URLUpdateError,e.ImplementationError=a.ImplementationError,e.ProxyProvidedPlayerFatalError=s.ProxyProvidedPlayerFatalError}(t.errors||(t.errors={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),n=o(17),i=o(33),a=o(20),s=o(7),l=o(30),c=o(8),u=o(32),d=o(18),p=o(31),f=o(29),h=o(6),m=o(19),g=o(34);!function(e){e.OnExit=a.OnExit,e.find=s.find,e.Promise=u.Promise,e.always=d.always,e.compact=p.compact,e.deferException=h.deferException,function(e){e.buildCache=l.buildCache}(e.cache||(e.cache={})),function(e){e.buildDeferred=r.buildDeferred}(e.deferred||(e.deferred={})),function(e){e.getExtension=g.getExtension,e.buildAbsoluteUrl=g.buildAbsoluteUrl}(e.url||(e.url={})),function(e){e.AbortableJob=n.AbortableJob,e.abortedError=n.abortedError}(e.abortableJob||(e.abortableJob={})),function(e){e.noMoreAttemptsError=i.noMoreAttemptsError,e.retry=i.retry,e.buildExponentialDelayCalculator=i.buildExponentialDelayCalculator}(e.retry||(e.retry={})),function(e){e.isSafari=m.isSafari,e.getSafariVersion=m.getSafariVersion,e.isIE=m.isIE,e.isEdge=m.isEdge,e.isFirefox=m.isFirefox,e.getChromeVersion=m.getChromeVersion}(e.browser||(e.browser={})),function(e){e.combine=f.combine,e.numberToUint8Array=f.numberToUint8Array,e.createVintBuffer=f.createVintBuffer}(e.arrayBuffer||(e.arrayBuffer={})),function(e){e.now=c.now}(e.time||(e.time={}))}(t.helpers||(t.helpers={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),n=o(1),i=function(){function e(){this._aborted=!1,this._requestStarted=!1,this._response=null,this._responseDeferred=r.buildDeferred(),this._requestStartedDeferred=r.buildDeferred(),this._onRequestStart=new n.EventDispatcher,this.onRequestStart=this._onRequestStart.getHandle(),this.whenRequestStarted=this._requestStartedDeferred.promise}return e.prototype.getResponse=function(){return this._responseDeferred.promise},e.prototype.hasRequestStarted=function(){return this._requestStarted},e.prototype.hasCompleted=function(){return!!this._response||this._aborted},e.prototype.abort=function(){if(!this._aborted){if(this._aborted=!0,this._response)throw new Error("Already have a response.");this._abort(),this._responseDeferred.reject(new Error("Aborted.")),this._requestStarted||this._requestStartedDeferred.reject(new Error("Aborted."))}},e.prototype._provideResponse=function(e){if(this._aborted)throw new Error("Response aborted.");if(this._response)throw new Error("Response already provided.");if(e instanceof Error)this._aborted=!0,this._responseDeferred.reject(e);else{if(!this._requestStarted)throw new Error("Request hasn't started yet.");this._response=e,this._responseDeferred.resolve(e)}},e.prototype._signalRequestStart=function(){if(this._aborted)throw new Error("Response aborted.");if(this._requestStarted)throw new Error("Request already started.");this._requestStarted=!0,this._requestStartedDeferred.resolve(void 0),this._onRequestStart.dispatch(void 0)},e}();t.LoaderRequest=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=o(3),a=o(10),s=o(5),l=function(e){function t(t){var o=e.call(this,t)||this;return o._onPlayerProvided=new n.EventDispatcher,o._onPlayerRemoved=new n.EventDispatcher,o._shouldPassThroughFatalErrors=!!t.shouldPassThroughFatalErrors,o.onPlayerProvided=o._onPlayerProvided.getHandle(),o.onPlayerRemoved=o._onPlayerRemoved.getHandle(),o._logger=i.prefixLogger(o._logger,"ProxyPlayer"),o}return r(t,e),t.prototype.providePlayer=function(e,t){void 0===t&&(t={syncPosition:!0,syncVolume:!0}),this._providePlayer(e,t),this._onPlayerProvided.dispatch(e)},t.prototype.removePlayer=function(){var e=this._getPlayer();if(!e)throw new Error("There is no player to remove.");this._removePlayer(),this._onPlayerRemoved.dispatch(e)},t.prototype.setInitialDuration=function(e){this._setInitialDuration(e)},t.prototype.getPlayer=function(){return this._getPlayer()},t.prototype._handleFatalError=function(e,t){this._shouldPassThroughFatalErrors?this._triggerError(e):this._triggerError(new s.ProxyProvidedPlayerFatalError(e,t))},t}(a.ProxyPlayerBase);t.ProxyPlayer=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(this.start=e,this.duration=t,t<0)throw new RangeError("Duration must be >= 0.");this.end=e+t}return e.normalizeRawTimeRanges=function(e){return e.slice(0).sort(function(e,t){return e.start-t.start}).reduce(function(e,t,o){var r=e.length-1;return o>0&&e[r].end>=t.start?e[r].end=t.end:e.push(t),e},[])},e.normalize=function(t){return e.normalizeRawTimeRanges(t.map(function(e){return{start:e.start,end:e.end}})).map(function(t){return new e(t.start,t.end-t.start)})},e.getCoverage=function(t){if(0===t.length)return new e(0,0);var o=1/0,r=0;return t.forEach(function(e){e.start<o&&(o=e.start),e.end>r&&(r=e.end)}),new e(o,r-o)},e.rangesContainTime=function(e,t){return t.some(function(t){return t.containsTime(e)})},e.prototype.containsTime=function(e){return this.start<=e&&this.end>e},e}();t.TimeRange=r},function(e,t){function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===o||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(){h&&p&&(h=!1,p.length?f=p.concat(f):m=-1,f.length&&a())}function a(){if(!h){var e=n(i);h=!0;for(var t=f.length;t;){for(p=f,f=[];++m<t;)p&&p[m].run();m=-1,t=f.length}p=null,h=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var c,u,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:o}catch(e){c=o}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var p,f=[],h=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];f.push(new s(e,t)),1!==f.length||h||n(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t,o){return e.call(this,t||"The URL update failed for some reason.",o)||this}return r(t,e),t.prototype.getCode=function(){return"URL_UPDATE_ERROR"},t}(n.PlayerFatalError);t.URLUpdateError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.combine=function(e){var t=new Uint8Array(e.reduce(function(e,t){return e+t.byteLength},0)),o=0;return e.forEach(function(e){t.set(e,o),o+=e.byteLength}),t},t.numberToUint8Array=function(e,t){if(void 0===t&&(t=!1),(e=Math.round(e))<0)throw new Error("Negative numbers not supported.");for(var o=Math.max(1,Math.ceil(Math.log(e+1)/Math.log(2)/8)),r=new Uint8Array(o),n=0;n<o;n++)r[t?n:o-1-n]=255&e,e>>>=8;return r},t.createVintBuffer=function(e){if(e<0||e>Math.pow(2,53))throw new Error("Unrepresentable value: "+e);var t;for(t=1;t<=8&&!(e<Math.pow(2,7*t)-1);t++);for(var o=new Uint8Array(t),r=1;r<=t;r++){var n=255&e;o[t-r]=n,e-=n,e/=Math.pow(2,8)}return o[0]|=1<<8-t,o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(7),n="undefined"!=typeof window&&"Map"in window;t.buildCache=function(){return n?new window.Map:new i};var i=function(){function e(){this._store=[]}return e.prototype.set=function(e,t){var o=r.find(this._store,function(t){return t.key===e});o?o.val=t:this._store.push({key:e,val:t})},e.prototype.get=function(e){var t=r.find(this._store,function(t){return t.key===e});if(t)return t.val},e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compact=function(e){return e.filter(function(e){return null!=e})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(12);t.Promise=r.Promise},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(17),n=o(2);t.noMoreAttemptsError=new Error("No more attempts remaining."),t.retry=function(e,o,i,a){return void 0===i&&(i=window.setTimeout),void 0===a&&(a=window.clearTimeout),new r.AbortableJob(function(){var r=n.buildDeferred(),s=0,l=null,c=null,u=function(){(l=e(s).run()).onCompletion(function(e){if(l=null,e.success)r.resolve(e.result);else{var n=o(++s);null!==n&&n<0?r.reject(new Error("Delay must be null or >= 0.")):null===n?r.reject(t.noMoreAttemptsError):c=i(function(){c=null,u()},n)}}),l.onError(function(e){l=null,r.reject(e)})};return u(),{result:r.promise,abort:function(){l&&l.abort(),c&&a(c)}}}).run()},t.buildExponentialDelayCalculator=function(e){var t=void 0===e?{}:e,o=t.timeBase,r=void 0===o?500:o,n=t.threshold,i=void 0===n?3:n,a=t.delayCap,s=void 0===a?45e3:a,l=t.jitter,c=void 0===l?200:l,u=t.maxAttempts,d=void 0===u?null:u;if(r<=0)throw new Error("Time base must be > 0.");if(i<=0)throw new Error("Threshold must be > 0.");if(0===s)throw new Error("Delay cap must be null or > 0.");if(null!==d&&d<1)throw new Error("Max attempts must be >= 1.");return function(e){if(null!==d&&e>=d)return null;var t=e>0?Math.pow(2,e/i-1):0;return Math.min(t*r,s||1/0)+Math.round(Math.random()*c)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(36),n=/^.*\.([^\.;\?#]*).*$/;t.getExtension=function(e){var t=n.exec(e);return t?t[1].toLowerCase():null},t.buildAbsoluteUrl=function(e,t){return r.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}},function(e,t,o){"use strict";function r(e){var t=Object.create(null);return Object.keys(e).forEach(function(o){t[o]=e[o]}),t}Object.defineProperty(t,"__esModule",{value:!0});var n=o(20),i=o(6),a=function(){},s=function(){function e(e,t){void 0===t&&(t={});var o=this;this._subscribers=[],this._onExit=new n.OnExit(function(){return o._after()},function(){return o._onEnter()}),this._beforeUpdateError=void 0,this._inAfterUpdate=!1,this._dead=!1,this._officiallyDead=!1,this._errors=[],this._state=r(e),this._initialState=r(e),this._beforeUpdate=t.beforeUpdate||function(){},this._afterUpdate=t.afterUpdate||a,this._afterDispatches=t.afterDispatches||a}return e.prototype.subscribe=function(e,t){var o=this;if(void 0===t&&(t=!0),this._dead){var n=!1;return{retrieve:function(){},remove:function(){return!n&&(n=!0)}}}var i={callback:e,localState:t?r(this._state):this._initialState};return this._subscribers.push(i),t||this._updateSubscriber(i),{remove:function(){var t=o._subscribers.map(function(e){return e.callback}).indexOf(e);return t>=0&&(o._subscribers.splice(t,1),!0)},retrieve:function(){o._updateSubscriber(i)}}},e.prototype.subscribeIndividual=function(e,t,o){return this.subscribe(function(o){var r=o[e];void 0!==r&&t(r)},o)},e.prototype.getHandle=function(){return{subscribe:this.subscribe.bind(this)}},e.prototype.getIndividualHandle=function(e){var t=this;return{subscribe:function(o){return t.subscribeIndividual(e,o)}}},e.prototype.update=function(e){var t=this;this._officiallyDead||(this._inAfterUpdate?e&&e(this._state,this._beforeUpdateError):this._onExit.enter(function(o){o.getResult(function(){try{e&&e(t._state,t._beforeUpdateError)}catch(e){t._errors.push(e)}})}))},e.prototype.getState=function(){return this._state},e.prototype.kill=function(){var e=this;this._dead||(this._dead=!0,window.setTimeout(function(){e._subscribers.splice(0),e._officiallyDead=!0},0))},e.prototype.isDead=function(){return this._dead},e.prototype._onEnter=function(){this._beforeUpdateError=void 0;try{this._beforeUpdate(this._state)}catch(e){this._beforeUpdateError=e}},e.prototype._after=function(){var e=this,t=this._errors;this._errors=[],i.deferException(function(){e._inAfterUpdate=!0;try{e._afterUpdate(e._state,{beforeUpdate:e._beforeUpdateError,update:t})}catch(t){throw e._inAfterUpdate=!1,t}e._inAfterUpdate=!1,e._subscribers.slice().forEach(function(t){return e._updateSubscriber(t)}),e._afterDispatches(e._state)})},e.prototype._updateSubscriber=function(e){var t=this._calculateDiff(e.localState);Object.keys(t).length&&(e.localState=r(this._state),i.deferException(function(){return e.callback(t,e.localState)}))},e.prototype._calculateDiff=function(e){var t=this,o=Object.create(null);return Object.keys(this._state).forEach(function(r){var n=t._state[r];n!==e[r]&&(o[r]=n)}),o},e}();t.StateManager=s},function(e,t,o){!function(t){var o=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/;?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,a={buildAbsoluteURL:function(e,t,o){if(o=o||{},e=e.trim(),!(t=t.trim())){if(!o.alwaysNormalize)return e;var n=this.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return n.path=a.normalizePath(n.path),a.buildURLFromParts(n)}var i=this.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return o.alwaysNormalize?(i.path=a.normalizePath(i.path),a.buildURLFromParts(i)):t;var s=this.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=r.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var c={scheme:s.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(c.netLoc=s.netLoc,"/"!==i.path[0]))if(i.path){var u=s.path,d=u.substring(0,u.lastIndexOf("/")+1)+i.path;c.path=a.normalizePath(d)}else c.path=s.path,i.params||(c.params=s.params,i.query||(c.query=s.query));return null===c.path&&(c.path=o.alwaysNormalize?a.normalizePath(i.path):i.path),a.buildURLFromParts(c)},parseURL:function(e){var t=o.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=a}()},function(e,t){var o;o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(o=window)}e.exports=o},function(e,t){},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085;var r=o(1),n=o(24),i=o(3),a=o(25);t.ProxyPlayer=a.ProxyPlayer;var s=o(10);t.ProxyPlayerBase=s.ProxyPlayerBase;var l=o(22);t.errors=l.errors;var c=o(23);t.helpers=c.helpers;var u=o(9);t.BasePlayer=u.BasePlayer;var d=o(21);t.Descriptor=d.Descriptor;var p=o(11);t.State=p.State;var f=o(26);t.TimeRange=f.TimeRange,function(e){e.EventDispatcher=r.EventDispatcher}(t.eventDispatcher||(t.eventDispatcher={})),function(e){e.LoaderRequest=n.LoaderRequest}(t.loader||(t.loader={})),function(e){e.noOpLogger=i.noOpLogger,e.consoleLogger=i.consoleLogger,e.prefixLogger=i.prefixLogger,e.cloneLogger=i.cloneLogger}(t.logger||(t.logger={}))}])},function(e,t,o){e.exports=function(e,t,o){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(t,o){t.exports=e},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.MSE_ERROR"},t}(n.errors.PlayerFatalError);t.MSEError=i},function(e,o){e.exports=t},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=function(e){function t(t){return e.call(this,"An error occurred trying to append to the buffer.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.APPEND_ERROR"},t}(n.MSEError);t.AppendError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=function(e){function t(t){return e.call(this,"An error occurred trying to initialize the buffer.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.INITIALIZE_ERROR"},t}(n.MSEError);t.InitializeError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return e.call(this,"A format could not be determined.")||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.NO_FORMAT_DETERMINED_ERROR"},t}(n.errors.NotSupportedError);t.NoFormatDeterminedError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return e.call(this,"A transmuxer could not be found.")||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.NO_TRANSMUXER_ERROR"},t}(n.errors.NotSupportedError);t.NoTransmuxerError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t){var o=e.call(this,"An error occurred when trying to retrieve a segment/key.",t)||this;return o._internalRetrievalError=t,o}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.RETRIEVAL_ERROR."+this._internalRetrievalError.getCode()},t}(n.errors.PlayerError);t.RetrievalError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return e.call(this,"The playlist type is not supported.")||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.UNSUPPORTED_PLAYLIST_TYPE_ERROR"},t}(n.errors.PlayerFatalError);t.UnsupportedPlaylistTypeError=i},function(e,t){e.exports=o},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(3),n=o(4),i=o(1),a=o(5),s=o(6),l=o(7),c=o(8);!function(e){e.AppendError=r.AppendError,e.InitializeError=n.InitializeError,e.MSEError=i.MSEError,e.NoFormatDeterminedError=a.NoFormatDeterminedError,e.NoTransmuxerError=s.NoTransmuxerError,e.RetrievalError=l.RetrievalError,e.UnsupportedPlaylistTypeError=c.UnsupportedPlaylistTypeError}(t.errors||(t.errors={}))},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(2),a=o(9),s=o(12),l=o(13),c=o(8),u=o(3),d=o(4),p=o(7),f=o(6),h=o(5),m=n.helpers.find,g=n.helpers.Promise,b=n.helpers.time.now,v=n.helpers.deferred.buildDeferred,y=n.errors.DependencyError,_=n.errors.PlayerFatalError,S=n.errors.URLUpdateError,w=n.eventDispatcher.EventDispatcher,k=n.logger.prefixLogger,E=n.helpers.abortableJob.abortedError,P=n.helpers.browser.getSafariVersion(),C=n.helpers.browser.isSafari(),T=n.helpers.browser.isFirefox(),R=n.helpers.browser.isEdge(),O=function(e){function t(t,o){var r=e.call(this,t,o)||this;return r._onPlaylistRequestQueued=new w,r._onPlaylistRequestStart=new w,r._onPlaylistRetrieved=new w,r._onPlaylistRequestFailed=new w,r._onInitDataRequestQueued=new w,r._onInitDataRequestStart=new w,r._onInitDataRetrieved=new w,r._onInitDataRequestFailed=new w,r._onKeyRequestQueued=new w,r._onKeyRequestStart=new w,r._onKeyRetrieved=new w,r._onKeyRequestFailed=new w,r._onPlaylistParseStart=new w,r._onPlaylistParseEnd=new w,r._onSegmentRequestQueued=new w,r._onSegmentRequestStart=new w,r._onSegmentRetrieved=new w,r._onSegmentRequestFailed=new w,r._onSegmentTransmuxStart=new w,r._onSegmentTransmuxEnd=new w,r._onSegmentDecryptionStart=new w,r._onSegmentDecryptionEnd=new w,r._onSegmentReady=new w,r._onSegmentAppendQueued=new w,r._onSegmentAppendEnd=new w,r._playlist=null,r._playlistSegmentRetriever=null,r._initialPlaylistRetrieveCompleted=!1,r._mse=null,r._simpleMSE=null,r._retrieveDurationDeferred=v(),r._html5PlayerReady=!1,r._startPositionOffset=0,r._transmuxerAndMSEType=null,r._lastSegmentAppended=null,r._maxBufferLength=null,r._cacheSize=null,r._onFirstSegmentRetrieved=null,r._seekAttemptTimer=null,r._seekMetadataEventHandle=null,r._playlistDuration=null,r._logger=k(r._logger,"HLSMSEPlayer"),r.onPlaylistRequestQueued=r._onPlaylistRequestQueued.getHandle(),r.onPlaylistRequestStart=r._onPlaylistRequestStart.getHandle(),r.onPlaylistRetrieved=r._onPlaylistRetrieved.getHandle(),r.onPlaylistRequestFailed=r._onPlaylistRequestFailed.getHandle(),r.onInitDataRequestQueued=r._onInitDataRequestQueued.getHandle(),r.onInitDataRequestStart=r._onInitDataRequestStart.getHandle(),r.onInitDataRetrieved=r._onInitDataRetrieved.getHandle(),r.onInitDataRequestFailed=r._onInitDataRequestFailed.getHandle(),r.onKeyRequestQueued=r._onKeyRequestQueued.getHandle(),r.onKeyRequestStart=r._onKeyRequestStart.getHandle(),r.onKeyRetrieved=r._onKeyRetrieved.getHandle(),r.onKeyRequestFailed=r._onKeyRequestFailed.getHandle(),r.onPlaylistParseStart=r._onPlaylistParseStart.getHandle(),r.onPlaylistParseEnd=r._onPlaylistParseEnd.getHandle(),r.onSegmentRequestQueued=r._onSegmentRequestQueued.getHandle(),r.onSegmentRequestStart=r._onSegmentRequestStart.getHandle(),r.onSegmentRetrieved=r._onSegmentRetrieved.getHandle(),r.onSegmentRequestFailed=r._onSegmentRequestFailed.getHandle(),r.onSegmentTransmuxStart=r._onSegmentTransmuxStart.getHandle(),r.onSegmentTransmuxEnd=r._onSegmentTransmuxEnd.getHandle(),r.onSegmentDecryptionStart=r._onSegmentDecryptionStart.getHandle(),r.onSegmentDecryptionEnd=r._onSegmentDecryptionEnd.getHandle(),r.onSegmentReady=r._onSegmentReady.getHandle(),r.onSegmentAppendQueued=r._onSegmentAppendQueued.getHandle(),r.onSegmentAppendEnd=r._onSegmentAppendEnd.getHandle(),r.__descriptor=t,r.__playerDependencies=o,r._url=t.getUrl(),r}return r(t,e),t.prototype.getBufferedTimeRanges=function(){var e=this._playlistSegmentRetriever;return e?n.TimeRange.normalize(e.getSegmentsWithData().map(function(e){return e.segment.getTimeRange()})):[]},t.prototype.getMaxBufferLength=function(){return this._maxBufferLength},t.prototype.getBufferController=function(){var e=this;return{setMaxBufferLength:function(t){if(t<0)throw new Error("Max buffer length cannot be < 0.");e._logger.debug("Updating max buffer length.",t),e._maxBufferLength=t,e._playlistSegmentRetriever?e._playlistSegmentRetriever.updateMaxBufferLength(t):e._logger.debug("Cannot update right now. Playlist segment retriever doesn't exist.")}}},t.prototype.getUrlController=function(){var e=this;return{updateUrl:function(t){e._logger.debug("Updating URL.",t),e._url=t;var o=e._playlist;return o?(e._playlistRetrieveJob&&(e._playlistRetrieveJob.abort(),e._playlistRetrieveJob=null,e._logger.debug("Aborted playlist retrieve job.")),e._playlistSegmentRetriever&&(e._playlistSegmentRetriever.switchPlaylist(null),e._logger.debug("Removed current URL.")),e._playlist=null,void e._retrievePlaylist()):void e._logger.debug("Cannot update right now. Playlist doesn't exist yet.")}}},t.prototype.getMemoryCacheMaxSize=function(){return null!==this._cacheSize?this._cacheSize:1e8},t.prototype.getMemoryCacheUsage=function(){return this._playlistSegmentRetriever?this._playlistSegmentRetriever.getCacheUsage():0},t.prototype.getMemoryCacheController=function(){var e=this;return{setMaxCacheSize:function(t){if(t<0)throw new Error("Max size cannot be < 0.");e._logger.debug("Updating maximum cache size.",t),e._cacheSize=t,e._playlistSegmentRetriever&&e._playlistSegmentRetriever.updateCacheSize(t)}}},t.prototype._canPlay=function(){var t=this;return s.MSE.isSupported()?e.prototype._canPlay.call(this).then(function(e){if(!0!==e)return g.resolve(e);var o=t.__descriptor.getSegmentFormat();if(!function(e){return void 0!==e.mimeType}(o))return t._logger.debug("Format could not be determined."),g.resolve(new h.NoFormatDeterminedError);var r=t._findTransmuxer(o);if(!r)return t._logger.debug("No transmuxer found."),g.resolve(new f.NoTransmuxerError);var n=r.getOutputFormat(),i=o;return t._transmuxerAndMSEType={transmuxer:r,mseType:t._buildMimeTypeAndCodecString(n,i)},g.resolve(!0)}):(this._logger.debug("MSE not supported."),g.resolve(!1))},t.prototype._canPlayProtocol=function(e){return"hls"===e.name},t.prototype._canPlayType=function(e){return"application/x-mpegURL"===e},t.prototype._retrieveDuration=function(){return this._retrieveDurationDeferred.promise},t.prototype._signalReady=function(){this._html5PlayerReady=!0,this._initialPlaylistRetrieveCompleted&&e.prototype._signalReady.call(this)},t.prototype._initialize=function(){var t=this.__playerDependencies;if(null===this._maxBufferLength)if(void 0!==t.maxBufferLength){if(t.maxBufferLength<0)return void this._triggerError(new y("maxBufferLength cannot be < 0."));this._maxBufferLength=t.maxBufferLength}else this._maxBufferLength=3e4;if(this._logger.debug("Initialized max buffer length.",this._maxBufferLength),null===this._cacheSize)if(void 0!==t.memoryCacheSize){if(t.memoryCacheSize<0)return void this._triggerError(new y("memoryCacheSize cannot be < 0."));this._cacheSize=t.memoryCacheSize}else this._cacheSize=1e8;this._logger.debug("Initialized cache size.",this._cacheSize),e.prototype._initialize.call(this),this._retrievePlaylist()},t.prototype._initMediaElement=function(t,o){if(this._simpleMSE&&(this._simpleMSE.kill(),this._simpleMSE=null,this._logger.debug("Killed SimpleMSE.")),this._mse&&(this._mse.kill(),this._mse=null,this._logger.debug("Killed MSE.")),null!==this._seekAttemptTimer&&(window.clearTimeout(this._seekAttemptTimer),this._seekAttemptTimer=null,this._logger.debug("Cancelled seek attempt timer.")),this._onFirstSegmentRetrieved=null,this._seekMetadataEventHandle&&(this._seekMetadataEventHandle.remove(),this._seekMetadataEventHandle=null),null===o)e.prototype._initMediaElement.call(this,t,null);else{this._initMSE();var r=this._mse.getUrl();this._logger.debug("Setting MSE url.",r),e.prototype._initMediaElement.call(this,t,r)}},t.prototype._shouldBeEnded=function(){if(!C)return e.prototype._shouldBeEnded.call(this);if(e.prototype._shouldBeEnded.call(this))return!0;if(!this.getMediaElement())return!1;var t=this._duration;return this._stallDetected&&null!==t&&this._getTruePosition()>=t-600},t.prototype._getTruePosition=function(){var e=this.getMediaElement();if(!e)throw new Error("Media element should exist.");return this._startPositionOffset+this._getMediaElementPosition()},t.prototype._handleSeekChange=function(t){e.prototype._handleSeekChange.call(this,t),this._playlistSegmentRetriever&&(this._logger.debug("Explicitly updating playlist segment retriever, as seek requested."),this._playlistSegmentRetriever.update(),this._findSegmentAndAppendToMSE())},t.prototype._performSeek=function(t,o){var r=this,n=this._simpleMSE,i=this._mse,a=this.getMediaElement();if(!i)throw new Error("MSE should exist.");if(!a)throw new Error("Media element should exist.");var s=!a.paused;null!==this._seekAttemptTimer&&(window.clearTimeout(this._seekAttemptTimer),this._seekAttemptTimer=null,this._logger.debug("Cancelled previous seek attempt timer.")),this._seekMetadataEventHandle&&(this._seekMetadataEventHandle.remove(),this._seekMetadataEventHandle=null,this._logger.debug("Removed previous loaded metadata event handler.")),n&&n.kill(),i.kill(),this._logger.debug("SimpleMSE and MSE destroyed."),this._startPositionOffset=t;var l=null;this._onFirstSegmentRetrieved=function(e){return l=e},this._logger.debug("Initializing MSE and SimpleMSE for new position."),this._initMSE();var c=this._mse.getUrl();if(this._logger.debug("Updated media element MSE src.",c),e.prototype._initMediaElement.call(this,a,c),s){this._logger.debug("Calling play() on media element as it was playing previously.");var u=a.play();u&&u.catch&&u.catch(function(e){"AbortError"!==e.name&&(r._logger.error("Unexpected play() error.",e),r._triggerError(new _("Exception from calling play() after seek.",e)))})}var d=function(e){(P&&P.major<11||T)&&e<50&&(r._logger.debug("Tweaking offset to fix glitch issue."),e=50);var t=function(){r._startPositionOffset=Math.max(0,r._startPositionOffset-e),r._logger.debug("Updated start position offset.",r._startPositionOffset,e);var t=function(){r._seekAttemptTimer=null,r._logger.debug("Attempting to seek to the required offset.",e),a.currentTime=e/1e3;var n=1e3*a.currentTime;Math.abs(n-e)<=100?(r._logger.debug("Seeked to the required offset.",n),o()):(r._logger.warn("Seek attempt failed. Trying again shortly.",n),r._seekAttemptTimer=window.setTimeout(t,50))};t()};r._onFirstSegmentRetrieved=null,R||a.readyState===a.HAVE_METADATA?(r._logger.debug("Media element has metadata. Seeking to offset."),t()):(r._logger.debug("Media element has not loaded metadata. Waiting for metadata..."),r._seekMetadataEventHandle=r._listenToOnce("loadedmetadata",function(){r._seekMetadataEventHandle=null,r._logger.debug("Got metadata. Seeking to offset."),t()},{earlyAttach:!0}))};null!==l?(this._logger.debug("First segment already retrieved. Preparing to seek to initial offset."),d(l)):(this._logger.debug("Waiting for first segment to be retrieved."),this._onFirstSegmentRetrieved=function(e){r._logger.debug("First segment retrieved. Preparing to seek to initial offset."),d(e)})},t.prototype._kill=function(){this._simpleMSE&&(this._logger.debug("Killing SimpleMSE."),this._simpleMSE.kill(),this._simpleMSE=null),this._mse&&(this._logger.debug("Killing MSE."),this._mse.kill(),this._mse=null),this._playlistRetrieveJob&&(this._logger.debug("Aborting playlist retrieve job."),this._playlistRetrieveJob.abort(),this._playlistRetrieveJob=null),this._playlistSegmentRetriever&&(this._logger.debug("Killing playlist segment retriever."),this._playlistSegmentRetriever.kill(),this._playlistSegmentRetriever=null),this._playlist=null,e.prototype._kill.call(this)},t.prototype._initMSE=function(){var e=this;if(!this._transmuxerAndMSEType)throw new Error("Transmuxer should have been configured.");this._lastSegmentAppended=null;var t=!1;P&&P.major<10&&this._transmuxerAndMSEType.transmuxer===i.MP3ToMP4Transmuxer&&(t=!0);var o=new s.MSE(this._transmuxerAndMSEType.mseType,this._logger,t),r=new l.SimpleMSE(o,function(){return e.getSegmentDataToAppendNext()},function(){return e._getMediaElementPosition()},function(t){e._triggerError(new u.AppendError(t))},this._logger);r.onAppendQueued.subscribe(this._onSegmentAppendQueued.dispatch),r.onAppendEnd.subscribe(this._onSegmentAppendEnd.dispatch),this._simpleMSE=r,r.start(),this._mse=o,o.whenInitialized().catch(function(t){t!==s.killedError&&(e._logger.error("Error during mse initialization.",t),e._triggerError(new d.InitializeError(t)))})},t.prototype._getMediaElementPosition=function(){var e=this.getMediaElement();if(!e)throw new Error("No media element.");return 1e3*e.currentTime},t.prototype._whenPlaylistRetrieved=function(){var t=this,o=this._playlist;if(!o)throw new Error("Playlist should have been retrieved.");var r=!this._initialPlaylistRetrieveCompleted;if(r)this._initialPlaylistRetrieveCompleted=!0,this._playlistDuration=o.getTotalDuration(),this._retrieveDurationDeferred.resolve(this._playlistDuration);else{var n=o.getTotalDuration();if(this._playlistDuration!==n)return this._logger.error("The duration from the new URL did not match the previous one."),void this._triggerError(new S("The duration from the new URL did not match the previous one.",{oldDuration:this._playlistDuration,newDuration:n}))}if(!this._transmuxerAndMSEType)throw new Error("Transmuxer should have been configured.");if(this._playlistSegmentRetriever)this._logger.debug("Switching playlist for playlist segment retriever."),this._playlistSegmentRetriever.switchPlaylist(o);else{var a=this._maxBufferLength;if(null===a)throw new Error("maxBufferLength should have been initiaized by now.");this._logger.debug("Creating playlist segment retriever.");var s=this._cacheSize;if(null===s)throw new Error("cacheSize should be set.");var l=new i.PlaylistSegmentRetriever({playlist:o,getPosition:function(){return t.getPosition()},maxBufferLength:a,cacheSize:s,transmuxer:this._transmuxerAndMSEType.transmuxer,logger:this._logger});l.onSegmentRequestQueued.subscribe(this._onSegmentRequestQueued.dispatch),l.onSegmentRequestStart.subscribe(this._onSegmentRequestStart.dispatch),l.onSegmentRetrieved.subscribe(this._onSegmentRetrieved.dispatch),l.onSegmentRequestFailed.subscribe(this._onSegmentRequestFailed.dispatch),l.onSegmentDecryptionStart.subscribe(this._onSegmentDecryptionStart.dispatch),l.onSegmentDecryptionEnd.subscribe(this._onSegmentDecryptionEnd.dispatch),l.onSegmentTransmuxStart.subscribe(this._onSegmentTransmuxStart.dispatch),l.onSegmentTransmuxEnd.subscribe(this._onSegmentTransmuxEnd.dispatch),this._playlistSegmentRetriever=l,l.onError.subscribe(function(e){t._logger.error("Error from playlist segment retriever.",e),e instanceof i.retrievalErrors.RetrievalError?t._triggerError(new p.RetrievalError(e)):t._triggerError(new _("Unexpected error when trying to retrieve segment.",e))}),l.onSegmentReady.subscribe(function(e){var o=e.eventRepresentation,r=b();t._logger.debug("Segment ready.",o),t._findSegmentAndAppendToMSE(),t._onSegmentReady.dispatch({segment:o},{time:r})})}this._initialPlaylistRetrieveCompleted=!0,r&&this._html5PlayerReady&&e.prototype._signalReady.call(this)},t.prototype._findSegmentAndAppendToMSE=function(){var e=this._simpleMSE;if(e&&e.waitingForSegmentData()){var t=this.getSegmentDataToAppendNext();t&&(this._logger.debug("Providing segment to SimpleMSE.",t.eventRepresentation),e.provideNextSegmentData(t))}},t.prototype._retrievePlaylist=function(){var e=this;if(this._playlist)throw new Error("Playlist already exists.");var t=this.__playerDependencies,o=t.playlistLoader,r=t.segmentLoader,n=t.keyLoader,a=t.isPlaylistResponseCodeAcceptable,s=t.isPlaylistResponseCodeRetryable,l=t.isSegmentResponseCodeAcceptable,u=t.isSegmentResponseCodeRetryable,d=t.isKeyResponseCodeAcceptable,f=t.isKeyResponseCodeRetryable;this._logger.debug("Creating playlist.",this._url);var h=new i.Playlist({url:this._url,segmentFormat:this.__descriptor.getSegmentFormat(),playlistLoader:o,segmentLoader:r,keyLoader:n,isPlaylistResponseCodeAcceptable:a,isPlaylistResponseCodeRetryable:s,isSegmentResponseCodeAcceptable:l,isSegmentResponseCodeRetryable:u,isKeyResponseCodeAcceptable:d,isKeyResponseCodeRetryable:f,logger:this._logger});h.onPlaylistRequestQueued.subscribe(this._onPlaylistRequestQueued.dispatch),h.onPlaylistRequestStart.subscribe(this._onPlaylistRequestStart.dispatch),h.onPlaylistRetrieved.subscribe(this._onPlaylistRetrieved.dispatch),h.onPlaylistRequestFailed.subscribe(this._onPlaylistRequestFailed.dispatch),h.onInitDataRequestQueued.subscribe(this._onInitDataRequestQueued.dispatch),h.onInitDataRequestStart.subscribe(this._onInitDataRequestStart.dispatch),h.onInitDataRetrieved.subscribe(this._onInitDataRetrieved.dispatch),h.onInitDataRequestFailed.subscribe(this._onInitDataRequestFailed.dispatch),h.onKeyRequestQueued.subscribe(this._onKeyRequestQueued.dispatch),h.onKeyRequestStart.subscribe(this._onKeyRequestStart.dispatch),h.onKeyRetrieved.subscribe(this._onKeyRetrieved.dispatch),h.onKeyRequestFailed.subscribe(this._onKeyRequestFailed.dispatch),h.onPlaylistParseStart.subscribe(this._onPlaylistParseStart.dispatch),h.onPlaylistParseEnd.subscribe(this._onPlaylistParseEnd.dispatch),this._playlist=h,this._playlistRetrieveJob=this._playlist.retrieve(),this._playlistRetrieveJob.onCompletion(function(){var t=e._playlist.getType();t!==i.PlaylistType.VOD?(e._logger.error("Unsupported playlist type.",t),e._triggerError(new c.UnsupportedPlaylistTypeError)):(e._logger.debug("Playlist retrieved."),e._whenPlaylistRetrieved())}),this._playlistRetrieveJob.onError(function(t){t!==E&&(e._logger.error("Error when retrieving playlist.",t),t instanceof i.retrievalErrors.RetrievalError?e._triggerError(new p.RetrievalError(t)):e._triggerError(new _("Unexpected error when retrieving playlist.",t)))})},t.prototype._findTransmuxer=function(e){var t=this,o=i.TransmuxerFactory.retrieveTransmuxers(e);this._logger.info("Finding a transmuxer...",e);var r=m(o,function(o){return s.MSE.isSupported(t._buildMimeTypeAndCodecString(o.getOutputFormat(),e))})||null;return r?this._logger.info("Transmuxer found.",r.getInputFormat(),r.getOutputFormat()):this._logger.warn("No transmuxer found."),r},t.prototype.getSegmentDataToAppendNext=function(){var e=this._lastSegmentAppended;this._logger.debug("Looking for segment to append next.",!!e);var t=this._playlistSegmentRetriever;if(!t)return this._logger.debug("No segment retriever."),null;if(e){var o=t.getSegmentsWithData(),r=o[o.map(function(e){return e.segment}).indexOf(e)+1];return r?(this._logger.debug("Found segment.",r.eventRepresentation),this._lastSegmentAppended=r.segment,{data:r.data,eventRepresentation:r.eventRepresentation}):(this._logger.debug("No segment found."),e.isFinalSegment()&&(this._logger.debug("The last segment we appended was the last one in the stream. Signalling EOS."),this._signalEOS()),null)}var n=this.getPosition(),r=m(t.getSegmentsWithData(),function(e){return e.segment.getTimeRange().containsTime(n)});if(!r)return this._logger.debug("No segment found.",n),null;var i=n-r.segment.getTimeRange().start,a=this.getMediaElement();if(!a)throw new Error("Media element should exist.");this._logger.debug("Found initial segment.",r.eventRepresentation),this._lastSegmentAppended=r.segment,this._onFirstSegmentRetrieved&&this._onFirstSegmentRetrieved(i);var s=r.data,l=r.initData,c=s;return l&&(this._logger.debug("Prepending init data."),(c=new Uint8Array(l.length+s.length)).set(l,0),c.set(s,l.length)),{data:c,eventRepresentation:r.eventRepresentation}},t.prototype._signalEOS=function(){var e=this;this._logger.debug("Signalling EOS."),this._simpleMSE&&(this._simpleMSE.kill(),this._logger.debug("Killed SimpleMSE."),this._simpleMSE=null);var t=this._mse;t&&!t.eosSignalled()&&t.signalEOS().catch(function(o){t===e._mse&&(e._logger.error("Error occurred when signalling EOS.",o),e._triggerError(new u.AppendError(o)))})},t}(a.HTML5Player);t.HLSMSEPlayer=O},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(9),i=r.helpers.deferred.buildDeferred,a=n.helpers.timeRanges.buildTimeRanges,s=r.helpers.Promise,l=r.logger.prefixLogger,c=r.logger.noOpLogger,u=/(MSIE )|(Trident\/)/,d=r.helpers.browser.isSafari(),p='audio/mp4; codecs="mp3"',f=r.helpers.browser.getSafariVersion(),h=r.helpers.browser.getChromeVersion();t.killedError=new Error("MSE killed.");var m=function(){function e(e,t,o){var r=this.constructor;if(void 0===t&&(t=c),void 0===o&&(o=!1),this._sourceBuffer=null,this._initialized=!1,this._initializeDeferred=i(),this._whenIdleDeferred=i(),this._error=null,this._dead=!1,this._eosSignalled=!1,this._pendingActions=[],this._currentAction=null,this._logger=l(t,"MSE"),this._onMediaSourceInit=this._onMediaSourceInit.bind(this),this._onMediaSourceEnded=this._onMediaSourceEnded.bind(this),this._onMediaSourceError=this._onMediaSourceError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),!r.isSupported(e))throw this._logger.error("Not supported."),new Error("Not supported.");d&&e===p&&(e="audio/mp4"),this._type=e,this._useSegmentsMode=o,this._mediaSource=new MediaSource,this._mediaSource.addEventListener("sourceopen",this._onMediaSourceInit,!1),this._mediaSource.addEventListener("error",this._onMediaSourceError,!1),this._url=URL.createObjectURL(this._mediaSource),this._logger.debug("Created URL.",this._url)}return e.isSupported=function(e){return!u.test(window.navigator.userAgent)&&"MediaSource"in window&&(!e||!(!d||e!==p)||!(f&&f.major<10&&"audio/mpeg"===e)&&!(h&&h.major<50&&'audio/webm; codecs="opus"'===e)&&MediaSource.isTypeSupported(e))},e.prototype.whenInitialized=function(){return this._initializeDeferred.promise},e.prototype.whenIdle=function(){return this._whenIdleDeferred?this._whenIdleDeferred.promise:s.resolve(void 0)},e.prototype.isIdle=function(){return this._dead||!this._whenIdleDeferred},e.prototype.hasInitialized=function(){return this._initialized},e.prototype.getError=function(){return this._error},e.prototype.getUrl=function(){return this._ensureNotDead(),this._url},e.prototype.getBuffered=function(){return this._ensureNotDead(),this._sourceBuffer?a(this._sourceBuffer.buffered):[]},e.prototype.append=function(e){this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("append() called.");var t=i();return this._pendingActions.push({type:"append",data:e,deferred:t}),this._performNextAction(),t.promise},e.prototype.remove=function(e){if(0===e.duration)throw new Error("Remove range must have a duration > 0.");this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("remove() called.",e);var t=i();return this._pendingActions.push({type:"remove",range:e,deferred:t}),this._performNextAction(),t.promise},e.prototype.signalEOS=function(){this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("signalEOS() called."),this._eosSignalled=!0;var e=i();return this._pendingActions.push({type:"eos",deferred:e}),this._performNextAction(),e.promise},e.prototype.eosSignalled=function(){return this._eosSignalled},e.prototype.kill=function(){if(!this._dead){if(this._logger.debug("kill() called."),this._dead=!0,this._sourceBuffer){this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._sourceBuffer.removeEventListener("error",this._onSourceBufferError,!1);try{this._mediaSource.removeSourceBuffer(this._sourceBuffer)}catch(e){this._logger.error("Error from removeSourceBuffer()",e)}}this._mediaSource.removeEventListener("sourceopen",this._onMediaSourceInit,!1),this._mediaSource.removeEventListener("sourceended",this._onMediaSourceEnded,!1),this._mediaSource.removeEventListener("error",this._onMediaSourceError,!1),URL.revokeObjectURL(this._url);var e=this._currentAction?[this._currentAction]:[];(e=e.concat(this._pendingActions)).forEach(function(e){e.deferred.reject(t.killedError)}),this._whenIdleDeferred||(this._whenIdleDeferred=i()),this._whenIdleDeferred.reject(t.killedError),this._initialized||this._initializeDeferred.reject(this._error||t.killedError),this._pendingActions.length=0,this._logger.debug("Killed.")}},e.prototype._ensureInitialized=function(){if(!this._initialized)throw new Error("Not initialized yet.")},e.prototype._ensureNotEOS=function(){if(this._eosSignalled)throw new Error("EOS signalled.")},e.prototype._ensureNotDead=function(){if(this._dead)throw new Error("MSE is dead.")},e.prototype._onMediaSourceInit=function(){this._logger.debug("MSE initialized."),this._mediaSource.removeEventListener("sourceopen",this._onMediaSourceInit,!1);try{this._logger.debug("Creating source buffer.",this._type),this._sourceBuffer=this._mediaSource.addSourceBuffer(this._type),this._sourceBuffer.mode=this._useSegmentsMode?"segments":"sequence",this._logger.debug("Using append mode: "+this._sourceBuffer.mode),this._sourceBuffer.addEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._sourceBuffer.addEventListener("error",this._onSourceBufferError,!1)}catch(e){this._handleError(e)}this._initializeDeferred.resolve(void 0),this._whenIdleDeferred.resolve(void 0),this._initialized=!0,this._performNextAction()},e.prototype._onMediaSourceEnded=function(){this._onSourceBufferUpdateEnd()},e.prototype._onMediaSourceError=function(e){this._handleError(e)},e.prototype._handleError=function(e){this._ensureNotDead(),this._logger.error("Error occurred.",e),this._error=e||new Error("Unknown error."),this.kill()},e.prototype._onSourceBufferUpdateEnd=function(){var e=this._currentAction;return this._logger.debug("Update ended.",this.getBuffered()),e?"append"===e.type&&0===r.TimeRange.getCoverage(this.getBuffered()).end?void this._handleError(new Error("Buffer end point is still 0 after an append.")):(this._currentAction=null,e.deferred.resolve(void 0),void this._performNextAction()):void this._handleError(new Error("No action in progress."))},e.prototype._onSourceBufferError=function(e){this._handleError(e)},e.prototype._performNextAction=function(){var e=this._whenIdleDeferred;if(!this._currentAction&&this._sourceBuffer){var t=this._pendingActions.shift();if(!t)return this._logger.debug("No more actions."),void(e&&(this._whenIdleDeferred=null,e.resolve(void 0)));switch(e||(this._whenIdleDeferred=i()),this._currentAction=t,this._logger.debug("Performing next action..."),t.type){case"append":var o=r.TimeRange.getCoverage(this.getBuffered());try{if("segments"===this._sourceBuffer.mode){var n=o.end/1e3;this._logger.debug("Setting timestampOffset because detected safari.",n),this._sourceBuffer.timestampOffset=n}this._logger.debug("Calling appendBuffer()."),this._sourceBuffer.appendBuffer(t.data)}catch(e){this._handleError(e)}break;case"remove":try{var a=t.range;this._logger.debug("Calling remove().",a.start,a.end),this._sourceBuffer.remove(a.start/1e3,a.end/1e3)}catch(e){this._handleError(e)}break;case"eos":try{this._logger.debug("Calling endOfStream()."),this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._mediaSource.addEventListener("sourceended",this._onMediaSourceEnded,!1),this._mediaSource.endOfStream()}catch(e){this._handleError(e)}}}},e}();t.MSE=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.Promise,i=r.eventDispatcher.EventDispatcher,a=r.logger.prefixLogger,s=r.logger.noOpLogger,l=function(){function e(e,t,o,r,n){void 0===n&&(n=s);var l=this;this._onAppendQueued=new i,this._onAppendEnd=new i,this._updateTimerId=null,this._gcTimerId=null,this._waitingForData=!1,this._started=!1,this._resettingPromise=null,this._error=null,this._logger=a(n,"SimpleMSE"),this.onAppendQueued=this._onAppendQueued.getHandle(),this.onAppendEnd=this._onAppendEnd.getHandle(),this._mse=e,this._getNextSegmentData=t,this._getPosition=o,this._onError=r,e.whenInitialized().then(function(){!l._error&&l._started&&(l._logger.debug("MSE initialized. Preparing to update."),l._prepareUpdate())}).catch(function(e){l._error||(l._logger.error("Error when waiting for MSE to initialize.",e),l._handleError(e||new Error("Error waiting for MSE to initialize.")))})}return e.prototype.start=function(){if(this._checkNotErrored(),this._resettingPromise)throw new Error("start() is not allowed whilst a reset is in progress.");if(this._started)throw new Error("Already started. reset() first.");this._logger.debug("start() called."),this._scheduleGC(),this._started=!0,this._prepareUpdate()},e.prototype.kill=function(){this._error||(this._logger.debug("kill() called."),this._clearTimers(),this._error=new Error("Killed."),this._logger.debug("Killed."))},e.prototype.reset=function(){var e=this;if(this._checkNotErrored(),this._logger.debug("reset() called."),this._resettingPromise)return this._logger.debug("Reset already in progress."),this._resettingPromise;if(!this._started)return this._logger.debug("Nothing to do to, already reset."),n.resolve();var t=this._mse;return this._waitingForData=!1,this._started=!1,this._clearTimers(),this._logger.debug("Waiting to clear MSE buffer..."),this._resettingPromise=t.whenIdle().then(function(){if(e._error)throw e._error;e._logger.debug("Clearing MSE buffer.");var o=t.getBuffered(),n=r.TimeRange.getCoverage(o);if(n.duration>0)return t.remove(n)}).then(function(){e._logger.debug("MSE buffer cleared."),e._resettingPromise=null}).catch(function(t){e._logger.error("Error resetting MSE.",t);var o=t||new Error("Error resetting MSE.");throw e._handleError(o),o})},e.prototype.waitingForSegmentData=function(){return this._checkNotErrored(),this._waitingForData},e.prototype.provideNextSegmentData=function(e){if(this._checkNotErrored(),!this._waitingForData)throw new Error("Not waiting for data.");this._logger.debug("Segment data provided."),this._waitingForData=!1,this._update(e)},e.prototype._prepareUpdate=function(){if(!this._updateTimerId){var e=this._mse;if(e.hasInitialized()){var t=r.TimeRange.getCoverage(e.getBuffered());if(t.end<=this._getPosition()+7e3){this._logger.debug("Requesting next segment data.");var o=this._getNextSegmentData();o?(this._logger.debug("Got segment data."),this._update(o)):(this._logger.debug("Did not get any data."),this._waitingForData=!0)}else this._scheduleUpdate()}}},e.prototype._gc=function(){var e=this,t=this._mse;if(t.hasInitialized()){var o=r.TimeRange.getCoverage(t.getBuffered()),n=this._getPosition()-5e3;if(o.start<n){var i=new r.TimeRange(o.start,n-o.start);this._logger.debug("Removing media that has been played.",i),t.remove(i).then(function(){e._logger.debug("Removed media that has been played.",i),e._error||e._scheduleGC()}).catch(function(t){e._logger.error("Error when attempting to remove media that has been played.",i,t),e._error||e._scheduleGC()})}else this._scheduleGC()}else this._scheduleGC()},e.prototype._update=function(e){var t=this;this._logger.debug("Updating...");var o=this._mse;this._onAppendQueued.dispatch({segment:e.eventRepresentation}),this._logger.debug("Appending..."),o.append(e.data).then(function(){t._logger.debug("Appended."),t._onAppendEnd.dispatch({segment:e.eventRepresentation}),t._resettingPromise||t._error||t._prepareUpdate()}).catch(function(e){t._error||(t._logger.error("Error updating MSE.",e),t._handleError(e||new Error("Error updating MSE.")))})},e.prototype._scheduleUpdate=function(){var e=this;this._updateTimerId=window.setTimeout(function(){e._updateTimerId=null,e._prepareUpdate()},500)},e.prototype._scheduleGC=function(){var e=this;this._gcTimerId||(this._gcTimerId=window.setTimeout(function(){e._gcTimerId=null,e._gc()},2e4))},e.prototype._checkNotErrored=function(){if(this._error)throw this._error},e.prototype._clearTimers=function(){this._updateTimerId&&(this._logger.debug("Clearing update timer."),window.clearTimeout(this._updateTimerId),this._updateTimerId=null),this._gcTimerId&&(window.clearTimeout(this._gcTimerId),this._gcTimerId=null)},e.prototype._handleError=function(e){this._error||(this._error=e,this._logger.error("Error occurred.",e),this._clearTimers(),this._onError(e))},e}();t.SimpleMSE=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085;var r=o(11);t.HLSMSEPlayer=r.HLSMSEPlayer;var n=o(10);t.errors=n.errors;var i=o(2);t.retrievalErrors=i.retrievalErrors}])}(o(2),o(4),o(7))},function(e,t,o){e.exports=function(e,t,o){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=91)}([function(t,o){t.exports=e},function(e,t,o){"use strict";var r=o(4);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,o){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,o){"use strict";e.exports=o(72)()?Symbol:o(74)},function(e,t,o){"use strict";var r=o(17)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getCode=function(){return"GENERIC"},e}();t.RetrievalError=r},function(e,t,o){"use strict";var r=o(10),n=o(19),i=o(58),a=o(22);(e.exports=function(e,t){var o,i,s,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(o=s=!0,i=!1):(o=a.call(e,"c"),i=a.call(e,"e"),s=a.call(e,"w")),c={value:t,configurable:o,enumerable:i,writable:s},l?r(n(l),c):c}).gs=function(e,t,o){var s,l,c,u;return"string"!=typeof e?(c=o,o=t,t=e,e=null):c=arguments[3],null==t?t=void 0:i(t)?null==o?o=void 0:i(o)||(c=o,o=void 0):(c=t,t=o=void 0),null==e?(s=!0,l=!1):(s=a.call(e,"c"),l=a.call(e,"e")),u={get:t,set:o,configurable:s,enumerable:l},c?r(n(c),u):u}},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call(function(){return arguments}());e.exports=function(e){return r.call(e)===n}},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===n)||!1}},function(e,o){e.exports=t},function(e,t,o){"use strict";e.exports=o(53)()?Object.assign:o(54)},function(e,t,o){"use strict";e.exports=o(20)()?Object.setPrototypeOf:o(21)},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(t){var o=e.call(this)||this;return o._code=t,o}return r(t,e),t.prototype.getCode=function(){return"OGG_PARSER."+this._code},t}(n.RetrievalError);t.OggParserError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(t){var o=e.call(this)||this;return o._statusCode=t,o}return r(t,e),t.prototype.getStatusCode=function(){return this._statusCode},t.prototype.getCode=function(){return"UNACCEPTABLE_RESPONSE_STATUS_CODE"},t}(n.RetrievalError);t.UnacceptableResponseStatusCodeError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(81),i=o(13),a=o(30),s=o(28),l=o(87),c=r.helpers.abortableJob.AbortableJob,u=r.helpers.retry,d=u.retry,p=u.buildExponentialDelayCalculator,f=r.helpers.Promise,h=r.helpers.arrayBuffer.combine,m=r.eventDispatcher.EventDispatcher,g=r.logger.prefixLogger,b=r.logger.noOpLogger,v=function(){function e(e){var t=e.url,o=e.sequenceNumber,r=e.playlist,n=e.timeRange,a=e.encryptionConfig,u=e.initData,v=e.format,y=e.loader,_=e.playlistEventRepresentation,S=e.logger,w=void 0===S?b:S,k=e.delayCalculator,E=void 0===k?p():k,P=e.isResponseCodeAcceptable,C=void 0===P?function(e){return 200===e}:P,T=e.isResponseCodeRetryable,R=void 0===T?function(e){return!(e>=400&&e<500)}:T,O=this;this._onSegmentRequestQueued=new m,this._onSegmentRequestStart=new m,this._onSegmentRetrieved=new m,this._onSegmentRequestFailed=new m,this._onSegmentDecryptionStart=new m,this._onSegmentDecryptionEnd=new m,this._logger=g(w,"Segment"),this.onSegmentRequestQueued=this._onSegmentRequestQueued.getHandle(),this.onSegmentRequestStart=this._onSegmentRequestStart.getHandle(),this.onSegmentRetrieved=this._onSegmentRetrieved.getHandle(),this.onSegmentRequestFailed=this._onSegmentRequestFailed.getHandle(),this.onSegmentDecryptionStart=this._onSegmentDecryptionStart.getHandle(),this.onSegmentDecryptionEnd=this._onSegmentDecryptionEnd.getHandle(),this._sequenceNumber=o,this._playlist=r,this._timeRange=n,this._encryptionConfig=a||null,this._initData=u||null,this._format=v,this._loader=y,this._isResponseCodeAcceptable=C,this._isResponseCodeRetryable=R,this._downloadAbortableJob=new c(function(){var e=d(function(){return new c(function(){var e=new s.Segment(_,t,o);O._onSegmentRequestQueued.dispatch({segment:e});var r=O._loader.request({url:t});r.whenRequestStarted.then(function(){return O._onSegmentRequestStart.dispatch({segment:e})}),O._logger.debug("Requesting segment.",t);var n=r.getResponse().then(function(o){if(!o)return O._logger.warn("Segment request timed out.",t),O._onSegmentRequestFailed.dispatch({segment:e,statusCode:null}),{success:!1};var r=o.statusCode;if(O._isResponseCodeAcceptable(r)){var n=o.data;return n?(O._logger.debug("Got segment response.",t,r),O._onSegmentRetrieved.dispatch({segment:e,statusCode:r}),{success:!0,result:{data:new Uint8Array(n),eventRepresentation:e}}):(O._logger.warn("Segment response contained no data.",t,r),O._onSegmentRequestFailed.dispatch({segment:e,statusCode:r}),{success:!1})}return O._isResponseCodeRetryable(r)?(O._logger.debug("Segment response code was not acceptable. Will retry.",t,r),O._onSegmentRequestFailed.dispatch({segment:e,statusCode:r}),{success:!1}):(O._logger.debug("Segment response code was not acceptable.",t,r),O._onSegmentRequestFailed.dispatch({segment:e,statusCode:r}),f.reject(new i.UnacceptableResponseStatusCodeError(r)))});return{result:n,abort:function(){O._logger.debug("Aborting segment request.",t),r.abort(),O._onSegmentRequestFailed.dispatch({segment:e,aborted:!0})}}})},E);return{result:e.whenComplete(),abort:function(){return e.abort()}}},{storeResult:!1}),this._retrieveAbortableJob=new c(function(){var e=O._downloadAbortableJob.run(),t=null,o=null,r=e.whenComplete().then(function(e){var r=e.data,n=e.eventRepresentation;return(o=O._decrypt(r,n)).whenComplete().then(function(e){O._initData&&(O._logger.debug("Prepending init data.",n),e=h([O._initData,e]));var o=l.SegmentParserFactory.retrieveSegmentParser(O._format);return O._logger.debug("Parsing segment data.",n,o.getFormat()),(t=o.parseSegmentData(e,O,O._playlist)).whenComplete().then(function(e){return O._logger.debug("Segment data ready.",n),{data:e,eventRepresentation:n}})})});return{result:r,abort:function(){e.abort(),o&&o.abort(),t&&t.abort()}}},{storeResult:!1})}return e.prototype.getSequenceNumber=function(){return this._sequenceNumber},e.prototype.isFinalSegment=function(){var e=this._playlist;return e.hasEnded()&&e.getStartingSequenceNumber()+e.getSegmentCount()-1===this._sequenceNumber},e.prototype.getTimeRange=function(){return this._timeRange},e.prototype.retrieveData=function(){return this._retrieveAbortableJob.run()},e.prototype._decrypt=function(e,t){var o=this,r=new c(function(){var r=o._encryptionConfig;if(!r)return{result:f.resolve(e)};o._logger.info("Finding a decryptor...");var i=n.DecryptorFactory.retrieveDecryptor(r);if(!i)return o._logger.error("Could not find a decryptor."),{result:f.reject(new a.NoDecryptorError)};o._logger.info("Decryptor found."),o._onSegmentDecryptionStart.dispatch({segment:t});var s=i.decrypt(e,r);return s.then(function(){o._logger.debug("Decrypted."),o._onSegmentDecryptionEnd.dispatch({segment:t})}),{result:s}});return r.run()},e}();t.Segment=v},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(39),i=o(40),a=r.helpers.Promise,s={rate:44100,id:3},l=s.rate;t.MP3ToMP4={getInputFormat:function(){return{mimeType:"audio/mpeg"}},getOutputFormat:function(){return{mimeType:"audio/mp4",audioCodec:{id:"mp3"}}},transmux:function(e){return new a(function(t,o){function r(e){a||(a=!0,o(e))}var a=!1;try{var c=[],u=new n.MP3Parser,d=new i.MP4Mux({audioTrackId:0,videoTrackId:-1,tracks:[{codecId:2,channels:2,samplerate:s.rate,samplesize:16,timescale:l}]});if(d.ondata=function(e){return c.push(e)},u.onFrame=function(e){try{var t=new Uint8Array(e.length+1),o=32;o|=s.id<<2,o|=2,o|=1,t[0]=o,t.set(e,1),d.pushPacket(8,t,0)}catch(e){r(e)}},u.push(e.data),u.close(),d.flush(),0===c.length)r(new Error("There was no output."));else{var p=c.shift();p?function(e){a||t(e)}({initData:p,data:function(e){var t=e.reduce(function(e,t){return e+t.length},0),o=new Uint8Array(t),r=0;return e.forEach(function(e){o.set(e,r),r+=e.length}),o}(c)}):r(new Error("No init data."))}}catch(e){r(e)}})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.Promise;t.PassThrough={getInputFormat:function(){return{}},getOutputFormat:function(){return{}},transmux:function(e){return n.resolve(e)}}},function(e,t,o){"use strict";e.exports=function(){}},function(e,t,o){"use strict";var r=o(4),n={function:!0,object:!0};e.exports=function(e){return r(e)&&n[typeof e]||!1}},function(e,t,o){"use strict";var r=o(4),n=Array.prototype.forEach,i=Object.create;e.exports=function(e){var t=i(null);return n.call(arguments,function(e){r(e)&&function(e,t){var o;for(o in e)t[o]=e[o]}(Object(e),t)}),t}},function(e,t,o){"use strict";var r=Object.create,n=Object.getPrototypeOf,i={};e.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&n(e(t(null),i))===i}},function(e,t,o){"use strict";var r,n=o(18),i=o(1),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(i(e),null===t||n(t))return e;throw new TypeError("Prototype must be null or an object")},e.exports=function(e){var t,o;return e?(2===e.level?e.set?(o=e.set,t=function(e,t){return o.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,o){var n;return r(t,o),(n=a.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===o&&(o=e.nullPolyfill),t.__proto__=o,n&&s(e.nullPolyfill,"__proto__",l),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),o={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{(e=r.set).call(t,o)}catch(e){}if(Object.getPrototypeOf(t)===o)return{set:e,level:2}}return t.__proto__=o,Object.getPrototypeOf(t)===o?{level:2}:((t={}).__proto__=o,Object.getPrototypeOf(t)===o&&{level:1})}()),o(56)},function(e,t,o){"use strict";e.exports=o(64)()?String.prototype.contains:o(65)},function(e,t,o){"use strict";var r=o(7),n=o(8),i=o(67),a=o(70),s=o(71),l=o(3).iterator;e.exports=function(e){return"function"==typeof s(e)[l]?e[l]():r(e)?new i(e):n(e)?new a(e):new i(e)}},function(e,t,o){"use strict";var r,n=o(42),i=o(10),a=o(2),s=o(1),l=o(6),c=o(41),u=o(3),d=Object.defineProperty,p=Object.defineProperties;e.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");p(this,{__list__:l("w",s(e)),__context__:l("w",t),__nextIndex__:l("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,p(r.prototype,i({_next:l(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:l(function(e){return this.__list__[e]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},c({_onAdd:l(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void d(this,"__redo__",l("c",[e]));this.__redo__.forEach(function(t,o){t>=e&&(this.__redo__[o]=++t)},this),this.__redo__.push(e)}}),_onDelete:l(function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,o){t>e&&(this.__redo__[o]=--t)},this)))}),_onClear:l(function(){this.__redo__&&n.call(this.__redo__),this.__nextIndex__=0})}))),d(r.prototype,u.iterator,l(function(){return this}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._playlist=e,this._url=t}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e}();t.InitData=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._playlist=e,this._url=t}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e}();t.Key=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._url=e}return e.prototype.getUrl=function(){return this._url},e}();t.Playlist=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,o){this._playlist=e,this._url=t,this._sequenceNumber=o}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e.prototype.getSequenceNumber=function(){return this._sequenceNumber},e}();t.Segment=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPartialMatch=function(e,t){return!(e.mimeType&&t.mimeType!==e.mimeType||e.audioCodec&&(!t.audioCodec||t.audioCodec.id!==e.audioCodec.id)||e.videoCodec&&(!t.videoCodec||t.videoCodec.id!==e.videoCodec.id))}},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"NO_DECRYPTOR"},t}(n.RetrievalError);t.NoDecryptorError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(t){var o=e.call(this)||this;return o._details=t,o}return r(t,e),t.prototype.getDetails=function(){return this._details},t.prototype.getCode=function(){return"PLAYLIST_PARSE"},t}(n.RetrievalError);t.PlaylistParseError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"UNSUPPORTED_ENCRYPTION_ERROR"},t}(n.RetrievalError);t.UnsupportedEncryptionError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(25),n=o(26),i=o(27),a=o(28);!function(e){e.InitData=r.InitData,e.Key=n.Key,e.Playlist=i.Playlist,e.Segment=a.Segment}(t.events||(t.events={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=o(0),i=o(9),a=o(12),s=n.helpers.find,l=n.eventDispatcher.EventDispatcher,c=n.helpers.abortableJob.abortedError,u=n.helpers.abortableJob.AbortableJob,d=n.logger.prefixLogger,p=n.logger.noOpLogger;!function(e){e[e.RETRIEVING_SEGMENT=0]="RETRIEVING_SEGMENT",e[e.RETRIEVED_SEGMENT=1]="RETRIEVED_SEGMENT",e[e.RETRIEVING_DATA=2]="RETRIEVING_DATA",e[e.COMPLETE=3]="COMPLETE"}(r||(r={}));var f=function(){function e(e){this._onSegmentRequestQueued=new l,this._onSegmentRequestStart=new l,this._onSegmentRetrieved=new l,this._onSegmentRequestFailed=new l,this._onSegmentDecryptionStart=new l,this._onSegmentDecryptionEnd=new l,this._onSegmentTransmuxStart=new l,this._onSegmentTransmuxEnd=new l,this._onSegmentReady=new l,this._onError=new l,this._segments=[],this._retrievingSegment=null,this._timerId=null,this._dead=!1;var t=e.playlist,o=e.getPosition,r=e.maxBufferLength,n=e.cacheSize,i=e.transmuxer,a=e.logger,s=void 0===a?p:a;if(this._logger=d(s,"PlaylistSegmentRetriever"),t&&!t.hasRetrieveCompleted())throw new Error("Playlist retrieve has not completed.");if(r<0)throw new Error("Max buffer length must be > 0.");if(n<0)throw new Error("Cache size must be > 0.");this.onSegmentRequestQueued=this._onSegmentRequestQueued.getHandle(),this.onSegmentRequestStart=this._onSegmentRequestStart.getHandle(),this.onSegmentRetrieved=this._onSegmentRetrieved.getHandle(),this.onSegmentRequestFailed=this._onSegmentRequestFailed.getHandle(),this.onSegmentDecryptionStart=this._onSegmentDecryptionStart.getHandle(),this.onSegmentDecryptionEnd=this._onSegmentDecryptionEnd.getHandle(),this.onSegmentTransmuxStart=this._onSegmentTransmuxStart.getHandle(),this.onSegmentTransmuxEnd=this._onSegmentTransmuxEnd.getHandle(),this.onSegmentReady=this._onSegmentReady.getHandle(),this.onError=this._onError.getHandle(),this._playlist=t,this._transmuxer=i,this._getPosition=o,this._maxBufferLength=r,this._cacheSize=n,this.update()}return e.prototype.updateMaxBufferLength=function(e){if(this._ensureNotDead(),e<0)throw new Error("Max buffer length must be > 0.");this._logger.debug("updateMaxBufferLength() called.",e),this._maxBufferLength=e,this.update()},e.prototype.updateCacheSize=function(e){if(this._ensureNotDead(),e<0)throw new Error("Cache size must be > 0.");this._logger.debug("updateCacheSize() called.",e),this._cacheSize=e,this.update()},e.prototype.getCacheSize=function(){return this._cacheSize},e.prototype.getCacheUsage=function(){return this._segments.reduce(function(e,t){return t.state===r.COMPLETE?e+t.data.byteLength+(t.initData?t.initData.byteLength:0):e},0)},e.prototype.switchPlaylist=function(e){if(this._ensureNotDead(),e&&!e.hasRetrieveCompleted())throw new Error("Playlist retrieve has not completed.");this._logger.debug("switchPlaylist() called."),this._abortCurrentRetrieve(),this._playlist=e,this._segments=this._segments.filter(function(e){return e.state===r.COMPLETE}),this.update()},e.prototype.getSegmentsWithData=function(){return this._ensureNotDead(),this._segments.filter(function(e){return e.state===r.COMPLETE}).map(function(e){if(e.state!==r.COMPLETE)throw new Error("Unexpected error.");var t=e.segment,o=e.initData,n=e.data,i=e.eventRepresentation;return{segment:t,initData:o,data:n,eventRepresentation:i}})},e.prototype.update=function(){var e=this;this._ensureNotDead(),this._timerId&&(this._logger.debug("Cancelling update timer."),window.clearTimeout(this._timerId),this._timerId=null);var t=this._getPosition(),o=t,n=0;this._segments.some(function(e){if(e.state!==r.COMPLETE)return!1;var i=e.segment.getTimeRange();return i.containsTime(n)&&(n=i.end),!(i.end<t)&&(i.start>o||(o=i.end,!1))});var i=t+this._maxBufferLength,a=function(){var t=e._playlist;if(t){var r=t.hasEnded()&&o===t.getTotalDuration();if(r)return o=n,t.getTotalDuration()+n<i}return o<i}();if(!a)return this._abortCurrentRetrieve(),this._garbageCollect(t),void this._scheduleNextUpdate();var l=s(this._segments,function(e){if(e.state===r.RETRIEVED_SEGMENT||e.state===r.RETRIEVING_DATA){var t=e.segment.getTimeRange();return t.containsTime(o)}return!1});l?this._retrieveSegmentData(l):this._retrieveSegment(o),this._garbageCollect(t)},e.prototype.kill=function(){this._dead||(this._logger.debug("kill() called."),this._abortCurrentRetrieve(),this._dead=!0,this._timerId&&(this._logger.debug("Cancelling update timer."),window.clearTimeout(this._timerId)),this._segments=[],this._logger.debug("Killed."))},e.prototype._retrieveSegmentData=function(e){var t=this;if(e.state!==r.RETRIEVED_SEGMENT&&e.state!==r.RETRIEVING_DATA)throw new Error("Segment in incorrect state for data to be retrieved.");var o=this._retrievingSegment;if(!o||o.state!==r.RETRIEVING_DATA||e.segment!==o.segment){this._abortCurrentRetrieve();var n=new u(function(){var o=!1,r=e.segment.retrieveData();t._logger.debug("Retrieving segment data...");var n=r.whenComplete().then(function(e){var r=e.data,n=e.eventRepresentation;if(o)throw c;return t._logger.debug("Retrieved segment data."),t._onSegmentTransmuxStart.dispatch({segment:n}),t._transmuxer.transmux(r).then(function(e){var r=e.data,i=e.initData;if(o)throw c;return t._onSegmentTransmuxEnd.dispatch({segment:n}),t._logger.debug("Transmuxed segment."),{data:r,initData:i,eventRepresentation:n}})});return{result:n,abort:function(){o=!0,r.abort()}}},{storeResult:!1}).run();n.onCompletion(function(o){var n=o.initData,i=o.data,a=o.eventRepresentation;t._retrievingSegment=null,t._segments.splice(t._segments.indexOf(e),1,{state:r.COMPLETE,initData:n,data:i,eventRepresentation:a,segment:e.segment}),t._logger.debug("Segment retrieve completed.",a),t.update(),t._onSegmentReady.dispatch({segment:e.segment,initData:n,data:i,eventRepresentation:a})}),n.onError(function(e){e!==c&&(t._logger.error("Error retrieving segment data.",e),t._scheduleNextUpdate(),e instanceof i.OggParserError&&(e=e instanceof i.ChecksumFailedError?new a.OggParserError("CHECKSUM_FAILED"):e instanceof i.NoSegmentsInPageError?new a.OggParserError("NO_SEGMENTS_IN_PAGE"):e instanceof i.PageFromDifferentBitstreamError?new a.OggParserError("PAGE_FROM_DIFFERENT_BITSTREAM"):e instanceof i.PageSequenceNumberDidNotIncrementError?new a.OggParserError("SEQUENCE_NUMBER_DID_NOT_INCREMENT"):e instanceof i.UnexpectedBOSError?new a.OggParserError("UNEXPECTED_BOS"):e instanceof i.UnexpectedEOSError?new a.OggParserError("UNEXPECTED_EOS"):new a.OggParserError("UNKNOWN")),t._onError.dispatch(e))}),this._retrievingSegment={state:r.RETRIEVING_DATA,dataRetrieveJob:n,segment:e.segment}}},e.prototype._retrieveSegment=function(e){var t=this,o=this._retrievingSegment,n=this._playlist,i=n?n.getSegmentIndexContainingTime(e):null;if(!o||o.state!==r.RETRIEVING_SEGMENT||o.segmentIndex!==i)if(this._abortCurrentRetrieve(),n)if(null===i)this._scheduleNextUpdate();else{var a=n.getSegment(i);this._logger.debug("Retrieving segment.",i),a.onCompletion(function(e){t._logger.debug("Retrieved segment.",i),e.onSegmentRequestQueued.subscribe(t._onSegmentRequestQueued.dispatch),e.onSegmentRequestStart.subscribe(t._onSegmentRequestStart.dispatch),e.onSegmentRetrieved.subscribe(t._onSegmentRetrieved.dispatch),e.onSegmentRequestFailed.subscribe(t._onSegmentRequestFailed.dispatch),e.onSegmentDecryptionStart.subscribe(t._onSegmentDecryptionStart.dispatch),e.onSegmentDecryptionEnd.subscribe(t._onSegmentDecryptionEnd.dispatch),t._segments.splice(t._segments.indexOf(s),1);var o=e.getTimeRange(),n=t._segments.length;t._segments.some(function(e,t){return e.state!==r.RETRIEVING_SEGMENT&&e.segment.getTimeRange().start>o.start&&(n=t,!0)}),t._segments.splice(n,0,{state:r.RETRIEVED_SEGMENT,segment:e}),t._retrievingSegment=null,t.update()}),a.onError(function(e){e!==c&&(t._logger.error("Error retrieving segment.",e),t._scheduleNextUpdate(),t._onError.dispatch(e))});var s={state:r.RETRIEVING_SEGMENT,segmentIndex:i,segmentRetrieveJob:a};this._segments.push(s),this._retrievingSegment=s}else this._logger.debug("Cannot retrieve segment as there is no playlist."),this._scheduleNextUpdate()},e.prototype._abortCurrentRetrieve=function(){var e=this._retrievingSegment;e&&(e.state===r.RETRIEVING_SEGMENT?(this._logger.debug("Aborting segment retrieve job."),e.segmentRetrieveJob.abort()):e.state===r.RETRIEVING_DATA&&(this._logger.debug("Aborting segment data retrieve job."),e.dataRetrieveJob.abort()),this._retrievingSegment=null)},e.prototype._garbageCollect=function(e){var t=this._segments,o=this._cacheSize,n=this.getCacheUsage();if(!(n<=o)){var i=this._playlist,a=i&&i.hasEnded()?i.getTotalDuration():1/0,s=e+this._maxBufferLength;s>a&&(s-=a)>=e||t.filter(function(t){return t.state===r.COMPLETE&&!function(e,t,o){var r=e.getTimeRange();return o!==t&&(o>t?r.end>t&&r.start<o:r.end>t||r.start<o)}(t.segment,e,s)}).map(function(t){if(t.state!==r.COMPLETE)throw new Error("Unexpected error.");var o=t.segment.getTimeRange(),n=o.start,i=Math.min(Math.abs(e-n),n+a-e);return{segment:t,distance:i,size:t.data.byteLength+(t.initData?t.initData.byteLength:0)}}).sort(function(e,t){return t.distance-e.distance}).some(function(e){return n<=o||(t.splice(t.indexOf(e.segment),1),n-=e.size,!1)})}},e.prototype._scheduleNextUpdate=function(){var e=this;this._timerId||(this._timerId=window.setTimeout(function(){e._timerId=null,e.update()},1e3))},e.prototype._ensureNotDead=function(){if(this._dead)throw new Error("Playlist segment retriever has been killed.")},e}();t.PlaylistSegmentRetriever=f},function(e,t,o){"use strict";function r(e){return 0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1?e.slice(1,-1):e}function n(e){0===e.indexOf("0x")&&(e=e.substr(2));var t=new Uint16Array(8);if(e.length%4!=0)throw new f.PlaylistParseError("Failed to parse IV (length is not multiple of 4).");for(var o=0;o<e.length;o+=4){var r=parseInt(e.substr(o,4),16);if(isNaN(r))throw new f.PlaylistParseError("Failed to parse hex number in IV string.");t[o/4]=r}return new Uint8Array(t)}function i(e){return!(e>=400&&e<500)}function a(e){var t,o={};for(N.lastIndex=0;null!==(t=N.exec(e));){var n=t[1].trim().toLowerCase(),i=r(t[2].trim());o[n]=i}return o}Object.defineProperty(t,"__esModule",{value:!0});var s,l,c=o(0),u=o(9),d=o(14),p=o(13),f=o(31),h=o(32),m=o(27),g=o(26),b=o(25),v=o(12),y=c.helpers.abortableJob.AbortableJob,_=c.helpers.deferred.buildDeferred,S=c.helpers.cache.buildCache,w=c.helpers.retry,k=w.retry,E=w.buildExponentialDelayCalculator,P=c.helpers.Promise,C=c.helpers.find,T=c.helpers.url,R=c.eventDispatcher.EventDispatcher,O=c.logger.prefixLogger,M=c.logger.noOpLogger,A=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF): *(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE): *(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g,N=/(.+?)=(.+?)(?:,|$)/g,I=/^\d*(\.\d+)?$/;!function(e){e[e.NONE=0]="NONE",e[e.AES_128=1]="AES_128",e[e.SAMPLE_AES=2]="SAMPLE_AES"}(s||(s={})),function(e){e[e.VOD=0]="VOD",e[e.LIVE=1]="LIVE",e[e.EVENT=2]="EVENT"}(l=t.PlaylistType||(t.PlaylistType={}));var x=function(){function e(e){var t=e.url,o=e.playlistLoader,r=e.segmentLoader,n=e.keyLoader,a=void 0===n?null:n,s=e.segmentFormat,l=e.logger,c=void 0===l?M:l,u=e.delayCalculator,d=void 0===u?E():u,f=e.keyDelayCalculator,h=void 0===f?E():f,g=e.segmentDelayCalculator,b=e.isPlaylistResponseCodeAcceptable,v=void 0===b?function(e){return 200===e}:b,w=e.isPlaylistResponseCodeRetryable,C=void 0===w?i:w,T=e.isSegmentResponseCodeAcceptable,A=void 0===T?function(e){return 200===e}:T,N=e.isSegmentResponseCodeRetryable,I=void 0===N?i:N,x=e.isKeyResponseCodeAcceptable,D=void 0===x?function(e){return 200===e}:x,F=e.isKeyResponseCodeRetryable,L=void 0===F?i:F,U=this;this._keyRetrievalJobsCache=S(),this._initDataRetrievalJobsCache=S(),this._data=null,this._playlistEventRepresentation=null,this._onPlaylistRequestQueued=new R,this._onPlaylistRequestStart=new R,this._onPlaylistRetrieved=new R,this._onPlaylistRequestFailed=new R,this._onPlaylistParseStart=new R,this._onPlaylistParseEnd=new R,this._onKeyRequestQueued=new R,this._onKeyRequestStart=new R,this._onKeyRetrieved=new R,this._onKeyRequestFailed=new R,this._onInitDataRequestQueued=new R,this._onInitDataRequestStart=new R,this._onInitDataRetrieved=new R,this._onInitDataRequestFailed=new R,this._logger=O(c,"Playlist"),this.onPlaylistRequestQueued=this._onPlaylistRequestQueued.getHandle(),this.onPlaylistRequestStart=this._onPlaylistRequestStart.getHandle(),this.onPlaylistRetrieved=this._onPlaylistRetrieved.getHandle(),this.onPlaylistRequestFailed=this._onPlaylistRequestFailed.getHandle(),this.onPlaylistParseStart=this._onPlaylistParseStart.getHandle(),this.onPlaylistParseEnd=this._onPlaylistParseEnd.getHandle(),this.onKeyRequestQueued=this._onKeyRequestQueued.getHandle(),this.onKeyRequestStart=this._onKeyRequestStart.getHandle(),this.onKeyRetrieved=this._onKeyRetrieved.getHandle(),this.onKeyRequestFailed=this._onKeyRequestFailed.getHandle(),this.onInitDataRequestQueued=this._onInitDataRequestQueued.getHandle(),this.onInitDataRequestStart=this._onInitDataRequestStart.getHandle(),this.onInitDataRetrieved=this._onInitDataRetrieved.getHandle(),this.onInitDataRequestFailed=this._onInitDataRequestFailed.getHandle(),this._url=t,this._playlistLoader=o,this._segmentLoader=r,this._keyLoader=a,this._segmentFormat=s,this._keyDelayCalculator=h,this._isPlaylistResponseCodeAcceptable=v,this._isPlaylistResponseCodeRetryable=C,this._isSegmentResponseCodeAcceptable=A,this._isSegmentResponseCodeRetryable=I,this._isKeyOrInitDataResponseCodeAcceptable=D,this._isKeyOrInitDataResponseCodeRetryable=L,this._segmentDelayCalculator=g,this._downloadAbortableJob=new y(function(){var e=k(function(){return new y(function(){var e=new m.Playlist(t);U._onPlaylistRequestQueued.dispatch({playlist:e});var o=U._playlistLoader.request({url:t});o.whenRequestStarted.then(function(){U._onPlaylistRequestStart.dispatch({playlist:e})}),U._logger.debug("Requesting playlist.",t);var r=o.getResponse().then(function(o){if(!o)return U._logger.warn("Playlist request timed out.",t),U._onPlaylistRequestFailed.dispatch({playlist:e,statusCode:null}),{success:!1};var r=o.statusCode;if(U._isPlaylistResponseCodeAcceptable(r)){var n=o.data;return n?(U._logger.debug("Got playlist response.",t,r),U._onPlaylistRetrieved.dispatch({playlist:e,statusCode:r}),{success:!0,result:{playlistContent:n,eventRepresentation:e}}):(U._logger.warn("Playlist response contained no data.",t,r),U._onPlaylistRequestFailed.dispatch({playlist:e,statusCode:r}),{success:!1})}return U._isPlaylistResponseCodeRetryable(r)?(U._logger.debug("Playlist response code was not acceptable. Will retry.",t,r),U._onPlaylistRequestFailed.dispatch({playlist:e,statusCode:r}),{success:!1}):(U._logger.debug("Playlist response code was not acceptable.",t,r),U._onPlaylistRequestFailed.dispatch({playlist:e,statusCode:r}),P.reject(new p.UnacceptableResponseStatusCodeError(r)))});return{result:r,abort:function(){U._logger.debug("Aborting playlist request.",t),o.abort(),U._onPlaylistRequestFailed.dispatch({playlist:e,aborted:!0})}}})},d);return{result:e.whenComplete(),abort:function(){return e.abort()}}},{storeResult:!1}),this._retrieveJob=new y(function(){var e=U._downloadAbortableJob.run(),t=_();return e.onCompletion(function(e){var o=e.playlistContent,r=e.eventRepresentation;U._onPlaylistParseStart.dispatch({playlist:r});try{U._data=U._parsePlaylist(o)}catch(e){return U._logger.error("Error when parsing playlist.",e,o),void t.reject(e)}U._playlistEventRepresentation=r,U._onPlaylistParseEnd.dispatch({playlist:r}),t.resolve(void 0)}),e.onError(t.reject),{result:t.promise,abort:function(){return e.abort()}}},{storeResult:!1})}return e.prototype.retrieve=function(){return this._retrieveJob.run()},e.prototype.hasRetrieveCompleted=function(){return!!this._data},e.prototype.getStartingSequenceNumber=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.mediaSequence},e.prototype.getType=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.type},e.prototype.getTargetDuration=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.targetDuration},e.prototype.getTotalDuration=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.totalDuration},e.prototype.hasEnded=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.ended},e.prototype.getSegmentCount=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.segments.length},e.prototype.getSegment=function(e){return this.getSegments(e,e+1)[0]},e.prototype.getSegments=function(e,t){var o=this,r=this._data;if(!r)throw new Error("Not loaded yet.");var n=r.mediaSequence;void 0===e&&(e=n);var i=r.segments.length;if(void 0===t&&(t=n+i),e<n)throw new Error("Start index must be >= the first segment index.");if(t<n)throw new Error("End index must be >= the first segment index.");if(t>n+i)throw new Error("End index cannot be > than the index of the last segment.");if(t<e)throw new Error("End index must be >= start index.");return r.segments.slice(e-n,t-n).map(function(t,r){var n=new y(function(){var n=t.encryptionData,i=e+r,a=o._playlistEventRepresentation;if(!a)throw new Error("Playlist event representation should exist.");var s=o._buildEncryptionConfig(n,i),l=t.initDataUrl?o._retrieveInitData(t.initDataUrl):null,c=s.whenComplete().then(function(e){var r=function(r){return new d.Segment({url:t.url,sequenceNumber:i,playlist:o,timeRange:t.timeRange,format:o._segmentFormat,loader:o._segmentLoader,playlistEventRepresentation:a,logger:o._logger,delayCalculator:o._segmentDelayCalculator,isResponseCodeAcceptable:o._isSegmentResponseCodeAcceptable,isResponseCodeRetryable:o._isSegmentResponseCodeRetryable,encryptionConfig:e,initData:r})};return l?l.whenComplete().then(function(e){return r(e)}):r(void 0)}).catch(function(e){throw e instanceof u.OggParserError?e instanceof u.ChecksumFailedError?new v.OggParserError("CHECKSUM_FAILED"):e instanceof u.NoSegmentsInPageError?new v.OggParserError("NO_SEGMENTS_IN_PAGE"):e instanceof u.PageFromDifferentBitstreamError?new v.OggParserError("PAGE_FROM_DIFFERENT_BITSTREAM"):e instanceof u.PageSequenceNumberDidNotIncrementError?new v.OggParserError("SEQUENCE_NUMBER_DID_NOT_INCREMENT"):e instanceof u.UnexpectedBOSError?new v.OggParserError("UNEXPECTED_BOS"):e instanceof u.UnexpectedEOSError?new v.OggParserError("UNEXPECTED_EOS"):new v.OggParserError("UNKNOWN"):e});return{result:c,abort:function(){s.abort(),l&&l.abort()}}},{storeResult:!1});return n.run()})},e.prototype.getSegmentIndexContainingTime=function(e){var t=this._data;if(!t)throw new Error("Not loaded yet.");var o=C(t.segments,function(t){return t.timeRange.containsTime(e)});return o?t.mediaSequence+t.segments.indexOf(o):null},e.prototype._buildEncryptionConfig=function(e,t){var o=this,r=new y(function(){if(e.method===s.NONE)return{result:P.resolve(void 0)};if(e.method!==s.AES_128)return o._logger.error("Unsupported encryption method.",e.method),{result:P.reject(new h.UnsupportedEncryptionError)};var r=o._keyLoader;if(!r)return{result:P.reject(new Error("Encryption method not supported as no key loader provided."))};var n=o._retrieveKey(e.keyUrl),i=n.whenComplete().then(function(o){return{cipher:"AES-CBC",key:o,iv:e.iv||function(e){for(var t=new Uint8Array(16),o=12;o<16;o++)t[o]=e>>8*(15-o)&255;return t}(t)}});return{result:i,abort:function(){return n.abort()}}});return r.run()},e.prototype._retrieveKey=function(e){var t=this,o=this._keyLoader;if(!o)throw new Error("No key loader.");var r=this._playlistEventRepresentation;if(!r)throw new Error("Playlist event representation should exist.");var n=new g.Key(r,e);return this._retrieveKeyOrInitData({url:e,loader:o,cache:this._keyRetrievalJobsCache,onRequestQueued:function(){return t._onKeyRequestQueued.dispatch({key:n})},onRequestStart:function(){return t._onKeyRequestStart.dispatch({key:n})},onRequestTimedOut:function(){t._onKeyRequestFailed.dispatch({key:n,statusCode:null})},onRequestFailed:function(e){t._onKeyRequestFailed.dispatch({key:n,statusCode:e})},onRequestAborted:function(){t._onKeyRequestFailed.dispatch({key:n,aborted:!0})},onRetrieved:function(e){t._onKeyRetrieved.dispatch({key:n,statusCode:e})},type:"key"})},e.prototype._retrieveInitData=function(e){var t=this,o=this._playlistEventRepresentation;if(!o)throw new Error("Playlist event representation should exist.");var r=new b.InitData(o,e);return this._retrieveKeyOrInitData({url:e,loader:this._segmentLoader,cache:this._initDataRetrievalJobsCache,onRequestQueued:function(){return t._onInitDataRequestQueued.dispatch({initData:r})},onRequestStart:function(){return t._onInitDataRequestStart.dispatch({initData:r})},onRequestTimedOut:function(){t._onInitDataRequestFailed.dispatch({initData:r,statusCode:null})},onRequestFailed:function(e){t._onInitDataRequestFailed.dispatch({initData:r,statusCode:e})},onRequestAborted:function(){t._onInitDataRequestFailed.dispatch({initData:r,aborted:!0})},onRetrieved:function(e){t._onInitDataRetrieved.dispatch({initData:r,statusCode:e})},type:"init data"})},e.prototype._retrieveKeyOrInitData=function(e){var t=this,o=e.url,r=e.loader,n=e.cache,i=e.onRequestQueued,a=e.onRequestStart,s=e.onRequestTimedOut,l=e.onRequestFailed,c=e.onRequestAborted,u=e.onRetrieved,d=e.type,f=n.get(o);return f?this._logger.debug(d+" retrieval already in progress.",o):(f=new y(function(){var e=k(function(){return new y(function(){i();var e=r.request({url:o});e.whenRequestStarted.then(function(){return a()}),t._logger.debug("Retrieving "+d+".",o);var n=e.getResponse().then(function(e){if(!e)return t._logger.warn(d+" request timed out.",o),s(),{success:!1};var r=e.statusCode;if(t._isKeyOrInitDataResponseCodeAcceptable(r)){var n=e.data;return n?(t._logger.debug("Got "+d+" response.",o,r),u(r),{success:!0,result:new Uint8Array(n)}):(t._logger.warn(d+" response contained no data.",o,r),l(r),{success:!1})}return t._isKeyOrInitDataResponseCodeRetryable(r)?(t._logger.warn(d+" response code was not acceptable. Will retry.",o,r),l(r),{success:!1}):(t._logger.warn(d+" response code was not acceptable.",o,r),l(r),P.reject(new p.UnacceptableResponseStatusCodeError(r)))});return{result:n,abort:function(){t._logger.debug("Aborting "+d+" request.",o),e.abort(),c()}}})},t._keyDelayCalculator);return{result:e.whenComplete(),abort:function(){return e.abort()}}},{storeResult:!1}),n.set(o,f)),f.run()},e.prototype._parsePlaylist=function(e){var t={version:null,type:l.LIVE,mediaSequence:null,targetDuration:null,totalDuration:0,ended:!1},o=[],r={method:s.NONE},i=null,u=null;A.lastIndex=0;for(var d,p=0,h=!1;null!==(d=A.exec(e));){var m=d.filter(function(e,t){return 0!==t&&void 0!==e}).map(function(e,t){return 0===t?e.toLowerCase():e}),g=m[0],b=m.slice(1);if(0===p){if("extm3u"!==g)throw new f.PlaylistParseError("First line did not contain EXTM3U tag.")}else{if(!h)switch(g){case"playlist-type":if(t.type!==l.LIVE)throw new f.PlaylistParseError("Already have playlist type.");switch(b[0].toLowerCase()){case"vod":t.type=l.VOD;break;case"event":t.type=l.EVENT;break;default:throw new f.PlaylistParseError("Invalid playlist type.")}break;case"media-sequence":if(null!==t.mediaSequence)throw new f.PlaylistParseError("Already have media sequence number.");var v=parseInt(b[0],10);if(v+""!==b[0])throw new f.PlaylistParseError("Invalid media sequence number.");t.mediaSequence=v;break;case"targetduration":if(null!==t.targetDuration)throw new f.PlaylistParseError("Already have target duration.");var y=parseInt(b[0],10);if(y+""!==b[0]||y<0)throw new f.PlaylistParseError("Invalid target duration.");t.targetDuration=1e3*y;break;case"version":if(null!==t.version)throw new f.PlaylistParseError("Already have version.");var _=parseInt(b[0],10);if(_+""!==b[0])throw new f.PlaylistParseError("Invalid version.");if(_<3)throw new f.PlaylistParseError("HLS version must be 3 or above.");t.version=_;break;default:h=!0}if(h)switch(g){case"key":var S=a(b[0]),w="method"in S?S.method.toLowerCase():null,k="uri"in S?T.buildAbsoluteUrl(this._url,S.uri):null,E="iv"in S?n(S.iv):null;if(!w)throw new f.PlaylistParseError("Missing encryption method.");if(!k&&"none"!==w)throw new f.PlaylistParseError("Missing key url.");switch(w){case"none":if(null!==k)throw new f.PlaylistParseError("Key url not allowed.");if(null!==E)throw new f.PlaylistParseError("IV not allowed.");r={method:s.NONE};break;case"aes-128":if(!k)throw new f.PlaylistParseError("Key url required.");r={method:s.AES_128,keyUrl:k,iv:E};break;case"sample-aes":if(!k)throw new f.PlaylistParseError("Key url required.");r={method:s.SAMPLE_AES,keyUrl:k,iv:E};break;default:throw new f.PlaylistParseError("Unknown encryption method.")}break;case"map":var S=a(b[0]);if(!("uri"in S))throw new f.PlaylistParseError("URI missing from EXT-X-MAP tag.");if("byterange"in S)throw new f.PlaylistParseError("BYTERANGE in EXT-X-MAP tag is currently unsupported.");i=S.uri?T.buildAbsoluteUrl(this._url,S.uri):null;break;case"inf":if(!b[0].match(I))throw new f.PlaylistParseError("Invalid segment duration.");u=1e3*parseFloat(b[0]);break;case"":if(t.ended)throw new f.PlaylistParseError("Already received ENDLIST tag.");if(null===u)throw new f.PlaylistParseError("Not received segment duration.");var P=T.buildAbsoluteUrl(this._url,b[0]);o.push({url:P,timeRange:new c.TimeRange(t.totalDuration,u),initDataUrl:i,encryptionData:r}),t.totalDuration+=u,u=null;break;case"endlist":if(t.ended)throw new f.PlaylistParseError("Already had ENDLIST tag.");t.ended=!0;break;default:this._logger.warn("Unable to parse playlist line.",g)}}p++}var C=t.version,R=t.type,O=t.mediaSequence,M=t.targetDuration,N=t.ended,x=t.totalDuration;if(null===C)throw new f.PlaylistParseError("Missing version.");if(null===M)throw new f.PlaylistParseError("Missing target duration.");if(N&&R===l.LIVE)throw new f.PlaylistParseError("Cannot be ended if type is LIVE.");if(!N&&R===l.VOD)throw new f.PlaylistParseError("Must be ended if type is VOD.");return null===O&&(O=0),{version:C,type:R,mediaSequence:O,targetDuration:M,totalDuration:x,ended:N,segments:o}},e}();t.Playlist=x},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(30),n=o(31),i=o(12),a=o(5),s=o(13),l=o(32);!function(e){e.NoDecryptorError=r.NoDecryptorError,e.PlaylistParseError=n.PlaylistParseError,e.OggParserError=i.OggParserError,e.RetrievalError=a.RetrievalError,e.UnacceptableResponseStatusCodeError=s.UnacceptableResponseStatusCodeError,e.UnsupportedEncryptionError=l.UnsupportedEncryptionError}(t.retrievalErrors||(t.retrievalErrors={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(29),n=o(88);t.TransmuxerFactory={retrieveTransmuxers:function(e,t){return n.default.filter(function(o){var n=o.getInputFormat(),i=o.getOutputFormat();return(!e||r.isPartialMatch(n,e))&&(!t||r.isPartialMatch(i,t))})},retrieveTransmuxer:function(e,o){return t.TransmuxerFactory.retrieveTransmuxers(e,o)[0]||null}}},function(e,t,o){"use strict";t.__esModule=!0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();t.AESDecryptor=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return r(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),o=new Uint32Array(4),r=0;r<o.length;r++)o[r]=t.getUint32(4*r);return o}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,o=this.subMix[0],r=this.subMix[1],n=this.subMix[2],i=this.subMix[3],a=this.invSubMix[0],s=this.invSubMix[1],l=this.invSubMix[2],c=this.invSubMix[3],u=new Uint32Array(256),d=0,p=0,f=0;for(f=0;f<256;f++)u[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var h=p^p<<1^p<<2^p<<3^p<<4;h=h>>>8^255&h^99,e[d]=h,t[h]=d;var m=u[d],g=u[m],b=u[g],v=257*u[h]^16843008*h;o[d]=v<<24|v>>>8,r[d]=v<<16|v>>>16,n[d]=v<<8|v>>>24,i[d]=v,v=16843009*b^65537*g^257*m^16843008*d,a[h]=v<<24|v>>>8,s[h]=v<<16|v>>>16,l[h]=v<<8|v>>>24,c[h]=v,d?(d=m^u[u[u[b^m]]],p^=u[u[p]]):d=p=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),o=!0,r=0;r<t.length&&o;)o=t[r]===this.key[r],r++;if(!o){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var i=this.ksRows=4*(n+6+1),a=void 0,s=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),c=this.invKeySchedule=new Uint32Array(this.ksRows),u=this.sBox,d=this.rcon,p=this.invSubMix[0],f=this.invSubMix[1],h=this.invSubMix[2],m=this.invSubMix[3],g=void 0,b=void 0;for(a=0;a<i;a++)a<n?g=l[a]=t[a]:(b=g,a%n==0?(b=u[(b=b<<8|b>>>24)>>>24]<<24|u[b>>>16&255]<<16|u[b>>>8&255]<<8|u[255&b],b^=d[a/n|0]<<24):n>6&&a%n==4&&(b=u[b>>>24]<<24|u[b>>>16&255]<<16|u[b>>>8&255]<<8|u[255&b]),l[a]=g=(l[a-n]^b)>>>0);for(s=0;s<i;s++)a=i-s,b=3&s?l[a]:l[a-4],c[s]=s<4||a<=4?b:p[u[b>>>24]]^f[u[b>>>16&255]]^h[u[b>>>8&255]]^m[u[255&b]],c[s]=c[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,o){for(var r,n,i=this.keySize+6,a=this.invKeySchedule,s=this.invSBox,l=this.invSubMix[0],c=this.invSubMix[1],u=this.invSubMix[2],d=this.invSubMix[3],p=this.uint8ArrayToUint32Array_(o),f=p[0],h=p[1],m=p[2],g=p[3],b=new Int32Array(e),v=new Int32Array(b.length),y=void 0,_=void 0,S=void 0,w=void 0,k=void 0,E=void 0,P=void 0,C=void 0,T=void 0,R=void 0,O=void 0,M=void 0;t<b.length;){for(T=this.networkToHostOrderSwap(b[t]),R=this.networkToHostOrderSwap(b[t+1]),O=this.networkToHostOrderSwap(b[t+2]),M=this.networkToHostOrderSwap(b[t+3]),k=T^a[0],E=M^a[1],P=O^a[2],C=R^a[3],r=4,n=1;n<i;n++)y=l[k>>>24]^c[E>>16&255]^u[P>>8&255]^d[255&C]^a[r],_=l[E>>>24]^c[P>>16&255]^u[C>>8&255]^d[255&k]^a[r+1],S=l[P>>>24]^c[C>>16&255]^u[k>>8&255]^d[255&E]^a[r+2],w=l[C>>>24]^c[k>>16&255]^u[E>>8&255]^d[255&P]^a[r+3],k=y,E=_,P=S,C=w,r+=4;y=s[k>>>24]<<24^s[E>>16&255]<<16^s[P>>8&255]<<8^s[255&C]^a[r],_=s[E>>>24]<<24^s[P>>16&255]<<16^s[C>>8&255]<<8^s[255&k]^a[r+1],S=s[P>>>24]<<24^s[C>>16&255]<<16^s[k>>8&255]<<8^s[255&E]^a[r+2],w=s[C>>>24]<<24^s[k>>16&255]<<16^s[E>>8&255]<<8^s[255&P]^a[r+3],r+=3,v[t]=this.networkToHostOrderSwap(y^f),v[t+1]=this.networkToHostOrderSwap(w^h),v[t+2]=this.networkToHostOrderSwap(S^m),v[t+3]=this.networkToHostOrderSwap(_^g),f=T,h=R,m=O,g=M,t+=4}return v.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}()},function(e,t,o){"use strict";function r(){this.buffer=null,this.bufferSize=0}t.__esModule=!0,t.MP3Parser=r;var n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],i=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];r.prototype.push=function(e){var t;if(this.bufferSize>0){var o=e.length+this.bufferSize;if(!this.buffer||this.buffer.length<o){var r=new Uint8Array(o);this.bufferSize>0&&r.set(this.buffer.subarray(0,this.bufferSize)),this.buffer=r}this.buffer.set(e,this.bufferSize),this.bufferSize=o,e=this.buffer,t=o}else t=e.length;for(var n,i=0;i<t&&(n=this._parse(e,i,t))>0;)i+=n;var a=t-i;a>0&&(!this.buffer||this.buffer.length<a?this.buffer=new Uint8Array(e.subarray(i,t)):this.buffer.set(e.subarray(i,t))),this.bufferSize=a},r.prototype._parse=function(e,t,o){if(t+2>o)return-1;if(255===e[t]||224==(224&e[t+1])){if(t+24>o)return-1;var r=e[t+1]>>3&3,a=e[t+1]>>1&3,s=e[t+2]>>4&15,l=e[t+2]>>2&3,c=!!(2&e[t+2]);if(1!==r&&0!==s&&15!==s&&3!==l){var u=3===r?3-a:3===a?3:4,d=1e3*n[14*u+s-1],p=3===r?0:2===r?1:2,f=i[3*p+l],h=c?1:0,m=3===a?(3===r?12:6)*d/f+h<<2:(3===r?144:72)*d/f+h|0;return t+m>o?-1:(this.onFrame&&this.onFrame(e.subarray(t,t+m)),m)}}for(var g=t+2;g<o;){if(255===e[g-1]&&224==(224&e[g]))return this.onNoise&&this.onNoise(e.subarray(t,g-1)),g-t-1;g++}return-1},r.prototype.close=function(){this.bufferSize>0&&this.onNoise&&this.onNoise(this.buffer.subarray(0,this.bufferSize)),this.buffer=null,this.bufferSize=0,this.onClose&&this.onClose()}},function(e,t,o){"use strict";t.__esModule=!0;var r,n,i=function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};!function(e){!function(e){e.utf8decode=function(e){for(var t=new Uint8Array(4*e.length),o=0,r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);if(i<=127)t[o++]=i;else{if(55296<=i&&i<=56319){var a=e.charCodeAt(r+1);56320<=a&&a<=57343&&(i=((1023&i)<<10)+(1023&a)+65536,++r)}0!=(4292870144&i)?(t[o++]=248|i>>>24&3,t[o++]=128|i>>>18&63,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i):0!=(4294901760&i)?(t[o++]=240|i>>>18&7,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i):0!=(4294965248&i)?(t[o++]=224|i>>>12&15,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=192|i>>>6&31,t[o++]=128|63&i)}}return t.subarray(0,o)},e.utf8encode=function(e){for(var t=0,o="";t<e.length;){var r=255&e[t++];if(r<=127)o+=String.fromCharCode(r);else{var n=192,i=5;do{var a=n>>1|128;if((r&a)===n)break;n=n>>1|128,--i}while(i>=0);if(i<=0)throw new Error("Invalid UTF8 character");for(var s=r&(1<<i)-1,l=5;l>=i;--l){var c=e[t++];if(128!=(192&c))throw new Error("Invalid UTF8 character sequence");s=s<<6|63&c}o+=s>=65536?String.fromCharCode(s-65536>>10&1023|55296,1023&s|56320):String.fromCharCode(s)}}return o}}(e.StringUtilities||(e.StringUtilities={}))}(n||(n={})),function(e){!function(e){function t(e){for(var t=e.length>>1,o=new Uint8Array(t),r=0;r<t;r++)o[r]=parseInt(e.substr(2*r,2),16);return o}function o(e){var t,o=0,l=r.RAW,c=e[o],u=c>>4,d=c>>2&3,p=2&c?16:8,f=1&c?2:1;switch(o++,u){case s:var h=e[o++];l=h,t=1024;break;case a:var m=e[o+1]>>3&3,g=e[o+1]>>1&3;t=1===g?3===m?1152:576:3===g?384:1152}return{codecDescription:i[u],codecId:u,data:e.subarray(o),rate:n[d],size:p,channels:f,samples:t,packetType:l}}var r,n=[5500,11025,22050,44100],i=["PCM","ADPCM","MP3","PCM le","Nellymouser16","Nellymouser8","Nellymouser","G.711 A-law","G.711 mu-law",null,"AAC","Speex","MP3 8khz"],a=2,s=10;!function(e){e[e.HEADER=0]="HEADER",e[e.RAW=1]="RAW"}(r||(r={}));var l,c,u,d=[null,"JPEG","Sorenson","Screen","VP6","VP6 alpha","Screen2","AVC"],p=4,f=7;!function(e){e[e.KEY=1]="KEY",e[e.INNER=2]="INNER",e[e.DISPOSABLE=3]="DISPOSABLE",e[e.GENERATED=4]="GENERATED",e[e.INFO=5]="INFO"}(l||(l={})),function(e){e[e.HEADER=0]="HEADER",e[e.NALU=1]="NALU",e[e.END=2]="END"}(c||(c={})),function(e){e[e.CAN_GENERATE_HEADER=0]="CAN_GENERATE_HEADER",e[e.NEED_HEADER_DATA=1]="NEED_HEADER_DATA",e[e.MAIN_PACKETS=2]="MAIN_PACKETS"}(u||(u={}));var h=function(){function n(e){var t=this;this.oncodecinfo=function(e){},this.ondata=function(e){throw new Error("MP4Mux.ondata is not set")},this.metadata=e,this.trackStates=this.metadata.tracks.map(function(e,o){var r={trackId:o+1,trackInfo:e,cachedDuration:0,samplesProcessed:0,initializationData:[]};return t.metadata.audioTrackId===o&&(t.audioTrackState=r),t.metadata.videoTrackId===o&&(t.videoTrackState=r),r},this),this._checkIfNeedHeaderData(),this.filePos=0,this.cachedPackets=[],this.chunkIndex=0}return n.prototype.pushPacket=function(e,t,n){switch(this.state===u.CAN_GENERATE_HEADER&&this._tryGenerateHeader(),e){case 8:var i=this.audioTrackState,l=o(t);if(!i||i.trackInfo.codecId!==l.codecId)throw new Error("Unexpected audio packet codec: "+l.codecDescription);switch(l.codecId){default:throw new Error("Unsupported audio codec: "+l.codecDescription);case a:break;case s:if(l.packetType===r.HEADER)return void i.initializationData.push(l.data)}this.cachedPackets.push({packet:l,timestamp:n,trackId:i.trackId});break;case 9:var h=this.videoTrackState,m=function(e){var t=0,o=e[t]>>4,r=15&e[t];t++;var n={frameType:o,codecId:r,codecDescription:d[r]};switch(r){case f:var i=e[t++];n.packetType=i,n.compositionTime=(e[t]<<24|e[t+1]<<16|e[t+2]<<8)>>8,t+=3;break;case p:n.packetType=c.NALU,n.horizontalOffset=e[t]>>4&15,n.verticalOffset=15&e[t],n.compositionTime=0,t++}return n.data=e.subarray(t),n}(t);if(!h||h.trackInfo.codecId!==m.codecId)throw new Error("Unexpected video packet codec: "+m.codecDescription);switch(m.codecId){default:throw new Error("unsupported video codec: "+m.codecDescription);case p:break;case f:if(m.packetType===c.HEADER)return void h.initializationData.push(m.data)}this.cachedPackets.push({packet:m,timestamp:n,trackId:h.trackId});break;default:throw new Error("unknown packet type: "+e)}this.state===u.NEED_HEADER_DATA&&this._tryGenerateHeader(),this.cachedPackets.length>=50&&this.state===u.MAIN_PACKETS&&this._chunk()},n.prototype.flush=function(){this.cachedPackets.length>0&&this._chunk()},n.prototype._checkIfNeedHeaderData=function(){this.trackStates.some(function(e){return e.trackInfo.codecId===s||e.trackInfo.codecId===f})?this.state=u.NEED_HEADER_DATA:this.state=u.CAN_GENERATE_HEADER},n.prototype._tryGenerateHeader=function(){var o=this.trackStates.every(function(e){switch(e.trackInfo.codecId){case s:case f:return e.initializationData.length>0;default:return!0}});if(o){for(var r=["isom"],n=[],i=0;i<this.trackStates.length;i++){var l,c=this.trackStates[i],d=c.trackInfo;switch(d.codecId){case s:var h=c.initializationData[0];l=new e.Iso.AudioSampleEntry("mp4a",1,d.channels,d.samplesize,d.samplerate);var m=new Uint8Array(41+h.length);m.set(t("0000000003808080"),0),m[8]=32+h.length,m.set(t("00020004808080"),9),m[16]=18+h.length,m.set(t("40150000000000FA000000000005808080"),17),m[34]=h.length,m.set(h,35),m.set(t("068080800102"),35+h.length),l.otherBoxes=[new e.Iso.RawTag("esds",m)];var g=h[0]>>3;c.mimeTypeCodec="mp4a.40."+g;break;case a:l=new e.Iso.AudioSampleEntry(".mp3",1,d.channels,d.samplesize,d.samplerate),c.mimeTypeCodec="mp3";break;case f:var b=c.initializationData[0];(l=new e.Iso.VideoSampleEntry("avc1",1,d.width,d.height)).otherBoxes=[new e.Iso.RawTag("avcC",b)];var v=b[1]<<16|b[2]<<8|b[3];c.mimeTypeCodec="avc1."+(16777216|v).toString(16).substr(1),r.push("iso2","avc1","mp41");break;case p:(l=new e.Iso.VideoSampleEntry("VP6F",1,d.width,d.height)).otherBoxes=[new e.Iso.RawTag("glbl",t("00"))],c.mimeTypeCodec="avc1.42001E";break;default:throw new Error("not supported track type")}var y,_=e.Iso.TrackHeaderFlags.TRACK_ENABLED|e.Iso.TrackHeaderFlags.TRACK_IN_MOVIE;c===this.audioTrackState?y=new e.Iso.TrackBox(new e.Iso.TrackHeaderBox(_,c.trackId,-1,0,0,1,i),new e.Iso.MediaBox(new e.Iso.MediaHeaderBox(d.timescale,-1,d.language),new e.Iso.HandlerBox("soun","SoundHandler"),new e.Iso.MediaInformationBox(new e.Iso.SoundMediaHeaderBox,new e.Iso.DataInformationBox(new e.Iso.DataReferenceBox([new e.Iso.DataEntryUrlBox(e.Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),new e.Iso.SampleTableBox(new e.Iso.SampleDescriptionBox([l]),new e.Iso.RawTag("stts",t("0000000000000000")),new e.Iso.RawTag("stsc",t("0000000000000000")),new e.Iso.RawTag("stsz",t("000000000000000000000000")),new e.Iso.RawTag("stco",t("0000000000000000")))))):c===this.videoTrackState&&(y=new e.Iso.TrackBox(new e.Iso.TrackHeaderBox(_,c.trackId,-1,d.width,d.height,0,i),new e.Iso.MediaBox(new e.Iso.MediaHeaderBox(d.timescale,-1,d.language),new e.Iso.HandlerBox("vide","VideoHandler"),new e.Iso.MediaInformationBox(new e.Iso.VideoMediaHeaderBox,new e.Iso.DataInformationBox(new e.Iso.DataReferenceBox([new e.Iso.DataEntryUrlBox(e.Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),new e.Iso.SampleTableBox(new e.Iso.SampleDescriptionBox([l]),new e.Iso.RawTag("stts",t("0000000000000000")),new e.Iso.RawTag("stsc",t("0000000000000000")),new e.Iso.RawTag("stsz",t("000000000000000000000000")),new e.Iso.RawTag("stco",t("0000000000000000"))))))),n.push(y)}var S=new e.Iso.MovieExtendsBox(null,[new e.Iso.TrackExtendsBox(1,1,0,0,0),new e.Iso.TrackExtendsBox(2,1,0,0,0)],null),w=new e.Iso.BoxContainerBox("udat",[new e.Iso.MetaBox(new e.Iso.RawTag("hdlr",t("00000000000000006D6469726170706C000000000000000000")),[new e.Iso.RawTag("ilst",t("00000025A9746F6F0000001D6461746100000001000000004C61766635342E36332E313034"))])]),k=new e.Iso.MovieHeaderBox(1e3,0,this.trackStates.length+1),E=new e.Iso.MovieBox(k,n,S,w),P=new e.Iso.FileTypeBox("isom",512,r),C=P.layout(0),T=E.layout(C),R=new Uint8Array(C+T);P.write(R),E.write(R),this.oncodecinfo(this.trackStates.map(function(e){return e.mimeTypeCodec})),this.ondata(R),this.filePos+=R.length,this.state=u.MAIN_PACKETS}},n.prototype._chunk=function(){var t=this.cachedPackets;if(this.videoTrackState){for(var o=t.length-1,r=this.videoTrackState.trackId;o>0&&(t[o].trackId!==r||t[o].packet.frameType!==l.KEY);)o--;o>0&&(t=t.slice(0,o))}if(0!==t.length){for(var n=[],i=0,c=[],u=[],d=0;d<this.trackStates.length;d++){var h=this.trackStates[d],m=h.trackInfo,g=h.trackId,b=t.filter(function(e){return e.trackId===g});if(0!==b.length){var v,y,_,S=new e.Iso.TrackFragmentBaseMediaDecodeTimeBox(h.cachedDuration);switch(u.push(i),m.codecId){case s:case a:_=[];for(var o=0;o<b.length;o++){var w=b[o].packet,k=Math.round(w.samples*m.timescale/m.samplerate);n.push(w.data),i+=w.data.length,_.push({duration:k,size:w.data.length}),h.samplesProcessed+=w.samples}var E=e.Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;v=new e.Iso.TrackFragmentHeaderBox(E,g,0,0,0,0,e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);var P=e.Iso.TrackRunFlags.DATA_OFFSET_PRESENT|e.Iso.TrackRunFlags.SAMPLE_DURATION_PRESENT|e.Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT;y=new e.Iso.TrackRunBox(P,_,0,0),h.cachedDuration=Math.round(h.samplesProcessed*m.timescale/m.samplerate);break;case f:case p:_=[];for(var C=h.samplesProcessed,T=C*m.timescale/m.framerate,R=Math.round(T),o=0;o<b.length;o++){var O=b[o].packet;C++;var M=Math.round(C*m.timescale/m.framerate),A=M-R;R=M;var N=Math.round(C*m.timescale/m.framerate+O.compositionTime*m.timescale/1e3);n.push(O.data),i+=O.data.length;var I=O.frameType===l.KEY?e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS:e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_OTHER|e.Iso.SampleFlags.SAMPLE_IS_NOT_SYNC;_.push({duration:A,size:O.data.length,flags:I,compositionTimeOffset:N-M})}var E=e.Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;v=new e.Iso.TrackFragmentHeaderBox(E,g,0,0,0,0,e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);var P=e.Iso.TrackRunFlags.DATA_OFFSET_PRESENT|e.Iso.TrackRunFlags.SAMPLE_DURATION_PRESENT|e.Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT|e.Iso.TrackRunFlags.SAMPLE_FLAGS_PRESENT|e.Iso.TrackRunFlags.SAMPLE_COMPOSITION_TIME_OFFSET;y=new e.Iso.TrackRunBox(P,_,0,0),h.cachedDuration=R,h.samplesProcessed=C;break;default:throw new Error("Un codec")}var x=new e.Iso.TrackFragmentBox(v,S,y);c.push(x)}}this.cachedPackets.splice(0,t.length);for(var D=new e.Iso.MovieFragmentHeaderBox(++this.chunkIndex),F=new e.Iso.MovieFragmentBox(D,c),L=F.layout(0),U=new e.Iso.MediaDataBox(n),j=U.layout(L),B=L+8,d=0;d<c.length;d++)c[d].run.dataOffset=B+u[d];var V=new Uint8Array(L+j);F.write(V),U.write(V),this.ondata(V),this.filePos+=V.length}},n}();e.MP4Mux=h,e.parseFLVMetadata=function(e){var t,o,r=[],n=-1,i=-1,l=+e.asGetPublicProperty("duration"),c=e.asGetPublicProperty("audiocodecid");switch(c){case a:case"mp3":t="mp3",o=a;break;case s:case"mp4a":t="mp4a",o=s;break;default:if(!isNaN(c))throw new Error("Unsupported audio codec: "+c);t=null,o=-1}var u,d,h=e.asGetPublicProperty("videocodecid");switch(h){case p:case"vp6f":u="vp6f",d=p;break;case f:case"avc1":u="avc1",d=f;break;default:if(!isNaN(h))throw new Error("Unsupported video codec: "+h);u=null,d=-1}var m=null===t?null:{codecDescription:t,codecId:o,language:"und",timescale:+e.asGetPublicProperty("audiosamplerate")||44100,samplerate:+e.asGetPublicProperty("audiosamplerate")||44100,channels:+e.asGetPublicProperty("audiochannels")||2,samplesize:16},g=null===u?null:{codecDescription:u,codecId:d,language:"und",timescale:6e4,framerate:+e.asGetPublicProperty("videoframerate")||+e.asGetPublicProperty("framerate"),width:+e.asGetPublicProperty("width"),height:+e.asGetPublicProperty("height")},b=e.asGetPublicProperty("trackinfo");if(b)for(var v=0;v<b.length;v++){var y=b[v],_=y.asGetPublicProperty("sampledescription")[0];_.asGetPublicProperty("sampletype")===c?(m.language=y.asGetPublicProperty("language"),m.timescale=+y.asGetPublicProperty("timescale")):_.asGetPublicProperty("sampletype")===h&&(g.language=y.asGetPublicProperty("language"),g.timescale=+y.asGetPublicProperty("timescale"))}return g&&(i=r.length,r.push(g)),m&&(n=r.length,r.push(m)),{tracks:r,duration:l,audioTrackId:n,videoTrackId:i}},e.splitMetadata=function(e){var t=[];return e.audioTrackId>=0&&t.push({tracks:[e.tracks[e.audioTrackId]],duration:e.duration,audioTrackId:0,videoTrackId:-1}),e.videoTrackId>=0&&t.push({tracks:[e.tracks[e.videoTrackId]],duration:e.duration,audioTrackId:-1,videoTrackId:0}),t}}(e.MP4||(e.MP4={}))}(r||(r={})),function(e){!function(e){!function(e){function t(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return Array.prototype.concat.apply(e,t)}function o(e,t,o){e[t]=o>>24&255,e[t+1]=o>>16&255,e[t+2]=o>>8&255,e[t+3]=255&o}function r(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}function a(e){return(e-d)/1e3|0}function s(e){return 65536*e|0}function l(e){return 1073741824*e|0}function c(e){return 256*e|0}var u=n.StringUtilities.utf8decode,d=-20828448e5,p=[1,0,0,0,1,0,0,0,1],f=[0,0,0],h=function(){function e(e,t){this.boxtype=e,"uuid"===e&&(this.userType=t)}return e.prototype.layout=function(e){this.offset=e;var t=8;return this.userType&&(t+=16),this.size=t,t},e.prototype.write=function(e){return o(e,this.offset,this.size),o(e,this.offset+4,r(this.boxtype)),this.userType?(e.set(this.userType,this.offset+8),24):8},e.prototype.toUint8Array=function(){var e=this.layout(0),t=new Uint8Array(e);return this.write(t),t},e}();e.Box=h;var m=function(e){function t(t,o,r){void 0===o&&(o=0),void 0===r&&(r=0);var n=e.call(this,t)||this;return n.version=o,n.flags=r,n}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.version<<24|this.flags),r+4},t}(h);e.FullBox=m;var g=function(e){function t(t,o,r){var n=e.call(this,"ftype")||this;return n.majorBrand=t,n.minorVersion=o,n.compatibleBrands=r,n}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4*(2+this.compatibleBrands.length),this.size},t.prototype.write=function(t){var n=this,i=e.prototype.write.call(this,t);return o(t,this.offset+i,r(this.majorBrand)),o(t,this.offset+i+4,this.minorVersion),i+=8,this.compatibleBrands.forEach(function(e){o(t,n.offset+i,r(e)),i+=4},this),i},t}(h);e.FileTypeBox=g;var b=function(e){function t(t,o){var r=e.call(this,t)||this;return r.children=o,r}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t);return this.children.forEach(function(e){e&&(o+=e.layout(t+o))}),this.size=o},t.prototype.write=function(t){var o=e.prototype.write.call(this,t);return this.children.forEach(function(e){e&&(o+=e.write(t))}),o},t}(h);e.BoxContainerBox=b;var v=function(e){function o(o,r,n,i){var a=e.call(this,"moov",t([o],r,[n,i]))||this;return a.header=o,a.tracks=r,a.extendsBox=n,a.userData=i,a}return i(o,e),o}(b);e.MovieBox=v;var y=function(e){function t(t,o,r,n,i,a,s,l){void 0===n&&(n=1),void 0===i&&(i=1),void 0===a&&(a=p),void 0===s&&(s=d),void 0===l&&(l=d);var c=e.call(this,"mvhd",0,0)||this;return c.timescale=t,c.duration=o,c.nextTrackId=r,c.rate=n,c.volume=i,c.matrix=a,c.creationTime=s,c.modificationTime=l,c}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+16+4+2+2+8+36+24+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,a(this.creationTime)),o(t,this.offset+r+4,a(this.modificationTime)),o(t,this.offset+r+8,this.timescale),o(t,this.offset+r+12,this.duration),r+=16,o(t,this.offset+r,s(this.rate)),o(t,this.offset+r+4,c(this.volume)<<16),o(t,this.offset+r+8,0),o(t,this.offset+r+12,0),r+=16,o(t,this.offset+r,s(this.matrix[0])),o(t,this.offset+r+4,s(this.matrix[1])),o(t,this.offset+r+8,s(this.matrix[2])),o(t,this.offset+r+12,s(this.matrix[3])),o(t,this.offset+r+16,s(this.matrix[4])),o(t,this.offset+r+20,s(this.matrix[5])),o(t,this.offset+r+24,l(this.matrix[6])),o(t,this.offset+r+28,l(this.matrix[7])),o(t,this.offset+r+32,l(this.matrix[8])),r+=36,o(t,this.offset+r,0),o(t,this.offset+r+4,0),o(t,this.offset+r+8,0),o(t,this.offset+r+12,0),o(t,this.offset+r+16,0),o(t,this.offset+r+20,0),r+=24,o(t,this.offset+r,this.nextTrackId),r+=4},t}(m);e.MovieHeaderBox=y,function(e){e[e.TRACK_ENABLED=1]="TRACK_ENABLED",e[e.TRACK_IN_MOVIE=2]="TRACK_IN_MOVIE",e[e.TRACK_IN_PREVIEW=4]="TRACK_IN_PREVIEW"}(e.TrackHeaderFlags||(e.TrackHeaderFlags={}));var _=function(e){function t(t,o,r,n,i,a,s,l,c,u,f){void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=p),void 0===u&&(u=d),void 0===f&&(f=d);var h=e.call(this,"tkhd",0,t)||this;return h.trackId=o,h.duration=r,h.width=n,h.height=i,h.volume=a,h.alternateGroup=s,h.layer=l,h.matrix=c,h.creationTime=u,h.modificationTime=f,h}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+20+8+6+2+36+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,a(this.creationTime)),o(t,this.offset+r+4,a(this.modificationTime)),o(t,this.offset+r+8,this.trackId),o(t,this.offset+r+12,0),o(t,this.offset+r+16,this.duration),r+=20,o(t,this.offset+r,0),o(t,this.offset+r+4,0),o(t,this.offset+r+8,this.layer<<16|this.alternateGroup),o(t,this.offset+r+12,c(this.volume)<<16),r+=16,o(t,this.offset+r,s(this.matrix[0])),o(t,this.offset+r+4,s(this.matrix[1])),o(t,this.offset+r+8,s(this.matrix[2])),o(t,this.offset+r+12,s(this.matrix[3])),o(t,this.offset+r+16,s(this.matrix[4])),o(t,this.offset+r+20,s(this.matrix[5])),o(t,this.offset+r+24,l(this.matrix[6])),o(t,this.offset+r+28,l(this.matrix[7])),o(t,this.offset+r+32,l(this.matrix[8])),r+=36,o(t,this.offset+r,s(this.width)),o(t,this.offset+r+4,s(this.height)),r+=8},t}(m);e.TrackHeaderBox=_;var S=function(e){function t(t,o,r,n,i){void 0===r&&(r="unk"),void 0===n&&(n=d),void 0===i&&(i=d);var a=e.call(this,"mdhd",0,0)||this;return a.timescale=t,a.duration=o,a.language=r,a.creationTime=n,a.modificationTime=i,a}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+16+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,a(this.creationTime)),o(t,this.offset+r+4,a(this.modificationTime)),o(t,this.offset+r+8,this.timescale),o(t,this.offset+r+12,this.duration),o(t,this.offset+r+16,function(e){return(31&e.charCodeAt(0))<<10|(31&e.charCodeAt(1))<<5|31&e.charCodeAt(2)}(this.language)<<16),r+20},t}(m);e.MediaHeaderBox=S;var w=function(e){function t(t,o){var r=e.call(this,"hdlr",0,0)||this;return r.handlerType=t,r.name=o,r._encodedName=u(r.name),r}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8+12+(this._encodedName.length+1),this.size},t.prototype.write=function(t){var n=e.prototype.write.call(this,t);return o(t,this.offset+n,0),o(t,this.offset+n+4,r(this.handlerType)),o(t,this.offset+n+8,0),o(t,this.offset+n+12,0),o(t,this.offset+n+16,0),n+=20,t.set(this._encodedName,this.offset+n),t[this.offset+n+this._encodedName.length]=0,n+=this._encodedName.length+1},t}(m);e.HandlerBox=w;var k=function(e){function t(t){void 0===t&&(t=0);var o=e.call(this,"smhd",0,0)||this;return o.balance=t,o}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,c(this.balance)<<16),r+4},t}(m);e.SoundMediaHeaderBox=k;var E=function(e){function t(t,o){void 0===t&&(t=0),void 0===o&&(o=f);var r=e.call(this,"vmhd",0,0)||this;return r.graphicsMode=t,r.opColor=o,r}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.graphicsMode<<16|this.opColor[0]),o(t,this.offset+r+4,this.opColor[1]<<16|this.opColor[2]),r+8},t}(m);e.VideoMediaHeaderBox=E,e.SELF_CONTAINED_DATA_REFERENCE_FLAG=1;var P=function(t){function o(o,r){void 0===r&&(r=null);var n=t.call(this,"url ",0,o)||this;return n.location=r,o&e.SELF_CONTAINED_DATA_REFERENCE_FLAG||(n._encodedLocation=u(r)),n}return i(o,t),o.prototype.layout=function(e){var o=t.prototype.layout.call(this,e);return this._encodedLocation&&(o+=this._encodedLocation.length+1),this.size=o},o.prototype.write=function(e){var o=t.prototype.write.call(this,e);return this._encodedLocation&&(e.set(this._encodedLocation,this.offset+o),e[this.offset+o+this._encodedLocation.length]=0,o+=this._encodedLocation.length),o},o}(m);e.DataEntryUrlBox=P;var C=function(e){function t(t){var o=e.call(this,"dref",0,0)||this;return o.entries=t,o}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t)+4;return this.entries.forEach(function(e){o+=e.layout(t+o)}),this.size=o},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.entries.length),this.entries.forEach(function(e){r+=e.write(t)}),r},t}(m);e.DataReferenceBox=C;var T=function(e){function t(t){var o=e.call(this,"dinf",[t])||this;return o.dataReference=t,o}return i(t,e),t}(b);e.DataInformationBox=T;var R=function(e){function t(t){var o=e.call(this,"stsd",0,0)||this;return o.entries=t,o}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t);return o+=4,this.entries.forEach(function(e){o+=e.layout(t+o)}),this.size=o},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.entries.length),r+=4,this.entries.forEach(function(e){r+=e.write(t)}),r},t}(m);e.SampleDescriptionBox=R;var O=function(e){function t(t,o,r,n,i){var a=e.call(this,"stbl",[t,o,r,n,i])||this;return a.sampleDescriptions=t,a.timeToSample=o,a.sampleToChunk=r,a.sampleSizes=n,a.chunkOffset=i,a}return i(t,e),t}(b);e.SampleTableBox=O;var M=function(e){function t(t,o,r){var n=e.call(this,"minf",[t,o,r])||this;return n.header=t,n.info=o,n.sampleTable=r,n}return i(t,e),t}(b);e.MediaInformationBox=M;var A=function(e){function t(t,o,r){var n=e.call(this,"mdia",[t,o,r])||this;return n.header=t,n.handler=o,n.info=r,n}return i(t,e),t}(b);e.MediaBox=A;var N=function(e){function t(t,o){var r=e.call(this,"trak",[t,o])||this;return r.header=t,r.media=o,r}return i(t,e),t}(b);e.TrackBox=N;var I=function(e){function t(t,o,r,n,i){var a=e.call(this,"trex",0,0)||this;return a.trackId=t,a.defaultSampleDescriptionIndex=o,a.defaultSampleDuration=r,a.defaultSampleSize=n,a.defaultSampleFlags=i,a}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+20,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.trackId),o(t,this.offset+r+4,this.defaultSampleDescriptionIndex),o(t,this.offset+r+8,this.defaultSampleDuration),o(t,this.offset+r+12,this.defaultSampleSize),o(t,this.offset+r+16,this.defaultSampleFlags),r+20},t}(m);e.TrackExtendsBox=I;var x=function(e){function o(o,r,n){var i=e.call(this,"mvex",t([o],r,[n]))||this;return i.header=o,i.tracDefaults=r,i.levels=n,i}return i(o,e),o}(b);e.MovieExtendsBox=x;var D=function(e){function t(t,o){var r=e.call(this,"meta",0,0)||this;return r.handler=t,r.otherBoxes=o,r}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t);return o+=this.handler.layout(t+o),this.otherBoxes.forEach(function(e){o+=e.layout(t+o)}),this.size=o},t.prototype.write=function(t){var o=e.prototype.write.call(this,t);return o+=this.handler.write(t),this.otherBoxes.forEach(function(e){o+=e.write(t)}),o},t}(m);e.MetaBox=D;var F,L=function(e){function t(t){var o=e.call(this,"mfhd",0,0)||this;return o.sequenceNumber=t,o}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.sequenceNumber),r+4},t}(m);e.MovieFragmentHeaderBox=L,function(e){e[e.BASE_DATA_OFFSET_PRESENT=1]="BASE_DATA_OFFSET_PRESENT",e[e.SAMPLE_DESCRIPTION_INDEX_PRESENT=2]="SAMPLE_DESCRIPTION_INDEX_PRESENT",e[e.DEFAULT_SAMPLE_DURATION_PRESENT=8]="DEFAULT_SAMPLE_DURATION_PRESENT",e[e.DEFAULT_SAMPLE_SIZE_PRESENT=16]="DEFAULT_SAMPLE_SIZE_PRESENT",e[e.DEFAULT_SAMPLE_FLAGS_PRESENT=32]="DEFAULT_SAMPLE_FLAGS_PRESENT"}(F=e.TrackFragmentFlags||(e.TrackFragmentFlags={}));var U=function(e){function t(t,o,r,n,i,a,s){var l=e.call(this,"tfhd",0,t)||this;return l.trackId=o,l.baseDataOffset=r,l.sampleDescriptionIndex=n,l.defaultSampleDuration=i,l.defaultSampleSize=a,l.defaultSampleFlags=s,l}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t)+4,r=this.flags;return r&F.BASE_DATA_OFFSET_PRESENT&&(o+=8),r&F.SAMPLE_DESCRIPTION_INDEX_PRESENT&&(o+=4),r&F.DEFAULT_SAMPLE_DURATION_PRESENT&&(o+=4),r&F.DEFAULT_SAMPLE_SIZE_PRESENT&&(o+=4),r&F.DEFAULT_SAMPLE_FLAGS_PRESENT&&(o+=4),this.size=o},t.prototype.write=function(t){var r=e.prototype.write.call(this,t),n=this.flags;return o(t,this.offset+r,this.trackId),r+=4,n&F.BASE_DATA_OFFSET_PRESENT&&(o(t,this.offset+r,0),o(t,this.offset+r+4,this.baseDataOffset),r+=8),n&F.SAMPLE_DESCRIPTION_INDEX_PRESENT&&(o(t,this.offset+r,this.sampleDescriptionIndex),r+=4),n&F.DEFAULT_SAMPLE_DURATION_PRESENT&&(o(t,this.offset+r,this.defaultSampleDuration),r+=4),n&F.DEFAULT_SAMPLE_SIZE_PRESENT&&(o(t,this.offset+r,this.defaultSampleSize),r+=4),n&F.DEFAULT_SAMPLE_FLAGS_PRESENT&&(o(t,this.offset+r,this.defaultSampleFlags),r+=4),r},t}(m);e.TrackFragmentHeaderBox=U;var j=function(e){function t(t){var o=e.call(this,"tfdt",0,0)||this;return o.baseMediaDecodeTime=t,o}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,this.baseMediaDecodeTime),r+4},t}(m);e.TrackFragmentBaseMediaDecodeTimeBox=j;var B,V=function(e){function t(t,o,r){var n=e.call(this,"traf",[t,o,r])||this;return n.header=t,n.decodeTime=o,n.run=r,n}return i(t,e),t}(b);e.TrackFragmentBox=V,function(e){e[e.IS_LEADING_MASK=201326592]="IS_LEADING_MASK",e[e.SAMPLE_DEPENDS_ON_MASK=50331648]="SAMPLE_DEPENDS_ON_MASK",e[e.SAMPLE_DEPENDS_ON_OTHER=16777216]="SAMPLE_DEPENDS_ON_OTHER",e[e.SAMPLE_DEPENDS_ON_NO_OTHERS=33554432]="SAMPLE_DEPENDS_ON_NO_OTHERS",e[e.SAMPLE_IS_DEPENDED_ON_MASK=12582912]="SAMPLE_IS_DEPENDED_ON_MASK",e[e.SAMPLE_HAS_REDUNDANCY_MASK=3145728]="SAMPLE_HAS_REDUNDANCY_MASK",e[e.SAMPLE_PADDING_VALUE_MASK=917504]="SAMPLE_PADDING_VALUE_MASK",e[e.SAMPLE_IS_NOT_SYNC=65536]="SAMPLE_IS_NOT_SYNC",e[e.SAMPLE_DEGRADATION_PRIORITY_MASK=65535]="SAMPLE_DEGRADATION_PRIORITY_MASK"}(e.SampleFlags||(e.SampleFlags={})),function(e){e[e.DATA_OFFSET_PRESENT=1]="DATA_OFFSET_PRESENT",e[e.FIRST_SAMPLE_FLAGS_PRESENT=4]="FIRST_SAMPLE_FLAGS_PRESENT",e[e.SAMPLE_DURATION_PRESENT=256]="SAMPLE_DURATION_PRESENT",e[e.SAMPLE_SIZE_PRESENT=512]="SAMPLE_SIZE_PRESENT",e[e.SAMPLE_FLAGS_PRESENT=1024]="SAMPLE_FLAGS_PRESENT",e[e.SAMPLE_COMPOSITION_TIME_OFFSET=2048]="SAMPLE_COMPOSITION_TIME_OFFSET"}(B=e.TrackRunFlags||(e.TrackRunFlags={}));var H=function(e){function t(t,o,r,n){var i=e.call(this,"trun",1,t)||this;return i.samples=o,i.dataOffset=r,i.firstSampleFlags=n,i}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t)+4,r=this.samples.length,n=this.flags;return n&B.DATA_OFFSET_PRESENT&&(o+=4),n&B.FIRST_SAMPLE_FLAGS_PRESENT&&(o+=4),n&B.SAMPLE_DURATION_PRESENT&&(o+=4*r),n&B.SAMPLE_SIZE_PRESENT&&(o+=4*r),n&B.SAMPLE_FLAGS_PRESENT&&(o+=4*r),n&B.SAMPLE_COMPOSITION_TIME_OFFSET&&(o+=4*r),this.size=o},t.prototype.write=function(t){var r=e.prototype.write.call(this,t),n=this.samples.length,i=this.flags;o(t,this.offset+r,n),r+=4,i&B.DATA_OFFSET_PRESENT&&(o(t,this.offset+r,this.dataOffset),r+=4),i&B.FIRST_SAMPLE_FLAGS_PRESENT&&(o(t,this.offset+r,this.firstSampleFlags),r+=4);for(var a=0;a<n;a++){var s=this.samples[a];i&B.SAMPLE_DURATION_PRESENT&&(o(t,this.offset+r,s.duration),r+=4),i&B.SAMPLE_SIZE_PRESENT&&(o(t,this.offset+r,s.size),r+=4),i&B.SAMPLE_FLAGS_PRESENT&&(o(t,this.offset+r,s.flags),r+=4),i&B.SAMPLE_COMPOSITION_TIME_OFFSET&&(o(t,this.offset+r,s.compositionTimeOffset),r+=4)}return r},t}(m);e.TrackRunBox=H;var G=function(e){function o(o,r){var n=e.call(this,"moof",t([o],r))||this;return n.header=o,n.trafs=r,n}return i(o,e),o}(b);e.MovieFragmentBox=G;var q=function(e){function t(t){var o=e.call(this,"mdat")||this;return o.chunks=t,o}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t);return this.chunks.forEach(function(e){o+=e.length}),this.size=o},t.prototype.write=function(t){var o=this,r=e.prototype.write.call(this,t);return this.chunks.forEach(function(e){t.set(e,o.offset+r),r+=e.length},this),r},t}(h);e.MediaDataBox=q;var z=function(e){function t(t,o){var r=e.call(this,t)||this;return r.dataReferenceIndex=o,r}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,0),o(t,this.offset+r+4,this.dataReferenceIndex),r+8},t}(h);e.SampleEntry=z;var W=function(e){function t(t,o,r,n,i,a){void 0===r&&(r=2),void 0===n&&(n=16),void 0===i&&(i=44100),void 0===a&&(a=null);var s=e.call(this,t,o)||this;return s.channelCount=r,s.sampleSize=n,s.sampleRate=i,s.otherBoxes=a,s}return i(t,e),t.prototype.layout=function(t){var o=e.prototype.layout.call(this,t)+20;return this.otherBoxes&&this.otherBoxes.forEach(function(e){o+=e.layout(t+o)}),this.size=o},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return o(t,this.offset+r,0),o(t,this.offset+r+4,0),o(t,this.offset+r+8,this.channelCount<<16|this.sampleSize),o(t,this.offset+r+12,0),o(t,this.offset+r+16,this.sampleRate<<16),r+=20,this.otherBoxes&&this.otherBoxes.forEach(function(e){r+=e.write(t)}),r},t}(z);e.AudioSampleEntry=W,e.COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH=24;var Y=function(t){function r(o,r,n,i,a,s,l,c,u,d){void 0===a&&(a=""),void 0===s&&(s=72),void 0===l&&(l=72),void 0===c&&(c=1),void 0===u&&(u=e.COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH),void 0===d&&(d=null);var p=t.call(this,o,r)||this;if(p.width=n,p.height=i,p.compressorName=a,p.horizResolution=s,p.vertResolution=l,p.frameCount=c,p.depth=u,p.otherBoxes=d,a.length>31)throw new Error("invalid compressor name");return p}return i(r,t),r.prototype.layout=function(e){var o=t.prototype.layout.call(this,e)+16+12+4+2+32+2+2;return this.otherBoxes&&this.otherBoxes.forEach(function(t){o+=t.layout(e+o)}),this.size=o},r.prototype.write=function(e){var r=t.prototype.write.call(this,e);o(e,this.offset+r,0),o(e,this.offset+r+4,0),o(e,this.offset+r+8,0),o(e,this.offset+r+12,0),r+=16,o(e,this.offset+r,this.width<<16|this.height),o(e,this.offset+r+4,s(this.horizResolution)),o(e,this.offset+r+8,s(this.vertResolution)),r+=12,o(e,this.offset+r,0),o(e,this.offset+r+4,this.frameCount<<16),r+=6,e[this.offset+r]=this.compressorName.length;for(var n=0;n<31;n++)e[this.offset+r+n+1]=n<this.compressorName.length?127&this.compressorName.charCodeAt(n):0;return r+=32,o(e,this.offset+r,this.depth<<16|65535),r+=4,this.otherBoxes&&this.otherBoxes.forEach(function(t){r+=t.write(e)}),r},r}(z);e.VideoSampleEntry=Y;var $=function(e){function t(t,o){var r=e.call(this,t)||this;return r.data=o,r}return i(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+this.data.length,this.size},t.prototype.write=function(t){var o=e.prototype.write.call(this,t);return t.set(this.data,this.offset+o),o+this.data.length},t}(h);e.RawTag=$}(e.Iso||(e.Iso={}))}(e.MP4||(e.MP4={}))}(r||(r={})),t.MP4Mux=r.MP4.MP4Mux},function(e,t,o){"use strict";var r,n=o(55),i=o(19),a=o(2),s=o(62),l=o(2),c=o(1),u=Function.prototype.bind,d=Object.defineProperty,p=Object.prototype.hasOwnProperty;r=function(e,t,o){var r,i=c(t)&&l(t.value);return delete(r=n(t)).writable,delete r.value,r.get=function(){return!o.overwriteDefinition&&p.call(this,e)?i:(t.value=u.call(i,o.resolveContext?o.resolveContext(this):this),d(this,e,t),this[e])},r},e.exports=function(e){var t=i(arguments[1]);return null!=t.resolveContext&&a(t.resolveContext),s(e,function(e,o){return r(o,e,t)})}},function(e,t,o){"use strict";var r=o(1);e.exports=function(){return r(this).length=0,this}},function(e,t,o){"use strict";e.exports=o(44)()?Array.from:o(45)},function(e,t,o){"use strict";e.exports=function(){var e,t,o=Array.from;return"function"==typeof o&&(t=o(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},function(e,t,o){"use strict";var r=o(3).iterator,n=o(7),i=o(46),a=o(51),s=o(2),l=o(1),c=o(4),u=o(8),d=Array.isArray,p=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},h=Object.defineProperty;e.exports=function(e){var t,o,m,g,b,v,y,_,S,w,k=arguments[1],E=arguments[2];if(e=Object(l(e)),c(k)&&s(k),this&&this!==Array&&i(this))t=this;else{if(!k){if(n(e))return 1!==(b=e.length)?Array.apply(null,e):((g=new Array(1))[0]=e[0],g);if(d(e)){for(g=new Array(b=e.length),o=0;o<b;++o)g[o]=e[o];return g}}g=[]}if(!d(e))if(void 0!==(S=e[r])){for(y=s(S).call(e),t&&(g=new t),_=y.next(),o=0;!_.done;)w=k?p.call(k,E,_.value,o):_.value,t?(f.value=w,h(g,o,f)):g[o]=w,_=y.next(),++o;b=o}else if(u(e)){for(b=e.length,t&&(g=new t),o=0,m=0;o<b;++o)w=e[o],o+1<b&&(v=w.charCodeAt(0))>=55296&&v<=56319&&(w+=e[++o]),w=k?p.call(k,E,w,m):w,t?(f.value=w,h(g,m,f)):g[m]=w,++m;b=m}if(void 0===b)for(b=a(e.length),t&&(g=new t(b)),o=0;o<b;++o)w=k?p.call(k,E,e[o],o):e[o],t?(f.value=w,h(g,o,f)):g[o]=w;return t&&(f.value=null,g.length=b),g}},function(e,t,o){"use strict";var r=Object.prototype.toString,n=r.call(o(17));e.exports=function(e){return"function"==typeof e&&r.call(e)===n}},function(e,t,o){"use strict";e.exports=o(48)()?Math.sign:o(49)},function(e,t,o){"use strict";e.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},function(e,t,o){"use strict";e.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},function(e,t,o){"use strict";var r=o(47),n=Math.abs,i=Math.floor;e.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?r(e)*i(n(e)):e}},function(e,t,o){"use strict";var r=o(50),n=Math.max;e.exports=function(e){return n(0,r(e))}},function(e,t,o){"use strict";var r=o(2),n=o(1),i=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(o,c){var u,d=arguments[2],p=arguments[3];return o=Object(n(o)),r(c),u=s(o),p&&u.sort("function"==typeof p?i.call(p,o):void 0),"function"!=typeof e&&(e=u[e]),a.call(e,u,function(e,r){return l.call(o,e)?a.call(c,d,o[e],e,o,r):t})}}},function(e,t,o){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,o){"use strict";var r=o(59),n=o(1),i=Math.max;e.exports=function(e,t){var o,a,s,l=i(arguments.length,2);for(e=Object(n(e)),s=function(r){try{e[r]=t[r]}catch(e){o||(o=e)}},a=1;a<l;++a)t=arguments[a],r(t).forEach(s);if(void 0!==o)throw o;return e}},function(e,t,o){"use strict";var r=o(43),n=o(10),i=o(1);e.exports=function(e){var t=Object(i(e)),o=arguments[1],a=Object(arguments[2]);if(t!==e&&!o)return t;var s={};return o?r(o,function(t){(a.ensure||t in e)&&(s[t]=e[t])}):n(s,e),s}},function(e,t,o){"use strict";var r,n=Object.create;o(20)()||(r=o(21)),e.exports=function(){var e,t,o;return r?1!==r.level?n:(e={},t={},o={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){return"__proto__"===e?void(t[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0}):void(t[e]=o)}),Object.defineProperties(e,t),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:e}),function(t,o){return n(null===t?e:t,o)}):n}()},function(e,t,o){"use strict";e.exports=o(52)("forEach")},function(e,t,o){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,o){"use strict";e.exports=o(60)()?Object.keys:o(61)},function(e,t,o){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,o){"use strict";var r=o(4),n=Object.keys;e.exports=function(e){return n(r(e)?Object(e):e)}},function(e,t,o){"use strict";var r=o(2),n=o(57),i=Function.prototype.call;e.exports=function(e,t){var o={},a=arguments[2];return r(t),n(e,function(e,r,n,s){o[r]=i.call(t,a,e,r,n,s)}),o}},function(e,t,o){"use strict";var r=o(18);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,o){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,o){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,o){"use strict";var r=Object.create(null),n=Math.random;e.exports=function(){var e;do{e=n().toString(36).slice(2)}while(r[e]);return e}},function(e,t,o){"use strict";var r,n=o(11),i=o(22),a=o(6),s=o(3),l=o(24),c=Object.defineProperty;r=e.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");l.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",c(this,"__kind__",a("",t))},n&&n(r,l),delete r.prototype.constructor,r.prototype=Object.create(l.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),c(r.prototype,s.toStringTag,a("c","Array Iterator"))},function(e,t,o){"use strict";var r=o(7),n=o(2),i=o(8),a=o(23),s=Array.isArray,l=Function.prototype.call,c=Array.prototype.some;e.exports=function(e,t){var o,u,d,p,f,h,m,g,b=arguments[2];if(s(e)||r(e)?o="array":i(e)?o="string":e=a(e),n(t),d=function(){p=!0},"array"!==o)if("string"!==o)for(u=e.next();!u.done;){if(l.call(t,b,u.value,d),p)return;u=e.next()}else for(h=e.length,f=0;f<h&&(m=e[f],f+1<h&&(g=m.charCodeAt(0))>=55296&&g<=56319&&(m+=e[++f]),l.call(t,b,m,d),!p);++f);else c.call(e,function(e){return l.call(t,b,e,d),p})}},function(e,t,o){"use strict";var r=o(7),n=o(4),i=o(8),a=o(3).iterator,s=Array.isArray;e.exports=function(e){return!(!n(e)||!s(e)&&!i(e)&&!r(e)&&"function"!=typeof e[a])}},function(e,t,o){"use strict";var r,n=o(11),i=o(6),a=o(3),s=o(24),l=Object.defineProperty;r=e.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),l(this,"__length__",i("",e.length))},n&&n(r,s),delete r.prototype.constructor,r.prototype=Object.create(s.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t,o=this.__list__[e];return this.__nextIndex__===this.__length__?o:(t=o.charCodeAt(0))>=55296&&t<=56319?o+this.__list__[this.__nextIndex__++]:o})}),l(r.prototype,a.toStringTag,i("c","String Iterator"))},function(e,t,o){"use strict";var r=o(69);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},function(e,t,o){"use strict";var r={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!r[typeof Symbol.iterator]&&!!r[typeof Symbol.toPrimitive]&&!!r[typeof Symbol.toStringTag]}},function(e,t,o){"use strict";e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},function(e,t,o){"use strict";var r,n,i,a,s=o(6),l=o(75),c=Object.create,u=Object.defineProperties,d=Object.defineProperty,p=Object.prototype,f=c(null);if("function"==typeof Symbol){r=Symbol;try{String(r()),a=!0}catch(e){}}var h=function(){var e=c(null);return function(t){for(var o,r,n=0;e[t+(n||"")];)++n;return e[t+=n||""]=!0,d(p,o="@@"+t,s.gs(null,function(e){r||(r=!0,d(this,o,s(e)),r=!1)})),o}}();i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return n(e)},e.exports=n=function e(t){var o;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?r(t):(o=c(i.prototype),t=void 0===t?"":String(t),u(o,{__description__:s("",t),__name__:s("",h(t))}))},u(n,{for:s(function(e){return f[e]?f[e]:f[e]=n(String(e))}),keyFor:s(function(e){var t;for(t in l(e),f)if(f[t]===e)return t}),hasInstance:s("",r&&r.hasInstance||n("hasInstance")),isConcatSpreadable:s("",r&&r.isConcatSpreadable||n("isConcatSpreadable")),iterator:s("",r&&r.iterator||n("iterator")),match:s("",r&&r.match||n("match")),replace:s("",r&&r.replace||n("replace")),search:s("",r&&r.search||n("search")),species:s("",r&&r.species||n("species")),split:s("",r&&r.split||n("split")),toPrimitive:s("",r&&r.toPrimitive||n("toPrimitive")),toStringTag:s("",r&&r.toStringTag||n("toStringTag")),unscopables:s("",r&&r.unscopables||n("unscopables"))}),u(i.prototype,{constructor:s(n),toString:s("",function(){return this.__name__})}),u(n.prototype,{toString:s(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:s(function(){return l(this)})}),d(n.prototype,n.toPrimitive,s("",function(){var e=l(this);return"symbol"==typeof e?e:e.toString()})),d(n.prototype,n.toStringTag,s("c","Symbol")),d(i.prototype,n.toStringTag,s("c",n.prototype[n.toStringTag])),d(i.prototype,n.toPrimitive,s("c",n.prototype[n.toPrimitive]))},function(e,t,o){"use strict";var r=o(73);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},function(e,t,o){"use strict";e.exports=o(77)()?WeakMap:o(79)},function(e,t,o){"use strict";e.exports=function(){var e,t;if("function"!=typeof WeakMap)return!1;try{e=new WeakMap([[t={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(e)&&"function"==typeof e.set&&e.set({},1)===e&&"function"==typeof e.delete&&"function"==typeof e.has&&"one"===e.get(t)}},function(e,t,o){"use strict";e.exports="function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)},function(e,t,o){"use strict";var r,n=o(11),i=o(63),a=o(1),s=o(66),l=o(6),c=o(23),u=o(68),d=o(3).toStringTag,p=o(78),f=Array.isArray,h=Object.defineProperty,m=Object.prototype.hasOwnProperty,g=Object.getPrototypeOf;e.exports=r=function(){var e,t=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return e=p&&n&&WeakMap!==r?n(new WeakMap,g(this)):this,null!=t&&(f(t)||(t=c(t))),h(e,"__weakMapData__",l("c","$weakMap$"+s())),t?(u(t,function(t){a(t),e.set(t[0],t[1])}),e):e},p&&(n&&n(r,WeakMap),r.prototype=Object.create(WeakMap.prototype,{constructor:l(r)})),Object.defineProperties(r.prototype,{delete:l(function(e){return!!m.call(i(e),this.__weakMapData__)&&(delete e[this.__weakMapData__],!0)}),get:l(function(e){if(m.call(i(e),this.__weakMapData__))return e[this.__weakMapData__]}),has:l(function(e){return m.call(i(e),this.__weakMapData__)}),set:l(function(e,t){return h(i(e),this.__weakMapData__,l("c",t)),this}),toString:l(function(){return"[object WeakMap]"})}),h(r.prototype,d,l("c","WeakMap"))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(83),n=o(82),i=[r.WebCrypto,n.JSCrypto];t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(80),i=r.helpers.find;t.DecryptorFactory={retrieveDecryptor:function(e){return i(n.default,function(t){return t.canDecrypt(e)})||null}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(38),i=r.helpers.Promise,a=null;t.JSCrypto={canDecrypt:function(e){return"AES-CBC"===e.cipher},decrypt:function(e,t){return a||(a=new n.AESDecryptor),a.expandKey(t.key.buffer),i.resolve(new Uint8Array(a.decrypt(e.buffer,0,t.iv.buffer)))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.Promise,i=window.crypto&&window.crypto.subtle;t.WebCrypto={canDecrypt:function(e){return!!i&&window.isSecureContext&&"AES-CBC"===e.cipher},decrypt:function(e,t){return new n(function(o,r){(function(e){return i.importKey("raw",e,{name:"AES-CBC"},!1,["decrypt"])})(t.key).then(function(o){return i.decrypt({name:"AES-CBC",iv:t.iv},o,e)}).then(function(e){return o(new Uint8Array(e))}).catch(r)})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(86),n=o(85),i=[r.OggOpusSegmentParser,n.DefaultSegmentParser];t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.abortableJob.AbortableJob,i=r.helpers.Promise;t.DefaultSegmentParser={getFormat:function(){return{}},parseSegmentData:function(e){var t=new n(function(){return{result:i.resolve({data:e})}});return t.run()}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(9),i=o(76),a=r.helpers.abortableJob.AbortableJob,s=r.helpers.Promise,l=r.helpers.arrayBuffer.combine,c=new i;t.OggOpusSegmentParser={getFormat:function(){return{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},parseSegmentData:function(e,t,o){var r=new a(function(){var r=n.retrievePages(e);if(r.length){var i=n.retrievePackets([r[0]])[0];if(i&&i.first){var a=1;r.slice(1).some(function(e,t){var o=!!(1&e.header.type[0]);return t>0&&!o||(a=t+2,!1)});var u=l(r.slice(0,a).map(function(e){return e.entirePage}));return c.set(o,u),{result:s.resolve({data:l(r.slice(a).map(function(e){return e.entirePage})),initData:u})}}}if(t.getSequenceNumber()<=o.getStartingSequenceNumber())return{result:s.reject(new Error("Could not find init data."))};if(c.has(o))return{result:s.resolve({initData:c.get(o),data:e})};var d=o.getSegment(o.getStartingSequenceNumber()),p=null,f=d.whenComplete().then(function(t){return(p=t.retrieveData()).whenComplete().then(function(t){var o=t.data;return{initData:o.initData,data:e}})});return{result:f,abort:function(){d.abort(),p&&p.abort()}}});return r.run()}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(29),i=o(84),a=r.helpers.find;t.SegmentParserFactory={retrieveSegmentParser:function(e){var t=a(i.default,function(t){return n.isPartialMatch(t.getFormat(),e)});if(!t)throw new Error("No segment parser found.");return t}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(16),n=o(15),i=o(89),a=[r.PassThrough,n.MP3ToMP4,i.OggOpusToWebm];t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=o(9),i=o(90),a=r.helpers.Promise,s=r.helpers.arrayBuffer.combine;t.OggOpusToWebm={getInputFormat:function(){return{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},getOutputFormat:function(){return{mimeType:"audio/webm",audioCodec:{id:"opus"}}},transmux:function(e){try{var t=e.initData?s([e.initData,e.data]):e.data,o=n.retrievePackets(n.retrievePages(t)),r=i.buildWebm(o);return a.resolve({data:r.data,initData:r.initData})}catch(e){return a.reject(e)}}}},function(e,t){e.exports=o},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085;var r=o(34);t.PlaylistSegmentRetriever=r.PlaylistSegmentRetriever;var n=o(35);t.Playlist=n.Playlist,t.PlaylistType=n.PlaylistType;var i=o(14);t.Segment=i.Segment;var a=o(37);t.TransmuxerFactory=a.TransmuxerFactory;var s=o(15);t.MP3ToMP4Transmuxer=s.MP3ToMP4;var l=o(16);t.PassThroughTransmuxer=l.PassThrough;var c=o(36);t.retrievalErrors=c.retrievalErrors;var u=o(33);t.events=u.events}])}(o(2),o(5),o(6))},function(e,t,o){e.exports=function(e){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._msg=e}return e.prototype.getMsg=function(){return this._msg},e}();t.OggParserError=r},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.ChecksumFailedError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.NoSegmentsInPageError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.PageFromDifferentBitstreamError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.PageSequenceNumberDidNotIncrementError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.UnexpectedBOSError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n.OggParserError);t.UnexpectedEOSError=i},function(e,t,o){"use strict";function r(e,t,o){return void 0===o&&(o=1),e.slice(t,t+o)}function n(e,t){return void 0===t&&(t=!0),new DataView(e).getUint32(0,t)}function i(e){var t=new Uint8Array(e.buffer,e.byteOffset),o=r(t,26),i=r(t,27,o[0]),a={version:r(t,4),type:r(t,5),granulePosition:r(t,6,8),bitstreamSerialNumber:r(t,14,4),pageSequenceNumber:r(t,18,4),checksum:r(t,22,4),pageSegments:o,segmentTable:i},c=[],u=27+o[0];if(i.forEach(function(e){c.push(r(t,u,e)),u+=e}),!c.length)throw new f.NoSegmentsInPageError("No segments.");var d=s.calculateCRC([m,a.version,a.type,a.granulePosition,a.bitstreamSerialNumber,a.pageSequenceNumber,g,o,i].concat(c)),p=n(a.checksum.buffer);if(d!==p)throw new l.ChecksumFailedError("Checksum failed.");return{header:a,segments:c,entirePage:r(t,0,u)}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(9),s=o(8),l=o(1),c=o(3),u=o(4),d=o(5),p=o(6),f=o(2),h=a.helpers.arrayBuffer.combine,m=new Uint8Array([79,103,103,83]),g=new Uint8Array([0,0,0,0]);t.retrievePages=function(e){for(var t=e.buffer,o=[],r=e.byteOffset-1;;){var n=r+1,a=new Uint8Array(t,n).findIndex(function(e,t,o){return o[t]===m[0]&&o[t+1]===m[1]&&o[t+2]===m[2]&&o[t+3]===m[3]});if(-1===a)break;r=a+=n;var s=new DataView(t,a);o.push(i(s))}return o},t.parsePage=i,t.retrievePackets=function(e){if(!e.length)return[];var t=n(e[0].header.bitstreamSerialNumber.buffer),o=-1,r=null,i=[];return e.forEach(function(a,s){if(n(a.header.bitstreamSerialNumber.buffer)!==t)throw new c.PageFromDifferentBitstreamError("Got a page from a different bitstream.");var l=n(a.header.pageSequenceNumber.buffer);if(l<=o)throw new u.PageSequenceNumberDidNotIncrementError("Page sequence number was not greater than the previous one.");var f=l!==o+1;o=l;var m=a.header.type[0],g=!!(1&m),b=!!(2&m);if(b&&s>0)throw new d.UnexpectedBOSError("Got BOS on a page which is not the first.");var v=!!(4&m);if(v&&s!==e.length-1)throw new p.UnexpectedEOSError("Got EOS on a page which is not the last.");var y=0;f&&(r=null);var _=a.segments.length;a.segments.forEach(function(e,t){if(r?r.data=h([r.data,e]):g&&0===t||(r={granulePosition:null,pageSequenceNumber:o,packetOffset:y,discontinuity:f&&0===y,first:b&&0===y,last:!1,data:e},y++),r&&e.byteLength<255){var s=t===_-1;s&&(r.granulePosition=n(a.header.granulePosition.buffer)),r.last=v&&s,i.push(r),r=null}})}),i}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);t.calculateCRC=function(e){var t=0;return e.forEach(function(e){for(var o=0;o<e.length;o++)t=t<<8^r[t>>24&255^e[o]]}),t>>>0}},function(t,o){t.exports=e},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085,function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(7));var r=o(0);t.OggParserError=r.OggParserError;var n=o(1);t.ChecksumFailedError=n.ChecksumFailedError;var i=o(2);t.NoSegmentsInPageError=i.NoSegmentsInPageError;var a=o(3);t.PageFromDifferentBitstreamError=a.PageFromDifferentBitstreamError;var s=o(4);t.PageSequenceNumberDidNotIncrementError=s.PageSequenceNumberDidNotIncrementError;var l=o(5);t.UnexpectedBOSError=l.UnexpectedBOSError;var c=o(6);t.UnexpectedEOSError=c.UnexpectedEOSError}])}(o(2))},function(e,t,o){e.exports=function(e){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(t,o){t.exports=e},function(e,t,o){"use strict";function r(e){var t=e[0]>>>3&31;if(t>=c.length)throw new Error("Invalid configuration.");return c[t]}Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(2),a=n.helpers.arrayBuffer,s=a.combine,l=a.numberToUint8Array,c=[10,20,40,60,10,20,40,60,10,20,40,60,10,20,10,20,2.5,5,10,20,2.5,5,10,20,2.5,5,10,20,2.5,5,10,20];t.buildWebm=function(e){var t=e[0];if(!t||!t.first)throw new Error("Missing start of stream.");var o=e.slice(2),n=function(e){if(!e.first)throw new Error("OpusHead is always in the first packet.");var t=e.data,o=new DataView(t.buffer),r=o.getUint8(9),n=o.getUint8(17),i=void 0,a=void 0,s=void 0;if(n>0){i=o.getUint8(18),a=o.getUint8(19),s=[];for(var l=0;l<r;l++)s.push(o.getUint8(20+l))}return{version:o.getUint8(8),channelCount:r,preSkip:o.getUint16(10,!0),inputSampleRate:o.getUint32(12,!0),outputGain:o.getUint16(16),channelMapFamily:n,streamCount:i,twoChannelStreamCount:a,channelMappingTable:s}}(t),a=0,c=o.map(function(e,t){if(e.discontinuity&&t>0)throw new Error("Discontinuities after first audio packet not supported.");var o=new Uint8Array(4);o[0]=129,new DataView(o.buffer).setInt16(1,a),o[3]=128;var n=function(e){var t=3&e[0];return 0===t?1:3!==t?2:63&e[1]}(e.data);return a+=n*r(e.data),i.encodeElement(i.IDS.SimpleBlock,s([o,e.data]))}),u=s([i.encodeElement(i.IDS.EBML,s([i.encodeElement(i.IDS.EBMLVersion,l(1)),i.encodeElement(i.IDS.EBMLReadVersion,l(1)),i.encodeElement(i.IDS.EBMLMaxIDLength,l(4)),i.encodeElement(i.IDS.EBMLMaxSizeLength,l(8)),i.encodeElement(i.IDS.DocType,new Uint8Array([119,101,98,109])),i.encodeElement(i.IDS.DocTypeVersion,l(1)),i.encodeElement(i.IDS.DocTypeReadVersion,l(2))])),i.encodeElement(i.IDS.Segment,i.encodeElement(i.IDS.Info,i.encodeElement(i.IDS.Duration,function(){var e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,a),e}()))),i.encodeElement(i.IDS.Tracks,i.encodeElement(i.IDS.TrackEntry,s([i.encodeElement(i.IDS.TrackNumber,l(1)),i.encodeElement(i.IDS.TrackUID,l(1)),i.encodeElement(i.IDS.FlagLacing,l(0)),i.encodeElement(i.IDS.CodecID,new Uint8Array([65,95,79,80,85,83])),i.encodeElement(i.IDS.CodecDelay,l(n.preSkip/48e3*1e9)),i.encodeElement(i.IDS.SeekPreRoll,new Uint8Array([4,196,180,0])),i.encodeElement(i.IDS.TrackType,l(2)),i.encodeElement(i.IDS.Audio,s([i.encodeElement(i.IDS.Channels,l(n.channelCount)),i.encodeElement(i.IDS.SamplingFrequency,new Uint8Array([64,231,112,0,0,0,0,0]))])),i.encodeElement(i.IDS.CodecPrivate,t.data)])))]),d=i.encodeElement(i.IDS.Cluster,function(){var e=[i.encodeElement(i.IDS.Timecode,l(0))];return e.push.apply(e,c),s(e)}());return{initData:u,data:d}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),n=r.helpers.arrayBuffer,i=n.combine,a=n.numberToUint8Array,s=n.createVintBuffer;t.IDS={EBML:440786851,EBMLVersion:17030,EBMLReadVersion:17143,EBMLMaxIDLength:17138,EBMLMaxSizeLength:17139,DocType:17026,DocTypeVersion:17031,DocTypeReadVersion:17029,Segment:408125543,Info:357149030,Duration:17545,Tracks:374648427,TrackEntry:174,TrackNumber:215,TrackUID:29637,FlagLacing:156,CodecID:134,CodecDelay:22186,SeekPreRoll:22203,TrackType:131,Audio:225,Channels:159,SamplingFrequency:181,CodecPrivate:25506,Cluster:524531317,Timecode:231,SimpleBlock:163},t.encodeElement=function(e,t){var o=a(e),r=s(t.byteLength);return i([o,r,t])}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085,function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(1))}])}(o(2))},function(e,t,o){e.exports=function(e){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(t,o){t.exports=e},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return e.call(this,"An unrecoverable error occurred whilst decoding.")||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.DECODE_ERROR"},t}(n.errors.PlayerFatalError);t.DecodeError=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return e.call(this,"An unrecoverable network error occurred.")||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.NETWORK_ERROR"},t}(n.errors.PlayerFatalError);t.NetworkError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(0);t.buildTimeRanges=function(e){for(var t=[],o=e.length,n=0;n<o;n++)t.push({end:1e3*e.end(n),start:1e3*e.start(n)});return r.TimeRange.normalizeRawTimeRanges(t).map(function(e){return new r.TimeRange(e.start,e.end-e.start)})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(1),n=o(2);!function(e){e.DecodeError=r.DecodeError,e.NetworkError=n.NetworkError}(t.errors||(t.errors={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(3);!function(e){!function(e){e.buildTimeRanges=r.buildTimeRanges}(e.timeRanges||(e.timeRanges={}))}(t.helpers||(t.helpers={}))},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(1),a=o(2),s=o(3),l=o(7),c=n.helpers.deferred.buildDeferred,u=n.helpers.url.getExtension,d=n.helpers.Promise,p=n.helpers.compact,f=n.logger.prefixLogger,h=n.errors.NotSupportedError,m=n.errors.PlayerFatalError,g=new Error("Media element was revoked."),b=function(e){function t(t,o){var r=e.call(this,o)||this;r._duration=null,r._stallDetected=!1,r._initialized=!1,r._deferredProvideMediaElementCallback=null,r._playInProgress={inProgress:!1},r._lastStallCheckPos=null,r._stallCheckTimerId=null,r._endedOverride=!1,r._volume=1,r._muted=!1,r._pauseEventTimer=null,r._positionWhenMediaElementRevoked=0,r._playingWhenMediaElementRevoked=!1,r._provideMediaElementDeferred=null,r._mediaElementAndState=null,r._listeners=[],r._currentSeekCallback=null,r._playDetectionPosition=0,r._playDetectionTimer=null,r._playDetectionTimerNumAttempts=0,r._logger=f(r._logger,"HTML5Player"),r._descriptor=t,r._playerDependencies=o,r._mimeType=t.getFormat().mimeType||r._buildMimeTypeAndCodecString(t.getFormat(),r._inferFormat(t.getUrl()));var i=void 0!==o.mediaElement?o.mediaElement:r._createDefaultMediaElement();return i&&r.provideMediaElement(i).catch(function(e){return e===g?void r._logger.debug("Initial provideMediaElement() call was aborted."):void r._triggerError(new l.InitializeError(e))}),r._logger.info("Checking if the player can play the provided descriptor."),r._canPlayTimer=window.setTimeout(function(){r._canPlay().then(function(e){if(!r.isDead())return e instanceof n.errors.NotSupportedError?(r._logger.info("Player not supported.",e),void r._triggerError(e)):e?(r._logger.info("Player supported."),void r._initialize()):(r._logger.info("Player not supported."),void r._triggerError(new h))}).catch(function(e){r._logger.error("Unexpected error during can play check.",e),r._triggerError(new m("An unexpected error occured during initialization.",e))})},0),r}return r(t,e),t.prototype.getMediaElement=function(){return this._mediaElementAndState&&this._mediaElementAndState.element},t.prototype.provideMediaElement=function(e){var t=this;if(this._ensureNotDead(),this._mediaElementAndState)throw new Error("Already have a media element.");this._logger.debug("provideMediaElement() called.",e),this._initMediaElementLocal(e,null);var o=this._provideMediaElementDeferred=c(),r=this._mediaElementAndState={element:e,state:"INITIALIZING"},n=function(){t._logger.debug("Initializing media element."),t._initMediaElement(e,t._descriptor.getUrl()),t._attachListeners();var n=t._listenToOnce("error",function(){t._provideMediaElementDeferred=null;var r=e.error.code+" = "+(e.error.message||"[unknown]");t._logger.error("Error whilst initializing media element.",r),t.revokeMediaElement(),o.reject(new Error("Error when initializing media element. Error: "+r))},{earlyAttach:!0});t._listenToOnce("loadeddata",function(){t._logger.debug("Got loadeddata event from media element."),i()},{earlyAttach:!0});var i=function(){t._logger.debug("Putting media element in the state that is expected..."),a()},a=function(){null===t._getQueuedSeekPosition()&&t._positionWhenMediaElementRevoked>0?(t._logger.debug("Seeking to expected position..."),t._performSeek(t._positionWhenMediaElementRevoked,function(e){return void 0!==e?(t._provideMediaElementDeferred=null,t._logger.error("An error occurred when trying to seek to the expected position."),t.revokeMediaElement(),void o.reject(new Error("An error occurred when trying to restore the position."))):(t._logger.debug("Seeked to expected position."),void s())})):s()},s=function(){t.isPlaying()===t.isActuallyPlaying()&&t._playingWhenMediaElementRevoked?(t._logger.debug("Calling play to match previous state..."),t._play().catch(function(){t._provideMediaElementDeferred=null,t._logger.error("An error occurred when trying to play."),r===t._mediaElementAndState&&t.revokeMediaElement(),o.reject(new Error("Browser refused play() request on media element."))}),t._listenToOnce("play",function(){t._logger.debug("Play succeeded."),l()},{earlyAttach:!0})):l()},l=function(){return t._mediaElementAndState!==r?void t._triggerError(new m("Media element switched unexpectedly.")):(t._provideMediaElementDeferred=null,n.remove(),o.resolve(void 0),t._mediaElementAndState.state="STABLE",t._logger.debug("Finished putting element in expected state."),void(null!==t._duration&&t._update(function(){t.isReady()||t._signalReady(),t._handleDefferredPauseAndSeek()})))}};return this._initialized?n():this._deferredProvideMediaElementCallback=n,this._provideMediaElementDeferred.promise},t.prototype.revokeMediaElement=function(){if(!this._mediaElementAndState)throw new Error("There is no media element to revoke.");this._deferredProvideMediaElementCallback=null,this._provideMediaElementDeferred&&(this._provideMediaElementDeferred.reject(g),this._provideMediaElementDeferred=null),this._logger.debug("revokeMediaElement() called."),this._detachListeners();var e=this._mediaElementAndState.element;this.isDead()||(this._positionWhenMediaElementRevoked=this.getPosition(),this._playingWhenMediaElementRevoked=this.isPlaying()),this._mediaElementAndState=null,this._initMediaElement(e,null),this.isDead()||this._handleStalled()},t.prototype.getVolume=function(){return this._volume},t.prototype.getMuted=function(){return this._muted},t.prototype.setMuted=function(e){this._muted=e,this._mediaElementAndState&&(this._mediaElementAndState.element.muted=e)},t.prototype.getBufferedTimeRanges=function(){return this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state?s.buildTimeRanges(this._mediaElementAndState.element.buffered):[]},t.prototype.getMaxBufferLength=function(){return null},t.prototype._setVolume=function(e){this._volume=e,this._mediaElementAndState&&(this._mediaElementAndState.element.volume=e)},t.prototype._inferFormat=function(e){var t=u(e);switch(t){case"mp3":return{mimeType:"audio/mpeg"};case"opus":return{mimeType:"audio/ogg",audioCodec:{id:"opus"}};case"mp4":return{mimeType:"video/mp4"};case"m3u8":return{mimeType:"application/x-mpegURL"};default:return{}}},t.prototype._buildMimeTypeAndCodecString=function(e,t){void 0===t&&(t={});var o=e.mimeType||t.mimeType,r=e.audioCodec||t.audioCodec,n=e.videoCodec||t.videoCodec,i=p([r,n]),a=i.length>0?'; codecs="'+i.map(function(e){return e.id}).join(",")+'"':"";return o+a},t.prototype._getResolvedMimeType=function(){return this._mimeType},t.prototype._canPlay=function(){return this._mimeType&&this._canPlayProtocol(this._descriptor.getProtocol())&&this._canPlayType(this._mimeType)?d.resolve(!0):d.resolve(!1)},t.prototype._canPlayProtocol=function(e){return["http","hls"].indexOf(e.name)>=0},t.prototype._canPlayType=function(e){try{var t=document.createElement("audio");return!!t.canPlayType(e)}catch(e){return!1}},t.prototype._initialize=function(){var e=this;this._initialized=!0,this._listenTo("error",function(){if("INITIALIZING"!==e._mediaElementAndState.state){var t=e._mediaElementAndState.element.error;switch(t.code){case 2:e._triggerError(new a.NetworkError);break;case 3:e._triggerError(new i.DecodeError);break;default:e._triggerError(new n.errors.PlayerFatalError("An unexpected error occurred.",t))}}else e._logger.debug("An error occurred, but the media element is initializing, so ignoring...")},{earlyAttach:!0}),this._listenTo("play",function(){e._logger.debug("Media element play event."),e.isPlaying()||!e._mediaElementAndState||e._mediaElementAndState.element.paused||(e._logger.debug("Calling play() because something external called play() on media element."),e.play())}),this._listenTo("playing",function(){e._logger.debug("Media element playing event."),e._mediaElementAndState&&!e._mediaElementAndState.element.paused?e._handlePlayingEvent():e._logger.debug("Ignoring playing event because media element is reporting it is paused.")}),this._listenTo("timeupdate",function(){return e._determineIfPlaying()}),this._listenTo("pause",function(){e._logger.debug("Media element pause event."),e._mediaElementAndState&&e._mediaElementAndState.element.paused?e._handlePauseEvent():e._logger.debug("Ignoring pause event because media element is reporting it is not paused.")}),this._listenTo("ended",function(){e._logger.debug("Media element ended event."),e._mediaElementAndState&&!e._mediaElementAndState.element.ended?e._handleEndedEvent():e._logger.debug("Ignoring ended event because media element is reporting it is not ended.")}),this._listenTo("stalled",function(){e._logger.debug("Media element stalled event."),e._checkIfStalled()}),this._stallCheckTimerId=window.setInterval(function(){return e._checkIfStalled()},400),this._retrieveDuration().then(function(t){e._logger.debug("Duration retrieved.",t),e._duration=t,e._update(function(){e._provideDuration(t),e._mediaElementAndState&&"STABLE"===e._mediaElementAndState.state&&(e._signalReady(),e._handleDefferredPauseAndSeek())})}).catch(function(t){e._triggerError(new n.errors.PlayerFatalError("An unexpected error occurred when attempting to retrieve the duration.",t))}),this._deferredProvideMediaElementCallback&&this._deferredProvideMediaElementCallback()},t.prototype._createDefaultMediaElement=function(){return document.createElement(this._playerDependencies.mediaElementType||"audio")},t.prototype._handlePauseEvent=function(){var e=this;if(!this._mediaElementAndState)throw new Error("Media element should exist.");var t=this._mediaElementAndState.element;this._pauseEventTimer||(this._pauseEventTimer=window.setTimeout(function(){e._pauseEventTimer=null,t.paused&&e.isActuallyPlaying()&&e._update(function(){e.isEnded()||(e._notifyNotStalled(),e._notifyPlaying(!1))})},0))},t.prototype._handlePlayingEvent=function(){var e=this,t=this._duration;if(null===t)throw new Error("Expecting duration to exist.");var o=this._getTruePosition();return o>=t?void this._logger.warn("Got a media element playing event and the positon was >= the duration.",o,t):this.isEnded()||this._shouldBeEnded()?void this._logger.warn("Got a media element playing event when the player is/should be ended."):void this._update(function(){e._notifyNotStalled(),e._determineIfPlaying(),e.isActuallyPlaying()||(e._playDetectionTimerNumAttempts=0,e._playDetectionTimer||(e._playDetectionTimer=window.setInterval(function(){return e._determineIfPlaying()},10)))})},t.prototype._handleEndedEvent=function(){return null!==this._getQueuedSeekPosition()?void this._logger.warn("Got a media element ended event but ignoring because a seek is in progress."):void this._update()},t.prototype._shouldBeEnded=function(){return this._endedOverride||this._mediaElementReportingEnded()},t.prototype._mediaElementReportingEnded=function(){return!!(this._mediaElementAndState&&this._mediaElementAndState.element.ended&&this._mediaElementAndState.element.paused)},t.prototype._retrieveDuration=function(){var e=this;return new d(function(t){e._listenToOnce("loadedmetadata",function(){var o=e._mediaElementAndState;o&&t(1e3*o.element.duration)},{reattach:!0,earlyAttach:!0})})},t.prototype._handlePlayPauseChange=function(e){var t=this;if(this.isEnded())!e&&this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&this._mediaElementAndState.element.pause(),this._notifyPlaying(e);else if(this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state){var o=this._mediaElementAndState.element,r=this._playInProgress.inProgress||!o.paused;if(r!==e)if(e){this._playDetectionPosition=this._getTruePosition();var n={inProgress:!0};this._playInProgress=n,this._play().then(function(){return n.inProgress=!1}).catch(function(e){return t._playInProgress!==n?void t._logger.debug("Ignoring play error because paused since.",e):(n.inProgress=!1,void t._notifyPlayRejection(e))})}else this._playInProgress={inProgress:!1},o.pause(),this._notifyPlaying(!1);else this._playInProgress.inProgress||this._notifyPlaying(e)}},t.prototype._handleSeekChange=function(e){var t=this,o=this._mediaElementAndState;if(o&&"USABLE"===o.state){var r=this._mediaElementReportingEnded();this._endedOverride=!1,this._performSeek(e,function(o){return void 0!==o?void t._triggerError(new n.errors.PlayerFatalError("An error occurred when trying to seek.",o)):(e===t._duration&&(t._endedOverride=!0),void t._signalSeekComplete())}),r&&this._handlePlayPauseChange(this.isPlaying())}},t.prototype._performSeek=function(e,t){var o=this,r=this._mediaElementAndState;if(!r)throw new Error("Media element does not exist.");var n=this._currentSeekCallback;if(n&&(this._currentSeekCallback=null,n.listenerHandle.remove()),r.element.currentTime!==e/1e3){r.element.currentTime=e/1e3;var i=this._listenToOnce("seeked",function(){o._currentSeekCallback=null,t()},{earlyAttach:!0});this._currentSeekCallback={listenerHandle:i,callback:t}}else t()},t.prototype._getPosition=function(){var e=null!==this._duration?this._duration:1/0;if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)return this._positionWhenMediaElementRevoked;this._determineIfPlaying();var t=Math.min(this._getTruePosition(),e);return this._shouldBeEnded()?e:t},t.prototype._getTruePosition=function(){if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)throw new Error("Media element does not exist or is in invalid state.");var e=this._mediaElementAndState.element;return 1e3*e.currentTime},t.prototype._kill=function(){window.clearTimeout(this._canPlayTimer),this._playDetectionTimer&&window.clearInterval(this._playDetectionTimer),this._mediaElementAndState&&this.revokeMediaElement(),this._stallCheckTimerId&&window.clearInterval(this._stallCheckTimerId),this._listeners=[]},t.prototype._listenToOnce=function(e,t,o){void 0===o&&(o={});var r=o.reattach,n=o.earlyAttach;void 0===r&&(r=!1),void 0===n&&(n=!1);var i=this._listenTo(e,function(e){i.remove(),t(e)},{reattach:r,earlyAttach:n});return i},t.prototype._listenTo=function(e,t,o){var r=this;void 0===o&&(o={});var n=o.reattach,i=o.earlyAttach;void 0===n&&(n=!0),void 0===i&&(i=!1);var a=function(e){s.attached?t(e):r._logger.warn("Got media element event after handler was removed. Ignoring.",e)},s={attached:!1,handler:a,eventType:e,once:!1,reattach:n,earlyAttach:i};if(this._listeners.push(s),!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state&&!i)return{remove:function(){var e=r._listeners.indexOf(s);e>=0&&r._listeners.splice(e,1)}};var l=this._mediaElementAndState.element;return l.addEventListener(e,a,!1),s.attached=!0,{remove:function(){var t=r._listeners.indexOf(s);t>=0&&(r._listeners.splice(t,1),s.attached=!1,l.removeEventListener(e,a,!1))}}},t.prototype._notifyNotStalled=function(){this._stallDetected=!1,this._lastStallCheckPos=null,this._handleStalled()},t.prototype._initMediaElement=function(e,t){this._initMediaElementLocal(e,t)},t.prototype._determineIfPlaying=function(){var e=this;this._playDetectionTimer&&(!this.isPlaying()||++this._playDetectionTimerNumAttempts>=200)&&(window.clearInterval(this._playDetectionTimer),this._playDetectionTimer=null),this._update(function(){e._mediaElementAndState&&"USABLE"===e._mediaElementAndState.state&&(e.isDead()||!e.isReady()||!e.isPlaying()||e.isActuallyPlaying()||e._mediaElementAndState.element.paused||e._getTruePosition()===e._playDetectionPosition||(e._logger.debug("Detected that playback has started."),e._playDetectionTimer&&(window.clearInterval(e._playDetectionTimer),e._playDetectionTimer=null),e._notifyPlaying(!0)))})},t.prototype._initMediaElementLocal=function(e,t){e.setAttribute("msAudioCategory","BackgroundCapableMedia"),e.mozAudioChannelType="content",e.removeAttribute("src"),function(e){e.load()}(e),t?(this._logger.debug("Setting media element src.",t),e.src=t):this._pauseEventTimer&&(this._logger.debug("Clearing pause event timer."),window.clearTimeout(this._pauseEventTimer),this._pauseEventTimer=null),e.volume=this._volume,e.muted=this._muted,e.playbackRate=1,e.setAttribute("preload","metadata"),e.pause(),e.load()},t.prototype._checkIfStalled=function(){if(this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state){var e=this._mediaElementAndState.element;if(!e.paused&&this.isActuallyPlaying()){var t=e.currentTime;this._stallDetected=e.readyState<=2||this._lastStallCheckPos===t,this._lastStallCheckPos=t,this._handleStalled()}}},t.prototype._handleStalled=function(){this._shouldBeEnded()&&null===this._getQueuedSeekPosition()?this.isEnded()||(this._logger.debug("Updating because stalled near end."),this._update()):this._notifyStalled(this._stallDetected||!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)},t.prototype._play=function(){var e=this;if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");if(this._mediaElementReportingEnded())return this._logger.debug("Not calling play() because we are at the end. It will be called after a seek."),d.resolve();var t=this._mediaElementAndState.element.play();return new d(function(o,r){t?t.then(function(){o()}).catch(function(t){"AbortError"===t.name?(e._logger.debug("Media element play() promise rejected with AbortError."),o()):r(t)}):o()})},t.prototype._handleDefferredPauseAndSeek=function(){var e=this;if(!this._mediaElementAndState||"STABLE"!==this._mediaElementAndState.state)throw new Error("Media element must be in the STABLE state.");this._logger.debug("Handling deferred pause and seek..."),this._mediaElementAndState.state="USABLE",this._attachListeners(),this._update(function(){e._handleStalled();var t=e._getQueuedSeekPosition();null!==t&&e._handleSeekChange(t),e.isPlaying()!==e.isActuallyPlaying()&&e._handlePlayPauseChange(e.isPlaying())})},t.prototype._detachListeners=function(){if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");var e=this._mediaElementAndState.element;this._listeners.forEach(function(t){t.attached&&(t.attached=!1,e.removeEventListener(t.eventType,t.handler,!1))}),this._listeners=this._listeners.filter(function(e){return e.reattach})},t.prototype._attachListeners=function(){if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");this._logger.debug("Attaching listeners...");var e=this._mediaElementAndState,t=e.element,o=e.state;this._listeners.forEach(function(e){e.attached||!e.reattach||"USABLE"!==o&&!e.earlyAttach||(t.addEventListener(e.eventType,e.handler,!1),e.attached=!0)}),this._logger.debug("Attached listeners.")},t}(n.BasePlayer);t.HTML5Player=b},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(t){return e.call(this,"An error occurred when initializing the media element.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.INITIALIZE_ERROR"},t}(n.errors.PlayerFatalError);t.InitializeError=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085;var r=o(6);t.HTML5Player=r.HTML5Player;var n=o(4);t.errors=n.errors;var i=o(5);t.helpers=i.helpers}])}(o(2))},function(e,t,o){e.exports=function(e){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),i=function(e){function t(t,o,r){void 0===o&&(o={}),void 0===r&&(r=2e4);var n=e.call(this)||this;if(r<0)throw new Error("Invaid timeout.");return n._timeoutTimer=window.setTimeout(function(){return n._onManualTimeout()},r),n._xhr=new XMLHttpRequest,n._xhr.addEventListener("load",function(){return n._onLoad()}),n._xhr.addEventListener("abort",function(){return n._onAbort()}),n._xhr.addEventListener("error",function(){return n._onError()}),n._xhr.addEventListener("timeout",function(){return n._onTimeout()}),n._xhr.addEventListener("loadend",function(){return n._onLoadEnd()}),n._xhr.open("GET",t,!0),n._xhr.timeout=r,n._xhr.responseType=n._getResponseType(),Object.keys(o).forEach(function(e){return n._xhr.setRequestHeader(e,o[e])}),n._signalRequestStart(),n._xhr.send(),n}return r(t,e),t.prototype._abort=function(){this._xhr.abort()},t.prototype._onAbort=function(){this.hasCompleted()||this._provideResponse(new Error("Request was aborted."))},t.prototype._onManualTimeout=function(){this.hasCompleted()||(this._provideResponse(null),this._xhr.abort())},t.prototype._onTimeout=function(){this.hasCompleted()||this._provideResponse(null)},t.prototype._onLoad=function(){if(!this.hasCompleted()){var e=this._xhr;this._provideResponse({statusCode:e.status,data:this._xhr.response,headers:this._parseHeaders(e.getAllResponseHeaders()||"")})}},t.prototype._onError=function(){this.hasCompleted()||(0===this._xhr.status?this._provideResponse({statusCode:0,data:null,headers:{}}):this._provideResponse(new Error("An error occurred.")))},t.prototype._onLoadEnd=function(){window.clearTimeout(this._timeoutTimer),this.hasCompleted()||this._provideResponse(new Error("Unexpected error occurred."))},t.prototype._parseHeaders=function(e){var t={};if(!e)return t;for(var o=e.split("\r\n"),r=0,n=o.length;r<n;r++){var i=o[r],a=i.indexOf(": ");if(a>0){var s=i.substring(0,a).trim(),l=i.substring(a+2);t[s]=l}}return t},t}(n.loader.LoaderRequest);t.LoaderRequest=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(3);t.arrayBufferLoader={request:function(e){var t=e.url,o=e.headers,n=e.timeout;return new r.ArrayBufferLoaderRequest(t,o,n)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(4);t.stringLoader={request:function(e){var t=e.url,o=e.headers,n=e.timeout;return new r.StringLoaderRequest(t,o,n)}}},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._getResponseType=function(){return"arraybuffer"},t}(n.LoaderRequest);t.ArrayBufferLoaderRequest=i},function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._getResponseType=function(){return"text"},t}(n.LoaderRequest);t.StringLoaderRequest=i},function(t,o){t.exports=e},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="13.0.0",t.buildNumber=1085;var r=o(2);t.stringLoader=r.stringLoader;var n=o(1);t.arrayBufferLoader=n.arrayBufferLoader}])}(o(2))},function(e,t,o){e.exports=function(e,t){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,o){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(2),i=o(3),a=o(1),s=n.helpers.abortableJob.AbortableJob,l=n.helpers.find,c=n.helpers.time,u=new a.Limiter(300,3e5),d=[i.renditions.encryptedHlsOpus,i.renditions.hlsOpus,i.renditions.encryptedHlsMp3,i.renditions.hlsMp3,i.renditions.httpMp3],p=function(e){function t(t){var o=t.loader,r=t.clientId,n=t.trackId,i=t.secretToken,a=void 0===i?null:i,s=t.requestAuthorization,l=void 0===s?null:s,c=t.excludedRenditions,u=void 0===c?[]:c,d=t.maxBitrate,p=void 0===d?1/0:d,f=t.endpointBaseUrl,h=void 0===f?"https://api.soundcloud.com/":f,m=t.encryptedStreamsEnabled,g=void 0!==m&&m,b=e.call(this)||this;if(b._getUrlsJob=null,b._clearResponseTimer=null,!o)throw new Error("loader required.");if("string"!=typeof r)throw new Error("clientId invalid.");if("number"!=typeof n)throw new Error("trackId invalid.");if(null!==a&&"string"!=typeof a)throw new Error("secretToken invalid.");if(null!==l&&"string"!=typeof l)throw new Error("requestAuthorizaton invalid.");if("number"!=typeof p||p<=0)throw new Error("maxBitrate must be > 0.");if("string"!=typeof h)throw new Error("endpointBaseUrl must be > 0.");if("boolean"!=typeof g)throw new Error("encryptedStreamsEnabled invalid.");return b._loader=o,b._clientId=r,b._requestAuthorization=l,b._trackId=n,b._secretToken=a,b._endpointBaseUrl=h,b._encryptedStreamsEnabled=g,b._excludedRenditions=u,b._excludedRenditionsOnLastURLRequest=u.slice(),b._maxBitrate=p,b}return r(t,e),t.prototype.getTrackId=function(){return this._trackId},t.prototype.excludeRendition=function(e){this._excludedRenditions.indexOf(e)<0&&this._excludedRenditions.push(e)},t.prototype.updateRequestAuthorization=function(e){if(null!==e&&"string"!=typeof e)throw new Error("requestAuthorizaton invalid.");this._requestAuthorization=e},t.prototype.clearCache=function(){this._clearResponseTimer&&(window.clearTimeout(this._clearResponseTimer),this._clearResponseTimer=null),this._getUrlsJob=null},t.prototype.getMaxBitrate=function(){return this._maxBitrate},t.prototype.setMaxBitrate=function(e){if("number"!=typeof e||e<=0)throw new Error("maxBitrate must be > 0.");this._maxBitrate=e},t.prototype.getUrl=function(){var e=this,t=this._maxBitrate,o=this._excludedRenditions,r=new s(function(){e._excludedRenditionsOnLastURLRequest.length===e._excludedRenditions.length?e.clearCache():e._excludedRenditionsOnLastURLRequest=e._excludedRenditions.slice();var r=e._getUrls(),n=r.whenComplete().then(function(e){var r=e.urls,n=e.timeRetrieved,i=null;return d.filter(function(e){return o.indexOf(e)<0}).some(function(e){var o=r.filter(function(t){return t.rendition===e}).map(function(e){return{url:e.url,bitrate:e.bitrate}}),a=l(o.sort(function(e,t){return t.bitrate-e.bitrate}),function(e){return e.bitrate<=t});return!!a&&(i={url:a.url,rendition:e,bitrate:a.bitrate,timeRetrieved:n},!0)}),i});return{result:n,abort:function(){return r.abort()}}});return r.run()},t.prototype._getUrls=function(){var e=this;return this._getUrlsJob||(this._getUrlsJob=new s(function(){var t=n.helpers.deferred.buildDeferred(),o=null,r=u.execute(function(){var r=e._requestAuthorization?{Authorization:e._requestAuthorization}:{},n=e._endpointBaseUrl+"i1/tracks/"+encodeURI(e._trackId+"")+"/streams?client_id="+encodeURIComponent(e._clientId);e._encryptedStreamsEnabled&&(n+="&with_encrypted_streams=true"),e._secretToken&&(n+="&secret_token="+encodeURIComponent(e._secretToken));var a=(o=e._loader.request({url:n,headers:r})).getResponse().then(function(e){if(!e)throw new i.RequestError(null);if(200!==e.statusCode)throw new i.RequestError(e.statusCode);if(!e.data)throw new Error("Response contained no data.");var t=c.now(),o=JSON.parse(e.data),r=[];return Object.keys(o).map(function(e){var t=e.split("_"),n=t[0],i=t[1],a=t[2],s=parseInt(a,10);if(n&&i&&!isNaN(s)){var c=l(d,function(e){return e.scProtocol===n&&e.scFormat===i});c&&r.push({rendition:c,bitrate:s,url:o[e]})}}),{urls:r,timeRetrieved:t}});a.then(t.resolve,t.reject)});return{result:t.promise,abort:function(){r.abort(),o&&o.abort()}}}),this._clearResponseTimer=window.setTimeout(function(){e._clearResponseTimer=null,e._getUrlsJob=null},5e3)),this._getUrlsJob.run()},t}(i.BaseStreamUrlRetriever);t.StreamUrlRetriever=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(void 0===t&&(t=6e4),this._limit=e,this._period=t,this._jobs=[],this._jobsRunInPeriod=0,e<=0)throw new Error("limit must be > 0.");if(t<=0)throw new Error("period must be > 0.")}return e.prototype.execute=function(e){var t=this,o={job:e};return this._jobs.push(o),this._executeNextJob(),{abort:function(){var e=t._jobs.indexOf(o);e>=0&&t._jobs.splice(e,1)}}},e.prototype._executeNextJob=function(){var e=this;if(this._jobsRunInPeriod<this._limit){var t=this._jobs.shift();t&&(this._jobsRunInPeriod++,window.setTimeout(function(){e._jobsRunInPeriod--,e._executeNextJob()},this._period),t.job())}},e}();t.Limiter=r},function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="12.0.0",t.buildNumber=404;var r=o(0);t.StreamUrlRetriever=r.StreamUrlRetriever}])}(o(2),o(1))}])},function(e,t,o){var r;(function(e,n,i,a){
/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
	 * @version   2.3.0
	 */
(function(){"use strict";function s(e){return"function"==typeof e}function l(){return function(){setTimeout(c,1)}}function c(){for(var e=0;e<C;e+=2){var t=I[e],o=I[e+1];t(o),I[e]=void 0,I[e+1]=void 0}C=0}function u(){}function d(e,t){if(t.constructor===e.constructor)!function(e,t){t._state===D?h(e,t._result):t._state===F?m(e,t._result):g(t,void 0,function(t){p(e,t)},function(t){m(e,t)})}(e,t);else{var o=function(e){try{return e.then}catch(e){return L.error=e,L}}(t);o===L?m(e,L.error):void 0===o?h(e,t):s(o)?function(e,t,o){T(function(e){var r=!1,n=function(e,t,o,r){try{e.call(t,o,r)}catch(e){return e}}(o,t,function(o){r||(r=!0,t!==o?p(e,o):h(e,o))},function(t){r||(r=!0,m(e,t))},e._label);!r&&n&&(r=!0,m(e,n))},e)}(e,t,o):h(e,t)}}function p(e,t){e===t?m(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?d(e,t):h(e,t)}function f(e){e._onerror&&e._onerror(e._result),b(e)}function h(e,t){e._state===x&&(e._result=t,e._state=D,0!==e._subscribers.length&&T(b,e))}function m(e,t){e._state===x&&(e._state=F,e._result=t,T(f,e))}function g(e,t,o,r){var n=e._subscribers,i=n.length;e._onerror=null,n[i]=t,n[i+D]=o,n[i+F]=r,0===i&&e._state&&T(b,e)}function b(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var r,n,i=e._result,a=0;a<t.length;a+=3)r=t[a],n=t[a+o],r?y(o,r,n,i):n(i);e._subscribers.length=0}}function v(){this.error=null}function y(e,t,o,r){var n,i,a,l,c=s(o);if(c){if((n=function(e,t){try{return e(t)}catch(e){return U.error=e,U}}(o,r))===U?(l=!0,i=n.error,n=null):a=!0,t===n)return void m(t,new TypeError("A promises callback cannot return that same promise."))}else n=r,a=!0;t._state!==x||(c&&a?p(t,n):l?m(t,i):e===D?h(t,n):e===F&&m(t,n))}function _(e,t){var o=this;o._instanceConstructor=e,o.promise=new e(u),o._validateInput(t)?(o._input=t,o.length=t.length,o._remaining=t.length,o._init(),0===o.length?h(o.promise,o._result):(o.length=o.length||0,o._enumerate(),0===o._remaining&&h(o.promise,o._result))):m(o.promise,o._validationError())}function S(e){this._id=q++,this._state=void 0,this._result=void 0,this._subscribers=[],u!==e&&(s(e)||function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof S||function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}(),function(e,t){try{t(function(t){p(e,t)},function(t){m(e,t)})}catch(t){m(e,t)}}(this,e))}var w,k,E,P=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},C=0,T=function(e,t){I[C]=e,I[C+1]=t,2===(C+=2)&&(k?k(c):E())},R="undefined"!=typeof window?window:void 0,O=R||{},M=O.MutationObserver||O.WebKitMutationObserver,A=void 0!==e&&"[object process]"==={}.toString.call(e),N="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,I=new Array(1e3);E=A?function(){var t=e.nextTick,o=e.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(o)&&"0"===o[1]&&"10"===o[2]&&(t=n),function(){t(c)}}():M?function(){var e=0,t=new M(c),o=document.createTextNode("");return t.observe(o,{characterData:!0}),function(){o.data=e=++e%2}}():N?function(){var e=new MessageChannel;return e.port1.onmessage=c,function(){e.port2.postMessage(0)}}():void 0===R?function(){try{var e=o(29);return w=e.runOnLoop||e.runOnContext,function(){w(c)}}catch(e){return l()}}():l();var x=void 0,D=1,F=2,L=new v,U=new v;_.prototype._validateInput=function(e){return P(e)},_.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},_.prototype._init=function(){this._result=new Array(this.length)};var j=_;_.prototype._enumerate=function(){for(var e=this,t=e.length,o=e.promise,r=e._input,n=0;o._state===x&&n<t;n++)e._eachEntry(r[n],n)},_.prototype._eachEntry=function(e,t){var o=this,r=o._instanceConstructor;!function(e){return"object"==typeof e&&null!==e}(e)?(o._remaining--,o._result[t]=e):e.constructor===r&&e._state!==x?(e._onerror=null,o._settledAt(e._state,t,e._result)):o._willSettleAt(r.resolve(e),t)},_.prototype._settledAt=function(e,t,o){var r=this,n=r.promise;n._state===x&&(r._remaining--,e===F?m(n,o):r._result[t]=o),0===r._remaining&&h(n,r._result)},_.prototype._willSettleAt=function(e,t){var o=this;g(e,void 0,function(e){o._settledAt(D,t,e)},function(e){o._settledAt(F,t,e)})};var B=function(e){return new j(this,e).promise},V=function(e){function t(e){p(r,e)}function o(e){m(r,e)}var r=new this(u);if(!P(e))return m(r,new TypeError("You must pass an array to race.")),r;for(var n=e.length,i=0;r._state===x&&i<n;i++)g(this.resolve(e[i]),void 0,t,o);return r},H=function(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(u);return p(t,e),t},G=function(e){var t=new this(u);return m(t,e),t},q=0,z=S;S.all=B,S.race=V,S.resolve=H,S.reject=G,S._setScheduler=function(e){k=e},S._setAsap=function(e){T=e},S._asap=T,S.prototype={constructor:S,then:function(e,t){var o=this,r=o._state;if(r===D&&!e||r===F&&!t)return this;var n=new this.constructor(u),i=o._result;if(r){var a=arguments[r-1];T(function(){y(r,n,a,i)})}else g(o,n,e,t);return n},catch:function(e){return this.then(null,e)}};var W=function(){var e;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=z)},Y={Promise:z,polyfill:W};o(23).amd?void 0!==(r=function(){return Y}.call(t,o,t,a))&&(a.exports=r):void 0!==a&&a.exports?a.exports=Y:void 0!==this&&(this.ES6Promise=Y),W()}).call(this)}).call(t,o(6),o(25).setImmediate,function(){return this}(),o(24)(e))},function(e,t){"use strict";var o={oauth_token:void 0,baseURL:"https://api.soundcloud.com",connectURL:"//connect.soundcloud.com",client_id:void 0,redirect_uri:void 0};e.exports={get:function(e){return o[e]},set:function(e,t){t&&(o[e]=t)}}},function(e,t,o){(function(t){"use strict";var r=o(3),n=o(20),i=o(2).Promise,a=function(e,o,r,n){var a=void 0,s=new i(function(i){var s=t.FormData&&r instanceof FormData;(a=new XMLHttpRequest).upload&&a.upload.addEventListener("progress",n),a.open(e,o,!0),s||a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&i({responseText:a.responseText,request:a})},a.send(r)});return s.request=a,s},s=function e(t,o,r,n){var i=a(t,o,r,n),s=i.then(function(t){var o=t.responseText,r=t.request,n=function(e){var t=e.responseText,o=e.request,r=void 0,n=void 0;try{n=JSON.parse(t)}catch(e){}return n?n.errors&&(r={message:""},n.errors[0]&&n.errors[0].error_message&&(r={message:n.errors[0].error_message})):r=o?{message:"HTTP Error: "+o.status}:{message:"Unknown error"},r&&(r.status=o.status),{json:n,error:r}}({responseText:o,request:r});if(n.json&&"302 - Found"===n.json.status)return e("GET",n.json.location,null);if(200!==r.status&&n.error)throw n.error;return n.json});return s.request=i.request,s};e.exports={request:function(e,o){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3],l=r.get("oauth_token"),c=r.get("client_id"),u={},d=t.FormData&&i instanceof FormData,p=void 0,f=void 0;return u.format="json",l?u.oauth_token=l:u.client_id=c,function(e,t,o){Object.keys(t).forEach(function(r){o?e.append(r,t[r]):e[r]=t[r]})}(i,u,d),"GET"!==e&&(p=d?i:n.encode(i),i={oauth_token:l}),o="/"!==o[0]?"/"+o:o,f=""+r.get("baseURL")+o+"?"+n.encode(i),s(e,f,p,a)},oEmbed:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=t.element;delete t.element,t.url=e;var r="https://soundcloud.com/oembed.json?"+n.encode(t);return s("GET",r,null).then(function(e){return o&&e.html&&(o.innerHTML=e.html),e})},upload:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.asset_data||e.file,o=r.get("oauth_token")&&e.title&&t;if(!o)return new i(function(e,t){t({status:0,error_message:"oauth_token needs to be present and title and asset_data / file passed as parameters"})});var n=Object.keys(e),a=new FormData;return n.forEach(function(t){var o=e[t];"file"===t&&(t="asset_data",o=e.file),a.append("track["+t+"]",o)}),this.request("POST","/tracks",a,e.progress)},resolve:function(e){return this.request("GET","/resolve",{url:e,_status_code_map:{302:200}})}}}).call(t,function(){return this}())},function(e,t){"use strict";var o={};e.exports={get:function(e){return o[e]},set:function(e,t){o[e]=t}}},function(e,t){function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===o||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(){h&&p&&(h=!1,p.length?f=p.concat(f):m=-1,f.length&&a())}function a(){if(!h){var e=n(i);h=!0;for(var t=f.length;t;){for(p=f,f=[];++m<t;)p&&p[m].run();m=-1,t=f.length}p=null,h=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var c,u,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:o}catch(e){c=o}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var p,f=[],h=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];f.push(new s(e,t)),1!==f.length||h||n(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,o){"use strict";var r=o(22);t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#|&)/,""))?e.split("&").reduce(function(e,t){var o=t.replace(/\+/g," ").split("="),r=o.shift(),n=o.length>0?o.join("="):void 0;return r=decodeURIComponent(r),n=void 0===n?null:decodeURIComponent(n),e.hasOwnProperty(r)?Array.isArray(e[r])?e[r].push(n):e[r]=[e[r],n]:e[r]=n,e},{}):{}},t.stringify=function(e){return e?Object.keys(e).sort().map(function(t){var o=e[t];return Array.isArray(o)?o.sort().map(function(e){return r(t)+"="+r(e)}).join("&"):r(t)+"="+r(o)}).filter(function(e){return e.length>0}).join("&"):""}},function(e,t,o){"use strict";var r=o(7),n=o(5);e.exports={notifyDialog:function(e){var t=r.parse(e.search),o=r.parse(e.hash),i={oauth_token:t.access_token||o.access_token,dialog_id:t.state||o.state,error:t.error||o.error,error_description:t.error_description||o.error_description},a=n.get(i.dialog_id);a&&a.handleConnectResponse(i)}}},function(e,t,o){"use strict";var r=o(3),n=o(11),i=o(2).Promise,a=function(e){return r.set("oauth_token",e.oauth_token),e};e.exports=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=r.get("oauth_token");if(t)return new i(function(e){e({oauth_token:t})});var o={client_id:e.client_id||r.get("client_id"),redirect_uri:e.redirect_uri||r.get("redirect_uri"),response_type:"code_and_token",scope:e.scope||"non-expiring",display:"popup"};if(!o.client_id||!o.redirect_uri)throw new Error("Options client_id and redirect_uri must be passed");var s=new n(o);return s.open().then(a)}},function(e,t,o){"use strict";var r=o(2).Promise;e.exports=function(){var e={};return e.promise=new r(function(t,o){e.resolve=t,e.reject=o}),e}},function(e,t,o){"use strict";var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=o(10),i=o(5),a=o(12),s=o(7),l="SoundCloud_Dialog",c=function(){return[l,Math.ceil(1e6*Math.random()).toString(16)].join("_")},u=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=c(),this.options=t,this.options.state=this.id,this.width=420,this.height=670,this.deferred=n()}return r(e,[{key:"open",value:function(){var e=function(e){return"https://soundcloud.com/connect?"+s.stringify(e)}(this.options);return this.popup=a.open(e,this.width,this.height),i.set(this.id,this),this.deferred.promise}},{key:"handleConnectResponse",value:function(e){var t=e.error;t?this.deferred.reject(e):this.deferred.resolve(e),this.popup.close()}}]),e}();e.exports=u},function(e,t){"use strict";e.exports={open:function(e,t,o){var r={},n=void 0;return r.location=1,r.width=t,r.height=o,r.left=window.screenX+(window.outerWidth-t)/2,r.top=window.screenY+(window.outerHeight-o)/2,r.toolbar="no",r.scrollbars="yes",n=Object.keys(r).map(function(e){return e+"="+r[e]}).join(", "),window.open(e,r.name,n)}}},function(e,t,o){"use strict";var r=o(19),n=o(1).MaestroCore,i=n.errors.PlayerFatalError,a=n.State,s=o(1).SCAudio.errors,l=s.GeoBlockedError,c=s.NoStreamsError,u=s.TimedOutError,d=s.NotSupportedError,p=1e3/60;e.exports=function(e){function t(){switch(e.getState()){case a.PLAYING:return"playing";case a.PAUSED:return e.isEnded()?"ended":"paused";case a.DEAD:return e.getFatalError()?"error":"dead";case a.LOADING:default:return"loading"}}var o=!1;e.onStateChange.subscribe(function(){return n.trigger("state-change",t())}),e.onPlay.subscribe(function(){n.trigger(o?"play-resume":"play-start"),o=!0}),e.onPlayIntent.subscribe(function(){return n.trigger("play")}),e.onPlayRejection.subscribe(function(e){return n.trigger("play-rejection",e)}),e.onPauseIntent.subscribe(function(){return n.trigger("pause")}),e.onSeek.subscribe(function(){return n.trigger("seeked")}),e.onSeekRejection.subscribe(function(e){return n.trigger("seek-rejection",e)}),e.onLoadStart.subscribe(function(){return n.trigger("buffering_start")}),e.onLoadEnd.subscribe(function(){return n.trigger("buffering_end")}),e.onEnded.subscribe(function(){return n.trigger("finish")}),e.onError.subscribe(function(e){e instanceof l?n.trigger("geo_blocked"):e instanceof c?n.trigger("no_streams"):e instanceof u?n.trigger("no_connection"):e instanceof d?n.trigger("no_protocol"):e instanceof i&&n.trigger("audio_error")});var n={play:e.play.bind(e),pause:e.pause.bind(e),seek:e.seek.bind(e),getVolume:e.getVolume.bind(e),setVolume:e.setVolume.bind(e),currentTime:e.getPosition.bind(e),getDuration:e.getDuration.bind(e),isBuffering:e.isLoading.bind(e),isPlaying:e.isPlaying.bind(e),isActuallyPlaying:e.isActuallyPlaying.bind(e),isEnded:e.isEnded.bind(e),isDead:e.isDead.bind(e),kill:e.kill.bind(e),hasErrored:function(){return!!e.getFatalError()},getState:t};return r.mixin(n),function(){function t(){window.clearTimeout(o),e.isPlaying()&&!e.isEnded()&&(o=window.setTimeout(t,p));var i=e.getPosition();i!==r&&(r=i,n.trigger("time",i))}var o=0,r=null;e.onChange.subscribe(function(e){var r=e.playing,n=e.seeking,i=e.dead;i?window.clearTimeout(o):void 0===r&&void 0===n||t()})}(),n}},function(e,t){(function(t){"use strict";var o=t.AudioContext||t.webkitAudioContext,r=null;e.exports=function(){return r||(r=new o)}}).call(t,function(){return this}())},function(e,t){(function(t){"use strict";var o=t.navigator.getUserMedia||t.navigator.webkitGetUserMedia||t.navigator.mozGetUserMedia;e.exports=function(e,r,n){o.call(t.navigator,e,r,n)}}).call(t,function(){return this}())},function(e,t,o){"use strict";var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=o(14),i=o(15),a=o(2).Promise,s=o(28),l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.context=t.context||n(),this._recorder=null,this.source=t.source,this.stream=null}return r(e,[{key:"start",value:function(){var e=this;return function(){var e=this,t=this.context;return new a(function(o,r){e.source?e.source instanceof AudioNode?o(e.source):r(new Error("source needs to be an instance of AudioNode")):i({audio:!0},function(r){e.stream=r,e.source=t.createMediaStreamSource(r),o(e.source)}.bind(e),r)})}.call(this).then(function(t){return e._recorder=new s(t),e._recorder.record(),t})}},{key:"stop",value:function(){if(this._recorder&&this._recorder.stop(),this.stream)if(this.stream.stop)this.stream.stop();else if(this.stream.getTracks){var e=this.stream.getTracks()[0];e&&e.stop()}}},{key:"getBuffer",value:function(){var e=this;return new a(function(t,o){e._recorder?e._recorder.getBuffer(function(o){var r=e.context.sampleRate,n=e.context.createBuffer(2,o[0].length,r);n.getChannelData(0).set(o[0]),n.getChannelData(1).set(o[1]),t(n)}.bind(e)):o(new Error("Nothing has been recorded yet."))})}},{key:"getWAV",value:function(){var e=this;return new a(function(t,o){e._recorder?e._recorder.exportWAV(function(e){t(e)}):o(new Error("Nothing has been recorded yet."))})}},{key:"play",value:function(){var e=this;return this.getBuffer().then(function(t){var o=e.context.createBufferSource();return o.buffer=t,o.connect(e.context.destination),o.start(0),o})}},{key:"saveAs",value:function(e){return this.getWAV().then(function(t){s.forceDownload(t,e)})}},{key:"delete",value:function(){this._recorder&&(this._recorder.stop(),this._recorder.clear(),this._recorder=null),this.stream&&this.stream.stop()}}]),e}();e.exports=l},function(e,t,o){"use strict";var r=o(4),n=o(3),i=o(13),a=o(1).SCAudio,s=o(1).SCAudioPublicApiStreamURLRetriever.StreamUrlRetriever,l=o(1).MaestroHTML5Player.HTML5Player,c=o(1).MaestroHLSMSEPlayer.HLSMSEPlayer,u=o(1).MaestroLoaders.stringLoader;e.exports=function(e,t){var o=t?{secret_token:t}:{};return r.request("GET",e,o).then(function(e){var o=n.get("baseURL"),r=n.get("client_id"),d=n.get("oauth_token"),p=!1,f=new s({clientId:r,secretToken:t,trackId:e.id,requestAuthorization:d?"OAuth "+d:null,loader:u}),h=a.buildPlayer({playerClasses:[l,c],streamUrlRetriever:f,fadeOutDuration:"SNIP"===e.policy?3e3:0});return h.onPlay.subscribe(function(){p||(p=!0,function(){var n=o+"/tracks/"+encodeURIComponent(e.id)+"/plays?client_id="+encodeURIComponent(r);t&&(n+="&secret_token="+encodeURIComponent(t));var i=new XMLHttpRequest;i.open("POST",n,!0),i.send()}())}),h.onEnded.subscribe(function(){h.pause()}),h.onPlayIntent.subscribe(function(){h.isEnded()&&h.seek(0)}),i(h)})},e.exports.activateAudioElement=function(){a.activateAudioElement()}},function(e,t,o){!function(){var o,r=Array.prototype.forEach,n=Object.prototype.hasOwnProperty,i=Array.prototype.slice,a=0,s={keys:Object.keys||function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("keys() called on a non-object");var t,o=[];for(t in e)e.hasOwnProperty(t)&&(o[o.length]=t);return o},uniqueId:function(e){var t=++a+"";return e?e+t:t},has:function(e,t){return n.call(e,t)},each:function(e,t,o){if(null!=e)if(r&&e.forEach===r)e.forEach(t,o);else if(e.length===+e.length)for(var n=0,i=e.length;n<i;n++)t.call(o,e[n],n,e);else for(var a in e)this.has(e,a)&&t.call(o,e[a],a,e)},once:function(e){var t,o=!1;return function(){return o?t:(o=!0,t=e.apply(this,arguments),e=null,t)}}};o={on:function(e,t,o){if(!c(this,"on",e,[t,o])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:o,ctx:o||this}),this},once:function(e,t,o){if(!c(this,"once",e,[t,o])||!t)return this;var r=this,n=s.once(function(){r.off(e,n),t.apply(this,arguments)});return n._callback=t,this.on(e,n,o)},off:function(e,t,o){var r,n,i,a,l,u,d,p;if(!this._events||!c(this,"off",e,[t,o]))return this;if(!e&&!t&&!o)return this._events={},this;for(a=e?[e]:s.keys(this._events),l=0,u=a.length;l<u;l++)if(e=a[l],i=this._events[e]){if(this._events[e]=r=[],t||o)for(d=0,p=i.length;d<p;d++)n=i[d],(t&&t!==n.callback&&t!==n.callback._callback||o&&o!==n.context)&&r.push(n);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!c(this,"trigger",e,t))return this;var o=this._events[e],r=this._events.all;return o&&u(o,t),r&&u(r,arguments),this},stopListening:function(e,t,o){var r=this._listeners;if(!r)return this;var n=!t&&!o;for(var i in"object"==typeof t&&(o=this),e&&((r={})[e._listenerId]=e),r)r[i].off(t,o,this),n&&delete this._listeners[i];return this}};var l=/\s+/,c=function(e,t,o,r){if(!o)return!0;if("object"==typeof o){for(var n in o)e[t].apply(e,[n,o[n]].concat(r));return!1}if(l.test(o)){for(var i=o.split(l),a=0,s=i.length;a<s;a++)e[t].apply(e,[i[a]].concat(r));return!1}return!0},u=function(e,t){var o,r=-1,n=e.length,i=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<n;)(o=e[r]).callback.call(o.ctx);return;case 1:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i);return;case 2:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i,a);return;case 3:for(;++r<n;)(o=e[r]).callback.call(o.ctx,i,a,s);return;default:for(;++r<n;)(o=e[r]).callback.apply(o.ctx,t)}};s.each({listenTo:"on",listenToOnce:"once"},function(e,t){o[t]=function(t,o,r){var n=this._listeners||(this._listeners={}),i=t._listenerId||(t._listenerId=s.uniqueId("l"));return n[i]=t,"object"==typeof o&&(r=this),t[e](o,r,this),this}}),o.bind=o.on,o.unbind=o.off,o.mixin=function(e){return s.each(["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"],function(t){e[t]=this[t]},this),e},void 0!==e&&e.exports&&(t=e.exports=o),t.BackboneEvents=o}()},function(e,t,o){e.exports=o(18)},function(e,t){e.exports={encode:function(e,t){function o(e){return e.filter(function(e){return"string"==typeof e&&e.length}).join("&")}function r(e){var t=Object.keys(e);return d?t.sort():t}function n(e,t){return o(r(t).map(function(o){return a(":name[:prop]".replace(/:name/,e).replace(/:prop/,o),t[o])}))}function i(e,t){return o(t.map(function(t){return a(":name[]".replace(/:name/,e),t)}))}function a(e,t){var o=encodeURIComponent,r=typeof t,a=null;return Array.isArray(t)?a=i(e,t):"string"===r?a=o(e)+"="+l(t):"number"===r?a=o(e)+"="+o(t).replace(/%20/g,"+"):"boolean"===r?a=o(e)+"="+t:"object"===r&&(null!==t?a=n(e,t):u||(a=o(e)+"=null")),a}function s(e){return"%"+("0"+e.charCodeAt(0).toString(16)).slice(-2).toUpperCase()}function l(e){return e.replace(/[^ !'()~\*]*/g,encodeURIComponent).replace(/ /g,"+").replace(/[!'()~\*]/g,s)}var c="object"==typeof t?t:{},u=c.ignorenull||!1,d=c.sorted||!1;return o(r(e).map(function(t){return a(t,e[t])}))}}},function(e,t,o){(function(e,t){!function(e,o){"use strict";function r(e){delete s[e]}function n(e){if(l)setTimeout(n,0,e);else{var t=s[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(o,r)}}(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var i,a=1,s={},l=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){n(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,o=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=o,t}}()?function(){var t="setImmediate$"+Math.random()+"$",o=function(o){o.source===e&&"string"==typeof o.data&&0===o.data.indexOf(t)&&n(+o.data.slice(t.length))};e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),i=function(o){e.postMessage(t+o,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;n(t)},i=function(t){e.port2.postMessage(t)}}():c&&"onreadystatechange"in c.createElement("script")?function(){var e=c.documentElement;i=function(t){var o=c.createElement("script");o.onreadystatechange=function(){n(t),o.onreadystatechange=null,e.removeChild(o),o=null},e.appendChild(o)}}():i=function(e){setTimeout(n,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),o=0;o<t.length;o++)t[o]=arguments[o+1];var r={callback:e,args:t};return s[a]=r,i(a),a++},u.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,function(){return this}(),o(6))},function(e,t){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,r,n){function i(e,t){this._id=e,this._clearFn=t}var a=Function.prototype.apply;r.setTimeout=function(){return new i(a.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new i(a.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(21),r.setImmediate=t,r.clearImmediate=o},function(e,t){var o=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;(r=new n).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(o.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}},function(e,t,o){e.exports=function(){return o(26)('!function(t){function n(r){if(e[r])return e[r].exports;var a=e[r]={exports:{},id:r,loaded:!1};return t[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n){(function(t){function n(t){h=t.sampleRate,v=t.numChannels,s()}function e(t){for(var n=0;n<v;n++)p[n].push(t[n]);g+=t[0].length}function r(t){for(var n=[],e=0;e<v;e++)n.push(i(p[e],g));if(2===v)var r=f(n[0],n[1]);else var r=n[0];var a=l(r),o=new Blob([a],{type:t});this.postMessage(o)}function a(){for(var t=[],n=0;n<v;n++)t.push(i(p[n],g));this.postMessage(t)}function o(){g=0,p=[],s()}function s(){for(var t=0;t<v;t++)p[t]=[]}function i(t,n){for(var e=new Float32Array(n),r=0,a=0;a<t.length;a++)e.set(t[a],r),r+=t[a].length;return e}function f(t,n){for(var e=t.length+n.length,r=new Float32Array(e),a=0,o=0;a<e;)r[a++]=t[o],r[a++]=n[o],o++;return r}function c(t,n,e){for(var r=0;r<e.length;r++,n+=2){var a=Math.max(-1,Math.min(1,e[r]));t.setInt16(n,a<0?32768*a:32767*a,!0)}}function u(t,n,e){for(var r=0;r<e.length;r++)t.setUint8(n+r,e.charCodeAt(r))}function l(t){var n=new ArrayBuffer(44+2*t.length),e=new DataView(n);return u(e,0,"RIFF"),e.setUint32(4,36+2*t.length,!0),u(e,8,"WAVE"),u(e,12,"fmt "),e.setUint32(16,16,!0),e.setUint16(20,1,!0),e.setUint16(22,v,!0),e.setUint32(24,h,!0),e.setUint32(28,4*h,!0),e.setUint16(32,2*v,!0),e.setUint16(34,16,!0),u(e,36,"data"),e.setUint32(40,2*t.length,!0),c(e,44,t),e}var h,v,g=0,p=[];t.onmessage=function(t){switch(t.data.command){case"init":n(t.data.config);break;case"record":e(t.data.buffer);break;case"exportWAV":r(t.data.type);break;case"getBuffer":a();break;case"clear":o()}}}).call(n,function(){return this}())}]);\n//# sourceMappingURL=9f9aac32c9a7432b5555.worker.js.map',o.p+"9f9aac32c9a7432b5555.worker.js")}},function(e,t,o){var r=o(27),n=function(e,t){var o=t||{},n=o.bufferLen||4096,i=o.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,n,i,i);var a=new r;a.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:i}});var s,l=!1;this.node.onaudioprocess=function(e){if(l){for(var t=[],o=0;o<i;o++)t.push(e.inputBuffer.getChannelData(o));a.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t])},this.record=function(){l=!0},this.stop=function(){l=!1},this.clear=function(){a.postMessage({command:"clear"})},this.getBuffer=function(e){s=e||o.callback,a.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(s=e||o.callback,t=t||o.type||"audio/wav",!s)throw new Error("Callback not set");a.postMessage({command:"exportWAV",type:t})},a.onmessage=function(e){var t=e.data;s(t)},e.connect(this.node),this.node.connect(this.context.destination)};n.forceDownload=function(e,t){var o=(window.URL||window.webkitURL).createObjectURL(e),r=window.document.createElement("a");r.href=o,r.download=t||"output.wav";var n=document.createEvent("Event");n.initEvent("click",!0,!0),r.dispatchEvent(n)},e.exports=n},function(e,t){}])}).call(this,o(103).setImmediate,o(103).clearImmediate)},function(e,t){var o;(o=(o=o)||{}).Widget=function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){function r(e){var t,o;for(t=0,o=C.length;t<o&&!1!==e(C[t]);t++);}function n(e){return e.contentWindow?e.contentWindow:e.contentDocument&&"parentWindow"in e.contentDocument?e.contentDocument.parentWindow:null}function i(e){var t,o=[];for(t in e)e.hasOwnProperty(t)&&o.push(e[t]);return o}function a(e,t,o){o.callbacks[e]=o.callbacks[e]||[],o.callbacks[e].push(t)}function s(e,t){var o=!0;return t.callbacks[e]=[],r(function(t){if((t.callbacks[e]||[]).length)return o=!1,!1}),o}function l(e,t,o){var r,i,a=n(o);return!!a.postMessage&&(r=o.getAttribute("src").split("?")[0],i=JSON.stringify({method:e,value:t}),"//"===r.substr(0,2)&&(r=window.location.protocol+r),r=r.replace(/http:\/\/(w|wt).soundcloud.com/,"https://$1.soundcloud.com"),void a.postMessage(i,r))}function c(e){var t;return r(function(o){if(o.instance===e)return t=o,!1}),t}function u(e){var t;return r(function(o){if(n(o.element)===e)return t=o,!1}),t}function d(e,t){return function(o){var r=function(e){return!!(e&&e.constructor&&e.call&&e.apply)}(o),n=c(this),i=!r&&t?o:null,s=r&&!t?o:null;return s&&a(e,s,n),l(e,i,n.element),this}}function p(e,t,o){var r,n,i;for(r=0,n=t.length;r<n;r++)e[i=t[r]]=d(i,o)}function f(e,t,o){return e+"?url="+t+"&"+function(e){var t,o,r=[];for(t in e)e.hasOwnProperty(t)&&(o=e[t],r.push(t+"="+("start_track"===t?parseInt(o,10):o?"true":"false")));return r.join("&")}(o)}function h(e,t,o){var r,n,i=e.callbacks[t]||[];for(r=0,n=i.length;r<n;r++)i[r].apply(e.instance,o);((function(e){var t,o=!1;for(t in S)if(S.hasOwnProperty(t)&&S[t]===e){o=!0;break}return o})(t)||t===k.READY)&&(e.callbacks[t]=[])}function m(e){var t,o,r,n,i;try{o=JSON.parse(e.data)}catch(e){return!1}return t=u(e.source),r=o.method,n=o.value,(!t||g(e.origin)===g(t.domain))&&(t?(r===k.READY&&(t.isReady=!0,h(t,T),s(T,t)),r!==k.PLAY||t.playEventFired||(t.playEventFired=!0),r!==k.PLAY_PROGRESS||t.playEventFired||(t.playEventFired=!0,h(t,k.PLAY,[n])),i=[],void 0!==n&&i.push(n),void h(t,r,i)):(r===k.READY&&P.push(e.source),!1))}function g(e){return e.replace(R,"")}var b,v,y,_=o(1),S=o(2),w=o(3),k=_.api,E=_.bridge,P=[],C=[],T="__LATE_BINDING__",R=/^http(?:s?)/;window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),e.exports=y=function(e,t,o){if(function(e){return!!(""===e||e&&e.charCodeAt&&e.substr)}(e)&&(e=document.getElementById(e)),!function(e){return!(!e||1!==e.nodeType||"IFRAME"!==e.nodeName.toUpperCase())}(e))throw new Error("SC.Widget function should be given either iframe element or a string specifying id attribute of iframe element.");t&&(o=o||{},e.src=f("http://wt.soundcloud.dev:9200/",t,o));var r,i,a=u(n(e));return a&&a.instance?a.instance:(r=P.indexOf(n(e))>-1,i=new b(e),C.push(new v(i,e,r)),i)},y.Events=k,window.SC=window.SC||{},window.SC.Widget=y,v=function(e,t,o){this.instance=e,this.element=t,this.domain=function(e){var t,o,r,n="";for("//"===e.substr(0,2)&&(e=window.location.protocol+e),t=0,o=(r=e.split("/")).length;t<o&&t<3;t++)n+=r[t],t<2&&(n+="/");return n}(t.getAttribute("src")),this.isReady=!!o,this.callbacks={}},(b=function(){}).prototype={constructor:b,load:function(e,t){if(e){t=t||{};var o=this,r=c(this),n=r.element,i=n.src,a=i.substr(0,i.indexOf("?"));r.isReady=!1,r.playEventFired=!1,n.onload=function(){o.bind(k.READY,function(){var e,o=r.callbacks;for(e in o)o.hasOwnProperty(e)&&e!==k.READY&&l(E.ADD_LISTENER,e,r.element);t.callback&&t.callback()})},n.src=f(a,e,t)}},bind:function(e,t){var o=this,r=c(this);return r&&r.element&&(e===k.READY&&r.isReady?setTimeout(t,1):r.isReady?(a(e,t,r),l(E.ADD_LISTENER,e,r.element)):a(T,function(){o.bind(e,t)},r)),this},unbind:function(e){var t,o=c(this);o&&o.element&&(t=s(e,o),e!==k.READY&&t&&l(E.REMOVE_LISTENER,e,o.element))}},p(b.prototype,i(S)),p(b.prototype,i(w),!0)},function(e,t){t.api={LOAD_PROGRESS:"loadProgress",PLAY_PROGRESS:"playProgress",PLAY:"play",PAUSE:"pause",FINISH:"finish",SEEK:"seek",READY:"ready",OPEN_SHARE_PANEL:"sharePanelOpened",CLICK_DOWNLOAD:"downloadClicked",CLICK_BUY:"buyClicked",ERROR:"error"},t.bridge={REMOVE_LISTENER:"removeEventListener",ADD_LISTENER:"addEventListener"}},function(e,t){e.exports={GET_VOLUME:"getVolume",GET_DURATION:"getDuration",GET_POSITION:"getPosition",GET_SOUNDS:"getSounds",GET_CURRENT_SOUND:"getCurrentSound",GET_CURRENT_SOUND_INDEX:"getCurrentSoundIndex",IS_PAUSED:"isPaused"}},function(e,t){e.exports={PLAY:"play",PAUSE:"pause",TOGGLE:"toggle",SEEK_TO:"seekTo",SET_VOLUME:"setVolume",NEXT:"next",PREV:"prev",SKIP:"skip"}}])},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(27),n=o(19),i=o(0),a=o(3),s=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),l=o(5);function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=t.score,this.controller=t.controller,this.jsflightController=t.jsflightController,this.documentController=t.documentController,this.scoreDocumentView=t.scoreDocumentView,this.scoreState=t.scoreState,this.scorePermissions=t.scorePermissions,this._lastPagingTime=0,this.SystemView=$$nf.classes.com.noteflight.notation.view.SystemView,this.controller.playFromSelection=this.controller.playFromSelection.bind(this.controller)}return function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(e,[{key:"play",value:function(){var e=this;if(NF.hasAudio||(0,r.crawler)()){this.SystemView.clearLastRolled();var t=this.scoreState.mediaSynced();if(t&&0===t.temporalMap.length){var o=this.scorePermissions.canEdit()?"alert.syncToPlayOwner":"alert.syncToPlayViewer";(0,a.standardAlertDialog)((0,i.resource)(o))}else(0,n.isTouchDevice)()&&this.scoreState.mediaSynced()&&(0,a.oneTimePerScoreAlert)("alert.touchDeviceMediaSync",this.score().external_id()),this.getSynthesisContext().startSound(function(){e.documentController.startPlaybackWhenReady(e.controller.playFromSelection),s.default.publish(l.SCORE_PLAYING)})}else(0,a.standardAlertDialog)((0,i.resource)("editor.noHtml5WebAudio"))}},{key:"pause",value:function(){this.scoreState.isSyncMediaPlaying()?this.controller.pauseSyncMedia():this.controller.pause()}},{key:"resume",value:function(){this.scoreState.isSyncMediaPlaying()?this.controller.resumeSyncMedia():this.controller.resume()}},{key:"stop",value:function(){this.scoreState.isSyncMediaPlaying(!1),this.controller.stop()}},{key:"playAll",value:function(){this.controller.playAll()}},{key:"soloMediaTrack",value:function(){this.controller.soloMediaTrack()}},{key:"muteTracksForPart",value:function(e){this.controller.muteTracksForPart(e)}},{key:"getTotalPagesToPrint",value:function(){return this.documentController.totalPagesToPrint}},{key:"getOpeningKeySignature",value:function(){return"".concat(this.controller.openingKeySignature)}},{key:"entryExistsForMeasureIndex",value:function(e){return this.controller.renderFullTemporalMap(),this.controller.entryExistsForMeasureIndex(e)}},{key:"lastMeasureIndexWithEntry",value:function(){return this.controller.lastMeasureIndexWithEntry}},{key:"scorePositionToTime",value:function(e){return this.controller.scorePositionToTime(e)}},{key:"resumeScrolling",value:function(){this.scoreDocumentView.resumeScrolling()}},{key:"getSynthesisContext",value:function(){return this.jsflightController.synthesis.context}},{key:"forceScoreBuild",value:function(){this.scoreDocumentView.forcePageFlow()}},{key:"forceFirstMeasuresToBeShown",value:function(){this.scoreDocumentView.forceFirstMeasuresToBeShown()}},{key:"setBuildWhileIdle",value:function(e){this.scoreDocumentView.viewInfo.buildWhileIdle=e}},{key:"buildScoreAsSoonAsPossible",value:function(e){this.scoreDocumentView.viewInfo.buildScoreAsSoonAsPossible=e}},{key:"setScoreTitle",value:function(e){this.controller.score.title=e}},{key:"selectPart",value:function(e){this.controller.selectPart(e)}},{key:"showAllParts",value:function(){this.controller.score.showAllParts()}},{key:"getTotalInvisibleParts",value:function(){return this.controller.score.totalInvisibleParts}},{key:"getTotalParts",value:function(){return this.controller.score.totalParts}},{key:"movePart",value:function(e,t){this.controller.document.undoHistory.openGroup("Reposition instruments"),this.controller.movePart(e,t)}},{key:"removeInstrument",value:function(e){this.selectPart(e),this.controller.document.undoHistory.openGroup("Remove Instrument"),this.controller.removeSelection()}},{key:"resizeToFitScore",value:function(){this.scoreDocumentView.controller.resizeToFit()}},{key:"toggleAutoScale",value:function(){var e=this.getAutoScale();return this.setAutoScale(!e),!e}},{key:"setAutoScale",value:function(e){this.scoreDocumentView.controller.autoScale=e}},{key:"getAutoScale",value:function(){return this.scoreDocumentView.controller.autoScale}},{key:"togglePrompt",value:function(e){this.scorePermissions.checkPromptPermissions()&&!this.scoreState.isStripMode()&&(e?this.documentController.removePrompt():this.documentController.addPrompt(),this.documentController.scrollToBeginning())}},{key:"toggleSupertitle",value:function(e){this.scoreState.isStripMode()||(e?this.documentController.removeSupertitle():this.documentController.addSupertitle(),this.documentController.scrollToBeginning())}},{key:"_doPagingRequest",value:function(){var e=(new Date).getTime();return!(e-this._lastPagingTime<300)&&(this._lastPagingTime=e,!0)}},{key:"scrollToPreviousPage",value:function(){this._doPagingRequest()&&(this.scoreDocumentView.setForceManualScrolling(!0),this.jsflightController.scrollToPreviousPage())}},{key:"scrollToNextPage",value:function(){this._doPagingRequest()&&(this.scoreDocumentView.setForceManualScrolling(!0),this.jsflightController.scrollToNextPage())}},{key:"centerCurrentPage",value:function(){var e=this;this.jsflightController&&setTimeout(function(){e.scoreState.isPerformMode()&&e.jsflightController.centerCurrentPageIfNeeded()},500)}},{key:"resetCursorPosition",value:function(){this.controller.moveCursorToBeginning()}},{key:"ensureSelectionVisible",value:function(){this.jsflightController.ensureSelectionVisible()}},{key:"printTimingStats",value:function(e){this.controller.printTimingStats(e)}},{key:"startAudioRecording",value:function(e){this.controller.startAudioRecording(e)}}]),e}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t.controller,this.isPaginatedMode=ko.observable(!1),this.isStripMode=ko.observable(!1),this.isFlowMode=ko.observable(!1),this.isPerformMode=ko.observable(!1),this.isAboutToPlay=ko.observable().extend({bindProperty:{source:this.controller,property:"isAboutToPlay"}}),this.player=ko.observable().extend({bindProperty:{source:this.controller.performer,property:"player"}}),this.isPaused=ko.observable().extend({bindProperty:{source:this.controller,property:"isPaused"}}),this.isPlayMode=ko.computed(function(){return!!o.player()}),this.isPlaying=ko.computed(function(){return o.player()&&!o.isPaused()}),this.isSyncMediaPlaying=ko.observable(!1),this._propertyMap=[{myProp:"mediaSynced",scoreProp:"synchronizedTrack",source:this.controller.score},{myProp:"transposeParts",scoreProp:"transposeParts",source:this.controller.score},{myProp:"showPartNames",scoreProp:"showPartNames",source:this.controller.score.effectiveStaffMetrics},{myProp:"partNamePosition",scoreProp:"partNamePosition",source:this.controller.score.effectiveStaffMetrics},{myProp:"showPartNamesOnEveryPage",scoreProp:"showPartNamesOnEveryPage",source:this.controller.score.effectiveStaffMetrics},{myProp:"showBarNumbers",scoreProp:"showBarNumbers",source:this.controller.score.effectiveStaffMetrics},{myProp:"showBarNumbersOnEachMeasure",scoreProp:"showBarNumbersOnEachMeasure",source:this.controller.score.effectiveStaffMetrics},{myProp:"showTabRhythm",scoreProp:"showTabRhythm",source:this.controller.score.effectiveStaffMetrics},{myProp:"displayMode",scoreProp:"displayMode",source:this.controller.score},{myProp:"viewScale",scoreProp:"viewScale",source:this.controller.score},{myProp:"scoreLineSpacing",scoreProp:"scoreLineSpacing",source:this.controller.score.effectiveStaffMetrics},{myProp:"staffSpacing",scoreProp:"staffSpacing",source:this.controller.score.effectiveStaffMetrics},{myProp:"systemSpacing",scoreProp:"systemSpacing",source:this.controller.score.effectiveStaffMetrics},{myProp:"systemStretch",scoreProp:"systemStretch",source:this.controller.score.effectiveStaffMetrics},{myProp:"titlePageFirstStaffPadding",scoreProp:"titlePageFirstStaffPadding",source:this.controller.score.effectiveStaffMetrics},{myProp:"layoutSpacing",scoreProp:"layoutSpacing",source:this.controller.score.effectiveStaffMetrics},{myProp:"verticalAutoSpace",scoreProp:"verticalAutoSpace",source:this.controller.score.effectiveStaffMetrics},{myProp:"centerChordSymbols",scoreProp:"centerChordSymbols",source:this.controller.score.effectiveStaffMetrics},{myProp:"keepChordSymbolsApart",scoreProp:"keepChordSymbolsApart",source:this.controller.score.effectiveStaffMetrics},{myProp:"setMusicFont",scoreProp:"musicFont",source:this.controller.score.effectiveStaffMetrics},{myProp:"partDisplayRespectSystemBreaks",scoreProp:"partDisplayRespectSystemBreaks",source:this.controller.score.effectiveStaffMetrics},{myProp:"showMultipleHyphens",scoreProp:"showMultipleHyphens",source:this.controller.score.effectiveStaffMetrics},{myProp:"hyphensMinPadding",scoreProp:"hyphensMinPadding",source:this.controller.score.effectiveStaffMetrics},{myProp:"autoMultiMeasureRestCreation",scoreProp:"autoMultiMeasureRestCreation",source:this.controller.score.effectiveStaffMetrics},{myProp:"titleSize",scoreProp:"titleSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"subtitleSize",scoreProp:"subtitleSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"supertitleSize",scoreProp:"supertitleSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"composerSize",scoreProp:"composerSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"titlePagePromptSize",scoreProp:"titlePagePromptSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"copyrightSize",scoreProp:"copyrightSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"pageNumberSize",scoreProp:"pageNumberSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"lyricsSize",scoreProp:"lyricsSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"performanceTextSize",scoreProp:"performanceTextSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"chordSymbolSize",scoreProp:"chordSymbolSize",source:this.controller.score.effectiveStaffMetrics},{myProp:"indentationSpacing",scoreProp:"indentationSpacing",source:this.controller.score.effectiveStaffMetrics},{myProp:"showCopyrightOnAllPages",scoreProp:"showCopyrightOnAllPages",source:this.controller.score.effectiveStaffMetrics},{myProp:"textProportional",scoreProp:"textProportional",source:this.controller.score.effectiveStaffMetrics},{myProp:"masterGain",scoreProp:"masterGain",source:this.controller.score.mix},{myProp:"reverbLevel",scoreProp:"reverbLevel",source:this.controller.score.mix},{myProp:"reverbType",scoreProp:"reverbType",source:this.controller.score.mix},{myProp:"graceNoteTime",scoreProp:"graceNoteTime",source:this.controller.score.performanceMetrics},{myProp:"graceNoteBeatFraction",scoreProp:"graceNoteBeatFraction",source:this.controller.score.performanceMetrics},{myProp:"pageMarginLeft",scoreProp:"pageMarginLeft",source:this.controller.score.effectivePageMetrics},{myProp:"pageMarginRight",scoreProp:"pageMarginRight",source:this.controller.score.effectivePageMetrics},{myProp:"pageMarginTop",scoreProp:"pageMarginTop",source:this.controller.score.effectivePageMetrics},{myProp:"pageMarginBottom",scoreProp:"pageMarginBottom",source:this.controller.score.effectivePageMetrics},{myProp:"musicFont",scoreProp:"musicFont",source:this.controller}],this._initModelBindings=this._initModelBindings.bind(this),this._initModelBindings(),this._initSubscribers()}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"_initSubscribers",value:function(){var e=this;this.displayMode.subscribe(function(){e.updateDisplayModeState()}),this.isAboutToPlay.subscribe(function(e){r.default.publish(n.SCORE_IS_ABOUT_TO_PLAY,e)}),this.isSyncMediaPlaying.subscribe(function(e){r.default.publish(n.SCORE_IS_SYNC_MEDIA_PLAYING,e)})}},{key:"updateDisplayModeState",value:function(){this.isPaginatedMode(this.controller.score.isPaginatedMode),this.isStripMode(this.controller.score.isStripMode),this.isFlowMode(this.controller.score.isFlowMode),this.isPerformMode(this.controller.score.isPerformMode)}},{key:"_initModelBindings",value:function(){var e=this;this._propertyMap.forEach(function(t){"function"==typeof e[t.myProp]?e[t.myProp](t.source[t.scoreProp]):e[t.myProp]=ko.observable().extend({bindProperty:{source:t.source,property:t.scoreProp}})})}}]),e}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(32)),n=o(2),i=o(14),a=o(594),s=o(0),l=o(3);function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=t.score,this.controller=t.controller,this.viewer=t.viewer||ko.observable(!1),this.demo=t.demo||ko.observable(!1),this.viewerParams=t.viewerParams,this.initializeConnectedProperties(),this.active=ko.observable(!1),this.ScoreData=null,this.ScoreDocument=null,this.isScoreCopyrighted=ko.computed(function(){return o.active()&&o.hasCopyrightedSongs()}),this.isPreview=ko.computed(function(){return o.viewer()&&"true"==o.viewerParams.preview||o.active()&&o.contentPolicy().preview}),this.ownsTheScore=ko.computed(function(){return NF.session.current_user()&&o.active()&&NF.session.current_user().external_id()==o.score().author().external_id()}),this.canEdit=ko.computed(function(){return o.active()&&(o.viewer()&&o.viewerParams.role==o.ScoreData.TEMPLATE_ROLE||o.contentPolicy().can_edit)}),this.canFave=ko.computed(function(){return!o.ownsTheScore()&&o.active()&&!o.score().in_favorites()}),this.canComment=ko.computed(function(){return!o.demo()&&!o.viewer()&&o.active()&&o.contentPolicy().can_comment}),this.canShareScore=ko.computed(function(){return o.active()&&o.contentPolicy().can_share}),this.canMakeItSearchable=ko.computed(function(){return o.canShareScore()&&o.active()&&o.contentPolicy().enable_browse_and_search}),this.canShareItWithIndividuals=ko.computed(function(){return o.canShareScore()&&o.active()&&o.contentPolicy().enable_user_based_sharing}),this.canMakeItCopyable=ko.computed(function(){return o.active()&&o.contentPolicy().can_copy&&(!o.isScoreCopyrighted()||o.ownsTheScore())}),this.canExport=ko.computed(function(){return o.active()&&o.contentPolicy().can_export&&(!o.isScoreCopyrighted()||o.ownsTheScore())}),this.canUseMixer=ko.computed(function(){return o.active()&&o.contentPolicy().enable_mixer}),this.canUseMetronome=ko.computed(function(){return o.active()&&o.contentPolicy().enable_metronome}),this.canUsePartDisplay=ko.computed(function(){return o.active()&&o.contentPolicy().enable_part_display}),this.canPrint=ko.computed(function(){return o.active()&&o.contentPolicy().can_print&&(!o.isScoreCopyrighted()||o.ownsTheScore())}),this.canUseTheExportDialog=ko.computed(function(){return o.canExport()||o.canPrint()}),this.userRole=ko.computed(function(){if(o.active())return o.viewer()?o.viewerParams.role==o.ScoreData.TEMPLATE_ROLE?o.viewerParams.role:o.ScoreData.READER_ROLE:o.score().historical()?o.ScoreData.READER_ROLE:o.contentPolicy().user_role})}return function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentPolicy=ko.observable(),this.hasCopyrightedSongs=ko.observable(),(0,i.connect)(a.scorePermissionsSelector,{})(this)}},{key:"scriptsLoaded",value:function(){this.ScoreData=$$nf.classes.com.noteflight.notation.service.ScoreData,this.ScoreDocument=$$nf.classes.com.noteflight.notation.document.ScoreDocument}},{key:"activate",value:function(){this.active(!0)}},{key:"checkChangeFontPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_select_font)||((0,r.default)((0,s.resource)("editorDialog.changeFont"),(0,s.resource)("action.changeFont"),"change_font"),!1)}},{key:"checkAutoMultiRestPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_part_display)||((0,r.default)((0,s.resource)("content.premiumRequiredForMultiRests"),(0,s.resource)("action.autoMultiMeasureRest"),"auto_multi_measure_rest"),!1)}},{key:"checkMultiRestPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_part_display)||((0,r.default)((0,s.resource)("content.premiumRequiredForMultiRests"),(0,s.resource)("alerts/premiumRequiredForMultiRests"),"auto_multi_measure_rest"),!1)}},{key:"checkMetronomePermissions",value:function(){return!!this.canUseMetronome()||((0,r.default)((0,s.resource)("editorDialog.useMetronome"),(0,s.resource)("action.useMetronome"),"use_metronome"),!1)}},{key:"checkPrintingPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_part_display)||((0,r.default)((0,s.resource)("editorDialog.printerPrintScore"),(0,s.resource)("action.printIndividualParts"),"print_individual_parts"),!1)}},{key:"checkPrintingSupported",value:function(){return!NF.chromeiOS||((0,l.standardAlertDialog)((0,s.resource)("alert.printPDFNotAvailable")),!1)}},{key:"checkMixerPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_mixer)||((0,r.default)((0,s.resource)("editorDialog.mixer"),(0,s.resource)("alerts/premiumRequiredToUsePartMixer"),"use_mixer"),!1)}},{key:"checkPromptPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_prompt)||((0,r.default)((0,s.resource)("editorDialog.addPrompt"),(0,s.resource)("action.addPrompt"),"add_prompt"),!1)}},{key:"checkRecordingPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_recording)||((0,r.default)((0,s.resource)("editorDialog.recording"),(0,s.resource)("action.recording"),"recording"),!1)}},{key:"checkTranscribingPermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_transcriber)||((0,r.default)((0,s.resource)("editorDialog.transcriber"),(0,s.resource)("action.transcribe"),"transcribe"),!1)}},{key:"checkTemplatePermissions",value:function(){return!(this.active()&&!this.contentPolicy().enable_template_creation&&!NF.session.current_user().sites_enabled())||((0,r.default)((0,s.resource)("editor.sharing.templateTitle"),(0,s.resource)("editor.sharing.template"),"sharing_template",{upgradePath:(0,n.path)("learn"),actionResource:"mustBeLearningEdition.actionMessage"}),!1)}},{key:"canUsePremiumInstruments",value:function(){if(!this.active())return!1;var e=!1;return this.controller&&(e=this.controller.document.editable),e?this.contentPolicy().enable_premium_instruments:this.score().premium_instruments()}},{key:"documentPermissions",value:function(){return this._userPermissions()|this._configurationPermissions()}},{key:"areDeveloperFeaturesEnabled",value:function(){return 0!=(this.documentPermissions()&this.ScoreDocument.DEVELOPER_FEATURES_PERMISSION)}},{key:"_userPermissions",value:function(){switch(this.userRole()){case this.ScoreData.AUTHOR_ROLE:case this.ScoreData.COAUTHOR_ROLE:return this.ScoreDocument.SAVE_PERMISSION|this.ScoreDocument.EDIT_PERMISSION|this.ScoreDocument.COMMENT_PERMISSION;case this.ScoreData.REVIEWER_ROLE:return this.ScoreDocument.COMMENT_PERMISSION;case this.ScoreData.TEMPLATE_ROLE:case this.ScoreData.DEMO_ROLE:return this.ScoreDocument.EDIT_PERMISSION;case this.ScoreData.READER_ROLE:default:return 0}return 0}},{key:"_configurationPermissions",value:function(){if(!this.active())return 0;var e=0,t=$$nf.classes.com.noteflight.notation.document.ScoreDocument;return this.contentPolicy().can_export&&(e|=t.EXPORT_PERMISSION),this.contentPolicy().can_copy&&(e|=t.SAVE_COPY_PERMISSION),this.contentPolicy().enable_template_creation&&(e|=t.TEMPLATE_CREATION_PERMISSION),this.contentPolicy().enable_developer_features&&(e|=t.DEVELOPER_FEATURES_PERMISSION),this.contentPolicy().enable_ash_font&&(e|=t.ASH_FONT_PERMISSION),this.contentPolicy().enable_select_font&&(e|=t.SELECT_FONT_PERMISSION),this.contentPolicy().enable_premium_instruments&&(e|=t.PREMIUM_INSTRUMENTS_PERMISSION),this.contentPolicy().enable_user_based_sharing&&(e|=t.USER_BASED_SHARING_PERMISSION),this.contentPolicy().enable_color&&(e|=t.COLOR_PERMISSION),this.contentPolicy().enable_mixer&&(e|=t.MIXER_PERMISSION),this.contentPolicy().enable_transcriber&&(e|=t.TRANSCRIBER_PERMISSION),this.contentPolicy().enable_recording&&(e|=t.RECORDING_PERMISSION),this.contentPolicy().enable_part_display&&(e|=t.PART_DISPLAY_PERMISSION),this.contentPolicy().enable_prompt&&(e|=t.PROMPT_PERMISSION),this.contentPolicy().enable_midi&&(e|=t.MIDI_PERMISSION),this.contentPolicy().enable_content_injection&&(e|=t.CONTENT_INJECTION_PERMISSION),this.contentPolicy().can_print&&(e|=t.PRINTING_PERMISSION),e}}]),e}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scorePermissionsSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentPolicySelector,n.hasCopyrightedSongsSelector,function(e,t){return{contentPolicy:e,hasCopyrightedSongs:t}});t.scorePermissionsSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=f(o(299)),n=f(o(300)),i=f(o(213)),a=o(8),s=o(0),l=o(301),c=o(3),u=o(14),d=o(597),p=f(o(598));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.html5Editor=t.html5Editor,this.documentController=t.documentController,this.scorePermissions=t.scorePermissions,this.scoreApi=t.scoreApi,this.initializeConnectedProperties()}return function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(e,[{key:"initializeConnectedProperties",value:function(){this.contentType=ko.observable(),this.currentUserIsProductOwner=ko.observable(),this.currentUserIsPreviewingProduct=ko.observable(),(0,u.connect)(d.scoreDialogsSelector,{})(this)}},{key:"exportScore",value:function(){(this.scorePermissions.canUseTheExportDialog()||this.currentUserIsProductOwner())&&(0,c.createAndShowDialog)({viewModel:new l.ExportScoreDialog(this.html5Editor,(0,s.resource)("editorDialog.exportScore")),templateName:"score/exportScore"})}},{key:"startPrintScore",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.scorePermissions.canUsePartDisplay()&&this.scoreApi.getTotalInvisibleParts()>0){if(NF.hasStorage&&!localStorage.getItem("_nf_alert_print_individual_parts_free_user"))return void(0,c.okCancel)((0,s.resource)("editor.allPartsWillBeShown"),function(){localStorage.setItem("_nf_alert_print_individual_parts_free_user",!0),e.printScore(t)});this.scoreApi.showAllParts()}t.totalPages=this.scorePermissions.isPreview()?1:Number.MAX_VALUE,t.individualParts=!1,this.createAndShowPrintDialog(t)}},{key:"printScore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new p.default(this,e);(0,c.createAndShowDialog)({viewModel:t,templateName:"dialogs/printSelectionDialog"})}},{key:"printIndividualParts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.totalPages=Number.MAX_VALUE,e.individualParts=!0,e.renderingPdf)this.createAndShowPrintDialog(e);else if(this.scorePermissions.canPrint()||this.contentType()===a.PRODUCT){if(this.currentUserIsPreviewingProduct()&&!this.scorePermissions.checkPrintingSupported()||!this.scorePermissions.checkPrintingPermissions())return;this.createAndShowPrintDialog(e)}}},{key:"createAndShowPrintDialog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new NF.PrintScoreDialog(this.html5Editor,this.documentController,e);(0,c.createAndShowDialog)({viewModel:t,templateName:"score/printScore"})}},{key:"showVersionHistory",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.VersionHistoryDialog(this.html5Editor),templateName:"score/versionHistory",modal:!1})}},{key:"showForceSilentPlayback",value:function(e){(0,c.createAndShowDialog)({viewModel:new Noteflight.ForceSilentPlayback(this.html5Editor,e),templateName:"score/forceSilentPlayback",modal:!0})}},{key:"editStringTuning",value:function(e){(0,c.createAndShowDialog)({viewModel:new Noteflight.TuningDialog(this.html5Editor,(0,s.resource)("editorDialog.editStringTuning"),e),templateName:"score/tuning"})}},{key:"editKeySignature",value:function(){var e=this.html5Editor.controller.keySignatureSelection,t=this.html5Editor.controller.score.systemStaff.getMeasureAt(e.startIndex).keySignature;(0,c.createAndShowDialog)({viewModel:new Noteflight.KeySignatureDialog(this.html5Editor,(0,s.resource)("editorDialog.editKeySignature"),t),templateName:"score/keySignature"})}},{key:"transpose",value:function(){(0,c.createAndShowDialog)({viewModel:new r.default(this.html5Editor,(0,s.resource)("editorDialog.transpose")),templateName:"score/transpose"})}},{key:"filterSelection",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.Filter(this.html5Editor,(0,s.resource)("editorDialog.filterSelection")),templateName:"score/filter",modal:!1})}},{key:"transcriberSettings",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.TranscriberSettings(this.html5Editor,(0,s.resource)("editorDialog.transcriptionSettings")),templateName:"score/transcriberSettings",modal:!1})}},{key:"recordingSettings",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.RecordingSettings(this.html5Editor,(0,s.resource)("editorDialog.options")),templateName:"score/recordingSettings",modal:!1})}},{key:"inputSelection",value:function(){(0,c.createAndShowDialog)({viewModel:new n.default(this.html5Editor,(0,s.resource)("editorDialog.inputSelection")),templateName:"score/inputSelection",modal:!1})}},{key:"graceNotePanel",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.GraceNotePanel(this.html5Editor,(0,s.resource)("editorDialog.graceNotePanel")),templateName:"score/graceNotePanel",modal:!1})}},{key:"calibrateMic",value:function(){(0,c.createAndShowDialog)({viewModel:new Noteflight.CalibrateMicDialog(this.html5Editor,(0,s.resource)("editorDialog.calibrateVolume")),templateName:"score/calibrateMic"})}},{key:"calibrateLatency",value:function(){(0,c.createAndShowDialog)({viewModel:new i.default(this.html5Editor,(0,s.resource)("editorDialog.calibrateLatency")),templateName:"score/calibrateLatency"})}},{key:"changeParts",value:function(){var e=this,t=this.html5Editor.controller.selection?this.html5Editor.controller.selection.selectedRange.staves[0].part:this.html5Editor.controller.score.getStaffAt(0).part;(0,c.createAndShowDialog)({viewModel:new Noteflight.ChooseInstrumentDialog(this.html5Editor,(0,s.resource)("editorDialog.changeParts"),t,function(t,o){e.html5Editor.controller.document.undoHistory.openGroup("Change Instrument"),e.html5Editor.controller.changeInstrument(t,o)}),templateName:"score/chooseInstrument",callback:"showInstrumentSelected"})}},{key:"addPart",value:function(e,t){var o=this;(0,c.createAndShowDialog)({viewModel:new Noteflight.ChooseInstrumentDialog(this.html5Editor,t,null,function(t,r){for(var n=0;n<r.length;n++){var i=r[n];o.html5Editor.controller.document.undoHistory.openGroup("Add Part"),o.html5Editor.controller.insertBlankStaffAt(t,e+n,i)}}),templateName:"score/chooseInstrument"})}}]),e}();t.default=m},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportScoreDialogSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentPolicySelector,function(e){return{isProductCopy:e.is_product_copy}});t.exportScoreDialogSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scoreDialogsSelector=void 0;var r=o(12),n=o(17),i=(0,r.createSelector)(n.editorContentTypeSelector,n.currentUserIsProductOwnerSelector,n.currentUserIsPreviewingProductSelector,function(e,t,o){return{contentType:e,currentUserIsProductOwner:t,currentUserIsPreviewingProduct:o}});t.scoreDialogsSelector=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.PrintSelectionType=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function e(t,o,r){c(this,e),this.name=t,this.selected=ko.observable(o),this.printResource=r};t.PrintSelectionType=u;var d=function(e){function t(e){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,t),(o=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?l(e):t}(this,a(t).call(this))).passedOptions=r,o.scoreDialog=e,o.printOptions=[new u("printFull",!0,"editorDialog.printFullScore"),new u("printParts",!1,"editorDialog.printIndividualParts"),new u("printFullWithParts",!1,"editorDialog.printFullScoreAndParts")],o.selectedPrintType=ko.observable(o.printOptions[0]),o.printSelectionChanged=o.printSelectionChanged.bind(l(l(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,r.default),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"adBlockEnabled",value:function(){var e=document.getElementById("adTest");return!(!e||0!==e.offsetHeight)}},{key:"printSelectionChanged",value:function(e){this.selectedPrintType()&&this.selectedPrintType().selected(!1),e&&(e.selected(!0),this.selectedPrintType(e))}},{key:"doOk",value:function(){switch(this.selectedPrintType().name){case"printFull":this.scoreDialog.startPrintScore(this.passedOptions);break;case"printParts":this.scoreDialog.printIndividualParts(Object.assign(this.passedOptions,{usePrinter:!0}));break;case"printFullWithParts":this.scoreDialog.printIndividualParts(Object.assign(this.passedOptions,{usePrinter:!0,includeFullScore:!0}));break;default:console.log("No print selection found!")}return!0}}]),t}();t.default=d},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t,o,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=t,this.annotationJsModel=o,this.annotationObject=r,this.openAnnotations=n,this.alreadyEdited=!1,this.id=r.idString}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"setAnnotationText",value:function(){if(this.annotationJsModel.isEditable()){var e=this.annotationJsModel.annotationText();this.editor.controller.updateAnnotationText(this.annotationObject,e)}}},{key:"closeAnnotationEvent",value:function(){this.setAnnotationText(),this.closeAnnotationDialog()}},{key:"removeAnnotation",value:function(){this.annotationJsModel.isEditable()&&(this.editor.controller.removeAnnotation(this.annotationObject),this.closeAnnotationDialog())}},{key:"closeAnnotationDialog",value:function(){var e=this.annotationObject.username+this.annotationObject.created.toString();this.openAnnotations.splice($.inArray(e,this.openAnnotations),1),this.editor.annotationDialogs.splice($.inArray(this,this.editor.annotationDialogs()),1)}},{key:"activateSaveButton",value:function(){this.alreadyEdited||(this.editor.addUndoHistoryGroup("Edit Annotation"),this.alreadyEdited=!0)}},{key:"doMoveDialogToFront",value:function(e){var t="#"+this.id;this.editor.currentAnnotationZIndex=$(t).css("z-index")>this.editor.currentAnnotationZIndex?$(t).css("z-index"):this.editor.currentAnnotationZIndex,this.editor.currentAnnotationZIndex++,$(t).css("z-index",this.editor.currentAnnotationZIndex)}}]),e}();t.default=n},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("generateRendering: construct ScoreRendering",t),this.params=t,this.timeout=null}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"downloadFullRenderingInfo",value:function(e){var t=this;console.log("generateRendering: downloadFullRenderingInfo - begin",this.rendering_url);var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&o.status>=200&&o.status<=299&&(console.log("generateRendering: downloadFullRenderingInfo - complete",o.response),t.params=o.response,e())},o.responseType="json",o.open("GET",this.rendering_url,!0),o.send()}},{key:"uploadScoreRendering",value:function(e,t){var o=this;console.log("generateRendering: uploadScoreRendering - starting");var r=new FormData;for(var n in this.output.fields){var i=this.output.fields[n];r.append(n,i)}r.append("file",e);var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&a.status>=200&&a.status<=299&&(console.log("generateRendering: uploadScoreRendering - complete"),t(),o.notifyScoreRenderingSuccess())},a.open("POST",this.output.url,!0),a.send(r)}},{key:"notifyScoreRenderingSuccess",value:function(){console.log("generateRendering: notifyScoreRenderingSuccess"),this.notifyScoreComplete(this.success_url)}},{key:"notifyScoreRenderingError",value:function(){console.log("generateRendering: notifyScoreRenderingError"),this.notifyScoreComplete(this.error_url)}},{key:"notifyScoreComplete",value:function(e){console.log("generateRendering: notifyScoreRenderingComplete - start",e);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&t.status>=200&&t.status<=299){console.log("generateRendering: notifyScoreRenderingComplete - complete",t.response);var e=t.response;window.location.href=e.generate_next_score_url}};var o={rendering_id:this.rendering_id,result:"success"};t.responseType="json",t.open("POST",e,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(o))}},{key:"notifyTimeout",value:function(){console.log("generateRendering: notifyTimeout"),this.notifyScoreRenderingError()}},{key:"startTimeout",value:function(){console.log("generateRendering: startTimeout"),this.resetTimeout()}},{key:"resetTimeout",value:function(){var e=this;console.log("generateRendering: resetTimeout"),this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),this.timeout=window.setTimeout(function(){e.notifyTimeout()},6e4)}},{key:"renderingType",get:function(){return this.rendering_type}},{key:"hasPurchasedProductInfo",get:function(){return null!=this.params.purchased_product_info}},{key:"purchasedQuantity",get:function(){return this.hasPurchasedProductInfo?this.params.purchased_product_info.purchased_quantity:null}},{key:"authorizedName",get:function(){return this.hasPurchasedProductInfo?this.params.purchased_product_info.authorized_name:null}},{key:"ensembleSizeMax",get:function(){return this.hasPurchasedProductInfo?this.params.purchased_product_info.ensemble_size_max:null}},{key:"scoreId",get:function(){return this.score_id}},{key:"rendering_type",get:function(){return this.params.rendering_type}},{key:"rendering_params",get:function(){return this.params.rendering_params}},{key:"rendering_id",get:function(){return this.params.rendering_id}},{key:"score_id",get:function(){return this.params.score_id}},{key:"success_url",get:function(){return this.params.success_url}},{key:"error_url",get:function(){return this.params.error_url}},{key:"rendering_url",get:function(){return this.params.rendering_url}},{key:"input",get:function(){return this.params.input}},{key:"output",get:function(){return this.params.output}}]),e}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showEditorTip=function(e){return s.apply(this,arguments)};var r=o(302),n=function(e){return e&&e.__esModule?e:{default:e}}(o(602));function i(e,t,o,r,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var a={invalidRepeatText:{notificationKey:r.INVALID_REPEAT_TEXT,titleResource:"palette.repeatEnding",messageResource:"alert.invalidRepeatText"},repositionedSystemText:{notificationKey:r.REPOSITIONED_SYSTEM_TEXT,titleResource:"palette.systemText",messageResource:"alert.systemTextPosition"},notEnoughMeasureRepeatSpace:{notificationKey:r.NOT_ENOUGH_MEASURE_REPEAT_SPACE,titleResource:"palette.measureRepeat",messageResource:"alert.notEnoughMeasureRepeatSpace"}};function s(){return(s=function(e){return function(){var t=this,o=arguments;return new Promise(function(r,n){var a=e.apply(t,o);function s(e){i(a,r,n,s,l,"next",e)}function l(e){i(a,r,n,s,l,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(t){var o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a[t]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,(0,r.getNotification)(o.notificationKey);case 5:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:return(i=new n.default({messageResource:o.messageResource,titleResource:o.titleResource,dismissCallback:function(){return(0,r.addNotification)(o.notificationKey)}})).show(),e.abrupt("return",i);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(3);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(e){var o,r=e.messageResource,n=e.okCallback,a=e.dismissCallback,l=e.titleResource,u=void 0===l?"alert.alert":l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this))).messageResource=r,o.okCallback=n,o.dismissCallback=a,o.titleResource=u,o.doOk=o.doOk.bind(c(c(o))),o.dismiss=o.dismiss.bind(c(c(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"doOk",value:function(){this.okCallback&&this.okCallback(),this.hide()}},{key:"dismiss",value:function(){this.dismissCallback&&this.dismissCallback(),this.doOk()}},{key:"show",value:function(){(0,n.createAndShowDialog)({viewModel:this,templateName:"dialogs/editorTip"})}}]),t}();t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEditorReady=function(e){return{type:r.EDITOR_READY,ready:e}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};r.get||r.set?Object.defineProperty(t,o,r):t[o]=e[o]}return t.default=e,t}(o(56))},function(e,t,o){e.exports=o.p+"images/for_preview_only-dfcaa3407db8693b22b42b1bbb074c9b.svg"},function(e,t,o){e.exports=o.p+"images/shadowBottom-9cf67022b3a191a7a786731c3ec38688.png"},function(e,t,o){e.exports=o.p+"images/shadowBottomLeft-2fef046eeff08ead37f4c97abe26777f.png"},function(e,t,o){e.exports=o.p+"images/shadowBottomRight-55ac86b2fc5a5d9f8e92c8c7d933eb7b.png"},function(e,t,o){e.exports=o.p+"images/shadowLeft-a93ee1487141d021730302c47f075d32.png"},function(e,t,o){e.exports=o.p+"images/shadowPreview-3df283c6bf2147762c7173301011bab9.png"},function(e,t,o){e.exports=o.p+"images/shadowRight-ef7ba002eda8a85677090bbd8646ea66.png"},function(e,t,o){e.exports=o.p+"images/shadowTop-955d6bdf7c2459b022d61f8a069a8180.png"},function(e,t,o){e.exports=o.p+"images/shadowTopLeft-dcfe6558e597182485e3eb87672de482.png"},function(e,t,o){e.exports=o.p+"images/shadowTopRight-9a6959269097c78c12e3a75e2665c077.png"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(20);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,o,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=l(this,c(t).call(this))).draft=e,a.draftCopyCallback=o,a.userServerCopyCallback=r,a.message=(0,n.resource)("editor.localDraftExists",(0,i.formatRelativeTime)(e.timestamp)),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"useDraftCopy",value:function(){this.hide(),this.draftCopyCallback(this.draft)}},{key:"useServerCopy",value:function(){this.hide(),this.userServerCopyCallback()}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(20);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,o,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=l(this,c(t).call(this))).callbackAccept=o,a.callbackReject=r,a.message=(0,n.resource)("editor.localSaves",(0,i.formatRelativeTime)(e)),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"accept",value:function(){this.hide(),this.callbackAccept&&this.callbackAccept()}},{key:"reject",value:function(){this.hide(),this.callbackReject&&this.callbackReject()}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(6);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.productUrl=t,this.path=r.path,this.handlePurchaseScoreClick=this.handlePurchaseScoreClick.bind(this)}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"handlePurchaseScoreClick",value:function(){n.NF.analytics.trackEvent("Marketplace","go_to_product_from_embed",this.productUrl),(0,r.navigate)(this.productUrl,!0)}}]),e}();t.default=a},function(e,t,o){"use strict";var r=o(2);Noteflight.ErrorPage=function(){var e=this;e.templateName=ko.observable("content/error"),e.error=ko.observable(),e.resource=ko.computed(function(){if(e.error())return"errors."+e.error().split(".").shift()})},(0,r.addRoute)("errorPage","/errors/{error}#",Noteflight.ErrorPage,{})},function(e,t,o){"use strict";var r=o(16),n=o(2),i=o(0),a=o(3);Noteflight.ForumIndexModel=function(){var e=this;e.templateName=ko.observable("content/forumIndex"),(0,r.setTitleAndMeta)(e,"title.forums","meta.forums"),Noteflight.GenericPageViewModel.call(e),Noteflight.CSESearch.call(this),e.doesSearch(!0),e.forums=ko.observableArray(),e.forumsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.manageForums"}],"_nf_tip_forums.hidden"),e.goToCreateNewForum=function(){(0,n.navigate)((0,n.path)("newForum"))},e.canAdminForums=ko.computed(function(){return Noteflight.session.current_user()&&Noteflight.session.current_user().effective_admin()}),e.isReadOnly=ko.observable(!1),e.handleFetchedForums=function(t){for(var o=0;o<t.forums.length;o++)e.forums.push(new Noteflight.ForumViewModel(e,new Noteflight.Forum(t.forums[o])))},NF.apiService.fetchForums("",e.handleFetchedForums,{}),e.forumDeleted=function(t){for(var o=0;o<e.forums().length;o++)if(e.forums()[o].forum().id()==t){e.forums.remove(e.forums()[o]);break}},e.searchLabel=ko.observable((0,i.resource)("search.labelForums"))},Noteflight.ForumViewModel=function(e,t){var o=this;o.forum=ko.observable(t),o.forumUrl=ko.computed(function(){return(0,n.path)("forum",{forumId:o.forum().id()})}),o.recentPostAuthorProfile=ko.computed(function(){if(o.forum().most_recent_discussion())return Noteflight.paths.profile({userId:o.forum().most_recent_discussion().most_recent_post().author().external_id()})}),o.recentPostAuthorAvatar=ko.computed(function(){if(o.forum().most_recent_discussion())return o.forum().most_recent_discussion().most_recent_post().author().avatar()}),o.recentPostAuthorName=ko.computed(function(){if(o.forum().most_recent_discussion())return o.forum().most_recent_discussion().most_recent_post().author().username()}),o.recentPostDiscussionName=ko.computed(function(){if(o.forum().most_recent_discussion())return o.forum().most_recent_discussion().name()}),o.recentPostDiscussion=ko.computed(function(){if(o.forum().most_recent_discussion())return Noteflight.paths.discussion({forumId:o.forum().id(),discussionId:o.forum().most_recent_discussion().id()})}),o.deleteForum=function(){(0,a.okCancel)((0,i.resource)("forums.confirmDeleteForum",o.forum().name()),function(){NF.apiService.deleteForum((0,i.resource)("forums.deletingForum"),function(t){e.forumDeleted(o.forum().id())},{forum_id:o.forum().id()})})},o.reorderForum=function(){new Noteflight.ReorderForumViewModel(e,o.forum()).show()},o.contextMenuItems=function(){return[{label:(0,i.resource)("action.delete"),action:o.deleteForum},{label:(0,i.resource)("action.reorderForum"),action:o.reorderForum}]}},Noteflight.ReorderForumViewModel=function(e,t){var o=this;a.DialogViewModel.call(o),o.forum=ko.observable(t),o.forums=ko.observable(e.forums()),o.orginalIndex=ko.observable(),o.overIndex=ko.observable(),o.newIndex=ko.observable(),o.selectedNewPos=ko.observable(!1);for(var r=0;r<e.forums().length;r++)if(e.forums()[r].forum().id()==o.forum().id()){o.orginalIndex(r),o.overIndex(r),o.newIndex(r);break}o.forumIndex=function(t){for(var r=0;r<e.forums().length;r++)if(e.forums()[r].forum().id()==t.forum().id())return r<=o.overIndex()&&r>o.orginalIndex()?r-1:r>=o.overIndex()&&r<o.orginalIndex()?r+1:r},o.show=function(){(0,a.createAndShowDialog)({viewModel:o,templateName:"dialogs/reorderForum"})},o.initReorderForumDialog=function(){$("#forumListing").mouseleave(function(e){o.selectedNewPos()||o.overIndex(o.orginalIndex())})},o.showNewPostion=function(e){o.selectedNewPos()||o.overIndex(o.forumIndex(e))},o.selectNewPostion=function(e){o.newIndex(o.overIndex()),o.selectedNewPos(!0)},o.changeNewPostion=function(e){o.overIndex(o.forumIndex(e)),o.selectNewPostion()},o.forumPositioned=function(){e.forums.splice(o.newIndex(),0,e.forums.splice(o.orginalIndex(),1)[0])},o.positionForumService=function(e){NF.apiService.positionForum((0,i.resource)("forums.movingForum"),o.forumPositioned,e)},o.reorderForum=function(){(0,a.hideCurrentDialog)(),o.orginalIndex()!=o.newIndex()&&o.positionForumService({forum_id:o.forum().id(),position:o.newIndex()})}},Noteflight.ForumSettingsViewModel=function(e){var t=this;t.session=Noteflight.session,t.create=ko.observable(e),t.forumId=ko.observable(""),t.forumName=ko.observable(""),t.forumDescription=ko.observable(""),t.forumAdmin=ko.observable(""),t.onlyAdminsCanView=ko.observable(!1),t.onlyAdminsCanPost=ko.observable(!1),t.forumPosition=ko.observable("bottom"),t.canUse=ko.observable(),t.create()&&(t.forumAdmin(t.session.current_user().username()),t.canUse(t.session.current_user()&&t.session.current_user().effective_admin())),t.currentForum=ko.observable(),t.initForumInfo=function(e,o){t.currentForum=ko.observable(o),t.forumId(e),t.forumName(o.name()),t.forumDescription(o.description()),t.onlyAdminsCanView(!o.visible()),t.onlyAdminsCanPost(!o.open()),t.forumAdmin(o.admin_username()),t.canUse(o.adminable()),t.forumName.subscribe(function(){t.changedSomething()}),t.forumDescription.subscribe(function(){t.changedSomething()}),t.forumAdmin.subscribe(function(){t.changedSomething()}),t.onlyAdminsCanView.subscribe(function(){t.changedSomething()}),t.onlyAdminsCanPost.subscribe(function(){t.changedSomething()})},t.madeChanges=ko.observable(!1),t.changesSaved=ko.observable(!1),t.changedSomething=function(){t.madeChanges(!0),t.changesSaved(!1)},t.forumCreated=function(e){(0,n.navigate)((0,n.path)("forums"))},t.canChangeAdministrator=ko.computed(function(){return t.session.current_user()&&t.session.current_user().effective_admin()}),t.enableUpdate=ko.computed(function(){return t.forumName()&&t.forumDescription()&&(t.forumAdmin()||!t.canChangeAdministrator())&&t.madeChanges()}),t.createForumService=function(e){NF.apiService.createForum((0,i.resource)("forums.addingForum"),t.forumCreated,e)},t.forumUpdated=function(e){t.madeChanges(!1),t.changesSaved(!0),t.currentForum().name(t.forumName()),t.currentForum().description(t.forumDescription())},t.updateForumService=function(e){NF.apiService.updateForum((0,i.resource)("forums.updatingSettings"),t.forumUpdated,e)},t.saveSettings=function(){for(var e=null,o=NF.session.user_groups.groups(),r=0;r<o.length;r++)if(o[r].is_community_group()){e=o[r].id();break}t.create()?t.createForumService({group_id:e,name:t.forumName(),description:t.forumDescription(),initial_position:t.forumPosition(),admin_username:t.forumAdmin(),visible:!t.onlyAdminsCanView(),open:!t.onlyAdminsCanPost()}):t.updateForumService({forum_id:t.forumId(),forum:{name:t.forumName(),description:t.forumDescription(),admin_username:t.forumAdmin(),visible:!t.onlyAdminsCanView(),open:!t.onlyAdminsCanPost()},group_id:NF.session.user_groups.groups()[0].id()})}},Noteflight.ForumDiscussionsModel=function(){var e=this;e.templateName=ko.observable("content/forumDiscussions"),Noteflight.GenericPageViewModel.call(e),e.state=ko.observable(),e.forumId=ko.observable(),e.forum=ko.observable(),e.virginal=ko.observable(!0),e.discussionId=ko.observable(),e.discussions=ko.observableArray(),e.remaining=ko.observable(0),e.postsSortOrder=ko.observable("desc"),e.discussionPosts=ko.observable(new Noteflight.DiscussionPostsModel(e)),Noteflight.SelectionList.call(this,e.discussions),Noteflight.CSESearch.call(this),e.doesSearch(!0),e.settingsViewModel=new Noteflight.ForumSettingsViewModel(!1),e.alertDialog=new Noteflight.AlertSequenceDialog,e.title=ko.computed(function(){return e.forum()&&e.discussionPosts().discussionName()&&e.forum().name()+" : "+e.discussionPosts().discussionName()}),e.navigateToForumUrl=ko.computed(function(){return e.forum()&&(0,n.path)("forum",{forumId:e.forum().id()})}),e.editForumUrl=ko.computed(function(){return e.forum()&&(0,n.path)("editForum",{forumId:e.forum().id()})}),e.discussionsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.manageDiscussions"}],"_nf_tip_discussions.hidden"),e.canAdminDiscussions=ko.computed(function(){return!!e.forum()&&e.forum().adminable()}),e.handleFetchedDiscussions=function(t){e.forum()||e.forum(new Noteflight.Forum(t.forum));for(var o=0;o<t.discussions.length;o++)e.discussions.push(new Noteflight.DiscussionViewModel(e,new Noteflight.Discussion(t.discussions[o])));if(e.remaining(t.remaining),"choose"==e.state()&&!NF.IsPhoneLayout()&&!e.discussionId()&&e.discussions().length>0)for(o=0;o<e.discussions().length;o++)if(e.discussions()[o].discussion().author.identified()){e.discussionId(e.discussions()[o].discussion().id());break}e.updateDiscussion(),e.canAdministerForum()&&e.settingsViewModel.initForumInfo(e.forumId(),e.forum())},e.fetchDiscussionsService=function(t){NF.apiService.fetchDiscussions("",e.handleFetchedDiscussions,t)},e.fetchDiscussions=function(){e.fetchDiscussionsService({forum_id:e.forumId(),start_index:e.discussions().length,max_count:20})},e.reset=function(){e.forum(null),e.discussions([]),"choose"!=e.state()&&"settings"!=e.state()||e.discussionId(null),e.forumId()&&(e.discussionPosts().reset(),e.fetchDiscussions())},e.deleteForum=function(){(0,a.okCancel)((0,i.resource)("forums.confirmDeleteForum",e.forum().name()),function(){NF.apiService.deleteForum((0,i.resource)("forums.deletingForum"),function(e){(0,n.navigate)((0,n.path)("forums"))},{forum_id:e.forumId()})})},e.forumsList=ko.observableArray([]),e.canAdministerForum=ko.computed(function(){return e.forum()&&e.forum().adminable()}),e.canAddDiscussion=ko.computed(function(){return"create"!=e.state()&&Noteflight.session.canShare()&&e.forum()&&e.forum().postable()}),e.createNewDiscussion=function(){(0,n.navigate)((0,n.path)("newDiscussion",{forumId:e.forumId()}))},e.discussionAdded=function(t){e.discussions.unshift(new Noteflight.DiscussionViewModel(e,t)),(0,n.navigate)((0,n.path)("discussion",{forumId:e.forumId(),discussionId:t.id()}))},e.discussionDeleted=function(t){for(var o=0;o<e.discussions().length;o++)if(e.discussions()[o].discussion().id()==t.id()){e.discussions.remove(e.discussions()[o]);break}e.discussionId()==t.id()&&(e.discussionId(null),(0,n.navigate)((0,n.path)("forum",{forumId:e.forumId()})))},e.onNavigate=function(){e.virginal()||e.forumId()!=e.lastForumId?(e.virginal(!1),e.lastForumId=e.forumId(),e.reset()):(("create"==e.state()||"settings"==e.state()||"choose"==e.state()&&e.discussionId())&&e.discussionId(null),e.updateDiscussion())},e.updateDiscussion=function(){if(e.discussions().length>0)if(e.discussionId()){if(!e.selectedItem()||e.selectedItem().discussion().id()!=e.discussionId()){e.selectNone();for(var t=0;t<e.discussions().length;t++)if(e.discussions()[t].discussion().id()==e.discussionId()){e.discussions()[t].selectOnly();break}}e.discussionPosts().discussion()&&e.selectedItem()&&e.discussionPosts().discussion().id()==e.selectedItem().discussion().id()&&e.selectedItem().discussion(e.discussionPosts().discussion())}else e.selectNone()},Noteflight.PageableViewModel.call(this,e.fetchDiscussions),e.searchLabel=ko.observable((0,i.resource)("search.labelForums"))},Noteflight.DiscussionViewModel=function(e,t){var o=this;o.forumDiscussions=e,o.discussion=ko.observable(t),o.url=ko.observable((0,n.path)("discussion",{discussionId:o.discussion().id(),forumId:e.forumId()})),Noteflight.SelectionItem.call(o,e),o.handleDeletedDiscussion=function(e){o.forumDiscussions.discussionDeleted(o.discussion())},o.deleteDiscussion=function(){(0,a.okCancel)((0,i.resource)("forums.confirmDeleteDiscussion",o.discussion().name()),function(){NF.apiService.deleteDiscussion((0,i.resource)("forums.deletingDiscussion"),o.handleDeletedDiscussion,{discussion_id:o.discussion().id()})})},o.contextMenuItems=function(){return o.forumDiscussions.forum().adminable()?[{label:(0,i.resource)("action.delete"),action:o.deleteDiscussion}]:[]}},Noteflight.DiscussionPostsModel=function(e){var t=this;t.forumDiscussions=e,t.discussionId=ko.observable(),t.discussion=ko.observable(),t.remaining=ko.observable(0),t.posts=ko.observableArray(),t.newPostText=ko.observable(""),t.newDiscussionName=ko.observable(""),t.showMarkdownLink=ko.observable(!1),t.showMarkdownTip=ko.observable(!1),t.sortOrder=ko.observable(t.forumDiscussions.postsSortOrder()),t.sortOptions=ko.observableArray([{order:"asc",label:(0,i.resource)("order.oldestFirst")},{order:"desc",label:(0,i.resource)("order.lastestFirst")}]),t.discussionName=ko.computed(function(){return t.discussion()?t.discussion().name():""}),t.handleDiscussionPosts=function(e){t.remaining(e.remaining),t.discussion()||t.discussion(new Noteflight.Discussion(e.discussion));for(var o=0;o<e.posts.length;o++)t.posts.push(new Noteflight.PostViewModel(t,new Noteflight.Post(e.posts[o])));t.forumDiscussions.forumId()?t.forumDiscussions.updateDiscussion():(t.forumDiscussions.forumId(e.forum.id),t.forumDiscussions.reset())},t.fetchPostsService=function(e){NF.apiService.fetchPosts("",t.handleDiscussionPosts,e)},t.fetchPosts=function(){t.fetchPostsService({discussion_id:t.discussionId(),start_index:t.posts().length,max_count:20,direction:t.sortOrder()})},t.reset=function(){t.posts.removeAll(),t.remaining(0),t.discussionId(null),t.discussion(null),t.newPostText(""),t.newDiscussionName(""),"create"!=t.forumDiscussions.state()&&e.discussionId()&&(t.discussionId(e.discussionId()),t.fetchPosts())},t.sortOrder.subscribe(function(){t.forumDiscussions.postsSortOrder(t.sortOrder()),t.reset()}),t.newDiscussion=ko.computed(function(){return"create"==t.forumDiscussions.state()}),t.canPost=ko.computed(function(){return(t.discussion()||t.newDiscussion())&&Noteflight.session.canShare()&&e.forum()&&e.forum().postable()}),t.enableNewPost=ko.computed(function(){return t.newPostText().trim().length>0&&(t.discussion()||t.newDiscussionName().trim().length>0)}),t.handleAddedPost=function(e){t.newPostText("");var o=new Noteflight.Post(e.post);t.posts.unshift(new Noteflight.PostViewModel(t,o)),t.discussion().posts_count(t.discussion().posts_count()+1),t.discussion().most_recent_post(o),$("#postArea").removeClass("withFocus"),t.showMarkdownLink(!1),t.showMarkdownTip(!1)},t.addPostService=function(e){NF.apiService.addPost((0,i.resource)("forums.posting"),t.handleAddedPost,e)},t.handleAddedDiscussion=function(e){t.newPostText(""),t.discussion(new Noteflight.Discussion(e.discussion)),t.discussionId(t.discussion().id()),handleDiscussionPosts(e),t.forumDiscussions.discussionAdded(t.discussion())},t.addDiscussionService=function(e){NF.apiService.addDiscussion((0,i.resource)("forums.posting"),t.handleAddedDiscussion,e)},t.postGotFocus=function(){$("#postArea").addClass("withFocus"),t.showMarkdownLink(!t.showMarkdownTip())},t.showMarkdownTipClick=function(){t.showMarkdownLink(!1),t.showMarkdownTip(!0)},t.addPost=function(){t.newDiscussion()?t.addDiscussionService({discussion:{forum_id:t.forumDiscussions.forumId(),name:t.newDiscussionName()},post:{text:t.newPostText()}}):t.addPostService({post:{discussion_id:t.discussionId(),text:t.newPostText()}})},t.postDeleted=function(e){for(var o=t.posts().length-1;o>=0;o--){var r=t.posts()[o];r.post.id()==e.id()&&t.posts.remove(r)}t.posts().length>0?(t.discussion().most_recent_post(t.posts()[0].post),t.discussion().posts_count(t.discussion().posts_count()-1)):t.forumDiscussions.discussionDeleted(t.discussion())},Noteflight.PageableViewModel.call(this,t.fetchPosts),ko.computed(function(){e.discussionId()!=t.discussionId()&&t.reset()}).extend({throttle:1})};Noteflight.PostViewModel=function(e,t){var o=this;o.discussionPosts=e,o.post=t,o.editPost=function(){new function(e){var t=this;t.post=ko.observable(e),t.text=ko.observable(t.post().post.text()),a.DialogViewModel.call(t),t.show=function(){(0,a.createAndShowDialog)({viewModel:t,templateName:"dialogs/editPost"})},t.handleUpdatedPost=function(e){t.post().post.text(e.post.text)},t.updatePost=function(){(0,a.hideCurrentDialog)(),NF.apiService.updatePost((0,i.resource)("forums.updatingPost"),t.handleUpdatedPost,{post_id:t.post().post.id(),text:t.text()})}}(o).show()},o.deletePost=function(){new function(e){var t=this;t.post=ko.observable(e),a.DialogViewModel.call(t),t.flagReason=ko.observable(""),t.show=function(){(0,a.createAndShowDialog)({viewModel:t,templateName:"dialogs/deletePost"})},t.afterDelete=function(e){t.post().discussionPosts.postDeleted(t.post().post)},t.deletePost=function(){(0,a.hideCurrentDialog)(),NF.session.current_user()&&NF.session.current_user().effective_admin()?NF.apiService.deletePost((0,i.resource)("forums.deletingPost"),t.afterDelete,{post_id:t.post().post.id()}):NF.apiService.blockPost((0,i.resource)("forums.deletingPost"),t.afterDelete,{post_id:t.post().post.id()})}}(o).show()},o.handleBlockedPost=function(){o.post.blocked_at((new Date).getTime())},o.blockPost=function(){NF.apiService.blockPost((0,i.resource)("forums.blockingPost"),o.handleBlockedPost,{post_id:o.post.id()})},o.handleUnblockedPost=function(){o.post.blocked_at(null)},o.unblockPost=function(){NF.apiService.unblockPost((0,i.resource)("forums.unblockingPost"),o.handleUnblockedPost,{post_id:o.post.id()})},o.isAdmin=ko.computed(function(){return NF.session.current_user()&&NF.session.current_user().effective_admin()}),o.flagPost=function(){new function(e){var t=this;t.post=ko.observable(e),a.DialogViewModel.call(t),t.flagReason=ko.observable(""),t.show=function(){(0,a.createAndShowDialog)({viewModel:t,templateName:"dialogs/flagPost"})},t.flagPost=function(){(0,a.hideCurrentDialog)(),NF.apiService.flagPost((0,i.resource)("forums.flaggingPost"),function(){},{post_id:t.post().post.id(),description:t.flagReason()})}}(o).show()},o.postAuthorProfileLink=ko.computed(function(){return Noteflight.paths.profile({userId:t.author().external_id()})}),o.canFlag=ko.computed(function(){return Noteflight.session.canShare()}),o.contextMenuItems=function(){var e=[];return o.post.mutable()&&(e.push({label:(0,i.resource)("action.edit"),action:o.editPost}),e.push({label:(0,i.resource)("action.delete"),action:o.deletePost})),o.isAdmin()&&(t.blocked_at()?e.push({label:(0,i.resource)("action.unblock"),action:o.unblockPost}):e.push({label:(0,i.resource)("action.block"),action:o.blockPost})),o.canFlag()&&e.push({label:(0,i.resource)("action.flag"),action:o.flagPost}),e}},Noteflight.ForumCreateViewModel=function(){this.templateName=ko.observable("content/forumCreate"),Noteflight.GenericPageViewModel.call(this),this.settingsViewModel=new Noteflight.ForumSettingsViewModel(!0)},(0,n.addRoute)("forums","/forums#",Noteflight.ForumIndexModel,{}),(0,n.addRoute)("forum","/forums#/forum/{forumId}",Noteflight.ForumDiscussionsModel,{state:"choose"}),(0,n.addRoute)("newDiscussion","/forums#/forum/{forumId}/newDiscussion",Noteflight.ForumDiscussionsModel,{state:"create"}),(0,n.addRoute)("discussion","/forums#/forum/{forumId}/discussion/{discussionId}",Noteflight.ForumDiscussionsModel,{state:"show"}),(0,n.addRoute)("editForum","/forums#/{forumId}/edit",Noteflight.ForumDiscussionsModel,{state:"settings"}),(0,n.addRoute)("editPost","/posts/{postId}/edit#",Noteflight.DefaultContentViewModel,{}),(0,n.addRoute)("newForum","/forums#/new",Noteflight.ForumCreateViewModel,{})},function(e,t,o){"use strict";Noteflight.getCountryLabelByCode=function(e){for(var t=0;t<NF.countries.length;t++)if(NF.countries[t].countryCode==e)return NF.countries[t].labelResource},Noteflight.countries=[{countryCode:"AL",labelResource:"country.albania",taxed:!1},{countryCode:"DZ",labelResource:"country.algeria",taxed:!1},{countryCode:"AD",labelResource:"country.andorra",taxed:!1},{countryCode:"AO",labelResource:"country.angola",taxed:!1},{countryCode:"AG",labelResource:"country.antiguaAndBarbuda",taxed:!1},{countryCode:"AR",labelResource:"country.argentina",taxed:!1},{countryCode:"AM",labelResource:"country.armenia",taxed:!1},{countryCode:"AU",labelResource:"country.australia",taxed:!0},{countryCode:"AT",labelResource:"country.austria",taxed:!1},{countryCode:"AZ",labelResource:"country.azerbaijan",taxed:!1},{countryCode:"BS",labelResource:"country.bahamas",taxed:!1},{countryCode:"BH",labelResource:"country.bahrain",taxed:!1},{countryCode:"BD",labelResource:"country.bangladesh",taxed:!1},{countryCode:"BB",labelResource:"country.barbados",taxed:!1},{countryCode:"BY",labelResource:"country.belarus",taxed:!1},{countryCode:"BE",labelResource:"country.belgium",taxed:!1},{countryCode:"BZ",labelResource:"country.belize",taxed:!1},{countryCode:"BJ",labelResource:"country.benin",taxed:!1},{countryCode:"BM",labelResource:"country.bermuda",taxed:!1},{countryCode:"BT",labelResource:"country.bhutan",taxed:!1},{countryCode:"BO",labelResource:"country.bolivia",taxed:!1},{countryCode:"BA",labelResource:"country.bosniaAndHerzegovina",taxed:!1},{countryCode:"BW",labelResource:"country.botswana",taxed:!1},{countryCode:"BR",labelResource:"country.brazil",taxed:!1},{countryCode:"BN",labelResource:"country.bruneiDarussalam",taxed:!1},{countryCode:"BG",labelResource:"country.bulgaria",taxed:!1},{countryCode:"BF",labelResource:"country.burkinaFaso",taxed:!1},{countryCode:"KH",labelResource:"country.cambodia",taxed:!1},{countryCode:"CM",labelResource:"country.cameroon",taxed:!1},{countryCode:"CA",labelResource:"country.canada",taxed:!1},{countryCode:"CV",labelResource:"country.capeVerde",taxed:!1},{countryCode:"CF",labelResource:"country.centralAfricanRepublic",taxed:!1},{countryCode:"TD",labelResource:"country.chad",taxed:!1},{countryCode:"CL",labelResource:"country.chile",taxed:!1},{countryCode:"CN",labelResource:"country.china",taxed:!1},{countryCode:"CO",labelResource:"country.colombia",taxed:!1},{countryCode:"CR",labelResource:"country.costaRica",taxed:!1},{countryCode:"HR",labelResource:"country.croatia",taxed:!1},{countryCode:"CY",labelResource:"country.cyprus",taxed:!1},{countryCode:"CZ",labelResource:"country.czechRepublic",taxed:!1},{countryCode:"DK",labelResource:"country.denmark",taxed:!1},{countryCode:"DJ",labelResource:"country.djibouti",taxed:!1},{countryCode:"DM",labelResource:"country.dominica",taxed:!1},{countryCode:"DO",labelResource:"country.dominicanRepublic",taxed:!1},{countryCode:"EC",labelResource:"country.ecuador",taxed:!1},{countryCode:"EG",labelResource:"country.egypt",taxed:!1},{countryCode:"SV",labelResource:"country.elSalvador",taxed:!1},{countryCode:"EE",labelResource:"country.estonia",taxed:!1},{countryCode:"FJ",labelResource:"country.fiji",taxed:!1},{countryCode:"FI",labelResource:"country.finland",taxed:!1},{countryCode:"FR",labelResource:"country.france",taxed:!1},{countryCode:"GF",labelResource:"country.frenchGuiana",taxed:!1},{countryCode:"GA",labelResource:"country.gabon",taxed:!1},{countryCode:"GM",labelResource:"country.gambia",taxed:!1},{countryCode:"GE",labelResource:"country.georgia",taxed:!1},{countryCode:"DE",labelResource:"country.germany",taxed:!1},{countryCode:"GH",labelResource:"country.ghana",taxed:!1},{countryCode:"GR",labelResource:"country.greece",taxed:!1},{countryCode:"GD",labelResource:"country.grenada",taxed:!1},{countryCode:"GT",labelResource:"country.guatemala",taxed:!1},{countryCode:"GW",labelResource:"country.guineabissau",taxed:!1},{countryCode:"GY",labelResource:"country.guyana",taxed:!1},{countryCode:"HT",labelResource:"country.haiti",taxed:!1},{countryCode:"VA",labelResource:"country.holySeeVaticanCityState",taxed:!1},{countryCode:"HN",labelResource:"country.honduras",taxed:!1},{countryCode:"HK",labelResource:"country.hongKong",taxed:!1},{countryCode:"HU",labelResource:"country.hungary",taxed:!1},{countryCode:"IS",labelResource:"country.iceland",taxed:!1},{countryCode:"IN",labelResource:"country.india",taxed:!1},{countryCode:"ID",labelResource:"country.indonesia",taxed:!1},{countryCode:"IQ",labelResource:"country.iraq",taxed:!1},{countryCode:"IE",labelResource:"country.ireland",taxed:!1},{countryCode:"IL",labelResource:"country.israel",taxed:!1},{countryCode:"IT",labelResource:"country.italy",taxed:!1},{countryCode:"JM",labelResource:"country.jamaica",taxed:!1},{countryCode:"JP",labelResource:"country.japan",taxed:!1},{countryCode:"JO",labelResource:"country.jordan",taxed:!1},{countryCode:"KZ",labelResource:"country.kazakhstan",taxed:!1},{countryCode:"KE",labelResource:"country.kenya",taxed:!1},{countryCode:"KI",labelResource:"country.kiribati",taxed:!1},{countryCode:"KR",labelResource:"country.koreaRepublicOf",taxed:!1},{countryCode:"KW",labelResource:"country.kuwait",taxed:!1},{countryCode:"KG",labelResource:"country.kyrgyzstan",taxed:!1},{countryCode:"LA",labelResource:"country.laos",taxed:!1},{countryCode:"LV",labelResource:"country.latvia",taxed:!1},{countryCode:"LB",labelResource:"country.lebanon",taxed:!1},{countryCode:"LS",labelResource:"country.lesotho",taxed:!1},{countryCode:"LR",labelResource:"country.liberia",taxed:!1},{countryCode:"LI",labelResource:"country.liechtenstein",taxed:!1},{countryCode:"LT",labelResource:"country.lithuania",taxed:!1},{countryCode:"LU",labelResource:"country.luxembourg",taxed:!1},{countryCode:"MO",labelResource:"country.macau",taxed:!1},{countryCode:"MK",labelResource:"country.macedonia",taxed:!1},{countryCode:"MG",labelResource:"country.madagascar",taxed:!1},{countryCode:"MW",labelResource:"country.malawi",taxed:!1},{countryCode:"MY",labelResource:"country.malaysia",taxed:!1},{countryCode:"MV",labelResource:"country.maldives",taxed:!1},{countryCode:"ML",labelResource:"country.mali",taxed:!1},{countryCode:"MT",labelResource:"country.malta",taxed:!1},{countryCode:"MH",labelResource:"country.marshallIslands",taxed:!1},{countryCode:"MR",labelResource:"country.mauritania",taxed:!1},{countryCode:"MU",labelResource:"country.mauritius",taxed:!1},{countryCode:"MX",labelResource:"country.mexico",taxed:!1},{countryCode:"FM",labelResource:"country.micronesiaFederatedStatesOf",taxed:!1},{countryCode:"MD",labelResource:"country.moldovaRepublicOf",taxed:!1},{countryCode:"MC",labelResource:"country.monaco",taxed:!1},{countryCode:"MN",labelResource:"country.mongolia",taxed:!1},{countryCode:"ME",labelResource:"country.montenegro",taxed:!1},{countryCode:"MS",labelResource:"country.montserrat",taxed:!1},{countryCode:"MA",labelResource:"country.morocco",taxed:!1},{countryCode:"MZ",labelResource:"country.mozambique",taxed:!1},{countryCode:"NA",labelResource:"country.namibia",taxed:!1},{countryCode:"NR",labelResource:"country.nauru",taxed:!1},{countryCode:"NP",labelResource:"country.nepal",taxed:!1},{countryCode:"NL",labelResource:"country.netherlands",taxed:!1},{countryCode:"NZ",labelResource:"country.newZealand",taxed:!1},{countryCode:"NI",labelResource:"country.nicaragua",taxed:!1},{countryCode:"NE",labelResource:"country.niger",taxed:!1},{countryCode:"NG",labelResource:"country.nigeria",taxed:!1},{countryCode:"NO",labelResource:"country.norway",taxed:!1},{countryCode:"OM",labelResource:"country.oman",taxed:!1},{countryCode:"PK",labelResource:"country.pakistan",taxed:!1},{countryCode:"PW",labelResource:"country.palau",taxed:!1},{countryCode:"PA",labelResource:"country.panama",taxed:!1},{countryCode:"PG",labelResource:"country.papuaNewGuinea",taxed:!1},{countryCode:"PY",labelResource:"country.paraguay",taxed:!1},{countryCode:"PE",labelResource:"country.peru",taxed:!1},{countryCode:"PH",labelResource:"country.philippines",taxed:!1},{countryCode:"PL",labelResource:"country.poland",taxed:!1},{countryCode:"PT",labelResource:"country.portugal",taxed:!1},{countryCode:"QA",labelResource:"country.qatar",taxed:!1},{countryCode:"RO",labelResource:"country.romania",taxed:!1},{countryCode:"RU",labelResource:"country.russianFederation",taxed:!1},{countryCode:"RW",labelResource:"country.rwanda",taxed:!1},{countryCode:"KN",labelResource:"country.saintKittsAndNevis",taxed:!1},{countryCode:"LC",labelResource:"country.saintLucia",taxed:!1},{countryCode:"VC",labelResource:"country.saintVincentAndTheGrenadines",taxed:!1},{countryCode:"WS",labelResource:"country.samoa",taxed:!1},{countryCode:"SM",labelResource:"country.sanMarino",taxed:!1},{countryCode:"ST",labelResource:"country.saoTomeAndPrincipe",taxed:!1},{countryCode:"SA",labelResource:"country.saudiArabia",taxed:!1},{countryCode:"SN",labelResource:"country.senegal",taxed:!1},{countryCode:"RS",labelResource:"country.serbia",taxed:!1},{countryCode:"SC",labelResource:"country.seychelles",taxed:!1},{countryCode:"SL",labelResource:"country.sierraLeone",taxed:!1},{countryCode:"SG",labelResource:"country.singapore",taxed:!1},{countryCode:"SK",labelResource:"country.slovakia",taxed:!1},{countryCode:"SI",labelResource:"country.slovenia",taxed:!1},{countryCode:"SB",labelResource:"country.solomonIslands",taxed:!1},{countryCode:"ZA",labelResource:"country.southAfrica",taxed:!1},{countryCode:"ES",labelResource:"country.spain",taxed:!1},{countryCode:"LK",labelResource:"country.sriLanka",taxed:!1},{countryCode:"SR",labelResource:"country.suriname",taxed:!1},{countryCode:"SZ",labelResource:"country.swaziland",taxed:!1},{countryCode:"SE",labelResource:"country.sweden",taxed:!1},{countryCode:"CH",labelResource:"country.switzerland",taxed:!1},{countryCode:"TJ",labelResource:"country.tajikistan",taxed:!1},{countryCode:"TW",labelResource:"country.taiwanProvinceOfChina",taxed:!1},{countryCode:"TZ",labelResource:"country.tanzaniaUnitedRepublicOf",taxed:!1},{countryCode:"TH",labelResource:"country.thailand",taxed:!1},{countryCode:"TL",labelResource:"country.timorleste",taxed:!1},{countryCode:"TG",labelResource:"country.togo",taxed:!1},{countryCode:"TO",labelResource:"country.tonga",taxed:!1},{countryCode:"TT",labelResource:"country.trinidadAndTobago",taxed:!1},{countryCode:"TN",labelResource:"country.tunisia",taxed:!1},{countryCode:"TR",labelResource:"country.turkey",taxed:!1},{countryCode:"TM",labelResource:"country.turkmenistan",taxed:!1},{countryCode:"TV",labelResource:"country.tuvalu",taxed:!1},{countryCode:"UG",labelResource:"country.uganda",taxed:!1},{countryCode:"UA",labelResource:"country.ukraine",taxed:!1},{countryCode:"AE",labelResource:"country.unitedArabEmirates",taxed:!1},{countryCode:"GB",labelResource:"country.unitedKingdom",taxed:!1},{countryCode:"US",labelResource:"country.unitedStates",taxed:!0},{countryCode:"UY",labelResource:"country.uruguay",taxed:!1},{countryCode:"UZ",labelResource:"country.uzbekistan",taxed:!1},{countryCode:"VU",labelResource:"country.vanuatu",taxed:!1},{countryCode:"VE",labelResource:"country.venezuela",taxed:!1},{countryCode:"VN",labelResource:"country.vietNam",taxed:!1},{countryCode:"YE",labelResource:"country.yemen",taxed:!1},{countryCode:"ZM",labelResource:"country.zambia",taxed:!1},{countryCode:"ZW",labelResource:"country.zimbabwe",taxed:!1}],Noteflight.states=[{code:"AL",strings:["ALABAMA"],taxed:!1},{code:"AK",strings:["ALASKA"],taxed:!1},{code:"AS",strings:["AMERICAN SAMOA"],taxed:!1},{code:"AZ",strings:["ARIZONA"],taxed:!1},{code:"AR",strings:["ARKANSAS"],taxed:!1},{code:"AA",strings:["ARMED FORCES AMERICA"],taxed:!1},{code:"AE",strings:["ARMED FORCES"],taxed:!1},{code:"AP",strings:["ARMED FORCES PACIFIC"],taxed:!1},{code:"CA",strings:["CALIFORNIA"],taxed:!1},{code:"CO",strings:["COLORADO"],taxed:!1},{code:"CT",strings:["CONNECTICUT"],taxed:!1},{code:"DE",strings:["DELAWARE"],taxed:!1},{code:"DC",strings:["DISTRICT OF COLUMBIA","WASHINGTON DC","WASHINGTON, DC"],taxed:!1},{code:"FM",strings:["FEDERATED STATES OF MICRONESIA"],taxed:!1},{code:"FL",strings:["FLORIDA"],taxed:!1},{code:"GA",strings:["GEORGIA"],taxed:!1},{code:"GU",strings:["GUAM"],taxed:!1},{code:"HI",strings:["HAWAII"],taxed:!0},{code:"ID",strings:["IDAHO"],taxed:!1},{code:"IL",strings:["ILLINOIS","LAND OF LINCOLN"],taxed:!1},{code:"IN",strings:["INDIANA"],taxed:!1},{code:"IA",strings:["IOWA"],taxed:!0},{code:"KS",strings:["KANSAS"],taxed:!1},{code:"KY",strings:["KENTUCKY"],taxed:!1},{code:"LA",strings:["LOUISIANA"],taxed:!1},{code:"ME",strings:["MAINE"],taxed:!1},{code:"MH",strings:["MARSHALL ISLANDS"],taxed:!1},{code:"MD",strings:["MARYLAND"],taxed:!1},{code:"MA",strings:["MASS","MASSACHUSETTS","TAXACHUSETTS"],taxed:!0},{code:"MI",strings:["MICHIGAN"],taxed:!0},{code:"MN",strings:["MINNESOTA"],taxed:!1},{code:"MS",strings:["MISSISSIPPI"],taxed:!1},{code:"MO",strings:["MISSOURI"],taxed:!1},{code:"MT",strings:["MONTANA"],taxed:!1},{code:"NE",strings:["NEBRASKA"],taxed:!1},{code:"NV",strings:["NEVADA"],taxed:!1},{code:"NH",strings:["NEW HAMPSHIRE"],taxed:!1},{code:"NJ",strings:["NEW JERSEY"],taxed:!1},{code:"NM",strings:["NEW MEXICO"],taxed:!1},{code:"NY",strings:["NEW YORK"],taxed:!1},{code:"NC",strings:["NORTH CAROLINA"],taxed:!1},{code:"ND",strings:["NORTH DAKOTA"],taxed:!1},{code:"MP",strings:["NORTHERN MARIANA ISLANDS"],taxed:!1},{code:"OH",strings:["OHIO"],taxed:!1},{code:"OK",strings:["OKLAHOMA"],taxed:!1},{code:"OR",strings:["OREGON"],taxed:!1},{code:"PA",strings:["PENNSYLVANIA"],taxed:!0},{code:"PR",strings:["PUERTO RICO"],taxed:!1},{code:"PW",strings:["PALAU"],taxed:!1},{code:"RI",strings:["RHODE ISLAND"],taxed:!0},{code:"SC",strings:["SOUTH CAROLINA"],taxed:!0},{code:"SD",strings:["SOUTH DAKOTA"],taxed:!0},{code:"TN",strings:["TENN","TENNESSEE"],taxed:!0},{code:"TX",strings:["TEXAS"],taxed:!1},{code:"UT",strings:["UTAH"],taxed:!0},{code:"VA",strings:["VIRGINIA"],taxed:!1},{code:"VI",strings:["VIRGIN ISLANDS"],taxed:!1},{code:"VT",strings:["VERMONT"],taxed:!1},{code:"WA",strings:["WASHINGTON"],taxed:!0},{code:"WI",strings:["WISCONSIN"],taxed:!1},{code:"WV",strings:["WEST VIRGINIA"],taxed:!0},{code:"WY",strings:["WYOMING"],taxed:!1},{code:"UM",strings:["US MINOR OUTLYING ISLANDS"],taxed:!1}]},function(e,t,o){"use strict";o(621),o(622);var r=o(16),n=o(2),i=o(0);Noteflight.GiftCard={},Noteflight.GiftCard.InitiateGiftCardViewModel=function(){var e=this;e.session=Noteflight.session,(0,r.setTitleAndMeta)(e,"title.giftCard","meta.giftCard"),e.templateName=ko.observable("content/initiateGiftCard3"),Noteflight.GenericPageViewModel.call(e),e.serviceReporter=new Noteflight.ServiceReporterViewModel((0,i.resource)("action.loadingInfo")),e.priceFormatted=ko.observable(""),Noteflight.configureRecurly();var t=recurly.Pricing();e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()+1),t.plan(NF.recurlyCrescendoPlan(),{quantity:1}).catch(function(t){e.serviceReporter.errors.push({message:(0,i.resource)("errors.recurly.generic")}),e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1)}).done(function(t){e.serviceReporter.busyCounter(e.serviceReporter.busyCounter()-1),e.priceFormatted(t.currency.symbol+t.now.subtotal)}),e.recipientName=ko.observable(),e.readyToCheckout=ko.computed(function(){return e.recipientName()}),e.checkout=function(){(0,n.navigate)(NF.paths.purchaseGiftCard3({recipient:e.recipientName()}))}},Noteflight.GiftCard.PurchaseRecurlyViewModel=function(){var e=this;e.recipient=ko.observable(),e.templateName=ko.observable("content/purchaseGiftCardRecurly"),e.title=ko.observable((0,i.resource)("content.purchasePlan",(0,i.resource)("giftCardPurchase.title"))),Noteflight.GenericPageViewModel.call(e),e.allowPurchase=ko.observable(!0),e.email=ko.observable(),e.showEmail=ko.observable(!0),NF.session.current_user()&&(e.email(NF.session.current_user().email()),e.showEmail(!1)),e.recurlyPlanName=NF.recurlyCrescendoPlan(),e.doThePurchase=function(t){var o={recurly_token_id:t.id,recipient_name:e.recipient(),email:e.email()};NF.apiController.purchaseGiftCert(e.serviceReporter,e.purchaseGiftCertComplete,o)},Noteflight.CommonRecurlyPurchaseViewModel.call(this,e.doThePurchase,!0),e.purchaseGiftCertComplete=function(t){e.allowPurchase(!1),(0,n.navigate)(t.gift_cert.print_cert_url)},e.updatePrice()},Noteflight.GiftCard.PrintGiftCardViewModel=function(){this.session=Noteflight.session,this.templateName=ko.observable("content/printGiftCard2"),this.title=ko.observable((0,i.resource)("giftCardPrint2.title")),Noteflight.GenericPageViewModel.call(this),this.recipient=ko.observable(""),this.gift_code=ko.observable(""),this.printCard=function(){window.print()}},(0,n.addRoute)("requestGiftCardDirect","/gift_card#",Noteflight.GiftCard.InitiateGiftCardViewModel,{}),(0,n.addRoute)("requestGiftCard","/info#/gift_card",Noteflight.GiftCard.InitiateGiftCardViewModel,{}),(0,n.addRouteAlias)("r2","requestGiftCard","/gift_card#"),(0,n.addRoute)("requestGiftCard2","/info#/gift_card2",Noteflight.GiftCard.InitiateGiftCardViewModel,{}),(0,n.addRoute)("purchaseGiftCard3","/info:?recipient:#/purchase_gift_card3",Noteflight.GiftCard.PurchaseRecurlyViewModel,{}),(0,n.addRoute)("printGiftCard2","/info/gift_card_print2:?recipient::?gift_code:#",Noteflight.GiftCard.PrintGiftCardViewModel,{})},function(e,t,o){e.exports=o.p+"images/gift_card_logo-1bbee2c507e932872c32cd507efc4477.png"},function(e,t,o){e.exports=o.p+"images/gift_card_background-e957f869330c8aab536084b1bdef40d1.png"},function(e,t,o){"use strict";var r=g(o(4)),n=g(o(62)),i=g(o(303)),a=g(o(305)),s=g(o(54)),l=g(o(625)),c=g(o(628)),u=o(5),d=g(o(215)),p=o(8),f=o(16),h=o(2),m=o(0);function g(e){return e&&e.__esModule?e:{default:e}}Noteflight.GroupViewModel=function(){var e=this;Noteflight.ServiceReporterViewModel.call(this,(0,m.resource)("action.loading")),s.default.call(e),e.activeHeaderTag("community"),e.groupId=ko.observable(),e.group=ko.observable(),e.lastGroupId=null,e.forums=ko.observableArray([]),e.overviewView=ko.observable(),e.scoresView=ko.observable(),e.membersView=ko.observable(),e.siteMembersView=ko.observable(),e.addClassesView=ko.observable(),e.inviteTeachersView=ko.observable(),e.manageForumsView=ko.observable(),e.newForumView=ko.observable(),e.activityView=ko.observable(),e.flaggedContentView=ko.observable(),e.editOverview=ko.observable(),e.title=ko.observable(),e.forumId=ko.observable(),e.discussionId=ko.observable(),e.name=ko.computed(function(){if(e.group())return e.group().name()}),e.isReadOnly=ko.computed(function(){if(e.group())return!NF.roles.isSiteAdmin()&&(e.group().archived()||e.group().deleted())}),e.readyToShow=ko.observable(!1),e.templateName=ko.observable("content/group"),e.searchTarget=ko.observable(""),e.searchForTitle=ko.computed(function(){return(0,m.resource)("content.searchFor",e.searchTarget())}),e.state=ko.observable("root"),e.subState=ko.observable(null),e.currentSubview=ko.observable(null),e.setSearchLabel=function(t){e.searchLabel=ko.observable((0,m.resource)(t))},e.groupsTipElements=ko.computed(function(){if(!e.readyToShow()||!e.group().isSiteCommunity()||!NF.session.community_member())return null;var t=NF.session.community_member().sso_user_role();t||(t="student");for(var o=[{resourcesKey:{student:"tip.thisIsCommunityGroupStudent",instructor:"tip.thisIsCommunityGroupTeacher",admin:"tip.thisIsCommunityGroupTeacher"}[t],type:"text"}],r={student:[],instructor:["tip.communityManageStudents"],admin:["tip.communityManageMembers","tip.communityChangeSettings"]}[t],n=0;n<r.length;n++)o.push({resourcesKey:r[n],type:"bullet"});return o}),e.groupsTip=ko.computed(function(){return new Noteflight.TipViewModel(e.groupsTipElements(),"_nf_tip_groups_community_group.hidden","groupsTipCusotmStyle")}),r.default.subscribe(u.SITE_UPDATED,function(t,r){r.group.id==e.group().id()&&o(r.group)}),r.default.subscribe(u.GROUP_UPDATED,function(t,r){r.id==e.group().id()&&o(r)}),e.suspendGroup=function(){function t(e){0===e.failed.length?(0,h.navigate)(NF.paths.groups()):r.default.publish(REPORTER_ADD_ERROR,{code:"unableToSuspendGroup",message:(0,m.resource)("errors.unableToSuspendGroup")})}Noteflight.showFlagCommentDialog((0,m.resource)("groupDialog.suspendGroupName",e.group().name()),e.group().name(),function(o){NF.apiService.suspendGroup((0,m.resource)("action.suspendingGroup"),t,{group_id:e.groupId(),suspended_by_id:NF.session.current_user().external_id(),reason:o})})},e.showFlagGroupDialog=function(){new Noteflight.FlagGlobalDialog(e.group().name(),function(t){NF.apiService.flagGroup((0,m.resource)("action.flagging"),function(){},{group_id:e.groupId(),group_name:e.group().name(),internal_comment:t,flagger_username:NF.session.current_user()?NF.session.current_user().username():"anonymous"})}).show()},e.contextMenuItems=function(){var t=[];return NF.roles.isLoggedIn()&&t.push({label:(0,m.resource)("action.flagGroup"),action:e.showFlagGroupDialog}),t},e.selectSubview=function(){var t=null;if(e.doesSearch(!1),e.search=e.defaultSearch,e.group().deleted()||!e.group().permissions.can_view_group_details())t=e.overviewView();else switch(e.state()){case"root":NF.IsPhoneLayout()||(t=e.overviewView());break;case"overview":t=e.overviewView();break;case"scores":t=e.scoresView();break;case"members":t=e.membersView(),NF.roles.isSiteAdmin()&&e.enableCustomSearch();break;case"siteMembers":t=e.siteMembersView(),e.enableCustomSearch();break;case"addClasses":t=e.addClassesView();break;case"inviteTeachers":t=e.inviteTeachersView();break;case"forumsTab":t=e.forums()[0],e.forumId(e.forums()[0].id());break;case"forums":for(var o=0;o<e.forums().length;o++)if(e.forumId()==e.forums()[o].id()){t=e.forums()[o];break}break;case"manageForums":t=e.manageForumsView();break;case"newForum":t=e.newForumView();break;case"activity":t=e.activityView();break;case"flaggedContent":t=e.flaggedContentView();break;case"editOverview":t=e.editOverview()}e.currentSubview(t),t&&t.activate()},e.isForumsCurrentSubview=ko.computed(function(){for(var t=0;t<e.forums().length;t++)if(e.forums()[t].isCurrent())return!0;return!1});var t=function(t){if(t){e.forums([]);for(var o=0;o<t.length;o++)e.forums.push(new NF.GroupDiscussionsViewModel(e,t[o]))}},o=function(o){if(e.group(new n.default(o)),e.title((0,f.safeValueExtractionFromObservableObject)(m.resource,o.name)),e.siteAdminVM=NF.roles.isAtLeastSiteTeacher()?new NF.SiteAdminViewModel(e):null,e.lastGroupId=e.group().id(),e.overviewView(new NF.GroupOverviewViewModel(e)),e.group().showDetails())if(e.scoresView(new NF.GroupScoresViewModel(e)),e.membersView(new NF.GroupMembersCommonViewModel(e)),e.siteMembersView(new NF.GroupSiteMembersCommonViewModel(e)),e.manageForumsView(new NF.GroupManageForumsViewModel(e)),e.newForumView(new NF.GroupForumCreateViewModel(e)),e.activityView(new NF.GroupActivityViewModel(e)),e.flaggedContentView(new NF.GroupFlaggedContentViewModel(e)),e.group().isCommunity()){var r=NF.session.community_member(),s=new d.default({groupId:e.groupId(),name:e.group().name(),description:e.group().overview_all(),allow_anonymous_view:NF.session.community().allow_anonymous_view(),logo_id:e.group().group_logo_id(),site_type:e.calculateSiteType(),sso_username:r?r.sso_username():null});e.addClassesView(new l.default(s,e)),e.inviteTeachersView(new c.default(s,e)),e.editOverview(new a.default(s))}else e.editOverview(new i.default(e.group));t(o.forums),e.selectSubview(),e.readyToShow(!0)};e.gotGroup=o,e.calculateSiteType=function(){var e=p.SITE_TYPE_SCC;return NF.session.community().sso_allowed()&&(e=p.SITE_TYPE_LTI),NF.session.community().is_google_classroom()&&(e=p.SITE_TYPE_GC),e},e.onNavigate=function(){e.group()&&e.lastGroupId==e.groupId()?e.selectSubview():NF.apiService.fetchGroup((0,m.resource)("action.loading"),function(e){o(e.group)},{group_id:e.groupId()})};var g=function(e){t(e.group.forums)};e.refreshForumsList=function(){NF.apiService.fetchGroup((0,m.resource)("action.loading"),g,{group_id:e.groupId()})},e.enableCustomSearch=function(){e.doesSearch(!0),e.search=function(t){e.searchTarget(t),t?e.currentSubview().customSearchFunction(t):e.clearSearch()},e.clearSearch=function(){e.searchTarget(""),Noteflight.appViewModel.clearSearch(),(0,h.navigate)(e.currentSubview().rootPath({groupId:e.groupId()}))}}},(0,h.addRoute)("viewGroup","/groups#/group/{groupId}",Noteflight.GroupViewModel,{state:"root"}),(0,h.addRoute)("viewGroupOverview","/groups#/group/{groupId}/overview",Noteflight.GroupViewModel,{state:"overview"}),(0,h.addRoute)("viewGroupOverviewLogin","/groups#/group/{groupId}/overviewLogin",Noteflight.GroupViewModel,{state:"overview",subState:"login"}),(0,h.addRoute)("viewGroupOverviewSignup","/groups#/group/{groupId}/overviewSignup",Noteflight.GroupViewModel,{state:"overview",subState:"signup"}),(0,h.addRoute)("viewGroupAllScores","/groups#/group/{groupId}/scores/all",Noteflight.GroupViewModel,{state:"scores",subState:"allScores"}),(0,h.addRoute)("viewGroupRecentScores","/groups#/group/{groupId}/scores/rising",Noteflight.GroupViewModel,{state:"scores",subState:"recentScores"}),(0,h.addRoute)("viewGroupPopularScores","/groups#/group/{groupId}/scores/popular",Noteflight.GroupViewModel,{state:"scores",subState:"popularScores"}),(0,h.addRoute)("viewSiteGroupStudents","/groups#/group/{groupId}/students",Noteflight.GroupViewModel,{state:"siteMembers",subState:"students"}),(0,h.addRoute)("viewSiteGroupTeachers","/groups#/group/{groupId}/teachers",Noteflight.GroupViewModel,{state:"siteMembers",subState:"teachers"}),(0,h.addRoute)("viewGroupMembers","/groups#/group/{groupId}/members",Noteflight.GroupViewModel,{state:"members",subState:"members"}),(0,h.addRoute)("viewGroupMembersSearch","/groups#/group/{groupId}/members/{searchTarget}",Noteflight.GroupViewModel,{state:"members",subState:"members"}),(0,h.addRoute)("addGCClasses","/groups#/group/{groupId}/addClasses",Noteflight.GroupViewModel,{state:"addClasses"}),(0,h.addRoute)("inviteTeachers","/groups#/group/{groupId}/inviteTeachers",Noteflight.GroupViewModel,{state:"inviteTeachers"}),(0,h.addRoute)("viewGroupRequests","/groups#/group/{groupId}/requests",Noteflight.GroupViewModel,{state:"members",subState:"requests"}),(0,h.addRoute)("viewGroupRequestsSearch","/groups#/group/{groupId}/requests/{searchTarget}",Noteflight.GroupViewModel,{state:"members",subState:"requests"}),(0,h.addRoute)("viewGroupBlacklist","/groups#/group/{groupId}/blacklist",Noteflight.GroupViewModel,{state:"members",subState:"blacklist"}),(0,h.addRoute)("viewGroupBlacklistSearch","/groups#/group/{groupId}/blacklist/{searchTarget}",Noteflight.GroupViewModel,{state:"members",subState:"blacklist"}),(0,h.addRoute)("viewGroupInvitations","/groups#/group/{groupId}/invitations",Noteflight.GroupViewModel,{state:"members",subState:"invitations"}),(0,h.addRoute)("viewGroupInvitationsSearch","/groups#/group/{groupId}/invitations/{searchTarget}",Noteflight.GroupViewModel,{state:"members",subState:"invitations"}),(0,h.addRoute)("viewGroupForums","/groups#/group/{groupId}/forums",Noteflight.GroupViewModel,{state:"forumsTab",subState:"choose"}),(0,h.addRoute)("viewGroupForum","/groups#/group/{groupId}/forums/{forumId}",Noteflight.GroupViewModel,{state:"forums",subState:"choose"}),(0,h.addRoute)("viewGroupDiscussion","/groups#/group/{groupId}/forums/{forumId}/discussion/{discussionId}",Noteflight.GroupViewModel,{state:"forums",subState:"show"}),(0,h.addRoute)("newGroupDiscussion","/groups#/group/{groupId}/forums/{forumId}/newDiscussion",Noteflight.GroupViewModel,{state:"forums",subState:"create"}),(0,h.addRoute)("editGroupForum","/groups#/group/{groupId}/forums/{forumId}/edit",Noteflight.GroupViewModel,{state:"forums",subState:"settings"}),(0,h.addRoute)("manageGroupForums","/groups#/group/{groupId}/manageForums",Noteflight.GroupViewModel,{state:"manageForums"}),(0,h.addRoute)("newGroupForum","/groups#/group/{groupId}/newForum",Noteflight.GroupViewModel,{state:"newForum"}),(0,h.addRoute)("viewGroupFlaggedContent","/groups#/group/{groupId}/flaggedContent",Noteflight.GroupViewModel,{state:"flaggedContent"}),(0,h.addRoute)("viewGroupFlaggedContentStats","/groups#/group/{groupId}/flaggedContent/stats",Noteflight.GroupViewModel,{state:"flaggedContent",subState:"stats"}),(0,h.addRoute)("editOverview","/groups#/group/{groupId}/editOverview",Noteflight.GroupViewModel,{state:"editOverview"}),(0,h.addRoute)("viewGroupActivity","/groups#/group/{groupId}/activity",Noteflight.GroupViewModel,{state:"activity"}),(0,h.addRoute)("viewGroupDiscussionsOld","/groups#/group/{groupId}/discussions/{forumId}",Noteflight.GroupViewModel,{state:"forums",subState:"choose"}),(0,h.addRoute)("viewGroupDiscussionOld","/groups#/group/{groupId}/discussions/{forumId}/discussion/{discussionId}",Noteflight.GroupViewModel,{state:"forums",subState:"show"}),(0,h.addRoute)("viewGroupNewDiscussionOld","/groups#/group/{groupId}/discussions/{forumId}/newDiscussion",Noteflight.GroupViewModel,{state:"forums",subState:"create"}),(0,h.addRoute)("viewGroupEditDiscussionOld","/groups#/group/{groupId}/discussions/{forumId}/edit",Noteflight.GroupViewModel,{state:"forums",subState:"settings"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(4)),n=o(5),i=c(o(116)),a=(c(o(32)),o(53)),s=c(o(75)),l=o(0);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m="/api/1.0/group_logo",g=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this,o))).endpointName("uploadGroupLogo"),e.pictureKey("group_logo"),e.imageAPI=m,e.editable(!0),e._choosePhotoGroupLogo=e._choosePhotoGroupLogo.bind(h(h(e))),e.selectedCallback=e.selectedCallback.bind(h(h(e))),e.contextMenuItems=ko.observableArray([{label:(0,l.resource)("action.upload"),action:e.uploadImage},{label:(0,l.resource)("action.chooseStockPhoto"),action:e._choosePhotoGroupLogo}]),e.groupId=o.groupId,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,s.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"_choosePhotoGroupLogo",value:function(){new i.default((0,l.resource)("action.changeGroupLogo"),"group_logo","uploadGroupLogoData",{selectedCallback:this.selectedCallback,aspectRatio:16/9}).show()}},{key:"selectedCallback",value:function(e){r.default.publish(n.STOCK_IMAGE_GROUP_LOGO_SELECTED,e),this._rawImageUrl(e.temp_url)}},{key:"refreshImage",value:function(){(0,a.updateProfileEpoch)(!0),this._rawImageUrl(this._originalImageUrl())}},{key:"_croppingCancelCallback",value:function(){var e=this,t=r.default.subscribe(n.GROUP_SAVED,function(o,n){r.default.unsubscribe(t),e.refreshImage()});r.default.publish(n.STOCK_IMAGE_GROUP_LOGO_SELECTED,{group_logo_id:this._oldImageId})}},{key:"_callbackNewImageUploaded",value:function(e,t){var o=t?this._letUserCropImage.bind(this):function(){};this._oldImageId=this.imageId(),r.default.publish(n.STOCK_IMAGE_GROUP_LOGO_SELECTED,e),this.newImageUploaded(!0),this._rawImageUrl(e.temp_url),o({aspectRatio:16/9})}}]),t}();t.default=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(54)),n=l(o(61)),i=o(626),a=l(o(306)),s=o(2);o(0);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=d(this,p(t).call(this))).site=e,r.parent=o,r.templateName=ko.observable("group/addClasses"),r.authorized=ko.observable(!1),r.googleClassroomCoursesForm=new i.GoogleClassroomCoursesViewModel(r.site.courses,!1),r.ready=ko.computed(function(){return r.authorized()&&r.googleClassroomCoursesForm.ready()&&r.googleClassroomCoursesForm.validNumberOfUsers()&&!r.googleClassroomCoursesForm.coursesToCount()}),r.siteMembersUrl=NF.paths.viewSiteGroupStudents({groupId:NF.getCommunityGroup().id()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,r.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"add",value:function(){var e=this.googleClassroomCoursesForm.selectedCourses().map(function(e){return e.id});this.syncDialog=new a.default({type:"manage_courses",groupIds:e,redirectAfterCommit:this.siteMembersUrl}),this.syncDialog.beginSync(function(){})}},{key:"goBack",value:function(){(0,s.navigate)(this.siteMembersUrl)}},{key:"handleAddClick",value:function(){this.add()}},{key:"handleCancelClick",value:function(){this.goBack()}},{key:"activate",value:function(){var e=this;this.authorized(!1);var t=n.default.getAuthLink({returnTo:window.location,googleClassroom:!0,referringHostname:!0});n.default.checkAuthorization(t).then(function(){return e.authorized(!0)})}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleClassroomCourse=t.GoogleClassroomCoursesViewModel=void 0;var r=s(o(4)),n=o(5),i=s(o(126)),a=(s(o(42)),o(0));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,o){return t&&c(e.prototype,t),o&&c(e,o),e}var d=function(){function e(t,o){var r=this;l(this,e),this.selectedCourses=t,this.creatingNewSite=o,this.coursesToCount=ko.observable(0),this.searchTarget=ko.observable(""),this.filteredCourses=ko.observableArray([]),this.selectedCourseNames=ko.observableArray([]),this.searchPlaceholder="action.searchForCourses",this.allCourses=ko.observableArray([]),this.uniqueUserIds=ko.computed(this.computeUniqueUserIds.bind(this)),this.totalUserCount=ko.computed(this.computeTotalUserCount.bind(this)),this.maxMemberCount=ko.computed(this.computeMaxMemberCount.bind(this)),this.availableMemberCount=ko.computed(function(){return Math.max(r.maxMemberCount()-r.totalUserCount(),0)}),this.initialUniqueUserIds=[],this.initialTotalUserCount=0,this.addedUniqueUserIds=ko.computed(this.computeAddedUniqueUserIds.bind(this)),this.addedUserCount=ko.computed(this.computeAddedUserCount.bind(this)),this.removedUniqueUserIds=ko.computed(this.computeRemovedUniqueUserIds.bind(this)),this.displayUserCount=ko.computed(this.computeDisplayUserCount.bind(this)),this.loadingSyncedGCCoursesDeferred=$.Deferred(),this.loadingComplete=ko.observable(!1),this.handleGoogleCourseListLoaded=this.handleGoogleCourseListLoaded.bind(this),this.handleCourseCheckboxClick=this.handleCourseCheckboxClick.bind(this),this.handleSyncedCourseListLoaded=this.handleSyncedCourseListLoaded.bind(this),this.removeSelected=this.removeSelected.bind(this),this.ready=ko.observable(!1),this.freeSeats=ko.computed(function(){return r.maxMemberCount()-r.totalUserCount()}),this.validNumberOfUsers=ko.computed(function(){return r.freeSeats()>=0})}return u(e,[{key:"initialize",value:function(){var e=this;$.when(this.loadingSyncedGCCoursesDeferred).done(function(){e.loadingComplete(!0),r.default.publish(n.REPORTER_REMOVE)}),r.default.publish(n.REPORTER_ADD,{text:(0,a.resource)("gc.loadingClassList")}),function(e){function t(t,o){r.default.publish(n.REPORTER_REMOVE);var i=t[0];e(i.result)}new Promise(function(e,t){NF.apiService.fetchGoogleClassroomCourseList("",e,{},{})}).then(function(e){r.default.publish(n.REPORTER_ADD,{text:(0,a.resource)("gc.loadingClassList")}),(new i.default).startPolling(e.id).onComplete(t).onError(function(e){r.default.publish(n.REPORTER_ADD_ERROR,{code:"gcError",message:(0,a.resource)("content.gcError")})})})}(this.handleGoogleCourseListLoaded),this.ready(!0)}},{key:"search",value:function(){var e=[],t=this.searchTarget();e=t.length?this.allCourses().filter(function(e){return e.name().toLowerCase().indexOf(t.toLowerCase())>-1}):this.allCourses(),this.filteredCourses(e)}},{key:"clearSearch",value:function(){this.searchTarget(""),this.filteredCourses(this.allCourses())}},{key:"computeUniqueUserIds",value:function(){for(var e=[],t=0;t<this.selectedCourses().length;t++){for(var o=this.selectedCourses()[t],r=0;r<o.studentIds.length;r++)e.indexOf(o.studentIds[r])<0&&e.push(o.studentIds[r]);for(var n=0;n<o.teacherIds.length;n++)e.indexOf(o.teacherIds[n])<0&&e.push(o.teacherIds[n])}return e}},{key:"computeTotalUserCount",value:function(){return this.uniqueUserIds().length}},{key:"computeMaxMemberCount",value:function(){return NF.session.community()&&NF.session.community().max_total_scc_member_count&&NF.session.community().max_total_scc_member_count()||0}},{key:"computeAddedUniqueUserIds",value:function(){var e=this.initialUniqueUserIds;return this.uniqueUserIds().filter(function(t){return!e.includes(t)})}},{key:"computeAddedUserCount",value:function(){return this.addedUniqueUserIds().length}},{key:"computeRemovedUniqueUserIds",value:function(){var e=this.initialUniqueUserIds,t=this.uniqueUserIds();return e.filter(function(e){return!t.includes(e)})}},{key:"computeRemovedUserCount",value:function(){return this.removedUniqueUserIds().length}},{key:"computeDisplayUserCount",value:function(){return this.computeAddedUserCount()>0||this.computeRemovedUserCount()>0}},{key:"handleGoogleCourseListLoaded",value:function(e){for(var t=[],o=0;o<e.length;o++)t.push(new p(e[o],this.handleCourseCheckboxClick));this.allCourses(t),this.filteredCourses(t),this.creatingNewSite?this.loadingSyncedGCCoursesDeferred.resolve():function(e){NF.apiService.fetchGoogleClasses("",e,{include_user_data:!0})}(this.handleSyncedCourseListLoaded)}},{key:"handleSyncedCourseListLoaded",value:function(e){for(var t=this,o=[],r=0;r<e.groups.length;r++){for(var n=e.groups[r],i=0;i<this.allCourses().length;i++){var a=this.allCourses()[i];a.id()==n.course_id&&(o.push($.Deferred()),a.deferred=o[o.length-1],a.synced(!0))}this.selectedCourses.valueHasMutated(),this.initialUniqueUserIds=this.computeUniqueUserIds(),this.initialTotalUserCount=this.totalUserCount()}$.when.apply($,o).done(function(){t.loadingSyncedGCCoursesDeferred.resolve()})}},{key:"handleCourseCheckboxClick",value:function(e,t){return e.synced()?this.selectCourse(e,t):this.unselectCourse(e),!0}},{key:"selectCourse",value:function(e,t){var o=this;r.default.publish(n.REPORTER_ADD,{text:(0,a.resource)("gc.loadingUserCount",e.name())}),this.coursesToCount(this.coursesToCount()+1);var i=this.selectedCourseNames().find(function(t){return t.id==e.id()});i||(i={id:e.id(),name:e.name(),loading:ko.observable(!0)},this.selectedCourseNames.push(i)),function(e,t){NF.apiService.fetchGoogleClassroomCourseUserCount("",t,{courseId:e})}(e.id(),function(s){r.default.publish(n.REPORTER_REMOVE,{text:(0,a.resource)("gc.loadingUserCount",e.name())}),o.coursesToCount(o.coursesToCount()-1),e.userCount(s.user_count),o.selectedCourses.push({id:e.id(),name:e.name(),studentIds:s.student_ids,teacherIds:s.teacher_ids}),t&&t.resolve(),o.validNumberOfUsers()||r.default.publish(n.REPORTER_ADD_ERROR,{code:"notEnoughMembers",message:(0,a.pluralize)("content.gc.notEnoughMembers",-o.freeSeats())}),i.loading(!1)})}},{key:"unselectCourse",value:function(e){this.selectedCourses.remove(function(t){return t.id==e.id()}),this.selectedCourseNames.remove(function(t){return t.id==e.id()})}},{key:"removeSelected",value:function(e){var t=e.id;this.selectedCourseNames.remove(function(e){return e.id==t}),this.allCourses().find(function(e){return e.id()==t}).toggleSynced()}}]),e}();t.GoogleClassroomCoursesViewModel=d;var p=function(){function e(t,o){var r=this;l(this,e),this.course=t,this.id=ko.observable(t.id),this.name=ko.observable(t.name),this.deferred=null,this.syncCallback=o,this.synced=ko.observable(!1),this.synced.subscribe(function(){r.syncCallback(r,r.deferred)}),this.userCount=ko.observable(null),this.textToShow=ko.computed(function(){var e=r.name();return r.userCount()&&(e+=" ("+r.userCount()+" "+(0,a.pluralize)("content.userCount",r.userCount())+")"),e})}return u(e,[{key:"toggleSynced",value:function(){this.synced(!this.synced())}}]),e}();t.GoogleClassroomCourse=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(0);t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message=ko.observable(t.name),this.countNum=t.count,this.count=ko.observable(""),t.count&&this.count((0,r.pluralize)("content.syncClassroom.count",t.count))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(o(4)),n=o(5),i=o(6),a=c(o(54)),s=o(2),l=o(0);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=/\S+@\S+\.\S+/,g=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this))).parent=e,o.templateName=ko.observable("group/inviteTeachers"),o.userList=ko.observable(""),o.ready=ko.observable(!0),o.validationError=ko.observable(!1),o.userList.subscribe(function(){o.validationError(!1),o.ready(!0)}),o.submittable=ko.computed(function(){return o.ready()&&""!==o.userList()}),o.maxMemberCount=ko.computed(o.computeMaxMemberCount.bind(h(h(o)))),o.totalUserCount=ko.computed(o.computeTotalUserCount.bind(h(h(o)))),o.availableMemberCount=ko.computed(function(){return Math.max(o.maxMemberCount()-o.totalUserCount(),0)}),o.siteMembersUrl=i.NF.paths.viewSiteGroupStudents({groupId:i.NF.getCommunityGroup().id()}),o.siteTeachersUrl=i.NF.paths.viewSiteGroupTeachers({groupId:i.NF.getCommunityGroup().id()}),o.teachersAdded=o.teachersAdded.bind(h(h(o))),o.fail=o.fail.bind(h(h(o))),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,a.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"goBack",value:function(){(0,s.navigate)(this.siteMembersUrl)}},{key:"goToTeachers",value:function(){(0,s.navigate)(this.siteTeachersUrl)}},{key:"handleAddClick",value:function(){this.ready(!1),r.default.publish(n.REPORTER_ADD,{text:(0,l.resource)("action.addingTeachers")});var e=this.userList().split("\n"),t=!0,o=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var u=s.value;if(!this.validate(u))return void this.validationError(!0)}}catch(e){o=!0,a=e}finally{try{t||null==c.return||c.return()}finally{if(o)throw a}}i.NF.apiService.googleClassroomInviteTeachers("",this.teachersAdded,{email_addresses:e},{fail:this.fail})}},{key:"handleCancelClick",value:function(){this.goBack()}},{key:"activate",value:function(){}},{key:"validate",value:function(e){return m.test(String(e).toLowerCase())}},{key:"fail",value:function(){this.ready(!0)}},{key:"computeMaxMemberCount",value:function(){return i.NF.session.community()&&i.NF.session.community().max_total_scc_member_count&&i.NF.session.community().max_total_scc_member_count()||0}},{key:"computeTotalUserCount",value:function(){return i.NF.session.community()&&i.NF.session.community().total_scc_member_count&&i.NF.session.community().total_scc_member_count()||0}},{key:"teachersAdded",value:function(e){this.ready(!0),this.userList(""),r.default.publish(n.REPORTER_REMOVE),this.goToTeachers()}}]),t}();t.default=g},function(e,t,o){"use strict";o(630),o(631),o(632),o(633),o(634),o(635),o(636),o(637),o(638);var r=o(16),n=o(2),i=o(0);o(639),o(913),Noteflight.HelpViewModel=function(){var e=this;e.topic=ko.observable(""),e.edition=ko.observable(),(0,r.setTitleAndMeta)(e,"title.guide","meta.guide"),e.helpHeader=(0,i.resource)("content.guide"),Noteflight.GenericPageViewModel.call(e),e.templateName=ko.observable("content/help_new"),e.init=function(t){e.distillPaletteInfo(NF.EditPaletteConfig),e.distillPaletteInfo(NF.PlayPaletteConfig),e.distillPaletteInfo(NF.RecordPaletteConfig),e.distillPaletteSectionInfo("view",NF.ScoreViewMenu),e.distillPaletteSectionInfo("header",NF.EditHeaderPaletteLeftConfig),e.distillPaletteSectionInfo("header",NF.PlayHeaderPaletteLeftConfig),e.distillPaletteSectionInfo("header",NF.RecordHeaderPaletteLeftConfig),e.populateContents(),e.highlightTopic(),e.scrollTocIntoView(),e.sizeImages(),e.scrollTopicIntoView(),e.checkAllMenuItemsTested()},e.topic.subscribe(function(){e.highlightTopic(),e.scrollTopicIntoView()});var t=0,o={},n={};e.distillPaletteSectionInfo=function(e,t){var r=o[e];if(!r){var a="header"==e?null:(0,i.resource)("palette.section.".concat(e));r={actions:{},title:a},o[e]=r}$(t.controls).each(function(e,t){n[t.id]=r.actions[t.id]=$.extend(t,{shortcut:NF.PaletteShortcut(t.id),title:(0,i.resource)("palette.".concat(t.id)),section:r})})},e.distillPaletteInfo=function(t){$(t.sections).each(function(t,o){e.distillPaletteSectionInfo(o.id,o)})},e.paletteActionHtml=function(e,t){t=t||{};var o=$('<div class="paletteButton guide"></div>'),r=n[e]||{};if(o.addClass(t.icon||r.buttonImageCSS||r.id),o.text(t.title||r.title),t.shortcut&&r.shortcut){var i=$('<span class="shortcut"></span>');i.text(r.shortcut.trim()),o.append(i)}var a=$("<div></div>");if(r.section&&r.section.title){var s=$('<div class="paletteSectionTitle"></div>');s.text((r.section.title+":").trim()),a.append(s)}return a.append(o),a.html()},e.populateContents=function(){$("div.guideAction").each(function(t,o){var r=$(o),n=r.attr("id").replace(/^action-/,"");r.html(e.paletteActionHtml(n,{shortcut:!0}))}),$("h2.guideAction").each(function(t,o){var r=$(o),n=r.attr("id").replace(/^action-/,""),i=$('<div class="popupPaletteSection"></div>');i.html(e.paletteActionHtml(n,{shortcut:!0})),r.append(i)}),$("#guide a").each(function(t,o){var r=$(o);if(""===r.html()){var n=r.attr("href");if(n&&n.match(/^#action-/)){var i=n.replace(/^#action-/,"");r.html(e.paletteActionHtml(i)),r.addClass("guideAction")}else n&&n.match(/^#/)&&(r.text($(n).text().trim()),r.addClass("guideSection"))}}),$("#guideTOC").empty();var t={};$("#guide h1,h2").each(function(e,o){var r=o.id||"a"==o.parentElement.localName&&o.parentElement.id;if(r){t[r]?console.log("Duplicate TOC id:",r):t[r]=r;var i=$(o),a=$("<div></div>"),s=$("<a></a>");if(a.append(s),r.match(/^action-/)){var l=o.id.replace(/^action-/,"");n[l]?s.text(n[l].title.trim()):console.log("Missing action:",l)}else s.text(i.text().trim());s.attr("href","#"+r),"h1"==o.localName?a.addClass("navHead"):a.addClass("navItem"),a.attr("id","toc-"+r),$("#guideTOC").append(a)}})};var a={selectMeasure:[130,64],mouseNoteEntry:[101.5,50],mouseEntryComplete:[133,41],durationChange:[204,35],pitchChange:[130,34],durationPitchChange:[113,41],noteSelection:[148,104],measureSelection:[141,117],scoreSelection:[143,156],insertMeasure:[127,81],deleteMeasure:[127,81],dragDropExample:[123,44.5],multipleSelection:[173.5,47.5],multipleSelectionAccented:[175,58],scoreSelection2:[433,143],rangeSelection:[135,117],staffSelection:[613,130],dragDropStaffH:[363.5,116.5],dragDropStaffV:[132.5,119],dragDropScore:[144.5,53.5],sectionPalettePinned:[315,217],instruments:[348,289],durationNote:[310,249],durationRest:[311,244],graceBeforeCreate:[120,47],graceAfterCreate:[136,47],graceNoteGroup:[137,41],graceNoteGroupComplete:[137,41],tupletBeforeCreate:[93,37],tupletAfterCreate:[127,54],dupletBeforeCreate:[56,52],dupletAfterCreate:[70,52],transposeInitial:[434,312],tempoControl:[199.5,31],initialTempoMarking:[391,68],rangeTempoMarking:[395,70],tempoValue:[352,73],swing8th16thInitial:[199,72],swingEighths:[238,86],swingSixteenths:[237,126],straightEights:[164,56],tripletEights:[161,53],dottedEights:[164,54],lyricsEntry:[232,68],lyricsEntrySyllables:[235,66],lyricsEntryVerse:[234,79],lyricsExample:[506.5,80],lyricsAboveBelow:[595.5,112],textEntryInitial:[143,47],textEntry:[137,66],multiLineText:[141,86],stringArticulations:[537,68],dynamicsEntry:[99,62],dynamicsEntry2:[103,67],chordEntry:[96.5,57],chordEntry2:[96,53],NamedChordMatrix:[399,158],ScaleDegreeChordMatrix:[434,85],scaleDegreeMatrix:[154,52],FiguredBassMatrix:[386,91],placeholderChordSymbol:[157,86],annotation:[298,307],prompt:[554,162],promptEntry:[556,178],measureInsertBefore:[354,54],addMeasureAfter:[384,58],addMeasureBefore:[383,56],deleteMeasureResult:[259,44],pickupBefore:[372,197],pickupAfter:[316,189],multiRestBefore:[519,55],multiRestCollapsed:[518,53],multiRestExpanded:[520,104],splitSystem:[705,99],createSystemDone:[723,111],keepWithNextDone:[281,110],repeatEnding1:[130.5,94.5],repeatEnding2:[129,100],measureRepeat:[522,83],hairpinSelection:[329,94],hairpinCreation:[327,94],hairpinExample:[328,133],slur2Note:[154,63],slurPhrase:[292,81],slurExamples:[636,149],slurHandles:[558,104],trillAccidental:[309,88],twoVoices:[221,112],tabBend1:[186,106],tabBend2:[180,128],tabBend3:[255,94.5],tabBend4:[256,126],quarterBend:[184,130],preBend1:[250,95],preBend2:[263,87],preBend3:[248,126],tabSlide:[160,49],mixParts:[339.5,379.5],partVolume:[175,29],partPan:[172,29],mixMaster:[345,338.5],mixReverb:[344,245],stripLayout:[416.5,112],zoomSlider:[264.5,107],transposedParts:[233,233],tabWithRhythm:[518,119],tabWithoutRhythm:[496,99],tabMouseEntry:[227,86],tabChordEntry:[107,108],tabFretEntry1:[156,112],tabFretEntry2:[151,115],tabCopyingStaves:[145.5,88],tabStringChange:[409,112],tuningInstruments:[340,143],tuningList:[406,455],tuningNote:[408,456],tuningCapo:[406,454],measurePlayButton:[207,91],playbackModeNew:[523,105],loopedPlayback:[186.5,112.5],playbackSpeedAdjust:[241,105],gracePanel:[390,160],audioRecordingTools:[537,109],micVolumeGood:[470,222],micVolumeQuiet:[470.5,225],recordingStartPoint:[334,262],waveformDisplay:[25,25],recordingAudioTrack:[339,205],trackInfo:[25,25],trackRemove:[25,25],midiRecordingTools:[480,97.5],midiRecordingOptions:[286,247],syncAudioVideo:[722,101],syncCueStart:[164,130],syncMarkedSlider:[472,97],syncDragMark:[123,92],syncMediaMixerParts:[344,409],syncMediaMixerTracks:[344,206],formattingNavIcon:[209,60],formattingfromMenu:[304,140],formattingTop:[559,79],formattingFullScore:[184,82],formattingParts:[182,105],formattingEyeIcon1:[447.5,223],formattingEyeIcon2:[448,224],formattingResetDefaults:[186,48.5],formattingClose:[32,31],sharedGroups:[373,154],sharedIndividual:[319,279],activityScoreLink:[555,73],activityListRemove:[194,100],linking:[267,128],scoreInformation:[295,277],linesPaletteDynamics:[424,238],performanceDynamics:[420,238],hairpinGood:[432,74],hairpinBetter:[432,74],hairpinBest:[432,74],overlapOne:[432,90],overlapTwo:[432,100],grandstaffDynamics1:[290,133],importScore:[398,245],grandstaffDynamics2:[290,170],grandstaffDynamics3:[403,139],correctForm:[355,76],formattingOnePart:[182,198],wrongForm:[355,76],sharedEveryone:[499,148],onscreenKeyboard:[496,225],sectionPalettePopup:[322,372.5],exportScoreNew:[396,389],versionsRestore:[398,317],filterSelection:[246,449],transposeFinal:[433,428],timeSignatureCutCommonNew:[475,459],timeSignatureTypeNew:[475,460],timeSignatureVisibilityNew:[474,458],pickupDialogNew:[475,459],changeKeySignature:[601,352],createSystem:[836,167],keepWithNext:[841,170],editInstrument:[606,492],tabInstrumentChoice:[263,357],audioTiming:[469.5,192],socialSharingNew:[695,428],sharingEveryoneNew:[696,584],shareIndividualNew:[695,579],activityScoreList:[562,265],importMidi:[400,464],formattingPageSetup:[557,425],midiExportNew:[397,476],sharingGroupsNew:[697,517],shareIndividualAdd:[512,150],embeddingNew:[431,407],pageLayout:[417,533],flowLayout:[690.5,194],performLayout:[412,371.5],recordingWaveform:[648,256.5],scoreDetailsPanelNew:[292,682],importMusicXMLNew:[438,480],formattingGeneralFullScore:[558,413],formattingSizing:[557,589],formattingText:[558,641],formattingGeneralParts:[558,514],copyrightedArr:[699,656],helpSearch:[792,379.5],syncLoadedVideo:[1342,174],syncMediaScoreDetailsPanel:[301,554],scoreDetails:[297,1087]};e.sizeImages=function(){$("img[data-image-asset]").each(function(e,t){var o=a[t.getAttribute("data-image-asset")];o?(t.width=o[0],t.height=o[1]):t.onload=function(){var e=t.getAttribute("data-image-asset");if(!a[e]){var o=t.width,r=t.height;$(t.parentElement).hasClass("guideShot")&&(t.width=o/=2,t.height=r/=2),console.log(e+": ["+o+", "+r+"],"),a[e]=[o,r]}},t.setAttribute("src",NF.asset("images/help_roto/"+t.getAttribute("data-image-asset")+".png"))})},e.checkAllMenuItemsTested=function(){var e=NF.EditPaletteConfig.sections;$.each(e,function(e,t){$.each(t.controls,function(e,t){!t.userGuideGroup&&t.id&&0===$("#action-"+t.id).length&&console.log(t.id)})})};var s=null;e.highlightTopic=function(){if(e.topic()){var t=$("#toc-"+e.topic());t.get(0)&&(s&&(s.removeClass("highlighted"),s=null),(s=t).addClass("highlighted"))}},e.scrollTopicIntoView=function(){if(e.topic()){var o=$("#"+e.topic());if(o.get(0)){var r=o.position().top;t!=r&&($(".contentPanel").scrollTop(r),t=r)}}},e.scrollTocIntoView=function(){var t=$("#toc-"+e.topic());t.get(0)&&$(".helpNavPanel").scrollTop(t.position().top+$(".helpNavPanel").scrollTop())}},(0,n.addRoute)("help","/guide#",Noteflight.HelpViewModel,{}),(0,n.addRouteAlias)("r2","help","/info/help#"),(0,n.addRoute)("helpNew","/guide/new#",Noteflight.HelpViewModel,{edition:"new"}),(0,n.addRoute)("helpNewTopic","/guide/new#{topic}",Noteflight.HelpViewModel,{edition:"new"}),(0,n.addRoute)("helpTopic","/guide#{topic}",Noteflight.HelpViewModel,{}),(0,n.addRouteAlias)("r2","helpTopic","/info/help#{topic}",Noteflight.HelpViewModel,{})},function(e,t,o){e.exports=o.p+"images/scorePalette/instruments-0cec6790dfb9b82f784ef5fcacdf7191.svg"},function(e,t,o){e.exports=o.p+"images/scorePalette/scoreDetails-6044d957fbb3ed76848dcc9912a14c0c.svg"},function(e,t,o){e.exports=o.p+"images/scorePalette/keyboard-9a622b3c852659a660d400d08f529955.svg"},function(e,t,o){e.exports=o.p+"images/scorePalette/sectionMenuTrigger-1c7d249e79c38a97e9af0acc3be362ca.svg"},function(e,t,o){e.exports=o.p+"images/editorMenu/editInstrument-b2b5bc551df1751f6c9c30d79443cffe.svg"},function(e,t,o){e.exports=o.p+"images/editorMenu/deleteInstrument-3984a2f1a39dc4bbecd98d4066dbeeeb.svg"},function(e,t,o){e.exports=o.p+"images/editorMenu/tuneInstrument-002001f74f47012ab337e60736f2edb7.svg"},function(e,t,o){e.exports=o.p+"images/score_premium-7711faa35a26235bab018107d22808a4.png"},function(e,t,o){e.exports=o.p+"images/crescendoIcon-2e2160763e5a94721e24ef5c03802b95.png"},function(e,t,o){var r={"./FiguredBassMatrix.png":640,"./NamedChordMatrix.png":641,"./ScaleDegreeChordMatrix.png":642,"./activityListRemove.png":643,"./activityScoreLink.png":644,"./activityScoreList.png":645,"./activityStart.png":646,"./addInstrument.png":647,"./addMeasureAfter.png":648,"./addMeasureBefore.png":649,"./annotation.png":650,"./audioRecordingTools.png":651,"./audioTiming.png":652,"./changeClef.png":653,"./changeKeySignature.png":654,"./changeTimeSignature.png":655,"./chordEntry.png":656,"./chordEntry2.png":657,"./commonTime.png":658,"./copyrightedArr.png":659,"./correctForm.png":660,"./createSystem.png":661,"./createSystemDone.png":662,"./cutTime.png":663,"./deleteMeasure.png":664,"./deleteMeasureResult.png":665,"./documentLayout.png":666,"./documentLayoutFormatting.png":667,"./documentLayoutFormattingNew.png":668,"./documentLayoutParts.png":669,"./documentLayoutPartsNew.png":670,"./documentLayoutmusicalText.png":671,"./documentLayoutpageText.png":672,"./dottedEights.png":673,"./dragDropCopy.png":674,"./dragDropExample.png":675,"./dragDropScore.png":676,"./dragDropStaffH.png":677,"./dragDropStaffV.png":678,"./dupletAfterCreate.png":679,"./dupletBeforeCreate.png":680,"./durationChange.png":681,"./durationChangeNote.png":682,"./durationDrag.png":683,"./durationNote.png":684,"./durationPitchChange.png":685,"./durationRest.png":686,"./dynamicsEntry.png":687,"./dynamicsEntry2.png":688,"./editInstrument.png":689,"./editingPaletteUse.png":690,"./embedding.png":691,"./embeddingIcon.png":692,"./embeddingNew.png":693,"./exportScoreNew.png":694,"./favesAndComments.png":695,"./filterSelection.png":696,"./flowLayout.png":697,"./formattingClose.png":698,"./formattingEyeIcon1.png":699,"./formattingEyeIcon2.png":700,"./formattingFullScore.png":701,"./formattingGeneralFullScore.png":702,"./formattingGeneralParts.png":703,"./formattingNavIcon.png":704,"./formattingOnePart.png":705,"./formattingPageSetup.png":706,"./formattingParts.png":707,"./formattingResetDefaults.png":708,"./formattingSizing.png":709,"./formattingText.png":710,"./formattingTop.png":711,"./formattingfromMenu.png":712,"./generalText.png":713,"./graceAfterCreate.png":714,"./graceBeforeCreate.png":715,"./graceNoteGroup.png":716,"./graceNoteGroupComplete.png":717,"./gracePanel.png":718,"./grandstaffDynamics1.png":719,"./grandstaffDynamics2.png":720,"./grandstaffDynamics3.png":721,"./hairpinBest.png":722,"./hairpinBetter.png":723,"./hairpinCreation.png":724,"./hairpinExample.png":725,"./hairpinGood.png":726,"./hairpinSelection.png":727,"./hairpins.png":728,"./helpSearch.png":729,"./importMidi.png":730,"./importMusicXML.png":731,"./importMusicXMLNew.png":732,"./importScore.png":733,"./initialTempoMarking.png":734,"./insertMeasure.png":735,"./instruments.png":736,"./jazzFont.png":737,"./keepWithNext.png":738,"./keepWithNextDone.png":739,"./linesPaletteDynamics.png":740,"./linking.png":741,"./loopedPlayback.png":742,"./lyricsAboveBelow.png":743,"./lyricsEntry.png":744,"./lyricsEntrySyllables.png":745,"./lyricsEntryVerse.png":746,"./lyricsExample.png":747,"./measureInsertBefore.png":748,"./measurePlayButton.png":749,"./measureRepeat.png":750,"./measureSelection.png":751,"./micVolumeGood.png":752,"./micVolumeQuiet.png":753,"./midiExportNew.png":754,"./midiImport.png":755,"./midiRecordingOptions.png":756,"./midiRecordingTools.png":757,"./mixMaster.png":758,"./mixParts.png":759,"./mixReverb.png":760,"./mouseEntryComplete.png":761,"./mouseNoteEntry.png":762,"./multiLineText.png":763,"./multiRestBefore.png":764,"./multiRestCollapsed.png":765,"./multiRestExpanded.png":766,"./multipleSelection.png":767,"./multipleSelectionAccented.png":768,"./multistaffDynamics1.png":769,"./multistaffDynamics2.png":770,"./multistaffDynamics3.png":771,"./noteSelection.png":772,"./onscreenKeyboard.png":773,"./overlapOne.png":774,"./overlapTwo.png":775,"./pageLayout.png":776,"./pageSetupMargins.png":777,"./partMute.png":778,"./partPan.png":779,"./partSolo.png":780,"./partVolume.png":781,"./performLayout.png":782,"./performanceDynamics.png":783,"./pickupAfter.png":784,"./pickupBefore.png":785,"./pickupDialog.png":786,"./pickupDialogNew.png":787,"./pitchChange.png":788,"./placeholderChordSymbol.png":789,"./playbackMode.png":790,"./playbackModeNew.png":791,"./playbackSpeedAdjust.png":792,"./preBend1.png":793,"./preBend2.png":794,"./preBend3.png":795,"./prompt.png":796,"./promptEntry.png":797,"./quarterBend.png":798,"./rangeSelection.png":799,"./rangeTempoMarking.png":800,"./record.png":801,"./recordingAudioTrack.png":802,"./recordingStartPoint.png":803,"./recordingWaveform.png":804,"./repeatEnding.png":805,"./repeatEnding1.png":806,"./repeatEnding2.png":807,"./repeatEndingPrompt.png":808,"./resetToDefaultsClose.png":809,"./scaleDegreeMatrix.png":810,"./scoreDetails.png":811,"./scoreDetailsPanel.png":812,"./scoreDetailsPanelNew.png":813,"./scoreInformation.png":814,"./scoreSelection.png":815,"./scoreSelection2.png":816,"./scoreSettings.png":817,"./scoreSettingsNew.png":818,"./sectionPalettePinned.png":819,"./sectionPalettePopup.png":820,"./selectMeasure.png":821,"./shareIndividualAdd.png":822,"./shareIndividualAddNew.png":823,"./shareIndividualAutocomplete.png":824,"./shareIndividualNew.png":825,"./shareIndividualStart.png":826,"./shareTabHTML.png":827,"./sharedEveryone.png":828,"./sharedGroups.png":829,"./sharedIndividual.png":830,"./sharingEveryone.png":831,"./sharingEveryoneNew.png":832,"./sharingEveryonePowers.png":833,"./sharingEveryoneSettings.png":834,"./sharingGroups.png":835,"./sharingGroupsNew.png":836,"./sharingIcon.png":837,"./sharingPrivate.png":838,"./slur2Note.png":839,"./slur2NoteSelection.png":840,"./slurExamples.png":841,"./slurHandles.png":842,"./slurPhrase.png":843,"./socialSharing.png":844,"./socialSharingNew.png":845,"./splitSystem.png":846,"./staffSelection.png":847,"./straightEights.png":848,"./stringArticulations.png":849,"./stripLayout.png":850,"./swing8th16thInitial.png":851,"./swingEighths.png":852,"./swingEighthsInitial.png":853,"./swingSixteenths.png":854,"./syncAudioVideo.png":855,"./syncCueStart.png":856,"./syncDragMark.png":857,"./syncLoadedVideo.png":858,"./syncMarkedSlider.png":859,"./syncMediaMixer.png":860,"./syncMediaMixerParts.png":861,"./syncMediaMixerTracks.png":862,"./syncMediaScoreDetailsPanel.png":863,"./syncUnloadedPanel.png":864,"./tabBend1.png":865,"./tabBend2.png":866,"./tabBend3.png":867,"./tabBend4.png":868,"./tabChordEntry.png":869,"./tabCopyingStaves.png":870,"./tabFretEntry1.png":871,"./tabFretEntry2.png":872,"./tabInstrumentChoice.png":873,"./tabMouseEntry.png":874,"./tabSlide.png":875,"./tabStringChange.png":876,"./tabWithRhythm.png":877,"./tabWithoutRhythm.png":878,"./tempoBeatUnit.png":879,"./tempoControl.png":880,"./tempoValue.png":881,"./textEntry.png":882,"./textEntryInitial.png":883,"./timeSignatureCutCommon.png":884,"./timeSignatureCutCommonNew.png":885,"./timeSignatureType.png":886,"./timeSignatureTypeNew.png":887,"./timeSignatureVisibility.png":888,"./timeSignatureVisibilityNew.png":889,"./toolbarPlayButton.png":890,"./toolbarTempo.png":891,"./trackInfo.png":892,"./trackRemove.png":893,"./transposeButton.png":894,"./transposeFinal.png":895,"./transposeInitial.png":896,"./transposedParts.png":897,"./trillAccidental.png":898,"./tripletEights.png":899,"./tuningCapo.png":900,"./tuningInstruments.png":901,"./tuningList.png":902,"./tuningNote.png":903,"./tupletAfterCreate.png":904,"./tupletBeforeCreate.png":905,"./twoVoices.png":906,"./versions.png":907,"./versionsRestore.png":908,"./volumeButton.png":909,"./waveformDisplay.png":910,"./wrongForm.png":911,"./zoomSlider.png":912};function n(e){var t=i(e);return o(t)}function i(e){var t=r[e];if(!(t+1)){var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return t}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=639},function(e,t,o){e.exports=o.p+"images/help_roto/FiguredBassMatrix-8c36d0fa140a1e6935117a6e3a73462e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/NamedChordMatrix-b5570ee09bf001da27a1911d8b154698.png"},function(e,t,o){e.exports=o.p+"images/help_roto/ScaleDegreeChordMatrix-cf5fab46f80b142333c20e448ce35aed.png"},function(e,t,o){e.exports=o.p+"images/help_roto/activityListRemove-c9a5cf3b51d75fc0c9a0224a86d65c3b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/activityScoreLink-6f63fa2c7679caa952ccab74211099b7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/activityScoreList-0ff9f08f31ebf69e1902be53d9b49c3a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/activityStart-17e9849a2cab03ed3fdbe8fbff3c5da0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/addInstrument-cf96af3d6bd95810e07ad99e489bc5ec.png"},function(e,t,o){e.exports=o.p+"images/help_roto/addMeasureAfter-e2ea12e876f545960e5bf9f9f30f609e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/addMeasureBefore-7b1454f6f32d4dc3a82aa4947510d164.png"},function(e,t,o){e.exports=o.p+"images/help_roto/annotation-cb23fd90e003a25381fecd7741145ef4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/audioRecordingTools-daf6a52998166cf680a78c78be59b9eb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/audioTiming-100622b06d0528c4b4a09712b1b26688.png"},function(e,t,o){e.exports=o.p+"images/help_roto/changeClef-37cf927abaea3727da09c343ca0c298f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/changeKeySignature-2de610fa9f8a060e18e2913dfb1634d2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/changeTimeSignature-a7f520d052510240c3af253e63d163de.png"},function(e,t,o){e.exports=o.p+"images/help_roto/chordEntry-3edcbefbc32051f488885d226b38079c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/chordEntry2-7f5bf8709b6d24bf08bf7481a784664a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/commonTime-3df1979b7dcc310792260b2f5f8e43d9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/copyrightedArr-3ebe356ef652da44f040c15d1dd9244d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/correctForm-e4532a6928a9344611878cd70decfbd2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/createSystem-210a5916748ef0964c25e643e34e5555.png"},function(e,t,o){e.exports=o.p+"images/help_roto/createSystemDone-ec978b3f33fdd5e5eb9f42ba5f197f49.png"},function(e,t,o){e.exports=o.p+"images/help_roto/cutTime-689c905e10d3d4a4c0a009bdfcdfc847.png"},function(e,t,o){e.exports=o.p+"images/help_roto/deleteMeasure-c21f6cacfa4b10e575d1a5ef9265fe79.png"},function(e,t,o){e.exports=o.p+"images/help_roto/deleteMeasureResult-b48db878f29b8d0d540adbdd5d91889e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayout-ed486437237ef6b7504fc2eb264caa8c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutFormatting-faf07d72c0e02b31118b5ec83c1fd030.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutFormattingNew-a1c239db4aa7a3cbf5c28bcdcbb738b7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutParts-e180a323fd048a269f8fd213372c7aa7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutPartsNew-bc552ddfeaa68c757d1677a23c8d8f87.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutmusicalText-f49f45e269312ac129b506dbd82e877d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/documentLayoutpageText-767c3fa02f7c836220955e45d4ea4541.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dottedEights-9270fcbe0da95961088245bd4ffb82c3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dragDropCopy-9d47b8b46cc691db6f99bde337d09118.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dragDropExample-bf1f94d18fe519a96e62b3ad38f69785.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dragDropScore-b779a7d147056e48b58f77ece1535a66.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dragDropStaffH-932c344b50327bd103f0053ab7f5074e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dragDropStaffV-ad42d8a532fc517452647a513b2ddacb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dupletAfterCreate-b657d2fb0b0acae164b36aac9a825ff8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dupletBeforeCreate-a4f120c98d2c5f8a82dd7ddaa86cc427.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationChange-94c95171d676d1612ba90b156047c53e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationChangeNote-42d4d810d56ffe61d2ceff7a1911834f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationDrag-c4bedb74f7ef064b04b1252253e245ed.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationNote-b88a818ae44edff91da1c70c93c76785.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationPitchChange-59825fb4a3520e154c19caceb656d3fb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/durationRest-cc2938861b17e8480c699442c85ab1b3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dynamicsEntry-9bc62f987b582e74a0c9c11084b0410c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/dynamicsEntry2-1ec2456cb17eefc79d497f4f0f1163f0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/editInstrument-f7935b7873ed3da2541066b6c2b7e4bf.png"},function(e,t,o){e.exports=o.p+"images/help_roto/editingPaletteUse-f9996330bd9adfea2182a3170e755f92.png"},function(e,t,o){e.exports=o.p+"images/help_roto/embedding-2e740dea412b55c1717a70e1b3077571.png"},function(e,t,o){e.exports=o.p+"images/help_roto/embeddingIcon-c4a16caccfd41871df0ccfc7e2b6d2df.png"},function(e,t,o){e.exports=o.p+"images/help_roto/embeddingNew-918f62827bfb3303087dfdc0638cdcb4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/exportScoreNew-3959df45fe7c1c246588af585f256550.png"},function(e,t,o){e.exports=o.p+"images/help_roto/favesAndComments-55aef9997b6e015554f11710d11477f2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/filterSelection-ae7e1c6f5873b2d9036f75da1a684a91.png"},function(e,t,o){e.exports=o.p+"images/help_roto/flowLayout-db2f8f0af135b1840239f66f7589beff.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingClose-a62bd2c730707c3a4a267d3f06e3f0f0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingEyeIcon1-5a53c97bf757500bc192091f22286cf2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingEyeIcon2-68675dc217e4a23804bd44b549af2132.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingFullScore-7c02f51c64e27d5a5c2e5a8856914b77.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingGeneralFullScore-785400c8f3c24891b456f2a7a6b0fa8f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingGeneralParts-8b6ccff204d8e9a0d5b4c5188839d0f0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingNavIcon-1ccdc4806e8d1d3645ef8d58f0c75102.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingOnePart-4a2a0aca20ad37b1ffd9062f38e12bb2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingPageSetup-81da23b73bc14597ce23d9ce7ebd66f2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingParts-2b48c6a6cf3587e7eda829764842d2db.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingResetDefaults-44fd8efc492a7604cdcf8423963676b9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingSizing-73f5db7092390eadd08c58228ab33d63.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingText-7a17e49b93b57f3cda67ce8e7287c0bf.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingTop-6dc4b2bfb4f88cc9b89678f5f3d92462.png"},function(e,t,o){e.exports=o.p+"images/help_roto/formattingfromMenu-75eb8032e2e86ed50d7a7000195682de.png"},function(e,t,o){e.exports=o.p+"images/help_roto/generalText-c6cd22cdcc8d08d153b454781bc89ed7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/graceAfterCreate-ffb5eda96e4db2428a13063db480bd0e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/graceBeforeCreate-65ba3b00fd086bbbcfb8808e5378acca.png"},function(e,t,o){e.exports=o.p+"images/help_roto/graceNoteGroup-e1650a023d2cb64727a95bbd91866cd4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/graceNoteGroupComplete-e386ff501744e391274626824fd034e1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/gracePanel-eadec6391cf42fe57c1319614d00447f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/grandstaffDynamics1-c6e1f33d7ad4203d2e0ce5d042bc9175.png"},function(e,t,o){e.exports=o.p+"images/help_roto/grandstaffDynamics2-108c30631fdbc1f6eb42fea8799d1a20.png"},function(e,t,o){e.exports=o.p+"images/help_roto/grandstaffDynamics3-56b8e3d791c0dbf77e284a30bcd315ff.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinBest-e2ac82def2302f6c2a75b65ddb27f4c6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinBetter-15e409ae564c28ebea078a1449d783ff.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinCreation-55fd58bd52e62036f6af6b685ec37c27.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinExample-95cf9ab773c8aac2d042f0798b1735a1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinGood-f927f0cb8222e1e08d0f3dced9c38e91.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpinSelection-71cc44c38ddc9cb354dd6c3a4f6d3ae5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/hairpins-9b8ba75875b973d749446aae82c18a3a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/helpSearch-7934bd0004eefc1743f12c2aade0e897.png"},function(e,t,o){e.exports=o.p+"images/help_roto/importMidi-ecd96453f8b6bfb98632008a40a5cf57.png"},function(e,t,o){e.exports=o.p+"images/help_roto/importMusicXML-51702dd193f861d575b784e0af7366a9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/importMusicXMLNew-dda24bc668e1c571a50ce2852301ecc4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/importScore-b201c328745a72894f3aa0dca619ca59.png"},function(e,t,o){e.exports=o.p+"images/help_roto/initialTempoMarking-48a45506608e8e000bcadc350007a88a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/insertMeasure-6d71c9f37f821c051382c93a2cbfd17b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/instruments-992fd0f3928afc0efc5e57f3128c18b3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/jazzFont-d68d4b4837b2fcf5eb8541a751b02ee2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/keepWithNext-fb60e4282d6dcb89fd3e8c900ef8b841.png"},function(e,t,o){e.exports=o.p+"images/help_roto/keepWithNextDone-2154b1360712c34807c01b5e9171c489.png"},function(e,t,o){e.exports=o.p+"images/help_roto/linesPaletteDynamics-545a4964011c78297ee0d3470202d191.png"},function(e,t,o){e.exports=o.p+"images/help_roto/linking-ce5163b28b30067c77536af8abb2bae1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/loopedPlayback-08220417ac8fdec914f09639e5fb23a8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/lyricsAboveBelow-00d6037e06274abe37023029965cf0d9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/lyricsEntry-410e998f3d1ee2075565d8c9e0351d35.png"},function(e,t,o){e.exports=o.p+"images/help_roto/lyricsEntrySyllables-5ead34947f39a24ecdce7f572dad97e7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/lyricsEntryVerse-d794abca90705379db3c22da135bde40.png"},function(e,t,o){e.exports=o.p+"images/help_roto/lyricsExample-a409eafe056620d0223d39b47f35e591.png"},function(e,t,o){e.exports=o.p+"images/help_roto/measureInsertBefore-48081306a4e5482274af104ec38939f1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/measurePlayButton-32a88207d5d6ad539679d34d7cc82501.png"},function(e,t,o){e.exports=o.p+"images/help_roto/measureRepeat-954a71277da5b4b61151829cd2622baf.png"},function(e,t,o){e.exports=o.p+"images/help_roto/measureSelection-0d0e1be44c8da8bc095217a9d2280bb9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/micVolumeGood-a55453007c3f90cbc0798eec8e5f3230.png"},function(e,t,o){e.exports=o.p+"images/help_roto/micVolumeQuiet-56fc5442d0c0cc30d89eec5e80107e91.png"},function(e,t,o){e.exports=o.p+"images/help_roto/midiExportNew-ac94339399e5593b7d26c6d85b1f3b1f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/midiImport-cad98b74d4ed55f442ba271ea04aa4b6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/midiRecordingOptions-919a3117766f17a75061abb17b9b6bd8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/midiRecordingTools-e546adb6a8e8c2a86f30b559e8f6b21c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/mixMaster-a8b63ac0d7564d6d64177c37a8b2c14f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/mixParts-ad71d8921fb23a1a00c1f9be9ac7d0af.png"},function(e,t,o){e.exports=o.p+"images/help_roto/mixReverb-7d9250221b5a7d80147198dac1f3f76b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/mouseEntryComplete-e43ddc46d9cbf40804631c32789eaaaf.png"},function(e,t,o){e.exports=o.p+"images/help_roto/mouseNoteEntry-428cf89eecfabc6fc9aa9946f326d5c7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multiLineText-32922ce41315452db1532ff7e6487228.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multiRestBefore-065630cb67333a0eb18a83431adee5ba.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multiRestCollapsed-0d3f07caea8a21498d003dbcac222089.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multiRestExpanded-cbae91236ad0e2a22c90f5bbc162f759.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multipleSelection-3872837ea342199bd62cbe4528c6b698.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multipleSelectionAccented-780afc48e38b350ab01bd914f770ce5d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multistaffDynamics1-c6e1f33d7ad4203d2e0ce5d042bc9175.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multistaffDynamics2-108c30631fdbc1f6eb42fea8799d1a20.png"},function(e,t,o){e.exports=o.p+"images/help_roto/multistaffDynamics3-56b8e3d791c0dbf77e284a30bcd315ff.png"},function(e,t,o){e.exports=o.p+"images/help_roto/noteSelection-24ee0bbe7d8c66c737b339174e40f724.png"},function(e,t,o){e.exports=o.p+"images/help_roto/onscreenKeyboard-b5869c852536bd2c83ed1b03afd65264.png"},function(e,t,o){e.exports=o.p+"images/help_roto/overlapOne-a685ad5c22c54f44dceb4329f6d2e434.png"},function(e,t,o){e.exports=o.p+"images/help_roto/overlapTwo-8a31eba775e095db39336552637f1938.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pageLayout-6986e4ebd6c61ad4b290689dc3e64aa6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pageSetupMargins-d4cc3a60f3c97c13d556a436c639a542.png"},function(e,t,o){e.exports=o.p+"images/help_roto/partMute-d7c9fb656dd7a03cb11a5862f0ebf0fd.png"},function(e,t,o){e.exports=o.p+"images/help_roto/partPan-46b49d88a9f8ee4586decbb07595b5f8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/partSolo-dcca9c32b2bfae9fe66d79df1384ec29.png"},function(e,t,o){e.exports=o.p+"images/help_roto/partVolume-5d9acf7a0c4e18826913696c39d52b57.png"},function(e,t,o){e.exports=o.p+"images/help_roto/performLayout-6bd19c4d9475e4fa1234d77d74edadbb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/performanceDynamics-7198bed0a1c1c065feeefb5a90ade82d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pickupAfter-31211dcfeee20c511009535d0da5b20c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pickupBefore-663a055d92c3a55bb46a858fa9b23d71.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pickupDialog-85b3e1d2b5c6066fb6d3e483853a02c6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pickupDialogNew-5addbce3df5096c5e501ece25b4e29f0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/pitchChange-fb37bc46da3da5330fbbbc9c0ecc9884.png"},function(e,t,o){e.exports=o.p+"images/help_roto/placeholderChordSymbol-474b232aeeb08fdff538dcdee9ca79b9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/playbackMode-68163a07509af7e75394f5e824efdddc.png"},function(e,t,o){e.exports=o.p+"images/help_roto/playbackModeNew-0198ad79a16a4f7581ef46ec1dcebace.png"},function(e,t,o){e.exports=o.p+"images/help_roto/playbackSpeedAdjust-dda3eeb2d375d53addc343146d808c7a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/preBend1-4c1694070aa2df4ae048dccc3239e637.png"},function(e,t,o){e.exports=o.p+"images/help_roto/preBend2-dc6c612a130c7bfd13570c97aa6a3f49.png"},function(e,t,o){e.exports=o.p+"images/help_roto/preBend3-01ca7052b255c763f6c46dbc98d253ba.png"},function(e,t,o){e.exports=o.p+"images/help_roto/prompt-304f0192cb9a12d747b16c11fc3eaa08.png"},function(e,t,o){e.exports=o.p+"images/help_roto/promptEntry-e30899510098ba748be60f4e47c13011.png"},function(e,t,o){e.exports=o.p+"images/help_roto/quarterBend-2aacb1368509d80dabd0412ee0a303b3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/rangeSelection-7e99033415767d7593b53235674537ae.png"},function(e,t,o){e.exports=o.p+"images/help_roto/rangeTempoMarking-849cc1a64cfe19c0c97c06cd0ad4ef4a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/record-e065bcf7556156cf4f28f6ef32197eee.png"},function(e,t,o){e.exports=o.p+"images/help_roto/recordingAudioTrack-431f3f20539327fac8fc130db0786b63.png"},function(e,t,o){e.exports=o.p+"images/help_roto/recordingStartPoint-9d31fca9c9464e0008887edf8289c2b4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/recordingWaveform-d357003e61c420a53e0d4336a8004819.png"},function(e,t,o){e.exports=o.p+"images/help_roto/repeatEnding-539e6317d3b32c4c6f6d939b2ea88ab5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/repeatEnding1-e7949d646d53277c63ebaceae98269c8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/repeatEnding2-b5d08da61201bd6cc8f384e31680238c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/repeatEndingPrompt-9affc8a6b19c367e1f38462ea942e874.png"},function(e,t,o){e.exports=o.p+"images/help_roto/resetToDefaultsClose-9050747f8250958fbf16e6e3f2e5c250.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scaleDegreeMatrix-13f58ce6b9af0aac1210703b3d292d35.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreDetails-55aef9997b6e015554f11710d11477f2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreDetailsPanel-75bb3068e401b66fe1d2b24799483f40.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreDetailsPanelNew-1705cf6e95dd54f00e1627ae52660b5f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreInformation-c185de2e4bfda382063253494554c8c5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreSelection-0fabdaf7d2894ce65f92b2f8e330edca.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreSelection2-3efda894aaf2b60033a1000390ac7f93.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreSettings-03d25d764c04d57da136a06522b9ac1d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/scoreSettingsNew-ff108d9423557bf22e8444e0f9bf850f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sectionPalettePinned-b0674c9650d9e83b4d450e52b33ce5db.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sectionPalettePopup-b45cb77551cb57f307cdf535370ae0eb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/selectMeasure-b69e42fd0d30788233d20a34b2b3c4ea.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareIndividualAdd-df5da355b18919da15e947ae958058e3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareIndividualAddNew-c7f44f031abe74cca08c615a28b298db.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareIndividualAutocomplete-d9dd71e4de5426d119ef329497c90559.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareIndividualNew-cbdc5b19fe2f900afc786f50dca7481c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareIndividualStart-162c2a8815221306327363f935ff4967.png"},function(e,t,o){e.exports=o.p+"images/help_roto/shareTabHTML-f01e170abbf43ac984a4cce3e43d00eb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharedEveryone-dba92fbadc88ddad5c61d28859788b47.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharedGroups-2ef9d8f2bfba099c9bab5c696dfe2ecd.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharedIndividual-45418a11e1b2f530f7964f60519d3fe1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingEveryone-1a96f4e2734fa49ba3f685db0e534f62.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingEveryoneNew-08b130f6c1aee8187b637414ec0cbc04.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingEveryonePowers-db564143f8bc1a7df1460d8d316286f9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingEveryoneSettings-650091c13602b6261e0357147c7f540a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingGroups-d052968a124a27cf7994cd4d99a0d1ca.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingGroupsNew-be52a0229d48a59cdf71617d9336f13a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingIcon-c0197a5663722be4f4779b9883857567.png"},function(e,t,o){e.exports=o.p+"images/help_roto/sharingPrivate-9883309566ddfb55534e6f99b4de041a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/slur2Note-1b93b328ed25d7e72ac73e9ed539df30.png"},function(e,t,o){e.exports=o.p+"images/help_roto/slur2NoteSelection-5c7157880d2ba7f23a83c95c8fa267d6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/slurExamples-3f35c09f3a39f041988f4f06ffb20f76.png"},function(e,t,o){e.exports=o.p+"images/help_roto/slurHandles-e426a9ac166f6b9a4b3283242e230174.png"},function(e,t,o){e.exports=o.p+"images/help_roto/slurPhrase-d6a044e8bdeeb0a6e7ae98ffad9ee028.png"},function(e,t,o){e.exports=o.p+"images/help_roto/socialSharing-2df9ba12d306464b63c7ac493065fc69.png"},function(e,t,o){e.exports=o.p+"images/help_roto/socialSharingNew-9c25980980f6fe39bfc1fa01d7e92563.png"},function(e,t,o){e.exports=o.p+"images/help_roto/splitSystem-0966d294ec6251b644ff28dcb632eec9.png"},function(e,t,o){e.exports=o.p+"images/help_roto/staffSelection-ed07e30b7b0c9e5d6a1a4853a9440cbf.png"},function(e,t,o){e.exports=o.p+"images/help_roto/straightEights-5043dde5e4cc7c3fbfab91e3db5beb0f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/stringArticulations-36db5f2f9fb354b91e8b3079fdce395c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/stripLayout-360389f193b15126e637543f58d9c6b8.png"},function(e,t,o){e.exports=o.p+"images/help_roto/swing8th16thInitial-9800c5eae5bf0f8a95480511b682e067.png"},function(e,t,o){e.exports=o.p+"images/help_roto/swingEighths-a1c5380cf478423c78f725fa50b95a2b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/swingEighthsInitial-823a44cc53b2c5b5c1425cbf16966a5f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/swingSixteenths-b9f5d26237aeb21a5f654a868f481061.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncAudioVideo-5fb83b8d245e126aadb2c2be69dd03d1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncCueStart-0957fa0667496d38a641e0067dc443d1.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncDragMark-76b930ac7759dd445b584f80b9f9e8c5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncLoadedVideo-e26a9b5933aa75ff5ac7293efb96cf72.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncMarkedSlider-ca08da982fda58e8c9596c7c4b65e0e3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncMediaMixer-9f98a752819c71c66f60bcaa335e06ae.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncMediaMixerParts-2581e134ba3a3436cea37b50c7480a81.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncMediaMixerTracks-8ebdbb77588c013be8ad7c62db4ab055.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncMediaScoreDetailsPanel-d8e4cdcb0506cda5d676107d11ea0957.png"},function(e,t,o){e.exports=o.p+"images/help_roto/syncUnloadedPanel-3302af56742ad4412034b07118970771.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabBend1-48a3f3cc91804611cba09d737c67ad9c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabBend2-a56f8dab8f1b51c8bada18bc1fd4190e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabBend3-4bb097be8b06b545af8655aec7ae8276.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabBend4-d243afedfbc8c52a739cedd9cd16e9a2.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabChordEntry-e3e42ba0ffdcfef8336c0fb222b31266.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabCopyingStaves-27993b417a903ce77e5d58a36259d385.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabFretEntry1-8cfdf784838264ac35385f7ca9c1bf27.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabFretEntry2-b28fce99bc46defd60d8a411e1b9819e.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabInstrumentChoice-9a54114b43d89b18f3b98d8e269faba7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabMouseEntry-fd08e789297ce2f4f32600454e5450a7.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabSlide-cd5f5b5bc2b0ea8cadc0523f7bcbd447.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabStringChange-28ca1df963ede6451098c9cf071a6764.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabWithRhythm-47717b6bf938e83cd9d07f09583219b5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tabWithoutRhythm-55618a0f960c3e4175b7fa7035b7da49.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tempoBeatUnit-f3eaa5f36b14d58d48b35678769349b4.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tempoControl-49e6ba366200b43c4ebaaf35984908e6.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tempoValue-aad1152c0a09cb8d0e52dde670075685.png"},function(e,t,o){e.exports=o.p+"images/help_roto/textEntry-78b8f6a72fa7d9f35f2cfb301ea03340.png"},function(e,t,o){e.exports=o.p+"images/help_roto/textEntryInitial-d07bd0058deb3fd8977e4eed0a3bfb67.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureCutCommon-0ce108148789d024f80125dd0516f2f0.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureCutCommonNew-a110de88f0e7464e23c9ed737bfe4136.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureType-c94e5b2dbe9e6654adc270450a564083.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureTypeNew-92abd085202b3681851b4f27375dac80.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureVisibility-cad0dd294f170f0602020e80c3c27df3.png"},function(e,t,o){e.exports=o.p+"images/help_roto/timeSignatureVisibilityNew-a292946034416c48962d1edd68877b0d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/toolbarPlayButton-7e236450edd5c9c920625f85413fe32f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/toolbarTempo-9f4dde147e75894716b2062dbde60151.png"},function(e,t,o){e.exports=o.p+"images/help_roto/trackInfo-03cfbdf21eb5241ddefce1bbb22e6890.png"},function(e,t,o){e.exports=o.p+"images/help_roto/trackRemove-dbb9346badc6463119deb7452d3c1b1f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/transposeButton-15d420c46e71a9e72f60c15bfc04475b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/transposeFinal-8129348e8db0566953e9d12662ac4430.png"},function(e,t,o){e.exports=o.p+"images/help_roto/transposeInitial-e51b1a3708d2760c3ad7befdb50f693a.png"},function(e,t,o){e.exports=o.p+"images/help_roto/transposedParts-9b2e28ec654e041f478e4569698154bb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/trillAccidental-d14c1b7a26ee788613aa979a1d3b4746.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tripletEights-4a4e13c21041e7586c3a7ba8e335a12d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tuningCapo-2e3cbcdccac97c2fb7c989a73eaa2f0f.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tuningInstruments-d2b8bcda671c06c3197a7d3642e1a7cb.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tuningList-271ea3d3dcfce01354c837d9e029b194.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tuningNote-c6110cdc76f1eed5fc3974542bda4696.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tupletAfterCreate-a250d4c9040cc2632fb21c29eeb65056.png"},function(e,t,o){e.exports=o.p+"images/help_roto/tupletBeforeCreate-daf0cb7bb731049c06837e7bb1e5740c.png"},function(e,t,o){e.exports=o.p+"images/help_roto/twoVoices-80b147664acf45ad5cf5fdc2444a297d.png"},function(e,t,o){e.exports=o.p+"images/help_roto/versions-b090dc81c32f5c40c2cc3e9938cfa2d5.png"},function(e,t,o){e.exports=o.p+"images/help_roto/versionsRestore-eadd41321e2df87b5972cd7ec2bfaa7b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/volumeButton-4a09ef6059e3c7e79b1b0c64b5676daa.png"},function(e,t,o){e.exports=o.p+"images/help_roto/waveformDisplay-14c3fd88ebe87430d5433048b85ef49b.png"},function(e,t,o){e.exports=o.p+"images/help_roto/wrongForm-3ad8a6438c41a67649254d131e155378.png"},function(e,t,o){e.exports=o.p+"images/help_roto/zoomSlider-3bfa1bbcf6f5398695125a25c9e9ba1b.png"},function(e,t,o){var r={"./8valines.png":914,"./FiguredBassMatrix.png":915,"./LRLine.png":916,"./NamedChordMatrix.png":917,"./ScaleDegreeChordMatrix.png":918,"./accidentals.png":919,"./activityStart.png":920,"./addInstrument.png":921,"./arpeggio.png":922,"./articulations.png":923,"./barlineBreaks.png":924,"./barlineStyles.png":925,"./beaming.png":926,"./bend.png":927,"./brackets.png":928,"./breath.png":929,"./caesura.png":930,"./changeClef.png":931,"./changeKeySignature.png":932,"./changeTimeSignature.png":933,"./chordEntry.png":934,"./chordEntry2.png":935,"./chordSymbol.png":936,"./coda.png":937,"./colorPalette.png":938,"./colors.png":939,"./commonTime.png":940,"./correctForm.png":941,"./cue.png":942,"./cutTime.png":943,"./delete.png":944,"./deleteMeasure.png":945,"./directions.png":946,"./disableCautionaries.png":947,"./documentLayout.png":948,"./documentLayoutFormatting.png":949,"./documentLayoutParts.png":950,"./dottedEights.png":951,"./doubleAccidentals.png":952,"./doubleDot.png":953,"./doubleNoteTremolos.png":954,"./downUp.png":955,"./dragDropCopy.png":956,"./dragDropExample.png":957,"./dragDropScore.png":958,"./dragDropStaffH.png":959,"./dragDropStaffV.png":960,"./durationDrag.png":961,"./durations.png":962,"./dynamics.png":963,"./dynamicsEntry.png":964,"./dynamicsEntry2.png":965,"./editingPaletteUse.png":966,"./embedding.png":967,"./embeddingIcon.png":968,"./favesAndComments.png":969,"./generalText.png":970,"./glissando.png":971,"./graceAfterCreate.png":972,"./graceBeforeCreate.png":973,"./graceIcons.png":974,"./graceNoteGroup.png":975,"./graceNoteGroupComplete.png":976,"./grandstaffDynamics1.png":977,"./grandstaffDynamics2.png":978,"./grandstaffDynamics3.png":979,"./guitarTabPalette.png":980,"./hairpinBest.png":981,"./hairpinBetter.png":982,"./hairpinCreation.png":983,"./hairpinExample.png":984,"./hairpinGood.png":985,"./hairpinSelection.png":986,"./hairpins.png":987,"./hammerPull.png":988,"./hide.png":989,"./incomingTie.png":990,"./individualParts.png":991,"./individualPartsButton.png":992,"./initialTempoMarking.png":993,"./insertMeasure.png":994,"./insertPart.png":995,"./jazzFont.png":996,"./lines.png":997,"./linesPaletteDynamics.png":998,"./lyrics.png":999,"./lyricsEntry.png":1e3,"./lyricsExample.png":1001,"./measurePlayButton.png":1002,"./measureSelection.png":1003,"./midiExport.png":1004,"./midiImport.png":1005,"./midiRecordingTools.png":1006,"./mixParts.png":1007,"./mixerButton.png":1008,"./mordents.png":1009,"./mouseNoteEntry.png":1010,"./multiLineText.png":1011,"./multiRestBefore.png":1012,"./multiRestCollapsed.png":1013,"./multiRestExpanded.png":1014,"./multipleSelection.png":1015,"./multipleSelectionSharped.png":1016,"./multirestIcon.png":1017,"./multistaffDynamics1.png":1018,"./multistaffDynamics2.png":1019,"./multistaffDynamics3.png":1020,"./noteHeadsPalette.png":1021,"./noteSelection.png":1022,"./noteheads.png":1023,"./objectPalette.png":1024,"./overlapOne.png":1025,"./overlapTwo.png":1026,"./pageLayout.png":1027,"./palmMute.png":1028,"./partMute.png":1029,"./partPan.png":1030,"./partSolo.png":1031,"./partVolume.png":1032,"./pedalLines.png":1033,"./performanceDynamics.png":1034,"./pickupAfter.png":1035,"./pickupBefore.png":1036,"./pickupDialog.png":1037,"./pitchRhythmPalette.png":1038,"./placeholderChordSymbol.png":1039,"./plainLines.png":1040,"./playbackSpeedAdjust.png":1041,"./quarterAlteration.png":1042,"./rangeSelection.png":1043,"./rangeTempoMarking.png":1044,"./record.png":1045,"./repeatEnding.png":1046,"./repeatEndingIcon.png":1047,"./repeats.png":1048,"./scaleDegreeMatrix.png":1049,"./scoreInformation.png":1050,"./scoreSelection.png":1051,"./scoreSelection2.png":1052,"./segno.png":1053,"./selectedBarline.png":1054,"./shareIndividualAdd.png":1055,"./shareIndividualStart.png":1056,"./shareTabFlash.png":1057,"./shareTabHTML.png":1058,"./sharingEveryone.png":1059,"./sharingEveryonePowers.png":1060,"./sharingEveryoneSettings.png":1061,"./sharingIcon.png":1062,"./sharingPrivate.png":1063,"./singleNoteTremolo.png":1064,"./slash.png":1065,"./slide.png":1066,"./slur2Note.png":1067,"./slur2NoteSelection.png":1068,"./slurExamples.png":1069,"./slurHandles.png":1070,"./slurPhrase.png":1071,"./slurs.png":1072,"./socialSharing.png":1073,"./staffSelection.png":1074,"./stems.png":1075,"./straightEights.png":1076,"./stringArticulations.png":1077,"./stripLayout.png":1078,"./swingEighths.png":1079,"./symbolsPalette.png":1080,"./syncAudioVideo.png":1081,"./syncLoadedVideo.png":1082,"./syncMarkedSlider.png":1083,"./syncUnloadedPanel.png":1084,"./systemText.png":1085,"./tabBend1.png":1086,"./tabBend2.png":1087,"./tabBend3.png":1088,"./tabBend4.png":1089,"./tabChordEntry.png":1090,"./tabCopyingStaves.png":1091,"./tabFretEntry1.png":1092,"./tabFretEntry2.png":1093,"./tabInstrumentChoice.png":1094,"./tabMouseEntry.png":1095,"./tabSlide.png":1096,"./tabStringChange.png":1097,"./tabWithRhythm.png":1098,"./tabWithoutRhythm.png":1099,"./tap.png":1100,"./tempoBeatUnit.png":1101,"./text.png":1102,"./textLines.png":1103,"./tiesDots.png":1104,"./toolbarPlayButton.png":1105,"./toolbarTempo.png":1106,"./transposeButton.png":1107,"./transposedParts.png":1108,"./trill.png":1109,"./trillAccidental.png":1110,"./tripletEights.png":1111,"./tuningCapo.png":1112,"./tuningInstruments.png":1113,"./tuningList.png":1114,"./tuningNote.png":1115,"./tupletAfterCreate.png":1116,"./tupletBeforeCreate.png":1117,"./turns.png":1118,"./twoVoices.png":1119,"./undoUse.png":1120,"./versions.png":1121,"./volumeButton.png":1122,"./wavyLine.png":1123,"./wrongForm.png":1124,"./zoomSlider.png":1125};function n(e){var t=i(e);return o(t)}function i(e){var t=r[e];if(!(t+1)){var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return t}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=913},function(e,t,o){e.exports=o.p+"images/help/8valines-6820ec55736903c8aa999ab4b4c54920.png"},function(e,t,o){e.exports=o.p+"images/help/FiguredBassMatrix-8c36d0fa140a1e6935117a6e3a73462e.png"},function(e,t,o){e.exports=o.p+"images/help/LRLine-7248a57257f0ce0358d44f30c785af3b.png"},function(e,t,o){e.exports=o.p+"images/help/NamedChordMatrix-b5570ee09bf001da27a1911d8b154698.png"},function(e,t,o){e.exports=o.p+"images/help/ScaleDegreeChordMatrix-cf5fab46f80b142333c20e448ce35aed.png"},function(e,t,o){e.exports=o.p+"images/help/accidentals-c255f659ea91ea8cf8de3fd158e0acf5.png"},function(e,t,o){e.exports=o.p+"images/help/activityStart-17e9849a2cab03ed3fdbe8fbff3c5da0.png"},function(e,t,o){e.exports=o.p+"images/help/addInstrument-d250a243910739b32ac21164fbc47022.png"},function(e,t,o){e.exports=o.p+"images/help/arpeggio-7637c203b281b56519bc371d82257933.png"},function(e,t,o){e.exports=o.p+"images/help/articulations-6d2441fe7e54e27c7381ffd1ec4617fd.png"},function(e,t,o){e.exports=o.p+"images/help/barlineBreaks-73f0179717691656b059c8f29be1a6a5.png"},function(e,t,o){e.exports=o.p+"images/help/barlineStyles-7180ae1c6fdacd5fadb64b6b26e6ffbe.png"},function(e,t,o){e.exports=o.p+"images/help/beaming-4c3e22c0fa87db66cf586280b9c39642.png"},function(e,t,o){e.exports=o.p+"images/help/bend-fd4d851ea5b87f10fd9727c442383f6b.png"},function(e,t,o){e.exports=o.p+"images/help/brackets-755f1da2b0ac90eed966b421f389c9f7.png"},function(e,t,o){e.exports=o.p+"images/help/breath-4d54ad71ce4445f2f607d4abab2c6013.png"},function(e,t,o){e.exports=o.p+"images/help/caesura-86d2dcfd2cead7902ae30cb3a44b6b07.png"},function(e,t,o){e.exports=o.p+"images/help/changeClef-37cf927abaea3727da09c343ca0c298f.png"},function(e,t,o){e.exports=o.p+"images/help/changeKeySignature-c357d12e5ce82485eb28cef192299354.png"},function(e,t,o){e.exports=o.p+"images/help/changeTimeSignature-1d5f08e72acc51a4d6b96caaa5c40911.png"},function(e,t,o){e.exports=o.p+"images/help/chordEntry-ebec4db6fb9bf6d73218c63a109e637c.png"},function(e,t,o){e.exports=o.p+"images/help/chordEntry2-6781d6d9df946aa10de243340d5279ee.png"},function(e,t,o){e.exports=o.p+"images/help/chordSymbol-01aa6a268bcd38e19171d5a507f4c700.png"},function(e,t,o){e.exports=o.p+"images/help/coda-72c6eb65d34b2a77f3c7b1dbf6fd1a98.png"},function(e,t,o){e.exports=o.p+"images/help/colorPalette-3564f718b4184e65d5b1e06f1b97efa1.png"},function(e,t,o){e.exports=o.p+"images/help/colors-42266a585854ea746f64045d99cd4986.png"},function(e,t,o){e.exports=o.p+"images/help/commonTime-3df1979b7dcc310792260b2f5f8e43d9.png"},function(e,t,o){e.exports=o.p+"images/help/correctForm-e4532a6928a9344611878cd70decfbd2.png"},function(e,t,o){e.exports=o.p+"images/help/cue-e89267ad8439b4c2dcdfd6f048bbab5e.png"},function(e,t,o){e.exports=o.p+"images/help/cutTime-689c905e10d3d4a4c0a009bdfcdfc847.png"},function(e,t,o){e.exports=o.p+"images/help/delete-8b272ee362decd249b3e151a24921b3b.png"},function(e,t,o){e.exports=o.p+"images/help/deleteMeasure-87fd11b8f746aeeec52bad1d8e23b6fe.png"},function(e,t,o){e.exports=o.p+"images/help/directions-bb199f2770c553f9c1839e3bf3570114.png"},function(e,t,o){e.exports=o.p+"images/help/disableCautionaries-43bb4f33bc830b8a3640b73cf2e75e60.png"},function(e,t,o){e.exports=o.p+"images/help/documentLayout-ed486437237ef6b7504fc2eb264caa8c.png"},function(e,t,o){e.exports=o.p+"images/help/documentLayoutFormatting-709acb5afda470101ccab4ae9b106d37.png"},function(e,t,o){e.exports=o.p+"images/help/documentLayoutParts-95ae147ea1de627f72103907caeecba9.png"},function(e,t,o){e.exports=o.p+"images/help/dottedEights-9270fcbe0da95961088245bd4ffb82c3.png"},function(e,t,o){e.exports=o.p+"images/help/doubleAccidentals-3941411515810fe015d0bc0b3e4d693a.png"},function(e,t,o){e.exports=o.p+"images/help/doubleDot-ce055f3ad38918ed4854e0985a5ebaa5.png"},function(e,t,o){e.exports=o.p+"images/help/doubleNoteTremolos-a83900617713622676d380e5a6f61fd4.png"},function(e,t,o){e.exports=o.p+"images/help/downUp-4016b985f89d55324b6988df1974aeda.png"},function(e,t,o){e.exports=o.p+"images/help/dragDropCopy-9d47b8b46cc691db6f99bde337d09118.png"},function(e,t,o){e.exports=o.p+"images/help/dragDropExample-9f656a5b8647c5d1290807a85ede96ee.png"},function(e,t,o){e.exports=o.p+"images/help/dragDropScore-b779a7d147056e48b58f77ece1535a66.png"},function(e,t,o){e.exports=o.p+"images/help/dragDropStaffH-7754839f20d5152d29d603001cdc3ab3.png"},function(e,t,o){e.exports=o.p+"images/help/dragDropStaffV-c8ff6d593cde642b241c378f0c749cd1.png"},function(e,t,o){e.exports=o.p+"images/help/durationDrag-c4bedb74f7ef064b04b1252253e245ed.png"},function(e,t,o){e.exports=o.p+"images/help/durations-325ab7f7a496f2a6ce27db71effd7f37.png"},function(e,t,o){e.exports=o.p+"images/help/dynamics-41b7c5e505465c6477afafe16077319c.png"},function(e,t,o){e.exports=o.p+"images/help/dynamicsEntry-b01e8c752b7b527a98a19c2ba1fdef9e.png"},function(e,t,o){e.exports=o.p+"images/help/dynamicsEntry2-d1fe65caa88ff142641e03994c06a754.png"},function(e,t,o){e.exports=o.p+"images/help/editingPaletteUse-f9996330bd9adfea2182a3170e755f92.png"},function(e,t,o){e.exports=o.p+"images/help/embedding-35a056a46d987f162fd5f0a73bf61f2d.png"},function(e,t,o){e.exports=o.p+"images/help/embeddingIcon-c4a16caccfd41871df0ccfc7e2b6d2df.png"},function(e,t,o){e.exports=o.p+"images/help/favesAndComments-38c56baea87d12de3fa7dde7fc35b30a.png"},function(e,t,o){e.exports=o.p+"images/help/generalText-c6cd22cdcc8d08d153b454781bc89ed7.png"},function(e,t,o){e.exports=o.p+"images/help/glissando-45368e04d7065b1db21266cbdcf029ac.png"},function(e,t,o){e.exports=o.p+"images/help/graceAfterCreate-ffb5eda96e4db2428a13063db480bd0e.png"},function(e,t,o){e.exports=o.p+"images/help/graceBeforeCreate-65ba3b00fd086bbbcfb8808e5378acca.png"},function(e,t,o){e.exports=o.p+"images/help/graceIcons-4cf48f3364517a6698f55e9a96af5000.png"},function(e,t,o){e.exports=o.p+"images/help/graceNoteGroup-e1650a023d2cb64727a95bbd91866cd4.png"},function(e,t,o){e.exports=o.p+"images/help/graceNoteGroupComplete-e386ff501744e391274626824fd034e1.png"},function(e,t,o){e.exports=o.p+"images/help/grandstaffDynamics1-c6e1f33d7ad4203d2e0ce5d042bc9175.png"},function(e,t,o){e.exports=o.p+"images/help/grandstaffDynamics2-108c30631fdbc1f6eb42fea8799d1a20.png"},function(e,t,o){e.exports=o.p+"images/help/grandstaffDynamics3-56b8e3d791c0dbf77e284a30bcd315ff.png"},function(e,t,o){e.exports=o.p+"images/help/guitarTabPalette-19dc9f6a3139e402b9226e0059aea235.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinBest-e2ac82def2302f6c2a75b65ddb27f4c6.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinBetter-15e409ae564c28ebea078a1449d783ff.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinCreation-55fd58bd52e62036f6af6b685ec37c27.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinExample-95cf9ab773c8aac2d042f0798b1735a1.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinGood-f927f0cb8222e1e08d0f3dced9c38e91.png"},function(e,t,o){e.exports=o.p+"images/help/hairpinSelection-71cc44c38ddc9cb354dd6c3a4f6d3ae5.png"},function(e,t,o){e.exports=o.p+"images/help/hairpins-9b8ba75875b973d749446aae82c18a3a.png"},function(e,t,o){e.exports=o.p+"images/help/hammerPull-abc842eb1ae6a58beea0ca3cfedff1f5.png"},function(e,t,o){e.exports=o.p+"images/help/hide-99d2019784ab8e0e8e65a175c8805f6c.png"},function(e,t,o){e.exports=o.p+"images/help/incomingTie-d192748eb15d6a67e17819c6acf3e6b4.png"},function(e,t,o){e.exports=o.p+"images/help/individualParts-80b74e4b490154457de24173ed44ad4e.png"},function(e,t,o){e.exports=o.p+"images/help/individualPartsButton-998e063fdc7df008b5aa9c36909bbe96.png"},function(e,t,o){e.exports=o.p+"images/help/initialTempoMarking-48a45506608e8e000bcadc350007a88a.png"},function(e,t,o){e.exports=o.p+"images/help/insertMeasure-e0083c74802528cbc14e7ffe1624ef2b.png"},function(e,t,o){e.exports=o.p+"images/help/insertPart-47d07734335c4cd52560ef937bcad860.png"},function(e,t,o){e.exports=o.p+"images/help/jazzFont-d68d4b4837b2fcf5eb8541a751b02ee2.png"},function(e,t,o){e.exports=o.p+"images/help/lines-699b6fcc61ea255ed5d92cbcb27804f0.png"},function(e,t,o){e.exports=o.p+"images/help/linesPaletteDynamics-957062ddfb0a0c67c9a6b6c9df775ced.png"},function(e,t,o){e.exports=o.p+"images/help/lyrics-d39694cba2a74796e12d9a6070a07505.png"},function(e,t,o){e.exports=o.p+"images/help/lyricsEntry-ec5148e20f0c42b7bc82956c95b23080.png"},function(e,t,o){e.exports=o.p+"images/help/lyricsExample-c44745f434bf611de4eeaf0b52a63d2d.png"},function(e,t,o){e.exports=o.p+"images/help/measurePlayButton-32a88207d5d6ad539679d34d7cc82501.png"},function(e,t,o){e.exports=o.p+"images/help/measureSelection-3ab28ecac37dffd5a03ca8228577d60a.png"},function(e,t,o){e.exports=o.p+"images/help/midiExport-32afd4a72b19cf9e218b747ff575bf4a.png"},function(e,t,o){e.exports=o.p+"images/help/midiImport-cad98b74d4ed55f442ba271ea04aa4b6.png"},function(e,t,o){e.exports=o.p+"images/help/midiRecordingTools-584c9b8463cdbf93874f5907c2588754.png"},function(e,t,o){e.exports=o.p+"images/help/mixParts-1b8e136a12a82c27dfe7b5cc76dd294b.png"},function(e,t,o){e.exports=o.p+"images/help/mixerButton-91c790630fbe9318b23c59e268972c9a.png"},function(e,t,o){e.exports=o.p+"images/help/mordents-b69692f6aa679fd845a252b315e3db10.png"},function(e,t,o){e.exports=o.p+"images/help/mouseNoteEntry-265a8d756e4f761e70072fa3387886d4.png"},function(e,t,o){e.exports=o.p+"images/help/multiLineText-21d9e6b7a7b94f42a7bf0cb29035f85d.png"},function(e,t,o){e.exports=o.p+"images/help/multiRestBefore-065630cb67333a0eb18a83431adee5ba.png"},function(e,t,o){e.exports=o.p+"images/help/multiRestCollapsed-0d3f07caea8a21498d003dbcac222089.png"},function(e,t,o){e.exports=o.p+"images/help/multiRestExpanded-cbae91236ad0e2a22c90f5bbc162f759.png"},function(e,t,o){e.exports=o.p+"images/help/multipleSelection-c130e39443a8ba1058813e5941a265d8.png"},function(e,t,o){e.exports=o.p+"images/help/multipleSelectionSharped-d4fa7959947e4af91b7c1c8123b8e838.png"},function(e,t,o){e.exports=o.p+"images/help/multirestIcon-5b736bde024fa38f9253af8e6b782fd5.png"},function(e,t,o){e.exports=o.p+"images/help/multistaffDynamics1-c6e1f33d7ad4203d2e0ce5d042bc9175.png"},function(e,t,o){e.exports=o.p+"images/help/multistaffDynamics2-108c30631fdbc1f6eb42fea8799d1a20.png"},function(e,t,o){e.exports=o.p+"images/help/multistaffDynamics3-56b8e3d791c0dbf77e284a30bcd315ff.png"},function(e,t,o){e.exports=o.p+"images/help/noteHeadsPalette-c7ea32d0b681113b0e85d16d30b7a996.png"},function(e,t,o){e.exports=o.p+"images/help/noteSelection-0550b16222bf4c71129baed67900f126.png"},function(e,t,o){e.exports=o.p+"images/help/noteheads-68cb02766a0e8d605bf415c1f5edccb2.png"},function(e,t,o){e.exports=o.p+"images/help/objectPalette-49d2ef203f3109cdb5a1e39cb3e3badd.png"},function(e,t,o){e.exports=o.p+"images/help/overlapOne-a685ad5c22c54f44dceb4329f6d2e434.png"},function(e,t,o){e.exports=o.p+"images/help/overlapTwo-8a31eba775e095db39336552637f1938.png"},function(e,t,o){e.exports=o.p+"images/help/pageLayout-a7a0cff68bbda8be21116420193ee456.png"},function(e,t,o){e.exports=o.p+"images/help/palmMute-a4ba6bf8672de7880ea85a7af9282e2b.png"},function(e,t,o){e.exports=o.p+"images/help/partMute-ced6166596de9b97d3e34b9c81623321.png"},function(e,t,o){e.exports=o.p+"images/help/partPan-da134accc373629b5e32cc2b250c7e28.png"},function(e,t,o){e.exports=o.p+"images/help/partSolo-620f973d2bf6271b22d6560bc1d435f6.png"},function(e,t,o){e.exports=o.p+"images/help/partVolume-aacecf9ab370ba40f14c5300384d4e8a.png"},function(e,t,o){e.exports=o.p+"images/help/pedalLines-f000e422a0b761a2d1e064e1125f0ae7.png"},function(e,t,o){e.exports=o.p+"images/help/performanceDynamics-36d0a1aef4be8765de27a293f11f365a.png"},function(e,t,o){e.exports=o.p+"images/help/pickupAfter-31211dcfeee20c511009535d0da5b20c.png"},function(e,t,o){e.exports=o.p+"images/help/pickupBefore-663a055d92c3a55bb46a858fa9b23d71.png"},function(e,t,o){e.exports=o.p+"images/help/pickupDialog-5872c8b233272d9fb1f8137f36d629f9.png"},function(e,t,o){e.exports=o.p+"images/help/pitchRhythmPalette-696ffe719262ff93cb9c15a87d323e5d.png"},function(e,t,o){e.exports=o.p+"images/help/placeholderChordSymbol-474b232aeeb08fdff538dcdee9ca79b9.png"},function(e,t,o){e.exports=o.p+"images/help/plainLines-b6c3aa36138e75527cc31cda71b0cb9e.png"},function(e,t,o){e.exports=o.p+"images/help/playbackSpeedAdjust-dcbea6a37e9ddcd23d6b419ecde9c10c.png"},function(e,t,o){e.exports=o.p+"images/help/quarterAlteration-c6aa9526d559a26c1fe2855c0f9c6140.png"},function(e,t,o){e.exports=o.p+"images/help/rangeSelection-5ac6cadafed899a9e894459a1711c025.png"},function(e,t,o){e.exports=o.p+"images/help/rangeTempoMarking-849cc1a64cfe19c0c97c06cd0ad4ef4a.png"},function(e,t,o){e.exports=o.p+"images/help/record-e065bcf7556156cf4f28f6ef32197eee.png"},function(e,t,o){e.exports=o.p+"images/help/repeatEnding-881f37ecda42f05c1d1b36cc6f8982a1.png"},function(e,t,o){e.exports=o.p+"images/help/repeatEndingIcon-e13865329c855a9240773dda3615aa6f.png"},function(e,t,o){e.exports=o.p+"images/help/repeats-e59879bb6466635c932fe7b7007d6a95.png"},function(e,t,o){e.exports=o.p+"images/help/scaleDegreeMatrix-13f58ce6b9af0aac1210703b3d292d35.png"},function(e,t,o){e.exports=o.p+"images/help/scoreInformation-8428032bd31342dcfd6170a6d659d249.png"},function(e,t,o){e.exports=o.p+"images/help/scoreSelection-9bafef80c1c2a83e52416fe5c08bf090.png"},function(e,t,o){e.exports=o.p+"images/help/scoreSelection2-c8990c0a87867175cabbba399bffbc2d.png"},function(e,t,o){e.exports=o.p+"images/help/segno-72af2fe116fb80b43c32937f123a4a66.png"},function(e,t,o){e.exports=o.p+"images/help/selectedBarline-09fc5fbb4e05468ee40aae530dd05f69.png"},function(e,t,o){e.exports=o.p+"images/help/shareIndividualAdd-fc26f05c09ee68f296f1b09224b07772.png"},function(e,t,o){e.exports=o.p+"images/help/shareIndividualStart-a64e27affba062924468a179bd06bde2.png"},function(e,t,o){e.exports=o.p+"images/help/shareTabFlash-cb862847b5cc6ff6bcd558cdd8fee6f1.png"},function(e,t,o){e.exports=o.p+"images/help/shareTabHTML-d4356cc9c6a69c1905048ed8f22c0eb9.png"},function(e,t,o){e.exports=o.p+"images/help/sharingEveryone-1e4ec1ff3c477a8dfcc6cfb66cd316b0.png"},function(e,t,o){e.exports=o.p+"images/help/sharingEveryonePowers-db564143f8bc1a7df1460d8d316286f9.png"},function(e,t,o){e.exports=o.p+"images/help/sharingEveryoneSettings-650091c13602b6261e0357147c7f540a.png"},function(e,t,o){e.exports=o.p+"images/help/sharingIcon-c0197a5663722be4f4779b9883857567.png"},function(e,t,o){e.exports=o.p+"images/help/sharingPrivate-9883309566ddfb55534e6f99b4de041a.png"},function(e,t,o){e.exports=o.p+"images/help/singleNoteTremolo-d10393075f264263bf2cb2e4d65e4dcc.png"},function(e,t,o){e.exports=o.p+"images/help/slash-d263c5e221f840cfc9c422c1212469dc.png"},function(e,t,o){e.exports=o.p+"images/help/slide-7112bb2bf937ce5750e877ad20677afe.png"},function(e,t,o){e.exports=o.p+"images/help/slur2Note-1b93b328ed25d7e72ac73e9ed539df30.png"},function(e,t,o){e.exports=o.p+"images/help/slur2NoteSelection-5c7157880d2ba7f23a83c95c8fa267d6.png"},function(e,t,o){e.exports=o.p+"images/help/slurExamples-3f35c09f3a39f041988f4f06ffb20f76.png"},function(e,t,o){e.exports=o.p+"images/help/slurHandles-e426a9ac166f6b9a4b3283242e230174.png"},function(e,t,o){e.exports=o.p+"images/help/slurPhrase-d6a044e8bdeeb0a6e7ae98ffad9ee028.png"},function(e,t,o){e.exports=o.p+"images/help/slurs-de0422cbaed310188cb74f164f5e9314.png"},function(e,t,o){e.exports=o.p+"images/help/socialSharing-1235b56c44bc6ca0faf08d84a1114bf9.png"},function(e,t,o){e.exports=o.p+"images/help/staffSelection-1aa4498a091a600e130db173ab5046b6.png"},function(e,t,o){e.exports=o.p+"images/help/stems-671bcbfc85a5845f522b7c58080509ab.png"},function(e,t,o){e.exports=o.p+"images/help/straightEights-5043dde5e4cc7c3fbfab91e3db5beb0f.png"},function(e,t,o){e.exports=o.p+"images/help/stringArticulations-36db5f2f9fb354b91e8b3079fdce395c.png"},function(e,t,o){e.exports=o.p+"images/help/stripLayout-2c567e849bce8efa68e2f3e415afa312.png"},function(e,t,o){e.exports=o.p+"images/help/swingEighths-57a9a4d03f3670b937cc40a73fba092a.png"},function(e,t,o){e.exports=o.p+"images/help/symbolsPalette-1783e222a677acb4ca97d2cc58b437db.png"},function(e,t,o){e.exports=o.p+"images/help/syncAudioVideo-6b95984a13fb9641e799ea06e4a9467e.png"},function(e,t,o){e.exports=o.p+"images/help/syncLoadedVideo-771cdd1c7cce58c47fc0e32482c73f83.png"},function(e,t,o){e.exports=o.p+"images/help/syncMarkedSlider-53a9d999f9a3a0862451722fb74674b1.png"},function(e,t,o){e.exports=o.p+"images/help/syncUnloadedPanel-3302af56742ad4412034b07118970771.png"},function(e,t,o){e.exports=o.p+"images/help/systemText-b76ae987b832dfe3d6912279a1663a8a.png"},function(e,t,o){e.exports=o.p+"images/help/tabBend1-978d726b4e5b450168cb4b4a720e5e1e.png"},function(e,t,o){e.exports=o.p+"images/help/tabBend2-6d447ff3f6e0f9e89c4b59a7e8100364.png"},function(e,t,o){e.exports=o.p+"images/help/tabBend3-dc5d8c32fb3b86ed91c8114b129be6a5.png"},function(e,t,o){e.exports=o.p+"images/help/tabBend4-befdb1aa9e987cc3e8854d76158c7717.png"},function(e,t,o){e.exports=o.p+"images/help/tabChordEntry-e3e42ba0ffdcfef8336c0fb222b31266.png"},function(e,t,o){e.exports=o.p+"images/help/tabCopyingStaves-27993b417a903ce77e5d58a36259d385.png"},function(e,t,o){e.exports=o.p+"images/help/tabFretEntry1-8cfdf784838264ac35385f7ca9c1bf27.png"},function(e,t,o){e.exports=o.p+"images/help/tabFretEntry2-b28fce99bc46defd60d8a411e1b9819e.png"},function(e,t,o){e.exports=o.p+"images/help/tabInstrumentChoice-f8d346fc768e765143cf5fe25d7f955a.png"},function(e,t,o){e.exports=o.p+"images/help/tabMouseEntry-fd08e789297ce2f4f32600454e5450a7.png"},function(e,t,o){e.exports=o.p+"images/help/tabSlide-cd5f5b5bc2b0ea8cadc0523f7bcbd447.png"},function(e,t,o){e.exports=o.p+"images/help/tabStringChange-28ca1df963ede6451098c9cf071a6764.png"},function(e,t,o){e.exports=o.p+"images/help/tabWithRhythm-47717b6bf938e83cd9d07f09583219b5.png"},function(e,t,o){e.exports=o.p+"images/help/tabWithoutRhythm-55618a0f960c3e4175b7fa7035b7da49.png"},function(e,t,o){e.exports=o.p+"images/help/tap-373d28a8a7f09aa54e3810bf67607188.png"},function(e,t,o){e.exports=o.p+"images/help/tempoBeatUnit-f3eaa5f36b14d58d48b35678769349b4.png"},function(e,t,o){e.exports=o.p+"images/help/text-648ffa37d6aaa0da8a152e5afdb2ff49.png"},function(e,t,o){e.exports=o.p+"images/help/textLines-84de6bcef6d60b4b0c069744b12953e3.png"},function(e,t,o){e.exports=o.p+"images/help/tiesDots-e941ec934a597e9b42ec81a497c2f627.png"},function(e,t,o){e.exports=o.p+"images/help/toolbarPlayButton-7e236450edd5c9c920625f85413fe32f.png"},function(e,t,o){e.exports=o.p+"images/help/toolbarTempo-9f4dde147e75894716b2062dbde60151.png"},function(e,t,o){e.exports=o.p+"images/help/transposeButton-15d420c46e71a9e72f60c15bfc04475b.png"},function(e,t,o){e.exports=o.p+"images/help/transposedParts-9b2e28ec654e041f478e4569698154bb.png"},function(e,t,o){e.exports=o.p+"images/help/trill-a671ffb73c441775a0cefb48bc1219c3.png"},function(e,t,o){e.exports=o.p+"images/help/trillAccidental-d468e4cf612a53df078a824a573a0dd7.png"},function(e,t,o){e.exports=o.p+"images/help/tripletEights-4a4e13c21041e7586c3a7ba8e335a12d.png"},function(e,t,o){e.exports=o.p+"images/help/tuningCapo-2e3cbcdccac97c2fb7c989a73eaa2f0f.png"},function(e,t,o){e.exports=o.p+"images/help/tuningInstruments-d2b8bcda671c06c3197a7d3642e1a7cb.png"},function(e,t,o){e.exports=o.p+"images/help/tuningList-271ea3d3dcfce01354c837d9e029b194.png"},function(e,t,o){e.exports=o.p+"images/help/tuningNote-c6110cdc76f1eed5fc3974542bda4696.png"},function(e,t,o){e.exports=o.p+"images/help/tupletAfterCreate-b22586a797860039e5fa3a32e9b5f018.png"},function(e,t,o){e.exports=o.p+"images/help/tupletBeforeCreate-0c905902dae100805dfff42152421f5d.png"},function(e,t,o){e.exports=o.p+"images/help/turns-a63077202e6d98af2b5cdb775dfb5c89.png"},function(e,t,o){e.exports=o.p+"images/help/twoVoices-80b147664acf45ad5cf5fdc2444a297d.png"},function(e,t,o){e.exports=o.p+"images/help/undoUse-0a8a8c440bdc09b0aa818da91b49f033.png"},function(e,t,o){e.exports=o.p+"images/help/versions-9a3af741117801287f74ebcfe6480674.png"},function(e,t,o){e.exports=o.p+"images/help/volumeButton-4a09ef6059e3c7e79b1b0c64b5676daa.png"},function(e,t,o){e.exports=o.p+"images/help/wavyLine-49e4b919c22ff7ecbe3bbdf818aa04b1.png"},function(e,t,o){e.exports=o.p+"images/help/wrongForm-3ad8a6438c41a67649254d131e155378.png"},function(e,t,o){e.exports=o.p+"images/help/zoomSlider-932403282b80836e5421496be13c55be.png"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2);var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.templateName=ko.observable("content/inactiveSccError"),this.isAdmin=ko.observable(NF.session.current_user()&&NF.session.current_user().effective_admin())};t.default=n,(0,r.addRoute)("inactive_scc_error","/users/inactive_scc_error/#",n,{})},function(e,t,o){"use strict";var r=p(o(4)),n=o(5),i=o(0),a=o(3),s=p(o(1128)),l=p(o(127)),c=p(o(1129)),u=o(53),d=p(o(197));function p(e){return e&&e.__esModule?e:{default:e}}Noteflight.CollectionItemsViewModel=function(e,t){var o=this,p=this;function f(e){return{name:ko.observable(e.name),id:ko.observable(e.id)}}function h(e,t,o){for(var r=0;r<e.length;r++)for(var n=null,i=!1,a=0;a<e[r].scores().length;a++)if(e[r].scores()[a].score.external_id()==t)if(n)e[r].scores()[a].score.collections(n);else{for(var s=0;s<e[r].scores()[a].score.collections().length;s++)if(e[r].scores()[a].score.collections()[s].id()==o.id){i=!0;break}i||(e[r].scores()[a].score.collections.push(f(o)),n=e[r].scores()[a].score.collections())}}function m(e,t){for(var o=0;o<e.length;o++)for(var r=0;r<e[o].scores().length;r++)for(var n=0;n<e[o].scores()[r].score.collections().length;n++)e[o].scores()[r].score.collections()[n].id()==t.id&&e[o].scores()[r].score.collections()[n].name(t.name)}p.parent=e,Noteflight.CommonScoresViewModel.call(p,e,(0,i.resource)("listing.removing"),"removeFromCollection"),NF.AddToCollectionItemsViewModel.call(p,e),p.title=ko.observable(t.name),p.id=ko.observable(t.id),p.canListCollections(!0),p.description=ko.observable(t.description),p.public=ko.observable(t.public),p.query=ko.observable(t.query),p.buttonLabel=ko.observable(t.button_label),p.isMarketplaceCollection=ko.observable(t.is_marketplace_collection),p.isCollectionOfCollections=ko.observable(t.is_collection_of_collections),p.collectionId=ko.observable(t.id),p.count=ko.observable(t.document_count),p.collectionPageUrl=ko.observable(t.url),p.collections=ko.observableArray([]),p.collectionsSortingTip=new Noteflight.TipViewModel([{resourcesKey:"tip.collectionsSortingTip"}],"_nf_tip_editor_menu.hidden","collectionsSortingTip"),p.showSorting(!1),this.displayedButtonLabel=ko.computed(function(){return(0,i.hasResource)(o.buttonLabel())?(0,i.resource)(o.buttonLabel()):o.buttonLabel()}),p.type.subscribe(function(){p.initializeServices()}),p.parent.viewType.subscribe(function(){p.parent.reset()}),r.default.subscribe(n.COLLECTION_IMAGE_UPLOADED,function(e,t){t.collectionId==p.collectionId()&&NF.apiService.updateCollectionImage((0,i.resource)("action.updatingCollection"),function(){p.imageUploader().refreshImage()},{collection_id:p.collectionId(),collection_image_id:t.imageId})}),r.default.subscribe(n.COLLECTIONS_REFRESH,function(e,t){t.collectionId==p.collectionId()&&p.parent.reset()}),p.collectionImage=ko.computed(function(){var e="/collections/image/"+p.collectionId();return(0,u.profileEpoch)()&&(e+="?"+(0,u.profileEpoch)()),e}),p.imageUploader=ko.observable(new s.default({collectionId:this.collectionId(),imageId:ko.observable(t.id),imageUrl:p.collectionImage,editable:!0})),p.checkAndAddScores=function(e){for(var t=0;t<e.length;t++)for(var o=0;o<e[t].collections().length;o++)if(e[t].collections()[o].id()==p.collectionId()){p.addScores([e[t]]);break}},p._setupSortableElements=function(){var e=null,t="list"==this.parent.viewType()?"#scoresList":"#scoresGrid";$(t).sortable({start:function(t,o){e=$(o.item).index()},update:function(o,r){var n=$(r.item).index();$(t).children().slice(Math.min(e,n),Math.max(e,n)+1);NF.apiService.updateCollectionOrder((0,i.resource)("action.updating"),function(){},{collection_id:p.collectionId(),start_position:e,end_position:n,type:p.type()})}}),$(t).disableSelection()},p.activate=function(){p.initializeServices(),p.scores([]),p.collections([]),p.fetchScoresService()},p.processDeleted=function(t){for(var o=0;o<p.scores().length;)switch(p.type()){case"CollectionProduct":t.scores.includes(p.scores()[o].product.id())?p.scores.splice(o,1):o++;break;default:t.scores.includes(p.scores()[o].score.external_id())?p.scores.splice(o,1):o++}e.fetchStats(),e.fetchCollections(),e.removeCollectionTags(e.viewers,t.collection.id),e.removeCollectionTags(e.collections(),t.collection.id)},p.removeCollectionCallback=function(e){r.default.publish(n.COLLECTIONS_UPDATE_COUNTER);for(var t=0;t<p.collections().length;t++)if(p.collections()[t].id()==e){p.collections.splice(t,1);break}},p.processFetchedCollections=function(e){if(e){for(var t=0;t<e.collection_items.length;t++){var o=e.collection_items[t];switch(p.type(o.type),o.type){case"CollectionCollection":p.collections.push(new NF.CollectionRow(o,p,{removeCallback:p.removeCollectionCallback}));break;case"CollectionDocument":p.scores.push(new p.scoreViewModel(p,new Noteflight.Score(o)));break;case"CollectionProduct":p.scores.push(new Noteflight.CommonProductViewModel(p,new l.default(o)))}}p.remaining(e.remaining),p.startIndex(e.startIndex),p.busy(!1),p._setupSortableElements()}else p.busy(!1)},p.initializeServices=function(){var e={collection_id:p.collectionId(),collection_type:p.type()};p.fetchScoresService=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.collectionItems("",p.processFetchedCollections,Object.assign(e,t))},p.deleteScoresService=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.removeCollectionItems(p.deleteScoresReporter,p.processDeletedCollections,Object.assign(e,t))}},p.processDeletedCollections=function(e){e.scores=e.collection_items,p.processDeleted(e)},p.isCurrent=ko.computed(function(){return"collection"==e.state()&&e.collectionId()==p.collectionId()}),p.accept=function(e){if(p.isCurrent())(0,a.standardAlertDialog)((0,i.pluralize)("action.collectionAlreadyBelong",e.selectedScores().length));else{var t=$.map(e.selectedScores(),function(e){return e.external_id()});p.addScoresToCollectionService({collection_id:p.collectionId(),score_ids:t}),p.addScores(e.selectedScores())}},p.scoresAdded=function(t){for(var o=0;o<t.collection_items.length;o++)h(e.viewers,t.collection_items[o],t.collection),h(e.collections(),t.collection_items[o],t.collection);r.default.publish(n.COLLECTIONS_UPDATE_COUNTER)},p.addScoresToCollectionService=function(e){var t=Object.assign({collection_type:"CollectionDocument"},e);Noteflight.apiService.addScoresToCollection((0,i.resource)("listing.adding"),p.scoresAdded,t)},p.deleteCollection=function(){(0,a.okCancel)((0,i.resource)("listing.confirmDeleteCollection",p.title()),function(){p.deleteCollectionService({collection_id:p.collectionId()})})},p.collectionDeleted=function(){e.collectionDeleted(p)},p.deleteCollectionService=function(e){NF.apiService.deleteCollection((0,i.resource)("listing.deletingCollection"),p.collectionDeleted,e)},p.dragSource=ko.observable(),p.hover=ko.computed(function(){return p.dragSource()&&p.dragSource().selectedScores}),p.collectionEdited=function(t){p.title(t.name),p.description(t.description),p.buttonLabel(t.button_label),p.isMarketplaceCollection(t.is_marketplace_collection),p.query(t.query),m(e.viewers,t),m(e.collections(),t)},p.editDetails=function(){new d.default({callback:p.collectionEdited,new:!1,id:p.collectionId(),title:p.title(),description:p.description(),public:p.public(),query:p.query(),isMarketplaceCollection:p.isMarketplaceCollection(),buttonLabel:p.buttonLabel()}).show()},p.addToCollectionOfCollections=function(){new c.default(p.collectionId()).show()},p.contextMenuItems=function(){var e=[{label:(0,i.resource)("action.deleteCollection"),action:p.deleteCollection},{label:(0,i.resource)("action.editDetails"),action:p.editDetails}];return NF.roles.isNoteflightAdmin()&&!p.isCollectionOfCollections()&&e.push({label:(0,i.resource)("action.addToCollectionOfCollections"),action:p.addToCollectionOfCollections}),e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(4)),n=o(5),i=l(o(116)),a=(l(o(32)),o(53),l(o(75))),s=o(0);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?f(e):t}(this,d(t).call(this,o))).collectionId=o.collectionId,e._aspectRatio=16/9,e.endpointName("uploadCollectionImage"),e.pictureKey("collection_image"),e.imageAPI="/client/1.0/collection_image/",e.selectedCallback=e.selectedCallback.bind(f(f(e))),e._choosePhotoHeader=e._choosePhotoHeader.bind(f(f(e))),e.contextMenuItems=ko.observableArray([{label:(0,s.resource)("action.upload"),action:e.uploadImage},{label:(0,s.resource)("action.chooseStockPhoto"),action:e._choosePhotoHeader}]),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,a.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"_choosePhotoHeader",value:function(){new i.default((0,s.resource)("action.changeHeader"),"collection_image","uploadCollectionImageData",{selectedCallback:this.selectedCallback}).show()}},{key:"_publishCollectionImageUploaded",value:function(e){r.default.publish(n.COLLECTION_IMAGE_UPLOADED,{imageId:e,collectionId:this.collectionId})}},{key:"selectedCallback",value:function(e){this._publishCollectionImageUploaded(e.collection_image_id)}},{key:"_croppingCancelCallback",value:function(){this.selectedCallback({collection_image_id:this._oldImageId})}},{key:"_callbackNewImageUploaded",value:function(e,t){var o=t?this._letUserCropImage.bind(this):function(){};this._oldImageId=this.imageId(),this.imageId(e.collection_image_id),this._rawImageUrl("".concat(this.imageAPI).concat(this.imageId())),this.newImageUploaded(!0),t||this._publishCollectionImageUploaded(e.collection_image_id),o()}}]),t}();t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(4)),n=o(5),i=l(o(13)),a=o(0),s=o(3);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,o){return t&&d(e.prototype,t),o&&d(e,o),e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e){function t(e){var o;return u(this,t),(o=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?m(e):t}(this,f(t).call(this))).idToAdd=e,o.collections=ko.observableArray([]),o._addToCollectionOfCollections=o._addToCollectionOfCollections.bind(m(m(o))),o._collectionAdded=o._collectionAdded.bind(m(m(o))),o._initialize(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.default),p(t,[{key:"_initialize",value:function(){NF.apiService.getCollections((0,a.resource)("action.loading"),this._gotCollections.bind(this),{collection_type:"CollectionCollection",id_to_add:this.idToAdd})}},{key:"_gotCollections",value:function(e){for(var t=0;t<e.collections.length;t++){var o=e.collections[t];this.collections.push(new b(o.id,o.name,this._addToCollectionOfCollections))}this.collections.sort(function(e,t){var o=e.name().toLowerCase(),r=t.name().toLowerCase();return o==r?0:o<r?-1:1}),setTimeout(this.calculateScrollableHeight,10)}},{key:"_collectionAdded",value:function(e){r.default.publish(n.COLLECTIONS_UPDATE_COUNTER,{}),r.default.publish(n.COLLECTIONS_REFRESH,{collectionId:e}),this.cancel()}},{key:"_addToCollectionOfCollections",value:function(e){var t=this,o={collection_id:e,collections_to_add:[this.idToAdd],collection_type:"CollectionCollection"};NF.apiService.addToCollection((0,a.resource)("action.adding"),function(){t._collectionAdded(e)},o)}},{key:"show",value:function(){return(0,s.createAndShowDialog)({viewModel:this,templateName:"dialogs/collectionOfCollections"}),this}}]),t}();t.default=g;var b=function(){function e(t,o,r){u(this,e),this.id=t,this.name=ko.observable(o),this.clickCallback=r}return p(e,[{key:"add",value:function(e){this.clickCallback(this.id)}}]),e}()},function(e,t,o){"use strict";o(1131),o(1132),o(1133),o(1134),o(1135),o(1136),o(1137),o(1138),o(1139);var r=function(e){return e&&e.__esModule?e:{default:e}}(o(307)),n=o(16),i=o(2),a=o(0);var s={infoIndex:"title.info",infoPlans:"title.plans",infoLearn:"title.learn",infoHigherEd:"title.higherEd",infoPartners:"title.partners",infoDevelopers:"title.developers"},l={infoIndex:"meta.info",infoPlans:"meta.plans",infoLearn:"meta.learn",infoHigherEd:"meta.higherEd",infoPartners:"meta.partners",infoDevelopers:"meta.developers"};Noteflight.InfoViewModel=function(){var e=this;e.session=Noteflight.session,e.templateName=ko.observable("content/info"),Noteflight.GenericPageViewModel.call(e),e.activeHeaderTag(""),e.state=ko.observable(""),e.add_library=ko.observable(),e.expandLearn=ko.observable(!1),e.minNumUsers=ko.computed(function(){return NF.session.current_user()&&NF.session.current_user().total_scc_member_count&&NF.session.current_user().total_scc_member_count()?Math.max(10,NF.session.current_user().total_scc_member_count()):10}),e.planHeader=ko.computed(function(){return e.session.current_user()?(0,a.resource)("content.upgrade"):(0,a.resource)("content.joinNoteflight")}),e.upgradeSignUp=ko.computed(function(){return e.session.current_user()?(0,a.resource)("action.upgrade"):(0,a.resource)("action.signup")}),e.title=ko.observable(),e.meta=ko.observable(),e.titleAndMetaSetter=ko.computed(function(){(0,n.setTitleAndMeta)(e,s[e.state()],l[e.state()])}),e.plansPageViewModel=new r.default,e.mailToLinkContactUsCampus=ko.computed(function(){return"mailto:info@noteflight.com?subject="+encodeURIComponent("Noteflight Campus")+"&body="+encodeURIComponent("Please provide the following information and a sales representative will get back to you shortly.\r\n\r\nThank you,\r\nThe Noteflight Team\r\n\r\n\r\nYour name:\r\n\r\nYour role/title:\r\n\r\nYour school name:\r\n\r\nYour school address:\r\n\r\nPhone number:\r\n\r\nApproximate number of students that would use Noteflight:\r\n\r\nLearning Management System, if any (Blackboard, Moodle, WordPress, etc.):\r\n\r\nAny questions:")}),e.doUpgradeSignup=function(t){return!!e.session.current_user()||(Noteflight.appViewModel.showSignupForm(t),!1)},e.doCustomTeacherUpgradeSignup=function(){return e.doUpgradeSignup(e.customTeacherPlan())},e.onNavigate=function(){"infoCharms"==e.state()?Noteflight.appViewModel.headerViewModel.suppressBanner(!0):"infoPlans"==e.state()&&(e.activeHeaderTag("upgrade"),e.expandLearn()&&(e.add_library()?(0,i.navigate)((0,i.path)("commerceFormLearn",{url_years:1,url_users:10,url_cls:e.add_library()+",10"})):(0,i.navigate)((0,i.path)("commerceFormLearn"))))},e.navigateToElement=function(e){$(".scrollingPage").animate({scrollTop:$("#"+e).position().top+$(".scrollingPage").scrollTop()},500)}},Noteflight.InitiatePurchaseOrderViewModel=function(){var e=this;if(e.session=Noteflight.session,e.templateName=ko.observable("content/initiatePurchaseOrder"),e.title=ko.observable((0,a.resource)("quoteRequest.title")),Noteflight.GenericPageViewModel.call(e),e.showForm=ko.observable(!0),e.isUserLoggedIn=ko.computed(function(){return NF.session.current_user()}),e.showSignup=function(){Noteflight.appViewModel.showSignupForm()},e.showLogin=function(){Noteflight.appViewModel.showLoginForm()},e.sites=ko.observable(),e.students_per_site=ko.observable(),e.years=ko.observable(),e.sso_enabled=ko.observable(),e.content_libraries_json=ko.observable(),e.content_libraries=ko.computed(function(){var t=e.content_libraries_json();return t&&JSON.parse(t)}),e.plan=ko.observable(),e.firstName=ko.observable(""),e.lastName=ko.observable(""),e.role=ko.observable(""),e.email=ko.observable(""),e.ccEmails=ko.observable(""),e.schoolName=ko.observable(""),e.schoolAddress1=ko.observable(""),e.schoolAddress2=ko.observable(""),e.city=ko.observable(""),e.zip=ko.observable(""),e.taxExempt=ko.observable(""),e.taxId=ko.observable(""),e.phone=ko.observable(""),Noteflight.CommerceCountryStateViewModel.call(this),e.showTaxExemptFlag=ko.computed(function(){var t=!1;return"US"==e.country()&&$.each(Noteflight.states,function(o,r){if(r.code==e.state())return t=r.taxed,!1}),t}),Noteflight.HeardAboutUsOptions.call(this),e.questions=ko.observable(""),e.session.current_user()){var t=e.session.current_user();e.email(t.email())}e.handleKeyUp=function(t,o){"13"!=o.keyCode&&e.serviceReporter.clearErrors()},e.clearErrors=function(){e.serviceReporter.clearErrors()},e.serviceReporter=new Noteflight.ServiceReporterViewModel((0,a.resource)("quoteRequest.submitting")),e.submitQuoteComplete=function(t){e.printQuoteUrl(t.print_quote_url),e.showForm(!1)},e.printQuoteUrl=ko.observable(),e.submitQuoteService=function(t){Noteflight.apiService.requestQuote(e.serviceReporter,e.submitQuoteComplete,t)},e.submitQuoteRequest=function(){e.serviceReporter.init(),e.firstName().length?e.lastName().length?e.role().length?e.email().length?e.schoolName().length?e.schoolAddress1().length?e.country().length?e.city().length?"US"!=e.country()||e.state()&&e.state().length?e.zip().length?e.submitQuoteService({sites:e.plan().sites(),students_per_site:e.plan().usersPerSite(),years:e.plan().years(),sso_enabled:e.plan().ssoEnabled(),content_libraries:e.content_libraries(),first_name:e.firstName(),last_name:e.lastName(),role:e.role(),email:e.email(),cc_emails:e.ccEmails(),school_name:e.schoolName(),school_address1:e.schoolAddress1(),school_address2:e.schoolAddress2(),country:e.country(),city:e.city(),state:e.state(),zip:e.zip(),tax_exempt:e.taxExempt(),tax_id:e.taxId(),phone:e.phone(),heard_about_us:e.heardAboutUs(),questions:e.questions()}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolZipRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolStateRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolCityRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolCountryRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolAddressRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.schoolNameRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.emailRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.roleRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.lastNameRequired")}):e.serviceReporter.errors.push({message:(0,a.resource)("errors.firstNameRequired")})},e.allowSubmit=ko.computed(function(){return!e.serviceReporter.busy()}),e.onNavigate=function(){e.plan(new Noteflight.CustomTeacherPlanViewModel(1,e.students_per_site(),e.years(),e.sso_enabled()));var t=e.content_libraries();if(t){var o=t.map(function(e){return new Noteflight.ContentLibraryForPurchase(e)});e.plan().contentLibraries(o)}}},(0,i.addRoute)("infoPlans","/info#/plans",Noteflight.InfoViewModel,{state:"infoPlans",expandLearn:!1}),(0,i.addRoute)("plans","/plans#",Noteflight.InfoViewModel,{state:"infoPlans"}),(0,i.addRoute)("plansCompare","/plans#/compare",Noteflight.InfoViewModel,{state:"infoPlans",expandLearn:!1}),(0,i.addRoute)("infoPlansExpandLearn","/info#/plans_expand_learn:?add_library:",Noteflight.InfoViewModel,{state:"infoPlans",expandLearn:!0}),(0,i.addRoute)("plansLearn","/plans#/learn",Noteflight.InfoViewModel,{state:"infoPlans",expandLearn:!0}),(0,i.addRoute)("plansLearnDirect","/plans/learn#",Noteflight.InfoViewModel,{state:"infoPlans",expandLearn:!0}),(0,i.addRoute)("learnTopic","/learn#{topic}",Noteflight.InfoViewModel,{state:"infoLearn"}),(0,i.addRoute)("premium","/premium#",Noteflight.InfoViewModel,{state:"infoPremium"}),(0,i.addRoute)("learn","/learn#",Noteflight.InfoViewModel,{state:"infoLearn"}),(0,i.addRoute)("info","/info:?params:#",Noteflight.InfoViewModel,{state:"infoIndex"}),(0,i.addRouteAlias)("r2","info","/info/learn_more#"),(0,i.addRoute)("infoIndividual","/info#/individual",Noteflight.InfoViewModel,{state:"infoPlans"}),(0,i.addRouteAlias)("r2","infoIndividual","/info/learn_more_individual:?promotion:#"),(0,i.addRoute)("infoK12","/info#/k12",Noteflight.InfoViewModel,{state:"infoLearn"}),(0,i.addRouteAlias)("r2","infoK12","/info/learn_more_k12#"),(0,i.addRoute)("infoK12Custom","/info#/k12custom",Noteflight.InfoViewModel,{state:"infoLearn"}),(0,i.addRoute)("infoPrivate","/info#/private",Noteflight.InfoViewModel,{state:"infoLearn"}),(0,i.addRouteAlias)("r2","infoPrivate","/info/learn_more_private#"),(0,i.addRoute)("partners","/partners#",Noteflight.InfoViewModel,{state:"infoPartners"}),(0,i.addRoute)("infoPartners","/info#/partners",Noteflight.InfoViewModel,{state:"infoPartners"}),(0,i.addRouteAlias)("r2","infoPartners","/info/learn_more_partners#"),(0,i.addRoute)("higherEd","/highered#",Noteflight.InfoViewModel,{state:"infoHigherEd"}),(0,i.addRoute)("infoHigherEd","/info#/highered",Noteflight.InfoViewModel,{state:"infoHigherEd"}),(0,i.addRouteAlias)("r2","infoHigherEd","/info/learn_more_highered#"),(0,i.addRoute)("developers","/developers#",Noteflight.InfoViewModel,{state:"infoDevelopers"}),(0,i.addRoute)("infoDevelopers","/info#/developers",Noteflight.InfoViewModel,{state:"infoDevelopers"}),(0,i.addRouteAlias)("r2","infoDevelopers","/info/learn_more_developers#"),(0,i.addRoute)("infoCharms","/info#/charms",Noteflight.InfoViewModel,{state:"infoCharms"}),(0,i.addRouteAlias)("r2","infoCharms","/info/learn_more_charms#"),(0,i.addRoute)("requestQuote","/info/request_quote:?sites::?students_per_site::?sso_enabled::?years::?content_libraries_json:#",Noteflight.InitiatePurchaseOrderViewModel,{})},function(e,t,o){e.exports=o.p+"images/logo_berklee-f35d1764384f3df0ff2d957a708f76ef.png"},function(e,t,o){e.exports=o.p+"images/logo_music_sales_group-eb068eeb180e7702353de8be763a3316.png"},function(e,t,o){e.exports=o.p+"images/logo_hal_leonard-14ffe33286225253dd8b0d3497eceb87.png"},function(e,t,o){e.exports=o.p+"images/logo_yamaha-2896cffed0b45f5bc7a555e90d8570bf.png"},function(e,t,o){e.exports=o.p+"images/logo_norton-c8a4cfd4c52b728d785c33426757cba5.png"},function(e,t,o){e.exports=o.p+"images/logo_ccli-8054e4a3495b27b3a355bf4ccebc9e31.png"},function(e,t,o){e.exports=o.p+"images/logo_glynlyon-ca3f052c31a770e814a002853b8ebe5f.png"},function(e,t,o){e.exports=o.p+"images/logo_music_first-f1cf3e685ea1e1bc4e3d7d41ea649c47.png"},function(e,t,o){e.exports=o.p+"images/logo_charms-aa07c958387d6f4a75371fb0912ab1a9.jpg"},function(e,t,o){"use strict";var r=o(16),n=o(2),i={terms:"title.terms",privacy:"title.privacy",copyright:"title.copyright"},a={terms:"meta.terms",privacy:"meta.privacy",copyright:"meta.copyright"};Noteflight.LegalViewModel=function(){var e=this;e.templateName=ko.observable("content/legal"),Noteflight.GenericPageViewModel.call(e),e.state=ko.observable("terms"),e.siteNavigator=n.siteNavigator,e.noteflightCommunity=Noteflight.session.community().default_community(),e.title=ko.observable(),e.meta=ko.observable(),e.titleAndMetaSetter=ko.computed(function(){(0,r.setTitleAndMeta)(e,i[e.state()],a[e.state()])})},(0,n.addRoute)("legal","/legal#",Noteflight.LegalViewModel,{}),(0,n.addRoute)("terms","/legal/terms#",Noteflight.LegalViewModel,{state:"terms"}),(0,n.addRoute)("legalTerms","/legal#/terms",Noteflight.LegalViewModel,{state:"terms"}),(0,n.addRouteAlias)("r2","terms","/info/terms_of_use#"),(0,n.addRoute)("privacy","/legal/privacy#",Noteflight.LegalViewModel,{state:"privacy"}),(0,n.addRoute)("legalPrivacy","/legal#/privacy",Noteflight.LegalViewModel,{state:"privacy"}),(0,n.addRouteAlias)("r2","privacy","/info/privacy#"),(0,n.addRoute)("copyright","/legal/copyright#",Noteflight.LegalViewModel,{state:"copyright"}),(0,n.addRoute)("legalCopyright","/legal#/copyright",Noteflight.LegalViewModel,{state:"copyright"}),(0,n.addRouteAlias)("r2","copyright","/info/copyright#")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryInfoBlock=t.LibrariesListingItemViewModel=void 0;var r=o(217),n=function(e){return e&&e.__esModule?e:{default:e}}(o(218)),i=o(2),a=o(0);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,o){return t&&h(e.prototype,t),o&&h(e,o),e}o(1142),o(1143);var g=function(){function e(t,o){f(this,e),this.library=o,this.group=o,this.initializeObservables(),this.initializeComputeds()}return m(e,[{key:"initializeObservables",value:function(){this.purchasedLibrary=ko.observable(this.library.allowed_user_count()>0),this.isLibraryMember=this.library.isActiveMember,this.canAddMembersButIsNotMember=ko.observable(this.library.canAddMembersButIsNotMember()&&this.purchasedLibrary());var e="lock";(this.purchasedLibrary()||this.isLibraryMember())&&(e=this.canAddMembersButIsNotMember()?"unlock":"check"),this.membershipIcon=ko.observable("fa-".concat(e))}},{key:"initializeComputeds",value:function(){var e=this;this.showPurchaseLinks=ko.computed(function(){return(!NF.session.community()||!NF.session.community().reseller_community())&&(!e.isLibraryMember()&&(NF.session.community().default_community()||NF.roles.isSiteAdmin()))}),this.groupURL=ko.computed(function(){return(0,i.path)("viewLibrary",{libraryId:e.library.id()})}),this.manageMembersURL=ko.computed(function(){return(0,i.path)("viewSiteLibraryStudents",{libraryId:e.library.id()})})}},{key:"goToLibrary",value:function(){return(0,i.navigate)(this.groupURL())}},{key:"buy",value:function(){this.library.navigateToPurchase()}}]),e}();t.LibrariesListingItemViewModel=g;var b=function(e){function t(){var e;f(this,t),(e=l(this,c(t).call(this))).title=(0,a.resource)("title.libraries"),e.doesSearch(!1),e.activeHeaderTag("libraries"),e.name=ko.observable("libraries"),e.allListing=new y(p(p(e))),e.yourListing=new v(p(p(e)));var o=NF.session.current_user();return e.userId=ko.observable(o?o.external_id():null),e.hideNewGroup=ko.observable(!0),e}return u(t,r.GroupsViewModel),t}(),v=function(e){function t(e){var o;return f(this,t),(o=l(this,c(t).call(this,e))).name="yourLibraries",o.parent=e,o.listingType="personal",o.readyToShow=ko.observable(!1),o.sortable=ko.observable(!1),o.hasNoLibraries=ko.observable(!1),o.tabHref=ko.computed(function(){return o.parent.searchTarget()?o.searchPath({searchTarget:o.parent.searchTarget()}):o.rootPath()}),o.title=ko.computed(function(){return(0,a.resource)("content.yourLibraries")}),o}return u(t,r.GroupsListingViewModel),m(t,[{key:"rootPath",value:function(){return Noteflight.paths.yourLibraries()}},{key:"searchPath",value:function(e){return Noteflight.paths.searchYourLibraries(e)}},{key:"fetchGroups",value:function(){var e={start_index:this.startIndex(),max_count:36},t=this.parent.searchTarget();t&&(e.query=t),$.extend(e,{user_id:this.parent.userId()}),NF.apiService.fetchLibraries(this,this.processFetchedData.bind(this),e)}},{key:"processFetchedData",value:function(e){if(!e.content_libraries.length&&!this.parent.searchTarget())return this.hasNoLibraries(!0),this.parent.state("all");this.hasNoLibraries(!1);for(var t=0;t<e.content_libraries.length;t++){var o=e.content_libraries[t];this.groups.push(new g(this,new n.default(o)))}this.count(e.count),this.remaining(e.remaining),this.startIndex(Math.min(this.startIndex()+36,this.count()))}}]),t}(),y=function(e){function t(e){var o;return f(this,t),(o=l(this,c(t).call(this,e))).name="AllLibraries",o.parent=e,o.listingType="public",o.listingFragment="fragments/libraryListing",o.infoBlock=new _,o.readyToShow=ko.observable(!1),o.sortable=ko.observable(!1),o.tabHref=ko.computed(function(){return o.parent.searchTarget()?o.searchPath({searchTarget:o.parent.searchTarget()}):o.rootPath()}),o.title=ko.computed(function(){return(0,a.resource)("content.allLibraries")}),o}return u(t,r.GroupsListingViewModel),m(t,[{key:"rootPath",value:function(){return Noteflight.paths.allLibraries()}},{key:"searchPath",value:function(e){return Noteflight.paths.searchAllLibraries(e)}},{key:"fetchGroups",value:function(){var e={start_index:this.startIndex(),max_count:36},t=this.parent.searchTarget();t&&(e.query=t),NF.apiService.fetchLibraries(this,this.processFetchedData.bind(this),e)}},{key:"processFetchedData",value:function(e){if(!e.content_libraries.length&&!this.parent.searchTarget())return this.parent.state("all");for(var t=0;t<e.content_libraries.length;t++){var o=e.content_libraries[t],r=new g(this,new n.default(o));$("head").append('<meta property="og:image" content="'+r.library.masterGroup.imageFullURL()+'" />'),$("head").append('<meta name="image" content="'+r.library.masterGroup.imageFullURL()+'" />'),this.groups.push(r)}this.count(e.count),this.remaining(e.remaining),this.startIndex(Math.min(this.startIndex()+36,this.count()))}}]),t}(),_=function(){function e(){f(this,e),this.fragmentName="fragments/librariesInfoBlock",this.showBuyLinks=ko.computed(function(){return(!NF.session.community()||!NF.session.community().reseller_community())&&(!NF.session.current_user()||!(!NF.session.current_user()||!NF.session.current_user().effective_admin()))})}return m(e,[{key:"goToBuy",value:function(){NF.appViewModel.changeCommunity(NF.defaultHostname,(0,i.path)("plansLearnDirect"))}}]),e}();t.LibraryInfoBlock=_,(0,i.addRoute)("libraries","/libraries#",b,{state:"all",searchTarget:null,searching:!1}),(0,i.addRouteAlias)("r2","libraries","/libraries#"),(0,i.addRoute)("yourLibraries","/libraries#/yours",b,{state:"yours",searchTarget:null,searching:!1}),(0,i.addRoute)("allLibraries","/libraries#/all",b,{state:"all",searchTarget:null,searching:!1}),(0,i.addRoute)("searchAllLibraries","/libraries#/search/{searchTarget}",b,{state:"allFiltered",searching:!0}),(0,i.addRoute)("searchYourLibraries","/libraries#/privateSearch/{searchTarget}",b,{state:"yoursFiltered",searching:!0})},function(e,t,o){e.exports=o.p+"images/check-7cd8797bc79163c6c2b678eca8989dd0.svg"},function(e,t,o){e.exports=o.p+"images/lock-2c05c13fc1643905c946e6d07a3079ee.svg"},function(e,t,o){"use strict";var r=u(o(4)),n=u(o(62)),i=u(o(218)),a=o(5),s=o(16),l=o(2),c=o(0);function u(e){return e&&e.__esModule?e:{default:e}}Noteflight.LibraryViewModel=function(){var e=this;Noteflight.GenericPageViewModel.call(e),e.groupId=ko.observable(),e.group=ko.observable(),e.libraryId=ko.observable(),e.library=ko.observable(),e.instanceGroup=ko.observable(),e.instanceGroupId=ko.observable(),e.lastLibraryId=null,e.lastGroupId=null,e.title=ko.observable(),e.activeHeaderTag("libraries"),e.search=ko.observable("all"),e.normalSearch=e.search,e.overviewView=ko.observable(),e.catalogView=ko.observable(),e.libraryMembersView=ko.observable(),e.currentSubview=ko.observable(null),e.name=ko.computed(function(){if(e.group())return e.group().name()}),e.userIsMember=ko.computed(function(){return!!e.library()&&e.library().isActiveMember()}),e.readyToShow=ko.observable(!1),e.showDetails=ko.computed(function(){return!!e.library()&&(e.library().canAddMembers()||NF.roles.isAtLeastSiteTeacher()&&e.library().allowed_user_count()>0)}),e.searchTarget=ko.observable(""),e.searchForTitle=ko.computed(function(){return(0,c.resource)("content.searchFor",e.searchTarget())}),e.updateInstanceGroup=function(t){e.library().updateInstanceGroup(t),r.default.publish(a.GROUP_UPDATED,t)},e.templateName=ko.observable("content/library"),e.state=ko.observable("root"),e.subState=ko.observable(null),e.showSearch=ko.computed(function(){return e.currentSubview()==e.catalogView()}),e.libraryPath=ko.computed(function(){if(e.library())return NF.paths.viewLibrary({libraryId:e.library().id()})}),e.selectSubview=function(){var t=null;switch(e.doesSearch(!1),e.search=e.normalSearch,e.state()){case"root":e.search("all"),NF.IsPhoneLayout()||(t=e.catalogView());break;case"overview":t=e.overviewView();break;case"catalog":t=e.catalogView();break;case"libraryMembers":t=e.libraryMembersView(),e.enableCustomSearch()}e.currentSubview(t),t&&t.activate()};e.onNavigate=function(){e.library()&&e.lastLibraryId==e.libraryId()?e.selectSubview():NF.apiService.fetchLibrary((0,c.resource)("action.loading"),function(t){!function(t){e.siteAdminVM=NF.roles.isAtLeastSiteTeacher()?new NF.SiteAdminViewModel(e):null,e.library(new i.default(t)),e.title((0,s.safeValueExtractionFromObservableObject)(c.resource,t.master_group.name)),e.libraryId(e.library().id()),e.group(new n.default(t.master_group)),e.groupId(e.group().id()),e.lastLibraryId=e.library().id(),e.lastGroupId=e.group().id(),t.instance_group&&(e.instanceGroup(new n.default(t.instance_group)),e.instanceGroupId(e.instanceGroup().id())),e.overviewView(new NF.LibraryOverviewViewModel(e)),e.catalogView(new NF.ContentLibraryCatalogViewModel(e,e.createLibraryScoresViewModel())),e.showDetails()&&e.libraryMembersView(new NF.LibraryMembersCommonViewModel(e)),e.selectSubview(),e.readyToShow(!0)}(t.library)},{library_id:e.libraryId()})},e.enableCustomSearch=function(){e.doesSearch(!0),e.search=function(t){t?e.currentSubview().customSearchFunction(t):e.clearSearch()},e.clearSearch=function(){e.searchTarget(""),(0,l.navigate)(e.currentSubview().rootPath({libraryId:e.libraryId()}))}},e.createLibraryScoresViewModel=function(){var t=new Noteflight.PublicScoresViewModel(e.search,e);return t.state("libraryScores"),t.groupId(e.groupId()),t.name(e.name()),t.libraryPath(e.libraryPath()),t.allScoresPath(NF.paths.viewGroupAllScores({groupId:e.groupId()})),t}},(0,l.addRoute)("viewLibrary","/libraries#/library/{libraryId}",Noteflight.LibraryViewModel,{state:"root"}),(0,l.addRoute)("viewLibraryOverview","/libraries#/library/{libraryId}/overview",Noteflight.LibraryViewModel,{state:"overview"}),(0,l.addRoute)("viewLibraryCatalog","/libraries#/library/{libraryId}/scores/{search}",Noteflight.LibraryViewModel,{state:"catalog"}),(0,l.addRoute)("viewSiteLibraryStudents","/libraries#/library/{libraryId}/students",Noteflight.LibraryViewModel,{state:"libraryMembers",subState:"students"}),(0,l.addRoute)("viewSiteLibraryTeachers","/libraries#/library/{libraryId}/teachers",Noteflight.LibraryViewModel,{state:"libraryMembers",subState:"teachers"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PremiumTrial=void 0;var r=o(2),n=o(0),i=o(31);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,c(t).call(this))).templateName=ko.observable("content/premiumTrial"),e.state=ko.observable("existingFreeUser"),e.initialize(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,Noteflight.GenericPageViewModel),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"initialize",value:function(){NF.session.current_user()?NF.session.current_user().has_premium_features()?this.state("existingPremiumUser"):NF.session.current_user().has_expired_premium_trial()&&this.state("existingTrial"):this.state("anonymous"),(0,i.setCookie)("premiumTrial","false",3e5,NF.COOKIE_DOMAIN,"/")}},{key:"premiumTrialSignup",value:function(){(0,i.setCookie)("premiumTrial","true",6e5,NF.COOKIE_DOMAIN,"/"),NF.appViewModel.headerViewModel.signupViewModel.show()}},{key:"premiumTrialLogin",value:function(){(0,i.setCookie)("premiumTrial","true",3e5,NF.COOKIE_DOMAIN,"/"),NF.appViewModel.headerViewModel.loginViewModel.show(this._loginSucceeds.bind(this))}},{key:"_loginSucceeds",value:function(e){if(e.warnings)switch(e.warnings[0].code){case"existingPremiumFeatures":(0,r.navigate)(NF.paths.premiumTrialExistingUser());break;case"existingPremiumTrial":(0,r.navigate)(NF.paths.premiumTrialExistingTrial())}else(0,r.navigate)(NF.paths.premiumTrialConfirmation())}},{key:"confirmTrial",value:function(){NF.apiService.purchasePremiumTrial({text:(0,n.resource)("action.loading"),fullScreen:!0,withBackground:!0,doNotShowDefaultError:!0},this.premiumTrialCallback.bind(this),{})}},{key:"premiumTrialCallback",value:function(e){this.state("trialConfirmation")}},{key:"getStarted",value:function(){(0,r.navigate)(NF.paths.loggedInHome())}},{key:"viewPlans",value:function(){(0,r.navigate)(NF.paths.plans())}},{key:"goHome",value:function(){(0,r.navigate)(NF.paths.loggedInHome())}}]),t}();t.PremiumTrial=d,(0,r.addRoute)("premiumTrial","/premium-trial#",d,{}),(0,r.addRoute)("premiumTrialConfirmation","/premium-trial-confirmation#",d,{state:"trialConfirmation"}),(0,r.addRoute)("premiumTrialExistingTrial","/premium-trial-existing-trial#",d,{state:"existingTrial"}),(0,r.addRoute)("premiumTrialExistingUser","/premium-trial-existing-user#",d,{state:"existingPremiumUser"})},function(e,t,o){"use strict";var r=f(o(4)),n=o(5),i=f(o(308)),a=f(o(1148)),s=f(o(32)),l=f(o(197)),c=o(2),u=o(0),d=o(3),p=o(302);function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Noteflight.PrivateScoresModel=function(){var e=this;Noteflight.ScoreListFamilyModel.call(this),e.templateName=ko.observable("content/privateScores"),Noteflight.GenericPageViewModel.call(e),e.activeHeaderTag("myScores"),this.showSearchBarForMobile(!0),r.default.subscribe(n.COLLECTIONS_UPDATE_COUNTER,function(t,o){e.fetchCollections()}),e.init=ko.observable(!1),e.fetchedAllCounts=ko.observable(!1),e.showMarketplaceScores=ko.observable(NF.session.current_user().has_seller_account()&&NF.session.current_user().has_premium_features()&&NF.session.showSellerFeatures()),e.showPurchasedScores=NF.session.showSellerFeatures,e.name=ko.observable("privateScores"),e.searchTarget=ko.observable(),e.busy=ko.observable(!1),e.searchTargetToShow=ko.computed(function(){return decodeURIComponent(e.searchTarget())}),e.searchScope=ko.observable("searchPrivate"),e.doesSearch(!0),NF.session.community().default_community()?this.searchConfiguration={yourhome:5,marketplace_with_contribs:1,score:1}:this.searchConfiguration={yourhome:5,score:1,group:1},e.searchHeader=ko.observable((0,u.resource)("action.searchForPrivateScores")),e.clearSearch=function(){e.searchTarget(null),"searchPrivate"==e.state()?(0,c.navigate)(NF.paths.yourScores()):"searchPublic"==e.state()?(0,c.navigate)(NF.paths.yourPublicScores()):"searchMarketplacePrivate"==e.state()?(0,c.navigate)(NF.paths.yourMarketplaceScores()):"searchPurchasedPrivate"==e.state()&&(0,c.navigate)(NF.paths.yourPurchasedScores())},e.handleSearchPrivate=function(t){(0,c.navigate)(NF.paths.privateSearch({searchTarget:e.searchTarget()}))},e.isReadOnly=ko.observable(!1),e.collections=ko.observableArray(),e.collectionId=ko.observable(),e.sortParameter=[],e.templateScoreId=ko.observable(),e.templateScoreName=ko.observable(),e.showRedeemedContentSection=ko.computed(function(){if(Noteflight.config.settings&&Noteflight.config.settings.bookDemoUsers&&NF.session.community().default_community())for(var e=0;e<Noteflight.config.settings.bookDemoUsers.length;e++)if(NF.config.settings.bookDemoUsers[e]==NF.session.current_user().username())return!0;return!1}),e.redemptions=ko.observableArray(),e.redeemedContentId=ko.observable(),e.collectionsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.manageCollection"}],"_nf_tip_collections.hidden"),e.showCollectionTags=ko.observable(!1),e.yourScoresViewModel=new Noteflight.YourScoresViewModel(e),e.privateSearchViewModel=new Noteflight.PrivateSearchViewModel(e),e.privatePublicSearchViewModel=new Noteflight.PrivatePublicSearchViewModel(e),e.privateMarketplaceSearchViewModel=new Noteflight.PrivateMarketplaceSearchViewModel(e),e.privatePurchasedSearchViewModel=new Noteflight.PrivatePurchasedSearchViewModel(e),e.templateCopiesViewModel=new Noteflight.TemplateCopiesViewModel(e),e.yourMarketplaceScoresViewModel=new Noteflight.YourMarketplaceScoresViewModel(e),e.yourPurchasedScoresViewModel=new Noteflight.YourPurchasedScoresViewModel(e),e.yourPublicScoresViewModel=new Noteflight.YourPublicScoresViewModel(e),e.scoresSharedWithYouViewModel=new Noteflight.ScoresSharedWithYouViewModel(e),e.yourFavesScoresViewModel=new Noteflight.YourFavesScoresViewModel(e),e.yourBooksViewModel=new Noteflight.YourBooksViewModel(e),e.yourMessagesViewModel=new S(e),e.yourActivityStreamViewModel=new Noteflight.YourActivityStreamViewModel(e),e.yourActivityStreamViewModel.userId(NF.session.current_user().external_id()),e.yourTrashScoresViewModel=new Noteflight.YourTrashScoresViewModel(e),e.dashboard=new a.default(e),e.fixedListModels=[e.dashboard,e.yourScoresViewModel,e.privateSearchViewModel,e.privatePublicSearchViewModel,e.scoresSharedWithYouViewModel,e.yourPublicScoresViewModel,e.yourFavesScoresViewModel,e.yourTrashScoresViewModel],e.viewers=[e.yourScoresViewModel,e.yourMarketplaceScoresViewModel,e.yourPurchasedScoresViewModel,e.yourPublicScoresViewModel,e.yourTrashScoresViewModel],e.listModels=e.fixedListModels,e.showYourBooks=ko.computed(function(){return e.yourBooksViewModel.count()>0}),e.alertDialog=new Noteflight.AlertSequenceDialog,e.fetchStats=function(){NF.apiService.privateStatistics("",e.populateStats)},e.populateStats=function(t){e.yourScoresViewModel.count(t.private_scores_count),e.yourMarketplaceScoresViewModel.count(t.marketplace_scores_count),e.yourPurchasedScoresViewModel.count(t.purchased_scores_count),e.yourPublicScoresViewModel.count(t.public_scores_count),e.scoresSharedWithYouViewModel.count(t.shared_scores_count),e.yourFavesScoresViewModel.count(t.favorites_count),e.yourTrashScoresViewModel.count(t.trash_count),e.yourBooksViewModel.count(t.my_books_count),e.yourActivityStreamViewModel.mostRecentActivityEventId(t.most_recent_activity_event_id),e.yourActivityStreamViewModel.newsLastViewedTime(t.activity_stream_last_viewed_at),e.yourMessagesViewModel.messagesNotRead(t.messages_not_read)},e.fetchCollectionsService=Noteflight.postService("/api/1.0/members/private_collections",e,function(t){e.collections.removeAll();for(var o=0;o<t.collections.length;o++)e.collections.push(new NF.CollectionItemsViewModel(e,t.collections[o]));e.listModels=e.fixedListModels.concat(e.collections()),e.fetchedAllCounts(!0)}),e.fetchCollections=function(){e.session.current_user()&&e.session.current_user().has_premium_features()&&e.fetchCollectionsService()},e.fetchRedemptionsService=function(){var t={redemptions:[]};e.redemptions.removeAll();$.ajax({url:"/content_item/book_demo",dataType:"json"}).done(function(o){for(var r=o||t,n=0;n<r.redemptions.length;n++)e.redemptions.push(new Noteflight.RedeemedContentViewModel(e,r.redemptions[n]));"redeemedContent"==e.state()&&e.selectView()}).fail(function(){for(var o=0;o<t.redemptions.length;o++)e.redemptions.push(new Noteflight.RedeemedContentViewModel(e,t.redemptions[o]))})},e.fetchRedemptions=function(){e.fetchRedemptionsService()},e.removeCollectionTags=function(e,t){for(var o=0;o<e.length;o++)e[o].removeCollection(t)},e.restoreScoresInCollectionsList=function(t){for(var o=0;o<e.collections().length;o++)e.collections()[o].checkAndAddScores(t)},e.addScoresFromList=function(e,t){for(var o=0;o<e.length;o++)e[o].checkAndAddScores(t)},e.removeScoresFromList=function(e,t){for(var o=0;o<e.length;o++)e[o].removeScores(t)},e.reset=function(){$.each(e.collections().concat(e.fixedListModels),function(t,o){o!=e.currentListing()&&o.clear()}),e.fetchedAllCounts(!1),e.fetchStats(),e.fetchCollections(),e.showRedeemedContentSection()&&e.fetchRedemptions()},e.reset(),e.activateViewModel=function(t){t&&(e.order()&&t.sortBy(e.order()),t.activate(),setTimeout(function(){e.init(!0)},1)),e.currentListing(t)},e.selectView=function(){var t;switch(e.state()){case"root":t=NF.IsPhoneLayout()?null:e.yourScoresViewModel;break;case"yourScores":t=e.yourScoresViewModel;break;case"dashboard":t=e.dashboard;break;case"searchPrivate":t=e.privateSearchViewModel,e.searchHeader((0,u.resource)("action.searchForPrivateScores")),e.searchScope(e.state());break;case"searchPublic":t=e.privatePublicSearchViewModel,e.searchHeader((0,u.resource)("action.searchForPublicScores")),e.searchScope(e.state());break;case"searchMarketplacePrivate":t=e.privateMarketplaceSearchViewModel,e.searchHeader((0,u.resource)("action.searchForSaleScores")),e.searchScope(e.state());break;case"searchPurchasedPrivate":t=e.privatePurchasedSearchViewModel,e.searchHeader((0,u.resource)("action.searchForPurchasedScores")),e.searchScope(e.state());break;case"templateCopies":t=e.templateCopiesViewModel;break;case"yourMarketplaceScores":t=e.yourMarketplaceScoresViewModel;break;case"yourPurchasedScores":t=e.yourPurchasedScoresViewModel;break;case"yourPublicScores":t=e.yourPublicScoresViewModel;break;case"scoresSharedWithYou":t=e.scoresSharedWithYouViewModel;break;case"yourFavesScores":t=e.yourFavesScoresViewModel;break;case"yourBooks":t=e.yourBooksViewModel;break;case"yourActivityStream":t=e.yourActivityStreamViewModel;break;case"yourMessages":t=e.yourMessagesViewModel;break;case"yourTrashScores":t=e.yourTrashScoresViewModel;break;case"collection":for(var o=0;o<e.collections().length;o++)if(e.collectionId()==e.collections()[o].collectionId()){t=e.collections()[o];break}break;case"redeemedContent":for(var r=0;r<e.redemptions().length;r++)if(e.redeemedContentId()==e.redemptions()[r].id()){t=e.redemptions()[r];break}break;default:return}e.activateViewModel(t)},e.fetchedAllCounts.subscribe(e.selectView),Noteflight.appViewModel.currentCSSLayout.subscribe(e.selectView),e.onNavigate=function(){e.initViewType(),e.initshowCollectionTags(),e.selectView()},e.searchLabel=ko.observable((0,u.resource)("search.labelYourScores")),e.search=function(t){t?(e.privateSearchViewModel.count(""),e.privatePublicSearchViewModel.count(""),(0,c.navigate)(Noteflight.paths.privateSearch({searchTarget:t}))):(e.searchTarget(null),(0,c.navigate)(Noteflight.paths.loggedInHome()))},e.sortByParameter=function(t,o){for(var r=0;r<e.sortParameter.length;r++)t=t[e.sortParameter[r]],o=o[e.sortParameter[r]];return t()<o()?-1:t()>o()?1:0},e.collectionDeleted=function(t){var o=t.isCurrent();e.collections.remove(t),o&&(0,c.navigate)((0,c.path)("loggedInHome",{state:"root"})),e.removeCollectionTags(e.viewers,t.collectionId()),e.removeCollectionTags(e.collections(),t.collectionId())},e.collectionCreated=function(t){e.fetchedAllCounts(!1),e.collections.push(new Noteflight.CollectionItemsViewModel(e,t)),e.sortParameter=["title"],e.collections.sort(e.sortByParameter)},e.showNewCollectionDialog=function(){e.session.current_user().has_premium_features()?new l.default({callback:e.collectionCreated,new:!0}).show():(0,s.default)((0,u.resource)("action.newCollectionTitle"),(0,u.resource)("action.newCollection"),"new_collection")},e.showCollectionSettingsDialog=function(){new function(e){var t=this;d.DialogViewModel.call(t),t.showCollectionTags=ko.observable(e.showCollectionTags()),t.show=function(){(0,d.createAndShowDialog)({viewModel:t,templateName:"dialogs/collectionSettings"})},t.saveSettings=function(){(0,d.hideCurrentDialog)(),e.setshowCollectionTags(t.showCollectionTags())}}(e).show()},e.initshowCollectionTags=function(){if(NF.session.current_user()&&NF.session.current_user().has_premium_features()&&NF.hasStorage){var t="true"==localStorage.getItem("_nf_scores_show_collections");e.showCollectionTags(t)}},e.setshowCollectionTags=function(t){e.showCollectionTags(t),NF.hasStorage&&localStorage.setItem("_nf_scores_show_collections",e.showCollectionTags())},e.inSearch=ko.computed(function(){return e.privatePublicSearchViewModel.isCurrent()||e.privateSearchViewModel.isCurrent()||e.privateMarketplaceSearchViewModel.isCurrent()||e.privatePurchasedSearchViewModel.isCurrent()})};var v=function(e){this.title=e.title(),this.collectionId=e.collectionId(),this.selected=ko.observable(!1)},y=function(e){this.title=e.name,this.hostname=e.hostname,this.selected=ko.observable(!1)};Noteflight.CommonScoreViewModel=function(e,t){Noteflight.ScoreViewModel.call(this,e,t),Noteflight.CommonGenericListingViewModel.call(this,e,t)},Noteflight.CommonProductViewModel=function(e,t){Noteflight.ProductViewModel.call(this,e,t),Noteflight.CommonGenericListingViewModel.call(this,e,t)},Noteflight.CommonGenericListingViewModel=function(e,t){var o=this;this.dragStart=function(t){return e},this.navigateToScore=function(){return!t.archived()||((0,d.okCancel)((0,u.resource)("listing.openArchivedScore"),o.continueToOpen),!1)},this.continueToOpen=function(){(0,c.navigate)(o.editUrl)},this.continueToOpen=this.continueToOpen.bind(this),this.contextMenuItems=function(){var t=[],r=o.selectionList.parent.isReadOnly;if(r&&r())return t;if(o.score.archived())t.push({label:(0,u.resource)("action.restore"),action:e.unarchiveScores});else{if(e.baseActions)for(var n=0;n<e.baseActions.length;n++)t.push({label:(0,u.resource)(e.baseActions[n].resource),action:e.baseActions[n].action});if(e.availableActions)for(var i=0;i<e.availableActions.length;i++)e.availableActions[i].rule(o.score)&&t.push({label:(0,u.resource)(e.availableActions[i].resource),action:e.availableActions[i].action})}return t}},Noteflight.ListActionModel=function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.id=e,this.resource=t,this.action=o,this.rule=r||function(){return!0}},Noteflight.ListActionViewModel=function(e,t){this.actionModel=e,this.enabled=ko.observable(t)},Noteflight.CommonScoresViewModel=function(e,t,o){var r=this;Noteflight.ScoreListModel.call(this,e),r.editableList=ko.observable(!0),r.heterogeneousList=ko.observable(!0),r.canListCollections=ko.observable(!1),r.type=ko.observable("CollectionDocument"),r.listCollections=ko.computed(function(){return r.canListCollections()&&e.showCollectionTags()}),r.scoreViewModel=Noteflight.CommonScoreViewModel,r.processDeleted=function(t){for(var n=[],i=0;i<r.scores().length;)t.scores.indexOf(r.scores()[i].score.external_id())>-1?(n.push(r.scores()[i].score),r.scores.splice(i,1)):i++;switch(""!==r.count()&&r.count(r.count()-t.scores.length),e.fetchStats(),e.fetchCollections(),o){case"moveToTrash":e.removeScoresFromList(e.viewers,n),e.removeScoresFromList(e.collections(),n),e.yourTrashScoresViewModel.addScores(n);break;case"restoreScores":e.addScoresFromList([e.yourScoresViewModel,e.yourPublicScoresViewModel],n),e.restoreScoresInCollectionsList(n)}r.adjustCountHook&&r.adjustCountHook(-t.scores.length)},r.deleteScoresReporter=new Noteflight.ServiceReporterViewModel(t),r.deleteScoresService=function(e){NF.apiService.deleteScores(r.deleteScoresReporter,r.processDeleted,e)},r.deleteScores=function(){var e="external_id";"CollectionProduct"==r.type()&&(e="id");var t=$.map(r.selectedItems(),function(t){return t.score[e]()});r.deleteScoresService({score_ids:t})},r.processUnarchived=function(e){$.each(r.scores(),function(t,o){e.scores.indexOf(o.score.external_id())>=0&&o.score.archived(!1)}),e.failed.length>0&&(0,d.standardAlertDialog)((0,u.pluralize)("errors.unableToRestore",e.failed.length))},r.unarchiveScores=function(){var e=$.map(r.selectedItems(),function(e){return e.score.external_id()});NF.apiService.restoreScores("",r.processUnarchived,{score_ids:e})},r.baseActions=[new NF.ListActionModel("delete","action.delete",r.deleteScores)],r.availableActions=[],r.editActions=ko.observableArray([]),r.selectedItems.subscribe(function(){r.editActions([]);for(var e=0;e<r.baseActions.length;e++)r.editActions.push(new NF.ListActionViewModel(r.baseActions[e],!1));for(var t=0;t<r.availableActions.length;t++)r.editActions.push(new NF.ListActionViewModel(r.availableActions[t],!1));for(var o=!1,n=[],i=0;i<r.selectedItems().length;i++){r.selectedItems()[i].score&&r.selectedItems()[i].score.archived()&&(o||(r.editActions.push(new NF.ListActionViewModel(new NF.ListActionModel("restore","action.restore",r.unarchiveScores),!0)),o=!0));for(var a=0;a<r.editActions().length;a++)r.editActions()[a].actionModel.rule(r.selectedItems()[i].score)?r.editActions()[a].enabled(!0):n.push(r.editActions()[a])}for(var s=0;s<n.length;s++)n[s].enabled(!1)})},Noteflight.AddToCollectionItemsViewModel=function(e){var t=this;t.addToCollection=function(){new function(e,t){var o=this;d.DialogViewModel.call(o),o.collections=[];for(var r=0;r<t().length;r++)o.collections.push(new v(t()[r]));o.selectedCollection=ko.observable(null),o.selectCollection=function(e){o.selectedCollection()&&o.selectedCollection().selected(!1),e.selected(!0),o.selectedCollection(e)},o.show=function(){(0,d.createAndShowDialog)({viewModel:o,templateName:"dialogs/addToCollection"})},o.addToCollection=function(){(0,d.hideCurrentDialog)();for(var r=0;r<t().length;r++)if(t()[r].collectionId()==o.selectedCollection().collectionId){t()[r].accept(e);break}}}(t,e.collections).show()},NF.session.current_user()&&NF.session.current_user().has_premium_features()&&t.baseActions.push(new NF.ListActionModel("organize","action.organize",t.addToCollection))};var _=function(e){var t=this;t.sites=ko.observableArray(),t.processSitesData=function(e){Noteflight.session.current_user().can_create_site();for(var o=0;o<e.communities.length;o++){var r=e.communities[o];r.active&&r.hostname!=Noteflight.session.community().hostname()&&t.sites.push(new y(r))}},t.copyToOtherSite=function(){0===t.sites().length&&NF.apiService.getSites("",t.processSitesData),new function(e){var t=this;t.scoresView=e,d.DialogViewModel.call(t),t.selectedSite=ko.observable(null);for(var o=0;o<e.sites().length;o++)if(e.sites()[o].selected()){t.selectedSite(e.sites()[o]);break}t.selectSite=function(e){t.selectedSite()&&t.selectedSite().selected(!1),e.selected(!0),t.selectedSite(e)},t.show=function(){(0,d.createAndShowDialog)({viewModel:t,templateName:"dialogs/copyToSite"})},t.scoresCopied=function(e){e.archive_notify?(0,d.standardAlertDialog)((0,u.resource)("content.scoresArchived")):(0,d.standardAlertDialog)((0,u.resource)("content.scoresCopiedSuccessfully"))},t.copyScoresToSite=function(e){NF.apiService.copyScores((0,u.resource)("listing.copying"),t.scoresCopied,e)},t.copyToSite=function(){if((0,d.hideCurrentDialog)(),t.selectedSite()){var o=$.map(e.selectedItems(),function(e){return e.score.external_id()});t.copyScoresToSite({hostname:t.selectedSite().hostname,score_ids:o})}}}(t).show()}};Noteflight.YourScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.deleting"),"moveToTrash"),NF.AddToCollectionItemsViewModel.call(t,e),_.call(t,e);NF.session.current_user()&&NF.session.current_user().sites_enabled()&&t.availableActions.push(new NF.ListActionModel("copyToOtherSite","action.copyToOtherSite",t.copyToOtherSite,function(e){return NF.session.current_user()&&NF.session.current_user().sites_enabled()&&!e.is_product_copy()})),t.checkAndAddScores=function(e){t.addScores(e)},t.canListCollections(!0),t.title=(0,u.resource)("listing.myScores"),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchScores("",t.processFetchedData,e)}},Noteflight.PrivateSearchViewModel=function(e){Noteflight.CommonScoresViewModel.call(this,e,(0,u.resource)("listing.deleting"),"moveToTrash"),NF.AddToCollectionItemsViewModel.call(this,e),_.call(this,e),this.title=ko.computed(function(){return(0,u.resource)("listing.privateSearch",e.searchTarget())}),this.loadingMessage=(0,u.resource)("listing.searching"),this.fetchWithSearchTargetFrom("/api/1.0/members/private_scores"),this.canListCollections(!0)},Noteflight.PrivatePublicSearchViewModel=function(e){Noteflight.PublicScoreListModel.call(this,e),this.title=ko.computed(function(){return(0,u.resource)("listing.privateSearch",e.searchTarget())}),this.loadingMessage=(0,u.resource)("listing.searching"),this.fetchWithSearchTargetFrom("/api/1.0/search/scores")},Noteflight.PrivateMarketplaceSearchViewModel=function(e){Noteflight.CommonScoresViewModel.call(this,e,(0,u.resource)("listing.deleting"),"moveToTrash"),this.scoreViewModel=Noteflight.CommonProductViewModel,this.editableList(!1),this.showFullDetail=!0,this.baseActions=[],this.title=ko.computed(function(){return(0,u.resource)("listing.privateSearch",e.searchTarget())}),this.loadingMessage=(0,u.resource)("listing.searching"),this.fetchWithSearchTargetFrom("/api/1.0/members/marketplace_scores")},Noteflight.PrivatePurchasedSearchViewModel=function(e){Noteflight.CommonScoresViewModel.call(this,e,(0,u.resource)("listing.deleting"),"moveToTrash"),this.scoreViewModel=Noteflight.CommonProductViewModel,this.editableList(!1),this.showFullDetail=!1,this.baseActions=[],this.title=ko.computed(function(){return(0,u.resource)("listing.privateSearch",e.searchTarget())}),this.loadingMessage=(0,u.resource)("listing.searching"),this.fetchWithSearchTargetFrom("/api/1.0/members/purchased_scores")},Noteflight.YourMarketplaceScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.deleting"),"moveToTrash"),t.heterogeneousList=ko.observable(!1),t.scoreViewModel=Noteflight.CommonProductViewModel,t.scorePublishedNotification=ko.observable(!1),this.showFullDetail=!0,NF.AddToCollectionItemsViewModel.call(t,e),t.canListCollections(!0),t.checkAndAddScores=function(e){t.addScores(e)},t.dismissNotification=function(){t.scorePublishedNotification()&&(t.scorePublishedNotification(!1),(0,p.dismissNotification)(p.SCORE_PUBLISHED))},t.superActivate=t.activate,t.activate=function(){t.superActivate(),t.dismissNotification()},t.baseActions=[],t.title=(0,u.resource)("listing.yourMarketplaceScores"),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchMarketplaceScores("",t.processFetchedData,e)},t.sortBy=ko.observable("favorites"),t.editableList(!1),(0,p.getNotification)(p.SCORE_PUBLISHED).then(function(e){return t.scorePublishedNotification(!!e)})},Noteflight.YourPurchasedScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.deleting"),"moveToTrash"),t.heterogeneousList=ko.observable(!1),t.scoreViewModel=Noteflight.CommonProductViewModel,this.showFullDetail=!1,NF.AddToCollectionItemsViewModel.call(t,e),t.canListCollections(!0),t.baseActions=[],t.title=(0,u.resource)("listing.yourPurchasedScores"),t.sortBy=ko.observable("title"),t.editableList(!1),t.sortOptions=ko.observableArray([{order:"most_recent",label:(0,u.resource)("order.mostRecent")},{order:"title",label:(0,u.resource)("order.title")},{order:"composer",label:(0,u.resource)("order.composer")}]),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchPurchasedScores("",t.processFetchedData,e)}},Noteflight.YourPublicScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.deleting"),"moveToTrash"),t.heterogeneousList=ko.observable(!1),NF.AddToCollectionItemsViewModel.call(t,e),_.call(t,e),t.canListCollections(!0),t.checkAndAddScores=function(e){for(var o=0;o<e.length;o++)"public"==e[o].scoreType()&&t.addScores([e[o]])},t.title=(0,u.resource)("listing.yourPublicScores"),t.fetchScoresService=Noteflight.getService("/api/1.0/members/scores",t,t.processFetchedData),t.sortBy=ko.observable("favorites")},Noteflight.SharedWithYouScoreViewModel=function(e,t){Noteflight.CommonScoreViewModel.call(this,e,t),this.scoreAuthor(t.author().username()),this.dragStart=function(e){return null}},Noteflight.ScoresSharedWithYouViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.removing"),null),t.heterogeneousList=ko.observable(!1),t.baseActions=[new NF.ListActionModel("remove","action.remove",t.deleteScores)],t.scoreViewModel=Noteflight.SharedWithYouScoreViewModel,t.title=(0,u.resource)("listing.scoresSharedWithYou"),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchSharedScores("",t.processFetchedData,e)},t.deleteScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.removeSharedScores(t.deleteScoresReporter,t.processDeleted,e)}},Noteflight.TemplateCopiesViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.removing"),null),t.heterogeneousList=ko.observable(!1),t.baseActions=[new NF.ListActionModel("remove","action.remove",t.deleteScores)],t.scoreViewModel=Noteflight.SharedWithYouScoreViewModel,t.title=ko.computed(function(){return e.templateScoreName()&&(0,u.resource)("listing.templateCopies",e.templateScoreName())}),t.processTemplateCopies=function(o){t.processFetchedData(o),e.templateScoreName(o.template.title)},ko.computed(function(){t.fetchScoresService=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.fetchTemplateCopies(t,t.processTemplateCopies,Object.assign({template_id:e.templateScoreId()},o))},t.deleteScoresService=function(e){NF.apiService.removeScores(t.deleteScoresReporter,t.processDeleted,e)}}),t.previousTemplateScoreId=null,t.activate=function(){(t.virginal||t.previousTemplateScoreId!=e.templateScoreId())&&(t.previousTemplateScoreId=e.templateScoreId(),t.reset())}},Noteflight.YourFavesScoreViewModel=function(e,t){Noteflight.CommonScoreViewModel.call(this,e,t),this.scoreAuthor(t.author().username()),this.dragStart=function(e){return null}},Noteflight.YourFavesScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.removing"),null),t.heterogeneousList=ko.observable(!1),t.baseActions=[new NF.ListActionModel("remove","action.remove",t.deleteScores)],t.scoreViewModel=Noteflight.YourFavesScoreViewModel,t.title=(0,u.resource)("listing.yourFaves"),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchFavoriteScores("",t.processFetchedData,e)},t.deleteScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};NF.apiService.removeFavoriteScores(t.deleteScoresReporter,t.processDeleted,e)},t.sortBy=ko.observable("title")},Noteflight.YourBooksViewModel=function(e){var t=this;Noteflight.ColumnLayoutViewModel.call(this,220,"#books"),t.columnsCSS=ko.computed(function(){var e=t.columnCount();return t.columnCount()>8&&(e=8),"columns"+e}),t.title=(0,u.resource)("listing.myBooks"),t.isCurrent=ko.computed(function(){return"yourBooks"==e.state()}),t.listType=ko.observable("books"),t.currentOrder=ko.observable("most_recent"),t.sortOptions=ko.observableArray([{order:"most_recent",label:(0,u.resource)("order.mostRecent")},{order:"title",label:(0,u.resource)("order.title")}]),t.virginal=ko.observable(!0),t.books=ko.observableArray([]),t.busy=ko.observable(!1),t.remaining=ko.observable(!1),t.handleFetchedBooks=function(e){if(e.books){var o=ko.utils.arrayMap(e.books,function(e){return ko.mapping.fromJS(e,Noteflight.BookSummaryViewModel.booksMapping)});t.books(o)}},t.fetchBooks=function(){NF.apiService.fetchPrivateBooks(t,t.handleFetchedBooks)},t.clear=function(){t.virginal(!0),t.books.removeAll()},t.reset=function(){t.clear(),t.fetchBooks(),t.virginal(!1)},t.activate=function(){t.virginal()&&t.reset()},t.count=ko.observable("")};var S=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=m(this,g(t).call(this))).title=(0,u.resource)("listing.messages"),o.messagesNotRead=ko.observable(0),o.isCurrent=ko.computed(function(){return"yourMessages"==e.state()}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i.default),t}();Noteflight.YourActivityStreamViewModel=function(e){var t=this;t.busy=ko.observable(!1),Noteflight.ActivityStreamViewModel.call(t),t.title=(0,u.resource)("listing.activity"),t.currentFilter=ko.observable("allNews"),t.currentFilter.subscribe(function(){t.reset()}),t.filterOptions=ko.observableArray([{filter:"allNews",label:(0,u.resource)("filter.allNews")},{filter:"youNews",label:(0,u.resource)("filter.youNews")},{filter:"followNews",label:(0,u.resource)("filter.followNews")}]),t.isCurrent=ko.computed(function(){return"yourActivityStream"==e.state()}),t.createIterator=function(){switch(t.currentFilter()){case"youNews":return new Noteflight.ActivitySourceEventsIterator("personal_user:"+t.userId());case"followNews":return new Noteflight.ActivityStreamEventsIterator;default:return new Noteflight.ActivityStreamEventsIterator({personal_source:"personal_user:"+t.userId()})}},t.setActivityStreamLastViewedTimeService=Noteflight.postService("/api/1.0/activity_stream/activity_stream_viewed",t),t.mostRecentActivityEventId=ko.observable(),t.newsLastViewedTime=ko.observable(),t.notifyPanelActivated=function(){var e=t.newsLastViewedTime(),o=(new Date).getTime();(!e||o>e)&&(t.setActivityStreamLastViewedTimeService(),t.newsLastViewedTime(o))},t.hasNew=ko.computed(function(){var e=t.newsLastViewedTime(),o=t.mostRecentActivityEventId(),r=o?parseInt(o.split("|")[0],10):null;return r&&(!e||e<r)})},Noteflight.YourTrashScoreViewModel=function(e,t){Noteflight.CommonScoreViewModel.call(this,e,t),this.navigateToScore=function(){return(0,d.standardAlertDialog)((0,u.resource)("listing.cantOpenTrashScore")),!1},this.dragStart=function(e){return null}},Noteflight.YourTrashScoresViewModel=function(e){var t=this;Noteflight.CommonScoresViewModel.call(t,e,(0,u.resource)("listing.restoring"),"restoreScores"),t.baseActions=[new NF.ListActionModel("restore","action.restore",t.deleteScores)],t.scoreViewModel=Noteflight.YourTrashScoreViewModel,t.title=(0,u.resource)("listing.yourTrash"),t.fetchScoresService=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.busy(!0),NF.apiService.fetchTrashScores("",t.processFetchedData,e)},t.processRestored=function(e){t.processDeleted(e),e.failed.length>0&&t.deleteScoresReporter.errors.push({message:(0,u.pluralize)("errors.unableToRestore",e.failed.length)})},t.deleteScoresService=function(e){NF.apiService.restoreScores(t.deleteScoresReporter,t.processRestored,e)},t.sortBy=ko.observable("title")},Noteflight.RedeemedChapterSectionViewModel=function(e){var t=this;ko.mapping.fromJS(e,{},t),t.url=ko.computed(function(){return"scoreLink"==t.type()?"/scores/view/"+t.externalId():null})},Noteflight.RedeemedChapterViewModel=function(e){var t=this;t.expanded=ko.observable(!1);var o={sections:{create:function(e){return new Noteflight.RedeemedChapterSectionViewModel(e.data)}}};ko.mapping.fromJS(e,o,t),t.toggleExpanded=function(){t.expanded(!t.expanded())}},Noteflight.RedeemedContentViewModel=function(e,t){var o=this,r={chapters:{create:function(e){return new Noteflight.RedeemedChapterViewModel(e.data)}}};o.authors=ko.observableArray([]),ko.mapping.fromJS(t,r,o),o.isCurrent=ko.computed(function(){return"redeemedContent"==e.state()&&e.redeemedContentId()==o.id()}),o.listType=ko.observable(o.type()),o.activate=function(){},o.bookImageURL=ko.computed(function(){if(o.bookImage)return"http://assets.noteflight.com/content_items/images/norton_book_demo/"+o.bookImage()})},(0,c.addRoute)("loggedInHome","/home#",Noteflight.PrivateScoresModel,{init:!1,state:"root"}),(0,c.addRoute)("dashboard","/home#/dashboard",Noteflight.PrivateScoresModel,{init:!1,state:"dashboard"}),(0,c.addRoute)("yourScores","/home#/yourScores",Noteflight.PrivateScoresModel,{init:!1,state:"yourScores"}),(0,c.addRoute)("yourMarketplaceScores","/home#/yourmarketplacescores",Noteflight.PrivateScoresModel,{init:!1,state:"yourMarketplaceScores"}),(0,c.addRoute)("yourPurchasedScores","/home#/yourpurchasedscores",Noteflight.PrivateScoresModel,{init:!1,state:"yourPurchasedScores"}),(0,c.addRoute)("yourPublicScores","/home#/yourpublicscores",Noteflight.PrivateScoresModel,{init:!1,state:"yourPublicScores"}),(0,c.addRoute)("scoresSharedWithYou","/home#/scoressharedwithme",Noteflight.PrivateScoresModel,{init:!1,state:"scoresSharedWithYou"}),(0,c.addRoute)("yourFavesScores","/home#/yourfavesscores",Noteflight.PrivateScoresModel,{init:!1,state:"yourFavesScores"}),(0,c.addRoute)("activityStream","/home#/activity",Noteflight.PrivateScoresModel,{init:!1,state:"yourActivityStream"}),(0,c.addRoute)("messages","/home#/messages",Noteflight.PrivateScoresModel,{init:!1,state:"yourMessages"}),(0,c.addRoute)("yourBooks","/home#/yourbooks",Noteflight.PrivateScoresModel,{init:!1,state:"yourBooks"}),(0,c.addRoute)("yourTrashScores","/home#/yourtrashscores",Noteflight.PrivateScoresModel,{init:!1,state:"yourTrashScores"}),(0,c.addRoute)("collection","/home#/collection/{collectionId}",Noteflight.PrivateScoresModel,{init:!1,state:"collection"}),(0,c.addRoute)("privateSearch","/private_search:?searchTarget:#",Noteflight.PrivateScoresModel,{init:!1,state:"searchPrivate"}),(0,c.addRoute)("privateMarketplaceSearch","/private_mp_search:?searchTarget:#",Noteflight.PrivateScoresModel,{init:!1,state:"searchMarketplacePrivate"}),(0,c.addRoute)("privatePurchasedSearch","/private_purchased_search:?searchTarget:#",Noteflight.PrivateScoresModel,{init:!1,state:"searchPurchasedPrivate"}),(0,c.addRoute)("templateCopies","/home#/template/{templateScoreId}",Noteflight.PrivateScoresModel,{init:!1,state:"templateCopies"}),(0,c.addRoute)("redeemedContent","/home#/redeemedContent/{redeemedContentId}",Noteflight.PrivateScoresModel,{init:!1,state:"redeemedContent"})},function(e,t,o){e.exports=o.p+"images/messages_avatar-46b131bec2516e7bc5d2f760dda7e353.png"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Period=t.default=void 0;s(o(1149));var r=s(o(1150)),n=s(o(1151)),i=s(o(32)),a=o(0);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){l(this,e),this.title=ko.observable((0,a.resource)("content.dashboard")),this.listType=ko.observable("dashboard"),this.isCurrent=ko.computed(function(){return"dashboard"==t.state()}),this.charts=ko.observableArray([]),this.periods=[new d("period.last30Days",28,4),new d("period.last3Months",88,4),new d("period.last6Months",180,6),new d("period.last12Months",360,12)],this.periodSelectedValue=ko.observable(this.periods[3].days),this.lastPeriodSelected=null,this.today=new Date,this.processFetchedData=this.processFetchedData.bind(this),this.initializeComputeds()}return function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(e,[{key:"initializeComputeds",value:function(){var e=this;this.startDate=ko.computed(function(){return(new Date.today).add(-(e.periodSelectedValue()-1)).days()}),this.periodSelected=ko.computed(function(){for(var t=0;t<e.periods.length;t++)if(e.periodSelectedValue()==e.periods[t].days)return e.periods[t]}),this.timeIncrementInSeconds=ko.computed(function(){var t=e.periodSelected();return t.days/t.chunks*24*60*60}),ko.computed(function(){e.lastPeriodSelected!=e.periodSelectedValue()&&(e.lastPeriodSelected=e.periodSelectedValue(),e.populateDashboard())}).extend({throttle:50})}},{key:"populateDashboard",value:function(){var e=this;if(this.isCurrent())if(NF.session.current_user().has_premium_features()){var t=[];t.push(new Promise(function(t,o){Noteflight.apiService.viewsByScore((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,max_identified:4})})),t.push(new Promise(function(t,o){Noteflight.apiService.viewsByTimeframe((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,time_increment:e.timeIncrementInSeconds()})})),t.push(new Promise(function(t,o){Noteflight.apiService.commentsByScore((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,max_identified:4})})),t.push(new Promise(function(t,o){Noteflight.apiService.commentsByTimeframe((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,time_increment:e.timeIncrementInSeconds()})})),t.push(new Promise(function(t,o){Noteflight.apiService.favoritesByScore((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,max_identified:4})})),t.push(new Promise(function(t,o){Noteflight.apiService.favoritesByTimeframe((0,a.resource)("action.loading"),function(e){t(e)},{start_date:e.startDate(),end_date:e.today,time_increment:e.timeIncrementInSeconds()})})),Promise.all(t).then(this.processFetchedData)}else(0,i.default)((0,a.resource)("content.dashboard"),(0,a.resource)("content.useScoreDashboard"),"score_dashboard",{cancelPath:NF.paths.yourScores()})}},{key:"processFetchedData",value:function(e){this.charts([]),this.charts.push({pie:ko.observable(new r.default("viewsByScore",e[0].data_points,this.periodSelected())),timeframe:ko.observable(new n.default("viewsByTimeframe",e[1].data_points,this.periodSelected()))}),this.charts.push({pie:ko.observable(new r.default("commentsByScore",e[2].data_points,this.periodSelected())),timeframe:ko.observable(new n.default("commentsByTimeframe",e[3].data_points,this.periodSelected()))}),this.charts.push({pie:ko.observable(new r.default("favoritesByScore",e[4].data_points,this.periodSelected())),timeframe:ko.observable(new n.default("favoritesByTimeframe",e[5].data_points,this.periodSelected()))})}},{key:"activate",value:function(){this.populateDashboard()}},{key:"clear",value:function(){}},{key:"clearSearch",value:function(){}}]),e}();t.default=u;var d=function e(t,o,r){l(this,e),this.label=(0,a.resource)(t),this.days=o,this.chunks=r};t.Period=d},function(e,t,o){e.exports=o(7)(587)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(309)),n=o(0),i=o(15);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=["#eaab54","#f87547","#968d84","#77b4e0","#cf7d2b"],f=function(e){function t(e,o,r){var n;return s(this,t),(n=c(this,u(t).call(this,e,o,r))).legendElements=ko.observableArray([]),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"doCreateChart",value:function(){for(var e=!0,t=this.data.top,o=0;o<t.length;o++)this.chartData.push(t[o].count),this.total(this.total()+t[o].count),this.chartLabels.push(t[o].title),this.legendElements.push(new h(t[o].title,t[o].count,o));this.data.remainder&&(this.chartData.push(this.data.remainder),this.total(this.total()+this.data.remainder),this.chartLabels.push((0,n.resource)("content.otherScores")),this.legendElements.push(new h((0,n.resource)("content.otherScores"),this.data.remainder,this.chartLabels.length-1))),this.backgroundColors=p.slice(0,this.chartLabels.length),0===this.data.top.length&&(this.chartData.push(1),this.chartLabels.push((0,n.resource)("content.noScoresShown")),this.backgroundColors=["#e0d9d2"],e=!1),this.displayChart(this.chartData,this.chartLabels,this.backgroundColors,e)}},{key:"displayChart",value:function(e,t,o,r){var n=document.getElementById(this.id()).getContext("2d");new Chart(n,{type:"doughnut",data:{labels:t,datasets:[{data:e,backgroundColor:o}]},options:{cutoutPercentage:80,legend:{display:!1},tooltips:{enabled:r,bodyFontSize:9,displayColors:!1},aspectRatio:1}})}}]),t}();t.default=f;var h=function e(t,o,r){s(this,e),this.title=ko.observable(t),this.color=ko.observable(p[r]),this.formattedTotal=ko.observable((0,i.formatCommas)(o))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(309)),n=o(20);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e,o,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=s(this,l(t).call(this,e,o,r))).timeIncrement=r.days/r.chunks,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"doCreateChart",value:function(){this.chartData=this.data.values,this.total(this.data.offset);for(var e=Number.MAX_SAFE_INTEGER,t=0,o=0,r=0;r<this.chartData.length;r++){var i=(new Date.today).add(-o).days();this.chartLabels.unshift((0,n.getDayAndMonth)(i)),o+=this.timeIncrement,this.total(this.total()+this.chartData[r]),this.chartData[r]=this.total(),e=Math.min(e,this.chartData[r]),t=Math.max(t,this.chartData[r])}0===this.chartData.length&&(t=0,e=0);var a={};a.stepSize=Math.max(1,Math.ceil((t-e)/4)),a.bottomLine=Math.max(0,e-a.stepSize),a.topLine=a.bottomLine+5*a.stepSize,this.displayChart(this.chartData,this.chartLabels,a)}},{key:"displayChart",value:function(e,t,o){var r=o.bottomLine||0,n=o.topLine||10,i=o.stepSize||1,a=document.getElementById(this.id()).getContext("2d");new Chart(a,{type:"line",data:{labels:t,datasets:[{data:e,borderColor:"#70b6f8",pointBorderColor:"#70b6f8",pointBackgroundColor:"white",backgroundColor:"transparent"}]},options:{legend:{display:!1},tooltips:{displayColors:!1},scales:{yAxes:[{ticks:{min:r,max:n,stepSize:i}}],xAxes:[{gridLines:{display:!1}}]}}})}}]),t}();t.default=u},function(e,t,o){"use strict";var r=d(o(310)),n=d(o(247)),i=d(o(248)),a=d(o(1153)),s=d(o(1154)),l=o(2),c=o(0),u=o(20);function d(e){return e&&e.__esModule?e:{default:e}}Noteflight.ProfileViewModel=function(){var e=this;e.showSorting=ko.observable(!0),Noteflight.ScoreListFamilyModel.call(this),e.templateName=ko.observable("content/profile"),e.formatDate=u.formatDate,Noteflight.GenericPageViewModel.call(e),e.session=Noteflight.session,e.userId=ko.observable(),e.user=ko.observable(),e.myFollow=ko.observable(),e.searchTarget=ko.observable(""),e.hideNewGroup=ko.observable(!0),e.editingList=ko.observable(!1),e.scrollingBreakpoint=ko.observable(),e.smallUserInfo=ko.observable(!1),e.avatarSize=ko.computed(function(){return e.smallUserInfo()?"small":"big"}),e.scrollingBreakpointPx=ko.computed(function(){return e.scrollingBreakpoint()&&e.smallUserInfo()?"".concat(e.scrollingBreakpoint()+30,"px"):"0px"}),e.imageUploaderHeader=ko.observable(null),e.imageUploaderAvatar=ko.observable(null),e.isUserMyself=ko.computed(function(){return e.user()&&NF.session.current_user()&&e.user().external_id()==NF.session.current_user().external_id()}),e.isUserPremium=ko.computed(function(){return e.user()&&e.user().has_premium_features()}),e.showHeaderImage=ko.computed(function(){return e.isUserPremium()&&!e.smallUserInfo()}),e.goToFacebook=function(){window.open("https://www.facebook.com/".concat(e.user().profile().facebook_username()))},e.goToTwitter=function(){window.open("https://www.twitter.com/".concat(e.user().profile().twitter_username()))},e.goToInstagram=function(){window.open("https://www.instagram.com/".concat(e.user().profile().instagram_username()))},e.init=function(){setTimeout(function(){e.scrollingBreakpoint($("#headerImageContainer").height()+$("#userInfoContainer").height())},500)},e.scrolled=function(t,o){NF.IsPhoneLayout()||(e.smallUserInfo()?$(".profilePage").scrollTop()<e.scrollingBreakpoint()&&e.smallUserInfo(!1):$(".profilePage").scrollTop()>e.scrollingBreakpoint()&&e.smallUserInfo(!0),e.currentListing().scrolled&&e.currentListing().scrolled(t,o))},e.viewPrivateScores=ko.computed(function(){var t=e.session.current_user(),o=e.session.community_member(),r=t&&t.external_id()!=e.userId(),n=e.user()&&e.user().role&&"student"==e.user().role();return r&&(t&&t.effective_admin()||o&&"instructor"==o.sso_user_role()&&n)}),e.processUserData=function(t){e.user(new Noteflight.User(t.user)),e.myFollow(new Noteflight.MyFollowViewModel(e.user())),e.myFollow().events.subscribe(e.followStatusChanged,e,"followStatusChanged"),e.initViewType(),e.selectView(),e.state.subscribe(e.selectView),e.imageUploaderHeader(new i.default({imageUrl:e.user().headerImage,editable:e.isUserMyself(),isPremium:e.isUserPremium(),externalId:e.user().external_id()})),e.imageUploaderAvatar(new n.default({imageUrl:e.user().avatar,editable:e.isUserMyself(),externalId:e.user().external_id(),uploaderId:"avatarUploader",imageSize:e.avatarSize}))},e.followStatusChanged=function(t){e.refreshFollowingsFollowers(),e.currentListing()==e.followersListingModel?e.followersListingModel.reset():e.followersListingModel.clear()},e.onUserError=function(e){e[0]&&e[0].code&&"userNotFound"==e[0].code&&(0,l.throw404)()},e.userId.subscribe(function(t){NF.apiService.getUser(e,e.processUserData,{user_id:t},{fail:e.onUserError}),e.scoresListModel.userId(t),e.favoriteScoresListModel.userId(t),e.groupListModel.userId(t),e.followingListingModel.userId(t),e.followersListingModel.userId(t),e.activityStreamModel.userId(t),e.marketplaceListingModel.userId(t)}),e.processFolloweesFollowersData=function(t){e.user()&&e.user().profile()&&e.user().profile().followingsFollowersData(t)};var t=Noteflight.postService("/api/1.0/activity_stream/followees_followers",e,e.processFolloweesFollowersData);e.user.subscribe(function(){e.refreshFollowingsFollowers()}),e.refreshFollowingsFollowers=function(){t({user_id:e.userId(),limit:14})},e.scoresListModel=new Noteflight.MembersScoresListModel(e),e.favoriteScoresListModel=new Noteflight.MembersFavoriteScoresListModel(e),e.groupListModel=new s.default(e,e.user()),e.activityStreamModel=new Noteflight.MembersActivityStreamViewModel(e),e.followingListingModel=new Noteflight.FollowingListingViewModel(e),e.followersListingModel=new Noteflight.FollowersListingViewModel(e),e.marketplaceListingModel=new a.default,e.listModels={scores:e.scoresListModel,favoriteScores:e.favoriteScoresListModel,groups:e.groupListModel,activity:e.activityStreamModel,following:e.followingListingModel,followers:e.followersListingModel,marketplace:e.marketplaceListingModel},e.reset=function(){for(var t in e.listModels)e.listModels[t].clear&&e.listModels[t].clear()},e.reset(),e.selectDefaultView=function(){return e.user().has_seller_account()?"marketplace":"publicScores"},e.selectView=function(){"default"==e.state()&&e.state(e.selectDefaultView());var t=e.listModels[e.state()];t||(t=e.scoresListModel),t.activate&&t.activate(),e.currentListing(t)},e.checkAtBottom=function(t,o){e.currentListing()&&e.currentListing().checkAtBottom(t,o)},e.tabGroupMap={publicScores:"tabGroup1",favoriteScores:"tabGroup1",groups:"tabGroup1",activity:"tabGroup1",following:"tabGroup2",followers:"tabGroup2"},e.tabGroup=ko.computed(function(){return e.tabGroupMap[e.state()]})},Noteflight.MembersScoresListModel=function(e){var t=this;Noteflight.ScoreListModel.call(t,e),t.scoreViewModel=Noteflight.CommonScoreViewModel;var o=Noteflight.postService("/api/1.0/members/private_scores",t,t.processFetchedData),r=Noteflight.getService("/api/1.0/members/scores",t,t.processFetchedData);t.fetchScoresService=function(){e.viewPrivateScores()?(t.heterogeneousList(!0),o.apply(t,arguments)):r.apply(t,arguments)},t.title=ko.computed(function(){return e.user()&&e.user().username()+" : "+(0,c.resource)(e.viewPrivateScores()?"content.scores":"content.publicScores")})},Noteflight.MembersFavoriteScoresListModel=function(e){Noteflight.PublicScoreListModel.call(this,e),this.fetchScoresService=Noteflight.getService("/api/1.0/members/favorite_scores",this,this.processFetchedData),this.title=ko.computed(function(){return e.user()&&e.user().username()+" : "+(0,c.resource)("content.favorites")})},Noteflight.MembersActivityStreamViewModel=function(e){this.busy=ko.observable(!1),this.showSorting=ko.observable(!1),Noteflight.ActivityStreamViewModel.call(this),this.title=ko.computed(function(){return e.user()&&"".concat(e.user().username(),":").concat((0,c.resource)("content.activity"))}),this.isCurrent=ko.computed(function(){return"activity"==e.state()})},Noteflight.MembersListingViewModel=function(e){var t=this;Noteflight.ColumnLayoutViewModel.call(this,350,"#members"),t.virginal=!0,t.userId=ko.observable(),t.startIndex=ko.observable(),t.remaining=ko.observable(0),t.busy=ko.observable(!1),t.listType=ko.observable("members"),t.loadingMessage=(0,c.resource)("action.loading"),t.members=ko.observableArray([]),t.activate=function(){t.virginal&&t.reset()},t.clear=function(){t.members.removeAll(),t.remaining(0),t.startIndex(0),t.virginal=!0},t.reset=function(){t.clear(),t.virginal=!1,t.fetchMembers()},t.batchSize=20,t.fetchMembers=function(){t.getMembersService({limit:t.batchSize,offset:t.startIndex(),user_id:t.userId()})},t.processMembersData=function(e){t.remaining(e.remaining);var o=e.members;t.startIndex((t.startIndex()?t.startIndex():0)+o.length);for(var n=0;n<o.length;n++){var i=new Noteflight.User(o[n]);t.members.push(r.default.createMemberFromUser(i))}},Noteflight.PageableViewModel.call(this,t.fetchMembers)},Noteflight.FollowingListingViewModel=function(e){var t=this;t.getMembersService=Noteflight.postService("/api/1.0/activity_stream/followees",t,function(e){t.processFolloweesData(e)}),t.processFolloweesData=function(e){for(var o=[],r=0;r<e.followees.length;r++)o.push(e.followees[r].source_details);var n={members:o,remaining:e.remaining};t.processMembersData(n)},Noteflight.MembersListingViewModel.call(this,e)},Noteflight.FollowersListingViewModel=function(e){var t=this;t.getMembersService=Noteflight.postService("/api/1.0/activity_stream/followers",t,function(e){t.processMembersData(e)}),Noteflight.MembersListingViewModel.call(this,e)},(0,l.addRoute)("profile","/profile/{userId}#",Noteflight.ProfileViewModel,{state:"default"}),(0,l.addRouteAlias)("r2","profile","/members/{userId}#"),(0,l.addRoute)("profilePublicScores","/profile/{userId}#/public",Noteflight.ProfileViewModel,{state:"publicScores"}),(0,l.addRouteAlias)("r2","profilePublicScores","/members/{userId}#"),(0,l.addRoute)("profilePublicCollections","/profile/{userId}#/collections",Noteflight.ProfileViewModel,{state:"publicScores"}),(0,l.addRoute)("profileFavoriteScores","/profile/{userId}#/favorites",Noteflight.ProfileViewModel,{state:"favoriteScores"}),(0,l.addRoute)("profileGroups","/profile/{userId}#/groups",Noteflight.ProfileViewModel,{state:"groups"}),(0,l.addRoute)("profileMarketplace","/profile/{userId}#/marketplace",Noteflight.ProfileViewModel,{state:"marketplace"}),(0,l.addRoute)("profileActivity","/profile/{userId}#/activity",Noteflight.ProfileViewModel,{state:"activity"}),(0,l.addRoute)("profileFollowing","/profile/{userId}#/following",Noteflight.ProfileViewModel,{state:"following"}),(0,l.addRoute)("profileFollowers","/profile/{userId}#/followers",Noteflight.ProfileViewModel,{state:"followers"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(127)),n=o(235),i=o(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,l(t).call(this))).paginationCallback=e._getProducts,e.sortOrder("most_recent"),e.userId=ko.observable(),e.listType=ko.observable("marketplace"),e.products=ko.observableArray([]),e._gotProducts=e._gotProducts.bind(u(u(e))),e._createSubscribers(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n.PageableViewModel),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"scrolled",value:function(e,t){this.checkAtBottom(e,t)}},{key:"_createSubscribers",value:function(){var e=this;this.userId.subscribe(function(){e._getProducts()})}},{key:"_gotProducts",value:function(e){var t=this;this.busy(!1),this.count(e.count),this.remaining(e.remaining),this.startIndex(e.count-e.remaining);for(var o=e.products,n=function(e){var n=new r.default(o[e]);n.coverArtViewModel=ko.computed(function(){return{coverArt:n.coverArt,size:ko.observable("phoneListSize"),editable:ko.observable(!1)}}),t.products.push(n)},i=0;i<o.length;i++)n(i)}},{key:"_getProducts",value:function(){this.busy(!0);var e={start_index:this.startIndex(),max_count:36,order:this.sortOrder(),user_id:this.userId()};NF.apiService.getProductsByUser((0,i.resource)("action.loading"),this._gotProducts,e)}}]),t}();t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(217),n=o(0);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,l(t).call(this,e))).showSorting=ko.observable(!0),r.user=o,r.userId=ko.observable(),r.targetId=r.userId,r.state=ko.observable("yours"),r.listType=ko.observable("groups"),r.listingType="public",r.title=ko.computed(function(){return r.user&&r.user.username()+" : "+(0,n.resource)("content.groups")}),r.userId.subscribe(function(){r.reset()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.GroupsListingViewModel),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"clear",value:function(){}},{key:"activate",value:function(){}}]),t}();t.default=u},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(123)),n=o(2),i=o(8),a=o(16),s=o(0),l=o(3);Noteflight.PublicScoresViewModel=function(e,t){var o=this;function i(){var e=NF.getSearchParametersFromQuery(decodeURIComponent(o.searchQuery()));e.keyword&&o.searchTarget(e.keyword[0]),o.filter&&o.filter().populateFilterSelectionFromUrl(e)}Noteflight.ScoreListFamilyModel.call(this),o.name=ko.observable("publicScores"),o.libraryPath=ko.observable(),o.templateName=ko.observable("content/publicScores"),o.libraryViewModel=ko.observable(t),o.library=t&&t.library||ko.observable(null),o.libraryId=ko.computed(function(){return o.library()&&o.library().id()}),Noteflight.GenericPageViewModel.call(o),o.activeHeaderTag("community"),o.doesSearch(!0),o.showSearchBarForMobile(!0),o.doesFilter(!0),o.state=ko.observable(),o.showSearchTarget=ko.observable(!1),o.state.subscribe(function(e){o.showFilter("search"==e&&!NF.IsPhoneLayout()),o.showSearchTarget("search"==e)}),this.searchConfiguration={score:4,marketplace_with_contribs:2,group:1},o.searchQuery=e||ko.observable(""),o.searchTarget=ko.observable(),o.searchTargetToShow=ko.computed(function(){return decodeURIComponent(o.searchTarget())}),ko.computed(function(){o.searchQuery()?i():o.searchTarget(null)}),o.updateEmptyUrlCallback=function(){o.searchTarget(null)},o.filterChanged=ko.observable(!1),o.filterUpdatedCallback=function(){o.filterChanged(!0),o.filter().updateUrl(o.searchTarget(),o.updateEmptyUrlCallback),!o.searchTarget()&&o.filter().noFiltersApplied&&(0,n.navigate)(NF.paths.allScores())},o.filter=ko.observable(new r.default({callback:o.filterUpdatedCallback})),o.isCommunity=ko.observable(!0),o.allScoreListModel=new Noteflight.AllScoreListModel(o),o.recentScoreListModel=new Noteflight.RecentScoreListModel(o),o.popularScoreListModel=new Noteflight.PopularScoreListModel(o),o.publicSearchListModel=new Noteflight.PublicSearchListModel(o),o.groupAllScoreListModel=new Noteflight.GroupAllScoreListModel(o),o.isReadOnly=ko.observable(!1),o.groupId=ko.observable(),o.libraryScoreListModel=new Noteflight.LibraryAllScoreListModel(o),o.allScoresPath=ko.observable((0,n.path)("allScores")),o.risingScoresPath=ko.observable((0,n.path)("risingScores")),o.popularScoresPath=ko.observable((0,n.path)("popularScores")),o.listModels={allScores:o.allScoreListModel,recentScores:o.recentScoreListModel,popularScores:o.popularScoreListModel,search:o.publicSearchListModel,groupAllScores:o.groupAllScoreListModel,libraryScores:o.libraryScoreListModel},o.reset=function(){for(var e in o.listModels)o.listModels[e].clear()},o.reset(),o.selectView=function(){var e=o.listModels[o.state()];e||(e=o.allScoreListModel),"search"!=o.state()&&(o.filter().clear(),o.searchTarget(null),setTimeout(function(){o.filter().initialize()},1e3)),o.order()&&e.sortBy(o.order()),e.activate(),o.currentListing(e)},o.checkAtBottom=function(e,t){o.currentListing()&&o.currentListing().checkAtBottom(e,t)},o.clearSearch=function(){o.searchTarget(null),o.filter().updateUrl(o.searchTarget(),o.updateEmptyUrlCallback),!o.searchTarget()&&o.filter().noFiltersApplied&&(0,n.navigate)(NF.paths.allScores())},o.onNavigate=function(){o.initViewType(),o.selectView(),i(),o.filterChanged(!0)},o.search=function(e){Noteflight.session.community().enable_browse_and_search()||(0,l.standardAlertDialog)((0,s.resource)("search.scoreSearchDisallowed"))},o.showGroupScores=function(e,t){o.isReadOnly=e.isReadOnly,o.groupId=e.parent.groupId,o.groupAllScoreListModel.editableList(t),o.groupAllScoreListModel.showScores(o.isCommunity(),o.groupId),o.currentListing(o.groupAllScoreListModel),o.onNavigate()},o.showLibraryScores=function(){o.groupId=o.libraryViewModel().groupId,o.currentListing(o.libraryScoreListModel),o.onNavigate()},o.closeFilter=function(){o.showFilter(!1)}},Noteflight.PublicScoreViewModel=function(e,t){Noteflight.CommonScoreViewModel.call(this,e,t),t.contentLibraryId()||this.scoreAuthor(t.author().username()),t.sharer&&t.sharer()&&(this.scoreSharedBy=t.sharer().username())},Noteflight.PublicScoreListModel=function(e){this.path=function(e){return NF.paths.publicSearch({searchQuery:e})},(0,a.setTitleAndMeta)(this,"title.scores","meta.scores"),Noteflight.ScoreListModel.call(this,e),this.scoreViewModel=Noteflight.PublicScoreViewModel},Noteflight.AllScoreListModel=function(e){Noteflight.PublicScoreListModel.call(this,e),this.label=(0,s.resource)("content.latest"),this.fetchScoresService=Noteflight.getService("/api/1.0/browse/scores",this,this.processFetchedData)},Noteflight.RecentScoreListModel=function(e){Noteflight.PublicScoreListModel.call(this,e),this.label=(0,s.resource)("content.popular"),this.fetchScoresService=Noteflight.getService("/api/1.0/top/scores",this,this.processFetchedData,{params:{age:"week"}})},Noteflight.PopularScoreListModel=function(e){Noteflight.PublicScoreListModel.call(this,e),this.label=(0,s.resource)("content.allTime"),this.fetchScoresService=Noteflight.getService("/api/1.0/top/scores",this,this.processFetchedData)},Noteflight.GroupAllScoreListModel=function(e){var t=this;Noteflight.PublicScoreListModel.call(t,e),t.removeScoreFromGroup=function(e){NF.apiService.removeScoreFromGroup((0,s.resource)("action.removing"),function(){!function(e){e.items.remove(e.selectedItem())}(e)},{group_id:e.parent.groupId(),score_external_id:e.selectedItem().score.external_id()})},t.baseActions=[new NF.ListActionModel("remove","action.remove",function(){t.removeScoreFromGroup(t)})],t.showSocialBitsList(!1),t.showScores=function(e,o){t.fetchScoresService=e?Noteflight.getService("/api/1.0/top/scores",t,t.processFetchedData,{}):Noteflight.getService("/api/1.0/groups/scores",t,t.processFetchedData,{params:{group_id:o}})}},Noteflight.LibraryAllScoreListModel=function(e){var t=this;t.parent=e,Noteflight.PublicScoreListModel.call(t,e),t.sortBy("title"),t.path=function(e){var o={libraryId:t.parent.libraryId()||1};return e&&(o.search=e),NF.paths.viewLibraryCatalog(o)};var o={serviceUri:"/api/1.0/libraries/search",search:t.parent.search,libraryId:t.parent.libraryId};Noteflight.ScoreSearchModel.call(t,o),t.checkoutScoreCopy=function(e){},t.baseActions=[new NF.ListActionModel("checkoutContentLibraryCopy","action.checkoutContentLibraryCopy",function(){t.checkoutScoreCopy(t)})],t.showSocialBitsList(!1),t.showScores=function(e){t.queryView.loadSearch()},t.library=function(){return t.parent.library()},t.canPurchase=ko.computed(function(){if(t.library()&&t.library().gated()&&0===t.library().allowed_user_count()){if(NF.session.community()&&NF.session.community().reseller_community())return!1;if(NF.roles.isSiteAdmin()||NF.session.community().default_community())return!0}return!1}),t.canAddMembersButIsNotMember=ko.computed(function(){return t.library()&&t.library().canAddMembersButIsNotMember()}),t.buy=function(){t.library().navigateToPurchase()},t.goToManageMembers=function(){(0,n.navigate)((0,n.path)("viewSiteLibraryStudents",{libraryId:t.library().id()}))},t.displayColumns=function(){return t.library()&&void 0!==t.library().tags.columns?t.library().tags.columns():null},t.hasColumn=function(e){var o=t.displayColumns();return!!(o&&Array.isArray(o)&&o.includes(e))}},Noteflight.PublicSearchListModel=function(e){var t=this;Noteflight.PublicScoreListModel.call(t,e),t.label=ko.computed(function(){return(0,s.resource)("content.searchFor",e.searchTarget())}),t.superActivate=t.activate,t.activate=function(){t.superActivate(),t.sortBy(i.MOST_RELEVANT)},t.loadingMessage=(0,s.resource)("listing.searching"),t.fetchScoresWithSearch=function(o){t.fetchScoresService=null,ko.computed(function(){if(t.searchTarget!=e.searchTarget()||e.filterChanged()){t.searchTarget=e.searchTarget(),e.filterChanged(!1);var r={term:t.searchTarget};$.extend(r,e.filter().filterParams),$.extend(r,e.filter().rangeParams),t.fetchScoresService=Noteflight.postService(o,t,t.processFetchedData,{params:r}),t.reset()}}).extend({throttle:20})},t.fetchScoresWithSearch("/api/1.0/search/scores")},(0,n.addRoute)("popularScores","/public_scores#/popular",Noteflight.PublicScoresViewModel,{state:"popularScores"}),(0,n.addRoute)("risingScores","/public_scores#/rising",Noteflight.PublicScoresViewModel,{state:"recentScores"}),(0,n.addRoute)("allScores","/public_scores#/all",Noteflight.PublicScoresViewModel,{state:"allScores"}),(0,n.addRoute)("publicScores","/public_scores#",Noteflight.PublicScoresViewModel,{state:"allScores"}),(0,n.addRoute)("publicSearch","/public_scores#/search/{searchQuery}",Noteflight.PublicScoresViewModel,{state:"search"})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMembers=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(310)),n=o(2),i=o(0);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,l(t).call(this))).serviceReporter=new Noteflight.ServiceReporterViewModel((0,i.resource)("action.loading")),NF.ColumnLayoutViewModel.call(u(u(e)),350,"#publicMembers"),e.initializeObservables(),e.doesSearch(!0),e.searchConfiguration={communitymember:5,group:4,score:1},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,Noteflight.GenericPageViewModel),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"initializeObservables",value:function(){var e=this;this.title=ko.observable((0,i.resource)("content.members")),this.templateName=ko.observable("content/publicMembers"),this.name=ko.observable("publicMembers"),this.state=ko.observable(),this.members=ko.observableArray([]),this.count=ko.observable(0),this.remaining=ko.observable(0),this.startIndex=ko.observable(0),this.sortOrder=ko.observable("relevance"),this.sortOrder.subscribe(function(){e.resetSearch()}),this.sortOptions=ko.observableArray([{order:"name",label:(0,i.resource)("order.name")},{order:"relevance",label:(0,i.resource)("order.relevance")},{order:"most_recently_joined",label:(0,i.resource)("order.mostRecentlyJoined")}])}},{key:"fetchMembers",value:function(){var e={start_index:this.startIndex(),max_count:36,order:this.sortOrder(),term:this.searchTarget()||null};NF.apiService.fetchMembers(this.serviceReporter,this.processFetchedData.bind(this),e)}},{key:"processFetchedData",value:function(e){for(var t=0;t<e.community_members.length;t++)this.members.push(r.default.createMemberFromCommunityMember(e.community_members[t]));this.count(e.count),this.remaining(e.remaining),this.startIndex(e.count-e.remaining)}},{key:"clearSearch",value:function(){this.searchTarget(""),(0,n.navigate)(NF.paths.publicMembers())}},{key:"resetSearch",value:function(){this.members([]),this.startIndex(0),this.count(0),this.remaining(0),this.fetchMembers()}},{key:"checkAtBottom",value:function(e,t){this.remaining()&&!this.serviceReporter.busy()&&($(t.target).find(".moreItems").position().top-$(t.target).scrollTop()<=$(t.target).outerHeight()&&this.fetchMembers())}},{key:"onNavigate",value:function(){this.resetSearch()}}]),t}();t.PublicMembers=d,(0,n.addRoute)("publicMembers","/public_members#",d,{}),(0,n.addRoute)("publicMembersSearch","/public_members_search:?searchTarget:#",d,{state:"search"})},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.QueryViewModel=function(e){var t=this;t.aggregationDataRaw=e.aggregationDataRaw,t.matchingCallback=e.matchingCallback,t.path=e.path,t.serviceUri=e.serviceUri,t.search=ko.observable(e.search?e.search():ko.observable("")),t.searching=ko.observable(!1),t.searchTarget=ko.observable(),t.queryObject=ko.observable({}),t.showMore=ko.observable(!1),t.paramView=ko.observableArray(),t.filterArr=ko.observable(),t.aggData=ko.observable(),t.isFetching=!1,t.keywordArray=[],t.searchForTitle=ko.computed(function(){return t.searchTarget()?(0,n.resource)("content.searchFor",t.searchTarget()):null}),t.runSearchLabel=(0,n.resource)("search.search"),t.showMoreLabel=ko.computed(function(){return t.showMore()?(0,n.resource)("search.hideAdvanced"):(0,n.resource)("search.showAdvanced")}),t.toUrlString=function(e){if(!e)return"all";var t=0,o="";for(t=0;t<e.length;t++)""!==o&&e[t].value&&(o+="&"),o+=e[t].value?encodeURIComponent(e[t].attribute)+":"+encodeURIComponent(e[t].value):"";return o||"all"},t.objToUrl=function(e){var o=e.target.concat(e.filter);return t.toUrlString(o)},t.isTarget=function(e){return["keyword","title","composer","lyricist"].indexOf(e)>-1},t.urlToObj=function(e){var o={target:[],filter:[]};if("all"==e)return o;for(var r=e.split("&"),n=0;n<r.length;n++){var i=r[n].split(":"),a={attribute:decodeURIComponent(i[0]),value:decodeURIComponent(i[1])};t.isTarget(i[0])?o.target.push(a):o.filter.push(a)}return o},t.updateQueryObject=function(){},t.findByAttribute=function(e,t){if(e)for(var o=0;o<e.length;o++){var r=e[o];if(r.attribute==t||r.aggregation==t)return r.value||""}return""},t.updateSearchTab=function(){},t.findInRestrictions=function(e){for(var o=t.paramView(),r=0;r<o.length;r++){var n=o[r];if(n.attribute==e.attribute&&n.value==e.value)return r}return-1},t.runSearch=function(){t.isFetching||(t.updateSearchTab(),t.updateQueryUrl())},t.loadSearch=function(){for(var e in t.queryObject(t.urlToObj(t.search())),t.updateSearchTab(),t.keywordArray){var o=t.keywordArray[e];o.inputString(t.findByAttribute(t.queryObject().target,o.attribute)),""!==o.inputString()&&o.isAdvanced&&t.showMore(!0)}for(var r in t.queryObject().filter)t.findInRestrictions(t.queryObject().filter[r])<0&&t.paramView.push(new NF.ScoreAttributeModel(t,t.queryObject().filter[r].attribute,t.queryObject().filter[r].value));var n={target:t.queryObject().target,filter:t.queryObject().filter,libraryId:t.libraryId?t.libraryId():{}};t.matchingCallback(n)},t.resetAll=function(){t.paramView([]),(0,r.navigate)(t.path("all"))},t.rawAggs=ko.computed(function(){var e={};if(t.aggregationDataRaw&&t.aggregationDataRaw())for(var o in t.aggregationDataRaw()){for(var r=t.aggregationDataRaw()[o],i=[],a=0;a<r.buckets.length;a++){var s=new NF.ScoreAttributeModel(t,o,r.buckets[a].key,r.buckets[a].doc_count);t.findInRestrictions(s)<0&&i.push(s)}e[o]=new NF.AggregationViewModel((0,n.resource)("content."+o),i)}t.aggData(e)}),t.aggregations=ko.computed(function(){var e=t.aggData(),o=[e.hlc_format,e.key_signature,e.hlc_grade,e.hlc_genre];return void 0===o[0]&&(o=[]),o})},Noteflight.ScoreQueryViewModel=function(e){var t=this;for(var o in t.libraryId=e.libraryId,t.path=e.path,t.matchingCallback=e.matchingCallback,t.aggregationDataRaw=e.aggregationDataRaw,t.search=e.search,t.serviceUri=e.serviceUri,Noteflight.QueryViewModel.call(this,e),t.searchTypes={keyword:!1,title:!0,composer:!0,lyricist:!0},t.searchTypes){var n={searchField:o,matchingCallback:t.runSearch,itemType:"score",hasSuggestions:t.searchTypes[o],libraryId:t.libraryId,isAdvanced:"keyword"!=o,showMore:t.showMore};t.keywordArray.push(new Noteflight.TargetModel(t,n))}t.updateQueryUrl=function(){var e=[];for(var o in t.keywordArray){var n=t.keywordArray[o];e.push({attribute:n.attribute,value:n.inputString()})}var i={target:e,filter:t.paramView()},a=t.objToUrl(i);(0,r.navigate)(t.path(a))},t.updateSearchTab=function(){for(var e in t.keywordArray)if(""!==t.keywordArray[e].inputString())return void t.searchTarget(t.keywordArray[e].inputString());t.searchTarget(null)}},Noteflight.TargetModel=function(e,t){var o=this;o.focus=ko.observable(),o.focusDelay=ko.computed(function(){return o.focus()}).extend({throttle:150}),o.matchingCallback=t.matchingCallback,o.inputString=ko.observable(""),o.attribute=t.searchField,o.itemType=t.itemType,o.isAdvanced=t.isAdvanced,o.visible=!o.isAdvanced||t.showMore,o.hasSuggestions=t.hasSuggestions,o.libraryId=t.libraryId,o.mode="search",o.placeholder=function(){return(0,n.resource)(o.mode+"."+o.attribute+o.mode.charAt(0).toUpperCase()+o.mode.slice(1))},o.handleKeydown=function(e,t){switch(t.keyCode){case 13:o.matchingCallback()}return!0},o.hasSuggestions&&(o.getSuggestions=function(t,r,n,i,a){var s=e.serviceUri;NF.postService(s,o,function(e){i&&i([]);for(var t=e.suggestions,r=0;r<t.length;r++)i.push(new NF.AutoMatch(o.suggester,t[r]))})({suggestion:{value:r(),field:t},target:{},query:{},libraryId:o.libraryId?o.libraryId():null})},o.makeSuggester=function(e,t,r){return function(r,n){o.getSuggestions(e,t,r,n,o.itemType)}},o.suggester=new Noteflight.AddEntity(o.inputString,o.makeSuggester(o.attribute,o.inputString,o.itemType),o.matchingCallback,o.mode),o.inputString=o.suggester.name,o.handleKeydown=o.suggester.handleKeydown)},Noteflight.AggregationViewModel=function(e,t){var o=this;o.showExtended=ko.observable(!1),o.name=e,o.values=t,o.viewableArray=ko.computed(function(){return o.showExtended()?o.values:o.values.slice(0,10)}),o.viewText=ko.computed(function(){return o.showExtended()?(0,n.resource)("search.showLess"):(0,n.resource)("search.showMore")});var r=t.length>10;return o.exceedsStd=ko.observable(r),o},Noteflight.ScoreAttributeModel=function(e,t,o,r){var i=this;i.parent=e;var a=NF.prettifyAttributeString(t,o);i.attribute=t,i.value=o,i.count=r,i.prettyText=a,i.prettyFilter=(0,n.resource)("content."+i.attribute)+": "+a,i.addFilter=function(){i.parent.paramView().indexOf(i)<0&&(i.parent.paramView.push(i),i.parent.runSearch())},i.removeFilter=function(){var e=i.parent.paramView().indexOf(i);e>=0&&i.parent.paramView.splice(e,1),i.parent.runSearch()}},Noteflight.AutoMatch=function(e,t){var o=this;o.suggestion=t,o.name=ko.computed(function(){return o.suggestion.text}),o.addMatch=function(){o.select(),e.matchingCallback(e.matchingEntity())},o.select=function(){e.name(o.suggestion.text)},o.selected=ko.computed(function(){return e.nameQuery&&o.name().toLowerCase()==e.nameQuery()})}},function(e,t,o){"use strict";var r=o(2),n=o(0),i=o(3);Noteflight.SiteActivationViewModel=function(){var e=this;e.templateName=ko.observable("content/siteActivate"),e.session=Noteflight.session,e.communityId=ko.observable(),e.hostname=ko.observable(),e.siteActivated=function(e){NF.location.setUri(e.url)},e.onNavigate=function(){NF.apiService.activateSite((0,n.resource)("content.savingSiteSettings"),e.siteActivated,{hostname:e.hostname(),community_id:e.communityId()})}},Noteflight.SiteNewUsersModel=function(e){var t=this;t.siteAdmin=e,t.userList=ko.observable(""),t.newUserInfo=ko.observableArray(),t.sso_user_role=ko.observable("student"),t.password=ko.observable(""),t.confirm_password=ko.observable(""),t.reset_password=ko.observable(!0),t.processedUserCount=ko.observable(0),t.availableUserCount=ko.computed(function(){return 9999999==e.maxMemberCount()?9999999:e.maxMemberCount()-e.totalMemberCount()}),t.maxMemberCount=ko.computed(function(){return e.maxMemberCount()}),t.unprocessedUserCount=ko.computed(function(){return t.newUserInfo().length-t.processedUserCount()}),t.showAddUsersForm=ko.observable(!0),t.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("action.addingUsers")),t.cantSubmit=ko.computed(function(){return t.serviceReporter.busy()||0===t.userList().length||t.serviceReporter.errors().length}),t.handleKeyUp=function(e,o){"13"!=o.keyCode&&t.serviceReporter.clearErrors()},t.prepareUsernames=function(){t.serviceReporter.init();for(var e=t.userList().split("\n"),o=[],r=!1,a=null,s=0;s<e.length;s++)if(e[s].length>0){if(!(a=new Noteflight.NewUserModel(t,e[s])).validate()){r=!0;break}o.push(a)}if(r)return t.newUserInfo([]),void t.serviceReporter.errors.push({message:(0,n.resource)("errors."+a.error())});if(t.newUserInfo(o),t.processedUserCount(0),t.newUserInfo().length){if(t.unprocessedUserCount()>t.availableUserCount())return(0,i.standardAlertDialog)((0,n.pluralize)("error.tooManyMembers",t.newUserInfo().length-t.availableUserCount())),void t.newUserInfo([]);if(t.password()!=t.confirm_password())return t.serviceReporter.errors.push({message:(0,n.resource)("errors.passwordsMustMatch")}),void t.newUserInfo([]);t.checkExistingUsers()}},t.processAddedUsers=function(o){if(o.users){for(var r=[],n=0;n<o.users.length;n++){var i=o.users[n],a=new Noteflight.NewUserModel(t,i.username);i.error&&a.error(i.error.code),a.processed(i.success),r.push(a),a.processed()&&t.processedUserCount(t.processedUserCount()+1)}t.newUserInfo(r),t.showAddUsersForm(0===t.unprocessedUserCount()),e.usersAdded(t.sso_user_role(),t.showAddUsersForm())}},t.checkExistingUsers=function(){for(var e=[],o=0;o<t.newUserInfo().length;o++){var r=t.newUserInfo()[o];r.processed()||e.push(r.username())}var n={usernames:e,password:t.password(),sso_user_role:t.sso_user_role(),reset_password_required:t.reset_password()};NF.apiService.sitesExistingUsers(t.serviceReporter,function(e){0===e.deactivated_users.length&&0===e.active_users.length?t.submitUsernames():new Noteflight.ExistingUsersDialog(t.submitUsernames,e).show()},n)},t.submitUsernames=function(o){for(var r=[],i=0;i<t.newUserInfo().length;i++){var a=t.newUserInfo()[i];a.processed()||r.push(a.username())}var s={usernames:r,password:t.password(),sso_user_role:t.sso_user_role(),reset_password_required:t.reset_password()};void 0!==o&&(s.handle_deleted=o),NF.apiService.addUsersToSite((0,n.resource)("action.addingUsers"),function(o){t.processAddedUsers(o),e.resetUserViewModels()},s)},t.cancel=function(){e.groupViewModel.siteMembersView().leaveAddMembersToSiteMode()},t.reset=function(){t.userList(""),t.newUserInfo([]),t.password(""),t.confirm_password(""),t.showAddUsersForm(!0)},t.backToListing=function(){"instructor"==t.sso_user_role()?(0,r.navigate)((0,r.path)("updateSiteTeachers")):"student"==t.sso_user_role()&&(0,r.navigate)((0,r.path)("updateSiteStudents"))}},Noteflight.ExistingUsersDialog=function(e,t){var o=this;o.callback=e;var r=t.deactivated_users,a=t.active_users;o.usernames=r,o.handleDeactivated=ko.observable(""),o.deactivatedUsers=[];for(var s=0;s<r.length;s++)o.deactivatedUsers.push(r[s].displayable_name);o.existingUsernames=[];for(var l=0;l<a.length;l++)o.existingUsernames.push(a[l].displayable_name);if(o.deactivatedUsers.length>10)o.description=(0,n.resource)("content.userConflict");else{var c=o.deactivatedUsers.join(", "),u=o.existingUsernames.join(", ");c.length>0&&u.length>0?o.description=(0,n.resource)("content.userConflictWithBothNames",[u,c]):c.length>0?o.description=(0,n.resource)("content.userConflictWithDeletedNames",c):u.length>0&&(o.description=(0,n.resource)("content.userConflictWithActiveNames",u))}i.DialogViewModel.call(o);var d={};o.deactivatedUsers.length>0?(d={viewModel:o,templateName:"dialogs/handleDeactivatedUsers"},o.doneButtonEnabled=ko.computed(function(){return""!==o.handleDeactivated()}),o.submit=function(){(0,i.hideCurrentDialog)(),o.callback(o.handleDeactivated())}):o.existingUsernames.length>0&&(d={viewModel:o,templateName:"dialogs/handleExistingActiveUsers"}),o.show=function(){(0,i.createAndShowDialog)(d)}},Noteflight.NewUserModel=function(e,t){var o=this;o.username=ko.observable(t),o.error=ko.observable(""),o.processed=ko.observable(!1),o.validate=function(){var e=o.username().trim(),t=/^([^\.]+),([^\.]+)$/.exec(e);return t&&(e=t[2]+" "+t[1]),e=(e=e.replace(/\s+/," ")).trim(),o.username(e),""===e?o.error("usernameRequired"):o.error(""),""===o.error()},o.errorText=ko.computed(function(){return o.error()&&(0,n.resource)("errors."+o.error())})},Noteflight.SiteUserViewModel=function(e,t){var o=this;o.usersListing=e,o.user=ko.observable(t),o.editingList=e.editingList,Noteflight.SelectionItem.call(this,e),o.masqueradeAsUser=function(){NF.apiService.masqueradeAsUser((0,n.resource)("content.masqueradingAsUser"),function(e){Noteflight.location.setUri(e.url)},{user_id:o.user().external_id()})},o.adminUser=function(){(0,r.navigate)(Noteflight.paths.adminProfile({userId:o.user().external_id()}))},o.contextMenuItems=function(){var e=[];return(NF.session.current_user().effective_admin()||"student"==o.user().community_member.sso_user_role())&&(e.push({label:(0,n.resource)("action.adminProfile"),action:o.adminUser}),e.push({label:(0,n.resource)("action.masquerade",o.user().username()),action:o.masqueradeAsUser}),e.push({label:(0,n.resource)("action.delete"),action:o.usersListing.deleteUsers})),e}};Noteflight.SiteUsersViewModel=function(e,t){var o=this;o.session=Noteflight.session,Noteflight.ColumnLayoutViewModel.call(this,400,"#users"),o.userType=ko.observable(t),o.userTypeInfo={student:{addActionResource:"action.addSiteStudents",addRoute:"addStudents",displayPlural:"content.students"},instructor:{addActionResource:"action.addSiteTeachers",addRoute:"addTeachers",displayPlural:"content.teachers"}},o.sortOrder=ko.observable("username"),o.sortOptions=ko.observableArray([{order:"username",label:(0,n.resource)("order.name")},{order:"most_recently_logged_in",label:(0,n.resource)("order.login")}]),o.addActionResource=ko.computed(function(){return o.userTypeInfo[o.userType()].addActionResource}),o.canAdminUsers=ko.computed(function(){return e.admin()||"student"==o.userType()&&e.instructor()}),o.addUsers=function(){(0,r.navigate)((0,r.path)(o.userTypeInfo[o.userType()].addRoute))},o.userTypeDisplayPlural=ko.computed(function(){return o.userTypeInfo[o.userType()].displayPlural}),o.users=ko.observableArray(),o.remaining=ko.observable(0),o.count=ko.observable(0),o.maxMemberCount=ko.observable(0),o.totalMemberCount=ko.observable(0),Noteflight.SelectionList.call(this,o.users),o.handleFetchedSiteUsers=function(e){for(var t=0;t<e.users.length;t++)o.users.push(new Noteflight.SiteUserViewModel(o,new Noteflight.User(e.users[t])));o.remaining(e.remaining),o.count(e.count),o.maxMemberCount(e.max_member_count),o.totalMemberCount(e.total_member_count)},o.fetchUsersParams=function(){return{start_index:o.users().length,max_count:36,role:o.userType(),order:o.sortOrder()}},o.fetchUsers=function(){NF.session.community().default_community()||NF.apiService.fetchSiteUsers((0,n.resource)("action.addingUsers"),o.handleFetchedSiteUsers,o.fetchUsersParams())},Noteflight.PageableViewModel.call(this,o.fetchUsers),o.adminUser=function(){o.selectedItems()[0].adminUser()},o.masqueradeAsUser=function(){o.selectedItems()[0].masqueradeAsUser()},o.reset=function(){o.users([]),o.fetchUsers()},o.sortOrder.subscribe(function(){o.reset()})},Noteflight.SiteUsersSearchViewModel=function(e,t){Noteflight.SiteUsersViewModel.call(this,e,t),this.title=ko.computed(function(){return(0,n.resource)("listing.studentSearch",e.searchTarget())});var o=this.fetchUsersParams;this.fetchUsersParams=function(){var t=o();return t.query=e.searchTarget(),t}},Noteflight.SiteAdminViewModel=function(e){var t=this;t.templateName=ko.observable("content/sccAdmin"),t.state=ko.observable(),t.session=Noteflight.session,t.groupViewModel=e,t.admin=ko.computed(function(){return t.session.community_member()&&"admin"==t.session.community_member().sso_user_role()}),t.instructor=ko.computed(function(){return t.session.community_member()&&"instructor"==t.session.community_member().sso_user_role()}),t.searchTarget=ko.observable(),t.searchScope=ko.observable("searchStudents"),t.searchLabel=ko.observable((0,n.resource)("search.labelStudents")),t.studentsViewModel=new Noteflight.SiteUsersViewModel(t,"student"),t.teachersViewModel=new Noteflight.SiteUsersViewModel(t,"instructor"),t.studentSearchViewModel=new Noteflight.SiteUsersSearchViewModel(t,"student"),t.maxMemberCount=ko.computed(function(){return t.studentsViewModel.maxMemberCount()}),t.memberCount=ko.computed(function(){return t.studentsViewModel.count()+t.teachersViewModel.count()+1}),t.totalMemberCount=ko.computed(function(){return t.studentsViewModel.totalMemberCount()}),t.newUsers=ko.observable(new Noteflight.SiteNewUsersModel(t)),t.onNavigate=function(){switch(NF.IsPhoneLayout()||"root"==t.state()&&t.state("students"),t.state()){case"studentSearch":t.studentSearchViewModel.reset();break;case"addStudents":t.newUsers().reset(),t.newUsers().sso_user_role("student");break;case"addTeachers":t.newUsers().reset(),t.newUsers().sso_user_role("instructor")}},t.title=ko.computed(function(){var e="";switch(t.state()){case"settings":e="action.showSettings";break;case"teachers":e="action.showSiteTeachers";break;case"students":e="action.showSiteStudents";break;case"studentSearch":return(0,n.resource)("listing.studentSearch",t.searchTarget());case"addStudents":e="action.addSiteStudents";break;case"addTeachers":e="action.addSiteTeachers"}if(e)return(0,n.resource)(e)}),t.currentSectionIsAForm=ko.computed(function(){return"settings"==t.state()||"addStudents"==t.state()||"addTeachers"==t.state()}),t.checkAtBottom=function(e,o){switch(t.state()){case"students":t.studentsViewModel.checkAtBottom(e,o);break;case"teachers":t.teachersViewModel.checkAtBottom(e,o)}},t.usersAdded=function(e,o){switch(e){case"student":t.studentsViewModel.reset(),o&&(0,r.navigate)((0,r.path)("updateSiteStudents"));break;case"instructor":t.teachersViewModel.reset(),o&&(0,r.navigate)((0,r.path)("updateSiteTeachers"))}},t.siteDeactivated=function(e){NF.location.setUri(e.url)},t.deactivateSite=function(){(0,i.okCancel)((0,n.resource)("content.confirmDeactivateCommunity",t.session.community().name()),function(){NF.apiService.deactivateSite((0,n.resource)("content.deactivatingSite"),t.siteDeactivated,{})})},t.search=function(e){e?(t.studentSearchViewModel.count(""),(0,r.navigate)(Noteflight.paths.updateSiteSearch({searchTarget:e}))):(t.searchTarget(null),(0,r.navigate)(Noteflight.paths.updateSiteStudents()))},t.deleteUsers=function(e,o){var r=e||$.map(t.selectedItems(),function(e){return e.user().external_id()}),a=function(e){o&&o(e),t.resetUserViewModels()};(0,i.okCancel)((0,n.resource)("content.confirmDeleteSiteMembers",t.groupViewModel.name()),function(){NF.apiService.deleteSiteUsers((0,n.resource)("content.deletingUser"),a,{user_ids:r})})},t.resetUserViewModels=function(){t.studentsViewModel.reset(),t.teachersViewModel.reset()},t.resetUserViewModels()},(0,r.addRoute)("activateSite","/site/admin#/activate/{hostname}",Noteflight.SiteActivationViewModel,{}),(0,r.addRoute)("adminSite","/site/admin#",Noteflight.SiteAdminViewModel,{state:"root"}),(0,r.addRoute)("updateSite","/site/admin#/settings",Noteflight.SiteAdminViewModel,{state:"settings"}),(0,r.addRoute)("updateSiteStudents","/site/admin#/students",Noteflight.SiteAdminViewModel,{state:"students"}),(0,r.addRoute)("updateSiteTeachers","/site/admin#/teachers",Noteflight.SiteAdminViewModel,{state:"teachers"}),(0,r.addRoute)("updateSiteSearch","/site/admin#/studentsearch/{searchTarget}",Noteflight.SiteAdminViewModel,{state:"studentSearch"}),(0,r.addRoute)("addStudents","/site/admin#/scc/addStudents",Noteflight.SiteAdminViewModel,{state:"addStudents"}),(0,r.addRoute)("addTeachers","/site/admin#/scc/addTeachers",Noteflight.SiteAdminViewModel,{state:"addTeachers"})},function(e,t,o){"use strict";Noteflight.ScoreSearchModel=function(e){var t=this;t.serviceUri=e.serviceUri,t.libraryId=e.libraryId,t.search=e.search,t.aggregationDataRaw=ko.observable(),t.targetList=ko.observable(),t.filterArr=ko.observable(),t.fetchScoresService=function(){},t.searchCallback=function(e){t.fetchScoresService=Noteflight.postService(t.serviceUri,t,t.processFetchedData,{params:e}),t.reset()};var o={path:t.path,matchingCallback:t.searchCallback,aggregationDataRaw:t.aggregationDataRaw,search:t.search,serviceUri:t.serviceUri,libraryId:t.libraryId};t.queryView=new NF.ScoreQueryViewModel(o),t.searchTarget=t.queryView.searchTarget,t.processFetchedData=function(o){for(var r=0;r<o.scores.length;r++){var n=new Noteflight.Score(o.scores[r]);n.contentLibraryId(e.libraryId()),t.scores.push(new t.scoreViewModel(t,n))}t.remaining(o.remaining),t.startIndex(o.startIndex),t.aggregationDataRaw(o.aggregations),t.queryView.isFetching=!1,t.busy(!1)}}},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(1161)),n=o(2),i=o(15);Noteflight.SiteHomeViewModel=function(){var e=this;e.formatCommas=i.formatCommas,e.name=ko.observable("home"),e.session=Noteflight.session,e.show_signup_form=ko.observable(""),e.zIndexCounter=1e3;var t=e.session.community().managed();e.templateName=ko.observable(t?"content/sccHome":"content/blank"),Noteflight.GenericPageViewModel.call(e),e.links=Noteflight.appViewModel.links,e.topNav=new r.default,e.activeHeaderTag("home"),this.searchConfiguration={marketplace_with_contribs:2,score:2,group:1},e.state=ko.observable({}),e.homeScoreUrl=ko.observable(""),e.homeScoreImageUrl=ko.observable("https://assets.noteflight.com/content_items/images/homepage/homeScorelowres.png"),e.signInUri=function(){return(0,n.path)("loggedInHome")},t||NF.apiService.getHomepageScore("",function(t){return e.processHomeScore(t)},{},{}),e.processHomeScore=function(t){t&&(e.homeScoreUrl(t.score_url),window.devicePixelRatio>1?e.homeScoreImageUrl(t.score_image_url):e.homeScoreImageUrl(t.low_res_score_image_url))},e.onNavigate=function(){e.show_signup_form()&&e.topNav.showSignup()}},Noteflight.SignInViewModel=function(){var e=this;e.userInitiatedSignUp=window.location.href.indexOf("user_initiated=signup")>-1,e.templateName=ko.observable("content/blank"),e.topNav=new r.default,e.topNav.forceBoldNav(!0),e.onNavigate=function(){NF.session.current_user()||(e.userInitiatedSignUp?Noteflight.appViewModel.showSignupForm():Noteflight.appViewModel.showLoginForm())}},Noteflight.ResetPasswordViewModel=function(){this.templateName=ko.observable("content/blank"),this.onNavigate=function(){new Noteflight.ChangePasswordDialog(!0,function(e){e?NF.reloadWindow():NF.appViewModel.logout()}).show()}},(0,n.addRoute)("resetPassword","/users/must_reset_password:?requested_uri:#",Noteflight.ResetPasswordViewModel,{}),(0,n.addRoute)("signIn","/users/sign_in:?requested_uri::?user_initiated:#",Noteflight.SignInViewModel,{}),(0,n.addRoute)("login","/login:?show_signup_form:#",Noteflight.SiteHomeViewModel,{}),(0,n.addRoute)("siteHome","/site#",Noteflight.SiteHomeViewModel,{}),(0,n.addRoute)("home","/#",Noteflight.SiteHomeViewModel,{}),(0,n.addRouteAlias)("r2","siteHome","/")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(54)),n=o(19);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?c(e):t}(this,s(t).call(this))).scrollTop=ko.observable(0),e.zIndexCounter=1e3,e.forceBoldNav=ko.observable(!1),e.isMobileLayout=n.isMobileLayout,e.showBoldNav=ko.computed(function(){return e.forceBoldNav()||e.scrollTop()>180}),e.search=e.searchPalette().controls()[0],e.search.showFullSearchBar(!1),ko.computed(function(){e.search.searchViewModel().forceShowSearchBar((0,n.isMobileOrSmallerLayout)())}),e.scrolled=e.scrolled.bind(c(c(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&a(e.prototype,t),o&&a(e,o)}(t,[{key:"scrolled",value:function(e,t){var o=t.target;this.scrollTop(o.scrollTop),(0,n.isPhoneLayoutOrSmaller)()||(this.zIndexCounter++,setTimeout(function(){$(".topNav").css("z-index",this.zIndexCounter+1),$(".overlayStuff").css("z-index",this.zIndexCounter)},10))}},{key:"showSignup",value:function(){Noteflight.appViewModel.showSignupForm()}},{key:"showLogin",value:function(){Noteflight.appViewModel.showLoginForm()}}]),t}();t.default=u},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(0),i=o(114),a=o(5);Noteflight.BillingInfoRecurlyViewModel=function(){var e=this;e.first_name=ko.observable(),e.last_name=ko.observable(),e.address1=ko.observable(),e.address2=ko.observable(" "),e.city=ko.observable(),e.postal_code=ko.observable(),e.resource=n.resource,Noteflight.CommerceCountryStateViewModel.call(this),e.formattedJsonForRecurly=function(){return{first_name:e.first_name(),last_name:e.last_name(),address1:e.address1(),address2:e.address2(),city:e.city(),state:e.state(),zip:e.postal_code(),country:e.country()}},e.handleKeyUp=function(t,o){"13"!=o.keyCode&&e.clearErrors()},e.clearErrors=function(){r.default.publish(a.REPORTER_CLEAR_ERRORS)},e.validateForm=function(){var t=e.validateInput();return!t||(r.default.publish(a.REPORTER_ADD_ERROR,{code:t,message:(0,n.resource)(t)}),!1)},e.validateInput=function(){return e.first_name()?e.last_name()?e.address1()?e.city()?"US"!=e.country()||e.stateCode()?e.postal_code()?void 0:"errors.zipRequired":"errors.stateRequired":"errors.cityRequired":"errors.addressRequired":"errors.lastNameRequired":"errors.firstNameRequired"}},Noteflight.PurchaseMethodCreditCardRecurlyViewModel=function(e){var t=this;t.serviceReporter=e,t.number=ko.observable().extend({maxDigits:16}),t.month=ko.observable().extend({maxDigitsAndValue:{maxDigits:2,maxValue:12}}),t.year=ko.observable().extend({maxDigits:2}),t.cvv=ko.observable().extend({maxDigits:4}),t.useExistingCard=ko.observable(!1),t.existingNumber=ko.observable(),t.formattedJsonForRecurly=function(){return{number:t.number(),month:t.month(),year:t.year(),verification_value:t.cvv()}},t.handleKeyUp=function(e,o){"13"!=o.keyCode&&t.clearErrors()},t.clearErrors=function(){t.serviceReporter.clearErrors()},t.validateInput=function(){if(!t.useExistingCard())return t.number()?t.month()&&t.year()?t.cvv()?void 0:"errors.cardSecurityCodeRequired":"errors.cardExpirationRequired":"errors.cardNumberRequired"},t.validateValues=function(){return recurly.validate.cardNumber(t.number())&&recurly.validate.cvv(t.cvv())?recurly.validate.expiry(t.month(),t.year())?void 0:"errors.recurly.problemYear":"errors.recurly.ccNumber"},t.validateForm=function(){t.serviceReporter.clearErrors(),t.serviceReporter.init();var e=t.validateInput();if(e)return t.serviceReporter.errors.push({message:(0,n.resource)(e)}),!1;var o=t.validateValues();return!o||(t.serviceReporter.errors.push({message:(0,n.resource)(o)}),!1)},t.currentCard=ko.computed(function(){return/^4/.test(t.number())?"visa":/^5$|^5[1-5]/.test(t.number())?"masterCard":/^3[47]/.test(t.number())?"amex":/^6$|^65|^60$|^601$|^6011/.test(t.number())?"discover":/^35|^2$|^21$|^213$|^2131|^1$|^18$|^180$|^1800/.test(t.number())?"jcb":!t.number()||/^3$/.test(t.number())?"all":void 0}),t.securityCodePopupContent=ko.computed(function(){var e,o,r;if("amex"==t.currentCard())e="American Express",o="content.amexCardSecurityCode",r="amex";else{switch(t.currentCard()){case"visa":e="Visa";break;case"masterCard":e="MasterCard";break;case"discover":e="Discover";break;case"jcb":e="JCB";break;default:e=(0,n.resource)("content.mostCards")}o="content.genericCardSecurityCode",r="generic"}return"<div class='securityCodeCardName'>"+e+"</div><div class='securityCodeText "+r+"'>"+(0,n.resource)(o)+"</div>"})};Noteflight.CommonRecurlyPurchaseViewModel=function(e,t){var o=this;if(Noteflight.configureRecurly(),o.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("action.loadingInfo")),t){o.price=ko.observable(""),o.priceFormatted=ko.observable(""),o.discountFormatted=ko.observable(""),o.taxFormatted=ko.observable(""),o.totalFormatted=ko.observable(""),o.couponCode=ko.observable(),o.validCouponCode=ko.observable(!1),o.couponDescription=ko.observable();var r=recurly.Pricing();o.updatePrice=function(){var e=function(e){var t=e.coupon;t&&t.valid_coupon_code?(o.couponDescription(t.description),o.validCouponCode(!0)):t&&!t.valid_coupon_code?(o.couponDescription((0,n.resource)("content.invalidCouponCode")),o.validCouponCode(!1)):(o.couponDescription(null),o.validCouponCode(!1))};o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()+1),function(e,t){r=r.plan(o.recurlyPlanName,{quantity:1}),o.isCustomPlan()&&(r=(r=r.addon("students_per_site",{quantity:o.users_per_site()})).addon("sso_enabled",{quantity:o.sso_enabled()?1:0}),o.content_libraries&&o.content_libraries()&&o.content_libraries().forEach(function(e){r=r.addon("cl_"+e.code,{quantity:e.quantity})})),r.address({country:o.billingInfoViewModel.country(),postal_code:o.billingInfoViewModel.postal_code()}).coupon(o.couponCode()).catch(t).done(e)}(function(t){o.price(Number(t.now.subtotal));var r=0;t.now.plan&&(r+=parseFloat(t.now.plan)),t.now.addons&&(r+=parseFloat(t.now.addons)),o.priceFormatted(t.currency.symbol+r.toFixed(2)),o.totalFormatted(t.currency.symbol+t.now.total),o.discountFormatted(t.currency.symbol+t.now.discount),t.taxes.length?o.taxFormatted(t.currency.symbol+t.now.tax):o.taxFormatted(""),o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()-1),o.couponCode()?Noteflight.postService("/api/1.0/recurly_coupon_code",o.serviceReporter,e)({coupon_code:o.couponCode()}):o.couponDescription()&&o.couponDescription(null)},function(e){o.serviceReporter.errors.push({message:(0,i.interpretRecurlyError)(e)}),o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()-1)})}}o.isCustomPlan=function(){return o.sites&&o.users_per_site&&o.years},o.clearClientErrors=function(){o.serviceReporter.clearErrors()},o.handleKeyUp=function(e,t){"13"!=t.keyCode&&o.clearClientErrors()},o.validateInput=function(){var e="";return o.validateCustomProductInput&&(e=o.validateCustomProductInput()),e||(e=o.billingInfoViewModel.validateInput()),e||(e=o.ccViewModel.validateInput()),e},o.purchase=function(){o.serviceReporter.init(),t?o.serviceReporter.actionLabel((0,n.resource)("content.submittingPurchase")):o.serviceReporter.actionLabel((0,n.resource)("content.updatingPaymentMethod"));var e=o.validateInput();e?o.serviceReporter.errors.push({message:(0,n.resource)(e)}):(o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()+1),recurly.token({number:o.ccViewModel.number(),month:o.ccViewModel.month(),year:o.ccViewModel.year(),cvv:o.ccViewModel.cvv(),first_name:o.billingInfoViewModel.first_name(),last_name:o.billingInfoViewModel.last_name(),address1:o.billingInfoViewModel.address1(),address2:o.billingInfoViewModel.address2(),city:o.billingInfoViewModel.city(),state:o.billingInfoViewModel.stateCode(),postal_code:o.billingInfoViewModel.postal_code(),country:o.billingInfoViewModel.country()},o.recurlyCreateTokenComplete))},o.recurlyCreateTokenComplete=function(t,r){t?(o.serviceReporter.errors.push({message:(0,i.interpretRecurlyError)(t)}),o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()-1)):(o.serviceReporter.busyCounter(o.serviceReporter.busyCounter()-1),e&&e(r))},o.billingInfoViewModel=new Noteflight.BillingInfoRecurlyViewModel,o.ccViewModel=new Noteflight.PurchaseMethodCreditCardRecurlyViewModel(o.serviceReporter),t&&(o.billingInfoViewModel.postal_code.subscribe(o.updatePrice),o.billingInfoViewModel.country.subscribe(o.updatePrice),o.couponCode.subscribe(o.updatePrice))}},function(e,t,o){"use strict";var r=o(0);Noteflight.SubviewModel=function(e){var t=this;t.parent=e,t.isCurrent=ko.computed(function(){return t.parent.currentSubview()&&t.parent.currentSubview()==t}),t.title=(0,r.resource)(t.titleResource),t.activate=function(){}}},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.TestContentViewModel=function(){var e=this;e.templateName=ko.observable("content/test"),e.state=ko.observable(),e.resources=ko.observable(),e.overrideResources=function(){(0,n.testResources)(e.resources()),Noteflight.reloadWindow()},e.revertResources=function(){(0,n.testResources)(null),Noteflight.reloadWindow()},e.onNavigate=function(){"resources"==e.state()&&e.resources((0,n.testResources)())}},(0,r.addRoute)("test","/test#:state:",Noteflight.TestContentViewModel,{})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(o(263)),n=o(2),i=o(0),a=o(31),s=u(o(4)),l=o(5),c=o(6);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.templateName=c.ko.observable("content/updateProfileInfo"),this.session=c.Noteflight.session,this.currentUser=c.Noteflight.session.current_user(),this.optionalInfo=new r.default,this.initializeObservables()}return function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(e,[{key:"initializeObservables",value:function(){var e=this;this.username=c.ko.observable(""),this.email=c.ko.observable(this.currentUser.email()),this.mandatoryOptionsFilled=c.ko.computed(function(){return""!==e.username()})}},{key:"handleUpdateComplete",value:function(e){this.session.update(e),(0,a.getCookie)("premiumTrial")?(0,n.navigate)((0,n.path)("premiumTrialConfirmation")):(0,n.navigate)((0,n.path)("loggedInHome"))}},{key:"update",value:function(){var e=this;if(s.default.publish(l.REPORTER_CLEAR_ERRORS),0===this.username().length)s.default.publish(l.REPORTER_ADD_ERROR,{code:"errors.usernameRequired",message:(0,i.resource)("errors.usernameRequired")});else{var t={user:{email:this.email(),username:this.username()}};t.user.profile=this.optionalInfo.getInfo(),c.NF.apiService.verifyProfile((0,i.resource)("action.updating"),function(t){return e.handleUpdateComplete(t)},t,{})}}}]),e}();t.default=p,(0,n.addRoute)("update_profile_info","/users/update_profile_info/#",p,{})},function(e,t,o){"use strict";Noteflight.UnknownContentPackageViewModel=function(e){this.contentType=ko.observable(e.contentType),this.templateName=ko.observable("content/unknownContentPackage")}},function(e,t,o){"use strict";Noteflight.EditorApiServer=function(e){var t=this;t.active=ko.observable(!1),t.playing=ko.observable(!1);var o=[];t.dispatchMessage=function(e){if("noteflightEvent"==e.kind)switch(e.event.type){case"editorReady":for(var r in t.jsApiMethods)e.event.methodNames.push(r);break;case"scoreDataLoaded":t.active(!0);break;case"playbackRequest":t.playing(!0);break;case"playbackStop":t.playing(!1)}t.viewerOrigin?t.viewerWindow.postMessage(JSON.stringify(e),t.viewerOrigin):o.push(e)},t.handleMessage=function(e){if("string"==typeof e.data){var r=JSON.parse(e.data);if(t.viewerOrigin||"initializeViewer"!=r.kind){if(t.viewerOrigin&&e.origin==t.viewerOrigin&&"invokeMethod"==r.kind){var n=t.invokeMethod(r.methodName,r.args);r.invocationId&&t.dispatchMessage({kind:"invokeResult",invocationId:r.invocationId,result:n})}}else for(t.viewerWindow=e.source,t.viewerOrigin=e.origin,t.viewerOrigin&&"null"!=t.viewerOrigin||(t.viewerOrigin="*"),t.dispatchMessage({kind:"initialized"});o.length>0;)t.dispatchMessage(o.shift())}},t.invokeMethod=function(o,r){return t.jsApiMethods[o]?t.jsApiMethods[o].apply(t,r):e.html5Editor().invokeApiMethod(o,r)},window.addEventListener?window.addEventListener("message",t.handleMessage):window.attachEvent&&window.attachEvent("onmessage",t.handleMessage),window.noteflightEventHandler=function(e){t.dispatchMessage({kind:"noteflightEvent",event:e})},t.jsApiMethods={scrollToPreviousPage:function(t){e.html5Editor().scoreApi.scrollToPreviousPage()},scrollToNextPage:function(t){e.html5Editor().scoreApi.scrollToNextPage()},centerCurrentPage:function(){e.html5Editor().scoreApi.centerCurrentPage()},resumeScrolling:function(t){e.html5Editor().scoreApi.resumeScrolling()},loadMusicXML:function(t){e.html5Editor().invokeApiMethod("loadMusicXML",[t,e.html5Editor().loadEditor])},loadNoteflightXML:function(t){e.html5Editor().invokeApiMethod("loadNoteflightXML",[t,e.html5Editor().loadEditor])},printTimingStats:function(t){e.html5Editor().scoreApi.printTimingStats(t)},resetCursorPosition:function(){e.html5Editor().scoreApi.resetCursorPosition()},togglePianoKeyboard:function(){e.showPianoKeyboard(!e.showPianoKeyboard())},isPianoKeyboardVisible:function(){return e.showPianoKeyboard()},setAutoScale:function(t){var o=e.html5Editor();o.scoreApi.setAutoScale(t),t&&o.resizeToFit()},getAutoScale:function(){return e.html5Editor().scoreApi.getAutoScale()},setDisplayMode:function(t){e.html5Editor().fit(t)},getDisplayMode:function(){return e.html5Editor().fit()}}}},function(e,t,o){"use strict";var r=o(2);Noteflight.Workbook1ListingViewModel=function(e){var t=this;t.contentPackageId=ko.observable(e.id),t.command=ko.observable(e.command),t.listingMetadata=ko.observable(e.listingMetadata),t.filesUrlPrefix=ko.observable("/content_packages/"+t.contentPackageId()+"/files/"),t.templateName=ko.observable("content/workbook1Listing"),t.workbook1Descriptor=ko.observable(),Noteflight.GenericPageViewModel.call(t),t.workbookNotFound=ko.computed(function(){return"workbookNotFound"==t.command()}),t.scoreNotFound=ko.computed(function(){return"scoreNotFound"==t.command()}),t.contentItem=ko.computed(function(){var e={id:t.contentPackageId(),title:t.listingMetadata().title,publisher:t.listingMetadata().publisher,bookImage:t.listingMetadata().image};return new Noteflight.BookSummaryViewModel(e)}),t.workbook1ViewUrl=ko.computed(function(){var e=t.workbook1Descriptor()?t.workbook1Descriptor().workbook1_id:"";return"/app/workbook1/view_workbook?workbook1_id="+encodeURIComponent(e)}),t.activate=function(){Noteflight.postService("/api/1.0/content_packages/read_file",t,t.onWorkbook1IdsFetched)({content_package_id:t.contentPackageId(),encoding:"UTF-8",path:"workbook1_descriptor.json"})},t.onWorkbook1IdsFetched=function(e){t.workbook1Descriptor($.parseJSON(e.file))},t.purchaseURL=ko.computed(function(){return t.listingMetadata().purchaseURL}),t.purchaseWorkbook=function(){(0,r.navigate)(t.purchaseURL())},t.showWorkbook=function(){(0,r.navigate)(t.workbook1ViewUrl())}}},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.RequestLearnDemoViewModel=function(){var e=this;e.session=Noteflight.session,e.templateName=ko.observable("content/requestLearnDemo"),e.title=ko.observable((0,n.resource)("requestLearnDemo.title")),e.resource=n.resource,Noteflight.GenericPageViewModel.call(e),e.showForm=ko.observable(!0),e.isUserLoggedIn=ko.computed(function(){return NF.session.current_user()}),e.isUserLoggedIn.subscribe(function(){e.updateUserInfo()}),e.firstName=ko.observable(""),e.lastName=ko.observable(""),e.role=ko.observable(""),e.noteflightEmail=ko.observable(""),e.contactEmail=ko.observable(""),e.username=ko.observable(""),e.schoolName=ko.observable(""),e.schoolAddress1=ko.observable(""),e.schoolAddress2=ko.observable(""),e.city=ko.observable(""),e.zip=ko.observable(""),e.phone=ko.observable(""),e.integrationOption=ko.observable(),e.integrationOptions=ko.observableArray([{value:"noIntegration",label:(0,n.resource)("content.noIntegrationNeeded")},{value:"gc",label:(0,n.resource)("content.googleClassroom")},{value:"lti",label:(0,n.resource)("content.ltiLmsTool")}]),Noteflight.CommerceCountryStateViewModel.call(this),e.numberOfUsers=ko.observable(""),e.startDate=ko.observable(""),e.questions=ko.observable(""),e.messageResourcesKey=ko.computed(function(){var e="requestLearnDemo.instructions";return NF.session.current_user()||(e+=".notLoggedIn"),e}),e.initialize=function(){e.updateUserInfo()},e.updateUserInfo=function(){if(e.session.current_user()){var t=e.session.current_user();e.noteflightEmail(t.email()),e.username(t.username())}},e.handleKeyUp=function(t,o){"13"!=o.keyCode&&e.serviceReporter.clearErrors()},e.integrationOption.subscribe(function(){e.serviceReporter.clearErrors()}),e.clearErrors=function(){e.serviceReporter.clearErrors()},e.showSignup=function(){Noteflight.appViewModel.showSignupForm()},e.showLogin=function(){Noteflight.appViewModel.showLoginForm()},e.serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("requestLearnDemo.submitting"));var t=Noteflight.postService("/client/1.0/submit_learn_demo_request",e.serviceReporter,function(t){e.showForm(!1)});e.submitDemoRequest=function(){e.serviceReporter.init();var o=[{observable:e.firstName,error:"errors.firstNameRequired"},{observable:e.lastName,error:"errors.lastNameRequired"},{observable:e.username,error:"errors.usernameRequired"},{observable:e.noteflightEmail,error:"errors.emailRequired"},{observable:e.role,error:"errors.roleRequired"},{observable:e.schoolName,error:"errors.schoolNameRequired"},{observable:e.schoolAddress1,error:"errors.schoolAddressRequired"},{observable:e.country,error:"errors.schoolCountryRequired"},{observable:e.city,error:"errors.schoolCityRequired"},{observable:e.numberOfUsers,error:"errors.numberOfUsersRequired"},{observable:e.startDate,error:"errors.startDateRequired"},{observable:e.integrationOption,error:"errors.integrationOptionRequired"}];$.each(o,function(t,o){if(!o.observable()||!o.observable().length)return e.serviceReporter.errors.push({message:(0,n.resource)(o.error)}),!1}),e.serviceReporter.errors().length||("US"!=e.country()||e.state()&&e.state().length?"US"!=e.country()||e.zip().length?t({first_name:e.firstName(),last_name:e.lastName(),role:e.role(),username:e.session.current_user().username(),noteflightEmail:e.session.current_user().email(),user_external_id:e.session.current_user().external_id(),contactEmail:e.contactEmail(),school_name:e.schoolName(),school_address1:e.schoolAddress1(),school_address2:e.schoolAddress2(),country:e.country(),city:e.city(),state:e.state(),zip:e.zip(),phone:e.phone(),number_of_users:e.numberOfUsers(),start_date:e.startDate(),questions:e.questions(),integration_option:e.integrationOption()}):e.serviceReporter.errors.push({message:(0,n.resource)("errors.schoolZipRequired")}):e.serviceReporter.errors.push({message:(0,n.resource)("errors.schoolStateRequired")}))},e.allowSubmit=ko.computed(function(){return!e.serviceReporter.busy()}),e.initialize()},(0,r.addRoute)("requestLearnDemo","/request_learn_demo#",Noteflight.RequestLearnDemoViewModel,{})},function(e,t,o){"use strict";Noteflight.Workbook1WorkingCopyViewModel=function(e){var t=this;t.contentPackageId=ko.observable(e.id),t.listingMetadata=ko.observable(e.listingMetadata),t.filesUrlPrefix=ko.observable("/content_packages/"+t.contentPackageId()+"/files/"),t.templateName=ko.observable("content/workbook1WorkingCopy"),t.bookData=ko.observable(),t.workbook1Descriptor=ko.observable(),Noteflight.GenericPageViewModel.call(t),t.activate=function(){if(t.listingMetadata().expired){var e={expired:!0,title:t.listingMetadata().title,publisher:t.listingMetadata().publisher,publisherURL:"",bookImage:t.listingMetadata().image,styles:{sidebarBackgroundColor:"#c0c0c0",titleColor:"#000000",publisherColor:"#808080",bodyBackgroundColor:"#f0f0f0"}},o=new Noteflight.Workbook1WorkingCopyContentViewModel(t,e);t.bookData(o)}else{Noteflight.postService("/api/1.0/content_packages/read_file",t,t.onWorkbook1IdsFetched)({content_package_id:t.contentPackageId(),encoding:"UTF-8",path:"workbook1_descriptor.json"})}},t.onWorkbook1IdsFetched=function(e){t.workbook1Descriptor($.parseJSON(e.file)),Noteflight.postService("/api/1.0/content_packages/read_file",t,t.onBookContentsFetched)({content_package_id:t.contentPackageId(),encoding:"UTF-8",path:"master_workbook/book.json"})},t.onBookContentsFetched=function(e){var o=$.parseJSON(e.file);o.bookImage&&(o.bookImage="master_workbook/"+o.bookImage);var r=new Noteflight.Workbook1WorkingCopyContentViewModel(t,o);t.bookData(r)}},Noteflight.Workbook1WorkingCopyContentViewModel=function(e,t){var o=this;o.workingCopyViewModel=function(){return e},o.expired=ko.observable(!1),o.authors=ko.observableArray([]);var r={chapters:{create:function(e){return new Noteflight.Workbook1WorkingCopyChapterViewModel(o,e.data)}}};ko.mapping.fromJS(t,r,o),o.bookImageURL=ko.computed(function(){if(o.bookImage)return"/content_packages/"+o.workingCopyViewModel().contentPackageId()+"/files/"+o.bookImage()})},Noteflight.Workbook1WorkingCopyChapterSectionViewModel=function(e,t){var o=this;o.workingCopyViewModel=function(){return e.workingCopyViewModel()},o.name=ko.observable(),ko.mapping.fromJS(t,{},o),o.url=ko.computed(function(){return"/app/workbook1/view_score?workbook1_id="+encodeURIComponent(o.workingCopyViewModel().workbook1Descriptor().workbook1_id)+"&path="+encodeURIComponent(o.name())})},Noteflight.Workbook1WorkingCopyChapterViewModel=function(e,t){var o=this;o.workingCopyViewModel=function(){return e.workingCopyViewModel()},o.expanded=ko.observable(!1);var r={sections:{create:function(e){return new Noteflight.Workbook1WorkingCopyChapterSectionViewModel(o,e.data)}}};ko.mapping.fromJS(t,r,o),o.toggleExpanded=function(){o.expanded(!o.expanded())}}},function(e,t,o){"use strict";var r=o(2),n=o(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o(1172));Noteflight.OauthRequestAccessViewModel=function(){this.session=Noteflight.session,this.templateName=ko.observable("content/oauthRequestAccess");var e=NF.config.oauthAuthRequestInfo;this.title=ko.observable((0,n.resource)("content.oauthDialog.title",e.client_name)),this.resource=n.resource,Noteflight.GenericPageViewModel.call(this),new i.default({}).show()},(0,r.addRoute)("oauthAuthorize","/oauth/authorize_after_login#",Noteflight.OauthRequestAccessViewModel,{})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this))).authToken=NF.authenticityToken,o.authInfo=NF.config.oauthAuthRequestInfo,console.log("authInfo",o.authInfo),o.appName=ko.observable((0,n.resource)("oauth.appNames.".concat(o.authInfo.client_name))),o.appImageUrl=ko.observable(o.authInfo.client_name),o.username=ko.observable(o.authInfo.username),o.scopes=ko.observableArray([]);var r=!0,i=!1,a=void 0;try{for(var s,u=o.authInfo.scopes[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var d=s.value;o.scopes.push({resource:"content.oauth.scopes.".concat(d)})}}catch(e){i=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw a}}return o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"show",value:function(){return(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/oauthRequestAccessDialog"}),this}},{key:"cancel",value:function(){this.submitForm(!1)}},{key:"allow",value:function(){this.submitForm(!0)}},{key:"submitForm",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=window.document.createElement("form");t.setAttribute("action",this.authInfo.auth_path),t.setAttribute("method","post"),e||this.addInput(t,"_method","delete"),this.addInput(t,"authenticity_token",this.authToken);for(var o=["client_id","redirect_uri","state","response_type","scope","code_challenge","code_challenge_method"],r=0;r<o.length;r++){var n=o[r];this.addInput(t,n,this.authInfo[n])}window.document.getElementById("oauthRequestElem").appendChild(t),t.submit()}},{key:"addInput",value:function(e,t,o){var r=window.document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name",t),null!=o&&""!=o&&r.setAttribute("value",o),e.appendChild(r)}}]),t}();t.default=d},function(e,t,o){"use strict";o(202),o(1174),o(1175),o(265),o(1176),o(62),o(218),o(1177),o(200),o(311),o(43),o(264),o(1178)},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.QuoteViewModel=function(e){var t=this;ko.mapping.fromJS(e,{},t),t.renewalText=ko.computed(function(){var e=t.billing_period_unit();return t.initial_charge()!=t.recurring_charge()&&(e+=" for "+Noteflight.formatCurrency(t.recurring_charge())),e})};var i=!0;Noteflight.configureRecurly=function(){i&&(recurly.configure(Noteflight.config.recurlyPublicKey),i=!1)},Noteflight.recurlyCrescendoPlan=function(){return"crescendo"},Noteflight.PlanViewModel=function(e){var t=this;ko.mapping.fromJS(e,{},t),t.pricePerStudent=ko.computed(function(){var e=1;return t.max_scc_count()&&(e=t.max_scc_count()*t.max_scc_member_count()),t.initial_charge()/e}),t.localizedBillingUnits=ko.computed(function(){return"month"==t.billing_period_unit()?(0,n.pluralize)("content.month",t.billing_period()):(0,n.pluralize)("content.year",t.billing_period())}),t.formattedPricePerPeriod=ko.computed(function(){return t.initial_charge()==t.renewal_charge()?(0,n.pluralize)("plans.pricePerUnit",t.billing_period(),NF.formatCurrency(t.initial_charge()),t.localizedBillingUnits()):(0,n.resource)("plan.saleOffer",t.initial_charge(),t.renewal_charge())}),t.updatePricingViaRecurly=function(e){e.busyCounter(e.busyCounter()+1);recurly.Pricing().plan(t.recurlyPlanName(),{quantity:1}).catch(function(t){e.errors.push({message:(0,n.resource)("errors.recurly.generic")}),e.busyCounter(e.busyCounter()-1)}).done(function(o){e.busyCounter(e.busyCounter()-1),t.initial_charge(Number(o.now.subtotal)),t.renewal_charge(Number(o.now.subtotal))})},t.recurlyPlanName=ko.computed(function(){var e=Noteflight.recurlyCrescendoPlan();return t.name&&(e="sp_"+t.name()),e})},Noteflight.CustomTeacherPlanViewModel=function(e,t,o,r){var n=this;parseInt(o,10)>5&&(o=5),parseInt(o,10)<1&&(o=1),parseInt(t,10)<10&&(t=10),Noteflight.PlanViewModel.call(this,{name:"CLIENT_ONLY_CUSTOM_TEACHER_PLAN",billing_period:1,billing_period_unit:"year",displayable_name:"Noteflight Learn",higher_ed_allowed:!1,initial_charge:0,max_scc_count:1,max_scc_member_count:1,purchase_subscription_url:"",renewal_charge:0,requires_promotion:!1}),n.sites=ko.observable(1),n.usersPerSite=ko.observable(1),n.years=ko.observable(1),n.ssoEnabled=ko.observable(r),n.contentLibraries=ko.observableArray(),n.recurlyPlanName=ko.computed(function(){return"sp_learn_"+n.years()+"year"}),n.priceParts=ko.observable({}),n.bloatedPrice=ko.observable();var i=function(){n.bloatedPrice((49+2*n.usersPerSite())*n.sites()*n.years());var e=0;n.contentLibraries().forEach(function(t){e+=5*t.quantity()*n.years()}),n.bloatedPrice(n.bloatedPrice()+e),t+=e;var t=n.bloatedPrice();n.years()>1&&(t*=.95),n.ssoEnabled()&&(n.bloatedPrice(n.bloatedPrice()+100),t+=100),n.initial_charge(t),n.renewal_charge(t),n.priceParts(NF.valueToCurrencyParts(t))},a=function(){var e=Noteflight.ContentLibraryForPurchase.toJson(n.contentLibraries()),t=NF.paths.commerceFormAnnual({sites:n.sites(),users_per_site:n.usersPerSite(),years:n.years(),allow_multiple_subscriptions:!0,sso_enabled:n.ssoEnabled(),content_libraries_json:e});n.purchase_subscription_url(t)};n.updatePriceDummy=ko.computed(function(){n.contentLibraries(),i(),a()}),n.sites.subscribe(function(e){n.max_scc_count(e),i(),a()}),n.usersPerSite.subscribe(function(e){n.max_scc_member_count(e),i(),a()}),n.years.subscribe(function(e){n.billing_period(e),i(),a()}),n.ssoEnabled.subscribe(function(e){i(),a()}),n.sites(e),n.usersPerSite(t),n.years(o)},Noteflight.SubscriptionViewModel=function(e){var t=this;t.prorated_refund=ko.observable(0);var o={quote:{create:function(e){return ko.observable(new Noteflight.QuoteViewModel(e.data))}},plan:{create:function(e){return ko.observable(new Noteflight.PlanViewModel(e.data))}}};ko.mapping.fromJS(e,o,t),t.paymentStatus=ko.computed(function(){return t.ended()?"failed":t.started()?"received":t.payment_delayed()?"delayed":t.payment_initiated()?"initiated":"waiting"}),t.paymentInProgress=ko.computed(function(){var e=t.paymentStatus();return"initiated"==e||"waiting"==e}),t.repurchase=function(){var e={};t.plan().name&&(e.scc_plan_name=t.plan().name(),e.allow_multiple_subscriptions=!0),(0,r.navigate)((0,r.path)("commerceFormAnnual",e))}}},function(e,t,o){"use strict";Noteflight.Discussion=function(e){var t={most_recent_post:{create:function(e){return ko.observable(e.data&&new Noteflight.Post(e.data))}},forum:{create:function(e){return ko.observable(new Noteflight.Forum(e.data))}}};ko.mapping.fromJS(e,t,this)}},function(e,t,o){"use strict";Noteflight.Forum=function(e){var t={most_recent_discussion:{create:function(e){return ko.observable(e.data&&new Noteflight.Discussion(e.data))}}};ko.mapping.fromJS(e,t,this)}},function(e,t,o){"use strict";var r=o(20);Noteflight.Post=function(e){var t={author:{create:function(e){return ko.observable(new Noteflight.User(e.data))}}};ko.mapping.fromJS(e,t,this),this.createdDate=(0,r.observableRelativeTime)(this.created()),this.blocked_at||(this.blocked_at=ko.observable()),this.blockedDate=(0,r.observableRelativeTime)(this.blocked_at())}},function(e,t,o){"use strict";Noteflight.VisitedScore=function(e,t){var o=this;o.title=ko.observable(e),o.externalId=t,o.scoreURL=ko.computed(function(){return"/scores/view/"+o.externalId})}},function(e,t,o){"use strict";o(1180),o(278)},function(e,t,o){"use strict";var r=0,n=[];window.fbAsyncInit=function(){for(window.FB.init({appId:Noteflight.config.facebookAppID,status:!0,xfbml:!0}),r=2;n.length;){n.pop()()}},Noteflight.invokeFBapi=function(){var e=arguments,t=function(){window.FB.api.apply(window.FB,e)};0==r?(!function(e,t,o){r=1;var n,i=e.getElementsByTagName(t)[0];e.getElementById(o)||((n=e.createElement(t)).id=o,n.src="//connect.facebook.net/en_US/all.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk"),n.push(t)):1==r?n.push(t):2==r&&t()},Noteflight.getFBShareCount=function(e,t){var o=new XMLHttpRequest;o.open("GET","https://graph.facebook.com/?id="+encodeURIComponent(e),!0),o.send(null),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(o.response),r=0;e.share&&(r=e.share.share_count),t&&t(r)}}},Noteflight.shareOnFacebook=function(e){return window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436"),!1}},function(e,t,o){"use strict";o(1182),o(1183),o(1184),o(1185),o(1186),o(1187),o(1188),o(1189),o(1190),o(125),o(1191),o(246),o(1192),o(1193),o(204),o(308),o(1194),o(1195),o(1196),o(1197),o(1198),o(238),o(1199),o(1201),o(281),o(307),o(1202),o(1203),o(1204),o(1205),o(1220),o(1222),o(1255),o(1259),o(58),o(42),o(1260),o(1261)},function(e,t,o){"use strict";var r=o(0),n=o(20);Noteflight.ActivityEventViewModel=function(e){var t=this,o={actor:{create:function(e){return ko.observable(new Noteflight.User(e.data))}},actionTarget:{create:function(e){switch(e.data&&e.data.object_type){case"score":return ko.observable(new Noteflight.Score(e.data));case"discussion":return ko.observable(new Noteflight.Discussion(e.data));case"user":return ko.observable(new Noteflight.User(e.data));default:return ko.observable()}}},actionDetails:{create:function(e){switch(e.data&&e.data.object_type){case"post":return ko.observable(new Noteflight.Post(e.data));case"comment":return ko.observable(new Noteflight.Comment(e.data));case"user":return ko.observable(new Noteflight.User(e.data));default:return ko.observable()}}}};ko.mapping.fromJS(e,o,t),t.actorProfileLink=ko.computed(function(){return Noteflight.paths.profile({userId:t.actor().external_id()})}),t.actionTargetType=ko.computed(function(){return t.actionTarget()?t.actionTarget().object_type():null}),t.actionDetailsType=ko.computed(function(){return t.actionDetails&&t.actionDetails()?t.actionDetails().object_type():null}),t.scoreLink=ko.computed(function(){return"score"==t.actionTargetType()?NF.paths.editScore({scoreId:t.actionTarget().external_id()}):null}),t.discussionLink=ko.computed(function(){if("discussion"==t.actionTargetType()){var e=t.actionTarget().forum();return e.group_id&&e.group_id()?NF.paths.viewGroupDiscussion({discussionId:t.actionTarget().id(),forumId:e.id(),groupId:e.group_id()}):NF.paths.discussion({discussionId:t.actionTarget().id(),forumId:e.id()})}return null}),t.userProfileLink=ko.computed(function(){return"user"==t.actionTargetType()?Noteflight.paths.profile({userId:t.actionTarget().external_id()}):null}),t.recipientUserProfileLink=ko.computed(function(){return"user"==t.actionDetailsType()?Noteflight.paths.profile({userId:t.actionDetails().external_id()}):null});var i={favedYourScore:"event.favedYourScore",commentedYourScore:"event.commentedYourScore",followedYou:"event.followedYou",unfollowedYou:"event.unfollowedYou",postedToDiscussion:"event.postedToDiscussion",sharedScoreWithYou:"event.sharedScoreWithYou",sharedScoreWithUser:"event.sharedScoreWithUser",favedScore:"event.favedScore",commentedScore:"event.commentedScore",publishedScore:"event.publishedScore",followedUser:"event.followedUser",unfollowedUser:"event.unfollowedUser",unfavedYourScore:"event.unfavedYourScore",unfavedScore:"event.unfavedScore",copiedYourScore:"event.copiedYourScore",copiedScore:"event.copiedScore",viewedYourScore:"event.viewedYourScore",viewedScore:"event.viewedScore"};t.eventHTML=ko.computed(function(){var e,o,n=i[t.action()],a="<a class='standardLink' href='"+t.actorProfileLink()+"'>"+t.actor().username()+"</a>";switch(t.action()){case"favedYourScore":case"commentedYourScore":case"sharedScoreWithYou":case"sharedScoreWithUser":case"favedScore":case"commentedScore":case"publishedScore":case"unfavedScore":case"unfavedYourScore":case"copiedYourScore":case"copiedScore":case"viewedYourScore":case"viewedScore":e="<a class='standardLink' href='"+t.scoreLink()+"'>"+t.actionTarget().title()+"</a>";break;case"postedToDiscussion":e="<a class='standardLink' href='"+t.discussionLink()+"'>"+t.actionTarget().name()+"</a>";break;case"followedUser":case"unfollowedUser":e="<a class='standardLink' href='"+t.userProfileLink()+"'><div class='inineAvatar userAvatarContainer mini'><div class='avatarImage' style=\"background-image:url('"+t.actionTarget().avatar()+"'\"></div></div>"+t.actionTarget().username()+"</a>";break;default:e=""}return o="sharedScoreWithUser"===t.action()?"<a class='standardLink' href='"+t.recipientUserProfileLink()+"'><div class='inineAvatar userAvatarContainer mini'><div class='avatarImage' style=\"background-image:url('"+t.actionDetails().avatar()+"'\"></div></div>"+t.actionDetails().username()+"</a>":"",n&&(0,r.resource)(n,a,e,o)}),t.eventDetailsHTML=ko.computed(function(){var e;switch(t.action()){case"postedToDiscussion":e=Noteflight.markdownToHtml(t.actionDetails().text());break;case"commentedYourScore":case"commentedScore":e=Noteflight.markdownToHtml(t.actionDetails().text());break;default:e=""}return e}),t.eventDate=(0,n.observableRelativeTime)(t.when()),t.eventIcon=ko.computed(function(){var e;switch(t.action()){case"favedYourScore":case"favedScore":case"unfavedYourScore":case"unfavedScore":e="faveIcon";break;case"copiedYourScore":case"copiedScore":e="copyIcon";break;case"viewedYourScore":case"viewedScore":e="viewIcon";break;case"followedYou":case"followedUser":case"unfollowedYou":case"unfollowedUser":e="followIcon";break;case"postedToDiscussion":e="postIcon";break;case"commentedYourScore":case"commentedScore":e="commentIcon";break;case"sharedScoreWithYou":case"sharedScoreWithUser":e="shareIcon";break;case"publishedScore":e="publishIcon"}return e})},Noteflight.ActivityStreamViewModel=function(){var e=this;e.listType=ko.observable("activity"),e.loadingMessage=(0,r.resource)("action.loading"),e.virginal=!0,e.remaining=ko.observable(),e.busy=ko.observable(!1),e.eventIterator=null,e.batchSize=20,e.maxEvents=0,e.userId=ko.observable(),e.events={activityEvents:ko.observableArray()},e.activate=function(){e.virginal&&e.reset(),e.notifyPanelActivated()},e.notifyPanelActivated=function(){},e.clear=function(){e.events.activityEvents.removeAll(),e.eventIterator&&e.eventIterator.stop(),e.eventIterator=e.createIterator(),e.busy(!1),e.remaining(!0)},e.reset=function(){e.clear(),e.virginal=!1,e.fetchEvents()},e.fetchEvents=function(){e.busy()||(e.maxEvents=e.events.activityEvents().length+e.batchSize,e.getNextEvent())},e.createIterator=function(){return new Noteflight.ActivitySourceEventsIterator("user:"+e.userId())},e.getNextEvent=function(){e.busy(!0),e.eventIterator.next(e.addEvent)},e.addEvent=function(t){if(t){var o=new Noteflight.ActivityEventViewModel(t);e.events.activityEvents.push(o),e.events.activityEvents().length<e.maxEvents?e.getNextEvent():e.busy(!1)}else e.busy(!1),e.remaining(!1)},Noteflight.PageableViewModel.call(this,e.fetchEvents)}},function(e,t,o){"use strict";Noteflight.ActivityStreamEventsIterator=function(e){var t=this;t.options=e||{};t.sources=[],t.sources_by_name={},t.sources_retrieved=!1,t.completed_sources_by_name={},t.events_by_id={},t.sources_next_before_id=null,t.sources_next_after_id=null,t.oldest_returned_event_id=null,t.next_callback=null,t.source_to_refresh=null,t.personal_source_loaded=!1,t.stopped=!1,t.stop=function(){t.stopped=!0},t.log=function(){},t.next=function(e){var o;if(t.log("next()"),t.stopped)t.log("  stopped");else{if(t.log("  sources",t.sources),t.next_callback)throw"next() was called again before the previous next() completed";if(t.next_callback=e,t.options.personal_source&&!t.personal_source_loaded)t.load_personal_source();else if(t.source_to_refresh)o=t.source_to_refresh,t.source_to_refresh=null,t.prepare_next_event(o);else if(t.sources_retrieved)if(t.sources.length>0){var r=(o=t.sources[0]).next_event;r?(t.source_to_refresh=o,t.is_valid_event(r)?(t.oldest_returned_event_id=r.event_id,t.events_by_id[r.event_id]=r,t.do_callback(r)):t.reenter_next()):t.prepare_next_event(o)}else t.sources_next_before_id?t.retrieve_sources():t.do_callback(null);else t.retrieve_sources()}},t.prepare_next_event=function(e){t.log("prepare_next_event("+e.source_name+")"),t.prepare_next_event_source=e,e.events_iterator.next(t.next_event_received)},t.prepare_next_event_source=null,t.next_event_received=function(e){var o=t.prepare_next_event_source;t.prepare_next_event_source=null,e?(t.log("next_event_received(id: "+e.event_id+", action: "+e.action+")"),o.next_event=e,o.next_event_id=e.event_id,t.sort_sources()):(t.log("next_event_received(null)"),t.remove_source(o))},t.retrieve_sources=function(){t.log("retrieve_sources()");t.options.get_more_sources_call?t.options.get_more_sources_call(t.sources_next_before_id,t.sources_next_after_id,10,t.sources_received):Noteflight.postService("/api/1.0/activity_stream/activity_sources",t,t.sources_received)({before_id:t.sources_next_before_id,after_id:t.sources_next_after_id,limit:10})},t.sources_received=function(e){if(t.log("sources_received(...)",e),t.sources_next_before_id=e.next_before_id,t.sources_next_after_id=e.next_after_id,t.sources_retrieved=!0,t.log("  received sources, self.sources_next_before_id = "+t.sources_next_before_id),e.next_before_id){var o=[];e.after_sources&&(o=o.concat(e.after_sources)),e.before_sources&&(o=o.concat(e.before_sources));for(var r=0;r<o.length;r++)t.add_source(o[r]);t.sort_sources()}else 0===t.sources.length?t.do_callback(null):t.reenter_next()},t.add_source=function(e){t.log("add_source("+e.source_name+")");var o=null;return t.sources_by_name[e.source_name]||t.completed_sources_by_name[e.source_name]||(o=new function(e,o,r){this.source_name=e,this.events_iterator=new Noteflight.ActivitySourceEventsIterator(e,{initial_source_events:r,get_more_events_call:t.options.get_more_events_call}),this.next_event=null,this.next_event_id=o}(e.source_name,e.last_activity_event_id,e.source_events),t.sources.push(o),t.sources_by_name[o.source_name]=o),o},t.sort_sources=function(){t.log("sort_sources()"),t.sources.sort(function(e,t){return e.next_event_id>t.next_event_id?-1:e.next_event_id<t.next_event_id?1:0}),t.sources.length>0&&t.log("self.sources[0].next_event_id = "+t.sources[0].next_event_id+", self.sources_next_before_id = "+t.sources_next_before_id),t.sources.length>0&&t.sources_next_before_id&&t.sources[0].next_event_id<t.sources_next_before_id?t.retrieve_sources():t.reenter_next()},t.remove_source=function(e){t.log("remove_source("+e.source_name+")");for(var o=0;o<t.sources.length;o++)if(t.sources[o]==e){t.sources.splice(o,1);break}t.sources_by_name[e.source_name]=null,t.completed_sources_by_name[e.source_name]=e,t.sort_sources()},t.do_callback=function(e){if(t.log("do_callback()"),t.stopped)t.log("  stopped");else{var o=t.next_callback;t.next_callback=null,o(e)}},t.reenter_next=function(){t.log("reenter_next()");var e=t.next_callback;t.next_callback=null,t.next(e)},t.is_valid_event=function(e){return t.oldest_returned_event_id&&e.event_id>t.oldest_returned_event_id?(t.log("  invalid event, event id "+e.event_id+" > "+t.oldest_returned_event_id),!1):!t.events_by_id[e.event_id]||(t.log("  invalid event, duplicate id "+e.event_id),!1)},t.load_personal_source=function(){t.log("load_personal_source()"),t.personal_source_loaded=!0;var e=t.add_source({source_name:t.options.personal_source});t.prepare_next_event(e)}},Noteflight.ActivitySourceEventsIterator=function(e,t){var o=(t=t||{}).initial_source_events,r=t.include_privately_visible_events,n=t.get_more_events_call,i=this,a=!1,s=null,l=null,c=null,u=function(e){a=!0,l=e.next_before_id,s=e.before_events};o&&u(o),i.stopped=!1,i.stop=function(){i.stopped=!0},i.next=function(e){if(!i.stopped)if(a)if(s&&s.length>0){var t=s.shift();t.privatelyVisible&&!r?i.next(e):e(t)}else l?i.getMoreEvents(e):e(null);else i.getMoreEvents(e)},i.getMoreEvents=function(t){c=t;n?n(e,20,l,i.handleEventsReceived):i.callForMoreEvents(e,20,l,i.handleEventsReceived)},i.callForMoreEvents=function(e,t,o,r){Noteflight.postService("/api/1.0/activity_stream/activity_source_events",i,i.handleEventsReceived)({source_name:e,limit:t,before_id:o})},i.handleEventsReceived=function(e){u(e);var t=c;c=null,i.next(t)}}},function(e,t,o){"use strict";var r=o(0);Noteflight.AddEntity=function(e,t,o,n){var i=this;i.name=e,i.mode=n||"",i.getEntities=t,i.matchingCallback=o,NF.ServiceReporterViewModel.call(this,(0,r.resource)("action.loading")),i.nameQuery=ko.computed(function(){return i.name().toLowerCase()}),i.entityMatches=ko.observableArray(),i.matchingEntity=ko.computed(function(){for(var e=0;e<i.entityMatches().length;e++)if(i.entityMatches()[e].name().toLowerCase()==i.nameQuery())return i.entityMatches()[e];return null}),i.disable=ko.computed(function(){for(var e=!1,t=0;t<i.entityMatches().length;t++)if(i.entityMatches()[t].name()==i.name()){e=!0;break}return 0===i.name().length||i.busy()||!e}),i.handleKeydown=function(e,t){switch(t.keyCode){case 38:return i.cycleMatches(-1),!1;case 40:return i.cycleMatches(1),!1;case 13:return"search"==i.mode?(i.matchingCallback(i.matchingEntity()),i.entityMatches([]),!0):(i.matchingEntity()?i.addMatchingEntity():i.cycleMatches(1),!1)}return!0},i.throttledName=ko.computed(function(){return i.nameQuery()}).extend({throttle:250}),i.throttledName.subscribe(function(){if(!i.matchingEntity()&&i.nameQuery().length>=2){var e={max_count:5,user_id:NF.session.current_user().external_id(),query:i.nameQuery()};i.getEntities(e,i.entityMatches)}else i.nameQuery().length<2&&i.entityMatches([])}),i.cycleMatches=function(e){var t=i.entityMatches().length;if(t>0){e<0&&(e+=t);for(var o=0;o<i.entityMatches().length;o++)if(i.entityMatches()[o].name().toLowerCase()==i.nameQuery().toLowerCase())return void i.name(i.entityMatches()[(o+e)%t].name());i.name(i.entityMatches()[0].name())}},i.addMatchingEntity=function(){(i.matchingEntity()||"search"==i.mode)&&(i.matchingCallback(i.matchingEntity()),i.name(""),i.entityMatches([]))}}},function(e,t,o){"use strict";var r=o(0),n=o(3),i=o(20),a=function(e){var t=this;ko.mapping.fromJS(e,{},t),t.url=function(){return window.location.protocol+"//"+t.hostname()}};Noteflight.AlertViewModel=function(e){this.subscription=ko.observable(),this.communities_waiting_for_crescendo=ko.observableArray(),this.communities_requiring_crescendo=ko.observableArray(),this.formatDate=i.formatDate;var t={subscription:{create:function(e){return ko.observable(new Noteflight.SubscriptionViewModel(e.data))}},communities_waiting_for_crescendo:{create:function(e){return ko.observable(new a(e.data))}},communities_requiring_crescendo:{create:function(e){return ko.observable(new a(e.data))}}};ko.mapping.fromJS(e,t,this),this.displayTitle=(0,r.resource)("alert.accountAlert")},Noteflight.AlertSequenceModel=function(){var e=this;e.alert=ko.observable(),e.done=ko.observable(!1),e.subscriptionId=ko.observable(),e.handleNextAlert=function(t){t.alert?(e.alert(new Noteflight.AlertViewModel(t.alert)),Noteflight.appViewModel.reloadSession()):e.done(!0)},e.alertService=Noteflight.postService("/api/1.0/members/alert",e,e.handleNextAlert),e.requestNextAlert=function(){e.alert(null),e.alertService(e.subscriptionId()?{params:{subscription_id:e.subscriptionId()}}:{})}},Noteflight.AlertSequenceDialog=function(){var e=this;n.DialogViewModel.call(e),e.alertSequence=ko.observable(new Noteflight.AlertSequenceModel),e.shown=!1,ko.computed(function(){e.alertSequence().alert()&&!e.shown&&(e.shown=!0,(0,n.createAndShowDialog)({viewModel:e,templateName:"dialogs/alertSequence"}))}),ko.computed(function(){!e.alertSequence().alert()&&e.shown&&(e.shown=!1,(0,n.hideCurrentDialog)())}),e.dismissAlert=function(){e.alertSequence().requestNextAlert()}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(2),n=o(0);function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.acceptanceKey=ko.observable(),this.changeComplete=ko.observable(!1),this.success=ko.observable(!1),this.templateName=ko.observable("content/changeEmailComplete")}return function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(e,[{key:"onNavigate",value:function(){var e=this;NF.apiService.changeEmailComplete((0,n.resource)("action.loadingInfo"),function(t){e.changeComplete(!0),e.success(!0)},{acceptance_key:this.acceptanceKey()},{fail:function(){e.changeComplete(!0)}})}}]),e}();t.default=a,(0,r.addRoute)("changeEmailComplete","/users/complete_change_email#/{acceptanceKey}",a,{})},function(e,t,o){"use strict";Noteflight.CommonRealTimeFeedback=function(){var e=this;e.CANVAS_WIDTH=72,e.CANVAS_HEIGHT=40,e.DOTS_SEPARATION=10,e.DOTS_PADDING=5,e.canvasContext=null,e.initializeCanvas=function(){if(!e.canvasContext){var t=document.getElementById("recordingCanvas");t?(e.canvasContext=t.getContext("2d"),e.drawStaticCanvas()):setTimeout(e.initializeCanvas,50)}},e.drawBackground=function(t){e.canvasContext.fillStyle="#e7e5ce",e.canvasContext.globalAlpha=t,e.canvasContext.fillRect(0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT)},e.clearCanvas=function(){e.canvasContext.clearRect(0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT)},e.drawDots=function(t){for(var o=e.CANVAS_WIDTH/e.DOTS_SEPARATION,r=1;r<=o;r++)e.canvasContext.fillStyle="#666659",e.canvasContext.globalAlpha=1,e.canvasContext.fillRect(e.DOTS_SEPARATION*r-t,e.DOTS_PADDING,1,1),e.canvasContext.fillRect(e.DOTS_SEPARATION*r-t,e.CANVAS_HEIGHT-e.DOTS_PADDING,1,1)},e.realHeight=function(){return e.CANVAS_HEIGHT-2*e.DOTS_PADDING},e.drawStaticCanvas=function(){e.clearCanvas(),e.drawBackground(.2)}}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.FlagGlobalDialog=function(e,t){var o=this;o.name=e,o.title=ko.computed(function(){return(0,r.resource)("content.flagIndividual",o.name)}),n.DialogViewModel.call(o),o.reason=ko.observable(""),o.show=function(){(0,n.createAndShowDialog)({viewModel:o,templateName:"dialogs/flagGlobalDialog"})},o.callback=function(){(0,n.hideCurrentDialog)(),t(o.reason())}}},function(e,t,o){"use strict";var r=o(0);Noteflight.MyFollowViewModel=function(e){var t=this;t.events=new ko.subscribable,t.user=e,t.canFollow=ko.computed(function(){return NF.session.current_user()&&NF.session.current_user().external_id()!=e.external_id()}),t.following=ko.computed(function(){return t.user.following()}),t.busy=ko.observable(!1),t.followUserComplete=function(e){t.followStatusChanged(!0)},t.unfollowUserComplete=function(e){t.followStatusChanged(!1)},t.followStatusChanged=function(e){var o=t.user.profile().followingsFollowers().followersCount();o=e?o+1:o-1,t.user.profile().followingsFollowers().followersCount(o),t.user.following(e),t.events.notifySubscribers(e,"followStatusChanged")};var o=Noteflight.postService("/api/1.0/activity_stream/follow_user",t,t.followUserComplete),n=Noteflight.postService("/api/1.0/activity_stream/unfollow_user",t,t.unfollowUserComplete);t.addToFollows=function(){Noteflight.checkUserIdentified((0,r.resource)("action.follow"),(0,r.resource)("action.followAction"))&&o({user_id:t.user.external_id()})},t.removeFromFollows=function(){n({user_id:t.user.external_id()})}}},function(e,t,o){"use strict";var r=u(o(204)),n=u(o(125)),i=u(o(32)),a=o(2),s=o(0),l=o(31),c=o(3);function u(e){return e&&e.__esModule?e:{default:e}}Noteflight.HeaderViewModel=function(){var e=this;e.session=Noteflight.session,e.currentForm=ko.observable(null),e.signupViewModel=new r.default,e.loginViewModel=new n.default,e.headerNeedToValidateViewModel=new Noteflight.HeaderNeedToValidateViewModel(e),e.headerAttachResourceViewModel=new Noteflight.HeaderContentViewModel(e),e.headerLTIReplaceResultViewModel=new Noteflight.HeaderLTIReplaceResultViewModel(e),e.visible=ko.observable(!0),e.recordingMode=ko.observable(!1),e.strippedDown=ko.observable(!1),e.sitesTip=new Noteflight.TipViewModel([{resourcesKey:"tip.sitesTip"}],"_nf_tip_sites.hidden","sitesTip"),e.toggleForm=function(t){e.currentForm()&&e.currentForm()!=t?(e.currentForm().showForm(!1),window.setTimeout(function(){e.toggleForm(t)},300)):(t.showForm(!t.showForm()),t.showForm()&&e.currentForm(t))};var t=NF.session.community().default_community()?NF.paths.createNewSite():"".concat(window.location.protocol,"//").concat(Noteflight.defaultHostname).concat(NF.paths.createNewSite());e.newSiteUrl=ko.observable(t),e.showLoginForm=function(){e.loginViewModel.show()},e.showSignupForm=function(t){e.signupViewModel.show()},e.showLTIReplaceResultForm=function(t,o){e.headerLTIReplaceResultViewModel.assignParams(t),e.headerLTIReplaceResultViewModel.submitCallback=o,e.headerLTIReplaceResultViewModel.canSubmit()&&e.toggleForm(e.headerLTIReplaceResultViewModel)},ko.computed(function(){e.currentForm()&&!e.currentForm().showForm()&&e.currentForm(null)}),e.animatingHeaderHeight=ko.observable(!1);var o=null;e.setAnimatingHeaderHeight=function(){window.clearTimeout(o),e.animatingHeaderHeight(!0),o=window.setTimeout(function(){e.animatingHeaderHeight(!1)},600)},ko.computed(function(){var t=e.currentForm()&&e.currentForm().showForm();e.setAnimatingHeaderHeight(t)}),e.logoRedirection=ko.computed(function(){var e=null;if(NF.session.user_groups){for(var t=NF.session.user_groups.groups(),o=0;o<t.length;o++)if(t[o].is_community_group()){e=NF.paths.viewGroup({groupId:t[o].id()});break}}else NF.session.community()&&(e=NF.session.community().community_url());return e||"/"}),e.mightNeedReminderBar=ko.computed(function(){return e.session.current_user()&&!e.session.current_user().verified()}),e.authorDisplayableLinkName=ko.observable(NF.session.author_displayable_link_name&&NF.session.author_displayable_link_name()),ko.computed(function(){!(!e.session.current_user()||e.session.current_user().verified()||!e.session.show_reminders())!=e.headerNeedToValidateViewModel.showForm()&&e.toggleForm(e.headerNeedToValidateViewModel)}),e.newScore=function(){if(e.session.current_user()){var t=new Noteflight.ServiceReporterViewModel((0,s.resource)("header.creatingScore"),null,null,function(t){"tooManyScores"!=t.code||e.session.current_user()&&e.session.current_user().has_premium_features()||(0,i.default)((0,s.resource)("action.newScoreTitle"),(0,s.resource)("content.addMoreScores"),"add_more_scores")});Noteflight.postService("/api/1.0/members/create_score",t,function(e){(0,a.navigate)((0,a.path)("editScore",{scoreId:e.score.external_id})),NF.analytics.trackEvent("behavior","score_creation")})()}else(0,c.showMustLoginSignupDialog)((0,s.resource)("action.newScoreTitle"),(0,s.resource)("action.newScoreAction"))},e.newGroup=function(){e.session.current_user().has_premium_features()?(0,a.navigate)((0,a.path)("newGroup")):(0,i.default)((0,s.resource)("action.newGroupTitle"),(0,s.resource)("action.newGroup"),"new_group")},e.navToYourScores=function(){e.session.current_user()?(0,a.navigate)((0,a.path)("loggedInHome")):(0,c.showMustLoginSignupDialog)((0,s.resource)("action.yourScoresTitle"),(0,s.resource)("action.yourScoresAction"))},e.navToScores=function(){e.session.current_user()?(0,a.navigate)((0,a.path)("loggedInHome")):(0,a.navigate)((0,a.path)("allScores"))};e.toggledBanner=ko.observable(!1),e.suppressBanner=ko.observable(!1),e.hideAnnouncementBanner=function(){NF.hasStorage&&localStorage.setItem("_nf_global_banner.hidden_millis",(new Date).getTime().toString()),e.toggledBanner(!0),e.setAnimatingHeaderHeight(!1)},e.showAnnouncementBanner=ko.computed(function(){if(NF.hasStorage){var t=localStorage.getItem("_nf_global_banner.hidden_millis");if(t){var o=parseInt(t,10),r=(new Date).getTime(),n=6048e5;if(Noteflight.config.settings&&Noteflight.config.settings.bannerHideDuration&&(n=1e3*Noteflight.config.settings.bannerHideDuration*60*60*24),Math.floor(r-o)<n)return!1}}return!e.suppressBanner()&&!e.toggledBanner()}),e.goBack=function(){NF.appViewModel.navigateToLastMasterView()},e.showPreviewBanner=!!(0,l.getCookie)("content_item_preview")},Noteflight.HeaderContentViewModel=function(){var e=this;e.showForm=ko.observable(!0),e.hideForm=function(){e.showForm(!1)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(2),i=o(0),a=o(3);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=c(this,u(t).call(this))).serviceReporter=new Noteflight.ServiceReporterViewModel((0,i.resource)("action.linking")),e.serviceReporter.showErrorsInBackground(!1),e.initializeObservables(),e.initializeComputeds(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.default),function(e,t,o){t&&l(e.prototype,t),o&&l(e,o)}(t,[{key:"initializeObservables",value:function(){this.username=ko.observable(""),this.password=ko.observable(""),this.success=ko.observable(!1),this.linking=ko.observable(!1)}},{key:"initializeComputeds",value:function(){var e=this;this.loginEnabled=ko.computed(function(){return e.username().length>0&&e.password().length>0&&!e.linking()})}},{key:"linkAccount",value:function(){var e=this;this.linking(!0),this.clearErrors(),NF.apiService.linkUserToNFAccount(this.serviceReporter,function(t){e.clearErrors(),e.success(!0),NF.analytics.trackEvent("webapp","link_account")},{username:this.username(),password:this.password()},{always:function(){e.linking(!1)}})}},{key:"loginWithFacebook",value:function(){(0,n.navigate)("/auth/facebook/")}},{key:"loginWithGoogle",value:function(){(0,n.navigate)("/auth/google/")}},{key:"linkSucceeded",value:function(){NF.reloadWindow()}},{key:"handleKeyUp",value:function(e,t){if(void 0!==t.keyCode)switch(t.keyCode.toString()){case"13":this.linkAccount();break;case"27":this.cancel();break;default:this.clearErrors()}return!0}},{key:"show",value:function(){(0,a.createAndShowDialog)({viewModel:this,templateName:"dialogs/linkAccounts"})}},{key:"clearErrors",value:function(){this.serviceReporter.errors([])}}]),t}();t.default=p,NF.LinkAccountsViewModel=p},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.HeaderLTIReplaceResultViewModel=function(){var e=this;e.grade=ko.observable(""),e.ltiParams=["lis_result_sourcedid","lis_outcome_service_url","oauth_consumer_key","ext_outcome_data_values_accepted","link_title"];for(var t=0;t<e.ltiParams.length;t++)e[e.ltiParams[t]]=ko.observable();e.assignParams=function(t){for(var o=0;o<e.ltiParams.length;o++){var r=e.ltiParams[o];e[r](t[r])}},e.serviceReporter=new Noteflight.ServiceReporterViewModel((0,r.resource)("session.replacingResult"));var o=Noteflight.postService("/api/1.0/lti/replace_result",e.serviceReporter,function(){e.hideForm()});e.showForm=ko.observable(!1),e.hideForm=function(){e.showForm(!1)},e.showForm.subscribe(function(){e.serviceReporter.clearErrors(),e.showForm()?e.serviceReporter.init():e.serviceReporter.hide()}),e.canSubmit=ko.computed(function(){return!!e.lis_result_sourcedid()}),e.allowGrade=ko.computed(function(){return NF.session.community_member&&NF.session.community_member()&&"student"!=NF.session.community_member().sso_user_role()}),e.replaceResult=function(){e.serviceReporter.init();var t,o=100;(e.allowGrade()&&(e.grade()?(o=parseInt(e.grade(),10),(!e.grade().match(/^[0-9]+$/)||o<0||o>100)&&e.serviceReporter.errors.push({message:(0,r.resource)("errors.gradeNotValid")})):e.serviceReporter.errors.push({message:(0,r.resource)("errors.gradeRequired")})),0===e.serviceReporter.errors().length)&&(t=e.link_title()?(0,r.resource)(e.allowGrade()?"content.confirmSubmitGrade":"content.confirmSubmitAssignment",e.link_title()):(0,r.resource)(e.allowGrade()?"content.confirmSubmitGradeUntitled":"content.confirmSubmitAssignmentUntitled"),(0,n.okCancel)(t,function(){e.doReplaceResult(o)}));return!1},e.doReplaceResult=function(t){o({lis_outcome_service_url:e.lis_outcome_service_url(),lis_result_sourcedid:e.lis_result_sourcedid(),ext_outcome_data_values_accepted:e.ext_outcome_data_values_accepted(),oauth_consumer_key:e.oauth_consumer_key(),result_data_url:window.location.href,result:t/100}),e.submitCallback&&e.submitCallback()}}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.HeaderNeedToValidateViewModel=function(e){var t=this;t.email=ko.observable(),ko.computed(function(){t.email(Noteflight.session.current_user()&&Noteflight.session.current_user().email())}),t.reporter=new Noteflight.ServiceReporterViewModel((0,r.resource)("header.sendingConfirmationLink")),t.showForm=ko.observable(!1),t.showMoreInfo=ko.observable(!1),t.validationTitle=ko.observable((0,r.resource)("mustBeVerified.actionMessage",(0,r.resource)("action.beSocial"))),t.hideForm=function(){t.showMoreInfo(!1),Noteflight.session.show_reminders(!1),Noteflight.postService("/client/1.0/session_properties",t,function(e){})({show_reminders:!1}),t.showForm(!1)},t.handleKeyUp=function(e,o){"13"!=o.keyCode&&t.reporter.clearErrors()},Noteflight.checkUserVerified=function(e){var o=Noteflight.session.current_user();return!!o&&(!!o.verified()||(t.validationTitle((0,r.resource)("mustBeVerified.actionMessage",e)),Noteflight.session.show_reminders()?(0,n.standardAlertDialog)((0,r.resource)("mustBeVerified.actionMessage",e)):Noteflight.session.show_reminders(!0),!1))},Noteflight.checkUserIdentified=function(e,t){return Noteflight.session.current_user()?!!Noteflight.checkUserVerified(t)&&(!!Noteflight.session.current_user().identified()||((0,n.showMustCreateProfileDialog)(e,t),!1)):((0,n.showMustLoginSignupDialog)(e,t),!1)},t.updateRegistrationService=Noteflight.postService("/client/1.0/update_registration",t.reporter,function(o){Noteflight.session.current_user().email(t.email()),t.showMoreInfo(!0),e.setAnimatingHeaderHeight(!0)}),t.resendValidationMail=function(){t.updateRegistrationService({email:t.email()})},t.busy=ko.observable(!1)}},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),n=o(5),i=o(0),a=o(74);Noteflight.PaletteControl=function(e,t,o){var r=this;r.parent=e,r.controller=ko.observable(o),r.advanced=ko.observable(!1),r.styleClasses=ko.observable(),r.inheritWidth=ko.observable(!1),ko.mapping.fromJS(t,{},this),r.visible=ko.pureComputed(function(){var e=!r.visibleFunction||r.controller()[r.visibleFunction()]();return r.invisibleFunction&&(e=e&&!r.controller()[r.invisibleFunction()]()),e}),r.disabled=ko.pureComputed(function(){return r.disableFunction?r.controller()[r.disableFunction()]():!!r.enableFunction&&!r.controller()[r.enableFunction()]()}),r.template=ko.pureComputed(function(){return"palette/"+r.type()}),r.baseCSS=ko.pureComputed(function(){var e="";return r.advanced()&&(e+="advanced "),r.disabled()&&(e+="disabled "),r.dropClass&&(e+=r.dropClass()+" "),r.anonymousDropClass&&!NF.session.current_user()&&(e+=r.anonymousDropClass()+" "),r.parent.controller&&r.parent.controller().activeHeaderTag&&r.parent.controller().activeHeaderTag()==r.id()&&(e+="highlightedPaletteElement"),e}),r.smartLoadId=ko.pureComputed(function(){return r.id?e.loadDescendantIcons?e.loadDescendantIcons(r)?r.id():"":r.id():""}),r.controlTypes={actionButton:Noteflight.PaletteActionButton,toggleButton:Noteflight.PaletteToggleButton,radioButton:Noteflight.PaletteRadioButton,urlButton:Noteflight.PaletteURLButton,separator:Noteflight.PaletteSeparator,searchControl:Noteflight.SearchControl},e.customControlTypes&&$.extend(r.controlTypes,e.customControlTypes),r.controlTypes[r.type()]&&r.controlTypes[r.type()].call(r),r.destroy=function(){r.visible.dispose(),r.disabled.dispose(),r.smartLoadId.dispose(),r.selected&&r.selected.dispose(),r.title&&r.title.dispose(),r.shortcut&&r.shortcut.dispose(),r.showZoomToFit&&r.showZoomToFit.dispose(),r.currentZoom&&r.currentZoom.dispose(),r.css&&r.css.dispose()}};var s=-1!=navigator.userAgent.indexOf("Mac OS X"),l={save:"S",print:"P",cut:"X",copy:"C",paste:"V",undo:"Z",redo:"Y",selectAll:"A",lyrics:NF.safari?"Ctrl+L":"L",expressionText:"E",graceNote:"G",moveUp:"",moveDown:"",moveHalfUp:"",moveHalfDown:"",moveOctaveUp:"",moveOctaveDown:"",pageBreakAfter:" Enter",hideShowCautionaries:" Enter",filterChordSymbols:"K",filterPerformanceText:"T",filterUpperVoice:"U",filterLowerVoice:"L",control:"",shift:"",left:"",right:"",extendLeft:"",extendRight:""},c={save:"Ctrl+S",print:"Ctrl+P",cut:"Ctrl+X",copy:"Ctrl+C",paste:"Ctrl+V",undo:"Ctrl+Z",redo:"Ctrl+Y",selectAll:"Ctrl+A",lyrics:"Ctrl+L",expressionText:"Ctrl+E",graceNote:"Ctrl+G",moveUp:"",moveDown:"",moveHalfUp:"Shift+",moveHalfDown:"Shift+",moveOctaveUp:"Ctrl+",moveOctaveDown:"Ctrl+",pageBreakAfter:"Shift Enter",hideShowCautionaries:"Ctrl+Enter",filterChordSymbols:"Shift+K",filterPerformanceText:"Shift+T",filterUpperVoice:"Shift+U",filterLowerVoice:"Shift+L",control:"Ctrl",shift:"Shift",left:"",right:"",extendLeft:"Shift+",extendRight:"Shift+"},u={repeat:"R",flat:"-",doubleFlat:"_",sharp:"+",doubleSharp:"*",natural:"=",tie:",",dot:".",performanceText:"T",chord:"K",beamStart:"}",beamContinue:"{",duplet:"2",triplet:"3",quadruplet:"4",quintuplet:"5",sextuplet:"6",septuplet:"7",noteLonger:"]",noteShorter:"[",marcato:"'",staccato:";",tenuto:":",martellato:'"',fermata:"^",courtesyAccidental:"%",changeNoteHead:"?",parentheses:"`",crescendo:"<",diminuendo:">",slur:"S",startBeam:"}",continueBeam:"{",bend:"~",preBend:"|",slide:"\\",systemBreakAfter:"Enter",voiceUpper:"U",voiceLower:"L",voiceUpperRemove:"M",voiceLowerRemove:"M",addSlash:"/",enharmonics:"Z",play:"Space",playFromStart:"P",escape:"Escape",enter:"Enter"},d={"palette.filter":!0};Noteflight.PaletteShortcut=function(e){return((s?l[e]:c[e])||u[e]||"").replace(/[A-Za-z]{2,}/g,function(e){return(0,i.resource)("palette.key."+e.toLowerCase())})},Noteflight.PaletteControlWithTitle=function(){var e=this;Noteflight.PaletteControlWithShortcut.call(e),e.title=ko.pureComputed(function(){return"palette."+e.id()}),e.controlId=ko.computed(function(){return"control-"+e.id()})},Noteflight.PaletteControlWithShortcut=function(){var e=this;e.shortcut=ko.pureComputed(function(){return NF.PaletteShortcut(e.id())})},Noteflight.PaletteURLButton=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.url=ko.pureComputed(function(){var t=e.route?e.route():"",o=e.externalPath?e.externalPath():"",r=e.routeArgs?ko.mapping.toJS(e.routeArgs):{};if(t){var n=Noteflight.paths[t];if(n)return n(r)}return o?e.externalPath():null}),e.openNewTab=ko.pureComputed(function(){return e.newTab&&e.newTab()?"_blank":""}),e.css=ko.pureComputed(function(){return"".concat(e.baseCSS()," paletteButton link ").concat(e.smartLoadId()," ").concat(e.styleClasses())})},Noteflight.PaletteSeparator=function(){var e=this;e.css=ko.pureComputed(function(){var t="paletteSeparator ";return e.advanced()&&(t+="advanced"),t})},Noteflight.PaletteActionButton=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),Noteflight.PaletteControlWithShortcut.call(e),e.visibleIcon=ko.observable(0),e.css=ko.pureComputed(function(){var t=e.baseCSS()+" paletteButton "+e.smartLoadId();return e.toggleIconClasses&&(t+=" ".concat(e.toggleIconClasses()[e.visibleIcon()])),t}),e.clicked=function(){if(NF.analytics.trackEvent("editor",e.id(),"button"),!e.disabled()){if(e.toggleIconClasses){var t=(e.visibleIcon()+1)%e.toggleIconClasses().length;e.visibleIcon(t)}e.actionFunction&&e.controller()[e.actionFunction()](e.id())}}},Noteflight.PaletteToggleButton=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.selected=ko.pureComputed(function(){return(!NF.IsPhoneLayout()||!d[e.title()])&&(e.getValueFunction?e.controller()[e.getValueFunction()](e.id()):e.valueFunction?e.controller()[e.valueFunction()]():void 0)}),e.css=ko.pureComputed(function(){var t=e.baseCSS()+" paletteButton "+e.smartLoadId();return e.selected()&&(t+=" selected"),t}),e.clicked=function(){NF.analytics.trackEvent("editor",e.id(),"button"),e.disabled()||(e.actionFunction?e.controller()[e.actionFunction()](e.id()):e.valueFunction&&e.controller()[e.valueFunction()](!e.controller()[e.valueFunction()]()))}},Noteflight.PaletteRadioButton=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.selected=ko.pureComputed(function(){if(e.valueFunction)return e.controller()[e.valueFunction()]()==e.value()}),e.css=ko.pureComputed(function(){var t=e.baseCSS()+" paletteButton "+e.smartLoadId()+" ";return e.selected()&&(t+="selected"),t}),e.clicked=function(){NF.analytics.trackEvent("editor",e.id(),"button"),e.setValueFunction?e.controller()[e.setValueFunction()](e.value()):e.valueFunction&&(e.allowNone&&e.allowNone()&&e.controller()[e.valueFunction()]()==e.value()?e.controller()[e.valueFunction()](null):e.controller()[e.valueFunction()](e.value()))}};var p=null;Noteflight.PalettePopupControl=function(e,t,o,i){var a=this;a.popupShown=ko.observable(!1),a.hideOnClick=!!i,a.hidePopup=function(){var t=$("#"+e);t.length&&(t.remove(),p===e&&(p=null,$("body").unbind("click"))),a.popupShown(!1)},a.clicked=function(i,s){if(NF.analytics.trackEvent("editor",a.id(),"button"),!a.disabled()){var l=$("#"+e);if(p&&p!=e&&($("#"+p).remove(),p=null,$("body").unbind("click")),l.length)a.hidePopup();else{var c=null;if((c=s?$(s.target).closest('div[class^="pickerTrigger"]'):$(".popupPaletteSection ."+this.id()))&&c.position()||(c=$(".headerPaletteSection ."+this.id())),!c||!c.position())return!0;var u="top:"+(c.offset().top+c.outerHeight()+"px")+"; left:"+(c.offset().left+"px")+";";a.inheritWidth()&&(u+="width: ".concat(c.outerWidth(),"px"));var d='<div id="'+e+'" class="'+t+'" style="'+u+'" data-bind="template:'+("{ name: '"+o+"'}")+(a.hideOnClick?", click: popupClicked":"")+'">',f=$(d);c.parents()[2].className.includes("popupPaletteSection")?c.parent().parent().parent().after(f):c.after(f),ko.applyBindings(a,f[0]);var h=window.innerWidth,m=window.innerHeight;f.offset().left+f.outerWidth()>h&&f.css("left",f.position().left-(f.offset().left+f.outerWidth()-h+2)),f.offset().top+f.outerHeight()>m&&f.css("top",f.position().top-(f.offset().top+f.outerHeight()-m+2)),p=e,Noteflight.HideCurrentTip(),r.default.subscribe(n.PALETTE_CLOSE_SUB_POPUPS,function(){a.hidePopup()}),a.popupShown(!0),setTimeout(function(){$("body").click(function(t){var o=document.getElementById(e);o&&!$.contains(o,t.target)&&a.hidePopup()})},1)}return!0}},a.parent.expanded&&a.parent.expanded.subscribe(function(){$("#"+e).remove()}),a.css=ko.pureComputed(function(){var e="";return a.advanced()&&(e+=" advanced"),a.disabled()&&(e+=" disabled"),a.dropClass&&(e+=" "+a.dropClass()),e}),a.popupClicked=function(){return setTimeout(a.hidePopup,100),!0},a.showPopup=function(){a.popupShown()||a.clicked()}},Noteflight.HeaderPalette=function(e){var t=this;t.controller=ko.observable(e);var o={controls:{create:function(e){return new Noteflight.PaletteControl(t,e.data,t.controller())}}};t.controls=ko.observableArray([]),t.init=function(e){if(e){for(var r=0;r<t.controls().length;r++)t.controls()[r].destroy();ko.mapping.fromJS(e,o,t)}else t.controls([])}},Noteflight.GenericHeaderPaletteLeftConfig={controls:[{id:"home",type:"urlButton",route:"home",visibleFunction:"nonLoggedIn"},{id:"create",type:"actionButton",actionFunction:"newScore",invisibleFunction:"nonLoggedIn",anonymousDropClass:"hideAt450"},{id:"myScores",type:"urlButton",route:"home",invisibleFunction:"nonLoggedIn"},{id:"community",type:"urlButton",route:"community",invisibleFunction:"anonymousNonPublicCommunity"},{id:"manageSite",type:"actionButton",actionFunction:"manageSite",visibleFunction:"isAtLeastSiteTeacher",invisibleFunction:"defaultCommunity"},{id:"libraries",type:"urlButton",route:"libraries",visibleFunction:"showLibraries",invisibleFunction:"anonymousNonPublicCommunity"},{id:"marketplace",type:"urlButton",route:"marketplace",visibleFunction:"showMarketplace"},{id:"search",type:"searchControl",visibleFunction:"showSearchButton",invisibleFunction:"isPhoneLayoutOrSmaller",anonymousDropClass:"hideAt500"}]},Noteflight.GenericHeaderPaletteLeft=function(e){Noteflight.HeaderPalette.call(this,e),this.init(Noteflight.GenericHeaderPaletteLeftConfig)},Noteflight.GenericSearchPalette=function(e){Noteflight.HeaderPalette.call(this,e),this.init({controls:[{id:"search",type:"searchControl"}]})},Noteflight.GenericHeaderPaletteRightConfig={controls:[{id:"helpCenter",type:"urlButton",externalPath:a.HELP_CENTER_LINK,newTab:!0,dropClass:"hideAt500"},{id:"search",type:"searchControl",visibleFunction:"showSearchButton",anonymousDropClass:"hideAt500",invisibleFunction:"isMobileLayoutOrLarger"},{id:"ourPlans",type:"urlButton",route:"plans",visibleFunction:"defaultCommunity",invisibleFunction:"loggedIn",anonymousDropClass:"hideAt500"},{id:"upgrade",type:"actionButton",actionFunction:"goUpgrade",visibleFunction:"showUpgrade",invisibleFunction:"anonymousNonDefaultCommunity",dropClass:"hideAt500"},{id:"filter",type:"toggleButton",valueFunction:"showFilter",visibleFunction:"showFilterButton"},{id:"signin",type:"actionButton",actionFunction:"signin",visibleFunction:"allowLogin",invisibleFunction:"loggedIn"}]},Noteflight.GenericHeaderPaletteRight=function(e){Noteflight.HeaderPalette.call(this,e),this.init(Noteflight.GenericHeaderPaletteRightConfig)}},function(e,t,o){"use strict";var r=o(0),n=null,i=!0,a=null;Noteflight.HideCurrentTip=function(){n&&(ko.removeNode(n),n=null,i||(a&&clearTimeout(a),a=setTimeout(function(){i=!0,a=null},2e3)))},ko.bindingHandlers.tip={init:function(e,t,o,s,l){$(e).mouseover(function(o){Noteflight.HideCurrentTip();var l=t(),c=(0,r.resource)(ko.utils.unwrapObservable(l.title)),u=ko.utils.unwrapObservable(l.shortcut);if("line-through"==$(e).css("text-decoration")||"0px"==$(e).css("font-size")){var d=$('<div class="paletteTip" data-bind="template: \'palette/tip\'">'),p=new function(e,t,o){this.title=t,this.shortcut=o}(s,c,u);n=d[0],ko.applyBindings(p,n),$("body").append(d);var f=50;i&&(f+=1e3),setTimeout(function(){var t,o;n&&(t=$(e).offset().top+$(e).outerHeight()+5,o=$(e).offset().left+$(e).outerWidth()/2-d.outerWidth()/2,o=Math.max(o,0),o=Math.min(o,visualViewport.width-d.outerWidth()),d.offset({left:o,top:t}),i=!1,a&&(clearTimeout(a),a=null))},f)}}),$(e).mouseout(function(e){Noteflight.HideCurrentTip()})},update:function(e,t,o,r,n){}}},function(e,t,o){"use strict";Noteflight.PianoRollCanvas=function(){var e=this;e.canvasContext=null,e.recordingIntervalId=-1,e.cursorPos=null,e.dotsShifting=0,e.pitchesToDraw=[],e.middlePitch=null,e.commonRealTimeFeedback=new NF.CommonRealTimeFeedback;var t=1,o=3,r=5,n=3;function i(){e.canvasContext.clearRect(0,0,e.commonRealTimeFeedback.CANVAS_WIDTH,e.commonRealTimeFeedback.CANVAS_HEIGHT)}function a(){e.commonRealTimeFeedback.drawBackground(1),e.commonRealTimeFeedback.drawDots(e.dotsShifting),function(){for(var t=0;t<e.pitchesToDraw.length;t++){e.canvasContext.globalAlpha=.8,e.canvasContext.fillStyle="#666659";var r=e.pitchesToDraw[t].stop-e.pitchesToDraw[t].start;e.canvasContext.fillRect(e.pitchesToDraw[t].start,e.commonRealTimeFeedback.CANVAS_HEIGHT/2+e.pitchesToDraw[t].pitchRepresentation,r,o)}}(),e.canvasContext.globalAlpha=1,e.canvasContext.fillStyle="#f64e20",e.canvasContext.fillRect(e.cursorPos,0,n,60)}function s(o){for(var r=e.pitchesToDraw.length-1;r>=0;r--)o?(e.pitchesToDraw[r].start-=t,e.pitchesToDraw[r].start<0&&(e.pitchesToDraw[r].start=0),e.pitchesToDraw[r].isActive||(e.pitchesToDraw[r].stop-=t),e.pitchesToDraw[r].stop<0&&e.pitchesToDraw.slice(r,r+1)):e.pitchesToDraw[r].isActive&&(e.pitchesToDraw[r].stop+=t)}function l(){e.cursorPos<e.commonRealTimeFeedback.CANVAS_WIDTH/2?(e.cursorPos+=t,s(!1)):s(!0),e.cursorPos==e.commonRealTimeFeedback.CANVAS_WIDTH/2&&(e.dotsShifting+=t,e.dotsShifting>=e.commonRealTimeFeedback.DOTS_SEPARATION&&(e.dotsShifting=0)),i(),a()}e.initialize=function(){e.commonRealTimeFeedback.initializeCanvas()},e.reset=function(){e.pitchesToDraw=[],e.middlePitch=-1,e.cursorPos=0},e.handleNoteOn=function(t){!function(t){-1==e.middlePitch&&(e.middlePitch=t),e.middlePitch>t&&e.middlePitch-t>e.commonRealTimeFeedback.CANVAS_HEIGHT/2&&(e.middlePitch=t+e.commonRealTimeFeedback.CANVAS_HEIGHT/2-r),e.middlePitch<t&&t-e.middlePitch>e.commonRealTimeFeedback.CANVAS_HEIGHT/2&&(e.middlePitch=t-e.commonRealTimeFeedback.CANVAS_HEIGHT/2+r)}(t);var o={};o.start=e.cursorPos,o.stop=e.cursorPos,o.pitchRepresentation=e.middlePitch-t,o.pitch=t,o.isActive=!0,e.pitchesToDraw.push(o)},e.handleNoteOff=function(t){for(var o=0;o<e.pitchesToDraw.length;o++)e.pitchesToDraw[o].isActive&&e.pitchesToDraw[o].pitch==t&&(e.pitchesToDraw[o].isActive=!1)},e.drawStaticCanvas=function(){i(),function(t){e.canvasContext.fillStyle="#e7e5ce",e.canvasContext.globalAlpha=t,e.canvasContext.fillRect(0,0,e.commonRealTimeFeedback.CANVAS_WIDTH,e.commonRealTimeFeedback.CANVAS_HEIGHT)}(.2)},e.startAnimation=function(){e.canvasContext=e.commonRealTimeFeedback.canvasContext,a(),e.recordingIntervalId=setInterval(l,50)},e.stopAnimation=function(){clearInterval(e.recordingIntervalId)}}},function(e,t,o){"use strict";Noteflight.RecordingCanvas=function(){var e=this,t=2,o=2,r=1,n=!0;e.commonRealTimeFeedback=new NF.CommonRealTimeFeedback,e.valuesToDraw=[],e.cursorPos=0,e.canvasContext=null,e.visualizationFactor=Number.MAX_VALUE,e.dotsShifting=0,e.initialize=function(){e.commonRealTimeFeedback.initializeCanvas()},e.updateCanvas=function(i){n&&(n=!1,e.canvasContext=e.commonRealTimeFeedback.canvasContext),e.commonRealTimeFeedback.drawBackground(1),e.commonRealTimeFeedback.clearCanvas(),function(t){for(var r=0,n=0;n<t.length;n++)r+=Math.abs(t[n]);var i=(r/=t.length)*e.visualizationFactor;if(i>e.commonRealTimeFeedback.CANVAS_HEIGHT||i<1){var a=e.commonRealTimeFeedback.CANVAS_HEIGHT/r;e.visualizationFactor=Math.min(e.visualizationFactor,a)}e.valuesToDraw.length==e.commonRealTimeFeedback.CANVAS_WIDTH/(2*o)&&e.valuesToDraw.shift(),e.cursorPos=e.valuesToDraw.length*o,e.valuesToDraw.push(r*e.visualizationFactor)}(i),function(){for(var t=0;t<e.valuesToDraw.length;t++)e.canvasContext.globalAlpha=1,e.canvasContext.fillStyle="#666659",e.canvasContext.fillRect(t*o,e.commonRealTimeFeedback.CANVAS_HEIGHT-e.valuesToDraw[t],o,e.commonRealTimeFeedback.CANVAS_HEIGHT)}(),e.canvasContext.globalAlpha=1,e.canvasContext.fillStyle="#f64e20",e.canvasContext.fillRect(e.cursorPos,0,t,e.commonRealTimeFeedback.CANVAS_HEIGHT),e.dotsShifting+=r,e.dotsShifting>=e.commonRealTimeFeedback.DOTS_SEPARATION&&(e.dotsShifting=0),e.commonRealTimeFeedback.drawDots(e.dotsShifting)}}},function(e,t,o){"use strict";var r=h(o(4)),n=o(5),i=h(o(42)),a=h(o(127)),s=h(o(200)),l=o(2),c=h(o(279)),u=o(36),d=o(19),p=o(0),f=o(20);function h(e){return e&&e.__esModule?e:{default:e}}Noteflight.ScoreListFamilyModel=function(){var e=this;e.session=Noteflight.session,e.currentListing=ko.observable(),e.title=ko.computed(function(){return ko.utils.unwrapObservable(e.currentListing()&&e.currentListing().title)}),e.state=ko.observable(""),ko.computed(function(){"search"==e.state()&&e.currentListing()&&e.currentListing().sortBy("relevance")}),e.order=ko.observable(),e.sortOptions=ko.observableArray([{order:"most_recent",label:(0,p.resource)("order.mostRecent")},{order:"favorites",label:(0,p.resource)("order.favorites")},{order:"title",label:(0,p.resource)("order.title")},{order:"composer",label:(0,p.resource)("order.composer")}]),e.searchIndexSortOptions=ko.observableArray([{order:"relevance",label:(0,p.resource)("order.relevance")},{order:"most_recent",label:(0,p.resource)("order.mostRecent")},{order:"title",label:(0,p.resource)("order.title")},{order:"composer",label:(0,p.resource)("order.composer")}]),e.sortOrder=ko.computed({read:function(){return e.currentListing()&&"scores"==e.currentListing().listType()?e.currentListing().sortBy():e.order()||"most_recent"},write:function(t){e.currentListing().sortBy(t),e.currentListing().reset()}}).extend({throttle:1}),e.showViewTypes=ko.computed(function(){return!(!e.currentListing()||"scores"!=e.currentListing().listType())&&e.currentListing().listingColumns()>=2}),e.showSorting=ko.computed(function(){return e.currentListing()&&e.currentListing().showSorting&&e.currentListing().showSorting()}),e.viewType=ko.observable(),e.initViewType=function(){NF.hasStorage&&e.viewType(localStorage.getItem("_nf_scores_view_type")||"list")};var t=function(t){e.viewType(t),NF.hasStorage&&localStorage.setItem("_nf_scores_view_type",e.viewType()),(0,u.initializeTippy)(u.originalBadgeHint)};e.setGridViewType=function(){t("grid")},e.setListViewType=function(){t("list")},ko.computed(function(){e.currentListing(),e.sortOrder(),r.default.publish(n.AUDIO_PREVIEW_STOP)})},Noteflight.GenericListingViewModel=function(e,t){var o=this;Noteflight.SelectionItem.call(this,e),this.score=t,this.reporter=new i.default,this.showSocialBits=ko.computed(function(){return e.showSocialBitsList()}),this.updated=ko.computed(function(){return(0,f.formatDate)(o.score.updated())}),this.editable=ko.computed(function(){return e.editableList()}),this.heterogeneous=ko.computed(function(){return e.heterogeneousList()}),this.editingList=ko.computed(function(){return e.editingList()}),this.audioPreview=new c.default({hasCustomAudioMedia:this.score.hasCustomAudioMedia()})},Noteflight.ScoreViewModel=function(e,t){var o=this;Noteflight.GenericListingViewModel.call(this,e,t),this.resource=p.resource,this.audioPreview.url=this.score.audioPreviewPath(),this.rowTemplate=ko.observable("score/scoreRowBody"),this.itemTemplate=ko.observable("score/scoreItemBody"),this.scoreAuthor=ko.observable(""),this.scoreSharedBy="",this.isProduct=ko.observable(!1),this.isProductCopy=ko.observable(this.score.is_product_copy()),this.alias=ko.observable(this.score.alias()),(0,u.initializeTippy)(u.originalBadgeHint),this.useMarketplaceHandle=ko.computed(function(){return o.isProduct()||o.isProductCopy()}),this.fromLibrary=ko.computed(function(){return o.score.fromLibrary()}),this.showAudioPreviewButtons=ko.computed(function(){return o.score.hasAudioPreview()}),this.editUrl=NF.paths.editScore({scoreId:this.score.external_id()}),this.navigateToAuthor=function(e,t){return(0,l.navigate)(Noteflight.paths.profile({userId:o.score.author().external_id()})),t.stopPropagation(),!1},this.navigateToSharer=function(e,t){return(0,l.navigate)(Noteflight.paths.profile({userId:o.score.sharer().external_id()})),t.stopPropagation(),!1},this.navigateToTemplateScores=function(e,t){return(0,l.navigate)((0,l.path)("templateCopies",{templateScoreId:o.score.external_id()})),t.stopPropagation(),!1}},Noteflight.ProductViewModel=function(e,t){Noteflight.GenericListingViewModel.call(this,e,t),this.resource=p.resource,this.product=t,this.showAudioPreviewButtons=ko.observable(!0),this.isProduct=ko.observable(!0),this.isProductCopy=ko.observable(!1),this.fromLibrary=ko.observable(!1),this.showPreviewButtons=ko.observable(!1),this.rowTemplate=ko.observable("score/productRowBody"),this.itemTemplate=ko.observable("score/productItemBody"),this.showFullDetail=ko.observable(e.showFullDetail),this.useMarketplaceHandle=ko.observable(!0),this.audioPreview.url=t.audioPreviewUrl()},Noteflight.ScoreListModel=function(e){var t=this;t.parent=e,t.listType=ko.observable("scores"),t.showSorting=ko.observable(!0),t.session=Noteflight.session,t.virginal=!0,t.count=ko.observable(""),t.remaining=ko.observable(!1),t.userId=ko.observable(null),t.startIndex=ko.observable(),t.scores=ko.observableArray(),t.busy=ko.observable(!1),t.sortBy=ko.observable("most_recent"),t.scoreViewModel=Noteflight.ScoreViewModel,t.loadingMessage=(0,p.resource)("action.loading"),t.minColumnWidth=400,t.editableList=ko.observable(!1),t.showSocialBitsList=ko.observable(!0),t.heterogeneousList=ko.observable(!1),t.pixelWidth=ko.observable(0),t.listingColumns=ko.computed(function(){return Math.floor(t.pixelWidth()/t.minColumnWidth)}),t.isCurrent=ko.computed(function(){return e.currentListing()==t}),Noteflight.SelectionList.call(this,t.scores),t.selectedScores=function(){return $.map(t.selectedItems(),function(e){return e.score})};t.fetchScores=function(){if(!t.busy()&&t.fetchScoresService){var e={start_index:t.startIndex(),max_count:36,order:t.sortBy()};t.userId()&&(e.user_id=t.userId()),t.busy(!0),t.fetchScoresService(e)}},t.processFetchedData=function(e){e.scores.forEach(function(e){var o;"score"==e.object_type?o=new s.default(e):"product"==e.object_type&&(o=new a.default(e)),t.scores.push(new t.scoreViewModel(t,o))}),t.parent.filter&&t.parent.filter().populateFilter(e.aggregations),t.remaining(e.remaining),e.startIndex?t.startIndex(e.startIndex):t.startIndex(e.count-e.remaining),(0,u.initializeTippy)(u.originalBadgeHint),t.busy(!1)},t.addScores=function(e){for(var o=0;o<e.length;o++)t.scores.push(new t.scoreViewModel(t,e[o]));t.sortScores(t.sortBy())},t.removeScores=function(e){for(var o=0;o<t.scores().length;o++)for(var r=0;r<e.length;r++)if(t.scores()[o].score.external_id()==e[r].external_id()){t.scores.splice(o,1);break}},t.removeCollection=function(e){for(var o=0;o<t.scores().length;o++)for(var r=0;r<t.scores()[o].score.collections().length;r++)if(t.scores()[o].score.collections()[r].id()==e){t.scores()[o].score.collections.splice(r,1);break}},t.sortScores=function(o){switch(t.sortOrder=o,o){case"most_recent":t.sortOrder="updated";break;case"favorites":t.sortOrder="favorites_count"}e.sortParameter=["score",t.sortOrder],t.scores.sort(e.sortByParameter),"most_recent"==o&&t.scores.reverse()},Noteflight.PageableViewModel.call(this,t.fetchScores),t.handleWindowScroll=function(e){t.remaining()&&!t.busy()&&($(e.target).scrollTop()+$(window).innerHeight()+40>=$(e.target).outerHeight()&&t.fetchScores())},t.setPixelWidth=function(e){t.pixelWidth($("#scores").width())},t.isCurrent.subscribe(function(){(0,d.isMobileLayout)()&&(t.isCurrent()?$(window).on("scroll",t.handleWindowScroll):$(window).off("scroll",t.handleWindowScroll)),t.isCurrent()?$(window).on("resize",t.setPixelWidth):$(window).off("resize",t.setPixelWidth)}),t.clear=function(){t.scores.removeAll(),t.remaining(!1),t.virginal=!0},t.reset=function(){t.clear(),t.startIndex(0),t.fetchScores(),t.virginal=!1},t.activate=function(){t.virginal&&t.reset(),t.stopEditing(),(0,u.initializeTippy)(u.originalBadgeHint)},t.fetchWithSearchTargetFrom=function(o){t.fetchScoresService=null,ko.computed(function(){if(t.isCurrent()&&e.searchTarget()&&t.searchTarget!=e.searchTarget()){t.searchTarget=e.searchTarget();var r={query:t.searchTarget};t.fetchScoresService=Noteflight.postService(o,t,t.processFetchedData,{params:r}),t.reset()}}).extend({throttle:20})}}},function(e,t,o){"use strict";var r=l(o(4)),n=o(5),i=l(o(312)),a=o(19),s=o(0);function l(e){return e&&e.__esModule?e:{default:e}}var c={publicScores:!0,privateScores:!0,groups:!0,publicMembers:!0,marketplace:!0,collection:!0,community:!0,home:!0};Noteflight.SearchControl=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.inheritWidth(!0),e.currentSearchString=Noteflight.appViewModel.searchTarget,e.searchViewModel=ko.observable(new i.default),e.searchViewModel().searchText.subscribe(function(t){(e.hidePopup||e.showPopup)&&(t?e.showPopup():e.hidePopup())}),e.showFullSearchBar=ko.observable(!0),e.showIconOnly=ko.computed(function(){return(0,a.isMobileLayout)()&&!e.showFullSearchBar()}),e.useNewSearch=ko.computed(function(){return!(!NF.appViewModel.contentViewModel()||!NF.appViewModel.contentViewModel().name)&&(!!c[NF.appViewModel.contentViewModel().name()]&&(Noteflight.PalettePopupControl.call(e,"popupSearchControl","popupEditorHelp","palette/popupSearch"),NF.appViewModel.contentViewModel().searchConfiguration&&(e.searchViewModel().searchConfiguration=Noteflight.appViewModel.contentViewModel().searchConfiguration),NF.appViewModel.contentViewModel().searchPlaceholder&&e.searchViewModel().searchPlaceholder(Noteflight.appViewModel.contentViewModel().searchPlaceholder),!0))}),e.searchLabel=ko.pureComputed(function(){return NF.appViewModel.contentViewModel().searchLabel?NF.appViewModel.contentViewModel().searchLabel():(0,s.resource)("search.labelPublicScores")}),e.selectAllText=function(){return $("#searchString").select(),!0},e.search=function(){Noteflight.appViewModel.search(),e.hidePopup&&e.hidePopup()},e.css=ko.pureComputed(function(){return e.baseCSS()}),r.default.subscribe(n.SEARCH,function(){e.hidePopup&&e.hidePopup()})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ALIASES=t.DO_NOT_CLOSE_EDITOR_MENU=void 0;t.DO_NOT_CLOSE_EDITOR_MENU={swingEighths:!0,swingSixteenths:!0,zoom:!0};t.ALIASES={changeTimeSignature:["cutTime","pickup"],changeKeySignature:["sharps","flats","accidentals"],toggleFormattingPanel:["multiMeasureRests","noteSize","format","hyphens","font","spacing","staffSize","lineBreak","systemBreak","pageBreak","indentationSpacing","titleSize","subtitleSize","composerSize","lyricistSize","promptSize","copyrightSize","pageNumberSize","lyricsSize","performanceTextSize","chordSymbolSize"],export:["musicXML","MIDI","PDF","audio","WAV","MP3","print"],scoreDetails:["share","publicScore","visibility","comments","description","email","send"],repeat:["duplicate"],concertPitch:["keySignature","key","transpose","clarinet","saxophone","trumpet","instruments"],versions:["saved","saving","history"],performanceText:["fingering"],expressionText:["pianissimo","piano","mezzopiano","mezzoforte","forte","fortissimo","dynamics"],duplet:["tuplet"],triplet:["tuplet"],quadruplet:["tuplet"],quintuplet:["tuplet"],sextuplet:["tuplet"],septuplet:["tuplet"],toggleMediaSyncPanel:["youtube","soundcloud"],voiceUpper:["rhythm","stem","parts"],voiceLower:["rhythm","stem","parts"],colorNone:["hide","hidden","invisible"],statistics:["scoreDuration"],whole:["rests"],pageTurner:["footPedal","pageFlip","airTurn","blueTurn"],pageSetup:["margins","orientation","landscape","portrait","size","layout"]}},function(e,t,o){"use strict";var r=null,n=function(){r&&(clearTimeout(r),r=null)};Noteflight.SidebarViewModel=function(){var e=this;e.visible=ko.observable(!1),e.peek=ko.observable(!1),e.zOrder=ko.observable(0),e.otherSidebar=null,e.sidebarShow=function(){e.zOrder(1),e.otherSidebar.zOrder(0),n(),e.peek(!1),e.visible(!0)},e.visible.subscribe(function(t){var o=$("#overlaySvg");o&&(t?(e.overlayState=o.css("display"),o.hide()):"none"!=e.overlayState&&o.fadeIn("slow"))}),e.doPeek=function(){e.zOrder(1),e.otherSidebar.zOrder(0),e.peek(!0)},e.sidebarPeek=function(){!function(e){n(),r=setTimeout(function(){e(),r=null},500)}(e.doPeek)},e.sidebarUnpeek=function(){n(),e.peek(!1)},e.sidebarClick=function(){return e.visible()?(e.visible(!1),!0):(e.sidebarShow(),!1)},e.sidebarOver=function(){e.visible()||e.doPeek()},e.sidebarOut=function(){e.peek()&&e.sidebarUnpeek()}}},function(e,t,o){"use strict";Noteflight.ContentLibraryCatalogViewModel=function(e,t){var o=this;o.parent=e,o.titleResource="content.catalog",o.templateName=ko.observable("library/catalog"),o.scoresViewModel=t,o.rootPath=function(){return Noteflight.paths.viewGroupAllScores()},NF.SubviewModel.call(this,e),o.activate=function(){o.scoresViewModel.libraryScoreListModel.queryView.search(o.parent.search()),o.scoresViewModel.libraryScoreListModel.queryView.isFetching=!0,o.scoresViewModel.libraryScoreListModel.queryView.loadSearch(),o.scoresViewModel.showLibraryScores()}}},function(e,t,o){"use strict";var r=o(0),n=o(15);Noteflight.LibraryMembersCommonViewModel=function(e){var t=this;t.parent=e,t.formatCommas=n.formatCommas,t.titleResource="library.members",t.templateName=ko.observable("library/libraryMembers"),t.library=t.parent.library,t.libraryId=e.libraryId,t.subviewTemplate=ko.observable(null),t.groupId=e.instanceGroupId,t.forceFetchData=ko.observable(!0),NF.ColumnLayoutViewModel.call(this,350,"#members"),NF.SubviewModel.call(this,e),NF.MembersSiteHelpers.call(this),NF.PageableViewModel.call(this,t.fetchMembers),t.loadingMessage=(0,r.resource)("action.loading"),t.remaining=ko.observable(0),t.shown=ko.observable(0),NF.ServiceReporterViewModel.call(this,(0,r.resource)("action.loading")),t.members=ko.observableArray([]),t.subview=ko.observable(),t.lastSubview=null,t.searching=ko.observable(!1),t.searchTarget=e.searchTarget,t.lastSearchTarget=null,t.setSearchLabel=function(e){t.parent.searchLabel=ko.observable((0,r.resource)(e))},t.searchLabel=ko.observable((0,r.resource)("search.labelGroups")),t.searchForTitle=ko.computed(function(){return(0,r.resource)("content.searchFor",t.searchTarget())}),t.memberCountMessage=ko.computed(function(){var e=t.library().actual_user_count(),o=t.library().allowed_user_count();return(0,r.resource)("library.memberCountMessage",e,o)}),t.customSearchFunction=function(e){t.searchTarget(e)},t.clearSearch=function(){t.searchTarget(null)},t.addMembersToGroupMode=ko.observable(!1),t.showSmallCards=ko.computed(function(){return t.addMembersToGroupMode()}),t.addMembersDescription=ko.computed(function(){return t.addMembersToGroupMode()?"addStudentsView"==t.subview().name?(0,r.resource)("content.addStudentsToLibrary"):(0,r.resource)("content.addTeachersToLibrary"):null}),t.showMemberCountMessage=ko.computed(function(){return t.subview()==t.addStudentsView||t.subview()==t.addTeachersView}),t.sortOptions=ko.observableArray([{order:"name",label:(0,r.resource)("order.name")},{order:"most_recently_added",label:(0,r.resource)("order.mostRecentlyAdded")},{order:"last_login_time",label:(0,r.resource)("order.lastLoginTime")}]),t.sortOrder=ko.observable("most_recently_added"),t.sortOrder.subscribe(function(){t.reset()}),t.editingList=ko.observable(!1),Noteflight.SelectionList.call(this,t.members),t.showEditListButton=ko.computed(function(){return!t.editingList()&&t.members().length>0&&t.subview()&&t.library().canAddMembers()}),t.showAddMembersButtons=ko.computed(function(){return!t.editingList()}),t.enableRemoveUsersButton=ko.computed(function(){return t.selectedItems().length>0}),t.enableEditAccountButton=ko.computed(function(){return 1==t.selectedItems().length}),t.enableLoginAsButton=ko.computed(function(){return 1==t.selectedItems().length}),t.startEditing=function(){t.editingList(!0),t.clearSelectedItemsList()},t.stopEditing=function(){t.editingList(!1)},t.addMembers=function(){for(var o=[],n=0;n<t.selectedItems().length;n++)o.push(t.selectedItems()[n].userModel.external_id());NF.apiService.addMembersToSiteGroup((0,r.resource)("action.adding"),function(o){e.updateInstanceGroup(o.group);var r=t.library().actual_user_count();t.library().actual_user_count(r+o.members.length),t.leaveAddMembersToGroupMode()},{user_ids:o,group_id:t.groupId()})},t.resetDefaultView=function(){t.members([]),t.addMembersToGroupMode(!1),t.subview()&&t.subview(t.subview().parentSubview)},t.leaveAddMembersToGroupMode=function(){t.resetDefaultView(),t.editingList(!1)},t.doRemoveUsersFromList=function(e){for(var o=t.members().length-1;o>=0;o--)for(var r=0;r<e.length;r++)if(t.members()[o].userModel.external_id()==e[r]){t.members.splice(o,1),t.shown(t.shown()-1);break}},t.updateListWithRemovedUsers=function(o,r){t.doRemoveUsersFromList(o);var n=t.library().actual_user_count();t.library().actual_user_count(n-o.length),e.updateInstanceGroup(r)},t.doRemoveUsers=function(e){e.length&&NF.apiService.removeSiteGroupMembers((0,r.resource)("action.removing"),function(e){var o=$.map(e.users,function(e){return e.external_id});t.updateListWithRemovedUsers(o,e.group)},{user_ids:e,group_id:t.groupId})},t.removeUsers=function(){t.doRemoveUsers(function(){for(var e=[],o=0;o<t.selectedItems().length;o++)e.push(t.selectedItems()[o].userModel.external_id());return e}())},t.fetchMembersEnabled=ko.computed(function(){return!!t.subview()&&(t.subview().fetchMembersEnabled?t.subview().fetchMembersEnabled():!t.parent.group().isNFCommunity())}),t.studentsView=new Noteflight.GroupStudentsMembersViewModel(t),t.teachersView=new Noteflight.GroupTeachersMembersViewModel(t),t.addStudentsView=new Noteflight.SiteStudentsViewModel(t),t.addTeachersView=new Noteflight.SiteTeachersViewModel(t),t.prepareGoToAddUsersToGroupMode=function(){t.editingList(!0),t.searchTarget(""),t.members([]),t.addMembersToGroupMode(!0)},t.addStudents=function(){t.prepareGoToAddUsersToGroupMode(),t.subview(t.addStudentsView)},t.addTeachers=function(){t.prepareGoToAddUsersToGroupMode(),t.subview(t.addTeachersView)};var o=function(e){t.shown(e.shown),t.remaining(e.remaining);for(var o=e.users,r=0;r<o.length;r++)t.members.push(new Noteflight.SiteGroupMemberViewModel(o[r],t,t.parent.group()));t.busy(!1)};t.processFetchedData=o,t.fetchMembers=function(){if(!t.busy()){var o={group_id:t.groupId(),max_count:40,start_index:t.shown(),order:t.sortOrder()};t.searchTarget()&&(o.query=e.searchTarget()),t.subview().extraParams&&$.extend(o,t.subview().extraParams),t.busy(!0),t.fetchMembersService(t,o,t.processFetchedData)}},t.clearData=function(){t.members([]),t.shown(0),t.remaining(0),t.forceFetchData(!0)},t.reset=function(){t.clearData(),t.fetchMembersEnabled()&&(t.fetchMembersService=t.subview().fetchMembersService,t.processFetchedData=t.subview().processFetchedData?t.subview().processFetchedData:o,t.fetchMembers()),t.forceFetchData(!1)},ko.computed(function(){(t.subview()&&(t.subview()!=t.lastSubview||t.searchTarget()!=t.lastSearchTarget)||t.forceFetchData())&&(t.lastSubview=t.subview(),t.lastSearchTarget=t.searchTarget(),t.reset())}).extend({throttle:10}),t.activate=function(){switch(t.clearData(),t.editingList(!1),e.subState()){case"students":t.subview(t.studentsView);break;case"teachers":t.subview(t.teachersView)}t.fetchMembersService=t.subview().fetchMembersService,t.processFetchedData=t.subview().processFetchedData?t.subview().processFetchedData:o,t.rootPath=t.subview().rootPath,t.subview().activate()}}},function(e,t,o){"use strict";Noteflight.LibraryOverviewViewModel=function(e){this.templateName=ko.observable("library/overview"),this.titleResource="group.overview",NF.SubviewModel.call(this,e)}},function(e,t,o){"use strict";o(1206),o(1207),o(1208),o(303),o(214),o(1209),o(1211),o(1213),o(1214),o(1215),o(1216),o(1217),o(1218)},function(e,t,o){"use strict";Noteflight.GroupActivityViewModel=function(e){var t=this;t.parent=e,t.titleResource="group.activity",t.templateName=ko.observable("group/activity"),NF.SubviewModel.call(this,e),NF.ActivityStreamViewModel.call(t),t.createIterator=function(){return new Noteflight.ActivitySourceEventsIterator("personal_user:"+NF.session.current_user().external_id())},t.activate=function(){t.reset()}}},function(e,t,o){"use strict";var r=u(o(4)),n=u(o(62)),i=u(o(54)),a=u(o(214)),s=o(5),l=o(2),c=o(0);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?m(e):t}(this,f(t).call(this))).handleCreateGroupInfoLoaded=e.handleCreateGroupInfoLoaded.bind(m(m(e))),e.handleCreateGroupSuccess=e.handleCreateGroupSuccess.bind(m(m(e))),e.detailView=!0,e.templateName=ko.observable("group/createGroup"),e.totalGroupsCreated=ko.observable(0),e.totalMaxGroups=ko.observable(0),e.showCreateGroupInfo=NF.session.community().default_community(),e.group=new n.default({id:null,name:"",overview_all:"",overview_members:"",access_policy:NF.session.community().default_community()?"public":"members_only",admission_policy:NF.session.community().default_community()?"open":"assignment",group_logo_id:null,is_community_group:!1}),e.groupForm=new a.default(e.group),e.groupForm.groupLogo.createImageUploader("images/defaultGroup.png"),e.remainingGroups=ko.computed(function(){return e.totalMaxGroups()-e.totalGroupsCreated()}),e.canCreateMoreGroups=ko.computed(function(){return 0===e.totalMaxGroups()||e.remainingGroups()>0}),e.groupsRemainingText=ko.computed(function(){return 0===e.totalMaxGroups()?null:0===e.totalGroupsCreated()?(0,c.pluralize)("content.createUpToGroups",e.totalMaxGroups()):e.remainingGroups()>0?(0,c.pluralize)("content.createUpToGroupsYouHaveCreated",e.totalMaxGroups(),e.totalGroupsCreated()):(0,c.pluralize)("content.createdMaxNumberOfGroups",e.totalMaxGroups())}),e.showCreateGroupInfo&&NF.apiService.createGroupInfo({},e.handleCreateGroupInfoLoaded,{}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.default),function(e,t,o){t&&p(e.prototype,t),o&&p(e,o)}(t,[{key:"handleCreateGroupInfoLoaded",value:function(e){this.totalGroupsCreated(e.groups_created),this.totalMaxGroups(e.group_limit)}},{key:"handleSubmitClick",value:function(){this.groupForm.validateGroup()&&function(e,t){NF.apiService.createGroup({text:(0,c.resource)("content.creatingGroup"),fullScreen:!0,withBackground:!0},t,{name:e.name(),overview_all:e.overview_all(),overview_members:e.overview_members(),access_policy:e.access_policy(),admission_policy:e.admission_policy(),group_logo_id:e.group_logo_id()})}(this.group,this.handleCreateGroupSuccess)}},{key:"handleCancelClick",value:function(){NF.appViewModel.navigateToLastMasterView()}},{key:"handleCreateGroupSuccess",value:function(e){r.default.publish(s.REPORTER_REMOVE,{fullScreen:!0}),(0,l.navigate)((0,l.path)("viewGroup",{groupId:e.group.id})),r.default.publish(s.GROUP_CREATED,e.group)}}]),t}();(0,l.addRoute)("newGroup","/groups#/new",g)},function(e,t,o){"use strict";var r=o(2),n=o(0),i=o(3);Noteflight.GroupDiscussionsViewModel=function(e,t){var o=this;o.templateName=ko.observable("group/discussions"),ko.mapping.fromJS(t,{},o),o.forumDiscussionsModel=new Noteflight.GroupForumDiscussionsModel(e),o.forumDiscussionsModel.forumId(o.id()),NF.SubviewModel.call(this,e),o.searchTarget=e.searchTarget,o.customSearchFunction=function(e){o.searchTarget(e)},o.url=ko.computed(function(){return(0,r.path)("viewGroupForum",{groupId:e.groupId(),forumId:o.id()})}),o.forumVisibleToUser=ko.computed(function(){return!0}),o.activate=function(){switch(o.forumDiscussionsModel.state(e.subState()),o.parent.setSearchLabel("search.labelForums"),e.subState()){case"create":case"show":o.forumDiscussionsModel.discussionId(e.discussionId()),o.forumDiscussionsModel.onNavigate();break;case"choose":o.forumDiscussionsModel.resetForum();break;case"settings":o.forumDiscussionsModel.discussionId(null),o.forumDiscussionsModel.onNavigate()}}},Noteflight.GroupReorderForumViewModel=function(e,t,o){var r=this;r.parent=e,i.DialogViewModel.call(r),r.forum=ko.observable(o),r.forums=ko.observable(t.forums()),r.orginalIndex=ko.observable(),r.overIndex=ko.observable(),r.newIndex=ko.observable(),r.selectedNewPos=ko.observable(!1);for(var a=0;a<t.forums().length;a++)if(t.forums()[a].forum().id()==r.forum().id()){r.orginalIndex(a),r.overIndex(a),r.newIndex(a);break}r.forumIndex=function(e){for(var o=0;o<t.forums().length;o++)if(t.forums()[o].forum().id()==e.forum().id())return o<=r.overIndex()&&o>r.orginalIndex()?o-1:o>=r.overIndex()&&o<r.orginalIndex()?o+1:o},r.show=function(){(0,i.createAndShowDialog)({viewModel:r,templateName:"dialogs/reorderForum"})},r.initReorderForumDialog=function(){$("#forumListing").mouseleave(function(e){r.selectedNewPos()||r.overIndex(r.orginalIndex())})},r.showNewPostion=function(e){r.selectedNewPos()||r.overIndex(r.forumIndex(e))},r.selectNewPostion=function(e){r.newIndex(r.overIndex()),r.selectedNewPos(!0)},r.changeNewPostion=function(e){r.overIndex(r.forumIndex(e)),r.selectNewPostion()},r.forumPositioned=function(){t.forums.splice(r.newIndex(),0,t.forums.splice(r.orginalIndex(),1)[0])};var s=Noteflight.postService("/api/1.0/forums/position",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.movingForum")),r.forumPositioned);r.reorderForum=function(){(0,i.hideCurrentDialog)(),r.orginalIndex()!=r.newIndex()&&(s({forum_id:r.forum().id(),position:r.newIndex()}),r.parent.refreshForumsList())}},Noteflight.GroupForumDiscussionsModel=function(e){var t=this;t.parent=e,t.groupId=e.groupId,t.templateName=ko.observable("content/forumDiscussions"),t.isReadOnly=t.parent.isReadOnly,t.state=ko.observable(),t.forumId=ko.observable(),t.forum=ko.observable(),t.virginal=ko.observable(!0),t.discussionId=ko.observable(),t.discussions=ko.observableArray(),t.remaining=ko.observable(0),t.group=e.group,t.forumsList=e.forums,t.postsSortOrder=ko.observable("desc"),t.discussionPosts=ko.observable(new Noteflight.GroupDiscussionPostsModel(t)),Noteflight.SelectionList.call(this,t.discussions),Noteflight.CSESearch.call(this),t.settingsViewModel=new Noteflight.GroupForumSettingsViewModel(e,!1),t.alertDialog=new Noteflight.AlertSequenceDialog,t.title=ko.computed(function(){return t.forum()&&t.discussionPosts().discussionName()&&t.forum().name()+" : "+t.discussionPosts().discussionName()}),t.navigateToForumUrl=ko.computed(function(){return(0,r.path)("viewGroupForum",{groupId:t.groupId(),forumId:t.forumId()})}),t.editForumUrl=ko.computed(function(){return t.forum()&&(0,r.path)("editGroupForum",{forumId:t.forum().id(),groupId:e.groupId()})}),t.discussionsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.manageDiscussions"}],"_nf_tip_discussions.hidden"),t.canAdminDiscussions=ko.computed(function(){return!!t.forum()&&t.forum().adminable()});var o=Noteflight.postService("/api/1.0/forums/discussions",t,function(e){t.forum()||t.forum(new Noteflight.Forum(e.forum));for(var o=0;o<e.discussions.length;o++)t.discussions.push(new Noteflight.GroupDiscussionViewModel(t,new Noteflight.Discussion(e.discussions[o])));t.remaining(e.remaining),"choose"==t.state()&&!NF.IsPhoneLayout()&&!t.discussionId()&&t.discussions().length>0&&t.discussionId(t.discussions()[0].discussion().id()),t.updateDiscussion(),t.canAdministerForum()&&t.settingsViewModel.initForumInfo(t.forumId(),t.forum()),t.busy(!1)});t.fetchDiscussions=function(){t.busy(!0),o({forum_id:t.forumId(),start_index:t.discussions().length,max_count:20})},t.reset=function(){t.forum(null),t.discussions([]),"choose"!=t.state()&&"settings"!=t.state()||t.discussionId(null),t.forumId()&&(t.discussionPosts().reset(),t.fetchDiscussions())},t.resetForum=function(){t.reset(),t.virginal(!1),t.lastForumId=t.forumId()},t.deleteForum=function(){(0,i.okCancel)((0,n.resource)("forums.confirmDeleteForum",t.forum().name()),function(){Noteflight.postService("/api/1.0/forums/delete",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.deletingForum")),function(e){(0,r.navigate)((0,r.path)("forums"))})({forum_id:t.forumId()})})},t.canAdministerForum=ko.computed(function(){return t.forum()&&t.forum().adminable()}),t.canAddDiscussion=ko.computed(function(){return"create"!=t.state()&&Noteflight.session.canShare()&&t.forum()&&t.forum().postable()&&!t.isReadOnly()}),t.createNewDiscussion=function(){(0,r.navigate)((0,r.path)("newGroupDiscussion",{forumId:t.forumId(),groupId:t.groupId()}))},t.discussionAdded=function(e){t.discussions.unshift(new Noteflight.GroupDiscussionViewModel(t,e)),(0,r.navigate)((0,r.path)("viewGroupDiscussion",{forumId:t.forumId(),discussionId:e.id(),groupId:t.groupId()}))},t.discussionDeleted=function(e){for(var o=0;o<t.discussions().length;o++)if(t.discussions()[o].discussion().id()==e.id()){t.discussions.remove(t.discussions()[o]);break}t.discussionId()==e.id()&&(t.discussionId(null),(0,r.navigate)((0,r.path)("viewGroupForum",{forumId:t.forumId(),groupId:t.groupId()})))},t.onNavigate=function(){t.virginal()||t.forumId()!=t.lastForumId?(t.virginal(!1),t.lastForumId=t.forumId(),t.reset()):(("create"==t.state()||"settings"==t.state()||"choose"==t.state()&&t.discussionId())&&t.discussionId(null),t.updateDiscussion())},t.updateDiscussion=function(){if(t.discussions().length>0)if(t.discussionId()){if(!t.selectedItem()||t.selectedItem().discussion().id()!=t.discussionId()){t.selectNone();for(var e=0;e<t.discussions().length;e++)if(t.discussions()[e].discussion().id()==t.discussionId()){t.discussions()[e].selectOnly();break}}t.discussionPosts().discussion()&&t.selectedItem()&&t.discussionPosts().discussion().id()==t.selectedItem().discussion().id()&&t.selectedItem().discussion(t.discussionPosts().discussion())}else t.selectNone()},Noteflight.PageableViewModel.call(this,t.fetchDiscussions),t.searchLabel=ko.observable((0,n.resource)("search.labelForums"))},Noteflight.GroupDiscussionViewModel=function(e,t){var o=this;o.forumDiscussions=e,o.discussion=ko.observable(t),o.url=ko.observable((0,r.path)("viewGroupDiscussion",{discussionId:o.discussion().id(),forumId:e.forumId(),groupId:e.groupId()})),Noteflight.SelectionItem.call(o,e),o.deleteDiscussion=function(){(0,i.okCancel)((0,n.resource)("forums.confirmDeleteDiscussion",o.discussion().name()),function(){Noteflight.postService("/api/1.0/forums/delete_discussion",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.deletingDiscussion")),function(e){o.forumDiscussions.discussionDeleted(o.discussion())})({discussion_id:o.discussion().id()})})},o.contextMenuItems=function(){var e=[];return o.forumDiscussions.isReadOnly()||o.forumDiscussions.forum()&&!o.forumDiscussions.forum().adminable()&&!o.forumDiscussions.group().showModeratorUI()?e:(e.push({label:(0,n.resource)("action.delete"),action:o.deleteDiscussion}),e)}},Noteflight.GroupDiscussionPostsModel=function(e){var t=this;t.forumDiscussions=e,t.discussionId=ko.observable(),t.discussion=ko.observable(),t.remaining=ko.observable(0),t.posts=ko.observableArray(),t.newPostText=ko.observable(""),t.newDiscussionName=ko.observable(""),t.isReadOnly=e.isReadOnly,t.showMarkdownLink=ko.observable(!1),t.showMarkdownTip=ko.observable(!1),t.sortOrder=ko.observable(t.forumDiscussions.postsSortOrder()),t.sortOptions=ko.observableArray([{order:"asc",label:(0,n.resource)("order.oldestFirst")},{order:"desc",label:(0,n.resource)("order.lastestFirst")}]),t.discussionName=ko.computed(function(){return t.discussion()?t.discussion().name():""});var o=function(e){t.remaining(e.remaining),t.discussion()||t.discussion(new Noteflight.Discussion(e.discussion));for(var o=0;o<e.posts.length;o++)t.posts.push(new Noteflight.GroupPostViewModel(t,new Noteflight.Post(e.posts[o])));t.forumDiscussions.forumId()?t.forumDiscussions.updateDiscussion():(t.forumDiscussions.forumId(e.forum.id),t.forumDiscussions.reset()),t.busy(!1)},r=Noteflight.postService("/api/1.0/forums/posts",t,o);t.fetchPosts=function(){t.busy(!0),r({discussion_id:t.discussionId(),start_index:t.posts().length,max_count:20,direction:t.sortOrder()})},t.reset=function(){t.posts.removeAll(),t.remaining(0),t.discussionId(null),t.discussion(null),t.newPostText(""),t.newDiscussionName(""),"create"!=t.forumDiscussions.state()&&e.discussionId()&&(t.discussionId(e.discussionId()),t.fetchPosts())},t.sortOrder.subscribe(function(){t.forumDiscussions.postsSortOrder(t.sortOrder()),t.reset()}),t.newDiscussion=ko.computed(function(){return"create"==t.forumDiscussions.state()}),t.canPost=ko.computed(function(){return(t.discussion()||t.newDiscussion())&&Noteflight.session.canShare()&&e.forum()&&e.forum().postable()&&!t.forumDiscussions.isReadOnly()}),t.enableNewPost=ko.computed(function(){return t.newPostText().trim().length>0&&(t.discussion()||t.newDiscussionName().trim().length>0)});var i=Noteflight.postService("/api/1.0/forums/add_post",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.posting")),function(e){t.newPostText("");var o=new Noteflight.Post(e.post);t.posts.unshift(new Noteflight.GroupPostViewModel(t,o)),t.discussion().posts_count(t.discussion().posts_count()+1),t.discussion().most_recent_post(o),$("#postArea").removeClass("withFocus"),t.showMarkdownLink(!1),t.showMarkdownTip(!1)}),a=Noteflight.postService("/api/1.0/forums/add_discussion",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.posting")),function(e){t.newPostText(""),t.discussion(new Noteflight.Discussion(e.discussion)),t.discussionId(t.discussion().id()),o(e),t.forumDiscussions.discussionAdded(t.discussion())});t.postGotFocus=function(){$("#postArea").addClass("withFocus"),t.showMarkdownLink(!t.showMarkdownTip())},t.showMarkdownTipClick=function(){t.showMarkdownLink(!1),t.showMarkdownTip(!0)},t.addPost=function(){t.newDiscussion()?a({discussion:{forum_id:t.forumDiscussions.forumId(),name:t.newDiscussionName()},post:{text:t.newPostText()}}):i({post:{discussion_id:t.discussionId(),text:t.newPostText()}})},t.postDeleted=function(e){for(var o=t.posts().length-1;o>=0;o--){var r=t.posts()[o];r.post.id()==e.id()&&t.posts.remove(r)}t.posts().length>0?(t.discussion().most_recent_post(t.posts()[0].post),t.discussion().posts_count(t.discussion().posts_count()-1)):t.forumDiscussions.discussionDeleted(t.discussion())},Noteflight.PageableViewModel.call(this,t.fetchPosts),ko.computed(function(){e.discussionId()!=t.discussionId()&&t.reset()}).extend({throttle:1})};Noteflight.GroupPostViewModel=function(e,t){var o=this;o.discussionPosts=e,o.post=t,o.editPost=function(){new function(e){var t=this;t.post=ko.observable(e),t.text=ko.observable(t.post().post.text()),i.DialogViewModel.call(t),t.show=function(){(0,i.createAndShowDialog)({viewModel:t,templateName:"dialogs/editPost"})},t.updatePost=function(){(0,i.hideCurrentDialog)(),Noteflight.postService("/api/1.0/forums/update_post",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.updatingPost")),function(e){t.post().post.text(e.post.text)})({post_id:t.post().post.id(),text:t.text()})}}(o).show()},o.deletePost=function(){new function(e){var t=this;t.post=ko.observable(e),i.DialogViewModel.call(t),t.flagReason=ko.observable(""),t.show=function(){(0,i.createAndShowDialog)({viewModel:t,templateName:"dialogs/deletePost"})},t.deletePost=function(){(0,i.hideCurrentDialog)(),Noteflight.postService("/api/1.0/forums/block_post",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.deletingPost")),function(e){t.post().discussionPosts.postDeleted(t.post().post)})({post_id:t.post().post.id()})}}(o).show()},o.flagPost=function(){new function(e){var t=this;t.post=ko.observable(e),i.DialogViewModel.call(t),t.flagReason=ko.observable(""),t.show=function(){(0,i.createAndShowDialog)({viewModel:t,templateName:"dialogs/flagPost"})},t.flagPost=function(){(0,i.hideCurrentDialog)(),Noteflight.postService("/api/1.0/posts/flag",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.flaggingPost")))({post_id:t.post().post.id(),description:t.flagReason()})}}(o).show()},o.postAuthorProfileLink=ko.computed(function(){return Noteflight.paths.profile({userId:t.author().external_id()})}),o.canFlag=ko.computed(function(){return Noteflight.session.canShare()}),o.contextMenuItems=function(){var e=[];return o.discussionPosts.isReadOnly()?e:(o.post.mutable()&&(e.push({label:(0,n.resource)("action.edit"),action:o.editPost}),e.push({label:(0,n.resource)("action.delete"),action:o.deletePost})),o.canFlag()&&e.push({label:(0,n.resource)("action.flag"),action:o.flagPost}),e)}}},function(e,t,o){"use strict";o(1210);var r=o(2),n=o(0),i=o(3),a=o(20);Noteflight.GroupFlaggedContentViewModel=function(e){var t=this;t.parent=e,t.titleResource="group.flaggedContent",t.templateName=ko.observable("group/flaggedContent"),NF.SubviewModel.call(this,e),t.groupId=ko.observable(e.groupId()),t.flaggedPosts=ko.observableArray([]),t.loadingMessage=(0,n.resource)("action.loading"),t.remaining=ko.observable(0),t.count=ko.observable(0),t.maxCount=40,Noteflight.PageableViewModel.call(this,t.fetchFlaggedPosts),t.sortOptions=ko.observableArray([{order:"flag_count",label:(0,n.resource)("order.flags")},{order:"most_recent",label:(0,n.resource)("order.newestFirst")}]),t.sortOrder=ko.observable("flag_count"),t.sortOrder.subscribe(function(){t.reset()});var o=Noteflight.postService("/api/1.0/posts/list_flagged_in_group",t,function(e){t.count(e.shown),t.remaining(e.remaining);for(var o=0;o<e.posts.length;o++)t.flaggedPosts.push(new NF.FlaggedPostViewModel(e.posts[o],t))});t.activate=function(){t.reset()},t.removeFlaggedPost=function(e){t.flaggedPosts.remove(e)},t.fetchFlaggedPosts=function(){o({group_id:t.groupId(),max_count:t.maxCount,start_index:t.count(),order:t.sortOrder()})},t.reset=function(){t.flaggedPosts.removeAll(),t.count(0),t.remaining(0),t.fetchFlaggedPosts()}},Noteflight.FlaggedPostViewModel=function(e,t){var o=this;o.text=ko.observable(e.text),o.postId=e.id,o.createdDate=(0,a.observableRelativeTime)(e.created),o.author=ko.observable(new NF.User(e.author)),o.forumId=ko.observable(e.discussion.forum_id),o.discussionId=ko.observable(e.discussion.id),o.discussionName=ko.observable(e.discussion.name),o.flagCount=ko.observable(e.flags.length),o.showFlagDetails=ko.observable(!1),o.flaggings=ko.observableArray([]);for(var s=0;s<e.flags.length;s++)o.flaggings.push(new NF.Flagging(e.flags[s]));o.actions=e.actions,o.authorUrl=ko.observable(NF.paths.profile({userId:o.author().external_id()})),o.contextUrl=ko.observable((0,r.path)("viewGroupDiscussion",{forumId:o.forumId(),discussionId:o.discussionId(),groupId:t.groupId()})),o.toggleDetails=function(){o.showFlagDetails(!o.showFlagDetails())},o.blockPostReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.deletingPost")),o.dismiss=function(e){Noteflight.postService("/api/1.0/posts/dismiss_flags",o,function(e){t.removeFlaggedPost(o)})({post_id:o.postId})},o.blockPost=function(e){function t(e){e.failed&&e.failed.length>0?(o.blockPostReporter.init(),o.blockPostReporter.errors.push({message:(0,n.resource)("errors.postNotRemoved")})):o.dismiss()}(0,i.hideCurrentDialog)(),(0,i.okCancel)((0,n.resource)("content.confirmDeleteFlaggedPost"),function(){Noteflight.postService("/api/1.0/forums/block_post",o,t)({post_id:o.postId})})},o.blacklistPoster=function(){function e(e){e.failed&&e.failed.length>0?PubSub.publish(REPORTER_ADD_ERROR,{code:"errors.unableToAddMembersToBlacklist",message:(0,n.resource)("errors.unableToAddMembersToBlacklist",e.failed.length)}):o.dismiss()}var r=[{userModel:o.author()}];new Noteflight.BlacklistDialogViewModel(r,function(r,i){NF.apiService.addMemberToBlacklist((0,n.resource)("action.banning"),e,{group_id:t.groupId(),user_external_ids:[o.author().external_id()],internal_comment:r,external_comment:i})}).show()},o.swallowClick=function(e){return!1},o.contextMenuItems=ko.observableArray([]),o.actions.hasOwnProperty("blacklist")&&o.actions.blacklist&&o.contextMenuItems.push({label:(0,n.resource)("action.blacklistUserButton",o.author().username()),action:o.blacklistPoster}),o.actions.hasOwnProperty("delete_post")&&o.actions.delete_post&&o.contextMenuItems.push({label:(0,n.resource)("content.deletePost"),action:o.blockPost}),o.actions.hasOwnProperty("dismiss")&&o.actions.dismiss&&o.contextMenuItems.push({label:(0,n.resource)("action.dismiss"),action:o.dismiss}),o.contextMenuItems.push({label:(0,n.resource)("content.flags"),action:o.toggleDetails})},Noteflight.Flagging=function(e){this.flagger=ko.observable(new NF.User(e.flagger)),this.reason=ko.observable(e.reason),this.createdDate=(0,a.observableRelativeTime)(1e3*e.created_at),this.flaggerUrl=ko.observable(NF.paths.profile({userId:this.flagger().external_id()}))}},function(e,t,o){e.exports=o.p+"images/up-476d3196c085903edb62d0f719168c00.svg"},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(1212)),n=o(0),i=o(20);var a=function(e,t,o){NF.apiService.fetchGroupInvitations(e,o,t)};Noteflight.GroupInvitationsViewModel=function(e){var t=this;t.parent=e,t.name="invitationsView",t.sortOptions=[{order:"most_recent",label:(0,n.resource)("order.mostRecent")}],t.fetchMembersService=a,t.rootPath=function(e){return Noteflight.paths.viewGroupInvitations(e)},t.searchPath=function(e){return Noteflight.paths.viewGroupInvitationsSearch(e)},t.activate=function(){t.parent.setSearchLabel("search.labelInvitations")},t.callbackCancelInvitations=function(e){for(var o=0;o<t.parent.members().length;o++)if(t.parent.members()[o].id()==e.invitation.id){t.parent.members.splice(o,1);break}},t.cancelInvitation=function(e){NF.apiService.cancelInvitation((0,n.resource)("action.removing"),t.callbackCancelInvitations,{invitation_id:e.id(),status:"rescinded"})},t.processFetchedData=function(e){t.parent.shown(e.shown),t.parent.remaining(e.remaining);for(var o=e.invitations,r=0;r<o.length;r++)t.parent.members.push(new Noteflight.InvitationViewModel(o[r],t.parent));t.parent.busy(!1)},Noteflight.GroupMembersSubview.call(this),t.memberActions([{resource:"action.cancel",action:t.cancelInvitation}])},Noteflight.InvitationViewModel=function(e,t){this.id=ko.observable(e.id),this.inviter=new NF.User(e.inviter),Noteflight.MemberViewModel.call(this,{user:e.invitee},t),this.invitedDate=ko.computed(function(){return(0,i.observableRelativeTime)(e.timestamp)})},Noteflight.InvitationsFormViewModel=function(e){var t=this;t.groupMembersViewModel=e,t.groupId=e.groupId(),t.visible=ko.observable(!1),t.username=ko.observable(""),t.message=ko.observable(""),t.invitedUsers=ko.observableArray([]),t.getNoteflightMembers=function(e,o){NF.postService("/api/1.0/search/members",t,function(e){o([]);for(var n=0;n<e.users.length;n++){var i=new NF.User(e.users[n]);t.allowNewIndividualUser(i)&&o.push(new r.default(t.addEntity,i))}})(e)},t.allowNewIndividualUser=function(e){if(e.external_id()==NF.session.current_user().external_id())return!1;for(var o=0;o<t.invitedUsers().length;o++)if(e.external_id()==t.invitedUsers()[o].id())return!1;return!0},t.addUserInvitation=function(e){t.invitedUsers.push(e)},t.addEntity=new Noteflight.AddEntity(t.username,t.getNoteflightMembers,t.addUserInvitation),t.addMatching=function(e){t.addEntity.addMatchingEntity()},t.selectMatching=function(e){t.addEntity.name(e)},t.getQuery=function(){return t.addEntity.nameQuery()},t.sendButtonEnabled=ko.computed(function(){return t.invitedUsers().length>0}),t.clearAndCloseInvitations=function(){t.visible(!1),t.message(""),t.invitedUsers([]),t.username("")},t.callbackSendInvitations=function(e){for(var o=e.results,r=0;r<o.length;r++)o[r].success?t.groupMembersViewModel.members.push(new Noteflight.InvitationViewModel(o[r].invitation,t.groupMembersViewModel)):PubSub.publish(REPORTER_ADD_ERROR,{code:"errors."+o[r].error,message:(0,n.resource)("errors."+o[r].error)});t.clearAndCloseInvitations()},t.cancelInvitations=function(){t.visible(!1)},t.sendInvitations=function(){for(var e=[],o=0;o<t.invitedUsers().length;o++)e.push({user_external_id:t.invitedUsers()[o].user.external_id(),comment:t.message()});NF.apiService.sendInvitations((0,n.resource)("action.sending"),t.callbackSendInvitations,{group_id:t.groupId,invitees:e})}}},function(e,t,o){"use strict";function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function e(t,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.addModel=t,this.user=o,this.element=this.user,this.name=this.user.username,this.id=this.user.external_id,this.avatar=ko.computed(function(){return"url("+r.user.avatar_uri()+")"}),this.selected=ko.computed(function(){return r.addModel.nameQuery&&r.name().toLowerCase()==r.addModel.nameQuery()})}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,[{key:"addMatch",value:function(){this.select(),this.addModel.addMatchingEntity()}},{key:"select",value:function(){this.addModel.name(this.user.username())}}]),e}();t.default=n},function(e,t,o){"use strict";var r=o(2),n=o(0),i=o(3);Noteflight.GroupManageForumsViewModel=function(e){var t=this;t.parent=e,t.titleResource="group.manageForums",t.templateName=ko.observable("group/manageForums"),NF.SubviewModel.call(this,e),t.forumIndexModel=new Noteflight.GroupForumIndexModel(e),t.rootPath=function(){return Noteflight.paths.viewGroupAllScores()},t.activate=function(){t.forumIndexModel.fetchForums()}},Noteflight.GroupForumIndexModel=function(e){var t=this;t.parent=e,t.templateName=ko.observable("content/forumIndex"),t.title=(0,n.resource)("content.forums"),t.groupId=e.groupId,Noteflight.CSESearch.call(this),t.forums=ko.observableArray(),t.forumsTip=new Noteflight.TipViewModel([{resourcesKey:"tip.manageForums"}],"_nf_tip_forums.hidden"),t.goToCreateNewForum=function(){(0,r.navigate)((0,r.path)("newGroupForum",{groupId:e.groupId()}))},t.canAdminForums=ko.computed(function(){return e.group().permissions.can_manage_forums()}),t.isReadOnly=e.isReadOnly;var o=Noteflight.postService("/api/1.0/forums",t,function(e){for(var o=0;o<e.forums.length;o++)t.forums.push(new Noteflight.GroupForumViewModel(t,new Noteflight.Forum(e.forums[o]),t.groupId()))});t.fetchForums=function(){t.forums([]),o({group_id:t.groupId()})},t.forumDeleted=function(e){t.parent.refreshForumsList();for(var o=0;o<t.forums().length;o++)if(t.forums()[o].forum().id()==e){t.forums.remove(t.forums()[o]);break}},t.searchLabel=ko.observable((0,n.resource)("search.labelForums"))},Noteflight.GroupForumViewModel=function(e,t,o){var a=this;a.forum=ko.observable(t),a.groupId=o,a.forumUrl=ko.computed(function(){return(0,r.path)("viewGroupForum",{forumId:a.forum().id(),groupId:a.groupId})}),a.recentPostAuthorProfile=ko.computed(function(){if(a.forum().most_recent_discussion())return Noteflight.paths.profile({userId:a.forum().most_recent_discussion().most_recent_post().author().external_id()})}),a.recentPostAuthorAvatar=ko.computed(function(){if(a.forum().most_recent_discussion())return a.forum().most_recent_discussion().most_recent_post().author().avatar()}),a.recentPostAuthorName=ko.computed(function(){if(a.forum().most_recent_discussion())return a.forum().most_recent_discussion().most_recent_post().author().username()}),a.recentPostDiscussionName=ko.computed(function(){if(a.forum().most_recent_discussion())return a.forum().most_recent_discussion().name()}),a.recentPostDiscussion=ko.computed(function(){if(a.forum().most_recent_discussion())return Noteflight.paths.viewGroupDiscussion({forumId:a.forum().id(),discussionId:a.forum().most_recent_discussion().id(),groupId:o})}),a.deleteForum=function(){(0,i.okCancel)((0,n.resource)("forums.confirmDeleteForum",a.forum().name()),function(){Noteflight.postService("/api/1.0/forums/delete",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.deletingForum")),function(t){e.forumDeleted(a.forum().id())})({forum_id:a.forum().id(),group_id:a.groupId})})},a.reorderForum=function(){new Noteflight.GroupReorderForumViewModel(e.parent,e,a.forum()).show()},a.contextMenuItems=function(){return[{label:(0,n.resource)("action.delete"),action:a.deleteForum},{label:(0,n.resource)("action.reorderForum"),action:a.reorderForum}]}},Noteflight.GroupForumCreateViewModel=function(e){this.parent=e,this.templateName=ko.observable("group/newForum"),this.settingsViewModel=new Noteflight.GroupForumSettingsViewModel(e,!0),NF.SubviewModel.call(this,e)},Noteflight.GroupForumSettingsViewModel=function(e,t){var o=this;o.session=Noteflight.session,o.parent=e,o.create=ko.observable(t),o.forumId=ko.observable(""),o.forumName=ko.observable(""),o.forumDescription=ko.observable(""),o.forumAdmin=ko.observable(""),o.onlyAdminsCanView=ko.observable(!1),o.onlyAdminsCanPost=ko.observable(!1),o.forumPosition=ko.observable("bottom"),o.canUse=ko.observable(),o.create()&&o.session.current_user()&&(o.forumAdmin(o.session.current_user().username()),o.canUse(o.parent.group().showAdminUI())),o.currentForum=ko.observable(),o.initForumInfo=function(e,t){o.currentForum=ko.observable(t),o.forumId(e),o.forumName(t.name()),o.forumDescription(t.description()),o.onlyAdminsCanView(!t.visible()),o.onlyAdminsCanPost(!t.open()),o.forumAdmin(t.admin_username()),o.canUse(t.adminable()),o.forumName.subscribe(function(){o.changedSomething()}),o.forumDescription.subscribe(function(){o.changedSomething()}),o.forumAdmin.subscribe(function(){o.changedSomething()}),o.onlyAdminsCanView.subscribe(function(){o.changedSomething()}),o.onlyAdminsCanPost.subscribe(function(){o.changedSomething()})},o.madeChanges=ko.observable(!1),o.changesSaved=ko.observable(!1),o.changedSomething=function(){o.madeChanges(!0),o.changesSaved(!1)},o.forumCreated=function(e){o.parent.refreshForumsList(),o.forumName(""),o.forumDescription(""),o.forumAdmin(""),o.onlyAdminsCanView(!1),o.onlyAdminsCanPost(!1),(0,r.navigate)((0,r.path)("manageGroupForums",{groupId:o.parent.groupId()}))},o.canChangeAdministrator=ko.computed(function(){return!1}),o.enableUpdate=ko.computed(function(){return o.forumName()&&o.forumDescription()&&o.madeChanges()});var i=Noteflight.postService("/api/1.0/groups/forums/create",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.addingForum")),o.forumCreated);o.forumUpdated=function(e){o.parent.refreshForumsList(),o.madeChanges(!1),o.changesSaved(!0),o.currentForum().name(o.forumName()),o.currentForum().description(o.forumDescription())};var a=Noteflight.postService("/api/1.0/forums/update",new Noteflight.ServiceReporterViewModel((0,n.resource)("forums.updatingSettings")),o.forumUpdated);o.saveSettings=function(){o.create()?i({group_id:o.parent.groupId(),name:o.forumName(),description:o.forumDescription(),initial_position:o.forumPosition(),visible:!0,open:!0}):a({forum_id:o.forumId(),forum:{name:o.forumName(),description:o.forumDescription(),admin_username:o.forumAdmin(),visible:!o.onlyAdminsCanView(),open:!o.onlyAdminsCanPost()},group_id:o.parent.groupId()})}}},function(e,t,o){"use strict";var r=o(5),n=d(o(4)),i=o(2),a=d(o(43)),s=o(0),l=o(3),c=o(20),u=o(15);function d(e){return e&&e.__esModule?e:{default:e}}var p={membersView:1,blacklistView:1},f=function(e,t,o){NF.apiService.fetchGroupMembers(e,o,t)},h=function(e,t,o){NF.apiService.fetchSiteGroupMembers(e,o,t)},m=function(e,t,o){NF.apiService.fetchGroupBlacklistMembers(e,o,t)},g=function(e,t,o){NF.apiService.fetchGroupRequests(e,o,t)};Noteflight.GroupMembersCommonViewModel=function(e){var t=this;t.parent=e,t.formatCommas=u.formatCommas,t.titleResource="group.members",t.templateName=ko.observable("group/members"),t.groupId=e.groupId,t.searchTarget=e.searchTarget,t.customSearchFunction=function(e){t.searchTarget(e)},t.forceFetchData=ko.observable(!0),NF.ColumnLayoutViewModel.call(this,350,"#members"),NF.SubviewModel.call(this,e),NF.MembersSiteHelpers.call(this),Noteflight.PageableViewModel.call(this,t.fetchMembers),NF.ServiceReporterViewModel.call(this,(0,s.resource)("action.loading")),t.members=ko.observableArray([]),t.membersToShow=ko.computed(function(){for(var e=[],o=0;o<t.members().length;o++)t.members()[o].isNotRemovable()||e.push(t.members()[o]);return e}),t.editableList=ko.observable(!1),t.subview=ko.observable(),t.lastSubview=null,t.lastSearchTarget=null,t.lastSortOrder=null,t.loadingMessage=(0,s.resource)("action.loading"),t.remaining=ko.observable(0),t.shown=ko.observable(0),t.max_count=40,t.showMore=ko.computed(function(){return t.remaining()&&!t.busy()&&t.shown()%t.max_count==0}),t.sortOptions=ko.observableArray([]);var o=[{order:"name",label:(0,s.resource)("order.name")}];t.showNavFilter=ko.computed(function(){return t.subview()&&"membersView"!=t.subview().name||!e.group().isCommunity()}),t.sortOrder=ko.observable(),t.editingList=ko.observable(!1),t.showEditListButton=ko.computed(function(){return!t.editingList()&&t.members().length>0&&p[t.subview().name]}),t.showInviteButton=ko.computed(function(){return t.subview()&&!t.parent.group().isCommunity()&&"invitationsView"==t.subview().name&&("open"==t.parent.group().admission_policy()||t.parent.group().showModeratorUI())}),t.startEditing=function(){t.editingList(!0)},t.stopEditing=function(){t.editingList(!1)},t.addMembersToBlacklist=function(){t.selectedItems().length>0&&t.doAddMembersToBlacklist(t.selectedItems())},t.removeMembersFromBlacklist=function(){t.selectedItems().length>0&&t.doRemoveMembersFromBlacklist(t.selectedItems())},t.approveAll=function(){t.doUpdateRequest("accepted",t.members()),t.remaining(0)},t.denyAll=function(){t.doUpdateRequest("rejected",t.members()),t.remaining(0)},Noteflight.SelectionList.call(this,t.members),t.fetchMembersEnabled=ko.computed(function(){return t.subview()&&!t.parent.group().isNFCommunity()}),t.membersView=new Noteflight.GroupMembersViewModel(t),t.blacklistView=new Noteflight.GroupBlacklistViewModel(t),t.requestsView=new Noteflight.GroupRequestsViewModel(t),t.invitationsView=new Noteflight.GroupInvitationsViewModel(t),t.showMembersView=ko.observable(!0),t.showBlacklistView=ko.computed(function(){return e.group().showModeratorUI()&&NF.session.community().default_community()}),t.showRequestsView=ko.computed(function(){return e.group().showModeratorUI()&&NF.session.community().default_community()}),t.showInvitationsView=ko.computed(function(){return e.group().showModeratorUI()&&NF.session.community().default_community()}),t.invitationsFormViewModel=new Noteflight.InvitationsFormViewModel(t),t.showInvitationsForm=function(){t.invitationsFormViewModel.visible(!0)};var i=function(e){t.shown(e.shown),t.remaining(e.remaining);for(var o=e.members?e.members:e.applications,r=0;r<o.length;r++)t.members.push(new Noteflight.MemberViewModel(o[r],t));t.busy(!1)};function a(e){for(var t=[],o=0;o<e.length;o++)t.push(e[o].userModel.external_id());return t}t.processFetchedData=i,t.fetchMembers=function(){if(!t.busy()){var o={group_id:t.groupId(),max_count:40,start_index:t.shown(),order:t.sortOrder()};e.searchTarget()&&(o.query=e.searchTarget()),t.busy(!0),t.fetchMembersService(t,o,t.processFetchedData)}},t.clearData=function(){t.members([]),t.shown(0),t.remaining(0),t.forceFetchData(!0)},t.reset=function(){t.clearData(),t.fetchMembersEnabled()&&t.fetchMembers(),t.forceFetchData(!1)},ko.computed(function(){(t.subview()&&(t.subview()!=t.lastSubview||t.searchTarget()!=t.lastSearchTarget||t.sortOrder()!=t.lastSortOrder&&t.lastSortOrder)||t.forceFetchData())&&(t.lastSubview=t.subview(),t.lastSearchTarget=t.searchTarget(),t.lastSortOrder=t.sortOrder(),t.reset())}).extend({throttle:50}),t.setSearchLabel=function(e){NF.roles.isSiteAdmin()&&(t.parent.searchLabel=ko.observable((0,s.resource)(e)))},t.activate=function(){switch(t.clearData(),t.editingList(!1),e.subState()){case"members":t.subview(t.membersView);break;case"blacklist":t.subview(t.blacklistView);break;case"requests":t.subview(t.requestsView);break;case"invitations":t.subview(t.invitationsView)}t.fetchMembersService=t.subview().fetchMembersService,t.processFetchedData=t.subview().processFetchedData?t.subview().processFetchedData:i,t.rootPath=t.subview().rootPath,t.searchPath=t.subview().searchPath,t.generateSortOptions(),t.subview().activate()},t.generateSortOptions=function(){var e=t.subview().sortOptions?t.subview().sortOptions:[];t.sortOptions(o.concat(e))},t.removeSelectedMembersFromList=function(){$.each(t.selectedItems(),function(e,t){t.removeFromList()})},t.removeApplicationsFromList=function(e){for(var o=t.members().length-1;o>=0;o--)-1==e.indexOf(t.members()[o].applicationId())||t.members()[o].removeFromList()},t.updateRole=function(e,o){$.each(t.members(),function(t,r){e.external_id==r.userModel.external_id()&&r.role(o)})},t.doChangeRole=function(e){t.changeRole=function(o){var r={user_external_id:e.userModel.external_id(),role:o};t.doUpdateMembership=function(e){t.updateRole(e.user,e.group_member.member_role)},NF.apiService.updateMembership((0,s.resource)("action.updating"),t.doUpdateMembership,{group_id:t.groupId(),user_external_id:r.user_external_id,role:r.role})},t.roleDialog=new Noteflight.RoleDialogViewModel(e,e.actions.roles,t.changeRole),t.roleDialog.show()},t.doAddMembersToBlacklist=function(e){function o(e){e.failed&&e.failed.length>0?n.default.publish(REPORTER_ADD_ERROR,{code:"errors.unableToAddMembersToBlacklist",message:(0,s.resource)("errors.unableToAddMembersToBlacklist",e.failed.length)}):t.removeSelectedMembersFromList(e.user_external_ids)}new Noteflight.BlacklistDialogViewModel(e,function(r,n){var i=a(e);NF.apiService.addMemberToBlacklist((0,s.resource)("action.adding"),o,{group_id:t.groupId(),user_external_ids:i,internal_comment:r,external_comment:n})}).show()},t.doRemoveMembersFromBlacklist=function(e){var o=a(e);NF.apiService.removeMemberFromBlacklist((0,s.resource)("action.removing"),function(e){e.failed&&e.failed.length>0?n.default.publish(REPORTER_ADD_ERROR,{code:"errors.unableToRemoveMembersFromBlacklist",message:(0,s.resource)("errors.unableToRemoveMembersFromBlacklist",e.failed.length)}):t.removeSelectedMembersFromList(e.user_external_ids)},{group_id:t.groupId(),user_external_ids:o})},t.doUpdateRequest=function(e,o){var i=[];$.each(o,function(t,o){i.push({status:e,application_id:o.applicationId()})}),NF.apiService.updateGroupRequest((0,s.resource)("action.updating"),function(e){if(e.failed&&e.failed.length>0)n.default.publish(REPORTER_ADD_ERROR,{code:"errors.unableToUpdateRequest",message:(0,s.resource)("errors.unableToUpdateRequest",e.failed.length)});else{var o=[];$.each(e.results,function(e,t){o[e]=t.application.id}),t.removeApplicationsFromList(o),n.default.publish(r.GROUP_UPDATED,e.group)}},{group_id:t.groupId(),applications:i})}},Noteflight.GroupMembersSubview=function(){var e=this;e.memberActions=ko.observableArray([]),e.tabHref=ko.computed(function(){return e.parent.searchTarget()?e.searchPath({searchTarget:e.parent.searchTarget(),groupId:e.parent.groupId()}):e.rootPath({groupId:e.parent.groupId()})})},Noteflight.GroupMembersViewModel=function(e){var t=this;t.parent=e,t.name="membersView",t.sortOptions=[{order:"role",label:(0,s.resource)("order.role")},{order:"most_recently_joined",label:(0,s.resource)("order.mostRecentlyJoined")},{order:"least_recently_joined",label:(0,s.resource)("order.leastRecentlyJoined")}],t.fetchMembersService=NF.session.community().default_community()?f:h,t.rootPath=function(e){return Noteflight.paths.viewGroupMembers(e)},t.searchPath=function(e){return Noteflight.paths.viewGroupMembersSearch(e)},t.activate=function(){t.parent.setSearchLabel("search.labelMembers"),t.parent.sortOrder("most_recently_joined")},Noteflight.GroupMembersSubview.call(this)},Noteflight.GroupRequestsViewModel=function(e){var t=this;t.parent=e,t.name="requestsView",t.sortOptions=[{order:"most_recent",label:(0,s.resource)("order.mostRecent")}],t.fetchMembersService=g,t.rootPath=function(e){return Noteflight.paths.viewGroupRequests(e)},t.searchPath=function(e){return Noteflight.paths.viewGroupRequestsSearch(e)},t.activate=function(){t.parent.setSearchLabel("search.labelRequests"),t.parent.sortOrder("most_recent")},Noteflight.GroupMembersSubview.call(this)},Noteflight.GroupBlacklistViewModel=function(e){var t=this;t.parent=e,t.name="blacklistView",t.sortOptions=[{order:"most_recent",label:(0,s.resource)("order.mostRecentlyAdded")}],t.fetchMembersService=m,t.processFetchedData=function(e){t.parent.shown(e.shown),t.parent.remaining(e.remaining);for(var o=0;o<e.blacklist.length;o++)t.parent.members.push(new Noteflight.MemberViewModel(e.blacklist[o],t.parent));t.parent.busy(!1)},t.rootPath=function(e){return Noteflight.paths.viewGroupBlacklist(e)},t.searchPath=function(e){return Noteflight.paths.viewGroupBlacklistSearch(e)},t.activate=function(){t.parent.setSearchLabel("search.labelBlacklistMembers"),t.parent.sortOrder("most_recent")},Noteflight.GroupMembersSubview.call(this)},Noteflight.MemberViewModel=function(e,t){var o=this,r=this,n=e.user?e.user:e.applicant;r.actions=e.actions;var l=e.group_member,u=e.community_member;r.userModel=new a.default(n),Noteflight.SelectionItem.call(this,t);var d=e.group_member?e.group_member.created_at:r.userModel.created();r.createdDate=(0,c.observableRelativeTime)(d),r.role=ko.observable(l?l.member_role:null),r.roleText=ko.computed(function(){return(0,s.resource)("content.".concat(o.role()))}),r.lastVisit=ko.computed(function(){var t=e.group_member?e.group_member.last_visited_at:null;return t?(0,c.observableRelativeTime)(1e3*t)():null}),r.requestedAdmission=ko.computed(function(){return e.request_admission_timestamp?(0,c.observableRelativeTime)(e.request_admission_timestamp):null}),r.showLastVisit=function(e){return"invitationsView"!=e},r.showBlacklistWarning=ko.computed(function(){return!!e.blacklisting}),r.requestText=ko.computed(function(){return e.request_text?e.request_text:null}),r.applicationId=ko.computed(function(){return e.id}),r.blacklistedDate=ko.computed(function(){return e.blacklisted_timestamp?(0,c.observableRelativeTime)(e.blacklisted_timestamp):null}),r.invitedDate=ko.observable(null),r.blacklistedComment=ko.computed(function(){return e.comment?e.comment:null}),r.blacklistedBy=ko.computed(function(){return e.moderator?e.moderator.username:null}),r.goToUser=function(){t.editingList()||(0,i.navigate)(NF.paths.profile({userId:r.userModel.external_id()}))},r.loginAs=function(){t.doLoginAs([n.external_id])},r.editUser=function(){t.doEditAccount([n.external_id])},r.swallowClick=function(e){return!1},r.removeFromList=function(){for(var e=0;e<t.members().length;e++)if(t.members()[e]==r){t.members.splice(e,1);break}},r.addToBlacklist=function(){t.doAddMembersToBlacklist([r])},r.removeFromBlacklist=function(){t.doRemoveMembersFromBlacklist([r])},r.changeRole=function(){t.doChangeRole(r)},r.approveRequest=function(){t.doUpdateRequest("accepted",[r])},r.denyRequest=function(){t.doUpdateRequest("rejected",[r])},r.isNotRemovable=ko.computed(function(){return t.editingList()&&(r.userModel.external_id()==NF.session.current_user().external_id()||"admin"==r.role())}),r.contextMenuItems=function(){if(!NF.session.current_user()||NF.session.current_user().external_id()==n.external_id)return[];var o=[];return NF.roles.isSite()&&(NF.roles.isSiteAdmin()||NF.roles.isSiteTeacher()&&"student"==u.sso_user_role)&&o.push({label:(0,s.resource)("action.loginAs",n.username),action:r.loginAs},{label:(0,s.resource)("action.edit"),action:r.editUser}),e.status&&"outstanding"==e.status&&(o.push({label:(0,s.resource)("action.approveRequest"),action:r.approveRequest}),o.push({label:(0,s.resource)("action.denyRequest"),action:r.denyRequest})),t.editingList()||!r.actions?o:(r.actions.hasOwnProperty("blacklist")&&r.actions.blacklist&&o.push({label:(0,s.resource)("action.addToBlacklist"),action:r.addToBlacklist}),r.actions.hasOwnProperty("unblacklist")&&r.actions.unblacklist&&o.push({label:(0,s.resource)("action.removeFromBlacklist"),action:r.removeFromBlacklist}),(NF.roles.isSiteAdmin()||r.actions.hasOwnProperty("roles")&&r.actions.roles.length>0)&&o.push({label:(0,s.resource)("action.changeRole"),action:r.changeRole}),o)},r.showContextMenuButton=ko.computed(function(){return r.contextMenuItems().length>0})},Noteflight.RoleDialogViewModel=function(e,t,o){var r=this;r.user=e,r.callback=o,r.availableRoles=[{name:(0,s.resource)("content.admin"),value:"admin",enabled:-1!=t.indexOf("admin"),description:(0,s.resource)("group.adminRole")},{name:(0,s.resource)("content.moderator"),value:"moderator",enabled:-1!=t.indexOf("moderator"),description:(0,s.resource)("group.moderatorRole")},{name:(0,s.resource)("content.member"),value:"member",enabled:-1!=t.indexOf("member"),description:(0,s.resource)("group.memberRole")}],r.selectedRole=ko.observable(r.user.role()),l.DialogViewModel.call(r),r.doneButtonEnabled=ko.computed(function(){return r.user.role()!=r.selectedRole()}),r.show=function(){(0,l.createAndShowDialog)({viewModel:r,templateName:"dialogs/changeRole"})},r.submit=function(){(0,l.hideCurrentDialog)(),r.callback(r.selectedRole())}},Noteflight.BlacklistDialogViewModel=function(e,t){var o=this;o.users=e,o.title=ko.computed(function(){var t="";return e.length>1?t=(0,s.resource)("content.memberCount.other",e.length):1==e.length&&(t=e[0].userModel.username()),(0,s.resource)("content.addToBlacklist",t)}),l.DialogViewModel.call(o),o.internalComment=ko.observable(""),o.externalComment=ko.observable(""),o.show=function(){(0,l.createAndShowDialog)({viewModel:o,templateName:"dialogs/addToBlacklist"})},o.callback=function(){(0,l.hideCurrentDialog)(),t(o.internalComment(),o.externalComment())}}},function(e,t,o){"use strict";var r=o(2),n=o(0);Noteflight.MembersSiteHelpers=function(){var e=this;e.masqueradeUserService=Noteflight.postService("/api/1.0/sites/masquerade_user",new Noteflight.ServiceReporterViewModel((0,n.resource)("content.masqueradingAsUser")),function(e){Noteflight.location.setUri(e.url)}),e.doLoginAs=function(t){e.masqueradeUserService({user_id:t})},e.loginAs=function(){1==e.selectedItems().length&&e.doLoginAs(e.selectedItems()[0].userModel.external_id())},e.doEditAccount=function(e){(0,r.navigate)(Noteflight.paths.adminProfile({userId:e}))},e.editAccount=function(){1==e.selectedItems().length&&e.doEditAccount(e.selectedItems()[0].userModel.external_id())}}},function(e,t,o){"use strict";var r=o(5),n=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),i=o(2),a=o(0),s=(o(16),o(3));function l(e){return"function"==typeof e&&e()}Noteflight.GroupOverviewViewModel=function(e){var t=this;t.templateName=ko.observable("group/overview"),t.titleResource="group.overview",NF.SubviewModel.call(this,e),t.deactivateServiceReporter=new Noteflight.ServiceReporterViewModel((0,a.resource)("content.deactivatingSite"));var o=e.group().overview_all();o=(0,a.hasResource)(o)?(0,a.resource)(o):NF.markdownToHtml(o),t.publicOverview=ko.observable(o),t.showYouAreInvited=ko.computed(function(){return l(e.group().invitation)}),t.showAdmissionRequested=ko.computed(function(){return l(e.group().application)}),t.showYouAreBanned=ko.computed(function(){return l(e.group().blacklisting)}),t.permissions=ko.computed(function(){return e.group().permissions||{}}),t.showJoinAction=ko.computed(function(){return l(t.permissions().can_join)||t.showYouAreInvited()}),t.showRequestAdmissionAction=ko.computed(function(){return l(t.permissions().can_apply_to_join)}),t.showLeaveAction=ko.computed(function(){return l(t.permissions().can_leave)}),t.showEditGroupAction=ko.computed(function(){return l(t.permissions().can_edit_group)}),t.showDeleteAction=ko.computed(function(){return l(t.permissions().can_delete_group)}),t.showUndeleteAction=ko.computed(function(){return l(t.permissions().can_undelete_group)}),t.showDeactivateSite=ko.computed(function(){return l(t.permissions().can_deactivate_community)}),t.isAnyOfTheActionsVisible=ko.computed(function(){return t.showJoinAction()||t.showRequestAdmissionAction()||t.showLeaveAction()||t.showEditGroupAction()||t.showDeleteAction()||t.showUndeleteAction()||t.showDeactivateSite()}),t.accessMessageResource=ko.computed(function(){return{public:"group.publicAccessMessage",members_only:"group.membersOnlyAccessMessage"}[e.group().access_policy()]}),t.admissionMessageResource=ko.computed(function(){return{automatic:"group.automaticAdmissionMessage",open:"group.openAdmissionMessage",approval_required:"group.approvalRequiredAdmissionMessage",invitation_only:"group.invitationOnlyAdmissionMessage",assignment:"group.assignmentOnlyAdmissionMessage"}[e.group().admission_policy()]}),t.siteVisitorMessage=ko.computed(function(){if(!NF.session.current_user()){var t={automatic:"group.visitorAutomaticMessage",open:"group.visitorOpenMessage",approval_required:"group.visitorApprovalRequiredMessage",invitation_only:""}[e.group().admission_policy()];if(t)return NF.session.community().default_community()||(t+=".site"),t}return!1}),t.siteAccessPolicyMessage=ko.computed(function(){var e=NF.session.community().allow_anonymous_view()?"Public":"Private";return(0,a.resource)("group.siteAccessPolicyMessage"+e)}),t.join=function(){t.checkUserVerified()&&NF.apiService.joinGroup((0,a.resource)("content.joiningGroup"),function(t){e.readyToShow(!1),n.default.publish(r.GROUP_UPDATED,t.group)},{group_id:e.groupId()})};var c=function(t){n.default.publish(r.GROUP_UPDATED,t.group),e.group().application(t)};t.requestAdmission=function(t){var o={group_id:e.groupId(),request_text:t};NF.apiService.applyToGroup((0,a.resource)("content.applyingToGroup"),c,o)},t.checkUserVerified=function(){return Noteflight.checkUserVerified((0,a.resource)("action.joinGroupAction"))};t.showRequestAdmissionDialog=function(){t.checkUserVerified()&&new function(e){var t=this;s.DialogViewModel.call(t),t.requestText=ko.observable(""),t.show=function(){(0,s.createAndShowDialog)({viewModel:t,templateName:"dialogs/requestAdmission"})},t.requestAdmission=function(){(0,s.hideCurrentDialog)(),e.requestAdmission(t.requestText())}}(t).show()},t.leave=function(){function t(){NF.apiService.leaveGroup((0,a.resource)("content.leavingGroup"),function(e){n.default.publish(r.GROUP_UPDATED,e.group)},{group_id:e.groupId()})}"open"==e.group().admission_policy()?"admin"!=e.group().role()?t():(0,s.okCancel)((0,a.resource)("group.confirmLeaveGroupRole"),t):(0,s.okCancel)((0,a.resource)("group.confirmLeaveGroupAdmission"),t)};var u=function(e){n.default.publish(r.GROUP_UPDATED,e.group)};t.deleteGroup=function(){var t={id:e.groupId()};NF.apiService.deleteGroup((0,a.resource)("content.deletingGroup"),u,t)};var d=function(e){n.default.publish(r.GROUP_UPDATED,e.group)};t.undeleteGroup=function(){var t={id:e.groupId()};NF.apiService.undeleteGroup((0,a.resource)("content.undeletingGroup"),d,t)},t.siteDeactivated=function(e){NF.location.setUri(e.url)},t.deactivateSite=function(){(0,s.okCancel)((0,a.resource)("content.confirmDeactivateCommunity",e.group().name()),function(){Noteflight.postService("/api/1.0/sites/deactivate",t.deactivateServiceReporter,t.siteDeactivated)({})})},t.activate=function(){switch(e.subState()){case"login":Noteflight.roles.isLoggedIn()||NF.appViewModel.showLoginForm();break;case"signup":Noteflight.roles.isLoggedIn()||NF.appViewModel.showSignupForm()}},t.editOverview=function(){NF.location.setUri((0,i.path)("editOverview",{groupId:e.groupId()}))}}},function(e,t,o){"use strict";Noteflight.GroupScoresViewModel=function(e){var t=this;t.parent=e,t.titleResource="group.scores",t.templateName=ko.observable("group/scores"),t.scoresViewModel=null,t.parent.group().isCommunity()?t.scoresViewModel=new NF.CommunityGroupScoresViewModel(t):t.scoresViewModel=new NF.InterestGroupScoresViewModel(t),t.rootPath=function(){return Noteflight.paths.viewGroupAllScores()},NF.SubviewModel.call(this,e),t.isReadOnly=e.isReadOnly,t.activate=function(){t.scoresViewModel.reset&&t.scoresViewModel.reset(),t.scoresViewModel.showGroupScores()}},Noteflight.InterestGroupScoresViewModel=function(e){var t=this;t.groupScoresViewModel=e;var o=t.groupScoresViewModel.parent.group().showModeratorUI();t.publicScoresViewModel=new Noteflight.PublicScoresViewModel,t.publicScoresViewModel.state("groupAllScores"),t.publicScoresViewModel.isCommunity(!1),t.publicScoresViewModel.groupId=e.parent.groupId,t.reset=function(){t.publicScoresViewModel.reset()},t.showGroupScores=function(){t.publicScoresViewModel.showGroupScores(t.groupScoresViewModel,o)}},Noteflight.CommunityGroupScoresViewModel=function(e){var t=this,o=e.parent.groupId();t.groupScoresViewModel=e;var r=t.groupScoresViewModel.parent.group().showAdminUI();t.publicScoresViewModel=new Noteflight.PublicScoresViewModel,o=e.parent.groupId(),t.publicScoresViewModel.allScoresPath(NF.paths.viewGroupAllScores({groupId:o})),t.publicScoresViewModel.risingScoresPath(NF.paths.viewGroupRecentScores({groupId:o})),t.publicScoresViewModel.popularScoresPath(NF.paths.viewGroupPopularScores({groupId:o})),t.groupScoresViewModel.parent.subState.subscribe(function(e){"scores"==t.groupScoresViewModel.parent.state()&&t.groupScoresViewModel.parent.subState()&&(t.publicScoresViewModel.state(t.groupScoresViewModel.parent.subState()),t.publicScoresViewModel.onNavigate())}),t.reset=function(){t.publicScoresViewModel.reset()},t.showGroupScores=function(){t.publicScoresViewModel.showGroupScores(t.groupScoresViewModel,r)}}},function(e,t,o){"use strict";var r=m(o(61)),n=m(o(306)),i=m(o(4)),a=o(5),s=m(o(126)),l=m(o(43)),c=o(2),u=o(0),d=o(3),p=o(20),f=o(15),h=m(o(1219));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,o){NF.apiService.fetchSiteGroupMembers(e,o,t)},b=function(e,t,o){NF.apiService.fetchSiteMembers(e,o,t)};Noteflight.GroupSiteMembersCommonViewModel=function(e){var t=this;function o(){for(var e=[],o=0;o<t.selectedItems().length;o++)e.push(t.selectedItems()[o].userModel.external_id());return e}t.parent=e,t.formatCommas=f.formatCommas,t.titleResource="group.members",t.templateName=ko.observable("group/siteMembers"),t.subviewTemplate=ko.observable(null),t.siteManagementEnabled=ko.observable(!0),t.groupId=e.groupId,e.group().isSiteCommunity()?(t.syncDialog=new n.default({type:"community"}),t.syncLabel=ko.observable((0,u.resource)("action.syncClasses"))):(t.syncDialog=new n.default({type:"group",groupIds:[t.groupId]}),t.syncLabel=ko.observable((0,u.resource)("action.syncClass"))),t.forceFetchData=ko.observable(!0),NF.ColumnLayoutViewModel.call(this,350,"#members"),NF.SubviewModel.call(this,e),NF.MembersSiteHelpers.call(this),NF.PageableViewModel.call(this,t.fetchMembers),NF.ServiceReporterViewModel.call(this,(0,u.resource)("action.loading")),t.asyncGCSyncing=new Noteflight.ServiceReporterViewModel((0,u.resource)("action.loading")),t.members=ko.observableArray([]),t.subview=ko.observable(),t.lastSubview=null,t.searching=ko.observable(!1),t.searchTarget=e.searchTarget,t.lastSearchTarget=null,t.setSearchLabel=function(e){t.parent.searchLabel=ko.observable((0,u.resource)(e))},t.searchLabel=ko.observable((0,u.resource)("search.labelGroups")),t.searchForTitle=ko.computed(function(){return(0,u.resource)("content.searchFor",t.searchTarget())}),t.customSearchFunction=function(e){t.searchTarget(e)},t.clearSearch=function(){t.searchTarget(null)},t.addMembersToGroupMode=ko.observable(!1),t.showSmallCards=ko.computed(function(){return t.addMembersToGroupMode()}),t.addMembersDescription=ko.computed(function(){return t.addMembersToGroupMode()?"addStudentsView"==t.subview().name?(0,u.resource)("content.addStudentsToGroup"):(0,u.resource)("content.addTeachersToGroup"):null}),t.addMembersToSiteMode=ko.observable(!1),t.addMembersToSiteDescription=ko.computed(function(){return t.addMembersToSiteMode()?"addStudentsView"==t.subview().name?(0,u.resource)("content.addStudents"):(0,u.resource)("content.addTeachers"):null}),t.loadingMessage=(0,u.resource)("action.loading"),t.remaining=ko.observable(0),t.shown=ko.observable(0),t.sortOptions=ko.observableArray([{order:"name",label:(0,u.resource)("order.name")},{order:"most_recently_joined",label:(0,u.resource)("order.mostRecentlyJoined")},{order:"last_login_time",label:(0,u.resource)("order.lastLoginTime")}]),t.sortOrder=ko.observable(t.sortOptions()[0].order),t.sortOrder.subscribe(function(){t.reset()}),t.editingList=ko.observable(!1),Noteflight.SelectionList.call(this,t.members),t.showEditListButton=ko.computed(function(){return!t.editingList()&&t.members().length>0&&!t.googleClassroom()}),t.showSyncButton=ko.computed(function(){return!(!(NF.session.community().is_google_classroom()&&t.subview()&&["studentsView","teachersView"].includes(t.subview().name))||t.editingList())&&NF.roles.isAtLeastSiteTeacher()}),t.showInviteTeacherButton=ko.computed(function(){return t.showSyncButton()&&e.group().isCommunity()}),t.showGCAdminButton=ko.computed(function(){return t.showInviteTeacherButton()}),t.googleClassroom=ko.computed(function(){return!!e.group()&&(e.group().isSiteCommunity()?NF.session.community().is_google_classroom():e.group().isGoogleClassroom())}),t.showAddMembersButtons=ko.computed(function(){return!t.editingList()&&!e.group().isSiteCommunity()&&!t.googleClassroom()}),t.showAddMembersToSiteButtons=ko.computed(function(){return e.group().isSiteCommunity()&&!t.googleClassroom()&&!NF.roles.isSSO()}),t.canAddTeachers=ko.computed(function(){return NF.roles.isAtLeastSiteTeacher()}),t.enableRemoveUsersButton=ko.computed(function(){return t.selectedItems().length>0}),t.enableEditAccountButton=ko.computed(function(){return 1==t.selectedItems().length}),t.enableResetPasswordsButton=ko.computed(function(){return t.selectedItems().length>=1}),t.enableLoginAsButton=ko.computed(function(){return 1==t.selectedItems().length}),t.startEditing=function(){t.editingList(!0),t.clearSelectedItemsList()},t.syncClassroom=function(){var e=r.default.getAuthLink({returnTo:window.location,googleClassroom:!0,referringHostname:!0});r.default.checkAuthorization(e).then(function(){return t.syncDialog.beginSync(t.doneSyncing)})},t.doneSyncing=function(){t.reset(),t.checkAsyncJobs()},t.addClasses=function(){(0,c.navigate)(NF.paths.addGCClasses({groupId:t.groupId()}))},t.inviteTeachers=function(){(0,c.navigate)(NF.paths.inviteTeachers({groupId:t.groupId()}))},t.stopEditing=function(){t.editingList(!1)},t.addMembers=function(){for(var e=[],o=0;o<t.selectedItems().length;o++)e.push(t.selectedItems()[o].userModel.external_id());!function(e,t,o){NF.apiService.addMembersToSiteGroup(e,o,t)}((0,u.resource)("action.adding"),{user_ids:e,group_id:t.groupId()},function(e){i.default.publish(a.GROUP_UPDATED,e.group),t.leaveAddMembersToGroupMode()})},t.resetDefaultView=function(){t.members([]),t.subviewTemplate(null),t.addMembersToSiteMode(!1),t.addMembersToGroupMode(!1),t.subview()&&t.subview(t.subview().parentSubview)},t.leaveAddMembersToGroupMode=function(){t.resetDefaultView(),t.editingList(!1)},t.leaveAddMembersToSiteMode=function(){t.resetDefaultView(),t.parent.siteAdminVM&&t.parent.siteAdminVM.newUsers().reset()},t.doRemoveUsersFromList=function(e){for(var o=t.members().length-1;o>=0;o--)for(var r=0;r<e.length;r++)if(t.members()[o].userModel.external_id()==e[r]){t.members.splice(o,1),t.shown(t.shown()-1);break}},t.resetPasswords=function(){var e=o(),t=new h.default({userIds:e});(0,d.createAndShowDialog)({viewModel:t,templateName:"dialogs/massResetPasswords"})},t.updateListWithRemovedUsers=function(e,o){t.doRemoveUsersFromList(e),i.default.publish(a.GROUP_UPDATED,o)},t.doRemoveUsers=function(e){e.length&&function(e,t,o){NF.apiService.removeSiteGroupMembers(e,o,t)}((0,u.resource)("action.removing"),{user_ids:e,group_id:t.groupId},function(e){var o=$.map(e.users,function(e){return e.external_id});t.updateListWithRemovedUsers(o,e.group)})},t.doRemoveUsersFromSite=function(e){e.length&&t.parent.siteAdminVM.deleteUsers(e,function(e){t.updateListWithRemovedUsers(e.users,e.group)})},t.removeUsers=function(){t.doRemoveUsers(o())},t.removeUsersFromSite=function(){t.doRemoveUsersFromSite(o())},t.fetchMembersEnabled=ko.computed(function(){return!!t.subview()&&(t.subview().fetchMembersEnabled?t.subview().fetchMembersEnabled():!t.parent.group().isNFCommunity())}),t.studentsView=new Noteflight.GroupStudentsMembersViewModel(t),t.teachersView=new Noteflight.GroupTeachersMembersViewModel(t),t.addStudentsView=new Noteflight.SiteStudentsViewModel(t),t.addTeachersView=new Noteflight.SiteTeachersViewModel(t),NF.roles.isAtLeastSiteTeacher()&&(t.addStudentsToSiteView=new Noteflight.AddStudentsToSiteViewModel(t,t.parent.siteAdminVM),t.addTeachersToSiteView=new Noteflight.AddTeachersToSiteViewModel(t,t.parent.siteAdminVM)),t.prepareGoToAddUsersToGroupMode=function(){t.editingList(!0),t.searchTarget(""),t.members([]),t.addMembersToGroupMode(!0)},t.addStudents=function(){t.prepareGoToAddUsersToGroupMode(),t.subview(t.addStudentsView)},t.addTeachers=function(){t.prepareGoToAddUsersToGroupMode(),t.subview(t.addTeachersView)},t.prepareGoToAddUsersToSiteMode=function(){t.searchTarget(""),t.members([]),t.addMembersToSiteMode(!0)},t.addStudentsToSite=function(){t.prepareGoToAddUsersToSiteMode(),t.subview(t.addStudentsToSiteView),t.subview().activate()},t.addTeachersToSite=function(){t.prepareGoToAddUsersToSiteMode(),t.subview(t.addTeachersToSiteView),t.subview().activate()};var l=function(e){t.shown(e.shown),t.remaining(e.remaining);for(var o=e.users,r=0;r<o.length;r++)t.members.push(new Noteflight.SiteGroupMemberViewModel(o[r],t,t.parent.group()));t.busy(!1)};t.processFetchedData=l,t.fetchMembers=function(){var o={group_id:t.groupId(),max_count:40,start_index:t.shown(),order:t.sortOrder()};t.searchTarget()&&(o.query=e.searchTarget()),t.subview().extraParams&&$.extend(o,t.subview().extraParams),t.busy(!0),t.fetchMembersService(t,o,t.processFetchedData)},t.clearData=function(){t.members([]),t.shown(0),t.remaining(0),t.forceFetchData(!0)},t.checkAsyncJobs=function(){var e=this;NF.roles.isAtLeastSiteTeacher()&&(this.siteManagementEnabled(!1),(new s.default).onUpdate(function(t){t[0];var o=t.reduce(function(e,t){return Math.min(e,t.percent)},100);o=Math.round(o),e.asyncGCSyncing.init(),e.asyncGCSyncing.actionLabel((0,u.resource)("action.syncingClassesWithGoogle",o)),e.asyncGCSyncing.busy(1)}).onComplete(function(t,o){e.asyncGCSyncing.busy(0),e.siteManagementEnabled(!0),(o||t.length>0)&&e.reset()}).onError(function(t){e.asyncGCSyncing.init(),e.asyncGCSyncing.errors.push({message:(0,u.resource)("errors.pollingError")})}).startPolling())},t.reset=function(){t.clearData(),t.fetchMembersEnabled()&&(t.fetchMembersService=t.subview().fetchMembersService,t.processFetchedData=t.subview().processFetchedData?t.subview().processFetchedData:l,t.fetchMembers()),t.forceFetchData(!1)},ko.computed(function(){(t.subview()&&(t.subview()!=t.lastSubview||t.searchTarget()!=t.lastSearchTarget)||t.forceFetchData())&&(t.lastSubview=t.subview(),t.lastSearchTarget=t.searchTarget(),t.reset())}).extend({throttle:10}),t.activate=function(){switch(t.clearData(),t.leaveAddMembersToSiteMode(),t.editingList(!1),e.subState()){case"students":t.subview(t.studentsView);break;case"teachers":t.subview(t.teachersView)}t.fetchMembersService=t.subview().fetchMembersService,t.processFetchedData=t.subview().processFetchedData?t.subview().processFetchedData:l,t.rootPath=t.subview().rootPath,t.subview().activate(),t.checkAsyncJobs()}},Noteflight.SiteGroupMembersSubview=function(e){var t=this;t.parent=e,t.memberActions=ko.observableArray([]),t.tabHref=ko.computed(function(){return t.parent&&t.parent.libraryId?t.rootPath({libraryId:e.libraryId()}):t.rootPath({groupId:e.groupId()})})},Noteflight.GroupStudentsMembersViewModel=function(e){var t=this;t.name="studentsView",t.parent=e,t.fetchMembersService=g,t.rootPath=function(e){return t.parent&&t.parent.libraryId?Noteflight.paths.viewSiteLibraryStudents(e):Noteflight.paths.viewSiteGroupStudents(e)},t.activate=function(){e.setSearchLabel("search.labelStudents")},Noteflight.SiteGroupMembersSubview.call(this,e),t.extraParams={sso_user_roles:["student"]}},Noteflight.GroupTeachersMembersViewModel=function(e){var t=this;t.name="teachersView",t.parent=e,t.fetchMembersService=g,t.rootPath=function(e){return t.parent&&t.parent.libraryId?Noteflight.paths.viewSiteLibraryTeachers(e):Noteflight.paths.viewSiteGroupTeachers(e)},t.activate=function(){e.setSearchLabel("search.labelTeachers")},Noteflight.SiteGroupMembersSubview.call(this,e),t.extraParams={sso_user_roles:["instructor","admin"]}},Noteflight.SiteMembersCommonViewModel=function(e){this.processFetchedData=function(t){e.remaining(t.remaining),e.shown(t.shown);for(var o=0;o<t.users.length;o++)e.members.push(new Noteflight.SiteMemberViewModel(t.users[o],e));e.busy(!1)},e.subviewTemplate(null),this.subviewTemplateData=ko.observable()},Noteflight.SiteStudentsViewModel=function(e){this.name="addStudentsView",this.fetchMembersService=b,this.parentSubview=e.studentsView,Noteflight.SiteMembersCommonViewModel.call(this,e),this.rootPath=function(e){return Noteflight.paths.viewSiteGroupStudents(e)},this.activate=function(){e.setSearchLabel("search.labelStudents")},Noteflight.SiteGroupMembersSubview.call(this,e),this.extraParams={sso_user_roles:["student"]}},Noteflight.SiteTeachersViewModel=function(e){this.name="addTeachersView",this.fetchMembersService=b,this.parentSubview=e.teachersView,Noteflight.SiteMembersCommonViewModel.call(this,e),this.rootPath=function(e){return Noteflight.paths.viewSiteGroupTeachers(e)},this.activate=function(){e.setSearchLabel("search.labelTeachers")},Noteflight.SiteGroupMembersSubview.call(this,e),this.extraParams={sso_user_roles:["instructor","admin"]}},Noteflight.SiteMemberViewModel=function(e,t){this.userModel=new l.default(e.user),Noteflight.SelectionItem.call(this,t)},Noteflight.SiteGroupMemberViewModel=function(e,t,o){var r=this,n=this,i=e.user,a=e.user.group_member;n.groupViewModel=t,n.group=o,n.actions=e.actions;var s=e.community_member,f=s&&"instructor"==s.sso_user_role,h=s&&s.connected_to_google;n.userModel=new l.default(i),Noteflight.SelectionItem.call(this,n.groupViewModel),n.role=ko.observable(a?a.member_role:null),n.roleText=ko.computed(function(){return(0,u.resource)("content.".concat(r.role()))}),n.lastVisit=ko.computed(function(){var e=null;return(e=n.group.isSiteCommunity()?i.last_login_time:a?a.last_visited_at:null)?(0,p.observableRelativeTime)(1e3*e)():null}),n.removeFromList=function(){for(var e=0;e<n.groupViewModel.members().length;e++)if(n.groupViewModel.members()[e]==n){n.groupViewModel.members.splice(e,1);break}},n.removeUser=function(){n.groupViewModel.doRemoveUsers([n.userModel.external_id()])},n.removeUserFromSite=function(){n.groupViewModel.doRemoveUsersFromSite([n.userModel.external_id()])},n.resendInvite=function(){NF.apiService.resendTeacherInvite("",this.inviteResent,{user_id:n.userModel.userExternalId()},{fail:this.fail})},n.inviteResent=function(){(0,d.standardAlertDialog)((0,u.resource)("content.invitationSent"))},n.loginAs=function(){n.groupViewModel.doLoginAs([n.userModel.external_id()])},n.editUser=function(){n.groupViewModel.doEditAccount([n.userModel.external_id()])},n.changeRole=function(){n.groupViewModel.doChangeRole(n)},n.goToUser=function(){n.groupViewModel.editingList()||(0,c.navigate)(NF.paths.profile({userId:n.userModel.external_id()}))},n.swallowClick=function(e){return!1},n.isNotRemovable=ko.computed(function(){return n.groupViewModel.editingList()&&(n.userModel.external_id()==NF.session.current_user().external_id()||"admin"==n.role())}),n.contextMenuItems=function(){var e=n.group.isGoogleClassroom(),t=NF.session.current_user(),o=NF.session.community_member();if(n.groupViewModel.editingList()||!t||t.external_id()==n.userModel.external_id())return[];var r=!1,a=!1,s=!1,l=!1,c=!1;t.effective_admin()||"admin"==o.sso_user_role()?(r=!0,a=!0,e&&!f||(n.group.isCommunity()?l=!0:s=!0)):"instructor"==o.sso_user_role()&&"admin"!=n.role()&&(s=!e&&!n.group.isCommunity()&&n.group.showAdminUI(),a=!0,e&&!f||!n.group.isCommunity()||(l=!0),"member"==n.role()&&(r=!0));var d=["instructor","admin"].includes(o.sso_user_role());n.group.isCommunity()&&e&&d&&f&&!h&&(c=!0);var p=[];return r&&p.push({label:(0,u.resource)("action.loginAs",i.username),action:n.loginAs}),a&&p.push({label:(0,u.resource)("action.edit"),action:n.editUser}),s&&p.push({label:(0,u.resource)("action.remove"),action:n.removeUser}),l&&p.push({label:(0,u.resource)("action.delete"),action:n.removeUserFromSite}),c&&p.push({label:(0,u.resource)("action.resendInvite"),action:n.resendInvite}),p},n.showContextMenuButton=ko.computed(function(){var e=n.contextMenuItems();return!n.groupViewModel.editingList()&&e.length>0})},Noteflight.AddMembersToSiteCommonViewModel=function(e){this.fetchMembersEnabled=ko.observable(!1),this.siteAdminVM.newUsers().processAddedUsers=function(t){e.leaveAddMembersToSiteMode(),e.parent.group().updateGroup(t.group)},this.siteAdminVM.newUsers().sso_user_role("student"),this.subviewTemplateData=ko.observable(this.siteAdminVM.newUsers())},Noteflight.AddStudentsToSiteViewModel=function(e,t){var o=this;o.name="addStudentsView",o.siteAdminVM=$.extend(!0,{},t),Noteflight.AddMembersToSiteCommonViewModel.call(this,e),o.parentSubview=e.studentsView,o.activate=function(){e.subviewTemplate("admin/addSiteUsers"),o.siteAdminVM.newUsers().sso_user_role("student")}},Noteflight.AddTeachersToSiteViewModel=function(e,t){var o=this;o.name="addTeachersView",o.siteAdminVM=$.extend(!0,{},t),Noteflight.AddMembersToSiteCommonViewModel.call(this,e),o.parentSubview=e.teachersView,o.activate=function(){e.subviewTemplate("admin/addSiteUsers"),o.siteAdminVM.newUsers().sso_user_role("instructor")}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(6),n=o(0),i=l(o(13)),a=l(o(42)),s=o(73);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=d(this,p(t).call(this))).initializeObservables(),e.userIds=o.userIds||[],e.reporter=new a.default({marginTop:"0px"}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,i.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"initializeObservables",value:function(){this.password=r.ko.observable(""),this.passwordConfirm=r.ko.observable(""),this.requireReset=r.ko.observable(!0)}},{key:"resetPasswords",value:function(){return this.reporter.clearErrors(),!Array.isArray(this.userIds)||this.userIds.length<1?(this.reporter.addError({code:"noUsers",message:(0,n.resource)("errors.noValidValue")}),!1):this.password().length<4?(this.reporter.addError({code:"passwordTooShort",message:(0,n.resource)("errors.passwordTooShortServer")}),!1):this.password()!==this.passwordConfirm()?(this.reporter.addError({code:"passwordMismatch",message:(0,n.resource)("errors.passwordsMustMatch")}),!1):void this._doResetPasswords(this.userIds,this.password(),this.requireReset())}},{key:"_doResetPasswords",value:function(e,t,o){s.apiService.massResetPasswords(this.reporter,this.hide,{user_ids:e,password:t,reset_required:o})}},{key:"doOk",value:function(){this.resetPasswords()}}]),t}();t.default=h},function(e,t,o){"use strict";o(1221),o(305),o(216)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(o(4)),n=p(o(54)),i=p(o(215)),a=p(o(216)),s=o(5),l=o(8),c=p(o(61)),u=o(2),d=o(0);function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var v=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?b(e):t}(this,m(t).call(this))).detailView=!0,e.siteTypeSelected=ko.observable(!1),e.templateName=ko.observable("site/createSite"),e.busy=ko.observable(!1),e.showConfirmationScreen=ko.observable(!1),e.userHasSso=ko.observable(NF.session.current_user()&&NF.session.current_user().sso_enabled()),e.ssoKey=ko.observable(""),e.ssoType=ko.observable(null),e.googleClassroomAuthCheckComplete=ko.observable(!1),e.selectGoogleClassroom=ko.observable(!1),e.selectGoogleClassroom.subscribe(function(t){t&&e.site.site_type(l.SITE_TYPE_GC)}),e.site=new i.default({groupId:null,name:"",description:"",logo_id:null,site_type:e.userHasSso()?null:l.SITE_TYPE_SCC,sso_username:NF.session.current_user()?NF.session.current_user().username():""}),e.siteForm=new a.default(e.site),e.showLmsTypeSelection=ko.computed(function(){return e.userHasSso()}),e.isLtiSite=ko.computed(function(){return e.site.site_type()==l.SITE_TYPE_LTI}),e.isGoogleClassroomSite=ko.computed(function(){return e.site.site_type()==l.SITE_TYPE_GC}),e.isSccSite=ko.computed(function(){return e.site.site_type()==l.SITE_TYPE_SCC}),e.site.site_type.subscribe(function(t){if(e.siteTypeSelected(!0),t==l.SITE_TYPE_GC&&!e.googleClassroomAuthCheckComplete()){var o=c.default.getAuthLink({returnTo:"/site/admin#/newSiteGoogle",googleClassroom:!0});c.default.checkAuthorization(o).then(e.handleClassroomAuthorizationSuccess).catch(e.handleClassroomAuthorizationFailure)}}),e.showSiteForm=ko.computed(function(){return e.isSccSite()||e.isLtiSite()||e.isGoogleClassroomSite()&&e.googleClassroomAuthCheckComplete()}),e.handleClassroomAuthorizationSuccess=e.handleClassroomAuthorizationSuccess.bind(b(b(e))),e.handleClassroomAuthorizationFailure=e.handleClassroomAuthorizationFailure.bind(b(b(e))),e.handleCreateSiteSuccess=e.handleCreateSiteSuccess.bind(b(b(e))),r.default.subscribe(s.STOCK_IMAGE_GROUP_LOGO_SELECTED,function(t,o){o.group_logo_id&&e.site.logo_id(o.group_logo_id)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,n.default),function(e,t,o){t&&h(e.prototype,t),o&&h(e,o)}(t,[{key:"selectGCSite",value:function(){this.site.site_type(l.SITE_TYPE_GC)}},{key:"selectLtiSite",value:function(){this.site.site_type(l.SITE_TYPE_LTI)}},{key:"onNavigate",value:function(){}},{key:"handleCancelClick",value:function(){NF.appViewModel.navigateToLastMasterView()}},{key:"handleSubmitClick",value:function(){this.siteForm.validateSite()&&(this.busy(!0),function(e,t,o){var r={sso_username:e.sso_username(),hostname:e.hostname(),name:e.name(),description:e.description(),allow_anonymous_view:e.allow_anonymous_view(),site_type:e.site_type(),logo_id:e.logo_id(),courses:e.courses()};e.site_type()==l.SITE_TYPE_LTI&&(r.default_proxy_url=e.default_proxy_url());NF.apiService.createSite(t,o,r)}(this.site,(0,d.resource)("content.creatingSite"),this.handleCreateSiteSuccess))}},{key:"handleVisitSiteSubmit",value:function(){Noteflight.appViewModel.changeCommunity(this.site.hostname())}},{key:"handleClassroomAuthorizationSuccess",value:function(){this.googleClassroomAuthCheckComplete(!0)}},{key:"handleClassroomAuthorizationFailure",value:function(){this.site.site_type(l.SITE_TYPE_LTI)}},{key:"handleCreateSiteSuccess",value:function(e){this.site.site_type()==l.SITE_TYPE_LTI&&this.ssoKey(e.domain.signature_secret_key),this.busy(!1),this.showConfirmationScreen(!0),NF.analytics.trackEvent("Site creation",this.site.site_type(),NF.session.current_user().max_total_scc_member_count())}}]),t}();t.default=v,(0,u.addRoute)("createNewSite","/site/admin#/newSite",v),(0,u.addRoute)("createNewSiteGoogle","/site/admin#/newSiteGoogle",v,{selectGoogleClassroom:!0})},function(e,t,o){"use strict";o(1223),o(1224),o(315),o(1225),o(219),o(213),o(1226),o(1227),o(1228),o(1229),o(301),o(1231),o(1232),o(1233),o(282),o(300),o(266),o(1234),o(1235),o(1236),o(1240),o(317),o(1241),o(1242),o(1243),o(220),o(1244),o(1245),o(1246),o(1247),o(1248),o(1249),o(316),o(1250),o(298),o(1251),o(299),o(1252),o(1253),o(1254)},function(e,t,o){"use strict";Noteflight.AnimatedCounter=function(e){var t=this;t.performer=e,t.counter=ko.observable(),t.interval=ko.observable(),t.intervalId=-1,t.callback=null,t.showMask=ko.observable(!0),t.isDone=!1,t.countingDown=ko.observable(!1),t.animationInterval=ko.computed(function(){return 2*t.interval()+"s"}),t.done=function(){clearInterval(t.intervalId),t.countingDown(!1),t.showMask(!1),t.isDone=!0,t.callback&&t.callback()},t.decrementCounter=function(){t.counter(t.counter()-1),0===t.counter()&&t.done()},t.startCountDown=function(e,o,r){t.isDone=!1,t.counter(null),t.showMask(!0),t.callback=r;var n=t.performer.player.rawPosition;e>0?setTimeout(function(){t.countingDown(!0),t.showMask(!1),t.counter(e),t.interval(o),t.intervalId=setInterval(t.decrementCounter,1e3*o)},Math.abs(1e3*n)):t.done()}}},function(e,t,o){"use strict";var r=o(20);Noteflight.Annotation=function(e,t){this.username=ko.observable(e.username),this.annotationText=ko.observable(e.text),this.annotationDate=(0,r.observableRelativeTime)(e.created),this.positionX=ko.observable(),this.positionY=ko.observable(),this.isEditable=ko.computed(function(){return t.document.editable})}},function(e,t,o){"use strict";var r=o(0),n=o(60),i=o(191),a=o(8),s=o(213),l=o(106);Noteflight.AudioRecording=function(e,t){var o=this;o.editor=t,o.palette=e,o.audioContext=null,o.recordingCanvas=e.recordingCanvas,o.input=null,o.javascriptNode=null,o.measureIndex=0,o.isRecording=!1,o.delay=0,o.recorderWorkerLoaded=!1;var c=null;(0,l.loadWorkerFile)((0,l.workerPath)("recorderWorker"),function(t){c=t,e.audioLoaded(!0)}),o.setupRecording=function(e){o.measureIndex=e,o.editor.controller.document.undoHistory.openGroup("Audio Recording");var t=o.editor.scoreApi.getSynthesisContext();o.audioContext=t.context},o.abortRecording=function(){o.isRecording=!1},o.stopRecording=function(){o.recorder&&o.isRecording&&(o.isRecording=!1,o.editor.scoreApi.muteTracksForPart(o.palette.selectedPart()),o.recorder.exportWAV(function(e){o.blob=e,o.javascriptNode.disconnect(o.audioContext.destination);var t=new FileReader;t.onload=function(){var e=this.result;o.audioContext.decodeAudioData(e,function(e){o.uploadAudioMedia(e,function(t){var r=o.palette.selectedPart(),n=o.editor.controller.score.getSystemStaffMeasureAt(o.measureIndex),i=o.editor.scoreApi.scorePositionToTime(n.scorePosition);o.editor.controller.addAudioClip(o.editor.getUserInfo(),r,e,t,i,o.delay),NF.analytics.trackEvent("editor","recording","time",Math.round(1e3*(e.duration-o.delay)))})})},t.readAsArrayBuffer(e)}))},o.uploadAudioMedia=function(e,t){(0,i.audioBufferToWav)(e).then(function(e){return(0,i.wavToArrayBuffer)(e)}).then(function(t){return new Promise(function(n,a){var s={content_type:"audio/wav",channel_count:e.channelCount,sample_rate:e.sampleRate,duration:e.duration},l=o.editor.controller.score.scoreId;(0,i.uploadMedia)(l,s,t,new Noteflight.ServiceReporterViewModel((0,r.resource)("action.uploadingWavFile")),n)})}).then(function(e){t(e)})},o.getLatency=function(){if(Noteflight.hasStorage){var e=localStorage.getItem(a.CALIBRATED_LATENCY_STORAGE_KEY);if(e)return Number(e)}return(0,s.calibratedLatencyGetter)()?Number((0,s.calibratedLatencyGetter)()):0},o.captureRecording=function(e){o.isRecording=!0,o.input=o.audioContext.createMediaStreamSource((0,n.microphoneStreamGetter)()),o.javascriptNode||(o.javascriptNode=o.audioContext.createScriptProcessor(2048,1,1)),o.input.connect(o.javascriptNode),o.javascriptNode.connect(o.audioContext.destination),o.javascriptNode.onaudioprocess=function(e){if(o.isRecording){var t=e.inputBuffer.getChannelData(0);o.recordingCanvas.updateCanvas(t)}};var t={numChannels:1,blob:(0,l.getWorkerBlob)(c)};o.recorder=new Recorder(o.input,t),o.recorder.record();var r=o.editor.controller.performer.player.rawPosition;o.delay=e-r+o.getLatency()}}},function(e,t,o){"use strict";var r=o(0),n=o(3),i=o(239),a=function(e){var t=(e- -20)/23*100;return t<0&&(t=0),t};Noteflight.CalibrateMicDialog=function(e,t){var o,s,l,c,u,d,p,f,h,m,g,b;this.editor=e,this.title=t,this.running=ko.observable(!1),this.state=ko.observable("idle"),this.feedbackText=ko.observable((0,r.resource)("content.calibrateGain.calibrating")),this.dBs=ko.observable(-40),this.highestDBs=ko.observable(0),this.nextButtonVisible=ko.observable(!1),this.skipButtonVisible=ko.observable(!0),this.cancelButtonVisible=ko.observable(!0),this.tryAgainButtonVisible=ko.observable(!1),this.greenZoneVisible=ko.observable(!1),this.cancelDialog=function(){this.running(!1),u.shutDown(),this.cancel()},this.init=function(){o=document.querySelector(".vuCurrent"),s=document.querySelector(".vuHighest"),l=document.querySelector(".vuHighestNotch"),c=document.querySelector(".vuGreenZone"),u=(0,i.createMicCalibrator)(this.editor.scoreApi.getSynthesisContext().context),b(),this.running(!0),window.requestAnimationFrame(p),u.start()},this.nextStep=function(){u.shutDown(),this.running(!1),this.editor.scoreDialogs.calibrateLatency(),this.cancel()},this.start=function(){u.start()},p=(p=function(){this.dBs(Math.round(u.dBs)+"dB"),this.highestDBs(Math.round(u.highestDBs)+"dB"),d(),f(a(u.dBs),a(u.highestDBs)),this.running()&&window.requestAnimationFrame(p)}).bind(this),d=(d=function(){var e=u.state;this.state()!=e&&(this.state(e),this.feedbackText((0,r.resource)("content.calibrateGain."+e)),["tooHigh","tooLow"].indexOf(e)>-1&&h(),"calibrating"==e&&g(),"justRight"==e&&m())}).bind(this),h=(h=function(){this.nextButtonVisible(!1),this.skipButtonVisible(!0),this.tryAgainButtonVisible(!0),this.greenZoneVisible(!0)}).bind(this),m=(m=function(){this.nextButtonVisible(!0),this.skipButtonVisible(!1),this.tryAgainButtonVisible(!1),this.greenZoneVisible(!0)}).bind(this),g=(g=function(){this.nextButtonVisible(!1),this.skipButtonVisible(!0),this.tryAgainButtonVisible(!1),this.greenZoneVisible(!1)}).bind(this),b=(b=function(){c.style.left=a(u.lowLimitDBs)+"%",c.style.width=a(u.highLimitDBs)-a(u.lowLimitDBs)+"%"}).bind(this),f=function(e,t){var r=(Math.floor(e)+155).toString(16);o.style.backgroundColor="#"+r+r+r,o.style.width=e+"%",s.style.left=t+"%",l.style.left=t+"%"},n.DialogViewModel.call(this)}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.ChooseInstrumentDialog=function(e,t,o,i){var a=this,s=[2,2,1,2,2,2,1],l=$$nf.classes.com.noteflight.notation.instrument.InstrumentLibraryEntry,c=$$nf.classes.com.noteflight.notation.instrument.InstrumentLibraryLoader,u=$$nf.classes.com.noteflight.notation.performance.IdentityScorePositionMap,d=$$nf.classes.com.noteflight.performance.MusicRealizer,p=$$nf.classes.com.noteflight.performance.PerformableNote,f=$$nf.classes.com.noteflight.performance.Performance,h=$$nf.classes.com.noteflight.performance.MusicPlayerManager,m=$$nf.classes.com.noteflight.notation.model.Note,g=$$nf.classes.com.noteflight.music.pitch.ChromaticPitch;a.resource=r.resource,a.editor=e,a.title=t,a.manifestType=$$nf.synthesis.context.premium?"premium":"basic",a.manifest=$$nf.synthesis.context.manifest[a.manifestType],a.instrumentList=ko.observableArray(a.manifest.list),a.groupsList=$$nf.synthesis.context.manifest.getGroupsList($$nf.synthesis.context.premium),a.instrumentMap=a.manifest.map,a.instrumentGroups=ko.observableArray(),a.instrument=ko.observable(),a.part=ko.observable();var b={};function v(e){a.player(null)}function y(e){var t=e.getGroups();if(t.length>0)for(var o=0;o<t.length;o++)_(t[o],e,0===o);else _(e.getUri().split("/")[0],e,!0)}function _(e,t,o){b[e]&&b[e].addInstrument(t,o)}if(a.isLoadingInstrument=ko.observable(!1),a.player=ko.observable(),a.transposition=ko.observable(0),a.transposedOctave=ko.observable(0),a.octaveShift=ko.observable(0),a.name=ko.observable(""),a.shortName=ko.observable(""),a.barlineBreak=ko.observable(!1),a.directionsAboveStaff=ko.observable(!1),a.playSampleNotesText=ko.computed(function(){return a.player()?(0,r.resource)("action.stop"):(0,r.resource)(a.isLoadingInstrument()?"action.loading":"action.playSample")}),a.highlightedInstrument=ko.observable(0),a.filteredInstruments=ko.observableArray([]),a.searchInstrument=ko.observable(""),a.searchInstrument.subscribe(function(e){if(a.filteredInstruments([]),a.highlightedInstrument(0),e=NF.getStringToCompare(e))for(var t=0;t<a.instrumentGroups().length;t++)for(var o=a.instrumentGroups()[t].filterInstruments(e),r=0;r<o.length;r++)a.isInstrumentInFilteredList(o[r])||a.filteredInstruments.push(o[r])}),a.filteringInstruments=ko.computed(function(){return a.searchInstrument().length>0}),a.searchInstrumentKeyPressed=function(e,t){var o=null;if(a.filteredInstruments().length>0){if(13==t.keyCode){if(a.instrument())return;a.filteredInstruments()[a.highlightedInstrument()].instrument.selectInstrument()}40==t.keyCode&&((o=a.highlightedInstrument()+1)>=a.filteredInstruments().length&&(o=0),a.highlightedInstrument(o)),38==t.keyCode&&((o=a.highlightedInstrument()-1)<0&&(o=a.filteredInstruments().length-1),a.highlightedInstrument(o))}return!0},a.transpositionOptions=[{key:(0,r.resource)("note.C"),transposition:0},{key:(0,r.resource)("note.B"),transposition:-1},{key:(0,r.resource)("note.B.flat"),transposition:-2},{key:(0,r.resource)("note.A"),transposition:-3},{key:(0,r.resource)("note.A.flat"),transposition:-4},{key:(0,r.resource)("note.G"),transposition:-5},{key:(0,r.resource)("note.F.sharp"),transposition:-6},{key:(0,r.resource)("note.F"),transposition:-7},{key:(0,r.resource)("note.E"),transposition:-8},{key:(0,r.resource)("note.E.flat"),transposition:-9},{key:(0,r.resource)("note.D"),transposition:-10},{key:(0,r.resource)("note.D.flat"),transposition:-11}],a.octaveOptions=[-4,-3,-2,-1,0,1,2,3,4],n.DialogViewModel.call(this),a.isInstrumentInFilteredList=function(e){for(var t=0;t<a.filteredInstruments().length;t++)if(a.filteredInstruments()[t].instrument.name()==e.instrument.name())return!0;return!1},a.getInstrumentDisplayName=function(e){var t="instruments.name."+NF.getStringForResourcesKey(e);return a.getDisplayName(t,e)},a.getInstrumentDisplayPartName=function(e){var t="instruments.partName."+NF.getStringForResourcesKey(e);return a.getDisplayName(t,e)},a.getInstrumentDisplayShortName=function(e,t){var o="instruments.shortName."+NF.getStringForResourcesKey(e);return a.getDisplayName(o,t)},a.getDisplayName=function(e,t){return(0,r.hasResource)(e)?(0,r.resource)(e):t},a.part.subscribe(function(){var e=a.part();if(e){for(var t=e.transposition;t<=-12;)t+=12;for(;t>0;)t-=12;a.transposition(t),a.transposedOctave(-Math.floor(-e.transposition/12)),a.octaveShift(e.octaveShift),a.name(a.getInstrumentDisplayPartName(e.name)),a.shortName(a.getInstrumentDisplayShortName(e.name,e.shortName)),a.barlineBreak(e.barlineBreak),a.directionsAboveStaff(e.directionsAboveStaff),a.clefs=[]}}),a.cancelDialog=function(){a.stopPlayer(),a.cancel()},a.showInstrumentSelected=function(){var e=$(".instrumentGroupContainer").find(".selected").position(),t=null;if(e&&(t=e.top),t){var o=$(".instrumentSelection").height(),r=$(".instrumentSelection").scrollTop();(t<r||t>r+o)&&$(".instrumentSelection").scrollTop(t-o+24)}},function(){!function(){for(var e=0;e<a.groupsList.length;e++){var t=a.groupsList[e].name.toLowerCase();a.instrumentGroups.push(new Noteflight.InstrumentGroupViewModel(t,a)),b[t]=a.instrumentGroups()[a.instrumentGroups().length-1]}}();for(var e=0;e<a.instrumentList().length;e++){var t=a.instrumentList()[e];t.classic||y(t)}}(),o){a.instrument(a.manifest.map[o.instrumentUri]),a.part(o),a.instrument()&&a.instrument().classic&&y(a.instrument());for(var S=0;S<a.instrumentGroups().length&&!a.instrumentGroups()[S].selectInstrument(o.instrumentUri);S++);}a.instrument.subscribe(function(){if(a.instrument()){var e=new l(null,a.instrument().getUri());c.parsePartDefaults(e,$$nf.classes.XML.fromDOM(a.instrument().getPartDefaults())),a.part(e.createPart()),a.clefs=e.clefs}else a.part(o)}),a.unselectInstruments=function(){for(var e=0;e<a.instrumentGroups().length;e++)a.instrumentGroups()[e].unselectInstruments()},a.playSampleNotes=function(){a.stopPlayer()||(a.isLoadingInstrument(!0),a.editor.startSound(function(){var e=a.instrument().createInstrument();e.load(function(){a.doPlaySampleNotes(e)})}))},a.doPlaySampleNotes=function(e){a.isLoadingInstrument(!1);for(var t=[],o=e.zones[0].rootPitch,r=e.zones[e.zones.length-1].rootPitch,n=o,i=0;n<=r;)t.push(new m(g.pitchAt(n,0))),n+=s[i],++i==s.length&&(i=0);if(t.length>=0){var l=new f,c=0;$.each(t,function(e,t){var o=new p;o.onset=c,o.channel=0,o.pitch=t.pitch,o.velocity=p.STANDARD_VELOCITY,o.duration=.2,l.addElement(o),c+=o.duration+.05});var b=new d([null],new u,{parts:[a.part()]});a.player(h.getInstance().createMusicPlayer(l,b)),a.player().addEventListener("soundComplete",v),a.player()&&a.player().play()}},a.stopPlayer=function(){return!!a.player()&&(a.player().stop(),!0)},a.chooseInstrument=function(){a.stopPlayer(),NF.analytics.trackEvent("editor","instrument",a.part().instrumentUri);var e=a.part().clone();o&&(e.gain=o.gain,e.pan=o.pan),e.transposition=a.transposition()+12*a.transposedOctave(),e.octaveShift=a.octaveShift(),e.name=a.name(),e.shortName=a.shortName(),e.barlineBreak=a.barlineBreak(),e.directionsAboveStaff=a.directionsAboveStaff(),(0,n.hideCurrentDialog)(),i(e,a.clefs)},a.ok=function(){a.instrument()&&a.chooseInstrument()}},Noteflight.InstrumentGroupViewModel=function(e,t){var o=this;o.resource=r.resource,o.instrumentDialog=t,o.groupName=NF.getStringForResourcesKey(e),o.instruments=ko.observableArray(),o.collapsed=ko.observable(!0),o.addInstrument=function(e,t){o.instruments.push({instrument:new Noteflight.InstrumentViewModel(e,o.instrumentDialog),isMainGroup:t})},o.unselectInstruments=function(){for(var e=0;e<o.instruments().length;e++)o.instruments()[e].instrument.selected(!1)},o.selectInstrument=function(e){for(var t=0;t<o.instruments().length;t++)if(o.instruments()[t].isMainGroup&&(o.instruments()[t].instrument.instrument.getUri()==e||o.instruments()[t].instrument.instrument.getAliases().indexOf(e)>-1))return o.collapsed(!1),o.instruments()[t].instrument.selected(!0),!0;return!1},o.toggleInstrumentGroup=function(){o.collapsed(!o.collapsed())},o.filterInstruments=function(e){for(var t=[],r=0;r<o.instruments().length;r++)o.instruments()[r].instrument.filterInstrument(e)&&t.push(o.instruments()[r]);return t}},Noteflight.InstrumentViewModel=function(e,t){var o=this;o.instrumentDialog=t,o.instrument=e,o.name=ko.observable(e.getName()),o.label=ko.observable(o.instrumentDialog.getInstrumentDisplayName(e.getName())),o.selected=ko.observable(!1),o.selectInstrument=function(){o.instrumentDialog.instrument(o.instrumentDialog.manifest.map[o.instrument.getUri()]),o.instrumentDialog.unselectInstruments(),o.selected(!0)},o.filterInstrument=function(e){return-1!=NF.getStringToCompare(o.label()).indexOf(e)}}},function(e,t,o){"use strict";var r=o(3);Noteflight.EditorKeyMediator=function(e){var t=this;function o(){var e=document.activeElement.nodeName;return"TEXTAREA"==e||"INPUT"==e}t.editorPalette=e,t.initialize=function(){$(window).bind("keydown",function(e){e.metaKey||e.ctrlKey?o()||function(e){var o;switch(String.fromCharCode(e.keyCode).toLowerCase()){case"c":o="copy";break;case"v":o="paste";break;case"x":o="cut";break;case"s":o="save";break;case"p":o="print";break;case"a":o="selectAll";break;case"z":o=e.shiftKey?"redo":"undo";break;case"y":o="redo";break;case"g":o="graceNote";break;case"l":o="lyrics";break;case"e":o="expressionText"}o&&(e.preventDefault(),t.editorPalette.doEditorAction(o),NF.analytics.trackEvent("editor",o,"shortcut"))}(e):function(e){if(0===e.keyCode)switch(e.key){case"UIKeyInputUpArrow":case"UIKeyInputLeftArrow":case"ArrowUp":case"ArrowLeft":!o()&&t.editorPalette.editor.scoreState.isPlayMode()&&t.editorPalette.editor.scoreApi.scrollToPreviousPage();break;case"UIKeyInputDownArrow":case"UIKeyInputRightArrow":case"ArrowDown":case"ArrowRight":!o()&&t.editorPalette.editor.scoreState.isPlayMode()&&t.editorPalette.editor.scoreApi.scrollToNextPage()}switch(String.fromCharCode(e.keyCode).toLowerCase()){case String.fromCharCode(13):(0,r.saveAndCloseCurrentModalDialog)(e);break;case String.fromCharCode(27):(0,r.cancelAndCloseCurrentModalDialog)(e);break;case"m":!o()&&t.editorPalette.editor.scoreState.isSyncMediaPlaying()&&t.editorPalette.editor.markNextMediaSyncMeasure();break;case String.fromCharCode(37):case String.fromCharCode(38):!o()&&t.editorPalette.editor.scoreState.isPlayMode()&&t.editorPalette.editor.scrollToPreviousPage();break;case String.fromCharCode(39):case String.fromCharCode(40):!o()&&t.editorPalette.editor.scoreState.isPlayMode()&&t.editorPalette.editor.scrollToNextPage()}}(e)})}}},function(e,t,o){"use strict";var r=p(o(4)),n=p(o(316)),i=o(5),a=o(19),s=o(220),l=o(0),c=o(3),u=o(14),d=o(221);function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Noteflight.ScoreCommonPalette=function(e,t){var o=this;o.editor=t,o.scoreEditor=t.scoreEditor,o.canEdit=t.scorePermissions.canEdit,o.initializeConnectedProperties=function(){o.isEditingProduct=ko.observable(),(0,u.connect)(d.scoreCommonPaletteSelector,{})(o)},o.initializeConnectedProperties(),o.embedded=ko.pureComputed(function(){return o.scoreEditor.viewer()}),o.hideSave=ko.computed(function(){return o.embedded()||o.isEditingProduct()}),o.disableViewType=ko.computed(function(){return o.isEditingProduct()}),o.showOpenInWindow=function(){return o.embedded()&&o.scoreEditor.showFullWindow},o.paused=t.scoreState.isPaused,o.pausePlayScore=function(){o.editor.scoreApi.pause()},o.continuePlayScore=function(){o.editor.scoreApi.resume()},o.beginningPlayScore=function(){o.editor.scoreApi.resetCursorPosition()},o.performanceSpeed=o.editor.performanceSpeed,o.isMetronomeMuted=ko.observable().extend({bindProperty:{source:o.editor.controller.performer.metronome,property:"muted"}}),o.playMetronome=ko.computed({read:function(){return!o.isMetronomeMuted()},write:function(e){!e||t.scorePermissions.checkMetronomePermissions()?o.editor.controller.performer.metronome.muted=!e:o.playMetronome(!1)}}),o.updateVars=function(){o.playMetronome(!t.controller.performer.metronome.muted)},o.openInWindow=function(){window.open(NF.paths.editScore(NF.currentRouteParams),"noteflightScore")},o.loggedIn=function(){return NF.session.current_user()},o.allowLogin=function(){return!o.editor.isViewerOnly()&&NF.session.allowLogin()},o.allowSignup=function(){return!o.editor.isViewerOnly()&&NF.session.allowSignup()},o.showPlay=function(){return o.scoreEditor.showPlaybackControls},o.showCopying=ko.computed(function(){return o.loggedIn()&&t.scorePermissions.canMakeItCopyable()}),o.showExport=ko.computed(function(){return!Noteflight.iOS&&t.scorePermissions.canUseTheExportDialog()}),o.showCopyingOrExport=function(){return o.showCopying()||o.showExport()},o.showPrinting=ko.computed(function(){return t.scorePermissions.canPrint()}),o.showAudioReference=ko.computed(function(){return t.score()&&t.score().hlcAudioref()}),o.signin=function(){NF.appViewModel.showLoginForm()},o.showInstrumentsButton=function(){return!o.embedded()},o.zoomDisabled=ko.computed(function(){return t.scoreState.isPerformMode()}),o.playScore=function(){e.switchMode("play"),o.editor.scoreApi.play()},o.playAudioReference=function(){o.showAudioReference()&&window.open(t.score().hlcAudioref(),"audioref")},o.perform=function(){e.switchMode("perform")},o.showScoreDetails=ko.computed({read:function(){return o.scoreEditor.scoreDetailsPanel().showScoreDetails()},write:function(e){o.scoreEditor.scoreDetailsPanel().openCloseScoreDetailsPanel(e)}}),o.showMixer=ko.computed({read:function(){return o.scoreEditor.showMixer()},write:function(e){o.scoreEditor.openCloseMixer(e)}}),o.showPianoKeyboard=ko.computed({read:function(){return o.scoreEditor.showPianoKeyboard()},write:function(e){o.scoreEditor.showPianoKeyboard(e)}}),o.showHelp=ko.observable(!0),o.floatHeader=ko.computed({read:function(){return NF.appViewModel.floatHeader()},write:function(e){NF.appViewModel.floatHeader(e),o.toggleFullScreen(e)}}),o.toggleFullScreen=function(e){if(e){var t=document.getElementsByTagName("BODY")[0];t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),o.scoreEditor.customHeaderPalette()&&o.scoreEditor.customHeaderPalette().menuOpen(!1),o.addFullscreenEventListeners()}else o.exitFullscreen()},o.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},o.addFullscreenEventListeners=function(){document.addEventListener("fullscreenchange",o.exitFullScreenHandler),document.addEventListener("webkitfullscreenchange",o.exitFullScreenHandler),document.addEventListener("mozfullscreenchange",o.exitFullScreenHandler),document.addEventListener("MSFullscreenChange",o.exitFullScreenHandler)},o.exitFullScreenHandler=function(){document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||o.productToggleFullScreen&&(NF.appViewModel.fullscreen(!1),o.showScoreDetails(!0))},o.useLargeIcons=ko.computed({read:function(){return e.useLargeIcons()},write:function(t){e.useLargeIcons(t)}}),o.currentView=ko.computed({read:function(){return o.editor.fit()},write:function(e){o.editor.fit(e)}}),o.showInstruments=ko.computed({read:function(){return o.scoreEditor.showInstruments()},write:function(e){o.scoreEditor.openCloseInstruments(e)}}),o.showFormatting=ko.computed({read:function(){return o.scoreEditor.showFormatting()},write:function(e){o.scoreEditor.openCloseFormatting(e)}}),o.showPageSetup=function(){o.scoreEditor.openCloseFormatting(!0,"pageSetup")},o.showMediaSync=ko.computed({read:function(){return o.scoreEditor.showMediaSyncEditor()},write:function(e){o.scoreEditor.openCloseMediaSyncEditor(e)}}),o.showStatistics=o.editor.showStatistics,o.requiresSave=ko.computed(function(){return o.editor.requiresSave()}),o.doEditorAction=function(e){var t=(0,l.resource)("palette."+e);switch(e){case"save":o.requiresSave()&&!o.isEditingProduct()&&(o.editor.save(),ga("send","event","Scores","save"));break;case"saveCopy":o.editor.saveScoreCopy();break;case"documentLayout":o.editor.scoreDialogs.editDocumentLayout();break;case"export":o.editor.scoreDialogs.exportScore();break;case"concertPitch":o.editor.controller.document.undoHistory.openGroup(t),o.editor.controller.setScoreProperty("transposeParts",!o.editor.controller.getScoreProperty("transposeParts"));break;case"pageSetup":o.editor.scoreDialogs.pageSetup();break;case"print":o.editor.print({usePrinter:!0});break;case"copy":o.editor.controller.copyClipboard();break;case"selectAll":o.editor.controller.document.undoHistory.openGroup(t),o.editor.controller.selectScore();break;case"selectFilter":o.editor.scoreDialogs.filterSelection();break;case"expressionText":o.addExpression();break;case"graceNote":o.setGrace();break;case"lyrics":o.addLyrics();break;case"hideShowCautionaries":o.toggleCautionaries();break;case"pageTurner":(0,c.standardAlertDialog)((0,l.resource)("editor.pageTurnerAlert"));break;default:o.doEditorActionsPalette?o.doEditorActionsPalette(e,t):console.log("action not implemented: "+e)}};var r={};o.boundScoreProperty=function(e,o){return ko.computed(function(){if(!t.active())return null;if(!r[e]){var n=o?o(t.controller.score):t.controller.score;r[e]=ko.observable().extend({bindProperty:{source:n,property:e}})}return r[e]()})},o.transposeParts=o.boundScoreProperty("transposeParts"),o.concertPitch=ko.computed(function(){return!o.transposeParts()});var n=0,i=0,a=0,s=0;function p(){n=$("#scoreContainer").height(),i=$("#html5Editor").scrollTop()+$("#html5Editor").height()/2,a=$("#scoreContainer").width(),s=$("#html5Editor").scrollLeft()+$("#html5Editor").width()/2}function f(){var e=$("#scoreContainer").height()*i/n;$("#html5Editor").scrollTop(e-$("#html5Editor").height()/2),e=$("#scoreContainer").width()*s/a,$("#html5Editor").scrollLeft(e-$("#html5Editor").width()/2)}o.setAutoScale=function(e){o.editor.scoreApi.setAutoScale(e),o.editor.scoreApi.resizeToFitScore()},o.toggleAutoScale=function(){var e=o.editor.scoreApi.toggleAutoScale();p(),o.autoScale(e),o.editor.scoreApi.resizeToFitScore(),f(),o.editor.repositionAnnotations(),o.markDocumentToSave()},o.markDocumentToSave=function(){o.editor.documentController.scoreDocument.markUnsaved(),o.editor.updateRequiresSave()},o.setScale=function(e){o.editor.controller.document&&(o.editor.controller.document.score.viewScale=e/100)},o.autoScale=ko.observable(o.editor.scoreApi.getAutoScale()||Noteflight.IsPhoneLayout()),o.autoScale.subscribe(function(e){o.setAutoScale(e)}),o.zoomFactor=ko.computed({read:function(){var e=Math.floor(100*o.editor.scoreState.viewScale());return e<40&&(o.setScale(40),e=40),e},write:function(e){o.editor.scoreApi.getAutoScale()&&o.editor.scoreApi.toggleAutoScale(),o.autoScale(!1),p(),o.setScale(e),o.editor.scoreApi.resizeToFitScore(),f(),o.editor.repositionAnnotations(),o.editor.controller.document.undoHistory.openGroup("zoom"),o.markDocumentToSave()}})},Noteflight.ScoreHeaderPaletteLeft=function(e){var t=this;t.customControlTypes=Noteflight.CustomScoreControls,Noteflight.HeaderPalette.call(t,e),t.entering=ko.observable(!1),t.exiting=ko.observable(!1),e.mode.subscribe(function(o){var r={edit:Noteflight.EditHeaderPaletteLeftConfig,view:Noteflight.ViewHeaderPaletteLeftConfig,play:Noteflight.PlayHeaderPaletteLeftConfig,transcribe:Noteflight.TranscribeHeaderPaletteLeftConfig,record:Noteflight.RecordHeaderPaletteLeftConfig,perform:Noteflight.PerformHeaderPaletteLeftConfig,productPreview:s.ProductPreviewHeaderPaletteLeftConfig,productOwned:s.ProductOwnedHeaderPaletteLeftConfig};Noteflight.HideCurrentTip(),t.controller(e.currentPalette()),t.init(r[o])})},Noteflight.ScoreHeaderPaletteRight=function(e){var t=this;t.customControlTypes=Noteflight.CustomScoreControls,Noteflight.HeaderPalette.call(t,e),e.mode.subscribe(function(o){var r={edit:Noteflight.EditHeaderPaletteRightConfig,view:Noteflight.ViewHeaderPaletteRightConfig,play:Noteflight.PlayHeaderPaletteRightConfig,transcribe:Noteflight.TranscribeHeaderPaletteRightConfig,record:Noteflight.RecordHeaderPaletteRightConfig,perform:Noteflight.PerformHeaderPaletteRightConfig,productPreview:s.ProductPreviewHeaderPaletteRightConfig,productOwned:s.ProductOwnedHeaderPaletteRightConfig};t.controller(e.currentPalette()),t.init(r[o])})},Noteflight.ScorePalette=function(e){var t,o=this;o.parent=e,o.controller=ko.observable(e),o.template=ko.observable("score/scoreHeaderPalette"),o.selectSections=ko.computed(function(){return!Noteflight.IsPhoneLayout()||"edit"!=e.mode()&&"view"!=e.mode()?"selectMany":"selectOne"}),o.menuOpen=ko.observable(!1),o.calcMaxMenuHeight=function(){return $(".contentFullHeight").outerHeight()+"px"},o.maxMenuHeight=ko.observable(o.calcMaxMenuHeight()),window.addEventListener("resize",function(e){o.maxMenuHeight(o.calcMaxMenuHeight())}),o.showHelpPointer=ko.observable(!1),o.showTouchPoppers=ko.computed(function(){return(0,a.isTouchDevice)()&&!Noteflight.IsPhoneLayout()}),o.overSectionMenu=function(e){NF.appViewModel.overHeader(e)},o.outSectionMenu=function(e){NF.appViewModel.outHeader(e)},o.css=ko.pureComputed(function(){return e.useLargeIcons()?"large":""}),o.menuTop=ko.pureComputed(function(){return NF.appViewModel.headerFloatTopMargin()+"px"}),o.menuLeft=ko.observable("0px");var n=ko.observable(0);o.mayHaveChangedHeight=function(){n(n()+1)},ko.computed(function(){n(),setTimeout(function(){o.maxMenuHeight(o.calcMaxMenuHeight())},1e3),o.controller().editor.headerMayHaveChangedHeight()}),o.toggleMenuOpen=function(e,t){o.menuOpen(!o.menuOpen()),o.takeDownCurrentPopupSection()},o.showMenuItem=function(e,t){o.menuOpen(!0),t&&e!=o.currentPopupControl&&(o.currentPopupControl=e,o.putUpPopupSection(t,$("#section-"+t.id())),setTimeout(function(){var t=$("#popupPaletteSection #control-"+e.id());if(t.offset()){var r=$(".sectionsMenu"),n=$("#popupPaletteSection").width()+r.width(),i=t.offset().top;o.showHelpPointer(!0),$("#helpPointer").offset({left:n,top:i})}},50))},o.hideHelpPointer=function(){o.showHelpPointer(!1)},o.closeMenu=function(){o.menuOpen(!1),o.takeDownCurrentPopupSection()};var l=(f(t={},a.PHONE_VERTICAL_LAYOUT,["duration"]),f(t,a.PHONE_LAYOUT,["duration"]),f(t,a.MOBILE_LAYOUT,["score","edit","duration","pitch","tempo","measure"]),f(t,a.STANDARD_LAYOUT,["score","duration","pitch","tempo","text","measure"]),t)[(0,a.calculateLayout)()];$.each(Noteflight.EditPaletteConfig.sections,function(e,t){$.each(l,function(e,o){if(o==t.id)return t.expanded=!0,!1})}),o.userSectionCustomizations={};var c=NF.hasStorage?localStorage.getItem("_nf_customized_palette"):null;c&&(o.userSectionCustomizations=JSON.parse(c)),o.sections=ko.observableArray([]);var u={sections:{create:function(e){return new Noteflight.ScorePaletteSection(o,e.data,o.controller())}}};o.buildPalette=function(e){o.mayHaveChangedHeight();var t={edit:Noteflight.EditPaletteConfig,view:Noteflight.ViewPaletteConfig,play:Noteflight.PlayPaletteConfig,transcribe:Noteflight.TranscribePaletteConfig,record:Noteflight.RecordPaletteConfig,perform:Noteflight.PerformPaletteConfig,productOwned:s.ProductOwnedPaletteConfig}[e];if(o.userSectionCustomizations[e]){var r=o.userSectionCustomizations[e];$.each(t.sections,function(e,t){if(r[t.id]){var o=r[t.id];void 0!==o.expanded&&(t.expanded=o.expanded),void 0!==o.showAdvanced&&(t.showAdvanced=o.showAdvanced)}})}$("#sectionsWrapper").hide();for(var n=0;n<o.sections().length;n++){for(var i=0;i<o.sections()[n].controls().length;i++)o.sections()[n].controls()[i].destroy();o.sections()[n].destroy()}ko.mapping.fromJS(t,u,o),$("#sectionsWrapper").fadeIn()},e.mode.subscribe(function(t){o.controller(e.currentPalette()),o.buildPalette(t)}),$("#header").click(function(){o.takeDownCurrentPopupSection()}),$("#scoreEditorPanel").click(function(){o.takeDownCurrentPopupSection()}),o.currentPopupSection=ko.observable(null),o.currentPopupControl=null,o.popupSectionTop=ko.observable(0),o.putUpPopupSection=function(e,t){o.hideHelpPointer(),o.currentPopupSection(e),$("#popupPaletteSection").show();var r=t.offset().top-15-$("#scoreSectionsMenuPanel").offset().top,n=$(".contentFullHeight").outerHeight(),i=$("#popupPaletteSection").outerHeight();r+i>n&&(r=Math.max(0,n-i-2)),o.popupSectionTop(r+"px")},o.takeDownCurrentPopupSection=function(){o.cancelTakeDownCurrentPopup(),o.currentPopupSection(null),o.hideHelpPointer()},o.takeDownCurrentPopupSectionAndCloseSubPopups=function(){o.takeDownCurrentPopupSection(),o.closeAllSubPopups()},o.controller().editor.controller.addEventListener("editorClick",o.takeDownCurrentPopupSectionAndCloseSubPopups),o.togglePopupSectionMenu=function(e,t){o.currentPopupSection()&&o.currentPopupSection()==e?o.currentPopupSection(null):o.putUpPopupSection(e,$(t.target))};var d,p;o.takeDownAndPutUpPopupSection=function(e,t){d=null,o.cancelTakeDownCurrentPopup(),o.hideHelpPointer(),o.closeAllSubPopups(),o.putUpPopupSection(e,t)},o.closeAllSubPopups=function(){r.default.publish(i.PALETTE_CLOSE_SUB_POPUPS)};var h,m=null,g=null;o.maybePutUpPopupSection=function(e,t){g?(d=e,p=t):o.takeDownAndPutUpPopupSection(e,t)},o.maybeTakeDownCurrentPopupSection=function(){h=!0,g=o.currentPopupSection(),d=null,m=setTimeout(function(){h&&(d?o.takeDownAndPutUpPopupSection(d,p):o.takeDownCurrentPopupSection())},200)},o.cancelTakeDownCurrentPopup=function(){g=null,h=!1,clearTimeout(m)},o.sectionTabOver=function(e,t){o.maybePutUpPopupSection(e,$(t.target))},o.sectionTabOut=function(e,t){},o.popupPaletteSectionOver=function(e,t){o.cancelTakeDownCurrentPopup()},o.popupPaletteSectionOut=function(e,t){}},Noteflight.ScorePaletteSection=function(e,t,o){var r=this;r.expanded=ko.observable(!1),r.showOnMobile=ko.observable(!0),r.showAdvanced=ko.observable(!1),r.palette=e,r.customControlTypes=Noteflight.CustomScoreControls;var n={controls:{create:function(e){return new Noteflight.PaletteControl(r,e.data,o)}}};ko.mapping.fromJS(t,n,this),r.sectionId=ko.computed(function(){return"section-"+r.id()}),r.showOnMobile()||$(window).resize(function(){r.expanded((0,a.isStandardOrLargerLayout)())}),r.title=ko.pureComputed(function(){return(0,l.resource)("palette.section."+r.id())}),r.toggle=function(){if(e.takeDownCurrentPopupSection(),"selectMany"==e.selectSections())r.expanded(!r.expanded());else if("selectOne"==e.selectSections()){r.expanded(!0);for(var t=0;t<e.sections().length;t++)r!=e.sections()[t]&&e.sections()[t].expanded(!1)}e.mayHaveChangedHeight(),r.expanded()&&NF.analytics.trackEvent("editor","palette",r.id())},r.css=ko.pureComputed(function(){var e;return e=r.expanded()?"expanded":"collapsed",r.showAdvanced()&&(e+=" maximized"),e}),r.toggleShowAdvanced=function(){r.showAdvanced(!r.showAdvanced()),e.mayHaveChangedHeight(),r.showAdvanced()&&NF.analytics.trackEvent("editor","paletteAdvanced",r.id())},r.showMinMax=ko.pureComputed(function(){for(var e=0;e<r.controls().length;e++)if(r.controls()[e].advanced()&&r.controls()[e].visible())return!0;return!1}),r.togglePopupPaletteSection=function(t,o){e.togglePopupSectionMenu(t,o)},r.currentPopupSection=ko.pureComputed(function(){return e.currentPopupSection()==r}),r.savePaletteInLocalStorage=function(){if(NF.hasStorage){var e=JSON.stringify(r.palette.userSectionCustomizations);localStorage.setItem("_nf_customized_palette",e)}};var i=function(){return e.parent.mode()};function s(e,t){r.palette.userSectionCustomizations[e]||(r.palette.userSectionCustomizations[e]={}),r.palette.userSectionCustomizations[e][t]||(r.palette.userSectionCustomizations[e][t]={})}r.expanded.subscribe(function(e){s(i(),r.id()),r.palette.userSectionCustomizations[i()][r.id()].expanded=e,r.savePaletteInLocalStorage()}),r.showAdvanced.subscribe(function(e){s(i(),r.id()),r.palette.userSectionCustomizations[i()][r.id()].showAdvanced=e,r.savePaletteInLocalStorage()}),r.loadDescendantIcons=function(e){return r.currentPopupSection()||r.expanded()&&(r.showAdvanced()||!e.advanced())},r.destroy=function(){r.currentPopupSection.dispose(),r.showMinMax.dispose(),r.selected&&r.selected.dispose(),r.title&&r.title.dispose(),r.shortcut&&r.shortcut.dispose(),r.showZoomToFit&&r.showZoomToFit.dispose(),r.currentZoom&&r.currentZoom.dispose(),r.css&&r.css.dispose()}},Noteflight.PalettePercentControl=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.currentValue=ko.computed({read:function(){if(e.valueFunction)return e.controller()[e.valueFunction()]()},write:function(t){e.valueFunction&&e.controller()[e.valueFunction()](t)}}),e.currentPercent=ko.pureComputed(function(){return e.currentValue()+"%"}),Noteflight.PalettePopupControl.call(e,"percentarama","popupSliderControl","palette/popupSliderControl")},Noteflight.ScorePaletteZoomControl=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),Noteflight.PalettePopupControl.call(e,"zoomerama","popupZoomer","palette/popupZoomer"),e.currentZoom=ko.pureComputed(function(){return e.controller().zoomFactor()+"%"}),e.showZoomToFit=ko.pureComputed(function(){return e.controller().editor.scoreState.isPaginatedMode()}),e.css=ko.pureComputed(function(){return e.baseCSS()})},Noteflight.ScorePaletteViewControl=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),Noteflight.PalettePopupControl.call(e,"viewMenu","popupMenu","palette/popupMenu",!0),e.controls=ko.observableArray([]),e.customControlTypes=Noteflight.CustomScoreControls;var t={controls:{create:function(t){return new Noteflight.PaletteControl(e,t.data,e.controller())}}};ko.mapping.fromJS(Noteflight.ScoreViewMenu,t,this);var o={paginated:"viewPaginated",strip:"viewStrip",flow:"viewFlow",perform:"viewPerform"},r={paginated:(0,l.resource)("palette.viewPaginated"),strip:(0,l.resource)("palette.viewStrip"),flow:(0,l.resource)("palette.viewFlow"),perform:(0,l.resource)("palette.viewPerform")};e.css=ko.pureComputed(function(){return e.baseCSS()+"paletteButton "+o[e.controller().currentView()]}),e.viewLabel=ko.pureComputed(function(){return r[e.controller().currentView()]})},Noteflight.ScorePaletteTempoControl=function(){var e=this;function t(){e.controller().applyTempo(e.tempoValue(),e.tempoDots(),e.tempoBPM())}Noteflight.PaletteControlWithTitle.call(e),Noteflight.PalettePopupControl.call(e,"notePicker","tempoNotePicker","palette/tempoNotePicker"),e.tempoValue=ko.observable(),e.tempoDots=ko.observable(),e.tempoBPM=ko.observable(),e.bpm=ko.computed({read:function(){return null===e.tempoBPM()||void 0===e.tempoBPM()?"":e.tempoBPM().toString()},write:function(o){o!=e.bpm()&&(e.tempoBPM(o),t())}}).extend({throttle:800}),e.css=ko.pureComputed(function(){return"paletteButton note"+e.tempoValue()}),e.selectTempoValue=function(o){return function(){e.tempoValue(o),t()}},e.toggleDot=function(){e.tempoDots(1==e.tempoDots()?0:1),t()},e.tempoValue=e.controller()?e.controller().tempoValue:ko.observable(),e.tempoDots=e.controller()?e.controller().tempoDots:ko.observable(),e.tempoBPM=e.controller()?e.controller().tempoBPM:ko.observable()},Noteflight.ScorePaletteDurationButton=function(){var e=this;e.allowNone=ko.observable(!1),Noteflight.PaletteRadioButton.call(this),Noteflight.PaletteControlWithShortcut.call(e),e.title=ko.pureComputed(function(){return e.controller().restSelected()?"palette.rest."+e.id():"palette."+e.id()}),e.controlId=ko.computed(function(){return"control-"+e.id()}),e.css=ko.pureComputed(function(){var t="paletteButton ";return e.controller().restSelected()?t+="rest"+e.value():t+="note"+e.value(),e.selected()&&(t+=" selected"),e.advanced()&&(t+=" advanced"),t})},Noteflight.CreateAnimatedCounterVM=function(){var e=this,t=e.controller().editor.controller.performer;e.recordingText=ko.observable(),e.countInMeasures=ko.observable(t.countInMeasures),e.countInMeasures.subscribe(function(e){var o=Math.abs(parseInt(e,10));isNaN(o)&&(o=0),t.countInMeasures=o}),e.animatedCounter=new Noteflight.AnimatedCounter(t),e.controller().animationStarted.subscribe(function(o){if(o){var r=e.controller().editor.controller,n=r.score.systemStaff.getMeasureAt(r.pausePosition.measureIndex),i=t.temporalMap.scorePositionToTime(n.duration);e.animatedCounter.startCountDown(t.countInMeasures,i),e.controller().onAnimationStart&&e.controller().onAnimationStart(t.countInMeasures*i),e.controller().onAnimationEnd&&setTimeout(e.controller().onAnimationEnd,t.countInMeasures*i*1e3)}})},Noteflight.TranscriberControl=function(){var e=this;NF.CreateAnimatedCounterVM.call(e),e.recordingText=ko.pureComputed(function(){return e.controller().selectedPart()?(0,l.resource)("content.transcribingPart",e.controller().selectedPart().nameToShow):""})},Noteflight.RecordingControl=function(){var e=this;NF.CreateAnimatedCounterVM.call(e),e.recordingText=ko.pureComputed(function(){return e.controller().selectedPart()?(0,l.resource)("content.recordingPart",e.controller().selectedPart().nameToShow):""})},Noteflight.SelectControl=function(){var e=this;Noteflight.PaletteControlWithTitle.call(e),e.options=ko.pureComputed(function(){if(e.optionsFunction)return e.controller[e.optionsFunction()]()}),e.currentValue=ko.computed({read:function(){if(e.valueFunction)return e.controller[e.valueFunction()]()},write:function(t){e.valueFunction&&e.controller[e.valueFunction()](t)}})},Noteflight.CustomScoreControls={durationButton:Noteflight.ScorePaletteDurationButton,tempoControl:Noteflight.ScorePaletteTempoControl,zoomControl:Noteflight.ScorePaletteZoomControl,viewControl:Noteflight.ScorePaletteViewControl,percentControl:Noteflight.PalettePercentControl,transcriberControl:Noteflight.TranscriberControl,recordingControl:Noteflight.RecordingControl,selectControl:Noteflight.SelectControl,pageTurner:Noteflight.PageTurner,helpControl:n.default}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(312)),n=o(314),i=o(313);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,c(t).call(this))).forceShowSearchBar(!0),o.scoreEditor=e,o.fullWidthInput(!1),o.helpItems={},o.editorItems=[],o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"search",value:function(){var e=this.searchText();if(this.initializeSections(),0===e.length)return this.scoreEditor.customHeaderPalette().hideHelpPointer(),void this.scoreEditor.customHeaderPalette().closeMenu();for(var t=0;t<this.editorItems.length;t++)if(this.editorItems[t].matches(e)){this.helpItems["editor-"+this.editorItems[t].item.id()]||(this.helpItems["editor-"+this.editorItems[t].item.id()]=new n.HelpItemMenu(this.editorItems[t].item,this.editorItems[t].menuSection,this.scoreEditor,this)),this.helpItems["userGuide-"+this.editorItems[t].item.id()]||(this.helpItems["userGuide-"+this.editorItems[t].item.id()]=new n.HelpItemUserGuide(this.editorItems[t].item,this.editorItems[t].menuSection,this.scoreEditor,this));var o=this.helpItems["editor-"+this.editorItems[t].item.id()],r=this.helpItems["userGuide-"+this.editorItems[t].item.id()];if(this.sections()[0].addElement(o),this.sections()[1].addElement(r),5==this.sections()[0].totalElements)break}var i=new n.HelpItem;return this.sections()[2].addElement(new n.HelpItemHelpCenter(i)),this.unselectAllElements(),this.selectedElement(0),this.selectElement(this.selectedElement()),!0}},{key:"searchWithNoSelection",value:function(){}},{key:"parseMenuItems",value:function(){var e=this;this.editorItems=[];var t=this.scoreEditor.customHeaderPalette().sections(),o=[];$.each(t,function(t,r){for(var i=r.controls(),a=0;a<i.length;a++)i[a].id&&i[a].id()&&!o.includes(i[a].id())&&(e.editorItems.push(new n.HelpItem(i[a],r)),o.push(i[a].id()))})}},{key:"initializeSections",value:function(){this.clearSections(),this.sections.push(new i.ScoreEditorSection("editor")),this.sections.push(new i.ScoreEditorSection("guide")),this.sections.push(new i.ScoreEditorSection("helpCenter"))}},{key:"initialize",value:function(){this.parseMenuItems(),this.searchText().length>0&&this.search(),this.active(!0)}}]),t}();t.default=d},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.Filter=function(e,t){var o=this;o.editor=e,o.title=t,n.DialogViewModel.call(this),o.filter=function(e){o.editor.controller.document.undoHistory.openGroup((0,r.resource)("editorDialog.filterSelection")),o.editor.controller.filterSelection(e),NF.analytics.trackEvent("editor",e,"filter")}}},function(e,t,o){"use strict";var r=o(3);Noteflight.ForceSilentPlayback=function(e,t){var o=this;r.DialogViewModel.call(this),o.editor=e,o.callback=t,o.initializePlayback=function(){o.editor.startSound(),(0,r.hideCurrentDialog)(o)},o.playScore=function(){o.editor.startSound(function(){(0,r.hideCurrentDialog)(o),o.callback()})}}},function(e,t,o){"use strict";var r=o(3),n=o(15);Noteflight.GraceNotePanel=function(e,t){var o=this;function i(){var e=(o.graceSliderValue()-o.graceSliderMin)*o.beatFractionRange/o.graceSliderRange+o.beatFractionMin,t=(0,n.roundNumber)(e,3);o.graceNoteBeatFraction(t),o.editor.controller.document.undoHistory.openGroup("Change Grace Notes")}function a(){var e=(o.graceSliderValue()-o.graceSliderMin)*o.graceTimeRange/o.graceSliderRange+o.graceTimeMin,t=(0,n.roundNumber)(e,3);o.graceNoteTime(t),o.editor.controller.document.undoHistory.openGroup("Change Grace Notes")}o.editor=e,o.title=t,r.DialogViewModel.call(this),o.beatFractionMin=.05,o.beatFractionMax=.125,o.beatFractionRange=o.beatFractionMax-o.beatFractionMin,o.graceTimeMin=.03,o.graceTimeMax=.09,o.graceTimeRange=o.graceTimeMax-o.graceTimeMin,o.graceSliderMin=1,o.graceSliderMax=10,o.graceSliderStep=1,o.graceSliderRange=o.graceSliderMax-o.graceSliderMin,o.graceSliderValue=5,o.isLinkedToTempo=ko.observable(),o.isLinkedToTempo.subscribe(function(e){e&&0===o.graceNoteBeatFraction()?(i(),o.graceNoteTime(0)):e||0!==o.graceNoteTime()||(a(),o.graceNoteBeatFraction(0))}),o.graceSliderValue=ko.observable(),o.graceSliderValue.subscribe(function(e){o.isLinkedToTempo()?i():a()}),o.graceNoteBeatFraction=o.editor.scoreState.graceNoteBeatFraction,o.graceNoteBeatFraction.subscribe(function(e){o.editor.controller.document.score.performanceMetrics.graceNoteBeatFraction=e}),o.graceNoteTime=o.editor.scoreState.graceNoteTime,o.graceNoteTime.subscribe(function(e){o.editor.controller.document.score.performanceMetrics.graceNoteTime=e}),o.graceNoteBeatFraction()>0?(o.graceNoteTime(0),o.isLinkedToTempo(!0),function(){var e=(o.graceNoteBeatFraction()-o.beatFractionMin)*o.graceSliderRange/o.beatFractionRange+o.graceSliderMin,t=Math.round(e);o.graceSliderValue(t),o.editor.controller.document.undoHistory.openGroup("Change Grace Notes")}()):(o.graceNoteBeatFraction(0),o.isLinkedToTempo(!1),function(){var e=(o.graceNoteTime()-o.graceTimeMin)*o.graceSliderRange/o.graceTimeRange+o.graceSliderMin,t=Math.round(e);o.graceSliderValue(t),o.editor.controller.document.undoHistory.openGroup("Change Grace Notes")}())}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.KeySignatureDialog=function(e,t,o){var i=this,a=$$nf.classes.com.noteflight.notation.model.KeySignature;n.DialogViewModel.call(this),i.title=t,i.fifths=ko.observable(o.fifths),i.mode=ko.observable(o.mode),i.atonal=ko.observable(o.atonal),i.keyChoices=[{label:(0,r.resource)("mode.unknown"),data:null},{label:(0,r.resource)("mode.major"),data:"major"},{label:(0,r.resource)("mode.minor"),data:"minor"},{label:(0,r.resource)("mode.ionian"),data:"ionian"},{label:(0,r.resource)("mode.dorian"),data:"dorian"},{label:(0,r.resource)("mode.phrygian"),data:"phrygian"},{label:(0,r.resource)("mode.lydian"),data:"lydian"},{label:(0,r.resource)("mode.mixolydian"),data:"mixolydian"},{label:(0,r.resource)("mode.aeolian"),data:"aeolian"},{label:(0,r.resource)("mode.locrian"),data:"locrian"}],i.getModeKey=function(e){if(!e)return"major";for(var t=0;t<i.keyChoices.length;t++)if(i.keyChoices[t].data==e)return e;return"major"},i.keyName=function(e){var t=new a(e,0,!1,i.getModeKey(i.mode())).tonic;return t=t.replace(/#$/,".sharp").replace(/b$/,".flat"),(0,r.resource)("note."+t)},i.applyFifths=function(e){return function(){i.atonal(!1),i.fifths(e)}},i.applyAtonal=function(){i.atonal(!0),i.fifths(0)},i.applyKeySignature=function(){var t=new a(i.fifths(),0,i.atonal(),i.mode());e.controller.document.undoHistory.openGroup("Change Key Signature"),e.controller.changeKeySignature(t),(0,n.hideCurrentDialog)()},i.doOk=function(){i.applyKeySignature()}}},function(e,t,o){"use strict";Noteflight.MidiRecording=function(e,t){var o=this;o.editor=e,o.headerMenu=t,o.startRecording=function(e,t){o.editor.controller.document.undoHistory.openGroup("Midi Recording"),o.editor.midiInputManager.startStopMidiRecording(!0),o.editor.controller.startMidiRecording(e,t.staves)},o.stopRecording=function(e){o.editor.midiInputManager.startStopMidiRecording(!1),o.editor.controller.stopMidiRecording(e),o.createGoogleAnalyticsEvent()},o.handleNoteOn=function(e){o.headerMenu.pianoRoll.handleNoteOn(e.message.pitch)},o.handleNoteOff=function(e){o.headerMenu.pianoRoll.handleNoteOff(e.message.pitch)},o.initializeEventListeners=function(){o.editor.midiInputManager.addEventListener("noteOn",o.handleNoteOn),o.editor.midiInputManager.addEventListener("noteOff",o.handleNoteOff)},o.createGoogleAnalyticsEvent=function(){if(0!==o.editor.controller.transcriber.startTime){var e=performance.now()-o.editor.controller.transcriber.startTime;NF.analytics.trackEvent("editor","transcription","time",Math.round(e))}}}},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(317)),n=o(0),i=o(3);Noteflight.Mixer=function(e){var t=this,o=e.controller.performer.metronome;function a(){t.mixerItems([]),t.parts([]),t.mediaSync(null),t.masterGain(e.controller.masterGain),t.reverbLevel(e.controller.reverbLevel),t.reverbType(e.controller.reverbType),o.nameToShow=(0,n.resource)("content.metronome");var i=new Noteflight.MixerItem(t.editor,o,t,0);if(i.solo(!1),i.separation(!0),t.mixerItems.push(i),t.controller.score.synchronizedTrack){var a={nameToShow:(0,n.resource)("content.mediaType."+t.controller.score.synchronizedTrack.type),get muted(){return t.controller.synchronizedTrackMuted},set muted(e){t.controller.synchronizedTrackMuted=e},get gain(){return t.controller.synchronizedTrackGain},set gain(e){t.controller.synchronizedTrackGain=e}},s=new Noteflight.MixerItem(t.editor,a,t,1);s.showPan(!1),s.separation(!0),t.mixerItems.push(s)}for(var l=e.controller.document.score.parts,c=0;c<l.length;c++){var u=l[c];t.mixerItems.push(new Noteflight.MixerItem(t.editor,u,t,t.mixerItems().length)),t.parts.push(r.default.createPartTrackItem(t,t.editor,u))}}t.editor=e,t.controller=e.controller,i.DialogViewModel.call(this),t.mixerPage=ko.observable("instruments"),t.mixerItems=ko.observableArray([]),t.masterGain=ko.observable(),t.masterGainAction=ko.computed(t.masterGain).extend({throttle:250}),t.masterGainAction.subscribe(function(){t.masterGainEvent()}),t.reverbLevel=ko.observable(),t.reverbLevelAction=ko.computed(t.reverbLevel).extend({throttle:250}),t.reverbLevelAction.subscribe(function(){t.reverbLevelEvent()}),t.reverbType=ko.observable(),t.reverbType.subscribe(function(){t.reverbTypeEvent()}),t.metronomeMuted=ko.observable().extend({bindProperty:{source:o,property:"muted"}}),t.singleInstrumentSelectedIndex=ko.observable(),ko.computed(function(){for(var e=0,o=0;o<t.mixerItems().length;o++)t.mixerItems()[o].muted()||(e++,t.singleInstrumentSelectedIndex(t.mixerItems()[o].index()));1!=e&&t.singleInstrumentSelectedIndex(null)}),t.parts=ko.observableArray([]),t.mediaSync=ko.observable(),t.reverbTypes=ko.observableArray([{resource:"content.reverbTypeNone",value:null},{resource:"content.reverbTypeSmall",value:"Small"},{resource:"content.reverbTypeMedium",value:"Medium"},{resource:"content.reverbTypeLarge",value:"Large"}]),t.changePage=function(e){t.mixerPage(e)},t.masterGainEvent=function(){var e=parseFloat(t.masterGain(),10);t.controller.masterGain=e},t.reverbLevelEvent=function(){var e=parseFloat(t.reverbLevel(),10);t.controller.reverbLevel=e},t.reverbTypeEvent=function(){var e=t.reverbType();t.controller.reverbType=e},t.selectReverbType=function(e){t.reverbType(e)},t.soloAction=function(e){var o=t.mixerItems().length;if(o>2){for(var r=!0,n=0;n<o;n++)if(t.mixerItems()[n].item!=e&&!t.mixerItems()[n].muted()){r=!1;break}for(n=0;n<o;n++)t.mixerItems()[n].muted(t.mixerItems()[n].item!=e?!r:r)}},t.playAll=function(){if(!e.scoreState.isPlaying())for(var o=1;o<t.mixerItems().length;o++)t.mixerItems()[o].muted(!1)},ko.observable().extend({bindProperty:{source:e.controller.score,property:"synchronizedTrack"}}).subscribe(function(){a()}),t.metronomeMuted.subscribe(function(){a()}),e.controller.document.addEventListener("mixerSettingsChange",a),a()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(219));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}o(1238);var c="noteflightType",u=function(e){function t(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=a(this,s(t).call(this,e))).partItem=e,o.type(c),o.username("Noteflight"),o.avatarUri(NF.asset("images/noteflight_avatar.png")),o.showInfoButton(!1),o.showDeleteButton(!1),o.showEditButton(!1),o.isInfoShown(!1),o.showToggleWaveform(!1),o.muted=ko.observable().extend({bindProperty:{source:o.partItem.part,property:"noteflightTrackMuted"}}),o.isWaveformShown(!1),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),function(e,t,o){t&&i(e.prototype,t),o&&i(e,o)}(t,[{key:"toggleTrack",value:function(){return this.partItem.selectNoteflightTrack(),!0}}]),t}();t.default=u},function(e,t,o){e.exports=o.p+"images/noteflight_avatar-46b131bec2516e7bc5d2f760dda7e353.png"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o(219)),n=s(o(315)),i=o(0),a=o(3);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f="recordingType",h=function(e){function t(e,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=u(this,d(t).call(this,e))).partItem=e,r.track=o,r.type(f),r.username(r.track.user.username),r.avatarUri(r.track.user.avatarUri),r.showInfoButton(!0),r.showDeleteButton(NF.session.current_user()&&r.track.user.userId==NF.session.current_user().external_id()||r.partItem.editor.scorePermissions.canEdit()),r.showEditButton(!1),r.isInfoShown(!1),r.showToggleWaveform(!0),r.isWaveformShown=ko.observable().extend({bindProperty:{source:r.partItem.part,property:"showAudioWaveform"}}),r.enabled=ko.observable().extend({bindProperty:{source:r.track,property:"playbackEnabled"}}),r.initialize(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.default),function(e,t,o){t&&c(e.prototype,t),o&&c(e,o)}(t,[{key:"initialize",value:function(){this.initEnabledVariable();for(var e=this.track.sortedAudioClips,t=0;t<e.length;t++)this.clips.push(new n.default(e[t]))}},{key:"initEnabledVariable",value:function(){var e=this;this.muted(!this.enabled()),this.muted.subscribe(function(t){e.enabled(!t)})}},{key:"toggleShowTrackInfo",value:function(){this.isInfoShown(!this.isInfoShown())}},{key:"deleteTrack",value:function(){var e=this;(0,a.okCancel)((0,i.resource)("content.confirmDeleteTrack"),function(){e.partItem.deleteTrack(e)})}},{key:"toggleTrack",value:function(){return this.partItem.selectRecordingTrack(this),!0}},{key:"toggleWaveform",value:function(){this.partItem.toggleWaveform()}}]),t}();t.default=h},function(e,t,o){"use strict";Noteflight.MixerItem=function(e,t,o,r){var n=this;n.mixer=o,n.editor=e,n.item=t,n.index=ko.observable(r.toString()),n.name=ko.observable(n.item.nameToShow),n.showPan=ko.observable(!0),n.separation=ko.observable(!1);[{property:"gain",throttle:!0},{property:"pan",throttle:!0},{property:"muted",throttle:!1}].forEach(function(e){n[e.property]=ko.observable(n.item[e.property]),e.throttle?(n[e.property+"Action"]=ko.computed(n[e.property]).extend({throttle:250}),n[e.property+"Action"].subscribe(function(){n[e.property+"Event"]()})):n[e.property].subscribe(function(){n[e.property+"Event"]()}),n[e.property+"Event"]=function(){n.editor.controller.document.undoHistory.openGroup(e.property);var t=n[e.property]();e.throttle&&(t=parseFloat(t,10)),n.item[e.property]=t}}),n.areAllOthersMuted=ko.computed(function(){for(var e=0;e<n.mixer.mixerItems().length;e++)if(n.mixer.mixerItems()[e].item!=n.item&&!n.mixer.mixerItems()[e].muted())return!1;return!0}),n.solo=function(){return n.mixer.soloAction(n.item),!0},n.toggleMutePart=function(){if(n.muted())n.muted(!1);else{if(n.areAllOthersMuted())return!1;n.muted(!0)}return!0},n.isPlaying=e.scoreState.isPlaying}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.NewScoreDialog=function(e,t,o,i,a,s){var l=this,c=($$nf.classes.flash.utils.ByteArray,$$nf.classes.com.noteflight.notation.document.ScoreDocument,$$nf.classes.com.noteflight.notation.fileformat.ScoreFormatRecognizer),u=$$nf.classes.com.noteflight.notation.model.StaffMetrics,d=$$nf.classes.com.noteflight.notation.model.ValueNotation;$$nf.classes.XML;l.editor=e,l.files=ko.observableArray(),l.filesLoaded=ko.observable(0),l.title=ko.computed(function(){return l.files().length<=1?(0,r.resource)("editor.newScore"):(0,r.resource)("editor.newScores")}),l.templateList=ko.observableArray(),l.template=ko.observable(),l.startOption=ko.observable("template"),l.allowImport=ko.observable(!Noteflight.iOS),l.importFile=ko.observable(),l.importState=ko.observable(),l.fileData=ko.observable(),l.errorMessage=ko.observable(),l.importStatus=ko.observable(),l.allowTemplateChoice=ko.observable(a),l.loadingScore=ko.observable(!1),l.loadMusicXmlScoreOptions=null,l.loadMidiScoreOptions=null,l.remainingFilesToLoad=ko.computed(function(){return l.files()&&l.filesLoaded()<l.files().length}),l.remainingFilesToLoad.subscribe(function(e){l.editor.remainingMultipleFilesToLoad(e)}),l.successfullyImportedFiles=ko.observable(0),l.fatalImportErrors=ko.observableArray(),l.nonFatalImportErrors=ko.observableArray(),l.hasFatalImportErrors=ko.computed(function(){return l.fatalImportErrors()&&l.fatalImportErrors().length>0}),l.reportMultipleFatalErrors=ko.computed(function(){return l.remainingFilesToLoad()&&l.hasFatalImportErrors()&&l.successfullyImportedFiles()>0}),l.showingNonFatalErrors=ko.observable(),l.musicXmlOptionOriginalTextPositions=ko.observable(!0),l.musicXmlOptionOriginalSystemBreaks=ko.observable(!1),l.musicXmlOptionOriginalStemDirections=ko.observable(!1),l.musicXmlOptionOriginalSlurDirections=ko.observable(!1),l.musicXmlOptionCombineVoices=ko.observable(!1),l.musicXmlOptionOptimizePVG=ko.observable(!1),l.musicXmlOptionImportTextBlock=ko.observable(!1),l.musicXmlOptionImportTextBlockNumbers=ko.observable(!1),l.developerOptions=[{name:"1",value:u.STYLE_PVG},{name:"2 S",value:u.STYLE_CCLI_SINGLE},{name:"2 M",value:u.STYLE_CCLI_MULTI}],l.hlcStyles=ko.observableArray([{name:"Accordion",value:u.STYLE_HLC_ACCORDION},{name:"Big Note",value:u.STYLE_HLC_BIG_NOTE},{name:"Choral",value:u.STYLE_HLC_CHORAL},{name:"Easy Piano",value:u.STYLE_HLC_EASY_PIANO},{name:"Educational Piano",value:u.STYLE_HLC_EDUCATIONAL_PIANO},{name:"Fakebook",value:u.STYLE_HLC_FAKEBOOK},{name:"Guitar",value:u.STYLE_HLC_GUITAR},{name:"Instrumental Solo",value:u.STYLE_HLC_INSTRUMENTAL_SOLO},{name:"Piano Solo",value:u.STYLE_HLC_PIANO_SOLO},{name:"PVG",value:u.STYLE_HLC_PVG},{name:"Ukulele",value:u.STYLE_HLC_UKULELE},{name:"MS - PVG",value:u.STYLE_MS_PVG},{name:"MS - Easy Piano",value:u.STYLE_MS_EASY_PIANO},{name:"Jazz",value:u.STYLE_CL_JAZZ}]),l.hlcSelectedStyle=ko.observable(),l.importStyle=ko.observable(),l.developerOptionsAvailable=ko.observable(l.editor.scorePermissions.areDeveloperFeaturesEnabled()),l.midiOptionParts=ko.observable("tracks");var p=[{name:(0,r.resource)("content.auto"),value:-1},{name:(0,r.resource)("note.thirtySecond"),value:d.THIRTY_SECOND},{name:(0,r.resource)("note.sixteenth"),value:d.SIXTEENTH},{name:(0,r.resource)("note.eighth"),value:d.EIGHTH},{name:(0,r.resource)("note.quarter"),value:d.QUARTER},{name:(0,r.resource)("note.half"),value:d.HALF}];function f(){l.hasNextFileToLoad()&&l.loadRemainingFiles()}l.quantizationOptionsList=ko.observableArray(p),l.quantization=ko.observable(p[0].value),n.DialogViewModel.call(this),l.initialTemplateIndex=ko.observable(0),l.scrollToIndex=function(){var e=$("#templateListElement").height()*l.initialTemplateIndex();e+1>=$("#scroller").height()&&$("#scroller").scrollTop(e)},l.okEnabled=ko.computed(function(){if(l.loadingScore())return!1;if(l.showingNonFatalErrors())return!0;switch(l.startOption()){case"template":return!a||l.template();case"import":return l.importFile()&&("musicXmlOptions"==l.importState()||"midiOptions"==l.importState())}}),l.importOptionsVisible=ko.computed(function(){return"import"==l.startOption()&&l.importFile()}),l.loadTemplates=function(){$.ajax({url:NF.asset("instruments/templates.xml"),dataType:"xml"}).done(function(e){l.parseTemplates(e)}).fail(function(){alert((0,r.resource)("errors.loadTemplateList"))})},l.parseTemplates=function(e){$(e).find("template").each(function(e,t){var o=new function(e){var t=NF.getStringForResourcesKey(e.find("title").text()),o="template.title."+t,n="template.description."+t;this.title=ko.observable((0,r.resource)(o)),this.description=ko.observable(e.find("description").text().length>0?(0,r.resource)(n):""),this.uri=ko.observable(e.find("uri").text()),this.selected=ko.observable(!1)}($(t));l.templateList.push(o)});for(var t=window.noteflightGetUserPreferences().defaultNewScoreTemplateName,o=0,n=0;n<l.templateList().length;n++)l.templateList()[n].title()==t&&(o=n);l.templateListSelectionChanged(l.templateList()[o]),l.initialTemplateIndex(o)},l.templateListSelectionChanged=function(e){l.startOption("template"),l.template()&&l.template().selected(!1),e.selected(!0),l.template(e)},l.clearFatalErrors=function(){l.reportMultipleFatalErrors()||l.fatalImportErrors([])},l.ok=function(){if(l.showingNonFatalErrors())(0,n.hideCurrentDialog)();else switch(l.startOption()){case"template":if((0,n.hideCurrentDialog)(),l.allowTemplateChoice()){var e=window.noteflightGetUserPreferences();e.defaultNewScoreTemplateName=l.template().title(),window.noteflightSetUserPreferences(e),o(NF.asset("instruments/".concat(l.template().uri())))}else o(s);break;case"import":switch(l.importState()){case"status":break;case"musicXmlOptions":l.loadMusicXml();break;case"midiOptions":l.loadMidi()}}},l.processFile=function(e){l.importFile(e),l.importState("status"),l.importStatus("Opening file..."),l.startOption("import"),l.fileReader=new FileReader,l.fileReader.onprogress=l.handleReadFileProgress,l.fileReader.onload=l.handleReadFileComplete,l.fileReader.readAsArrayBuffer(l.importFile())},l.handleFileSelect=function(e,t){l.files(t.target.files),l.fatalImportErrors([]),l.editor.scoreEditor.disableNavigation(l.files().length>1),l.processFile(l.files()[0])},l.handleReadFileProgress=function(e){e.target==l.fileReader&&(l.importState("status"),l.importStatus("Loading file: "+e.loaded+" / "+e.total+" bytes"))},l.handleReadFileComplete=function(e){if(e.target==l.fileReader){var t=l.fileReader.result,o=new Uint8Array(t,0,e.total);if(254===o[0]&&255===o[1]&&0===o[2]&&60===o[3]||255===o[0]&&254===o[1]&&60===o[2]&&0===o[3]||239===o[0]&&187===o[1]&&191===o[2]&&60===o[3])l.fileReader2=new FileReader,l.fileReader2.onprogress=l.handleReadFileProgress,l.fileReader2.onload=l.handleReadFileComplete2,l.fileReader2.readAsText(new Blob([o]));else if(l.bytesStartWithString(o,"<?xml")||l.bytesStartWithString(o,"<noteflightScore")||l.bytesStartWithString(o,"<noteflightCompressed")||l.bytesStartWithString(o,"<!DOCTYPE")){var r=l.getEncodingFromXmlHeader(o);l.fileReader2=new FileReader,l.fileReader2.onprogress=l.handleReadFileProgress,l.fileReader2.onload=l.handleReadFileComplete2,l.fileReader2.readAsText(new Blob([o]),r)}else l.fileData(o),l.readFileComplete()}},l.bytesStartWithString=function(e,t){for(var o=0;o<t.length;o++)if(o>=e.length||e[o]!=t.charCodeAt(o))return!1;return!0},l.getEncodingFromXmlHeader=function(e){if(e.length<5||60!=e[0]||63!=e[1]||120!=e[2]||109!=e[3]||108!=e[4])return null;for(var t,o,r=5,n=0;r<e.length;){e[r];var i=String.fromCharCode(e[r]),a=" "==i||"\t"==i||"\n"==i||"\r"==i;switch(n){case 0:if(a)n=0;else{if(!(i>="a"&&i<="z"))return null;t=i,n=1}break;case 1:if(a)n=2;else if("="==i)n=3;else{if(!(i>="a"&&i<="z"))return null;t+=i,n=1}break;case 2:if(a)n=2;else{if("="!=i)return null;n=3}break;case 3:if(a)n=3;else if("'"==i)o="",n=4;else{if('"'!=i)return null;o="",n=5}break;case 4:if("'"==i){if(n=0,"encoding"==t)return o}else o+=i;break;case 5:if('"'==i){if(n=0,"encoding"==t)return o}else o+=i,n=5}r++}return null},l.handleReadFileComplete2=function(e){if(e.target==l.fileReader2){var t=l.fileReader2.result;l.fileData(t),l.readFileComplete()}},l.hasNextFileToLoad=function(){return l.filesLoaded(l.filesLoaded()+1),l.remainingFilesToLoad()},l.loadRemainingFiles=function(){l.processFile(l.files()[l.filesLoaded()])},l.readFileComplete=function(){switch(l.importState(""),l.editor.element.jsnoteflight("detectScoreType",l.fileData())){case c.NOTEFLIGHT_XML_FORMAT:case c.NF_COMPRESSED_XML_FORMAT:l.loadNoteflightXmlScore(l.fileData());break;case c.MUSICXML_FORMAT:l.loadMusicXmlScoreOptions?(l.importState("loadingMultipleFiles"),l.loadMusicXmlScore(l.loadMusicXmlScoreOptions)):l.importState("musicXmlOptions");break;case c.MIDI_FORMAT:l.loadMidiScoreOptions?(l.importState("loadingMultipleFiles"),l.loadMidiScore(l.loadMidiScoreOptions)):l.importState("midiOptions");break;case c.UNSUPPORTED_MIDI_FORMAT:l.fatalImportErrors.push((0,r.resource)("errors.unrecognizedMidiFormat",l.importFile().name)),l.remainingFilesToLoad()&&f();break;case c.UNRECOGNIZED_FORMAT:l.fatalImportErrors.push((0,r.resource)("errors.unrecognizedFileFormat",l.importFile().name)),l.remainingFilesToLoad()&&f()}},l.loadMusicXml=function(){var e={useSystemBreaks:l.musicXmlOptionOriginalSystemBreaks(),useTextPositions:l.musicXmlOptionOriginalTextPositions(),optimizeForPVG:l.musicXmlOptionOptimizePVG(),importBlock:l.musicXmlOptionImportTextBlock(),importBlockNumbers:l.musicXmlOptionImportTextBlockNumbers(),useStemDirections:l.musicXmlOptionOriginalStemDirections(),useSlurDirections:l.musicXmlOptionOriginalSlurDirections(),combineSameStemVoices:l.musicXmlOptionCombineVoices()};l.loadMusicXmlScore(e)},l.loadMusicXmlWithDeveloperOption=function(e){var t=e.value,o={};switch(t){case u.STYLE_CCLI:case u.STYLE_CCLI_MULTI:case u.STYLE_CCLI_SINGLE:o.importStyle=t,o.optimizeForPVG=!0,o.useLinesForEndings=!0,o.useStemDirections=!0,o.useSlurDirections=!0,o.combineSameStemVoices=!0,o.importBlock=!0;break;case u.STYLE_HLC_ACCORDION:case u.STYLE_HLC_PIANO_SOLO:case u.STYLE_HLC_EDUCATIONAL_PIANO:case u.STYLE_HLC_BIG_NOTE:case u.STYLE_HLC_FAKEBOOK:case u.STYLE_HLC_KEYBOARD:case u.STYLE_HLC_PIANO_DUET:case u.STYLE_HLC_INSTRUMENTAL_SOLO:case u.STYLE_HLC_CHORAL:case u.STYLE_HLC_EASY_PIANO:case u.STYLE_HLC_PVG:case u.STYLE_HLC_GUITAR:case u.STYLE_HLC_UKULELE:case u.STYLE_PVG:case u.STYLE_MS_PVG:case u.STYLE_MS_EASY_PIANO:o.importStyle=t,o.optimizeForPVG=!0,o.useLinesForEndings=!0,o.importBlock=!0,o.importBlockNumbers=!0;break;case u.STYLE_CL_JAZZ:o.importStyle=t}l.loadMusicXmlScore(o)},l.loadMusicXmlScore=function(e){l.loadMusicXmlScoreOptions||(l.loadMusicXmlScoreOptions=e),l.loadScore(e)},l.loadMidiScore=function(e){l.loadMidiScoreOptions||(l.loadMidiScoreOptions=e),l.loadScore(e)},l.loadNoteflightXmlScore=function(e){l.loadScore({stripRecordedAudio:!0})},l.loadMidi=function(){var e={quantizationLevel:l.quantization().value,channelsBecomeParts:"tracks"!=l.midiOptionParts()};l.loadMidiScore(e)},l.loadScore=function(e){l.loadingScore(!0),e.fileName=l.importFile()&&l.importFile().name,setTimeout(function(){i(l.fileData(),e,function(e){l.importComplete(e)})},10)},l.importComplete=function(e){l.loadingScore(!1),e.score?(l.successfullyImportedFiles(l.successfullyImportedFiles()+1),e.nonFatalErrors&&e.nonFatalErrors.length>0&&!l.remainingFilesToLoad()?(l.nonFatalImportErrors(e.nonFatalErrors),l.showingNonFatalErrors(!0)):l.hasNextFileToLoad()?l.loadRemainingFiles():l.hasFatalImportErrors()||(0,n.hideCurrentDialog)()):l.fatalImportErrors(e.fatalErrors)},l.hideWindow=function(){(0,n.hideCurrentDialog)()},l.loadTemplates()}},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(32)),n=o(0),i=o(3),a=o(8);Noteflight.EditHeaderPaletteLeftConfig={controls:[{id:"play",type:"actionButton",actionFunction:"playScore",visibleFunction:"showPlay",enableFunction:"playEnable"},{id:"transcribe",type:"actionButton",actionFunction:"transcribe",invisibleFunction:"embedded"},{id:"record",type:"actionButton",actionFunction:"record",invisibleFunction:"embedded"},{id:"fullWindow",type:"actionButton",actionFunction:"openInWindow",visibleFunction:"showOpenInWindow"}]},Noteflight.EditHeaderPaletteRightConfig={controls:[{id:"save",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"requiresSave",invisibleFunction:"hideSave"},{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",dropClass:"hideAt500"},{id:"toggleFormattingPanel",type:"toggleButton",valueFunction:"showFormatting",dropClass:"hideAt1100"},{type:"separator"},{id:"view",type:"viewControl",dropClass:"hideAt400",disableFunction:"disableViewType"},{id:"zoom",type:"zoomControl",dropClass:"hideAt350",disableFunction:"zoomDisabled"},{type:"separator"},{id:"keyboard",type:"toggleButton",valueFunction:"showPianoKeyboard",dropClass:"hideAt550"},{id:"guide",type:"helpControl",dropClass:"hideAt600"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",invisibleFunction:"embedded"}]},Noteflight.EditPaletteConfig={sections:[{id:"score",controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments"},{id:"concertPitch",type:"toggleButton",valueFunction:"concertPitch",actionFunction:"doEditorAction"},{id:"toggleFormattingPanel",type:"toggleButton",valueFunction:"showFormatting"},{type:"separator"},{id:"pageSetup",type:"actionButton",actionFunction:"showPageSetup"},{id:"print",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"showPrinting"},{type:"separator",invisibleFunction:"embedded"},{id:"save",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"requiresSave",invisibleFunction:"hideSave"},{id:"export",type:"actionButton",actionFunction:"doEditorAction",invisibleFunction:"embedded",enableFunction:"showExport"},{id:"saveCopy",type:"actionButton",actionFunction:"doEditorAction",invisibleFunction:"embedded",enableFunction:"showCopying",advanced:!0},{type:"separator",invisibleFunction:"embedded",visibleFunction:"showHistory",advanced:!0},{id:"versions",type:"actionButton",actionFunction:"doEditorAction",invisibleFunction:"embedded",visibleFunction:"showHistory",advanced:!0},{type:"separator",invisibleFunction:"embedded",advanced:!0},{id:"toggleMediaSyncPanel",type:"toggleButton",valueFunction:"showMediaSync",advanced:!0},{type:"separator",invisibleFunction:"embedded",advanced:!0},{id:"statistics",type:"toggleButton",valueFunction:"showStatistics",advanced:!0}]},{id:"edit",controls:[{id:"undo",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"canUndo"},{id:"redo",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"canRedo"},{type:"separator"},{id:"cut",type:"actionButton",actionFunction:"doEditorAction"},{id:"copy",type:"actionButton",actionFunction:"doEditorAction"},{id:"paste",type:"actionButton",actionFunction:"doEditorAction"},{id:"delete",type:"actionButton",actionFunction:"doEditorAction"},{id:"repeat",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{type:"separator",advanced:!0},{id:"selectAll",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"selectFilter",type:"actionButton",actionFunction:"doEditorAction",advanced:!0}]},{id:"duration",controls:[{id:"whole",type:"durationButton",value:"8",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration"},{id:"half",type:"durationButton",value:"7",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration"},{id:"quarter",type:"durationButton",value:"6",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration"},{id:"eighth",type:"durationButton",value:"5",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration"},{id:"sixteenth",type:"durationButton",value:"4",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration"},{id:"thirtysecond",type:"durationButton",value:"3",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration",advanced:!0},{id:"sixtyfourth",type:"durationButton",value:"2",valueFunction:"value",userGuideGroup:"durationPalette",setValueFunction:"setDuration",advanced:!0},{type:"separator"},{id:"dot",type:"toggleButton",valueFunction:"dot"},{id:"doubleDot",type:"toggleButton",valueFunction:"doubleDot",advanced:!0},{id:"tie",type:"toggleButton",valueFunction:"tied",actionFunction:"toggleTied"},{id:"incomingTie",type:"actionButton",actionFunction:"toggleIncomingTies",advanced:!0},{type:"separator",advanced:!0},{id:"lvTie",type:"actionButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation",advanced:!0},{type:"separator",advanced:!0},{id:"noteShorter",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"noteLonger",type:"actionButton",actionFunction:"doEditorAction",advanced:!0}]},{id:"rhythm",controls:[{id:"tremolo1",type:"radioButton",value:"1",valueFunction:"tremolo",setValueFunction:"toggleTremolo",allowNone:!0},{id:"tremolo2",type:"radioButton",value:"2",valueFunction:"tremolo",setValueFunction:"toggleTremolo",allowNone:!0},{id:"tremolo3",type:"radioButton",value:"3",valueFunction:"tremolo",setValueFunction:"toggleTremolo",allowNone:!0},{id:"tremoloStart",type:"actionButton",actionFunction:"startTremolo"},{id:"buzz",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{type:"separator"},{id:"beamStart",type:"toggleButton",actionFunction:"toggleBeamAt",valueFunction:"beamAt"},{id:"beamContinue",type:"toggleButton",actionFunction:"toggleBeamBefore",valueFunction:"beamBefore"},{type:"separator"},{id:"addSlash",type:"actionButton",actionFunction:"enterSlash"},{id:"graceNote",type:"actionButton",actionFunction:"doEditorAction"},{id:"appoggiatura",type:"actionButton",actionFunction:"setAppoggiatura"},{type:"separator"},{id:"duplet",type:"actionButton",actionFunction:"applyTuplet"},{id:"triplet",type:"actionButton",actionFunction:"applyTuplet"},{id:"quadruplet",type:"actionButton",actionFunction:"applyTuplet",advanced:!0},{id:"quintuplet",type:"actionButton",actionFunction:"applyTuplet"},{id:"sextuplet",type:"actionButton",actionFunction:"applyTuplet",advanced:!0},{id:"septuplet",type:"actionButton",actionFunction:"applyTuplet",advanced:!0}]},{id:"pitch",controls:[{id:"sharp",type:"toggleButton",actionFunction:"toggleAccidental",getValueFunction:"accidentalSelected"},{id:"flat",type:"toggleButton",actionFunction:"toggleAccidental",getValueFunction:"accidentalSelected"},{id:"natural",type:"toggleButton",actionFunction:"toggleAccidental",getValueFunction:"accidentalSelected"},{type:"separator"},{id:"transpose",type:"actionButton",actionFunction:"doEditorAction"},{type:"separator"},{id:"moveUp",type:"actionButton",actionFunction:"doEditorAction"},{id:"moveDown",type:"actionButton",actionFunction:"doEditorAction"},{id:"moveHalfUp",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"moveHalfDown",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"moveOctaveUp",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"moveOctaveDown",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{type:"separator",advanced:!0},{id:"doubleSharp",type:"toggleButton",actionFunction:"toggleAccidental",getValueFunction:"accidentalSelected",advanced:!0},{id:"doubleFlat",type:"toggleButton",actionFunction:"toggleAccidental",getValueFunction:"accidentalSelected",advanced:!0},{id:"enharmonics",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"courtesyAccidental",type:"toggleButton",actionFunction:"toggleCourtesyAccidental",valueFunction:"courtesyAccidental",advanced:!0},{type:"separator",advanced:!0},{id:"octaveUp",type:"actionButton",actionFunction:"addOctaveUp",advanced:!0},{id:"octaveDown",type:"actionButton",actionFunction:"addOctaveDown",advanced:!0}]},{id:"tempo",controls:[{id:"tempo",type:"tempoControl",userGuideGroup:"tempoPalette"},{type:"separator",advanced:!0},{id:"accel",type:"actionButton",actionFunction:"addAccelerando",advanced:!0},{id:"rit",type:"actionButton",actionFunction:"addRitardando",advanced:!0},{id:"fermata",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation",advanced:!0},{id:"caesura",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation",advanced:!0},{id:"breath",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation",advanced:!0},{type:"separator",advanced:!0},{id:"swingEighths",type:"percentControl",buttonImageCSS:"swingEighths",min:0,max:50,step:.25,valueFunction:"swingEighthsSlider",advanced:!0,userGuideGroup:"swingEighths"},{id:"swingSixteenths",type:"percentControl",buttonImageCSS:"swingSixteenths",min:0,max:50,step:.25,valueFunction:"swingSixteenthsSlider",advanced:!0,userGuideGroup:"swingEighths"}]},{id:"text",controls:[{id:"lyrics",type:"actionButton",actionFunction:"doEditorAction"},{id:"performanceText",type:"actionButton",actionFunction:"addPerformance"},{id:"expressionText",type:"actionButton",actionFunction:"doEditorAction"},{id:"chord",type:"actionButton",actionFunction:"addChordSymbol"},{id:"rehearsalLetter",type:"actionButton",actionFunction:"addRehearsalLetter"},{type:"separator",advanced:!0},{id:"textBlockBeforeSystem",type:"actionButton",actionFunction:"addTextBlockBeforeSystem",advanced:!0},{id:"textBlockAfterSystem",type:"actionButton",actionFunction:"addTextBlockAfterSystem",advanced:!0},{id:"systemText",type:"actionButton",actionFunction:"addSystemText",advanced:!0},{id:"supertitle",type:"toggleButton",valueFunction:"hasSupertitle",actionFunction:"doEditorAction",advanced:!0},{id:"annotation",type:"actionButton",actionFunction:"addAnnotation",advanced:!0},{id:"prompt",type:"toggleButton",valueFunction:"hasPrompt",actionFunction:"doEditorAction",advanced:!0},{type:"separator",advanced:!0},{id:"textBorder",type:"toggleButton",valueFunction:"textbox",actionFunction:"toggleTextbox",enableFunction:"textboxAvailable",advanced:!0}]},{id:"measure",controls:[{id:"addMeasureBefore",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{id:"addMeasureAfter",type:"actionButton",actionFunction:"doEditorAction"},{id:"deleteMeasure",type:"actionButton",actionFunction:"doEditorAction"},{id:"resetMeasureNumbers",type:"actionButton",actionFunction:"resetMeasureNumbers",advanced:!0},{type:"separator"},{id:"changeTimeSignature",type:"actionButton",actionFunction:"doEditorAction"},{id:"changeKeySignature",type:"actionButton",actionFunction:"doEditorAction"},{type:"separator"},{id:"clefTreble",type:"actionButton",actionFunction:"setClef"},{id:"clefBass",type:"actionButton",actionFunction:"setClef"},{type:"separator"},{id:"barLineSingle",type:"radioButton",value:"single",valueFunction:"barlineType",setValueFunction:"setBarlineType",allowNone:!1},{id:"barLineDouble",type:"radioButton",value:"double",valueFunction:"barlineType",setValueFunction:"setBarlineType",allowNone:!1},{id:"barLineFinal",type:"radioButton",value:"final",setValueFunction:"setBarlineType",valueFunction:"barlineType",allowNone:!1},{id:"barLineInvisible",type:"radioButton",value:"invisible",setValueFunction:"setBarlineType",valueFunction:"barlineType",allowNone:!1,advanced:!0},{type:"separator",advanced:!0},{id:"clefTenor",type:"actionButton",actionFunction:"setClef",advanced:!0},{id:"clefAlto",type:"actionButton",actionFunction:"setClef",advanced:!0},{id:"clefTenorVoice",type:"actionButton",actionFunction:"setClef",advanced:!0},{id:"clefF8Below",type:"actionButton",actionFunction:"setClef",advanced:!0},{type:"separator",advanced:!0},{id:"hideShowCautionaries",type:"toggleButton",valueFunction:"disableCautionaries",actionFunction:"doEditorAction",advanced:!0},{id:"hideShowMeasure",type:"actionButton",actionFunction:"doEditorAction",advanced:!0},{type:"separator",advanced:!0},{id:"multiRest",type:"actionButton",actionFunction:"setMultiRest",advanced:!0}]},{id:"layout",controls:[{id:"systemBreakAfter",type:"toggleButton",actionFunction:"toggleBreakType",getValueFunction:"breakTypeSelected"},{id:"pageBreakAfter",type:"toggleButton",actionFunction:"toggleBreakType",getValueFunction:"breakTypeSelected"},{id:"splitSystem",type:"actionButton",actionFunction:"toggleSplitSystem"},{type:"separator"},{id:"createSystem",type:"toggleButton",actionFunction:"addBreakSet"},{id:"keepWithNext",type:"toggleButton",actionFunction:"addBreakSet",getValueFunction:"keepWithNextSelected"},{type:"separator"},{id:"moveAbove",type:"radioButton",value:"up",valueFunction:"direction",setValueFunction:"setNotationDirection",allowNone:!0},{id:"moveBelow",type:"radioButton",value:"down",valueFunction:"direction",setValueFunction:"setNotationDirection",allowNone:!0},{type:"separator"},{id:"resetLayout",type:"actionButton",actionFunction:"doEditorAction"}]},{id:"repeat",controls:[{id:"repeatStart",type:"toggleButton",valueFunction:"startRepeat",actionFunction:"toggleStartRepeat"},{id:"repeatEnd",type:"toggleButton",valueFunction:"endRepeat",actionFunction:"toggleEndRepeat"},{type:"separator"},{id:"segno",type:"actionButton",actionFunction:"addSegno"},{id:"coda",type:"actionButton",actionFunction:"addCoda"},{id:"repeatEnding",type:"actionButton",actionFunction:"addRepeatEnding"},{id:"repeatEndingFinal",type:"actionButton",actionFunction:"addRepeatEndingFinal"},{id:"measureRepeat",type:"actionButton",actionFunction:"setMeasureRepeat"}]},{id:"dynamics",controls:[{id:"expressionText",type:"actionButton",actionFunction:"doEditorAction"},{type:"separator"},{id:"crescendo",type:"actionButton",actionFunction:"addCrescendo"},{id:"diminuendo",type:"actionButton",actionFunction:"addDiminuendo"},{type:"separator"},{id:"cresc",type:"actionButton",actionFunction:"addLineCrescendo"},{id:"dim",type:"actionButton",actionFunction:"addLineDiminuendo"},{id:"lv",type:"actionButton",actionFunction:"addLetVibrate"},{id:"pedalDown",type:"actionButton",actionFunction:"addPedal"}]},{id:"articulation",controls:[{id:"slur",type:"actionButton",actionFunction:"addSlur"},{type:"separator"},{id:"marcato",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"staccato",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"tenuto",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"martellato",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"staccatissimo",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{type:"separator"},{id:"closed",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"open",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"downBow",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"upBow",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{type:"separator"},{id:"rip1",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPreEffect",advanced:!0},{id:"rip2",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPreEffect",advanced:!0},{id:"scoop",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPreEffect",advanced:!0},{id:"plop",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPreEffect",advanced:!0},{id:"fall1",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPostEffect",advanced:!0},{id:"fall2",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPostEffect",advanced:!0},{id:"quickFall",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPostEffect",advanced:!0},{id:"doit",type:"toggleButton",getValueFunction:"hasEffect",actionFunction:"setPostEffect",advanced:!0},{id:"bendJazz",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation",advanced:!0}]},{id:"ornament",controls:[{id:"trill",type:"actionButton",actionFunction:"addTrill"},{id:"arpeggio",type:"toggleButton",valueFunction:"arpeggio",actionFunction:"toggleArpeggio"},{id:"glissando",type:"toggleButton",actionFunction:"toggleGlissando",valueFunction:"glissando"},{id:"mordent",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"invertedMordent",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"turn",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"invertedTurn",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"}]},{id:"note",controls:[{id:"noteHeadNormal",type:"radioButton",value:"normal",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadStemless",type:"radioButton",value:"stemless",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadSlash",type:"radioButton",value:"slash",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadHit",type:"radioButton",value:"hit",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadCross",type:"radioButton",value:"cross",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadSquare",type:"radioButton",value:"square",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadDiamond",type:"radioButton",value:"diamond",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadTriangle",type:"radioButton",value:"triangle",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadHarmonic",type:"radioButton",value:"harmonic",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{id:"noteHeadCrossCircle",type:"radioButton",value:"crossCircle",valueFunction:"noteHead",setValueFunction:"setNoteHead",allowNone:!1},{type:"separator"},{id:"stemsDown",type:"radioButton",value:"down",valueFunction:"direction",setValueFunction:"setDirection",allowNone:!0},{id:"stemsUp",type:"radioButton",value:"up",valueFunction:"direction",setValueFunction:"setDirection",allowNone:!0},{type:"separator"},{id:"cue",type:"toggleButton",valueFunction:"cue",actionFunction:"setCue"},{id:"parentheses",type:"toggleButton",valueFunction:"parentheses",actionFunction:"toggleParentheses"}]},{id:"voice",controls:[{id:"voiceUpper",type:"actionButton",actionFunction:"doEditorAction"},{id:"voiceUpperRemove",type:"actionButton",visibleFunction:"inUpperVoice",actionFunction:"doEditorAction"},{id:"voiceLower",type:"actionButton",actionFunction:"doEditorAction"},{id:"voiceLowerRemove",type:"actionButton",visibleFunction:"inLowerVoice",actionFunction:"doEditorAction"}]},{id:"tab",controls:[{id:"bend",type:"toggleButton",valueFunction:"bent",actionFunction:"toggleBent"},{id:"preBend",type:"toggleButton",valueFunction:"preBent",actionFunction:"togglePreBent"},{id:"quarterBend",type:"toggleButton",valueFunction:"quarterBendAlteration",actionFunction:"addQuarterBendAlteration"},{id:"slide",type:"toggleButton",valueFunction:"slide",actionFunction:"toggleSlide"},{id:"hammerOn",type:"actionButton",actionFunction:"addSlurArticulation"},{id:"pullOff",type:"actionButton",actionFunction:"addSlurArticulation"},{id:"pm",type:"actionButton",actionFunction:"addPalmMute"},{id:"lr",type:"actionButton",actionFunction:"addLetRing"},{id:"tap",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"downStroke",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"},{id:"upStroke",type:"toggleButton",actionFunction:"toggleArticulation",getValueFunction:"hasArticulation"}]},{id:"lines",controls:[{id:"solid",type:"actionButton",actionFunction:"addLine"},{id:"dashed",type:"actionButton",actionFunction:"addLine"},{id:"solidBracketDown",type:"actionButton",actionFunction:"addLine"},{id:"solidBracketUp",type:"actionButton",actionFunction:"addLine"},{id:"wavy",type:"actionButton",actionFunction:"addVibrato"}]},{id:"color",controls:[{id:"colorNone",type:"radioButton",value:"0xFFFFFF",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorBlack",type:"radioButton",value:"0x000000",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorGrey",type:"radioButton",value:"0xC7CCCC",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorGreen",type:"radioButton",value:"0x33BB33",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorRed",type:"radioButton",value:"0xFF0000",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorOrange",type:"radioButton",value:"0xFF9D00",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorBlue",type:"radioButton",value:"0x3333FF",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorMustard",type:"radioButton",value:"0x999900",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorPink",type:"radioButton",value:"0xCC33CC",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{id:"colorAqua",type:"radioButton",value:"0x33CCCC",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1},{type:"separator",advanced:!0},{id:"colorClassroomC",type:"radioButton",value:"0xE52343",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomD",type:"radioButton",value:"0xFA9D01",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomE",type:"radioButton",value:"0xFEF401",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomF",type:"radioButton",value:"0xD4E24E",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomG",type:"radioButton",value:"0x009D95",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomA",type:"radioButton",value:"0x5D4CA3",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomB",type:"radioButton",value:"0xD03396",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0},{id:"colorClassroomCS",type:"radioButton",value:"0xE52343",valueFunction:"color",setValueFunction:"setColor",userGuideGroup:"colorPalette",allowNone:!1,advanced:!0}]},{id:"sound",showAdvanced:!0,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome"},{id:"performanceSpeed",type:"percentControl",buttonImageCSS:"speedAmount",min:50,max:200,step:5,valueFunction:"performanceSpeed"}]},{id:"view",controls:[{id:"view",type:"viewControl",userGuideGroup:"viewPalette",disableFunction:"disableViewType"},{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled"},{type:"separator"},{id:"keyboard",type:"toggleButton",valueFunction:"showPianoKeyboard"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",invisibleFunction:"embedded"},{type:"separator"},{id:"fullScreen",type:"toggleButton",valueFunction:"floatHeader"},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"},{id:"pageTurner",type:"actionButton",actionFunction:"doEditorAction"}]}]},Noteflight.ScoreEditPalette=function(e,t){var o=this;o.editor=t,Noteflight.ScoreCommonPalette.call(o,e,t);var s=t.controller,l=t.documentController,c=($$nf.classes.com.noteflight.notation.controller.ScoreDocumentController,$$nf.classes.com.noteflight.notation.event.ControllerEvent,$$nf.classes.com.noteflight.notation.event.ModelEvent,$$nf.classes.com.noteflight.notation.event.ModelUpdateEvent),u=$$nf.classes.com.noteflight.notation.event.NoteEditEvent,d=($$nf.classes.com.noteflight.notation.event.NotationEvent,$$nf.classes.com.noteflight.notation.event.SelectEvent,$$nf.classes.com.noteflight.notation.event.UndoEvent),p=($$nf.classes.com.noteflight.notation.model.Annotation,$$nf.classes.com.noteflight.notation.model.Barline),f=$$nf.classes.com.noteflight.notation.model.Clef,h=$$nf.classes.com.noteflight.notation.model.Hairpin,m=$$nf.classes.com.noteflight.notation.model.LineNotation,g=$$nf.classes.com.noteflight.notation.model.Measure,b=($$nf.classes.com.noteflight.notation.model.MeasurePosition,$$nf.classes.com.noteflight.notation.model.MultiRest,$$nf.classes.com.noteflight.notation.model.Notation),v=$$nf.classes.com.noteflight.notation.model.Note,y=$$nf.classes.com.noteflight.notation.model.NoteSet,_=($$nf.classes.com.noteflight.notation.model.PerformanceText,$$nf.classes.com.noteflight.notation.model.Slur),S=$$nf.classes.com.noteflight.notation.model.Tacet,w=$$nf.classes.com.noteflight.notation.model.TextNotation,k=$$nf.classes.com.noteflight.notation.model.Lyric,E=$$nf.classes.com.noteflight.notation.model.Trill,P=$$nf.classes.com.noteflight.notation.model.ValueNotation,C=($$nf.classes.com.noteflight.notation.service.Localizer,$$nf.classes.com.noteflight.notation.model.Tempo),T=($$nf.classes.com.noteflight.notation.model.MeterMap,$$nf.classes.com.noteflight.notation.model.SwingMeterMap),R=$$nf.classes.com.noteflight.notation.model.Block,O=$$nf.classes.com.noteflight.notation.model.EffectNotation;new NF.EditorKeyMediator(o).initialize(),o.transcribe=function(){o.editor.transcribingModeCanBeUsed()&&e.switchMode("transcribe")},o.record=function(){o.editor.canRecordingModeBeUsed()&&e.switchMode("record")},o.canUndo=ko.observable(),o.canRedo=ko.observable(),o.playEnable=ko.computed(function(){return!o.editor.scoreEditor.showMediaSyncEditor()}),o.handleUndoChange=function(e){o.canUndo(s.document.undoHistory.canUndo),o.canRedo(s.document.undoHistory.canRedo)},o.init=function(){o.editor.controller.setPerformanceMode(null)},o.handleModelUpdate=function(e){"tempo"==e.property&&o.updateMeasureState()},s.document.undoHistory.addEventListener(d.UNDO_HISTORY_CHANGE,o.handleUndoChange),s.document.score.addEventListener(c.MODEL_UPDATE,o.handleModelUpdate),o.doEditorActionsPalette=function(e,a){var l=0;switch(e){case"versions":o.editor.scoreDialogs.showVersionHistory();break;case"synchAudioVideo":o.showScoreDetails(!0),o.editor.audioVideoSynchronizer();break;case"undo":s.undo(),o.currentView(s.score.displayMode),o.editor.scoreApi.ensureSelectionVisible();break;case"redo":s.redo(),o.currentView(s.score.displayMode),o.editor.scoreApi.ensureSelectionVisible();break;case"cut":s.document.undoHistory.openGroup(a),s.cutClipboard(),o.editor.scoreApi.ensureSelectionVisible();break;case"paste":s.document.undoHistory.openGroup(a),s.pasteClipboard(),o.editor.scoreApi.ensureSelectionVisible();break;case"delete":s.document.undoHistory.openGroup(a),s.deleteSelection(),o.editor.scoreApi.ensureSelectionVisible();break;case"repeat":s.document.undoHistory.openGroup(a),s.repeatSelection(),o.editor.scoreApi.ensureSelectionVisible();break;case"noteLonger":s.document.undoHistory.openGroup(a),s.adjustSelectionDuration(1,!1),o.editor.scoreApi.ensureSelectionVisible();break;case"noteShorter":s.document.undoHistory.openGroup(a),s.adjustSelectionDuration(-1,!1),o.editor.scoreApi.ensureSelectionVisible();break;case"transpose":o.editor.scoreDialogs.transpose();break;case"moveUp":s.document.undoHistory.openGroup(a),s.transposeSelectionDiatonic(1),o.editor.scoreApi.ensureSelectionVisible();break;case"moveDown":s.document.undoHistory.openGroup(a),s.transposeSelectionDiatonic(-1),o.editor.scoreApi.ensureSelectionVisible();break;case"moveHalfUp":s.document.undoHistory.openGroup(a),s.transposeSelectionChromatic(1),o.editor.scoreApi.ensureSelectionVisible();break;case"moveHalfDown":s.document.undoHistory.openGroup(a),s.transposeSelectionChromatic(-1),o.editor.scoreApi.ensureSelectionVisible();break;case"moveOctaveUp":s.document.undoHistory.openGroup(a),s.transposeSelectionAtOctave(1),o.editor.scoreApi.ensureSelectionVisible();break;case"moveOctaveDown":s.document.undoHistory.openGroup(a),s.transposeSelectionAtOctave(-1),o.editor.scoreApi.ensureSelectionVisible();break;case"enharmonics":s.document.undoHistory.openGroup(a),s.enharmonicShift();break;case"prompt":o.editor.scoreApi.togglePrompt(o.hasPrompt());break;case"supertitle":o.editor.scoreApi.toggleSupertitle(o.hasSupertitle());break;case"changeTimeSignature":t.editTimeSignature(),t.scoreApi.ensureSelectionVisible();break;case"changeKeySignature":t.scoreDialogs.editKeySignature(),t.scoreApi.ensureSelectionVisible();break;case"addMeasureAfter":s.document.undoHistory.openGroup(a),l=o.measures()?o.measures().endIndex:s.document.score.numMeasures,s.insertBlankMeasureAt(l);break;case"addMeasureBefore":s.document.undoHistory.openGroup(a),l=0,o.measures()&&(l=o.measures().startIndex),s.insertBlankMeasureAt(l);break;case"deleteMeasure":s.document.undoHistory.openGroup(a),s.document.selection=o.measures(),s.deleteSelection();break;case"hideShowMeasure":t.contentPolicy().enable_color?(s.document.undoHistory.openGroup(a),s.toggleHideStaff()):(0,r.default)((0,n.resource)("editorDialog.hideMeasures"),(0,n.resource)("action.hideMeasures"),"hide_measures");break;case"voiceLower":s.document.undoHistory.openGroup(a),s.selectVoice(!1),t.scoreApi.ensureSelectionVisible();break;case"voiceUpper":s.document.undoHistory.openGroup(a),s.selectVoice(!0),t.scoreApi.ensureSelectionVisible();break;case"voiceLowerRemove":case"voiceUpperRemove":s.document.undoHistory.openGroup(a),s.removeSelectedVoice(),t.scoreApi.ensureSelectionVisible();break;case"resetLayout":null==s.selection?(0,i.okCancel)((0,n.resource)("content.resetLayoutWarning"),function(){s.document.undoHistory.openGroup(a),s.resetLayout(),t.scoreApi.ensureSelectionVisible()}):(s.document.undoHistory.openGroup(a),s.resetLayout(),t.scoreApi.ensureSelectionVisible());break;default:console.log("action not implemented: "+e)}},o.note=ko.observable(),o.noteSet=ko.observable(),o.barline=ko.observable(),o.otherNotation=ko.observable(),o.measures=ko.observable(),o.accidental=ko.observable(),o.courtesyAccidental=ko.observable(),o.tied=ko.observable(),o.bent=ko.observable(),o.preBent=ko.observable(),o.slide=ko.observable(),o.glissando=ko.observable(),o.noteHead=ko.observable(),o.xOffset=ko.observable(),o.yOffset=ko.observable(),o.quarterBendAlteration=ko.observable(),o.parentheses=ko.observable(),o.cue=ko.observable(),o.value=ko.observable(),o.dots=ko.observable(),o.beamAt=ko.observable(),o.beamBefore=ko.observable(),o.articulations=ko.observable(),o.tremolo=ko.observable(),o.arpeggio=ko.observable(),o.direction=ko.observable(),o.grace=ko.observable(),o.appoggiatura=ko.observable(),o.restSelected=ko.observable(),o.preEffect=ko.observable(),o.postEffect=ko.observable(),o.barlineType=ko.observable(),o.breakType=ko.observable(),o.keepWithNext=ko.observable(),o.endRepeat=ko.observable(),o.disableCautionaries=ko.observable(),o.startRepeat=ko.observable(),o.color=ko.observable(),o.textboxAvailable=ko.observable(),o.textbox=ko.observable(),o.tempoValue=ko.observable(),o.tempoDots=ko.observable(),o.tempoBPM=ko.observable();function M(e){return l.scoreDocument.score.systemStaff.getMeasureAt(e).tempo}function A(e){var t=M(e).clone();return 0===o.swingEighths()?t.meterMap=new T("16",o.swingSixteenths()/100):t.meterMap=new T("8",o.swingEighths()/100),t}function N(){s.document.undoHistory.openGroup("Change Swing");var e=s.document.selection;if(e)for(var t=e.selectedMeasures.startIndex;t<e.selectedMeasures.endIndex;t++){var o=A(t);s.document.score.setTempoAtMeasure(o,t,t+1)}else{var r=A(0);s.setSelectionTempo(r)}}function I(e){return M(e).clone().meterMap}o.swingEighths=ko.observable(0),o.swingEighths.subscribe(function(e){0!==e&&o.swingSixteenths(0)}),o.swingSixteenths=ko.observable(0),o.swingSixteenths.subscribe(function(e){0!==e&&o.swingEighths(0)}),o.swingEighthsSlider=ko.computed({read:function(){return Math.round(o.swingEighths())},write:function(e){e!=o.swingEighths()&&(o.swingEighths(e),N())}}).extend({throttle:100}),o.swingSixteenthsSlider=ko.computed({read:function(){return Math.round(o.swingSixteenths())},write:function(e){e!=o.swingSixteenths()&&(o.swingSixteenths(e),N())}}).extend({throttle:100}),o.showHistory=ko.computed(function(){return t.score()&&(t.contentPolicy().user_role==a.DOCUMENT_ROLE_AUTHOR||t.contentPolicy().user_role==a.DOCUMENT_ROLE_COAUTHOR)}),o.prompt=o.boundScoreProperty("prompt"),o.hasPrompt=ko.computed(function(){return null!==o.prompt()}),o.supertitle=o.boundScoreProperty("supertitle"),o.hasSupertitle=ko.computed(function(){return null!==o.supertitle()}),o.inUpperVoice=ko.observable(null),o.inLowerVoice=ko.observable(null),o.updatePalette=function(){var e=s.document.selection;if(e&&!e.empty&&(s.document.editable||s.document.markingsEditable)){o.noteSet(s.document.firstSelectedNoteSet),o.note(s.document.firstSelectedNote),o.barline(s.document.firstSelectedBarline),o.keepWithNext(s.score.getBreak(e.startIndex)==g.KEEP_WITH_NEXT_TYPE);var t=s.document.firstSelectedNotation(b);$$nf.operator_is(t,P)||$$nf.operator_is(t,p)?o.otherNotation(null):o.otherNotation(t),o.measures(e.selectedMeasures),o.noteSet()&&o.noteSet().measure.numVoices>1?(o.inUpperVoice(1==o.noteSet().voice.index),o.inLowerVoice(2==o.noteSet().voice.index)):(o.inUpperVoice(null),o.inLowerVoice(null))}else o.noteSet(null),o.note(null),o.barline(null),o.otherNotation(null),o.measures(null),o.inUpperVoice(null),o.inLowerVoice(null)},o.noteState=ko.computed(function(){var e=o.note();e&&e.measure&&e.measure.staff&&e.measure.staff.score?(o.accidental(e.measure.getScoreNote(e).accidental),o.tied(e.tied),o.parentheses(e.parentheses),o.courtesyAccidental(e.courtesyAccidental),o.bent(e.liaison==v.BEND_LIAISON),o.preBent(e.liaison==v.PRE_BEND_LIAISON),o.slide(e.liaison==v.SLIDE_LIAISON),o.glissando(e.liaison==v.GLISSANDO_LIAISON),o.noteHead(e.noteHead),o.xOffset(10*e.dx),o.yOffset(10*e.dy),o.quarterBendAlteration(0!==e.tuning),o.cue(e.effectiveCue),o.preEffect(e.preEffect),o.postEffect(e.postEffect)):(o.preEffect(null),o.postEffect(null),o.accidental(null),o.tied(!!o.noteSet()&&(o.noteSet().tied&&o.noteSet().tieCount==o.noteSet().notes.length)))}),o.noteSetState=ko.computed(function(){var e=o.noteSet();if(e){o.value(e.value),o.dots(e.dots),o.articulations(e.articulations),o.tremolo(e.tremolo),o.arpeggio(e.arpeggio),o.direction(e.direction),o.grace(e.grace&&!e.appoggiatura),o.appoggiatura(e.grace&&e.appoggiatura),o.restSelected(0===e.notes.length),o.beamAt(e.beam);var t=e.previousNoteSet();o.beamBefore(t&&t.beam),o.note()||o.cue(e.cue)}else o.value(0),o.dots(0),o.articulations(0),o.tremolo(0),o.arpeggio(0),o.direction(0),o.grace(0),o.appoggiatura(0),o.restSelected(!1),o.beamAt(0),o.beamBefore(0),o.cue(0)}),o.barlineState=ko.computed(function(){var e=o.barline();if(e){o.barlineType(e.type);var t=e.measure;if(!t)return;o.breakType(s.document.score.getBreak(t.index)),o.endRepeat(t.endRepeat),o.disableCautionaries(t.disableCautionaries),o.noteSet()||e.position<t.duration?o.startRepeat(t.startRepeat):t.staff&&t.index<t.staff.score.numMeasures-1?(t=t.staff.getMeasureAt(t.index+1),o.startRepeat(t.startRepeat)):o.startRepeat(!1)}else o.barlineType(null),o.startRepeat(!1),o.endRepeat(!1),o.disableCautionaries(!1),o.breakType(null)}),o.otherNotationState=ko.computed(function(){var e=o.otherNotation();if(o.textboxAvailable(!1),$$nf.operator_is(e,E)){var t=e;o.accidental(t.scoreAccidental),o.note(t.dummyNeighbor)}else if($$nf.operator_is(e,w)){o.textboxAvailable(!0);var r=e;o.textbox(r.textbox)}else $$nf.operator_is(e,k)&&o.direction(e.direction)}),o.colorState=ko.computed(function(){if($$nf.operator_is(o.noteSet(),S))o.color(o.noteSet().color);else{if(!o.note())return o.otherNotation()&&o.color(o.otherNotation().color),void o.color(null);var e=s.selection&&s.selection.selectedNotations();if(e){if($$nf.operator_is(e[0],y)){var t=e[0];if(o.note().color!=t.color)return void o.color(t.color)}o.color(o.note().effectiveColor)}}}).extend({throttle:1}),o.updateMeasureState=function(){var e,t,r=o.measures();if(r){t=e=M(r.startIndex);for(var n=r.startIndex;n<r.endIndex;n++){var i=M(n);if(i.value!=e.value||i.dots!=e.dots||i.bpm!=e.bpm){e=null;break}}}else t=e=M(0);o.tempoValue(e?e.value:t.value),o.tempoDots(e?e.dots:t.dots),o.tempoBPM(e?e.bpm:"");var a=0,s=0;t.meterMap&&"swing"==t.meterMap.type&&("8"==t.meterMap.swingType?a=100*t.meterMap.swingDelta:s=100*t.meterMap.swingDelta),o.swingEighths(a),o.swingSixteenths(s)},o.measureState=ko.computed(o.updateMeasureState),o.applyTempo=function(e,t,r){var n=parseInt(r,10);if(n>0&&n<=1e3&&-1!=o.value()){s.document.undoHistory.openGroup("Change Tempo");var i=new C(e,t,n),a=s.document.selection;if(a)for(var l=a.selectedMeasures.startIndex;l<a.selectedMeasures.endIndex;l++){var c=i.clone();c.meterMap=I(l),s.setTempoAtMeasure(c,l,l+1)}else i.meterMap=I(0),s.setSelectionTempo(i)}};var x={downStroke:"downBow",upStroke:"upBow",tap:"closed"},D={turn:"delayedTurn",invertedTurn:"delayedInvertedTurn"};o.toggleArticulation=function(e){x[e]&&(e=x[e]),o.applyAction(u.ARTICULATION,e)},o.hasArticulation=function(e){var t=!1;return o.articulations()&&(x[e]&&(e=x[e]),t=o.articulations().indexOf(e)>=0,D[e]&&(t=t||o.articulations().indexOf(D[e])>=0)),t};var F={scoop:O.SCOOP,plop:O.PLOP,quickFall:O.QUICK_FALL,doit:O.DOIT,rip1:O.RIP1,rip2:O.RIP2,fall1:O.FALL1,fall2:O.FALL2};o.hasEffect=function(e){return o.preEffect()&&o.preEffect().type==e||o.postEffect()&&o.postEffect().type==e},o.setPreEffect=function(e){o.applyAction(u.PRE_EFFECT,F[e])},o.setPostEffect=function(e){o.applyAction(u.POST_EFFECT,F[e])},o.setDuration=function(e){o.value()!=e&&o.applyAction(u.VALUE,e)},o.dot=ko.computed({read:function(){return 1==o.dots()},write:function(e){o.applyAction(u.DOTS,1==o.dots()?0:1)}}),o.doubleDot=ko.computed({read:function(){return 2==o.dots()},write:function(e){o.applyAction(u.DOTS,2==o.dots()?0:2)}}),o.toggleTied=function(){o.applyAction(u.TIED,!o.tied())},o.setMultiRest=function(){o.applyAction(u.MULTIREST,null)},o.toggleTremolo=function(e){o.applyAction(u.TREMOLO,o.tremolo()==e?0:e)},o.toggleBeamAt=function(){o.applyAction(u.BEAM_AT,!o.beamAt())},o.toggleBeamBefore=function(){o.applyAction(u.BEAM_BEFORE,!o.beamBefore())},o.setGrace=function(){o.applyAction(u.GRACE,null)},o.setAppoggiatura=function(){o.applyAction(u.APPOGGIATURA,null)},o.startTremolo=function(){o.applyAction(u.START_TREMOLO,null)},o.toggleIncomingTies=function(){o.applyAction(u.INCOMING_TIE,null)},o.toggleGlissando=function(){o.applyAction(u.GLISSANDO,!o.glissando())},o.applyTuplet=function(e){o.applyAction("tuplet",{duplet:2,triplet:3,quadruplet:4,quintuplet:5,sextuplet:6,septuplet:7}[e])};var L={sharp:v.SHARP,flat:v.FLAT,natural:v.NATURAL,doubleSharp:v.DOUBLE_SHARP,doubleFlat:v.DOUBLE_FLAT};o.accidentalSelected=function(e){return o.accidental()==L[e]},o.toggleAccidental=function(e){o.applyAction(u.ACCIDENTAL,L[e])},o.toggleCourtesyAccidental=function(){o.applyAction(u.COURTESY_ACCIDENTAL,!o.courtesyAccidental())},o.addOctaveUp=function(){o.applyAction(u.OCTAVE_UP,null)},o.addOctaveDown=function(){o.applyAction(u.OCTAVE_DOWN,null)},o.addSlur=function(){o.applyAction(u.SLUR,null)},o.addAccelerando=function(){o.applyAction(u.ACCELERANDO,null)},o.addRitardando=function(){o.applyAction(u.RITARDANDO,null)},o.addLyrics=function(){o.applyAction(u.LYRICS,null)},o.addExpression=function(){o.applyAction(u.EXPRESSION,null)},o.addPerformance=function(){o.applyAction(u.PERFORMANCE,null)},o.addChordSymbol=function(){o.applyAction(u.CHORD_SYMBOL,null)},o.addTextBlockBeforeSystem=function(){o.applyAction(u.TEXT_BLOCK_BEFORE,null)},o.addTextBlockAfterSystem=function(){o.applyAction(u.TEXT_BLOCK_AFTER,null)},o.addSystemText=function(){o.applyAction(u.SYSTEM_TEXT,null)},o.addAnnotation=function(){o.applyAction(u.ANNOTATION,null)},o.addRehearsalLetter=function(){o.applyAction(u.REHEARSAL_LETTER,null)},o.toggleTextbox=function(){o.applyAction(u.TEXT_IN_BOX,null)};var U={clefTreble:f.trebleClef(),clefTenorVoice:f.tenorVoiceClef(),clefTenor:f.tenorClef(),clefAlto:f.altoClef(),clefBass:f.bassClef(),clefF8Below:f.vocalTenorClef()};o.setClef=function(e){s.document.undoHistory.openGroup("Clef Change"),s.changeClef(U[e])},o.resetMeasureNumbers=function(){o.applyAction(u.RESET_MEASURE_NUMBERS,null)},o.setBarlineType=function(e){o.applyAction(u.BARLINE,e)},o.toggleCautionaries=function(){o.applyAction(u.CAUTIONARIES,null)},o.toggleStartRepeat=function(){o.applyAction(u.START_REPEAT,!o.startRepeat())},o.toggleEndRepeat=function(){o.applyAction(u.END_REPEAT,!o.endRepeat())},o.addSegno=function(){o.applyAction(u.SEGNO,null)},o.addCoda=function(){o.applyAction(u.CODA,null)},o.toggleSplitSystem=function(){o.applyAction(u.SPLIT_SYSTEM,null)},o.addRepeatEnding=function(){o.applyAction(u.REPEAT_ENDING,null)},o.addRepeatEndingFinal=function(){o.applyAction(u.REPEAT_ENDING_FINAL,null)},o.setMeasureRepeat=function(){o.applyAction(u.MEASURE_REPEAT,null)},o.addCrescendo=function(){o.applyAction(u.CRESCENDO,null)},o.addDiminuendo=function(){o.applyAction(u.DIMINUENDO,null)},o.addLetVibrate=function(){o.applyAction(u.LET_VIBRATE,null)},o.addLineCrescendo=function(){o.applyAction(u.LINE_CRESCENDO,null)},o.addLineDiminuendo=function(){o.applyAction(u.LINE_DIMINUENDO,null)},o.addPedal=function(){o.applyAction(u.PEDAL,null)},o.addTrill=function(){o.applyAction(u.TRILL,null)},o.addVibrato=function(){o.applyAction(u.VIBRATO,null)},o.toggleArpeggio=function(){var e;switch(o.arpeggio()){case y.NORMAL_ARPEGGIO:e=y.UP_ARPEGGIO;break;case y.UP_ARPEGGIO:e=y.DOWN_ARPEGGIO;break;case y.DOWN_ARPEGGIO:e=null;break;default:e=y.NORMAL_ARPEGGIO}o.applyAction(u.ARPEGGIO,e)},o.setNoteHead=function(e){o.applyAction(u.NOTE_HEAD,o.noteHead()!=e?e:null)},o.setDirection=function(e){o.applyAction(u.DIRECTION,o.direction()!=e?e:null)},o.setNotationDirection=function(e){o.applyAction(u.NOTATION_DIRECTION,o.direction()!=e?e:null)},o.setCue=function(){o.applyAction(u.CUE,null)},o.toggleParentheses=function(){o.applyAction(u.PARENTHESES,!o.parentheses())},o.toggleBent=function(){o.applyAction(u.BENT,!o.bent())},o.togglePreBent=function(){o.applyAction(u.PRE_BENT,!o.preBent())},o.addQuarterBendAlteration=function(){o.applyAction(u.QUARTER_BEND_ALTERATION,null)},o.toggleSlide=function(){o.applyAction(u.SLIDE,!o.slide())},o.addSlurArticulation=function(e){o.applyAction(u.SLUR_ARTICULATION,e)},o.addPalmMute=function(){o.applyAction(u.PALM_MUTE,null)},o.addLetRing=function(){o.applyAction(u.LET_RING,null)},o.addLine=function(e){o.applyAction(u.LINE,e)},o.setColor=function(e){o.applyAction(u.COLOR,e)};var j={systemBreakAfter:g.SYSTEM_BREAK_TYPE,pageBreakAfter:g.PAGE_BREAK_TYPE,keepWithNext:g.KEEP_WITH_NEXT_TYPE};o.breakTypeSelected=function(e){return o.breakType()==j[e]},o.toggleBreakType=function(e){o.applyAction(u.BREAK_TYPE,j[e])};var B={keepWithNext:"keepWithNext",createSystem:"createSystem"};o.keepWithNextSelected=function(){return o.keepWithNext()},o.addBreakSet=function(e){o.applyAction(u.BREAK_SET_TYPE,B[e])},o.NYI=function(){return!1},o.enterSlash=function(){o.applyAction(u.ENTER_SLASH,null)},o.onlyIfPermitted=function(e,o,n,i){t.contentPolicy()[o]?e():(0,r.default)(n,i,o)},o.applyAction=function(e,r){switch(e){case u.ACCIDENTAL:if(o.note())switch(s.document.undoHistory.openGroup("Accidental"),r){case v.DOUBLE_FLAT:s.applyAccidentalToSelection(-2);break;case v.FLAT:s.applyAccidentalToSelection(-1);break;case v.NATURAL:s.applyAccidentalToSelection(0);break;case v.SHARP:s.applyAccidentalToSelection(1);break;case v.DOUBLE_SHARP:s.applyAccidentalToSelection(2)}break;case u.VALUE:o.noteSet()&&(s.document.undoHistory.openGroup("Rhythm Change"),s.setSelectionDuration(r,0));break;case u.DOTS:o.noteSet()&&!$$nf.operator_is(o.noteSet(),S)&&(s.document.undoHistory.openGroup("Rhythm Change"),s.setSelectionDuration(o.noteSet().value,r));break;case u.TIED:s.document.undoHistory.openGroup("Tie Change"),s.modifyTies();break;case u.PARENTHESES:s.document.undoHistory.openGroup("Parentheses Change"),s.modifyParentheses();break;case u.COURTESY_ACCIDENTAL:s.document.undoHistory.openGroup("Courtesy Accidental Change"),s.modifyCourtesyAccidentals();break;case u.INCOMING_TIE:s.document.undoHistory.openGroup("Incoming Tie Change"),s.modifyIncomingTies();break;case u.BENT:s.document.undoHistory.openGroup("Bend Change"),s.modifyLiaisons(v.BEND_LIAISON),t.scoreApi.ensureSelectionVisible();break;case u.PRE_BENT:s.document.undoHistory.openGroup("Pre-Bend Change"),s.modifyLiaisons(v.PRE_BEND_LIAISON),t.scoreApi.ensureSelectionVisible();break;case u.SLIDE:s.document.undoHistory.openGroup("Slide Change"),s.modifyLiaisons(v.SLIDE_LIAISON),t.scoreApi.ensureSelectionVisible();break;case u.GLISSANDO:s.document.undoHistory.openGroup("Glissando Change"),s.modifyLiaisons(v.GLISSANDO_LIAISON),t.scoreApi.ensureSelectionVisible();break;case u.REMOVE:s.document.undoHistory.openGroup("Delete"),s.removeSelection();break;case u.REMOVE_MARKINGS:s.document.undoHistory.openGroup("Delete Markings"),s.removeSelectionMarkings();break;case u.ANNOTATION:s.document.undoHistory.openGroup("Add Annotation"),s.addAnnotation();break;case u.TREMOLO:s.document.undoHistory.openGroup("Single Note Tremolo"),s.setTremolo(r);break;case u.START_TREMOLO:s.document.undoHistory.openGroup("Start Tremolo"),s.startTremolo();break;case u.MULTIREST:o.onlyIfPermitted(function(){s.document.undoHistory.openGroup("Add Multiple Rest"),s.addMultiRest()},"enable_part_display",(0,n.resource)("content.premiumRequiredForMultiRests"),(0,n.resource)("alerts/premiumRequiredForMultiRests"));break;case u.ARPEGGIO:s.document.undoHistory.openGroup("Modify Arpeggio"),s.modifyArpeggio(r);break;case u.CUE:s.document.undoHistory.openGroup("Modify Cue"),s.modifyCue();break;case u.DIRECTION:s.document.undoHistory.openGroup("Modify Direction"),s.modifyDirection(r);break;case u.NOTATION_DIRECTION:s.document.undoHistory.openGroup("Modify Notations Direction"),s.modifyNotationsDirection(r);break;case u.GRACE:s.document.undoHistory.openGroup("Modify Grace Note"),s.modifyGrace(!1);break;case u.APPOGGIATURA:s.document.undoHistory.openGroup("Modify Appoggiatura"),s.modifyGrace(!0);break;case u.SEGNO:s.document.undoHistory.openGroup("Add Segno"),s.addSegno();break;case u.CODA:s.document.undoHistory.openGroup("Add Coda"),s.addCoda();break;case u.SPLIT_SYSTEM:s.document.undoHistory.openGroup("Toggle Split System"),s.toggleSplitSystem();break;case u.REPEAT_ENDING:l.addRepeatEnding(),s.document.validateNow();break;case u.REPEAT_ENDING_FINAL:l.addRepeatEnding(!0),s.document.validateNow();break;case u.MEASURE_REPEAT:s.document.undoHistory.openGroup("Set MeasureRepeat"),s.setMeasureRepeat();break;case u.SYSTEM_TEXT:l.addPerformance(!0);break;case u.REHEARSAL_LETTER:s.document.undoHistory.openGroup("Rehearsal letter"),s.addRehearsalLetter();break;case u.TEXT_IN_BOX:s.document.undoHistory.openGroup("Textbox"),s.toggleTextbox();break;case u.COLOR:o.onlyIfPermitted(function(){s.document.undoHistory.openGroup("Set Color"),s.setColor(r)},"enable_color",(0,n.resource)("content.premiumRequiredToChangeScoreColors"),(0,n.resource)("alerts/premiumRequiredToChangeScoreColors"));break;case u.CHORD_SYMBOL:l.addChordSymbol();break;case u.LYRICS:l.addLyric();break;case u.EXPRESSION:l.addExpression();break;case u.PERFORMANCE:l.addPerformance(!1);break;case u.ENTER_SLASH:s.document.undoHistory.openGroup("Enter Slash"),s.enterSlash();break;case u.BEAM_BEFORE:s.document.undoHistory.openGroup("Beam Change"),s.modifyBeamBeforeSelection();break;case u.BEAM_AT:s.document.undoHistory.openGroup("Beam Change"),s.modifyBeamAtSelection();break;case u.BARLINE:s.document.undoHistory.openGroup("Change Barline"),s.setBarlineType(r.toString());break;case u.RESET_MEASURE_NUMBERS:s.document.undoHistory.openGroup("Reset measure numbers"),s.resetMeasureNumbers();break;case u.START_REPEAT:s.document.undoHistory.openGroup("Change Repeat"),s.modifyStartRepeat();break;case u.END_REPEAT:s.document.undoHistory.openGroup("Change Repeat"),s.modifyEndRepeat();break;case u.BREAK_SET_TYPE:s.document.undoHistory.openGroup("Insert Break Set"),s.applyBreakSet(r.toString());break;case u.BREAK_TYPE:s.document.undoHistory.openGroup("Insert Break"),s.applyBreak(r.toString());break;case u.CAUTIONARIES:s.document.undoHistory.openGroup("Hide/Show Cautionaries"),s.toggleCautionaries();break;case u.NOTE_HEAD:s.document.undoHistory.openGroup("Change Note Head"),s.setNoteHead(r&&r.toString());break;case u.ARTICULATION:s.document.undoHistory.openGroup("Change Articulation"),s.modifyArticulation(r.toString());break;case u.SLUR:s.document.undoHistory.openGroup("Add Slur"),s.addSpanToSelection(new _);break;case u.OCTAVE_UP:s.document.undoHistory.openGroup("Add Octave Up"),s.addSpanToSelection(m.createLineNotation(m.TYPE_OCTAVE_UP,s.document.score.staffMetrics));break;case u.OCTAVE_DOWN:s.document.undoHistory.openGroup("Add Octave Down"),s.addSpanToSelection(m.createLineNotation(m.TYPE_OCTAVE_DOWN,s.document.score.staffMetrics));break;case u.LET_VIBRATE:s.document.undoHistory.openGroup("Add Let Vibrate"),s.addSpanToSelection(m.createLineNotation(m.TYPE_LET_VIBRATE,s.document.score.staffMetrics,"l.v."));break;case u.TRILL:s.document.undoHistory.openGroup("Add Trill"),s.addSpanToSelection(m.createLineNotation(m.TYPE_TRILL,s.document.score.staffMetrics));break;case u.VIBRATO:s.document.undoHistory.openGroup("Add Vibrato"),s.addSpanToSelection(m.createLineNotation(m.TYPE_VIBRATO,s.document.score.staffMetrics));break;case u.LINE_CRESCENDO:s.document.undoHistory.openGroup("Add Crescendo"),s.addSpanToSelection(m.createLineNotation(m.TYPE_CRESCENDO,s.document.score.staffMetrics,"cresc."));break;case u.LINE_DIMINUENDO:s.document.undoHistory.openGroup("Add Diminuendo"),s.addSpanToSelection(m.createLineNotation(m.TYPE_DIMINUENDO,s.document.score.staffMetrics,"dim."));break;case u.ACCELERANDO:s.document.undoHistory.openGroup("Add Accelerando"),s.addSpanToSelection(m.createLineNotation(m.TYPE_ACCELERANDO,s.document.score.staffMetrics,"accel."));break;case u.RITARDANDO:s.document.undoHistory.openGroup("Add Ritardando"),s.addSpanToSelection(m.createLineNotation(m.TYPE_RITARDANDO,s.document.score.staffMetrics,"rit."));break;case u.QUARTER_BEND_ALTERATION:s.document.undoHistory.openGroup("Quarter-bend Alteration Change"),s.modifyQuarterBendAlteration();break;case u.SLUR_ARTICULATION:s.document.undoHistory.openGroup("Add "+_.ARTICULATION_FRIENDLY_NAMES[r.toString()]);var i=new _;i.slurArticulation=r.toString(),s.addSpanToSelection(i);break;case u.PALM_MUTE:s.document.undoHistory.openGroup("Add Palm Mute"),s.addSpanToSelection(m.createLineNotation(m.TYPE_PALM_MUTE,s.document.score.staffMetrics,"P.M."));break;case u.LET_RING:s.document.undoHistory.openGroup("Add Let Ring"),s.addSpanToSelection(m.createLineNotation(m.TYPE_LET_VIBRATE,s.document.score.staffMetrics,"l.r."));break;case u.CRESCENDO:s.document.undoHistory.openGroup("Add Crescendo"),s.addSpanToSelection(h.createHairpin(h.CRESCENDO,s.document.score.staffMetrics));break;case u.DIMINUENDO:s.document.undoHistory.openGroup("Add Diminuendo"),s.addSpanToSelection(h.createHairpin(h.DIMINUENDO,s.document.score.staffMetrics));break;case u.PEDAL:s.document.undoHistory.openGroup("Add Pedal"),s.addSpanToSelection(m.createLineNotation(m.TYPE_PEDAL,s.document.score.staffMetrics));break;case u.LINE:s.document.undoHistory.openGroup("Add Line"),s.addSpanToSelection(m.createLineNotation(r.toString(),s.document.score.staffMetrics));break;case u.PRE_EFFECT:s.document.undoHistory.openGroup("Add Pre Effect"),s.applyPreEffectToSelection(r);break;case u.POST_EFFECT:s.document.undoHistory.openGroup("Add Post Effect"),s.applyPostEffectToSelection(r);break;case u.TEXT_BLOCK_BEFORE:s.document.undoHistory.openGroup("Add Text Block"),s.addTextBlock(R.BEFORE_SYSTEM);break;case u.TEXT_BLOCK_AFTER:s.document.undoHistory.openGroup("Add Text Block"),s.addTextBlock(R.AFTER_SYSTEM);break;case"tuplet":s.document.undoHistory.openGroup("Create Triplet"),s.createTuplet2(r),t.scoreApi.ensureSelectionVisible()}}}},function(e,t,o){"use strict";var r=o(19),n=o(14),i=o(221),a=o(220),s=o(8),l="#headerPalette",c={slow:100,fast:1};Noteflight.PaletteHoncho=function(e){var t=this,o={left:NF.session.community().default_community()?71:160,right:61,leftMobile:60,rightMobile:60,leftPhone:55,rightPhone:40};function u(e){var t=NF.capitalizeFirstLetter(e);return l+t+"PreviousMode"}function d(e){$(u(e)).stop(!1,!0,!0),$(t._getCurrentModeId(e)).stop(!1,!0,!0)}function p(e){var o=u(e),r=t._getCurrentModeId(e);$(o)[0].innerHTML=$(r)[0].innerHTML,$(o).css(e,$(r).css(e)),$(o).show()}function f(e){var o=t._getCurrentModeId(e);return $(o).hide(),parseInt($(o).css(e),10)}function h(e,t){var o=u(e),r={};r[e]="-="+$(o).width(),$(o).fadeOut({queue:!1,duration:"fast"}),$(o).animate(r,c[t],"swing")}function m(e,o){var r=t._getCurrentModeId(e);$(r).css(e,o-$(r).width()+"px"),$(r).show()}t.editor=e,t.scoreEditor=e.scoreEditor,t.initializeConnectedProperties=function(){t.isEditingProduct=ko.observable(),t.currentUserIsAuthor=ko.observable(),t.currentUserIsProductOwner=ko.observable(),t.currentUserIsPreviewingProduct=ko.observable(),t.contentType=ko.observable(),(0,n.connect)(i.paletteHonchoSelector,{})(t)},t.initializeConnectedProperties(),t.mode=ko.observable(),t._getCurrentModeId=function(e){var t=NF.capitalizeFirstLetter(e);return l+t},t._moveNewHeaderPalettesIn=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t._getCurrentModeId(e),s={};s[e]="+="+$(a).width(),i||$(a).hide();var l=(0,r.isMobileLayout)()?"Mobile":(0,r.isPhoneLayoutOrSmaller)()?"Phone":"";i||$(a).fadeIn({queue:!1,duration:"slow"}),$(a).animate(s,c[n],"swing",function(){$(a).css(e,o[e+l]+"px")})},t.switchMode=function(e,o){var r=o||"slow";d("left"),d("right"),p("left"),p("right");var n=f("left"),i=f("right");t.mode(e),h("left",r),h("right",r),m("left",n),m("right",i),t._moveNewHeaderPalettesIn("left",r),t._moveNewHeaderPalettesIn("right",r)},t.handleWindowResize=function(){t._moveNewHeaderPalettesIn("left","fast",!0)},t.baseMode=ko.computed(function(){if(t.contentType()==s.PRODUCT){if(t.currentUserIsPreviewingProduct())return"productPreview";if(t.currentUserIsProductOwner()||t.currentUserIsAuthor()&&!t.isEditingProduct())return"productOwned"}return t.editor.scorePermissions.canEdit()?"edit":"view"}),t.useLargeIcons=ko.observable(!!NF.hasStorage&&"true"==localStorage.getItem("_nf_use_large_icons")),t.useLargeIcons.subscribe(function(e){t.scoreEditor.customHeaderPalette()&&t.scoreEditor.customHeaderPalette().mayHaveChangedHeight(),NF.hasStorage&&localStorage.setItem("_nf_use_large_icons",e)});var g,b,v,y={view:new Noteflight.ScoreViewPalette(t,e),edit:new Noteflight.ScoreEditPalette(t,e),play:new Noteflight.ScorePlayPalette(t,e),productPreview:new a.ProductPalette(t,e),productOwned:new a.ProductPalette(t,e)};t.playing=ko.computed(function(){return t.editor.active()&&!!t.editor.scoreState.player()}),t.isAboutToPlay=t.editor.scoreApi.scoreState.isAboutToPlay,ko.computed(function(){"edit"!=t.mode()&&"view"!=t.mode()||!t.isAboutToPlay()&&!t.playing()?t.playing()||t.editor.scoreState.isSyncMediaPlaying()||"play"!=t.mode()||t.backToBaseMode():t.switchMode("play")}).extend({throttle:300}),e.isViewerOnly()||(y.transcribe=new Noteflight.ScoreTranscribePalette(t,e),y.record=new Noteflight.ScoreRecordPalette(t,e)),t.currentPalette=ko.computed(function(){return y[t.mode()]}),t.mode.subscribe(function(){t.currentPalette().updateVars(),t.currentPalette().init&&t.currentPalette().init()}),t.updatePalette=function(){t.currentPalette()&&t.currentPalette().updatePalette&&t.currentPalette().updatePalette()},t.backToBaseMode=function(){t.switchMode(t.baseMode())},t.saveViewState=function(){g=NF.appViewModel.floatHeader(),b=t.scoreEditor.scoreDetailsPanel().showScoreDetails(),v=t.scoreEditor.showPianoKeyboard()},t.restoreViewState=function(){NF.appViewModel.floatHeader(g),t.scoreEditor.scoreDetailsPanel().openCloseScoreDetailsPanel(b),t.scoreEditor.showPianoKeyboard(v)},t.scoreEditor.headerPaletteLeft(new Noteflight.ScoreHeaderPaletteLeft(t)),t.scoreEditor.headerPaletteRight(new Noteflight.ScoreHeaderPaletteRight(t)),t.currentUserIsPreviewingProduct()||(!t.scoreEditor.viewer()||t.editor.scorePermissions.canEdit()||t.currentUserIsProductOwner())&&t.scoreEditor.customHeaderPalette(new Noteflight.ScorePalette(t)),t.switchMode(t.baseMode())}},function(e,t,o){"use strict";Noteflight.PlayHeaderPaletteLeftConfig={controls:[{id:"edit",type:"actionButton",actionFunction:"stopPlayScore",visibleFunction:"canEdit"},{id:"back",type:"actionButton",actionFunction:"stopPlayScore",invisibleFunction:"canEdit"},{type:"separator"},{id:"beginning",type:"actionButton",actionFunction:"beginningPlayScore"},{id:"pause",type:"actionButton",actionFunction:"pausePlayScore",invisibleFunction:"paused"},{id:"play",type:"actionButton",actionFunction:"continuePlayScore",visibleFunction:"paused"},{id:"stop",type:"actionButton",actionFunction:"stopPlayScore"},{id:"jumpToCursor",type:"actionButton",visibleFunction:"isJumpToCursorVisible",actionFunction:"jumpToCursor"}]},Noteflight.PlayHeaderPaletteRightConfig={controls:[{id:"view",type:"viewControl",dropClass:"hideAt500"},{id:"zoom",type:"zoomControl",dropClass:"hideAt350",disableFunction:"zoomDisabled"},{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",invisibleFunction:"embedded",dropClass:"hideAt400"},{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer",invisibleFunction:"embedded",dropClass:"hideAt450"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",invisibleFunction:"embedded",dropClass:"hideAt450"}]},Noteflight.PlayPaletteConfig={sections:[{id:"sound",expanded:!0,showAdvanced:!0,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome"},{id:"performanceSpeed",type:"percentControl",buttonImageCSS:"speedAmount",min:50,max:200,step:5,valueFunction:"performanceSpeed"},{type:"separator"},{id:"toggleGracePanel",type:"actionButton",actionFunction:"toggleGraceNotePanel"}]},{id:"view",expanded:!1,showAdvanced:!1,controls:[{id:"view",type:"viewControl"},{id:"zoom",type:"zoomControl"},{type:"separator"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails"},{type:"separator"},{id:"fullScreen",type:"toggleButton",valueFunction:"floatHeader"},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"},{id:"pageTurner",type:"actionButton",actionFunction:"doEditorAction"}]}]},Noteflight.ScorePlayPalette=function(e,t){var o=this;o.editor=t,Noteflight.ScoreCommonPalette.call(o,e,t),o.init=function(){e.saveViewState(),o.showPianoKeyboard(!1)},o.stopPlayScore=function(){o.editor.scoreApi.stop(),e.backToBaseMode()},o.toggleGraceNotePanel=function(){o.editor.scoreDialogs.graceNotePanel()},o.jumpToCursor=function(){o.editor.scoreApi.resumeScrolling()},o.isJumpToCursorVisible=ko.computed(function(){return o.scoreEditor.forceManualScrolling()&&e.playing()})}},function(e,t,o){"use strict";var r=o(0),n=o(3),i=o(60);Noteflight.RecordHeaderPaletteLeftConfig={controls:[{id:"edit",type:"actionButton",actionFunction:"endRecordingMode"},{type:"separator"},{id:"beginning",type:"actionButton",actionFunction:"beginningPlayScore",disableFunction:"recordingPerformance"},{id:"pause",type:"actionButton",actionFunction:"pausePlayScore",invisibleFunction:"notPlaying",disableFunction:"recordingPerformance"},{id:"play",type:"actionButton",actionFunction:"continuePlayScore",visibleFunction:"notPlaying",disableFunction:"recordingPerformance"},{id:"recordPerformance",type:"actionButton",actionFunction:"startRecordingPerformance",enableFunction:"recordButtonEnabled",visibleFunction:"canRecord",invisibleFunction:"recordingPerformance"},{id:"pauseRecordPerformance",type:"actionButton",actionFunction:"pauseRecordingPerformance",visibleFunction:"recordingPerformance"},{id:"calibrateMic",type:"actionButton",actionFunction:"startCalibratingMic",visibleFunction:"canRecord",enableFunction:"calibrateMicEnabled"},{id:"recordingControl",type:"recordingControl",visibleFunction:"recordingPerformance"}]},Noteflight.RecordHeaderPaletteRightConfig={controls:[{id:"save",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"requiresSave",invisibleFunction:"embedded"},{id:"view",type:"viewControl",dropClass:"hideAt500"},{id:"zoom",type:"zoomControl",dropClass:"hideAt350",disableFunction:"zoomDisabled"},{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",dropClass:"hideAt400"},{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer",invisibleFunction:"embedded",dropClass:"hideAt450"}]},Noteflight.RecordPaletteConfig={sections:[{id:"score",controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments"},{id:"save",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"requiresSave",invisibleFunction:"embedded"}]},{id:"sound",expanded:!0,showAdvanced:!0,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome",disableFunction:"recordingPerformance"},{id:"mutePartForRecording",type:"toggleButton",valueFunction:"mutePartForRecording",disableFunction:"recordingPerformance"},{type:"separator"},{id:"calibrateMic",type:"actionButton",actionFunction:"startCalibratingMic",visibleFunction:"canRecord",disableFunction:"recordingPerformance"},{id:"options",type:"actionButton",actionFunction:"options",disableFunction:"recordingPerformance"},{id:"inputSelection",type:"actionButton",actionFunction:"inputSelection",disableFunction:"recordingPerformance"}]},{id:"view",expanded:!1,showAdvanced:!1,controls:[{id:"view",type:"viewControl"},{id:"zoom",type:"zoomControl"},{type:"separator"},{id:"fullScreen",type:"toggleButton",valueFunction:"floatHeader"},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"}]}]},Noteflight.ScoreRecordPalette=function(e,t){var o=this;function a(){o.recordingPerformance()&&o.endRecordingMode()}function s(e){o.selectedPart(e.part)}function l(e){o.scoreBuilt(!0)}function c(e){o.scoreBuilt(!1),o.scoreView.removeEventListener("complete",l),o.scoreView=o.editor.documentController.documentView.scoreView,o.scoreView.addEventListener("complete",l)}function u(){var e=o.editor.controller.pausePosition.measureIndex;if(o.editor.scoreApi.entryExistsForMeasureIndex(e)){o.recordingCanvas.initialize(),o.audioRecording.setupRecording(e),o.editor.controller.addEventListener("playbackStarts",function(){o.animationStarted(!0),o.editor.controller.removeEventListener("playbackStarts")});var t=null;o.editor.mutePartForRecording()&&(t=o.selectedPart()),o.editor.scoreApi.startAudioRecording(t),o.recordingPerformance(!0)}else{var i=o.editor.scoreApi.lastMeasureIndexWithEntry();(0,n.standardAlertDialog)((0,r.resource)("editor.noEntryAtThisMeasure",i))}}o.editor=t,Noteflight.ScoreCommonPalette.call(o,e,t),o.recordingPerformance=ko.observable(!1),o.canRecord=ko.computed(function(){return o.editor.scorePermissions.canEdit()}),o.recordingCanvas=null,o.audioRecording=null,o.animationStarted=ko.observable(!1),o.selectedPart=ko.observable(),o.audioLoaded=ko.observable(!1),o.scoreBuilt=ko.observable(!0),o.scoreView=null,o.micCaptured=ko.observable(!1),o.notPlaying=ko.computed(function(){return o.paused()||!e.playing()}),o.readyToRecord=ko.computed(function(){return o.micCaptured()&&o.audioLoaded()&&o.scoreBuilt()}),o.realRecordingStarted=!1,o.recordButtonEnabled=ko.computed(function(){return o.readyToRecord()&&o.notPlaying()}),o.calibrateMicEnabled=ko.computed(function(){return o.micCaptured()&&!o.recordingPerformance()&&o.notPlaying()}),o.previousMetronome=o.playMetronome(),o.parts=function(){return t.controller.score.parts.slice()},o.init=function(){o.scoreView=o.editor.documentController.documentView.scoreView,o.editor.controller.addEventListener("forceStop",o.endRecordingMode),o.editor.controller.document.addEventListener("pause",o.pauseRecordingPerformance),o.editor.controller.addEventListener("partSelected",s),o.editor.controller.performer.addEventListener("soundComplete",a),o.editor.documentController.documentView.addEventListener("forcePageFlow",c),o.editor.controller.setPerformanceMode("record",!0),o.recordingCanvas=new NF.RecordingCanvas,o.audioRecording=new NF.AudioRecording(o,o.editor),(0,i.getMicStream)(function(){o.micCaptured(!0)}),o.recordingCanvas.initialize(),o.selectedPart(o.editor.controller.partToHighlight),o.editor.controller.isPaused=!0,o.editor.performanceSpeed(100),o.editor.scorePermissions.canUseMixer()&&o.editor.scoreEditor.openCloseMixer(!0,"tracks"),o.scoreView.isIncrementalFlowComplete?o.scoreBuilt(!0):c()},o.mutePartForRecording=o.editor.mutePartForRecording,o.startCalibratingMic=function(){o.editor.scoreDialogs.calibrateMic()},o.onAnimationStart=function(e){o.audioRecording.captureRecording(e)},o.onAnimationEnd=function(){o.realRecordingStarted=!0},o.startRecordingPerformance=function(){o.selectedPart()?(o.previousMetronome=o.playMetronome(),o.editor.scorePermissions.canUseMetronome()&&o.playMetronome(!0),!(NF.hasStorage&&localStorage.getItem("_nf_overwrite_recording_alert"))&&o.editor.controller.clipsCanBeOverwritten(o.selectedPart(),o.editor.getUserInfo(),o.editor.controller.pausePosition)?(0,n.okCancel)((0,r.resource)("editor.possiblyOverwritingRecording"),function(){NF.hasStorage&&localStorage.setItem("_nf_overwrite_recording_alert",(new Date).getTime()),u()}):u()):(0,n.standardAlertDialog)((0,r.resource)("editor.partMustBeSelectedToRecord"))},o.pauseRecordingPerformance=function(){o.recordingPerformance()&&(o.recordingPerformance(!1),o.animationStarted(!1),o.playMetronome(o.previousMetronome),o.editor.stopAudioRecording(),o.realRecordingStarted?(o.audioRecording.stopRecording(),o.editor.scoreApi.stop()):o.audioRecording.abortRecording(),o.realRecordingStarted=!1)},o.endRecordingMode=function(){o.recordingPerformance()&&o.pauseRecordingPerformance(),o.playMetronome(o.previousMetronome),o.editor.scoreApi.stop(),(0,i.releaseMicStream)(),e.backToBaseMode()},o.options=function(){o.editor.scoreDialogs.recordingSettings()},o.inputSelection=function(){o.editor.scoreDialogs.inputSelection()}}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.TranscribeHeaderPaletteLeftConfig={controls:[{id:"edit",type:"actionButton",actionFunction:"cancelTranscribe"},{type:"separator"},{id:"startTranscribing",type:"actionButton",actionFunction:"startTranscribing",invisibleFunction:"transcribing"},{id:"doneTranscribing",type:"actionButton",actionFunction:"stopTranscribing",visibleFunction:"transcribing"},{id:"transcriberControl",type:"transcriberControl",visibleFunction:"transcribing"}]},Noteflight.TranscribeHeaderPaletteRightConfig={controls:[{id:"save",type:"actionButton",actionFunction:"doEditorAction",visibleFunction:"requiresSave",invisibleFunction:"embedded"},{id:"view",type:"viewControl",dropClass:"hideAt500"},{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",dropClass:"hideAt400"},{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer",invisibleFunction:"embedded",dropClass:"hideAt450"}]},Noteflight.TranscribePaletteConfig={sections:[{id:"score",controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments"},{id:"save",type:"actionButton",actionFunction:"doEditorAction",enableFunction:"requiresSave",invisibleFunction:"embedded"}]},{id:"sound",expanded:!0,showAdvanced:!0,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"performanceSpeed",type:"percentControl",buttonImageCSS:"speedAmount",min:50,max:200,step:5,valueFunction:"performanceSpeed",disableFunction:"transcribing"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome",disableFunction:"transcribing"},{type:"separator"},{id:"options",type:"actionButton",actionFunction:"options",disableFunction:"transcribing"}]},{id:"view",expanded:!1,showAdvanced:!1,controls:[{id:"view",type:"viewControl"},{id:"zoom",type:"zoomControl"},{type:"separator"},{id:"fullScreen",type:"toggleButton",valueFunction:"floatHeader"},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"}]}]},Noteflight.ScoreTranscribePalette=function(e,t){var o=this;function i(e){o.selectedPart(e.part),o.selectedMeasure=e.measureIndex}o.editor=t,o.parent=e,Noteflight.ScoreCommonPalette.call(o,e,t),o.listenToPlaybackToStartId=-1,o.midiRecording=new Noteflight.MidiRecording(t,o),o.pianoRoll=new Noteflight.PianoRollCanvas,o.transcribing=ko.observable(!1),o.animationStarted=ko.observable(!1),o.selectedPart=ko.observable(),o.selectedMeasure=0,o.checkIfReady=function(){return!!o.selectedPart()||((0,n.standardAlertDialog)((0,r.resource)("alert.midiRecordingSelectionNeeded")),!1)},o.init=function(){o.editor.controller.addEventListener("partSelected",i),o.editor.controller.addEventListener("pause",o.stopTranscribing),o.editor.controller.setPerformanceMode("transcribe"),o.pianoRoll.initialize(),e.saveViewState(),o.showScoreDetails(!1),o.showPianoKeyboard(!1),o.transcribing(!1),o.pianoRoll.initialize(),o.previousPerformanceSpeed=o.editor.performanceSpeed(),o.editor.scorePermissions.canUseMetronome()&&o.playMetronome(!0)},o.enableDisableMetronomeLoop=function(e){o.editor.controller.performer.metronomeLoop=void 0!==e?e:o.playMetronome()},o.endTranscribingMode=function(){o.playMetronome(!1),e.restoreViewState(),e.backToBaseMode()},o.startTranscribing=function(){o.checkIfReady()&&(o.enableDisableMetronomeLoop(),o.midiRecording.startRecording(o.selectedMeasure,o.selectedPart()),o.listenToPlaybackToStartId=setInterval(function(){isNaN(o.editor.controller.performer.playbackTimePosition)||o.editor.controller.performer.playbackTimePosition>0&&(clearInterval(o.listenToPlaybackToStartId),o.startAnimationProcess())},10),o.transcribing(!0))},o.finishTranscription=function(e){o.transcribing(!1),o.enableDisableMetronomeLoop(!1),o.stopAnimationProcess(e),o.editor.performanceSpeed(o.previousPerformanceSpeed),o.endTranscribingMode()},o.onAnimationStart=function(e){setTimeout(function(){o.recordingMode()},1e3*e)},o.stopTranscribing=function(){o.finishTranscription(!0)},o.cancelTranscribe=function(){o.finishTranscription(!1)},o.startAnimationProcess=function(){!o.animationStarted()&&o.transcribing()&&o.animationStarted(!0)},o.stopAnimationProcess=function(e){o.animationStarted()&&o.editor.controller.performer.isRecording&&(o.editor.controller.transcriber.enabled=!1,o.midiRecording.stopRecording(e),o.pianoRoll.stopAnimation(),o.animationStarted(!1))},o.recordingMode=function(){o.transcribing()&&(o.midiRecording.initializeEventListeners(),o.editor.controller.transcriber.startTime=performance.now(),o.editor.controller.transcriber.enabled=!0,o.pianoRoll.startAnimation())},o.options=function(){o.editor.scoreDialogs.transcriberSettings()}}},function(e,t,o){"use strict";Noteflight.ViewHeaderPaletteLeftConfig={controls:[{id:"play",type:"actionButton",actionFunction:"playScore",visibleFunction:"showPlay"},{id:"audioReference",type:"actionButton",actionFunction:"playAudioReference",visibleFunction:"showAudioReference"},{id:"fullWindow",type:"actionButton",actionFunction:"openInWindow",visibleFunction:"showOpenInWindow"}]},Noteflight.ViewHeaderPaletteRightConfig={controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",visibleFunction:"showInstrumentsButton",dropClass:"hideAt400"},{type:"separator",visibleFunction:"showInstrumentsButton"},{id:"view",type:"viewControl",anonymousDropClass:"hideAt450"},{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled",anonymousDropClass:"hideAt350"},{type:"separator",visibleFunction:"showSignupOrLogin"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails",visibleFunction:"allowLogin",invisibleFunction:"embedded",anonymousDropClass:"hideAt400"},{id:"signin",type:"actionButton",actionFunction:"signin",visibleFunction:"allowLogin",invisibleFunction:"loggedIn"}]},Noteflight.ViewPaletteConfig={sections:[{id:"score",expanded:!0,showAdvanced:!1,controls:[{id:"toggleInstrumentsPanel",type:"toggleButton",valueFunction:"showInstruments",visibleFunction:"showInstrumentsButton"},{id:"concertPitch",type:"toggleButton",valueFunction:"concertPitch",actionFunction:"doEditorAction"},{id:"toggleFormattingPanel",type:"toggleButton",valueFunction:"showFormatting"},{type:"separator"},{id:"pageSetup",type:"actionButton",actionFunction:"doEditorAction"},{id:"print",type:"actionButton",actionFunction:"doEditorAction",visibleFunction:"showPrinting"},{type:"separator",invisibleFunction:"embedded",visibleFunction:"showCopyingOrExport"},{id:"saveCopy",type:"actionButton",actionFunction:"doEditorAction",invisibleFunction:"embedded",visibleFunction:"showCopying"},{id:"export",type:"actionButton",actionFunction:"doEditorAction",invisibleFunction:"embedded",visibleFunction:"showExport"},{type:"separator",invisibleFunction:"embedded",advanced:!0},{id:"statistics",type:"toggleButton",valueFunction:"showStatistics",advanced:!0}]},{id:"sound",expanded:!0,showAdvanced:!0,controls:[{id:"toggleMixPanel",type:"toggleButton",valueFunction:"showMixer"},{id:"metronome",type:"toggleButton",valueFunction:"playMetronome"},{id:"performanceSpeed",type:"percentControl",buttonImageCSS:"speedAmount",min:50,max:200,step:5,valueFunction:"performanceSpeed"}]},{id:"view",expanded:!1,showAdvanced:!1,controls:[{id:"view",type:"viewControl"},{id:"zoom",type:"zoomControl",disableFunction:"zoomDisabled"},{type:"separator"},{id:"scoreDetails",type:"toggleButton",valueFunction:"showScoreDetails"},{type:"separator"},{id:"fullScreen",type:"toggleButton",valueFunction:"floatHeader"},{id:"largeIcons",type:"toggleButton",valueFunction:"useLargeIcons"},{id:"pageTurner",type:"actionButton",actionFunction:"doEditorAction"}]}]},Noteflight.ScoreViewMenu={controls:[{id:"viewPaginated",type:"radioButton",value:"paginated",valueFunction:"currentView"},{id:"viewStrip",type:"radioButton",value:"strip",valueFunction:"currentView"},{id:"viewFlow",type:"radioButton",value:"flow",valueFunction:"currentView"},{id:"viewPerform",type:"radioButton",value:"perform",valueFunction:"currentView"}]},Noteflight.ScoreViewPalette=function(e,t){var o=this;Noteflight.ScoreCommonPalette.call(o,e,t),o.init=function(){o.editor.controller.setPerformanceMode(null)},o.showSignupOrLogin=ko.computed(function(){return o.allowLogin()||o.loggedIn()})}},function(e,t,o){"use strict";var r=o(19),n=o(0);Noteflight.PianoKeyboard=function(e,t){var o,i,a=this;a.editor=e,a.selector=t,a.element=null,a.numKeys=108,a.numVisible=function(){var e=a.element.parent().width();return e||(e=$("#scoreEditorPanel").outerWidth()||0),e/o*(12/7)},a.visibleOctaves=function(){return Math.floor(a.visible()/12)},a.usePhoneLayout=Noteflight.IsPhoneLayout(),a.initializeKeys=function(){a.element=$(a.selector),a.usePhoneLayout?(o=30,i=15):(o=62,i=31);var e=$("#pianoKeysBlack"),t=$("#pianoKeysWhite");e.html(""),t.html(""),a.keys=[],a.selectedPitches=[],a.chordPitches=[],a.firstVisible=0;for(var r=0,s=0,l=0;r<a.numKeys;)a.createKey(t,r++,l,{text:(0,n.resource)("note.cOctave",s)}),a.createKey(e,r++,l+i),l+=o,a.createKey(t,r++,l),a.createKey(e,r++,l+i),l+=o,a.createKey(t,r++,l),l+=o,a.createKey(t,r,l,41==r?{icon:"bassClef"}:null),r++,a.createKey(e,r++,l+i),l+=o,a.createKey(t,r,l,55==r?{icon:"trebleClef"}:null),r++,a.createKey(e,r++,l+i),l+=o,a.createKey(t,r++,l),a.createKey(e,r++,l+i),l+=o,a.createKey(t,r++,l),l+=o,s++;a.scrollToPitch(48-12*Math.floor(a.numVisible()/24))},Noteflight.appViewModel.currentCSSLayout.subscribe(function(e){a.usePhoneLayout!=(0,r.isPhoneLayoutOrSmaller)()&&(a.usePhoneLayout=(0,r.isPhoneLayoutOrSmaller)(),a.initializeKeys())}),a.scrollToPitch=function(e){a.firstVisible=Math.max(0,Math.min(Math.floor(a.numKeys-a.numVisible()+1),e)),a.element.css("left",-a.firstVisible*o*7/12)},a.scrollRight=function(){a.scrollToPitch(a.firstVisible-12)},a.scrollLeft=function(){a.scrollToPitch(a.firstVisible+12)},a.createKey=function(e,t,o,r){a.keys.push(new Noteflight.PianoKey(a,e,t,o,r))},a.selectNotes=function(e,t,o){var r=0;if(e){var n=e.clef;n&&0===a.chordPitches.length&&a.revealPitchRange(n.note.pitch.ordinal-6,n.note.pitch.ordinal+6),a.lastStaff=e.staff,r=e.scoreInterval.pitches}else a.lastStaff=null;$.each(a.chordPitches,function(e,t){a.keys[t].clearHighlighting()}),a.chordPitches=[],$.each(t,function(e,t){var o=t.pitch.ordinal+r;a.keys[o]&&(a.keys[o].addChordHighlight(!0),a.chordPitches.push(o))}),a.selectedPitches=[],$.each(o,function(e,t){var o=t.pitch.ordinal+r;a.keys[o]&&(a.keys[o].addSelectionHighlight(!0),a.selectedPitches.push(o))}),a.chordPitches.sort();var i=a.chordPitches[0],s=a.chordPitches[a.chordPitches.length-1];a.revealPitchRange(i,s)},a.revealPitchRange=function(e,t){t<a.firstVisible?a.scrollToPitch(12*Math.floor(t/12)):e>a.firstVisible+a.numVisible()&&a.scrollToPitch(12*Math.ceil((e-a.numVisible())/12))},a.noteOn=function(e,t){var o=a.editor.controller,r=null,n=o.document.firstSelectedNoteSet;n&&(r=n.findChromaticOrdinal(e)),o.document.selection&&(r&&a.chordPitches.indexOf(e)>=0&&!o.document.entryAfterSelection?t?o.selectNotation(r):o.modifyNotationSelection(r):t?(o.document.undoHistory.openGroup("Enter Notes"),o.document.entryAfterSelection?o.enterPitchAtSelection(e,!1):o.placePitchAtSelection(e,!1)):r?(o.selectNotation(r),o.removeSelection(),o.selectNotation(n)):o.addPitchToSelection(e,!1),a.editor.scoreApi.ensureSelectionVisible())},a.noteOff=function(e){}};var i=0;Noteflight.PianoKey=function(e,t,o,r,n){var a=this;a.down=!1,a.pitch=function(){return o},a.keyDown=function(t){if(!a.down){a.down=!0;var o=e.editor.controller;e.editor.startSound(function(){o.noteOn(a.pitch()),o.document.requestModelChange(function(){e.noteOn(a.pitch(),t)})})}},a.keyUp=function(){if(a.down){a.down=!1;var t=e.editor.controller;t.noteOff(a.pitch()),t.document.requestModelChange(function(){e.noteOff(a.pitch())})}},a.touchStart=function(e){e.originalEvent.touches&&1==e.originalEvent.touches.length&&(i=0),a.keyDown(0===i),i++,e.preventDefault()},a.touchEnd=function(e){a.keyUp(),i--,e.preventDefault()};var s=null;a.pointerDown=function(e){return s?(window.clearTimeout(s),s=null):(e.originalEvent.isPrimary&&(i=0),a.keyDown(0===i&&!e.shiftKey),i++),!1},a.pointerUp=function(e){return s=window.setTimeout(function(){a.keyUp(),i--,s=null},300),!1},a.mouseDown=function(e){a.keyDown(!e.shiftKey)},a.mouseUp=function(e){a.keyUp()},a.clearHighlighting=function(){a.element.removeClass("selected"),a.element.removeClass("chord")},a.addChordHighlight=function(){a.element.addClass("chord")},a.addSelectionHighlight=function(){a.element.removeClass("chord"),a.element.addClass("selected")};var l=$('<div class="key">');if(n)if(n.text)l.html(n.text);else if(n.icon){var c=$('<div class="keyIcon">');c.addClass(n.icon),l.append(c)}l.css({left:r+"px"}),a.element=l,t.append(l),window.navigator.pointerEnabled?(l.bind("pointerdown",a.pointerDown),l.bind("pointerup",a.pointerUp)):window.navigator.msPointerEnabled?(l.bind("MSPointerDown",a.pointerDown),l.bind("MSPointerUp",a.pointerUp)):(l.bind("touchstart",a.touchStart),l.bind("touchend",a.touchEnd),l.bind("mousedown",a.mouseDown),l.bind("mouseup",a.mouseUp),l.bind("mouseout",a.mouseUp)),l.bind("contextmenu",function(){return!1})}},function(e,t,o){"use strict";var r=o(3);Noteflight.PrintScoreDialog=function(e,t,o){var n=this;r.DialogViewModel.call(this),n.editor=e,n.individualParts=o.individualParts,n.totalPages=o.totalPages,n.usePrinter=ko.observable(o.usePrinter&&NF.supportsDataURI),n.showPrintingWarning=ko.observable(!1),n.state=ko.observable(),n.cancelled=ko.observable(!1),n.pageIndex=ko.observable(0),n.unicodeReplaced=ko.observable(!1),n.savedTransposePartsValue=!1,n.savedDisplayMode=null,n.onStateChange=o.onStateChange,n.state.subscribe(function(e){n.onStateChange&&n.onStateChange(e,n)}),n.onPageIndexChange=o.onPageIndexChange,n.pageIndex.subscribe(function(e){n.onPageIndexChange&&n.onPageIndexChange(e)}),n.showPageOrientationWarning=ko.computed(function(){return!!n.individualParts&&!n.editor.controller.score.partsPageOrientations.every(function(e,t,o){return e===o[0]})}),n.firstPageOrientation=ko.computed(function(){return n.editor.getFirstPartPageOrientation()});var i=$$nf.classes.com.noteflight.notation.metrics.PageMetrics;n.getOtherOrientation=ko.computed(function(){return n.firstPageOrientation()==i.LANDSCAPE?i.PORTRAIT:i.LANDSCAPE});var a=$$nf.classes.com.noteflight.notation.model.Score,s=t.scoreDocument.score.effectivePageMetrics;n.title=ko.observable(n.usePrinter()?"editorDialog.printerPrintScore":"editorDialog.printScore"),n.printStartingMessage=ko.observable(n.usePrinter()?"content.printerPrintStarting":"content.printStarting"),n.close=function(){(0,r.hideCurrentDialog)()},n.invokeLater=function(e){window.setTimeout(e,10)},n.savePDF=function(){if(NF.hasBlob){var e=NF.removeBreakLines(n.editor.score().title());n.doc.save(e+".pdf")}else window.open(n.doc.output("bloburi"));n.close()},n.doOk=function(){return n.savePDF(),!0},n.printPDF=function(){n.doc.autoPrint(),window.open(n.doc.output("bloburi")),n.close()},n.callWithPageViews=function(r){var i=function(e){n.pageViews=e,r(),n.individualParts&&n.editor.incrementalSaveManager.scoreEditListener.whileIgnoringModelEvents(function(){t.controller.setScoreProperty("transposeParts",n.savedTransposePartsValue)}),n.editor.fit(n.savedDisplayMode)};n.individualParts?o.includeFullScore&&e.scoreApi.getTotalParts()>1?t.asyncGetPartwisePageViews(i,!0):t.asyncGetPartwisePageViews(i):t.asyncGetPageViews(i)},n.printNextPage=function(){if(n.state("printing"),n.cancelled())n.close();else if(n.pageIndex()<n.pageViews.length&&n.pageIndex()<n.totalPages){n.pageIndex()>0&&n.doc.addPage();window.svgElementToPdf(n.pageViews[n.pageIndex()]._svg,n.doc,{fill:"#000000",stroke:"#000000",convertTextToImage:!1,convertUnicodeTextToImage:!0}),n.pageIndex(n.pageIndex()+1),n.invokeLater(n.printNextPage)}else n.state("ready"),n.showPrintingWarning(e.scoreApi.getTotalPagesToPrint>=10),n.unicodeReplaced(!!n.doc.getSVGConversionProperties().unicodeReplaced)};var l={};function c(){var e=jsPDF;n.doc=new e(s.orientation.toLowerCase(),"pt",l[s.name]||"letter",!1),n.doc.addFont("AshText.ttf","ashtext","normal","WinAnsiEncoding"),n.pageIndex(0),n.callWithPageViews(n.printNextPage),t.documentView.removeEventListener("forcePageFlow")}l.A3="a3",l.A4="a4",l.A5="a5",l["US Letter"]="letter",l["US Legal"]="legal",l["US Tabloid"]="tabloid",n.doPrint=function(){n.individualParts&&(n.savedTransposePartsValue=t.controller.getScoreProperty("transposeParts"),n.editor.incrementalSaveManager.scoreEditListener.whileIgnoringModelEvents(function(){t.controller.setScoreProperty("transposeParts",!0)})),t.documentView.addEventListener("forcePageFlow",c),e.scoreApi.forceScoreBuild()},n.print=function(){t&&(n.savedDisplayMode=n.editor.fit(),n.editor.scoreState.isPaginatedMode()?n.doPrint():(n.editor.setFitMode(a.PAGINATED_DISPLAY),n.editor.isFitDirty.subscribe(function(e){e||n.doPrint()})))},n.cancel=function(){n.cancelled(!0)},n.startPrinting=function(){n.state("starting"),window.jsPDF?n.print():NF.loadScript(NF.asset("js/printingLib.js"),n.print)},n.startPrinting()}},function(e,t,o){"use strict";var r=o(3);Noteflight.RecordingSettings=function(e,t){this.editor=e,this.title=t,r.DialogViewModel.call(this),this.countInMeasures=ko.observable(e.controller.performer.countInMeasures),this.countInMeasures.subscribe(function(t){e.controller.performer.countInMeasures=t}),this.mutePartForRecording=e.mutePartForRecording}},function(e,t,o){"use strict";var r=o(0),n=o(3),i=o(241),a=o(189);Noteflight.TranscriberSettings=function(e,t){var o=this;o.editor=e,o.title=t,n.DialogViewModel.call(this),o.countInMeasures=ko.observable(e.controller.performer.countInMeasures),o.countInMeasures.subscribe(function(t){e.controller.performer.countInMeasures=t}),o.basicOptionsMenu=ko.observableArray([]);var s=$$nf.classes.com.noteflight.music.pitch.ChromaticPitch;o.splitStaves=ko.observable(o.editor.controller.transcriber.settings.splitStaves),o.splitStaves.subscribe(function(e){o.editor.controller.transcriber.settings.splitStaves=e}),o.staffThreshold=ko.observable(o.editor.controller.transcriber.settings.staffThreshold);var l=new s(o.staffThreshold());o.staffThresholdToShow=ko.observable(l.toString()),o.staffThreshold.subscribe(function(){o.editor.controller.transcriber.settings.staffThreshold=o.staffThreshold();var e=new s(o.staffThreshold());o.staffThresholdToShow(e.toString())}),o.customQuantization=ko.observable(o.editor.controller.transcriber.settings.customQuantization),o.customQuantization.subscribe(function(e){o.editor.controller.transcriber.settings.customQuantization=e}),o.customQuantizationValue=ko.observable(o.editor.controller.transcriber.settings.customQuantizationValue),o.customQuantizationValue.subscribe(function(e){o.editor.controller.transcriber.settings.customQuantizationValue=e}),o.customQuantizationValueToShow=ko.computed(function(){return(0,i.valueToLabel)(o.customQuantizationValue())}),[{property:"detectTriplets",path:o.editor.controller.transcriber.settings,text:"content.detectTriplets"},{property:"isEchoNotesRecordingEnabled",path:o.editor.controller,text:"content.echoNotes"}].forEach(function(e){(0,a.createBasicBinding)(o,e),o.basicOptionsMenu.push({isChecked:o[e.property],text:(0,r.resource)(e.text)})}),o.more=function(e){e(e()+1)},o.less=function(e){e(e()-1)},o.previousNoteName=function(){o.customQuantizationValue(Math.max(o.customQuantizationValue()-1,0))},o.followingNoteName=function(){o.customQuantizationValue(Math.min(o.customQuantizationValue()+1,10))}}},function(e,t,o){"use strict";var r=o(0),n=o(3);Noteflight.InstrumentTunerStringViewModel=function(e,t,o,r){var n=this;ko.mapping.fromJS(t,{},this),n.stringBottom=ko.observable(386),n.rodHeight=12,n.rodWidth=Math.abs(n.pegX()-n.postX()),n.rodY=n.pegY()-6,n.rodX=n.pegX()>n.stringX2()?n.stringX2():n.pegX(),n.note=ko.observable(o.note),n.accidental=ko.observable(o.accidental),n.octave=ko.observable(o.octave),n.select=function(){e.selectString(n)},n.isSelected=ko.computed(function(){return e.selectedString()==n}),n.pegClass=ko.computed(function(){return n.isSelected()?"string current":"string"}),n.setValue=function(e){n.note(e.note),n.accidental(e.accidental),n.octave(e.octave)},n.stringLabel=ko.computed(function(){return"String "+(r+1)})},Noteflight.TuningDialog=function(e,t,o){var i=this;i.title=t,n.DialogViewModel.call(this);$$nf.classes.com.noteflight.notation.model.TablatureClef,$$nf.classes.com.noteflight.notation.model.Staff;var a=$$nf.classes.com.noteflight.notation.model.Interval,s=$$nf.classes.com.noteflight.notation.model.Note,l=$$nf.classes.com.noteflight.music.pitch.ChromaticPitch,c=$$nf.classes.com.noteflight.notation.performance.IdentityScorePositionMap,u=$$nf.classes.com.noteflight.performance.MusicRealizer,d=$$nf.classes.com.noteflight.performance.PerformableNote,p=$$nf.classes.com.noteflight.performance.Performance,f=$$nf.classes.com.noteflight.performance.MusicPlayerManager,h=o.staves[0];e.controller.selectStaff(h);var m=h.getMeasureAt(0).getNotatedClefAtMeasurePosition(0);i.player=ko.observable(),i.isValid=function(){return i.isTabClef()&&i.staffLengthOK()};var g="";void 0!==m.staffNotes&&(4==m.staffNotes.length&&(g=-1!=h.part.instrumentUri.indexOf("ukulele")?"ukulele":"bass"),5==m.staffNotes.length&&(g="banjo"),6==m.staffNotes.length&&(g="guitar"));var b=[{layoutName:"4Strings",strings:[{pegX:202,pegY:120,postX:150,stringX1:145,stringY1:151,stringX2:145},{pegX:207,pegY:60,postX:150,stringX1:129,stringY1:151,stringX2:145},{pegX:35,pegY:60,postX:92,stringX1:113,stringY1:151,stringX2:97},{pegX:40,pegY:120,postX:92,stringX1:97,stringY1:151,stringX2:97}],capoOriginY:161,capoIncrementY:15,capoMaxY:361},{layoutName:"5Strings",strings:[{pegX:202,pegY:120,postX:158,stringX1:153,stringY1:151,stringX2:155},{pegX:207,pegY:60,postX:153,stringX1:137,stringY1:151,stringX2:148},{pegX:35,pegY:60,postX:105,stringX1:121,stringY1:151,stringX2:110},{pegX:40,pegY:120,postX:100,stringX1:105,stringY1:151,stringX2:105},{pegX:40,pegY:255,postX:84,stringX1:89,stringY1:255,stringX2:87}],capoOriginY:161,capoIncrementY:15,capoMaxY:361},{layoutName:"6Strings",strings:[{pegX:197,pegY:180,postX:153,stringX1:148,stringY1:216,stringX2:148},{pegX:202,pegY:120,postX:153,stringX1:137,stringY1:216,stringX2:148},{pegX:207,pegY:60,postX:153,stringX1:126,stringY1:216,stringX2:148},{pegX:35,pegY:60,postX:88,stringX1:115,stringY1:216,stringX2:93},{pegX:40,pegY:120,postX:88,stringX1:104,stringY1:216,stringX2:93},{pegX:45,pegY:180,postX:88,stringX1:93,stringY1:216,stringX2:93}],capoOriginY:226,capoIncrementY:10,capoMaxY:361}],v=[{setName:"guitarSet",tunings:[{label:(0,r.resource)("content.standard"),stringValues:[{note:"E",octave:4,accidental:""},{note:"B",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:2,accidental:""},{note:"E",octave:2,accidental:""}]},{label:(0,r.resource)("content.halfStepDown"),stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"C",octave:3,accidental:""},{note:"G",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:(0,r.resource)("content.fullStepDown"),stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"C",octave:3,accidental:""},{note:"G",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:(0,r.resource)("content.drop")+" D",stringValues:[{note:"E",octave:4,accidental:""},{note:"B",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:(0,r.resource)("content.open")+" D",stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:(0,r.resource)("content.open")+" C",stringValues:[{note:"E",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:3,accidental:""},{note:"C",octave:3,accidental:""},{note:"G",octave:2,accidental:""},{note:"C",octave:2,accidental:""}]},{label:(0,r.resource)("content.open")+" G",stringValues:[{note:"D",octave:4,accidental:""},{note:"B",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"G",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:"D "+(0,r.resource)("content.modal"),stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:2,accidental:""},{note:"D",octave:2,accidental:""}]},{label:(0,r.resource)("content.baritone"),stringValues:[{note:"B",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:2,accidental:""},{note:"E",octave:2,accidental:""},{note:"B",octave:1,accidental:""}]}]},{setName:"bassSet",tunings:[{label:(0,r.resource)("content.standard"),stringValues:[{note:"G",octave:2,accidental:""},{note:"D",octave:2,accidental:""},{note:"A",octave:1,accidental:""},{note:"E",octave:1,accidental:""}]},{label:(0,r.resource)("content.drop")+" D",stringValues:[{note:"G",octave:2,accidental:""},{note:"D",octave:2,accidental:""},{note:"A",octave:1,accidental:""},{note:"D",octave:1,accidental:""}]},{label:(0,r.resource)("content.halfStepDown"),stringValues:[{note:"F",octave:2,accidental:""},{note:"C",octave:2,accidental:""},{note:"G",octave:1,accidental:""},{note:"D",octave:1,accidental:""}]},{label:(0,r.resource)("content.fullStepDown"),stringValues:[{note:"F",octave:2,accidental:""},{note:"C",octave:2,accidental:""},{note:"G",octave:1,accidental:""},{note:"D",octave:1,accidental:""}]}]},{setName:"ukeSet",tunings:[{label:(0,r.resource)("content.standardReentrant"),stringValues:[{note:"A",octave:4,accidental:""},{note:"E",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:4,accidental:""}]},{label:(0,r.resource)("content.standardLinear"),stringValues:[{note:"A",octave:4,accidental:""},{note:"E",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:3,accidental:""}]},{label:(0,r.resource)("content.baritone"),stringValues:[{note:"E",octave:4,accidental:""},{note:"B",octave:4,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""}]},{label:(0,r.resource)("content.english"),stringValues:[{note:"B",octave:4,accidental:""},{note:"F",octave:4,accidental:""},{note:"D",octave:4,accidental:""},{note:"A",octave:4,accidental:""}]},{label:(0,r.resource)("content.canadian"),stringValues:[{note:"B",octave:4,accidental:""},{note:"F",octave:4,accidental:""},{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""}]},{label:(0,r.resource)("content.slackKey"),stringValues:[{note:"G",octave:4,accidental:""},{note:"E",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:4,accidental:""}]}]},{setName:"banjoSet",tunings:[{label:(0,r.resource)("content.tuning.gStandard"),stringValues:[{note:"D",octave:4,accidental:""},{note:"B",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"G",octave:4,accidental:""}]},{label:(0,r.resource)("content.tuning.gModal"),stringValues:[{note:"D",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"G",octave:4,accidental:""}]},{label:(0,r.resource)("content.tuning.cDouble"),stringValues:[{note:"D",octave:4,accidental:""},{note:"C",octave:4,accidental:""},{note:"G",octave:3,accidental:""},{note:"C",octave:3,accidental:""},{note:"G",octave:4,accidental:""}]},{label:(0,r.resource)("content.tuning.cStandard"),stringValues:[{note:"D",octave:4,accidental:""},{note:"B",octave:3,accidental:""},{note:"G",octave:3,accidental:""},{note:"C",octave:3,accidental:""},{note:"G",octave:4,accidental:""}]},{label:(0,r.resource)("content.tuning.dStandardF"),stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"F",octave:4,accidental:""}]},{label:(0,r.resource)("content.tuning.dStandardA"),stringValues:[{note:"D",octave:4,accidental:""},{note:"A",octave:3,accidental:""},{note:"F",octave:3,accidental:""},{note:"D",octave:3,accidental:""},{note:"A",octave:4,accidental:""}]}]}],y=[{instrument:"guitar",layout:"6Strings",tuningSet:"guitarSet"},{instrument:"bass",layout:"4Strings",tuningSet:"bassSet"},{instrument:"ukulele",layout:"4Strings",tuningSet:"ukeSet"},{instrument:"banjo",layout:"5Strings",tuningSet:"banjoSet"}];i.layoutName=null,i.layout=ko.observable(null),i.instrumentSet=null,i.tunings=null;for(var _=0;_<y.length;_++)if(y[_].instrument==g){i.layoutName=y[_].layout;for(var S=y[_].tuningSet,w=0;w<v.length;w++)v[w].setName==S&&(i.tunings=v[w].tunings);break}for(_=0;_<b.length;_++)if(i.layoutName==b[_].layoutName){i.layout(b[_]);break}if(i.initialStringValues=[],void 0!==m.tuning){var k=m.tuning;for(_=0;_<k.length;_++){var E=k[_][0],P="",C=1;k[_].length>2?("#"==k[_][1]&&(P=""),C=k[_][2]):(P="",C=k[_][1]),i.initialStringValues.push({note:E,octave:C,accidental:P})}}if(i.strings=[],i.layout()){for(i.tuningSelected=ko.observable(!0),i.capoSelected=ko.observable(!1),i.selectedString=ko.observable(null),_=0;_<i.layout().strings.length;_++)i.strings.push(new Noteflight.InstrumentTunerStringViewModel(i,i.layout().strings[_],i.initialStringValues[_],_));i.selectString=function(e){for(i.tuningSelected(!1),i.capoSelected(!1),i.selectedString(e),_=0;_<i.stringValues.length;_++)if(i.selectedString().note()==i.stringValues[_].note&&i.selectedString().octave()==i.stringValues[_].octave&&i.selectedString().accidental()==i.stringValues[_].accidental){$("#stringTable").scrollTop(30*_-120);break}var t=i.createNoteStringOne(i.selectedString());i.playNote(new s(l.pitchFromString(t)))},i.selectTuning=function(){i.capoSelected(!1),i.selectedString(null),i.tuningSelected(!0),i.playTuning()},i.selectCapo=function(){i.tuningSelected(!1),i.selectedString(null),i.capoSelected(!0)},i.capoPositions=[{value:0,label:(0,r.resource)("content.noCapo")},{value:1,label:(0,r.resource)("content.fret")+" 1"},{value:2,label:(0,r.resource)("content.fret")+" 2"},{value:3,label:(0,r.resource)("content.fret")+" 3"},{value:4,label:(0,r.resource)("content.fret")+" 4"},{value:5,label:(0,r.resource)("content.fret")+" 5"},{value:6,label:(0,r.resource)("content.fret")+" 6"},{value:7,label:(0,r.resource)("content.fret")+" 7"},{value:8,label:(0,r.resource)("content.fret")+" 8"},{value:9,label:(0,r.resource)("content.fret")+" 9"},{value:10,label:(0,r.resource)("content.fret")+" 10"},{value:11,label:(0,r.resource)("content.fret")+" 11"},{value:12,label:(0,r.resource)("content.fret")+" 12"},{value:13,label:(0,r.resource)("content.fret")+" 13"},{value:14,label:(0,r.resource)("content.fret")+" 14"},{value:15,label:(0,r.resource)("content.fret")+" 15"}],i.capoPosition=ko.observable(0),void 0!==m.capo&&i.capoPosition(m.capo),i.setCapoPostion=function(e){i.capoPosition(e.value),i.playTuning()},i.currentCapoText=ko.computed(function(){return i.capoPositions[i.capoPosition()].label}),i.currentCapoPosition=ko.computed(function(){return"translate(81, "+Math.min(i.layout().capoMaxY,i.layout().capoOriginY+i.capoPosition()*i.layout().capoIncrementY)+")"}),i.capoClass=ko.computed(function(){return i.capoSelected()?"capo current":"capo"}),i.stringValues=[];for(var T=[{note:"C",accidental:""},{note:"C",accidental:""},{note:"D",accidental:""},{note:"D",accidental:""},{note:"E",accidental:""},{note:"F",accidental:""},{note:"F",accidental:""},{note:"G",accidental:""},{note:"G",accidental:""},{note:"A",accidental:""},{note:"A",accidental:""},{note:"B",accidental:""}],R=0;R<=7;R++)for(var O=0;O<T.length;O++)i.stringValues.push({label:T[O].note+" "+T[O].accidental,note:T[O].note,octave:R,accidental:T[O].accidental});i.stringValues.push({label:"C",note:"C",octave:"8",accidental:""}),i.setStringValue=function(e){var t=i.createNoteStringTwo(e),o=new s(l.pitchFromString(t));i.playNote(o),i.selectedString().setValue(e)},i.tuningClass=ko.computed(function(){return i.tuningSelected()?"tuning current":"tuning"}),i.currentTuningIndex=ko.computed(function(){for(var e=0;e<i.tunings.length;e++){for(var t=!0,o=0;o<i.strings.length;o++){var r=i.tunings[e].stringValues[o],n=i.strings[o];if(r.note!=n.note()||r.accidental!=n.accidental()||r.octave!=n.octave()){t=!1;break}}if(t)return e}return-1}),i.currentTuningLabel=ko.computed(function(){return-1==i.currentTuningIndex()?"Custom":i.tunings[i.currentTuningIndex()].label}),i.setTuning=function(e){for(var t=0;t<i.strings.length;t++)i.strings[t].setValue(e.stringValues[t]);i.playTuning()},i.createNoteStringOne=function(e){var t=e.note();return""==e.accidental()&&(t+="#"),t+=e.octave()},i.createNoteStringTwo=function(e){var t=e.note;return""==e.accidental&&(t+="#"),t+=e.octave},i.playNote=function(t){var o=[];o.push(t.transposeInterval(a.fromPitches(i.capoPosition()))),e.controller.performer.echoNotes(o,1,h)},i.playTuning=function(){i.player()&&(i.player().stop(),i.player(null));for(var t=[],o=0;o<i.strings.length;o++){var r=i.createNoteStringOne(i.strings[o]);t.push(new s(l.pitchFromString(r)).transposeInterval(a.fromPitches(i.capoPosition())))}t.reverse(),e.startSound(function(){i.doPlayTuning(t)})},i.doPlayTuning=function(e){if(e.length>=0){var t=new p,o=0;$.each(e,function(r,n){var i=new d;i.onset=o,i.channel=0,i.pitch=n.pitch,i.velocity=d.STANDARD_VELOCITY,i.duration=.3*(2+e.length-r),t.addElement(i),o+=.3});var r=new u([null],new c,{parts:[h.part]});i.player(f.getInstance().createMusicPlayer(t,r)),i.player()&&i.player().play()}},i.applyTuning=function(){for(var t=[],o=0;o<i.strings.length;o++){var r=i.createNoteStringOne(i.strings[o]);t.push(r)}t.reverse();var s=m.clone();s.capo=i.capoPosition(),s.tuning=t;var l=i.capoPosition()-m.capo,c=a.fromPitches(l).toString();e.controller.document.undoHistory.openGroup("Change Tuning"),e.controller.changeClef(s),0!==l&&e.controller.transposeSelectionInterval(c),(0,n.hideCurrentDialog)()}}}},function(e,t,o){"use strict";var r=o(3),n=function(e,t){this.dialog=e,this.version=t,this.selected=ko.observable(!1),this.userLink=ko.computed(function(){return Noteflight.paths.profile({userId:t.creator().external_id()})})};Noteflight.VersionHistoryDialog=function(e){var t=this;r.DialogViewModel.call(this),t.editor=e,t.currentVersion=ko.observable(),t.versions=ko.observableArray(),t.editor.saving.subscribe(function(e){e||t.loadVersions()}),t.revertEnabled=ko.computed(function(){return!t.editor.saving()&&t.versions().length>0&&t.versions()[0]!=t.currentVersion()}),t.revert=function(){t.editor.save(),t.editor.loadingFromVersionHistory(!1)},t.close=function(){t.versions().length&&(t.currentVersion(t.versions()[0]),t.editor.loadingFromVersionHistory(!1)),(0,r.hideCurrentDialog)(t)},t.currentVersion.subscribe(function(e){e&&e.version.version_id()!=t.editor.score().versionId()&&(t.editor.score().version(e.version),t.editor.loadScore(e.version.version_uri()))}),t.versionSelectionChanged=function(e){t.currentVersion()&&t.currentVersion().selected(!1),e.selected(!0),t.currentVersion(e),e!=t.versions()[0]&&t.editor.loadingFromVersionHistory(!0)},t.versionsFetched=function(){for(var e=t.editor.score().versions(),o=e.length-1;o>=0;o--)t.versions.push(new n(t,e[o]));t.versionSelectionChanged(t.versions()[0])},t.loadVersions=function(){t.versions([]),t.editor.score().versions([]),t.editor.scoreEditor.fetchScoreData({facet:"versions",versions_offset:0,versions_limit:t.editor.score().versions_count()},{done:t.versionsFetched})},t.loadVersions()}},function(e,t,o){"use strict";var r=o(16);Noteflight.WebMidiConnector=function(e){var t=this;t.editor=e,t.documentController=t.editor.documentController,t.timeStampFactor=null,t.midi=null;var o=$$nf.classes.com.noteflight.notation.event.MidiMessageEvent,n=$$nf.classes.com.noteflight.notation.model.MidiSocketMessage;function i(e,t){var r=new n("");return r.timestampInMilliseconds=t.timeStamp,r.type=e,r.pitch=t.data[1],r.velocity=t.data[2],new o(e,r)}function a(e){var r=i(o.NOTE_OFF,e);t.editor.controller.noteOff(r.message.pitch-12),t.editor.midiInputManager.handleNoteOff(r,!1)}function s(e){switch(240&e.data[0]){case 144:0!==e.data[2]?function(e){var r=i(o.NOTE_ON,e);t.editor.controller.noteOn(r.message.pitch-12,r.message.velocity),t.editor.midiInputManager.handleNoteOn(r,!1)}(e):a(e);break;case 128:a(e)}}function l(e){t.midi=e;var o=!1,r=e.inputs.values();t.editor.webMidiEnabled(!0);for(var n=r.next();n&&!n.done;n=r.next()){(n=n.value).name.toString();o=!0,n.onmidimessage=s}t.editor.midiKeyboardPluggedIn(o)}function c(e){(0,r.debug)("MIDI ERROR: "+e)}t.initialize=function(){if(window.navigator.requestMIDIAccess)window.navigator.requestMIDIAccess().then(l,c);else(0,r.debug)("MIDI not enabled")}}},function(e,t,o){"use strict";o(1256),o(1257),o(1258)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o(96)),n=o(2),i=o(0),a=o(19),s=l(o(123));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?f(e):t}(this,d(t).call(this))).activeHeaderTag("marketplace"),e.doesSearch(!0),e.showSearchBarForMobile(!0),e.doesFilter((0,a.isPhoneLayoutOrSmaller)()),e.templateName=ko.observable("content/marketplace"),e.name=ko.observable("marketplace"),e.titleResource=ko.observable(),e.title=ko.computed(function(){return(0,i.resource)(e.titleResource())}),e.filter=ko.observable(),(0,a.isPhoneLayoutOrSmaller)()&&e.initializeFilterForPhones(),e.searchConfiguration={marketplace_with_contribs:8},e.searchPlaceholder="action.searchForSongsArtistsComposers",e.navigateToAllScores=e.navigateToAllScores.bind(f(f(e))),e.closeFilter=e.closeFilter.bind(f(f(e))),e.filterSelection=e.filterSelection.bind(f(f(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.default),function(e,t,o){t&&u(e.prototype,t),o&&u(e,o)}(t,[{key:"initializeFilterForPhones",value:function(){this.filter(new s.default({callback:this.filterSelection.bind(this),title:"content.viewAllScores",titleColor:"colorPremium",titleCallback:this.navigateToAllScores})),this.filter().initialize({searchProducts:!0})}},{key:"closeFilter",value:function(){this.showFilter(!1)}},{key:"filterSelection",value:function(e){var t=null;for(var o in e.selection)if(e.selection[o].length>0){t=o;break}var r="".concat(t,":").concat(encodeURIComponent(e.selection[t][0]));(0,n.navigate)((0,n.path)("marketplaceSearchQuery",{searchQuery:encodeURI(r)}))}},{key:"navigateToAllScores",value:function(){(0,n.navigate)((0,n.path)("marketplaceSearch"))}}]),t}();t.default=h,(0,n.addRoute)("marketplace","/marketplace#/",h,{titleResource:"content.noteflightMarketplace"}),(0,n.addRoute)("songCatalog","/marketplace/song_catalog#/",h,{titleResource:"content.songCatalog"})},function(e,t,o){"use strict";var r=c(o(4)),n=o(5),i=c(o(96)),a=c(o(123)),s=o(2),l=o(19);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}(this,p(t).call(this))).activeHeaderTag("marketplace"),e.templateName=ko.observable("content/marketplaceSearch"),e.name=ko.observable("marketplace"),e.doesSearch(!0),e.doesFilter(!0),e.showSearchBarForMobile(!0),e.showFilter=ko.observable(!(0,l.isPhoneLayoutOrSmaller)()),e.showFilter.subscribe(function(e){r.default.publish(n.FILTER_TOGGLE,{open:e})}),e.searchQuery=ko.observable(),e.searchQuery.subscribe(function(t){e.broadcastQuery(),NF.hasStorage&&localStorage.setItem("marketplaceSearchQuery",encodeURI(t))}),e.filter=ko.observable(new a.default({callback:e.filterSelection.bind(h(h(e))),listenToUpdatedAggregations:!0})),e.searchConfiguration={marketplace_with_contribs:8},e.searchPlaceholder="action.searchForSongsArtistsComposers",r.default.subscribe(n.SEARCH_QUERY_REQUESTED,function(t,o){e.broadcastQuery()}),e.closeFilter=function(){e.showFilter(!1)},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,i.default),function(e,t,o){t&&d(e.prototype,t),o&&d(e,o)}(t,[{key:"filterSelection",value:function(e){r.default.publish(n.FILTER_SELECTION,e)}},{key:"broadcastQuery",value:function(){r.default.publish(n.SEARCH_QUERY_BROADCAST,this.searchQuery())}}]),t}();(0,s.addRoute)("marketplaceSearch","/marketplace/search#",m,{searchQuery:"all"}),(0,s.addRoute)("marketplaceSearchQuery","/marketplace/search#/{searchQuery}",m,{})},function(e,t,o){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(o(96)),n=o(2);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,s(t).call(this))).doesSearch(!0),e.name=ko.observable("collection"),e.searchConfiguration={marketplace_with_contribs:5},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),t}();(0,n.addRoute)("collectionPage","/collection/{id}/#",c,{})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(96)),n=o(2);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,s(t).call(this))).templateName=ko.observable("content/react"),e.name=ko.observable("community"),e.doesSearch(!0),e.showSearchBarForMobile(!0),e.activeHeaderTag("community"),e.searchConfiguration={score:3,group:3,marketplace_with_contribs:1,communitymember:2},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r.default),t}();t.default=c,(0,n.addRoute)("community","/community#",c,{})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(o(13)),n=o(0),i=o(3);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,c(t).call(this))).serviceReporter=new Noteflight.ServiceReporterViewModel((0,n.resource)("action.unlinking")),e.serviceReporter.showErrorsInBackground(!1),e.initializeObservables(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r.default),function(e,t,o){t&&s(e.prototype,t),o&&s(e,o)}(t,[{key:"initializeObservables",value:function(){this.success=ko.observable(!1),this.unlinking=ko.observable(!1)}},{key:"unlinkAccount",value:function(){var e=this;this.unlinking(!0),this.clearErrors(),NF.apiService.unlinkAccounts(this.serviceReporter,function(t){e.clearErrors(),e.success(!0),NF.analytics.trackEvent("webapp","unlink_account")},{},{always:function(){e.unlinking(!1)}})}},{key:"unlinkSucceeded",value:function(){NF.reloadWindow()}},{key:"show",value:function(){(0,i.createAndShowDialog)({viewModel:this,templateName:"dialogs/unlinkAccounts"})}},{key:"clearErrors",value:function(){this.serviceReporter.errors([])}}]),t}();t.default=d,NF.UnlinkAccountsViewModel=d},function(e,t,o){"use strict";var r=o(0);Noteflight.CollectionRow=function(e,t,o){var n=this;Noteflight.SelectionItem.call(n,t),n.name=ko.observable(e.name),n.id=ko.observable(e.id),n.editable=ko.observable(!0),n.editingList=e.editingList,n.removeCallback=o.removeCallback,n.contextMenuItems=function(){return[{label:(0,r.resource)("action.delete"),action:n._removeCollection}]},n._removeCollection=function(){NF.apiService.removeFromCollection((0,r.resource)("action.deleting"),function(){n.removeCallback&&n.removeCallback(n.id())},{collection_type:"CollectionCollection",score_ids:[n.id()],collection_id:t.collectionId()})}}},function(e,t,o){var r={"./activity/activityStreamListing.html":1263,"./admin/addSiteUsers.html":1264,"./admin/forumSettings.html":1265,"./alerts/account.html":1266,"./alerts/alert.html":1267,"./alerts/global.html":1268,"./app/leftSideBar.html":1269,"./app/main.html":1270,"./charts/pie.html":1271,"./charts/timeframe.html":1272,"./commerce/commerceForm.html":1273,"./commerce/purchaseConfirmation.html":1274,"./commerce/quoteConfirmation.html":1275,"./content/account.html":1276,"./content/activateAccount.html":1277,"./content/activateCode.html":1278,"./content/blank.html":1279,"./content/changeEmailComplete.html":1280,"./content/confirmIdentity.html":1281,"./content/contentPackage.html":1282,"./content/dashboard.html":1283,"./content/default.html":1284,"./content/details/authorInformationSection.html":1285,"./content/details/commentsSection.html":1286,"./content/details/contentLibrarySection.html":1287,"./content/details/coverArt.html":1288,"./content/details/productActionSection.html":1289,"./content/details/productInformation.html":1290,"./content/details/publishProductUpdatesSection.html":1291,"./content/details/recommendedSection.html":1292,"./content/details/reviews.html":1293,"./content/details/saveProductCopySection.html":1294,"./content/details/scoreDetailsPanel.html":1295,"./content/details/scoreFacets.html":1296,"./content/details/sellScoreSection.html":1297,"./content/details/shareScoreSection.html":1298,"./content/details/socialStatsSection.html":1299,"./content/editor.html":1300,"./content/error.html":1301,"./content/forumCreate.html":1302,"./content/forumDiscussions.html":1303,"./content/forumIndex.html":1304,"./content/group.html":1305,"./content/groups.html":1306,"./content/help_new.html":1307,"./content/inactiveSccError.html":1308,"./content/info.html":1309,"./content/initiateGiftCard3.html":1310,"./content/initiatePurchaseOrder.html":1311,"./content/legal.html":1312,"./content/library.html":1313,"./content/marketplace.html":1314,"./content/marketplaceSearch.html":1315,"./content/mediaSyncEditor.html":1316,"./content/mustLogin.html":1317,"./content/newSite/fragments/googleClassroom.html":1318,"./content/oauthRequestAccess.html":1319,"./content/premiumTrial.html":1320,"./content/printGiftCard2.html":1321,"./content/privateScores.html":1322,"./content/productEmbedBottomContainer.html":1323,"./content/profile.html":1324,"./content/publicMembers.html":1325,"./content/publicScores.html":1326,"./content/purchaseGiftCardRecurly.html":1327,"./content/react.html":1328,"./content/redeemedArrangement.html":1329,"./content/redeemedBook.html":1330,"./content/redeemedBoxProduct.html":1331,"./content/redeemedGiftCert.html":1332,"./content/requestLearnDemo.html":1333,"./content/review.html":1334,"./content/sccHome.html":1335,"./content/siteActivate.html":1336,"./content/test.html":1337,"./content/unknownContentPackage.html":1338,"./content/updateProfileInfo.html":1339,"./content/verificationFailure.html":1340,"./content/viewer.html":1341,"./content/workbook1Listing.html":1342,"./content/workbook1WorkingCopy.html":1343,"./dialogs/addToBlacklist.html":1344,"./dialogs/addToCollection.html":1345,"./dialogs/alert.html":1346,"./dialogs/alertSequence.html":1347,"./dialogs/beforeUnload.html":1348,"./dialogs/blackboxing.html":1349,"./dialogs/cancelProductEditing.html":1350,"./dialogs/changePassword.html":1351,"./dialogs/changeRole.html":1352,"./dialogs/collectionDetails.html":1353,"./dialogs/collectionOfCollections.html":1354,"./dialogs/collectionSettings.html":1355,"./dialogs/confirmProfileUpdate.html":1356,"./dialogs/confirmProvider.html":1357,"./dialogs/copyToSite.html":1358,"./dialogs/deleteAccount.html":1359,"./dialogs/deleteCustomerCard.html":1360,"./dialogs/deletePost.html":1361,"./dialogs/demoAlert.html":1362,"./dialogs/editPost.html":1363,"./dialogs/editProductOptions.html":1364,"./dialogs/editorTip.html":1365,"./dialogs/embedDialog.html":1366,"./dialogs/errorBand.html":1367,"./dialogs/flag.html":1368,"./dialogs/flagComment.html":1369,"./dialogs/flagDocument.html":1370,"./dialogs/flagGlobalDialog.html":1371,"./dialogs/flagPost.html":1372,"./dialogs/formatScoreBeforeSelling.html":1373,"./dialogs/googleAuth.html":1374,"./dialogs/handleDeactivatedUsers.html":1375,"./dialogs/handleExistingActiveUsers.html":1376,"./dialogs/imageEditor.html":1377,"./dialogs/imagePicker.html":1378,"./dialogs/linkAccounts.html":1379,"./dialogs/login.html":1380,"./dialogs/massResetPasswords.html":1381,"./dialogs/modernAlert.html":1382,"./dialogs/mustBePremium.html":1383,"./dialogs/mustCreateProfile.html":1384,"./dialogs/mustLoginSignup.html":1385,"./dialogs/newlyPublishedProduct.html":1386,"./dialogs/oauthRequestAccessDialog.html":1387,"./dialogs/okBack.html":1388,"./dialogs/okCancel.html":1389,"./dialogs/printSelectionDialog.html":1390,"./dialogs/privacyAndSecurity.html":1391,"./dialogs/reactComponentDialog.html":1392,"./dialogs/reorderForum.html":1393,"./dialogs/requestAdmission.html":1394,"./dialogs/scorePurchase.html":1395,"./dialogs/scorePurchaseCreateAccount.html":1396,"./dialogs/scorePurchaseCreateIdentity.html":1397,"./dialogs/scorePurchaseLogin.html":1398,"./dialogs/scorePurchaseShoppingCart.html":1399,"./dialogs/scorePurchaseWallet.html":1400,"./dialogs/scoreTitlePrompt.html":1401,"./dialogs/sellScore.html":1402,"./dialogs/signup.html":1403,"./dialogs/simpleDialog.html":1404,"./dialogs/stopSelling.html":1405,"./dialogs/syncClassroom.html":1406,"./dialogs/unlinkAccounts.html":1407,"./dialogs/writeReview.html":1408,"./editor/fragments/commerceLinks.html":1409,"./editor/fragments/googleClassroomCourseWorkCreation.html":1410,"./editor/fragments/googleClassroomScoreInfo.html":1411,"./editor/fragments/googleClassroomTurnInForm.html":1412,"./fragments/accountProfile.html":1413,"./fragments/accountStatus.html":1414,"./fragments/activateAccount.html":1415,"./fragments/addCustomerCard.html":1416,"./fragments/audioPreview.html":1417,"./fragments/billingAddress.html":1418,"./fragments/billingInfo.html":1419,"./fragments/billingInfoData.html":1420,"./fragments/billingInfoRecurly.html":1421,"./fragments/billingInfoWithCreditCard.html":1422,"./fragments/bookSummary.html":1423,"./fragments/card.html":1424,"./fragments/catalogScores.html":1425,"./fragments/collectionHeader.html":1426,"./fragments/collectionRow.html":1427,"./fragments/creditCard.html":1428,"./fragments/creditCardData.html":1429,"./fragments/creditCardRecurly.html":1430,"./fragments/customerCard.html":1431,"./fragments/customerWallet.html":1432,"./fragments/discussions.html":1433,"./fragments/editIdentity.html":1434,"./fragments/errorBanner.html":1435,"./fragments/flaggedPost.html":1436,"./fragments/forumIndex.html":1437,"./fragments/freeLibrary.html":1438,"./fragments/group.html":1439,"./fragments/groupsListing.html":1440,"./fragments/imageUploader.html":1441,"./fragments/infoPopup.html":1442,"./fragments/instrumentsMapping.html":1443,"./fragments/librariesInfoBlock.html":1444,"./fragments/library.html":1445,"./fragments/libraryListing.html":1446,"./fragments/libraryScores.html":1447,"./fragments/libraryScoresListing.html":1448,"./fragments/markdownTip.html":1449,"./fragments/marketplaceListing.html":1450,"./fragments/mediaSyncEditorButtons.html":1451,"./fragments/mediaSyncPlayer.html":1452,"./fragments/mediaSyncProgressBar.html":1453,"./fragments/memberCard.html":1454,"./fragments/officialBadge.html":1455,"./fragments/product.html":1456,"./fragments/profileOptionalInfo.html":1457,"./fragments/publicScores.html":1458,"./fragments/resendActivation.html":1459,"./fragments/sccCommunityGroup.html":1460,"./fragments/scoreSearch.html":1461,"./fragments/scoreWork.html":1462,"./fragments/scoreWorkBlackbox.html":1463,"./fragments/scoreWorkRadio.html":1464,"./fragments/scoresFilter.html":1465,"./fragments/search.html":1466,"./fragments/searchResults.html":1467,"./fragments/sellScoreCopyright.html":1468,"./fragments/sellScoreDetails.html":1469,"./fragments/sellScoreEnsembleAndPrice.html":1470,"./fragments/sellScoreText.html":1471,"./fragments/sellerPayoutDestinationSetup.html":1472,"./fragments/sellerPayouts.html":1473,"./fragments/sellerSetupLanding.html":1474,"./fragments/sellerSignup.html":1475,"./fragments/simpleMemberCard.html":1476,"./fragments/smallMemberCard.html":1477,"./fragments/stars.html":1478,"./fragments/tip.html":1479,"./fragments/userMenu.html":1480,"./fragments/viewUpgrade.html":1481,"./group/activity.html":1482,"./group/addClasses.html":1483,"./group/createGroup.html":1484,"./group/discussions.html":1485,"./group/editGroup.html":1486,"./group/flaggedContent.html":1487,"./group/groupForm.html":1488,"./group/inviteTeachers.html":1489,"./group/manageForums.html":1490,"./group/members.html":1491,"./group/newForum.html":1492,"./group/overview.html":1493,"./group/scores.html":1494,"./group/siteMembers.html":1495,"./header/avatarButton.html":1496,"./header/errorsReporter.html":1497,"./header/fullScreenErrorReporter.html":1498,"./header/fullScreenReporter.html":1499,"./header/headerAttachResource.html":1500,"./header/headerLTIReplaceResult.html":1501,"./header/headerNeedToValidate.html":1502,"./header/reporter.html":1503,"./header/serviceReporter.html":1504,"./info/infoCharms.html":1505,"./info/infoDetails.html":1506,"./info/infoDevelopers.html":1507,"./info/infoHigherEd.html":1508,"./info/infoIndex.html":1509,"./info/infoPartners.html":1510,"./info/infoPlans.html":1511,"./info/infoSiteHome.html":1512,"./info/scoresWelcome.html":1513,"./item:global_banner.html":1514,"./library/catalog.html":1515,"./library/libraryMembers.html":1516,"./library/overview.html":1517,"./locale/ca/content/help_new.html":1518,"./locale/de/content/help_new.html":1519,"./locale/es/content/help_new.html":1520,"./locale/es_ES/content/help_new.html":1521,"./locale/fr/content/help_new.html":1522,"./locale/ja/content/help_new.html":1523,"./locale/sk_SK/content/help_new.html":1524,"./locale/zh-CN/content/help_new.html":1525,"./locale/zh-TW/content/help_new.html":1526,"./marketplace/breadcrumbHeader.html":1527,"./menu/context.html":1528,"./menu/customDropdown.html":1529,"./menu/hint.html":1530,"./messages/messagesList.html":1531,"./notifications/dismissableNotification.html":1532,"./notifications/inlineError.html":1533,"./notifications/validationUnderlay.html":1534,"./palette/actionButton.html":1535,"./palette/commonRealTimeFeedback.html":1536,"./palette/durationButton.html":1537,"./palette/editorHelp.html":1538,"./palette/helpControl.html":1539,"./palette/percentControl.html":1540,"./palette/popupMenu.html":1541,"./palette/popupSearch.html":1542,"./palette/popupSliderControl.html":1543,"./palette/popupZoomer.html":1544,"./palette/radioButton.html":1545,"./palette/recordingControl.html":1546,"./palette/searchControl.html":1547,"./palette/selectControl.html":1548,"./palette/separator.html":1549,"./palette/tempoControl.html":1550,"./palette/tempoNotePicker.html":1551,"./palette/tip.html":1552,"./palette/toggleButton.html":1553,"./palette/transcriberControl.html":1554,"./palette/urlButton.html":1555,"./palette/viewControl.html":1556,"./palette/zoomControl.html":1557,"./post/postView.html":1558,"./score/annotation.html":1559,"./score/calibrateLatency.html":1560,"./score/calibrateMic.html":1561,"./score/chooseInstrument.html":1562,"./score/exportScore.html":1563,"./score/filter.html":1564,"./score/forceSilentPlayback.html":1565,"./score/formattingPanel.html":1566,"./score/graceNotePanel.html":1567,"./score/html5EditorControls.html":1568,"./score/inputSelection.html":1569,"./score/instrumentsPanel.html":1570,"./score/keySignature.html":1571,"./score/libraryScoreRow.html":1572,"./score/libraryScoreRowBody.html":1573,"./score/localDraft.html":1574,"./score/localSaves.html":1575,"./score/mediaSyncViewer.html":1576,"./score/mixer.html":1577,"./score/mixerItem.html":1578,"./score/newScore.html":1579,"./score/printScore.html":1580,"./score/productItemBody.html":1581,"./score/productRowBody.html":1582,"./score/publicScoresListing.html":1583,"./score/recordingSettings.html":1584,"./score/saveAside.html":1585,"./score/scoreAnnotations.html":1586,"./score/scoreDragProxy.html":1587,"./score/scoreEditorPanelContents.html":1588,"./score/scoreHeaderPalette.html":1589,"./score/scoreItem.html":1590,"./score/scoreItemBody.html":1591,"./score/scoreRow.html":1592,"./score/scoreRowBody.html":1593,"./score/timeSignature.html":1594,"./score/track.html":1595,"./score/transcriberSettings.html":1596,"./score/transpose.html":1597,"./score/tuning.html":1598,"./score/versionHistory.html":1599,"./site/createSite.html":1600,"./site/editSite.html":1601,"./site/googleClassroomCourses.html":1602,"./site/siteForm.html":1603,"./strips/infoStrip.html":1604,"./strips/scoreStrip.html":1605};function n(e){var t=i(e);return o(t)}function i(e){var t=r[e];if(!(t+1)){var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return t}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=1262},function(e,t,o){e.exports=o.p+"templates/activity/activityStreamListing-6bd67b92c95361da398ece33575278fc.html"},function(e,t,o){e.exports=o.p+"templates/admin/addSiteUsers-4aa1bed941446f4f9f69d54b4f9276e0.html"},function(e,t,o){e.exports=o.p+"templates/admin/forumSettings-7f9732565b1f5853d6f58900ca491017.html"},function(e,t,o){e.exports=o.p+"templates/alerts/account-346277f477be8f01b6baee936d01253c.html"},function(e,t,o){e.exports=o.p+"templates/alerts/alert-c8600491f06b4f3eee58119ca525c44f.html"},function(e,t,o){e.exports=o.p+"templates/alerts/global-bb99dea395df2185fab98069e201b4d8.html"},function(e,t,o){e.exports=o.p+"templates/app/leftSideBar-ddc5971702a4e4959fd56cf41517681e.html"},function(e,t,o){e.exports=o.p+"templates/app/main-0f0c77d326f38954bd4b794d86b17527.html"},function(e,t,o){e.exports=o.p+"templates/charts/pie-954503b04ea942c4ea09476f3eca1bf9.html"},function(e,t,o){e.exports=o.p+"templates/charts/timeframe-ba7b96f508ae255fcc5854fe4b508ecf.html"},function(e,t,o){e.exports=o.p+"templates/commerce/commerceForm-437b680d111cc67441f327afaeb96457.html"},function(e,t,o){e.exports=o.p+"templates/commerce/purchaseConfirmation-3bd87572291a33acc168be502e995c04.html"},function(e,t,o){e.exports=o.p+"templates/commerce/quoteConfirmation-0ac2ef9be1080949d15d755bacb4e470.html"},function(e,t,o){e.exports=o.p+"templates/content/account-bbac2c0dbb3a82be32a98db92a2fd726.html"},function(e,t,o){e.exports=o.p+"templates/content/activateAccount-9f2e052355ab7938da7209a95ab12bba.html"},function(e,t,o){e.exports=o.p+"templates/content/activateCode-9daf3a6ba8e02bb9e298fb6a1c04ab44.html"},function(e,t,o){e.exports=o.p+"templates/content/blank-f49f7371f1c4e74cc5984cf9b2983a01.html"},function(e,t,o){e.exports=o.p+"templates/content/changeEmailComplete-8041b41dc862ed2114e955de64857b72.html"},function(e,t,o){e.exports=o.p+"templates/content/confirmIdentity-149eda40260b81c7d57004af86a43089.html"},function(e,t,o){e.exports=o.p+"templates/content/contentPackage-7fe4b40b95beb8f482dd40aaada605f4.html"},function(e,t,o){e.exports=o.p+"templates/content/dashboard-8a7077dd12c16e322f612c234814c5db.html"},function(e,t,o){e.exports=o.p+"templates/content/default-83ead2c929247cafc9234882cb35318e.html"},function(e,t,o){e.exports=o.p+"templates/content/details/authorInformationSection-d43cd6e978e157b9db54caa898607d73.html"},function(e,t,o){e.exports=o.p+"templates/content/details/commentsSection-d535fb4c136b001eb3e8fbd8f093fbc9.html"},function(e,t,o){e.exports=o.p+"templates/content/details/contentLibrarySection-ce7aa24283b1b30589a65c2d43243f55.html"},function(e,t,o){e.exports=o.p+"templates/content/details/coverArt-7b12208425ea51c5bbea3558ed478baf.html"},function(e,t,o){e.exports=o.p+"templates/content/details/productActionSection-2689e7f8e5c410552d38f5e938c51208.html"},function(e,t,o){e.exports=o.p+"templates/content/details/productInformation-12038cbdc1139e26a0ce365ec82fa24f.html"},function(e,t,o){e.exports=o.p+"templates/content/details/publishProductUpdatesSection-076ea6970ae772bbb4031a47bc831464.html"},function(e,t,o){e.exports=o.p+"templates/content/details/recommendedSection-1967a7e29349a4e1a769e992ff7a025a.html"},function(e,t,o){e.exports=o.p+"templates/content/details/reviews-51899d930ffcb2e8f67e1068c12dab96.html"},function(e,t,o){e.exports=o.p+"templates/content/details/saveProductCopySection-4a236c9c69d3c88e25c733477d4529d0.html"},function(e,t,o){e.exports=o.p+"templates/content/details/scoreDetailsPanel-0f0fa2754bfd6413b59e7436850bafda.html"},function(e,t,o){e.exports=o.p+"templates/content/details/scoreFacets-6d262d5db5ecd4a0a8c2fda4d506a1e7.html"},function(e,t,o){e.exports=o.p+"templates/content/details/sellScoreSection-7b38122c892a432d765836565d64d2a4.html"},function(e,t,o){e.exports=o.p+"templates/content/details/shareScoreSection-7f646a08d1713434284cb269c07834e6.html"},function(e,t,o){e.exports=o.p+"templates/content/details/socialStatsSection-1dfa16876309d28c7f67e9081c8e8b98.html"},function(e,t,o){e.exports=o.p+"templates/content/editor-97c02b093fcd0c57ba0598025b5244b7.html"},function(e,t,o){e.exports=o.p+"templates/content/error-13e49e35d822cd0e8b07149ec081d4c4.html"},function(e,t,o){e.exports=o.p+"templates/content/forumCreate-93a095a9effb5cab7d68fb8df15ce635.html"},function(e,t,o){e.exports=o.p+"templates/content/forumDiscussions-1767abf9528207accda5abbf7e9b39d3.html"},function(e,t,o){e.exports=o.p+"templates/content/forumIndex-96defc764654f002dbd7a246ec612897.html"},function(e,t,o){e.exports=o.p+"templates/content/group-8cf3154ed8cabba37a412a332baa9309.html"},function(e,t,o){e.exports=o.p+"templates/content/groups-da12fb632e996abdf018b504563d02b3.html"},function(e,t,o){e.exports=o.p+"templates/content/help_new-954dade6e8a7c7240dfbc3ca0ab835e9.html"},function(e,t,o){e.exports=o.p+"templates/content/inactiveSccError-0955bc36fdce5517a83576395d4ac17f.html"},function(e,t,o){e.exports=o.p+"templates/content/info-25d574260c43ff0f725705af6c7cf22d.html"},function(e,t,o){e.exports=o.p+"templates/content/initiateGiftCard3-859935bdffd12783bd4657ba469ee1a8.html"},function(e,t,o){e.exports=o.p+"templates/content/initiatePurchaseOrder-98d60d293085b46287bbbaeff50222e1.html"},function(e,t,o){e.exports=o.p+"templates/content/legal-ad17d3141371f9b562dc25a235374261.html"},function(e,t,o){e.exports=o.p+"templates/content/library-87f0bd6b6dd56550b75c0ef50adb9d9c.html"},function(e,t,o){e.exports=o.p+"templates/content/marketplace-d7ff6d3c16d2d400c5319e030ec1822a.html"},function(e,t,o){e.exports=o.p+"templates/content/marketplaceSearch-683c447e420c3d9270cb8a609789970c.html"},function(e,t,o){e.exports=o.p+"templates/content/mediaSyncEditor-2f8fc36b669ed5180170ce8dbc2e8c6e.html"},function(e,t,o){e.exports=o.p+"templates/content/mustLogin-e801ee4c5f26fcc8eec949861f668df9.html"},function(e,t,o){e.exports=o.p+"templates/content/newSite/fragments/googleClassroom-d9bee712650d34166ccf97840634ede3.html"},function(e,t,o){e.exports=o.p+"templates/content/oauthRequestAccess-33b2bb6b0a1d478992d56d03dab9da47.html"},function(e,t,o){e.exports=o.p+"templates/content/premiumTrial-f68bd5020a999151b00169d5f04e8135.html"},function(e,t,o){e.exports=o.p+"templates/content/printGiftCard2-7e4cc2fd543db23d256ea2e566a06677.html"},function(e,t,o){e.exports=o.p+"templates/content/privateScores-6515a80c3d342de241a0f8e87ed4c4bf.html"},function(e,t,o){e.exports=o.p+"templates/content/productEmbedBottomContainer-e1f58f62fc88eff014a1e06795b8142b.html"},function(e,t,o){e.exports=o.p+"templates/content/profile-db15c54b03371fee2910baa61b98ff33.html"},function(e,t,o){e.exports=o.p+"templates/content/publicMembers-f32b484973622785ff1faabfcd1a5347.html"},function(e,t,o){e.exports=o.p+"templates/content/publicScores-953f25ebd204f9b4eb7252cc1b335109.html"},function(e,t,o){e.exports=o.p+"templates/content/purchaseGiftCardRecurly-173ab28a4bed4d199a692b1e6aca90d9.html"},function(e,t,o){e.exports=o.p+"templates/content/react-5523272605f5e3fd7f6b38855a989633.html"},function(e,t,o){e.exports=o.p+"templates/content/redeemedArrangement-dd580d7ceeb36424f77a26466e69f73c.html"},function(e,t,o){e.exports=o.p+"templates/content/redeemedBook-5c3419871e0213e9b1bdcab23285c239.html"},function(e,t,o){e.exports=o.p+"templates/content/redeemedBoxProduct-42f95d5bcadf8b04a34e90f11d361f4b.html"},function(e,t,o){e.exports=o.p+"templates/content/redeemedGiftCert-985e85c8aa8ca60677eb2b10c4ba75cc.html"},function(e,t,o){e.exports=o.p+"templates/content/requestLearnDemo-2fc2e0cb0a95d9db6dc0fea8aafea992.html"},function(e,t,o){e.exports=o.p+"templates/content/review-07da5b2b16c0cc8155d9d76a131607ab.html"},function(e,t,o){e.exports=o.p+"templates/content/sccHome-055a836e581290db9022ae2ad5f09fee.html"},function(e,t,o){e.exports=o.p+"templates/content/siteActivate-fb48ccd4552293dcab425d1232449c8f.html"},function(e,t,o){e.exports=o.p+"templates/content/test-657ed79070e56ff2e3aaa8a80a231bed.html"},function(e,t,o){e.exports=o.p+"templates/content/unknownContentPackage-b7db95aa7347e400b6f8777441b473c4.html"},function(e,t,o){e.exports=o.p+"templates/content/updateProfileInfo-5080d3e7c955fab4d3ca571d07d4a40d.html"},function(e,t,o){e.exports=o.p+"templates/content/verificationFailure-badeb1bf627d2691f29ef2d8889db791.html"},function(e,t,o){e.exports=o.p+"templates/content/viewer-53c1883a0d9241d4db3015b59373b10d.html"},function(e,t,o){e.exports=o.p+"templates/content/workbook1Listing-687b3a091a23edd03c97f3058581ac23.html"},function(e,t,o){e.exports=o.p+"templates/content/workbook1WorkingCopy-6a50e2a262b1b13bad4358e1b17d4803.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/addToBlacklist-f75ca7e73f54a10ce3767d5ce8b10dc7.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/addToCollection-3e29afe57a0600177b8ea93e965d65d7.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/alert-9a4063eadf94a1402070555b988c4130.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/alertSequence-562b5e1e710fce6e0750ee1032af6d78.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/beforeUnload-6cc678360ba71a2e00bc7cc9ed1d89a0.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/blackboxing-841f72b979126c070601a800ea8ac3b6.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/cancelProductEditing-28bd2198dfb82c327fca6ceaf3cf3fbb.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/changePassword-f49d8fd6840b5a3b89b96f88f3fb210f.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/changeRole-ae804e2baa1455c6a1af0c6673dadd55.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/collectionDetails-c621208d6e5142443776f3b6dc0d8145.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/collectionOfCollections-272d6828732bb5c499082807c64986aa.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/collectionSettings-bdb817d0cfb4f55e2d0e1de8c0b005c4.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/confirmProfileUpdate-9da80a1c9acd05a66c87b484e043cfee.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/confirmProvider-44d0102774793106b296af0200664379.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/copyToSite-067548f47e47d3b0b532f3ba965cbf1b.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/deleteAccount-2193e8978f80657e9f57e905e9509059.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/deleteCustomerCard-529b20c13d0fcdcfe5ac179e85c30c17.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/deletePost-a096973ce4b623c7a4dbda6afa578629.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/demoAlert-cd2f0b82cf193f39f4c1129f67ff63e9.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/editPost-e53b282fbb252c1e382f3993477e37db.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/editProductOptions-2986fd76c06a07b77467029e57ce60df.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/editorTip-0a3f7669a6b019ee8344f3ef7e84be3c.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/embedDialog-a6b279b3790c7c427ac23413d5b44099.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/errorBand-edd008f2ce510285d2e6e043c0b460fb.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/flag-fa8ae93ec9a6c8fc0439b9b3471bdd9a.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/flagComment-7034a57d68c6f52de47a650dc432d9ae.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/flagDocument-8e764916ce72edb5bb38cffe34587069.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/flagGlobalDialog-e586950dc44d75df61afba7369deab08.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/flagPost-ccc1cd8269271d812a63d79353ce4d52.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/formatScoreBeforeSelling-04f6920b1d598254f3e1f755acfca81e.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/googleAuth-dd28cefa907b2748c22296621aaa2c7d.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/handleDeactivatedUsers-835250a7d64d432af0d3a1f8e15a1b50.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/handleExistingActiveUsers-4cf72da838e223560ec0df75176005db.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/imageEditor-134b9e40122a1fe0e2fcd159244df318.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/imagePicker-5f2b692379c0b4e7e58dbb339a90a1b1.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/linkAccounts-cb4a745feba8d52b8157296af9ccbc0b.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/login-c4881f8da82260c2dc4b0503dbe33651.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/massResetPasswords-4086b40f45ea2ef81ea3216a5c2754f2.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/modernAlert-7f69db42e0be04d0891fe21732c7da37.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/mustBePremium-31d611f4d2bf3c329f3fb5e819f1c1e7.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/mustCreateProfile-c89659d7fec8c94f8fe30a37e2a12ccd.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/mustLoginSignup-67ee0cd306ee4b224273345292b4ac19.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/newlyPublishedProduct-01da19b9aeb93e999220a11629b18f97.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/oauthRequestAccessDialog-31e561d3a42357073dbd4b18bfd88837.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/okBack-0754b8220b3eb7548fd278279ea9aacc.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/okCancel-0d1158946764cbd9ed02ca9c84dedc51.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/printSelectionDialog-3f8f9a4f770b73da910563bcc2d776db.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/privacyAndSecurity-c21e89ab76e627aff50a8feca3c44a45.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/reactComponentDialog-d7a21cb2a35175d615667d9f256a00e1.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/reorderForum-67b7a7f9e74f767a3156980f50e9ace3.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/requestAdmission-5e17a42d78bef1a7a237e5432068594e.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchase-6c6b96cef8c3a506dab84336db708ce3.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchaseCreateAccount-49c17434a46d71022d16c48c863e75cb.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchaseCreateIdentity-a02e2969cfa714b3c1cbb2a6f7cc30b9.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchaseLogin-1c77cc7e0ee0f03257be471550ed52c9.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchaseShoppingCart-e661e2b5d5f194c1c191257bf709a126.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scorePurchaseWallet-d6628a968deb2e97a1e463b618cd0052.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/scoreTitlePrompt-91030850840c08fe6e362e323a155a3d.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/sellScore-54c1241a72a304f736f5d42fa16528e4.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/signup-b171d9bb2694acc2dc6e2eb3de86915c.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/simpleDialog-1b7dc3551f1fd21aacdd35904425ea91.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/stopSelling-17f4f33855bbd64d1825b7f1aa7e9477.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/syncClassroom-acf6f89cc3a7956b755563deea1f1ae4.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/unlinkAccounts-f9c3f35a11f6084d1fc6dc62b9183489.html"},function(e,t,o){e.exports=o.p+"templates/dialogs/writeReview-d7d109ff22ac6410d9f6e90f1ee656d7.html"},function(e,t,o){e.exports=o.p+"templates/editor/fragments/commerceLinks-ef3107ad9c33456b758d203159ec9ef1.html"},function(e,t,o){e.exports=o.p+"templates/editor/fragments/googleClassroomCourseWorkCreation-4c66a30cdc31731f67b887cde6f766bf.html"},function(e,t,o){e.exports=o.p+"templates/editor/fragments/googleClassroomScoreInfo-924de0a37d701686afb6b79eba0315a7.html"},function(e,t,o){e.exports=o.p+"templates/editor/fragments/googleClassroomTurnInForm-41981a294bae0bc0ab88d609f72a9b10.html"},function(e,t,o){e.exports=o.p+"templates/fragments/accountProfile-e98de4fbef662c4c222c16746e14acfb.html"},function(e,t,o){e.exports=o.p+"templates/fragments/accountStatus-e60489132b4aef900b0d7a0ca99f07a1.html"},function(e,t,o){e.exports=o.p+"templates/fragments/activateAccount-8cf651f9726bed8b425f3478b426386d.html"},function(e,t,o){e.exports=o.p+"templates/fragments/addCustomerCard-b4a9f4a3d4649fa5e73ce920265ce874.html"},function(e,t,o){e.exports=o.p+"templates/fragments/audioPreview-fbf089de600d3a28a67024339125d0ec.html"},function(e,t,o){e.exports=o.p+"templates/fragments/billingAddress-f0e438e17faaf872413d95ae216ee91b.html"},function(e,t,o){e.exports=o.p+"templates/fragments/billingInfo-1404b3c0f56fe361d561cb3d7a2a62c5.html"},function(e,t,o){e.exports=o.p+"templates/fragments/billingInfoData-6b12946c033338160e921b3ab46b9944.html"},function(e,t,o){e.exports=o.p+"templates/fragments/billingInfoRecurly-19ade7ad4bde704e15a30e3d0dced4d1.html"},function(e,t,o){e.exports=o.p+"templates/fragments/billingInfoWithCreditCard-34bc1c7f32c47c2bd5571013ef59adf9.html"},function(e,t,o){e.exports=o.p+"templates/fragments/bookSummary-dd4c8fa5561367114783f395e2bfc9da.html"},function(e,t,o){e.exports=o.p+"templates/fragments/card-d9d5278bd65c77c54a72682f34d9ddbb.html"},function(e,t,o){e.exports=o.p+"templates/fragments/catalogScores-7261cd2a4e428607886b93ea343ce19b.html"},function(e,t,o){e.exports=o.p+"templates/fragments/collectionHeader-7494bf3cc85d869f7fa5d1640068a600.html"},function(e,t,o){e.exports=o.p+"templates/fragments/collectionRow-8d75d46b9876965cea5f764aa3bb9f2f.html"},function(e,t,o){e.exports=o.p+"templates/fragments/creditCard-0764c51e7d802f5166f447532952cb58.html"},function(e,t,o){e.exports=o.p+"templates/fragments/creditCardData-12e5a181ce8df00f44e1ca7763b7298b.html"},function(e,t,o){e.exports=o.p+"templates/fragments/creditCardRecurly-98027ea3278537b30decb17198032a6e.html"},function(e,t,o){e.exports=o.p+"templates/fragments/customerCard-88367a567b4f543c3913ea08fbccc319.html"},function(e,t,o){e.exports=o.p+"templates/fragments/customerWallet-2b4f0b0b9dc2de1ad8fd20e6cbbc0161.html"},function(e,t,o){e.exports=o.p+"templates/fragments/discussions-d0fa638969ae2813a8def20da6643a7c.html"},function(e,t,o){e.exports=o.p+"templates/fragments/editIdentity-f2c25ba228295bf5ebffc01931355c3b.html"},function(e,t,o){e.exports=o.p+"templates/fragments/errorBanner-9695095a81639fc25a446a59229994a5.html"},function(e,t,o){e.exports=o.p+"templates/fragments/flaggedPost-b9a3f1a33eef134e06d8e04129a5645c.html"},function(e,t,o){e.exports=o.p+"templates/fragments/forumIndex-721001994c95c7e72c41ac39a5033b12.html"},function(e,t,o){e.exports=o.p+"templates/fragments/freeLibrary-e52f55bb479f5891fa7dc2ba4d0fbfac.html"},function(e,t,o){e.exports=o.p+"templates/fragments/group-eca2ced0f614f96a4c36a70f41430906.html"},function(e,t,o){e.exports=o.p+"templates/fragments/groupsListing-11a80db9b503619f0d6f55f90b43b039.html"},function(e,t,o){e.exports=o.p+"templates/fragments/imageUploader-07fdf15c2b9b2847b2516dc223a031f3.html"},function(e,t,o){e.exports=o.p+"templates/fragments/infoPopup-5f0bd1c7531bd3cfa5cb3ddb389f1b99.html"},function(e,t,o){e.exports=o.p+"templates/fragments/instrumentsMapping-9e3adb43c647d1335db54bf4b801c7ae.html"},function(e,t,o){e.exports=o.p+"templates/fragments/librariesInfoBlock-23fd3ffc7807017bf5f92a47ad3cb2b7.html"},function(e,t,o){e.exports=o.p+"templates/fragments/library-395aa1c7c10fcc34c76ed36e93df4ca7.html"},function(e,t,o){e.exports=o.p+"templates/fragments/libraryListing-09c313d070c4ffdc3d157da1ad1a33e2.html"},function(e,t,o){e.exports=o.p+"templates/fragments/libraryScores-cfb8c3dda1088dbfe32a8fdc0eb30355.html"},function(e,t,o){e.exports=o.p+"templates/fragments/libraryScoresListing-33ecd5c8980840b7066342abc93463c0.html"},function(e,t,o){e.exports=o.p+"templates/fragments/markdownTip-241cff89e51956a169548dd6d9573050.html"},function(e,t,o){e.exports=o.p+"templates/fragments/marketplaceListing-8c09d42021f7218f3f3be3fdb50611f6.html"},function(e,t,o){e.exports=o.p+"templates/fragments/mediaSyncEditorButtons-e1985fe6d50d7fea1f3dd16a365140b2.html"},function(e,t,o){e.exports=o.p+"templates/fragments/mediaSyncPlayer-488237c2a4afe136ee081b0a3775af13.html"},function(e,t,o){e.exports=o.p+"templates/fragments/mediaSyncProgressBar-181ee244c5f8a2c4233710aa203406b6.html"},function(e,t,o){e.exports=o.p+"templates/fragments/memberCard-8f9a99d41e7201dd6cad0602794cc593.html"},function(e,t,o){e.exports=o.p+"templates/fragments/officialBadge-8c0397fb77679d32703ff46fca7e9c1f.html"},function(e,t,o){e.exports=o.p+"templates/fragments/product-e91c4bb356b4c7df9c0fe068aa1661a3.html"},function(e,t,o){e.exports=o.p+"templates/fragments/profileOptionalInfo-0889b8168ba7f732bcda6e8189842411.html"},function(e,t,o){e.exports=o.p+"templates/fragments/publicScores-c3bea1a4b32f89ac71967cdd37c38362.html"},function(e,t,o){e.exports=o.p+"templates/fragments/resendActivation-e5b7d5bb91e0e1755e451a7d8e5346a9.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sccCommunityGroup-1a2f661706a06a893ed96c7c93dd8e76.html"},function(e,t,o){e.exports=o.p+"templates/fragments/scoreSearch-af9ead97ac142097d226f2fd8e4f896b.html"},function(e,t,o){e.exports=o.p+"templates/fragments/scoreWork-9916baffa8623d06ef69ce7584c7e19c.html"},function(e,t,o){e.exports=o.p+"templates/fragments/scoreWorkBlackbox-b2fe22d9220c959db8e25baa25698ad9.html"},function(e,t,o){e.exports=o.p+"templates/fragments/scoreWorkRadio-a829e15b365cf65265b7680196f2846c.html"},function(e,t,o){e.exports=o.p+"templates/fragments/scoresFilter-94e4a32a3819eba29a8187caa8d6376e.html"},function(e,t,o){e.exports=o.p+"templates/fragments/search-65b3702a4e49dee1b2345da729dbd664.html"},function(e,t,o){e.exports=o.p+"templates/fragments/searchResults-bf7ddb5ef5e32ba865ffeb00a90bcde9.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellScoreCopyright-b38946e78bffb37dff240d2d726f9a67.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellScoreDetails-9d8c8f18037660d48aaba0db4cfcf4c8.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellScoreEnsembleAndPrice-a7e3bd8bb4db313af50fc12dc7513fe6.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellScoreText-2152fd62d85ffc1b8691c8fa41c45911.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellerPayoutDestinationSetup-ef295eb5b0538c73eb864451df467787.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellerPayouts-548765935108f3c92fe184247df262f4.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellerSetupLanding-8404a2ff2587d08fd8da58fe6b447c9c.html"},function(e,t,o){e.exports=o.p+"templates/fragments/sellerSignup-ab258eb8f4d3c335e33fd49cbbb6824f.html"},function(e,t,o){e.exports=o.p+"templates/fragments/simpleMemberCard-72dfbd73c233d179521c325932adc404.html"},function(e,t,o){e.exports=o.p+"templates/fragments/smallMemberCard-9bbc2202fc1993eece4a0bca06694f6d.html"},function(e,t,o){e.exports=o.p+"templates/fragments/stars-7715a866363ca6f7db98bb8c0d7c63aa.html"},function(e,t,o){e.exports=o.p+"templates/fragments/tip-87d8893961d3dfaa577722a8e68f7444.html"},function(e,t,o){e.exports=o.p+"templates/fragments/userMenu-77e00c3a957f55f57f3b0d7843a33b34.html"},function(e,t,o){e.exports=o.p+"templates/fragments/viewUpgrade-0a58ba96cf475f6a5126355395b5f571.html"},function(e,t,o){e.exports=o.p+"templates/group/activity-1a47e84b48c9323d9e400d832b819700.html"},function(e,t,o){e.exports=o.p+"templates/group/addClasses-3317f5c9427df77ad88670f153ee184f.html"},function(e,t,o){e.exports=o.p+"templates/group/createGroup-3cb4144425c7e1dca82b280640a636c3.html"},function(e,t,o){e.exports=o.p+"templates/group/discussions-dc69f7d6b64a4ad1e588d6ebf7c5aea7.html"},function(e,t,o){e.exports=o.p+"templates/group/editGroup-04da35e1dd3d5699f335e38f9b6c44a6.html"},function(e,t,o){e.exports=o.p+"templates/group/flaggedContent-0db3155536a010b775ae8c281c1563dd.html"},function(e,t,o){e.exports=o.p+"templates/group/groupForm-e3b71b4bb43853630ba1fc89caf95000.html"},function(e,t,o){e.exports=o.p+"templates/group/inviteTeachers-e70aa4d33c1535b417653e0f0a454008.html"},function(e,t,o){e.exports=o.p+"templates/group/manageForums-9172671f40e78e263ffdd3b06f8ca2a9.html"},function(e,t,o){e.exports=o.p+"templates/group/members-3e21c20598dcdf59fd10831e46d7b871.html"},function(e,t,o){e.exports=o.p+"templates/group/newForum-15a1e562ecc5d425b3f32f7f5a027867.html"},function(e,t,o){e.exports=o.p+"templates/group/overview-4de11c4f562d7a37b922949b577db2dd.html"},function(e,t,o){e.exports=o.p+"templates/group/scores-e7d8149d3b1c39f83e8adc44d32f6950.html"},function(e,t,o){e.exports=o.p+"templates/group/siteMembers-7236d6ce3518b934229e8876ae12b186.html"},function(e,t,o){e.exports=o.p+"templates/header/avatarButton-dca5109b218df8a3eb1019702cd81441.html"},function(e,t,o){e.exports=o.p+"templates/header/errorsReporter-442c78b2e1c3fa77e25fee804e8a0cd9.html"},function(e,t,o){e.exports=o.p+"templates/header/fullScreenErrorReporter-9504b8fe858591381b39d78cf750e7e0.html"},function(e,t,o){e.exports=o.p+"templates/header/fullScreenReporter-3fac6ee90ec59adaad3dd2d079179999.html"},function(e,t,o){e.exports=o.p+"templates/header/headerAttachResource-42528d80de971e062537f2d03be8ecba.html"},function(e,t,o){e.exports=o.p+"templates/header/headerLTIReplaceResult-4d1decfcd15f90cf8495420cb86663cd.html"},function(e,t,o){e.exports=o.p+"templates/header/headerNeedToValidate-cf2b39955a503adaf0b04d6e6f172b7d.html"},function(e,t,o){e.exports=o.p+"templates/header/reporter-912b21571cde7a5c69d3050b19a2be09.html"},function(e,t,o){e.exports=o.p+"templates/header/serviceReporter-187fab866ff63e037f7dd501652e934e.html"},function(e,t,o){e.exports=o.p+"templates/info/infoCharms-d57e39b9fdb0373d1037d20fb9ad2f86.html"},function(e,t,o){e.exports=o.p+"templates/info/infoDetails-ba3c44b7cf1d80d43daf24ba4e0c61c0.html"},function(e,t,o){e.exports=o.p+"templates/info/infoDevelopers-17cb65ff07be0a36ca142057c2b25a98.html"},function(e,t,o){e.exports=o.p+"templates/info/infoHigherEd-1e078f2b73edbcf91d1c1eda3b05ba6b.html"},function(e,t,o){e.exports=o.p+"templates/info/infoIndex-083fccab6178dad967cea63d122f2122.html"},function(e,t,o){e.exports=o.p+"templates/info/infoPartners-bc25898fb933e3e36601ca056a25d070.html"},function(e,t,o){e.exports=o.p+"templates/info/infoPlans-76201c470151bdd43f7449f25e190edd.html"},function(e,t,o){e.exports=o.p+"templates/info/infoSiteHome-f2b1844c9f065fc202f8f83c9afb32bc.html"},function(e,t,o){e.exports=o.p+"templates/info/scoresWelcome-4588680c901a6d059fbd787f40795c40.html"},function(e,t,o){e.exports=o.p+"templates/item:global_banner-d41d8cd98f00b204e9800998ecf8427e.html"},function(e,t,o){e.exports=o.p+"templates/library/catalog-2660d1556006d134f15a09964d3c1ce6.html"},function(e,t,o){e.exports=o.p+"templates/library/libraryMembers-eb6c92f70c5355c9d0f6340c754e8046.html"},function(e,t,o){e.exports=o.p+"templates/library/overview-03d362ff9ca8dd0202bcdab5edd49f11.html"},function(e,t,o){e.exports=o.p+"templates/locale/ca/content/help_new-6b61dce6bb4c975406776a44ab9bb64e.html"},function(e,t,o){e.exports=o.p+"templates/locale/de/content/help_new-1b6ee06e71ff98dc4a90f61f932a3b99.html"},function(e,t,o){e.exports=o.p+"templates/locale/es/content/help_new-8c67735c323dea401672ab226bbae0b3.html"},function(e,t,o){e.exports=o.p+"templates/locale/es_ES/content/help_new-5ba1e0bcbec50e1119a29aa0f225bc24.html"},function(e,t,o){e.exports=o.p+"templates/locale/fr/content/help_new-75ca44b8de2c46f01c75b79e342119e0.html"},function(e,t,o){e.exports=o.p+"templates/locale/ja/content/help_new-ea6157743364757601ea716e5438e223.html"},function(e,t,o){e.exports=o.p+"templates/locale/sk_SK/content/help_new-5aed8e7e40da739daa802e938f4e3eeb.html"},function(e,t,o){e.exports=o.p+"templates/locale/zh-CN/content/help_new-ab1e7b858ec8ec6c70dbb5cb91543920.html"},function(e,t,o){e.exports=o.p+"templates/locale/zh-TW/content/help_new-1f98d1554f34e2eb5af2c52ae5e8f84b.html"},function(e,t,o){e.exports=o.p+"templates/marketplace/breadcrumbHeader-1402f575dc41677fb44add0690359f96.html"},function(e,t,o){e.exports=o.p+"templates/menu/context-c0b6c646a5a1acf76991525b6cd22a7c.html"},function(e,t,o){e.exports=o.p+"templates/menu/customDropdown-4c70a44395969e1942e7485854d5911c.html"},function(e,t,o){e.exports=o.p+"templates/menu/hint-d4a469e81269260270898e28b4f1d4cb.html"},function(e,t,o){e.exports=o.p+"templates/messages/messagesList-17986fc3f3d27354c9e8925b094ec65b.html"},function(e,t,o){e.exports=o.p+"templates/notifications/dismissableNotification-b2ddcc1c4f92fa8c2ac9f27c00b0c36b.html"},function(e,t,o){e.exports=o.p+"templates/notifications/inlineError-25407d02e8bb91304aa9647b2aad09f6.html"},function(e,t,o){e.exports=o.p+"templates/notifications/validationUnderlay-2240ee6847f0f998478624b3a176bfd0.html"},function(e,t,o){e.exports=o.p+"templates/palette/actionButton-e4a84bbe283352d82501f35fb0171eba.html"},function(e,t,o){e.exports=o.p+"templates/palette/commonRealTimeFeedback-98ec8acba24043bfcc1e30391ffe84dc.html"},function(e,t,o){e.exports=o.p+"templates/palette/durationButton-e4a84bbe283352d82501f35fb0171eba.html"},function(e,t,o){e.exports=o.p+"templates/palette/editorHelp-c12c6efb9a0f9caf30e078af6843d1cb.html"},function(e,t,o){e.exports=o.p+"templates/palette/helpControl-b4a9a89287d2fa517a036a8c6cd1be70.html"},function(e,t,o){e.exports=o.p+"templates/palette/percentControl-4714ffb165a337ae05e9ecff77dac193.html"},function(e,t,o){e.exports=o.p+"templates/palette/popupMenu-89006318ac0326fc21bd86c14974ffa0.html"},function(e,t,o){e.exports=o.p+"templates/palette/popupSearch-8ae6edb2ff9a7dad578af110b3d6e934.html"},function(e,t,o){e.exports=o.p+"templates/palette/popupSliderControl-b7e8385b499070dba74e2c1b892b4c0d.html"},function(e,t,o){e.exports=o.p+"templates/palette/popupZoomer-ed57fcff890e27effeae08949f33b507.html"},function(e,t,o){e.exports=o.p+"templates/palette/radioButton-e4a84bbe283352d82501f35fb0171eba.html"},function(e,t,o){e.exports=o.p+"templates/palette/recordingControl-942fa4065122c42153c7e8467768740a.html"},function(e,t,o){e.exports=o.p+"templates/palette/searchControl-c47a2261898a9e042ed224737fb4c866.html"},function(e,t,o){e.exports=o.p+"templates/palette/selectControl-21c126e491c69b51963b085e9ea382e8.html"},function(e,t,o){e.exports=o.p+"templates/palette/separator-2a775cf2202ef54d84c801f5beb1834d.html"},function(e,t,o){e.exports=o.p+"templates/palette/tempoControl-03d81c9b350932d0aae6a2174fa49a20.html"},function(e,t,o){e.exports=o.p+"templates/palette/tempoNotePicker-cd8aabe759b97e6d56763e0a5f248bb1.html"},function(e,t,o){e.exports=o.p+"templates/palette/tip-a479bcd33a56b500240865b22f6040d4.html"},function(e,t,o){e.exports=o.p+"templates/palette/toggleButton-e4a84bbe283352d82501f35fb0171eba.html"},function(e,t,o){e.exports=o.p+"templates/palette/transcriberControl-14b4dee0fc11ee8335234bcc7a60f552.html"},function(e,t,o){e.exports=o.p+"templates/palette/urlButton-ef8275401cb61db6d36cfa8b4ec58f93.html"},function(e,t,o){e.exports=o.p+"templates/palette/viewControl-4554627dab5cdc872331f5abca063442.html"},function(e,t,o){e.exports=o.p+"templates/palette/zoomControl-fa1e968fc0c0932b60bd91fb77314d5b.html"},function(e,t,o){e.exports=o.p+"templates/post/postView-35f40278d2299a95a665d7e4a4f8ca0b.html"},function(e,t,o){e.exports=o.p+"templates/score/annotation-716ebae89e7354778cc9a604deed2317.html"},function(e,t,o){e.exports=o.p+"templates/score/calibrateLatency-ab73bb0e18ff624579d0c9fe2aaf60e3.html"},function(e,t,o){e.exports=o.p+"templates/score/calibrateMic-e6ee3473c5737465f8cf93fc0b2a44f6.html"},function(e,t,o){e.exports=o.p+"templates/score/chooseInstrument-c0f8e938100ff8b96069ea5888d3fa0a.html"},function(e,t,o){e.exports=o.p+"templates/score/exportScore-89ff4071da3b9890baaeb577c7677f88.html"},function(e,t,o){e.exports=o.p+"templates/score/filter-e3458bdf91ea1fccb47a42c5dfa9f35d.html"},function(e,t,o){e.exports=o.p+"templates/score/forceSilentPlayback-6defb9edae4576d1b25d38bd0a0376dc.html"},function(e,t,o){e.exports=o.p+"templates/score/formattingPanel-ce7db631299296daf0d3769a4d8d27f7.html"},function(e,t,o){e.exports=o.p+"templates/score/graceNotePanel-c17fe42050d87cbd6a6407f212353a82.html"},function(e,t,o){e.exports=o.p+"templates/score/html5EditorControls-f27c5b1a6cbb5f080f8b48f09d81dcbc.html"},function(e,t,o){e.exports=o.p+"templates/score/inputSelection-d3463f542e1bfac2782ab43d02063b4a.html"},function(e,t,o){e.exports=o.p+"templates/score/instrumentsPanel-d5027df5a67c42e1119c6b573e8f8b3c.html"},function(e,t,o){e.exports=o.p+"templates/score/keySignature-cf4c83e4c3bb767d48e5ae87aa60850c.html"},function(e,t,o){e.exports=o.p+"templates/score/libraryScoreRow-f6343628b7d6acd098519e68f975d805.html"},function(e,t,o){e.exports=o.p+"templates/score/libraryScoreRowBody-b5d4aaef05efb131aaf0acab0b634eb9.html"},function(e,t,o){e.exports=o.p+"templates/score/localDraft-960cdf93271d9d6e0b1a4d3e1b600208.html"},function(e,t,o){e.exports=o.p+"templates/score/localSaves-45304e55f0ae8e4f580efe8d7a711f8a.html"},function(e,t,o){e.exports=o.p+"templates/score/mediaSyncViewer-966f3fbec3c62d0346a061b81ff85b74.html"},function(e,t,o){e.exports=o.p+"templates/score/mixer-e07e51692b60fce760e18fc5025b1f7c.html"},function(e,t,o){e.exports=o.p+"templates/score/mixerItem-44c3e2feb716e3d9f3fab69245e4eba4.html"},function(e,t,o){e.exports=o.p+"templates/score/newScore-d7eb14eb6e625df1f8ce861c765be109.html"},function(e,t,o){e.exports=o.p+"templates/score/printScore-ee627a0e8109eec5896b2c9bb5d34925.html"},function(e,t,o){e.exports=o.p+"templates/score/productItemBody-3e4dbace43136d6efa2bac1fe5561f3f.html"},function(e,t,o){e.exports=o.p+"templates/score/productRowBody-fecce064123d594a9f3fc3314ae56ec0.html"},function(e,t,o){e.exports=o.p+"templates/score/publicScoresListing-e4f8cc2fed78ab638b243bbc7244f479.html"},function(e,t,o){e.exports=o.p+"templates/score/recordingSettings-7c594dde0417ab6f3638bddbf6a974cb.html"},function(e,t,o){e.exports=o.p+"templates/score/saveAside-95353d1a0fd5bbe9e2c27908ced4aa55.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreAnnotations-9e9ffe496ff340233ae6f6b195654e3e.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreDragProxy-142496b70a0d84f3c929cd86fdc9beb5.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreEditorPanelContents-2a7b740112bce785ff7970c4e102476f.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreHeaderPalette-8c7cfdf7349c49878b1912b7bb5f254d.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreItem-4287ee1188e5e60565e72360a6a4d99b.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreItemBody-c60a78cf3b306c2f2eb470cb83aea877.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreRow-e72603ec8316e73c75af22ec26da6287.html"},function(e,t,o){e.exports=o.p+"templates/score/scoreRowBody-a8d30fb4a9777a0fa791f71d3cfe3360.html"},function(e,t,o){e.exports=o.p+"templates/score/timeSignature-4c6a975f0474bb1d301c55a32c0cd2b1.html"},function(e,t,o){e.exports=o.p+"templates/score/track-47841afca8849c150c351ce31d054c70.html"},function(e,t,o){e.exports=o.p+"templates/score/transcriberSettings-2f58a1f5020ae0d0e95a966b96e8e523.html"},function(e,t,o){e.exports=o.p+"templates/score/transpose-e86cc8016866f5509e9c6314ccfe00cc.html"},function(e,t,o){e.exports=o.p+"templates/score/tuning-2c37ab6ed24e8f1f5e79873999bc6765.html"},function(e,t,o){e.exports=o.p+"templates/score/versionHistory-2b8a2601c96c5e766708333520ff131f.html"},function(e,t,o){e.exports=o.p+"templates/site/createSite-ce2f4733036795c68c96848ccf921854.html"},function(e,t,o){e.exports=o.p+"templates/site/editSite-c6dd2d0077c198861d3a63b4a064faa8.html"},function(e,t,o){e.exports=o.p+"templates/site/googleClassroomCourses-3324fde6d56727f0ee36304e5e3e22dc.html"},function(e,t,o){e.exports=o.p+"templates/site/siteForm-390ae64a487ee32c699ca1a1e3f6a6dd.html"},function(e,t,o){e.exports=o.p+"templates/strips/infoStrip-22af97cd1bb75a49e1a5e1af025e0a74.html"},function(e,t,o){e.exports=o.p+"templates/strips/scoreStrip-93030310623a9711bb7206ea1e235c09.html"},function(e,t,o){e.exports=o.p+"images/BandPhoto-81956d15a9ac598f96aca5e30c248c41.jpg"},function(e,t,o){e.exports=o.p+"images/noteflightHomePageBG-8bce59cb8346ab49f3dd1834c178336f.jpg"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=o(6),n=l(o(311)),i=l(o(93)),a=o(90),s=o(8);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if(r.Noteflight.config.settings=e.settings,r.Noteflight.config.assetPrefix=e.assetPrefix,r.Noteflight.config.instrumentPrefix=e.instrumentPrefix,r.Noteflight.defaultHostname=e.defaultHostname,r.Noteflight.config.gcHostnameSuffix=e.gcHostnameSuffix,r.Noteflight.config.sccHostnameSuffix=e.sccHostnameSuffix,r.Noteflight.config.ssoHostnameSuffix=e.ssoHostnameSuffix,r.Noteflight.config.facebookAppID=e.facebookAppID,r.Noteflight.config.googleAnalyticsTracker=e.googleAnalyticsTracker,r.Noteflight.config.googleCSE=e.googleCSE,r.Noteflight.config.recurlyPublicKey=e.recurlyPublicKey,r.Noteflight.config.rrApiKey=e.rrApiKey,r.Noteflight.config.rrEnvironment=e.rrEnvironment,r.Noteflight.config.rrSessionId=e.rrSessionId,r.Noteflight.config.rrFindLog=e.rrFindLog,r.Noteflight.config.stripePublicKey=e.stripePublicKey,r.Noteflight.config.oauthAuthRequestInfo=e.oauthAuthRequestInfo,r.Noteflight.flash=e.flash,r.Noteflight.authenticityToken=e.authenticityToken,r.Noteflight.ssl="https:"==window.location.protocol,r.Noteflight.embedded=e.embedded,r.Noteflight.errorResource=e.errorResource,r.Noteflight.environment=e.environment,r.Noteflight.config.editorDebug=e.editorDebug,r.Noteflight.scoreUri=e.scoreUri,r.Noteflight.scoreContentUri=e.scoreContentUri,r.Noteflight.scoreData=e.scoreData,r.Noteflight.incrementalSaveSession=e.incrementalSaveSession,r.Noteflight.firstResponse=!0,e.editor.contentType===s.PRODUCT)for(var t=0;t<e.models.products.length;t++){var o=e.models.products[t];o.id===e.editor.contentId&&(0,a.addProductView)(o)}r.Noteflight.models=e.models,r.Noteflight.editor=e.editor,r.Noteflight.inlineTemplates=e.inlineTemplates,r.Noteflight.viewModelOverride=e.viewModelOverride,r.Noteflight.session=new n.default(e.login),r.Noteflight.roles=new i.default(r.Noteflight.session)}window.bootstrapApp=c},function(e,t,o){e.exports=o.p+"images/btn_login-cb48a1007916522b3ff7fe657c631dbb.png"},function(e,t,o){e.exports=o.p+"images/btn_cancelsubscription-3a0c9993c76330219c36cc3a2b7c3bb3.png"},function(e,t,o){e.exports=o.p+"images/btn_search-9e6d3ddfa57f52fd4fc443fa7976c694.jpg"},function(e,t,o){e.exports=o.p+"images/btn_submitform-86bdb9c03412120001bba9010ffc93f9.png"},function(e,t,o){e.exports=o.p+"images/signInButton-bd07ff9fb1df725eed0b6643f9efb984.png"},function(e,t,o){e.exports=o.p+"images/submitButton-1fcbfbf9acc88a4f930c23e034ff912a.png"},function(e,t,o){e.exports=o.p+"images/facebook_link_image_2-a2c16cd04ce703c4e464ba8cb4fae63f.png"},function(e,t,o){e.exports=o.p+"images/sax_ed-ce532d9d2094d079d1e1467bf51565b2.png"},function(e,t,o){e.exports=o.p+"images/NoteflightWebview-a3d61860b14ac70fd5e73dd875bb7924.jpg"},function(e,t,o){e.exports=o.p+"images/allDevices50-0e297242847083f17f1fe935eebd2518.png"},function(e,t,o){e.exports=o.p+"images/ipad_kilroy-bb24262f35eab15eed1c9e5e9cd1576a.png"},function(e,t,o){e.exports=o.p+"images/homeVideoPoster-690f939ae71f1bd6e6eb5c3eed8825db.jpg"},function(e,t,o){e.exports=o.p+"videos/NoteflightVideo-d517a78ab27e1b9bbd138c75016eda89.mp4"},function(e,t,o){e.exports=o.p+"videos/NoteflightVideo-e6e4892130196ce6a086a9eecb0f9b0d.webm"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,function(e,t){},,function(e,t){},,function(e,t){},,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){}]);