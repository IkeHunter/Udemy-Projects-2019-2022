/*******************************************************************************
 *
 * NOTEFLIGHT LLC
 * Copyright 2019 Noteflight LLC
 * All Rights Reserved
 *
 * @license
 *******************************************************************************/!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/assets/",i(i.s=321)}({103:function(t,e,i){t.exports=i(7)(628)},321:function(t,e,i){"use strict";i(322),i(323),i(324),i(325)},322:function(t,e,i){t.exports=i(7)(573)},323:function(t,e,i){"use strict";(function(t){function e(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t,e,i,n){return(r="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var r,o=a(t,e);if(o){if((r=Object.getOwnPropertyDescriptor(o,e)).set)return r.set.call(n,i),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=i,Object.defineProperty(n,e,r)}else!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(n,e,i);return!0})(t,e,i,n)}function o(t,e,i,n,o){if(!r(t,e,i,n||t)&&o)throw new Error("failed to set property");return i}function s(t,e,i){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=a(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function a(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}function l(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,i){return e&&g(t.prototype,e),i&&g(t,i),t}!function(){var r=function(){function t(){y(this,t)}return p(t,null,[{key:"registerClass",value:function(e,i){if(a.has(i)||d.has(e))throw"Class ".concat(i," is registered multiple times");var n=new t.Class(e,i);a.set(i,n),d.set(e,n),this.addToClasses(e,i,m)}},{key:"implementsInterfaces",value:function(t,e){if(g.has(t))throw"Class declares interfaces multiple times";g.set(t,new _(t,e))}},{key:"getClass",value:function(t){return null===t||void 0===t?null:t.constructor}},{key:"getClassForClass",value:function(t){var e=d.get(t);if(!e)throw"Class ".concat(t," not found");return e}},{key:"getClassForName",value:function(t){var e=a.get(t);if(!e)throw"Class ".concat(t," not found");return e.clazz}},{key:"getClassName",value:function(t){return this.getClassForClass(t).name}},{key:"getUnqualifiedClassName",value:function(t){return this.getClassForClass(t).unqualifiedName}},{key:"getSuperclass",value:function(t){return this.getClassForClass(t).superclass}},{key:"getAssignableTo",value:function(t){return this.getClassForClass(t).assignableTo}},{key:"addToAssignableTo",value:function(t,e){var i=this.getAssignableTo(t),n=!0,r=!1,o=void 0;try{for(var s,a=i.keys()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e.set(l,!0)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"addToClasses",value:function(t,e,i){var n=e.indexOf(".");if(n>=0){var r=e.substring(0,n),o=e.substring(n+1),s=i[r];s||(s={},i[r]=s),this.addToClasses(t,o,s)}else i[e]=t}},{key:"Class",get:function(){return v}}]),t}(),a=new Map,d=new Map,g=new Map,m={},v=function(){function t(e,i){y(this,t),this.clazz=e,this.name=i,this.unqualifiedName=this.toUnqualifiedName(i)}return p(t,[{key:"toUnqualifiedName",value:function(t){var e=t.lastIndexOf(".");return e>=0?t.substring(e+1):t}},{key:"superclass",get:function(){var t=Object.getPrototypeOf(this.clazz.prototype);return null===t?null:t.constructor}},{key:"assignableTo",get:function(){if(!this._assignableTo){var t=new Map;t.set(this.clazz,!0);var e=this.superclass;e&&r.addToAssignableTo(e,t);var i=g.get(this.clazz);if(null!=i){var n=!0,o=!1,s=void 0;try{for(var a,l=i.interfaces[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var u=a.value;r.addToAssignableTo(u,t)}}catch(t){o=!0,s=t}finally{try{n||null==l.return||l.return()}finally{if(o)throw s}}}this._assignableTo=t}return this._assignableTo}}]),t}(),_=function t(e,i){y(this,t),this.interfaces=i};r.registerClass(Object,"Object"),r.registerClass(String,"String"),r.registerClass(Array,"Array"),r.registerClass(Number,"Number"),r.registerClass(Boolean,"Boolean"),r.registerClass(Date,"Date"),r.registerClass(RegExp,"RegExp"),r.registerClass(r,"Classes");var S=function t(e,i,n){y(this,t),this.noteSet=null,this.pitch=0,this.startTime=NaN,this.noteSet=e,this.pitch=i,this.startTime=n};r.registerClass(S,"ActiveNotes");var L=function t(){y(this,t)};r.registerClass(L,"Class");var k=function t(e,i,n,r,o){y(this,t),this.halign=null,this.valign=null,this.justify=null,this.defaultY=NaN,this.text=null,this.type=null,this.halign=e,this.valign=i,this.justify=n,this.defaultY=r,this.text=o};r.registerClass(k,"Credit");var T=function(){function t(){y(this,t)}return p(t,null,[{key:"currentDate",get:function(){return null!=E?E:new Date}},{key:"mockCurrentDate",get:function(){return E},set:function(t){E=t}}]),t}(),E=null;r.registerClass(T,"CurrentDate");var M=function t(){y(this,t),this.displayObjectCount=0,this.displayObjectContainerCount=0,this.eventListenerCount=0,this.displayObjectEventListenerCount=0,this.unstagedDisplayObjectEventListenerCount=0,this.weakEventListenerCount=0};r.registerClass(M,"DisplayListStats");var b=function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y(this,t),this.domType=null,this.suppressable=!1,this.domType=e,this.suppressable=i};r.registerClass(b,"EventInfo");var w=function t(e,i){y(this,t),this.defaultY=NaN,this.text=null,this.defaultY=e,this.text=i};r.registerClass(w,"Fingering");var x=function t(e,i){y(this,t),this.path=null,this.loaded=!1,this.path=e,this.loaded=i};r.registerClass(x,"FontTableEntry");var C=function t(e,i){y(this,t),this.formalElementName=null,this.rhythmElement=null,this.formalElementName=e,this.rhythmElement=i};r.registerClass(C,"FormalElement");var N=function t(e,i){y(this,t),this.layout=null,this.constraint=null,this.layout=e,this.constraint=i};r.registerClass(N,"LayoutConstraintPair");var A=function(){function t(){y(this,t)}return p(t,null,[{key:"as",value:function(t,e){if(null===t)return null;if(null===e)throw"type is null";return e===Hy?this.isIntValue(t)?t:null:e===yl?this.isIntValue(t)&&t>=0?t:null:e===Number?this.isNumberType(t)?t:null:e===Boolean?!0===t||!1===t?t:null:e===String?this.isStringType(t)?t:null:e===L?"function"==typeof t||t instanceof Function?t:null:this.is(t,e)?t:null}},{key:"is",value:function(t,e){if(null===t||void 0===t)return!1;if(null===e||void 0===e)throw"FIXME - type cannot be null";if(t instanceof e)return!0;if(e===String)return this.isStringType(t);if(e===Number)return this.isNumberType(t);if(e===Hy||e==yl)return!1;if(e===Boolean)return this.isBooleanType(t);if("object"===f(t))return r.getAssignableTo(r.getClass(t)).has(e);if("string"==typeof t)return e===String||e===Object;throw console.log("call to is",t,e),"FIXME - not implemented"}},{key:"instanceof",value:function(t,e){return this.is(t,e)}},{key:"unknownToType",value:function(t,e){if(null==e)throw new Error("type is null");return e===Hy?this.unknownToInt(t):e===yl?this.unknownToUint(t):e===Number?this.unknownToNumber(t):e===Boolean?this.unknownToBoolean(t):e===String?this.unknownToString(t):e===q?this.unknownToXML(t):e===ht?this.unknownToXMLList(t):this.unknownToObject(t)}},{key:"unknownToInt",value:function(t){if(this.isNumberType(t)&&!isNaN(t))return this.numberToInt(t);if(!0===t)return 1;if(!1===t)return 0;if(null===t||void 0===t||isNaN(t))return 0;if(""===t)return 0;if(this.isStringType(t))return this.stringToInt(t);if(t instanceof Date)return this.dateToInt();if(t instanceof q)return this.xmlToInt(t);if(t instanceof ht)return this.xmllistToInt(t);throw"FIXME - not implemented"}},{key:"stringToUint",value:function(t){return this.intToUint(this.stringToInt(t))}},{key:"stringToInt",value:function(t){return this.isDecimalString(t)?parseInt(t,10):this.isHexString(t)?parseInt(t,16):this.isOctalString(t)?parseInt(t,10):0}},{key:"stringToNumber",value:function(t){return void 0===t?NaN:null===t?0:""===t?0:this.isDecimalString(t)?parseFloat(t):this.isHexString(t)?parseInt(t,16):this.isOctalString(t)?parseInt(t,10):NaN}},{key:"isDecimalString",value:function(e){return t.DECIMAL_STRING_PATTERN.test(e)}},{key:"isHexString",value:function(e){return t.HEX_STRING_PATTERN.test(e)}},{key:"isOctalString",value:function(e){return t.OCTAL_STRING_PATTERN.test(e)}},{key:"numberToInt",value:function(t){return 0|t}},{key:"numberToUint",value:function(t){return this.intToUint(this.numberToInt(t))}},{key:"isNumberType",value:function(t){return"number"==typeof t||t instanceof Number}},{key:"isStringType",value:function(t){return"string"==typeof t||t instanceof String}},{key:"isBooleanType",value:function(t){return"boolean"==typeof t||t instanceof Boolean}},{key:"isIntValue",value:function(t){return this.isNumberType(t)&&Math.floor(t)===t}},{key:"unknownToUint",value:function(t){if(this.isNumberType(t)&&!isNaN(t))return this.intToUint(t>=0?Math.floor(t):Math.ceil(t));if(!0===t)return 1;if(!1===t)return 0;if(null===t||void 0===t||isNaN(t))return 0;if(""===t)return 0;if(this.isStringType(t))return this.stringToUint(t);if(t instanceof Date)return this.dateToUint();if(t instanceof q)return this.xmlToUint(t);if(t instanceof ht)return this.xmllistToUint(t);throw"FIXME - not implemented"}},{key:"intToUint",value:function(t){return t>=0?t:t>>>0}},{key:"intToNumber",value:function(t){return t}},{key:"uintToNumber",value:function(t){return t}},{key:"dateToNumber",value:function(t){return void 0===t?NaN:null===t?0:t.getTime()}},{key:"dateToInt",value:function(t){return void 0===t?NaN:this.numberToInt(this.dateToNumber(t))}},{key:"dateToUint",value:function(t){return void 0===t?NaN:this.numberToUint(this.dateToNumber(t))}},{key:"unknownToNumber",value:function(t){return this.isNumberType(t)?t:!0===t?1:!1===t?0:null===t?0:void 0===t?NaN:""===t?0:this.isStringType(t)?this.stringToNumber(t):t instanceof Date?this.dateToNumber(t):t instanceof q?this.xmlToNumber(t):t instanceof ht?this.xmllistToNumber(t):t}},{key:"unknownToBoolean",value:function(t){return this.isBooleanType(t)?t:!!t}},{key:"unknownToString",value:function(t){return this.isStringType(t)?t:null===t?null:t instanceof q||t instanceof ht?t.toString():""+t}},{key:"numberToString",value:function(t){return t.toString()}},{key:"uintToString",value:function(t){return t.toString()}},{key:"unknownToXML",value:function(t){if(t instanceof q)return t;if("string"==typeof t)return this.stringToXML(t);throw"FIXME - not implemented"}},{key:"stringToXML",value:function(t){return q.parse(t)}},{key:"unknownToXMLList",value:function(t){if(t instanceof ht)return t;if("string"==typeof t)return this.stringToXMLList(t);throw"FIXME - not implemented"}},{key:"stringToXMLList",value:function(t){var e=q.parse(t);return new ht([e])}},{key:"unknownToObject",value:function(t){return t}},{key:"booleanToString",value:function(t){return t.toString()}},{key:"intToString",value:function(t){return t.toString()}},{key:"xmlToInt",value:function(t){return this.stringToInt(this.xmlToString(t))}},{key:"xmlToUint",value:function(t){return this.stringToInt(this.xmlToString(t))}},{key:"xmlToNumber",value:function(t){return void 0===t?NaN:null===t?0:this.stringToNumber(this.xmlToString(t))}},{key:"xmlToString",value:function(t){return t?t.toString():null}},{key:"xmllistToInt",value:function(t){return 0===t.list.length?0:this.stringToInt(this.xmllistToString(t))}},{key:"xmllistToUint",value:function(t){return 0===t.list.length?0:this.stringToInt(this.xmllistToString(t))}},{key:"xmllistToNumber",value:function(t){return void 0===t?NaN:null===t?0:0===t.list.length?0:this.stringToNumber(this.xmllistToString(t))}},{key:"xmllistToString",value:function(t){return t.toString()}},{key:"qnameToString",value:function(t){return t.toString()}},{key:"castUnknownToString",value:function(t){return null===t?"null":this.unknownToString(t)}},{key:"DECIMAL_STRING_PATTERN",get:function(){return/^\s*[+-]?(([0-9]+)|([0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?))\s*$/}},{key:"HEX_STRING_PATTERN",get:function(){return/^\s*[+-]?0x[0-9a-fA-F]+\s*$/}},{key:"OCTAL_STRING_PATTERN",get:function(){return/^\s*0[0-9]+\s*$/}}]),t}();r.registerClass(A,"com.noteflight.astoes6.Convert");var I=function(){function t(e){y(this,t),this.constraint=null,this.leftConstraint=null,this.position=NaN,this.duration=NaN,this.barline=!1,this.staffIndex=0,this.voiceNumber=0,this.includeInPositioning=!1,this.constraint=e.constraint,this.leftConstraint=e.leftConstraint;var i=e.notation;this.voiceNumber=i.voiceNumber,this.staffIndex=i.measure.staff?i.measure.staff.index:-1,this.position=i.position,this.duration=i.duration,this.barline=A.is(i,En),this.includeInPositioning=!(i.excludeFromPositioning||A.is(i,ul))}return p(t,[{key:"x",get:function(){return this.constraint.layoutVector.length}}]),t}();r.registerClass(I,"LayoutPosition");var P=function t(e){y(this,t),this.voiceConstraints={},this.lastLyrics={},this.lastChordSymbol=null,this.rootConstraints=[],this.lastBarline=null,this.floatingLayouts={},this.floatingCombinedLayout=null;for(var i=0;i<e.measure.numVoices;i++)this.voiceConstraints[i.toString()]=e.leftPaddingConstraint,this.floatingLayouts[i.toString()]=null;this.voiceConstraints[-1]=e.leftPaddingConstraint};r.registerClass(P,"MeasureLayoutState");r.registerClass(function t(){y(this,t)},"NativeObject");var O=function t(e,i,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;y(this,t),this.name=null,this.nameToShow=null,this.width=NaN,this.height=NaN,this.flashName=null,this.name=e,this.nameToShow=i,this.width=n,this.height=r,this.flashName=o};r.registerClass(O,"PageSize");var Q=function t(e,i,n,r){y(this,t),this.field=null,this.start=0,this.end=0,this.staffStartIndex=0,this.field=e,this.start=i,this.end=n,this.staffStartIndex=r};r.registerClass(Q,"PartLabel");var R=function t(e,i){y(this,t),this.top=NaN,this.height=NaN,this.top=e,this.height=i};r.registerClass(R,"PlaybackHighlight");var D=function(){function t(){y(this,t)}return p(t,null,[{key:"QName_toString",value:function(t){return""===t.uri||null===t.uri?t.localName:t.uri+"::"+t.localName}},{key:"TopLevelFunctions_JS_document",value:function(){return document}},{key:"TopLevelFunctions_JS_window",value:function(){return window}},{key:"TopLevelFunctions_clearInterval",value:function(t){return clearInterval(t)}},{key:"TopLevelFunctions_clearTimeout",value:function(t){return clearTimeout(t)}},{key:"TopLevelFunctions_flash_external_ExternalInterface_call",value:function(t,e){window[t].apply(null,e)}},{key:"TopLevelFunctions_flash_utils_getDefinitionByName",value:function(t){return r.getClassForName(t)}},{key:"TopLevelFunctions_flash_utils_getQualifiedClassName",value:function(t){if(null===t)return null;if(A.isStringType(t))return"String";if(A.isNumberType(t))return"Number";if(A.isBooleanType(t))return"Boolean";var e=r.getClass(t);return e?r.getClassName(e):null}},{key:"TopLevelFunctions_flash_utils_getTimer",value:function(){return(new Date).getTime()}},{key:"TopLevelFunctions_flash_utils_setTimeout",value:function(t,e){return setTimeout(t,e)}},{key:"TopLevelFunctions_isFinite",value:function(t){return isFinite(t)}},{key:"TopLevelFunctions_isNaN",value:function(t){return isNaN(t)}},{key:"TopLevelFunctions_jQuery",value:function(t){return $(t)}},{key:"TopLevelFunctions_parseFloat",value:function(t){return parseFloat(t)}},{key:"TopLevelFunctions_parseInt",value:function(t,e){return parseInt(t,e)}},{key:"TopLevelFunctions_setInterval",value:function(t,e){return setInterval(t,e)}},{key:"TopLevelFunctions_setTimeout",value:function(t,e){return setTimeout(t,e)}},{key:"TopLevelFunctions_trace",value:function(t){console.log.apply(console,arguments)}},{key:"TopLevelFunctions_idString",value:function(t){if(!t.$nf_idString){var e=r.getUnqualifiedClassName(r.getClass(t))+"-"+F++;t.$nf_idString=e}return t.$nf_idString}},{key:"com_noteflight_notation_controller_jsflight_JsflightController_toASObject",value:function(t,e){return e?"undefined"!=typeof Uint8Array&&e instanceof Uint8Array?new Dy(e):e:null}},{key:"com_noteflight_performance_MusicPlayer_createOfflineSynthesisContext",value:function(t,e,i){var n={offline:!0,totalTime:e};return $.extend(n,$$nf.synthesis.contextOptions),new nfsyn.SynthesisContext(n)}},{key:"com_noteflight_performance_MusicPlayer_createSequencer",value:function(t,e,i,n,r,o){var s=o&&o.context?o.context:$$nf.synthesis.context,a=new nfsyn.Sequencer(s,$$nf.synthesis.manifest,{scorePositionMap:r.scorePositionMap,parts:r.performanceInfo.parts,performance:{elements:n}},o);return a.sequenceStart=e,a.premium=$$nf.synthesis.context.premium,a.playbackSpeed=$$nf.synthesis.playbackSpeed,a}},{key:"com_noteflight_performance_MusicPlayer_getAudioSynthesisContext",value:function(t){return $$nf.synthesis.context}},{key:"com_noteflight_performance_AudioMedia_loadAudioMedia",value:function(t){$$nf.synthesis.context.loadAudioMedia(t)}},{key:"com_noteflight_performance_MusicPlayerManager_createMusicPlayer",value:function(t,e,i){return $$nf.synthesis.context.active?new $$nf.classes.com.noteflight.performance.MusicPlayer(e,i):null}},{key:"com_noteflight_utils_ApplicationUtil_getLocalStorage",value:function(){return localStorage}},{key:"flash_net_SharedObject_getLocal",value:function(t,e,i){throw new $$nf.classes.Error("Local storage not supported")}},{key:"flash_system_Capabilities_getTouchscreenType",value:function(){return G.singleton.getTouchscreenType()}},{key:"flash_utils_ByteArray_copyBuffer",value:function(t,e,i,n,r){var o=new Uint8Array(i,n,r),s=new Uint8Array(t,e,r);o.set(s)}},{key:"flash_utils_ByteArray_createTypedBuffer",value:function(t){return new ArrayBuffer(t)}},{key:"flash_utils_ByteArray_createUint8Array",value:function(t){return new Uint8Array(t,0,t.byteLength)}},{key:"flash_utils_ByteArray_toString",value:function(t){for(var e="",i=0;i<t.length;i+=1e3){var n=t.length-i;n>1e3&&(n=1e3);var r=new Uint8Array(t._buffer,i,n);e+=String.fromCharCode.apply(null,r)}return e}},{key:"mx_controls_Alert_show",value:function(t){$$nf.alertHook?$$nf.alertHook(t):alert(t)}},{key:"mx_core_UIComponent_callLater",value:function(t,e,i){setTimeout(function(){return e.apply(t,i||[])})}},{key:"mx_utils_StringUtil2_trim",value:function(t){return $.trim(t)}}]),t}(),F=0;r.registerClass(D,"com.noteflight.astoes6.NativeMethods");var U=function(){function t(e,i){y(this,t),this.localName=null,this.uri=null,this.uri=e,this.localName=i}return p(t,[{key:"toString",value:function(){return D.QName_toString(this)}}]),t}();r.registerClass(U,"QName");r.registerClass(function t(){y(this,t),this.index=0,this.input=null},"RegExpResult");var V=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;y(this,t),this.startIndex=e,this.iteration=i,this.endIndex=n,this.endingSeen=!1,this.maxEnding=-1,this.repeatCount=2,this.incrementedDueToFormalElement=!1}return p(t,[{key:"implicitStart",get:function(){return this.endIndex>=0}}]),t}();r.registerClass(V,"RepeatState");var B=function t(e,i,n,r){y(this,t),this.className=null,this.methodName=null,this.now=null,this.childTime=NaN,this.className=e,this.methodName=i,this.now=n,this.childTime=r};r.registerClass(B,"StackObj");var H=function t(e){y(this,t),this.elements=null,this.staff=null,this.transcribedMeasures=null,this.elements=e};r.registerClass(H,"StaffInformation");var G=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,t),this.document=X.JS_document(),this.svgElement=null,this.phantomGroup=null,this.definitions=null,this.svgElement=e.get(0),this.options=i,this.phantomGroup=this.createElement("g"),this.phantomGroup.setAttribute("visibility","hidden"),this.svgElement.appendChild(this.phantomGroup),this.definitions=this.createElement("defs"),this.svgElement.appendChild(this.definitions),this.textMeasurement=new tg(this,i.textMeasurementCaches,i.textWidthCanvas)}return p(t,null,[{key:"SVGNS",get:function(){return"http://www.w3.org/2000/svg"}},{key:"singleton",get:function(){return Y},set:function(t){Y=t}}]),p(t,[{key:"createElement",value:function(e){return this.document.createElementNS(t.SVGNS,e)}},{key:"getScreenCTM",value:function(t){return t.getScreenCTM()}},{key:"getBBox",value:function(t){return this.internalGetBBox(t)}},{key:"internalGetBBox",value:function(t){try{var e=null;if(!t.ownerSVGElement){for(var i=t;i.parentNode;)i=i.parentNode;this.phantomGroup.appendChild(i),e=t.getBBox(),this.phantomGroup.removeChild(i)}return e||(e=t.getBBox()),e}catch(t){}var n,r,o=t.parentNode;return o&&(r=t.nextSibling,o.removeChild(t)),this.phantomGroup.appendChild(t),n=t.getBBox(),this.phantomGroup.removeChild(t),o&&(r?o.insertBefore(t,r):o.appendChild(t)),n}},{key:"transformPoint",value:function(t,e,i){var n=this.svgElement.createSVGPoint();return n.x=t,n.y=e,n.matrixTransform(i)}},{key:"getTouchscreenType",value:function(){return this.options.ignoreTouchscreen?"none":"ontouchstart"in window||navigator.msMaxTouchPoints?"finger":"none"}}]),t}(),Y=null;r.registerClass(G,"SvgContext");var z=function t(e,i){y(this,t),this.scorePosition=NaN,this.timescale=NaN,this.scorePosition=e,this.timescale=i};r.registerClass(z,"TempoEntry");var W=function t(e,i){y(this,t),this.text=null,this.time=NaN,this.text=e,this.time=i};r.registerClass(W,"TimingResult");var X=function(){function t(){y(this,t)}return p(t,null,[{key:"parseFloat",value:function(t){return D.TopLevelFunctions_parseFloat(t)}},{key:"parseInt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D.TopLevelFunctions_parseInt(t,e)}},{key:"trace",value:function(t){D.TopLevelFunctions_trace(t)}},{key:"isNaN",value:function(t){return D.TopLevelFunctions_isNaN(t)}},{key:"isFinite",value:function(t){return D.TopLevelFunctions_isFinite(t)}},{key:"setTimeout",value:function(t,e){return D.TopLevelFunctions_setTimeout(t,e)}},{key:"clearTimeout",value:function(t){D.TopLevelFunctions_clearTimeout(t)}},{key:"setInterval",value:function(t,e){return D.TopLevelFunctions_setInterval(t,e)}},{key:"clearInterval",value:function(t){D.TopLevelFunctions_clearInterval(t)}},{key:"flash_net_navigateToURL",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D.TopLevelFunctions_flash_net_navigateToURL(t,e)}},{key:"flash_utils_getDefinitionByName",value:function(t){return D.TopLevelFunctions_flash_utils_getDefinitionByName(t)}},{key:"flash_utils_getQualifiedClassName",value:function(t){return D.TopLevelFunctions_flash_utils_getQualifiedClassName(t)}},{key:"flash_utils_getTimer",value:function(){return D.TopLevelFunctions_flash_utils_getTimer()}},{key:"flash_utils_setTimeout",value:function(t,e){return D.TopLevelFunctions_flash_utils_setTimeout(t,e)}},{key:"flash_external_ExternalInterface_call",value:function(t,e){D.TopLevelFunctions_flash_external_ExternalInterface_call(t,e)}},{key:"JS_document",value:function(){return D.TopLevelFunctions_JS_document()}},{key:"JS_window",value:function(){return D.TopLevelFunctions_JS_window()}},{key:"jQuery",value:function(t){return D.TopLevelFunctions_jQuery(t)}},{key:"idString",value:function(t){return D.TopLevelFunctions_idString(t)}}]),t}();r.registerClass(X,"TopLevelFunctions");var K=function(){function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1];y(this,t)}return p(t,[{key:"push",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return D.Vector_push(this,e)}},{key:"every",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return D.Vector_every(this,t,e)}},{key:"forEach",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D.Vector_forEach(this,t,e)}},{key:"join",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:",";return D.Vector_join(this,t)}},{key:"pop",value:function(){return D.Vector_pop(this)}},{key:"some",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return D.Vector_some(this,t,e)}},{key:"sort",value:function(t){return D.Vector_sort(this,t)}},{key:"splice",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4294967295,i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return D.Vector_splice(this,t,e,n)}},{key:"toLocaleString",value:function(){return D.Vector_toLocaleString(this)}},{key:"toString",value:function(){return D.Vector_toString(this)}},{key:"unshift",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return D.Vector_unshift(this,e)}},{key:"length",get:function(){return D.Vector_$get$length(this)}}]),t}();r.registerClass(K,"Vector");var j=function t(e,i){y(this,t),this.text=null,this.width=0,this.text=e,this.width=i};r.registerClass(j,"WidthTest");var q=function(){function t(e){y(this,t),this.doc=e}return p(t,[{key:"name",value:function(){return null}},{key:"localName",value:function(){return null}},{key:"hasSimpleContent",value:function(){return!1}},{key:"child",value:function(t){throw"Not implemented"}},{key:"children",value:function(){throw"Not implemented"}},{key:"descendants",value:function(t){throw"Not implemented"}},{key:"allDescendants",value:function(){throw"Not implemented"}},{key:"appendChild",value:function(t){throw"Not implemented"}},{key:"query",value:function(t){throw"Not implemented"}},{key:"set",value:function(t,e){throw"Not implemented"}},{key:"setAttribute",value:function(t,e){throw"Not implemented"}},{key:"hasOwnProperty",value:function(t){return this.has(t)}},{key:"has",value:function(t){throw"Not implemented"}},{key:"attribute",value:function(t){throw"Not implemented"}},{key:"parent",value:function(){throw"Not implemented"}},{key:"childIndex",value:function(){throw"Not implemented"}},{key:"text",value:function(){throw"Not implemented"}},{key:"normalize",value:function(){throw"Not implemented"}},{key:"toUntrimmedString",value:function(){return this.toString()}},{key:"concat",value:function(e){var i=[this],n=null;if(e instanceof ht)n=e.list;else{if(!(e instanceof t))throw"FIXME - not implemented";n=[e]}var r=i.concat(n);return new ht(r)}},{key:"toXmlString",value:function(){throw"Not implemented"}},{key:"toXMLString",value:function(){return this.toXmlString()}},{key:"node",get:function(){throw"Not implemented"}},{key:"element",get:function(){throw"Not implemented"}}],[{key:"addToAllDescendants",value:function(e,i,n){for(var r=i.childNodes,o=0;o<r.length;o++){var s=r[o];s.nodeType===Node.ELEMENT_NODE&&(n.push(t.fromNode(e,s)),this.addToAllDescendants(e,s,n))}}},{key:"addToDescendants",value:function(e,i,n,r){for(var o=i.childNodes,s=0;s<o.length;s++){var a=o[s];a.nodeType===Node.ELEMENT_NODE&&(a.localName==n&&r.push(t.fromNode(e,a)),this.addToDescendants(e,a,n,r))}}},{key:"fromNode",value:function(e,i){switch(i.nodeType){case Node.ELEMENT_NODE:return new t.Element(e,i);case Node.TEXT_NODE:return new t.Text(e,i);case Node.PROCESSING_INSTRUCTION_NODE:return new t.ProcessingInstruction(e,i);case Node.DOCUMENT_NODE:return this.fromNode(e,i.documentElement);default:return new t.UnknownNode(e,i)}}},{key:"fromDOM",value:function(t){return this.fromNode(t.ownerDocument,t)}},{key:"parse",value:function(e){var i=new DOMParser,n=e.replace(t.NOT_SAFE_IN_XML_1_0,""),r=i.parseFromString(n,"application/xml");return this.fromNode(r,r.documentElement)}},{key:"ignoreComments",get:function(){return J},set:function(t){J=t}},{key:"ignoreWhitespace",get:function(){return Z}},{key:"prettyIndent",get:function(){return tt}},{key:"prettyPrinting",get:function(){return et}},{key:"NOT_SAFE_IN_XML_1_0",get:function(){return it}},{key:"Node",get:function(){return nt}},{key:"Text",get:function(){return rt}},{key:"Element",get:function(){return ot}},{key:"Comment",get:function(){return st}},{key:"ProcessingInstruction",get:function(){return at}},{key:"UnknownNode",get:function(){return lt}},{key:"Attr",get:function(){return ut}}]),t}(),J=!0,Z=!0,tt=2,et=!0,it=/[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm,nt=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._node=i,n}return c(e,q),p(e,[{key:"child",value:function(t){if("@"===t[0])return this.attribute(t.slice(1));for(var e=[],i=this.node.childNodes,n=0;n<i.length;n++){var r=i[n];r.nodeType===Node.ELEMENT_NODE&&r.localName==t&&e.push(q.fromNode(this.doc,r))}return new ht(e)}},{key:"children",value:function(){for(var t=[],e=this.node.childNodes,i=0;i<e.length;i++){var n=e[i];n.nodeType!==Node.ELEMENT_NODE&&n.nodeType!=Node.PROCESSING_INSTRUCTION_NODE||t.push(q.fromNode(this.doc,n))}return new ht(t)}},{key:"descendants",value:function(t){var e=[];return q.addToDescendants(this.doc,this.node,t,e),new ht(e)}},{key:"allDescendants",value:function(){var t=[];return q.addToAllDescendants(this.doc,this.node,t),new ht(t)}},{key:"query",value:function(t){var e=[];return this.node.nodeType==Node.ELEMENT_NODE&&t(this)&&e.push(this),new ht(e)}},{key:"set",value:function(t,e){if("@"===t[0])this.setAttribute(t.slice(1),e);else{var i=this.doc.createElement(t),n=this.doc.createTextNode(e);i.appendChild(n),this.node.appendChild(i)}}},{key:"setAttribute",value:function(t,e){this.element.setAttribute(t,e)}},{key:"has",value:function(t){if("@"===t[0])return this.node.nodeType===Node.ELEMENT_NODE&&this.element.hasAttribute(t.slice(1));for(var e=this.node.childNodes,i=0;i<e.length;i++){var n=e[i];if(n.nodeType==Node.ELEMENT_NODE&&n.localName==t)return!0}return!1}},{key:"attribute",value:function(t){var e=[];if(this.node.nodeType===Node.ELEMENT_NODE&&this.element.hasAttribute(t)){var i=this.element.getAttribute(t),n=new q.Attr(this.doc,null,t,i);e.push(n)}return new ht(e)}},{key:"parent",value:function(){var t=this.node.parentNode;return t?q.fromNode(this.doc,t):void 0}},{key:"childIndex",value:function(){var t=this.node.parentNode;if(!t)return-1;for(var e=0,i=t.childNodes,n=0;n<i.length;n++){var r=i[n];if(r===this.node)return e;r.nodeType===Node.ELEMENT_NODE&&e++}return-1}},{key:"text",value:function(){for(var t=[],e=this.node.childNodes,i=0;i<e.length;i++){var n=e[i];n.nodeType==Node.TEXT_NODE&&t.push(q.fromNode(this.doc,n))}return new ht(t)}},{key:"normalize",value:function(){return this.node.normalize(),this}},{key:"toXmlString",value:function(){return(new XMLSerializer).serializeToString(this.node)}},{key:"node",get:function(){return this._node}},{key:"element",get:function(){return this.node}}]),e}(),rt=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,q.Node),p(e,[{key:"hasSimpleContent",value:function(){return!0}},{key:"toString",value:function(){return this.node.nodeValue}}]),e}(),ot=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,q.Node),p(e,[{key:"name",value:function(){return new U(this.node.namespaceURI,this.node.localName)}},{key:"localName",value:function(){return this.node.localName}},{key:"hasSimpleContent",value:function(){return 0===this.node.childElementCount}},{key:"hasComplexContent",value:function(){return!this.hasSimpleContent()}},{key:"appendChild",value:function(t){if(t instanceof q)this.node.appendChild(t.node);else{if(!(t instanceof ht))throw"FIXME - not implemented";var e=!0,i=!1,n=void 0;try{for(var r,o=t.list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.node.appendChild(s.node)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"processingInstructions",value:function(){if("*"!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*"))throw"FIXME - not implemented";for(var t=[],e=this.node.childNodes,i=0;i<e.length;i++){var n=e[i];n.nodeType==Node.PROCESSING_INSTRUCTION_NODE&&t.push(q.fromNode(this.doc,n))}return new ht(t)}},{key:"toUntrimmedString",value:function(){if(this.hasSimpleContent()){for(var t="",e=this.node.childNodes,i=0;i<e.length;i++){t+=""+e[i].nodeValue}return t}return this.toXMLString()}},{key:"toString",value:function(){return this.toUntrimmedString().trim()}},{key:"dom",get:function(){return[this.node]}}]),e}(),st=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,q.Node),e}(),at=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,q.Node),p(e,[{key:"name",value:function(){return new U(this.node.namespaceURI,this.node.localName)}}]),e}(),lt=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,q.Node),e}(),ut=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t))).namespaceURI=i,o._localName=n,o.value=r,o}return c(e,q),p(e,[{key:"name",value:function(){return new U(this.namespaceURI,this._localName)}},{key:"localName",value:function(){return this._localName}},{key:"hasSimpleContent",value:function(){return!0}},{key:"toString",value:function(){return this.value}}]),e}();r.registerClass(q,"XML");var ht=function(){function t(e){y(this,t),this.list=e}return p(t,[{key:"length",value:function(){return this.list.length}},{key:"child",value:function(e){if("@"===e[0])return this.attribute(e.slice(1));var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)for(var l=s.value,u=l.node.childNodes,h=0;h<u.length;h++){var c=u[h];c.nodeType===Node.ELEMENT_NODE&&c.localName==e&&i.push(q.fromNode(l.doc,c))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return new t(i)}},{key:"children",value:function(){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=a.node.childNodes,u=0;u<l.length;u++){var h=l[u];h.nodeType!==Node.ELEMENT_NODE&&h.nodeType!=Node.PROCESSING_INSTRUCTION_NODE||e.push(q.fromNode(a.doc,h))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return new t(e)}},{key:"descendants",value:function(e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;q.addToDescendants(l.doc,l.node,e,i)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return new t(i)}},{key:"allDescendants",value:function(){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;q.addToAllDescendants(a.doc,a.node,e)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return new t(e)}},{key:"query",value:function(e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e(l)&&i.push(l)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return new t(i)}},{key:"get",value:function(t){return this.list[t]}},{key:"attribute",value:function(e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.node.nodeType===Node.ELEMENT_NODE&&l.element.hasAttribute(e)){var u=l.element.getAttribute(e),h=new q.Attr(l.doc,null,e,u);i.push(h)}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return new t(i)}},{key:"childIndex",value:function(){return 1===this.list.length?this.list[0].childIndex():-1}},{key:"appendChild",value:function(t){if(!(this.list.length>=1))throw"FIXME - not implemented";this.list[0].appendChild(t)}},{key:"processingInstructions",value:function(){if("*"!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*"))throw"FIXME - not implemented";var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=a.node.childNodes,u=0;u<l.length;u++){var h=l[u];h.nodeType==Node.PROCESSING_INSTRUCTION_NODE&&e.push(q.fromNode(a.doc,h))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return new t(e)}},{key:"has",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){if(r.value.has(t))return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"hasOwnProperty",value:function(t){return this.has(t)}},{key:"parent",value:function(){var t=null,e=!0,i=!1,n=void 0;try{for(var r,o=this.list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value.parent();if(null!=t&&t.node!=s.node)return;t=s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t||void 0}},{key:"text",value:function(){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=a.node.childNodes,u=0;u<l.length;u++){var h=l[u];h.nodeType==Node.TEXT_NODE&&e.push(q.fromNode(a.doc,h))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return new t(e)}},{key:"toString",value:function(){var t="",e=!0,i=!1,n=void 0;try{for(var r,o=this.list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){t+=r.value.toUntrimmedString()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"toXMLString",value:function(){var t="",e=!0,i=!1,n=void 0;try{for(var r,o=this.list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){t+=r.value.toXMLString()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"concat",value:function(e){var i=this.list,n=null;if(e instanceof t)n=e.list;else{if(!(e instanceof q))throw"FIXME - not implemented";n=[e]}return new t(i.concat(n))}},{key:"setAttribute",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=this.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.setAttribute(t,e)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}],[{key:"fromNodes",value:function(e,i){var n=[],r=!0,o=!1,s=void 0;try{for(var a,l=i[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;n.push(q.fromNode(e,u))}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return new t(n)}}]),t}();r.registerClass(ht,"XMLList");var ct=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];y(this,t),this.bubbles=!1,this.cancelable=!1,this.currentTarget=null,this.eventPhase=0,this.target=null,this.type=null,this._cancelled=!1,this._cancelledImmediate=!1,this._defaultPrevented=!1,this.type=e,this.bubbles=i,this.cancelable=n}return p(t,null,[{key:"ACTIVATE",get:function(){return"activate"}},{key:"ADDED",get:function(){return"added"}},{key:"ADDED_TO_STAGE",get:function(){return"addedToStage"}},{key:"CANCEL",get:function(){return"cancel"}},{key:"CHANGE",get:function(){return"change"}},{key:"CLEAR",get:function(){return"clear"}},{key:"CLOSE",get:function(){return"close"}},{key:"CLOSING",get:function(){return"closing"}},{key:"COMPLETE",get:function(){return"complete"}},{key:"CONNECT",get:function(){return"connect"}},{key:"CONTEXT3D_CREATE",get:function(){return"context3DCreate"}},{key:"COPY",get:function(){return"copy"}},{key:"CUT",get:function(){return"cut"}},{key:"DEACTIVATE",get:function(){return"deactivate"}},{key:"DISPLAYING",get:function(){return"displaying"}},{key:"ENTER_FRAME",get:function(){return"enterFrame"}},{key:"EXIT_FRAME",get:function(){return"exitFrame"}},{key:"EXITING",get:function(){return"exiting"}},{key:"FRAME_CONSTRUCTED",get:function(){return"frameConstructed"}},{key:"FRAME_LABEL",get:function(){return"frameLabel"}},{key:"FULLSCREEN",get:function(){return"fullScreen"}},{key:"HTML_BOUNDS_CHANGE",get:function(){return"htmlBoundsChange"}},{key:"HTML_DOM_INITIALIZE",get:function(){return"htmlDOMInitialize"}},{key:"HTML_RENDER",get:function(){return"htmlRender"}},{key:"ID3",get:function(){return"id3"}},{key:"INIT",get:function(){return"init"}},{key:"LOCATION_CHANGE",get:function(){return"locationChange"}},{key:"MOUSE_LEAVE",get:function(){return"mouseLeave"}},{key:"NETWORK_CHANGE",get:function(){return"networkChange"}},{key:"OPEN",get:function(){return"open"}},{key:"PASTE",get:function(){return"paste"}},{key:"PREPARING",get:function(){return"preparing"}},{key:"REMOVED",get:function(){return"removed"}},{key:"REMOVED_FROM_STAGE",get:function(){return"removedFromStage"}},{key:"RENDER",get:function(){return"render"}},{key:"RESIZE",get:function(){return"resize"}},{key:"SCROLL",get:function(){return"scroll"}},{key:"SELECT",get:function(){return"select"}},{key:"SELECT_ALL",get:function(){return"selectAll"}},{key:"SOUND_COMPLETE",get:function(){return"soundComplete"}},{key:"STANDARD_ERROR_CLOSE",get:function(){return"standardErrorClose"}},{key:"STANDARD_INPUT_CLOSE",get:function(){return"standardInputClose"}},{key:"STANDARD_OUTPUT_CLOSE",get:function(){return"standardOutputClose"}},{key:"SUSPEND",get:function(){return"suspend"}},{key:"TAB_CHILDREN_CHANGE",get:function(){return"tabChildrenChange"}},{key:"TAB_ENABLED_CHANGE",get:function(){return"tabEnabledChange"}},{key:"TAB_INDEX_CHANGE",get:function(){return"tabIndexChange"}},{key:"TEXT_INTERACTION_MODE_CHANGE",get:function(){return"textInteractionModeChange"}},{key:"TEXTURE_READY",get:function(){return"textureReady"}},{key:"TOO_MANY_MEASURES_TO_PLAY",get:function(){return"tooManyMeasuresToPlay"}},{key:"TOO_MANY_TEMPO_CHANGE_MARKINGS",get:function(){return"tooManyTempoChangeMarkings"}},{key:"UNLOAD",get:function(){return"unload"}},{key:"USER_IDLE",get:function(){return"userIdle"}},{key:"USER_PRESENT",get:function(){return"userPresent"}}]),p(t,[{key:"stopImmediatePropagation",value:function(){this._cancelled=this._cancelledImmediate=!0}},{key:"stopPropagation",value:function(){this._cancelled=!0}},{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"isDefaultPrevented",value:function(){return this._defaultPrevented}},{key:"cancelled",get:function(){return this._cancelled}},{key:"cancelledImmediate",get:function(){return this._cancelledImmediate}}]),t}();r.registerClass(ct,"flash.events.Event");var dt=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(i=l(this,h(e).call(this,t,n,r))).bytesLoaded=NaN,i.bytesTotal=NaN,i.bytesLoaded=o,i.bytesTotal=s,i}return c(e,ct),p(e,null,[{key:"PROGRESS",get:function(){return"progress"}},{key:"SOCKET_DATA",get:function(){return"socketData"}},{key:"STANDARD_ERROR_DATA",get:function(){return"standardErrorData"}},{key:"STANDARD_INPUT_PROGRESS",get:function(){return"standardInputProgress"}},{key:"STANDARD_OUTPUT_DATA",get:function(){return"standardOutputData"}}]),e}();r.registerClass(dt,"flash.events.ProgressEvent");var ft=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return y(this,e),(n=l(this,h(e).call(this,e.DETERMINATE_PROGRESS,!1,!1,t,i))).message=null,n.message=r,n}return c(e,dt),p(e,null,[{key:"DETERMINATE_PROGRESS",get:function(){return"DeterminateProgress"}}]),e}();r.registerClass(ft,"com.noteflight.events.DeterminateProgressEvent");var yt=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t))).instrumentName=null,o.numInstruments=0,o.numLoaded=0,o.instrumentName=i,o.numInstruments=r,o.numLoaded=n,o}return c(e,ct),p(e,null,[{key:"INSTRUMENT_LOAD",get:function(){return"instrumentLoad"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.instrumentName,this.numLoaded,this.numInstruments)}}]),e}();r.registerClass(yt,"com.noteflight.events.InstrumentLoadEvent");var gt=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return y(this,e),(r=l(this,h(e).call(this,t))).source=null,r.sourceName=null,r.blocking=!1,r.source=i,r.sourceName=n,r.blocking=o,r}return c(e,ct),p(e,null,[{key:"PROGRESS_START",get:function(){return"progressStart"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.source,this.sourceName,this.blocking)}}]),e}();r.registerClass(gt,"com.noteflight.events.ProgressSourceEvent");var pt="tipEvent",mt=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,pt))).key=t,i}return c(e,ct),p(e,null,[{key:"INVALID_REPEAT_TEXT",get:function(){return"invalidRepeatText"}},{key:"REPOSITIONED_SYSTEM_TEXT",get:function(){return"repositionedSystemText"}},{key:"NOT_ENOUGH_MEASURE_REPEAT_SPACE",get:function(){return"notEnoughMeasureRepeatSpace"}}]),p(e,[{key:"clone",value:function(){return new e(this.key)}}]),e}();r.registerClass(mt,"com.noteflight.notation.event.TipEvent");var vt=function t(){y(this,t)};r.registerClass(vt,"flash.events.IEventDispatcher");var _t=function t(){y(this,t)};r.implementsInterfaces(_t,[vt]),r.registerClass(_t,"com.noteflight.instruments.IInstrument");r.registerClass(function t(){y(this,t),this.chordTimeSkew=NaN,this.supportedArticulations=null},"com.noteflight.instruments.InstrumentInfo");var St=function(){function t(e){y(this,t),this._ordinal=0,this._ordinal=e}return p(t,[{key:"ordinal",get:function(){return this._ordinal}}]),t}();r.registerClass(St,"com.noteflight.music.pitch.Pitch");var Lt=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,St),p(e,[{key:"intervalAbove",value:function(t){return this.ordinal-t.ordinal}},{key:"toString",value:function(){return"[Pitch class="+this.pitchClass+" octave="+this.octave+"]"}},{key:"pitchesPerOctave",get:function(){throw new Error("pitchesPerOctave property not implemented")}},{key:"octave",get:function(){return Math.floor((this.ordinal-this.pitchClass)/this.pitchesPerOctave)}},{key:"pitchClass",get:function(){return this.ordinal>=0?this.ordinal%this.pitchesPerOctave:11-(-this.ordinal-1)%this.pitchesPerOctave}}]),e}();r.registerClass(Lt,"com.noteflight.music.pitch.TemperedPitch");var kt=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Lt),p(e,null,[{key:"C",get:function(){return 0}},{key:"C_SHARP",get:function(){return 1}},{key:"D_FLAT",get:function(){return 1}},{key:"D",get:function(){return 2}},{key:"D_SHARP",get:function(){return 3}},{key:"E_FLAT",get:function(){return 3}},{key:"E",get:function(){return 4}},{key:"F",get:function(){return 5}},{key:"F_SHARP",get:function(){return 6}},{key:"G_FLAT",get:function(){return 6}},{key:"G",get:function(){return 7}},{key:"G_SHARP",get:function(){return 8}},{key:"A_FLAT",get:function(){return 8}},{key:"A",get:function(){return 9}},{key:"A_SHARP",get:function(){return 10}},{key:"B_FLAT",get:function(){return 10}},{key:"B",get:function(){return 11}},{key:"_pitches",get:function(){return Tt},set:function(t){Tt=t}},{key:"MIDDLE_C_OCTAVE",get:function(){return 4}},{key:"SHARP_PITCH_NAMES",get:function(){return Et}},{key:"FLAT_PITCH_NAMES",get:function(){return Mt}},{key:"PITCHES_PER_OCTAVE",get:function(){return 12}},{key:"STEP_PITCH_CLASSES",get:function(){return bt}},{key:"STEP_NAMES",get:function(){return"CDEFGAB"}}]),p(e,[{key:"transpose",value:function(t){return e.getPitch(this.ordinal+t)}},{key:"toString",value:function(){return A.as(e.SHARP_PITCH_NAMES[this.pitchClass],String)+this.octave}},{key:"pitchesPerOctave",get:function(){return e.PITCHES_PER_OCTAVE}}],[{key:"getPitch",value:function(t){var i=e._pitches[t];return null==i&&(i=new e(t),e._pitches[t]=i),i}},{key:"pitchAt",value:function(t,i){return e.getPitch(t+i*e.PITCHES_PER_OCTAVE)}},{key:"middleC",value:function(){return e.pitchAt(e.C,e.MIDDLE_C_OCTAVE)}},{key:"standardA",value:function(){return e.pitchAt(e.A,e.MIDDLE_C_OCTAVE)}},{key:"pitchFromString",value:function(t){var i=X.parseInt(t);if(!X.isNaN(i))return e.getPitch(A.numberToInt(i));var n=e.STEP_NAMES.indexOf(t.charAt(0));if(n<0)throw new Error("Unrecognized pitch step "+t);var r=A.unknownToInt(e.STEP_PITCH_CLASSES[n]);"#"==(t=t.substring(1)).charAt(0)?(r++,t=t.substring(1)):"b"==t.charAt(0)&&(r--,t=t.substring(1));var o=X.parseInt(t);if(X.isNaN(o))throw new Error("Unrecognized octave: "+t);return e.pitchAt(r,A.numberToInt(o))}}]),e}(),Tt={},Et=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Mt=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],bt=[0,2,4,5,7,9,11];r.registerClass(kt,"com.noteflight.music.pitch.ChromaticPitch");var wt=function t(){y(this,t)};r.registerClass(wt,"com.noteflight.notation.common.IDestroyable");var xt=function(){function t(){y(this,t)}return p(t,null,[{key:"isInDictionary",value:function(t,e){return e.map.has(t)}},{key:"xmlForOfSource",value:function(t){throw"FIXME - not implemented"}},{key:"dictionaryForInSource",value:function(t){return t.map.keys()}},{key:"dictionaryForOfSource",value:function(t){return t.map.values()}},{key:"objectForOfSource",value:function(t){var e=[];for(var i in t)e.push(t[i]);return e}},{key:"unknownForOfSource",value:function(t){if(t instanceof q)return xmlForOfSource(t);if(t instanceof ht)return xmllistForOfSource(t);if(t instanceof Uy)return dictionaryForOfSource(t);if(t instanceof Array)return t;if(t instanceof K)return t;if(t.constructor===Object)return objectForOfSource(t);throw"FIXME - not implemented"}},{key:"deleteFromDictionary",value:function(t,e){return t.map.delete(e)}},{key:"setURLVariablesProperty",value:function(t,e,i){throw"FIXME - not implemented"}},{key:"getNsIdentiferProperty",value:function(t,e,i){throw"FIXME - not implemented"}},{key:"arraySortPredefined",value:function(t,e){throw"FIXME - not implemented"}},{key:"byteArrayGet",value:function(t,e){return t._u8view[e]}},{key:"byteArraySet",value:function(t,e,i){t._u8view[e]=i}},{key:"bindMethod",value:function(t,e){var i=t.$boundMethods;i||(i=new Map,t.$boundMethods=i);var n=i.get(e);return n||(n=e.bind(t),i.set(e,n)),n}}]),t}();r.registerClass(xt,"com.noteflight.astoes6.RuntimeHelper");var Ct=function t(){y(this,t)};r.implementsInterfaces(Ct,[wt]),r.registerClass(Ct,"com.noteflight.notation.controller.IScoreObjectMediator");var Nt=function(){function t(){y(this,t),this._view=null}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,nh),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleMouseClick)),null!=this._view.notation&&this._view.notation.addEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)),this._view.annotation.virgin&&(this._view.annotation.virgin=!1,this._view.context.documentController.editAnnotation(this._view.annotation))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleMouseClick)),null!=this._view.notation&&this._view.notation.removeEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}},{key:"handleMouseClick",value:function(t){this._view.context.controller.selectNotation(this._view.notation),this._view.context.documentController.editAnnotation(this._view.annotation),t.stopPropagation()}}]),t}();r.implementsInterfaces(Nt,[Ct]),r.registerClass(Nt,"com.noteflight.notation.controller.AnnotationMediator");var At=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(y(this,t),this.listeners=[],e)throw"Constructing EventDispatcher with a target not implemented"}return p(t,null,[{key:"weakListenerCount",get:function(){return It},set:function(t){It=t}},{key:"eventCount",get:function(){return Pt},set:function(t){Pt=t}},{key:"dispatchCount",get:function(){return Ot},set:function(t){Ot=t}}]),p(t,[{key:"addEventListener",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Mf(e,i,n,r,o);this.listeners.push(s),o&&t.weakListenerCount++}},{key:"dispatchEvent",value:function(t){this.doDispatchEvent(t,!1)}},{key:"dispatchCaptureEvent",value:function(t){this.doDispatchEvent(t,!0)}},{key:"doDispatchEvent",value:function(e,i){++t.eventCount,e.target||(e.target=this);var n,r=e.target;if(1==this.listeners.length)n=A.unknownToType(this.listeners[0],Mf),e.type!=n.type&&null!=e.type||i!=n.useCapture||(e.currentTarget=this,n.listener(e),++t.dispatchCount);else if(0!==this.listeners.length){var o=!0,s=!1,a=void 0;try{for(var l,u=this.matchingListeners(e.type,null,i)[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(n=A.unknownToType(h,Mf),e.currentTarget=this,n.listener(e),++t.dispatchCount,e.cancelledImmediate)break}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}e.target=r}},{key:"hasEventListener",value:function(t){throw"not implemented"}},{key:"removeEventListener",value:function(e,i){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=!0,r=!1,o=void 0;try{for(var s,a=this.matchingListeners(e,i)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Mf);u.useWeakReference&&t.weakListenerCount--;var h=this.listeners.indexOf(u);h>=0&&this.listeners.splice(h,1)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"willTrigger",value:function(t){throw"not implemented"}},{key:"matchingListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=!0,o=!1,s=void 0;try{for(var a,l=this.listeners[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,Mf);h.matches(t,e,i)&&n.push(h)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"updateDisplayListStats",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.listeners[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;A.unknownToType(s,Mf).updateDisplayListStats(t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"_propertyChanged",value:function(t,e,i){var n=new zy(zy.PROPERTY_CHANGE,!1,!1,Wy.UPDATE,t,e,i,this);this.dispatchEvent(n)}}]),t}();r.implementsInterfaces(At,[vt]);var It=0,Pt=0,Ot=0;r.registerClass(At,"flash.events.EventDispatcher");var Qt=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._context=null,i._dragPoint=null,i._dragStarted=!1,i._lastClickMillis=0,i.minimumDrag=3,i.doubleClick=!1,i.dragDirection=null,i._context=t,i}return c(e,At),p(e,null,[{key:"VERTICAL_DRAG",get:function(){return"vertical"}},{key:"HORIZONTAL_DRAG",get:function(){return"horizontal"}},{key:"moveEWCursor",get:function(){return Rt},set:function(t){Rt=t}},{key:"moveNSCursor",get:function(){return Dt},set:function(t){Dt=t}},{key:"moveNESWCursor",get:function(){return Ft},set:function(t){Ft=t}},{key:"moveDurationCursor",get:function(){return Ut},set:function(t){Ut=t}}]),p(e,[{key:"handleMouseDown",value:function(t){var e=X.flash_utils_getTimer();this.doubleClick=e-this._lastClickMillis<=this.context.info.doubleClickMillis,this._lastClickMillis=e,this._dragPoint=new If(this._context.stage.mouseX,this._context.stage.mouseY),this._context.stage.addEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove)),this._context.stage.addEventListener(li.MOUSE_UP,xt.bindMethod(this,this.handleMouseUp)),this.dragDirection=null,t.stopPropagation()}},{key:"handleMouseMove",value:function(t){if(!this._dragStarted&&t.buttonDown&&null!=this._dragPoint&&this.context.controller.isNotationInteractionAvailable()){var i=Math.abs(this._context.stage.mouseX-this._dragPoint.x),n=Math.abs(this._context.stage.mouseY-this._dragPoint.y);(i>=this.minimumDrag||n>=this.minimumDrag)&&(this._dragStarted=!0,this.dragDirection=i<n?e.VERTICAL_DRAG:e.HORIZONTAL_DRAG)}this._dragStarted&&this.handleDragMove(t)}},{key:"handleMouseUp",value:function(t){this._dragStarted?(this.handleDragMove(t),this.handleDragEnd(t)):this.doubleClick?this.handleDoubleClick(t):this.handleClick(t),this._context.stage.removeEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove)),this._context.stage.removeEventListener(li.MOUSE_UP,xt.bindMethod(this,this.handleMouseUp)),t.stopPropagation(),Ky.removeAllCursors()}},{key:"handleDragMove",value:function(t){}},{key:"handleDragEnd",value:function(t){}},{key:"handleClick",value:function(t){}},{key:"handleDoubleClick",value:function(t){}},{key:"dragDelta",get:function(){return new If((this.context.stage.mouseX-this._dragPoint.x)/this._context.info.displayScale,(this.context.stage.mouseY-this._dragPoint.y)/this._context.info.displayScale)}},{key:"context",get:function(){return this._context}},{key:"dragPoint",get:function(){return this._dragPoint}},{key:"dragStarted",get:function(){return this._dragStarted}}]),e}(),Rt=null,Dt=null,Ft=null,Ut=null;r.registerClass(Qt,"com.noteflight.notation.controller.DragMediator");var Vt=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t)))._undoGroupName=null,n._dragBarline=null,n._measure=null,n._dragRightMargin=!1,n._initialValue=NaN,n._undoGroupName=r,n._dragBarline=i,n._measure=i.measure,n._dragRightMargin=i.measure.index==t.layoutContext.score.numMeasures-1,n._initialValue=n._dragRightMargin?n._measure.rightMargin:n._measure.layoutWeight,n}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),Ky.removeAllCursors(),Ky.setCursor(Qt.moveEWCursor)}},{key:"handleDragMove",value:function(t){if(this._dragRightMargin){var e=A.numberToInt(Math.round((this.dragPoint.x-this.context.stage.mouseX)/(this.context.info.displayScale*this.context.layoutContext.staffMetrics.lineSpacing)));this.context.document.undoHistory.openGroupName="Change Measure Margin",this._measure.rightMargin=Math.max(0,this._initialValue+e)}else{this.context.document.undoHistory.openGroupName="Change Measure Layout Width";var i=this._initialValue*Math.exp((this.context.stage.mouseX-this.dragPoint.x)/200);i=Math.max(.5,Math.min(2,i)),this.context.controller.setLayoutWeight(this._measure,i)}}},{key:"handleClick",value:function(t){this._dragBarline&&this.context.controller.selectNotation(this._dragBarline)}}]),e}();r.registerClass(Vt,"com.noteflight.notation.controller.BarlineDragMediator");var Bt=function(){function t(){y(this,t),this._view=null,this._mouseDownSeen=!1,this._lastClickMillis=0}return p(t,null,[{key:"touchStartNotation",get:function(){return Ht},set:function(t){Ht=t}},{key:"previousTouchStartNotation",get:function(){return $t},set:function(t){$t=t}},{key:"ignoreNextMouseUp",get:function(){return Gt},set:function(t){Gt=t}}]),p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,lh),this._view.addEventListener(li.MOUSE_UP,xt.bindMethod(this,this.handleMouseUp)),this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.addEventListener(li.TOUCHSTART,xt.bindMethod(this,this.handleTouchStart)),this._view.addEventListener(li.TOUCHEND,xt.bindMethod(this,this.handleTouchEnd)),null!=this._view.notation&&this._view.notation.enabled&&(this._view.notation.addEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)),this._view.notation.addEventListener(Fi.EDIT,xt.bindMethod(this,this.handleEdit)))}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.notation&&(this._view.notation.removeEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)),this._view.notation.removeEventListener(Fi.EDIT,xt.bindMethod(this,this.handleEdit))))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"doEdit",value:function(){return!this._view.context.overlay&&(!!(A.is(this._view,uh)&&this._view.notation.enabled&&this._view.context.controller.document.isModelEditable(this._view.notation))&&(A.unknownToType(this._view,uh).editText(),!0))}},{key:"handleEdit",value:function(t){this.doEdit()}},{key:"handleMouseUp",value:function(e){t.ignoreNextMouseUp&&(t.ignoreNextMouseUp=!1,e.stopPropagation())}},{key:"handleMouseDown",value:function(t){this._mouseDownSeen=!0;var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;if(this._lastClickMillis=e,this._view.notation.enabled&&this._view.context.controller.isNotationInteractionAvailable()){var n=this._view.notation,r=n.valueNotation,o=this._view.context.controller.document.isModelEditable(n);if(o&&!(i||t.shiftKey||t.ctrlKey)){if(A.is(n,ja)){var s=n.measure.index;return void this._view.context.layoutContext.score.systemStaff.dispatchEvent(new Fi(Fi.FOCUS_MEASURE_NUMBER,s))}if(n.symbol){var a={};null!=n.customizationForViewId&&(a.measurePosition=new gl(n.measure.index,n.rhythmPosition)),new Oe(this._view,a).handleMouseDown(t)}else n.movable?(Ky.removeAllCursors(),A.is(n.measure.effectiveClef,$l)?new Fe(this._view.context,n,"Change Fret").handleMouseDown(t):new De(this._view.context,n,"Move").handleMouseDown(t),n.measure.isSystemMeasure||A.is(n,Gl)?Ky.setCursor(Qt.moveNSCursor):(new Zt(this._view.context,n.measure,n).handleMouseDown(t),Ky.setCursor(Qt.moveNESWCursor))):A.is(n,En)&&new Vt(this._view.context,A.as(n,En),"Adjust Layout").handleMouseDown(t)}if(o&&null!=r&&!i&&t.shiftKey&&t.ctrlKey&&(Ky.removeAllCursors(),Ky.setCursor(Qt.moveDurationCursor),new zt(this._view.context,n,"Adjust Duration").handleMouseDown(t)),i&&A.is(n,de)&&(n=r),this._view.context.document.undoHistory.openGroup("Select Notation"),t.shiftKey&&!t.ctrlKey&&null!=r)this._view.context.controller.selectNotationRange(r);else if(t.ctrlKey&&!t.shiftKey)this._view.context.controller.modifyNotationSelection(n);else if(A.is(n,zl))this._view.context.controller.selectNotation(n),o&&this._view.context.documentController.editTimeSignature();else if(A.is(n,Ga))this._view.context.controller.selectNotation(n),o&&this._view.context.documentController.editKeySignature();else if(A.is(n,Mn)){if(null!=n.measure)this._view.context.controller.selectNotation(n);else{var l=this._view.layout.measureLayout;null!=l&&this._view.context.controller.selectStaff(l.measure.staff)}o&&i&&this._view.context.documentController.editClef()}else if(A.is(this._view,uh)){if(this._view.context.controller.selectNotation(n),o&&i)return A.unknownToType(this._view,uh).editText(),void t.stopPropagation()}else if(A.is(n,En))this._view.context.controller.selectNotation(n);else if(null==this._view.context.document.selection||!this._view.context.document.selection.includes(n))if(this._view.context.controller.selectNotation(n),A.is(n,de)){var u=A.as(n,de);this._view.context.controller.echoNotes([u])}else if(A.is(n,Sn)&&A.unknownToType(n,Sn).notes.length>0){var h=A.as(n,Sn);this._view.context.controller.echoNotes(h.notes)}t.stopPropagation(),this._view.context.documentView.setFocus()}}},{key:"handleClick",value:function(t){if(!this._mouseDownSeen&&t.target==this._view&&this._view.context.controller.isNotationInteractionAvailable()){var e=this._view.notation;if(!this._view.selected||!this.doEdit())if(this._view.context.documentView.setFocus(),this._view.context.document.undoHistory.openGroup("Select Notation"),t.shiftKey&&this._view.notation.valueNotation?this._view.context.controller.selectNotationRange(this._view.notation.valueNotation):this._view.context.controller.selectNotation(this._view.notation),A.is(e,de)){var i=A.as(e,de);this._view.context.controller.echoNotes([i])}else if(A.is(e,Sn)&&A.unknownToType(e,Sn).notes.length>0){var n=A.as(e,Sn);this._view.context.controller.echoNotes(n.notes)}}}},{key:"handleTouchStart",value:function(e){t.previousTouchStartNotation=t.touchStartNotation,t.touchStartNotation=this._view.notation}},{key:"handleTouchEnd",value:function(e){this._view.context.controller.selectRange(this._view.notation,t.previousTouchStartNotation),t.ignoreNextMouseUp=!0}}]),t}(),Ht=null,$t=null,Gt=!1;r.implementsInterfaces(Bt,[Ct]),r.registerClass(Bt,"com.noteflight.notation.controller.BasicNotationMediator");var Yt=function(){function t(){y(this,t),this._view=null,this._dragPoint=null,this._dragDelta=0,this._lastClickMillis=0}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,rh),this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),null!=this._view.notation&&this._view.notation.addEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange))}},{key:"destroy",value:function(){this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),null!=this._view.notation&&this._view.notation.removeEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)),this._view=null}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}},{key:"handleMouseDown",value:function(t){if(this._view.context.controller.isNotationInteractionAvailable()){var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;this._lastClickMillis=e,this._dragPoint=null;var n=this._view.notation;null!=n.valueNotation&&!t.shiftKey&&t.ctrlKey,i&&(this._view.context.document.selection=this.firstRange.union(this.lastRange)),this._view.context.document.undoHistory.openGroup("Select Notation"),t.shiftKey?this._view.context.controller.selectNotationRange(A.as(n,mn)):t.ctrlKey?this._view.context.controller.modifyNotationSelection(n):null!=this._view.context.document.selection&&this._view.context.document.selection.includes(n)||this._view.context.controller.selectNotation(n),t.stopPropagation(),this._view.context.documentView.setFocus()}}},{key:"firstRange",get:function(){return Je.getRangeForNotation(this._view.layout.getBeamableLayoutAt(0).noteSet)}},{key:"lastRange",get:function(){return Je.getRangeForNotation(this._view.layout.getBeamableLayoutAt(this._view.layout.numBeamableLayouts-1).noteSet)}}]),t}();r.implementsInterfaces(Yt,[Ct]),r.registerClass(Yt,"com.noteflight.notation.controller.BeamMediator");var zt=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t)))._undoGroupName=null,n._dragNotation=null,n._dragDelta=0,n._groupCreated=!1,n._undoGroupName=r,n._dragNotation=i,n}return c(e,Qt),p(e,null,[{key:"DURATION_DRAG_QUANTUM",get:function(){return 20}}]),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this._dragDelta=0}},{key:"handleDragMove",value:function(t){this.dragDirection==Qt.HORIZONTAL_DRAG&&this.handleDurationDragMove(t)}},{key:"handleDurationDragMove",value:function(t){Ky.removeAllCursors(),Ky.setCursor(Qt.moveDurationCursor);var i=A.numberToInt(Math.round((this.context.stage.mouseX-this.dragPoint.x)/e.DURATION_DRAG_QUANTUM));i!=this._dragDelta&&(this._groupCreated&&(this.context.controller.undo(),this._groupCreated=!1),0!==i&&(this._groupCreated||(this.context.document.undoHistory.openGroup(this._undoGroupName),this._groupCreated=!0),this.context.controller.stepSelectionDuration(i)),this._dragDelta=i)}},{key:"handleClick",value:function(t){this._dragNotation&&this.context.controller.selectNotation(this._dragNotation)}}]),e}();r.registerClass(zt,"com.noteflight.notation.controller.DurationDragMediator");var Wt=function t(){y(this,t)};r.registerClass(Wt,"com.noteflight.notation.controller.IOverlayMediator");var Xt=function t(){y(this,t)};r.implementsInterfaces(Xt,[vt]),r.registerClass(Xt,"com.noteflight.notation.controller.IScoreController");var Kt=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._startMeasure=null,n._dragMeasure=null,n._view=null,n._view=i,n._startMeasure=n._view.measure,n}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.stage.addEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)),this.updateSelection(t),this.context.documentView.initializeDragAutoScroll()}},{key:"handleMouseUp",value:function(t){s(h(e.prototype),"handleMouseUp",this).call(this,t),this.context.stage.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleDragMove",value:function(t){this.updateSelection(t)}},{key:"handleEnterFrame",value:function(t){this.context.documentView.handleDragAutoScroll()}},{key:"handleClick",value:function(t){null==this._view.entryNote&&this._view.context.controller.isNotationInteractionAvailable()&&(t.shiftKey?this._view.context.controller.extendRangeToMeasure(this._view.measure):this._view.context.controller.selectRangeForMeasure(this._view.measure))}},{key:"handleDoubleClick",value:function(t){this._view.context.controller.selectStaff(this._view.measure.staff)}},{key:"updateSelection",value:function(t){if(!t.shiftKey&&!t.ctrlKey&&this._view.context.controller.isNotationInteractionAvailable()){var e=this.context.getPositionUnderMouse();if(null!=e){var i=this.context.document.score.getStaffAt(e.staffIndex).getMeasureAt(e.measureIndex);i!=this._dragMeasure&&(this._dragMeasure=i,this.context.controller.selectRangeForMeasure(this._startMeasure),this.context.controller.extendRangeToMeasure(this._startMeasure.staff.getMeasureAt(A.intToUint(this._dragMeasure.index))))}}}}]),e}();r.registerClass(Kt,"com.noteflight.notation.controller.MeasureDragMediator");var jt=function(){function t(){y(this,t),this._view=null,this._lastClickMillis=0,this._mouseDownSeen=!1}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,Uh),this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.addEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove)),this._view.addEventListener(li.MOUSE_UP,xt.bindMethod(this,this.handleMouseUp)),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),null!=this._view.measure&&this._view.measure.addEventListener(Fi.MEASURE_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.removeEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove)),this._view.removeEventListener(li.MOUSE_UP,xt.bindMethod(this,this.handleMouseUp)),this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),null!=this._view.measure&&this._view.measure.removeEventListener(Fi.MEASURE_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleMouseDown",value:function(t){var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;if(this._lastClickMillis=e,this._view.context.controller.isNotationInteractionAvailable()){if(this._mouseDownSeen=!0,this.showNoteEntryFeedback(t),i)this._view.context.document.undoHistory.openGroupName="Select Staff",this._view.context.controller.selectStaff(this._view.measure.staff);else if(null!=this._view.entryNote){this._view.context.controller.document.undoHistory.openGroup("Add Note"),this._view.entryNote.enabled=!0,this._view.entryNote.parent=null;var n=A.is(this._view.entryNoteSet.measure.effectiveClef,$l);this._view.context.controller.addNoteToNoteSet(this._view.entryNote,this._view.entryNoteSet),this._view.context.controller.document.advanceAfterNoteEntry&&(n||this._view.context.controller.setEntryAfterSelection(!0)),this._view.removeNoteEntryView(),Ky.removeAllCursors(),Ky.setCursor(Qt.moveNESWCursor),n?new Fe(this._view.context,null).handleMouseDown(t):new De(this._view.context,null).handleMouseDown(t),new zt(this._view.context,null,"Adjust Duration").handleMouseDown(t)}else this._view.mouseInStaff?this._view.context.controller.document.editable&&(A.is(this._view.context.document.selection,Je)||A.is(this._view.context.document.selection,Ke))&&this._view.context.document.selection.selectedRange.includesEntireMeasure(this._view.measure)?(this._view.context.document.undoHistory.openGroup("Move"),new Zt(this._view.context,this._view.measure,null,xt.bindMethod(this,this.handleClick)).handleMouseDown(t)):(this._view.context.document.undoHistory.openGroup("Select Measures"),new Kt(this._view.context,this._view).handleMouseDown(t)):(this._view.context.document.undoHistory.openGroup("Deselect All"),this._view.context.controller.clearSelection());this._view.context.documentView.setFocus(),this._view.context.controller.dispatchEvent(new Fi(Fi.NOTATION_SELECTED)),t.stopPropagation()}else i&&(this._mouseDownSeen=!0,this._view.context.controller.forceStop())}},{key:"handleMouseMove",value:function(t){t.buttonDown||this.showNoteEntryFeedback(t)}},{key:"handleMouseUp",value:function(t){}},{key:"showNoteEntryFeedback",value:function(t){if(this._view.context.controller.document.editable){if(!t.shiftKey&&!t.ctrlKey&&this._view.acceptNoteEntry(t)){var e=this._view.mouseX/this._view.staffMetrics.lineSpacing,i=this._view.layout.getEntryNotation(e,this._view.entryVoiceNumber);if(null!=i&&(null==this._view.insertionNoteSet||this._view.insertionNoteSet==i.notation))return void this._view.updateNoteEntryView(i,this._view.mouseY,!1)}this._view.removeNoteEntryView()}}},{key:"getMeasureFromEvent",value:function(t){if(!t.target.layout)return null;var e=Kd.getObjectProperty(t.target,"layout");if(A.is(e,Wo))return A.unknownToType(Kd.getObjectProperty(e,"measure"),hl);if(A.is(e,Uo)){var i=Kd.getObjectProperty(e,"measureLayout");return A.unknownToType(Kd.getObjectProperty(i,"measure"),hl)}return null}},{key:"handleClick",value:function(t){if(!this._view.context.controller.isNotationInteractionAvailable()){var e,i=null,n=this.getMeasureFromEvent(t);n&&(e=n.index,i=n.staff.part),this._view.context.controller.performanceModeAction(i,e),this._view.context.documentView.showPositionCursor(new gl(A.numberToUint(e),0))}!this._mouseDownSeen&&t.target==this._view&&this._view.context.controller.isNotationInteractionAvailable()&&(this._view.context.document.undoHistory.openGroup("Select Measures"),t.shiftKey?this._view.context.controller.extendRangeToMeasure(this._view.measure):t.ctrlKey?this._view.context.controller.selectStaff(this._view.measure.staff):this._view.context.controller.selectRangeForMeasure(this._view.measure))}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}}]),t}();r.implementsInterfaces(jt,[Ct]),r.registerClass(jt,"com.noteflight.notation.controller.MeasureEditMediator");var qt=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._startMeasure=null,n._dragMeasure=null,n._view=null,n._view=i,n._startMeasure=n._view.measure,n}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.stage.addEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)),this.updateSelection(t),this.context.documentView.initializeDragAutoScroll()}},{key:"handleMouseUp",value:function(t){s(h(e.prototype),"handleMouseUp",this).call(this,t),this.context.stage.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleDragMove",value:function(t){this.updateSelection(t)}},{key:"handleEnterFrame",value:function(t){this.context.documentView.handleDragAutoScroll()}},{key:"handleClick",value:function(t){t.shiftKey?this._view.context.controller.extendMeasureSelection(this._view.measure):this._view.context.controller.selectMeasure(this._view.measure)}},{key:"updateSelection",value:function(t){if(!t.shiftKey&&!t.ctrlKey){var e=this.context.getPositionUnderMouse();if(null!=e){var i=this.context.document.score.systemStaff.getMeasureAt(e.measureIndex);i!=this._dragMeasure&&(this._dragMeasure=i,this.context.controller.selectMeasure(this._startMeasure),this._dragMeasure!=this._startMeasure&&this.context.controller.extendMeasureSelection(this._dragMeasure))}}}}]),e}();r.registerClass(qt,"com.noteflight.notation.controller.MeasureHandleDragMediator");var Jt=function(){function t(){y(this,t),this._view=null,this._mouseDownSeen=!1,this._lastClickMillis=0}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,Nh),this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.addEventListener(wi.MEASURE_EDIT,xt.bindMethod(this,this.handleMeasureEdit)),null!=this._view.systemStaffMeasure&&this._view.systemStaffMeasure.addEventListener(Fi.MEASURE_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.removeEventListener(wi.MEASURE_EDIT,xt.bindMethod(this,this.handleMeasureEdit)),null!=this._view.systemStaffMeasure&&this._view.systemStaffMeasure.removeEventListener(Fi.MEASURE_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleMeasureEdit",value:function(t){switch(t.kind){case wi.ADD_AFTER:this._view.context.document.undoHistory.openGroup("Add Measure"),this._view.context.controller.insertBlankMeasureAt(A.intToUint(t.measure.index+1));break;case wi.ADD_BEFORE:this._view.context.document.undoHistory.openGroup("Add Measure"),this._view.context.controller.insertBlankMeasureAt(A.intToUint(t.measure.index));break;case wi.DELETE:this._view.context.document.undoHistory.openGroup("Delete Measure"),this._view.context.controller.selectMeasure(t.measure),this._view.context.controller.deleteSelection();break;case wi.PLAY_BACK:this._view.context.controller.playFromMeasure(t.measure.index);break;case wi.PLAY_LOOP:this._view.context.controller.playSelection({loop:!0})}}},{key:"handleMouseDown",value:function(t){var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;if(this._lastClickMillis=e,this._view.context.controller.isNotationInteractionAvailable()){if(this._mouseDownSeen=!0,i)this._view.context.document.undoHistory.openGroupName="Select Score",this._view.context.controller.selectScore();else{var n=A.as(this._view.context.document.selection,Ke);this._view.context.controller.document.editable&&null!=n&&n.includes(this._view.measure)?(this._view.context.document.undoHistory.openGroup("Move"),new Zt(this._view.context,this._view.measure,null,xt.bindMethod(this,this.handleClick)).handleMouseDown(t)):(this._view.context.document.undoHistory.openGroup("Select Measures"),this._view.aboutToBeActive=!0,new qt(this._view.context,this._view).handleMouseDown(t))}t.stopPropagation(),this._view.context.documentView.setFocus(),this._view.showControls()}else i&&(this._mouseDownSeen=!0,this._view.context.controller.forceStop())}},{key:"handleClick",value:function(t){this._view.context.controller.isNotationInteractionAvailable()&&!this._mouseDownSeen&&(this._view.context.documentView.setFocus(),this._view.context.controller.stop(),this._view.context.document.undoHistory.openGroup("Select Measures"),t.shiftKey?this._view.context.controller.extendMeasureSelection(this._view.measure):t.ctrlKey?this._view.context.controller.selectScore():this._view.context.controller.selectMeasure(this._view.measure),this._view.showControls())}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}}]),t}();r.implementsInterfaces(Jt,[Ct]),r.registerClass(Jt,"com.noteflight.notation.controller.MeasureHandleMediator");var Zt=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return y(this,e),(n=l(this,h(e).call(this,t)))._dragMeasure=null,n._dropQuantum=0,n._startPos=null,n._allowVertical=!1,n._clickHandler=null,n._dragMeasure=i,null!=r?(n._startPos=new gl(A.intToUint(r.measure.index),r.position),n._allowVertical=!1):n._allowVertical=!0,null!=r&&null!=r.valueNotation?n._dropQuantum=mn.valueToDuration(r.valueNotation.unitValue):n._dropQuantum=n._dragMeasure.timeSignature.beatDuration,n._clickHandler=o,n}return c(e,Qt),p(e,null,[{key:"moveCursorClass",get:function(){return te},set:function(t){te=t}},{key:"copyCursorClass",get:function(){return ee},set:function(t){ee=t}},{key:"rejectCursorClass",get:function(){return ie},set:function(t){ie=t}}]),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.stage.addEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)),this.context.stage.addEventListener(ui.KEY_DOWN,xt.bindMethod(this,this.handleKeyActivity)),this.context.stage.addEventListener(ui.KEY_UP,xt.bindMethod(this,this.handleKeyActivity)),this.context.documentView.initializeDragAutoScroll()}},{key:"handleMouseUp",value:function(t){s(h(e.prototype),"handleMouseUp",this).call(this,t),this.context.stage.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)),this.context.stage.removeEventListener(ui.KEY_DOWN,xt.bindMethod(this,this.handleKeyActivity)),this.context.stage.removeEventListener(ui.KEY_UP,xt.bindMethod(this,this.handleKeyActivity)),this.dragStarted||null==this._clickHandler||this._clickHandler(t)}},{key:"handleEnterFrame",value:function(t){(this._allowVertical||this.dragDirection==Qt.HORIZONTAL_DRAG)&&this.context.documentView.handleDragAutoScroll()}},{key:"handleKeyActivity",value:function(t){this.updateCursor(t.ctrlKey)}},{key:"handleDragMove",value:function(t){this.updateCursor(t.ctrlKey),(this._allowVertical||this.dragDirection==Qt.HORIZONTAL_DRAG)&&(A.is(this.context.document.selection,Ke)?this.handleMeasureDragMove(t):this.handleObjectOrRangeDragMove(t))}},{key:"updateCursor",value:function(t){this.dragStarted&&(this._allowVertical||this.dragDirection==Qt.HORIZONTAL_DRAG)&&(Ky.removeAllCursors(),t?Ky.setCursor(e.copyCursorClass):Ky.setCursor(e.moveCursorClass))}},{key:"handleMeasureDragMove",value:function(t){var e=this.context.getPositionUnderMouse(this._dropQuantum);if(null!=e){var i=this.context.document.score.getStaffAt(e.staffIndex).getMeasureAt(e.measureIndex),n=A.as(this.context.document.selection,Ke),r=i.index;if(e.position>=i.duration/2&&r++,!t.ctrlKey&&r>=n.startIndex&&r<=n.endIndex)this.context.document.dragHighlight=null;else{var o=new gl(A.intToUint(r),0);this.context.document.dragHighlight=new Je(this.context.document.score,o,o,n.selectedRange.staves)}}else this.context.document.dragHighlight=null}},{key:"handleObjectOrRangeDragMove",value:function(t){var e=this.context.getPositionUnderMouse(this._dropQuantum);if(null!=e){var i=this.context.document.score.getStaffAt(e.staffIndex).getMeasureAt(e.measureIndex);if(null==this._startPos){var n=Math.floor(e.position/i.timeSignature.beatDuration)*i.timeSignature.beatDuration;this._startPos=new gl(e.measureIndex,n)}var r=this.context.document.selection.selectedRange,o=this._dragMeasure.staff,s=null;1==r.staves.length&&(s=i.staff);var a=o.rangeDuration(this._startPos,e);if(0!==a||null!=s&&s!=o){var l=A.as(this.context.document.selection,qe),u=null!=l&&1==l.selectedObjects.length,h=o.offsetPosition(r.start,a,!1),c=u?h:o.offsetPosition(r.end,a,!0),d=A.unknownToType(null!=s?[s]:r.staves,Array);this.context.document.dragHighlight=new Je(this.context.document.score,h,c,d)}else this.context.document.dragHighlight=null}else this.context.document.dragHighlight=null}},{key:"handleDragEnd",value:function(t){if(Ky.removeAllCursors(),(this._allowVertical||this.dragDirection==Qt.HORIZONTAL_DRAG)&&null!=this.context.document.dragHighlight){var e=null;1==this.context.document.dragHighlight.staves.length&&(e=this.context.document.dragHighlight.staves[0]);var i=t.ctrlKey;this.context.document.undoHistory.openGroupName=i?"Copy":"Move";var n=this.context.document.dragHighlight.start;this.context.document.dragHighlight=null,this.context.controller.moveSelection(n.measureIndex,n.position,i,e)}}}]),e}(),te=null,ee=null,ie=null;r.registerClass(Zt,"com.noteflight.notation.controller.NotationDragMediator");var ne=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;y(this,t),this._documentController=null,this._lastKeyTime=NaN,this._lastKeyEvent=null,this._trackingCallback=null,this._documentController=e,this._trackingCallback=i}return p(t,null,[{key:"NUMBER_BUNCHING_MSEC",get:function(){return 1e3}},{key:"MAX_FRET",get:function(){return 36}}]),p(t,[{key:"handleKey",value:function(t){return!!(this.handleViewKey(t)||this.haveEditableDocument()&&this.handleEditKey(t))&&(t.stopImmediatePropagation(),this._lastKeyTime=X.flash_utils_getTimer(),this._lastKeyEvent=t,!0)}},{key:"haveEditableDocument",value:function(){return null!=this.controller.document&&(this.controller.document.editable||this.controller.document.markingsEditable)}},{key:"handleViewKey",value:function(t){switch(String.fromCharCode(t.charCode)){case String.fromCharCode(3):this.controller.copyClipboard();break;case"c":if(t.ctrlKey){this.controller.copyClipboard();break}return!1;case"P":this._documentController.startPlaybackWhenReady(xt.bindMethod(this.controller,this.controller.togglePlayStop));break;case"p":var e=this;this._documentController.startPlaybackWhenReady(function(){e.controller.togglePlayStop(!0)});break;case String.fromCharCode(27):this.controller.isNotationInteractionAvailable()?(this.controller.document.undoHistory.openGroup("Clear Selection"),this.controller.clearSelection()):this.controller.forceStop();break;case" ":this.controller.isNotationInteractionAvailable()?this._documentController.startPlaybackWhenReady(xt.bindMethod(this.controller,this.controller.togglePlayStop)):this._documentController.startPlaybackWhenReady(xt.bindMethod(this.controller,this.controller.togglePause));break;default:if(!this.handleViewKeyCode(t))return!1}return!0}},{key:"handleViewKeyCode",value:function(t){if(0!==t.charCode)return!1;switch(t.keyCode){case Cy.LEFT:if(this.controller.isPlaying)break;if(this.controller.document.tablatureSelection)return t.ctrlKey?(this.controller.document.undoHistory.openGroup("Select"),this.controller.selectPreviousNoteSet(),this._documentController.ensureSelectionVisible()):t.shiftKey?(this.controller.document.undoHistory.openGroup("Contract Selection"),this.controller.selectionLeft()):(this.controller.document.undoHistory.openGroup("Move Fret Selection Backward"),this.controller.selectPreviousNoteOnString()),!0;if(t.ctrlKey)return!1;t.shiftKey?(this.controller.document.undoHistory.openGroup("Contract Selection"),this.controller.selectionLeft()):this.controller.document.entryAfterSelection?(this.controller.document.undoHistory.openGroup("Move Insertion Point"),this.controller.setEntryAfterSelection(!1),this._documentController.ensureSelectionVisible()):null!=this.controller.document.firstSelectedNoteSet?(this.controller.document.undoHistory.openGroup("Move Left"),this.controller.selectPreviousNoteSet(),this._documentController.ensureSelectionVisible()):(this.controller.document.undoHistory.openGroup("Move Left"),this.controller.nudgeSelection(he.DIRECTION_LEFT));break;case Cy.RIGHT:if(this.controller.isPlaying)break;if(this.controller.document.tablatureSelection)return t.ctrlKey?(this.controller.document.undoHistory.openGroup("Select"),this.controller.selectNextNoteSet(),this._documentController.ensureSelectionVisible()):t.shiftKey?(this.controller.document.undoHistory.openGroup("Extend Selection"),this.controller.selectionRight()):(this.controller.document.undoHistory.openGroup("Move Fret Selection Forward"),this.controller.selectNextNoteOnString()),!0;if(t.ctrlKey)return!1;t.shiftKey?(this.controller.document.undoHistory.openGroup("Extend Selection"),this.controller.selectionRight()):null!=this.controller.document.firstSelectedNoteSet?(this.controller.document.undoHistory.openGroup("Move Right"),this.controller.selectNextNoteSet(),this._documentController.ensureSelectionVisible()):(this.controller.document.undoHistory.openGroup("Move Right"),this.controller.nudgeSelection(he.DIRECTION_RIGHT));break;case 27:this.controller.isNotationInteractionAvailable()?(this.controller.document.undoHistory.openGroup("Clear Selection"),this.controller.clearSelection()):this.controller.forceStop();break;default:return!1}return!0}},{key:"handleEditKey",value:function(t){if(this.controller.document.tablatureSelection&&this.handleTabEditKey(t))return t.stopImmediatePropagation(),!0;var e=String.fromCharCode(t.charCode),i=this,n=function(){i.controller.document.undoHistory.openGroup("Enter Note");var t=kt.STEP_NAMES.indexOf(e.toUpperCase());i.controller.document.entryAfterSelection?i.controller.enterStepAtSelection(t):i.controller.placeStepAtSelection(t),i._documentController.ensureSelectionVisible()};switch(e){case String.fromCharCode(5):this._documentController.addExpression();break;case"e":t.ctrlKey?this._documentController.addExpression():n();break;case String.fromCharCode(7):this.controller.document.undoHistory.openGroup("Add Grace Note"),this.controller.modifyGrace(!1),this._documentController.ensureSelectionVisible();break;case"g":t.ctrlKey?(this.controller.document.undoHistory.openGroup("Add Grace Note"),this.controller.modifyGrace(!1),this._documentController.ensureSelectionVisible()):n();break;case"a":case"b":case"c":case"d":case"f":n();break;case"h":e="b",n();break;case"E":if(t.ctrlKey){this._documentController.addExpression(),this._documentController.ensureSelectionVisible(),this.trackAction("expressionText");break}case"A":case"B":case"C":case"D":case"F":case"G":this.controller.document.undoHistory.openGroup("Add Note"),this.controller.addStepToSelection(kt.STEP_NAMES.indexOf(e.toUpperCase())),this._documentController.ensureSelectionVisible();break;case"H":this.controller.document.undoHistory.openGroup("Add Note"),this.controller.addStepToSelection(kt.STEP_NAMES.indexOf("B")),this._documentController.ensureSelectionVisible();break;case"<":this.controller.document.undoHistory.openGroup("Add Crescendo"),this.controller.addSpanToSelection(Va.createHairpin(Va.CRESCENDO,this.controller.document.score.effectiveStaffMetrics)),this._documentController.ensureSelectionVisible(),this.trackAction("crescendo");break;case">":this.controller.document.undoHistory.openGroup("Add Diminuendo"),this.controller.addSpanToSelection(Va.createHairpin(Va.DIMINUENDO,this.controller.document.score.effectiveStaffMetrics)),this._documentController.ensureSelectionVisible(),this.trackAction("diminuendo");break;case"k":this._documentController.addChordSymbol(),this._documentController.ensureSelectionVisible(),this.trackAction("chord");break;case"K":this.controller.document.undoHistory.openGroup("Filter Selection"),this.controller.filterSelection("filterChords"),this._documentController.ensureSelectionVisible(),this.trackAction("filterChords");break;case String.fromCharCode(12):this._documentController.addLyric(),this._documentController.ensureSelectionVisible(),this.trackAction("lyrics");break;case"l":if(t.ctrlKey){this._documentController.addLyric(),this.trackAction("lyrics");break}this.controller.document.undoHistory.openGroup("Use Lower Voice"),this.controller.selectVoice(!1),this._documentController.ensureSelectionVisible(),this.trackAction("voiceLower");break;case"L":this.controller.document.undoHistory.openGroup("Filter Selection"),this.controller.filterSelection("filterVoice1"),this._documentController.ensureSelectionVisible(),this.trackAction("filterLowerVoice");break;case"u":this.controller.document.undoHistory.openGroup("Use Upper Voice"),this.controller.selectVoice(!0),this._documentController.ensureSelectionVisible(),this.trackAction("voiceUpper");break;case"U":this.controller.document.undoHistory.openGroup("Filter Selection"),this.controller.filterSelection("filterVoice0"),this._documentController.ensureSelectionVisible(),this.trackAction("filterUpperVoice");break;case"m":case"M":this.isSyncMediaPlaying||(this.controller.document.undoHistory.openGroup("Remove Voice"),this.controller.removeSelectedVoice(),this._documentController.ensureSelectionVisible(),this.trackAction("removeVoice"));break;case"2":this.controller.document.undoHistory.openGroup("Create Duplet"),this.controller.createTuplet2(2),this._documentController.ensureSelectionVisible(),this.trackAction("duplet");break;case"3":this.controller.document.undoHistory.openGroup("Create Triplet"),this.controller.createTuplet2(3),this._documentController.ensureSelectionVisible(),this.trackAction("triplet");break;case"4":this.controller.document.undoHistory.openGroup("Create Quadruplet"),this.controller.createTuplet2(4),this._documentController.ensureSelectionVisible(),this.trackAction("quadruplet");break;case"5":this.controller.document.undoHistory.openGroup("Create Quintuplet"),this.controller.createTuplet2(5),this._documentController.ensureSelectionVisible(),this.trackAction("quintuplet");break;case"6":this.controller.document.undoHistory.openGroup("Create Sextuplet"),this.controller.createTuplet2(6),this._documentController.ensureSelectionVisible(),this.trackAction("sextuplet");break;case"7":this.controller.document.undoHistory.openGroup("Create Septuplet"),this.controller.createTuplet2(7),this._documentController.ensureSelectionVisible(),this.trackAction("septuplet");break;case"'":this.controller.document.undoHistory.openGroup("Articulation Change"),this.controller.modifyArticulation(Sn.MARCATO_ARTICULATION),this._documentController.ensureSelectionVisible(),this.trackAction("marcato");break;case'"':this.controller.document.undoHistory.openGroup("Articulation Change"),this.controller.modifyArticulation(Sn.MARTELLATO_ARTICULATION),this._documentController.ensureSelectionVisible(),this.trackAction("martellato");break;case";":this.controller.document.undoHistory.openGroup("Articulation Change"),this.controller.modifyArticulation(Sn.STACCATO_ARTICULATION),this._documentController.ensureSelectionVisible(),this.trackAction("staccato");break;case":":this.controller.document.undoHistory.openGroup("Articulation Change"),this.controller.modifyArticulation(Sn.TENUTO_ARTICULATION),this._documentController.ensureSelectionVisible(),this.trackAction("tenuto");break;case"^":this.controller.document.undoHistory.openGroup("Articulation Change"),this.controller.modifyArticulation(Sn.FERMATA_ARTICULATION),this._documentController.ensureSelectionVisible(),this.trackAction("fermata");break;case",":this.controller.document.undoHistory.openGroup("Tie Change"),this.controller.modifyTies(),this._documentController.ensureSelectionVisible(),this.trackAction("tie");break;case"~":this.controller.document.undoHistory.openGroup("Bend Change"),this.controller.modifyLiaisons(de.BEND_LIAISON),this._documentController.ensureSelectionVisible(),this.trackAction("bend");break;case"|":this.controller.document.undoHistory.openGroup("Pre-bend Change"),this.controller.modifyLiaisons(de.PRE_BEND_LIAISON),this._documentController.ensureSelectionVisible(),this.trackAction("preBend");break;case"%":this.controller.document.undoHistory.openGroup("Courtesy Accidental"),this.controller.modifyCourtesyAccidentals(),this._documentController.ensureSelectionVisible(),this.trackAction("courtesyAccidental");break;case"`":this.controller.document.undoHistory.openGroup("Parentheses"),this.controller.modifyParentheses(),this._documentController.ensureSelectionVisible(),this.trackAction("parentheses");break;case"\\":this.controller.document.undoHistory.openGroup("Slide Change"),this.controller.modifyLiaisons(de.SLIDE_LIAISON),this._documentController.ensureSelectionVisible(),this.trackAction("slide");break;case"{":this.controller.document.undoHistory.openGroup("Beam Change"),this.controller.modifyBeamBeforeSelection(),this._documentController.ensureSelectionVisible(),this.trackAction("beamContinue");break;case"}":this.controller.document.undoHistory.openGroup("Beam Change"),this.controller.modifyBeamAtSelection(),this._documentController.ensureSelectionVisible(),this.trackAction("beamStart");break;case" ":case"n":case"N":this.controller.document.undoHistory.openGroup("Enter Rest"),this.controller.enterRestAtSelection(),this._documentController.ensureSelectionVisible();break;case"/":this.controller.document.undoHistory.openGroup("Enter Slash"),this.controller.enterSlash(),this._documentController.ensureSelectionVisible(),this.trackAction("enterSlash");break;case"?":this.controller.document.undoHistory.openGroup("Note Head Change"),this.controller.modifyNoteHead(),this._documentController.ensureSelectionVisible(),this.trackAction("noteHeadChange");break;case"(":case")":case"[":case"]":case String.fromCharCode(246):case String.fromCharCode(228):this.controller.document.undoHistory.openGroup("Rhythm Change"),this.controller.adjustSelectionDuration("["==e||"("==e||246==e.charCodeAt(0)?-1:1,!1),this._documentController.ensureSelectionVisible();break;case".":this.controller.document.undoHistory.openGroup("Rhythm Change"),this.controller.adjustSelectionDuration(0,!0),this._documentController.ensureSelectionVisible();break;case"*":this.controller.document.undoHistory.openGroup("Accidental"),this.controller.applyAccidentalToSelection(2),this._documentController.ensureSelectionVisible(),this.trackAction("doubleSharp");break;case"+":case"#":this.controller.document.undoHistory.openGroup("Accidental"),this.controller.applyAccidentalToSelection(1),this._documentController.ensureSelectionVisible(),this.trackAction("sharp");break;case"-":case"@":this.controller.document.undoHistory.openGroup("Accidental"),this.controller.applyAccidentalToSelection(-1),this._documentController.ensureSelectionVisible(),this.trackAction("flat");break;case"_":this.controller.document.undoHistory.openGroup("Accidental"),this.controller.applyAccidentalToSelection(-2),this._documentController.ensureSelectionVisible(),this.trackAction("doubleFlat");break;case"=":case"$":this.controller.document.undoHistory.openGroup("Accidental"),this.controller.applyAccidentalToSelection(0),this._documentController.ensureSelectionVisible(),this.trackAction("natural");break;case String.fromCharCode(13):t.shiftKey?(this.controller.document.undoHistory.openGroup("Toggle Page Break"),this.controller.applyBreak(hl.PAGE_BREAK_TYPE),this.trackAction("pageBreakAfter")):t.ctrlKey?(this.controller.document.undoHistory.openGroup("Hide/Show Cautionaries"),this.controller.toggleCautionaries(),this.trackAction("hideShowCautionaries")):(this.controller.document.undoHistory.openGroup("Toggle System Break"),this.controller.applyBreak(hl.SYSTEM_BREAK_TYPE),this.trackAction("systemBreakAfter")),this._documentController.ensureSelectionVisible();break;case"s":case"S":t.ctrlKey||(this.controller.document.undoHistory.openGroup("Add Slur"),this.controller.addSpanToSelection(new Ol),this._documentController.ensureSelectionVisible(),this.trackAction("slur"));break;case"r":case"R":this.controller.document.undoHistory.openGroup("Repeat"),this.controller.repeatSelection(),this._documentController.ensureSelectionVisible(),this.trackAction("repeat");break;case"t":this._documentController.addPerformance(!1),this.trackAction("performanceText");break;case"T":this.controller.document.undoHistory.openGroup("Filter Selection"),this.controller.filterSelection("filterPerformance"),this._documentController.ensureSelectionVisible();break;case String.fromCharCode(22):this.controller.document.undoHistory.openGroup("Paste"),this.controller.pasteClipboard(),this._documentController.ensureSelectionVisible();break;case"v":t.ctrlKey&&(this.controller.document.undoHistory.openGroup("Paste"),this.controller.pasteClipboard(),this._documentController.ensureSelectionVisible());break;case String.fromCharCode(24):this.controller.document.undoHistory.openGroup("Cut"),this.controller.cutClipboard();break;case"x":t.ctrlKey&&(this.controller.document.undoHistory.openGroup("Cut"),this.controller.cutClipboard(),this._documentController.ensureSelectionVisible());break;case String.fromCharCode(25):this.controller.redo(),this._documentController.ensureSelectionVisible();break;case"y":t.ctrlKey&&(this.controller.redo(),this._documentController.ensureSelectionVisible());break;case String.fromCharCode(26):this.controller.undo(),this._documentController.ensureSelectionVisible();break;case"z":case"Z":t.ctrlKey?(this.controller.undo(),this._documentController.ensureSelectionVisible()):(this.controller.document.undoHistory.openGroup("Enharmonic Change"),this.controller.enharmonicShift(),this._documentController.ensureSelectionVisible(),this.trackAction("enharmonics"));break;case String.fromCharCode(8):this._documentController.ensureSelectionVisible(),this.controller.document.undoHistory.openGroup("Delete"),this.controller.deleteSelection();break;default:if(!this.handleEditKeyCode(t))return!1}return!0}},{key:"handleTabEditKey",value:function(e){if(e.ctrlKey)return!1;var i=String.fromCharCode(e.charCode);switch(i){case"a":case"b":case"c":case"d":case"e":case"f":case"g":case"A":case"B":case"C":case"D":case"E":case"F":case"G":this.controller.document.undoHistory.openGroup("Add Note"),this.controller.addStringToSelection($l.STRING_NAMES.indexOf(i.toUpperCase())),this._documentController.ensureSelectionVisible();break;case"H":case"/":case"*":case"+":case"#":case"-":case"@":case"_":case"=":case"$":case"?":break;case"x":this.controller.document.undoHistory.openGroup("Add Muted Note"),this.controller.setSelectionFret(0,!0);break;case"h":this.controller.document.undoHistory.openGroup("Add Hammer-On");var n=new Ol;n.slurArticulation=Ol.HAMMER_ON_ARTICULATION,this.controller.addSpanToSelection(n),this._documentController.ensureSelectionVisible(),this.trackAction("hammerOn");break;case"j":this.controller.document.undoHistory.openGroup("Add Pull-Off");var r=new Ol;r.slurArticulation=Ol.PULL_OFF_ARTICULATION,this.controller.addSpanToSelection(r),this._documentController.ensureSelectionVisible(),this.trackAction("pullOff");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":var o=!1,s=A.stringToNumber(i);if(X.flash_utils_getTimer()-this._lastKeyTime<=t.NUMBER_BUNCHING_MSEC){var a=String.fromCharCode(this._lastKeyEvent.charCode);if(a.match(/[0-9]/)){var l=10*A.stringToNumber(a)+s;l<=t.MAX_FRET&&(s=l,o=!0)}}o||this.controller.document.undoHistory.openGroup("Change Fret"),this.controller.setSelectionFret(A.numberToInt(s));break;default:return!1}return!0}},{key:"handleEditKeyCode",value:function(t){if(0!==t.charCode)return!1;if(this.controller.document.tablatureSelection&&this.handleTabEditKeyCode(t))return t.stopImmediatePropagation(),!0;switch(t.keyCode){case Cy.UP:if(this.controller.isPlaying)break;t.ctrlKey?(this.controller.document.undoHistory.openGroup("Move Up Octave"),this.controller.transposeSelectionAtOctave(1),this.trackAction("moveOctaveUp")):t.shiftKey?(this.controller.document.undoHistory.openGroup("Move Up Chromatic"),this.controller.transposeSelectionChromatic(1),this.trackAction("moveHalfUp")):(this.controller.document.undoHistory.openGroup("Move Up"),this.controller.transposeSelectionDiatonic(1),this.trackAction("moveUp")),this._documentController.ensureSelectionVisible();break;case Cy.DOWN:if(this.controller.isPlaying)break;t.ctrlKey?(this.controller.document.undoHistory.openGroup("Move Down Octave"),this.controller.transposeSelectionAtOctave(-1),this.trackAction("moveOctaveDown")):t.shiftKey?(this.controller.document.undoHistory.openGroup("Move Down Chromatic"),this.controller.transposeSelectionChromatic(-1),this.trackAction("moveHalfDown")):(this.controller.document.undoHistory.openGroup("Move Down"),this.controller.transposeSelectionDiatonic(-1),this.trackAction("moveDown")),this._documentController.ensureSelectionVisible();break;case Cy.LEFT:t.ctrlKey&&(this.controller.document.undoHistory.openGroup("Move Left"),this.controller.nudgeSelection(he.DIRECTION_LEFT));break;case Cy.RIGHT:t.ctrlKey&&(this.controller.document.undoHistory.openGroup("Move Right"),this.controller.nudgeSelection(he.DIRECTION_RIGHT));break;case Cy.DELETE:this._documentController.ensureSelectionVisible(),this.controller.document.undoHistory.openGroup("Delete"),this.controller.deleteSelection();break;default:return!1}return!0}},{key:"handleTabEditKeyCode",value:function(t){switch(t.keyCode){case Cy.UP:t.shiftKey?(this.controller.document.undoHistory.openGroup("Move Up Fret"),this.controller.transposeSelectionChromatic(1)):t.ctrlKey?(this.controller.document.undoHistory.openGroup("Move Up String"),this.controller.adjustStringIndex(-1)):(this.controller.document.undoHistory.openGroup("Move Up Selection"),this.controller.moveUpString()),this._documentController.ensureSelectionVisible();break;case Cy.DOWN:t.shiftKey?(this.controller.document.undoHistory.openGroup("Move Down Fret"),this.controller.transposeSelectionChromatic(-1)):t.ctrlKey?(this.controller.document.undoHistory.openGroup("Move Down String"),this.controller.adjustStringIndex(1)):(this.controller.document.undoHistory.openGroup("Move Down Selection"),this.controller.moveDownString()),this._documentController.ensureSelectionVisible();break;case Cy.DELETE:this._documentController.ensureSelectionVisible(),this.controller.document.undoHistory.openGroup("Delete"),this.controller.deleteSelection();break;case Cy.F1:case Cy.F2:case Cy.F3:case Cy.F4:case Cy.F5:case Cy.F6:case Cy.F7:case Cy.F8:case Cy.F9:case Cy.F10:var e=t.keyCode-Cy.F1;this.controller.document.undoHistory.openGroup("Add Note"),this.controller.addStringToSelection(e),this._documentController.ensureSelectionVisible();break;default:return!1}return!0}},{key:"trackAction",value:function(t){null!=this._trackingCallback&&this._trackingCallback(t)}},{key:"controller",get:function(){return this._documentController.controller}},{key:"isSyncMediaPlaying",get:function(){return this.controller.isSyncMediaPlaying}}]),t}();r.registerClass(ne,"com.noteflight.notation.controller.NoteflightKeyMediator");var re=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._scoreDocumentView=null,i._overlayWidth=0,i._scaledOverlayWidth=0,i._scoreDocumentView=t,i}return c(e,At),p(e,[{key:"setup",value:function(){if(this.isStripMode())this.checkOverlayWidth(),this.dispatchEvent(new Vi(Vi.LOADED));else{this._overlayWidth=0;var t=new Vi(Vi.WIDTH);t.width=this._overlayWidth,this.dispatchEvent(t)}}},{key:"handleUpdateOverlayPosition",value:function(t){this.isStripMode()&&this.overlayIndex!=t.measureIndex&&(this.systemLayout.swapStaffStartMeasures(A.numberToInt(t.measureIndex)),A.as(this._scoreDocumentView.scoreView,Sc).updateBackdrop(),this.checkOverlayWidth())}},{key:"handleSetStaffSpacing",value:function(t){this.systemLayout.setStaffSpacing(t),A.as(this._scoreDocumentView.scoreView,Sc).updateSystemGeometry()}},{key:"isStripMode",value:function(){return this._scoreDocumentView.viewInfo.displayMode==Nl.STRIP_DISPLAY}},{key:"checkOverlayWidth",value:function(){var t=this._scoreDocumentView.viewInfo.displayScale,e=this._scoreDocumentView.width-this._scoreDocumentView.layoutContext.stripMetrics.stripMarginRight*t;if(this._overlayWidth!=e){this._overlayWidth=e;var i=new Vi(Vi.WIDTH);i.width=this._overlayWidth,this.dispatchEvent(i)}}},{key:"overlayIndex",get:function(){return this.systemLayout.staffLayouts[0].staffStartLayout.measure.index}},{key:"systemLayout",get:function(){var t=A.as(this._scoreDocumentView.scoreLayout,Fs);return A.as(t.systemLayout,Ls)}},{key:"scaledOverlayWidth",get:function(){return this._scaledOverlayWidth}}]),e}();r.implementsInterfaces(re,[Wt]),r.registerClass(re,"com.noteflight.notation.controller.OverlayClient");var oe=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._scoreDocumentView=null,i._overlayIndex=0,i._previousOverlayIndex=0,i._overlayIndexUpdatedAt=0,i._overlayWidth=0,i._scaledOverlayWidth=0,i._scoreDocumentView=t,i}return c(e,At),p(e,null,[{key:"OVERLAY_REGRESSION_TIMEOUT",get:function(){return 500}}]),p(e,[{key:"setup",value:function(){var t=A.as(this._scoreDocumentView.scoreLayout,Fs);this.isStripMode()?(this._scoreDocumentView.addEventListener(hi.SCROLL,xt.bindMethod(this,this.determineOverlayMeasureIndex)),t.addEventListener(Vi.STAFF_SPACING,xt.bindMethod(this,this.handleUpdateStaffSpacing))):this._scoreDocumentView.removeEventListener(hi.SCROLL,xt.bindMethod(this,this.determineOverlayMeasureIndex))}},{key:"handleOverlayLoaded",value:function(t){A.as(this._scoreDocumentView.scoreLayout,Fs).systemLayout.determineStaffPositions()}},{key:"handleUpdateStaffSpacing",value:function(t){this.dispatchEvent(t)}},{key:"isStripMode",value:function(){return this._scoreDocumentView.viewInfo.displayMode==Nl.STRIP_DISPLAY}},{key:"determineOverlayMeasureIndex",value:function(){if(this.isStripMode()){var t=A.as(this._scoreDocumentView.scoreView,Sc).overlayMeasureIndex;if(this._overlayIndex!=t){var i=(new Date).getTime(),n=i-this._overlayIndexUpdatedAt<e.OVERLAY_REGRESSION_TIMEOUT;if(t==this._previousOverlayIndex&&n)return;this._previousOverlayIndex=this._overlayIndex,this._overlayIndex=t,this._overlayIndexUpdatedAt=i;var r=new Vi(Vi.POSITION);r.measureIndex=this._overlayIndex,this.dispatchEvent(r)}}}},{key:"overlayWidth",set:function(t){this._scaledOverlayWidth=t,this._overlayWidth=t/this._scoreDocumentView.viewInfo.displayScale},get:function(){return this._overlayWidth}},{key:"overlayIndex",get:function(){return this._overlayIndex}},{key:"scaledOverlayWidth",get:function(){return this._scaledOverlayWidth}}]),e}();r.implementsInterfaces(oe,[Wt]),r.registerClass(oe,"com.noteflight.notation.controller.OverlayHost");var se=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._parent=null,t._children=null,t._annotations=null,t._children=[],t._annotations=[],t.addEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(u(u(t)),t.handlePropertyChange)),t}return c(e,At),p(e,[{key:"addChild",value:function(t){this.addChildAt(t,this._children.length)}},{key:"addChildAt",value:function(t,e){t.parent=this,t.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),t.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),this._children.splice(e,0,t),this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.ADD_CHILD_MODEL,this,t,e))}},{key:"getChildAt",value:function(t){return t<this._children.length?this._children[t]:null}},{key:"removeChild",value:function(t){var e=this._children.indexOf(t);e>=0&&this.removeChildAt(A.intToUint(e))}},{key:"removeChildAt",value:function(t){var e=this.getChildAt(t);this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.REMOVING_CHILD_MODEL,this,e,t)),this.doRemoveChildAt(t),this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.REMOVE_CHILD_MODEL,this,e,t))}},{key:"doRemoveChildAt",value:function(t){var e=this.getChildAt(t);null!=e&&(e.parent=null,e.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),e.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),this._children.splice(t,1))}},{key:"removeAllChildren",value:function(){for(;this.numChildren>0;)this.removeChildAt(A.intToUint(this.numChildren-1))}},{key:"addAnnotation",value:function(t){this.addAnnotationAt(t,this._annotations.length)}},{key:"addAnnotationAt",value:function(t,e){t.parent=this,t.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),t.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),this._annotations.splice(e,0,t),this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.ADD_ANNOTATION,this,t,e))}},{key:"getAnnotationAt",value:function(t){return t<this._annotations.length?this._annotations[t]:null}},{key:"removeAnnotation",value:function(t){var e=this._annotations.indexOf(t);e>=0&&this.removeAnnotationAt(A.intToUint(e))}},{key:"removeAnnotationAt",value:function(t){var e=this.getAnnotationAt(t);null!=e&&(this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.REMOVING_ANNOTATION,this,e,t)),e.parent=null,e.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),e.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),this._annotations.splice(t,1),this.dispatchModelEvent(new Ri(Ri.MODEL_CHANGE,Ri.REMOVE_ANNOTATION,this,e,t)))}},{key:"removeAllAnnotations",value:function(){for(;this.numAnnotations>0;)this.removeAnnotationAt(A.intToUint(this.numAnnotations-1))}},{key:"getAllAnnotations",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._annotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push(s),s.getAllAnnotations(t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var a=!0,l=!1,u=void 0;try{for(var h,c=this._children[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){h.value.getAllAnnotations(t)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}},{key:"getAncestorOfType",value:function(t){for(var e=this.parent;null!=e&&!A.is(e,t);)e=e.parent;return e}},{key:"pathToChild",value:function(t){if(A.is(t,Ea))return Ea.PATH_PREFIX+this._annotations.indexOf(t).toString();if(A.is(t,El)){for(var e=0;e<this._children.length;e++){var i=this._children[e];if(A.is(i,Rl))if(A.as(i,Rl).part==t)return El.PATH_PREFIX+e.toString()}throw new Error("Unable to resolve Part in score.")}return this._children.indexOf(t).toString()}},{key:"resolvePath",value:function(t){var e=t.indexOf("/");if(e<0)return this.resolvePathComponent(t);var i=t.substring(0,e),n=t.substring(e+1);return this.resolvePathComponent(i).resolvePath(n)}},{key:"resolvePathComponent",value:function(t){return t.charAt(0)==Ea.PATH_PREFIX?A.as(this._annotations[X.parseInt(t.substring(1))],e):t.charAt(0)==El.PATH_PREFIX?A.unknownToType(this._children[X.parseInt(t.substring(1))],Rl).part:A.is(this,hl)&&"n"==t.charAt(0)?A.unknownToType(this,hl).getNotationAt(A.numberToInt(X.parseInt(t.substring(1)))):A.is(this,hl)&&t.charAt(0)==wa.PATH_PREFIX?A.unknownToType(this,hl).getBlockAt(A.numberToInt(X.parseInt(t.substring(1)))):A.as(this._children[X.parseInt(t)],e)}},{key:"handlePropertyChange",value:function(t){if(t.kind==Wy.UPDATE){var e=new Di(Di.MODEL_UPDATE,t.property,t.oldValue,t.newValue,t.source);this.dispatchModelUpdateEvent(e)}}},{key:"handleChildModelChange",value:function(t){this.dispatchModelEvent(t)}},{key:"handleChildModelUpdate",value:function(t){this.dispatchModelUpdateEvent(t)}},{key:"dispatchModelEvent",value:function(t){this.dispatchEvent(t)}},{key:"dispatchModelUpdateEvent",value:function(t){this.dispatchEvent(t)}},{key:"layoutPropertyChange",value:function(t){return!0}},{key:"getModelProperty",value:function(t){return Kd.getObjectProperty(this,t)}},{key:"setModelProperty",value:function(t,e){Kd.setObjectProperty(this,t,e)}},{key:"clone",value:function(){var t=A.as(X.flash_utils_getDefinitionByName(X.flash_utils_getQualifiedClassName(this)),L),i=A.unknownToType(new t,e);i.removeAllChildren();var n=!0,r=!1,o=void 0;try{for(var s,a=this._children[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.addChild(l.clone())}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}var u=!0,h=!1,c=void 0;try{for(var d,f=this._annotations[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;i.addAnnotation(A.as(y.clone(),Ea))}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}return i}},{key:"index",get:function(){return null==this._parent?-1:this._parent._children.indexOf(this)}},{key:"annotations",get:function(){return this._annotations}},{key:"allAnnotations",get:function(){var t=[];return this.getAllAnnotations(t),t}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"numChildren",get:function(){return this._children.length}},{key:"numAnnotations",get:function(){return this._annotations.length}},{key:"descendants",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this._children[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push(s),t=t.concat(s.descendants)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var a=!0,l=!1,u=void 0;try{for(var h,c=this._annotations[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;t.push(d),t=t.concat(d.descendants)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}return t}},{key:"ancestors",get:function(){for(var t=[],e=this.parent;null!=e;)t.push(e),e=e.parent;return t}},{key:"path",get:function(){var t=this.parent;return null==t?"/":A.is(t,Nl)?t.pathToChild(this):t.path+"/"+t.pathToChild(this)}}],[{key:"cloneModel",value:function(t){return null==t?null:t.clone()}},{key:"cloneArray",value:function(t){if(null==t)return null;for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}}]),e}();r.registerClass(se,"com.noteflight.notation.model.Model");var ae=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._$rhythmPosition=0,i._lastVoiceNumber=0,i.rhythmPosition=A.intToUint(t),i}return c(e,se),p(e,null,[{key:"RHYTHM_COMPARISON_THRESHOLD",get:function(){return.01}}]),p(e,[{key:"inRhythmContext",value:function(t){for(var e=this.parent;null!=e&&e!=t;)e=e.parent;return e==t}},{key:"startsAtPosition",value:function(t){return Math.abs(this.position-t)<e.RHYTHM_COMPARISON_THRESHOLD}},{key:"endsAtPosition",value:function(t){return Math.abs(this.position+this.duration-t)<e.RHYTHM_COMPARISON_THRESHOLD}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.rhythmPosition=this.rhythmPosition,t._lastVoiceNumber=this.lastVoiceNumber,t}},{key:"rhythmPosition",get:function(){return this._$rhythmPosition},set:function(t){var e=this._$rhythmPosition;this._$rhythmPosition=t,e!==t&&this._propertyChanged("rhythmPosition",e,t)}},{key:"rhythmContext",get:function(){return A.as(this.getAncestorOfType(Ha),Ha)}},{key:"measure",get:function(){return A.as(this.getAncestorOfType(hl),hl)}},{key:"voice",get:function(){return A.as(this.getAncestorOfType(Kl),Kl)}},{key:"score",get:function(){return A.as(this.getAncestorOfType(Nl),Nl)}},{key:"measurePosition",get:function(){return new gl(A.intToUint(this.measure.index),this.position)}},{key:"endPosition",get:function(){return new gl(A.intToUint(this.measure.index),this.position+this.duration)}},{key:"voiceNumber",get:function(){var t=this.voice;return null!=t?t.voiceNumber:Kl.UNKNOWN_VOICE_NUMBER}},{key:"lastVoiceNumber",get:function(){var t=this.voiceNumber;return t!=Kl.UNKNOWN_VOICE_NUMBER?t:this._lastVoiceNumber},set:function(t){this._lastVoiceNumber=t}},{key:"parent",set:function(t){null==t&&(this._lastVoiceNumber=this.voiceNumber),this._parent=t},get:function(){return s(h(e.prototype),"parent",this)}},{key:"position",get:function(){return this.rhythmContext.getPosition(this.rhythmPosition)}},{key:"rhythmDuration",get:function(){return 0}},{key:"duration",get:function(){return this.rhythmContext.getDuration(this.rhythmDuration)}},{key:"inSystemStaff",get:function(){return this.measure&&this.measure.isSystemMeasure}}],[{key:"compareScorePosition",value:function(t,e){var i;if(null!=t.measure&&null!=e.measure){if(0!=(i=t.measure.index-e.measure.index))return i<0?-1:1;if(0!=(i=t.position-e.position))return i<0?-1:1;if(t.measure.staff&&e.measure.staff&&0!=(i=t.measure.staff.index-e.measure.staff.index))return i<0?-1:1}else if(0!=(i=t.rhythmPosition-e.rhythmPosition))return i<0?-1:1;if(0!=(i=t.voiceNumber-e.voiceNumber))return i<0?-1:1;if(A.is(t,Sn)&&A.is(e,Sn)){var n=A.as(t,Sn),r=A.as(e,Sn);if(n.grace&&r.grace&&n===r.previousGraceNote)return-1;var o=n.grace?1:0;return(r.grace?1:0)-o}return A.is(t,Sn)&&A.is(e,Va)?1:0}},{key:"comparePosition",value:function(t,e){var i;return 0!=(i=t.position-e.position)?i<0?-1:1:0!=(i=t.voiceNumber-e.voiceNumber)?i<0?-1:1:0!=(i=t.index-e.index)?i<0?-1:1:0}}]),e}();r.registerClass(ae,"com.noteflight.notation.model.RhythmElement");var le=function t(){y(this,t)};r.registerClass(le,"com.noteflight.notation.model.IRhythmExtent");var ue=function t(){y(this,t)};r.implementsInterfaces(ue,[le]),r.registerClass(ue,"com.noteflight.notation.model.IRhythmElement");var he=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t)))._$enabled=!0,i._$dx=0,i._$dy=0,i._$cue=!1,i._$direction=null,i._$color=0,i.excludeFromPositioning=!1,i.implicitDy=!1,i._initialMeasure=0,i._initialPosition=0,i._$customizationsForViews=[],i.canBeCustomizedForView=!1,i}return c(e,ae),p(e,null,[{key:"DIRECTION_UP",get:function(){return"up"}},{key:"DIRECTION_DOWN",get:function(){return"down"}},{key:"DIRECTION_LEFT",get:function(){return"left"}},{key:"DIRECTION_RIGHT",get:function(){return"right"}},{key:"HIDDEN_COLOR",get:function(){return 16777215}},{key:"PLACEMENT_ABOVE",get:function(){return 999}},{key:"PLACEMENT_BELOW",get:function(){return-999}}]),p(e,[{key:"propertyChanged",value:function(t,e,i){this._propertyChanged(t,e,i)}},{key:"sameVoiceAs",value:function(t){return t.measure==this.measure&&t.voiceNumber==this.voiceNumber}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.enabled=this.enabled,t.dx=this.dx,t.dy=this.dy,t.direction=this.direction,t.cue=this.cue,t.color=this.color,t}},{key:"requestValidation",value:function(){}},{key:"editCustomizationForView",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.canBeCustomizedForView)if(t){for(var n=0;n<this.customizationsForViews.length;n++)if(this.customizationsForViews[n].viewId==t)return void this.customizationsForViews[n].updateOptions(i);this.customizationsForViews.push(new Qe(this,t,i))}else s(h(e.prototype),"editCustomizationForView",this).call(this,t,i);else for(var r in i)this[r]=i[r]}},{key:"getCustomizationForView",value:function(t,e){if(t)for(var i=0;i<this.customizationsForViews.length;i++)if(this.customizationsForViews[i].viewId==t){if(null!=this.customizationsForViews[i][e])return this.customizationsForViews[i][e];break}return null}},{key:"getEffectiveValueForView",value:function(t,e){var i=this.getCustomizationForView(t,e);return this.canBeCustomizedForView&&null!==i?i:this[e]}},{key:"removeCustomizationForView",value:function(t){for(var e=0;e<this.customizationsForViews.length;e++)this.customizationsForViews[e].viewId==t&&this.customizationsForViews.splice(e,1)}},{key:"handleDraggingStart",value:function(){this._initialPosition=this.position,this._initialMeasure=this.measure.index}},{key:"handleDraggingEnd",value:function(t){if(this.canBeCustomizedForView&&this.anchorPointCanBeEdited&&this.customizationsForViews.length>0&&(this.position!=this._initialPosition||this.measure.index!=this._initialMeasure)){for(var e=0;e<this.customizationsForViews.length;e++)this.customizationsForViews[e].dx=null;t&&t()}}},{key:"enabled",get:function(){return this._$enabled},set:function(t){var e=this._$enabled;this._$enabled=t,e!==t&&this._propertyChanged("enabled",e,t)}},{key:"dx",get:function(){var t=this.getCustomizationForView(this.customizationForViewId,"dx");return null!==t?t:this._$dx},set:function(t){if(this.customizationForViewId)this.editCustomizationForView(this.customizationForViewId,{dx:t});else{var e=this._$dx;this._$dx=t,e!==t&&this._propertyChanged("dx",e,t)}}},{key:"dy",get:function(){var t=this.getCustomizationForView(this.customizationForViewId,"dy");return null!==t?t:this._$dy},set:function(t){if(this.customizationForViewId)this.editCustomizationForView(this.customizationForViewId,{dy:t});else{var e=this._$dy;this._$dy=t,e!==t&&this._propertyChanged("dy",e,t)}}},{key:"color",get:function(){var t=this.getCustomizationForView(this.customizationForViewId,"color");return null!==t?t:this._$color},set:function(t){if(this.customizationForViewId)this.editCustomizationForView(this.customizationForViewId,{color:t});else{var e=this._$color;this._$color=t,e!==t&&this._propertyChanged("color",e,t)}}},{key:"privateDx",get:function(){return this._$dx}},{key:"privateDy",get:function(){return this._$dy}},{key:"privateColor",get:function(){return this._$color}},{key:"cue",get:function(){return this._$cue},set:function(t){var e=this._$cue;this._$cue=t,e!==t&&this._propertyChanged("cue",e,t)}},{key:"direction",get:function(){return this._$direction},set:function(t){var e=this._$direction;this._$direction=t,e!==t&&this._propertyChanged("direction",e,t)}},{key:"customizationsForViews",get:function(){return this._$customizationsForViews},set:function(t){var e=this._$customizationsForViews;this._$customizationsForViews=t,e!==t&&this._propertyChanged("customizationsForViews",e,t)}},{key:"anchorPointCanBeEdited",get:function(){return null==this.customizationForViewId||!this.canBeCustomizedForView}},{key:"customizationForViewId",get:function(){return this.canBeCustomizedForView&&this.measure&&this.measure.staff&&this.measure.staff.score?this.measure.staff.score.customizationForViewId:null}},{key:"valueNotation",get:function(){return A.as(this,mn)}},{key:"metrical",get:function(){return!1}},{key:"movable",get:function(){return!1}},{key:"symbol",get:function(){return!1}},{key:"showOnlyOnSystemStaff",get:function(){return!1}},{key:"affectsParentLayout",get:function(){return!0}},{key:"hasValueConstraint",get:function(){return this.metrical}},{key:"units",get:function(){return 0}},{key:"unitValue",get:function(){return A.intToUint(mn.TWO_HUNDRED_FIFTY_SIXTH)}},{key:"effectiveColor",get:function(){return this.color},set:function(t){this.color=t}},{key:"invisible",get:function(){return this.effectiveColor==e.HIDDEN_COLOR}},{key:"effectiveCue",get:function(){return this.cue},set:function(t){this.cue=t}},{key:"marking",get:function(){return!1}},{key:"y",get:function(){if(null==this.score)return 0;var t=this.dy-this.paddingY;return this.alignToStaffTop&&(t+=this.measure.effectiveClef.staffHeight),t},set:function(t){null!=this.score&&(this.dy=t+this.paddingY,this.alignToStaffTop&&(this.dy-=this.measure.effectiveClef.staffHeight))}},{key:"alignToStaffTop",get:function(){return!1}},{key:"paddingY",get:function(){return 0}}]),e}();r.implementsInterfaces(he,[ue]),r.registerClass(he,"com.noteflight.notation.model.Notation");var ce=function(t){function e(){return y(this,e),l(this,h(e).call(this,0))}return c(e,he),p(e,[{key:"noteSet",get:function(){return A.as(this.parent,Sn)}},{key:"position",get:function(){return null!=this.noteSet?this.noteSet.position:0}},{key:"measure",get:function(){return null!=this.noteSet?this.noteSet.measure:null}},{key:"rhythmPosition",get:function(){return null!=this.noteSet?this.noteSet.rhythmPosition:0},set:function(t){o(h(e.prototype),"rhythmPosition",A.intToUint(t),this,!0)}},{key:"voiceNumber",get:function(){return null!=this.noteSet?this.noteSet.voiceNumber:0}},{key:"valueNotation",get:function(){return this.noteSet}}]),e}();r.registerClass(ce,"com.noteflight.notation.model.NoteSetChild");var de=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return y(this,e),(t=l(this,h(e).call(this)))._$pitch=null,t._$step=0,t._$accidental=null,t._$explicitAccidental=!1,t._$courtesyAccidental=!1,t._$liaison=null,t._$incomingLiaison=null,t._$preEffect=null,t._$postEffect=null,t._$noteHead=null,t._$tuning=0,t._$stringIndex=-1,t._$fret=-1,t._$parentheses=!1,t._$liaisonStartNote=null,t._$liaisonEndNote=null,t._$silent=!1,t.pitch=i,t.step=n>=0||null==i?n:e.DEFAULT_STEPS[i.pitchClass],t.accidental=r,t.liaison=o?e.TIE_LIAISON:null,t.noteHead=s,t}return c(e,ce),p(e,null,[{key:"C",get:function(){return 0}},{key:"D",get:function(){return 1}},{key:"E",get:function(){return 2}},{key:"F",get:function(){return 3}},{key:"G",get:function(){return 4}},{key:"A",get:function(){return 5}},{key:"B",get:function(){return 6}},{key:"STEP_PITCHES",get:function(){return fe}},{key:"STEP_INTERVALS",get:function(){return ye}},{key:"DEFAULT_STEPS",get:function(){return ge}},{key:"DEFAULT_SHARP_STEPS",get:function(){return pe}},{key:"LEAST_FIFTHS_STEPS",get:function(){return me}},{key:"LEAST_FIFTHS",get:function(){return ve}},{key:"DOUBLE_FLAT",get:function(){return"doubleFlat"}},{key:"FLAT",get:function(){return"flat"}},{key:"NATURAL",get:function(){return"natural"}},{key:"SHARP",get:function(){return"sharp"}},{key:"DOUBLE_SHARP",get:function(){return"doubleSharp"}},{key:"ACCIDENTAL_TABLE",get:function(){return _e}},{key:"ALTERATION_TABLE",get:function(){return Se}},{key:"NORMAL_NOTE_HEAD",get:function(){return"normal"}},{key:"STEMLESS_NOTE_HEAD",get:function(){return"stemless"}},{key:"SLASH_NOTE_HEAD",get:function(){return"slash"}},{key:"HIT_NOTE_HEAD",get:function(){return"hit"}},{key:"CROSS_NOTE_HEAD",get:function(){return"cross"}},{key:"SQUARE_NOTE_HEAD",get:function(){return"square"}},{key:"DIAMOND_NOTE_HEAD",get:function(){return"diamond"}},{key:"TRIANGLE_NOTE_HEAD",get:function(){return"triangle"}},{key:"HARMONIC_NOTE_HEAD",get:function(){return"harmonic"}},{key:"CROSS_CIRCLE_NOTE_HEAD",get:function(){return"crossCircle"}},{key:"TIE_LIAISON",get:function(){return"tie"}},{key:"BEND_LIAISON",get:function(){return"bend"}},{key:"PRE_BEND_LIAISON",get:function(){return"preBend"}},{key:"SLIDE_LIAISON",get:function(){return"slide"}},{key:"GLISSANDO_LIAISON",get:function(){return"glissando"}}]),p(e,[{key:"alter",value:function(t){return new e(this.pitch.transpose(t),this.step)}},{key:"transposeDiatonic",value:function(t){for(var i=this.step+t,n=this.notatedOctave;i>=7;)i-=7,n++;for(;i<0;)i+=7,n--;return new e(kt.pitchAt(e.STEP_PITCHES[i],n),i)}},{key:"transposeInterval",value:function(t){if(t.unison)return this;for(var i=this.step+t.steps;i>=7;)i-=7;for(;i<0;)i+=7;var n=new e(kt.getPitch(this.pitch.ordinal+t.pitches),i);return n.normalizeAlteration(),null!=this.accidental&&(n.accidental=e.alterationToAccidental(n.alteration),n.courtesyAccidental=this.courtesyAccidental),n}},{key:"normalizeAlteration",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;this.alteration>t;)this.step=(this.step+1)%7;for(;this.alteration<-t;)this.step=(this.step+7-1)%7}},{key:"intervalFrom",value:function(t){return new $a(this.diatonicOrdinal-t.diatonicOrdinal,this.pitch.ordinal-t.pitch.ordinal)}},{key:"sameAs",value:function(t){return this==t||this.pitch.ordinal==t.pitch.ordinal&&this.step==t.step}},{key:"setLiaison",value:function(t){this.noteSet.removeArticulation(Sn.LV_TIE_ARTICULATION),this.liaison=t}},{key:"clearLiaison",value:function(t){this.liaison==t&&(this.liaison=null)}},{key:"canonicalIntervalFrom",value:function(t){var i=A.as(this.clone(),e),n=$a.fromPitches(this.pitch.ordinal-t.pitch.ordinal);return 6==n.intervalClass?null:(i.step=(t.step+n.stepClass)%7,i)}},{key:"getAlteredness",value:function(t){return Math.abs(t.getAlteration(A.intToUint(this.step))-this.alteration)}},{key:"addPreEffect",value:function(t){this.preEffect=t,this.addChild(t)}},{key:"addPostEffect",value:function(t){this.postEffect=t,this.addChild(t)}},{key:"removePreEffect",value:function(){this.removeChild(this.preEffect),this.preEffect=null}},{key:"removePostEffect",value:function(){this.removeChild(this.postEffect),this.postEffect=null}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.pitch=this.pitch,t.step=this.step,t.accidental=this.accidental,t.explicitAccidental=this.explicitAccidental,t.courtesyAccidental=this.courtesyAccidental,t.liaison=this.liaison,t.incomingLiaison=this.incomingLiaison,t.noteHead=this.noteHead,t.parentheses=this.parentheses,t.tuning=this.tuning,t.stringIndex=this.stringIndex,t.fret=this.fret,null!==this.preEffect&&t.addPreEffect(this.preEffect.clone()),null!==this.postEffect&&t.addPostEffect(this.postEffect.clone()),t}},{key:"pitch",get:function(){return this._$pitch},set:function(t){var e=this._$pitch;this._$pitch=t,e!==t&&this._propertyChanged("pitch",e,t)}},{key:"step",get:function(){return this._$step},set:function(t){var e=this._$step;this._$step=t,e!==t&&this._propertyChanged("step",e,t)}},{key:"accidental",get:function(){return this._$accidental},set:function(t){var e=this._$accidental;this._$accidental=t,e!==t&&this._propertyChanged("accidental",e,t)}},{key:"explicitAccidental",get:function(){return this._$explicitAccidental},set:function(t){var e=this._$explicitAccidental;this._$explicitAccidental=t,e!==t&&this._propertyChanged("explicitAccidental",e,t)}},{key:"courtesyAccidental",get:function(){return this._$courtesyAccidental},set:function(t){var e=this._$courtesyAccidental;this._$courtesyAccidental=t,e!==t&&this._propertyChanged("courtesyAccidental",e,t)}},{key:"liaison",get:function(){return this._$liaison},set:function(t){var e=this._$liaison;this._$liaison=t,e!==t&&this._propertyChanged("liaison",e,t)}},{key:"incomingLiaison",get:function(){return this._$incomingLiaison},set:function(t){var e=this._$incomingLiaison;this._$incomingLiaison=t,e!==t&&this._propertyChanged("incomingLiaison",e,t)}},{key:"preEffect",get:function(){return this._$preEffect},set:function(t){this._$preEffect=t}},{key:"postEffect",get:function(){return this._$postEffect},set:function(t){this._$postEffect=t}},{key:"noteHead",get:function(){return this._$noteHead},set:function(t){var e=this._$noteHead;this._$noteHead=t,e!==t&&this._propertyChanged("noteHead",e,t)}},{key:"tuning",get:function(){return this._$tuning},set:function(t){var e=this._$tuning;this._$tuning=t,e!==t&&this._propertyChanged("tuning",e,t)}},{key:"stringIndex",get:function(){return this._$stringIndex},set:function(t){var e=this._$stringIndex;this._$stringIndex=t,e!==t&&this._propertyChanged("stringIndex",e,t)}},{key:"fret",get:function(){return this._$fret},set:function(t){var e=this._$fret;this._$fret=t,e!==t&&this._propertyChanged("fret",e,t)}},{key:"parentheses",get:function(){return this._$parentheses},set:function(t){var e=this._$parentheses;this._$parentheses=t,e!==t&&this._propertyChanged("parentheses",e,t)}},{key:"liaisonStartNote",get:function(){return this._$liaisonStartNote},set:function(t){var e=this._$liaisonStartNote;this._$liaisonStartNote=t,e!==t&&this._propertyChanged("liaisonStartNote",e,t)}},{key:"liaisonEndNote",get:function(){return this._$liaisonEndNote},set:function(t){var e=this._$liaisonEndNote;this._$liaisonEndNote=t,e!==t&&this._propertyChanged("liaisonEndNote",e,t)}},{key:"silent",get:function(){return this._$silent},set:function(t){var e=this._$silent;this._$silent=t,e!==t&&this._propertyChanged("silent",e,t)}},{key:"movable",get:function(){return!0}},{key:"diatonicPitch",get:function(){return this.pitch.transpose(-this.alteration)}},{key:"notatedOctave",get:function(){return this.diatonicPitch.octave}},{key:"diatonicOrdinal",get:function(){return this.step+7*this.notatedOctave}},{key:"stemless",get:function(){return this.noteHead==e.STEMLESS_NOTE_HEAD&&(null==this.noteSet||this.noteSet.value>=mn.QUARTER)}},{key:"alteration",get:function(){var t=this.pitch.pitchClass-e.STEP_PITCHES[this.step];return t>6?t-=12:t<-6&&(t+=12),t}},{key:"playable",get:function(){return this.noteHead!=e.SLASH_NOTE_HEAD&&this.noteHead!=e.HIT_NOTE_HEAD}},{key:"tunedOrdinal",get:function(){return this.pitch.ordinal+this.tuning/100}},{key:"tied",get:function(){return this.liaison==e.TIE_LIAISON},set:function(t){this.liaison=t?e.TIE_LIAISON:null}},{key:"bent",get:function(){return this.liaison==e.BEND_LIAISON||this.liaison==e.PRE_BEND_LIAISON}},{key:"slide",get:function(){return this.liaison==e.SLIDE_LIAISON}},{key:"glissando",get:function(){return this.liaison==e.GLISSANDO_LIAISON}},{key:"tieEnd",get:function(){return null!=this.liaisonStartNote&&this.liaisonStartNote.tied}},{key:"cumulativeBend",get:function(){for(var t=0,i=this;null!=i.liaisonStartNote&&(i.liaisonStartNote.bent||i.liaisonStartNote.liaison==e.TIE_LIAISON);)t+=i.tunedOrdinal-i.liaisonStartNote.tunedOrdinal,i=i.liaisonStartNote;return t}},{key:"relativeBend",get:function(){return null==this.liaisonStartNote||!this.liaisonStartNote.bent&&this.liaisonStartNote.liaison!=e.TIE_LIAISON?0:this.tunedOrdinal-this.liaisonStartNote.tunedOrdinal}},{key:"noteIndex",get:function(){return null==this.noteSet?-1:this.noteSet.notes.indexOf(this)}},{key:"hasIndexLiaison",get:function(){return null!=this.liaison&&this.liaison!=e.TIE_LIAISON}},{key:"hasPreEffect",get:function(){return null!=this.preEffect}},{key:"hasPostEffect",get:function(){return null!=this.postEffect}},{key:"hasEffect",get:function(){return this.hasPreEffect||this.hasPostEffect}},{key:"effectiveColor",get:function(){return 0===this.color&&null!=this.noteSet?this.noteSet.color:this.color},set:function(t){this.color=t,null!=this.noteSet&&(1==this.noteSet.children.length?(this.color=0,this.noteSet.color=t):this.noteSet.color=0)}},{key:"effectiveCue",get:function(){return this.cue||null==this.noteSet?this.cue:this.noteSet.cue},set:function(t){this.cue=t,null!=this.noteSet&&(1==this.noteSet.children.length?(this.cue=!1,this.noteSet.cue=t):this.noteSet.cue=!1)}}],[{key:"toIntVector",value:function(t){for(var e=[],i=0;i<t.length;i++)e[e.length]=A.unknownToInt(t[i]);return e}},{key:"toStringVector",value:function(t){for(var e=[],i=0;i<t.length;i++)e[e.length]=A.unknownToString(t[i]);return e}},{key:"fromString",value:function(t){var i=kt.STEP_NAMES.indexOf(t.charAt(0));if(i<0)throw new Error("Unrecognized pitch step "+t);var n=A.unknownToInt(kt.STEP_PITCH_CLASSES[i]),r=null;"#"==(t=t.substring(1)).charAt(0)?(n++,(t=t.substring(1)).length>0&&"#"==t.charAt(0)?(n++,t=t.substring(1),r=e.DOUBLE_SHARP):r=e.SHARP):"b"==t.charAt(0)&&(n--,(t=t.substring(1)).length>0&&"b"==t.charAt(0)?(n--,t=t.substring(1),r=e.DOUBLE_FLAT):r=e.FLAT);var o=X.parseInt(t);return X.isNaN(o)||(n+=A.numberToInt(12*o)),new e(kt.getPitch(n),i,r)}},{key:"noteAt",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new e(kt.pitchAt(t,i),n,r)}},{key:"alterationToAccidental",value:function(t){return t<-2||t>2?null:e.ACCIDENTAL_TABLE[t- -2]}},{key:"accidentalToAlteration",value:function(t){return null!=t&&t in e.ALTERATION_TABLE?e.ALTERATION_TABLE[t]:0}},{key:"compareNotePitch",value:function(t,e){return t.diatonicPitch.ordinal<e.diatonicPitch.ordinal?-1:t.diatonicPitch.ordinal>e.diatonicPitch.ordinal?1:t.pitch.ordinal<e.pitch.ordinal?-1:t.pitch.ordinal>e.pitch.ordinal?1:0}}]),e}(),fe=de.toIntVector([0,2,4,5,7,9,11]),ye=de.toIntVector([2,2,1,2,2,2,1]),ge=de.toIntVector([0,1,1,2,2,3,4,4,5,5,6,6]),pe=de.toIntVector([0,0,1,1,2,3,3,4,4,5,5,6]),me=de.toIntVector([0,1,1,2,2,3,3,4,5,5,6,6]),ve=de.toIntVector([0,-5,2,-3,4,-1,6,1,-4,3,-2,5]),_e=de.toStringVector([de.DOUBLE_FLAT,de.FLAT,de.NATURAL,de.SHARP,de.DOUBLE_SHARP]),Se={doubleFlat:-2,flat:-1,natural:0,sharp:1,doubleSharp:2};r.registerClass(de,"com.noteflight.notation.model.Note");var Le=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this)))._document=null,r._performer=null,r._user=null,r._clipboard=null,r._transcriber=null,r.performanceMode=null,r._isMidiRecording=!1,r.isEchoNotesRecordingEnabled=!0,r._$isPaused=!1,r._pausePosition=null,r._$isAboutToPlay=!1,r._viewer=!1,r.showEndOfPreviewText=!1,r._disableNotationInteraction=!1,r._partToHighlight=null,r.isSyncMediaPlaying=!1,r._mostRecentPerformance=null,r.document=t,r._performer=i,r._user=n,r._transcriber=new zu,r._pausePosition=new gl(0,0),r._performer&&r._createPerformerEvents(),r}return c(e,At),p(e,null,[{key:"ALPHABET",get:function(){return ke},set:function(t){ke=t}},{key:"LOCAL_STORAGE_KEY",get:function(){return"_nf_clipboard"}},{key:"PLAY",get:function(){return"play"}},{key:"RECORD",get:function(){return"record"}},{key:"TRANSCRIBE",get:function(){return"transcribe"}},{key:"CREATE_SYSTEM_BREAK_SET",get:function(){return"createSystem"}},{key:"KEEP_WITH_NEXT_BREAK_SET",get:function(){return"keepWithNext"}},{key:"NOTE_HEAD_CYCLE",get:function(){return Te},set:function(t){Te=t}}]),p(e,[{key:"_createPerformerEvents",value:function(){this._performer.addEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handleSoundCompleteEvent)),this._performer.addEventListener(ct.TOO_MANY_MEASURES_TO_PLAY,xt.bindMethod(this,this.handleTooManyMeasuresToPlay)),this._performer.addEventListener(ct.TOO_MANY_TEMPO_CHANGE_MARKINGS,xt.bindMethod(this,this.handleTooManyTempoChangeMarkings))}},{key:"_removePerformerEvents",value:function(){this._performer.removeEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handleSoundCompleteEvent)),this._performer.removeEventListener(ct.TOO_MANY_MEASURES_TO_PLAY,xt.bindMethod(this,this.handleTooManyMeasuresToPlay)),this._performer.removeEventListener(ct.TOO_MANY_TEMPO_CHANGE_MARKINGS,xt.bindMethod(this,this.handleTooManyTempoChangeMarkings))}},{key:"calculateScoreDuration",value:function(){if(this.score.synchronizedTrack&&!this.score.synchronizedTrack.muted)return this.score.synchronizedTrack.temporalMap.getScoreDuration(this.score);var t=this.score.audibleStaves;return t.length?this.performer.renderStaves([t[0]]).scorePositionMap.getScoreDuration(this.score):0}},{key:"setIsAboutToPlayValue",value:function(t){this.isAboutToPlay=t}},{key:"setPerformanceMode",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(this.performanceMode=t,t){case e.RECORD:case e.TRANSCRIBE:var n=this.document.firstSelectedMeasureIndex||0;this.clearSelection(),this.performanceModeAction(this.score.firstVisiblePartAtFirstMeasure,n)}this.document.dispatchEvent(new Qi(Qi.MODE_CHANGE,t,i))}},{key:"modeRequiresShowCursor",value:function(){return this.performanceMode==e.RECORD||this.performanceMode==e.TRANSCRIBE}},{key:"allowPlaySynchronizedMedia",value:function(){return this.performanceMode!=e.TRANSCRIBE}},{key:"showHtml5Shadow",value:function(){return!this.viewer&&(this.score.isPaginatedMode||this.score.isFlowMode)}},{key:"isNotationInteractionAvailable",value:function(){return!this.isPlaying&&!this.isPerformanceMode&&!this.disableNotationInteraction}},{key:"validateViewCache",value:function(){this.dispatchEvent(new Ci(Ci.VALIDATE_CACHE))}},{key:"moveCursorToBeginning",value:function(){this.moveCursorToMeasureIndex(0),this.performer.startFromBeginning()}},{key:"checkEditPermission",value:function(){return!!this.document.editable||(this.dispatchEvent(new Si(Si.DISALLOWED_ACTION)),!1)}},{key:"checkEditMarkingPermission",value:function(){return!(!this.document.editable&&!this.document.markingsEditable)||(this.dispatchEvent(new Si(Si.DISALLOWED_ACTION)),!1)}},{key:"showEditTimeSignatureDialog",value:function(){this.checkEditPermission()&&this.dispatchEvent(new Li(Li.TIME_SIGNATURE_DIALOG))}},{key:"showEditKeySignatureDialog",value:function(){this.checkEditPermission()&&this.dispatchEvent(new Li(Li.KEY_SIGNATURE_DIALOG))}},{key:"copyClipboard",value:function(){null==this._document.selection||this._document.selection.empty||this.saveClipboard()}},{key:"cutClipboard",value:function(){this.checkEditPermission()&&(null==this._document.selection||this._document.selection.empty||(this.saveClipboard(),this.removeSelection(!0)))}},{key:"pasteClipboard",value:function(){this.checkEditPermission()&&(this.restoreClipboard(),null!=this._clipboard&&this.pasteAt(this._clipboard,this.selection))}},{key:"undo",value:function(){this._document.undo()}},{key:"undoAll",value:function(){this._document.undoAll()}},{key:"redo",value:function(){this._document.redo()}},{key:"redoAll",value:function(){this._document.redoAll()}},{key:"echoSelectedNotes",value:function(){if(this._performer&&A.is(this.selection,qe)&&this.score.playbackMode!=Nl.PLAYBACK_MODE_SILENT){this.score.dispatchEvent(new ci(ci.REQUEST_AUDIO)),this.score.dispatchEvent(new ci(ci.REQUEST_INSTRUMENTS));var t=[],e=null,i=!0,n=!1,r=void 0;try{for(var o,s=A.unknownToType(this.selection,qe).selectedObjects[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(A.is(a,de))t.push(a);else if(A.is(a,Sn)){var l=A.unknownToType(a,Sn);if(null!=e&&0!==l.measurePosition.compareTo(e))break;l.notes.length>0&&(e=l.measurePosition),t=t.concat(l.notes)}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this._performer.echoNotes(t,this.score.numStaves)}}},{key:"noteOn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(this.score.playbackMode!=Nl.PLAYBACK_MODE_SILENT&&(this.isEchoNotesRecordingEnabled||!this._isMidiRecording)){var i=this.document.activeStaff();if(i.part.synthesizer){var n=i.getMeasureAt(0),r="normal";if(n){t-=n.scoreInterval.pitches;var o=new de(kt.getPitch(A.numberToInt(t)));o.noteHead=n.effectiveClef.defaultNoteHead(o.pitch),r=n.effectiveClef.mapNoteAndArticulation(o)}i.part.synthesizer.noteOn(t,e,r,null)}}}},{key:"noteOff",value:function(t){if(this.isEchoNotesRecordingEnabled||!this._isMidiRecording){var e=this.document.activeStaff();if(e.part.synthesizer){var i=e?e.getMeasureAt(0):null,n=i?i.scoreInterval.pitches:0;e.part.synthesizer.noteOff(t-n)}}}},{key:"echoNotes",value:function(t){this._performer&&this.score.playbackMode!=Nl.PLAYBACK_MODE_SILENT&&(this.score.dispatchEvent(new ci(ci.REQUEST_AUDIO)),this.score.dispatchEvent(new ci(ci.REQUEST_INSTRUMENTS)),this._performer.echoNotes(t,this.score.numStaves,this.score.getStaffAt(0)))}},{key:"useSyncedTemporalMap",value:function(){this.performer.useSyncedTemporalMap(this.score)}},{key:"scorePositionToTime",value:function(t){return this.performer.scorePositionToTime(t)}},{key:"play",value:function(){this.playFromMeasure(0,0)}},{key:"playFromSelection",value:function(){this.playFromNotation(this.document.firstSelectedNoteSet)}},{key:"playFromNotation",value:function(t){this.playFromMeasure(null==t?0:t.measure.index)}},{key:"playFromMeasure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.stopPlayback(),this.startPlaybackWhenReady({startMeasureIndex:t,timeOffset:e})}},{key:"playSelection",value:function(t){this.stopPlayback(),this.document.selection&&null!=this.document.selection.startIndex&&(t.startMeasureIndex=this.document.selection.startIndex,t.endMeasureIndex=this.document.selection.endIndex,this.startPlaybackWhenReady(t))}},{key:"stopPlayback",value:function(){this.isPlaying&&!this.isPaused&&this.performer.stopPerformance()}},{key:"startPlaybackWhenReady",value:function(t){var e=this;e.isPaused=!1;var i=function i(n){e.score.removeEventListener(ct.COMPLETE,i),e.startPlaybackAfterPrecondition(t)};this.score.dispatchEvent(new ci(ci.REQUEST_AUDIO)),this.score.complete?i():(this.score.dispatchEvent(new ci(ci.REQUEST_INSTRUMENTS)),this.score.addEventListener(ct.COMPLETE,i))}},{key:"startPlaybackAfterPrecondition",value:function(t){var e=this,i=t.startMeasureIndex||0,n=null,r=function i(r){n&&n.removeEventListener(ct.COMPLETE,i),e.preparePerformance(t)},o=new $i($i.PLAY_BACK,new gl(i,0));this.document.dispatchEvent(o),this.performer.addEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handlePerformerPropertyChange)),o.playbackPrecondition?(n=o.playbackPrecondition).addEventListener(ct.COMPLETE,r):r()}},{key:"measureIndexToTime",value:function(t){return this.performer.temporalMap.measureIndexToTime(A.numberToInt(t))}},{key:"preparePerformance",value:function(t){var e=this,i=t.timeOffset||0,n=t.startMeasureIndex||0,r=function(){e.dispatchEvent(new $i($i.PLAYBACK_STARTS,new gl(n,0)))},o=function(){e.dispatchEvent(new $i($i.PLAYBACK_STARTS_ERROR))};null==t.endMeasureIndex&&this.document.layoutContext.preview&&(t.endMeasureIndex=this.document.layoutContext.scoreLayout.endMeasureIndex),this._mostRecentPerformance=this.performer.renderStaves(this.document.playbackStaves,t),this.addEventListener($i.HTML5_EDITOR_READY,function t(s){e.removeEventListener($i.HTML5_EDITOR_READY,t),e.performer.playPerformance(e._mostRecentPerformance,e.score,i,n,r,o)}),this.dispatchEvent(new $i($i.READY_TO_START_PLAYBACK,new gl(n))),this.logPlay()}},{key:"startPlaybackNow",value:function(){this.dispatchEvent(new $i($i.HTML5_EDITOR_READY))}},{key:"createWav",value:function(t){this.performer.createWav(this.renderedPerformance(),t)}},{key:"createMP3",value:function(t){this.performer.createMP3(this.renderedPerformance(),t)}},{key:"renderedPerformance",value:function(){return this.performer.renderStaves(this.document.playbackStaves)}},{key:"logPlay",value:function(){var t="playScore";null!=this.document.author&&null!=this._user&&(t=this.document.author.userId==this._user.userId?"play_my_score":"play_other_user_score"),this.logToAnalytics("command",t)}},{key:"restartPlayback",value:function(){this.pause()&&this.resume()}},{key:"moveCursorToMeasureIndex",value:function(t){t<0||(this.isPaused?this.moveCursor(new gl(A.numberToUint(t),0)):this.isPlaying&&(this.performer.pausePerformance(),this.moveCursor(new gl(A.numberToUint(t),0)),this.resume()))}},{key:"pauseSyncMedia",value:function(){this.performer.pausePerformance(),this.isPaused=!0}},{key:"resumeSyncMedia",value:function(){this.performer.prepareToResumePlayback(),this.isPaused=!1}},{key:"pause",value:function(){return!(!this.isPlaying||this.isPaused)&&(this._pausePosition=this.performer.position,this.performer.pausePerformance(),this.renderFullTemporalMap(),this.isPaused=!0,this.moveCursor(this._pausePosition),this.document.dispatchEvent(new $i($i.PAUSE)),this.document.dispatchEvent(new $i($i.STOP,this._pausePosition)),!0)}},{key:"resume",value:function(){this.performer.prepareToResumePlayback(),this.playFromMeasure(this._pausePosition.measureIndex)}},{key:"dispatchStopEvent",value:function(t){this._performer.removeEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handlePerformerPropertyChange)),this.performer.stopPerformance();var e=new $i($i.STOP,t);this.document.dispatchEvent(e)}},{key:"handleSoundCompleteEvent",value:function(t){this.document.dispatchEvent(new $i($i.STOP,0))}},{key:"handleTooManyMeasuresToPlay",value:function(t){this.dispatchEvent(t)}},{key:"handleTooManyTempoChangeMarkings",value:function(t){this.dispatchEvent(t)}},{key:"handlePerformerPropertyChange",value:function(t){this.isPlaying&&"player"==t.property&&null==t.newValue&&this.dispatchStopEvent(new gl(this.score.numMeasures,0))}},{key:"stop",value:function(){this.performer&&(this.isPaused=!1,this.isPlaying?this.dispatchStopEvent(this.performer.position):this.performer.stopPerformance())}},{key:"forceStop",value:function(){this.stop(),this.dispatchEvent(new $i($i.FORCE_STOP))}},{key:"renderFullTemporalMap",value:function(){return this.performer.renderStaves(this.document.playbackStaves),this.performer.temporalMap}},{key:"performanceModeAction",value:function(t,i){switch(this.performanceMode){case e.TRANSCRIBE:case e.RECORD:this.dispatchEvent(new Yi(Yi.PART_SELECTED,t,i)),this._partToHighlight=t;break;case e.PLAY:this._partToHighlight=null}this.moveCursorToMeasureIndex(i),this.pausePosition=new gl(A.numberToUint(i),0)}},{key:"highlightPartWithCursor",value:function(){return!(!this.isPerformanceMode||!this._partToHighlight)}},{key:"moveCursor",value:function(t){this.performer&&(this.performer.player||this.renderFullTemporalMap(),this._pausePosition=t,this.performer.position=t,this.performer.dispatchEvent(new dt(dt.PROGRESS)))}},{key:"togglePause",value:function(){this.isPlaying&&!this.isPaused?this.pause():this.resume()}},{key:"togglePlayStop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isPlaying&&!this.isPaused?this.stop():t?this.playFromMeasure(0):this.isPaused?this.togglePause():this.playFromSelection()}},{key:"startAudioRecording",value:function(t){this.performer.isRecording=!0,t&&(this.performer.stavesToMuteForRecording=t.staffIndices),this.resume()}},{key:"stopAudioRecording",value:function(){this.performer.isRecording=!1,this.pause()}},{key:"startMidiRecording",value:function(t,e){this.performer.isRecording=!0,this.midiRecordingFromMeasure(A.numberToInt(t),e),this.dispatchEvent(new Si(Si.TEMPORAL_MAP_CREATED)),this.playFromMeasure(A.numberToInt(t))}},{key:"stopMidiRecording",value:function(t){this.performer.isRecording=!1,this.stop(),this._isMidiRecording&&t&&this.transcriber.finish(),this._isMidiRecording=!1}},{key:"midiRecordingFromMeasure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==e&&(e=null!=this.selection?this.selection.selectedRange.staves:A.as(this.document.score.staves,Array)),this._isMidiRecording=!0,this._createTranscriber(t,A.unknownToType(e[0],Rl)),this.performer.stavesToMuteForRecording=this.transcriber.transcribedStavesIndices}},{key:"soloMediaTrack",value:function(){this.score.soloMediaTrack()}},{key:"muteTracksForPart",value:function(t){t.muteTracksForPart()}},{key:"playAll",value:function(){this.score.playAll()}},{key:"_createTranscriber",value:function(t,e){for(var i=0,n=0;n<e.part.staves.length;n++)if(e.part.staves[n]==e){i=n;break}var r=this._performer.renderStaves(e.part.staves,{startMeasureIndex:A.intToUint(t)});this.transcriber.createTranscriber(e.part,i,this.performer.temporalMap,r.measureIndices)}},{key:"testTranscriber",value:function(){var t=this._performer.renderStaves([this.score.staves[0]]),e=[];this.selection?e=this.selection.selectedRange.staves:e.push(this.score.parts[1].staves[0]),this.midiRecordingFromMeasure(0,e),this.transcriber.enabled=!0;for(var i=0;i<t.performance.elements.length;i++)this.transcriber.addElement(t.performance.elements[i]);this.transcriber.finish(),this.transcriber.enabled=!1}},{key:"retranscribe",value:function(){this.transcriber.recoverOldData(),this.transcriber.finish()}},{key:"selectNextNoteSet",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.document.firstSelectedNoteSet;if(null!=e){var i=e.nextNoteSet(!0,!0);null==i&&(i=e.nextNoteSetAnyVoice(!0)),null!=i&&(this.selectNotation(i),t&&this.echoSelectedNotes())}}},{key:"selectPreviousNoteSet",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.document.firstSelectedNoteSet;if(null!=e){var i=e.previousNoteSet(!0,!0);null==i&&(i=e.previousNoteSetAnyVoice(!0)),null!=i&&(this.selectNotation(i),t&&this.echoSelectedNotes())}}},{key:"selectNextNoteOnString",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.document.firstSelectedNoteSet;if(null!=t){var e=t.nextNoteSet(!0,!0);null==e&&(e=t.nextNoteSetAnyVoice(!0)),null!=e?null!=e.noteOnString(this.document.stringIndex)?(this.selectNotation(e.noteOnString(this.document.stringIndex)),this.echoSelectedNotes()):(this.checkEditPermission()&&0===e.notes.length&&e.rhythmDuration>t.rhythmDuration&&this.prepareEntryAfterSelection(),this.selectNotation(e)):this.checkEditPermission()&&(this.score.insertMeasureAfter(t),this.selectNextNoteSet(!1))}}},{key:"selectPreviousNoteOnString",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.document.firstSelectedNoteSet;if(null!=t){var e=t.previousNoteSet(!0,!0);null==e&&(e=t.previousNoteSetAnyVoice(!0)),null!=e&&(null!=e.noteOnString(this.document.stringIndex)?(this.selectNotation(e.noteOnString(this.document.stringIndex)),this.echoSelectedNotes()):this.selectNotation(e))}}},{key:"moveUpString",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null!=this.selection&&this.document.stringIndex>0&&this.setStringIndex(this.document.stringIndex-1)}},{key:"moveDownString",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null!=this.selection){var t=A.as(this.selectedNotations[0].measure.effectiveClef,$l);if(t){var e=t.stringNotes.length;this.document.stringIndex<e-1&&this.setStringIndex(this.document.stringIndex+1)}}}},{key:"setStringIndex",value:function(t){this.document.stringIndex=A.numberToInt(t);var e=this.document.firstSelectedNoteSet;null!=e&&(null!=e.noteOnString(A.numberToInt(t))?(this.selectNotation(e.noteOnString(A.numberToInt(t))),this.echoSelectedNotes()):this.selectNotation(e))}},{key:"mapMidiPatches",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.score.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(!o.midiPatch||0===o.midiPatch){var s=this.performer.instrumentResolver.getEntryByUri(o.instrumentUri);s&&s.midiPatch&&(o.midiPatch=s.midiPatch)}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"selectionRight",value:function(){var t,e;if(null!=this.document.selection){if(A.is(this.document.selection,Je)&&this.document.selection.direction==Je.DIRECTION_LEFT)null==(e=(t=this.document.firstSelectedNoteSet).nextNoteSet(!0))&&(e=t.nextNoteSetAnyVoice(!0)),null!=e&&(e.endPosition.compareTo(this.selection.selectedRange.end)<0?this.document.selection=new Je(this.score,e.measurePosition,this.selection.selectedRange.end,this.selection.selectedRange.staves,Je.DIRECTION_LEFT):this.document.selection=new qe(this.score,[e]));else{if(A.is(this.document.selection,qe)&&A.is(this.document.selection.selectedObjects[0],xn))return void this.adjustEffect(this.document.selection.selectedObjects[0],he.DIRECTION_RIGHT);null==(e=(t=this.document.lastSelectedNoteSet).nextNoteSet(!0))&&(e=t.nextNoteSetAnyVoice(!0)),null!=e&&(this.document.selection=new Je(this.score,this.selection.selectedRange.start,e.endPosition,this.selection.selectedRange.staves,Je.DIRECTION_RIGHT))}this.setEntryAfterSelection(!1)}}},{key:"selectionLeft",value:function(){var t,e;if(null!=this.document.selection){if(A.is(this.document.selection,Je)&&this.document.selection.direction==Je.DIRECTION_RIGHT)null==(e=(t=this.document.lastSelectedNoteSet).previousNoteSet(!0))&&(e=t.previousNoteSetAnyVoice(!0)),null!=e&&(e.measurePosition.compareTo(this.selection.selectedRange.start)>0?this.document.selection=new Je(this.score,this.selection.selectedRange.start,e.endPosition,this.selection.selectedRange.staves,Je.DIRECTION_RIGHT):this.document.selection=new qe(this.score,[e]));else{if(A.is(this.document.selection,qe)&&A.is(this.document.selection.selectedObjects[0],xn))return void this.adjustEffect(this.document.selection.selectedObjects[0],he.DIRECTION_LEFT);null==(e=(t=this.document.firstSelectedNoteSet).previousNoteSet(!0))&&(e=t.previousNoteSetAnyVoice(!0)),null!=e&&(this.document.selection=new Je(this.score,e.measurePosition,this.selection.selectedRange.end,this.selection.selectedRange.staves,Je.DIRECTION_LEFT))}this.setEntryAfterSelection(!1)}}},{key:"ensureSelection",value:function(){return null!=this.selection||(Gy.show(Ou.getString("alerts/controllerRequiresSelection")),!1)}},{key:"setEntryAfterSelection",value:function(t){this.document.entryAfterSelection=t,this.checkEagerMeasureAppend()}},{key:"enterStepAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;if(null!=i){var n=null;null!=i&&i.notes.length>0&&(n=i.getNoteAt(0)),this.prepareEntryAfterSelection(),this.doAddStepToSelection(t,n,null,i.color,!0,e)}}}},{key:"enterPitchAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;null!=i&&(this.prepareEntryAfterSelection(),this.doAddPitchToSelection(t,i.color,e))}}},{key:"placeStepAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;if(null!=i){var n=null;i.notes.length>0&&(n=i.getNoteAt(0)),this.document.selection=new qe(this.score,[i]),i.removeNotes(),this.doAddStepToSelection(t,n,null,0,!0,e)}}}},{key:"placePitchAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;null!=i&&(this.document.selection=new qe(this.score,[i]),i.removeAllChildren(),this.doAddPitchToSelection(t,0,e))}}},{key:"enterRestAtSelection",value:function(){if(this.document.entryAfterSelection)this.prepareEntryAfterSelection();else{var t=this.document.firstSelectedNoteSet;null!=t&&(this.selectNotation(t),this.removeSelection())}this.setEntryAfterSelection(!0)}},{key:"prepareEntryAfterSelection",value:function(){if(this.checkEditPermission()){var t=this.document.firstSelectedNoteSet;if(null!=t)if(null==t.nextNoteSet(!0)&&this.score.insertMeasureAfter(t),this.selectNextNoteSet(!1),this.isFullMeasureNotation(t)||t.grace){var e=this.document.firstSelectedNoteSet;null!=e&&e.removeAllChildren()}else this.convertSelectionToRest(t.value,t.dots)}}},{key:"repeatSelection",value:function(){if(this.checkEditPermission()&&null!=this._document.selection&&!this._document.selection.empty){var t=A.as(this.selection,qe);null!=t&&1==t.selectedObjects.length&&A.is(t.selectedObjects[0],de)&&this.selectNotation(A.unknownToType(t.selectedObjects[0],de).noteSet);var e,i=this._document.selection.createClipboard();if(A.is(this.selection,Ke)){var n=A.as(this.selection,Ke);e=new Ke(this.score,n.endIndex,n.endIndex+1)}else{var r=this.selection.selectedRange,o=r.end;o.position>=this.score.systemStaff.getMeasureAt(o.measureIndex).duration&&(o=new gl(A.intToUint(o.measureIndex+1),0)),e=new Je(this.score,o,o,r.staves)}this.pasteAt(i,e)}}},{key:"moveSelection",value:function(t,e,i,n){if(this.checkEditPermission()&&null!=this._document.selection&&!this._document.selection.empty){var r=A.as(this.selection,qe);if(null!=r&&1==r.selectedObjects.length){var o=r.selectedObjects[0];A.is(o,de)?this.selectNotation(A.unknownToType(o,de).noteSet):A.is(o,Sn)&&0===A.unknownToType(o,Sn).notes.length&&this.selectNotationRange(A.unknownToType(o,Sn))}var s=this.selection.createClipboard(),a=this.selection.selectedRange;if(!i){if(A.is(this.selection,Ke)){var l=A.as(this.selection,Ke);t>=l.endIndex&&(t-=l.endIndex-l.startIndex)}this.removeSelection(!0)}var u=new gl(A.intToUint(t),e);this.pasteAt(s,new Je(this.score,u,u,A.unknownToType(null!=n?[n]:a.staves,Array))),null!=r&&null!=this.document.selection&&(this.document.selection=new qe(this.score,this.document.selection.selectedNotations()),this.setEntryAfterSelection(!0))}}},{key:"convertSelectionToRest",value:function(t,e){if(this.checkEditPermission()){var i=this;this.applyToNoteSets(function(n){for(;n.notes.length>0;)n.removeNote(n.getNoteAt(0)),n.removeAllAnnotations();i.selectNotation(i.changeNoteSetValue(n,t,e))})}}},{key:"addStepToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.checkEditPermission()&&this.doAddStepToSelection(t,null,null,0,!0,e)}},{key:"doAddStepToSelection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=this.document.firstSelectedNoteSet;if(null!=s&&(!this.isFullMeasureNotation(s)||null!=(s=this.removeFullMeasureNotation(s)))){var a=s;if(null==e&&A.is(this.selection,qe)){var l=A.unknownToType(this.selection,qe).selectedObjects;1==l.length&&A.is(l[0],de)&&(e=A.unknownToType(l[0],de))}if(null==e){var u=A.as(a.measure.previousNotation(a.position,function(t){var e=A.as(t,Sn);return null!=e&&e.notes.length>0&&(a.voiceNumber<0||e.voiceNumber<0||e.voiceNumber==a.voiceNumber)},!0),Sn);null!=u?e=u.getNoteAt(0):(e=A.as(a.measure.effectiveClef.note.clone(),de)).pitch=e.pitch.transpose(A.numberToInt(12*-Math.round(a.measure.scoreInterval.pitches/12)))}if(r){for(t-=a.measure.scoreInterval.steps;t<0;)t+=7;for(;t>=7;)t-=7}for(var h=kt.pitchAt(A.unknownToInt(kt.STEP_PITCH_CLASSES[t]),0),c=new de(h);c.diatonicOrdinal-e.diatonicOrdinal>3;)c.pitch=c.pitch.transpose(-12);for(;c.diatonicOrdinal-e.diatonicOrdinal<-3;)c.pitch=c.pitch.transpose(12);(c=c.alter(a.measure.effectiveScoreAlteration(a.position,c,a.voiceNumber))).noteHead=i,c.color=n,this.doAddNoteToNoteSet(c,a,o),this.setEntryAfterSelection(!0)}}},{key:"addPitchToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.checkEditPermission()&&this.doAddPitchToSelection(t,0,e)}},{key:"doAddPitchToSelection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.document.firstSelectedNoteSet;if(null!=n&&(!this.isFullMeasureNotation(n)||null!=(n=this.removeFullMeasureNotation(n)))){var r=n;t-=r.measure.scoreInterval.pitches;var o=r.measure.index>0&&null!=r.measure.staff.getMeasureAt(A.intToUint(r.measure.index-1)).systemMeasure.keySignatureNotation,s=A.as(r.measure.previousNotation(r.position,function(t){var e=A.as(t,Sn);return null!=e&&e.notes.length>0&&(r.voiceNumber<0||e.voiceNumber<0||e.voiceNumber==r.voiceNumber)},!o),Sn),a=null;s&&(a=s.findClosestMatchingPitch(t));var l=kt.getPitch(t),u=r.measure.keySignature,h=u.getNoteForPitch(l,a);if(h.color=e,this.doAddNoteToNoteSet(h,r,i),this.selectNotation(r,!1),this.setEntryAfterSelection(!0),r.notes.length>1){var c=r.normalizeSpelling(u);Math.abs(c)>r.notes.length&&this.enharmonicShift()}}}},{key:"addStringToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;if(null!=i){var n=i.noteOnString(t);if(null!=n)return this.document.selection=new qe(this.score,[n]),void this.echoSelectedNotes()}this.doAddStringToSelection(t,null,e)}}},{key:"setSelectionFret",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.checkEditPermission()&&null!=this.selection){var i=A.as(this.selectedNotations[0].measure.effectiveClef,$l);if(i){if(this.document.firstSelectedNoteSet.noteOnString(this.document.stringIndex)){var n=this.document.firstSelectedNoteSet.noteOnString(this.document.stringIndex);if(n.playable&&A.is(n.measure.effectiveClef,$l)){var r=new de(n.pitch.transpose(t-i.getEffectiveFret(n)));n.step=r.step,n.fret=-1,n.accidental=null,e?n.noteHead=de.CROSS_NOTE_HEAD:(n.pitch=r.pitch,n.noteHead=de.NORMAL_NOTE_HEAD)}}else{this.document.ensureStringIndexWithinBounds();var o=i.stringNotes[this.document.stringIndex],s=kt.getPitch(t+o.pitch.ordinal);this.doAddStringToSelection(this.document.stringIndex,s,!0,e)}this.echoSelectedNotes()}}}},{key:"adjustStringIndex",value:function(t){if(this.checkEditPermission()){var e=t<0?1:-1;this.applyToNotes(function(e){if(e.playable&&A.is(e.measure.effectiveClef,$l)){var i=A.as(e.measure.effectiveClef,$l);if(e.stringIndex<0)e.stringIndex=t<0?i.stringNotes.length-1:0;else{var n=e.stringIndex+t;if(n<0||n>=i.stringNotes.length)return;var r=e.noteSet,o=A.as(e.clone(),de);o.stringIndex+=t,i.getEffectiveFret(o)>=0&&!r.noteOnString(o.stringIndex)&&(e.stringIndex=o.stringIndex)}e.fret=-1}},function(t,i){return t.stringIndex<i.stringIndex?-e:t.stringIndex>i.stringIndex?e:0}),this.echoSelectedNotes()}}},{key:"doAddStringToSelection",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.document.firstSelectedNoteSet;if(null!=r&&A.is(r.measure.effectiveClef,$l)){var o=A.as(r.measure.effectiveClef,$l);if(t>=o.stringNotes.length)Gy.show(Ou.getString("alerts/instrumentTooFewStrings",[o.stringNotes.length]));else{this.isFullMeasureNotation(r)&&(r=this.removeFullMeasureNotation(r)),null==e&&(e=o.stringNotes[t].pitch);var s=new de(e);for(s.stringIndex=t;o.getEffectiveFret(s)<0;)s.pitch=s.pitch.transpose(12);n&&(s.noteHead=de.CROSS_NOTE_HEAD),this.doAddNoteToNoteSet(s,r,i)}}}},{key:"addNoteToNoteSet",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.checkEditPermission()){this.isFullMeasureNotation(e)&&(e=this.removeFullMeasureNotation(e));var n=this.document.firstSelectedNoteSet;null==n||n.grace||this.isFullMeasureNotation(n)||((e=this.changeNoteSetValue(e,n.value,n.dots)).color=n.color),this.doAddNoteToNoteSet(t,e,i)}}},{key:"dispatchMajorNotationAction",value:function(){var t={},e=this.selectedParts;e&&(t.parts=e),this.dispatchEvent(new ci(ci.MAJOR_NOTATION_CHANGE,t))}},{key:"doAddNoteToNoteSet",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.measure.effectiveClef.mapNoteAndArticulation(t);null==t.noteHead&&(t.noteHead=this.defaultNoteHead(e,t.pitch));var r=e.defaultBeamEnabled;e.addNote(t),null!=n&&e.addArticulation(n),e.defaultBeamEnabled!=r&&e.defaultBeaming(),this.selectNotation(t,!1),i&&this.echoSelectedNotes(),this.dispatchMajorNotationAction()}},{key:"adjustSelectionDuration",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;if(null!=i){if(this.isFullMeasureNotation(i))return void this.selectNotation(this.removeFullMeasureNotation(i));var n=i.value+t;if(n<mn.MIN_NOTATED_VALUE||n>mn.MAX_NOTATED_VALUE)return;n==mn.MIN_NOTATED_VALUE&&(e=!1),i=this.changeNoteSetValue(i,i.value+t,e?1==i.dots?0:1:0),this.selectNotation(i,!1),this.checkEagerMeasureAppend(),this.dispatchMajorNotationAction()}}}},{key:"stepSelectionDuration",value:function(t){if(this.checkEditPermission()){var e=this.document.firstSelectedNoteSet;if(null!=e){for(;t>0;)(e=this.document.firstSelectedNoteSet).dots>0?this.adjustSelectionDuration(1,!0):this.adjustSelectionDuration(0,!0),t--;for(;t<0;)(e=this.document.firstSelectedNoteSet).dots>0?this.adjustSelectionDuration(0,!0):this.adjustSelectionDuration(-1,!0),t++}}}},{key:"setSelectionDuration",value:function(t,e){if(this.checkEditPermission()){var i=this.document.firstSelectedNoteSet;null!=i&&(this.isFullMeasureNotation(i)&&(i=this.removeFullMeasureNotation(i)),i=this.changeNoteSetValue(i,t,e),this.selectNotation(i,!1))}}},{key:"changeNoteSetValue",value:function(t,e,i){if(!this.checkEditPermission())return t;if(t.value==e&&t.dots==i)return t;if(t.grace)return t.value=A.intToUint(e),t.dots=i,t;var n,r=t.rhythmContext;if(r.getDuration(t.rhythmPosition+mn.valueToDuration(e,i))>r.duration)return t;if((n=this.isFullMeasureNotation(t)?new Sn:A.as(t.clone(),Sn)).clearTies(),n.value=A.numberToUint(Math.max(0,Math.min(mn.BREVE,e))),n.dots=i,A.is(r,Xl)&&0===n.rhythmPosition&&n.rhythmDuration==r.timeSignature.meterDuration){var o=A.as(r,Xl);return(r=o.rhythmContext).removeElement(o),n.rhythmPosition=o.rhythmPosition,n.rhythmDuration=o.rhythmDuration,r.addElement(n),n}var s=A.numberToInt(Math.max(t.rhythmDuration,n.rhythmDuration)),a=new Nu(r),l=new Cu;return l.filter=function(e){return!(A.is(e,Ua)||A.is(e,Sn)&&A.unknownToType(e,Sn).grace&&e.rhythmPosition==t.rhythmPosition)},a.removePositionRange(t.rhythmPosition,s,l),r.addElement(n),a.addRests(),n.defaultBeaming(),n}},{key:"resetMeasureNumbers",value:function(){this.checkEditPermission()&&this.score.resetMeasureNumbers()}},{key:"getMeasureNumberByIndex",value:function(t){var e=this.score.getSystemStaffMeasureAt(t);return e?e.measureNumber:-1}},{key:"createTuplet",value:function(t,e){if(!this.checkEditPermission())return null;var i=this.document.firstSelectedNoteSet;if(null==i)return null;var n=i.rhythmContext;if(n.getDuration(i.rhythmPosition+t*i.rhythmDuration)>n.duration)return Gy.show(Ou.getString("alerts/notEnoughRoomForTuplet")),null;if(i.grace)return Gy.show(Ou.getString("alerts/cantCreateTupletOnGrace")),null;var r=A.as(i.clone(),Sn);r.rhythmPosition=0,r.clearTies();var o=new Nu(n);o.removePositionRange(i.rhythmPosition,t*i.rhythmDuration);var s=new Xl(i.rhythmPosition,t,i.value,e,i.value);return n.addElement(s),o.addRests(),o=new Nu(s),s.addElement(r),o.addRests(),r.defaultBeaming(),this.selectNotation(r,!1),s}},{key:"createTuplet2",value:function(t){if(!this.checkEditPermission())return null;var e=this.document.firstSelectedNoteSet;if(null==e)return null;if(e.grace)return Gy.show(Ou.getString("alerts/cantCreateTupletOnGrace")),null;var i,n=e.measure,r=this.document.selection.selectedRange;if(A.is(e.rhythmContext,Xl)&&0===e.rhythmPosition&&A.unknownToType(e.rhythmContext,Xl).rhythmUnits==t&&r.start.measureIndex==n.index&&Math.round(r.start.position)==Math.round(A.unknownToType(e.rhythmContext,Xl).position)&&r.end.measureIndex==n.index&&Math.round(r.end.position)==Math.round(e.position+A.unknownToType(e.rhythmContext,Xl).duration)){var o=A.as(e.rhythmContext,Xl),s=(o.rhythmPosition,o.rhythmContext),a=new Sn(o.rhythmPosition,e.notes,mn.durationToValue(o.rhythmDuration));return 3==o.units?a.dots=1:7==o.units&&(a.dots=2),s.removeElement(o),s.addElement(a),new Nu(s).addRests(),this.selectNotation(a),null}this.isFullMeasureNotation(e)?(i=new Sn(0,[],n.timeSignature.beatValue),!e.measure.timeSignature.triple||2!=t&&4!=t||(i.value++,i.dots=1)):((i=A.as(e.clone(),Sn)).rhythmPosition=0,i.clearTies());for(var l=i.value;l<mn.MAX_NOTATED_VALUE&&t*(1<<l)/i.rhythmDuration<1;)l++;for(;l>0&&t*(1<<l)/i.rhythmDuration>=2;)l--;if(t*(1<<l)==i.rhythmDuration)return Gy.show(Ou.getString("alerts/cantCreateDegenerateTuplet",[t])),null;var u=e.rhythmContext,h=new Nu(u),c=new Cu;c.ignoreGraceNotesAtBeginning=!0,h.removePositionRange(e.rhythmPosition,e.rhythmDuration,c);var d=new Xl(e.rhythmPosition,i.units,i.unitValue,t,l);return u.removeElement(e),u.addElement(d),h.addRests(),h=new Nu(d),i.value=l,i.dots=0,d.addElement(i),h.addRests(),i.defaultBeaming(),this.selectTuplet(d),d}},{key:"removeContainingTuplet",value:function(){if(this.checkEditPermission()){var t=this.document.firstSelectedNoteSet;if(null!=t){for(var e=t.rhythmPosition,i=t.rhythmContext,n=!1;A.is(i,Xl)&&0===e;){var r=A.as(i,Xl);e=r.rhythmPosition,(i=r.rhythmContext).removeElement(r),new Nu(i).addRests(),t=i.noteSetAtPosition(e),n=!0}n&&null!=t&&this.selectNotation(t)}}}},{key:"startTremolo",value:function(){if(!this.checkEditPermission())return null;var t,e,i=this.document.firstSelectedNoteSet;if(null==i||0===i.notes.length)return null;if(i.tremoloDyad)return(t=(e=A.as(i.rhythmContext,Xl)).rhythmContext).removeElement(e),(i=i.clone()).tremolo=0,i.rhythmDuration=e.rhythmDuration,i.rhythmPosition=e.rhythmPosition,t.addElement(i),this.selectNotation(i),null;t=i.rhythmContext,new Nu(t).removePositionRange(i.rhythmPosition,i.rhythmDuration),(e=new Xl(i.rhythmPosition,i.units,i.unitValue,2*i.units,i.unitValue)).tremolo=!0,t.addElement(e);var n=A.as(i.clone(),Sn);n.rhythmPosition=0,n.clearTies(),n.tremolo=3,e.addElement(n);var r=A.as(n.clone(),Sn);return r.rhythmPosition=r.rhythmDuration,e.addElement(r),this.selectNotation(r),e}},{key:"selectVoice",value:function(t){if(this.checkEditPermission()){var e=this.document.firstSelectedNoteSet;if(null!=e&&!A.is(e,vl)){var i=t?0:1,n=e.measure;if(n.numVoices>1){var r=new Nu(n.getVoiceNumber(i)).getNotations(),o=null,s=!0,a=!1,l=void 0;try{for(var u,h=r[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=A.unknownToType(c,he);if(A.is(d,Sn)&&d.position<=e.position&&(o=A.as(d,Sn)),d.position>e.position)break}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}this.selectNotation(o,!0)}else{var f=new Kl;n.addChildAt(f,A.intToUint(i+1));var y=new Gl;f.addElement(y),this.selectNotation(y,!0)}}}}},{key:"removeSelectedVoice",value:function(){if(this.checkEditPermission()){var t=this.document.firstSelectedNoteSet;if(null!=t){var e=t.measure;e.numVoices<2||e.removeVoiceNumber(t.voiceNumber)}}}},{key:"modifyTies",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNote;if(null!=t){var e=!t.tied;this.applyToNotes(function(t){e?t.setLiaison(de.TIE_LIAISON):t.clearLiaison(de.TIE_LIAISON);var i=t.measure.getLiaisonEnd(t);null!=i&&e&&(i.pitch=t.pitch)})}}}},{key:"modifyCourtesyAccidentals",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNote;if(null!=t){var e=!t.courtesyAccidental;this.applyToNotes(function(t){e?(t.accidental=de.alterationToAccidental(t.alteration),t.courtesyAccidental=t.explicitAccidental=!0):(t.accidental=null,t.courtesyAccidental=t.explicitAccidental=!1)})}}}},{key:"modifyParentheses",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNote;if(null!=t){var e=!t.parentheses;this.applyToNotes(function(t){t.parentheses=e})}}}},{key:"modifyIncomingTies",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNote;if(null!=t)if(t.noteSet.position>0||!t.noteSet.measure.allowIncomingLiaisons)Gy.show(Ou.getString("alerts/incomingTieError"));else if(null!=t){var e=null==t.incomingLiaison;this.applyToNotes(function(t){t.incomingLiaison=e?de.TIE_LIAISON:null})}}}},{key:"modifyLiaisons",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNote;if(null!=e){var i=e.liaison!=t;this.applyToNotes(function(e){i?e.setLiaison(t):e.clearLiaison(t)}),e.liaison!=de.PRE_BEND_LIAISON||e.noteSet.grace||this.modifyGrace(!1)}}}},{key:"modifyBeamAtSelection",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNoteSet;if(null!=t){var e=!t.beam;this.applyToNoteSets(function(t){t.beam=e})}}}},{key:"modifyBeamBeforeSelection",value:function(){if(this.checkEditPermission()){var t=this._document.firstSelectedNoteSet;if(null!=t&&(t=t.previousNoteSet()),null!=t){var e=!t.beam;this.applyToNoteSets(function(t){null!=(t=t.previousNoteSet())&&(t.beam=e)})}}}},{key:"modifyArticulation",value:function(t){if(this.checkEditMarkingPermission()){var e=this._document.firstSelectedNoteSet;if(null!=e){var i=e.hasArticulation(t),n=Sn.DELAYED_ARTICULATIONS[t];null!=n?i?this.applyToNoteSets(function(e){e.removeArticulation(t),e.addArticulation(n)}):e.hasArticulation(n)?this.applyToNoteSets(function(t){t.removeArticulation(n)}):this.applyToNoteSets(function(e){e.addArticulation(t)}):i?this.applyToNoteSets(function(e){e.removeArticulation(t)}):this.applyToNoteSets(function(e){switch(e.addArticulation(t),t){case Sn.UP_BOW_ARTICULATION:e.removeArticulation(Sn.DOWN_BOW_ARTICULATION);break;case Sn.DOWN_BOW_ARTICULATION:e.removeArticulation(Sn.UP_BOW_ARTICULATION);break;case Sn.OPEN_ARTICULATION:e.removeArticulation(Sn.CLOSED_ARTICULATION);break;case Sn.CLOSED_ARTICULATION:e.removeArticulation(Sn.OPEN_ARTICULATION)}})}this.dispatchMajorNotationAction()}}},{key:"setTremolo",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNoteSet;null==e||this.isFullMeasureNotation(e)||this.applyToNoteSets(function(e){if(!(e.grace&&t>0||e.tremoloDyad&&0===t)&&(e.tremolo=t,e.tremoloDyad)){var i=!0,n=!1,r=void 0;try{for(var o,s=e.rhythmContext.elements[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Sn);l.grace||(l.tremolo=t)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}})}}},{key:"modifyQuarterBendAlteration",value:function(){var t=this._document.firstSelectedNote;if(null!=t){var e=0===t.tuning;this.applyToNotes(function(t){t.tuning=e?50:0})}}},{key:"modifyCue",value:function(){if(this.checkEditMarkingPermission()){var t,e=this._document.firstSelectedNote;if(null!=e){t=!e.effectiveCue;var i=!0,n=!1,r=void 0;try{for(var o,s=this.selectedNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;(A.is(a,de)||A.is(a,Sn))&&(a.effectiveCue=t)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}else{var l=this._document.firstSelectedNoteSet;null!=l&&(t=!l.effectiveCue,this.applyToNoteSets(function(e){e.effectiveCue=t}))}}}},{key:"modifyDirection",value:function(t){this.checkEditMarkingPermission()&&(null!=this._document.firstSelectedNoteSet&&this.applyToNoteSets(function(e){e.notes.length>0&&(e.direction=t)}))}},{key:"modifyNotationsDirection",value:function(t){if(this.checkEditMarkingPermission()&&null!=this._document.selection){var e=!0,i=!1,n=void 0;try{for(var r,o=this._document.selection.selectedNotations()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;A.is(s,ul)?A.unknownToType(s.parent,Sn).setLyricsDirection(t):A.is(s,Ua)?(A.unknownToType(s,Ua).defaultDirection=t,A.unknownToType(s,Ua).requiresDefaultInfo=!0):s.direction=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"modifyArpeggio",value:function(t){this.checkEditMarkingPermission()&&(null!=this._document.firstSelectedNoteSet&&this.applyToNoteSets(function(e){e.notes.length>1&&(e.arpeggio=t)}))}},{key:"modifyGrace",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNoteSet;if(null!=e){if(0===e.numChildren)return void Gy.show(Ou.getString("alerts/cantTurnRestToGraceNote"));if(e.grace)return void(e.appoggiatura!=t?e.appoggiatura=t:Gy.show(Ou.getString("alerts/selectedNoteAlreadyGraceNote")));var i=A.as(e.clone(),Sn);i.dots=0,i.tremolo=0,i.grace=!0,i.appoggiatura=t,t||(i.value=A.intToUint(mn.EIGHTH)),e.rhythmContext.addElementAt(i,A.intToUint(e.index)),e.removeAllChildren();var n=i.previousGraceNote;null!=n&&n.defaultBeaming(),this.selectNotation(e)}}}},{key:"setXOffset",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNotation(he);null!=e&&(e.dx=t/10)}}},{key:"setYOffset",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNotation(he);null!=e&&(e.dy=t/10)}}},{key:"setColor",value:function(t){if(this.checkEditMarkingPermission()&&null!=this.selection){var e=!0,i=!1,n=void 0;try{for(var r,o=this.selection.selectedNotations()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.effectiveColor=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"modifyNoteHead",value:function(){if(this.checkEditMarkingPermission()){var t=this._document.firstSelectedNote;if(null!=t){var i=t.noteHead;null==i&&(i=de.NORMAL_NOTE_HEAD);var n=e.NOTE_HEAD_CYCLE.indexOf(i);(i=n<0?null:A.unknownToString(e.NOTE_HEAD_CYCLE[(n+1)%e.NOTE_HEAD_CYCLE.length]))==de.NORMAL_NOTE_HEAD&&(i=null),this.applyToNotes(function(t){t.noteHead=i})}}}},{key:"setNoteHead",value:function(t){this.checkEditMarkingPermission()&&this.applyToNotes(function(e){e.noteHead=t})}},{key:"enterSlash",value:function(){if(this.checkEditPermission()){this.document.entryAfterSelection&&this.prepareEntryAfterSelection();var t=this.document.firstSelectedNoteSet;if(null!=t){if(1==t.notes.length&&t.getNoteAt(0).noteHead==de.SLASH_NOTE_HEAD)return void(t.getNoteAt(0).noteHead=de.HIT_NOTE_HEAD);t.removeAllChildren(),this.selectNotation(t,!1);var e=t.measure.getEffectiveClefAtMeasurePosition(t.position),i=e.getLineNote(e.centerLine,t.measure,!0);this.doAddStepToSelection(i.step,i,de.SLASH_NOTE_HEAD,0,!1)}}}},{key:"setBarlineType",value:function(t){if(this.checkEditPermission()&&null!=this.document.selection){var e=this.document.firstSelectedBarline;null!=e&&(e.type=t)}}},{key:"modifyStartRepeat",value:function(){if(this.checkEditPermission()&&null!=this.selection){var t;if(A.is(this.selection,qe)&&A.is(this.selection.selectedNotations()[0],En)){var e=A.unknownToType(this.selection.selectedNotations()[0],En);if(t=e.measure,0===e.position)t.startRepeat=!t.startRepeat,t.startRepeat||this.clearSelection();else t.index<this.score.numMeasures-1&&((t=t.staff.getMeasureAt(A.intToUint(t.index+1))).startRepeat=!t.startRepeat)}else(t=this.score.systemStaff.getMeasureAt(A.intToUint(this.selection.selectedMeasures.startIndex))).startRepeat=!t.startRepeat;this.dispatchMajorNotationAction()}}},{key:"modifyEndRepeat",value:function(){if(this.checkEditPermission()&&null!=this.selection){var t=this.selection.selectedMeasures,e=this.score.systemStaff.getMeasureAt(A.intToUint(t.endIndex-1));e.endRepeat=!e.endRepeat}}},{key:"transposeSelectionAtOctave",value:function(t){if(this.checkEditPermission()&&this.ensureSelection()){var e=!1;this.applyToNotes(function(i){i.playable&&(i.pitch=i.pitch.transpose(12*t),i.fret=-1,e=!0)}),e||this.nudgeSelection(t<0?he.DIRECTION_DOWN:he.DIRECTION_UP),this.echoSelectedNotes(),this.dispatchMajorNotationAction()}}},{key:"transposeSelectionDiatonic",value:function(t){if(this.checkEditMarkingPermission()&&this.ensureSelection()){var e=!1,i=this;this.applyToNotes(function(n){if(n.playable){var r=n.transposeDiatonic(t);n.pitch=r.pitch.transpose(n.measure.effectiveScoreAlteration(n.noteSet.position,r,n.noteSet.voiceNumber)),n.step=r.step,n.accidental=null,n.explicitAccidental=n.courtesyAccidental=!1,n.fret=-1;var o=i.defaultNoteHead(n.noteSet,n.pitch);null!=o&&(n.noteHead=o),e=!0}}),e?this.echoSelectedNotes():(this.applyToNotes(function(e){if(!e.playable){var i=e.transposeDiatonic(t);e.pitch=i.pitch.transpose(e.measure.effectiveAlteration(e.noteSet.position,i,e.noteSet.voiceNumber)),e.step=i.step}}),this.applyToNoteSets(function(e){0===e.notes.length&&(e.dy=.5*Math.round(2*e.dy+t),e.explicitRestY=!1)}),this.nudgeSelection(t<0?he.DIRECTION_DOWN:he.DIRECTION_UP)),this.dispatchMajorNotationAction()}}},{key:"transposeSelectionInterval",value:function(t){null==this.selection&&this.selectScore();var e=$a.fromString(t);this.applyToNotes(function(t){if(t.playable){var i=t.transposeInterval(e);t.pitch=i.pitch,t.step=i.step,t.accidental=i.accidental,t.fret=-1}}),this.applyToNonNotes(function(t,i){if(A.is(i,Aa)){var n=A.as(i,Aa),r=n.transposeInterval(e);n.text=r.text}})}},{key:"enharmonicShift",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.checkEditPermission()){var e,i;if(1==(t=A.unknownToType(t||this.selection.selectedNotations(),Array)).length&&(A.is(t[0],de)||A.is(t[0],Sn)&&1==A.unknownToType(t[0],Sn).notes.length)){e=A.unknownToType(A.is(t[0],de)?t[0]:A.unknownToType(t[0],Sn).notes[0],de),i=new $a(1,0);var n=e.transposeInterval(i);n.step==(e.step+1)%7&&(-2!=n.alteration||n.step!=de.C&&n.step!=de.F)||(i=new $a(-2,0),(n=e.transposeInterval(i)).step==(e.step+5)%7&&(2!=n.alteration||n.step!=de.B&&n.step!=de.E)||(i=new $a(-1,0)))}else{var r=0;this.applyToNotes(function(t){t.playable&&(e=t.measure.getScoreNote(t,t.measure.scoreInterval),r+=e.alteration)}),i=new $a(r<0?-1:1,0)}this.transposeSelectionInterval(i.toString())}}},{key:"transposeSelectionChromatic",value:function(t){if(this.checkEditPermission()&&this.ensureSelection())if(A.is(this.document.selection,qe)&&A.is(this.document.selection.selectedObjects[0],xn)){var e=t>0?he.DIRECTION_UP:he.DIRECTION_DOWN;this.adjustEffect(this.document.selection.selectedObjects[0],e)}else{var i=this.document.firstSelectedNote;if(null!=i){for(var n=t>0?1:-1,r=A.numberToInt(Math.abs(t)),o=A.as(i.clone(),de),s=0,a=0;a<r;a++){var l=o.transposeDiatonic(n);l.pitch=l.pitch.transpose(i.measure.keySignature.getAlteration(A.intToUint(l.step))),o.pitch=o.pitch.transpose(n),n>0&&(o.alteration>=2||o.pitch.ordinal>=l.pitch.ordinal)?(o.step=(o.step+1)%7,s++):n<0&&(o.alteration<=-2||o.pitch.ordinal<=l.pitch.ordinal)&&(o.step=(o.step-1+7)%7,s--)}this.applyToNotes(function(e){if(e.playable&&!e.measure.effectiveClef.unpitched){var i=e.transposeInterval(new $a(s,t));e.step=i.step,e.pitch=i.pitch,e.explicitAccidental=e.courtesyAccidental=!1,e.fret=-1}}),this.echoSelectedNotes(),this.dispatchMajorNotationAction()}}}},{key:"applyAccidentalToSelection",value:function(t){if(this.checkEditPermission()){var e=this._document.firstSelectedNote;if(null!=e||null==this._document.selection){var i=e.measure.getScoreNote(e),n=t-(i.alteration-e.alteration),r=de.alterationToAccidental(n),o=e.alteration!=n||e.accidental!=r;this.applyToNotes(function(e){if(o?(i=e.measure.getScoreNote(e),n=t-(i.alteration-e.alteration),e.alteration==n&&e.accidental==r||(e.pitch=e.diatonicPitch.transpose(n),e.accidental=de.alterationToAccidental(n),e.explicitAccidental=n==e.measure.effectiveAlteration(e.noteSet.position,e,e.noteSet.voiceNumber))):(n=e.measure.effectiveScoreAlteration(e.noteSet.position,e,e.noteSet.voiceNumber),e.pitch=e.diatonicPitch.transpose(n+1),e.pitch=e.diatonicPitch.transpose(n),e.explicitAccidental=e.courtesyAccidental=!1),e.tied){var s=e.measure.getLiaisonEnd(e);null!=s&&(s.pitch=e.pitch)}var a=e.measure.effectiveClef.mapNoteAndArticulation(e);null!=a&&e.noteSet.addArticulation(a)}),this.echoSelectedNotes()}else{var s=this._document.selection.selectedNotations();1==s.length&&A.is(s[0],Wl)&&this.applyAccidentalToTrill(A.as(s[0],Wl),t)}}}},{key:"applyAccidentalToTrill",value:function(t,e){if(null==t.target){var i=de.alterationToAccidental(e);t.accidental==i?t.accidental=null:t.accidental=i}else{var n=t.dummyNeighbor,r=e-(t.measure.getScoreNote(n).alteration-n.alteration),o=de.alterationToAccidental(r),s=n.alteration!=r||n.accidental!=o;t.accidental=s?o:null}}},{key:"toggleTextbox",value:function(){if(this.checkEditMarkingPermission()){var t,e=!0,i=!0,n=!1,r=void 0;try{for(var o,s=this.selection.selectedNotations()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.as(a,Ca);l&&(e&&(t=l.textbox,e=!1),l.textbox=!t)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}},{key:"selectNotation",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=t?null!=t.measure&&(this.document.selection=new qe(this.score,[t]),e&&this.setEntryAfterSelection(!1)):this.document.selection=null}},{key:"selectNotationRange",value:function(t){if(null==this.selection||this.selection.empty)return this.document.selection=Je.getRangeForNotation(t),void this.setEntryAfterSelection(!1);A.is(this.selection,Ke)?this.modifyNotationSelection(t):(this.document.selection=this.selection.selectedRange.union(Je.getRangeForNotation(t)),this.setEntryAfterSelection(!1))}},{key:"modifyNotationSelection",value:function(t){null==this.selection||this.selection.empty?this.selectNotation(t):(A.is(this.selection,qe)?this.selection.contains(t)?this._document.deselect(new qe(this.score,[t])):A.is(t,de)&&this.selection.contains(A.unknownToType(t,de).noteSet)&&1==A.unknownToType(t,de).noteSet.notes.length?this._document.deselect(new qe(this.score,[A.unknownToType(t,de).noteSet])):this._document.select(new qe(this.score,[t])):A.is(this.selection,Ke)?this.document.selection=A.unknownToType(this.selection,Ke).withRange(t.measure.index,t.measure.index+1):A.is(this.selection,Je)&&null!=t.valueNotation&&(this.document.selection=A.unknownToType(this.selection,Je).union(Je.getRangeForNotation(t.valueNotation))),this.setEntryAfterSelection(!1))}},{key:"selectRangeForMeasure",value:function(t){t.isSystemMeasure?this.selectMeasure(t):(this.document.selection=Je.getRangeForMeasure(t),this.setEntryAfterSelection(!1))}},{key:"selectStaff",value:function(t){this.document.selection=Je.selectStaff(t),this.setEntryAfterSelection(!1)}},{key:"selectTuplet",value:function(t){if(null!=t){var e=t.measure;this.document.selection=new Je(this.score,new gl(A.intToUint(e.index),t.position),new gl(A.intToUint(e.index),t.position+t.duration),[e.staff])}}},{key:"selectRange",value:function(t,e){var i=t.measure,n=e.measure;this.document.selection=new Je(this.score,new gl(i.index,t.rhythmPosition),new gl(A.intToUint(n.index),e.rhythmPosition+e.rhythmDuration),[i.staff])}},{key:"selectPart",value:function(t){this.document.selection=Je.selectPart(t),this.setEntryAfterSelection(!1)}},{key:"toggleMediaSynced",value:function(){this.score.toggleMediaSynced(),this.dispatchEvent(new ci(ci.MAJOR_NOTATION_CHANGE))}},{key:"toggleNoteflightTrack",value:function(t){t.noteflightTrackMuted=!t.noteflightTrackMuted}},{key:"toggleTrack",value:function(t){t.togglePlayback()}},{key:"deleteTrack",value:function(t){t.remove(),this.dispatchEvent(new qi(qi.TRACK_CHANGE))}},{key:"addAudioClip",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=Yc.createAudioMedia();a.mediaFileData=i,a.channelCount=A.unknownToInt(i.numberOfChannels),a.sampleRate=A.unknownToNumber(i.sampleRate),a.duration=A.unknownToNumber(i.duration),null!=n&&(a.mediaFileId=n.media_file_id,a.mediaId=n.media_id,a.contentType=n.content_type),a.notifyLoaded();var l=new Ma;l.trackStartTime=r,l.mediaStartTime=o,l.mediaEndTime=s||a.duration,l.audioMedia=a;var u=e.getOrCreateTrackByUser(t);u.addAudioClipAndRemoveOverlap(l),u.selectPlayback(),this.dispatchEvent(new qi(qi.TRACK_CHANGE)),e.showAudioWaveform=!0}},{key:"selectMeasure",value:function(t){if(A.is(this.document.selection,Ke)){var e=this.document.selection.selectedMeasures;if(e.startIndex==t.index&&e.endIndex==t.index+1)return}this.document.selection=new Ke(this.score,t.index,t.index+1),this.setEntryAfterSelection(!1)}},{key:"selectScore",value:function(){this.document.selection=new Ke(this.score,0,this.score.numMeasures),this.setEntryAfterSelection(!1)}},{key:"filterSelection",value:function(t){if(this.ensureSelection()){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.selectedNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=!1;switch(t){case"filterChords":l=A.is(a,Aa);break;case"filterExpressions":l=A.is(a,Ra);break;case"filterPerformance":l=A.is(a,bl);break;case"filterNotes":A.is(a,Sn)&&(a.notes.length>0?e=e.concat(a.notes):e.push(a)),l=A.is(a,de);break;case"filterNotesAndLyrics":A.is(a,de)&&e.push(a.noteSet),l=A.is(a,Sn);break;case"filterLyrics":A.is(a,Sn)?e=e.concat(a.lyrics):A.is(a,de)&&(e=e.concat(a.noteSet.lyrics)),l=A.is(a,ul);break;case"filterSpans":l=A.is(a,Ua);break;case"filterVoice0":l=0===a.voiceNumber;break;case"filterVoice1":l=1==a.voiceNumber}l&&e.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}e.length>0?this.document.selection=new qe(this.score,e):this.document.selection=null}}},{key:"extendRangeToMeasure",value:function(t){null==this.selection||this.selection.empty?this.selectMeasure(t):t.isSystemMeasure?this.extendMeasureSelection(t):(this.document.selection=this.selection.withMeasure(t),this.setEntryAfterSelection(!1))}},{key:"extendRangeToStaff",value:function(t){null==this.selection||this.selection.empty?this.selectStaff(t):(this.document.selection=this.selection.withMeasure(t.getMeasureAt(0)).withMeasure(t.getMeasureAt(A.intToUint(this.score.numMeasures-1))),this.setEntryAfterSelection(!1))}},{key:"extendMeasureSelection",value:function(t){null==this.selection||this.selection.empty?this.selectMeasure(t):(this.document.selection=this.selection.selectedMeasures.withMeasure(t),this.setEntryAfterSelection(!1))}},{key:"clearSelection",value:function(){this.document.selection=null}},{key:"removeTacet",value:function(t){var e=t.measure;e.removeElement(t);var i=new Sn(0,null,e.timeSignature.beatValue,0);return e.addElement(i,t.lastVoiceNumber),e.addRests(),i}},{key:"removeMeasureRepeat",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.measure;if(n.removeElement(t),i){var r=n.getVoiceNumber(0,!0),o=new Gl;r.addElement(o),this.selectNotation(o)}else e=new Sn(0,null,n.timeSignature.beatValue,0),n.addElement(e,t.lastVoiceNumber),n.addRests();return e}},{key:"isFullMeasureNotation",value:function(t){return A.is(t,Gl)||A.is(t,vl)}},{key:"removeFullMeasureNotation",value:function(t){return A.is(t,Gl)?this.removeTacet(A.as(t,Gl)):A.is(t,vl)?this.removeMeasureRepeat(A.as(t,vl)):null}},{key:"insertBlankMeasureAt",value:function(t){this.checkEditPermission()&&(this.score.insertBlankMeasureAt(t),0===t&&(this.score.defaultMeasureBoundary(0),this.score.defaultMeasureBoundary(1)),this.document.selection=new Ke(this.score,t,t+1),this.setEntryAfterSelection(!1),this.dispatchMajorNotationAction())}},{key:"addMeasureAfterSelection",value:function(){if(this.checkEditPermission()){var t=this.document.firstSelectedNoteSet;null!=t&&this.insertBlankMeasureAt(A.intToUint(t.measure.index+1))}}},{key:"insertBlankStaffAt",value:function(t,e,i){if(this.checkEditPermission()){var n=new Rl;n.part=t,n.type=Ul.createTypeFromClef(i),this.score.staffMetrics.showPartNames=!0,this.score.staffMetrics.partNamePosition=pn.PART_NAME_POSITION_STAFF,this.score.insertBlankStaffAt(n,e,i),this.selectStaff(n)}}},{key:"movePart",value:function(t,e){this.checkEditPermission()&&(this.dispatchEvent(new xi(xi.PART_MOVED)),this.score.movePart(t,e))}},{key:"pasteIntoRange",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=e.start;this.score.ensureDuration(r.measureIndex,r.position,t.duration);for(var o=0;o<t.sequences.length;o++){var s=A.unknownToType(t.sequences[o],Pl),a=e.staves[o];if(i!=Kl.NON_METRICAL_VOICE_NUMBER&&a.clearStaffRange(r,A.numberToInt(t.duration),i),s.mergeToStaff(a,r,i),a.addRests(r,A.numberToInt(t.duration)),r.position>0){var l=A.as(a.getMeasureAt(r.measureIndex).previousNotation(r.position),Sn);null!=l&&l.defaultBeaming()}var u=a.offsetPosition(e.start,t.duration,!1);if(u.measureIndex<a.measures.length&&u.position>0){var h=A.as(a.getMeasureAt(u.measureIndex).previousNotation(u.position),Sn);null!=h&&h.defaultBeaming()}}var c=this.score.systemStaff.offsetPosition(r,t.duration,!0);n&&(this.document.selection=new Je(this.score,r,c,e.staves),this.setEntryAfterSelection(!1))}},{key:"pasteAt",value:function(t,i){if(null!=i){if(A.is(t,ti)){var n=A.unknownToType(t,ti),r=i.selectedMeasures.startIndex;this.score.insertScoreAt(n.score,r),this.score.defaultMeasureBoundary(r),this.score.defaultMeasureBoundary(r+n.score.numMeasures),this.document.selection=new Ke(this.score,r,r+n.score.numMeasures),this.setEntryAfterSelection(!1)}else if(A.is(t,ri)){var o=A.unknownToType(t,ri),s=i.selectedRange;if(o.sequences.length!=s.staves.length)return void Gy.show(Ou.getString("alerts/clipboardSelectionMismatch",[e.stavesText(o.sequences.length),e.stavesText(s.staves.length)]));if(o.singleVoiceNumber==Kl.UNKNOWN_VOICE_NUMBER||o.singleVoiceNumber==Kl.NON_METRICAL_VOICE_NUMBER&&!o.fromObjects)this.pasteIntoRange(o,s,Kl.UNKNOWN_VOICE_NUMBER);else{var a=o.singleVoiceNumber,l=this.selection.selectedVoiceNumber;if(a==Kl.NON_METRICAL_VOICE_NUMBER?l=a:l==Kl.NON_METRICAL_VOICE_NUMBER&&(l=Kl.UNKNOWN_VOICE_NUMBER),this.pasteIntoRange(o,s,l),o.fromObjects&&l!=Kl.UNKNOWN_VOICE_NUMBER){var u=[];if(0===this.selectedNotations.length)return void(this.document.selection=null);var h=!0,c=!1,d=void 0;try{for(var f,y=this.selectedNotations[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;if(g.voiceNumber==l){if(g.rhythmContext&&A.is(g.rhythmContext,Xl)){var p=A.unknownToType(g.rhythmContext,Xl);if(this.selectedNotations.indexOf(A.unknownToType(p.elements[0],he))<0)continue}u.push(g)}}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}this.document.selection=new qe(this.score,u)}}}this.dispatchMajorNotationAction()}}},{key:"pasteSequence",value:function(t,e,i){var n=new ri;n.sequences=[t];var r=new Je(this.score,i,i,[e]);this.pasteIntoRange(n,r,Kl.UNKNOWN_VOICE_NUMBER,!1)}},{key:"removeRange",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.score.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);t.includesEntireStaffRange(l,0,this.score.numMeasures)&&e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}e.length==this.score.numStaves&&(e=[]);var u=!0,h=!1,c=void 0;try{for(var d,f=t.staves[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;if(!(e.indexOf(y)>=0))for(var g=t.start.measureIndex;g<=t.end.measureIndex;g++){var p=y.getMeasureAt(A.intToUint(g)),m=g==t.start.measureIndex?t.start.position:0,v=g==t.end.measureIndex?t.end.position:p.duration;if(p.removePositionRange(A.numberToInt(m),A.numberToInt(v-m),Kl.UNKNOWN_VOICE_NUMBER),p.addRests(),m>0){var _=A.as(p.previousNotation(m),Sn);null!=_&&_.defaultBeaming()}}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}if(e.length>0){for(var S=0;S<e.length;S++){var L=e[S],k=A.unknownToType(L,Rl);this.score.removeChild(k)}if(this.clearSelection(),1==this.score.numVisibleParts&&(this.score.staffMetrics.showPartNames=!1),0===this.score.visibleStaves.length){var T=!0,E=!1,M=void 0;try{for(var b,w=this.score.parts[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){b.value.visible=!0}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}}}}},{key:"removeMeasures",value:function(t){var e=t.startIndex,i=t.endIndex;this.clearSelection();for(var n=this.score.systemStaff.getMeasureAt(A.intToUint(e)),r=n.timeSignatureNotation,o=0===e&&null!=r&&!r.equals(n.measureInfo.timeSignature),s=i-1;s>=e;s--){var a=!0,l=!1,u=void 0;try{for(var h,c=this.score.staves[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;A.unknownToType(d,Rl).removeChildAt(A.intToUint(s))}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}this.score.systemStaff.removeChildAt(A.intToUint(s))}if(e==this.score.numMeasures){var f=this.score.systemStaff.getMeasureAt(A.intToUint(e-1)).barlineNotation;null!=f&&(f.type=En.FINAL)}o&&this.score.systemStaff.getMeasureAt(A.intToUint(e)).addElement(A.as(r.clone(),zl),Kl.NON_METRICAL_VOICE_NUMBER),this.dispatchMajorNotationAction()}},{key:"removeSelection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(A.is(this.selection,qe)){var e=null;this.applyToNonNotes(function(t,i){if(A.is(i,ul)){var n=A.as(i,ul);(e=n.noteSet).removeLyric(n)}else if(A.is(i,Yl)){var r=i.measure,o=r.index;if(i.measure.removeElement(i),o>0){var s=r.staff.getMeasureAt(A.intToUint(o-1)).tempo;t.score.setTempoAtMeasure(s,A.intToUint(o))}}else A.is(i,vl)?t.removeMeasureRepeat(A.as(i,vl),!0):A.is(i,xn)?i.isPreEffect?i.parent.removePreEffect():i.parent.removePostEffect():i.measure.isSystemMeasure?(A.is(i,bl)||A.is(i,Il)||A.is(i,Oa)||A.is(i,Aa)||A.is(i,ll))&&i.measure.removeElement(i):(e=A.as(i.measure.notationAtPosition(i.position,Sn),Sn),i.measure.removeElement(i))}),this.applyToNotes(function(i){var n=(e=i.noteSet).defaultBeamEnabled;if(e.removeNote(i,t),0===e.notes.length&&(e.removeAllAnnotations(),e.grace)){var r=e.previousGraceNote,o=e.nextGraceNote;e.measure.removeElement(e),null!=r&&r.defaultBeaming(),null!=o&&o.defaultBeaming()}null!=e.parent&&e.defaultBeamEnabled!=n&&e.defaultBeaming()}),null!=e&&this.selectNotation(e)}else if(A.is(this.selection,Je))this.removeRange(A.as(this.selection,Je));else if(A.is(this.selection,Ke)){var i=!1,n=A.as(this.selection,Ke);0===n.startIndex&&n.endIndex==this.score.numMeasures&&(this.removeRange(new Ke(this.score,0,1).selectedRange),i=1==this.score.numMeasures,n=new Ke(this.score,1,this.score.numMeasures)),i||this.removeMeasures(n),this.score.defaultMeasureBoundary(n.startIndex)}}},{key:"removeSelectionMarkings",value:function(){this.applyToNonNotes(function(t,e){this.document&&this.document.isModelEditable(e)&&e.measure.removeElement(e)})}},{key:"deleteSelection",value:function(){var t=this.selectionSingleRest();if(null!=t){if(A.is(t,Gl)&&t.measure.numVoices>1)return void this.removeSelectedVoice();if(this.removeContainingTuplet(),this.document.entryAfterSelection)return void this.setEntryAfterSelection(!1);this.selectPreviousNoteSet(!1)}this.removeSelection()}},{key:"selectionSingleRest",value:function(){var t=A.as(this.selection,qe);if(null==t||1!=t.selectedNotations().length)return null;var e=A.as(t.selectedNotations()[0],Sn);return null==e?null:A.is(e,vl)?null:0!==e.notes.length?null:e}},{key:"setTempoAtMeasure",value:function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yl.MAX_VALUE,r=this.score.systemStaff.getMeasureAt(A.intToUint(e));if(null!=r&&null!=r.tempoNotation&&null!=this.selection&&this.selection.includes(r.tempoNotation)&&A.is(this.selection,qe)&&(i=!0),this.document.score.setTempoAtMeasure(t,e,n),this.dispatchMajorNotationAction(),i&&null!=r.tempoNotation){var o=new qe(this.score,[r.tempoNotation]);this.document.selection=o}}},{key:"setSelectionTempo",value:function(t){if(this.checkEditPermission()){var e,i=0,n=0;null!=this.selection&&(i=this.selection.selectedMeasures.startIndex,n=this.selection.selectedMeasures.endIndex);var r=this.score.systemStaff.getMeasureAt(A.intToUint(i));if(null!=r&&null!=r.tempoNotation&&null!=this.selection&&this.selection.includes(r.tempoNotation)&&A.is(this.selection,qe)&&(e=!0),null==this.selection||A.is(this.selection,qe)&&i==n-1?this.score.setTempoAtMeasure(t,A.intToUint(i)):this.score.setTempoAtMeasure(t,A.intToUint(i),A.intToUint(n)),e){var o=new qe(this.score,[r.tempoNotation]);this.document.selection=o}this.dispatchMajorNotationAction()}}},{key:"changeTimeSignature",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditPermission()){var i=this.timeSignatureSelection;e||(i=new Ke(i.score,i.startIndex,i.startIndex+1));var n=this.score.systemStaff.getMeasureAt(A.intToUint(i.startIndex)),r=n.measureInfo,o=n.timeSignatureNotation,s=r.timeSignature;if(s.equals(t))this.dispatchEvent(new Si(Si.TIME_SIGNATURE_APPLIED));else{if(s.sameTimeProperties(t))r.timeSignature=t,n.measureInfo=r,this.score.defaultMeasureBoundary(i.startIndex,e);else{var a,l,u=i.selectedRange;if(e)a=A.unknownToType(u.createClipboard(),ri),l=A.numberToUint((a.duration+t.meterDuration-1)/t.meterDuration);else{var h=new gl(u.end.measureIndex,Math.max(0,u.end.position-t.meterDuration));u=new Je(this.score,h,u.end,u.staves),a=A.unknownToType(u.createClipboard(),ri),l=1;var c=new gl(A.intToUint(i.startIndex),0),d=new gl(A.intToUint(i.startIndex),t.meterDuration);u=new Je(this.score,c,d,u.staves)}r.timeSignature=t;for(var f=0;f<l;f++)this.score.insertBlankMeasureAt(i.startIndex,r);var y=new Ke(this.score,i.startIndex+l,i.endIndex+l);this.removeMeasures(y),this.pasteIntoRange(a,u,Kl.UNKNOWN_VOICE_NUMBER);var g=i.startIndex+l;if(!e){var p=!0,m=!1,v=void 0;try{for(var _,S=this.score.staves[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value,k=A.unknownToType(L,Rl).getMeasureAt(A.intToUint(i.startIndex)).getNotationAt(0);this.isFullMeasureNotation(k)&&this.removeFullMeasureNotation(k)}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}null!=o&&this.score.systemStaff.getMeasureAt(A.intToUint(i.startIndex)).addElement(A.as(o.clone(),zl),Kl.NON_METRICAL_VOICE_NUMBER)}this.score.defaultMeasureBoundary(i.startIndex,e),this.score.defaultMeasureBoundary(g,e),this.document.selection=new Ke(this.score,i.startIndex,g),this.setEntryAfterSelection(!1)}this.dispatchMajorNotationAction(),this.dispatchEvent(new Si(Si.TIME_SIGNATURE_APPLIED))}}}},{key:"changeKeySignature",value:function(t){if(this.checkEditPermission()){for(var e=this.keySignatureSelection,i=e.startIndex;i<e.endIndex;i++){var n=this.score.systemStaff.getMeasureAt(A.intToUint(i));n.keySignature=t,null!=n.keySignatureNotation&&(n.removeElement(n.keySignatureNotation),null!=n.barlineNotation&&(n.barlineNotation.type=En.SINGLE));var r=!0,o=!1,s=void 0;try{for(var a,l=this.score.staves[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;A.unknownToType(u,Rl).getMeasureAt(A.intToUint(i)).keySignature=t}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}this.score.defaultSystemMeasureNotations(e.startIndex,!0),this.score.defaultSystemMeasureNotations(e.endIndex,!0)}}},{key:"changeClef",value:function(t){this.checkEditPermission()&&this.changeClefInRange(t,this.clefSelection)}},{key:"changeClefInRange",value:function(t,e){for(var i=0;i<e.staves.length;i++)this.doChangeClefInStaff(t,e,e.staves[i])}},{key:"doChangeClefInStaff",value:function(t,e,i){for(var n=e.start.measureIndex,r=e.end.measureIndex,o=A.numberToInt(e.start.position),s=A.numberToInt(e.end.position),a=i.getMeasureAt(A.intToUint(r)),l=a.getNotatedClefAtMeasurePosition(s),u=n;u<=r;u++){var h=i.getMeasureAt(A.intToUint(u));this.removeClefNotations(h,e),u==n&&o>0?this.addClefAtMeasurePosition(t,h,o):h.clef=A.as(t.clone(),Mn)}s<a.duration&&this.addClefAtMeasurePosition(l,a,s),i.defaultClefChanges(n),i.defaultClefChanges(r+1)}},{key:"removeClefNotations",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t.measureNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,he);A.is(l,Mn)&&e.includesNotationClosed(l)&&t.removeElement(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"addClefAtMeasurePosition",value:function(t,e,i){t.sameAs(e.getNotatedClefAtMeasurePosition(i))||((t=A.as(t.clone(),Mn)).rhythmPosition=A.intToUint(i),e.addElement(t,Kl.NON_METRICAL_VOICE_NUMBER))}},{key:"overrideStaffClef",value:function(t,e){t.overrideClef=e,this.defaultTransposableSpans(t)}},{key:"applyBreakSet",value:function(t){if(this.checkEditPermission()&&null!=this.selection){var i=this.selection.selectedMeasures,n=i.endIndex;t==e.CREATE_SYSTEM_BREAK_SET&&(i.startIndex>0&&this.score.setBreak(i.startIndex-1,hl.SYSTEM_BREAK_TYPE),n=i.endIndex-1,this.score.setBreak(i.endIndex-1,hl.SYSTEM_BREAK_TYPE));for(var r=!0,o=i.startIndex;o<n;o++){var s=this.score.getBreak(o);o==i.startIndex&&s==hl.KEEP_WITH_NEXT_TYPE&&(r=!1);var a=r?hl.KEEP_WITH_NEXT_TYPE:null;this.score.setBreak(o,a)}}}},{key:"applyBreak",value:function(t){this.checkEditPermission()&&null!=this.selection&&this.score.applyBreak(this.selection.selectedMeasures.endIndex-1,t)}},{key:"toggleCautionaries",value:function(){if(this.checkEditPermission()&&null!=this.selection){var t=this.selection.selectedMeasures,e=this.score.systemStaff.getMeasureAt(A.intToUint(t.endIndex-1));null==e.breakType?(e.breakType=hl.SYSTEM_BREAK_TYPE,e.disableCautionaries=!0):e.disableCautionaries=!e.disableCautionaries}}},{key:"toggleHideStaff",value:function(){if(this.checkEditPermission()&&null!=this.selection){var t,e=this.selection.selectedRange,i=!0,n=!0,r=!1,o=void 0;try{for(var s,a=e.staves[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)for(var l=s.value,u=e.start.measureIndex;u<=e.end.measureIndex;u++)i&&(t=!l.getMeasureAt(A.intToUint(u)).canHideStaff,i=!1),l.getMeasureAt(A.intToUint(u)).canHideStaff=t}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}},{key:"addMultiRest",value:function(){if(this.checkEditPermission()){var t=this.selection.selectedRange,e=t.end.measureIndex-t.start.measureIndex+1;if(e<2)Gy.show(Ou.getString("alerts/multirestTooShort"));else{var i=!0,n=!1,r=void 0;try{for(var o,s=t.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=t.start.measureIndex;l<=t.end.measureIndex;l++){var u=a.getMeasureAt(A.intToUint(l));if(u.numVoices>1||!A.is(u.getVoiceNumber(0).noteSetAtPosition(0),Gl))return void Gy.show(Ou.getString("alerts/multirestNoTacet"));if(0!==u.multiRest)return void Gy.show(Ou.getString("alerts/multirestOverlap"))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.addSpanToSelection(kl.createMultiRest(e))}}}},{key:"toggleBarlineBreaks",value:function(){if(this.checkEditPermission()&&null!=this.selection){var t,e=this.selection.selectedRange,i=!0,n=!0,r=!1,o=void 0;try{for(var s,a=e.staves[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i&&(t=!l.part.barlineBreak,i=!1),l.part.barlineBreak=t}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}},{key:"changeInstrument",value:function(t,e){if(this.checkEditPermission()){var i;i=null==this.selection?[this.score.getStaffAt(0)]:this.selection.selectedRange.staves,t.staves=i;var n=0,r=!0,o=!1,s=void 0;try{for(var a,l=i[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,Rl);if(h.overrideClef=null,e&&e.length>0){h.type=Ul.createTypeFromClef(e[n]);var c=!0,d=!1,f=void 0;try{for(var y,g=h.measures[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){y.value.clef=A.as(e[n].clone(),Mn)}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}n+1<e.length&&n++}h.part=t}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}}},{key:"addSpanToSelection",value:function(t){if(this.checkEditMarkingPermission()){var e=this.document.firstSelectedNoteSet;if(null!=e){var i=this.selection.selectedRange,n=A.numberToInt(i.duration);A.is(this.selection,qe)&&1==A.unknownToType(this.selection,qe).selectedNotations().length&&!A.is(t,Va)||(n=A.numberToInt(Math.max(1,n-1)));var r,o=1==i.staves.length?e.voiceNumber:0;t.span=n,t.rhythmPosition=A.numberToUint(i.start.position),t.includeGrace=e.grace||null==e.previousGraceNote;var s=!0,a=!1,l=void 0;try{for(var u,h=i.staves[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c,d=u.value;if((r=A.as(t.clone(),Ua)).requiresDefaultInfo=!0,d.getMeasureAt(i.start.measureIndex).addElement(r,o),A.is(r,qa)){A.as(r,qa);c=A.is(r,kl)?e.measure.effectiveClef.staffHeight/2:A.unknownToType(r,qa).defaultPositionAboveStaff(d)?e.measure.effectiveClef.staffHeight+this.document.score.effectiveStaffMetrics.lineNotationDistanceAboveStaff:this.document.score.effectiveStaffMetrics.lineNotationDistanceBelowStaff,r.dy=c}if(A.is(r,Va)){d.part.directionsAboveStaff&&(c=this.document.score.effectiveStaffMetrics.hairpinExpressionPaddingTop,r.dy=c);var f,y=i.objectSelection.selectedObjects.filter(function(t){return A.is(t,Ra)}).map(function(t){return[t.measurePosition.measureIndex,t.measurePosition.position]}),g=this.document.lastSelectedNoteSet;if(y.length)for(var p=0;p<y.length;p++){var m=y[p][0],v=y[p][1];if(m===g.measurePosition.measureIndex&&v===g.measurePosition.position){f=!0;break}f=!1}f&&g!=this.document.firstSelectedNoteSet&&(r.span-=g.duration)}A.is(r,Wl)&&r.recalculateInterval()}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}this.modifyNotationSelection(r)}}}},{key:"applyPreEffectToSelection",value:function(t){if(!this.checkEditPermission())return null;var e=this._document.firstSelectedNote;if(null==e)return Gy.show(Ou.getString("alerts/requiresNoteSelection")),null;if(e.hasPreEffect&&e.preEffect.type==t)e.removePreEffect();else{var i=new xn(t,xn.defaultAscent(t),xn.defaultShift(t));e.hasPreEffect?(e.removePreEffect(),e.addPreEffect(i)):e.addPreEffect(i)}}},{key:"applyPostEffectToSelection",value:function(t){if(!this.checkEditPermission())return null;var e=this._document.firstSelectedNote;if(null==e)return Gy.show(Ou.getString("alerts/requiresNoteSelection")),null;if(e.hasPostEffect&&e.postEffect.type==t)e.removePostEffect();else{var i=new xn(t,xn.defaultAscent(t),xn.defaultShift(t));e.hasPostEffect?(e.removePostEffect(),e.addPostEffect(i)):e.addPostEffect(i)}}},{key:"addAnnotation",value:function(){if(!this.checkEditPermission())return null;if(null==this.document.firstSelectedNoteSet)return Gy.show(Ou.getString("alerts/requiresNoteSelection")),null;var t=new Ea;return t.created=T.currentDate,t.lastModified=t.created,t.text="",t.username=this._user.username,t.virgin=!0,this.document.firstSelectedNoteSet.addAnnotation(t),t}},{key:"updateAnnotationText",value:function(t,e){this.checkEditPermission()&&(t.text=e)}},{key:"removeAnnotation",value:function(t){this.checkEditPermission()&&t.parent.removeAnnotation(t)}},{key:"addSegno",value:function(){this.addSymbol(new Il)}},{key:"addCoda",value:function(){this.addSymbol(new Oa)}},{key:"toggleSplitSystem",value:function(){var t=this.document.firstSelectedNoteSet;if(null!=t&&t.measure.nextMeasure){var e=t.measure.effectiveSystemMeasure;e.systemGap=!e.systemGap}}},{key:"addRepeatEnding",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.checkEditMarkingPermission())return null;var e=this.document.selection;if(!e)return null;var i=e.selectedMeasures;if(!i)return null;this._removeSelectedRepeatEndings(e);var n=i.duration,r=this._createRepeatEnding(n,t);return this.document.score.systemStaff.getMeasureAt(i.startIndex).addElement(r,Kl.NON_METRICAL_VOICE_NUMBER),this.selectNotation(r),r}},{key:"_removeSelectedRepeatEndings",value:function(t){var e=t.selectedNotations(),i=t.systemMeasureNotations,n=this.document.score.systemStaff,r=t.measureIndicies.reduce(function(t,e){return t.concat(n.spanNotationsAt(e))},[]);e.concat(i,r).forEach(function(t){var e=t instanceof ll,i=t instanceof qa&&[ll.TYPE_INITIAL,ll.TYPE_FINAL].includes(t.type);(e||i)&&t.measure&&t.measure.removeElement(t)})}},{key:"_createRepeatEnding",value:function(t,e){var i=t,n=e?ll.TYPE_FINAL:ll.TYPE_INITIAL,r=this.document.score.effectiveStaffMetrics.repeatEndingBracketEndX,o=e?"2.":"1.",s=this.document.score.effectiveStaffMetrics.repeatEndingBracketHeight,a=this.document.score.effectiveStaffMetrics.repeatEndingBracketBold,l=new ll(0,i,n,r,o,s,a);return l.dy=this.document.score.effectiveStaffMetrics.repeatEndingDistanceAboveStaff,l}},{key:"setMeasureRepeat",value:function(){if(this.checkEditMarkingPermission()&&this.selection){var t=this.selection.objectSelection,e=[],i=new Uy,n=!0,r=!1,o=void 0;try{for(var s,a=t.selectedNotations()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,he).measure;u.isSystemMeasure||i.get(u)||(i.put(u,!0),e.push(u))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}var h=e[0];h&&0==h.index&&this.dispatchTipEvent(mt.NOT_ENOUGH_MEASURE_REPEAT_SPACE);for(var c=[],d=0;d<e.length;d++){var f=e[d],y=vl.setMeasureToMeasureRepeat(f);c.push(y)}this.document.selection=new qe(this.score,c)}}},{key:"addSymbol",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.checkEditMarkingPermission()){var i=this.document.firstSelectedNoteSet;if(null!=i){if(e){var n=this.selection.selectedRange;t.rhythmPosition=A.numberToUint(n.start.position)}i.measure.systemMeasure.addElement(t,Kl.NON_METRICAL_VOICE_NUMBER),this.selectNotation(t)}}}},{key:"addRehearsalLetter",value:function(){if(null!=this.document.selection){var t=this.document.selection.selectedRange,e=this.score.systemStaff.getMeasureAt(t.start.measureIndex),i=A.as(e.notationAtPosition(t.start.position,bl),bl),n=0,r=e.previousNotation(t.start.position,function(t){return A.is(t,bl)},!0);null==r||null!=i&&r.dy==i.dy?null!=i&&(n=i.dy+this.score.effectiveStaffMetrics.performanceTextSpacing):n=r.dy;var o=this.selectNextRehearsalLetter(t.start.measureIndex,A.numberToInt(t.start.position));this.modifyFollowingMeasures(t.start.measureIndex,A.numberToInt(t.start.position),o);var s=new bl(t.start.position,"",n);s.parent=e,s.textbox=!0,s.text=o,e.addElement(s,Kl.NON_METRICAL_VOICE_NUMBER)}}},{key:"modifyFollowingMeasures",value:function(t,i,n){for(var r=e.ALPHABET.indexOf(n.substring(0,1))+e.ALPHABET.length*(n.length-1),o=t;o<this.score.numMeasures;o++)for(var s=this.score.systemStaff.getMeasureAt(A.intToUint(o)).allNonMetricalElements,a=0;a<s.length;a++){var l=A.as(s[a],Ca);l&&(o>t||s[a].position>i)&&l.text==this.prepareAlphabetLetter(r)&&l.textbox&&(l.text=this.prepareAlphabetLetter(r+1),r++)}}},{key:"selectNextRehearsalLetter",value:function(t,e){for(var i=0,n=0;n<=t;n++)for(var r=this.score.systemStaff.getMeasureAt(A.intToUint(n)).allNonMetricalElements,o=0;o<r.length;o++){var s=A.as(r[o],Ca);s&&(n<t||r[o].position<=e)&&s.text==this.prepareAlphabetLetter(i)&&s.textbox&&i++}return this.prepareAlphabetLetter(i)}},{key:"prepareAlphabetLetter",value:function(t){for(var i=A.numberToInt(t/e.ALPHABET.length),n=t%e.ALPHABET.length,r=e.ALPHABET.charAt(n),o=0;o<i;o++)r+=e.ALPHABET.charAt(n);return r}},{key:"resetLayout",value:function(){if(this.checkEditPermission())for(var t,e=(t=null==this.selection?new Ke(this.score,0,this.score.numMeasures):this.selection.selectedMeasures).startIndex;e<t.endIndex;e++){var i=this.score.systemStaff.getMeasureAt(A.intToUint(e));this.setLayoutWeight(i,1),i.leftMargin=i.rightMargin=0;var n=!0,r=!1,o=void 0;try{for(var s,a=this.score.staves[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;A.unknownToType(l,Rl).getMeasureAt(A.intToUint(e)).defaultTransposableSpans()}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}i.breakType=null,i.systemGap=!1,i.removeCustomizationForViews()}}},{key:"setLayoutWeight",value:function(t,e){t.layoutWeight=e}},{key:"applyToNoteSets",value:function(t){var e=new Uy,i=!0,n=!1,r=void 0;try{for(var o,s=this.selectedNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;A.is(a,de)?e.put(A.unknownToType(a,de).noteSet,!0):A.is(a,Sn)&&e.put(a,!0)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var l=!0,u=!1,h=void 0;try{for(var c,d=xt.dictionaryForInSource(e)[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){t(c.value)}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}},{key:"applyToNotes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.selectedNotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;A.is(l,de)?i.push(l):A.is(l,Sn)&&(i=i.concat(A.unknownToType(l,Sn).notes))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}null!=e&&i.sort(e);var u=!0,h=!1,c=void 0;try{for(var d,f=i[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;t(A.unknownToType(y,de))}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}},{key:"applyToNonNotes",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.selectedNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;(A.is(a,vl)||!A.is(a,de)&&!A.is(a,Sn))&&e.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}for(var l=0;l<e.length;l++){var u=e[l];t(this,A.unknownToType(u,he))}}},{key:"handleSelectEvent",value:function(t){this.dispatchEvent(t)}},{key:"defaultNoteHead",value:function(t,e){return t.measure.effectiveClef.defaultNoteHead(e)}},{key:"checkEagerMeasureAppend",value:function(){var t=this.document.firstSelectedNoteSet;null!=t&&this.document.entryAfterSelection&&t.measure.index==this.score.numMeasures-1&&Math.round(t.position+t.duration)==Math.round(t.measure.duration)&&this.score.insertBlankMeasureAt(this.score.numMeasures)}},{key:"restoreClipboard",value:function(){try{var t=Vd.getLocalStorage(),i=A.unknownToString(t.getItem(e.LOCAL_STORAGE_KEY)),n=A.unknownToType(i,q),r=n.attribute("className");if(r==ti.EXTERNAL_CLASSNAME)this._clipboard=new ti;else{if(r!=ri.EXTERNAL_CLASSNAME)throw new Error("Clipboard class "+r+" not found...");this._clipboard=new ri}this._clipboard.fromXML(n)}catch(t){if(!A.is(t,Object))throw t;A.as(t,Object)}}},{key:"saveClipboard",value:function(){this._clipboard=this._document.selection.createClipboard();try{var t=0!=(this._document.permissions&ei.SAVE_COPY_PERMISSION),i=0!=(this._document.permissions&ei.EXPORT_PERMISSION),n=this._clipboard&&A.is(this._clipboard,Ze);if(t&&n){var r=Vd.getLocalStorage();if(i){var o=this._clipboard.toXML().toXMLString();r.setItem(e.LOCAL_STORAGE_KEY,o)}else r.removeItem(e.LOCAL_STORAGE_KEY)}}catch(t){if(!A.is(t,Object))throw t;A.as(t,Object)}}},{key:"nudgeSelection",value:function(t){this.checkEditMarkingPermission()&&this.ensureSelection()&&this.applyToNonNotes(function(e,i){switch(t){case he.DIRECTION_LEFT:i.dx=.5*Math.round(2*i.dx-1);break;case he.DIRECTION_RIGHT:i.dx=.5*Math.round(2*i.dx+1);break;case he.DIRECTION_UP:i.dy=.5*Math.round(2*i.dy+1);break;case he.DIRECTION_DOWN:i.dy=.5*Math.round(2*i.dy-1)}})}},{key:"adjustEffect",value:function(t,e){Math.sign(t.shift);var i=xn.PLACEMENT_BY_TYPE[t.type],n=this.score.staffMetrics.effectAdjustDelta,r=0;switch(e){case he.DIRECTION_LEFT:r=Math.round(2*t.shift-1)*n,i==xn.PRE_EFFECT?t.shift=r:t.shift=Math.max(0,r);break;case he.DIRECTION_RIGHT:r=Math.round(2*t.shift+1)*n,i==xn.POST_EFFECT?t.shift=r:t.shift=Math.min(0,r);break;case he.DIRECTION_UP:t.ascent=Math.round(2*t.ascent-1)*n;break;case he.DIRECTION_DOWN:t.ascent=Math.round(2*t.ascent+1)*n}}},{key:"setScoreProperty",value:function(t,e){if(this.score.setModelProperty(t,e),"transposeParts"==t){var i=!0,n=!1,r=void 0;try{for(var o,s=this.score.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);l.part.transposingInterval.unison||this.defaultTransposableSpans(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}},{key:"defaultTransposableSpans",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t.measures[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.defaultTransposableSpans()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"getScoreProperty",value:function(t){return this.score.getModelProperty(t)}},{key:"setPartProperty",value:function(t,e,i){if(t.setModelProperty(e,i),"transposition"==e||"octaveShift"==e){var n=!0,r=!1,o=void 0;try{for(var s,a=t.staves[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,h=!1,c=void 0;try{for(var d,f=l.measures[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){d.value.defaultTransposableSpans()}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}},{key:"getClipboardSO",value:function(){return Qf.getLocal("noteflight.clipboard","/")}},{key:"requestPrintScore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.dispatchEvent(new ci(ci.PRINT_SCORE,t))}},{key:"logToAnalytics",value:function(t,e){this.dispatchEvent(new _i(_i.LOG_ANALYTICS,t,e))}},{key:"transpose",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=[],l=0;l<this._document.score.parts.length;l++)a.push(t);this.transposeParts(a,t,e,i,n,r,o,s)}},{key:"transposeParts",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=this.isPlaying,u=l?this.performer.position:null,h=this,c=function(){h._document.score.transposeParts=!0,h._document.score.effectiveStaffMetrics.ignoreStemDirection=n,h._document.score.effectiveStaffMetrics.ignoreSlurDirection=r;for(var c=0;c<h._document.score.parts.length;c++)if(t&&A.is(t[c],Number)){var d=h._document.score.parts[c];d.alternateKey=o,h.setPartProperty(d,"transposition",-t[c]),h.setPartProperty(d,"hideChordSymbols",s),h.setPartProperty(d,"hideFretboards",a)}if(h.performer.pitchAdjustment=e,h.dispatchEvent(new Si(Si.PARTS_TRANSPOSED)),l&&i&&u){var f=new By(100,1),y=u;f.addEventListener(Nf.TIMER,function(t){h.playFromMeasure(y.measureIndex)}),f.start()}};if(l){this.stop();var d=new By(100,1);d.addEventListener(Nf.TIMER,function(t){c()}),d.start()}else c();this.dispatchMajorNotationAction()}},{key:"toggleShowAudioWaveform",value:function(t){t.showAudioWaveform=!t.showAudioWaveform}},{key:"toggleAudioWaveforms",value:function(){this.score.audioWaveformsShown||this.dispatchEvent(new en(en.WAVEFORMS_LOADING)),this.score.toggleAudioWaveforms()}},{key:"clipsCanBeOverwritten",value:function(t,e,i){this.performer.temporalMap||this.renderFullTemporalMap();var n=this.performer.temporalMap.measureIndexToTime(i.measureIndex),r=t.getRecordedAudioTracksByUser(e),o=!0,s=!1,a=void 0;try{for(var l,u=r[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(A.unknownToType(h,wl).hasClipsAfterTime(n))return!0}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return!1}},{key:"entryExistsForMeasureIndex",value:function(t){return!this.score.synchronizedTrack||this.performer.entryExistsForMeasureIndex(t)}},{key:"togglePartVisibility",value:function(t){this.score.totalParts>t&&(this.score.parts[t].visible=!this.score.parts[t].visible)}},{key:"showPartsOnly",value:function(t){for(var e=this.score.parts,i=0;i<e.length;i++)e[i].visible=t.includes(e[i])}},{key:"showAllParts",value:function(){this.showPartsOnly(this.score.parts)}},{key:"printTimingStats",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];jd.printTimingStats(t)}},{key:"_addTextBlockToMeasure",value:function(t,e){var i=this.score.effectiveStaffMetrics.blockColumnWeight,n=new xa(Ou.getString("editor/placeholder.textBlock"),i,e),r=new wa;return r.addColumn(n),t.addBlock(r),r}},{key:"addTextBlock",value:function(t){if(this.selection){var e,i=this.selection.selectedMeasures;e=t==wa.BEFORE_SYSTEM?i.startIndex:i.endIndex-1;var n=this.selection.selectedRange,r=new Ia(e),o=this.document.layoutContext.scoreLayout.chunkIndexOfElementIdentifier(r),s=0;if(t==wa.BEFORE_SYSTEM){if(0===o)return;s=this.document.layoutContext.scoreLayout.chunks[o].startPosition.measureIndex}else s=this.document.layoutContext.scoreLayout.chunks[o].endPosition.measureIndex;var a=n.staves[0].getMeasureAt(s).systemMeasure,l=null;return l=t==wa.BEFORE_SYSTEM?xa.POSITION_BEFORE_SYSTEM:xa.POSITION_AFTER_SYSTEM,this._addTextBlockToMeasure(a,l)}}},{key:"applyScoreEdit",value:function(t){var e=new xg(this.document),i=JSON.parse(t),n=cg.fromJson(i);e.applyScoreEdit(n)}},{key:"applyScoreEdits",value:function(t){var e=new xg(this.document),i=JSON.parse(t),n=!0,r=!1,o=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=cg.fromJson(l);e.applyScoreEdit(u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"dispatchTipEvent",value:function(t){this.dispatchEvent(new mt(t))}},{key:"isPaused",get:function(){return this._$isPaused},set:function(t){var e=this._$isPaused;this._$isPaused=t,e!==t&&this._propertyChanged("isPaused",e,t)}},{key:"isAboutToPlay",get:function(){return this._$isAboutToPlay},set:function(t){var e=this._$isAboutToPlay;this._$isAboutToPlay=t,e!==t&&this._propertyChanged("isAboutToPlay",e,t)}},{key:"score",get:function(){return this._document.score}},{key:"clipboard",get:function(){return this._clipboard}},{key:"performer",get:function(){return this._performer},set:function(t){this._performer&&this._removePerformerEvents(),this._performer=t,this.dispatchEvent(new Si(Si.PERFORMER_CHANGE)),this._createPerformerEvents()}},{key:"isPlaying",get:function(){return this._performer&&null!=this._performer.player}},{key:"transcriber",get:function(){return this._transcriber}},{key:"pausePosition",set:function(t){this._pausePosition=t},get:function(){return this._pausePosition}},{key:"viewer",get:function(){return this._viewer},set:function(t){this._viewer=t}},{key:"partToHighlight",get:function(){return this._partToHighlight}},{key:"musicFont",set:function(t){this.checkEditPermission()&&0!=(this._document.permissions&ei.SELECT_FONT_PERMISSION)&&this.score.effectiveStaffMetrics.setMusicFont(t)},get:function(){return this.score.effectiveStaffMetrics.musicFont}},{key:"isPerformanceMode",get:function(){return null!=this.performanceMode}},{key:"speedAdjustment",get:function(){return this.performer.speedAdjustment},set:function(t){this.performer.speedAdjustment=t,this.restartPlayback(),this.dispatchMajorNotationAction()}},{key:"selection",get:function(){return this._document.selection}},{key:"isMidiRecording",get:function(){return this._isMidiRecording}},{key:"document",get:function(){return this._document},set:function(t){null!=this._document&&(this._document.removeEventListener(Gi.ADD_SELECTION,xt.bindMethod(this,this.handleSelectEvent)),this._document.removeEventListener(Gi.REMOVE_SELECTION,xt.bindMethod(this,this.handleSelectEvent))),this._document=t,null!=this._document&&(this._document.addEventListener(Gi.ADD_SELECTION,xt.bindMethod(this,this.handleSelectEvent),!1,0,!0),this._document.addEventListener(Gi.REMOVE_SELECTION,xt.bindMethod(this,this.handleSelectEvent),!1,0,!0)),this.dispatchEvent(new Si(Si.DOCUMENT_CHANGE))}},{key:"implicitMeasureSelection",get:function(){return null==this.selection?new Ke(this.score,0,this.score.numMeasures):this.selection.selectedMeasures}},{key:"implicitRangeSelection",get:function(){return null==this.selection?new Ke(this.score,0,this.score.numMeasures).selectedRange:this.selection.selectedRange}},{key:"temporalMapOffset",get:function(){return this.performer.temporalMap?this.performer.temporalMap.offset:0}},{key:"lastMeasureIndexWithEntry",get:function(){return this.score.getSystemStaffMeasureAt(this.performer.lastMeasureIndexWithEntry).measureNumber}},{key:"selectedNotations",get:function(){return null!=this.selection?this.selection.selectedNotations():[]}},{key:"selectedParts",get:function(){if(!this.selection)return null;for(var t=[],e=this.selection.selectedRange.staves,i=0;i<e.length;i++)-1==t.indexOf(e[i].part)&&t.push(e[i].part);return t}},{key:"selectedPart",get:function(){if(!this.selection)return null;var t=this.selectedParts;return null==t?null:A.unknownToType(t[0],El)}},{key:"timeSignatureSelection",get:function(){if(A.is(this.selection,qe)){var t=A.as(this.selection,qe);if(1==t.selectedObjects.length&&A.is(t.selectedObjects[0],zl)){for(var e=A.as(t.selectedObjects[0],zl),i=A.intToUint(e.measure.index),n=A.intToUint(i+1);n<this.score.numMeasures&&this.score.systemStaff.getMeasureAt(n).timeSignature.equals(e);)n++;return new Ke(this.score,i,n)}}return this.implicitMeasureSelection}},{key:"clefSelection",get:function(){if(A.is(this.selection,qe)){var t=A.as(this.selection,qe);if(1==t.selectedObjects.length&&A.is(t.selectedObjects[0],Mn)){for(var e=A.as(t.selectedObjects[0],he),i=e,n=new gl(A.intToUint(e.measure.index),e.position),r=new gl(A.intToUint(this.score.numMeasures-1),this.score.systemStaff.getMeasureAt(A.intToUint(this.score.numMeasures-1)).duration),o=function(t){return A.is(t,Mn)};null!=e;)if(e=e.measure.nextNotation(e.position,o,!0),A.is(e,Mn)){r=new gl(A.intToUint(e.measure.index),e.position);break}return new Je(this.score,n,r,[i.measure.staff])}}return this.implicitRangeSelection}},{key:"keySignatureSelection",get:function(){if(A.is(this.selection,qe)){var t=A.as(this.selection,qe);if(1==t.selectedObjects.length&&A.is(t.selectedObjects[0],Ga)){for(var e=A.as(t.selectedObjects[0],Ga),i=A.intToUint(e.measure.index+1),n=A.intToUint(i+1);n<this.score.numMeasures&&this.score.systemStaff.getMeasureAt(n).keySignature.equals(e);)n++;return new Ke(this.score,i,n)}}return this.implicitMeasureSelection}},{key:"getFirstPartPageOrientation",get:function(){return this.score.parts[0].pageMetrics?this.score.parts[0].pageMetrics.orientation:this.score.pageMetrics.orientation}},{key:"disableNotationInteraction",set:function(t){this._disableNotationInteraction=t},get:function(){return this._disableNotationInteraction}},{key:"hasAudibleStaves",get:function(){return this.score.audibleStaves.length>0}},{key:"openingKeySignature",get:function(){return"".concat(this.score.initialKey.tonic,"/").concat(this.score.initialKey.mode)}},{key:"masterGain",get:function(){return this.score.mix.masterGain},set:function(t){this.masterGain!=t&&(this.document.undoHistory.openGroup("Change Master Gain"),this.score.mix.masterGain=t)}},{key:"reverbType",get:function(){return this.score.mix.reverbType},set:function(t){this.reverbType!=t&&(this.document.undoHistory.openGroup("Change Reverb Type"),this.score.mix.reverbType=t)}},{key:"reverbLevel",get:function(){return this.score.mix.reverbLevel},set:function(t){this.reverbLevel!=t&&(this.document.undoHistory.openGroup("Change Reverb Level"),this.score.mix.reverbLevel=t)}},{key:"synchronizedTrackMuted",get:function(){return!!this.score.synchronizedTrack&&this.score.synchronizedTrack.muted},set:function(t){this.score.synchronizedTrack&&(this.score.createDraftSynchronizedTrack(),this.score.draftSynchronizedTrack.muted=t,this.score.saveDraftSynchronizedTrack(),this.dispatchEvent(new ci(ci.MAJOR_NOTATION_CHANGE)))}},{key:"synchronizedTrackGain",get:function(){return!!this.score.synchronizedTrack&&this.score.synchronizedTrack.gain},set:function(t){this.score.synchronizedTrack&&(this.score.createDraftSynchronizedTrack(),this.score.draftSynchronizedTrack.gain=t,this.score.saveDraftSynchronizedTrack())}}],[{key:"stavesText",value:function(t){return 0===t?"no staves":1==t?"1 staff":t.toString()+" staves"}}]),e}();r.implementsInterfaces(Le,[Xt]);var ke="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Te=[de.NORMAL_NOTE_HEAD,de.STEMLESS_NOTE_HEAD,de.SLASH_NOTE_HEAD,de.HIT_NOTE_HEAD,de.CROSS_NOTE_HEAD,de.SQUARE_NOTE_HEAD,de.DIAMOND_NOTE_HEAD,de.TRIANGLE_NOTE_HEAD,de.HARMONIC_NOTE_HEAD,de.CROSS_CIRCLE_NOTE_HEAD];r.registerClass(Le,"com.noteflight.notation.controller.ScoreController");var Ee=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._controller=null,n._documentView=null,n._performer=null,n._$isPartDisplayPopupVisible=!1,n._$isMixerPopupVisible=!1,n._$isAudioTrackVisible=!1,n._$enableNotationInPlayback=!1,n._$resetScrollPositionOnLoad=!1,n._totalPagesToPrint=-1,n._waveformController=null,n._playedOnce=!1,n._controller=t,n._documentView=i,n._waveformController=new He(u(u(n))),n}return c(e,At),p(e,[{key:"startPlaybackWhenReady",value:function(t){var e=this;this._controller.setIsAboutToPlayValue(!0);this._documentView.scoreView.isIncrementalFlowComplete||this._controller.document.editable&&this._playedOnce?(this._controller.setPerformanceMode("play"),e._controller.setIsAboutToPlayValue(!1),t()):(this._playedOnce=!0,this.documentView.scoreView.addEventListener(ct.COMPLETE,function i(n){e.documentView.scoreView.removeEventListener(ct.COMPLETE,i),t(),e._controller.setIsAboutToPlayValue(!1)}),this._controller.setPerformanceMode("play",!0))}},{key:"editTimeSignature",value:function(){this.controller.showEditTimeSignatureDialog()}},{key:"editKeySignature",value:function(){this.controller.showEditKeySignatureDialog()}},{key:"editClef",value:function(){}},{key:"addChordSymbol",value:function(){var t=A.as(this.scoreDocument.firstSelectedNotation(Aa),Aa);if(null==t){var e=this.scoreDocument.firstSelectedNoteSet;if(null!=e)return t=A.as(e.measure.notationAtPosition(e.position,Aa),Aa),this.scoreDocument.undoHistory.openGroup("Add Text"),this.controller.selectNotation(e),void hh.addChordSymbol(this._documentView.viewContext,e.measure,e.position,t)}null!=t&&(this.scoreDocument.undoHistory.openGroup("Edit Text"),t.dispatchEvent(new Fi(Fi.EDIT)))}},{key:"addRepeatEnding",value:function(t){this.scoreDocument.undoHistory.openGroup("New Repeat Ending");var e=this.controller.addRepeatEnding(t);e&&kh.addRepeatEnding(this.documentView.viewContext,e)}},{key:"addExpression",value:function(){var t=A.as(this.scoreDocument.firstSelectedNotation(Ra),Ra);if(null==t&&null!=this.scoreDocument.selection){var e=this.scoreDocument.selection.selectedRange,i=e.staves[0].getMeasureAt(e.start.measureIndex);this.scoreDocument.undoHistory.openGroup("Add Dynamics/Expression"),t=A.as(i.notationAtPosition(e.start.position,Ra),Ra);var n=0;i.staff.part.directionsAboveStaff&&(n=this.controller.score.effectiveStaffMetrics.expressionTextTopPadding);var r=i.previousNotation(e.start.position,function(t){return A.is(t,Ra)},!0);null==r||null!=t&&r.dy==t.dy?null!=t&&(n=t.dy+this.controller.score.effectiveStaffMetrics.expressionTextSpacing):n=r.dy,fh.addExpressionText(this._documentView.viewContext,i,e.start.position,n)}else null!=t&&(this.scoreDocument.undoHistory.openGroup("Edit Dynamics/Expression"),t.dispatchEvent(new Fi(Fi.EDIT)))}},{key:"addPerformance",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=A.as(this.scoreDocument.firstSelectedNotation(bl),bl);if(null==i&&null!=this.scoreDocument.selection){var n=this.scoreDocument.selection.selectedRange,r=n.staves[0].getMeasureAt(n.start.measureIndex);t&&(r=r.systemMeasure),this.scoreDocument.undoHistory.openGroup(t?"Add System Text":"Add Performance Text"),i=A.as(r.notationAtPosition(n.start.position,bl),bl);var o=0,s=r.previousNotation(n.start.position,function(t){return A.is(t,bl)},!0);null==s||null!=i&&s.dy==i.dy?null!=i&&(o=i.dy+this.controller.score.effectiveStaffMetrics.performanceTextSpacing):o=s.dy,nc.addPerformanceText(this._documentView.viewContext,r,n.start.position,o,e)}else null!=i&&(this.scoreDocument.undoHistory.openGroup(t?"Edit System Text":"Edit Performance Text"),i.dispatchEvent(new Fi(Fi.EDIT)))}},{key:"addLyric",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=A.as(this.scoreDocument.firstSelectedNotation(ul),ul);if(null==i||i.line!=t){var n=this.scoreDocument.firstSelectedNoteSet;null==n||A.is(n,Gl)||null==(i=n.getLyricAtLine(t))&&(this.scoreDocument.undoHistory.openGroup("Add Lyrics"),this.controller.selectNotation(n),Mh.addLyric(this._documentView.viewContext,n,t,e))}null!=i&&i.dispatchEvent(new Fi(Fi.EDIT))}},{key:"addPrompt",value:function(){this.scoreDocument.undoHistory.openGroup("Add Prompt"),this.scoreDocument.score.prompt=""}},{key:"removePrompt",value:function(){this.scoreDocument.undoHistory.openGroup("Remove Prompt"),this.scoreDocument.score.prompt=null}},{key:"addSupertitle",value:function(){this.scoreDocument.undoHistory.openGroup("Add Supertitle"),this.scoreDocument.score.supertitle=""}},{key:"removeSupertitle",value:function(){this.scoreDocument.undoHistory.openGroup("Remove Supertitle"),this.scoreDocument.score.supertitle=null}},{key:"togglePartMix",value:function(){this.showPartMix(!this.isMixerPopupVisible)}},{key:"showPartMix",value:function(t){this.isMixerPopupVisible=t,t&&(this.isPartDisplayPopupVisible=!1,this.isAudioTrackVisible=!1)}},{key:"toggleAudioTrack",value:function(){this.showAudioTrack(!this.isAudioTrackVisible)}},{key:"showAudioTrack",value:function(t){this.isAudioTrackVisible=t,t&&(this.isMixerPopupVisible=!1,this.isPartDisplayPopupVisible=!1)}},{key:"editAnnotation",value:function(t){this._documentView.editAnnotation(t),this.dispatchEvent(new Ri(Ri.EDIT_ANNOTATION,null,t,null,-1))}},{key:"dumpXml",value:function(){X.trace(new cr(this.scoreDocument.score).xml.toXMLString())}},{key:"asyncGetPartwisePageViews",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._documentView.scoreDocument.score,n=[],r=0,o=i.visibleParts;this._controller.showAllParts();var s=i.effectiveStaffMetrics.lineSpacing,a=this,l=function(){var e=i.parts[r];e?(r+=1,a.asyncGetPageViews(u,e)):(i.effectiveStaffMetrics.lineSpacing=s,a._controller.showPartsOnly(o),i.useIndividualPartInfo=null,t(n))},u=function(t){n=n.concat(t),l()};e?a.asyncGetPageViews(u):l()}},{key:"createPrintPaginatedLayout",value:function(t,e){return new Es(t,e)}},{key:"asyncGetPageViews",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this._documentView.createLayoutContext(this.scoreDocument.score);i.pageMetrics=this.getPrintPageMetrics(),this.scoreDocument.score.useIndividualPartInfo=e,this.scoreDocument.recalculateLineSpacing(),this._documentView.createFoundryForContext(i);var n=this.createPrintPaginatedLayout(i,!1);n.document=new ei(this.scoreDocument.score,this.scoreDocument.permissions,this.scoreDocument.author);var r=this;n.asyncValidateLayout(function(){t(r.getPrintViews(i,n))})}},{key:"getPrintViews",value:function(t,e){var i=this._documentView.viewInfo.clone();i.displayScale=1,i.printView=!0,i.scoreDropShadowEnabled=!1;var n=new Ec(i,t,null,null,null,null,null,A.booleanToString(!1),{fakeView:!0}),r=A.as(e.createDisplayObject(n),ec).pageViews;return this._totalPagesToPrint=r.length,r}},{key:"getPrintPageMetrics",value:function(){return this.scoreDocument.score.effectivePageMetrics}},{key:"handlePerformerProgress",value:function(t){this._documentView.enableNotationViews(this.enableNotationInPlayback),this._documentView.scrollToPosition(this._performer.position,!0,this._performer)}},{key:"handlePerformerStop",value:function(t){this._documentView.enableNotationViews(!0),this._documentView.hidePositionCursor()}},{key:"showPositionCursor",value:function(t){this._documentView.showPositionCursor(t)}},{key:"hidePositionCursor",value:function(){this._documentView.hidePositionCursor()}},{key:"ensureSelectionVisible",value:function(){this._documentView.ensureSelectionVisible()}},{key:"scrollToBeginning",value:function(){this._documentView.scrollToPosition(gl.MIN_POSITION,!1)}},{key:"handleScoreReady",value:function(t){this.resetScrollPositionOnLoad&&this._documentView.resetScrollPosition()}},{key:"isPartDisplayPopupVisible",get:function(){return this._$isPartDisplayPopupVisible},set:function(t){var e=this._$isPartDisplayPopupVisible;this._$isPartDisplayPopupVisible=t,e!==t&&this._propertyChanged("isPartDisplayPopupVisible",e,t)}},{key:"isMixerPopupVisible",get:function(){return this._$isMixerPopupVisible},set:function(t){var e=this._$isMixerPopupVisible;this._$isMixerPopupVisible=t,e!==t&&this._propertyChanged("isMixerPopupVisible",e,t)}},{key:"isAudioTrackVisible",get:function(){return this._$isAudioTrackVisible},set:function(t){var e=this._$isAudioTrackVisible;this._$isAudioTrackVisible=t,e!==t&&this._propertyChanged("isAudioTrackVisible",e,t)}},{key:"enableNotationInPlayback",get:function(){return this._$enableNotationInPlayback},set:function(t){var e=this._$enableNotationInPlayback;this._$enableNotationInPlayback=t,e!==t&&this._propertyChanged("enableNotationInPlayback",e,t)}},{key:"resetScrollPositionOnLoad",get:function(){return this._$resetScrollPositionOnLoad},set:function(t){var e=this._$resetScrollPositionOnLoad;this._$resetScrollPositionOnLoad=t,e!==t&&this._propertyChanged("resetScrollPositionOnLoad",e,t)}},{key:"controller",get:function(){return this._controller}},{key:"waveformController",get:function(){return this._waveformController}},{key:"documentView",get:function(){return this._documentView}},{key:"scoreDocument",get:function(){return this._controller.document}},{key:"performer",get:function(){return this._performer},set:function(t){this._performer=t,this._performer.addEventListener(dt.PROGRESS,xt.bindMethod(this,this.handlePerformerProgress)),this._performer.addEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handlePerformerStop)),this._controller.performer=t}},{key:"scrolling",set:function(t){this._documentView.scrolling=t},get:function(){return this._documentView.scrolling}}]),e}();r.registerClass(Ee,"com.noteflight.notation.controller.ScoreDocumentController");var Me=function(){function t(){y(this,t),this._view=null,this._drag=!1,this._lastClickMillis=0}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,tc),this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.addEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),this._view.removeEventListener(li.MOUSE_MOVE,xt.bindMethod(this,this.handleMouseMove)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleMouseDown",value:function(t){this._drag=!1,this._view.context.document.undoHistory.openGroup("Clear Selection"),this._view.context.controller.clearSelection(),Xh.clearLastRolled(),t.stopPropagation()}},{key:"handleMouseMove",value:function(t){this._drag=!0}},{key:"handleClick",value:function(t){var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;this._lastClickMillis=e,!this._drag&&t.target==this._view&&this._view.context.controller.isNotationInteractionAvailable()?(this._view.context.document.undoHistory.openGroup("Clear Selection"),this._view.context.controller.clearSelection(),this._view.context.controller.stop(),this._view.context.controller.dispatchEvent(new ci(ci.EDITOR_CLICK)),Xh.clearLastRolled(),this._view.context.documentView.setFocus(),t.stopPropagation()):i&&!this._view.context.controller.isNotationInteractionAvailable()&&this._view.context.controller.forceStop()}}]),t}();r.implementsInterfaces(Me,[Ct]),r.registerClass(Me,"com.noteflight.notation.controller.ScoreMediator");var be=function(){function t(){y(this,t),this._view=null,this._mouseDownSeen=!1,this._lastClickMillis=0}return p(t,[{key:"handleViewEvents",value:function(t){throw new Error("Not implemented")}},{key:"addListeners",value:function(){this._view&&(this._view.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),null!=this._view.notation&&this._view.notation.addEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),null!=this._view.notation&&this._view.notation.removeEventListener(Fi.NOTATION_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}},{key:"handleMouseDown",value:function(t){throw new Error("Not implemented")}},{key:"handleClick",value:function(t){if(!this._mouseDownSeen&&this._view.notation.enabled){var e=this._view.notation;this._view.context.document.undoHistory.openGroup("Select Notation"),this._view.context.controller.selectNotation(e),t.stopPropagation(),this._view.context.documentView.setFocus()}}}]),t}();r.implementsInterfaces(be,[Ct]),r.registerClass(be,"com.noteflight.notation.controller.ObjectMediator");var we=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return y(this,e),(i=l(this,h(e).call(this,t))).position=null,i._quantum=n,i._staff=r,i._positioningOptions=o||{},i.clickDelta=new If(0,0),i}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.stage.addEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)),this.context.documentView.initializeDragAutoScroll()}},{key:"handleMouseUp",value:function(t){s(h(e.prototype),"handleMouseUp",this).call(this,t),this.context.stage.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleDragMove",value:function(t){this.updatePosition(t)}},{key:"handleEnterFrame",value:function(t){this.context.documentView.handleDragAutoScroll()}},{key:"updatePosition",value:function(t){var e=this._staff;null!=e&&e.isSystemStaff&&(e=A.unknownToType(e.score.visibleStaves[0],Rl));var i=this.context.documentView.getPositionUnderPoint(this.context,new If(this.context.stage.mouseX,this.context.stage.mouseY).subtract(this.clickDelta),this._quantum,e,this._positioningOptions);null!=i&&(this.position=i,null!=e&&(this.context.controller.document.dragHighlight=new Je(this.context.controller.score,this.position,this.position,[e])),this.positionChanged(),this.dispatchEvent(new ct(ct.CHANGE)))}},{key:"positionChanged",value:function(){}},{key:"handleDragEnd",value:function(t){this.context.controller.document.dragHighlight=null,s(h(e.prototype),"handleDragEnd",this).call(this,t)}}]),e}();r.registerClass(we,"com.noteflight.notation.controller.ScorePositionDragMediator");var xe=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t)))._slur=null,o._type=null,o._start=null,o._slur=i,o._type=n,o._start=r,o}return c(e,Qt),p(e,null,[{key:"LEFT_CONTROL",get:function(){return"c1"}},{key:"RIGHT_CONTROL",get:function(){return"c2"}}]),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.document.undoHistory.openGroup("Drag Control Point")}},{key:"handleDragMove",value:function(t){var i=this.dragDelta;switch(this._type){case e.LEFT_CONTROL:this._slur.cx1=this._start.x+i.x/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.cy1=this._start.y-i.y/this.context.layoutContext.staffMetrics.lineSpacing;break;case e.RIGHT_CONTROL:this._slur.cx2=this._start.x+i.x/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.cy2=this._start.y-i.y/this.context.layoutContext.staffMetrics.lineSpacing}}},{key:"handleDragEnd",value:function(t){s(h(e.prototype),"handleDragEnd",this).call(this,t),this._slur.requestValidation()}}]),e}();r.registerClass(xe,"com.noteflight.notation.controller.SlurControlPointMediator");var Ce=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t)))._slur=null,o._start1=null,o._start2=null,o._slur=i,o._start1=n,o._start2=r,o}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.document.undoHistory.openGroup("Drag Control Point")}},{key:"handleDragMove",value:function(t){var e=this.dragDelta;this._slur.cx1=this._start1.x+e.x/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.cy1=this._start1.y-e.y/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.cx2=this._start2.x+e.x/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.cy2=this._start2.y-e.y/this.context.layoutContext.staffMetrics.lineSpacing,this._slur.direction=this._slur.cy1+this._slur.cy2>0?he.DIRECTION_UP:he.DIRECTION_DOWN}},{key:"handleDragEnd",value:function(t){s(h(e.prototype),"handleDragEnd",this).call(this,t),this._slur.requestValidation()}}]),e}();r.registerClass(Ce,"com.noteflight.notation.controller.SlurMidPointMediator");var Ne=function(t){function e(t,i){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return y(this,e),(n=l(this,h(e).call(this,t,i.measure.timeSignature.beatDuration,i.measure.staff,{horizontalAlign:"noBarline"})))._notation=null,n._allowVertical=!1,n._notation=i,n._allowVertical=r,n}return c(e,we),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.document.undoHistory.openGroup("Drag End Point")}},{key:"handleDragEnd",value:function(t){s(h(e.prototype),"handleDragEnd",this).call(this,t),this._notation.requestValidation()}},{key:"positionChanged",value:function(){this._notation.span=Math.max(1,this.context.controller.score.rangeDuration(this._notation.measurePosition,this.position)),this._allowVertical&&(this._notation.ascent=this.position.dy-this._notation.dy),this._notation.endx=this.position.dx}}]),e}();r.registerClass(Ne,"com.noteflight.notation.controller.SpanEndDragMediator");var Ae=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,be),p(e,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,gh),this.addListeners()}},{key:"handleMouseDown",value:function(t){this._mouseDownSeen=!0;var e=X.flash_utils_getTimer(),i=e-this._lastClickMillis<=this._view.context.info.doubleClickMillis;if(this._lastClickMillis=e,this._view.notation.enabled){var n=this._view.notation,r=this._view.context.controller.document.isModelEditable(n);if(r&&!(i||t.shiftKey||t.ctrlKey)&&n.movable&&(Ky.removeAllCursors(),new De(this._view.context,n,"Move").handleMouseDown(t),Ky.setCursor(Qt.moveNESWCursor)),this._view.context.document.undoHistory.openGroup("Select Notation"),t.ctrlKey||t.shiftKey)this._view.context.controller.modifyNotationSelection(n);else if(A.is(n,ll)){if(this._view.context.controller.selectNotation(n),r&&i)return this._view.editText(),void t.stopPropagation()}else null!=this._view.context.document.selection&&this._view.context.document.selection.includes(n)||this._view.context.controller.selectNotation(n);t.stopPropagation(),this._view.context.documentView.setFocus()}}}]),e}();r.registerClass(Ae,"com.noteflight.notation.controller.SpanNotationMediator");var Ie=function(t){function e(t,i){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return y(this,e),(n=l(this,h(e).call(this,t,i.measure.timeSignature.beatDuration,i.measure.staff,ts.spanStartPosOptions(i))))._notation=null,n._allowVertical=!1,n._originalPosition=null,n._originalSpan=NaN,n._originalDx=NaN,n._originalDy=NaN,n._originalAscent=NaN,n._lastPosition=null,n._notation=i,n._allowVertical=r,n}return c(e,we),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.context.document.undoHistory.openGroup("Drag Start Point"),this._originalPosition=this._notation.measurePosition,this._originalSpan=this._notation.span,this._originalDx=this._notation.dx,this._originalDy=this._notation.dy,this._originalAscent=this._notation.ascent,this._notation.excludeFromPositioning=!0}},{key:"handleMouseUp",value:function(t){this._notation.excludeFromPositioning=!1,s(h(e.prototype),"handleMouseUp",this).call(this,t)}},{key:"positionChanged",value:function(){if(!(this.position.compareTo(this._notation.endPosition)>0)){if(null!=this._lastPosition&&0!==this.position.compareTo(this._lastPosition)){var t=this._notation.measure.staff;this._notation.rhythmPosition=A.numberToUint(this.position.position),this._notation.span=this._originalSpan-t.score.rangeDuration(this._originalPosition,this.position),this._notation.measure.removeElement(this._notation),t.getMeasureAt(this.position.measureIndex).addElement(this._notation,this._notation.lastVoiceNumber),this.context.controller.selectNotation(this._notation)}this._lastPosition=this.position,this._notation.dx=this.position.dx,this._notation.dy=this.position.dy,this._allowVertical&&(this._notation.ascent=this._originalAscent-(this._notation.dy-this._originalDy))}}},{key:"handleDragEnd",value:function(t){this._notation.excludeFromPositioning=!1,this._notation.requestValidation(),s(h(e.prototype),"handleDragEnd",this).call(this,t)}}]),e}();r.registerClass(Ie,"com.noteflight.notation.controller.SpanStartDragMediator");var Pe=function(){function t(){y(this,t),this._view=null}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,mc),this._view.addEventListener(Xi.PART_EDIT,xt.bindMethod(this,this.handlePartEdit)),null!=this._view.staff&&this._view.staff.addEventListener(Fi.STAFF_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange))}},{key:"removeListeners",value:function(){this._view&&(this._view.removeEventListener(Xi.PART_EDIT,xt.bindMethod(this,this.handlePartEdit)),null!=this._view.staff&&this._view.staff.removeEventListener(Fi.STAFF_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handlePartEdit",value:function(t){switch(t.kind){case Xi.SELECT:this._view.context.document.undoHistory.openGroup("Select Part"),this._view.context.controller.selectStaff(t.staff),this._view.context.documentView.setFocus();break;case Xi.ADD_TO_SELECTION:this._view.context.document.undoHistory.openGroup("Select Part"),this._view.context.controller.extendRangeToStaff(t.staff),this._view.context.documentView.setFocus()}}},{key:"handleStatusChange",value:function(t){this._view.wholeStaffSelected(t.startMeasureIndex,t.endMeasureIndex)&&this._view.updateStatus()}}]),t}();r.implementsInterfaces(Pe,[Ct]),r.registerClass(Pe,"com.noteflight.notation.controller.StaffHandleMediator");var Oe=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t.context,t.notation.measure.timeSignature.beatDuration,t.notation.measure.staff,n)))._view=t,i._lastPosition=null,i}return c(e,we),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this.clickDelta=new If((this._view.mouseX-this._view.notation.dx*this.context.layoutContext.staffMetrics.lineSpacing)*this.context.info.displayScale,(this._view.mouseY+(this._view.notation.dy-this._view.layout.padding.bottom)*this.context.layoutContext.staffMetrics.lineSpacing)*this.context.info.displayScale),this._view.notation.excludeFromPositioning=!0,this._view.notation.handleDraggingStart()}},{key:"handleMouseUp",value:function(t){this._view.notation.excludeFromPositioning=!1,s(h(e.prototype),"handleMouseUp",this).call(this,t)}},{key:"positionChanged",value:function(){var t=this._view.notation;if(null==this._lastPosition)this.context.document.undoHistory.openGroup("Drag Object");else if(0!==this.position.compareTo(this._lastPosition)){var e=t.measure.staff;t.rhythmPosition=A.numberToUint(this.position.position),t.measure.removeElement(t),e.getMeasureAt(this.position.measureIndex).addElement(t,t.lastVoiceNumber),this.context.controller.selectNotation(t)}this._lastPosition=this.position,t.dx=this.position.dx,t.dy=this.position.dy+this._view.layout.padding.bottom}},{key:"handleDragEnd",value:function(t){var i=this;this._view.notation.excludeFromPositioning=!1,this._view.notation.dy--,this._view.notation.dy++,s(h(e.prototype),"handleDragEnd",this).call(this,t),this._view.notation.handleDraggingEnd(function(){i.context.controller.dispatchTipEvent(mt.REPOSITIONED_SYSTEM_TEXT)})}}]),e}();r.registerClass(Oe,"com.noteflight.notation.controller.SymbolDragMediator");var Qe=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};y(this,t),this.notation=e,this.viewId=i,this._$dx=null,this._$dy=null,this._$color=null,this.updateOptions(n)}return p(t,[{key:"updateOptions",value:function(t){t.dx&&(this.dx=t.dx),t.dy&&(this.dy=t.dy),t.color&&(this.color=t.color)}},{key:"dx",get:function(){return this._$dx},set:function(t){var e=this._$dx;this._$dx=t,e!==t&&this.notation.propertyChanged("dx",e,t)}},{key:"dy",get:function(){return this._$dy},set:function(t){var e=this._$dy;this._$dy=t,e!==t&&this.notation.propertyChanged("dy",e,t)}},{key:"effectiveColor",get:function(){return this.color}},{key:"privateColor",get:function(){return this._$color}},{key:"color",get:function(){return this._$color},set:function(t){var e=this._$color;this._$color=t,e!==t&&this.notation.propertyChanged("color",e,t)}}]),t}();r.registerClass(Qe,"com.noteflight.notation.model.CustomizationForView");var Re=function(){function t(){y(this,t),this._view=null}return p(t,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,kc),this._view.addEventListener(li.CLICK,xt.bindMethod(this,this.handleMouseClick))}},{key:"removeListeners",value:function(){this._view&&this._view.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleMouseClick))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"handleStatusChange",value:function(t){this._view.updateStatus()}},{key:"handleMouseClick",value:function(t){this._view.context.controller.toggleAudioWaveforms(),t.stopPropagation()}}]),t}();r.implementsInterfaces(Re,[Ct]),r.registerClass(Re,"com.noteflight.notation.controller.TrackFlagMediator");var De=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t)))._undoGroupName=null,n._dragNotation=null,n._dragDelta=0,n._undoGroupName=r,n._dragNotation=i,n}return c(e,Qt),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this._dragDelta=0}},{key:"handleDragMove",value:function(t){this.dragDirection==Qt.VERTICAL_DRAG&&this.handleTranspositionDragMove(t)}},{key:"handleDragEnd",value:function(t){s(h(e.prototype),"handleDragEnd",this).call(this,t),this._dragNotation&&this._dragNotation.requestValidation()}},{key:"handleTranspositionDragMove",value:function(t){Ky.removeAllCursors(),Ky.setCursor(Qt.moveNSCursor);var e=A.numberToInt(Math.round(2*(this.dragPoint.y-this.context.stage.mouseY)/(this.context.info.displayScale*this.context.layoutContext.staffMetrics.lineSpacing)));e!=this._dragDelta&&(null!=this._undoGroupName&&(this.context.document.undoHistory.openGroupName=this._undoGroupName),t.shiftKey?this.context.controller.transposeSelectionChromatic(e-this._dragDelta):this.context.controller.transposeSelectionDiatonic(e-this._dragDelta),this._dragDelta=e)}},{key:"handleClick",value:function(t){this._dragNotation&&this.context.controller.selectNotation(this._dragNotation)}}]),e}();r.registerClass(De,"com.noteflight.notation.controller.TranspositionDragMediator");var Fe=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t)))._undoGroupName=null,n._dragNotation=null,n._dragDelta=0,n._undoGroupName=r,n._dragNotation=i,n}return c(e,Qt),p(e,null,[{key:"FRET_DRAG_QUANTUM",get:function(){return 10}}]),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this._dragDelta=0}},{key:"handleDragMove",value:function(t){this.dragDirection==Qt.VERTICAL_DRAG&&this.handleTranspositionDragMove(t)}},{key:"handleTranspositionDragMove",value:function(t){Ky.removeAllCursors(),Ky.setCursor(Qt.moveNSCursor);var i=A.numberToInt(Math.round((this.dragPoint.y-this.context.stage.mouseY)/e.FRET_DRAG_QUANTUM));if(i!=this._dragDelta){null!=this._undoGroupName&&(this.context.document.undoHistory.openGroupName=this._undoGroupName);var n=this.context.document.firstSelectedNote;if(null!=n){var r=i-this._dragDelta,o=n.measure.effectiveClef.getEffectiveFret(n);(r>0||o>=0&&o+r>=0)&&this.context.controller.transposeSelectionChromatic(r)}this._dragDelta=i}}},{key:"handleClick",value:function(t){this._dragNotation&&this.context.controller.selectNotation(this._dragNotation)}}]),e}();r.registerClass(Fe,"com.noteflight.notation.controller.TranspositionFretMediator");var Ue=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,be),p(e,[{key:"handleViewEvents",value:function(t){this._view=A.as(t,$h),this.addListeners()}},{key:"handleMouseDown",value:function(t){this._mouseDownSeen=!0;var e=X.flash_utils_getTimer();this._lastClickMillis,this._view.context.info.doubleClickMillis;if(this._lastClickMillis=e,this._view.notation.enabled){var i=this._view.notation;this._view.context.document.undoHistory.openGroup("Select Notation"),t.ctrlKey||t.shiftKey?this._view.context.controller.modifyNotationSelection(i):this._view.context.controller.selectNotation(i),t.stopPropagation(),this._view.context.documentView.setFocus()}}}]),e}();r.registerClass(Ue,"com.noteflight.notation.controller.EffectMediator");var Ve=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,i.measure.timeSignature.beatDuration,i.measure.staff,{measurePosition:new gl(i.measure.index,i.parent.noteSet.rhythmPosition)})))._notation=null,r._allowVertical=!1,r._notation=i,r._view=n,r}return c(e,we),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this._originalDy=this._view.startY+this._notation.dy,this._originalDx=this._view.startX-this._notation.dx,this.context.document.undoHistory.openGroup("Drag Start Point")}},{key:"positionChanged",value:function(){this._notation.dy=this._originalDy+this.position.dy,this._notation.dx=-this._originalDx+this.position.dx}}]),e}();r.registerClass(Ve,"com.noteflight.notation.controller.EffectStartDragMediator");var Be=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,i.measure.timeSignature.beatDuration,i.measure.staff,{measurePosition:new gl(i.measure.index,i.parent.noteSet.rhythmPosition)})))._notation=null,r._layout=null,r._allowVertical=!1,r._notation=i,r._view=n,r}return c(e,we),p(e,[{key:"handleMouseDown",value:function(t){s(h(e.prototype),"handleMouseDown",this).call(this,t),this._originalDy=this._view.startY,this._originalDx=this._view.startX,this.context.document.undoHistory.openGroup("Drag End Point")}},{key:"positionChanged",value:function(){var t=this.position.dx-this._originalDx,e=-this._originalDy-this.position.dy,i=t,n=e;if(this._notation.wavyType){var r=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));i-=t/r,n-=e/r}this._notation.isPreEffect?this._notation.shift=Math.min(i,0):this._notation.shift=Math.max(i,0),this._notation.ascent=n}}]),e}();r.registerClass(Be,"com.noteflight.notation.controller.EffectEndDragMediator");var He=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._controller=null,i._updateTimer=null,i._partsNeedingUpdate=[],i._temporalMap=null,i.loading=0,i.loaded=0,i._controller=t,i}return c(e,At),p(e,[{key:"scoreReady",value:function(){this.score.addEventListener(tn.WAVEFORM_MODEL_UPDATE,xt.bindMethod(this,this.handleWaveformModelUpdate));var t=!0,e=!1,i=void 0;try{for(var n,r=this.score.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this.updatePartWaveform(o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"handleWaveformModelUpdate",value:function(t){this.updatePartWaveform(t.part)}},{key:"updatePartWaveform",value:function(t){this._partsNeedingUpdate.indexOf(t)<0&&(this._partsNeedingUpdate.push(t),this.updateNeeded())}},{key:"updateNeeded",value:function(){var t=this._updateTimer;t?(t.reset(),t.start()):(t=new By(5,1),this._updateTimer=t,t.addEventListener(Nf.TIMER,xt.bindMethod(this,this.handleUpdateTimer)),t.start())}},{key:"handleUpdateTimer",value:function(t){this._updateTimer=null,this.updateWaveforms()}},{key:"updateWaveforms",value:function(){if(!this.loadAudioMedias()){var t=this._partsNeedingUpdate;if(this._partsNeedingUpdate=[],this.hasAudioMedias()){this.prepareTemporalMap();var e=new en(en.WAVEFORM_UPDATE,t);this.dispatchEvent(e)}}}},{key:"prepareTemporalMap",value:function(){null==this._temporalMap&&(this._temporalMap=this.scoreController.renderFullTemporalMap())}},{key:"hasAudioMedias",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.score.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(o.showAudioWaveform){var s=!0,a=!1,l=void 0;try{for(var u,h=o.recordedAudioTracks[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;if(A.unknownToType(c,wl).playbackEnabled)return!0}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"loadAudioMedias",value:function(){var t=!1,e=!0,i=!1,n=void 0;try{for(var r,o=this.score.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.showAudioWaveform){var a=!0,l=!1,u=void 0;try{for(var h,c=s.recordedAudioTracks[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,wl);if(f.playbackEnabled){var y=!0,g=!1,p=void 0;try{for(var m,v=f.audioClips[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){var _=m.value,S=A.unknownToType(_,Ma).audioMedia;S.loadingComplete||(t=!0,S.loading||this.loadAudioMedia(S))}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"loadAudioMedia",value:function(t){this.loading++,this.dispatchInstrumentLoad(),t.addEventListener(zc.AUDIO_MEDIA_LOADED,xt.bindMethod(this,this.audioMediaLoaded)),t.addEventListener(zc.AUDIO_MEDIA_LOAD_ERROR,xt.bindMethod(this,this.audioMediaLoaded)),t.notLoaded&&t.load()}},{key:"audioMediaLoaded",value:function(t){this.loaded++,this.dispatchInstrumentLoad();var e=t.audioMedia;e.removeEventListener(zc.AUDIO_MEDIA_LOADED,xt.bindMethod(this,this.audioMediaLoaded)),e.removeEventListener(zc.AUDIO_MEDIA_LOAD_ERROR,xt.bindMethod(this,this.audioMediaLoaded)),this.updateNeeded()}},{key:"dispatchInstrumentLoad",value:function(){var t=new yt(yt.INSTRUMENT_LOAD,"playback",A.intToUint(this.loaded),A.intToUint(this.loading));this._controller.controller.performer.dispatchEvent(t)}},{key:"score",get:function(){return this._controller.scoreDocument.score}},{key:"scoreController",get:function(){return this._controller.controller}},{key:"temporalMap",get:function(){return this._temporalMap}}]),e}();r.registerClass(He,"com.noteflight.notation.controller.WaveformController");var $e=i(55),Ge=function(t){function e(t,i,n,r,o){var s;y(this,e),(s=l(this,h(e).call(this))).jQuery=null,s.rootDiv=null,s.sizingDiv=null,s.html5Editor=null,s.rootSvg=null,s.scrollTop=NaN,s.heightUpdating=!1,s.header=null,s.overlayShown=!1,s.overlayManuallyPositioned=!1,s.HEADER_CHANGE_TIMEOUT=500,s.overlaySvg=null,s.synthesis=null,s.keyboardMediator=null,s.keyMediator=null,s.options=null,s.initialDisplayCallback=null,s.score=null,s.stage=null,s.overlayStage=null,s.scoreDocument=null,s.scoreDocumentView=null,s.overlayScoreDocumentView=null,s.overlayHost=null,s.overlayClient=null,s._recordControllerActions=!1,s._recordScoreEdits=!1,s._simultaneousEditing=!1,s.baseScoreController=null,s.actionRecorder=null,s.scoreController=null,s.scoreDocumentController=null,s.instrumentManifest=null,s.instrumentManifestRequested=!1,s.scoreUser=null,s._browserInterface=null,s._listenersInitialized=!1,s.PERF_MARGIN=32,s._validPageMetrics=!0,s._cachedPageMetrics={},s._currentMode=null,s._viewScale={},s.SVG_DEFS={name:"svg",id:"scoreSvg",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:"width:100%;height:100%;stroke:#000000;fill:#000000;-webkit-tap-highlight-color: rgba(0,0,0,0);"},s.OVERLAY_SVG_DEFS={name:"svg",xmlns:"http://www.w3.org/2000/svg",id:"overlaySvg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:"position:fixed;display:none;left:0;stroke:#000000;fill:#000000;-webkit-tap-highlight-color: rgba(0,0,0,0);"},s._lastScrollV=0,s._lastScrollH=0,s.jQuery=t,s.rootDiv=i,s.synthesis=n,s.keyboardMediator=r,s.options=o;var a={enabled:o.ismEnabled,useLocalStorage:o.useLocalStorageForIncrementalSaving||!0,remoteIsmEngaged:o.remoteIsmEngaged};return s.incrementalLocalSaveManager=new Ag(u(u(s)),a),o.remoteIsmEngaged&&(s.incrementalSaveManager=new Ig(u(u(s)),a,o.scoreEditSessionData,o.pubSubClient)),s}return c(e,At),p(e,[{key:"loadInstrumentManifest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.synthesis.context.manifest;this.instrumentManifest=new Oo(A.unknownToType(e.xml,q),A.unknownToString(e.options.manifestLocation),A.unknownToString(e.options.instrumentBase),e.options.loadAssetFunc).manifest,this.instrumentManifest.premium=t}},{key:"initialize",value:function(){this.options.enableClientApi&&(this._browserInterface=new Uu(this),this._browserInterface.handleEditorReady()),this.sizingDiv=this.jQuery('<div id="scoreContainer"></div>'),this.html5Editor=this.jQuery("#html5Editor"),this.header=this.jQuery("#header"),this.html5Editor[0].addEventListener("scroll",xt.bindMethod(this,this.handleHtml5EditorScroll)),this.html5Editor[0].addEventListener("headerHeightChangeStart",xt.bindMethod(this,this.handleHeaderHeightChangeStart)),this.sizingDiv.css("position","absolute"),this.options.hideScore||this.rootDiv.append(this.sizingDiv),this._browserInterface&&this._browserInterface.handleStartCreatingDomElements(),this.rootSvg=this.jQuery(this.xmlDefToElement(this.SVG_DEFS)),this.overlaySvg=this.jQuery(this.xmlDefToElement(this.OVERLAY_SVG_DEFS)),this.sizingDiv.append(this.rootSvg),this.sizingDiv.append(this.overlaySvg),this._browserInterface&&this._browserInterface.handleEndCreatingDomElements()}},{key:"xmlDefToElement",value:function(t){var e=t.xmlns?X.JS_document().createElementNS(t.xmlns,t.name):X.JS_document().createElement(t.name);for(var i in t)"name"!=i&&"xmlns"!=i&&"children"!=i&&e.setAttribute(i,t[i]);if(t.children){var n=!0,r=!1,o=void 0;try{for(var s,a=xt.unknownForOfSource(t.children)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e.appendChild(this.xmlDefToElement(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}return e}},{key:"detectScoreType",value:function(t){var e=this.toASObject(t),i=new on;return("string"==typeof e||A.instanceof(e,String))&&i.isXmlString(A.castUnknownToString(e))?e=A.unknownToType(e,q):A.instanceof(e,Dy)&&i.isXml(A.as(e,Dy))&&(e=A.unknownToType(A.as(e,Dy).toString(),q)),i.recognizeFormat(e)}},{key:"toASObject",value:function(t){return D.com_noteflight_notation_controller_jsflight_JsflightController_toASObject(this,t)}},{key:"loadScore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=this,r=null,o=null,s=null,a=null,l=[],u=[],h=function(t){n._browserInterface&&n._browserInterface.dispatchNoteflightEvent({type:t})},c=function(t){if(t&&a)for(var e=0;e<a.errors.length;e++)l.push(t[e])},d=function(){n.instrumentManifestRequested=!0;var t=!!e.premium&&e.premium;n.synthesis.context.manifest.promise().done(function(){n.loadInstrumentManifest(t)}).always(function(){y()})},f=function(){if(a){if(n.instrumentManifestRequested)try{h(Iu.SCORE_READY),c(a.errors),a&&!a.title&&e.fileName&&(a.title=A.unknownToString(e.fileName.replace(/\.[a-zA-Z0-9]+$/,""))),n.displayScore(a,e),i&&i({score:a,fatalErrors:u,nonFatalErrors:l})}catch(t){throw n.dispatchEvent(new Ef(Ef.SCORE_LOADING_ERROR)),e.errorOnFail?t:(n.dispatchEvent(new Ef(Ef.SCORE_LOADING_ERROR)),new Error("An error occurred reading the score XML"))}else d();return 1}if(null!=s){h("scoreXmlReady");try{a=new rn(e).translateXml(s)}catch(t){throw n.dispatchEvent(new Ef(Ef.SCORE_LOADING_ERROR)),new Error("An error occurred reading the score XML")}}else{if(null!=r)return n.instrumentManifestRequested?(h("scoreDataReady"),function(){var t=new an;t.midiOptions=sn.fromOptions(e);var i=A.unknownToType(e.instrumentEntries,Array);null==i&&n.instrumentManifest&&(i=n.instrumentManifest.entries);var o=e.fileName||"imported midi file";t.addEventListener(Tf.ERROR,function(t){u.push(t.type+": "+t.text)});var s=t.createScore(o,r,i),l=A.as(s,un);null!=l&&(a=l.score,c(l.errors))}(),a?0:1):(d(),1);if(null==o)return h("scoreLoadStart"),function(){var e=new on,i=n.toASObject(t),s=A.as(i,Dy);if(null==s||e.isXml(s))o=t.toString();else switch(e.recognizeBinaryFormat(s)){case on.MIDI_FORMAT:r=s;break;case on.UNSUPPORTED_MIDI_FORMAT:return u.push("Unsupported MIDI format"),1;default:return u.push("Unsupported file format"),1}return 0}();h("scoreDataReady"),s=A.unknownToType(o,q)}},y=function t(){f()||X.setTimeout(t,1)};y()}},{key:"pushTimer",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];jd.pushTimer(t,e,i,n)}},{key:"popTimer",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];jd.popTimer(t,e,i,n)}},{key:"setDisplayModeAttribute",value:function(t){this.sizingDiv.attr("class",t+"Mode")}},{key:"displayScore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(jd.pushTimer("JsflightController","displayScore",!1,!0),this.score=t,t.forceCompletion(),this.options.ismEnabled){var i=NF.scoreData.score_latest_version,n=i?i.version_id:null;this.incrementalLocalSaveManager.loadingScoreCalled||this.incrementalLocalSaveManager.loadingScore(NF.scoreData.external_id,n),this.options.remoteIsmEngaged&&!this.incrementalSaveManager.loadingScoreCalled&&this.incrementalSaveManager.loadingScore(NF.scoreData.external_id,n)}this.options.fit=this.options.fit||(t.isPaginatedMode?"paginated":t.displayMode),this.options.scale?t.viewScale=A.unknownToNumber(this.options.scale):this.options.scale=t.viewScale,this.setDisplayModeAttribute(this.options.fit),this.options.playback&&(t.playbackMode=A.unknownToString(this.options.playback)),t.showArranger=this.options.showArranger||!1,t.lockTitle=this.options.lockTitle||!1,t.lockComposer=this.options.lockComposer||!1,t.lockLyricist=this.options.lockLyricist||!1,t.lockCopyright=this.options.lockCopyright||!1,t.lockFooter=this.options.lockFooter||!1,this.stage&&this.stage.svgElement&&this.stage.svgElement.parentNode&&(this.stage.svgElement.parentNode.removeChild(this.stage.svgElement),this.stage=null),this.stage=new mf(this),this.overlayStage=new mf(this,this.overlaySvg);var r=A.intToUint(Yd.parseFromOptions(e,"permissions",4294967295));this.scoreDocument=new ei(t,r,null),Gd.parseFromOptions(e,"markUnsaved",!1)&&this.scoreDocument.markUnsaved(),this.scoreDocumentView=new xc,this.overlayScoreDocumentView=new xc(!0),this.overlayHost=A.as(this.scoreDocumentView.overlayMediator,oe),this.overlayClient=A.as(this.overlayScoreDocumentView.overlayMediator,re),this.overlayClient.addEventListener(Vi.WIDTH,xt.bindMethod(this,this.updateOverlayWidth)),this.overlayClient.addEventListener(Vi.LOADED,xt.bindMethod(this.overlayHost,this.overlayHost.handleOverlayLoaded)),this.overlayHost.addEventListener(Vi.POSITION,xt.bindMethod(this,this.updateOverlayClientPosition)),this.overlayHost.addEventListener(Vi.STAFF_SPACING,xt.bindMethod(this.overlayClient,this.overlayClient.handleSetStaffSpacing)),null!=this.stage&&this.stage.addChild(this.scoreDocumentView),this.overlayStage.addChild(this.overlayScoreDocumentView),this.baseScoreController=new Le(this.scoreDocument,null,this.scoreUser),this._recordControllerActions?(this.actionRecorder=new Vu(this.baseScoreController),this.actionRecorder.record(),this.scoreController=this.actionRecorder):this.scoreController=this.baseScoreController,this.scoreDocumentController=new Ee(this.scoreController,this.scoreDocumentView),this.scoreDocumentController.performer=pu.createNotationPerformer(this.instrumentManifest,t.performanceMetrics),t.addEventListener(ci.REQUEST_AUDIO,xt.bindMethod(this,this.startSound)),t.addEventListener(Ri.ERROR_LOADING_INSTRUMENT,xt.bindMethod(this,this.handleErrorLoadingInstrument));for(var o=[this.scoreDocumentView,this.overlayScoreDocumentView],s=0;s<o.length;s++){var a=o[s],l=A.unknownToType(a,xc);l.controller=this,l.scoreController=this.scoreController,l.scoreDocumentController=this.scoreDocumentController,l.publicCreateChildren(),l.initializeView(),l.viewInfo.buildIncrementally=Gd.parseFromOptions(e,"buildIncrementally",!0),l.viewInfo.buildWhileIdle=A.unknownToBoolean(this.options.viewer||this.options.buildScoreAsSoonAsPossible),l.viewInfo.buildScoreAsSoonAsPossible=A.unknownToBoolean(this.options.buildScoreAsSoonAsPossible),l.viewInfo.hidePlaybackControls=Gd.parseFromOptions(this.options,"hidePlaybackControls",!1),l.scoreController.viewer=A.unknownToBoolean(this.options.viewer),l.scoreController.showEndOfPreviewText=A.unknownToBoolean(this.options.showEndOfPreviewText||!1),l.scoreController.disableNotationInteraction=Gd.parseFromOptions(this.options,"disableNotationInteraction",!1);var u={mockLoadedFonts:e.mockLoadedFonts};l.glyphFontLoader=new Pr(u),l.scoreDocument=this.scoreDocument,this.resizeToFit(this.options.fit),l.layoutContext.preview=Gd.parseFromOptions(this.options,"preview",!1)||Gd.parseFromOptions(e,"preview",!1),l.watermarkUrl=A.unknownToString(void 0!==this.options.watermark?this.options.watermark:""),l.watermarkScale=A.unknownToNumber(void 0!==this.options.watermarkScale?this.options.watermarkScale:""),l.transparentPlaybackCursor=Gd.parseFromOptions(this.options,"transparentPlaybackCursor",!1),l.viewInfo.shadowBottomUrl=A.unknownToString(void 0!==this.options.shadowBottom?this.options.shadowBottom:""),l.viewInfo.shadowBottomLeftUrl=A.unknownToString(void 0!==this.options.shadowBottomLeft?this.options.shadowBottomLeft:""),l.viewInfo.shadowBottomRightUrl=A.unknownToString(void 0!==this.options.shadowBottomRight?this.options.shadowBottomRight:""),l.viewInfo.shadowLeftUrl=A.unknownToString(void 0!==this.options.shadowLeft?this.options.shadowLeft:""),l.viewInfo.shadowPreviewUrl=A.unknownToString(void 0!==this.options.shadowPreview?this.options.shadowPreview:""),l.viewInfo.shadowRightUrl=A.unknownToString(void 0!==this.options.shadowRight?this.options.shadowRight:""),l.viewInfo.shadowTopUrl=A.unknownToString(void 0!==this.options.shadowTop?this.options.shadowTop:""),l.viewInfo.shadowTopLeftUrl=A.unknownToString(void 0!==this.options.shadowTopLeft?this.options.shadowTopLeft:""),l.viewInfo.shadowTopRightUrl=A.unknownToString(void 0!==this.options.shadowTopRight?this.options.shadowTopRight:"")}t.staffMetrics.ignoreSystemMargins=Gd.parseFromOptions(e,"ignoreSystemMargins",!1),t.footer=A.unknownToString(void 0!==this.options.footer?this.options.footer:t.footer),this.options.customCssClass&&this.jQuery("body").addClass(this.options.customCssClass),this.scoreDocumentView.glyphFontLoader.loadGlyphsAndFonts({fonts:null,glyphFamily:null,supportAshFont:0!=(r&ei.ASH_FONT_PERMISSION),callback:this.glyphsLoaded.bind(this)}),jd.popTimer("JsflightController","displayScore",!1,!0),this.initialDisplayCallback&&this.initialDisplayCallback(),this.scoreDocumentView.scoreDocumentController.waveformController.scoreReady(),this.options.remoteIsmEngaged?this.incrementalSaveManager.scoreLoaded(this.scoreDocument):this.incrementalLocalSaveManager.scoreLoaded(this.scoreDocument),this.scoreDocument.editable&&t.assignPartIds()}},{key:"handleHtml5EditorScroll",value:function(t){this.scrollTop!=this.html5Editor.scrollTop()&&(this.updateOverlayYPosition(),this.scrollTop=A.unknownToNumber(this.html5Editor.scrollTop))}},{key:"hideOverlay",value:function(){this.overlaySvg.fadeOut(200),this.overlayShown=!1}},{key:"showOverlay",value:function(){this.overlaySvg.fadeIn(200),this.overlayShown=!0}},{key:"handleHeaderHeightChangeStart",value:function(){if(!this.heightUpdating&&this.overlayManuallyPositioned){this.overlaySvg.hide(),this.heightUpdating=!0;var t=this;X.setTimeout(function(){t.updateOverlayYPosition(),t.heightUpdating=!1,t.overlayShown&&t.overlaySvg.fadeIn(200)},this.HEADER_CHANGE_TIMEOUT)}}},{key:"updateOverlayYPosition",value:function(){var t,e=A.unknownToNumber(this.sizingDiv.offset().top);e<this.header.height()?(t=A.numberToString(e)+"px",this.overlayManuallyPositioned=!0):(t="auto",this.overlayManuallyPositioned=!1),this.overlaySvg[0].style.top=t}},{key:"updateOverlayClientPosition",value:function(t){t.measureIndex<1?this.hideOverlay():(this.showOverlay(),this.overlayClient.handleUpdateOverlayPosition(t))}},{key:"updateOverlayWidth",value:function(t){this.overlaySvg.width(t.width),this.overlayHost.overlayWidth=t.width}},{key:"glyphsLoaded",value:function(){this.scoreDocumentView.updateLayout(),this.overlayScoreDocumentView.updateLayout();this.keyMediator=new ne(this.scoreDocumentController,function(t){X.JS_window().NF.analytics.trackEvent("editor",t,"shortcut")}),this._listenersInitialized||(this.keyboardMediator(xt.bindMethod(this,this.handleKeyboardEvent)),Vd.isFingerTouchScreenType&&this.rootDiv.bind("touchmove",xt.bindMethod(this,this.handleTouchMove)),this.rootDiv.bind("scroll",xt.bindMethod(this,this.handleScroll)),this._listenersInitialized=!0),this.scoreDocumentView.addEventListener(Mi.REPORT_PAGE_FLOW,xt.bindMethod(this,this.rebroadcastIncrementalLayoutEvent)),this.scoreDocumentView.addEventListener(Mi.REPORT_STRIP_FLOW,xt.bindMethod(this,this.rebroadcastIncrementalLayoutEvent));var t=this.stage;null!=t&&t.svgElement.appendChild(this.scoreDocumentView.svgElement),this.overlayStage.svgElement.appendChild(this.overlayScoreDocumentView.svgElement),this._browserInterface&&this._browserInterface.handleScoreLoaded()}},{key:"saveScore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=new cr(this.score);if(t){var i=e.xml.toXmlString();return tr.xml("noteflightCompressed",function(t){t.text(btoa($e.deflate(i,{to:"string"})))})}return e.xml}},{key:"getMusicXML",value:function(){var t=new ir(this.score);return ir.XML_PROLOGUE+"\n"+t.toXMLString()}},{key:"exportToMidi",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new ln,i=t.midiOptimization||vi.MIDI_OPTIMIZE_FOR_SCORE;return e.createMidiFromScore(this.score,this.scoreDocumentController.performer,i)}},{key:"getPlaybackMeasures",value:function(){return(new dr).createFormFromScore(this.score)}},{key:"getStandingWaveJson",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(new fr).createJSONObjectFromScore(this.score,this.scoreDocumentController.performer,0,t)}},{key:"startSound",value:function(t){this.synthesis.context.startSound()}},{key:"handleErrorLoadingInstrument",value:function(t){this._browserInterface&&this._browserInterface.dispatchNoteflightEvent({type:Ri.ERROR_LOADING_INSTRUMENT})}},{key:"handleKeyboardEvent",value:function(t,e,i,n){var r=new ui("keyDown",!0,!1,A.intToUint(n),A.intToUint(i),0,A.unknownToBoolean(e.control),A.unknownToBoolean(e.alt),A.unknownToBoolean(e.shift),A.unknownToBoolean(e.control),A.unknownToBoolean(e.control));return xt.bindMethod(this.keyMediator,this.keyMediator.handleKey).call(this.keyMediator,r)}},{key:"resizeToFit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&(this.options.fit=t);var e=this.horizontalScrollPosition,i=this.verticalScrollPosition;switch(this._currentMode&&(this._viewScale[this._currentMode]=this.score.viewScale),this.rootDiv.css("overflow","auto"),this.hideOverlay(),A.as(this.options.fit,String)){case Nl.FLOW_DISPLAY:this.flowScoreToPageWidth();break;case Nl.STRIP_DISPLAY:this.showScoreAsStrip();break;case Nl.PERFORM_DISPLAY:i=this.scaleScoreToPageHeight();break;default:this.setPaginatedDisplay()}this.horizontalScrollPosition=e,this.verticalScrollPosition=i}},{key:"setPaginatedDisplay",value:function(){if(this.score){if(this.restorePageMetrics(Nl.PAGINATED_DISPLAY),this.setScoreDisplayMode(Nl.PAGINATED_DISPLAY),this.savePageMetrics(Nl.PAGINATED_DISPLAY),this.options.autoScale){var t=this.score.effectivePageMetrics.width;this.scoreDocumentView.showHtml5Shadow()&&(t+=2*this.score.effectivePageMetrics.horizontalScoreShadowSize),this.score.viewScale=this.rootDiv.width()/t}else this.score.viewScale=this.restoreScale(Nl.PAGINATED_DISPLAY);this.updateSDVDimensions()}}},{key:"setScoreDisplayMode",value:function(t){this.score&&t!=this.score.displayMode&&(this.scoreDocumentController&&this.scoreDocumentController.scoreDocument.undoHistory.openGroup(t),this.score.displayMode=t,this.setDisplayModeAttribute(t)),this._currentMode=t}},{key:"savePageMetrics",value:function(t){this._cachedPageMetrics[t]=this.score.pageMetrics.clone()}},{key:"restorePageMetrics",value:function(t){this._validPageMetrics||(this._cachedPageMetrics[t]?this.score.pageMetrics=this._cachedPageMetrics[t]:this.score.pageMetrics=new hr,this._validPageMetrics=!0)}},{key:"restoreScale",value:function(t){return this._viewScale[t]?this._viewScale[t]:this.score.viewScale}},{key:"scaleScoreToPageHeight",value:function(){if(this.score&&this.scoreDocumentView.scoreView){var t=Math.round(this.rootDiv.scrollTop()/(this.sizingDiv.height()/this.scoreDocumentView.scoreView.pageCountGuess));return this.restorePageMetrics(Nl.PERFORM_DISPLAY),this.setScoreDisplayMode(Nl.PERFORM_DISPLAY),this.savePageMetrics(Nl.PERFORM_DISPLAY),this.score.viewScale=Math.min(this.rootDiv.height()/this.score.effectivePageMetrics.height,this.rootDiv.width()/this.score.effectivePageMetrics.width),this.updateSDVDimensions(),this.rootDiv.scrollTop((A.unknownToNumber(this.rootDiv.height())+this.PERF_MARGIN*this.score.viewScale)*t),this.rootDiv.css("overflow","hidden"),this.rootDiv.scrollTop()}}},{key:"flowScoreToPageWidth",value:function(){if(this.score){this.setScoreDisplayMode(Nl.FLOW_DISPLAY);var t=this.rootDiv.width();this.scoreDocumentView.showHtml5Shadow()&&(t-=2*this.score.effectivePageMetrics.horizontalScoreShadowSize*this.score.viewScale,this.score.viewScale=this.restoreScale(Nl.FLOW_DISPLAY)),this._validPageMetrics=!1,this.score.effectivePageMetrics=(new hr).withDimensions(null,t/this.viewScale,t*this.options.scale/this.viewScale,null)}}},{key:"updateSDVDimensions",value:function(){this.scoreDocumentView&&this.scoreDocumentView.updateScoreDimensions(),this.overlayScoreDocumentView&&this.overlayScoreDocumentView.updateScoreDimensions()}},{key:"showScoreAsStrip",value:function(){this.score&&(this.restorePageMetrics(Nl.STRIP_DISPLAY),this.setScoreDisplayMode(Nl.STRIP_DISPLAY),this.score.viewScale=this.restoreScale(Nl.STRIP_DISPLAY),this.updateSDVDimensions())}},{key:"updateScoreDimensions",value:function(t,e){if(this.sizingDiv){this.sizingDiv.width(t+"px"),this.sizingDiv.height(e+"px");for(var i=[this.rootSvg,this.overlaySvg],n=0;n<i.length;n++){i[n].css("min-height",e+"px")}this.sizingDiv.css("left",Math.max(0,(this.rootDiv.width()-t)/2)+"px"),this.sizingDiv.css("top",Math.max(0,(this.rootDiv.height()-e)/2)+"px"),X.setTimeout(xt.bindMethod(this,this.updateOverlayYPosition),1)}}},{key:"ensureSelectionVisible",value:function(){this.scoreDocumentController.ensureSelectionVisible()}},{key:"animateScrollPosition",value:function(t,e){if(this.score.isStripMode)Math.abs(this.horizontalScrollPosition-t.x)<.1*this.rootDiv.width()?e():this.rootDiv.animate({scrollLeft:t.x},200,"swing",function(){e()});else{var i=t.y;if(this.score.isPerformMode&&(i=this.verticalScrollPosition+this.scoreDocumentView.pageTopForY(i-this.verticalScrollPosition)),Math.abs(this.verticalScrollPosition-i)<.07*this.rootDiv.height())e();else if(this.score.isPerformMode){var n=this,r=A.unknownToNumber(n.sizingDiv.position().left),o=i<this.verticalScrollPosition?1:-1;n.sizingDiv.css("left",r),this.sizingDiv.animate({left:this.rootDiv.width()*o},75,"swing",function(){n.sizingDiv.css("left",n.rootDiv.width()*-o+"px"),n.rootDiv.animate({scrollTop:i},50),n.sizingDiv.animate({left:r},75,"swing",function(){n.verticalScrollPosition=i,e()})})}else this.rootDiv.animate({scrollTop:i},200,"swing",function(){e()})}}},{key:"handleScroll",value:function(t){var e;this.verticalScrollPosition!=this._lastScrollV&&(e=new hi(hi.SCROLL,!0,!1,null,this.verticalScrollPosition,Xy.VERTICAL,this.verticalScrollPosition-this._lastScrollV),this._lastScrollV=this.verticalScrollPosition,this.scoreDocumentView.dispatchEvent(e)),this.horizontalScrollPosition!=this._lastScrollH&&(e=new hi(hi.SCROLL,!0,!1,null,this.horizontalScrollPosition,Xy.HORIZONTAL,this.horizontalScrollPosition-this._lastScrollH),this._lastScrollH=this.horizontalScrollPosition,this.scoreDocumentView.dispatchEvent(e),this.overlayScoreDocumentView.dispatchEvent(e))}},{key:"forceScroll",value:function(t){if(Object.defineProperty(this,"horizontalScrollPosition",{value:t,writable:!0}),t!=this._lastScrollH){var e=new hi(hi.SCROLL,!0,!1,null,t,Xy.HORIZONTAL,t-this._lastScrollH);this._lastScrollH=this.horizontalScrollPosition,this.scoreDocumentView.dispatchEvent(e),this.overlayScoreDocumentView.dispatchEvent(e)}}},{key:"handleTouchMove",value:function(t){var e=t.originalEvent.changedTouches;e&&e.length}},{key:"scrollToPreviousPage",value:function(){this.animateScrollPosition(new If(0,this.verticalScrollPosition-this.rootDiv.height()+50),function(){})}},{key:"scrollToNextPage",value:function(){this.animateScrollPosition(new If(0,this.verticalScrollPosition+this.rootDiv.height()+50),function(){})}},{key:"centerCurrentPage",value:function(){this.verticalScrollPosition=this.verticalScrollPosition+this.scoreDocumentView.pageTopForY(50)}},{key:"centerCurrentPageIfNeeded",value:function(){this.scoreController&&this.scoreController.score.isPerformMode&&this.centerCurrentPage()}},{key:"rebroadcastIncrementalLayoutEvent",value:function(t){this.scoreDocumentController.dispatchEvent(t)}},{key:"invokeApiMethod",value:function(t,e){var i=this._browserInterface.callbacks[t];return i?i.apply(this._browserInterface,e):null}},{key:"dispatchJsflightEvent",value:function(t,e){this.rootDiv.trigger(t,e)}},{key:"togglePerformanceBenchmarking",value:function(t){jd.enabled=t}},{key:"togglePerfBenchSimpleOutput",value:function(t){jd.simpleOutput=t}},{key:"togglePerfBenchSilentMode",value:function(t){jd.enabled=t,jd.silentMode=t}},{key:"setPerfBenchClassWhitelist",value:function(t){jd.classWhitelist=t}},{key:"setPerfBenchMethodWhitelist",value:function(t){jd.methodWhitelist=t}},{key:"setPerfBenchClassBlacklist",value:function(t){jd.classBlacklist=t}},{key:"setPerfBenchMethodBlacklist",value:function(t){jd.methodBlacklist=t}},{key:"recordControllerActions",value:function(t){this._recordControllerActions=t}},{key:"recordScoreEdits",value:function(t){this._recordScoreEdits=t}},{key:"simultaneousEditing",value:function(t){this._simultaneousEditing=t}},{key:"scoreUserObject",set:function(t){this.scoreUser=t}},{key:"viewScale",get:function(){return this.score?this.score.viewScale:1}},{key:"autoScale",set:function(t){this.options.autoScale=t},get:function(){return A.unknownToBoolean(this.options.autoScale)}},{key:"stageWidth",get:function(){return A.unknownToNumber(this.rootDiv.width())}},{key:"stageHeight",get:function(){return A.unknownToNumber(this.rootDiv.height())}},{key:"stageOffset",get:function(){var t=this.rootDiv.offset();return new If(A.unknownToNumber(t.left),A.unknownToNumber(t.top))}},{key:"horizontalScrollPosition",get:function(){return A.unknownToNumber(this.rootDiv.scrollLeft())},set:function(t){this.rootDiv.scrollLeft(t)}},{key:"verticalScrollPosition",get:function(){return A.unknownToNumber(this.rootDiv.scrollTop())},set:function(t){this.rootDiv.scrollTop(t)}},{key:"displayListStats",get:function(){if(null==this.stage)throw Error("this.stage expected to be non-null");return this.stage.displayListStats}}]),e}();r.registerClass(Ge,"com.noteflight.notation.controller.jsflight.JsflightController");var Ye=function t(){y(this,t)};r.registerClass(Ye,"com.noteflight.notation.document.IClipboard");var ze=function t(){y(this,t)};r.registerClass(ze,"com.noteflight.notation.document.ISelection");var We=function t(){y(this,t)};r.registerClass(We,"com.noteflight.notation.document.IUndoableEdit");var Xe=function(){function t(){y(this,t)}return p(t,[{key:"measureIndicies",get:function(){for(var t=[],e=this.start.measureIndex;e<=this.end.measureIndex;e++)t.push(e);return t}},{key:"systemMeasureNotations",get:function(){var t=this.score.systemStaff;return this.measureIndicies.reduce(function(e,i){return e.concat(t.getMeasureAt(i).measureNotations)},[])}},{key:"duration",get:function(){var t=this;return this.measureIndicies.reduce(function(e,i){return e+t.score.systemStaff.getMeasureAt(i).duration},0)}}]),t}();r.registerClass(Xe,"com.noteflight.notation.document.Selection");var Ke=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this)))._startIndex=0,r._endIndex=0,r._score=null,r._score=t,r._startIndex=i,r._endIndex=n,r}return c(e,Xe),p(e,[{key:"contains",value:function(t){return this.includes(t)&&A.is(t,hl)&&A.unknownToType(t,hl).isSystemMeasure}},{key:"includes",value:function(t){var e=null;if(A.is(t,hl)?e=A.unknownToType(t,hl):A.is(t,he)&&(e=A.unknownToType(t,he).measure),null!=e){var i=e.index;return i>=this.startIndex&&i<this.endIndex}return!1}},{key:"union",value:function(t){return t.selectedMeasures.withRange(this.startIndex,this.endIndex)}},{key:"dispatchStatusChange",value:function(){this.score.systemStaff.dispatchEvent(new Fi(Fi.SYSTEM_STATUS_CHANGE,this.startIndex,this.endIndex));for(var t=this.startIndex;t<Math.min(this.score.numMeasures,this.endIndex+1);t++){var e=[this.score.systemStaff];e=e.concat(this.score.staves.slice());var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);l.dispatchEvent(new Fi(Fi.STAFF_STATUS_CHANGE,this.startIndex,this.endIndex));var u=l.getMeasureAt(A.intToUint(t));if(null!=u){u.dispatchEvent(new Fi(Fi.MEASURE_STATUS_CHANGE));var h=!0,c=!1,d=void 0;try{for(var f,y=u.measureNotations[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;A.unknownToType(g,he).dispatchEvent(new Fi(Fi.NOTATION_STATUS_CHANGE))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}},{key:"createClipboard",value:function(){return new ti(this)}},{key:"selectedNotations",value:function(){for(var t=[],e=this.startIndex;e<this.endIndex;e++){var i=!0,n=!1,r=void 0;try{for(var o,s=this.score.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);t=t.concat(l.getMeasureAt(A.intToUint(e)).measureNotations)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}return t}},{key:"withMeasure",value:function(t){return this.withRange(t.index,t.index+1)}},{key:"cloneMeasureSelection",value:function(){return new e(this.score,this.startIndex,this.endIndex)}},{key:"withRange",value:function(t,i){return t>=this.startIndex&&i<=this.endIndex?this:new e(this.score,A.numberToInt(Math.min(this.startIndex,t)),A.numberToInt(Math.max(this.endIndex,i)))}},{key:"toJSON",value:function(){return{type:"measure",startMeasureIndex:this.startIndex,endMeasureIndex:this.endIndex}}},{key:"score",get:function(){return this._score}},{key:"startIndex",get:function(){return this._startIndex}},{key:"endIndex",get:function(){return this._endIndex}},{key:"start",get:function(){return new gl(A.intToUint(this.startIndex),0)}},{key:"end",get:function(){return new gl(Math.max(0,this._endIndex-1),0)}},{key:"objectSelection",get:function(){return new qe(this.score,this.selectedNotations())}},{key:"selectedRange",get:function(){return new Je(this.score,new gl(A.intToUint(this.startIndex),0),new gl(A.intToUint(this.endIndex-1),this.score.systemStaff.getMeasureAt(A.intToUint(this.endIndex-1)).duration),this.score.staves.slice())}},{key:"selectedMeasures",get:function(){return this}},{key:"selectedVoiceNumber",get:function(){return Kl.UNKNOWN_VOICE_NUMBER}},{key:"empty",get:function(){return this.startIndex>=this.endIndex}}]),e}();r.implementsInterfaces(Ke,[ze]),r.registerClass(Ke,"com.noteflight.notation.document.MeasureSelection");var je=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).processTimerEnabled=!1,t.processTime=0,t._invalidMeasureMap=null,t._sequenceChanges=[],t._invalidStaffMap=null,t._invalidScore=!1,t._invalidGeometry=!1,t._eventType=null,t._needsReflow=!1,t._disableFixup=!1,t._processing=!1,t._modelCallbacks=[],t._timer=null,t._timer=new By(e.SHORT_DELAY,1),t._timer.addEventListener(Nf.TIMER,xt.bindMethod(u(u(t)),t.handleValidationTimer)),t}return c(e,At),p(e,null,[{key:"VERY_SHORT_DELAY",get:function(){return 1}},{key:"SHORT_DELAY",get:function(){return 10}},{key:"LONG_DELAY",get:function(){return 300}}]),p(e,[{key:"measureChanged",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)switch(n){case Ai.REFLOW:this._needsReflow=!0;break;case Ai.ADD:this._sequenceChanges.push({type:n,measureIndex:t.index,systemMeasure:t});break;case Ai.REMOVE:this._sequenceChanges.push({type:n,measureIndex:t.index}),t.nextMeasure&&(t=t.nextMeasure)}if(null==this._invalidMeasureMap||null==this._invalidStaffMap)return this._invalidMeasureMap=new Uy,this._invalidMeasureMap.put(t,t),this._invalidStaffMap=new Uy,this._invalidStaffMap.put(t.staff,t.staff),this._eventType=i,void this.startTimer(e.SHORT_DELAY);switch(this._invalidMeasureMap.put(t,t),this._invalidStaffMap&&this._invalidStaffMap.put(t.staff,t.staff),i){case Ai.SEQUENCE_CHANGE:this._eventType=i;break;case Ai.VALIDATE:this._eventType!=Ai.GEOMETRY_CHANGE&&this._eventType!=Ai.SPAN_CHANGE||(this._eventType=i);break;case Ai.GEOMETRY_CHANGE:this._eventType==Ai.SPAN_CHANGE&&(this._eventType=i);break;case Ai.SPAN_CHANGE:}this.startTimer(e.SHORT_DELAY)}},{key:"rebuildScore",value:function(){this._invalidScore=!0,this.startTimer(e.SHORT_DELAY),this.dispatchEvent(new Ai(Ai.REBUILD_SCORE))}},{key:"rebuildGeometry",value:function(){this._invalidGeometry=!0,this.startTimer(e.LONG_DELAY)}},{key:"disableFixup",value:function(){this._disableFixup=!0}},{key:"requestModelChange",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.LONG_DELAY;this._processing?this._modelCallbacks.push(t):t(),this.startTimer(i)}},{key:"processChanges",value:function(){var t;this.processTimerEnabled&&(t=new Date),this.removeOrphans(),this._disableFixup||this.fixInvalidatedMeasures(),this._disableFixup=!1;try{if(this._processing=!0,this._invalidScore)this.dispatchEvent(new Ai(Ai.VALIDATE));else{var e=this.invalidMeasures;if(e.length||this._sequenceChanges.length||this._needsReflow){var i=new Ai(this._eventType,e,this.invalidStaves);i.reflow=this._needsReflow,i.sequenceChanges=this._sequenceChanges,this.dispatchEvent(i)}this._invalidGeometry&&this.dispatchEvent(new Ai(Ai.GEOMETRY_CHANGE))}}finally{this.reset()}var n=!0,r=!1,o=void 0;try{for(var s,a=this._modelCallbacks[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;A.unknownToType(l,Function)()}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this._modelCallbacks=[],this.processTimerEnabled&&t&&(this.processTime+=(new Date).getTime()-t.getTime()),this.dispatchEvent(new Ai(Ai.VALIDATED))}},{key:"reset",value:function(){this._invalidMeasureMap=null,this._sequenceChanges=[],this._invalidStaffMap=null,this._invalidScore=!1,this._invalidGeometry=!1,this._processing=!1,this._needsReflow=!1,this._timer.stop(),this._timer.delay=e.SHORT_DELAY,this.willProcess=!1}},{key:"checkProcessTime",value:function(){X.trace("Measure validator has processed for "+this.processTime+"ms since last checked."),this.processTime=0}},{key:"handleValidationTimer",value:function(t){this.processChanges()}},{key:"removeOrphans",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.invalidMeasures[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,hl);null!=s.staff&&null!=s.staff.score||xt.deleteFromDictionary(this._invalidMeasureMap,s)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"fixInvalidatedMeasures",value:function(){var t,e,i=!0,n=!1,r=void 0;try{for(var o,s=this.invalidMeasures[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)e=o.value,(t=A.unknownToType(e,hl)).isSystemMeasure||t.calculateDerived()}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var a=!0,l=!1,u=void 0;try{for(var h,c=this.invalidMeasures[Symbol.iterator]();!(a=(h=c.next()).done);a=!0)e=h.value,(t=A.unknownToType(e,hl)).isSystemMeasure||(t.cleanUpAccidentals(),t.cleanUpClefs(),t.cleanUpRestPositions(),t.staff.defaultClefChanges(t.index),t.staff.defaultClefChanges(t.index+1),Ai.BIG_CHANGES.indexOf(this._eventType)>-1&&t.defaultTransposableSpans(!0))}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}},{key:"startTimer",value:function(t){this.willProcess=!0,this._timer.delay=Math.max(this._timer.delay,t),this._timer.running||this._timer.start()}},{key:"invalidMeasures",get:function(){if(null==this._invalidMeasureMap)return[];var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=xt.dictionaryForOfSource(this._invalidMeasureMap)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,hl);a&&t.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"invalidStaves",get:function(){if(null==this._invalidStaffMap)return[];var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=xt.dictionaryForOfSource(this._invalidStaffMap)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Rl);a&&t.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}}]),e}();r.registerClass(je,"com.noteflight.notation.document.MeasureValidator");var qe=function(t){function e(t,i){var n;y(this,e),(n=l(this,h(e).call(this)))._score=null,n._selectedObjects=null,n._dictionary=null,n._score=t,n._selectedObjects=[],n._dictionary=new Uy;var r=!0,o=!1,s=void 0;try{for(var a,u=i[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=a.value;null==n._dictionary.get(c)&&(n._dictionary.put(c,c),n._selectedObjects.push(c))}}catch(t){o=!0,s=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}return n}return c(e,Xe),p(e,[{key:"includes",value:function(t){return this.contains(t)}},{key:"contains",value:function(t){return null!=this._dictionary.get(t)}},{key:"union",value:function(t){var i=t.objectSelection;return new e(this.score,this._selectedObjects.concat(i._selectedObjects))}},{key:"difference",value:function(t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this._selectedObjects[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;t.contains(l)||i.push(l)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return new e(this.score,i)}},{key:"dispatchStatusChange",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.selectedObjects[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;A.is(o,he)&&A.unknownToType(o,he).dispatchEvent(new Fi(Fi.NOTATION_STATUS_CHANGE))}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"createClipboard",value:function(){var t=new ri,e=this;return t.addRange(this.selectedRange,function(t){if(A.is(t,Sn)&&A.unknownToType(t,Sn).grace)return null;var i=A.as(t,se),n=i.clone();return e.pruneUnselected(i,n)?A.as(n,ue):null}),t.fromObjects=!0,t}},{key:"pruneUnselected",value:function(t,e){if(A.is(t,ce))return this.includes(t)||this.includes(A.unknownToType(t,ce).noteSet);if(!A.is(t,Xl)&&!A.is(t,Sn))return this.includes(t);if(A.is(t,vl))return!0;for(var i=!1,n=!1,r=t.numChildren-1;r>=0;r--)this.pruneUnselected(t.getChildAt(A.intToUint(r)),e.getChildAt(A.intToUint(r)))?i=!0:(e.removeChildAt(A.intToUint(r)),n=!0);return A.is(e,Xl)&&n&&new Nu(A.as(e,Xl)).addRests(),i}},{key:"selectedNotations",value:function(){return this.selectedObjects}},{key:"withMeasure",value:function(t){return this.selectedRange.union(Je.getRangeForMeasure(t))}},{key:"toJSON",value:function(){return{type:"object"}}},{key:"selectedObjects",get:function(){return this._selectedObjects}},{key:"score",get:function(){return this._score}},{key:"start",get:function(){return this.selectedRange.start}},{key:"end",get:function(){return this.selectedRange.end}},{key:"selectedVoiceNumber",get:function(){var t=Kl.UNKNOWN_VOICE_NUMBER,e=null,i=!0,n=!1,r=void 0;try{for(var o,s=this._selectedObjects[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(A.is(a,ae)){var l=A.unknownToType(a,ae),u=l.voiceNumber,h=l.measure.staff;if(t!=Kl.UNKNOWN_VOICE_NUMBER&&u!=t||null!=e&&h!=e)return Kl.UNKNOWN_VOICE_NUMBER;t=u,e=h}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}},{key:"objectSelection",get:function(){return this}},{key:"selectedRange",get:function(){var t=new Je(this.score,gl.MAX_POSITION,gl.MIN_POSITION,[]),e=!0,i=!1,n=void 0;try{for(var r,o=this._selectedObjects[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=null,l=null;A.is(s,he)&&(l=(a=A.unknownToType(s,he)).valueNotation),null!=l?t=A.as(t.union(Je.getRangeForNotation(l)),Je):null!=a&&(t=A.as(t.union(Je.getRangeForNotation(a)),Je))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"selectedMeasures",get:function(){var t=Hy.MAX_VALUE,e=0,i=!0,n=!1,r=void 0;try{for(var o,s=this._selectedObjects[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(A.is(a,he)&&A.unknownToType(a,he).measure){var l=A.unknownToType(a,he).measure.index;t=A.numberToInt(Math.min(t,l)),e=A.numberToInt(Math.max(e,l+1))}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return new Ke(this.score,t,e)}},{key:"empty",get:function(){return 0===this._selectedObjects.length}}]),e}();r.implementsInterfaces(qe,[ze]),r.registerClass(qe,"com.noteflight.notation.document.ObjectSelection");var Je=function(t){function e(t,i,n,r){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.DIRECTION_RIGHT;return y(this,e),(o=l(this,h(e).call(this)))._staves=null,o._start=null,o._end=null,o._score=null,o._direction=null,o._score=t,o._staves=r,o._start=i,o._end=n,o._direction=s,o}return c(e,Xe),p(e,null,[{key:"DIRECTION_RIGHT",get:function(){return"right"}},{key:"DIRECTION_LEFT",get:function(){return"left"}}]),p(e,[{key:"contains",value:function(t){return!1}},{key:"includes",value:function(t){return A.is(t,Rl)?this.includesStaff(A.as(t,Rl)):A.is(t,hl)?this.includesMeasure(A.as(t,hl)):!!A.is(t,he)&&this.includesNotation(A.as(t,he))}},{key:"dispatchStatusChange",value:function(){var t=this.start.measureIndex;t==this.score.numMeasures&&t--;for(var e=t;e<=this.end.measureIndex;e++){var i=new Fi(Fi.MEASURE_STATUS_CHANGE),n=this.score.systemStaff.getMeasureAt(A.intToUint(e));null!=n&&n.dispatchEvent(i);var r=!0,o=!1,s=void 0;try{for(var a,l=this.score.staves[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,Rl);if(h.dispatchEvent(new Fi(Fi.STAFF_STATUS_CHANGE,t,this.end.measureIndex)),null!=(n=h.getMeasureAt(A.intToUint(e)))){n.dispatchEvent(i);var c=!0,d=!1,f=void 0;try{for(var y,g=n.measureNotations[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value;A.unknownToType(p,he).dispatchEvent(new Fi(Fi.NOTATION_STATUS_CHANGE))}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}}},{key:"selectedNotations",value:function(){for(var t=[],e=this.start.measureIndex;e<=this.end.measureIndex;e++){var i=!0,n=!1,r=void 0;try{for(var o,s=this.score.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);if(this.includes(l)){var u=!0,h=!1,c=void 0;try{for(var d,f=l.getMeasureAt(A.intToUint(e)).measureNotations[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=A.unknownToType(y,he);this.includes(g)&&t.push(g)}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}return t}},{key:"createClipboard",value:function(){return new ri(this)}},{key:"withMeasure",value:function(t){return this.union(e.getRangeForMeasure(t))}},{key:"includesEntireStaffRange",value:function(t,e,i){if(!this.includesStaff(t))return!1;if(e=A.numberToUint(Math.min(t.numChildren,e)),(i=A.numberToUint(Math.min(t.numChildren,i)))<=e)return!1;if(new gl(e,0).compareTo(this._start)<0)return!1;var n=t.getMeasureAt(A.intToUint(i-1));return!(new gl(A.intToUint(i-1),n.duration).compareTo(this._end)>0)}},{key:"includesStaff",value:function(t){return this._staves.indexOf(t)>=0}},{key:"includesMeasure",value:function(t){return!!this.includesStaff(t.staff)&&(!(new gl(A.intToUint(t.index),0).compareTo(this._end)>=0)&&!(new gl(A.intToUint(t.index),t.duration).compareTo(this._start)<0))}},{key:"includesEntireMeasure",value:function(t){return!!this.includesStaff(t.staff)&&(!(new gl(A.intToUint(t.index),0).compareTo(this._start)<0)&&!(new gl(A.intToUint(t.index),t.duration).compareTo(this._end)>0))}},{key:"intersectsMeasure",value:function(t){return!!this.includesStaff(t.staff)&&(!(new gl(A.intToUint(t.index),0).compareTo(this._end)>0)&&!(new gl(A.intToUint(t.index),t.duration).compareTo(this._start)<0))}},{key:"includesNotation",value:function(t){if(null==t.measure)return!1;if(!this.includesStaff(t.measure.staff))return!1;var e=new gl(A.intToUint(t.measure.index),t.position);return e.compareTo(this._start)>=0&&e.compareTo(this._end)<0}},{key:"includesNotationClosed",value:function(t){if(null==t.measure)return!1;if(!this.includesStaff(t.measure.staff))return!1;var e=new gl(A.intToUint(t.measure.index),t.position);return e.compareTo(this._start)>=0&&e.compareTo(this._end)<=0}},{key:"union",value:function(t){var e=t.selectedRange;return this.withRange(e.start,e.end).withStaves(e.staves)}},{key:"cloneRangeSelection",value:function(){return new e(this.score,this.start,this.end,this.staves)}},{key:"withStaves",value:function(t){var e=this.cloneRangeSelection(),i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.includesStaff(a)||e._staves.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e._staves.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),e}},{key:"withRange",value:function(t,e){var i=this.cloneRangeSelection();return t.compareTo(this._start)<0&&(i._start=t),e.compareTo(this._end)>0&&(i._end=e),i}},{key:"toJSON",value:function(){return{type:"range"}}},{key:"score",get:function(){return this._score}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"staves",get:function(){return this._staves}},{key:"direction",get:function(){return this._direction}},{key:"objectSelection",get:function(){return new qe(this.score,this.selectedNotations())}},{key:"selectedRange",get:function(){return this}},{key:"empty",get:function(){return 0===this._staves.length||this._start.compareTo(this._end)>=0}},{key:"duration",get:function(){return this.score.rangeDuration(this._start,this._end)}},{key:"selectedMeasures",get:function(){return new Ke(this.score,this.start.measureIndex,this.end.measureIndex+1)}},{key:"selectedVoiceNumber",get:function(){return 1==this.staves.length?new qe(this._score,this.selectedNotations()).selectedVoiceNumber:Kl.UNKNOWN_VOICE_NUMBER}}],[{key:"getRangeForNotation",value:function(t){var i;if(i=t.measure.isSystemMeasure?t.measure.staff.score.staves.slice():[t.measure.staff],A.is(t,mn)){var n=A.as(t,mn),r=new gl(A.intToUint(n.measure.index),n.position),o=null;if(A.is(n.rhythmContext,Xl)){var s=A.unknownToType(n.rhythmContext,Xl);s.topLevelTuplet&&n==s.elements[s.numElements-1]&&(o=new gl(A.intToUint(n.measure.index),s.position+s.duration))}return null==o&&(o=new gl(A.intToUint(n.measure.index),n.position+n.duration)),new e(n.measure.staff.score,r,o,i)}var a=new gl(A.intToUint(t.measure.index),t.position);return new e(t.measure.staff.score,a,a,i)}},{key:"getRangeForMeasure",value:function(t){var i=new gl(A.intToUint(t.index),0),n=new gl(A.intToUint(t.index),t.duration);return new e(t.staff.score,i,n,[t.staff])}},{key:"selectStaff",value:function(t){var i=t.score,n=i.systemStaff.getMeasureAt(A.intToUint(i.numMeasures-1));return new e(i,new gl(0,0),new gl(A.intToUint(n.index),n.duration),[t])}},{key:"selectPart",value:function(t){var i=t.score,n=i.systemStaff.getMeasureAt(A.intToUint(i.numMeasures-1));return new e(i,new gl(0,0),new gl(A.intToUint(n.index),n.duration),t.staves)}}]),e}();r.implementsInterfaces(Je,[ze]),r.registerClass(Je,"com.noteflight.notation.document.RangeSelection");var Ze=function t(){y(this,t)};r.registerClass(Ze,"flash.utils.IExternalizable");var ti=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(y(this,t),this._score=null,null!=e){this._score=new Nl;for(var i=e.startIndex;i<e.endIndex;i++)this._score.systemStaff.addMeasure(A.as(e.score.systemStaff.getMeasureAt(A.intToUint(i)).clone(),hl));var n=!0,r=!1,o=void 0;try{for(var s,a=e.score.staves[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Rl),h=new Rl;for(this._score.addStaff(h).part=u.part,i=e.startIndex;i<e.endIndex;i++)h.addMeasure(A.as(u.getMeasureAt(A.intToUint(i)).clone(),hl))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}return p(t,null,[{key:"EXTERNAL_CLASSNAME",get:function(){return"score"}}]),p(t,[{key:"writeExternal",value:function(t){var e=new cr(this._score).xml;t.writeObject(e.toXMLString())}},{key:"readExternal",value:function(t){var e=A.unknownToType(t.readObject(),q);this.fromXML(e)}},{key:"toXML",value:function(){var e=new cr(this._score).xml;return e.setAttribute("className",t.EXTERNAL_CLASSNAME),e}},{key:"fromXML",value:function(t){this._score=(new ur).translateXml(t)}},{key:"score",get:function(){return this._score}}]),t}();r.implementsInterfaces(ti,[Ye,Ze]),r.registerClass(ti,"com.noteflight.notation.document.ScoreClipboard");var ei=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this)))._score=null,r._layoutContext=null,r._permissions=0,r._author=null,r._selection=null,r._entryAfterSelection=!1,r._dragHighlight=null,r._undoHistory=null,r._measureValidator=new je,r._savedUndoStateId=0,r._lastLineSpacing=0,r._activeStaff=null,r._$stringIndex=0,r._$advanceAfterNoteEntry=!0,ws.clear(),r._undoHistory=new oi(A.numberToUint(e.MAX_UNDO_ENTRIES),u(u(r))),r.score=t,r._permissions=i,r._author=n,r._measureValidator.addEventListener(Ai.SEQUENCE_CHANGE,xt.bindMethod(u(u(r)),r.handleValidateMeasure)),r._measureValidator.addEventListener(Ai.VALIDATE,xt.bindMethod(u(u(r)),r.handleValidateMeasure)),r._measureValidator.addEventListener(Ai.GEOMETRY_CHANGE,xt.bindMethod(u(u(r)),r.handleValidateMeasure)),r._measureValidator.addEventListener(Ai.SPAN_CHANGE,xt.bindMethod(u(u(r)),r.handleValidateMeasure)),r.markSaved(),r}return c(e,At),p(e,null,[{key:"MAX_UNDO_ENTRIES",get:function(){return 100}},{key:"EDIT_PERMISSION",get:function(){return 1}},{key:"COMMENT_PERMISSION",get:function(){return 2}},{key:"SAVE_PERMISSION",get:function(){return 4}},{key:"SAVE_COPY_PERMISSION",get:function(){return 8}},{key:"EXPORT_PERMISSION",get:function(){return 32}},{key:"TEMPLATE_CREATION_PERMISSION",get:function(){return 64}},{key:"PREMIUM_INSTRUMENTS_PERMISSION",get:function(){return 256}},{key:"USER_BASED_SHARING_PERMISSION",get:function(){return 512}},{key:"COLOR_PERMISSION",get:function(){return 1024}},{key:"MIXER_PERMISSION",get:function(){return 2048}},{key:"PART_DISPLAY_PERMISSION",get:function(){return 4096}},{key:"PROMPT_PERMISSION",get:function(){return 8192}},{key:"MIDI_PERMISSION",get:function(){return 16384}},{key:"DEVELOPER_FEATURES_PERMISSION",get:function(){return 32768}},{key:"EDIT_MARKINGS_PERMISSION",get:function(){return 65536}},{key:"SCORE_SHARING_PERMISSION",get:function(){return 131072}},{key:"ASH_FONT_PERMISSION",get:function(){return 262144}},{key:"CONTENT_INJECTION_PERMISSION",get:function(){return 524288}},{key:"SELECT_FONT_PERMISSION",get:function(){return 1048576}},{key:"TRANSCRIBER_PERMISSION",get:function(){return 2097152}},{key:"RECORDING_PERMISSION",get:function(){return 4194304}},{key:"PRINTING_PERMISSION",get:function(){return 16777216}},{key:"LONG_DELAY",get:function(){return 300}}]),p(e,[{key:"undo",value:function(){this._measureValidator.disableFixup(),this.undoHistory.undo(),this.validateNow()}},{key:"undoAll",value:function(){for(;this.undoHistory.canUndo;)this.undo()}},{key:"redo",value:function(){this._measureValidator.disableFixup(),this.undoHistory.redo(),this.validateNow()}},{key:"redoAll",value:function(){for(;this.undoHistory.canRedo;)this.redo()}},{key:"ensureStringIndexWithinBounds",value:function(){if(null!=this.selection&&this.selection.selectedNotations().length>0){var t=this.selection.selectedNotations()[0];if("measure"in A.unknownToObject(t)&&null!=t.measure.clef){var e=A.as(t.measure.clef,$l);e&&(this.stringIndex<0&&(this.stringIndex=0),this.stringIndex>=e.stringNotes.length&&(this.stringIndex=e.stringNotes.length-1))}}}},{key:"isModelEditable",value:function(t){return null!=t&&!(A.is(t,qa)&&!A.is(t,ll)&&A.as(t,qa).inSystemStaff)&&(this.editable||this.markingsEditable&&(A.is(t,bl)||A.is(t,Ra)||A.is(t,ul)||A.is(t,Aa)||A.is(t,Ua)||A.is(t,Pa)))}},{key:"markSaved",value:function(){this._savedUndoStateId=this._undoHistory.currentStateId}},{key:"markUnsaved",value:function(){this._savedUndoStateId=-1}},{key:"activeStaff",value:function(){return A.unknownToType(this._activeStaff||this.score.staves[0],Rl)}},{key:"adjustSelectionRelatedState",value:function(){if(A.is(this._selection,qe)){var t=A.as(this._selection,qe);if(1==t.selectedObjects.length&&A.is(t.selectedObjects[0],de)){var e=A.as(t.selectedObjects[0],de);A.is(e.measure.effectiveClef,$l)&&(this.stringIndex=e.stringIndex)}}this.ensureStringIndexWithinBounds()}},{key:"firstSelectedNotation",value:function(t){if(null==this.selection)return null;var e,i=!0,n=!1,r=void 0;try{for(var o,s=this.selection.selectedNotations()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;A.is(a,t)&&(null==e||ae.compareScorePosition(a,e)<0)&&(e=a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"select",value:function(t){if(null==this.selection||this.selection.empty)this.selection=t;else if(A.is(this.selection,qe)&&A.is(t,qe)){this.selection=A.unknownToType(this.selection,qe).union(A.unknownToType(t,qe));var e=!0,i=!1,n=void 0;try{for(var r,o=A.unknownToType(t,qe).selectedObjects[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,se);this.selection=A.unknownToType(this.selection,qe).difference(new qe(this.score,a.ancestors)),this.selection=A.unknownToType(this.selection,qe).difference(new qe(this.score,a.descendants))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}else this.selection=t}},{key:"deselect",value:function(t){if(A.is(this.selection,qe)&&A.is(t,qe)){var e=A.unknownToType(this.selection,qe).difference(A.unknownToType(t,qe));this.selection=e.empty?null:e}else this.selection=null}},{key:"deselectModelAndDescendants",value:function(t){A.is(this.selection,qe)&&(this.deselect(new qe(this.score,[t])),this.deselect(new qe(this.score,t.descendants)))}},{key:"reflowFromMeasure",value:function(t){this._measureValidator.measureChanged(t,Ai.VALIDATE)}},{key:"rebuildGeometry",value:function(){this._measureValidator.rebuildGeometry()}},{key:"validateNow",value:function(){this._measureValidator.processChanges()}},{key:"handleModelChange",value:function(t){if(t.kind==Ri.REMOVING_CHILD_MODEL){this.deselectModelAndDescendants(t.child);var e=!0,i=!1,n=void 0;try{for(var r,o=t.child.allAnnotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Ea),l=new Ri(Ri.MODEL_CHANGE,Ri.REMOVING_ANNOTATION,a.parent,a,-1);a.parent.dispatchEvent(l)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}if(A.is(t.child,he)&&!A.unknownToType(t.child,he).affectsParentLayout||this.invalidateModelParent(t.parent,null),A.is(t.child,kl)&&(t.kind==Ri.ADD_CHILD_MODEL||t.kind==Ri.REMOVING_CHILD_MODEL))for(var u=A.unknownToType(t.child,kl),h=u.measurePosition.measureIndex;h<=u.endPosition.measureIndex;h++)this._measureValidator.measureChanged(u.measure.staff.getMeasureAt(A.intToUint(h)),Ai.VALIDATE);if(A.is(t.child,hl)&&A.as(t.child,hl).isSystemMeasure){var c=A.as(t.child,hl);t.kind==Ri.ADD_CHILD_MODEL?this._measureValidator.measureChanged(c,Ai.SEQUENCE_CHANGE,Ai.ADD):t.kind==Ri.REMOVING_CHILD_MODEL&&this._measureValidator.measureChanged(c,Ai.SEQUENCE_CHANGE,Ai.REMOVE)}this.modelEventCausesMixerUpdate(t)&&this.dispatchEvent(new Ji(Ji.MIXER_SETTINGS_CHANGE))}},{key:"handleModelUpdate",value:function(t){if(this.modelUpdateCausesMixerUpdate(t)&&this.dispatchEvent(new Ji(Ji.MIXER_SETTINGS_CHANGE)),A.is(t.source,Nl))switch(t.property.toString()){case"displayMode":case"viewScale":case"playbackMode":case"synchronizedTrack":return void this.dispatchEvent(t)}A.is(t.source,se)&&!A.unknownToType(t.source,se).layoutPropertyChange(t)||this.invalidateModelParent(t.source,t.property.toString())}},{key:"modelEventCausesMixerUpdate",value:function(t){return t.parent instanceof wl||(t.child instanceof wl||t.child instanceof Rl)}},{key:"modelUpdateCausesMixerUpdate",value:function(t){return t.source instanceof Al||(t.source instanceof El||(t.source instanceof Rl&&"part"==t.property||t.source instanceof Nl&&"synchronizedTrack"==t.property))}},{key:"handleSpanChange",value:function(t){this._measureValidator.measureChanged(t.measure,t.requestValidate?Ai.VALIDATE:Ai.SPAN_CHANGE),t.requestValidate&&this._measureValidator.disableFixup()}},{key:"recalculateLineSpacing",value:function(){var t=this.score.effectiveStaffMetrics.scoreLineSpacing;t!=this._lastLineSpacing&&(this._lastLineSpacing=this.score.effectiveStaffMetrics.lineSpacing=t,this.foundryChanged())}},{key:"foundryChanged",value:function(){this.dispatchEvent(new Ai(Ai.FOUNDRY_CHANGE))}},{key:"rebuildScore",value:function(){this._measureValidator.rebuildScore()}},{key:"resetValidation",value:function(){this._measureValidator.reset()}},{key:"requestModelChange",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.LONG_DELAY;this._measureValidator.requestModelChange(t,i)}},{key:"invalidateModelParent",value:function(t,e){if(A.is(t,Nl)){if("transposeParts"==e){var i=!0,n=!1,r=void 0;try{for(var o,s=this.score.atonalKeySignatureMeasures[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.invalidateAccidentals(),a.cleanUpAccidentals()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}"staffMetrics"!=e&&"pageMetrics"!=e||this.recalculateLineSpacing(),this._measureValidator.rebuildScore()}else if(A.is(t,El))"visible"==e&&this.recalculateLineSpacing(),this._measureValidator.rebuildScore();else if(A.is(t,Rl))"part"!=e&&"overrideClef"!=e||this._measureValidator.rebuildScore();else if(A.is(t,pn))"scoreLineSpacing"==e?this.recalculateLineSpacing():"glyphFamily"==e?this.foundryChanged():"lineSpacing"!=e&&this._measureValidator.rebuildScore();else if(A.is(t,hr))this._measureValidator.rebuildScore();else if(A.is(t,hl)){var l=A.as(t,hl);switch(e){case"breakType":this._measureValidator.measureChanged(l,Ai.SEQUENCE_CHANGE,Ai.REFLOW);break;case"disableCautionaries":this._measureValidator.measureChanged(l,Ai.SEQUENCE_CHANGE);break;case"canHideStaff":case"systemGap":this._measureValidator.measureChanged(l,Ai.SEQUENCE_CHANGE),l.index>0&&this._measureValidator.measureChanged(l.previousMeasure,Ai.SEQUENCE_CHANGE);break;case"startRepeat":this._measureValidator.measureChanged(l,Ai.VALIDATE),l.index>0&&this._measureValidator.measureChanged(l.previousMeasure,Ai.VALIDATE);break;case"tempo":l.nextMeasure&&this._layoutContext.scoreLayout.isFirstMeasureOfChunk(A.intToUint(l.nextMeasure.index))&&this._measureValidator.measureChanged(l,Ai.SEQUENCE_CHANGE),l.index>0&&this._layoutContext.scoreLayout.isFirstMeasureOfChunk(A.intToUint(l.index))&&this._measureValidator.measureChanged(l.previousMeasure,Ai.SEQUENCE_CHANGE);break;case"blocks":l.index>0?this._measureValidator.measureChanged(l.previousMeasure,Ai.SEQUENCE_CHANGE,Ai.REFLOW):this._measureValidator.measureChanged(l,Ai.SEQUENCE_CHANGE,Ai.REFLOW);break;case"measureNumber":this._measureValidator.rebuildScore();break;default:this._measureValidator.measureChanged(l,Ai.VALIDATE)}}else if(A.is(t,xa))t.block&&t.block.measure&&(t.block.measure.index>0?this._measureValidator.measureChanged(t.block.measure.previousMeasure,Ai.SEQUENCE_CHANGE,Ai.REFLOW):this._measureValidator.measureChanged(t.block.measure,Ai.SEQUENCE_CHANGE,Ai.REFLOW));else if(A.is(t,Ha))this._measureValidator.measureChanged(A.unknownToType(t,Ha).measure,Ai.VALIDATE);else if(A.is(t,ll)){if(!t.measure)return;for(var u=t.measure.index;u<=t.endPosition.measureIndex;u++){var h=t.measure.staff.getMeasureAt(u);h&&this._measureValidator.measureChanged(h,Ai.VALIDATE)}}else if(A.is(t,Ua));else if(A.is(t,he)){var c=A.unknownToType(t,he).measure;null!=c&&this._measureValidator.measureChanged(c,Ai.VALIDATE)}}},{key:"handleValidateMeasure",value:function(t){this.dispatchEvent(t)}},{key:"dispatchSelectEvent",value:function(t,e,i){if(null!=e&&!e.empty){var n=new Gi(t,e);this.dispatchEvent(n),e.dispatchStatusChange(),A.is(e,qe)&&i&&e.selectedMeasures.dispatchStatusChange()}}},{key:"stringIndex",get:function(){return this._$stringIndex},set:function(t){var e=this._$stringIndex;this._$stringIndex=t,e!==t&&this._propertyChanged("stringIndex",e,t)}},{key:"advanceAfterNoteEntry",get:function(){return this._$advanceAfterNoteEntry},set:function(t){var e=this._$advanceAfterNoteEntry;this._$advanceAfterNoteEntry=t,e!==t&&this._propertyChanged("advanceAfterNoteEntry",e,t)}},{key:"measureValidator",get:function(){return this._measureValidator}},{key:"undoHistory",get:function(){return this._undoHistory}},{key:"permissions",get:function(){return this._permissions},set:function(t){this._permissions=t}},{key:"author",get:function(){return this._author}},{key:"editable",get:function(){return 0!=(this._permissions&e.EDIT_PERMISSION)}},{key:"editableWithNotePalette",get:function(){return this.editable||this.markingsEditable}},{key:"markingsEditable",get:function(){return this.editable||0!=(this._permissions&e.EDIT_MARKINGS_PERMISSION)}},{key:"score",get:function(){return this._score},set:function(t){this._score!=t&&(null!=this._score&&(this._score.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleModelChange)),this._score.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate)),this._score.removeEventListener(zi.SPAN_CHANGE,xt.bindMethod(this,this.handleSpanChange))),this._score=t,this._undoHistory.clear(),null!=this._score&&(this._score.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleModelChange)),this._score.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate)),this._score.addEventListener(zi.SPAN_CHANGE,xt.bindMethod(this,this.handleSpanChange))))}},{key:"layoutContext",get:function(){return this._layoutContext},set:function(t){this._layoutContext=t}},{key:"requiresSave",get:function(){return this.editable&&0!=(this.permissions&e.SAVE_PERMISSION)&&this._savedUndoStateId!=this._undoHistory.currentStateId}},{key:"selection",get:function(){return this._selection},set:function(t){if(t){var e=t.selectedRange.staves;e.length&&(this._activeStaff=A.unknownToType(e[0],Rl))}var i=this._selection;if(this._selection=t,this.adjustSelectionRelatedState(),null!=i||null!=t)if(null==i)this.dispatchSelectEvent(Gi.ADD_SELECTION,t,!0);else if(null==t)this.dispatchSelectEvent(Gi.REMOVE_SELECTION,i,!0);else if(A.is(i,qe)&&A.is(t,qe)){var n=A.as(i,qe),r=A.as(t,qe);this.dispatchSelectEvent(Gi.REMOVE_SELECTION,n.difference(r),!1),this.dispatchSelectEvent(Gi.ADD_SELECTION,r.difference(n),!1),i.selectedMeasures.dispatchStatusChange(),t.selectedMeasures.dispatchStatusChange()}else this.dispatchSelectEvent(Gi.REMOVE_SELECTION,i,!0),this.dispatchSelectEvent(Gi.ADD_SELECTION,t,!0)}},{key:"dragHighlight",get:function(){return this._dragHighlight},set:function(t){var e=this._dragHighlight;this._dragHighlight=t,null!=e&&e.dispatchStatusChange(),null!=t&&t.dispatchStatusChange()}},{key:"firstSelectedNoteSet",get:function(){if(null==this.selection)return null;var t=null,e=!0,i=!1,n=void 0;try{for(var r,o=this.selection.selectedNotations()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=null;A.is(s,de)?a=A.unknownToType(s,de).noteSet:A.is(s,Sn)&&(a=A.unknownToType(s,Sn)),(null==t||null!=a&&ae.compareScorePosition(a,t)<0)&&(t=a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"firstSelectedMeasureIndex",get:function(){return null==this.selection?null:this.selection.selectedMeasures.startIndex}},{key:"lastSelectedNoteSet",get:function(){if(null==this.selection)return null;var t=null,e=!0,i=!1,n=void 0;try{for(var r,o=this.selection.selectedNotations().reverse()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=null;A.is(s,de)?a=A.unknownToType(s,de).noteSet:A.is(s,Sn)&&(a=A.unknownToType(s,Sn)),(null==t||null!=a&&ae.compareScorePosition(a,t)>0)&&(t=a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"firstSelectedNote",get:function(){if(null==this.selection)return null;var t=null,e=!0,i=!1,n=void 0;try{for(var r,o=this.selection.selectedNotations()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=null;A.is(s,de)?a=A.unknownToType(s,de):A.is(s,Sn)&&A.unknownToType(s,Sn).notes.length>0&&(a=A.unknownToType(s,Sn).notes[0]),(null==t||null!=a&&(ae.compareScorePosition(a.noteSet,t.noteSet)<0||a.noteSet==t.noteSet&&de.compareNotePitch(a,t)<0))&&(t=a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"firstSelectedBarline",get:function(){var t=A.as(this.firstSelectedNotation(En),En);if(!t){var e=this.selection.selectedMeasures.endIndex-1;e>=0&&(t=this.score.systemStaff.getMeasureAt(A.intToUint(e)).barlineNotation)}return t}},{key:"tablatureSelection",get:function(){return null!=this.firstSelectedNoteSet&&A.is(this.firstSelectedNoteSet.measure.effectiveClef,$l)}},{key:"entryAfterSelection",get:function(){return this._entryAfterSelection},set:function(t){var e=this._entryAfterSelection;if(t!=e){this._entryAfterSelection=t;var i=new ki(ki.DOCUMENT_UPDATE,"entryAfterSelection",e,this.entryAfterSelection,this);this.dispatchEvent(i),null!=this.selection&&this.selection.selectedMeasures.dispatchStatusChange()}}},{key:"playbackStaves",get:function(){if(A.is(this.selection,Je)){var t=A.as(this.selection,Je);if(t.includesEntireStaffRange(t.staves[0],0,this.score.numMeasures)&&1==t.staves.length)return t.staves}return this.score.staves.slice()}}]),e}();r.registerClass(ei,"com.noteflight.notation.document.ScoreDocument");var ii=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return y(this,e),(t=l(this,h(e).call(this)))._$username=null,t._$userId=null,t._$homepageUri=null,t._$avatarUri=null,t._$premiumMember=!1,t._$identified=!1,t.username=i,t.userId=n,t.homepageUri=r,t.avatarUri=o,t.premiumMember=s,t.identified=a,t}return c(e,At),p(e,[{key:"username",get:function(){return this._$username},set:function(t){var e=this._$username;this._$username=t,e!==t&&this._propertyChanged("username",e,t)}},{key:"userId",get:function(){return this._$userId},set:function(t){var e=this._$userId;this._$userId=t,e!==t&&this._propertyChanged("userId",e,t)}},{key:"homepageUri",get:function(){return this._$homepageUri},set:function(t){var e=this._$homepageUri;this._$homepageUri=t,e!==t&&this._propertyChanged("homepageUri",e,t)}},{key:"avatarUri",get:function(){return this._$avatarUri},set:function(t){var e=this._$avatarUri;this._$avatarUri=t,e!==t&&this._propertyChanged("avatarUri",e,t)}},{key:"premiumMember",get:function(){return this._$premiumMember},set:function(t){var e=this._$premiumMember;this._$premiumMember=t,e!==t&&this._propertyChanged("premiumMember",e,t)}},{key:"identified",get:function(){return this._$identified},set:function(t){var e=this._$identified;this._$identified=t,e!==t&&this._propertyChanged("identified",e,t)}}]),e}();r.registerClass(ii,"com.noteflight.notation.document.ScoreUser");var ni=function(){function t(e){y(this,t),this._document=null,this._document=e}return p(t,[{key:"decodeSelection",value:function(t){this._document.selection=this.doDecodeSelection(t)}},{key:"doDecodeSelection",value:function(t){var e;if(null!=(e=/m(\d+)(-(\d+))?/.exec(t))){var i=this.parseMeasureIndex(e[1]);if(null==e[3])return new Ke(this._document.score,i,i+1);var n=this.parseMeasureIndex(e[3])+1;return new Ke(this._document.score,i,n)}if(null!=(e=/s([0-9,]+)r(\d+)p(\d+)-(\d+)p(\d+)/.exec(t))){var r=e[1].split(","),o=[],s=!0,a=!1,l=void 0;try{for(var u,h=r[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=A.unknownToString(c);if(""!==d){var f=this._document.score.getStaffAt(A.numberToUint(A.stringToNumber(d)-1));null!=f&&o.push(f)}}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}var y=this.parseMeasurePosition(e[2],e[3]),g=this.parseMeasurePosition(e[4],e[5]);return new Je(this._document.score,y,g,o)}if(null!=(e=/o(.+)/.exec(t))){var p=e[1].split(","),m=[],v=!0,_=!1,S=void 0;try{for(var L,k=p[Symbol.iterator]();!(v=(L=k.next()).done);v=!0){var T=L.value,E=A.unknownToString(T);if(""!==E){var M=this._document.score.resolvePath(E);A.is(M,he)&&m.push(M)}}}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}return new qe(this._document.score,m)}return null}},{key:"parseMeasureIndex",value:function(t){return A.numberToInt(Math.max(0,Math.min(this._document.score.numMeasures,A.stringToNumber(t)-1)))}},{key:"parseMeasurePosition",value:function(t,e){var i=this.parseMeasureIndex(t),n=this._document.score.systemStaff.getMeasureAt(A.intToUint(i)),r=Math.max(0,Math.min(n.duration,A.stringToNumber(e)));return new gl(A.intToUint(i),r)}},{key:"encodeSelection",value:function(){return this.doEncodeSelection(this._document.selection)}},{key:"doEncodeSelection",value:function(t){if(A.is(t,Ke)){var e=A.as(t,Ke);return"m"+this.indexRange(e.startIndex,e.endIndex)}if(A.is(t,Je)){var i=A.as(t,Je);return"s"+this.staffIndexList(i.staves)+"r"+this.measurePositionToString(i.start)+"-"+this.measurePositionToString(i.end)}if(A.is(t,qe)){var n=A.as(t,qe);return"o"+this.objectPathList(n.selectedNotations())}return""}},{key:"indexRange",value:function(t,e){return e==t+1?(t+1).toString():(t+1).toString()+"-"+e}},{key:"staffIndexList",value:function(t){var e="",i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);e.length>0&&(e+=","),e+=(l.index+1).toString()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"objectPathList",value:function(t){var e="",i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,he);e.length>0&&(e+=","),e+=l.path}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"measurePositionToString",value:function(t){return(t.measureIndex+1).toString()+"p"+Math.round(t.position)}}]),t}();r.registerClass(ni,"com.noteflight.notation.document.SelectionEncoder");var ri=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this._sequences=[],this._duration=0,this._fromObjects=!1,null!=e&&this.addRange(e)}return p(t,null,[{key:"EXTERNAL_CLASSNAME",get:function(){return"sequence"}}]),p(t,[{key:"addRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!0,n=!1,r=void 0;try{for(var o,s=t.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=this.createStaffSequence(a,t.start,t.end,e);this._duration=Math.max(this._duration,l.duration),this._sequences.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"createStaffSequence",value:function(t,e,i,n){for(var r=new Pl,o=-e.position,s=e.measureIndex;s<=i.measureIndex;s++){var a=t.getMeasureAt(A.intToUint(s)),l=!0,u=!1,h=void 0;try{for(var c,d=a.measureElements[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,y=A.unknownToType(f,ue),g=new gl(A.intToUint(s),y.position);if(y.duration>0&&g.compareTo(e)>=0&&g.compareTo(i)<0||0===y.duration&&g.compareTo(e)>=0&&g.compareTo(i)<=0){var p=y;if(null!=n&&(p=A.unknownToType(n(p),ue)),A.is(p,Gl)){var m=A.as(p,Gl);r.duration=Math.max(r.duration,m.position+m.duration+o)}else if(A.is(p,ae)){var v=A.as(A.unknownToType(p,ae).clone(),ae);A.is(p,vl)&&(v.rhythmDuration=y.duration),v.rhythmPosition=A.numberToUint(y.position+o),r.addElement(A.as(v,ue))}}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}o+=a.duration}return r}},{key:"writeExternal",value:function(t){var e=[];this._fromObjects&&e.push("<fromObjects/>");var i=!0,n=!1,r=void 0;try{for(var o,s=this._sequences[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Pl);e.push(cr.generateSequence(l).toXMLString())}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}t.writeObject(e)}},{key:"readExternal",value:function(t){this._sequences=[];var e=A.as(t.readObject(),Array);"<fromObjects/>"==e[0]&&(this._fromObjects=!0,e.shift());var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToString(a),u=(new ur).translateSequence(A.unknownToType(l,q));this._duration=Math.max(this._duration,u.duration),this._sequences.push(u)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"toXML",value:function(){var e=A.unknownToType("<sequences/>",q);e.setAttribute("className",t.EXTERNAL_CLASSNAME),this._fromObjects&&e.appendChild(A.unknownToType("<fromObjects/>",q));var i=!0,n=!1,r=void 0;try{for(var o,s=this._sequences[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Pl);e.appendChild(cr.generateSequence(l))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"fromXML",value:function(t){t.child("fromObjects").length()>0&&(this._fromObjects=!0);var e=t.child("sequence"),i=!0,n=!1,r=void 0;try{for(var o,s=e.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=(new ur).translateSequence(a);this._duration=Math.max(this._duration,l.duration),this._sequences.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"duration",get:function(){return this._duration}},{key:"sequences",get:function(){return this._sequences},set:function(t){this._sequences=t,this._duration=0;var e=!0,i=!1,n=void 0;try{for(var r,o=this._sequences[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Pl);this._duration=Math.max(this._duration,a.duration)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"fromObjects",get:function(){return this._fromObjects},set:function(t){this._fromObjects=t}},{key:"singleVoiceNumber",get:function(){return this._sequences.length>1?Kl.UNKNOWN_VOICE_NUMBER:A.unknownToType(this._sequences[0],Pl).singleVoiceNumber}}]),t}();r.implementsInterfaces(ri,[Ye,Ze]),r.registerClass(ri,"com.noteflight.notation.document.SequenceClipboard");var oi=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._groups=null,n._cursor=0,n._groupOpen=!1,n._maxGroups=0,n.infiniteUndo=!1,n._enabled=!1,n._initialStateId=0,n._scoreDocument=null,n._maxGroups=t,n._scoreDocument=i,n.clear(),n}return c(e,At),p(e,null,[{key:"_nextStateId",get:function(){return si},set:function(t){si=t}}]),p(e,[{key:"clear",value:function(){this._groupOpen=!1,this._enabled=!0,this._groups=[],this._cursor=0,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE))}},{key:"getGroupAt",value:function(t){return A.as(this._groups[t],ai)}},{key:"undo",value:function(){if(this.canUndo){var t=this.getGroupAt(A.intToUint(--this._cursor));this.dispatchEvent(new Zi(Zi.UNDO_ABOUT_TO_UNDO,t.name)),this._groupOpen=!1,this._enabled=!1,t.undo(),this._enabled=!0,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE))}}},{key:"redo",value:function(){if(this.canRedo){var t=this.getGroupAt(A.intToUint(this._cursor++));this.dispatchEvent(new Zi(Zi.UNDO_ABOUT_TO_REDO,t.name)),this._groupOpen=!1,this._enabled=!1,t.redo(),this._enabled=!0,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE))}}},{key:"addEdit",value:function(t){if(this._enabled&&(this._groupOpen&&(this._cursor++,this._groupOpen=!1,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE))),this.numGroups>0)){var i=this.getGroupAt(A.intToUint(this.numGroups-1)),n=t.changesContent&&!i.changesContent;i.addEdit(t),n&&(i.stateId=++e._nextStateId,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE)))}}},{key:"reopenGroup",value:function(){if(this.canUndo&&!this._groupOpen){var t=this.getGroupAt(A.intToUint(this.numGroups-1));this._enabled=!1,t.undo(),this._enabled=!0,t.clear(),this._cursor--,this._groupOpen=!0}}},{key:"openGroup",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._cursor;n<this._groups.length;n++){var r=this._groups[n];null!=r&&r.releaseUndoData()}this._groups=this._groups.slice(0,this._cursor),this._groupOpen=!1,this.infiniteUndo||this.numGroups!=this._maxGroups||(this._initialStateId=this.getGroupAt(0).stateId,this._groups.shift(),this._cursor--),this._groups.push(new ai(this,t,e._nextStateId,i)),this._groupOpen=!0,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE)),this.dispatchEvent(new Zi(Zi.UNDO_GROUP_OPENED,t))}},{key:"dispatchUndoEvent",value:function(t){this._scoreDocument.dispatchEvent(t)}},{key:"numGroups",get:function(){return A.intToUint(this._groupOpen?this._groups.length-1:this._groups.length)}},{key:"canUndo",get:function(){return this._cursor>0}},{key:"canRedo",get:function(){return this._cursor<this.numGroups}},{key:"undoName",get:function(){return this.canUndo?this.getGroupAt(A.intToUint(this._cursor-1)).name:""}},{key:"redoName",get:function(){return this.canRedo?this.getGroupAt(A.intToUint(this._cursor)).name:""}},{key:"currentStateId",get:function(){return this.canUndo?this.getGroupAt(A.intToUint(this._cursor-1)).stateId:this._initialStateId}},{key:"openGroupName",get:function(){return this.getGroupAt(A.intToUint(this._groups.length-1)).name},set:function(t){this.getGroupAt(A.intToUint(this._groups.length-1)).name=t,this.dispatchEvent(new Zi(Zi.UNDO_HISTORY_CHANGE)),this.dispatchEvent(new Zi(Zi.UNDO_GROUP_NAME_CHANGED,t))}}]),e}(),si=0;r.registerClass(oi,"com.noteflight.notation.document.UndoHistory");var ai=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y(this,t),this.undoController=null,this.name=null,this.stateId=0,this.eventName=null,this._edits=[],this._changesContent=!1,this._frozen=!1,this.undoController=e,this.name=i,this.stateId=n,this.eventName=r}return p(t,[{key:"addEdit",value:function(t){this._frozen||(this._edits.push(t),t.changesContent&&(this._changesContent=!0))}},{key:"redo",value:function(){for(var t=0;t<this._edits.length;t++)A.unknownToType(this._edits[t],We).redo();this.eventName&&this.undoController.dispatchUndoEvent(new Zi(this.eventName))}},{key:"undo",value:function(){this._frozen=!0;for(var t=this._edits.length-1;t>=0;t--)A.unknownToType(this._edits[t],We).undo();this.eventName&&this.undoController.dispatchUndoEvent(new Zi(this.eventName))}},{key:"clear",value:function(){this._edits=[]}},{key:"releaseUndoData",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._edits[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.releaseUndoData()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"edits",get:function(){return this._edits}},{key:"changesContent",get:function(){return this._changesContent}}]),t}();r.implementsInterfaces(ai,[We]),r.registerClass(ai,"com.noteflight.notation.document.UndoableEditGroup");var li=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:NaN,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]&&arguments[9],g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11&&void 0!==arguments[11]&&arguments[11],m=arguments.length>12&&void 0!==arguments[12]&&arguments[12],v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0;return y(this,e),(i=l(this,h(e).call(this))).altKey=!1,i.buttonDown=!1,i.clickCount=0,i.commandKey=!1,i.controlKey=!1,i.ctrlKey=!1,i.delta=0,i.isRelatedObjectInaccessible=!1,i.localX=NaN,i.localY=NaN,i.movementX=NaN,i.movementY=NaN,i.relatedObject=null,i.shiftKey=!1,i.stageX=NaN,i.stageY=NaN,i.type=t,i.bubbles=n,i.cancelable=r,i.localX=o,i.localY=s,i.relatedObject=a,i.ctrlKey=u||p,i.altKey=c,i.shiftKey=d,i.buttonDown=f,i.delta=g,i.commandKey=p,i.controlKey=m,i.clickCount=v,i}return c(e,ct),p(e,null,[{key:"CLICK",get:function(){return"click"}},{key:"CONTEXT_MENU",get:function(){return"contextMenu"}},{key:"DOUBLE_CLICK",get:function(){return"doubleClick"}},{key:"MIDDLE_CLICK",get:function(){return"middleClick"}},{key:"MIDDLE_MOUSE_DOWN",get:function(){return"middleMouseDown"}},{key:"MIDDLE_MOUSE_UP",get:function(){return"middleMouseUp"}},{key:"MOUSE_DOWN",get:function(){return"mouseDown"}},{key:"MOUSE_MOVE",get:function(){return"mouseMove"}},{key:"MOUSE_OUT",get:function(){return"mouseOut"}},{key:"MOUSE_OVER",get:function(){return"mouseOver"}},{key:"MOUSE_UP",get:function(){return"mouseUp"}},{key:"MOUSE_WHEEL",get:function(){return"mouseWheel"}},{key:"RELEASE_OUTSIDE",get:function(){return"releaseOutside"}},{key:"RIGHT_CLICK",get:function(){return"rightClick"}},{key:"RIGHT_MOUSE_DOWN",get:function(){return"rightMouseDown"}},{key:"RIGHT_MOUSE_UP",get:function(){return"rightMouseUp"}},{key:"ROLL_OUT",get:function(){return"rollOut"}},{key:"ROLL_OVER",get:function(){return"rollOver"}},{key:"TOUCHSTART",get:function(){return"touchstart"}},{key:"TOUCHEND",get:function(){return"touchend"}}]),e}();r.registerClass(li,"flash.events.MouseEvent");var ui=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]&&arguments[9],g=arguments.length>10&&void 0!==arguments[10]&&arguments[10];return y(this,e),(i=l(this,h(e).call(this,t,n,r))).altKey=!1,i.charCode=0,i.commandKey=!1,i.controlKey=!1,i.ctrlKey=!1,i.keyCode=0,i.keyLocation=0,i.shiftKey=!1,i.charCode=o,i.keyCode=s,i.keyLocation=a,i.ctrlKey=u,i.altKey=c,i.shiftKey=d,i.controlKey=f,i.commandKey=g,i}return c(e,ct),p(e,null,[{key:"KEY_DOWN",get:function(){return"keyDown"}},{key:"KEY_UP",get:function(){return"keyUp"}}]),e}();r.registerClass(ui,"flash.events.KeyboardEvent");var hi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:NaN,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:NaN;return y(this,e),(i=l(this,h(e).call(this,t,n,r))).delta=NaN,i.detail=null,i.direction=null,i.position=NaN,i.detail=o,i.position=s,i.direction=a,i.delta=u,i}return c(e,ct),p(e,null,[{key:"SCROLL",get:function(){return"scroll"}}]),e}();r.registerClass(hi,"mx.events.ScrollEvent");var ci=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t))).options=null,i.options=n,i}return c(e,ct),p(e,null,[{key:"SCORE_LAYOUT_CHANGE",get:function(){return"scoreLayoutChange"}},{key:"DISPLAY_SCALE_CHANGE",get:function(){return"displayScaleChange"}},{key:"REBUILD_LAYOUT",get:function(){return"rebuildLayout"}},{key:"FORCE_PAGE_FLOW",get:function(){return"forcePageFlow"}},{key:"CANCEL_FORCE_BUILD",get:function(){return"cancelForceBuild"}},{key:"PREFERENCES_SAVE",get:function(){return"preferencesSave"}},{key:"OPTIONS_CHANGE",get:function(){return"optionsChange"}},{key:"REQUEST_INSTRUMENTS",get:function(){return"requestInstruments"}},{key:"REQUEST_AUDIO",get:function(){return"requestAudio"}},{key:"EDITOR_READY",get:function(){return"editorReady"}},{key:"SCORE_READY",get:function(){return"scoreReady"}},{key:"LAYOUT_UPDATED",get:function(){return"layoutUpdated"}},{key:"PRINT_SCORE",get:function(){return"printScore"}},{key:"MAJOR_NOTATION_CHANGE",get:function(){return"majorNotationChange"}},{key:"EDITOR_CLICK",get:function(){return"editorClick"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(ci,"com.noteflight.notation.event.EditorEvent");var di=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_INITIAL_IDLE_TIMEOUT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.DEFAULT_SUBSEQUENT_IDLE_TIMEOUT;return y(this,e),(i=l(this,h(e).call(this)))._target=null,i.initialIdleTimeout=NaN,i.subsequentIdleTimeout=NaN,i._paused=!1,i._idleTimer=new By(e.DEFAULT_INITIAL_IDLE_TIMEOUT),i._enabled=!1,i.initialIdleTimeout=n,i.subsequentIdleTimeout=r,i._target=t,i}return c(e,At),p(e,null,[{key:"DEFAULT_INITIAL_IDLE_TIMEOUT",get:function(){return 1e4}},{key:"VIEWER_INITIAL_IDLE_TIMEOUT",get:function(){return 500}},{key:"ASAP_INITIAL_IDLE_TIMEOUT",get:function(){return 100}},{key:"DEFAULT_SUBSEQUENT_IDLE_TIMEOUT",get:function(){return 500}},{key:"ACTIVITY_EVENTS",get:function(){return fi}}]),p(e,[{key:"addEventListeners",value:function(){var t=!0,i=!1,n=void 0;try{for(var r,o=e.ACTIVITY_EVENTS[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,a=A.unknownToString(s);this._target.addEventListener(a,xt.bindMethod(this,this.onActivity))}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}this._idleTimer.addEventListener(Nf.TIMER,xt.bindMethod(this,this.onTimer))}},{key:"removeEventListeners",value:function(){var t=!0,i=!1,n=void 0;try{for(var r,o=e.ACTIVITY_EVENTS[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,a=A.unknownToString(s);this._target.removeEventListener(a,xt.bindMethod(this,this.onActivity))}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}this._idleTimer.removeEventListener(Nf.TIMER,xt.bindMethod(this,this.onTimer))}},{key:"stop",value:function(){this._idleTimer.stop()}},{key:"start",value:function(){this._idleTimer.delay=this.initialIdleTimeout,this._idleTimer.start()}},{key:"onActivity",value:function(t){this.start()}},{key:"onTimer",value:function(t){this._paused||(this.dispatchEvent(new Ei(Ei.IDLE)),this._idleTimer.delay=this.subsequentIdleTimeout,this._idleTimer.start())}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!=t&&(this._enabled=t,t?(this.addEventListeners(),this.start()):(this.removeEventListeners(),this.stop()))}},{key:"paused",set:function(t){this._enabled&&(this._paused=t,this._paused?this.stop():this.start())},get:function(){return this._paused}}]),e}(),fi=[li.MOUSE_DOWN,li.MOUSE_MOVE,li.CLICK,ui.KEY_DOWN,hi.SCROLL,ci.DISPLAY_SCALE_CHANGE];r.registerClass(di,"com.noteflight.notation.editor.IdleManager");var yi=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._documentController=null,i._midiInputMode=null,i._isMidiRecording=!1,i._noteSet=null,i._premiumAlertShown=!1,i.lastBendValue=0,i.lastControllerValue=0,i._documentController=t,i._midiInputMode=i.createMidiInputStep(),i}return c(e,At),p(e,null,[{key:"CONTROLLER_THRESHOLD",get:function(){return 32}}]),p(e,[{key:"createMidiInputStep",value:function(){return new pi(this._documentController)}},{key:"createMidiInputTranscriber",value:function(){return new mi(this._documentController)}},{key:"initializeState",value:function(){this.lastBendValue=this.lastControllerValue=0}},{key:"checkMidiEnabled",value:function(){return null!=this._documentController.scoreDocument&&!this._documentController.controller.marketplace&&(0!=(this._documentController.scoreDocument.permissions&ei.MIDI_PERMISSION)||(this._premiumAlertShown||(Gy.show(Ou.getString("alert.midiRecordingPremiumOnly")),this._premiumAlertShown=!0),!1))}},{key:"handleServiceConnected",value:function(t){this.initializeState(),this._documentController.controller.logToAnalytics("midi","connect")}},{key:"handleServiceDisconnected",value:function(t){}},{key:"handleServiceError",value:function(t){}},{key:"handlePitchBend",value:function(t){this.checkMidiEnabled()&&(0===this.lastBendValue&&0!==t.message.value&&(this._documentController.scoreDocument.undoHistory.openGroup("Change Rhythm"),this._documentController.controller.stepSelectionDuration(t.message.value<0?-1:1)),this.lastBendValue=t.message.value)}},{key:"handleController",value:function(t){if(this.checkMidiEnabled()){if(this.lastControllerValue<e.CONTROLLER_THRESHOLD&&t.message.value>=e.CONTROLLER_THRESHOLD)switch(t.message.parameter){case 64:this._documentController.scoreDocument.undoHistory.openGroup("Change Ties"),this._documentController.controller.modifyTies();break;case 66:this._documentController.scoreDocument.undoHistory.openGroup("Change Rhythm"),this._documentController.controller.stepSelectionDuration(1);break;case 67:this._documentController.scoreDocument.undoHistory.openGroup("Change Rhythm"),this._documentController.controller.stepSelectionDuration(-1);break;case 1:this._documentController.scoreDocument.undoHistory.openGroup("Move Right"),this._documentController.controller.selectNextNoteSet(),this._documentController.ensureSelectionVisible()}this.lastControllerValue=t.message.value}}},{key:"connectMidiInputService",value:function(t){t.addEventListener(Pi.CONNECTED,xt.bindMethod(this,this.handleServiceConnected)),t.addEventListener(Pi.DISCONNECTED,xt.bindMethod(this,this.handleServiceDisconnected)),t.addEventListener(Pi.ERROR,xt.bindMethod(this,this.handleServiceError)),t.addEventListener(Oi.NOTE_ON,xt.bindMethod(this,this.handleNoteOn)),t.addEventListener(Oi.NOTE_OFF,xt.bindMethod(this,this.handleNoteOff)),t.addEventListener(Oi.PITCH_BEND,xt.bindMethod(this,this.handlePitchBend)),t.addEventListener(Oi.CONTROLLER,xt.bindMethod(this,this.handleController))}},{key:"handleNoteOn",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.checkMidiEnabled()&&(this._midiInputMode.doNoteOn(t,e),this.dispatchEvent(new Oi(Oi.NOTE_ON,t.message)))}},{key:"handleNoteOff",value:function(t){this.checkMidiEnabled()&&(this._midiInputMode.doNoteOff(t),this.dispatchEvent(new Oi(Oi.NOTE_OFF,t.message)))}},{key:"startStopMidiRecording",value:function(t){this._isMidiRecording=t,this._midiInputMode=A.unknownToType(t?this.createMidiInputTranscriber():this.createMidiInputStep(),gi)}},{key:"isMidiRecording",get:function(){return this._isMidiRecording}}]),e}();r.registerClass(yi,"com.noteflight.notation.editor.MidiInputManager");var gi=function(){function t(e){y(this,t),this._documentController=null,this._documentController=e}return p(t,[{key:"handleNoteOn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.doNoteOn(t,e)}},{key:"doNoteOn",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("doNoteOn not overridden")}},{key:"handleNoteOff",value:function(t){this.doNoteOff(t)}},{key:"doNoteOff",value:function(t){throw new Error("doNoteOFf not overridden")}},{key:"documentController",get:function(){return this._documentController}}]),t}();r.registerClass(gi,"com.noteflight.notation.editor.MidiInputMode");var pi=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t)))._selectionAlertShown=!1,i._midiInputSeen=!1,i._chordCounter=0,i._lastNoteTime=0,i}return c(e,gi),p(e,null,[{key:"MIN_CHORD_MILLIS",get:function(){return 3e3}}]),p(e,[{key:"doNoteOn",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.documentController.controller.document.undoHistory.openGroup("Enter Note");var n=new Date;A.numberToUint(n.time/1e3);null!=this.documentController.scoreDocument.selection||this._selectionAlertShown||(Gy.show(Ou.getString("alerts/midiInputNeedsLocationMessage"),Ou.getString("alerts/midiInputNeedsLocationTitle")),this._selectionAlertShown=!0),t.message.timestamp-this._lastNoteTime>e.MIN_CHORD_MILLIS&&(this._chordCounter=0);var r=t.message.pitch-12;if(null!=this.documentController.scoreDocument.selection)0===this._chordCounter?this.documentController.controller.document.entryAfterSelection?this.documentController.controller.enterPitchAtSelection(r,i):this.documentController.controller.placePitchAtSelection(r,i):this.documentController.controller.addPitchToSelection(r,i),this.documentController.ensureSelectionVisible(),this._chordCounter++,this._lastNoteTime=t.message.timestamp,this._midiInputSeen||(this.documentController.controller.logToAnalytics("midi","input"),this._midiInputSeen=!0);else if(i){var o=new de(kt.getPitch(r));new Sn(0,[o]);this.documentController.controller.echoNotes([o])}}},{key:"doNoteOff",value:function(t){this._chordCounter=A.numberToInt(Math.max(0,this._chordCounter-1))}}]),e}();r.registerClass(pi,"com.noteflight.notation.editor.MidiInputStep");var mi=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t,null)))._listOfActiveNotes=[],i}return c(e,gi),p(e,[{key:"doNoteOn",value:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var e=t.message.pitch-12,i=new de(kt.getPitch(e));this._listOfActiveNotes.push(new S(new Sn(0,[i]),e,t.message.timestampInMilliseconds))}},{key:"doNoteOff",value:function(t){for(var e=t.message.pitch-12,i=0;i<this._listOfActiveNotes.length;i++)if(this._listOfActiveNotes[i].pitch==e){var n=new td;n.onset=this._listOfActiveNotes[i].startTime,n.duration=t.message.timestampInMilliseconds-n.onset,n.pitch=new kt(e),n.channel=t.message.channel,this.documentController.controller.transcriber.addElementInMilliseconds(n),this._listOfActiveNotes.splice(i,1)}}}]),e}();r.registerClass(mi,"com.noteflight.notation.editor.MidiInputTranscriber");var vi=function(){function t(){y(this,t)}return p(t,null,[{key:"MIDI_OPTIMIZE_FOR_PERFORMANCE",get:function(){return"midiPerformance"}},{key:"MIDI_OPTIMIZE_FOR_SCORE",get:function(){return"midiScore"}}]),t}();r.registerClass(vi,"com.noteflight.notation.editor.ScoreExport");var _i=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t))).category=null,r.action=null,r.category=i,r.action=n,r}return c(e,ct),p(e,null,[{key:"LOG_ANALYTICS",get:function(){return"logAnalytics"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.category,this.action)}}]),e}();r.registerClass(_i,"com.noteflight.notation.event.AnalyticsEvent");var Si=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"DOCUMENT_CHANGE",get:function(){return"documentChange"}},{key:"PERFORMER_CHANGE",get:function(){return"performerChange"}},{key:"DISALLOWED_ACTION",get:function(){return"disallowedAction"}},{key:"PARTS_TRANSPOSED",get:function(){return"partsTransposed"}},{key:"TEMPORAL_MAP_CREATED",get:function(){return"temporalMapCreated"}},{key:"TIME_SIGNATURE_APPLIED",get:function(){return"timeSignatureApplied"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Si,"com.noteflight.notation.event.ControllerEvent");var Li=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"TIME_SIGNATURE_DIALOG",get:function(){return"timeSignatureDialog"}},{key:"KEY_SIGNATURE_DIALOG",get:function(){return"keySignatureDialog"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Li,"com.noteflight.notation.event.DialogEvent");var ki=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t))).property=null,s.oldValue=null,s.newValue=null,s.document=null,s.property=i,s.oldValue=n,s.newValue=r,s.document=o,s}return c(e,ct),p(e,null,[{key:"DOCUMENT_UPDATE",get:function(){return"documentUpdate"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.property,this.oldValue,this.newValue,this.document)}}]),e}();r.registerClass(ki,"com.noteflight.notation.event.DocumentUpdateEvent");var Ti=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"HYPHENS_UPDATED",get:function(){return"hyphensUpdated"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Ti,"com.noteflight.notation.event.HyphensUpdateEvent");var Ei=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"IDLE",get:function(){return"idle"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Ei,"com.noteflight.notation.event.IdleEvent");var Mi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(i=l(this,h(e).call(this,t))).index=0,i.measureValidationEvent=null,i.index=n,i.measureValidationEvent=r,i}return c(e,ct),p(e,null,[{key:"CONTINUE_INCREMENTAL_FLOW",get:function(){return"continueIncrementalFlow"}},{key:"INCREMENTAL_LAYOUT_STEP_INITIATED",get:function(){return"incrementalLayoutStepInitiated"}},{key:"INCREMENTAL_LAYOUT_STEP_COMPLETE",get:function(){return"incrementalLayoutStepComplete"}},{key:"REPORT_PAGE_FLOW",get:function(){return"reportPageFlow"}},{key:"REPORT_STRIP_FLOW",get:function(){return"reportStripFlow"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.index,this.measureValidationEvent)}},{key:"invalidStaves",get:function(){return this.measureValidationEvent?this.measureValidationEvent.staves:null}}]),e}();r.registerClass(Mi,"com.noteflight.notation.event.IncrementalLayoutEvent");var bi=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return y(this,e),(r=l(this,h(e).call(this,t))).measureIndices=null,r.systemLayout=null,r.justify=!1,r.staves=null,r.measureIndices=i,r.systemLayout=n,r.justify=o,r.staves=s,r}return c(e,ct),p(e,null,[{key:"DISPLAY",get:function(){return"display"}},{key:"GEOMETRY_CHANGE",get:function(){return"geometryChange"}},{key:"SPAN_CHANGE",get:function(){return"spanChange"}},{key:"SEQUENCE_CHANGE",get:function(){return"sequenceChange"}},{key:"UPDATE_MEASURE_HANDLE_INDEX",get:function(){return"updateMeasureHandleIndex"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.measureIndices,this.systemLayout,this.justify)}}]),e}();r.registerClass(bi,"com.noteflight.notation.event.MeasureDisplayEvent");var wi=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,!0))).kind=null,r.measure=null,r.kind=i,r.measure=n,r}return c(e,ct),p(e,null,[{key:"MEASURE_EDIT",get:function(){return"measureEdit"}},{key:"DELETE",get:function(){return"delete"}},{key:"PLAY_BACK",get:function(){return"playback"}},{key:"PLAY_LOOP",get:function(){return"playloop"}},{key:"ADD_BEFORE",get:function(){return"addBefore"}},{key:"ADD_AFTER",get:function(){return"addAfter"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.kind,this.measure)}}]),e}();r.registerClass(wi,"com.noteflight.notation.event.MeasureEditEvent");var xi=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,!0))).kind=i,r.part=n,r}return c(e,ct),p(e,null,[{key:"PART_MOVED",get:function(){return"partMoved"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.kind,this.part)}}]),e}();r.registerClass(xi,"com.noteflight.notation.event.PartEditEvent");var Ci=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,!0))).kind=i,n}return c(e,ct),p(e,null,[{key:"VALIDATE_CACHE",get:function(){return"validateCache"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.kind)}}]),e}();r.registerClass(Ci,"com.noteflight.notation.event.ViewCacheEvent");var Ni=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).measureLayout=null,n.measureLayout=i,n}return c(e,ct),p(e,null,[{key:"UPDATE_MEASURE_INDEX",get:function(){return"updateMeasureIndex"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.measureLayout)}}]),e}();r.registerClass(Ni,"com.noteflight.notation.event.MeasureLayoutEvent");var Ai=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(i=l(this,h(e).call(this,t))).sequenceChanges=[],i.reflow=!1,i._measures=null,i._measureIndices=null,i._staves=null,i._measures=n,i._staves=r,i}return c(e,ct),p(e,null,[{key:"SEQUENCE_CHANGE",get:function(){return"sequenceChange"}},{key:"ADD",get:function(){return"add"}},{key:"REMOVE",get:function(){return"remove"}},{key:"REFLOW",get:function(){return"reflow"}},{key:"VALIDATE",get:function(){return"validate"}},{key:"INVALIDATE",get:function(){return"invalidate"}},{key:"REBUILD_SCORE",get:function(){return"rebuildScore"}},{key:"BIG_CHANGES",get:function(){return Ii}},{key:"GEOMETRY_CHANGE",get:function(){return"geometryChange"}},{key:"SPAN_CHANGE",get:function(){return"spanChange"}},{key:"FOUNDRY_CHANGE",get:function(){return"foundryChange"}},{key:"VALIDATED",get:function(){return"validated"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.measures,this.staves)}},{key:"measures",get:function(){return this._measures}},{key:"staves",get:function(){return this._staves}},{key:"measureIndices",get:function(){if(null==this._measures&&!this.sequenceChanges.length)return null;if(null==this._measureIndices){this._measureIndices=[];var t=!0,e=!1,i=void 0;try{for(var n,r=this._measures[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;o.index>=0&&this._measureIndices.indexOf(o.index)<0&&this._measureIndices.push(o.index)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._measureIndices.sort(function(t,e){return t<e?-1:t>e?1:0})}return this._measureIndices}},{key:"firstMeasureIndex",get:function(){return A.unknownToInt(null==this.measureIndices||0===this.measureIndices.length?0:this.measureIndices[0])}}]),e}(),Ii=[Ai.SEQUENCE_CHANGE,Ai.VALIDATE];r.registerClass(Ai,"com.noteflight.notation.event.MeasureValidationEvent");var Pi=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,ct),p(e,null,[{key:"DISCONNECTED",get:function(){return"disconnected"}},{key:"CONNECTED",get:function(){return"connected"}},{key:"ERROR",get:function(){return"error"}}]),e}();r.registerClass(Pi,"com.noteflight.notation.event.MidiInputServiceEvent");var Oi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t))).message=null,i.message=n,i}return c(e,ct),p(e,null,[{key:"NOTE_ON",get:function(){return"noteOn"}},{key:"NOTE_OFF",get:function(){return"noteOff"}},{key:"PITCH_BEND",get:function(){return"pitchBend"}},{key:"CONTROLLER",get:function(){return"controller"}}]),e}();r.registerClass(Oi,"com.noteflight.notation.event.MidiMessageEvent");var Qi=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),(n=l(this,h(e).call(this,t))).mode=null,n.forceScoreBuild=!1,n.mode=i,n.forceScoreBuild=r,n}return c(e,ct),p(e,null,[{key:"MODE_CHANGE",get:function(){return"modeChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.mode,this.forceScoreBuild)}}]),e}();r.registerClass(Qi,"com.noteflight.notation.event.ModeEvent");var Ri=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(n=l(this,h(e).call(this,t))).kind=null,n.parent=null,n.child=null,n.index=0,n._data=null,n.kind=i,n.parent=r,n.child=o,n.index=s,n}return c(e,ct),p(e,null,[{key:"MODEL_CHANGE",get:function(){return"modelChange"}},{key:"ADD_CHILD_MODEL",get:function(){return"addChildModel"}},{key:"REMOVING_CHILD_MODEL",get:function(){return"removingChildModel"}},{key:"REMOVE_CHILD_MODEL",get:function(){return"removeChildModel"}},{key:"ADD_ANNOTATION",get:function(){return"addAnnotation"}},{key:"REMOVING_ANNOTATION",get:function(){return"removingAnnotation"}},{key:"REMOVE_ANNOTATION",get:function(){return"removeAnnotation"}},{key:"EDIT_ANNOTATION",get:function(){return"editAnnotation"}},{key:"ERROR_LOADING_INSTRUMENT",get:function(){return"errorLoadingInstrument"}}]),p(e,[{key:"clone",value:function(){var t=new e(this.type,this.kind,this.parent,this.child,this.index);return t._data=this._data,t}},{key:"data",get:function(){return this._data||(this._data={}),this._data}}]),e}();r.registerClass(Ri,"com.noteflight.notation.event.ModelEvent");var Di=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t))).property=null,s.oldValue=null,s.newValue=null,s.source=null,s._data=null,s.property=i,s.oldValue=n,s.newValue=r,s.source=o,s}return c(e,ct),p(e,null,[{key:"MODEL_UPDATE",get:function(){return"modelUpdate"}}]),p(e,[{key:"clone",value:function(){var t=new e(this.type,this.property,this.oldValue,this.newValue,this.source);return t._data=this._data,t}},{key:"data",get:function(){return this._data||(this._data={}),this._data}}]),e}();r.registerClass(Di,"com.noteflight.notation.event.ModelUpdateEvent");var Fi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return y(this,e),(i=l(this,h(e).call(this,t)))._startMeasureIndex=NaN,i._endMeasureIndex=NaN,i._startMeasureIndex=n,i._endMeasureIndex=r,i}return c(e,ct),p(e,null,[{key:"NOTATION_STATUS_CHANGE",get:function(){return"notationStatusChange"}},{key:"MEASURE_STATUS_CHANGE",get:function(){return"measureStatusChange"}},{key:"STAFF_STATUS_CHANGE",get:function(){return"staffStatusChange"}},{key:"SYSTEM_STATUS_CHANGE",get:function(){return"systemStatusChange"}},{key:"EDIT",get:function(){return"edit"}},{key:"NOTATION_SELECTED",get:function(){return"notationSelected"}},{key:"DIRECTION",get:function(){return"direction"}},{key:"FOCUS_MEASURE_NUMBER",get:function(){return"focusMeasureNumber"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}},{key:"startMeasureIndex",get:function(){return this._startMeasureIndex}},{key:"endMeasureIndex",get:function(){return this._endMeasureIndex}}]),e}();r.registerClass(Fi,"com.noteflight.notation.event.NotationEvent");var Ui=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t))).kind=null,r.data=null,r.kind=i,r.data=n,r}return c(e,ct),p(e,null,[{key:"NOTE_EDIT",get:function(){return"noteEdit"}},{key:"ACCIDENTAL",get:function(){return"accidental"}},{key:"COURTESY_ACCIDENTAL",get:function(){return"courtesyAccidental"}},{key:"VALUE",get:function(){return"value"}},{key:"TIED",get:function(){return"tied"}},{key:"PARENTHESES",get:function(){return"parentheses"}},{key:"INCOMING_TIE",get:function(){return"incomingTie"}},{key:"BENT",get:function(){return"bent"}},{key:"PRE_BENT",get:function(){return"preBent"}},{key:"SLIDE",get:function(){return"slide"}},{key:"GLISSANDO",get:function(){return"glissando"}},{key:"DOTS",get:function(){return"dotted"}},{key:"REMOVE",get:function(){return"remove"}},{key:"REMOVE_MARKINGS",get:function(){return"removeMarkings"}},{key:"ANNOTATION",get:function(){return"annotation"}},{key:"LYRICS",get:function(){return"lyrics"}},{key:"PERFORMANCE",get:function(){return"performance"}},{key:"EXPRESSION",get:function(){return"expression"}},{key:"CHORD_SYMBOL",get:function(){return"chordSymbol"}},{key:"ENTER_SLASH",get:function(){return"enterSlash"}},{key:"BEAM_BEFORE",get:function(){return"beamBefore"}},{key:"BEAM_AT",get:function(){return"beamAt"}},{key:"BARLINE",get:function(){return"barline"}},{key:"START_REPEAT",get:function(){return"startRepeat"}},{key:"END_REPEAT",get:function(){return"endRepeat"}},{key:"BREAK_SET_TYPE",get:function(){return"breakSetType"}},{key:"BREAK_TYPE",get:function(){return"breakType"}},{key:"CAUTIONARIES",get:function(){return"cautionaries"}},{key:"NOTE_HEAD",get:function(){return"noteHead"}},{key:"ARTICULATION",get:function(){return"articulation"}},{key:"SLUR",get:function(){return"slur"}},{key:"OCTAVE_UP",get:function(){return"octaveUp"}},{key:"OCTAVE_DOWN",get:function(){return"octaveDown"}},{key:"LET_VIBRATE",get:function(){return"letVibrate"}},{key:"TRILL",get:function(){return"trill"}},{key:"VIBRATO",get:function(){return"vibrato"}},{key:"LINE_CRESCENDO",get:function(){return"lineCrescendo"}},{key:"LINE_DIMINUENDO",get:function(){return"lineDiminuendo"}},{key:"RITARDANDO",get:function(){return"ritardando"}},{key:"ACCELERANDO",get:function(){return"accelerando"}},{key:"CRESCENDO",get:function(){return"crescendo"}},{key:"DIMINUENDO",get:function(){return"diminuendo"}},{key:"PEDAL",get:function(){return"pedal"}},{key:"LINE",get:function(){return"line"}},{key:"TREMOLO",get:function(){return"tremolo"}},{key:"START_TREMOLO",get:function(){return"startTremolo"}},{key:"ARPEGGIO",get:function(){return"arpeggio"}},{key:"MULTIREST",get:function(){return"multirest"}},{key:"SLUR_ARTICULATION",get:function(){return"slurArticulation"}},{key:"PALM_MUTE",get:function(){return"palmMute"}},{key:"LET_RING",get:function(){return"letRing"}},{key:"X_OFFSET",get:function(){return"xOffset"}},{key:"Y_OFFSET",get:function(){return"yOffset"}},{key:"COLOR",get:function(){return"color"}},{key:"QUARTER_BEND_ALTERATION",get:function(){return"quarterBendAlteration"}},{key:"CUE",get:function(){return"cue"}},{key:"DIRECTION",get:function(){return"direction"}},{key:"NOTATION_DIRECTION",get:function(){return"notationDirection"}},{key:"GRACE",get:function(){return"grace"}},{key:"APPOGGIATURA",get:function(){return"appoggiatura"}},{key:"SEGNO",get:function(){return"segno"}},{key:"CODA",get:function(){return"coda"}},{key:"SPLIT_SYSTEM",get:function(){return"splitSystem"}},{key:"REPEAT_ENDING",get:function(){return"repeatEnding"}},{key:"REPEAT_ENDING_FINAL",get:function(){return"repeatEndingFinal"}},{key:"MEASURE_REPEAT",get:function(){return"measureRepeat"}},{key:"SYSTEM_TEXT",get:function(){return"systemText"}},{key:"TEXT_IN_BOX",get:function(){return"textbox"}},{key:"REHEARSAL_LETTER",get:function(){return"rehearsalLetter"}},{key:"TEXT_BLOCK_BEFORE",get:function(){return"textBlockBefore"}},{key:"TEXT_BLOCK_AFTER",get:function(){return"textBlockAfter"}},{key:"RESET_MEASURE_NUMBERS",get:function(){return"resetMeasureNumbers"}},{key:"PRE_EFFECT",get:function(){return"preEffect"}},{key:"POST_EFFECT",get:function(){return"postEffect"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.kind,this.data)}},{key:"dataAsString",value:function(){return Kd.valueToString(this.data)}}]),e}();r.registerClass(Ui,"com.noteflight.notation.event.NoteEditEvent");var Vi=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t))).measureIndex=NaN,i.width=NaN,i.staffYs=null,i.systemHeight=NaN,i.topPadding=NaN,i}return c(e,ct),p(e,null,[{key:"POSITION",get:function(){return"position"}},{key:"WIDTH",get:function(){return"width"}},{key:"STAFF_SPACING",get:function(){return"staffSpacing"}},{key:"LOADED",get:function(){return"loaded"}}]),e}();r.registerClass(Vi,"com.noteflight.notation.event.OverlayUpdateEvent");var Bi=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return y(this,e),(n=l(this,h(e).call(this,t))).pageIndex=NaN,n.lastChunkIndex=NaN,n.pageIndex=i,n.lastChunkIndex=r,n}return c(e,ct),p(e,null,[{key:"PAGE_DISPLAY",get:function(){return"pageDisplay"}},{key:"CHECK_OLD_REMAINING_CHUNKS",get:function(){return"checkOldRemainingChunks"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.pageIndex,this.lastChunkIndex)}}]),e}();r.registerClass(Bi,"com.noteflight.notation.event.PageDisplayEvent");var Hi=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t))).pageIndices=null,o.pageIndices=i,o.measureIndices=n,o.staves=r,o}return c(e,ct),p(e,null,[{key:"PAGE_REFLOW",get:function(){return"pageReflow"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.pageIndices,this.measureIndices,this.staves)}}]),e}();r.registerClass(Hi,"com.noteflight.notation.event.PageReflowEvent");var $i=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(i=l(this,h(e).call(this,t))).playbackPrecondition=null,i.measurePosition=null,i.measurePosition=n,i.playbackPrecondition=r,i}return c(e,ct),p(e,null,[{key:"PLAY_BACK",get:function(){return"playback"}},{key:"PLAYBACK_STARTS",get:function(){return"playbackStarts"}},{key:"PLAYBACK_STARTS_ERROR",get:function(){return"playbackStartsError"}},{key:"PAUSE",get:function(){return"pause"}},{key:"STOP",get:function(){return"stop"}},{key:"FORCE_STOP",get:function(){return"forceStop"}},{key:"HTML5_EDITOR_READY",get:function(){return"html5EditorReady"}},{key:"READY_TO_START_PLAYBACK",get:function(){return"readyToStartPlayback"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.measurePosition,this.playbackPrecondition)}},{key:"startMeasureIndex",get:function(){return this.measurePosition?this.measurePosition.measureIndex:0}}]),e}();r.registerClass($i,"com.noteflight.notation.event.PlaybackEvent");var Gi=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).selection=null,n.selection=i,n}return c(e,ct),p(e,null,[{key:"ADD_SELECTION",get:function(){return"addSelection"}},{key:"REMOVE_SELECTION",get:function(){return"removeSelection"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.selection)}}]),e}();r.registerClass(Gi,"com.noteflight.notation.event.SelectEvent");var Yi=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t))).part=null,r.measureIndex=0,r.part=i,r.measureIndex=n,r}return c(e,ct),p(e,null,[{key:"PART_SELECTED",get:function(){return"partSelected"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.part,this.measureIndex)}}]),e}();r.registerClass(Yi,"com.noteflight.notation.event.SelectPartEvent");var zi=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),(n=l(this,h(e).call(this,t)))._measure=null,n._requestValidate=!1,n._measure=i,n._requestValidate=r,n}return c(e,ct),p(e,null,[{key:"SPAN_CHANGE",get:function(){return"spanChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.measure,this.requestValidate)}},{key:"measure",get:function(){return this._measure}},{key:"requestValidate",get:function(){return this._requestValidate}}]),e}();r.registerClass(zi,"com.noteflight.notation.event.SpanChangeEvent");var Wi=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"STAFF_CHANGE",get:function(){return"staffChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Wi,"com.noteflight.notation.event.StaffChangeEvent");var Xi=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,!0))).kind=null,r.staff=null,r.kind=i,r.staff=n,r}return c(e,ct),p(e,null,[{key:"PART_EDIT",get:function(){return"partEdit"}},{key:"SELECT",get:function(){return"select"}},{key:"ADD_TO_SELECTION",get:function(){return"addToSelection"}},{key:"ADD_ABOVE",get:function(){return"addAbove"}},{key:"ADD_BELOW",get:function(){return"addBelow"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.kind,this.staff)}}]),e}();r.registerClass(Xi,"com.noteflight.notation.event.StaffEditEvent");var Ki=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t,!0))}return c(e,ct),p(e,null,[{key:"STAFF_START_CHANGE",get:function(){return"staffStartChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Ki,"com.noteflight.notation.event.StaffStartChangeEvent");var ji=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(i=l(this,h(e).call(this,t))).pos=NaN,i.length=NaN,i.pos=n,i.length=r,i}return c(e,ct),p(e,null,[{key:"SYNCHRONIZED_MEDIA_POSITION_CHANGE",get:function(){return"synchronizedMediaPositionChange"}},{key:"SYNCHRONIZED_MEDIA_PLAY",get:function(){return"synchronizedMediaPlay"}},{key:"SYNCHRONIZED_MEDIA_STOP",get:function(){return"synchronizedMediaStop"}},{key:"SYNCHRONIZED_MEDIA_PAUSE",get:function(){return"synchronizedMediaPause"}},{key:"SYNCHRONIZED_MEDIA_RESUME",get:function(){return"synchronizedMediaResume"}},{key:"SYNCHRONIZED_MEDIA_START_FROM_BEGINNING",get:function(){return"synchronizedMediaStartFromBeginning"}},{key:"SYNCHRONIZED_MEDIA_LOADED",get:function(){return"synchronizedMediaLoaded"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.pos,this.length)}}]),e}();r.registerClass(ji,"com.noteflight.notation.event.SynchronizedMediaEvent");var qi=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"TRACK_CHANGE",get:function(){return"trackChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(qi,"com.noteflight.notation.event.TrackChangeEvent");var Ji=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,ct),p(e,null,[{key:"MIXER_SETTINGS_CHANGE",get:function(){return"mixerSettingsChange"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Ji,"com.noteflight.notation.event.MixerSettingsChangeEvent");var Zi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t))).groupName=n,i}return c(e,ct),p(e,null,[{key:"UNDO_HISTORY_CHANGE",get:function(){return"undoHistoryChange"}},{key:"UNDO_GROUP_OPENED",get:function(){return"undoGroupOpened"}},{key:"UNDO_GROUP_NAME_CHANGED",get:function(){return"undoGroupNameChanged"}},{key:"UNDO_ABOUT_TO_UNDO",get:function(){return"undoAboutToUndo"}},{key:"UNDO_ABOUT_TO_REDO",get:function(){return"undoAboutToRedo"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.groupName)}}]),e}();r.registerClass(Zi,"com.noteflight.notation.event.UndoEvent");var tn=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).part=null,n.part=i,n}return c(e,ct),p(e,null,[{key:"WAVEFORM_MODEL_UPDATE",get:function(){return"waveformModelUpdate"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.part)}}]),e}();r.registerClass(tn,"com.noteflight.notation.event.WaveformModelUpdateEvent");var en=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t))).parts=null,i.parts=n,i}return c(e,ct),p(e,null,[{key:"WAVEFORM_UPDATE",get:function(){return"waveformUpdate"}},{key:"WAVEFORMS_LOADING",get:function(){return"waveformsLoading"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.parts)}}]),e}();r.registerClass(en,"com.noteflight.notation.event.WaveformUpdateEvent");var nn=function t(){y(this,t)};r.registerClass(nn,"com.noteflight.notation.fileformat.IScoreReader");var rn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this._xml=null,this._score=null,this._format=null,this._options=null,this._options=e}return p(t,[{key:"translateXml",value:function(t){switch(this._format=(new on).recognizeFormat(t),this._format){case on.NOTEFLIGHT_XML_FORMAT:try{var e=new ur(this._options);this._score=e.translateXml(t),this._xml=e.xml}catch(t){throw new Error("An error occurred while trying to process the XML")}break;case on.NF_COMPRESSED_XML_FORMAT:try{var i=$e.inflate(atob(t.node.textContent),{to:"string"});t=A.unknownToType(i,q),this.translateXml(t)}catch(t){throw new Error("An error occurred while trying to process the XML")}break;case on.MUSICXML_FORMAT:var n=new gn(yn.fromOptions(this._options));this._score=n.translateXml(t),this._xml=n.xml;break;case on.UNRECOGNIZED_FORMAT:throw new Error("Noteflight could not import this file, which is in an unknown XML format.");default:throw new Error("An error occurred while trying to determine the score format")}return this._score.initCompleted=!0,this._score}},{key:"xml",get:function(){return this._xml}},{key:"score",get:function(){return this._score}}]),t}();r.implementsInterfaces(rn,[nn]),r.registerClass(rn,"com.noteflight.notation.fileformat.FlexibleScoreReader");var on=function(){function t(){y(this,t)}return p(t,null,[{key:"NOTEFLIGHT_XML_FORMAT",get:function(){return"NoteflightXml"}},{key:"NF_COMPRESSED_XML_FORMAT",get:function(){return"NoteflightCompressedXml"}},{key:"MUSICXML_FORMAT",get:function(){return"MusicXml"}},{key:"MIDI_FORMAT",get:function(){return"MIDI"}},{key:"UNSUPPORTED_MIDI_FORMAT",get:function(){return"unsupportedMIDI"}},{key:"UNRECOGNIZED_FORMAT",get:function(){return"unrecognized"}},{key:"FILE_HEAD_LENGTH",get:function(){return 256}}]),p(t,[{key:"isXml",value:function(e){var i=new Dy,n=t.FILE_HEAD_LENGTH<e.bytesAvailable?t.FILE_HEAD_LENGTH:e.bytesAvailable;e.readBytes(i,0,n);var r=i.toString();return this.isXmlString(r)}},{key:"isXmlString",value:function(t){return t.indexOf("<?xml")>=0||t.indexOf("<noteflightScore")>=0||t.indexOf("<noteflightCompressed")>=0||t.indexOf("<!DOCTYPE")>=0}},{key:"recognizeFormat",value:function(e){return A.is(e,q)?this.recognizeXMLFormat(A.as(e,q)):A.is(e,Dy)?this.recognizeBinaryFormat(A.as(e,Dy)):t.UNRECOGNIZED_FORMAT}},{key:"recognizeXMLFormat",value:function(e){switch(e.name().toString()){case"noteflightScore":return t.NOTEFLIGHT_XML_FORMAT;case"noteflightCompressed":return t.NF_COMPRESSED_XML_FORMAT;case"score-partwise":return t.MUSICXML_FORMAT;default:return t.UNRECOGNIZED_FORMAT}}},{key:"recognizeBinaryFormat",value:function(e){switch((new Ld).checkFileFormat(e)){case Ld.SIMULTANEOUS_TRACKS_FORMAT:case Ld.SINGLE_TRACK_FORMAT:return t.MIDI_FORMAT;case Ld.SEPARATE_TRACKS_FORMAT:return t.UNSUPPORTED_MIDI_FORMAT;default:return t.UNRECOGNIZED_FORMAT}}}]),t}();r.registerClass(on,"com.noteflight.notation.fileformat.ScoreFormatRecognizer");var sn=function(){function t(){y(this,t),this.quantizationLevel=t.VALUE_QUANTIZATION_AUTO,this.channelsBecomeParts=!1,this.ignoreEmptyTracks=!0,this.initialTimeSignature=null,this.initialKeySignature=null,this.quantizeTuplets=!1}return p(t,null,[{key:"VALUE_QUANTIZATION_AUTO",get:function(){return-1}}]),p(t,null,[{key:"fromOptions",value:function(e){var i=new t;return i.quantizationLevel=Yd.parseFromOptions(e,"quantizationLevel",0),i.channelsBecomeParts=Gd.parseFromOptions(e,"channelsBecomeParts",!1),i.ignoreEmptyTracks=Gd.parseFromOptions(e,"ignoreEmptyTracks",!0),i.quantizeTuplets=Gd.parseFromOptions(e,"quantizeTuplets",!1),i}}]),t}();r.registerClass(sn,"com.noteflight.notation.fileformat.midi.MidiOptions");var an=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._workInProgress=!1,t._currentFrame=0,t._totalFrames=0,t._percentageIncrement=0,t._nextProgressAt=0,t._cancelled=!1,t._midiPerformance=null,t._score=null,t._timeSignatureIdx=0,t._measureDuration=e.DEFAULT_MEASURE_DURATION,t._editDistanceThreshold=2,t._instrumentEntries=null,t._maxMeasures=1,t._fileName=null,t._fileData=null,t._initialClef=null,t._longestTrackDurationInSeconds=NaN,t._sequences=null,t._trackNum=0,t._staffIdx=0,t._midiOptions=null,t._ignoreEmptyTracks=!0,t._mapChannelsToPerformances=!1,t.errors=null,t._progressManager=null,t._performanceTranscriber=new zu,t._temporalMap=new Eu,t}return c(e,At),p(e,null,[{key:"DEFAULT_MEASURE_DURATION",get:function(){return 256}},{key:"DURATION_QUARTER_NOTE",get:function(){return 64}},{key:"DEFAULT_PART_NAME",get:function(){return"MIDI Instrument"}},{key:"DEFAULT_PART_NAME_SHORT",get:function(){return"MIDI Inst"}},{key:"DEFAULT_INSTRUMENT_URI",get:function(){return"percussion/pitched/piano"}}]),p(e,[{key:"createScore",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._workInProgress)throw new Error("Failed attempt to start multiple simultaneous MidiToNoteflight translations via createScore()");return this.errors=[],this._fileName=t,this._fileData=e,this._instrumentEntries=i,this._workInProgress=!0,this._progressManager=new hf(this,!0),this._progressManager.start(xt.bindMethod(this,this.start)),this._progressManager.completionEvent}},{key:"start",value:function(){this._longestTrackDurationInSeconds=0,this._sequences=[],this._midiOptions.quantizationLevel!=sn.VALUE_QUANTIZATION_AUTO&&(this._performanceTranscriber.settings.customQuantization=!0,this._performanceTranscriber.settings.customQuantizationValue=this._midiOptions.quantizationLevel),this._progressManager.yield(xt.bindMethod(this,this.startMidiRead))}},{key:"cancel",value:function(){this._cancelled=!0}},{key:"startMidiRead",value:function(){var t=new Ld;t.mapChannelsToPerformances=this._mapChannelsToPerformances,this._midiPerformance=t.createPerformance(this._fileData),t.tracksTruncated&&this.errors.push(Ou("content.maxMIDITracks",[Ld.MAX_SOUNDING_TRACKS]));for(var e=0;e<this._midiPerformance.performances.length;e++){var i=A.as(this._midiPerformance.performances[e],nd),n=this.createPerformanceElements(i,A.intToUint(e+1));if(this._sequences.push(n),n.length>0){var r=n[n.length-1];this._longestTrackDurationInSeconds=Math.max(this._longestTrackDurationInSeconds,r.onset+r.duration)}}this._totalFrames=A.numberToUint(this._longestTrackDurationInSeconds*this._sequences.length),this._percentageIncrement=A.numberToUint(this._totalFrames/100),this._nextProgressAt=this._percentageIncrement,this._progressManager.yield(xt.bindMethod(this,this.startMidiTranslate))}},{key:"startMidiTranslate",value:function(){this._currentFrame=0,this._score=new Nl,this._score.title=Ou.getString("content.midiImport"),this._score.staffMetrics.verticalAutoSpace=!0,this._midiPerformance.trackNames[1].length>0?this._score.title=this._midiPerformance.trackNames[1][0]:this._fileName.length>0&&(this._score.title=Ou.getString("content.midiFromFile",[this._fileName])),this._midiPerformance.copyrights.length>0&&(this._score.composer=A.unknownToString(this._midiPerformance.copyrights[0])),this._trackNum=1,this._progressManager.yield(xt.bindMethod(this,this.processPart))}},{key:"processPart",value:function(){if(this._cancelled)this.cancelMidiScoreWrite();else if(this._trackNum>this._midiPerformance.performances.length)this._progressManager.yield(xt.bindMethod(this,this.finishMidiScoreWrite));else{var t=A.intToUint(this._trackNum-1),i=A.as(this._midiPerformance.performances[t],nd);if(t>0&&this._ignoreEmptyTracks&&i.elements.length<=0)return this._trackNum++,void this._progressManager.yield(xt.bindMethod(this,this.processPart));for(var n=-1,r="",o="",s=!1,a=(this._sequences[t],0);a<this._midiPerformance.programChanges.length;a++){var l=A.as(this._midiPerformance.programChanges[a],wd);if(l.track==this._trackNum||l.channel==this._midiPerformance.channelMap[this._trackNum]){n=l.programNumber;break}}this._midiPerformance.trackNames.length>this._trackNum&&this._midiPerformance.trackNames[this._trackNum].length>0&&(o=this._midiPerformance.trackNames[this._trackNum][0]),this._midiPerformance.instrumentNames.length>this._trackNum&&this._midiPerformance.instrumentNames[this._trackNum].length>0&&(r=this._midiPerformance.instrumentNames[this._trackNum][0]),this._initialClef=this.guessInitialClef(i),this._midiPerformance.channelMap[this._trackNum]==Ld.DRUM_CHANNEL&&(s=!0,this._initialClef=Mn.percussionClef());var u=El.createPart();u.name=e.DEFAULT_PART_NAME,u.shortName=e.DEFAULT_PART_NAME_SHORT,u.instrumentUri=e.DEFAULT_INSTRUMENT_URI;var h=!1;null!=this._instrumentEntries&&(n>=0&&(h=this.mapInstrumentByProgramNumber(u,A.intToUint(n)),null!=o?this.guessPartName(u,o):null!=r&&this.guessPartName(u,r)),h||(null!=o?this.guessPartName(u,o,!0):null!=r&&this.guessPartName(u,r,!0))),s&&(u.instrumentUri="percussion/drums/standard"),u.transposition=0,u.octaveShift=0;var c=new Rl;this._score.addStaff(c),c.part=u;var d;this._score.parts;if(0===t){var f,y;0===this._midiPerformance.timeSignatures.length&&this._midiPerformance.timeSignatures.push(new Nd(0,0,4,2,Ld.PULSE,Ld.THIRTYSECONDS_PER_PULSE));var g,p=0,m=0,v=0,_=0,S=0,L=!0,k=!0;for(1,a=0;a<this._midiPerformance.timeSignatures.length;a++){var T=this._midiPerformance.timeSignatures[a];if(a<this._midiPerformance.timeSignatures.length-1)S=this._midiPerformance.timeSignatures[a+1].onsetMetric*e.DURATION_QUARTER_NOTE,k=!1;else _=this._longestTrackDurationInSeconds,k=!0;for(L=!0;k&&m<_||!k&&v<S;){var E=this.getKeySignature(m);y=this.processSystemMeasure(p,T,L,E,g,m),d=this.processMeasure(p,this._initialClef,y),c.addMeasure(d),this._temporalMap.appendEntry(new Mu(d.index,m,d.measureInfo.tempo.timeScale,v,0)),m+=d.durationInSeconds,v+=d.duration,p++,L=!1,g=E}}if(f=p,this._maxMeasures=f,this._ignoreEmptyTracks&&i.elements.length<=0&&this._midiPerformance.performances.length>1)return this._score.staves.splice(c.index,1),this._trackNum++,void this._progressManager.yield(xt.bindMethod(this,this.processPart))}else for(a=0;a<this._maxMeasures;a++)d=this.processMeasure(a,this._initialClef),c.addMeasure(d);this._performanceTranscriber.createTranscriber(c.part,0,this._temporalMap,Array.from(Array(c.measures.length).keys())),this._performanceTranscriber.enabled=!0;for(var M=this._sequences[t],b=0;b<M.length;b++)this._performanceTranscriber.addElementInSeconds(M[b]);this._performanceTranscriber.finish({skipAddingEmptyMeasures:!0}),this._trackNum++,this._progressManager.yield(xt.bindMethod(this,this.processPart))}}},{key:"getKeySignature",value:function(t){for(var i,n=this._midiPerformance.keySignatures,r=null,o=0;o<n.length;o++){if((i=A.as(n[o],Td)).onsetMetric*e.DURATION_QUARTER_NOTE>t)return r||i;r=i}return i}},{key:"createPerformanceElements",value:function(t){for(var e=[],i=0;i<t.elements.length;i++){var n=A.as(t.elements[i],Md),r=new Jc;r.onset=n.onset,r.duration=n.duration,r.pitch=n.pitch,e.push(r)}return e}},{key:"mapInstrumentByProgramNumber",value:function(t,e){if(this._instrumentEntries)for(var i=0;i<this._instrumentEntries.length;i++){var n=A.unknownToType(this._instrumentEntries[i],Ao);if(n.midiPatch==e)return t.name=n.label,t.shortName=n.label,t.instrumentUri=n.uri,!0}return!1}},{key:"guessPartName",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._editDistanceThreshold,r=0;if(this._instrumentEntries){for(var o=0;o<this._instrumentEntries.length;o++){var s=A.unknownToType(this._instrumentEntries[o],Ao),a=cf.levenshteinDistance(s.label,e);if(a<n&&(r=o,0===(n=a)))break}if(n<this._editDistanceThreshold){var l=A.unknownToType(this._instrumentEntries[r],Ao);t.name=l.label,t.shortName=l.label,i&&(t.instrumentUri=l.uri)}}e.length>0&&(t.name=e,t.shortName=e)}},{key:"processMeasure",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new hl;return n.clef=e,n.breakType=null,n.startRepeat=!1,n.endRepeat=!1,n.layoutWeight=1,i?this._score.systemStaff.addMeasureAt(i,t):i=this._score.systemStaff.getMeasureAt(t),n.systemMeasure=i,n.measureInfo=i.measureInfo,n.addRests(),n}},{key:"processSystemMeasure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,s=new hl;if(null!=e?this.processTimeSignature(s,t,e,i):this.processTimeSignature(s,t),null!=n){var a=this.processKeySignature(s,n),l=null==r;if(null!=r){var u=new Ga(r.fifths);l=!a.equals(u)}t>0&&l&&s.addElement(a,-1)}else this.processKeySignature(s);if(0===t)if(this._midiPerformance.tempi.length>=1){var h=this._midiPerformance.tempi[0];s.tempo=this.processTempo(h.bpm),s.addTempoNotation()}else s.tempo=this.processTempo();else{var c=!1;if(o>-1)for(var d=0;d<this._midiPerformance.tempi.length;d++)if(this._midiPerformance.tempi[d].onsetMetric==o){s.tempo=this.processTempo(this._midiPerformance.tempi[d].bpm),s.addTempoNotation(),c=!0;break}c||(s.tempo=this._score.systemStaff.measures[t-1].tempo)}return this.processBarline(s),s}},{key:"processBarline",value:function(t){t.addElement(new En(this._measureDuration),-1)}},{key:"processTimeSignature",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=4,s=4;n&&(o=n.numerator,s=n.denominator),this._timeSignatureIdx++;var a=new zl(o,s);t.timeSignature=a,(0===i||r)&&(t.addElement(a,-1),this._measureDuration=A.numberToUint(Math.round(e.DEFAULT_MEASURE_DURATION*o/s)))}},{key:"processKeySignature",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e=i?new Ga(i.fifths):new Ga,t.keySignature=e,e}},{key:"processTempo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t>0?new Yl(mn.QUARTER,0,Math.round(t)):new Yl}},{key:"guessInitialClef",value:function(t){if(null==t||null==t.elements||t.elements.length<=0)return Mn.trebleClef();for(var e=0,i=0;i<t.elements.length;i++){var n=A.as(t.elements[i],Md);e+=A.intToUint(n.pitch.ordinal)}var r=e/t.elements.length,o=Mn.trebleClef();return r<50&&r>0&&(o=Mn.bassClef()),o}},{key:"finishMidiScoreWrite",value:function(){if(this._score.staves.length<=0){var t=El.createPart(),i=new Rl;this._score.addStaff(i),t.name=e.DEFAULT_PART_NAME,i.part=t}if(this._score.getStaffAt(0).measures.length<=0){var n=this.processSystemMeasure(0),r=this.processMeasure(0,Mn.trebleClef(),n);r.addRests(),this._score.getStaffAt(0).addMeasure(r)}this._score.systemStaff.measures[this._score.systemStaff.measures.length-1].barlineNotation.type=En.FINAL,this._progressManager.yield(xt.bindMethod(this,this.finalReturn))}},{key:"finalReturn",value:function(){this._workInProgress=!1,this._progressManager.complete(new un(this._score,this.errors))}},{key:"cancelMidiScoreWrite",value:function(){this._workInProgress=!1,this._progressManager.complete(new ct(ct.CANCEL))}},{key:"midiOptions",set:function(t){this._midiOptions=t,this._mapChannelsToPerformances=t.channelsBecomeParts}}]),e}();r.registerClass(an,"com.noteflight.notation.fileformat.midi.MidiToNoteflightTranslator");var ln=function(){function t(){y(this,t)}return p(t,[{key:"createMidiFromScore",value:function(t,e,i){var n,r,o=new Ld;if(e.playAudioRecordings=!1,i==vi.MIDI_OPTIMIZE_FOR_PERFORMANCE)0===(r=t.audibleStaves.slice()).length&&(r=t.staves.slice()),n=e.renderStaves(r,{ignoreSyncedTemporalMap:!0});else{var s=e.metrics;e.metrics=t.performanceMetrics,e.metrics.configureForScoreExport(),r=t.staves.slice(),n=e.renderStaves(r,{ignoreSpeedAdjustment:!0,renderExact:!0,forMidi:!0,ignoreSyncedTemporalMap:!0}),e.metrics=s}var a,l=0,u=[],h=null,c=null,d=!0,f=!1,y=void 0;try{for(var g,p=n.measureIndices[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value,v=A.unknownToInt(m),_=t.systemStaff.getMeasureAt(A.intToUint(v));if(a=0,_.keySignature&&(null==h||!_.keySignature.equals(h))){var S=new Td(u.length,l,_.keySignature.fifths);u.push(S),h=_.keySignature}!_.timeSignature||null!=c&&_.timeSignature.equals(c)||(u.push(new Nd(u.length,l,_.timeSignature.beats,_.timeSignature.beatType)),c=_.timeSignature);for(var L=0;L<_.numNotations;L++){var k=_.getNotationAt(L);if(A.is(k,Ca)){var T=A.as(k,Ca);a=l+k.position,u.push(new Cd(u.length,a,T.text))}}l+=_.duration}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}if(A.is(n.scorePositionMap,Eu))for(var E=0,M=A.unknownToType(n.scorePositionMap,Eu),b=0;b<M.length;b++){var w=M.getEntryAt(b);w.timescale!=E&&(a=w.scorePosition,u.push(new xd(u.length,w.scorePosition,60/(64*w.timescale))),E=w.timescale)}if(0===n.performance.elements.length)return null;var x=o.createMidi(r.length);x.writeBytes(o.createTempoTrack(u,t.title,t.composer));var C=0,N=!0,I=!1,P=void 0;try{for(var O,Q=r[Symbol.iterator]();!(N=(O=Q.next()).done);N=!0){var R=O.value,D=A.unknownToType(R,Rl),F=0,U=null;D.getMeasureAt(0).effectiveClef.unpitched?(F=9,i==vi.MIDI_OPTIMIZE_FOR_PERFORMANCE&&(U=D.getMeasureAt(0).effectiveClef.percussionMap)):F=C<9?C:A.numberToUint(Math.min(15,C+1));var V=o.createMidiTrack(n.performance.elements,C,F,D.part.midiPatch,D.part.name,U);x.writeBytes(V),C++}}catch(t){I=!0,P=t}finally{try{N||null==Q.return||Q.return()}finally{if(I)throw P}}return x}}]),t}();r.registerClass(ln,"com.noteflight.notation.fileformat.midi.NoteflightToMidiTranslator");var un=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,e.MIDI_SCORE_WRITER_COMPLETE))).score=null,n.errors=null,n.score=t,n.errors=i,n}return c(e,ct),p(e,null,[{key:"MIDI_SCORE_WRITER_COMPLETE",get:function(){return"MidiScoreWriterComplete"}}]),e}();r.registerClass(un,"com.noteflight.notation.fileformat.midi.event.MidiScoreWriterCompleteEvent");var hn=function(){function t(){y(this,t)}return p(t,null,[{key:"nfToMusicXml",get:function(){return cn},set:function(t){cn=t}},{key:"musicXmlToNf",get:function(){return dn},set:function(t){dn=t}}]),t}(),cn={brass:"brass.trumpet","brass/french-horn":"brass.french-horn","brass/trombone":"brass.trombone","brass/trumpet":"brass.trumpet","brass/tuba":"brass.tuba",keyboards:"keyboard.piano","keyboards/clavichord":"keyboard.clavichord","keyboards/electric-piano":"keyboard.piano.electric","keyboards/organ":"keyboard.organ","keyboards/virginal":"keyboard.virginal",percussion:"wood.wood-block","percussion/unpitched/cymbals":"metal.cymbal.hand","percussion/drums":"drum.snare-drum","percussion/drums/marchingBand/bass":"drum.bass-drum","percussion/drums/marchingBand/tenor":"drum.tenor-drum","percussion/drums/timbale":"drum.timbale","percussion/drums/timpani":"drum.timpani","percussion/unpitched/bongo":"drum.bongo","percussion/unpitched/bass-drum":"drum.bass-drum","percussion/unpitched/congas":"drum.conga","percussion/unpitched/cowbell":"metal.bells.cowbell","percussion/unpitched/guiro":"wood.guiro","percussion/unpitched/metronome":"effect.metronome-click","percussion/unpitched/sleighBell":"metal.bells.jingle-bell","percussion/unpitched/snare":"drum.snare-drum","percussion/unpitched/tom-tom":"drum.tom-tom","percussion/pitched":"pitched-percussion.vibraphone","percussion/pitched/balafon":"pitched-percussion.balafon","percussion/pitched/celesta":"keyboard.celesta","percussion/pitched/glockenspiel":"pitched-percussion.glockenspiel","percussion/pitched/marimba":"pitched-percussion.marimba","percussion/pitched/metallophone":"pitched-percussion.metallophone","percussion/pitched/piano":"keyboard.piano","percussion/pitched/piano/grand":"keyboard.piano.grand","percussion/pitched/vibraphone":"pitched-percussion.vibraphone","percussion/pitched/xylophone":"pitched-percussion.xylophone","percussion/pitched/xylorimba":"pitched-percussion.xylorimba",strings:"strings.violin","strings/cello":"strings.cello","strings/contrabass":"strings.contrabass","strings/harp":"pluck.harp","strings/harpsichord":"keyboard.harpsichord","strings/guitar":"pluck.guitar","strings/guitar/acoustic":"pluck.guitar.acoustic","strings/guitar/electric":"pluck.guitar.electric","strings/viol/alto":"strings.viol.alto","strings/viol/bass":"strings.viol.bass","strings/viol/tenor":"strings.viol.tenor","strings/viola":"strings.viola","strings/violin":"strings.violin",vocal:"voice.vocals","vocal/alto":"voice.alto","vocal/bass":"voice.bass","vocal/child":"voice.child","vocal/countertenor":"voice.countertenor","vocal/female":"voice.female","vocal/male":"voice.male","vocal/mezzo-soprano":"voice.mezzo-soprano","vocal/soprano":"voice.soprano","vocal/tenor":"voice.tenor",woodwind:"wind.reed.clarinet","woodwind/bassoon":"wind.reed.bassoon","woodwind/clarinet":"wind.reed.clarinet","woodwind/clarinet/bass":"wind.reed.clarinet.bass","woodwind/clarinet/contrabass":"wind.reed.clarinet.contrabass","woodwind/contrabassoon":"wind.reed.contrabassoon","woodwind/english-horn":"wind.reed.english-horn","woodwind/flute":"wind.flutes.flute","woodwind/oboe":"wind.reed.oboe","woodwind/piccolo":"wind.flutes.flute.piccolo","woodwind/saxophone":"wind.reed.saxophone","woodwind/saxophone/alto":"wind.reed.saxophone.alto","woodwind/saxophone/baritone":"wind.reed.saxophone.baritone","woodwind/saxophone/soprano":"wind.reed.saxophone.soprano","woodwind/saxophone/tenor":"wind.reed.saxophone.tenor"},dn={brass:"brass/trumpet/premium","brass.euphonium":"brass/french-horn/premium","brass.french-horn":"brass/french-horn/premium","brass.mellophone":"brass/french-horn/premium","brass.sackbutt":"brass/trombone/premium","brass.sousaphone":"brass/tuba/premium","brass.trombone":"brass/trombone/premium","brass.trumpet":"brass/trumpet/premium","brass.tuba":"brass/tuba/premium",drum:"percussion/drums/premium","drum.bass-drum":"percussion/unpitched/bass-drum/premium","drum.bongo":"percussion/unpitched/bongo/premium","drum.snare-drum":"percussion/unpitched/snare/premium","drum.tenor-drum":"percussion/drums/marchingBand/tenor/premium","drum.timbale":"percussion/unpitched/timbales/premium","drum.timpani":"percussion/unpitched/timpani/premium","drum.tom-tom":"percussion/drums/tom-tom","drum.tom-tom.synth":"percussion/drums/tom-tom",effect:"keyboards/piano","effect.metronome-click":"percussion/unpitched/metronome/premium",keyboard:"percussion/pitched/piano/premium","keyboard.celesta":"percussion/pitched/celesta","keyboard.clavichord":"strings/harpsichord","keyboard.harpsichord":"strings/harpsichord","keyboard.organ":"keyboards/organ/premium","keyboard.piano":"percussion/pitched/piano/basic","keyboard.piano.electric":"keyboards/electric-piano/premium","keyboard.piano.grand":"percussion/pitched/piano/grand/premium","keyboard.virginal":"strings/harpsichord",metal:"percussion/generic/single","metal.bells.cowbell":"percussion/unpitched/cowbell/premium","metal.bells.jingle-bell":"percussion/unpitched/sleighBell/basic","metal.cymbal":"percussion/unpitched/cymbals/premium","pitched-percussion":"percussion/pitched/piano/premiumd","pitched-percussion.balafon":"percussion/pitched/marimba/premium","pitched-percussion.glockenspiel":"percussion/pitched/glockenspiel/premium","pitched-percussion.marimba":"percussion/pitched/marimba/premium","pitched-percussion.metallophone":"percussion/pitched/vibraphone/premium","pitched-percussion.vibraphone":"percussion/pitched/vibraphone/premium","pitched-percussion.xylophone":"percussion/pitched/xylophone/premium","pitched-percussion.xylorimba":"percussion/pitched/marimba/premium",pluck:"strings/guitar/premium","pluck.guitar.acoustic":"strings/guitar/acoustic/premium","pluck.guitar.electric":"strings/guitar/electric/paul","pluck.harp":"strings/harp/premium",rattle:"percussion/generic/single",strings:"strings/premium","strings.cello":"strings/cello/solo/premium","strings.contrabass":"strings/bass/upright/premium","strings.viol.alto":"strings/viola/solo/premium","strings.viol.bass":"strings/bass/upright/premium","strings.viol.tenor":"strings/cello/solo/premium","strings.viola":"strings/cello/solo/premium","strings.viola-damore":"strings/viola/solo/premium","strings.violin":"strings/violin/solo/premium",synth:"percussion/pitched/piano/premium",voice:"vocal/choir/female/aah","voice.alto":"ocal/choir/female/aah","voice.bass":"vocal/choir/male/aah","voice.child":"ocal/choir/female/aah","voice.countertenor":"vocal/choir/female/aah","voice.female":"ocal/choir/female/aah","voice.male":"vocal/choir/male/aah","voice.mezzo-soprano":"vocal/choir/female/aah","voice.soprano":"vocal/choir/female/aah","voice.tenor":"vocal/choir/male/aah",wind:"woodwind","wind.flutes":"woodwind/flute/premium","wind.flutes.flute.piccolo":"woodwind/piccolo/premium","wind.reed.bassoon":"woodwind/bassoon/premium","wind.reed.clarinet":"woodwind/clarinet/premium","wind.reed.clarinet.bass":"woodwind/clarinet/bass/premium","wind.reed.contrabassoon":"woodwind/bassoon/premium","wind.reed.english-horn":"woodwind/english-horn/premium","wind.reed.oboe":"woodwind/oboe/premium","wind.reed.oboe-da-caccia":"woodwind/oboe/premium","wind.reed.oboe-damore":"woodwind/oboe/premium","wind.reed.saxophone":"woodwind/saxophone/alto/premium","wind.reed.saxophone.alto":"woodwind/saxophone/alto/premium","wind.reed.saxophone.baritone":"woodwind/saxophone/baritone/premium","wind.reed.saxophone.soprano":"woodwind/saxophone/soprano/premium","wind.reed.saxophone.tenor":"woodwind/saxophone/tenor/premium","wind.reed.shawm":"woodwind/oboe/premium","wind.reed.shenai":"woodwind/oboe/premium",wood:"percussion/generic/single"};r.registerClass(hn,"com.noteflight.notation.fileformat.musicxml.MusicXmlInstrumentList");var fn=function(){function t(){y(this,t)}return p(t,null,[{key:"_MUSIC_XML_LAST_RESORT",get:function(){return"keyboard.piano"}},{key:"_NF_LAST_RESORT",get:function(){return"keyboards/piano"}}]),p(t,[{key:"translateInstrumentToMusicXml",value:function(e){return this.findInstrumentForMapping("/",e,hn.nfToMusicXml,t._MUSIC_XML_LAST_RESORT)}},{key:"translateXmlInstrumentToNoteflight",value:function(e){return this.findInstrumentForMapping(".",e,hn.musicXmlToNf,t._NF_LAST_RESORT)}},{key:"findInstrumentForMapping",value:function(t,e,i,n){var r,o;do{if(null!=(o=i[e]))return o;r=e.lastIndexOf(t),e=e.slice(0,r)}while(r>=0);return n}}]),t}();r.registerClass(fn,"com.noteflight.notation.fileformat.musicxml.MusicXmlInstrumentTranslator");var yn=function(){function t(){y(this,t),this.useSystemBreaks=!1,this.useTextPositions=!0,this.optimizeForPVG=!1,this.useStemDirections=!1,this.useSlurDirections=!1,this.combineSameStemVoices=!1,this.useLinesForEndings=!1,this.mapJazzFontsToAsh=!1,this.importStyle=null,this.importBlock=!1,this.importBlockNumbers=!1,this.matchBlocksWithBullets=!1,this.silenceHiddenNotes=!1,this.breakUpTitle=!1,this.putDetectedCreditsInComposer=!1}return p(t,null,[{key:"fromOptions",value:function(e){var i=new t;return i.useSystemBreaks=Gd.parseFromOptions(e,"useSystemBreaks",!1),i.useTextPositions=Gd.parseFromOptions(e,"useTextPositions",!0),i.optimizeForPVG=Gd.parseFromOptions(e,"optimizeForPVG",!1),i.useStemDirections=Gd.parseFromOptions(e,"useStemDirections",!1),i.useSlurDirections=Gd.parseFromOptions(e,"useSlurDirections",!1),i.combineSameStemVoices=Gd.parseFromOptions(e,"combineSameStemVoices",!1),i.useLinesForEndings=Gd.parseFromOptions(e,"useLinesForEndings",!1),i.mapJazzFontsToAsh=Gd.parseFromOptions(e,"mapJazzFontsToAsh",!1),e&&e.importStyle?i.importStyle=A.unknownToString(e.importStyle):i.importStyle=null,i.importBlock=Gd.parseFromOptions(e,"importBlock",!1),i.importBlockNumbers=Gd.parseFromOptions(e,"importBlockNumbers",!1),i.matchBlocksWithBullets=Gd.parseFromOptions(e,"matchBlocksWithBullets",!1),i.silenceHiddenNotes=Gd.parseFromOptions(e,"silenceHiddenNotes",!1),i.putDetectedCreditsInComposer=Gd.parseFromOptions(e,"putDetectedCreditsInComposer",!1),i}}]),t}();r.registerClass(yn,"com.noteflight.notation.fileformat.musicxml.MusicXmlOptions");var gn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this._xml=null,this._score=null,this._version=null,this._options=null,this._options=e}return p(t,[{key:"translateXml",value:function(t){if("score-partwise"!=t.name())throw new Error("Only <score-partwise> documents are supported.");this._version=t.attribute("version").toString();var e=new An;return null!=this._options&&(e.options=this._options),this._score=e.translateXml(t),this._xml=t,this._score}},{key:"xml",get:function(){return this._xml}},{key:"score",get:function(){return this._score}}]),t}();r.implementsInterfaces(gn,[nn]),r.registerClass(gn,"com.noteflight.notation.fileformat.musicxml.MusicXmlReader");var pn=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$glyphFamily="Sonata",t._$lineSpacing=e.DEFAULT_LINE_SPACING,t._$scoreLineSpacing=e.DEFAULT_LINE_SPACING,t._$creditLineSpacing=0,t._$scoreDisplayRespectSystemBreaks=!0,t._$partDisplayRespectSystemBreaks=!1,t._$lineThickness=.1,t._$clefPadding=new Qo(-.5,0,.75,0),t._$clefChangePadding=new Qo(0,0,.5,0),t._$timeSignaturePadding=new Qo(0,0,1,0),t._$keySignaturePadding=new Qo(-.75,0,1.25,0),t._$notePadding=new Qo(-.25,0,.5,0),t._$initialGracePadding=new Qo(-.5,0,.75,0),t._$noteLiaisonPadding=.75,t._$liaisonHorizontalPadding=.125,t._$liaisonVerticalPadding=.5,t._$maxLvTieWidth=.5,t._$bendIncreasePadding=4,t._$barlinePadding=new Qo(-.5,0,.5,0),t._$repeatEndingBracketHeight=1.75,t._$repeatEndingBracketEndX=-.25,t._$repeatEndingBracketTextYOffset=2,t._$repeatEndingBracketBold=!0,t._$autoMultiMeasureRestCreation=!1,t._$initialBarlinePadding=new Qo(0,0,1,0),t._$repeatWings=!0,t._$chordSymbolPadding=new Qo(0,-2,1,0),t._$chordFramePadding=new Qo(0,3.5,1,0),t._$expressionTextPadding=new Qo(0,3.75,1,0),t._$expressionTextTopPadding=9,t._$performanceTextPadding=new Qo(0,-3,1,0),t._$lyricsPadding=new Qo(-.5,0,.5,0),t._$lyricsNotesPadding=.5,t._$blockSidesPadding=60,t._$blockLeftMargin=30,t._$blockVerticalPadding=10,t._$blockBeforeBuffer=3,t._$blockAfterBuffer=-3,t._$blockBottomMargin=30,t._$blockColumnPadding=2,t._$numberOfColumnsPerBlock=1,t._$symbolOffset=4,t._$symbolScale=1,t._$symbolFirstMeasureXOffset=-.5,t._$indentationSpacing=0,t._$lyricsAboveStaffBottom=6,t._$lyricsBelowStaffTop=-2,t._$lyricsLineSpacing=2,t._$directionsAboveStaff=!0,t._$lyricExtensionPadding=.5,t._$lyricExtensionLength=1,t._$lyricExtensionThickness=.5,t._$useLyricsDefaultDirection=!0,t._$barStartPaddingLeft=1,t._$staffSpacing=5.5,t._$legerLineRatio=.325,t._$legerLineThickness=.125,t._$systemSpacing=9.25,t._$measureHandlePadding=4.625,t._$systemLineThickness=.125,t._$smallClefScale=.875,t._$accidentalSpacing=.28,t._$accidentalSpread=.2,t._$accidentalClearance=3,t._$parenthesisSpacing=.2,t._$accidentalKeySignatureSpacing=1,t._$glyphEffectSpacing=.28,t._$arpeggioWidth=.5,t._$arpeggioSpacing=.75,t._$normalStemLength=3.5,t._$nullStemLength=.5,t._$beamingStemLength=3,t._$multiVoiceBeamingStemLength=2.5,t._$stemMultiVoiceCutback=.5,t._$beamMultiVoiceCutback=.5,t._$lowerVoiceRestOffset=-2,t._$upperVoiceRestOffset=2,t._$stemThickness=.175,t._$dotSpacing=.25,t._$multipleDotGap=.5,t._$spacings=e.toNumberVector([1.41,1.41,1.41,1.41,1.94,2.5,3.5,6,8.2]),t._$minInterVoiceSpacing=1.41,t._$barTacetWidth=7,t._$barNumberBoxed=!1,t._$ripHorizontalSpacing=.28,t._$fallHorizontalSpacing=.05,t._$preEffectVerticalSpacing=.1,t._$postEffectVerticalSpacing=.25,t._$preEffectVerticalPaddingOffLine=.1,t._$postEffectVerticalPaddingOffLine=.15,t._$effectAdjustDelta=.5,t._$tieEffectVerticalPadding=.5,t._$tieHorizontalPadding=.35,t._$tieHorizontalPaddingDotted=.6,t._$slideHorizontalPadding=.3,t._$tieVerticalPaddingOnLine=.25,t._$tieHalfMaxHeightWidth=16,t._$tieHalfMaxShoulderWidth=5,t._$tieMaxShoulder=.2,t._$tieMaxStroke=.125,t._$slideStrokeBias=.25,t._$slideThickness=.125,t._$bendArrowHeight=1,t._$bendArrowWidth=.75,t._$tieSingleNoteEnabled=!0,t._$tieSingleNoteBelowSpacing=.5,t._$tieSingleNoteCenterPadding=.125,t._$tieStaffLineDither=.25,t._$tieMinimumVerticalSpacing=.75,t._$tieHeight=2,t._$slurHalfMaxHeightWidth=5,t._$slurHeight=1.5,t._$slurTolerance=2,t._$slurArticulationPadding=1.25,t._$slurPadding=1,t._$slurMinNormalizedHeight=0,t._$hairpinThickness=.1,t._$hairpinLongThreshold=8,t._$hairpinShortEndGap=1,t._$hairpinLongEndGap=1.5,t._$hairpinBreakGap=.75,t._$hairpinPadding=new Qo(1.5,-2.75,1,0),t._$hairpinEndExpressionPadding=1,t._$hairpinStartExpressionPadding=.3,t._$hairpinExpressionPaddingTop=6,t._$hairpinMinimumWidth=.5,t._$trillAccidentalScale=.8,t._$trillAccidentalYSpacing=-.5,t._$trillAccidentalXSpacing=.25,t._$beamThickness=.5,t._$beamSpacing=.25,t._$nearCrossoverOffset=1,t._$crossoverOffset=1.5,t._$wholeCrossoverOffset=2,t._$articulationPadding=.5,t._$articulationSpacing=.25,t._$rightArticulationPadding=2,t._$annotationIconHeight=1.75,t._$tupletBracketHeight=.5,t._$tupletHeight=1.25,t._$tupletNumberPadding=.5,t._$fractionalBeamLength=1.25,t._$tremoloInsetLength=1.25,t._$splitCodaByDefault=!1,t._$splitSystemGap=10,t._$titleY=1,t._$titleSize=.6,t._$titleBold=!1,t._$subtitleSize=.3,t._$subtitleBold=!1,t._$supertitleSize=.3,t._$supertitleBold=!1,t._$composerBold=!1,t._$lyricistBold=!1,t._$copyrightBold=!1,t._$footerBold=!1,t._$composerY=6,t._$composerSize=.4,t._$composerBottomPadding=2,t._$arrangerBottomPadding=2,t._$arrangerPlaceholderBottomPadding=.5,t._$pageNumberY=0,t._$pageNumberSize=.3,t._$pageNumberIncludesTitle=!1,t._$copyrightSize=.24,t._$showCopyrightOnAllPages=!1,t._$textProportional=!0,t._$footerSize=.24,t._$footerColor=0,t._$titlePageTopPadding=10,t._$titlePageSubtitlePadding=.5,t._$titlePageSupertitlePadding=.5,t._$pageTopPadding=0,t._$titlePageFirstStaffPadding=0,t._$titlePagePromptSize=.3,t._$titlePagePromptPadding=new Qo(0,5,0,0),t._$staffLabelPadding=1.75,t._$grandStaffPadding=.5,t._$partNameSize=.3,t._$tempoSymbolSize=.22,t._$tempoSymbolScale=.75,t._$tempoFirstMeasureXOffset=-4,t._$tempoTimeSignatureXOffset=-3,t._$tempoTimeSignatureXOffsetFirstMeasure=-3,t._$tempoXOffset=-1,t._$tempoXOffsetFirstMeasure=-2,t._$tempoUnitOffset=3.78,t._$tempoTextOffset=2,t._$chordSymbolSize=.32,t._$repeatEndingFontSize=.25,t._$keepChordSymbolsApart=!1,t._$centerChordSymbols=!1,t._$chordBelowStaffOffset=-10,t._$chordBelowStaffOffsetTab=-14,t._$expressionTextSize=.3,t._$expressionTextSpacing=-2,t._$performanceTextSize=.3,t._$labelTextSize=.25,t._$performanceTextSpacing=-2.5,t._$lyricsSize=.275,t._$lyricsDescent=.25,t._$lyricsAscent=1-t.lyricsDescent,t._$blockSize=.275,t._$blockHeaderWeight=2,t._$blockColumnWeight=10,t._$mouseNotationPadding=.5,t._$mouseNoteEntryStemMargin=.5,t._$mouseNoteEntrySlopWidth=3.5,t._$mouseNoteEntrySlopHeight=3.75,t._$textFont="Georgia",t._$titleFont="Georgia",t._$subtitleFont="Georgia",t._$supertitleFont="Georgia",t._$composerFont="Georgia",t._$arrangerFont="Georgia",t._$lyricistFont="Georgia",t._$copyrightFont="Georgia",t._$footerFont="Georgia",t._$staffTextFont="Georgia",t._$lyricsFont="Georgia",t._$blockFont="Georgia",t._$lyricsBold=!1,t._$lyricsItalic=!1,t._$arrangerBold=!1,t._$arrangerItalic=!1,t._$showMultipleHyphens=!0,t._$hyphensMinPadding=4,t._$chordSymbolFont="Tahoma",t._$tempoFont="Tahoma",t._$tempoBold=!1,t._$cueScale=.75,t._$graceScale=.6,t._$tabGraceScale=.8,t._$tabFretBackgroundPadding=.1,t._$tabFretWidth=2.25,t._$tabStemOffset=1,t._$lineNotationPadding=new Qo(1.5,0,1,0),t._$lineNotationThickness=.1,t._$lineNotationLongThreshold=8,t._$lineNotationBreakGap=.75,t._$lineNotationFontSize=.275,t._$lineNotationBracketHeight=1,t._$lineNotationYPosition=6,t._$lineNotationDistanceAboveStaff=2,t._$lineNotationDistanceBelowStaff=-2,t._$repeatEndingDistanceAboveStaff=8,t._$tremoloVerticalStemOffset=1.4,t._$tremoloVerticalNoteOffset=1.7,t._$stemDecorationVerticalStemOffset=1,t._$stemDecorationVerticalNoteOffset=2,t._$chordFrameFretSpacing=1,t._$chordFrameStringSpacing=.75,t._$spaceAboveChords=3,t._$spaceAboveChordFrames=8.5,t._$spaceAbovePerformanceText=3,t._$verticalAutoSpace=!1,t._$layoutSpacing=0,t._$minVerticalGap=.5,t._$systemStretch=5,t._$topStaffGap=5,t._$ignoreStemDirection=!1,t._$ignoreSlurDirection=!1,t._$ignoreSystemMargins=!1,t._$swingDelta=0,t._style=null,t._$musicFont=e.STYLE_DEFAULT,t._$showBarNumbers=!1,t._$showBarNumbersOnEachMeasure=!1,t._$showPartNames=e.SHOW_PART_NAMES_DEFAULT,t._$partNamePosition=e.PART_NAME_POSITION_STAFF,t._$showPartNamesOnEveryPage=!1,t._$partNameAtTheTopOffset=-2,t._$showTabRhythm=!0,t}return c(e,se),p(e,null,[{key:"MIN_LINE_SPACING",get:function(){return 2}},{key:"MAX_LINE_SPACING",get:function(){return 12}},{key:"MIN_STAFF_SPACING",get:function(){return 0}},{key:"MAX_STAFF_SPACING",get:function(){return 25}},{key:"MIN_SYSTEM_SPACING",get:function(){return 0}},{key:"MAX_SYSTEM_SPACING",get:function(){return 25}},{key:"DEFAULT_LINE_SPACING",get:function(){return 6}},{key:"DEFAULT_STAFF_HEIGHT",get:function(){return 40}},{key:"DEFAULT_GLYPH_FAMILY",get:function(){return"Sonata"}},{key:"STYLE_DEFAULT",get:function(){return"default"}},{key:"STYLE_PVG",get:function(){return"pvg"}},{key:"STYLE_CCLI",get:function(){return"ccli"}},{key:"STYLE_CCLI_MULTI",get:function(){return"ccliMulti"}},{key:"STYLE_CCLI_SINGLE",get:function(){return"ccliSingle"}},{key:"STYLE_CCLI_MULTI_HANGUL",get:function(){return"ccliMultiHangul"}},{key:"STYLE_CCLI_SINGLE_HANGUL",get:function(){return"ccliSingleHangul"}},{key:"STYLE_JAZZ_ASH",get:function(){return"jazzAsh"}},{key:"STYLE_YCJ",get:function(){return"ycj"}},{key:"STYLE_HLC_ACCORDION",get:function(){return"hlcAccordion"}},{key:"STYLE_HLC_INSTRUMENTAL_SOLO",get:function(){return"hlcInstrumentalSolo"}},{key:"STYLE_HLC_BIG_NOTE",get:function(){return"hlcBigNote"}},{key:"STYLE_HLC_CHORAL",get:function(){return"hlcChoral"}},{key:"STYLE_HLC_EASY_PIANO",get:function(){return"hlcEasyPiano"}},{key:"STYLE_HLC_EDUCATIONAL_PIANO",get:function(){return"hlcEducationalPiano"}},{key:"STYLE_HLC_FAKEBOOK",get:function(){return"hlcFakebook"}},{key:"STYLE_HLC_GUITAR",get:function(){return"hlcGuitar"}},{key:"STYLE_HLC_PIANO_SOLO",get:function(){return"hlcPianoSolo"}},{key:"STYLE_HLC_UKULELE",get:function(){return"hlcUkulele"}},{key:"STYLE_HLC_PVG",get:function(){return"hlcPvg"}},{key:"STYLE_CL_JAZZ",get:function(){return"clJazz"}},{key:"STYLE_MS_PVG",get:function(){return"msPvg"}},{key:"STYLE_MS_EASY_PIANO",get:function(){return"msEasyPiano"}},{key:"SHOW_PART_NAMES_DEFAULT",get:function(){return!1}},{key:"PART_NAME_POSITION_STAFF",get:function(){return"staff"}},{key:"PART_NAME_POSITION_TOP_LEFT_OF_THE_PAGE",get:function(){return"topLeftOfThePage"}}]),p(e,[{key:"createFoundryMetrics",value:function(){var t=new _r;return t.sizeUnit=this.lineSpacing,t.lineSpacing=this.lineSpacing,t.stemThickness=this.stemThickness,t}},{key:"getTimeWidth",value:function(t){var e=A.as(t,mn);if(null!=e){var i=A.numberToUint(Math.min(this.spacings.length-1,e.value)),n=this.spacings[i];return e.dots>0&&i<this.spacings.length-1&&(n=Math.sqrt(n*this.spacings[i+1])),n}return 0}},{key:"getDurationWidth",value:function(t){if(0===t)return 0;var e=A.numberToInt(Math.min(this.spacings.length-1,mn.durationToValue(t)));return t==1<<e||e==this.spacings.length-1?this.spacings[e]:Math.sqrt(this.spacings[e]*this.spacings[e+1])}},{key:"tieStandardHeight",value:function(t){return.25+(2/(1+Math.exp(-Math.abs(t)/this.tieHalfMaxHeightWidth))-1)*this.tieHeight}},{key:"tieShoulder",value:function(t){return.25-(2/(1+Math.exp(-Math.abs(t)/this.tieHalfMaxShoulderWidth))-1)*this.tieMaxShoulder}},{key:"slurStandardHeight",value:function(t){return(2/(1+Math.exp(-Math.abs(t)/this.slurHalfMaxHeightWidth))-1)*this.slurHeight}},{key:"pageTextPxToLines",value:function(t){return t/this.creditFontSize}},{key:"setMusicFont",value:function(t){switch(this.musicFont=t,t){case e.STYLE_DEFAULT:this.glyphFamily="Sonata",this.chordSymbolFont="Tahoma",this.textFont="Georgia",this.titleFont="Georgia",this.subtitleFont="Georgia",this.supertitleFont="Georgia",this.composerFont="Georgia",this.arrangerFont="Georgia",this.lyricistFont="Georgia",this.copyrightFont="Georgia",this.footerFont="Georgia",this.staffTextFont="Georgia",this.lyricsFont="Georgia",this.tempoFont="Tahoma",this.stemThickness=.175,this.legerLineThickness=.125,this.chordSymbolSize=.32,this.tempoSymbolSize=.22,this.repeatEndingBracketHeight=1.75,this.repeatEndingDistanceAboveStaff=8,this.repeatEndingBracketTextYOffset=2;break;case e.STYLE_JAZZ_ASH:this.glyphFamily="Ash",this.chordSymbolFont="AshText",this.textFont="AshText",this.titleFont="AshText",this.subtitleFont="AshText",this.supertitleFont="AshText",this.composerFont="AshText",this.arrangerFont="AshText",this.lyricistFont="AshText",this.copyrightFont="AshText",this.footerFont="AshText",this.staffTextFont="AshText",this.lyricsFont="AshText",this.tempoFont="AshText",this.stemThickness=.2,this.legerLineThickness=.25,this.chordSymbolSize=.5,this.tempoSymbolSize=.3,this.repeatEndingBracketHeight=3,this.repeatEndingDistanceAboveStaff=9,this.repeatEndingBracketTextYOffset=9}}},{key:"clone",value:function(){var t=new e;return t.scoreLineSpacing=this.scoreLineSpacing,t.staffSpacing=this.staffSpacing,t.systemSpacing=this.systemSpacing,t.systemStretch=this.systemStretch,t.titlePageFirstStaffPadding=this.titlePageFirstStaffPadding,t.layoutSpacing=this.layoutSpacing,t.indentationSpacing=this.indentationSpacing,t.verticalAutoSpace=this.verticalAutoSpace,t.centerChordSymbols=this.centerChordSymbols,t.keepChordSymbolsApart=this.keepChordSymbolsApart,t.showMultipleHyphens=this.showMultipleHyphens,t.hyphensMinPadding=this.hyphensMinPadding,t.autoMultiMeasureRestCreation=this.autoMultiMeasureRestCreation,t.partDisplayRespectSystemBreaks=this.partDisplayRespectSystemBreaks,t.titleSize=this.titleSize,t.subtitleSize=this.subtitleSize,t.supertitleSize=this.supertitleSize,t.composerSize=this.composerSize,t.titlePagePromptSize=this.titlePagePromptSize,t.copyrightSize=this.copyrightSize,t.pageNumberSize=this.pageNumberSize,t.lyricsSize=this.lyricsSize,t.performanceTextSize=this.performanceTextSize,t.chordSymbolSize=this.chordSymbolSize,t.showCopyrightOnAllPages=this.showCopyrightOnAllPages,t.textProportional=this.textProportional,t.showPartNames=this.showPartNames,t.partNamePosition=this.partNamePosition,t.showPartNamesOnEveryPage=this.showPartNamesOnEveryPage,t.musicFont=this.musicFont,t.showBarNumbers=this.showBarNumbers,t.showBarNumbersOnEachMeasure=this.showBarNumbersOnEachMeasure,t.showTabRhythm=this.showTabRhythm,t}},{key:"glyphFamily",get:function(){return this._$glyphFamily},set:function(t){var e=this._$glyphFamily;this._$glyphFamily=t,e!==t&&this._propertyChanged("glyphFamily",e,t)}},{key:"lineSpacing",get:function(){return this._$lineSpacing},set:function(t){var e=this._$lineSpacing;this._$lineSpacing=t,e!==t&&this._propertyChanged("lineSpacing",e,t)}},{key:"scoreLineSpacing",get:function(){return this._$scoreLineSpacing},set:function(t){var e=this._$scoreLineSpacing;this._$scoreLineSpacing=t,e!==t&&this._propertyChanged("scoreLineSpacing",e,t)}},{key:"creditLineSpacing",get:function(){return this._$creditLineSpacing},set:function(t){var e=this._$creditLineSpacing;this._$creditLineSpacing=t,e!==t&&this._propertyChanged("creditLineSpacing",e,t)}},{key:"scoreDisplayRespectSystemBreaks",get:function(){return this._$scoreDisplayRespectSystemBreaks},set:function(t){var e=this._$scoreDisplayRespectSystemBreaks;this._$scoreDisplayRespectSystemBreaks=t,e!==t&&this._propertyChanged("scoreDisplayRespectSystemBreaks",e,t)}},{key:"partDisplayRespectSystemBreaks",get:function(){return this._$partDisplayRespectSystemBreaks},set:function(t){var e=this._$partDisplayRespectSystemBreaks;this._$partDisplayRespectSystemBreaks=t,e!==t&&this._propertyChanged("partDisplayRespectSystemBreaks",e,t)}},{key:"lineThickness",get:function(){return this._$lineThickness},set:function(t){var e=this._$lineThickness;this._$lineThickness=t,e!==t&&this._propertyChanged("lineThickness",e,t)}},{key:"clefPadding",get:function(){return this._$clefPadding},set:function(t){var e=this._$clefPadding;this._$clefPadding=t,e!==t&&this._propertyChanged("clefPadding",e,t)}},{key:"clefChangePadding",get:function(){return this._$clefChangePadding},set:function(t){var e=this._$clefChangePadding;this._$clefChangePadding=t,e!==t&&this._propertyChanged("clefChangePadding",e,t)}},{key:"timeSignaturePadding",get:function(){return this._$timeSignaturePadding},set:function(t){var e=this._$timeSignaturePadding;this._$timeSignaturePadding=t,e!==t&&this._propertyChanged("timeSignaturePadding",e,t)}},{key:"keySignaturePadding",get:function(){return this._$keySignaturePadding},set:function(t){var e=this._$keySignaturePadding;this._$keySignaturePadding=t,e!==t&&this._propertyChanged("keySignaturePadding",e,t)}},{key:"notePadding",get:function(){return this._$notePadding},set:function(t){var e=this._$notePadding;this._$notePadding=t,e!==t&&this._propertyChanged("notePadding",e,t)}},{key:"initialGracePadding",get:function(){return this._$initialGracePadding},set:function(t){var e=this._$initialGracePadding;this._$initialGracePadding=t,e!==t&&this._propertyChanged("initialGracePadding",e,t)}},{key:"noteLiaisonPadding",get:function(){return this._$noteLiaisonPadding},set:function(t){var e=this._$noteLiaisonPadding;this._$noteLiaisonPadding=t,e!==t&&this._propertyChanged("noteLiaisonPadding",e,t)}},{key:"liaisonHorizontalPadding",get:function(){return this._$liaisonHorizontalPadding},set:function(t){var e=this._$liaisonHorizontalPadding;this._$liaisonHorizontalPadding=t,e!==t&&this._propertyChanged("liaisonHorizontalPadding",e,t)}},{key:"liaisonVerticalPadding",get:function(){return this._$liaisonVerticalPadding},set:function(t){var e=this._$liaisonVerticalPadding;this._$liaisonVerticalPadding=t,e!==t&&this._propertyChanged("liaisonVerticalPadding",e,t)}},{key:"maxLvTieWidth",get:function(){return this._$maxLvTieWidth},set:function(t){var e=this._$maxLvTieWidth;this._$maxLvTieWidth=t,e!==t&&this._propertyChanged("maxLvTieWidth",e,t)}},{key:"bendIncreasePadding",get:function(){return this._$bendIncreasePadding},set:function(t){var e=this._$bendIncreasePadding;this._$bendIncreasePadding=t,e!==t&&this._propertyChanged("bendIncreasePadding",e,t)}},{key:"barlinePadding",get:function(){return this._$barlinePadding},set:function(t){var e=this._$barlinePadding;this._$barlinePadding=t,e!==t&&this._propertyChanged("barlinePadding",e,t)}},{key:"repeatEndingBracketEndX",get:function(){return this._$repeatEndingBracketEndX},set:function(t){var e=this._$repeatEndingBracketEndX;this._$repeatEndingBracketEndX=t,e!==t&&this._propertyChanged("repeatEndingBracketEndX",e,t)}},{key:"repeatEndingBracketHeight",get:function(){return this._$repeatEndingBracketHeight},set:function(t){var e=this._$repeatEndingBracketHeight;this._$repeatEndingBracketHeight=t,e!==t&&this._propertyChanged("repeatEndingBracketHeight",e,t)}},{key:"repeatEndingBracketTextYOffset",get:function(){return this._$repeatEndingBracketTextYOffset},set:function(t){var e=this._$repeatEndingBracketTextYOffset;this._$repeatEndingBracketTextYOffset=t,e!==t&&this._propertyChanged("repeatEndingBracketTextYOffset",e,t)}},{key:"repeatEndingBracketBold",get:function(){return this._$repeatEndingBracketBold},set:function(t){var e=this._$repeatEndingBracketBold;this._$repeatEndingBracketBold=t,e!==t&&this._propertyChanged("repeatEndingBracketBold",e,t)}},{key:"autoMultiMeasureRestCreation",get:function(){return this._$autoMultiMeasureRestCreation},set:function(t){var e=this._$autoMultiMeasureRestCreation;this._$autoMultiMeasureRestCreation=t,e!==t&&this._propertyChanged("autoMultiMeasureRestCreation",e,t)}},{key:"initialBarlinePadding",get:function(){return this._$initialBarlinePadding},set:function(t){var e=this._$initialBarlinePadding;this._$initialBarlinePadding=t,e!==t&&this._propertyChanged("initialBarlinePadding",e,t)}},{key:"repeatWings",get:function(){return this._$repeatWings},set:function(t){var e=this._$repeatWings;this._$repeatWings=t,e!==t&&this._propertyChanged("repeatWings",e,t)}},{key:"chordSymbolPadding",get:function(){return this._$chordSymbolPadding},set:function(t){var e=this._$chordSymbolPadding;this._$chordSymbolPadding=t,e!==t&&this._propertyChanged("chordSymbolPadding",e,t)}},{key:"chordFramePadding",get:function(){return this._$chordFramePadding},set:function(t){var e=this._$chordFramePadding;this._$chordFramePadding=t,e!==t&&this._propertyChanged("chordFramePadding",e,t)}},{key:"expressionTextPadding",get:function(){return this._$expressionTextPadding},set:function(t){var e=this._$expressionTextPadding;this._$expressionTextPadding=t,e!==t&&this._propertyChanged("expressionTextPadding",e,t)}},{key:"expressionTextTopPadding",get:function(){return this._$expressionTextTopPadding},set:function(t){var e=this._$expressionTextTopPadding;this._$expressionTextTopPadding=t,e!==t&&this._propertyChanged("expressionTextTopPadding",e,t)}},{key:"performanceTextPadding",get:function(){return this._$performanceTextPadding},set:function(t){var e=this._$performanceTextPadding;this._$performanceTextPadding=t,e!==t&&this._propertyChanged("performanceTextPadding",e,t)}},{key:"lyricsPadding",get:function(){return this._$lyricsPadding},set:function(t){var e=this._$lyricsPadding;this._$lyricsPadding=t,e!==t&&this._propertyChanged("lyricsPadding",e,t)}},{key:"lyricsNotesPadding",get:function(){return this._$lyricsNotesPadding},set:function(t){var e=this._$lyricsNotesPadding;this._$lyricsNotesPadding=t,e!==t&&this._propertyChanged("lyricsNotesPadding",e,t)}},{key:"blockSidesPadding",get:function(){return this._$blockSidesPadding},set:function(t){var e=this._$blockSidesPadding;this._$blockSidesPadding=t,e!==t&&this._propertyChanged("blockSidesPadding",e,t)}},{key:"blockLeftMargin",get:function(){return this._$blockLeftMargin},set:function(t){var e=this._$blockLeftMargin;this._$blockLeftMargin=t,e!==t&&this._propertyChanged("blockLeftMargin",e,t)}},{key:"blockVerticalPadding",get:function(){return this._$blockVerticalPadding},set:function(t){var e=this._$blockVerticalPadding;this._$blockVerticalPadding=t,e!==t&&this._propertyChanged("blockVerticalPadding",e,t)}},{key:"blockBeforeBuffer",get:function(){return this._$blockBeforeBuffer},set:function(t){var e=this._$blockBeforeBuffer;this._$blockBeforeBuffer=t,e!==t&&this._propertyChanged("blockBeforeBuffer",e,t)}},{key:"blockAfterBuffer",get:function(){return this._$blockAfterBuffer},set:function(t){var e=this._$blockAfterBuffer;this._$blockAfterBuffer=t,e!==t&&this._propertyChanged("blockAfterBuffer",e,t)}},{key:"blockColumnPadding",get:function(){return this._$blockColumnPadding},set:function(t){var e=this._$blockColumnPadding;this._$blockColumnPadding=t,e!==t&&this._propertyChanged("blockColumnPadding",e,t)}},{key:"numberOfColumnsPerBlock",get:function(){return this._$numberOfColumnsPerBlock},set:function(t){var e=this._$numberOfColumnsPerBlock;this._$numberOfColumnsPerBlock=t,e!==t&&this._propertyChanged("numberOfColumnsPerBlock",e,t)}},{key:"symbolOffset",get:function(){return this._$symbolOffset},set:function(t){var e=this._$symbolOffset;this._$symbolOffset=t,e!==t&&this._propertyChanged("symbolOffset",e,t)}},{key:"symbolScale",get:function(){return this._$symbolScale},set:function(t){var e=this._$symbolScale;this._$symbolScale=t,e!==t&&this._propertyChanged("symbolScale",e,t)}},{key:"symbolFirstMeasureXOffset",get:function(){return this._$symbolFirstMeasureXOffset},set:function(t){var e=this._$symbolFirstMeasureXOffset;this._$symbolFirstMeasureXOffset=t,e!==t&&this._propertyChanged("symbolFirstMeasureXOffset",e,t)}},{key:"indentationSpacing",get:function(){return this._$indentationSpacing},set:function(t){var e=this._$indentationSpacing;this._$indentationSpacing=t,e!==t&&this._propertyChanged("indentationSpacing",e,t)}},{key:"lyricsAboveStaffBottom",get:function(){return this._$lyricsAboveStaffBottom},set:function(t){var e=this._$lyricsAboveStaffBottom;this._$lyricsAboveStaffBottom=t,e!==t&&this._propertyChanged("lyricsAboveStaffBottom",e,t)}},{key:"lyricsBelowStaffTop",get:function(){return this._$lyricsBelowStaffTop},set:function(t){var e=this._$lyricsBelowStaffTop;this._$lyricsBelowStaffTop=t,e!==t&&this._propertyChanged("lyricsBelowStaffTop",e,t)}},{key:"lyricsLineSpacing",get:function(){return this._$lyricsLineSpacing},set:function(t){var e=this._$lyricsLineSpacing;this._$lyricsLineSpacing=t,e!==t&&this._propertyChanged("lyricsLineSpacing",e,t)}},{key:"directionsAboveStaff",get:function(){return this._$directionsAboveStaff},set:function(t){var e=this._$directionsAboveStaff;this._$directionsAboveStaff=t,e!==t&&this._propertyChanged("directionsAboveStaff",e,t)}},{key:"lyricExtensionPadding",get:function(){return this._$lyricExtensionPadding},set:function(t){var e=this._$lyricExtensionPadding;this._$lyricExtensionPadding=t,e!==t&&this._propertyChanged("lyricExtensionPadding",e,t)}},{key:"lyricExtensionLength",get:function(){return this._$lyricExtensionLength},set:function(t){var e=this._$lyricExtensionLength;this._$lyricExtensionLength=t,e!==t&&this._propertyChanged("lyricExtensionLength",e,t)}},{key:"lyricExtensionThickness",get:function(){return this._$lyricExtensionThickness},set:function(t){var e=this._$lyricExtensionThickness;this._$lyricExtensionThickness=t,e!==t&&this._propertyChanged("lyricExtensionThickness",e,t)}},{key:"useLyricsDefaultDirection",get:function(){return this._$useLyricsDefaultDirection},set:function(t){var e=this._$useLyricsDefaultDirection;this._$useLyricsDefaultDirection=t,e!==t&&this._propertyChanged("useLyricsDefaultDirection",e,t)}},{key:"barStartPaddingLeft",get:function(){return this._$barStartPaddingLeft},set:function(t){var e=this._$barStartPaddingLeft;this._$barStartPaddingLeft=t,e!==t&&this._propertyChanged("barStartPaddingLeft",e,t)}},{key:"staffSpacing",get:function(){return this._$staffSpacing},set:function(t){var e=this._$staffSpacing;this._$staffSpacing=t,e!==t&&this._propertyChanged("staffSpacing",e,t)}},{key:"legerLineRatio",get:function(){return this._$legerLineRatio},set:function(t){var e=this._$legerLineRatio;this._$legerLineRatio=t,e!==t&&this._propertyChanged("legerLineRatio",e,t)}},{key:"legerLineThickness",get:function(){return this._$legerLineThickness},set:function(t){var e=this._$legerLineThickness;this._$legerLineThickness=t,e!==t&&this._propertyChanged("legerLineThickness",e,t)}},{key:"systemSpacing",get:function(){return this._$systemSpacing},set:function(t){var e=this._$systemSpacing;this._$systemSpacing=t,e!==t&&this._propertyChanged("systemSpacing",e,t)}},{key:"measureHandlePadding",get:function(){return this._$measureHandlePadding},set:function(t){var e=this._$measureHandlePadding;this._$measureHandlePadding=t,e!==t&&this._propertyChanged("measureHandlePadding",e,t)}},{key:"systemLineThickness",get:function(){return this._$systemLineThickness},set:function(t){var e=this._$systemLineThickness;this._$systemLineThickness=t,e!==t&&this._propertyChanged("systemLineThickness",e,t)}},{key:"smallClefScale",get:function(){return this._$smallClefScale},set:function(t){var e=this._$smallClefScale;this._$smallClefScale=t,e!==t&&this._propertyChanged("smallClefScale",e,t)}},{key:"accidentalSpacing",get:function(){return this._$accidentalSpacing},set:function(t){var e=this._$accidentalSpacing;this._$accidentalSpacing=t,e!==t&&this._propertyChanged("accidentalSpacing",e,t)}},{key:"accidentalSpread",get:function(){return this._$accidentalSpread},set:function(t){var e=this._$accidentalSpread;this._$accidentalSpread=t,e!==t&&this._propertyChanged("accidentalSpread",e,t)}},{key:"accidentalClearance",get:function(){return this._$accidentalClearance},set:function(t){var e=this._$accidentalClearance;this._$accidentalClearance=t,e!==t&&this._propertyChanged("accidentalClearance",e,t)}},{key:"parenthesisSpacing",get:function(){return this._$parenthesisSpacing},set:function(t){var e=this._$parenthesisSpacing;this._$parenthesisSpacing=t,e!==t&&this._propertyChanged("parenthesisSpacing",e,t)}},{key:"accidentalKeySignatureSpacing",get:function(){return this._$accidentalKeySignatureSpacing},set:function(t){var e=this._$accidentalKeySignatureSpacing;this._$accidentalKeySignatureSpacing=t,e!==t&&this._propertyChanged("accidentalKeySignatureSpacing",e,t)}},{key:"glyphEffectSpacing",get:function(){return this._$glyphEffectSpacing},set:function(t){var e=this._$glyphEffectSpacing;this._$glyphEffectSpacing=t,e!==t&&this._propertyChanged("glyphEffectSpacing",e,t)}},{key:"arpeggioWidth",get:function(){return this._$arpeggioWidth},set:function(t){var e=this._$arpeggioWidth;this._$arpeggioWidth=t,e!==t&&this._propertyChanged("arpeggioWidth",e,t)}},{key:"arpeggioSpacing",get:function(){return this._$arpeggioSpacing},set:function(t){var e=this._$arpeggioSpacing;this._$arpeggioSpacing=t,e!==t&&this._propertyChanged("arpeggioSpacing",e,t)}},{key:"normalStemLength",get:function(){return this._$normalStemLength},set:function(t){var e=this._$normalStemLength;this._$normalStemLength=t,e!==t&&this._propertyChanged("normalStemLength",e,t)}},{key:"nullStemLength",get:function(){return this._$nullStemLength},set:function(t){var e=this._$nullStemLength;this._$nullStemLength=t,e!==t&&this._propertyChanged("nullStemLength",e,t)}},{key:"beamingStemLength",get:function(){return this._$beamingStemLength},set:function(t){var e=this._$beamingStemLength;this._$beamingStemLength=t,e!==t&&this._propertyChanged("beamingStemLength",e,t)}},{key:"multiVoiceBeamingStemLength",get:function(){return this._$multiVoiceBeamingStemLength},set:function(t){var e=this._$multiVoiceBeamingStemLength;this._$multiVoiceBeamingStemLength=t,e!==t&&this._propertyChanged("multiVoiceBeamingStemLength",e,t)}},{key:"stemMultiVoiceCutback",get:function(){return this._$stemMultiVoiceCutback},set:function(t){var e=this._$stemMultiVoiceCutback;this._$stemMultiVoiceCutback=t,e!==t&&this._propertyChanged("stemMultiVoiceCutback",e,t)}},{key:"beamMultiVoiceCutback",get:function(){return this._$beamMultiVoiceCutback},set:function(t){var e=this._$beamMultiVoiceCutback;this._$beamMultiVoiceCutback=t,e!==t&&this._propertyChanged("beamMultiVoiceCutback",e,t)}},{key:"lowerVoiceRestOffset",get:function(){return this._$lowerVoiceRestOffset},set:function(t){var e=this._$lowerVoiceRestOffset;this._$lowerVoiceRestOffset=t,e!==t&&this._propertyChanged("lowerVoiceRestOffset",e,t)}},{key:"upperVoiceRestOffset",get:function(){return this._$upperVoiceRestOffset},set:function(t){var e=this._$upperVoiceRestOffset;this._$upperVoiceRestOffset=t,e!==t&&this._propertyChanged("upperVoiceRestOffset",e,t)}},{key:"stemThickness",get:function(){return this._$stemThickness},set:function(t){var e=this._$stemThickness;this._$stemThickness=t,e!==t&&this._propertyChanged("stemThickness",e,t)}},{key:"dotSpacing",get:function(){return this._$dotSpacing},set:function(t){var e=this._$dotSpacing;this._$dotSpacing=t,e!==t&&this._propertyChanged("dotSpacing",e,t)}},{key:"multipleDotGap",get:function(){return this._$multipleDotGap},set:function(t){var e=this._$multipleDotGap;this._$multipleDotGap=t,e!==t&&this._propertyChanged("multipleDotGap",e,t)}},{key:"spacings",get:function(){return this._$spacings},set:function(t){var e=this._$spacings;this._$spacings=t,e!==t&&this._propertyChanged("spacings",e,t)}},{key:"minInterVoiceSpacing",get:function(){return this._$minInterVoiceSpacing},set:function(t){var e=this._$minInterVoiceSpacing;this._$minInterVoiceSpacing=t,e!==t&&this._propertyChanged("minInterVoiceSpacing",e,t)}},{key:"barTacetWidth",get:function(){return this._$barTacetWidth},set:function(t){var e=this._$barTacetWidth;this._$barTacetWidth=t,e!==t&&this._propertyChanged("barTacetWidth",e,t)}},{key:"barNumberBoxed",get:function(){return this._$barNumberBoxed},set:function(t){var e=this._$barNumberBoxed;this._$barNumberBoxed=t,e!==t&&this._propertyChanged("barNumberBoxed",e,t)}},{key:"ripHorizontalSpacing",get:function(){return this._$ripHorizontalSpacing},set:function(t){var e=this._$ripHorizontalSpacing;this._$ripHorizontalSpacing=t,e!==t&&this._propertyChanged("ripHorizontalSpacing",e,t)}},{key:"fallHorizontalSpacing",get:function(){return this._$fallHorizontalSpacing},set:function(t){var e=this._$fallHorizontalSpacing;this._$fallHorizontalSpacing=t,e!==t&&this._propertyChanged("fallHorizontalSpacing",e,t)}},{key:"preEffectVerticalPaddingOffLine",get:function(){return this._$preEffectVerticalPaddingOffLine},set:function(t){var e=this._$preEffectVerticalPaddingOffLine;this._$preEffectVerticalPaddingOffLine=t,e!==t&&this._propertyChanged("preEffectVerticalPaddingOffLine",e,t)}},{key:"postEffectVerticalPaddingOffLine",get:function(){return this._$postEffectVerticalPaddingOffLine},set:function(t){var e=this._$postEffectVerticalPaddingOffLine;this._$postEffectVerticalPaddingOffLine=t,e!==t&&this._propertyChanged("postEffectVerticalPaddingOffLine",e,t)}},{key:"preEffectVerticalSpacing",get:function(){return this._$preEffectVerticalSpacing},set:function(t){var e=this._$preEffectVerticalSpacing;this._$preEffectVerticalSpacing=t,e!==t&&this._propertyChanged("preEffectVerticalSpacing",e,t)}},{key:"postEffectVerticalSpacing",get:function(){return this._$postEffectVerticalSpacing},set:function(t){var e=this._$postEffectVerticalSpacing;this._$postEffectVerticalSpacing=t,e!==t&&this._propertyChanged("postEffectVerticalSpacing",e,t)}},{key:"effectAdjustDelta",get:function(){return this._$effectAdjustDelta},set:function(t){var e=this._$effectAdjustDelta;this._$effectAdjustDelta=t,e!==t&&this._propertyChanged("effectAdjustDelta",e,t)}},{key:"tieEffectVerticalPadding",get:function(){return this._$tieEffectVerticalPadding},set:function(t){var e=this._$tieEffectVerticalPadding;this._$tieEffectVerticalPadding=t,e!==t&&this._propertyChanged("tieEffectVerticalPadding",e,t)}},{key:"tieHorizontalPadding",get:function(){return this._$tieHorizontalPadding},set:function(t){var e=this._$tieHorizontalPadding;this._$tieHorizontalPadding=t,e!==t&&this._propertyChanged("tieHorizontalPadding",e,t)}},{key:"tieHorizontalPaddingDotted",get:function(){return this._$tieHorizontalPaddingDotted},set:function(t){var e=this._$tieHorizontalPaddingDotted;this._$tieHorizontalPaddingDotted=t,e!==t&&this._propertyChanged("tieHorizontalPaddingDotted",e,t)}},{key:"slideHorizontalPadding",get:function(){return this._$slideHorizontalPadding},set:function(t){var e=this._$slideHorizontalPadding;this._$slideHorizontalPadding=t,e!==t&&this._propertyChanged("slideHorizontalPadding",e,t)}},{key:"tieVerticalPaddingOnLine",get:function(){return this._$tieVerticalPaddingOnLine},set:function(t){var e=this._$tieVerticalPaddingOnLine;this._$tieVerticalPaddingOnLine=t,e!==t&&this._propertyChanged("tieVerticalPaddingOnLine",e,t)}},{key:"tieHalfMaxHeightWidth",get:function(){return this._$tieHalfMaxHeightWidth},set:function(t){var e=this._$tieHalfMaxHeightWidth;this._$tieHalfMaxHeightWidth=t,e!==t&&this._propertyChanged("tieHalfMaxHeightWidth",e,t)}},{key:"tieHalfMaxShoulderWidth",get:function(){return this._$tieHalfMaxShoulderWidth},set:function(t){var e=this._$tieHalfMaxShoulderWidth;this._$tieHalfMaxShoulderWidth=t,e!==t&&this._propertyChanged("tieHalfMaxShoulderWidth",e,t)}},{key:"tieMaxShoulder",get:function(){return this._$tieMaxShoulder},set:function(t){var e=this._$tieMaxShoulder;this._$tieMaxShoulder=t,e!==t&&this._propertyChanged("tieMaxShoulder",e,t)}},{key:"tieMaxStroke",get:function(){return this._$tieMaxStroke},set:function(t){var e=this._$tieMaxStroke;this._$tieMaxStroke=t,e!==t&&this._propertyChanged("tieMaxStroke",e,t)}},{key:"slideStrokeBias",get:function(){return this._$slideStrokeBias},set:function(t){var e=this._$slideStrokeBias;this._$slideStrokeBias=t,e!==t&&this._propertyChanged("slideStrokeBias",e,t)}},{key:"slideThickness",get:function(){return this._$slideThickness},set:function(t){var e=this._$slideThickness;this._$slideThickness=t,e!==t&&this._propertyChanged("slideThickness",e,t)}},{key:"bendArrowHeight",get:function(){return this._$bendArrowHeight},set:function(t){var e=this._$bendArrowHeight;this._$bendArrowHeight=t,e!==t&&this._propertyChanged("bendArrowHeight",e,t)}},{key:"bendArrowWidth",get:function(){return this._$bendArrowWidth},set:function(t){var e=this._$bendArrowWidth;this._$bendArrowWidth=t,e!==t&&this._propertyChanged("bendArrowWidth",e,t)}},{key:"tieSingleNoteEnabled",get:function(){return this._$tieSingleNoteEnabled},set:function(t){var e=this._$tieSingleNoteEnabled;this._$tieSingleNoteEnabled=t,e!==t&&this._propertyChanged("tieSingleNoteEnabled",e,t)}},{key:"tieSingleNoteBelowSpacing",get:function(){return this._$tieSingleNoteBelowSpacing},set:function(t){var e=this._$tieSingleNoteBelowSpacing;this._$tieSingleNoteBelowSpacing=t,e!==t&&this._propertyChanged("tieSingleNoteBelowSpacing",e,t)}},{key:"tieSingleNoteCenterPadding",get:function(){return this._$tieSingleNoteCenterPadding},set:function(t){var e=this._$tieSingleNoteCenterPadding;this._$tieSingleNoteCenterPadding=t,e!==t&&this._propertyChanged("tieSingleNoteCenterPadding",e,t)}},{key:"tieStaffLineDither",get:function(){return this._$tieStaffLineDither},set:function(t){var e=this._$tieStaffLineDither;this._$tieStaffLineDither=t,e!==t&&this._propertyChanged("tieStaffLineDither",e,t)}},{key:"tieMinimumVerticalSpacing",get:function(){return this._$tieMinimumVerticalSpacing},set:function(t){var e=this._$tieMinimumVerticalSpacing;this._$tieMinimumVerticalSpacing=t,e!==t&&this._propertyChanged("tieMinimumVerticalSpacing",e,t)}},{key:"tieHeight",get:function(){return this._$tieHeight},set:function(t){var e=this._$tieHeight;this._$tieHeight=t,e!==t&&this._propertyChanged("tieHeight",e,t)}},{key:"slurHalfMaxHeightWidth",get:function(){return this._$slurHalfMaxHeightWidth},set:function(t){var e=this._$slurHalfMaxHeightWidth;this._$slurHalfMaxHeightWidth=t,e!==t&&this._propertyChanged("slurHalfMaxHeightWidth",e,t)}},{key:"slurHeight",get:function(){return this._$slurHeight},set:function(t){var e=this._$slurHeight;this._$slurHeight=t,e!==t&&this._propertyChanged("slurHeight",e,t)}},{key:"slurTolerance",get:function(){return this._$slurTolerance},set:function(t){var e=this._$slurTolerance;this._$slurTolerance=t,e!==t&&this._propertyChanged("slurTolerance",e,t)}},{key:"slurArticulationPadding",get:function(){return this._$slurArticulationPadding},set:function(t){var e=this._$slurArticulationPadding;this._$slurArticulationPadding=t,e!==t&&this._propertyChanged("slurArticulationPadding",e,t)}},{key:"slurPadding",get:function(){return this._$slurPadding},set:function(t){var e=this._$slurPadding;this._$slurPadding=t,e!==t&&this._propertyChanged("slurPadding",e,t)}},{key:"slurMinNormalizedHeight",get:function(){return this._$slurMinNormalizedHeight},set:function(t){var e=this._$slurMinNormalizedHeight;this._$slurMinNormalizedHeight=t,e!==t&&this._propertyChanged("slurMinNormalizedHeight",e,t)}},{key:"hairpinThickness",get:function(){return this._$hairpinThickness},set:function(t){var e=this._$hairpinThickness;this._$hairpinThickness=t,e!==t&&this._propertyChanged("hairpinThickness",e,t)}},{key:"hairpinLongThreshold",get:function(){return this._$hairpinLongThreshold},set:function(t){var e=this._$hairpinLongThreshold;this._$hairpinLongThreshold=t,e!==t&&this._propertyChanged("hairpinLongThreshold",e,t)}},{key:"hairpinShortEndGap",get:function(){return this._$hairpinShortEndGap},set:function(t){var e=this._$hairpinShortEndGap;this._$hairpinShortEndGap=t,e!==t&&this._propertyChanged("hairpinShortEndGap",e,t)}},{key:"hairpinLongEndGap",get:function(){return this._$hairpinLongEndGap},set:function(t){var e=this._$hairpinLongEndGap;this._$hairpinLongEndGap=t,e!==t&&this._propertyChanged("hairpinLongEndGap",e,t)}},{key:"hairpinBreakGap",get:function(){return this._$hairpinBreakGap},set:function(t){var e=this._$hairpinBreakGap;this._$hairpinBreakGap=t,e!==t&&this._propertyChanged("hairpinBreakGap",e,t)}},{key:"hairpinPadding",get:function(){return this._$hairpinPadding},set:function(t){var e=this._$hairpinPadding;this._$hairpinPadding=t,e!==t&&this._propertyChanged("hairpinPadding",e,t)}},{key:"hairpinEndExpressionPadding",get:function(){return this._$hairpinEndExpressionPadding},set:function(t){var e=this._$hairpinEndExpressionPadding;this._$hairpinEndExpressionPadding=t,e!==t&&this._propertyChanged("hairpinEndExpressionPadding",e,t)}},{key:"hairpinStartExpressionPadding",get:function(){return this._$hairpinStartExpressionPadding},set:function(t){var e=this._$hairpinStartExpressionPadding;this._$hairpinStartExpressionPadding=t,e!==t&&this._propertyChanged("hairpinStartExpressionPadding",e,t)}},{key:"hairpinExpressionPaddingTop",get:function(){return this._$hairpinExpressionPaddingTop},set:function(t){var e=this._$hairpinExpressionPaddingTop;this._$hairpinExpressionPaddingTop=t,e!==t&&this._propertyChanged("hairpinExpressionPaddingTop",e,t)}},{key:"hairpinMinimumWidth",get:function(){return this._$hairpinMinimumWidth},set:function(t){var e=this._$hairpinMinimumWidth;this._$hairpinMinimumWidth=t,e!==t&&this._propertyChanged("hairpinMinimumWidth",e,t)}},{key:"trillAccidentalScale",get:function(){return this._$trillAccidentalScale},set:function(t){var e=this._$trillAccidentalScale;this._$trillAccidentalScale=t,e!==t&&this._propertyChanged("trillAccidentalScale",e,t)}},{key:"trillAccidentalYSpacing",get:function(){return this._$trillAccidentalYSpacing},set:function(t){var e=this._$trillAccidentalYSpacing;this._$trillAccidentalYSpacing=t,e!==t&&this._propertyChanged("trillAccidentalYSpacing",e,t)}},{key:"trillAccidentalXSpacing",get:function(){return this._$trillAccidentalXSpacing},set:function(t){var e=this._$trillAccidentalXSpacing;this._$trillAccidentalXSpacing=t,e!==t&&this._propertyChanged("trillAccidentalXSpacing",e,t)}},{key:"beamThickness",get:function(){return this._$beamThickness},set:function(t){var e=this._$beamThickness;this._$beamThickness=t,e!==t&&this._propertyChanged("beamThickness",e,t)}},{key:"beamSpacing",get:function(){return this._$beamSpacing},set:function(t){var e=this._$beamSpacing;this._$beamSpacing=t,e!==t&&this._propertyChanged("beamSpacing",e,t)}},{key:"nearCrossoverOffset",get:function(){return this._$nearCrossoverOffset},set:function(t){var e=this._$nearCrossoverOffset;this._$nearCrossoverOffset=t,e!==t&&this._propertyChanged("nearCrossoverOffset",e,t)}},{key:"crossoverOffset",get:function(){return this._$crossoverOffset},set:function(t){var e=this._$crossoverOffset;this._$crossoverOffset=t,e!==t&&this._propertyChanged("crossoverOffset",e,t)}},{key:"wholeCrossoverOffset",get:function(){return this._$wholeCrossoverOffset},set:function(t){var e=this._$wholeCrossoverOffset;this._$wholeCrossoverOffset=t,e!==t&&this._propertyChanged("wholeCrossoverOffset",e,t)}},{key:"articulationPadding",get:function(){return this._$articulationPadding},set:function(t){var e=this._$articulationPadding;this._$articulationPadding=t,e!==t&&this._propertyChanged("articulationPadding",e,t)}},{key:"articulationSpacing",get:function(){return this._$articulationSpacing},set:function(t){var e=this._$articulationSpacing;this._$articulationSpacing=t,e!==t&&this._propertyChanged("articulationSpacing",e,t)}},{key:"rightArticulationPadding",get:function(){return this._$rightArticulationPadding},set:function(t){var e=this._$rightArticulationPadding;this._$rightArticulationPadding=t,e!==t&&this._propertyChanged("rightArticulationPadding",e,t)}},{key:"annotationIconHeight",get:function(){return this._$annotationIconHeight},set:function(t){var e=this._$annotationIconHeight;this._$annotationIconHeight=t,e!==t&&this._propertyChanged("annotationIconHeight",e,t)}},{key:"tupletBracketHeight",get:function(){return this._$tupletBracketHeight},set:function(t){var e=this._$tupletBracketHeight;this._$tupletBracketHeight=t,e!==t&&this._propertyChanged("tupletBracketHeight",e,t)}},{key:"tupletHeight",get:function(){return this._$tupletHeight},set:function(t){var e=this._$tupletHeight;this._$tupletHeight=t,e!==t&&this._propertyChanged("tupletHeight",e,t)}},{key:"tupletNumberPadding",get:function(){return this._$tupletNumberPadding},set:function(t){var e=this._$tupletNumberPadding;this._$tupletNumberPadding=t,e!==t&&this._propertyChanged("tupletNumberPadding",e,t)}},{key:"fractionalBeamLength",get:function(){return this._$fractionalBeamLength},set:function(t){var e=this._$fractionalBeamLength;this._$fractionalBeamLength=t,e!==t&&this._propertyChanged("fractionalBeamLength",e,t)}},{key:"tremoloInsetLength",get:function(){return this._$tremoloInsetLength},set:function(t){var e=this._$tremoloInsetLength;this._$tremoloInsetLength=t,e!==t&&this._propertyChanged("tremoloInsetLength",e,t)}},{key:"splitCodaByDefault",get:function(){return this._$splitCodaByDefault},set:function(t){var e=this._$splitCodaByDefault;this._$splitCodaByDefault=t,e!==t&&this._propertyChanged("splitCodaByDefault",e,t)}},{key:"splitSystemGap",get:function(){return this._$splitSystemGap},set:function(t){var e=this._$splitSystemGap;this._$splitSystemGap=t,e!==t&&this._propertyChanged("splitSystemGap",e,t)}},{key:"titleY",get:function(){return this._$titleY},set:function(t){var e=this._$titleY;this._$titleY=t,e!==t&&this._propertyChanged("titleY",e,t)}},{key:"titleSize",get:function(){return this._$titleSize},set:function(t){var e=this._$titleSize;this._$titleSize=t,e!==t&&this._propertyChanged("titleSize",e,t)}},{key:"titleBold",get:function(){return this._$titleBold},set:function(t){var e=this._$titleBold;this._$titleBold=t,e!==t&&this._propertyChanged("titleBold",e,t)}},{key:"subtitleSize",get:function(){return this._$subtitleSize},set:function(t){var e=this._$subtitleSize;this._$subtitleSize=t,e!==t&&this._propertyChanged("subtitleSize",e,t)}},{key:"supertitleSize",get:function(){return this._$supertitleSize},set:function(t){var e=this._$supertitleSize;this._$supertitleSize=t,e!==t&&this._propertyChanged("supertitleSize",e,t)}},{key:"subtitleBold",get:function(){return this._$subtitleBold},set:function(t){var e=this._$subtitleBold;this._$subtitleBold=t,e!==t&&this._propertyChanged("subtitleBold",e,t)}},{key:"supertitleBold",get:function(){return this._$supertitleBold},set:function(t){var e=this._$supertitleBold;this._$supertitleBold=t,e!==t&&this._propertyChanged("supertitleBold",e,t)}},{key:"composerBold",get:function(){return this._$composerBold},set:function(t){var e=this._$composerBold;this._$composerBold=t,e!==t&&this._propertyChanged("composerBold",e,t)}},{key:"lyricistBold",get:function(){return this._$lyricistBold},set:function(t){var e=this._$lyricistBold;this._$lyricistBold=t,e!==t&&this._propertyChanged("lyricistBold",e,t)}},{key:"copyrightBold",get:function(){return this._$copyrightBold},set:function(t){var e=this._$copyrightBold;this._$copyrightBold=t,e!==t&&this._propertyChanged("copyrightBold",e,t)}},{key:"footerBold",get:function(){return this._$footerBold},set:function(t){var e=this._$footerBold;this._$footerBold=t,e!==t&&this._propertyChanged("footerBold",e,t)}},{key:"composerY",get:function(){return this._$composerY},set:function(t){var e=this._$composerY;this._$composerY=t,e!==t&&this._propertyChanged("composerY",e,t)}},{key:"composerSize",get:function(){return this._$composerSize},set:function(t){var e=this._$composerSize;this._$composerSize=t,e!==t&&this._propertyChanged("composerSize",e,t)}},{key:"composerBottomPadding",get:function(){return this._$composerBottomPadding},set:function(t){var e=this._$composerBottomPadding;this._$composerBottomPadding=t,e!==t&&this._propertyChanged("composerBottomPadding",e,t)}},{key:"arrangerBottomPadding",get:function(){return this._$arrangerBottomPadding},set:function(t){var e=this._$arrangerBottomPadding;this._$arrangerBottomPadding=t,e!==t&&this._propertyChanged("arrangerBottomPadding",e,t)}},{key:"arrangerPlaceholderBottomPadding",get:function(){return this._$arrangerPlaceholderBottomPadding},set:function(t){var e=this._$arrangerPlaceholderBottomPadding;this._$arrangerPlaceholderBottomPadding=t,e!==t&&this._propertyChanged("arrangerPlaceholderBottomPadding",e,t)}},{key:"pageNumberY",get:function(){return this._$pageNumberY},set:function(t){var e=this._$pageNumberY;this._$pageNumberY=t,e!==t&&this._propertyChanged("pageNumberY",e,t)}},{key:"pageNumberSize",get:function(){return this._$pageNumberSize},set:function(t){var e=this._$pageNumberSize;this._$pageNumberSize=t,e!==t&&this._propertyChanged("pageNumberSize",e,t)}},{key:"pageNumberIncludesTitle",get:function(){return this._$pageNumberIncludesTitle},set:function(t){var e=this._$pageNumberIncludesTitle;this._$pageNumberIncludesTitle=t,e!==t&&this._propertyChanged("pageNumberIncludesTitle",e,t)}},{key:"copyrightSize",get:function(){return this._$copyrightSize},set:function(t){var e=this._$copyrightSize;this._$copyrightSize=t,e!==t&&this._propertyChanged("copyrightSize",e,t)}},{key:"showCopyrightOnAllPages",get:function(){return this._$showCopyrightOnAllPages},set:function(t){var e=this._$showCopyrightOnAllPages;this._$showCopyrightOnAllPages=t,e!==t&&this._propertyChanged("showCopyrightOnAllPages",e,t)}},{key:"textProportional",get:function(){return this._$textProportional},set:function(t){var e=this._$textProportional;this._$textProportional=t,e!==t&&this._propertyChanged("textProportional",e,t)}},{key:"footerSize",get:function(){return this._$footerSize},set:function(t){var e=this._$footerSize;this._$footerSize=t,e!==t&&this._propertyChanged("footerSize",e,t)}},{key:"footerColor",get:function(){return this._$footerColor},set:function(t){var e=this._$footerColor;this._$footerColor=t,e!==t&&this._propertyChanged("footerColor",e,t)}},{key:"titlePageTopPadding",get:function(){return this._$titlePageTopPadding},set:function(t){var e=this._$titlePageTopPadding;this._$titlePageTopPadding=t,e!==t&&this._propertyChanged("titlePageTopPadding",e,t)}},{key:"titlePageSubtitlePadding",get:function(){return this._$titlePageSubtitlePadding},set:function(t){var e=this._$titlePageSubtitlePadding;this._$titlePageSubtitlePadding=t,e!==t&&this._propertyChanged("titlePageSubtitlePadding",e,t)}},{key:"titlePageSupertitlePadding",get:function(){return this._$titlePageSupertitlePadding},set:function(t){var e=this._$titlePageSupertitlePadding;this._$titlePageSupertitlePadding=t,e!==t&&this._propertyChanged("titlePageSupertitlePadding",e,t)}},{key:"pageTopPadding",get:function(){return this._$pageTopPadding},set:function(t){var e=this._$pageTopPadding;this._$pageTopPadding=t,e!==t&&this._propertyChanged("pageTopPadding",e,t)}},{key:"titlePageFirstStaffPadding",get:function(){return this._$titlePageFirstStaffPadding},set:function(t){var e=this._$titlePageFirstStaffPadding;this._$titlePageFirstStaffPadding=t,e!==t&&this._propertyChanged("titlePageFirstStaffPadding",e,t)}},{key:"titlePagePromptSize",get:function(){return this._$titlePagePromptSize},set:function(t){var e=this._$titlePagePromptSize;this._$titlePagePromptSize=t,e!==t&&this._propertyChanged("titlePagePromptSize",e,t)}},{key:"titlePagePromptPadding",get:function(){return this._$titlePagePromptPadding},set:function(t){var e=this._$titlePagePromptPadding;this._$titlePagePromptPadding=t,e!==t&&this._propertyChanged("titlePagePromptPadding",e,t)}},{key:"staffLabelPadding",get:function(){return this._$staffLabelPadding},set:function(t){var e=this._$staffLabelPadding;this._$staffLabelPadding=t,e!==t&&this._propertyChanged("staffLabelPadding",e,t)}},{key:"grandStaffPadding",get:function(){return this._$grandStaffPadding},set:function(t){var e=this._$grandStaffPadding;this._$grandStaffPadding=t,e!==t&&this._propertyChanged("grandStaffPadding",e,t)}},{key:"partNameSize",get:function(){return this._$partNameSize},set:function(t){var e=this._$partNameSize;this._$partNameSize=t,e!==t&&this._propertyChanged("partNameSize",e,t)}},{key:"tempoSymbolSize",get:function(){return this._$tempoSymbolSize},set:function(t){var e=this._$tempoSymbolSize;this._$tempoSymbolSize=t,e!==t&&this._propertyChanged("tempoSymbolSize",e,t)}},{key:"tempoSymbolScale",get:function(){return this._$tempoSymbolScale},set:function(t){var e=this._$tempoSymbolScale;this._$tempoSymbolScale=t,e!==t&&this._propertyChanged("tempoSymbolScale",e,t)}},{key:"tempoFirstMeasureXOffset",get:function(){return this._$tempoFirstMeasureXOffset},set:function(t){var e=this._$tempoFirstMeasureXOffset;this._$tempoFirstMeasureXOffset=t,e!==t&&this._propertyChanged("tempoFirstMeasureXOffset",e,t)}},{key:"tempoTimeSignatureXOffset",get:function(){return this._$tempoTimeSignatureXOffset},set:function(t){var e=this._$tempoTimeSignatureXOffset;this._$tempoTimeSignatureXOffset=t,e!==t&&this._propertyChanged("tempoTimeSignatureXOffset",e,t)}},{key:"tempoTimeSignatureXOffsetFirstMeasure",get:function(){return this._$tempoTimeSignatureXOffsetFirstMeasure},set:function(t){var e=this._$tempoTimeSignatureXOffsetFirstMeasure;this._$tempoTimeSignatureXOffsetFirstMeasure=t,e!==t&&this._propertyChanged("tempoTimeSignatureXOffsetFirstMeasure",e,t)}},{key:"tempoXOffset",get:function(){return this._$tempoXOffset},set:function(t){var e=this._$tempoXOffset;this._$tempoXOffset=t,e!==t&&this._propertyChanged("tempoXOffset",e,t)}},{key:"tempoXOffsetFirstMeasure",get:function(){return this._$tempoXOffsetFirstMeasure},set:function(t){var e=this._$tempoXOffsetFirstMeasure;this._$tempoXOffsetFirstMeasure=t,e!==t&&this._propertyChanged("tempoXOffsetFirstMeasure",e,t)}},{key:"tempoUnitOffset",get:function(){return this._$tempoUnitOffset},set:function(t){var e=this._$tempoUnitOffset;this._$tempoUnitOffset=t,e!==t&&this._propertyChanged("tempoUnitOffset",e,t)}},{key:"tempoTextOffset",get:function(){return this._$tempoTextOffset},set:function(t){var e=this._$tempoTextOffset;this._$tempoTextOffset=t,e!==t&&this._propertyChanged("tempoTextOffset",e,t)}},{key:"chordSymbolSize",get:function(){return this._$chordSymbolSize},set:function(t){var e=this._$chordSymbolSize;this._$chordSymbolSize=t,e!==t&&this._propertyChanged("chordSymbolSize",e,t)}},{key:"repeatEndingFontSize",get:function(){return this._$repeatEndingFontSize},set:function(t){var e=this._$repeatEndingFontSize;this._$repeatEndingFontSize=t,e!==t&&this._propertyChanged("repeatEndingFontSize",e,t)}},{key:"keepChordSymbolsApart",get:function(){return this._$keepChordSymbolsApart},set:function(t){var e=this._$keepChordSymbolsApart;this._$keepChordSymbolsApart=t,e!==t&&this._propertyChanged("keepChordSymbolsApart",e,t)}},{key:"centerChordSymbols",get:function(){return this._$centerChordSymbols},set:function(t){var e=this._$centerChordSymbols;this._$centerChordSymbols=t,e!==t&&this._propertyChanged("centerChordSymbols",e,t)}},{key:"chordBelowStaffOffset",get:function(){return this._$chordBelowStaffOffset},set:function(t){var e=this._$chordBelowStaffOffset;this._$chordBelowStaffOffset=t,e!==t&&this._propertyChanged("chordBelowStaffOffset",e,t)}},{key:"chordBelowStaffOffsetTab",get:function(){return this._$chordBelowStaffOffsetTab},set:function(t){var e=this._$chordBelowStaffOffsetTab;this._$chordBelowStaffOffsetTab=t,e!==t&&this._propertyChanged("chordBelowStaffOffsetTab",e,t)}},{key:"expressionTextSize",get:function(){return this._$expressionTextSize},set:function(t){var e=this._$expressionTextSize;this._$expressionTextSize=t,e!==t&&this._propertyChanged("expressionTextSize",e,t)}},{key:"expressionTextSpacing",get:function(){return this._$expressionTextSpacing},set:function(t){var e=this._$expressionTextSpacing;this._$expressionTextSpacing=t,e!==t&&this._propertyChanged("expressionTextSpacing",e,t)}},{key:"performanceTextSize",get:function(){return this._$performanceTextSize},set:function(t){var e=this._$performanceTextSize;this._$performanceTextSize=t,e!==t&&this._propertyChanged("performanceTextSize",e,t)}},{key:"labelTextSize",get:function(){return this._$labelTextSize},set:function(t){var e=this._$labelTextSize;this._$labelTextSize=t,e!==t&&this._propertyChanged("labelTextSize",e,t)}},{key:"performanceTextSpacing",get:function(){return this._$performanceTextSpacing},set:function(t){var e=this._$performanceTextSpacing;this._$performanceTextSpacing=t,e!==t&&this._propertyChanged("performanceTextSpacing",e,t)}},{key:"lyricsSize",get:function(){return this._$lyricsSize},set:function(t){var e=this._$lyricsSize;this._$lyricsSize=t,e!==t&&this._propertyChanged("lyricsSize",e,t)}},{key:"lyricsDescent",get:function(){return this._$lyricsDescent},set:function(t){var e=this._$lyricsDescent;this._$lyricsDescent=t,e!==t&&this._propertyChanged("lyricsDescent",e,t)}},{key:"lyricsAscent",get:function(){return this._$lyricsAscent},set:function(t){var e=this._$lyricsAscent;this._$lyricsAscent=t,e!==t&&this._propertyChanged("lyricsAscent",e,t)}},{key:"blockSize",get:function(){return this._$blockSize},set:function(t){var e=this._$blockSize;this._$blockSize=t,e!==t&&this._propertyChanged("blockSize",e,t)}},{key:"blockHeaderWeight",get:function(){return this._$blockHeaderWeight},set:function(t){var e=this._$blockHeaderWeight;this._$blockHeaderWeight=t,e!==t&&this._propertyChanged("blockHeaderWeight",e,t)}},{key:"blockColumnWeight",get:function(){return this._$blockColumnWeight},set:function(t){var e=this._$blockColumnWeight;this._$blockColumnWeight=t,e!==t&&this._propertyChanged("blockColumnWeight",e,t)}},{key:"mouseNotationPadding",get:function(){return this._$mouseNotationPadding},set:function(t){var e=this._$mouseNotationPadding;this._$mouseNotationPadding=t,e!==t&&this._propertyChanged("mouseNotationPadding",e,t)}},{key:"mouseNoteEntryStemMargin",get:function(){return this._$mouseNoteEntryStemMargin},set:function(t){var e=this._$mouseNoteEntryStemMargin;this._$mouseNoteEntryStemMargin=t,e!==t&&this._propertyChanged("mouseNoteEntryStemMargin",e,t)}},{key:"mouseNoteEntrySlopWidth",get:function(){return this._$mouseNoteEntrySlopWidth},set:function(t){var e=this._$mouseNoteEntrySlopWidth;this._$mouseNoteEntrySlopWidth=t,e!==t&&this._propertyChanged("mouseNoteEntrySlopWidth",e,t)}},{key:"mouseNoteEntrySlopHeight",get:function(){return this._$mouseNoteEntrySlopHeight},set:function(t){var e=this._$mouseNoteEntrySlopHeight;this._$mouseNoteEntrySlopHeight=t,e!==t&&this._propertyChanged("mouseNoteEntrySlopHeight",e,t)}},{key:"textFont",get:function(){return this._$textFont},set:function(t){var e=this._$textFont;this._$textFont=t,e!==t&&this._propertyChanged("textFont",e,t)}},{key:"titleFont",get:function(){return this._$titleFont},set:function(t){var e=this._$titleFont;this._$titleFont=t,e!==t&&this._propertyChanged("titleFont",e,t)}},{key:"subtitleFont",get:function(){return this._$subtitleFont},set:function(t){var e=this._$subtitleFont;this._$subtitleFont=t,e!==t&&this._propertyChanged("subtitleFont",e,t)}},{key:"supertitleFont",get:function(){return this._$supertitleFont},set:function(t){var e=this._$supertitleFont;this._$supertitleFont=t,e!==t&&this._propertyChanged("supertitleFont",e,t)}},{key:"composerFont",get:function(){return this._$composerFont},set:function(t){var e=this._$composerFont;this._$composerFont=t,e!==t&&this._propertyChanged("composerFont",e,t)}},{key:"arrangerFont",get:function(){return this._$arrangerFont},set:function(t){var e=this._$arrangerFont;this._$arrangerFont=t,e!==t&&this._propertyChanged("arrangerFont",e,t)}},{key:"lyricistFont",get:function(){return this._$lyricistFont},set:function(t){var e=this._$lyricistFont;this._$lyricistFont=t,e!==t&&this._propertyChanged("lyricistFont",e,t)}},{key:"copyrightFont",get:function(){return this._$copyrightFont},set:function(t){var e=this._$copyrightFont;this._$copyrightFont=t,e!==t&&this._propertyChanged("copyrightFont",e,t)}},{key:"footerFont",get:function(){return this._$footerFont},set:function(t){var e=this._$footerFont;this._$footerFont=t,e!==t&&this._propertyChanged("footerFont",e,t)}},{key:"staffTextFont",get:function(){return this._$staffTextFont},set:function(t){var e=this._$staffTextFont;this._$staffTextFont=t,e!==t&&this._propertyChanged("staffTextFont",e,t)}},{key:"lyricsFont",get:function(){return this._$lyricsFont},set:function(t){var e=this._$lyricsFont;this._$lyricsFont=t,e!==t&&this._propertyChanged("lyricsFont",e,t)}},{key:"blockFont",get:function(){return this._$blockFont},set:function(t){var e=this._$blockFont;this._$blockFont=t,e!==t&&this._propertyChanged("blockFont",e,t)}},{key:"lyricsBold",get:function(){return this._$lyricsBold},set:function(t){var e=this._$lyricsBold;this._$lyricsBold=t,e!==t&&this._propertyChanged("lyricsBold",e,t)}},{key:"lyricsItalic",get:function(){return this._$lyricsItalic},set:function(t){var e=this._$lyricsItalic;this._$lyricsItalic=t,e!==t&&this._propertyChanged("lyricsItalic",e,t)}},{key:"showMultipleHyphens",get:function(){return this._$showMultipleHyphens},set:function(t){var e=this._$showMultipleHyphens;this._$showMultipleHyphens=t,e!==t&&this._propertyChanged("showMultipleHyphens",e,t)}},{key:"hyphensMinPadding",get:function(){return this._$hyphensMinPadding},set:function(t){var e=this._$hyphensMinPadding;this._$hyphensMinPadding=t,e!==t&&this._propertyChanged("hyphensMinPadding",e,t)}},{key:"chordSymbolFont",get:function(){return this._$chordSymbolFont},set:function(t){var e=this._$chordSymbolFont;this._$chordSymbolFont=t,e!==t&&this._propertyChanged("chordSymbolFont",e,t)}},{key:"tempoFont",get:function(){return this._$tempoFont},set:function(t){var e=this._$tempoFont;this._$tempoFont=t,e!==t&&this._propertyChanged("tempoFont",e,t)}},{key:"tempoBold",get:function(){return this._$tempoBold},set:function(t){var e=this._$tempoBold;this._$tempoBold=t,e!==t&&this._propertyChanged("tempoBold",e,t)}},{key:"cueScale",get:function(){return this._$cueScale},set:function(t){var e=this._$cueScale;this._$cueScale=t,e!==t&&this._propertyChanged("cueScale",e,t)}},{key:"graceScale",get:function(){return this._$graceScale},set:function(t){var e=this._$graceScale;this._$graceScale=t,e!==t&&this._propertyChanged("graceScale",e,t)}},{key:"tabGraceScale",get:function(){return this._$tabGraceScale},set:function(t){var e=this._$tabGraceScale;this._$tabGraceScale=t,e!==t&&this._propertyChanged("tabGraceScale",e,t)}},{key:"tabFretBackgroundPadding",get:function(){return this._$tabFretBackgroundPadding},set:function(t){var e=this._$tabFretBackgroundPadding;this._$tabFretBackgroundPadding=t,e!==t&&this._propertyChanged("tabFretBackgroundPadding",e,t)}},{key:"tabFretWidth",get:function(){return this._$tabFretWidth},set:function(t){var e=this._$tabFretWidth;this._$tabFretWidth=t,e!==t&&this._propertyChanged("tabFretWidth",e,t)}},{key:"tabStemOffset",get:function(){return this._$tabStemOffset},set:function(t){var e=this._$tabStemOffset;this._$tabStemOffset=t,e!==t&&this._propertyChanged("tabStemOffset",e,t)}},{key:"lineNotationPadding",get:function(){return this._$lineNotationPadding},set:function(t){var e=this._$lineNotationPadding;this._$lineNotationPadding=t,e!==t&&this._propertyChanged("lineNotationPadding",e,t)}},{key:"lineNotationThickness",get:function(){return this._$lineNotationThickness},set:function(t){var e=this._$lineNotationThickness;this._$lineNotationThickness=t,e!==t&&this._propertyChanged("lineNotationThickness",e,t)}},{key:"lineNotationLongThreshold",get:function(){return this._$lineNotationLongThreshold},set:function(t){var e=this._$lineNotationLongThreshold;this._$lineNotationLongThreshold=t,e!==t&&this._propertyChanged("lineNotationLongThreshold",e,t)}},{key:"lineNotationBreakGap",get:function(){return this._$lineNotationBreakGap},set:function(t){var e=this._$lineNotationBreakGap;this._$lineNotationBreakGap=t,e!==t&&this._propertyChanged("lineNotationBreakGap",e,t)}},{key:"lineNotationFontSize",get:function(){return this._$lineNotationFontSize},set:function(t){var e=this._$lineNotationFontSize;this._$lineNotationFontSize=t,e!==t&&this._propertyChanged("lineNotationFontSize",e,t)}},{key:"lineNotationBracketHeight",get:function(){return this._$lineNotationBracketHeight},set:function(t){var e=this._$lineNotationBracketHeight;this._$lineNotationBracketHeight=t,e!==t&&this._propertyChanged("lineNotationBracketHeight",e,t)}},{key:"lineNotationYPosition",get:function(){return this._$lineNotationYPosition},set:function(t){var e=this._$lineNotationYPosition;this._$lineNotationYPosition=t,e!==t&&this._propertyChanged("lineNotationYPosition",e,t)}},{key:"lineNotationDistanceAboveStaff",get:function(){return this._$lineNotationDistanceAboveStaff},set:function(t){var e=this._$lineNotationDistanceAboveStaff;this._$lineNotationDistanceAboveStaff=t,e!==t&&this._propertyChanged("lineNotationDistanceAboveStaff",e,t)}},{key:"lineNotationDistanceBelowStaff",get:function(){return this._$lineNotationDistanceBelowStaff},set:function(t){var e=this._$lineNotationDistanceBelowStaff;this._$lineNotationDistanceBelowStaff=t,e!==t&&this._propertyChanged("lineNotationDistanceBelowStaff",e,t)}},{key:"repeatEndingDistanceAboveStaff",get:function(){return this._$repeatEndingDistanceAboveStaff},set:function(t){var e=this._$repeatEndingDistanceAboveStaff;this._$repeatEndingDistanceAboveStaff=t,e!==t&&this._propertyChanged("repeatEndingDistanceAboveStaff",e,t)}},{key:"tremoloVerticalStemOffset",get:function(){return this._$tremoloVerticalStemOffset},set:function(t){var e=this._$tremoloVerticalStemOffset;this._$tremoloVerticalStemOffset=t,e!==t&&this._propertyChanged("tremoloVerticalStemOffset",e,t)}},{key:"tremoloVerticalNoteOffset",get:function(){return this._$tremoloVerticalNoteOffset},set:function(t){var e=this._$tremoloVerticalNoteOffset;this._$tremoloVerticalNoteOffset=t,e!==t&&this._propertyChanged("tremoloVerticalNoteOffset",e,t)}},{key:"stemDecorationVerticalStemOffset",get:function(){return this._$stemDecorationVerticalStemOffset},set:function(t){var e=this._$stemDecorationVerticalStemOffset;this._$stemDecorationVerticalStemOffset=t,e!==t&&this._propertyChanged("stemDecorationVerticalStemOffset",e,t)}},{key:"stemDecorationVerticalNoteOffset",get:function(){return this._$stemDecorationVerticalNoteOffset},set:function(t){var e=this._$stemDecorationVerticalNoteOffset;this._$stemDecorationVerticalNoteOffset=t,e!==t&&this._propertyChanged("stemDecorationVerticalNoteOffset",e,t)}},{key:"chordFrameFretSpacing",get:function(){return this._$chordFrameFretSpacing},set:function(t){var e=this._$chordFrameFretSpacing;this._$chordFrameFretSpacing=t,e!==t&&this._propertyChanged("chordFrameFretSpacing",e,t)}},{key:"chordFrameStringSpacing",get:function(){return this._$chordFrameStringSpacing},set:function(t){var e=this._$chordFrameStringSpacing;this._$chordFrameStringSpacing=t,e!==t&&this._propertyChanged("chordFrameStringSpacing",e,t)}},{key:"spaceAboveChords",get:function(){return this._$spaceAboveChords},set:function(t){var e=this._$spaceAboveChords;this._$spaceAboveChords=t,e!==t&&this._propertyChanged("spaceAboveChords",e,t)}},{key:"spaceAboveChordFrames",get:function(){return this._$spaceAboveChordFrames},set:function(t){var e=this._$spaceAboveChordFrames;this._$spaceAboveChordFrames=t,e!==t&&this._propertyChanged("spaceAboveChordFrames",e,t)}},{key:"spaceAbovePerformanceText",get:function(){return this._$spaceAbovePerformanceText},set:function(t){var e=this._$spaceAbovePerformanceText;this._$spaceAbovePerformanceText=t,e!==t&&this._propertyChanged("spaceAbovePerformanceText",e,t)}},{key:"verticalAutoSpace",get:function(){return this._$verticalAutoSpace},set:function(t){var e=this._$verticalAutoSpace;this._$verticalAutoSpace=t,e!==t&&this._propertyChanged("verticalAutoSpace",e,t)}},{key:"layoutSpacing",get:function(){return this._$layoutSpacing},set:function(t){var e=this._$layoutSpacing;this._$layoutSpacing=t,e!==t&&this._propertyChanged("layoutSpacing",e,t)}},{key:"minVerticalGap",get:function(){return this._$minVerticalGap},set:function(t){var e=this._$minVerticalGap;this._$minVerticalGap=t,e!==t&&this._propertyChanged("minVerticalGap",e,t)}},{key:"systemStretch",get:function(){return this._$systemStretch},set:function(t){var e=this._$systemStretch;this._$systemStretch=t,e!==t&&this._propertyChanged("systemStretch",e,t)}},{key:"topStaffGap",get:function(){return this._$topStaffGap},set:function(t){var e=this._$topStaffGap;this._$topStaffGap=t,e!==t&&this._propertyChanged("topStaffGap",e,t)}},{key:"ignoreStemDirection",get:function(){return this._$ignoreStemDirection},set:function(t){var e=this._$ignoreStemDirection;this._$ignoreStemDirection=t,e!==t&&this._propertyChanged("ignoreStemDirection",e,t)}},{key:"ignoreSlurDirection",get:function(){return this._$ignoreSlurDirection},set:function(t){var e=this._$ignoreSlurDirection;this._$ignoreSlurDirection=t,e!==t&&this._propertyChanged("ignoreSlurDirection",e,t)}},{key:"ignoreSystemMargins",get:function(){return this._$ignoreSystemMargins},set:function(t){var e=this._$ignoreSystemMargins;this._$ignoreSystemMargins=t,e!==t&&this._propertyChanged("ignoreSystemMargins",e,t)}},{key:"swingDelta",get:function(){return this._$swingDelta},set:function(t){var e=this._$swingDelta;this._$swingDelta=t,e!==t&&this._propertyChanged("swingDelta",e,t)}},{key:"musicFont",get:function(){return this._$musicFont},set:function(t){var e=this._$musicFont;this._$musicFont=t,e!==t&&this._propertyChanged("musicFont",e,t)}},{key:"showBarNumbers",get:function(){return this._$showBarNumbers},set:function(t){var e=this._$showBarNumbers;this._$showBarNumbers=t,e!==t&&this._propertyChanged("showBarNumbers",e,t)}},{key:"showBarNumbersOnEachMeasure",get:function(){return this._$showBarNumbersOnEachMeasure},set:function(t){var e=this._$showBarNumbersOnEachMeasure;this._$showBarNumbersOnEachMeasure=t,e!==t&&this._propertyChanged("showBarNumbersOnEachMeasure",e,t)}},{key:"showPartNames",get:function(){return this._$showPartNames},set:function(t){var e=this._$showPartNames;this._$showPartNames=t,e!==t&&this._propertyChanged("showPartNames",e,t)}},{key:"partNamePosition",get:function(){return this._$partNamePosition},set:function(t){var e=this._$partNamePosition;this._$partNamePosition=t,e!==t&&this._propertyChanged("partNamePosition",e,t)}},{key:"showPartNamesOnEveryPage",get:function(){return this._$showPartNamesOnEveryPage},set:function(t){var e=this._$showPartNamesOnEveryPage;this._$showPartNamesOnEveryPage=t,e!==t&&this._propertyChanged("showPartNamesOnEveryPage",e,t)}},{key:"partNameAtTheTopOffset",get:function(){return this._$partNameAtTheTopOffset},set:function(t){var e=this._$partNameAtTheTopOffset;this._$partNameAtTheTopOffset=t,e!==t&&this._propertyChanged("partNameAtTheTopOffset",e,t)}},{key:"showTabRhythm",get:function(){return this._$showTabRhythm},set:function(t){var e=this._$showTabRhythm;this._$showTabRhythm=t,e!==t&&this._propertyChanged("showTabRhythm",e,t)}},{key:"effectiveCreditSize",get:function(){return this.creditLineSpacing>0?this.creditLineSpacing:this.lineSpacing}},{key:"baseFontSize",get:function(){return e.DEFAULT_STAFF_HEIGHT*this.lineSpacing/e.DEFAULT_LINE_SPACING}},{key:"creditFontSize",get:function(){return this.textProportional?e.DEFAULT_STAFF_HEIGHT*this.effectiveCreditSize/e.DEFAULT_LINE_SPACING:e.DEFAULT_STAFF_HEIGHT/e.DEFAULT_LINE_SPACING}},{key:"fonts",get:function(){return[this.chordSymbolFont,this.textFont,this.tempoFont,this.staffTextFont,this.lyricsFont,this.titleFont,this.subtitleFont,this.supertitleFont,this.composerFont,this.arrangerFont,this.lyricistFont,this.copyrightFont]}},{key:"style",get:function(){return null==this._style?e.STYLE_DEFAULT:this._style},set:function(t){switch(this._style=t,t.substr(0,3),t){case e.STYLE_YCJ:this.textFont="GothicJP",this.titleFont="GothicJP",this.subtitleFont="GothicJP",this.supertitleFont="GothicJP",this.composerFont="GothicJP",this.arrangerFont="GothicJP",this.lyricistFont="GothicJP",this.copyrightFont="GothicJP",this.footerFont="GothicJP",this.staffTextFont="GothicJP",this.lyricsFont="GothicJP",this.lineSpacing=this.scoreLineSpacing=4,this.titlePageFirstStaffPadding=0,this.pageTopPadding=4,this.systemSpacing=13,this.systemStretch=5,this.staffSpacing=6.5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.lyricsSize=.3,this.lyricsLineSpacing=3,this.layoutSpacing=5,this.repeatEndingBracketBold=!1,this.repeatEndingBracketTextYOffset=0,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.copyrightSize=.25,this.composerSize=.3,this.footerSize=.3,this.slurMinNormalizedHeight=.7,this.directionsAboveStaff=!1;break;case e.STYLE_JAZZ_ASH:this.setMusicFont(e.STYLE_JAZZ_ASH),this.pageTopPadding=4,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.lyricsSize=.3,this.lyricsLineSpacing=3,this.layoutSpacing=5,this.repeatEndingBracketBold=!1,this.repeatEndingBracketTextYOffset=0,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.lineSpacing=this.scoreLineSpacing=4,this.titlePageFirstStaffPadding=0,this.systemSpacing=13,this.systemStretch=5,this.staffSpacing=6.5,this.copyrightSize=.25,this.composerSize=.3,this.footerSize=.3,this.directionsAboveStaff=!1;break;case e.STYLE_PVG:this.lineSpacing=this.scoreLineSpacing=4,this.titlePageFirstStaffPadding=0,this.pageTopPadding=4,this.systemSpacing=13,this.systemStretch=5,this.staffSpacing=6.5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.lyricsSize=.3,this.lyricsLineSpacing=3,this.layoutSpacing=5,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.copyrightSize=.25,this.composerSize=.3,this.footerSize=.3,this.tieSingleNoteEnabled=!1,this.directionsAboveStaff=!1;break;case e.STYLE_HLC_ACCORDION:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.titleBold=!0,this.titleSize=.8,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.indentationSpacing=8,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.composerSize=.28,this.composerY=12,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.28,this.lyricsLineSpacing=2.5,this.layoutSpacing=9,this.directionsAboveStaff=!1,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.copyrightSize=.2,this.footerSize=.3,this.pageTopPadding=4,this.systemSpacing=8.5,this.systemStretch=3,this.staffSpacing=6,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-5.75,this.tempoTimeSignatureXOffset=-5,this.tempoXOffsetFirstMeasure=-5.5,this.tempoXOffset=-4;break;case e.STYLE_HLC_INSTRUMENTAL_SOLO:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.titleBold=!0,this.titleSize=.8,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=8,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.composerSize=.28,this.composerY=12,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.28,this.lyricsLineSpacing=2.5,this.layoutSpacing=7,this.indentationSpacing=8,this.directionsAboveStaff=!1,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.copyrightSize=.2,this.footerSize=.3,this.pageTopPadding=4,this.systemSpacing=8.5,this.systemStretch=3,this.staffSpacing=6,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-8.45,this.tempoTimeSignatureXOffset=-4,this.tempoXOffsetFirstMeasure=-4.5,this.tempoXOffset=-2;break;case e.STYLE_HLC_BIG_NOTE:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.titleBold=!0,this.titleSize=.7,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.indentationSpacing=8,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.2,this.composerY=12,this.copyrightSize=.15,this.footerSize=.3,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=10,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.2,this.lyricsLineSpacing=1.5,this.lineSpacing=this.scoreLineSpacing=7,this.layoutSpacing=4,this.chordSymbolSize=.22,this.pageTopPadding=4,this.systemSpacing=3.75,this.systemStretch=3,this.staffSpacing=5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-7,this.tempoTimeSignatureXOffset=-4.5,this.tempoXOffsetFirstMeasure=-6,this.tempoXOffset=-5.5;break;case e.STYLE_HLC_CHORAL:this.titleBold=!0,this.titleSize=.8,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.directionsAboveStaff=!1,this.composerSize=.3,this.composerY=12,this.composerBold=!0,this.lyricistBold=!0,this.useLyricsDefaultDirection=!1,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsLineSpacing=2.5,this.lyricsBold=!0,this.layoutSpacing=2,this.indentationSpacing=8,this.copyrightSize=.25,this.footerSize=.3,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.lineSpacing=this.scoreLineSpacing=4.5,this.pageTopPadding=4,this.systemSpacing=8.5,this.systemStretch=3,this.staffSpacing=7,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-7.5,this.tempoTimeSignatureXOffset=-3.5,this.tempoXOffsetFirstMeasure=-6.5,this.tempoXOffset=-4.25;break;case e.STYLE_HLC_EASY_PIANO:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.titleBold=!0,this.titleSize=.7,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.25,this.composerY=12,this.copyrightSize=.15,this.footerSize=.3,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsLineSpacing=2,this.lyricsSize=.25,this.expressionTextSize=.25,this.layoutSpacing=5,this.indentationSpacing=8,this.pageTopPadding=4,this.systemSpacing=8.5,this.systemStretch=3,this.staffSpacing=8,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-9.75,this.tempoTimeSignatureXOffset=-4.5,this.tempoXOffsetFirstMeasure=-7,this.tempoXOffset=-4.25;break;case e.STYLE_HLC_EDUCATIONAL_PIANO:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.barNumberBoxed=!0,this.performanceTextPadding=new Qo(0,-2.6,1,0),this.titleSize=.7,this.composerSize=.25,this.composerY=12,this.copyrightSize=.15,this.footerSize=.3,this.splitCodaByDefault=!0,this.splitSystemGap=8,this.indentationSpacing=8,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.tempoFont="Georgia",this.lyricsLineSpacing=2,this.lyricsSize=.23,this.layoutSpacing=2,this.pageTopPadding=4,this.systemSpacing=5,this.systemStretch=3,this.staffSpacing=5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-8.75,this.tempoTimeSignatureXOffset=-2.75,this.tempoXOffsetFirstMeasure=-5.25,this.tempoXOffset=-1.25;break;case e.STYLE_HLC_FAKEBOOK:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.titleBold=!0,this.titleSize=.5,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=8,this.indentationSpacing=8,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.28,this.composerY=12,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.3,this.lyricsBold=!0,this.lyricsLineSpacing=2.5,this.layoutSpacing=6,this.copyrightSize=.25,this.footerSize=.3,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.lineSpacing=this.scoreLineSpacing=4,this.pageTopPadding=4,this.systemSpacing=13,this.systemStretch=3,this.staffSpacing=6.5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-8.5,this.tempoTimeSignatureXOffset=-5.5,this.tempoXOffsetFirstMeasure=-7.5,this.tempoXOffset=-5;break;case e.STYLE_HLC_GUITAR:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.titleBold=!0,this.titleSize=1,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.28,this.composerBold=!0,this.composerY=12,this.copyrightSize=.25,this.footerSize=.3,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.3,this.lyricsLineSpacing=2.5,this.layoutSpacing=9,this.indentationSpacing=8,this.showMultipleHyphens=!1,this.repeatEndingBracketHeight=3,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.pageTopPadding=4,this.systemSpacing=8.5,this.systemStretch=3,this.staffSpacing=5.8,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-7,this.tempoTimeSignatureXOffset=-5,this.tempoXOffsetFirstMeasure=-6,this.tempoXOffset=-5;break;case e.STYLE_HLC_PIANO_SOLO:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.titleBold=!0,this.titleSize=.9,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.27,this.composerY=12,this.copyrightSize=.22,this.footerSize=.3,this.indentationSpacing=8,this.repeatEndingBracketHeight=6,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.tempoFont="Georgia",this.tempoBold=!0,this.lineSpacing=this.scoreLineSpacing=4,this.layoutSpacing=8,this.pageTopPadding=4,this.systemSpacing=10.5,this.systemStretch=3,this.staffSpacing=6.5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-7.25,this.tempoTimeSignatureXOffset=-3.25,this.tempoXOffsetFirstMeasure=-6,this.tempoXOffset=-.75;break;case e.STYLE_HLC_UKULELE:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.titleBold=!0,this.titleSize=.7,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.28,this.composerBold=!0,this.composerY=12,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.22,this.lyricsLineSpacing=2,this.layoutSpacing=9,this.indentationSpacing=8,this.copyrightSize=.2,this.footerSize=.3,this.repeatEndingBracketHeight=3,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=6,this.lineNotationYPosition=8,this.lineSpacing=this.scoreLineSpacing=6,this.pageTopPadding=4,this.systemSpacing=14,this.systemStretch=0,this.staffSpacing=6.5,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-7.45,this.tempoTimeSignatureXOffset=-4,this.tempoXOffsetFirstMeasure=-5.5,this.tempoXOffset=-4;break;case e.STYLE_HLC_PVG:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.titleBold=!0,this.titleSize=1,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.375,this.composerY=12,this.copyrightSize=.225,this.footerSize=.3,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.3,this.lyricsLineSpacing=2.5,this.indentationSpacing=8,this.pageTopPadding=4,this.systemSpacing=12,this.systemStretch=3,this.staffSpacing=8,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.layoutSpacing=7,this.repeatEndingBracketHeight=11,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.tempoSymbolScale=.95,this.tempoUnitOffset=4.18,this.swingDelta=.33,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-8.5,this.tempoTimeSignatureXOffset=-2.75,this.tempoXOffsetFirstMeasure=-8,this.tempoXOffset=-1;break;case e.STYLE_CL_JAZZ:this.setMusicFont(e.STYLE_JAZZ_ASH),this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.autoMultiMeasureRestCreation=!0,this.directionsAboveStaff=!1,this.footerSize=.3;break;case e.STYLE_MS_PVG:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.lineSpacing=this.scoreLineSpacing=4,this.titleBold=!0,this.titleSize=1,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.375,this.composerY=12,this.copyrightSize=.225,this.footerSize=.3,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.3,this.lyricsLineSpacing=2.5,this.indentationSpacing=8,this.pageTopPadding=4,this.systemSpacing=12,this.systemStretch=3,this.staffSpacing=8,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.layoutSpacing=7,this.repeatEndingBracketHeight=3,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-10.45,this.tempoTimeSignatureXOffset=-6,this.tempoXOffsetFirstMeasure=-6.5,this.tempoXOffset=-4;break;case e.STYLE_MS_EASY_PIANO:this.titleFont="Arial",this.subtitleFont="Arial",this.supertitleFont="Arial",this.composerFont="Arial",this.arrangerFont="Arial",this.copyrightFont="Arial",this.footerFont="Arial",this.textFont="Arial",this.lyricistFont="Arial",this.lineSpacing=this.scoreLineSpacing=5,this.titleBold=!0,this.titleSize=.7,this.subtitleBold=!0,this.supertitleBold=!0,this.splitCodaByDefault=!0,this.splitSystemGap=10,this.showMultipleHyphens=!1,this.useLyricsDefaultDirection=!1,this.directionsAboveStaff=!1,this.composerSize=.25,this.composerY=12,this.copyrightSize=.225,this.footerSize=.3,this.tempoFont="Georgia",this.tempoBold=!0,this.lyricsSize=.3,this.lyricsLineSpacing=2.5,this.indentationSpacing=8,this.pageTopPadding=4,this.systemSpacing=12,this.systemStretch=3,this.staffSpacing=8,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.layoutSpacing=7,this.repeatEndingBracketHeight=3,this.repeatEndingBracketTextYOffset=0,this.repeatEndingBracketBold=!1,this.lineNotationDistanceAboveStaff=11,this.spaceAbovePerformanceText=6,this.tieSingleNoteEnabled=!1,this.tempoSymbolSize=.27,this.autoMultiMeasureRestCreation=!0,this.tempoTimeSignatureXOffsetFirstMeasure=-10.45,this.tempoTimeSignatureXOffset=-6,this.tempoXOffsetFirstMeasure=-6.5,this.tempoXOffset=-4;break;case e.STYLE_CCLI_MULTI_HANGUL:case e.STYLE_CCLI_SINGLE_HANGUL:this.textFont="SMGothic",this.titleFont="SMGothic",this.subtitleFont="SMGothic",this.supertitleFont="SMGothic",this.composerFont="SMGothic",this.arrangerFont="SMGothic",this.lyricistFont="SMGothic",this.copyrightFont="SMGothic",this.footerFont="SMGothic",this.staffTextFont="SMGothic",this.lyricsFont="SMGothic";case e.STYLE_CCLI:case e.STYLE_CCLI_MULTI:case e.STYLE_CCLI_SINGLE:this.lineSpacing=this.scoreLineSpacing=this.creditLineSpacing=5,this.titlePageFirstStaffPadding=0,this.pageTopPadding=4,this.systemSpacing=t==e.STYLE_CCLI_SINGLE||t==e.STYLE_CCLI_SINGLE_HANGUL?16:12,this.systemStretch=5,this.staffSpacing=10,this.chordFrameFretSpacing=.8,this.chordFrameStringSpacing=.8,this.centerChordSymbols=!0,this.keepChordSymbolsApart=!0,this.repeatWings=!1,this.pageNumberIncludesTitle=!0,this.spaceAboveChords=2,this.lyricsBelowStaffTop=-3,this.lyricsSize=.3,this.lyricsLineSpacing=2.5,this.layoutSpacing=6,this.repeatEndingBracketBold=!1,this.repeatEndingBracketTextYOffset=0,this.symbolScale=.75,this.copyrightSize=.25,this.composerSize=.3,this.footerSize=.3,this.indentationSpacing=8,this.numberOfColumnsPerBlock=2,this.showMultipleHyphens=!1,this.autoMultiMeasureRestCreation=!0,this.directionsAboveStaff=!1,this.tempoTimeSignatureXOffsetFirstMeasure=-7.5,this.tempoTimeSignatureXOffset=-2.5,this.tempoXOffsetFirstMeasure=-5.5,this.tempoXOffset=-2.5}}}],[{key:"toNumberVector",value:function(t){for(var e=[],i=0;i<t.length;i++)e[e.length]=A.unknownToNumber(t[i]);return e}}]),e}();r.registerClass(pn,"com.noteflight.notation.model.StaffMetrics");var mn=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(t=l(this,h(e).call(this,A.numberToInt(i))))._$value=0,t._$dots=0,t.value=n,t.dots=r,t}return c(e,he),p(e,null,[{key:"TWO_HUNDRED_FIFTY_SIXTH",get:function(){return 0}},{key:"ONE_HUNDRED_TWENTY_EIGHTH",get:function(){return 1}},{key:"SIXTY_FOURTH",get:function(){return 2}},{key:"THIRTY_SECOND",get:function(){return 3}},{key:"SIXTEENTH",get:function(){return 4}},{key:"EIGHTH",get:function(){return 5}},{key:"QUARTER",get:function(){return 6}},{key:"HALF",get:function(){return 7}},{key:"WHOLE",get:function(){return 8}},{key:"BREVE",get:function(){return 9}},{key:"LONGA",get:function(){return 10}},{key:"MIN_NOTATED_VALUE",get:function(){return vn}},{key:"MAX_NOTATED_VALUE",get:function(){return _n}}]),p(e,[{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.value=this.value,t.dots=this.dots,t}},{key:"value",get:function(){return this._$value},set:function(t){var e=this._$value;this._$value=t,e!==t&&this._propertyChanged("value",e,t)}},{key:"dots",get:function(){return this._$dots},set:function(t){var e=this._$dots;this._$dots=t,e!==t&&this._propertyChanged("dots",e,t)}},{key:"rhythmDuration",get:function(){return A.intToUint(e.valueToDuration(this.value,this.dots))},set:function(t){var i=e.durationToValue(t);if(t==1<<i)this.value=A.intToUint(i),this.dots=0;else if(t==3<<i-1)this.value=A.intToUint(i),this.dots=1;else{if(t!=7<<i-2)throw new Error("Attempt to set illegal duration: "+t);this.value=A.intToUint(i),this.dots=2}}},{key:"units",get:function(){return A.intToUint((1<<this.dots+1)-1)}},{key:"unitValue",get:function(){return A.intToUint(this.value-this.dots)}},{key:"metrical",get:function(){return!0}},{key:"movable",get:function(){return!0}}],[{key:"isDurationValid",value:function(t){var i=e.durationToValue(t);return t==1<<i||t==3<<i-1||t==7<<i-2}},{key:"durationToValue",value:function(t){for(var e=-1;t>0;)t>>=1,e+=1;return A.intToUint(e)}},{key:"valueToDuration",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(1<<e+1)-1<<t-e}},{key:"ascendingValueDurations",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=1,o=2<<e.MAX_NOTATED_VALUE-1;t>0;)r==o?(n.push(r),t-=1):i&&7==(7&t)?(n.push(7*r),t>>=3,r<<=3):i&&3==(3&t)?(n.push(3*r),t>>=2,r<<=2):(1==(1&t)&&n.push(r),t>>=1,r<<=1);return n}},{key:"descendingValueDurations",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.ascendingValueDurations(t,i).reverse()}}]),e}(),vn=mn.TWO_HUNDRED_FIFTY_SIXTH,_n=mn.WHOLE;r.registerClass(mn,"com.noteflight.notation.model.ValueNotation");var Sn=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(y(this,e),(t=l(this,h(e).call(this,i,A.intToUint(r),o)))._$beam=!1,t._$topLevelBeam=!1,t._$grace=!1,t._$appoggiatura=!1,t._$articulations=[],t._$tremolo=0,t._$arpeggio=null,t._$explicitRestY=!1,t._lyrics=null,t._notes=null,A.is(n,de))t.addNote(A.as(n,de));else if(A.is(n,Array)){var s=!0,a=!1,u=void 0;try{for(var c,d=xt.unknownForOfSource(n)[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var f=c.value,g=A.unknownToType(f,de);t.addNote(g)}}catch(t){a=!0,u=t}finally{try{s||null==d.return||d.return()}finally{if(a)throw u}}}else if(null!=n){var p=A.is(n,Object)?A.as(n,Object).toString():"";throw new Error("Unexpected type for NoteSet notes: "+p)}return t}return c(e,mn),p(e,null,[{key:"UP_BOW_ARTICULATION",get:function(){return"upBow"}},{key:"DOWN_BOW_ARTICULATION",get:function(){return"downBow"}},{key:"CLOSED_ARTICULATION",get:function(){return"closed"}},{key:"OPEN_ARTICULATION",get:function(){return"open"}},{key:"BUZZ_ARTICULATION",get:function(){return"buzz"}},{key:"FERMATA_ARTICULATION",get:function(){return"fermata"}},{key:"MARCATO_ARTICULATION",get:function(){return"marcato"}},{key:"MARTELLATO_ARTICULATION",get:function(){return"martellato"}},{key:"STACCATO_ARTICULATION",get:function(){return"staccato"}},{key:"STACCATISSIMO_ARTICULATION",get:function(){return"staccatissimo"}},{key:"TENUTO_ARTICULATION",get:function(){return"tenuto"}},{key:"BREATH_ARTICULATION",get:function(){return"breath"}},{key:"CAESURA_ARTICULATION",get:function(){return"caesura"}},{key:"MORDENT_ARTICULATION",get:function(){return"mordent"}},{key:"INVERTED_MORDENT_ARTICULATION",get:function(){return"invertedMordent"}},{key:"TURN_ARTICULATION",get:function(){return"turn"}},{key:"INVERTED_TURN_ARTICULATION",get:function(){return"invertedTurn"}},{key:"DELAYED_TURN_ARTICULATION",get:function(){return"delayedTurn"}},{key:"DELAYED_INVERTED_TURN_ARTICULATION",get:function(){return"delayedInvertedTurn"}},{key:"LV_TIE_ARTICULATION",get:function(){return"lvTie"}},{key:"NORMAL_ARPEGGIO",get:function(){return"normal"}},{key:"UP_ARPEGGIO",get:function(){return"up"}},{key:"DOWN_ARPEGGIO",get:function(){return"down"}},{key:"BEND_ARTICULATION",get:function(){return"bendJazz"}},{key:"ALWAYS_ABOVE_STAFF",get:function(){return 1}},{key:"ALLOWED_IN_STAFF",get:function(){return 2}},{key:"ALLOWED_ON_REST",get:function(){return 4}},{key:"AFFECTS_WIDTH",get:function(){return 8}},{key:"PLACE_TO_RIGHT",get:function(){return 16}},{key:"STEM_DECORATION",get:function(){return 32}},{key:"ARTICULATION_LIAISON",get:function(){return 64}},{key:"ARTICULATION_ATTRIBUTES",get:function(){return Ln}},{key:"ARTICULATION_ORDER",get:function(){return kn}},{key:"DELAYED_ARTICULATIONS",get:function(){return Tn}}]),p(e,[{key:"computeNotesAndLyrics",value:function(){var t=[],e=[];this._notes=t,this._lyrics=e;var i=!0,n=!1,r=void 0;try{for(var o,s=this._children[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,he);A.is(l,de)?t.push(l):A.is(l,ul)&&e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}t.sort(de.compareNotePitch)}},{key:"setLyricsDirection",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._lyrics[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.direction=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"isRest",value:function(){return 0===this.notes.length}},{key:"getNoteAt",value:function(t){return A.as(this.notes[t],de)}},{key:"addNote",value:function(t){0===this.notes.length?(this.color=t.color,t.color=0):1==this.notes.length&&0!==this.color&&(this.notes[0].color=this.color,this.color=0),this.addChild(t)}},{key:"mergeNoteSet",value:function(t){for(var e=0;e<t.notes.length;e++)this.addNote(t.notes[e])}},{key:"removeNote",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.removeChild(t),0===this.notes.length){this.articulations.slice();var n=!0,r=!1,o=void 0;try{for(var s,a=this.articulations.slice()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToString(l);(i||0==(e.ARTICULATION_ATTRIBUTES[u]&e.ALLOWED_ON_REST))&&this.removeArticulation(u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this.direction=null}}},{key:"removeNotes",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.notes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this.removeChild(o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"addArticulation",value:function(t){if(0!==this.numChildren||0!=(e.ARTICULATION_ATTRIBUTES[t]&e.ALLOWED_ON_REST)){if(e.ARTICULATION_ATTRIBUTES[t]==e.ARTICULATION_LIAISON){var i=!0,n=!1,r=void 0;try{for(var o,s=this.notes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.clearLiaison(de.TIE_LIAISON)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}for(var a=this.articulations.slice(),l=0;l<a.length;l++){if(e.ARTICULATION_ORDER[a[l]]>e.ARTICULATION_ORDER[t])return a.splice(l,0,t),void(this.articulations=a);if(a[l]==t)return}a.push(t),this.articulations=a}}},{key:"removeArticulation",value:function(t){var e=this.articulations.slice(),i=e.indexOf(t);i>=0&&(e.splice(i,1),this.articulations=e)}},{key:"hasArticulation",value:function(t){return this.articulations.indexOf(t)>=0}},{key:"hasArticulationWithAttribute",value:function(t){var i=!0,n=!1,r=void 0;try{for(var o,s=this.articulations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToString(a);if(e.ARTICULATION_ATTRIBUTES[l]==t)return!0}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return!1}},{key:"addLyric",value:function(t){this.addChild(t)}},{key:"removeLyric",value:function(t){this.removeChild(t)}},{key:"getLyricAtLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!0,n=!1,r=void 0;try{for(var o,s=this.lyrics[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a.line==t&&(!e||e==he.DIRECTION_DOWN||a.direction==he.DIRECTION_UP))return a}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return null}},{key:"previousNoteSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.measure)return null;if(i&&null!=this.previousGraceNote)return this.previousGraceNote;var n=this;return A.as(this.measure.previousNotation(this.position,function(t){var r=A.as(t,e);return null!=r&&r.voiceNumber==n.voiceNumber&&(i||!r.grace)},t),e)}},{key:"previousNoteSetAnyVoice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null==this.measure)return null;return A.as(this.measure.previousNotation(this.position,function(t){return A.is(t,e)&&!A.unknownToType(t,e).grace},t),e)}},{key:"nextNoteSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.measure)return null;if(i)for(var n=this.measure.measureNotations,r=A.intToUint(n.indexOf(this));++r<n.length;){var o=A.as(n[r],e);if(null!=o&&o.voiceNumber==this.voiceNumber)return o}var s=this;return A.as(this.measure.nextNotation(this.position,function(t){var n=A.as(t,e);return null!=n&&n.voiceNumber==s.voiceNumber&&(i||!n.grace)},t),e)}},{key:"nextNoteSetAnyVoice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null==this.measure)return null;return A.as(this.measure.nextNotation(this.position,function(t){return A.is(t,e)&&!A.unknownToType(t,e).grace},t),e)}},{key:"findSameAs",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.sameAs(t))return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"findDiatonicOrdinal",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.diatonicOrdinal==t)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"findChromaticOrdinal",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.pitch.ordinal==t)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"getLiaisonTypeCount",value:function(t){var e=0,i=!0,n=!1,r=void 0;try{for(var o,s=this.notes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.liaison==t&&e++}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"setAllTies",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.setLiaison(de.TIE_LIAISON)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"clearTies",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.notes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.clearLiaison(de.TIE_LIAISON)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"normalizeSpelling",value:function(t){if(0===this.notes.length)return 0;var e=0,i={},n=[],r=[],o=!0,s=!1,a=void 0;try{for(var l,u=this.notes[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;null==h.canonicalIntervalFrom(this.getNoteAt(0))?n.push(h):r.push(h)}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}r=r.concat(n);for(var c=0;c<r.length;c++){var d=A.unknownToType(r[c],de);if(c>0)if(d.pitch.pitchClass in i)d.step=A.unknownToInt(i[d.pitch.pitchClass]);else for(var f=null,y=100,g=c-1;g>=0;g--)if(null!=(f=d.canonicalIntervalFrom(A.unknownToType(r[g],de)))){var p=f.getAlteredness(t);p<y&&(d.step=f.step,y=p)}i[d.pitch.pitchClass]=d.step,e+=d.getAlteredness(t)}return e}},{key:"hasDiatonicPitch",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=this.notes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a.step==t&&a.notatedOctave==e)return!0}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return!1}},{key:"noteOnString",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.stringIndex==t)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"findClosestMatchingPitch",value:function(t){var e=null,i=9999,n=!0,r=!1,o=void 0;try{for(var s,a=this.notes[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=Math.abs(l.pitch.ordinal-t);u<=i&&(e=l,i=u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e}},{key:"defaultBeamStart",value:function(){if(this.grace){if(!this.appoggiatura){var t=this.nextGraceNote;null!=t?(this.beam=!0,t.value=this.value=A.intToUint(mn.SIXTEENTH)):(this.beam=!1,this.value=A.intToUint(null==this.previousGraceNote?mn.EIGHTH:mn.SIXTEENTH))}}else{var e=this.nextNoteSet();this.defaultBeamEnabled&&null!=e&&e.defaultBeamEnabled?A.is(this.rhythmContext,Xl)||A.is(e.rhythmContext,Xl)?this.beam=e.rhythmContext==this.rhythmContext:this.beam=zl.inSameGroup(this.rhythmContext.timeSignature.beamEnds,this.rhythmPosition,e.rhythmPosition):this.beam=!1,this.topLevelBeam=!1}}},{key:"defaultBeaming",value:function(){this.defaultBeamStart();var t=this.previousNoteSet();null!=t&&t.defaultBeamStart()}},{key:"addChildAt",value:function(t,i){s(h(e.prototype),"addChildAt",this).call(this,t,i),this._notes=null,this._lyrics=null}},{key:"doRemoveChildAt",value:function(t){this._notes=null,this._lyrics=null,s(h(e.prototype),"doRemoveChildAt",this).call(this,t)}},{key:"handleChildModelUpdate",value:function(t){s(h(e.prototype),"handleChildModelUpdate",this).call(this,t),(A.is(t.source,de)&&"pitch"==t.property||"alteration"==t.property)&&(this._notes=null,this.direction=null)}},{key:"hasLyricWithText",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.lyrics[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.line==t&&""!==s.text)return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.beam=this.beam,t.topLevelBeam=this.topLevelBeam,t.grace=this.grace,t.appoggiatura=this.appoggiatura,t.articulations=this.articulations.slice(),t.tremolo=this.tremolo,t.arpeggio=this.arpeggio,t.explicitRestY=this.explicitRestY,t}},{key:"toString",value:function(){var t="[note set pos="+this.position+", duration="+this.duration+", voice="+this.voiceNumber+", pitches=",e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){t+=r.value.pitch.toString()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t+="]"}},{key:"beam",get:function(){return this._$beam},set:function(t){var e=this._$beam;this._$beam=t,e!==t&&this._propertyChanged("beam",e,t)}},{key:"topLevelBeam",get:function(){return this._$topLevelBeam},set:function(t){var e=this._$topLevelBeam;this._$topLevelBeam=t,e!==t&&this._propertyChanged("topLevelBeam",e,t)}},{key:"grace",get:function(){return this._$grace},set:function(t){var e=this._$grace;this._$grace=t,e!==t&&this._propertyChanged("grace",e,t)}},{key:"appoggiatura",get:function(){return this._$appoggiatura},set:function(t){var e=this._$appoggiatura;this._$appoggiatura=t,e!==t&&this._propertyChanged("appoggiatura",e,t)}},{key:"articulations",get:function(){return this._$articulations},set:function(t){var e=this._$articulations;this._$articulations=t,e!==t&&this._propertyChanged("articulations",e,t)}},{key:"tremolo",get:function(){return this._$tremolo},set:function(t){var e=this._$tremolo;this._$tremolo=t,e!==t&&this._propertyChanged("tremolo",e,t)}},{key:"arpeggio",get:function(){return this._$arpeggio},set:function(t){var e=this._$arpeggio;this._$arpeggio=t,e!==t&&this._propertyChanged("arpeggio",e,t)}},{key:"explicitRestY",get:function(){return this._$explicitRestY},set:function(t){var e=this._$explicitRestY;this._$explicitRestY=t,e!==t&&this._propertyChanged("explicitRestY",e,t)}},{key:"children",get:function(){return this._children}},{key:"lyrics",get:function(){if(null==this._lyrics&&this.computeNotesAndLyrics(),!this._lyrics)throw Error("this._lyrics should be non-null");return this._lyrics}},{key:"notes",get:function(){if(null==this._notes&&this.computeNotesAndLyrics(),!this._notes)throw Error("this._notes should be non-null");return this._notes}},{key:"previousGraceNote",get:function(){if(null==this.rhythmContext)return null;for(var t=A.intToUint(this.index);--t>=0;){var i=A.as(this.rhythmContext.getElementAt(t),e);if(null!=i)return i.grace?i:null}return null}},{key:"nextGraceNote",get:function(){if(null==this.rhythmContext)return null;for(var t=A.intToUint(this.index);++t<this.rhythmContext.numElements;){var i=A.as(this.rhythmContext.getElementAt(t),e);if(null!=i)return i.grace?i:null}return null}},{key:"numFollowingGraceNotes",get:function(){for(var t=0,e=this;null!=e&&e.grace;)t++,e=e.nextGraceNote;return t}},{key:"rhythmDuration",get:function(){return A.intToUint(this.grace?0:mn.valueToDuration(this.value,this.dots))},set:function(t){o(h(e.prototype),"rhythmDuration",t,this,!0)}},{key:"metrical",get:function(){return!this.grace||this.marking}},{key:"marking",get:function(){if(!this.grace)return!1;var t=!0,e=!1,i=void 0;try{for(var n,r=this.notes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(o.liaison==de.PRE_BEND_LIAISON&&null!=o.measure&&A.is(o.measure.effectiveClef,$l)&&null!=o.liaisonEndNote&&o.liaisonEndNote.relativeBend>0)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"tied",get:function(){return this.tieCount>0}},{key:"tieCount",get:function(){return this.getLiaisonTypeCount(de.TIE_LIAISON)}},{key:"liaisonStart",get:function(){return this.liaisonCount>0}},{key:"liaisonCount",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){null!=r.value.liaison&&t++}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"liaisonEnd",get:function(){return this.liaisonEndCount>0}},{key:"liaisonEndCount",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;null==s.liaisonStartNote&&null==s.incomingLiaison||t++}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"hasEffects",get:function(){return this.effectCount>0}},{key:"effectCount",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;null==s.preEffect&&null==s.postEffect||t++}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"defaultBeamEnabled",get:function(){return this.value<=mn.EIGHTH&&this.numNonLyricChildren>0}},{key:"numNonLyricChildren",get:function(){return this.children.reduce(function(t,e){return t+(e instanceof ul?0:1)},0)}},{key:"effectiveColor",set:function(t){this.color=t;var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.color=0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var s=!0,a=!1,l=void 0;try{for(var u,h=this.lyrics[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){u.value.color=t}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}},get:function(){return s(h(e.prototype),"effectiveColor",this)}},{key:"effectiveCue",set:function(t){this.cue=t;var e=!0,i=!1,n=void 0;try{for(var r,o=this.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.cue=!1}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}},get:function(){return s(h(e.prototype),"effectiveCue",this)}},{key:"tremoloDyad",get:function(){return A.is(this.rhythmContext,Xl)&&A.unknownToType(this.rhythmContext,Xl).tremolo}},{key:"beamLevel",get:function(){return this.tremoloDyad?this.tremolo-1:mn.EIGHTH-this.value}},{key:"canShowBeam",get:function(){return this.value<=mn.EIGHTH||this.tremoloDyad}},{key:"hasLyrics",get:function(){return this.lyrics.length>0}}]),e}(),Ln={staccato:Sn.ALLOWED_IN_STAFF,staccatissimo:0,tenuto:Sn.ALLOWED_IN_STAFF,marcato:0,martellato:Sn.ALWAYS_ABOVE_STAFF,open:Sn.ALWAYS_ABOVE_STAFF,closed:Sn.ALWAYS_ABOVE_STAFF,breath:Sn.ALWAYS_ABOVE_STAFF|Sn.PLACE_TO_RIGHT,caesura:Sn.ALWAYS_ABOVE_STAFF|Sn.ALLOWED_ON_REST|Sn.PLACE_TO_RIGHT,upBow:Sn.ALWAYS_ABOVE_STAFF,downBow:Sn.ALWAYS_ABOVE_STAFF,fermata:Sn.ALWAYS_ABOVE_STAFF|Sn.ALLOWED_ON_REST|Sn.AFFECTS_WIDTH,mordent:Sn.ALWAYS_ABOVE_STAFF,invertedMordent:Sn.ALWAYS_ABOVE_STAFF,turn:Sn.ALWAYS_ABOVE_STAFF,invertedTurn:Sn.ALWAYS_ABOVE_STAFF,delayedTurn:Sn.ALWAYS_ABOVE_STAFF|Sn.PLACE_TO_RIGHT,delayedInvertedTurn:Sn.ALWAYS_ABOVE_STAFF|Sn.PLACE_TO_RIGHT,buzz:Sn.STEM_DECORATION,lvTie:Sn.ARTICULATION_LIAISON,bendJazz:Sn.ALWAYS_ABOVE_STAFF},kn={staccato:0,staccatissimo:1,tenuto:2,marcato:3,martellato:4,open:5,closed:6,upBow:7,downBow:8,caesura:9,breath:10,bendJazz:11,fermata:12,mordent:12,invertedMordent:12,turn:12,invertedTurn:12,delayedTurn:12,delayedInvertedTurn:12},Tn={turn:Sn.DELAYED_TURN_ARTICULATION,invertedTurn:Sn.DELAYED_INVERTED_TURN_ARTICULATION};r.registerClass(Sn,"com.noteflight.notation.model.NoteSet");var En=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.SINGLE;return y(this,e),(t=l(this,h(e).call(this,A.numberToInt(i))))._$type=null,t.type=n,t}return c(e,he),p(e,null,[{key:"SINGLE",get:function(){return"single"}},{key:"DOUBLE",get:function(){return"double"}},{key:"INVISIBLE",get:function(){return"invisible"}},{key:"FINAL",get:function(){return"final"}},{key:"INITIAL",get:function(){return"initial"}},{key:"DASHED",get:function(){return"dashed"}},{key:"REPEAT",get:function(){return"repeat"}},{key:"START_REPEAT",get:function(){return"startRepeat"}},{key:"END_REPEAT",get:function(){return"endRepeat"}},{key:"GRAND_STAFF",get:function(){return"grandStaff"}},{key:"TOP_START_WING",get:function(){return"topStartWing"}},{key:"BOTTOM_START_WING",get:function(){return"bottomStartWing"}},{key:"TOP_INITIAL_WING",get:function(){return"topInitialWing"}},{key:"BOTTOM_INITIAL_WING",get:function(){return"bottomInitialWing"}},{key:"TOP_END_WING",get:function(){return"topEndWing"}},{key:"BOTTOM_END_WING",get:function(){return"bottomEndWing"}},{key:"BRACE_BODY",get:function(){return"braceBody"}}]),p(e,[{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.type=this.type,t}},{key:"type",get:function(){return this._$type},set:function(t){var e=this._$type;this._$type=t,e!==t&&this._propertyChanged("type",e,t)}},{key:"metrical",get:function(){return this.position==this.measure.duration}},{key:"hasValueConstraint",get:function(){return!1}},{key:"breaksMultiMeasureRest",get:function(){return this.type==e.DOUBLE||this.type==e.FINAL||this.type==e.REPEAT||this.type==e.END_REPEAT}}]),e}();r.registerClass(En,"com.noteflight.notation.model.Barline");var Mn=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return y(this,e),(t=l(this,h(e).call(this,A.numberToInt(i))))._$numLines=0,t._$line=0,t._$sign=null,t._$note=null,t._$lineSpacing=1,t._$displayLineCount=-1,t._$displayLineSpacing=NaN,t._$percussionMap=null,t.sign=n,t.line=r,t.note=o,t.numLines=s,t.displayLineCount=a>=0?a:s,t.displayLineSpacing=u,n==e.PERCUSSION_CLEF_SIGN&&(t.percussionMap=e.BERKLEE_MAP),t}return c(e,he),p(e,null,[{key:"G_CLEF_SIGN",get:function(){return"G"}},{key:"F_CLEF_SIGN",get:function(){return"F"}},{key:"C_CLEF_SIGN",get:function(){return"C"}},{key:"TENOR_VOICE_CLEF_SIGN",get:function(){return"tenorVoice"}},{key:"VOCAL_TENOR_CLEF_SIGN",get:function(){return"F8below"}},{key:"PERCUSSION_CLEF_SIGN",get:function(){return"percussion"}},{key:"PERCUSSION2_CLEF_SIGN",get:function(){return"percussion2"}},{key:"TAB_CLEF_SIGN",get:function(){return"tab"}},{key:"BERKLEE_MAP",get:function(){return"berklee"}},{key:"PAS_MAP",get:function(){return"PAS"}},{key:"PERCUSSION_SPLIT_LINE",get:function(){return 1.5}},{key:"SHARP_SEQUENCE",get:function(){return bn}},{key:"FLAT_SEQUENCE",get:function(){return wn}}]),p(e,[{key:"getPitchLine",value:function(t){if(!this.note)throw Error("this.note expected to be non-null");return this.line+.5*(t.step-this.note.step)+3.5*(t.notatedOctave-this.note.notatedOctave)}},{key:"getEffectiveFret",value:function(t){return-1}},{key:"isTab",value:function(){return this.sign==e.TAB_CLEF_SIGN}},{key:"getLineNote",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=A.numberToInt(Math.round(2*(t-this.line)));if(!this.note)throw Error("this.note expected to be non-null");return i?this.note.transposeDiatonic(n-e.scoreInterval.steps):this.note.transposeDiatonic(n)}},{key:"getRestLine",value:function(t){var e=this.numLines%2==1?(this.numLines-1)/2:this.numLines/2;return this.displayLineCount>1&&(2==this.displayLineCount&&t>=mn.HALF&&(e-=this.displayLineSpacing/2),t==mn.WHOLE&&(e+=this.displayLineSpacing)),e}},{key:"getKeySignatureLines",value:function(t){return t>0?A.as(e.SHARP_SEQUENCE[this.initialStep],Array).slice(0,t):t<0?A.as(e.FLAT_SEQUENCE[this.initialStep],Array).slice(0,-t):[]}},{key:"showRhythm",value:function(t){return!0}},{key:"equals",value:function(t){return t.position==this.position&&this.sameAs(t)}},{key:"sameAs",value:function(t){return t.numLines==this.numLines&&t.line==this.line&&t.sign==this.sign&&(null!=t.note&&null!=this.note&&t.note.pitch.ordinal==this.note.pitch.ordinal||null==t.note&&null==this.note)}},{key:"mapNoteAndArticulation",value:function(t){if(this.percussionMap)if(this.percussionMap==e.BERKLEE_MAP)switch(t.pitch.toString()){case"G#3":return t.pitch=t.pitch.transpose(-1),t.step=de.G,t.accidental=null,Sn.OPEN_ARTICULATION}else if(this.percussionMap==e.PAS_MAP)switch(t.pitch.toString()){case"G#5":return t.pitch=t.pitch.transpose(-1),t.step=de.G,t.accidental=null,Sn.OPEN_ARTICULATION}return null}},{key:"defaultNoteHead",value:function(t){if(this.percussionMap==e.BERKLEE_MAP)switch(t.toString()){case"C3":case"G3":case"B3":case"C4":return de.CROSS_NOTE_HEAD;default:return de.NORMAL_NOTE_HEAD}else if(this.percussionMap==e.PAS_MAP)switch(t.toString()){case"D4":case"F5":case"G5":case"A5":case"B5":case"C6":return de.CROSS_NOTE_HEAD;default:return de.NORMAL_NOTE_HEAD}return null}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.numLines=this.numLines,t.line=this.line,t.sign=this.sign,t.note=this.note,t.lineSpacing=this.lineSpacing,t.displayLineCount=this.displayLineCount,t.displayLineSpacing=this.displayLineSpacing,t.percussionMap=this.percussionMap,t}},{key:"numLines",get:function(){return this._$numLines},set:function(t){var e=this._$numLines;this._$numLines=t,e!==t&&this._propertyChanged("numLines",e,t)}},{key:"line",get:function(){return this._$line},set:function(t){var e=this._$line;this._$line=t,e!==t&&this._propertyChanged("line",e,t)}},{key:"sign",get:function(){return this._$sign},set:function(t){var e=this._$sign;this._$sign=t,e!==t&&this._propertyChanged("sign",e,t)}},{key:"note",get:function(){return this._$note},set:function(t){var e=this._$note;this._$note=t,e!==t&&this._propertyChanged("note",e,t)}},{key:"lineSpacing",get:function(){return this._$lineSpacing},set:function(t){var e=this._$lineSpacing;this._$lineSpacing=t,e!==t&&this._propertyChanged("lineSpacing",e,t)}},{key:"displayLineCount",get:function(){return this._$displayLineCount},set:function(t){var e=this._$displayLineCount;this._$displayLineCount=t,e!==t&&this._propertyChanged("displayLineCount",e,t)}},{key:"displayLineSpacing",get:function(){return this._$displayLineSpacing},set:function(t){var e=this._$displayLineSpacing;this._$displayLineSpacing=t,e!==t&&this._propertyChanged("displayLineSpacing",e,t)}},{key:"percussionMap",get:function(){return this._$percussionMap},set:function(t){var e=this._$percussionMap;this._$percussionMap=t,e!==t&&this._propertyChanged("percussionMap",e,t)}},{key:"hasValueConstraint",get:function(){return!0}},{key:"staffHeight",get:function(){return(this.numLines-1)*this.lineSpacing}},{key:"centerLine",get:function(){return(this.numLines-1)/2}},{key:"defaultStemsUp",get:function(){return this.displayLineCount<=1}},{key:"initialStep",get:function(){if(!this.note)throw Error("this.note expected to be non-null");for(var t=this.note.step-2*this.line;t<0;)t+=7;return t%7}},{key:"unpitched",get:function(){return this.sign==e.PERCUSSION_CLEF_SIGN||this.sign==e.PERCUSSION2_CLEF_SIGN}},{key:"showKey",get:function(){return!0}},{key:"tabStemDirection",get:function(){return null}},{key:"showLegerLines",get:function(){return this.displayLineCount==this.numLines}},{key:"showSign",get:function(){return this.displayLineCount>0}},{key:"displayLineStartIndex",get:function(){return(this.numLines-1-(this.displayLineCount-1)*this.displayLineSpacing)/2}},{key:"displayLineEndIndex",get:function(){return this.displayLineStartIndex+(this.displayLineCount-1)*this.displayLineSpacing+1}}],[{key:"parseString",value:function(t){return"treble"==t||"G"==t?e.trebleClef():"tenorVoice"==t?e.tenorVoiceClef():"bass"==t||"F"==t?e.bassClef():"alto"==t?e.altoClef():"tenor"==t?e.tenorClef():"percussion"==t?e.percussionClef():null}},{key:"trebleClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.G_CLEF_SIGN,1,new de(kt.pitchAt(kt.G,kt.MIDDLE_C_OCTAVE)))}},{key:"tenorVoiceClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.TENOR_VOICE_CLEF_SIGN,1,new de(kt.pitchAt(kt.G,kt.MIDDLE_C_OCTAVE-1)))}},{key:"bassClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.F_CLEF_SIGN,3,new de(kt.pitchAt(kt.F,kt.MIDDLE_C_OCTAVE-1)))}},{key:"altoClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.C_CLEF_SIGN,2,new de(kt.pitchAt(kt.C,kt.MIDDLE_C_OCTAVE)))}},{key:"tenorClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.C_CLEF_SIGN,3,new de(kt.pitchAt(kt.C,kt.MIDDLE_C_OCTAVE)))}},{key:"vocalTenorClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.VOCAL_TENOR_CLEF_SIGN,3,new de(kt.pitchAt(kt.F,kt.MIDDLE_C_OCTAVE-2)))}},{key:"percussionClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.PERCUSSION_CLEF_SIGN,2,new de(kt.pitchAt(kt.D,kt.MIDDLE_C_OCTAVE-1)))}},{key:"percussion2Clef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e.PERCUSSION2_CLEF_SIGN,2,new de(kt.pitchAt(kt.B,kt.MIDDLE_C_OCTAVE)))}}]),e}(),bn=[[1.5,3.5,2,4,2.5,4.5,3],[1,3,1.5,3.5,2,4,2.5],[4,2.5,4.5,3,1.5,3.5,2],[3.5,2,4,2.5,1,3,1.5],[3,1.5,3.5,2,.5,2.5,1],[2.5,1,3,1.5,3.5,2,4],[2,4,2.5,4.5,3,1.5,3.5]],wn=[[3,4.5,2.5,4,2,3.5,1.5],[2.5,4,2,3.5,1.5,3,1],[2,3.5,1.5,3,1,2.5,.5],[1.5,3,1,2.5,.5,2,0],[1,2.5,.5,2,0,1.5,-.5],[4,2,3.5,1.5,3,1,2.5],[3.5,1.5,3,1,2.5,.5,2]];r.registerClass(Mn,"com.noteflight.notation.model.Clef");var xn=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,0)))._$ascent=i,r._$shift=n,r._$type=t,r}return c(e,he),p(e,null,[{key:"RIP1",get:function(){return"rip1"}},{key:"RIP2",get:function(){return"rip2"}},{key:"FALL1",get:function(){return"fall1"}},{key:"FALL2",get:function(){return"fall2"}},{key:"SCOOP",get:function(){return"scoop"}},{key:"PLOP",get:function(){return"plop"}},{key:"QUICK_FALL",get:function(){return"quickFall"}},{key:"DOIT",get:function(){return"doit"}},{key:"PRE_EFFECT",get:function(){return"preEffect"}},{key:"POST_EFFECT",get:function(){return"postEffect"}},{key:"ASCENT_TYPES",get:function(){return Cn}},{key:"PLACEMENT_BY_TYPE",get:function(){return Nn}},{key:"DEFAULT_ASCENT",get:function(){return 2}},{key:"DEFAULT_SHIFT",get:function(){return 2}}]),p(e,[{key:"calculateRotation",value:function(){return this.wavyType?Math.atan2(this.ascent,this.shift):0}},{key:"calculateLength",value:function(){return this.wavyType||this.lineType?Math.sqrt(Math.pow(this.shift,2)+Math.pow(this.ascent,2)):0}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.type=this.type,t.ascent=this.ascent,t.shift=this.shift,t}},{key:"ascent",get:function(){return this._$ascent},set:function(t){var e=this._$ascent;this._$ascent=t,e!==t&&this._propertyChanged("ascent",e,t)}},{key:"shift",get:function(){return this._$shift},set:function(t){var e=this._$shift;this._$shift=t,e!==t&&this._propertyChanged("shift",e,t)}},{key:"type",get:function(){return this._$type},set:function(t){var e=this._$type;this._$type=t,e!==t&&this._propertyChanged("type",e,t)}},{key:"rotation",get:function(){return this.calculateRotation()}},{key:"length",get:function(){return this.calculateLength()}},{key:"movable",get:function(){return!0}},{key:"wavyType",get:function(){return this.type==e.RIP1||this.type==e.FALL1}},{key:"lineType",get:function(){return this.type==e.RIP2||this.type==e.FALL2}},{key:"isPreEffect",get:function(){return e.PLACEMENT_BY_TYPE[this.type]==e.PRE_EFFECT}}],[{key:"defaultShift",value:function(t){return e.ASCENT_TYPES.indexOf(t)<0?0:e.PLACEMENT_BY_TYPE[t]==e.PRE_EFFECT?-e.DEFAULT_SHIFT:e.DEFAULT_SHIFT}},{key:"defaultAscent",value:function(t){return e.ASCENT_TYPES.indexOf(t)<0?0:e.DEFAULT_ASCENT}}]),e}(),Cn=[xn.RIP1,xn.RIP2,xn.FALL1,xn.FALL2],Nn={scoop:"preEffect",plop:"preEffect",rip1:"preEffect",rip2:"preEffect",quickFall:"postEffect",doit:"postEffect",fall1:"postEffect",fall2:"postEffect"};r.registerClass(xn,"com.noteflight.notation.model.EffectNotation");var An=function(){function t(){y(this,t),this._musicXml=null,this._score=null,this._options=null,this._errors=null,this._maxParts=128,this._maxMeasures=1024,this._maxVoices=4,this._maxStavesPerPart=8,this._maxMusicXmlVoices=32,this._maxMusicXmlStavesPerPart=32,this._unsupportedFeatures=null,this._numParts=0,this._numMeasures=0,this._badNotePositionCount=0,this._lastElementPosition=0,this._lyricsLines=[],this._lyricsLinePrefixes=[],this._lyricsExtensions=[],this._melismaCount=0,this._slashStore=[],this._measure=null,this._partIdx=0,this._part=null,this._partKey=null,this._musicXmlPart=null,this._divisions=0,this._measureIdx=0,this._spanNotations=null,this._numStaves=0,this._canHideStaff=!1,this._musicXmlStaffVoiceStarts=null,this._musicXmlStaffVoiceEnds=null,this._voicesPerStaff=null,this._stavesPerPart=null,this._staffScales=null,this._lyricsYForMeasure=[],this._staffIndexOctaveShifts=null,this._measureIndicesWithRehearsalMarkings={},this._measureRepeatByStaff=null,this._options=t._defaultOptions}return p(t,null,[{key:"POINTS_PER_INCH",get:function(){return 72}},{key:"INCHES_PER_MM",get:function(){return.0393700787}},{key:"DIVISIONS_PER_QUARTER",get:function(){return In}},{key:"DEFAULT_NOTATION_SPAN",get:function(){return Pn}},{key:"PLACEMENT_ABOVE",get:function(){return"above"}},{key:"PLACEMENT_BELOW",get:function(){return"below"}},{key:"STAFF_ABOVE_OFFSET",get:function(){return 3}},{key:"STAFF_BELOW_OFFSET",get:function(){return-4}},{key:"SPACES_PER_OCTAVE",get:function(){return 3.5}},{key:"MAX_PVG_TEXT_Y",get:function(){return 15}},{key:"MIN_PVG_SYSTEM_MARGIN",get:function(){return 4}},{key:"CHORD_OFFSET_THRESHOLD",get:function(){return 1}},{key:"TEXT_BLOCK_MIN_NUMBER_OF_WORDS",get:function(){return 8}},{key:"WORD_LIKE_DIRECTIONS",get:function(){return On}},{key:"TEXTBLOCK_SPECIAL_WORDS",get:function(){return Qn}},{key:"MS_STYLES",get:function(){return Rn}},{key:"BLACKLISTED_STYLES_FOR_SUBTITLE_CUSTOMIZATION",get:function(){return Dn}},{key:"STYLES_FOR_SPANISH_SUBTITLE",get:function(){return Fn}},{key:"_defaultOptions",get:function(){return Un},set:function(t){Un=t}},{key:"ACCIDENTAL_TABLE",get:function(){return Vn}},{key:"DEFAULT_CLEF_NOTE",get:function(){return"G4"}},{key:"CLEF_NOTE_TABLE",get:function(){return Bn}},{key:"DURATION_VALUE_TABLE",get:function(){return Hn}},{key:"BARLINE_TYPE_TABLE",get:function(){return $n}},{key:"VALID_CLEF_SIGNS",get:function(){return Gn}},{key:"ARTICULATION_TABLE",get:function(){return Yn}},{key:"EFFECT_TABLE",get:function(){return zn}},{key:"PRE_EFFECT_TYPES",get:function(){return Wn}},{key:"CHORD_TABLE",get:function(){return Xn}},{key:"LINE_NOTATION_ORNAMENT_TYPES",get:function(){return jn}},{key:"ARTICULATION_ORNAMENT_TABLE",get:function(){return qn}},{key:"MATCH_MULTIPLE_NEWLINES",get:function(){return Jn}},{key:"MATCH_CRLF",get:function(){return Zn}},{key:"LYRICS_MATCH_TOLERANCE",get:function(){return 10}},{key:"CHORD_TRIAD_TABLE",get:function(){return Kn}}]),p(t,[{key:"translateXml",value:function(t){jd.pushTimer("MusicXmlToScoreTranslator","translateXml",!1,!0),this._musicXml=t,this.initialize(),this.setupPartsAndMeasures(),this.parseScore(),this.cleanUpScore(),this.appendErrors(),jd.popTimer("MusicXmlToScoreTranslator","translateXml",!1,!0);this._score.parts;return this._score}},{key:"setupPartsAndMeasures",value:function(){if(this._numParts=A.intToUint(this._musicXml.child("part").length()),this._numParts<=0)this.appendError("No parts found","This score containes no parts");else{this._numParts>this._maxParts&&(this.appendError("Too many parts","This score contained "+this._numParts+" parts and has been reduced to "+this._maxParts+" parts"),this._numParts=this._maxParts),this._numMeasures=yl.MAX_VALUE;for(var t=0,e=0;e<this._numParts;e++){var i=A.intToUint(this._musicXml.child("part").get(e).child("measure").length());this._numMeasures=A.numberToUint(Math.min(this._numMeasures,i)),t=A.numberToUint(Math.max(t,i))}this._numMeasures<t&&this.appendError("Score reduced","This score contained parts with different number of measures. The score has been reduced to "+this._numMeasures+" measures"),this._numMeasures>this._maxMeasures&&(this.appendError("Too many measures","This score contained "+this._numMeasures+" measures and has been reduced to "+this._maxMeasures+" measures"),this._numMeasures=this._maxMeasures)}}},{key:"initialize",value:function(){this._errors=[],this._score=new Nl,this._score.staffMetrics.showPartNames=!1,this._score.displayMode=Nl.PAGINATED_DISPLAY,this._musicXmlStaffVoiceStarts=[],this._musicXmlStaffVoiceEnds=[],this._voicesPerStaff=[],this._stavesPerPart=[],this._staffScales=[],this._staffIndexOctaveShifts=[],this._lyricsYForMeasure=[],this._unsupportedFeatures={}}},{key:"handleError",value:function(t){throw new Error(t)}},{key:"appendError",value:function(t,e){this._errors.push(t+": "+e)}},{key:"appendErrors",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._errors[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToString(o);this._score.errors.push(s)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"parseScore",value:function(){if("score-partwise"==this._musicXml.name()){for(this._score.staffMetrics.verticalAutoSpace=!0,this.parseMetadata(),this.parseEncoding(),this._musicXml.has("defaults")&&this.parseDefaults(),this._partIdx=0;this._partIdx<this._numParts;this._partIdx++)this.parsePartSkeleton();for(this._partIdx=0;this._partIdx<this._numParts;this._partIdx++)this.parsePart()}else this.handleError("Unsupported format, Only partwise MusicXML documents are supported.")}},{key:"parsePartSkeleton",value:function(){var t=this._musicXml.child("part").get(this._partIdx),e=t.child("measure").child("attributes"),i=A.numberToUint(e.has("divisions")?X.parseInt(e.child("divisions").get(0).toString()):1),n=A.unknownToUint(e.has("staves")?e.child("staves"):1);n<1?n=1:n>2&&e.child("staves").length()>0&&(n=A.numberToUint(X.parseInt(e.child("staves").get(0).toString())));var r=this.parsePartDetails(t);this._stavesPerPart[this._partIdx]=n,this._musicXmlStaffVoiceStarts[this._partIdx]=[],this._musicXmlStaffVoiceEnds[this._partIdx]=[],this._lyricsYForMeasure[this._partIdx]=[],this._voicesPerStaff[this._partIdx]=[],this._musicXmlStaffVoiceStarts[this._partIdx][0]=0,this._musicXmlStaffVoiceEnds[this._partIdx][0]=0,this._spanNotations={};for(var o=0;o<n;o++)this._musicXmlStaffVoiceStarts[this._partIdx][o]=0===o?0:Hy.MAX_VALUE,this._musicXmlStaffVoiceEnds[this._partIdx][o]=0,this.parseStaffSkeleton(o,r,t,i)}},{key:"parseStaffSkeleton",value:function(t,e,i,n){var r=new Rl;this._score.addStaff(r),r.part=e,this._canHideStaff=!1,this._staffScales[r.index]=1;for(var o=0;o<this._numMeasures;o++)this.parseMeasureSkeleton(o,i,n,t,e,r);this._voicesPerStaff[this._partIdx][t]=1+this._musicXmlStaffVoiceEnds[this._partIdx][t]-this._musicXmlStaffVoiceStarts[this._partIdx][t]}},{key:"parseMeasureSkeleton",value:function(t,e,i,n,r,o){var s=e.child("measure").get(t);s.has("divisions")&&(i=A.numberToUint(X.parseInt(s.child("divisions").get(0).toString())));var a=s.child("attributes").child("clef"),l=!0,u=!1,h=void 0;try{for(var c,d=s.child("attributes").child("staff-details").list[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;this.parseStaffDetails(f,o,n,a.length()>0)}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}var y,g=this.defaultClef();if(0===t){if(a.length()>0){for(var p=0,m=0;m<a.length();++m)if(X.parseInt(A.xmllistToString(a.get(m).attribute("number")))==n+1){p=m;break}(g=this.parseClef(a.get(p),0,o)).unpitched&&(g.displayLineCount=o.type.numLines,g.numLines=o.type.numLines=Ul.NUM_LINES_STANDARD,g.displayLineCount>=2&&g.displayLineCount<=3&&(g.displayLineSpacing=2))}}else if(this._measure){this._measure.staff.getMeasureAt(A.intToUint(t-1));g=this._measure.getNotatedClefAtMeasurePosition(this._measure.duration)}if(0===this._partIdx&&0===n){y=this.generateMeasureSkeleton(g),this._score.systemStaff.addMeasure(y),this.parseSystemMeasure(s,y,i,this._score.systemStaff,r.transpositionInterval);var v=X.parseInt(s.attribute("number").toString());!X.isNaN(v)&&v-t>1&&(y.measureNumber=A.numberToInt(v))}else y=this._score.systemStaff.getMeasureAt(t);this._measure=this.generateMeasureSkeleton(g),this._measure.measureInfo=y.measureInfo,this._measure.canHideStaff=this._canHideStaff,o.addMeasure(this._measure),a.length()>0&&this.parseClefs(a,this._measure,n,i);var _=!0,S=!1,L=void 0;try{for(var k,T=s.children().query(function(t){return t.hasOwnProperty("staff")&&t.child("staff")==n+1}).child("voice").list[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value,M=A.xmlToUint(E);M<this._musicXmlStaffVoiceStarts[this._partIdx][n]&&(this._musicXmlStaffVoiceStarts[this._partIdx][n]=M-1),M>this._musicXmlStaffVoiceEnds[this._partIdx][n]&&(this._musicXmlStaffVoiceEnds[this._partIdx][n]=M-1)}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}this.options.optimizeForPVG&&((0===t||this.startsNewSystem(s))&&(this._lyricsLines=[]),this.inferLyricsLines(s,this._lyricsLines)),this._lyricsYForMeasure[this._partIdx][t]=this._lyricsLines,this.options.useLinesForEndings&&this.parseBarlineEndings(s,this._measure)}},{key:"parsePart",value:function(){this._part=A.as(this._score.parts[this._partIdx],El),this._musicXmlPart=this._musicXml.child("part").get(this._partIdx);var t=this._musicXmlPart.child("measure").child("attributes");this._divisions=A.numberToUint(t.has("divisions")?X.parseInt(t.child("divisions").get(0).toString()):1),this._numStaves=A.unknownToUint(this._stavesPerPart[this._partIdx]),this._spanNotations={},this._lyricsExtensions=[],this._partKey=new Ga,this._measureRepeatByStaff=[],this._melismaCount=0,this._options.optimizeForPVG&&(this._lyricsLinePrefixes=[]);for(var e=0;e<this._numStaves;e++)this._slashStore.push({slash:!1,slashStems:!1,slashStartPosition:0});for(this._measureIdx=0;this._measureIdx<this._numMeasures;this._measureIdx++)this.parseMeasure()}},{key:"parseMeasure",value:function(){for(var t,e,i=[],n=0;n<=this._maxMusicXmlStavesPerPart;n++){i[n]=[];for(var r=0;r<=this._maxMusicXmlVoices;r++)i[n][r]=[]}var o=0,s=0;this._lastElementPosition=0;var a=this._musicXmlPart.child("measure").get(this._measureIdx),l=[];a.has("divisions")&&(this._divisions=A.numberToUint(X.parseInt(a.child("divisions").get(0).toString())));var u,h,c,d,f=new Sn,y=new de,g=0,p=!1,m=0,v=!0,_=!1,S=void 0;try{for(var L,k=a.children().list[Symbol.iterator]();!(v=(L=k.next()).done);v=!0){var T,E=L.value,M=1,b=0,w=0,x=0,C=0;if(E.has("staff")&&(M=A.numberToUint(X.parseInt(E.child("staff").toString()))),"attributes"==E.name()&&E.child("measure-style").has("slash")&&(M=parseInt(E.child("measure-style").list[0].attribute("number").toString())||1)!=g&&(o=0),M!=g){for(d=M-1,n=0;n<this._partIdx;n++)d+=A.unknownToInt(this._stavesPerPart[n]);d<0&&(d=0),T=this._score.getStaffAt(A.intToUint(d)),t=A.as(T.getMeasureAt(this._measureIdx),hl),g=M}if(!t)throw Error("measure expected to be non-null");var N=1;E.has("voice")&&(N=A.numberToUint(X.parseInt(E.child("voice").toString())));var I=N-1-this._musicXmlStaffVoiceStarts[this._partIdx][M-1];I<0&&(I=0);var P,O,Q=null,R=A.intToUint(M-1),D=0;if(i[R][I].length>0)for(var F=0;F<i[R][I].length;F++)null!=i[R][I][F]&&(Q=i[R][I][F]);s=(e=Q||t.getVoiceNumber(I,!0)).getRhythmPosition(o);t:if("note"==E.name()){if(this._slashStore[d].slash&&!this._slashStore[d].slashStems){E.has("grace")||E.has("chord")||(b=this.parseDuration(E,this._divisions));break t}var U,V=A.intToUint(E.child("dot").length()),B=-1,H=!1;if(E.has("type")&&(B=this.mapDurationValue(E.child("type").toString())),E.child("notations").has("tuplet")){var $=!0,G=!1,Y=void 0;try{for(var z,W=E.child("notations").child("tuplet").query(function(t){return"start"==t.attribute("type")}).list[Symbol.iterator]();!($=(z=W.next()).done);$=!0)D=0,(O=z.value).query(function(t){return t.attribute("@number")}).length()>0&&(D=A.numberToInt(X.parseInt(A.xmllistToString(O.attribute("number")))-1)),U=this.cleanupPosition(s),u=this.parseTuplet(E,O,U),this.addElementToContext(u,e)&&(i[R][I][D]=u,e=u,s,s=0)}catch(t){G=!0,Y=t}finally{try{$||null==W.return||W.return()}finally{if(G)throw Y}}}if("start"==(P=E.child("notations").child("ornaments").child("tremolo").attribute("type").toString())&&(null==Q||!Q.tremolo)){D=i[R][I].length,U=this.cleanupPosition(s);var K=new mn(0,A.intToUint(B),V);(u=new Xl(U,K.units,K.unitValue,2*K.units,K.unitValue)).tremolo=!0,this.addElementToContext(u,e)&&(i[R][I][D]=u,e=u,s,s=0)}if((E.has("cue")||"cue"==E.child("type").attribute("size"))&&(H=!0),E.has("rest"))b=this.parseDuration(E,this._divisions),E.has("type")?C=A.intToUint(mn.valueToDuration(B,V)):(C=A.numberToUint(b),B=mn.WHOLE,V=0),c=this.cleanupPosition(s),B==mn.WHOLE&&0===V&&0===c&&C>=t.duration&&A.is(e,Kl)?(f=new Gl,C=A.numberToUint(t.duration)):f=new Sn(c,null,B,V),this.parseColor(E,f),f.cue=H,this.addElementToContext(f,e)&&(this._lastElementPosition=f.position,this.parseBeams(E,a,f),E.child("rest").has("display-step")&&E.child("rest").has("display-octave")&&this.explicitRestY(f,t.getNotatedClefAtMeasurePosition(this._lastElementPosition),this._part,E.child("rest").get(0)));else if(E.has("grace")?(y=this.parseNote(E,t.getNotatedClefAtMeasurePosition(o),t),E.has("chord")?f.addNote(y):(c=this.cleanupPosition(s),(f=new Sn(c,y,B,V)).grace=!0,h=!1,C=0,b=0,this.addElementToContext(f,e)&&(this._lastElementPosition=f.position,f.beam=!0))):(y=this.parseNote(E,t.getNotatedClefAtMeasurePosition(o),t),E.has("chord")?(f.addNote(y),y&&(f.color=y.color)):(c=this.cleanupPosition(s),f=new Sn(c,y,B,V),h=!1,C=A.intToUint(mn.valueToDuration(B,V)),this.addElementToContext(f,e)&&(this._lastElementPosition=f.position,this.parseBeams(E,a,f)),b=this.parseDuration(E,this._divisions))),h){if(!H){var j=!0,q=!1,J=void 0;try{for(var Z,tt=f.notes[Symbol.iterator]();!(j=(Z=tt.next()).done);j=!0){Z.value.cue=!0}}catch(t){q=!0,J=t}finally{try{j||null==tt.return||tt.return()}finally{if(q)throw J}}h=!1,f.cue=!1,y&&(y.cue=!1)}}else H&&(1==f.notes.length?(f.cue=!0,h=!0):y&&(y.cue=!0));if(E.has("stem"))switch(E.child("stem").toString()){case"up":this.options.useStemDirections&&(f.direction=he.DIRECTION_UP);break;case"down":this.options.useStemDirections&&(f.direction=he.DIRECTION_DOWN);break;case"none":if(!A.is(t.clef,$l)){var et=!0,it=!1,nt=void 0;try{for(var rt,ot=f.notes[Symbol.iterator]();!(et=(rt=ot.next()).done);et=!0){var st=rt.value;null!=st.noteHead&&st.noteHead!=de.NORMAL_NOTE_HEAD||(st.noteHead=de.STEMLESS_NOTE_HEAD)}}catch(t){it=!0,nt=t}finally{try{et||null==ot.return||ot.return()}finally{if(it)throw nt}}}}var at,lt=!1,ut=!0,ht=!1,ct=void 0;try{for(var dt,ft=E.processingInstructions().list[Symbol.iterator]();!(ut=(dt=ft.next()).done);ut=!0)(at=dt.value.toXMLString().toLowerCase()).indexOf("unexported slide start")>=0&&(lt=!0)}catch(t){ht=!0,ct=t}finally{try{ut||null==ft.return||ft.return()}finally{if(ht)throw ct}}var yt=E.child("notations");if(null!=f.rhythmContext){this.parseAllArticulations(yt,f,t,o,y);var gt=!0,pt=!1,mt=void 0;try{for(var vt,_t=yt.processingInstructions().list[Symbol.iterator]();!(gt=(vt=_t.next()).done);gt=!0)(at=vt.value.toXMLString().toLowerCase()).indexOf("bend exported as slur")>=0?m++:at.indexOf("unexported slide start")>=0&&(lt=!0)}catch(t){pt=!0,mt=t}finally{try{gt||null==_t.return||_t.return()}finally{if(pt)throw mt}}yt.has("arpeggiate")&&this.parseArpeggiate(yt.child("arpeggiate"),f),yt.has("slur")&&0===m&&this.parseSlurs(yt.child("slur"),e,this._spanNotations,c,f.grace||!p,this._divisions,t,M),yt.has("slide")&&this.parseLiaisons(yt.child("slide"),y,de.SLIDE_LIAISON),lt&&y&&(y.liaison=de.SLIDE_LIAISON),yt.has("glissando")&&this.parseLiaisons(yt.child("glissando"),y,de.GLISSANDO_LIAISON),yt.has("technical")&&this.parseTechnicals(yt.child("technical"),y),yt.has("ornaments")&&this.parseOrnaments(yt.child("ornaments"),e,this._spanNotations,c,this._divisions,t,f),yt.child("tied").query(function(t){return"stop"==t.attribute("type")}).length()>0&&0===f.position&&!t.flowsFromPreviousMeasure&&y&&(y.incomingLiaison=de.TIE_LIAISON)}if(m>0&&(y&&(y.liaison=de.BEND_LIAISON),f.invisible&&(f.color=0),m--),E.has("lyric")&&(this.parseLyrics(E.child("lyric"),f,this._lyricsYForMeasure[this._partIdx][this._measureIdx]),T&&(T.part.barlineBreak=!0,T.part.directionsAboveStaff=this._score.staffMetrics.directionsAboveStaff)),1==M&&this._lyricsExtensions.length>0)for(var St=0;St<this._lyricsExtensions.length;St++){var Lt=this._lyricsExtensions[St];null!=Lt&&Lt.voiceNumber==f.voiceNumber&&null==f.getLyricAtLine(St)&&(0===f.notes.length||this._slashStore[d].slash||f.cue&&"extend"==Lt.type?this._lyricsExtensions[St]=null:"continued"==Lt.type?(f.addLyric(new ul("",St,!0,!1)),f.tied||(this._lyricsExtensions[St]=null)):"extend"==Lt.type&&(f.addLyric(new ul("",St,!1,!0,!1,A.unknownToString(Lt.direction))),f.tied||this._melismaCount>0||!Lt.requireTieOrSlur||(this._lyricsExtensions[St]=null)))}p=f.grace}else if("attributes"==E.name()){E.has("key")&&(this._partKey=this.parseKeySignature(E.child("key"),t.part.transpositionInterval));var kt=!0,Tt=!1,Et=void 0;try{for(var Mt,bt=E.child("measure-style").child("slash").list[Symbol.iterator]();!(kt=(Mt=bt.next()).done);kt=!0){var wt=Mt.value;if("start"==wt.attribute("type").toString())this._slashStore[d].slash=!0,this._slashStore[d].slashStartPosition=o,this._slashStore[d].slashStems="yes"==wt.child("@use-stems");else if("stop"==wt.attribute("type").toString()){var xt=this._score.getStaffAt(d).getMeasureAt(this._measureIdx);this.generateSlashMeasure(xt,this._slashStore[d].slashStartPosition,o,this._slashStore[d].slashStems),this._slashStore[d].slash=!1,this._slashStore[d].slashStems=!1}}}catch(t){Tt=!0,Et=t}finally{try{kt||null==bt.return||bt.return()}finally{if(Tt)throw Et}}var Ct=!0,Nt=!1,At=void 0;try{for(var It,Pt=E.child("measure-style").list[Symbol.iterator]();!(Ct=(It=Pt.next()).done);Ct=!0){var Ot=It.value,Qt=Ot.attribute("number").toString(),Rt=A.numberToInt(null==Qt||""===Qt?1:X.parseInt(Qt)),Dt=!0,Ft=!1,Ut=void 0;try{for(var Vt,Bt=Ot.child("measure-repeat").list[Symbol.iterator]();!(Dt=(Vt=Bt.next()).done);Dt=!0){var Ht=Vt.value;"start"==Ht.attribute("type").toString()?this._measureRepeatByStaff[Rt]=!0:"stop"==Ht.attribute("type").toString()&&(this._measureRepeatByStaff[Rt]=!1)}}catch(t){Ft=!0,Ut=t}finally{try{Dt||null==Bt.return||Bt.return()}finally{if(Ft)throw Ut}}}}catch(t){Nt=!0,At=t}finally{try{Ct||null==Pt.return||Pt.return()}finally{if(Nt)throw At}}}else"backup"==E.name()?w=this.parseDuration(E,this._divisions):"forward"==E.name()?x=this.parseDuration(E,this._divisions):"direction"==E.name()?(this._lastElementPosition=o,this.parseDirection(E,this._divisions,t,this._spanNotations,this._numStaves,this._lastElementPosition,l)):"harmony"==E.name()&&this.parseChordSymbols(E,t,this._divisions);var $t=e.getDuration(b)-w+x;if(o=Math.max(0,o+$t),"stop"==P&&(D=i[R][I].length-1,u=i[R][I][D],i[R][I].splice(-1,1)),E.child("notations").has("tuplet")){var Gt=!0,Yt=!1,zt=void 0;try{for(var Wt,Xt=E.child("notations").child("tuplet").query(function(t){return"stop"==t.attribute("type")}).list[Symbol.iterator]();!(Gt=(Wt=Xt.next()).done);Gt=!0)D=0,(O=Wt.value).query(function(t){return t.attribute("number")}).length()>0&&(D=A.numberToInt(X.parseInt(A.xmllistToString(O.attribute("number")))-1)),u=i[R][I][D],i[R][I].splice(-1,1)}catch(t){Yt=!0,zt=t}finally{try{Gt||null==Xt.return||Xt.return()}finally{if(Yt)throw zt}}}I}}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}for(var Kt=0;Kt<this._measureRepeatByStaff.length;Kt++)if(this._measureRepeatByStaff[Kt]&&null!=this._part.staves&&null!=this._part.staves[Kt-1]){var jt=this._part.staves[Kt-1].getMeasureAt(this._measureIdx);vl.setMeasureToMeasureRepeat(jt),this._spanNotations={}}for(var qt=1;qt<this._numStaves+1;qt++){var Jt=this._slashStore.length-qt;if(this._slashStore[Jt].slash){var Zt=this._score.getStaffAt(Jt).getMeasureAt(this._measureIdx);this.generateSlashMeasure(Zt,this._slashStore[Jt].slashStartPosition,Zt.duration,this._slashStore[Jt].slashStems),this._slashStore[Jt].slashStartPosition=0}}if(t){if(!this._slashStore[d].slash){var te=t.staff.part.transposingInterval.inverse().add(new $a(this._partKey.enharmonicDistance,0));t.transposeInterval(te)}if(this._measureIdx>0){var ee=this.startsNewSystem(a),ie=t.staff.getMeasureAt(A.intToUint(this._measureIdx-1)).getFormalElements().length>0||t.getFormalElements().length>0;(this._options.useSystemBreaks||ie)&&ee&&(this._score.systemStaff.getMeasureAt(A.intToUint(this._measureIdx-1)).breakType=hl.SYSTEM_BREAK_TYPE)}t.flowsToNextMeasure||(this._lyricsExtensions=[]),this.processBlocks(l,t)}}},{key:"processBlocks",value:function(t,e){t.sort(function(t,e){return t.y==e.y?t.x-e.x==0?t.index-e.index:t.x-e.x:e.y-t.y});for(var i=e.staff.isSystemStaff?e:e.systemMeasure,n=0;n<t.length;n++){var r=t[n];(r.isBlockHeader||0===i.blocks.length||i.blocks[i.blocks.length-1].totalColumns==this._score.staffMetrics.numberOfColumnsPerBlock)&&i.addBlock(new wa);var o=i.blocks[i.blocks.length-1],s=r.isBlockHeader?this._score.staffMetrics.blockHeaderWeight:this._score.staffMetrics.blockColumnWeight;o.addColumn(this.createBlockColumn(A.unknownToString(r.text),s))}}},{key:"appendText",value:function(t,e){var i=t||"";return i.length>0&&(i+="\n"),i+=e}},{key:"parseMetadata",value:function(){this._score.title=this.normalizeScoreString(this._musicXml.has("movement-title")?this._musicXml.child("movement-title").toString():this._musicXml.child("work").child("work-title").toString());var t=!0,e=!1,i=void 0;try{for(var n,r=this._musicXml.child("identification").child("creator").list[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=this.normalizeScoreString(o.toString());switch(o.attribute("type").toString()){case"lyricist":this._score.lyricist=s;break;case"composer":default:this._score.composer=s}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._musicXml.child("identification").has("rights")&&(this._score.copyright=this.normalizeScoreString(this._musicXml.child("identification").child("rights").toString()));var a,l=[],u=!0,h=!1,c=void 0;try{for(var d,f=this._musicXml.child("credit").list[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=y.attribute("page");if(!(g.length()>0&&A.stringToNumber(g.toString())>1)){var p=!0,m=!0,v=!1,_=void 0;try{for(var S,L=y.child("credit-words").list[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var T=S.value;if(p){a=new k(T.attribute("halign").toString(),T.attribute("valign").toString(),T.attribute("justify").toString(),A.xmllistToNumber(T.child("@default-y")),this.normalizeScoreString(T.toString()));var E=y.child("credit-type");E&&(a.type=E.toString()),""===a.halign&&(a.halign=a.justify),l.push(a),p=!1}else l[l.length-1].text+="\n"+T.toString()}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}l.sort(function(t,e){return t.defaultY>e.defaultY?-1:t.defaultY<e.defaultY?1:0});for(var M="",b="",w="",x=0;x<l.length;x++)if((a=l[x]).type)switch(a.type){case"subtitle":this._score.subtitle=this.appendText(this._score.subtitle,a.text);break;case"dedication":this._score.supertitle=this.appendText(this._score.supertitle,a.text);break;case"title":w=this.appendText(w,a.text);break;case"composer":M=this.appendText(M,a.text);break;case"lyricist":b=this.appendText(b,a.text)}else if("top"==a.valign)switch(a.halign){case"left":case"":b=this.appendText(b,a.text);break;case"center":w=this.appendText(w,a.text);break;case"right":M=this.appendText(M,a.text)}M.length>0&&(this._score.composer=M),b.length>0&&(this._score.lyricist=b),w.length>0&&(this._score.title=w)}},{key:"normalizeScoreString",value:function(e){var i=e;return i=(i=(i=i.replace(t.MATCH_MULTIPLE_NEWLINES,"\n")).replace(t.MATCH_CRLF,"\n")).replace(/``|""|''/g,"")}},{key:"generateSlashMeasure",value:function(t,e,i,n){if(n){var r=!0,o=!1,s=void 0;try{for(var a,l=t.measureNotations[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,he);if(!(h.position<e||h.position>=i)&&A.is(h,Sn)){var c=A.unknownToType(h,Sn),d=!0,f=!1,y=void 0;try{for(var g,p=c.notes[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){g.value.noteHead=de.HIT_NOTE_HEAD}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}else for(var m=e;m<i;){var v=A.as(t.clef.getLineNote(t.clef.centerLine,t,!0).clone(),de);v.noteHead=de.SLASH_NOTE_HEAD;var _=new Sn(m,[v]);_.rhythmDuration=A.intToUint(t.timeSignature.defaultBeatGroupDuration),t.addElement(_,0),m+=_.rhythmDuration}}},{key:"parseEncoding",value:function(){var t=this._musicXml.child("identification").child("encoding"),e=t.child("software").toString();((t.child("supports").query(function(t){return"accidental"==t.attribute("element").toString()&&"no"==t.attribute("type").toString()}).length()>0||e.indexOf("Guitar Pro")>=0)&&(this._unsupportedFeatures.accidentals=!0),t.child("supports").query(function(t){return"transpose"==t.attribute("element").toString()&&"no"==t.attribute("type").toString()}).length()>0&&(this._unsupportedFeatures.transposition=!0),e.indexOf("Sibelius")>=0||e.indexOf("Guitar Pro")>=0)&&(A.numberToInt(X.parseInt(e.substr(e.indexOf("Dolet")+6,1)))<4&&(this._unsupportedFeatures.beams=!0))}},{key:"parseDefaults",value:function(){var e=this._musicXml.child("defaults");if(e.has("scaling")){var i=A.stringToNumber(e.child("scaling").child("tenths").toString()),n=A.stringToNumber(e.child("scaling").child("millimeters").toString()),r=Math.round(n*t.INCHES_PER_MM*t.POINTS_PER_INCH/i*10);if(r<pn.MIN_LINE_SPACING?r=pn.MIN_LINE_SPACING:r>pn.MAX_LINE_SPACING&&(r=pn.MAX_LINE_SPACING),this._score.staffMetrics.lineSpacing=this._score.staffMetrics.scoreLineSpacing=r,e.has("system-distance")){var o=e.child("system-distance").toString()/10;o<pn.MIN_SYSTEM_SPACING?o=pn.MIN_SYSTEM_SPACING:o>pn.MAX_SYSTEM_SPACING&&(o=pn.MAX_SYSTEM_SPACING),this._score.staffMetrics.systemSpacing=o}if(e.has("staff-layout")&&e.child("staff-layout").has("staff-distance")){var s=e.child("staff-layout").child("staff-distance").toString()/10;s<pn.MIN_STAFF_SPACING?s=pn.MIN_STAFF_SPACING:s>pn.MAX_STAFF_SPACING&&(s=pn.MAX_STAFF_SPACING),this._score.staffMetrics.staffSpacing=s}e.has("music-font")&&this.isJazzFont(e.child("music-font").child("@font-family").toString())&&this._options.mapJazzFontsToAsh?this.setImportStyle(pn.STYLE_JAZZ_ASH):e.has("word-font")&&this.isHangulFont(e.child("word-font").child("@font-family").toString())&&(this._options.importStyle==pn.STYLE_CCLI_MULTI||this._options.importStyle==pn.STYLE_CCLI_SINGLE)?this.setImportStyle(this._options.importStyle==pn.STYLE_CCLI_MULTI?pn.STYLE_CCLI_MULTI_HANGUL:pn.STYLE_CCLI_SINGLE_HANGUL):null!=this._options.importStyle?this.setImportStyle(this._options.importStyle):this._options.optimizeForPVG&&this.setImportStyle(pn.STYLE_PVG)}}},{key:"isJazzFont",value:function(t){return null!=/Inkpen|handwritten|Ash/.exec(t)}},{key:"isHangulFont",value:function(t){return null!=/SMGothic/.exec(t)}},{key:"parseSystemMeasure",value:function(e,i,n,r,o){var s=A.intToUint(i.index),a=e.child("attributes"),l=new zl,u=new zl,h=null;if(s>0&&(u=(h=this._score.systemStaff.getMeasureAt(A.intToUint(s-1))).timeSignatureNotation?h.timeSignatureNotation:h.timeSignature),a.has("time")&&!a.child("time").has("senza-misura"))l=this.parseTimeSignature(a.child("time")),0!==s&&l.equals(u)||i.addElement(l,Kl.NON_METRICAL_VOICE_NUMBER);else if(r.measures.length>1)l=u;else{var c=A.numberToUint(Math.round(this.measureDuration(e,n)/t.DIVISIONS_PER_QUARTER));c<1&&(c=4),l=new zl(c)}var d=this.measureDuration(e,n)/t.DIVISIONS_PER_QUARTER;if(d>0&&Math.round(d*t.DIVISIONS_PER_QUARTER)!=l.meterDuration){for(var f=l.beatType,y=d*=f/4;Math.abs(d-Math.round(d))>1/256&&f<256;)f*=2,d*=2;f>=256&&(f=l.beatType,d=Math.ceil(y)),l=new zl(A.numberToUint(Math.round(d)),f)}i.timeSignature=l;var g=new Ga,p=new Ga;if(s>0&&h&&(p=h.keySignature),a.has("key")?(g=this.parseKeySignature(a.child("key"),o),s>0&&!g.equals(p)&&(g.cancel=p.fifths,h&&(g.rhythmPosition=A.numberToUint(h.duration),h.addElement(g,Kl.NON_METRICAL_VOICE_NUMBER)))):r.measures.length>1&&(g=p),i.keySignature=g,this.parseBarline(e,i),this.options.optimizeForPVG){var m=!0,v=!1,_=void 0;try{for(var S,L=e.child("print").child("system-layout").child("system-margins").children().list[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var k=S.value;switch(k.localName()){case"left-margin":var T=X.parseInt(k.text())/10;T>t.MIN_PVG_SYSTEM_MARGIN&&(i.leftMargin=T);break;case"right-margin":var E=X.parseInt(k.text())/10;E>t.MIN_PVG_SYSTEM_MARGIN&&(i.rightMargin=E)}}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}}}},{key:"parseMetronome",value:function(e,i){var n=null;if(e.has("per-minute")){var r=mn.QUARTER;e.has("beat-unit")&&e.child("beat-unit").toString()in t.DURATION_VALUE_TABLE&&(r=t.DURATION_VALUE_TABLE[e.child("beat-unit").toString()]);var o=e.has("beat-unit-dot"),s=A.xmllistToString(e.child("per-minute")),a=A.numberToInt(X.parseInt(s.replace(/\D/g,"")));0===a&&(a=120),(n=new Yl(A.intToUint(r),o?1:0,A.intToUint(a))).dx=i.x,n.dy=i.y}return n}},{key:"inferMeterMap",value:function(t){if((t=t.toLowerCase()).indexOf("swing")>=0||t.indexOf("shuffle")>=0){var e=t.indexOf("16")>0?Hl.SIXTEENTH_SWING_TYPE:Hl.EIGHTH_SWING_TYPE;return new Hl(e,this._score.staffMetrics.swingDelta)}return t.indexOf("straight")>=0?_l.IDENTITY:null}},{key:"parseSegno",value:function(t,e,i,n){i>e.duration/2&&e.index+1<this._score.numMeasures&&(e=e.staff.getMeasureAt(A.intToUint(e.index+1)),i=0),this.addSystemSymbol(new Il(A.numberToInt(i)),e,n)}},{key:"parseCoda",value:function(t,e,i){var n=this.addSystemSymbol(new Oa(A.numberToInt(e)),t,i);this._score.staffMetrics.splitCodaByDefault&&n.previousMeasure&&e<=t.duration/2&&(n.previousMeasure.effectiveSystemMeasure.systemGap=!0)}},{key:"addSystemSymbol",value:function(t,e,i){return e.systemMeasure.addElement(t,Kl.NON_METRICAL_VOICE_NUMBER),t.dx=0===t.rhythmPosition?this._score.staffMetrics.symbolFirstMeasureXOffset-this._score.staffMetrics.symbolScale:i.x,t.dy=this.options.optimizeForPVG&&!this.isStaffRelative(i.y)?0:i.y,e.systemMeasure}},{key:"parseTimeSignature",value:function(t){for(var e=null,i=0;i<t.get(0).child("beats").length();i++){var n=X.parseFloat(t.get(0).child("beats").get(i).toString());(X.isNaN(n)||0===n)&&(n=4);var r=A.numberToInt(X.parseInt(t.get(0).child("beat-type").get(i).toString()));for((X.isNaN(r)||0===r)&&(r=4);Math.abs(n-Math.round(n))>1/256&&r<256;)n*=2,r*=2;e=null!=e?e.appendTimeSignature(new zl(A.numberToUint(n),A.intToUint(r))):new zl(A.numberToUint(n),A.intToUint(r)),"no"==t.attribute("print-object").toString()&&(e.visibility=zl.HIDDEN_VISIBILITY)}switch(t.get(0).attribute("symbol").toString()){case"common":null!=e&&(e.timeSymbol=zl.COMMON_TIME_SYMBOL);break;case"cut":null!=e&&(e.timeSymbol=zl.CUT_TIME_SYMBOL)}return e}},{key:"parseKeySignature",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new Ga(A.xmllistToInt(t.get(0).child("fifths")));if(null!=e&&(i=i.transposeFifths(e.inverse().fifths)),t.has("mode")){var n=A.xmllistToString(t.child("mode"));Object.keys(Ga.MODE_FIFTHS).includes(n.toLowerCase())&&(i.mode=n)}return i}},{key:"parseBarline",value:function(e,i){var n,r=new En(i.duration);i.addElement(r,Kl.NON_METRICAL_VOICE_NUMBER);var o=!0,s=!1,a=void 0;try{for(var l,u=e.child("barline").list[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if("left"==h.attribute("location").toString())n=0,h.child("repeat").query(function(t){return"forward"==t.attribute("direction")}).length()>0&&(i.startRepeat=!0);else{if(n=i.duration,h.hasOwnProperty("bar-style")){r.type=En.SINGLE;var c=A.xmllistToString(h.child("bar-style"));c in t.BARLINE_TYPE_TABLE&&(r.type=t.BARLINE_TYPE_TABLE[c])}h.child("repeat").query(function(t){return"backward"==t.attribute("direction")}).length()>0&&(i.endRepeat=!0)}if(h.has("segno")&&i.addElement(new Il(A.numberToInt(n)),Kl.NON_METRICAL_VOICE_NUMBER),h.has("coda")&&i.addElement(new Oa(A.numberToInt(n)),Kl.NON_METRICAL_VOICE_NUMBER),h.has("ending")&&!this.options.useLinesForEndings&&h.child("ending").get(0).hasOwnProperty("@type")&&"start"==h.child("ending").get(0).attribute("type")){var d="1";h.child("ending").get(0).hasOwnProperty("@number")&&"."!=(d=A.xmllistToString(h.child("ending").get(0).attribute("number"))).charAt(d.length-1)&&(d+=".");var f=ll.TYPE_INITIAL,y=i.duration,g=this._score.staffMetrics.repeatEndingBracketHeight,p=this._score.staffMetrics.repeatEndingBracketBold,m=new ll(0,y,f,0,d,g,p);m.dy=this._score.staffMetrics.repeatEndingDistanceAboveStaff,i.addElement(m,Kl.NON_METRICAL_VOICE_NUMBER)}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"parseBarlineEndings",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t.child("barline").list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this._lastElementPosition="left"==a.attribute("location").toString()?0:e.duration;var l=!0,u=!1,h=void 0;try{for(var c,d=a.child("ending").list[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;if("no"!=f.child("@print-object").toString())if("start"==f.attribute("type").toString()){var y=this.parsePositioning(f,this._lastElementPosition,"above",e.staff),g=A.xmllistToString(f.attribute("number"));g.length>0&&"."!=g.charAt(g.length-1)&&(g+="."),this.parseSpanStart(f,this._spanNotations,Ua.LINE_TYPE,this._lastElementPosition,!0,e.systemMeasure,this._divisions,null,y,ll.TYPE_INITIAL,g,this._score.staffMetrics.repeatEndingBracketHeight)}else if("stop"==f.attribute("type").toString())this.parseSpanStop(f,this._spanNotations,Ua.LINE_TYPE,e.duration,e.systemMeasure,this._divisions);else if("discontinue"==f.attribute("type").toString()){var p=A.as(this.parseSpanStop(f,this._spanNotations,Ua.LINE_TYPE,e.duration,e.systemMeasure,this._divisions),qa);null!=p&&(p.type=ll.TYPE_FINAL)}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"parseNote",value:function(e,i,n){if(!e.has("pitch")&&!e.has("unpitched"))return null;var r,o=de.NORMAL_NOTE_HEAD,s=!1;if(e.has("notehead")&&(o=this.mapNoteHeadType(e.child("notehead").toString(),"no"!=e.child("notehead").attribute("filled")),s="yes"==e.child("notehead").attribute("parentheses")),e.has("pitch")){var a=kt.STEP_NAMES.indexOf(e.child("pitch").child("step").toString()),l=e.child("tie").query(function(t){return"start"==t.attribute("type")}).length()>0||e.child("notations").child("tied").query(function(t){return"start"==t.attribute("type")}).length()>0,u=null,h=!1;e.has("accidental")&&(u=t.ACCIDENTAL_TABLE[e.child("accidental").toString()],h="yes"==e.child("accidental").attribute("parentheses")||"yes"==e.child("accidental").attribute("cautionary")),r=new de(this.mapPitch(e.child("pitch")),a,u,l,o),null!=u&&(r.explicitAccidental=!0,r.courtesyAccidental=h)}else e.has("unpitched")&&((r=this.mapUnpitchedNote(e.child("unpitched").child("display-step").toString(),A.numberToUint(X.parseInt(A.xmllistToString(e.child("unpitched").child("display-octave")))),i)).noteHead=o);return r&&(r.parentheses=s),this.parseColor(e,r),n.staff.index in this._staffIndexOctaveShifts&&r&&(r.pitch=r.pitch.transpose(A.numberToInt(12*this._staffIndexOctaveShifts[n.staff.index]))),r}},{key:"parseColor",value:function(t,e){if("no"==t.child("@print-object").toString().toLowerCase())e.color=16777215,A.is(e,de)&&this.options.silenceHiddenNotes&&(A.unknownToType(e,de).silent=!0);else if(t.has("@color")){var i=t.child("@color").toString();"#"==i.charAt(0)&&(i=i.slice(1)),e.color=A.numberToUint(X.parseInt(i,16))}}},{key:"mapNoteHeadType",value:function(t,e){switch(t){case"slash":return de.SLASH_NOTE_HEAD;case"triangle":return de.TRIANGLE_NOTE_HEAD;case"diamond":return e?de.DIAMOND_NOTE_HEAD:de.HARMONIC_NOTE_HEAD;case"square":return de.SQUARE_NOTE_HEAD;case"x":return de.CROSS_NOTE_HEAD;case"slashed":return de.HIT_NOTE_HEAD;default:return de.NORMAL_NOTE_HEAD}}},{key:"mapUnpitchedNote",value:function(t,e,i){var n=A.intToUint(kt.STEP_NAMES.indexOf(t)%kt.STEP_NAMES.length),r=new de(kt.pitchFromString(kt.STEP_NAMES.charAt(n)+e));switch(i.displayLineCount){case 0:case 1:case 2:r=r.transposeDiatonic(4);break;case 3:r=r.transposeDiatonic(2);break;case 4:r=r.transposeDiatonic(1)}return r}},{key:"mapPitch",value:function(t){var e=kt.pitchFromString(t.child("step").toString()+t.child("octave").toString());return t.has("alter")&&(e=e.transpose(A.numberToInt(X.parseInt(t.child("alter").toString())))),e}},{key:"mapPitchClassString",value:function(t,e){switch(e){case-2:return t+"bb";case-1:return t+"b";case 1:return t+"#";case 2:return t+"##"}return t}},{key:"cleanUpStaff",value:function(e){var i=!0,n=!1,r=void 0;try{for(var o,s=e.measures[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(this.options.optimizeForPVG){var l,u=[],h=[],c=!0,d=!1,f=void 0;try{for(var y,g=a.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=A.unknownToType(p,se);null!=(l=A.as(m,Ca))&&(e.index>0&&l.dy>t.MAX_PVG_TEXT_Y&&!this.isStaffRelative(l.dy)?u.push(l):0===e.index&&a.canHideStaff&&h.push(l))}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}for(var v=0;v<u.length;v++){var _=u[v];l=A.unknownToType(_,Ca);var S=this._score.getStaffAt(0).getMeasureAt(A.intToUint(a.index));S.canHideStaff||(l.parent.removeChild(l),this.isStaffRelative(l.dy)||(l.dy=0),S.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER,!0).addChild(l),S.defaultTextPositions())}for(var L=0;L<h.length;L++){var k=h[L];l=A.unknownToType(k,Ca);var T=this._score.getStaffAt(1).getMeasureAt(A.intToUint(a.index));T.canHideStaff||(l.parent.removeChild(l),T.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER,!0).addChild(l))}}a.defaultAboveBelow(),this.options.optimizeForPVG&&a.defaultTextPositions(),this.options.combineSameStemVoices&&a.combineSameStemVoices(),this.checkNotePositions(a),"accidentals"in this._unsupportedFeatures&&(a.invalidateAccidentals(),a.cleanUpAccidentals()),"beams"in this._unsupportedFeatures&&a.defaultBeaming(),a.removeEmptyVoices(),a.addRests(!0),a.defaultTransposableSpans(),a.convertDanglingSlursToTies(),a.cleanUpRestPositions(),a.calculateDerived()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"cleanUpTitle",value:function(){if(this._score.title&&this.options.breakUpTitle){var t=this._score.title.split("\n");!this._score.subtitle&&t.length>1&&(this._score.title=A.unknownToString(t.shift()),this._score.subtitle=t.join("\n"))}}},{key:"cleanUpScore",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._score.staves[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,Rl);this.cleanUpStaff(s)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this.cleanUpTitle()}},{key:"checkNotePositions",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t.voices[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Kl);if(a.voiceNumber!=Kl.NON_METRICAL_VOICE_NUMBER){var l=null,u=[],h=!0,c=!1,d=void 0;try{for(var f,y=a.elements[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;A.is(g,Sn)&&(null==l||A.is(l,Sn)&&A.unknownToType(l,Sn).grace||!(g.rhythmPosition<=l.rhythmPosition)||(this.appendError("Non-monotonic element position",A.numberToString(g.rhythmPosition+" after position "+l.rhythmPosition+" in "+t.path)),u.push(g)),(g.rhythmPosition<0||g.rhythmPosition+g.rhythmDuration>t.duration)&&(this.appendError("Invalid element position",A.numberToString(g.rhythmPosition+" in "+t.path)),u.push(g)),l=g),A.is(g,Xl)&&(A.unknownToType(g,Xl).validTuplet||(this.appendError("Incomplete tuplet",A.numberToString(g.position+" in "+t.path)),new Nu(A.unknownToType(g,Xl)).addRests()))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}for(var p=0;p<u.length;p++){var m=u[p];g=A.unknownToType(m,ue),t.removeElement(g)}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"parseClefs",value:function(t,e,i,n){var r=!0,o=!1,s=void 0;try{for(var a,l=t.list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(A.numberToUint(u.attribute("number")?X.parseInt(A.xmllistToString(u.attribute("number")))-1:0)==i){var h,c=this.determinePosition(u.parent().parent(),u.parent().childIndex(),n,A.intToUint(A.intToUint(i+1)));if(c>0||e.index>0)if(0===c&&e.index>0){var d=A.as(e.staff.measures[e.index-1],hl);h=this.parseClef(u,d.duration),d.addElement(h,Kl.NON_METRICAL_VOICE_NUMBER),e.clef=h}else h=this.parseClef(u,c),e.addElement(h,Kl.NON_METRICAL_VOICE_NUMBER)}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"parseClef",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e)return this.defaultClef();var r=e.child("sign").toString(),o=Mn.trebleClef().line,s=t.DEFAULT_CLEF_NOTE;if("-1"==e.child("clef-octave-change")){if("G"==r)return Mn.tenorVoiceClef(i);if("F"==r)return Mn.vocalTenorClef(i)}if("none"==r&&(r="percussion"),t.VALID_CLEF_SIGNS.indexOf(r)<0)return this.defaultClef(i);if("percussion"==r)return null!=n&&(n.part.instrumentUri="percussion/unpitched"),Mn.percussion2Clef(i);if("TAB"==r)return null!=n&&(n.part.barlineBreak=!0,n.index>0&&(n.score.getStaffAt(A.intToUint(n.index-1)).part.barlineBreak=!0)),$l.tabClef(i,n);e.has("line")&&(o=A.numberToUint(X.parseInt(A.xmllistToString(e.child("line")))-1),e.child("sign").toString()in t.CLEF_NOTE_TABLE&&(s=t.CLEF_NOTE_TABLE[e.child("sign")]));var a=new de(kt.pitchFromString(s));return new Mn(i,r,o,a)}},{key:"generateMeasureSkeleton",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=new hl;return e.tempo=new Yl,e.keySignature=new Ga(0,0,!0),e.timeSignature=new zl,e.clef=t||this.defaultClef(),e}},{key:"defaultClef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Mn(e,Mn.G_CLEF_SIGN,1,new de(kt.pitchFromString(t.DEFAULT_CLEF_NOTE)))}},{key:"parseBeams",value:function(t,e,i){var n=!1,r=!0,o=!1,s=void 0;try{for(var a,l=t.child("beam").list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;"begin"!=u&&"continue"!=u||(i.beam=!0),"end"==u&&(n=!0)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}if(0===i.notes.length&&!n&&!i.beam){var h=i.previousNoteSet();null!=h&&(i.beam=h.beam)}if(t.childIndex()<e.children().length()-1){var c=e.children().get(t.childIndex()+1),d=!0,f=!1,y=void 0;try{for(var g,p=c.child("beam").list[Symbol.iterator]();!(d=(g=p.next()).done);d=!0)"backward hook"==(u=g.value)&&(i.beam=!0)}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}}}},{key:"inferLyricsLines",value:function(e,i){var n,r=!0,o=!1,s=void 0;try{for(var a,l=e.descendants("lyric").list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;u.hasOwnProperty("@default-y")&&(n=A.numberToInt(X.parseInt(A.xmllistToString(u.attribute("default-y")))),this.indexOfWithinTolerance(n,i,t.LYRICS_MATCH_TOLERANCE)<0&&i.push(n))}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}if(i.length>0){var h=!0,c=!1,d=void 0;try{for(var f,y=e.descendants("words").list[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;g.hasOwnProperty("@default-y")&&(n=A.numberToInt(X.parseInt(A.xmllistToString(g.attribute("default-y")))))<0&&this.indexOfWithinTolerance(n,i,t.LYRICS_MATCH_TOLERANCE)<0&&i.push(n)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}i.length>1&&i.sort(function(t,e){return t>e?-1:t<e?1:0})}},{key:"parseLyrics",value:function(e,i,n){var r,o=0,s=null,a=!0,l=!1,u=void 0;try{for(var h,c=e.list[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if(n.length>0&&d.hasOwnProperty("@default-y")){var f=X.parseInt(A.xmllistToString(d.attribute("default-y")));o=this.indexOfWithinTolerance(f,n,t.LYRICS_MATCH_TOLERANCE)}else o=A.numberToInt(X.parseInt(A.xmllistToString(d.attribute("number")))-1),o=A.numberToInt(Math.max(0,o));(this.options.optimizeForPVG||this.optimizeForCCLI)&&(s=he.DIRECTION_DOWN),d.hasOwnProperty("@placement")&&"above"==d.attribute("placement").toString()&&(s=he.DIRECTION_UP);var y=!0,g=!1,p=void 0;try{for(var m,v=i.lyrics[Symbol.iterator]();!(y=(m=v.next()).done);y=!0)(r=m.value).line==o&&i.removeLyric(r)}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}var _="";if(this.options.optimizeForPVG&&null!=this._lyricsLinePrefixes[o]){var S=this._lyricsLinePrefixes[o];if(A.is(S,Ca)){var L=A.as(S,Ca);L.measure.index>=i.measure.index-1&&L.text.length<=10?(S=L.text,L.parent.removeChild(L)):S=null}null!=S&&(_=A.unknownToObject(S).toString()+" "),this._lyricsLinePrefixes[o]=null}var k=null,T=null,E=!1,M="",b=!0,w=!1,x=void 0;try{for(var C,N=d.children().list[Symbol.iterator]();!(b=(C=N.next()).done);b=!0){var I=C.value;if("text"==I.name()){var P=I.toString();173==P.charCodeAt(0)&&(P="-"),_+=P}else if("elision"==I.name()){_=_.replace(/\($/,"");var O=I.toString();""===O||" "==O?O=" ":"‿"==O&&(O="_"),_+=O}else"syllabic"==I.name()?(T=I.toString(),null==k&&(k=T)):"extend"==I.name()&&""===(M=I.attribute("type").toString())&&(M="start",E=!0)}}catch(t){w=!0,x=t}finally{try{b||null==N.return||N.return()}finally{if(w)throw x}}if("stop"!=M||""!==_){var Q="begin"==T||"middle"==T,R="middle"==k||"end"==k,D=!Q&&"start"==M;D?this._lyricsExtensions[o]={voiceNumber:i.voiceNumber,type:"extend",requireTieOrSlur:o>0||this._melismaCount>0||E,direction:s}:Q&&i.tied?this._lyricsExtensions[o]={voiceNumber:i.voiceNumber,type:"continued"}:this._lyricsExtensions[o]=null,r=new ul(_,o,Q,D,R,s),this.parseColor(d,r),i.addLyric(r)}else this._lyricsExtensions[o]=null,r=new ul("",o,!1,!0,!1,s),i.addLyric(r)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}},{key:"measureDuration",value:function(t,e){var i=0,n=0,r=!0,o=!1,s=void 0;try{for(var a,l=t.children().list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;u.has("duration")&&("backup"==u.name()?i-=this.parseDuration(u,e,!0):"forward"==u.name()?i+=this.parseDuration(u,e,!0):u.has("chord")||u.has("grace")||(i+=this.parseDuration(u,e,!0),n=Math.max(n,i)))}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"parseAllArticulations",value:function(t,e,i,n,r){if(this.parseArticulations(t.child("articulations").children(),e,r),this.parseArticulations(t.child("technical").children(),e),this.parseArticulations(t.child("fermata"),e),t.has("dynamics")){var o="";t.child("dynamics").hasOwnProperty("@placement")&&(o=t.child("dynamics").attribute("placement").toString());var s=this.parsePositioning(t.child("dynamics").get(0),n,o,i.staff);this.parseDynamics(t.child("dynamics").children(),i,n,s)}}},{key:"parseArticulations",value:function(e,i,n){var r=!0,o=!1,s=void 0;try{for(var a,l=e.list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(u.name()in t.ARTICULATION_TABLE)i.addArticulation(t.ARTICULATION_TABLE[u.name()]);else if(u.name()in t.EFFECT_TABLE){var h=t.EFFECT_TABLE[u.name()],c=new xn(h,xn.defaultAscent(h),xn.defaultShift(h));t.PRE_EFFECT_TYPES.indexOf(h)<0?n.addPostEffect(c):n.addPreEffect(c)}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"parseArpeggiate",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;"up"==a.attribute("direction").toString()?e.arpeggio=Sn.UP_ARPEGGIO:"down"==a.attribute("direction").toString()?e.arpeggio=Sn.DOWN_ARPEGGIO:null==e.arpeggio&&(e.arpeggio=Sn.NORMAL_ARPEGGIO)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"parseDynamics",value:function(t,e,i,n){var r=!0,o=!1,s=void 0;try{for(var a,l=t.list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=new Ra(i,A.qnameToString(u.name()),n.y);h.dx=n.x,e.addElement(h,Kl.NON_METRICAL_VOICE_NUMBER)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"parseChordSymbols",value:function(e,i,n){var r="",o=0;o=0,r=this.mapPitchClassString(e.child("root").child("root-step").toString(),A.numberToInt(X.parseInt(e.child("root").child("root-alter").toString())));var s=!1;if(!e.child("root").child("root-step").has("@enclosure")||"rectangle"!=e.child("root").child("root-step").attribute("enclosure")&&"square"!=e.child("root").child("root-step").attribute("enclosure")||(s=!0),e.has("kind")&&e.child("kind").attribute("text").toString().length>0)"none"==e.child("kind").toString()?r=e.child("kind").attribute("text").toString():r+=e.child("kind").attribute("text").toString();else{if(e.has("kind")){var a=e.child("kind").toString();a in t.CHORD_TABLE?r+=t.CHORD_TABLE[a]:r+=a,"yes"==e.child("kind").child("@use-symbols").toString()&&(r=(r=r.replace(/aug/gi,"+")).replace(/dim/gi,"o"))}e.child("root").has("bass-step")&&(r+="/"+e.child("root").child("bass-step"))}e.has("degree")&&(r+=this.parseDegrees(e.child("degree"),"yes"==e.child("kind").child("@parentheses-degrees").toString(),e.child("kind").toString())),e.has("bass")&&(r+="/"+this.mapPitchClassString(e.child("bass").child("bass-step").toString(),A.numberToInt(X.parseInt(e.child("bass").child("bass-alter").toString())))),o=this.determinePosition(e.parent(),e.childIndex(),n);var l,u=this.parsePositioning(e,o,e.attribute("placement").toString(),i.staff),h=0;if(e.has("offset")){var c=X.parseInt(A.xmllistToString(e.child("offset")))/n*t.DIVISIONS_PER_QUARTER;Math.abs(c)>t.CHORD_OFFSET_THRESHOLD?o+=c:h=c}if(e.has("frame")){(l=new Da).strings=A.xmllistToInt(e.child("frame").child("frame-strings")),l.frets=A.xmllistToInt(e.child("frame").child("frame-frets")),e.child("frame").has("first-fret")&&(l.firstFret=A.xmllistToInt(e.child("frame").child("first-fret")),l.firstFretLocation=A.xmllistToString(e.child("frame").child("first-fret").attribute("location")),l.firstFretText=A.xmllistToString(e.child("frame").child("first-fret").attribute("text")));var d=!0,f=!1,y=void 0;try{for(var g,p=e.child("frame").child("frame-note").list[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value,v=A.stringToInt(m.child("string").get(0).toString());v--;var _=A.stringToInt(m.child("fret").get(0).toString()),S=new Fa;S.string=v,S.fret=_,m.has("fingering")&&(S.fingering=m.child("fingering").get(0).toString()),m.has("barre")&&(S.hasBarre=!0,S.barre=m.child("barre").get(0).attribute("type").toString()),l.notes.push(S)}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}var L=this.parsePositioning(e.child("frame").get(0),o,e.child("frame").attribute("placement").toString(),i.staff);0!==L.x&&(u.x=L.x),0!==L.y&&(u.y=L.y)}var k=new Aa(o,r);null!=l&&(k.fretboard=l),k.dx=u.x+h,k.dy=u.y,k.textbox=s,i.addElement(k,Kl.NON_METRICAL_VOICE_NUMBER)}},{key:"parseDegrees",value:function(e,i,n){var r=[],o=!1,s=!0,a=!1,l=void 0;try{for(var u,h=e.list[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;if("no"!=c.child("@print-object").toString()){var d="";1==A.xmllistToNumber(c.child("degree-alter"))?d="#":-1==A.xmllistToNumber(c.child("degree-alter"))&&(d="b");var f=c.child("degree-type").toString();"subtract"==f?(d=(this.options.importStyle==pn.STYLE_YCJ?"omit":"no")+d,o=!0):"add"==f&&null!=t.CHORD_TRIAD_TABLE[n]?(d="add"+d,o=!0):"add"==f&&(i=!0),d+=c.child("degree-value").toString(),r.push(d)}}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}return 0===r.length?"":o?"("+r.join(",")+")":i?"("+r.reverse().join(" ")+")":r.join("")}},{key:"determinePosition",value:function(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=0,r=0,o=!0,s=!1,a=void 0;try{for(var l,u=t.children().list[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if("note"==h.name()&&h.has("duration")&&!h.has("grace")&&!h.has("chord")||"forward"==h.name()?r+=this.parseDuration(h,i,!0):"backup"==h.name()&&(r-=this.parseDuration(h,i,!0)),n==e)return r<0?0:A.numberToUint(Math.round(r));n++}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return 0}},{key:"explicitRestY",value:function(t,e,i,n){try{var r=new de(kt.pitchFromString(n.child("display-step").toString()+n.child("display-octave").toString()));r.pitch=r.pitch.transpose(-12*i.octaveShift);var o=e.getPitchLine(r);t.dy=o-e.getRestLine(t.value),t.explicitRestY=!0}catch(t){if(!A.is(t,Error))throw t;A.as(t,Error)}}},{key:"parseTuplet",value:function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=i=t.child("time-modification").has("normal-type")?A.xmllistToString(t.child("time-modification").child("normal-type")):A.xmllistToString(t.child("type")),o=A.stringToUint(t.child("time-modification").child("normal-notes").toString()),s=A.stringToUint(t.child("time-modification").child("actual-notes").toString());e.has("tuplet-actual")&&(s=A.xmllistToUint(e.child("tuplet-actual").child("tuplet-number")),r=A.xmllistToString(e.child("tuplet-actual").child("tuplet-type"))),e.has("tuplet-normal")&&(o=A.xmllistToUint(e.child("tuplet-normal").child("tuplet-number")),i=A.xmllistToString(e.child("tuplet-normal").child("tuplet-type")));var a=new Xl(A.numberToInt(n),o,A.intToUint(this.mapDurationValue(i)),s,A.intToUint(this.mapDurationValue(r)));if(e.has("@bracket")&&(a.showBracket="yes"==e.child("@bracket").toString()),e.has("@show-number"))switch(e.child("@show-number").toString()){case"both":a.showNormalNumber=!0,a.showActualNumber=!0;break;case"none":a.showNormalNumber=!1,a.showActualNumber=!1;break;case"actual":default:a.showNormalNumber=!1,a.showActualNumber=!0}return a}},{key:"createBlockColumn",value:function(t,e){return new xa(t,e)}},{key:"stylesForSpanishSubtitle",value:function(e){return t.STYLES_FOR_SPANISH_SUBTITLE[e]}},{key:"blacklistedStylesForSubtitleCustomization",value:function(e){return t.BLACKLISTED_STYLES_FOR_SUBTITLE_CUSTOMIZATION[e]}},{key:"parseDirection",value:function(e,i,n,r,o,s,a){var l=0;e.has("staff")&&(l=A.numberToUint(X.parseInt(e.child("staff").toString())-1)),0===s&&(s=this.determinePosition(e.parent(),e.childIndex(),i,A.intToUint(l+1)));var u="",h=null,c=null,d=null,f=e.child("direction-type").children(),y=e.child("direction-type").processingInstructions();if(y.length()>0&&y.toXMLString().toLowerCase().indexOf("chord symbol")>=0&&f.length()>=2){var g=f.get(1),p=new Aa(s,g.toString());n.addElement(p,Kl.NON_METRICAL_VOICE_NUMBER)}else{for(var m=0;m<f.length();m++){var v=f.get(m),_=A.qnameToString(v.name()),S=v.toString(),L=e.attribute("placement")==t.PLACEMENT_ABOVE&&"words"==_||"rehearsal"==_?Ca.PERFORMANCE_TYPE:Ca.EXPRESSION_TYPE,k=null;m<f.length()-1&&(k=A.qnameToString(f.get(m+1).name())),L==Ca.PERFORMANCE_TYPE&&!e.has("staff")&&o>1&&"rehearsal"!=_&&(n=n.systemMeasure);var T="";e.hasOwnProperty("@placement")&&(T=e.attribute("placement").toString());var E=s;(e.allDescendants().has("offset")||e.has("offset"))&&(E=Math.max(0,E+e.descendants("offset").get(0)/i*t.DIVISIONS_PER_QUARTER));var M=this.parsePositioning(v,E,T,n.staff,L),b="yes"==e.attribute("directive");b&&(M.x+=this._score.staffMetrics.tempoFirstMeasureXOffset),"segno"!=_&&"coda"!=_||!(""!==u||t.WORD_LIKE_DIRECTIONS.indexOf(k)>=0)||(S="{"+_+"}",_="words",L=Ca.PERFORMANCE_TYPE);var w="rehearsal"==_||"rectangle"==v.attribute("enclosure")||"square"==v.attribute("enclosure");switch(_){case"rehearsal":case"words":if(t.WORD_LIKE_DIRECTIONS.indexOf(k)>=0){""===u&&(h=M),u+=S;continue}var x;if(""!==u?(null!=h&&(M=h),x=u+" "+S):x=S,u="",h=null,""===(x=this.normalizeScoreString(x)))continue;var C=this._measureIdx<=1&&(x.match(/ by /i)||x.match(/ por /i)&&this.stylesForSpanishSubtitle(this.options.importStyle)),N=this._measureIdx<=1&&this.options.optimizeForPVG&&!this.blacklistedStylesForSubtitleCustomization(this.options.importStyle)&&!(b||w)&&n.staff.index<=1&&L==Ca.PERFORMANCE_TYPE&&x.indexOf(" ")>=0&&x.indexOf("{")<0;if(this.options.putDetectedCreditsInComposer){var I=null!=this._score.composer&&this._score.composer.length>0;if(C&&!I){this._score.composer=x;continue}if(C||N){this._score.subtitle=""===this._score.subtitle?x:this._score.subtitle+"\n"+x;continue}}else if(C||N){this._score.subtitle=""===this._score.subtitle?x:this._score.subtitle+"\n"+x;continue}if(0!==this._score.staffMetrics.swingDelta&&null==d&&(d=this.inferMeterMap(x)),this.options.importBlock&&this._measureIdx==this._numMeasures-1&&!b&&!w&&(L==Ca.PERFORMANCE_TYPE||L==Ca.EXPRESSION_TYPE)&&x.indexOf("{")<0){var P=x.split(" ").length-1,O=!(!this.options.importBlockNumbers||!x.match(/^\s*\d+\s*\.\s*$/)&&!x.match(/^\s*Rap\s*\d+\s*\:\s*$/));if(P>=t.TEXT_BLOCK_MIN_NUMBER_OF_WORDS||O||-1!=t.TEXTBLOCK_SPECIAL_WORDS.indexOf(x)){a.push({text:x,isBlockHeader:O,x:M.x,y:M.y,index:a.length});continue}}var Q=-1;if(this.options.optimizeForPVG){if((Q=this.lyricLineForElement(v))>=0&&("{"==x||"}"==x))continue;if(x=(x=x.replace(/\$/g,"{segno}")).replace(/\u00D8/g,"{coda}"),Q<0&&x.match(/^[0-9\(\)\n ]*$/)&&x.match(/[0-9]/)&&!w){M=this.doParsePositioning("fingering",v,E,null,n.staff);var R=new Aa(E,x);R.dx=M.x,R.dy=M.y,n.addElement(R,Kl.NON_METRICAL_VOICE_NUMBER);continue}}var D=null;switch(L){case Ca.PERFORMANCE_TYPE:var F=new bl(E,x,M.y);"right"==v.attribute("justify")?(F.justify=Ca.JUSTIFY_RIGHT,M.x-=1):this.options.optimizeForPVG&&s>=.75*n.duration&&E<=s&&(F.rhythmPosition=A.numberToUint(n.duration),F.justify=Ca.JUSTIFY_RIGHT,M.x-=1),F.dx=M.x,F.textbox=w,"rehearsal"==_?null==this._measureIndicesWithRehearsalMarkings[n.index]&&(n.systemMeasure.addElement(F,Kl.NON_METRICAL_VOICE_NUMBER),this._measureIndicesWithRehearsalMarkings[n.index]=!0):n.addElement(F,Kl.NON_METRICAL_VOICE_NUMBER),D=F;break;case Ca.EXPRESSION_TYPE:var U=new Ra(E,x,M.y);n.addElement(U,Kl.NON_METRICAL_VOICE_NUMBER),U.dx=M.x,U.textbox=w,D=U}Q>=0&&D&&D.text.length<10&&(this._lyricsLinePrefixes[Q]=D);break;case"dynamics":this.parseDynamics(v.children(),n,E,M);break;case"wedge":this.parseHairpins(v,n,r,i,s,M);break;case"octave-shift":case"dashes":case"bracket":case"pedal":u?(this.parseLineNotation(v,n,r,i,s,M,u),u=""):this.parseLineNotation(v,n,r,i,s,M);break;case"metronome":c=this.parseMetronome(v,M);break;case"other-direction":switch(v.toString().toLowerCase().replace(/[ ,.]/g,"")){case"segno":case"smallds":this.parseSegno(v,n,E,M);break;case"coda":case"smallcoda":this.parseCoda(n,E,M);break;case"tocoda":var V=new bl(E,"To Coda {coda}",M.y);V.dx=M.x,V.rhythmPosition=A.numberToUint(n.duration),V.justify=Ca.JUSTIFY_RIGHT,n.systemMeasure.addElement(V,Kl.NON_METRICAL_VOICE_NUMBER)}break;case"segno":if(this.options.optimizeForPVG&&this.lyricLineForElement(v)>=0)continue;this.parseSegno(v,n,E,M);break;case"coda":this.parseCoda(n,E,M)}}if(null==c){var B=!0,H=!1,$=void 0;try{for(var G,Y=e.child("sound").list[Symbol.iterator]();!(B=(G=Y.next()).done);B=!0){var z=G.value;z.hasOwnProperty("@tempo")&&(c=new Yl(A.intToUint(mn.QUARTER),0,A.numberToUint(X.parseInt(A.xmllistToString(z.attribute("tempo"))))))}}catch(t){H=!0,$=t}finally{try{B||null==Y.return||Y.return()}finally{if(H)throw $}}}null!=d&&(null==c&&(c=A.unknownToType(this._score.getSystemStaffMeasureAt(n.index).tempo.clone(),Yl)),c.meterMap=d),null!=c&&this._score.setTempoAtMeasure(c,A.intToUint(n.index))}}},{key:"parsePositioning",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this.doParsePositioning(t.name().toString(),t,e,i,n,r)}},{key:"doParsePositioning",value:function(e,i,n,r,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!1,l=this._score.staffMetrics.expressionTextPadding.x,u=0,h=!0,c=!1,d=!0,f=t.STAFF_ABOVE_OFFSET,y=t.STAFF_BELOW_OFFSET,g=0,p=0,m=i.hasOwnProperty("@relative-y");switch(e){case"harmony":case"fingering":l=this._score.staffMetrics.chordSymbolPadding.x,u=this._score.staffMetrics.chordSymbolPadding.y,a=!0;break;case"frame":l=this._score.staffMetrics.chordFramePadding.x,u=this._score.staffMetrics.chordFramePadding.y,a=!0;break;case"segno":case"coda":case"other-direction":l=-this._score.staffMetrics.symbolScale,u=-(this._score.staffMetrics.symbolOffset-1.5*this._score.staffMetrics.symbolScale),g=l,m||(f=he.PLACEMENT_ABOVE-u,y=he.PLACEMENT_BELOW-u+o.type.height),a=!0;break;case"wedge":l=this._score.staffMetrics.hairpinPadding.x;break;case"pedal":this.options.optimizeForPVG&&(g=1);break;case"dynamics":d=!1,l=this._score.staffMetrics.expressionTextPadding.x,u=this._score.staffMetrics.expressionTextPadding.y;break;case"lyric":l=this._score.staffMetrics.lyricsPadding.x,u=this._score.staffMetrics.lyricsPadding.y;break;case"words":case"rehearsal":h=this._options.useTextPositions,s==Ca.EXPRESSION_TYPE?(l=this._score.staffMetrics.expressionTextPadding.x,u=this._score.staffMetrics.expressionTextPadding.y):(l=this._score.staffMetrics.performanceTextPadding.x,u=this._score.staffMetrics.performanceTextPadding.y,m||(f=he.PLACEMENT_ABOVE-u,y=he.PLACEMENT_BELOW-u+o.type.height),a=!0);break;case"ending":f=this._score.staffMetrics.lineNotationDistanceAboveStaff,y=this._score.staffMetrics.lineNotationDistanceBelowStaff;break;case"metronome":a=!0,u=-this._score.staffMetrics.tempoTextOffset,f=f=he.PLACEMENT_ABOVE-u;break;case"slur":case"trill-mark":case"wavy-line":c=!0;default:m||(f=he.PLACEMENT_ABOVE-u-o.type.height,y=he.PLACEMENT_BELOW-u)}var v=A.unknownToNumber(o.isSystemStaff?this._staffScales[0]:this._staffScales[o.index]);return h&&(c||d&&0===n)&&i.hasOwnProperty("@default-x")&&(g=X.parseInt(A.xmllistToString(i.attribute("default-x")))/(10*v)-l),h&&i.hasOwnProperty("@default-y")?(p=X.parseInt(A.xmllistToString(i.attribute("default-y")))/(10*v)+u,a||(p+=o.type.height)):r==t.PLACEMENT_ABOVE?p=a?u+f:u+o.type.height+f:r==t.PLACEMENT_BELOW&&(p=a?u-o.type.height+y:u+y),h&&m&&(p+=X.parseInt(A.xmllistToString(i.attribute("relative-y")))/(10*v)),h&&i.hasOwnProperty("@relative-x")&&(g+=X.parseInt(A.xmllistToString(i.attribute("relative-x")))/(10*v)),new If(g,p)}},{key:"mapDurationValue",value:function(e){var i=0;return e in t.DURATION_VALUE_TABLE&&(i=t.DURATION_VALUE_TABLE[e]),i>mn.MAX_NOTATED_VALUE&&(i=mn.MAX_NOTATED_VALUE),i}},{key:"parseDuration",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0,o=e.has("type")?e.child("type").toString():null;if(null==o||"whole"==o&&0===e.child("dot").length()&&e.has("duration"))e.has("duration")&&(r=X.parseInt(e.child("duration").toString())/i*t.DIVISIONS_PER_QUARTER,e.has("time-modification")&&(r/=this.tupletTimeModification(e.child("time-modification").get(0))));else{r=mn.valueToDuration(this.mapDurationValue(o.toString()));var s=e.child("dot").length();1==s?r*=1.5:2==s&&(r*=1.75)}return n&&e.has("time-modification")&&(r*=this.tupletTimeModification(e.child("time-modification").get(0))),r}},{key:"tupletTimeModification",value:function(t){return A.numberToUint(X.parseInt(t.child("normal-notes").toString()))/A.numberToUint(X.parseInt(t.child("actual-notes").toString()))}},{key:"parseSpanKey",value:function(t){var e=0;if(t.query(function(t){return t.attribute("number")}).length()>0){var i=X.parseInt(A.xmllistToString(t.attribute("number")));e=A.numberToUint(X.isNaN(i)?0:i-1)}return t.name().toString()+e}},{key:"parseHairpins",value:function(t,e,i,n,r,o){var s=!0,a=!1,l=void 0;try{for(var u,h=t.query(function(t){return"crescendo"==t.attribute("type")||"diminuendo"==t.attribute("type")}).list[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;this.parseSpanStart(c,i,Ua.HAIRPIN_TYPE,r,!0,e,n,null,o,t.attribute("type").toString())}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}var d=!0,f=!1,y=void 0;try{for(var g,p=t.query(function(t){return"stop"==t.attribute("type")}).list[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value;this.parseSpanStop(m,i,Ua.HAIRPIN_TYPE,r,e,n,null,o)}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}}},{key:"parseSlurs",value:function(t,e,i,n,r,o,s,a){var l=!0,u=!1,h=void 0;try{for(var c,d=t.list[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;if("start"==f.attribute("type")){var y=this.parsePositioning(f,n,f.attribute("placement").toString(),s.staff);this.parseSpanStart(f,i,Ua.SLUR_TYPE,n,r,s,o,e,y),1==a&&this._melismaCount++}else if("stop"==f.attribute("type")){var g=this.parsePositioning(f,n,f.attribute("placement").toString(),s.staff);this.parseSpanStop(f,i,Ua.SLUR_TYPE,n,s,o,e,g),1==a&&this._melismaCount--}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}},{key:"parseLineNotation",value:function(t,e,i,n,r,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",a=A.qnameToString(t.name()),l="",u=null,h=0;if(t.hasOwnProperty("@line-type")){switch(t.child("@line-type").toString()){case"dashed":case"dotted":l=qa.TYPE_DASHED;break;case"wavy":l=qa.TYPE_VIBRATO;break;case"solid":l=qa.TYPE_SOLID}t.hasOwnProperty("@line-end")&&("down"==(u=t.child("@line-end").toString())?l=qa.TYPE_SOLID_BRACKET_DOWN:"both"==u?l=qa.TYPE_SOLID_BRACKET_MIDDLE:"up"==u&&(l=qa.TYPE_SOLID_BRACKET_UP)),t.hasOwnProperty("@end-length")&&(h=A.stringToNumber(t.child("@end-length").toString())/10)}switch(a){case"dashes":case"bracket":""===l&&(l=qa.mapStartingTextToType(s));break;case"pedal":l=qa.TYPE_PEDAL;break;case"octave-shift":l=t.hasOwnProperty("@type")&&"down"==t.attribute("type")?"15"==t.attribute("size")?qa.TYPE_TWO_OCTAVES_UP:qa.TYPE_OCTAVE_UP:qa.TYPE_OCTAVE_DOWN}if(t.query(function(t){return"stop"==t.attribute("type")}).length()>0){var c=this.parseSpanStop(t,i,Ua.LINE_TYPE,r,e,n,null,o);if(A.is(c,qa)){var d=A.unknownToType(c,qa);t.hasOwnProperty("@line-end")&&(u=t.child("@line-end").toString(),d.type==qa.TYPE_DASHED&&("down"==u?d.type=qa.TYPE_DASHED_FINAL_DOWN:"both"==u?d.type=qa.TYPE_DASHED_FINAL_MIDDLE:"up"==u&&(d.type=qa.TYPE_DASHED_FINAL_UP)))}}else this.parseSpanStart(t,i,Ua.LINE_TYPE,r,!0,e,n,null,o,l,s,h)}},{key:"parseOrnaments",value:function(e,i,n,r,o,s,a){var l,u,h=!0,c=!1,d=void 0;try{for(var f,y=e.children().list[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.qnameToString(g.name());if("tremolo"==p&&(a.tremolo=A.unknownToInt(g),a.tremolo>6?a.tremolo=6:a.tremolo<0&&(a.tremolo=0)),p in t.ARTICULATION_ORNAMENT_TABLE)a.addArticulation(t.ARTICULATION_ORNAMENT_TABLE[p]);else if(!(t.LINE_NOTATION_ORNAMENT_TYPES.indexOf(p)<0)){var m=qa.TYPE_VIBRATO;if("trill-mark"!=p)if(g.hasOwnProperty("@type")&&g.query(function(t){return"stop"==t.attribute("type")}).length()>0)this.parseSpanStop(g,n,Ua.LINE_TYPE,r,s,o,null);else{if(null!=l&&"wavy-line"==p){this.parseSpanStart(g,n,Ua.LINE_TYPE,r,!1,s,o,null,u,qa.TYPE_TRILL,""),l=null;continue}var v=this.parseOrnamentPositioning(g,r,s);this.parseSpanStart(g,n,Ua.LINE_TYPE,r,!0,s,o,null,v,m,"")}else l=g,u=this.parseOrnamentPositioning(g,r,s)}}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}null!=l&&(this.parseSpanStart(l,n,Ua.LINE_TYPE,r,!1,s,o,null,u,qa.TYPE_TRILL,""),this.parseSpanStop(l,n,Ua.LINE_TYPE,r,s,o,null))}},{key:"parseOrnamentPositioning",value:function(t,e,i){var n="above";return t.hasOwnProperty("@placement")&&(n=t.attribute("placement").toString()),this.parsePositioning(t,e,n,i.staff)}},{key:"parseSpanStart",value:function(e,i,n,r,o,s,a){var l,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"",d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=this.parseSpanKey(e),g=this.cleanupPosition(r),p=e.parent().parent();switch(p.has("offset")&&(g+=X.parseInt(A.xmllistToString(p.child("offset")))/a*t.DIVISIONS_PER_QUARTER),n){case Ua.SLUR_TYPE:if(l=new Ol(g,o,t.DEFAULT_NOTATION_SPAN),null!=h&&(l.dx=h.x,l.dy=h.y),this.options.useSlurDirections){var m=A.xmllistToString(e.child("@bezier-y"));if(""!==m)l.defaultDirection=A.stringToNumber(m)<0?he.DIRECTION_DOWN:he.DIRECTION_UP;else{var v=A.xmllistToString(e.attribute("placement"));"above"==v?l.defaultDirection=he.DIRECTION_UP:"below"==v&&(l.defaultDirection=he.DIRECTION_DOWN)}}else l.dy!=he.PLACEMENT_ABOVE&&l.dy!=he.PLACEMENT_BELOW||(l.dy=0);l.requiresDefaultInfo=!0,this.addElementToContext(l,u);break;case Ua.HAIRPIN_TYPE:l=new Va(g,!0,t.DEFAULT_NOTATION_SPAN,c),null!=h&&(l.dx=h.x,l.dy=h.y),s.addElement(l,Kl.NON_METRICAL_VOICE_NUMBER);break;case Ua.LINE_TYPE:l=c==qa.TYPE_TRILL?new Wl(g,t.DEFAULT_NOTATION_SPAN,c,0,0,d):[ll.TYPE_INITIAL,ll.TYPE_FINAL].includes(c)?new ll(g,t.DEFAULT_NOTATION_SPAN,c,0,d,this._score.staffMetrics.repeatEndingBracketHeight,this._score.staffMetrics.repeatEndingBracketBold):new qa(g,o,t.DEFAULT_NOTATION_SPAN,c,0,0,d,f),null!=h&&(l.dx=h.x,l.dy=h.y,A.is(l,Wl)&&!this.isStaffRelative(l.dy)&&(l.dy+=.5)),c!=ll.TYPE_FINAL&&c!=ll.TYPE_INITIAL||this.isStaffRelative(l.dy)||(l.dy+=1),e.hasOwnProperty("@end-length")&&(A.unknownToType(l,qa).bracketLength=A.stringToNumber(e.child("@end-length").toString())/10),s.addElement(l,Kl.NON_METRICAL_VOICE_NUMBER),c==qa.TYPE_OCTAVE_DOWN?this._staffIndexOctaveShifts[l.measure.staff.index]=1:c==qa.TYPE_OCTAVE_UP?this._staffIndexOctaveShifts[l.measure.staff.index]=-1:c==qa.TYPE_TWO_OCTAVES_UP&&(this._staffIndexOctaveShifts[l.measure.staff.index]=-2)}return i[y]=l,l}},{key:"parseSpanStop",value:function(e,i,n,r,o,s){arguments.length>6&&void 0!==arguments[6]&&arguments[6];var a,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=this.parseSpanKey(e);if(u in i){(a=A.as(i[u],Ua)).span=this._score.rangeDuration(a.measurePosition,new gl(A.intToUint(o.index),this._lastElementPosition)),l&&(a.endx=l.x,n==Ua.LINE_TYPE&&"bracket"!=e.name()||!e.hasOwnProperty("@default-y")||(a.ascent=l.y-a.dy));var h=e.parent().parent();if(h.has("offset")&&(a.span+=X.parseInt(A.xmllistToString(h.child("offset")))/s*t.DIVISIONS_PER_QUARTER),a.span=Math.ceil(a.span),delete i[u],A.is(a,qa)){var c=A.as(a,qa),d=c.type;d!=qa.TYPE_OCTAVE_DOWN&&d!=qa.TYPE_OCTAVE_UP&&d!=qa.TYPE_TWO_OCTAVES_UP||delete this._staffIndexOctaveShifts[c.measure.staff.index]}}return a}},{key:"parsePartDetails",value:function(t){var e=A.xmllistToString(t.attribute("id")),i=t.child("measure").child("attributes"),n=El.createPart();if(i.child("transpose").has("chromatic")){var r=A.numberToInt(X.parseInt(i.child("transpose").child("chromatic").toString()));if(i.child("transpose").has("diatonic")){var o=A.numberToInt(X.parseInt(i.child("transpose").child("diatonic").toString()));n.transpositionInterval=new $a(-o,-r)}else n.transposition=r}if(i.child("transpose").has("octave-change")){var s=A.numberToInt(X.parseInt(i.child("transpose").child("octave-change").toString()));0===n.transposition?n.octaveShift=-1*s:null!=n.transpositionInterval&&(n.transpositionInterval=n.transpositionInterval.add(new $a(-7*s,-12*s)))}var a=this._musicXml.child("part-list").child("score-part").query(function(t){return t.attribute("id")==e});if(a.has("part-name")&&(n.name=cf.normalizeWhitespace(a.child("part-name").toString()),""!==n.name&&"no"!=a.child("part-name").child("@print-object").toString()&&(this._score.staffMetrics.showPartNames=!0)),a.has("part-abbreviation")&&(n.shortName=cf.normalizeWhitespace(a.child("part-abbreviation").toString()),""!==n.shortName&&"no"!=a.child("part-abbreviation").child("@print-object").toString()&&(this._score.staffMetrics.showPartNames=!0)),a.has("score-instrument")){var l=a.child("score-instrument").get(0);if(l.child("instrument-sound").length()>0){var u=l.child("instrument-sound").toString(),h=(new fn).translateXmlInstrumentToNoteflight(u);n.instrumentUri=h}}return n.instrumentUri||(n.instrumentUri=fn._NF_LAST_RESORT),n}},{key:"parseTechnicals",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t.list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a.has("string")&&(e.stringIndex=A.numberToInt(A.xmllistToNumber(a.child("string"))-1)),a.has("fret")&&(e.fret=A.numberToInt(A.xmllistToNumber(a.child("fret")))),a.has("bend")?e.liaison=de.BEND_LIAISON:a.has("pre-bend")&&(e.liaison=de.PRE_BEND_LIAISON),a.has("fingering")){var l=this.parsePositioning(a.child("fingering").get(0),e.position,null,e.noteSet.measure.staff),u=[],h=!0,c=!1,d=void 0;try{for(var f,y=a.child("fingering").list[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=0;g.hasOwnProperty("@default-y")&&(p=X.parseInt(A.xmllistToString(g.attribute("default-y")))),u.push(new w(p,g.text().toString()))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}u.sort(function(t,e){return t.defaultY>e.defaultY?-1:t.defaultY<e.defaultY?1:0});for(var m=[],v=0;v<u.length;v++){var _=u[v];m.push(_.text)}var S=new Aa(e.position,m.join(" "));S.dx=l.x,S.dy=l.y,e.noteSet.grace&&(S.dx-=this._score.staffMetrics.initialGracePadding.width-this._score.staffMetrics.initialGracePadding.x+this._score.staffMetrics.notePadding.width),e.noteSet.measure.addElement(S,Kl.NON_METRICAL_VOICE_NUMBER)}a.child("hammer-on").query(function(t){return"start"==t.attribute("type")}).length()>0&&this.applySlurArticulation(Ol.HAMMER_ON_ARTICULATION),a.child("pull-off").query(function(t){return"start"==t.attribute("type")}).length()>0&&this.applySlurArticulation(Ol.PULL_OFF_ARTICULATION)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"applySlurArticulation",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=xt.objectForOfSource(this._spanNotations)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Ua);A.is(a,Ol)&&(A.unknownToType(a,Ol).slurArticulation=t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"parseLiaisons",value:function(t,e,i){var n=!0,r=!1,o=void 0;try{for(var s,a=t.query(function(t){return"start"==t.attribute("type")}).list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){s.value;e.liaison=i}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"parseStaffDetails",value:function(t,e,i,n){if(!t.hasOwnProperty("@number")||A.xmllistToNumber(t.attribute("number"))==i+1){if(t.hasOwnProperty("@print-object")){var r=t.child("@print-object").toString().toLowerCase();"no"==r?this._canHideStaff=!0:"yes"==r&&(this._canHideStaff=!1)}if(n){var o=1;if(t.has("staff-lines")&&(o=A.numberToUint(X.parseInt(t.child("staff-lines").toString())),e.type=Ul.createTypeFromLineCount(o)),t.has("staff-tuning")){for(var s=[],a=1;a<=o;a++){var l=t.child("staff-tuning").query(function(t){return t.attribute("line")==a}).get(0),u=l.child("tuning-step").toString()+l.child("tuning-octave").toString();s.push(u)}var h=A.numberToInt(X.parseInt(t.child("capo").toString())),c=new Fl;c.setStaffNotesFromStrings(s,h),e.type.staffTuning=c}if(t.has("staff-size")){var d=X.parseInt(t.child("staff-size").toString())/(100*e.type.lineSpacing);this._staffScales[e.index]=d}}}}},{key:"startsNewSystem",value:function(t){return!!t.has("print")&&("yes"==t.child("print").attribute("new-system")||"yes"==t.child("print").attribute("new-page"))}},{key:"lyricLineForElement",value:function(e){var i=this._lyricsYForMeasure[this._partIdx][this._measureIdx];if(i.length>0&&e.hasOwnProperty("@default-y")){var n=X.parseInt(A.xmllistToString(e.attribute("default-y")));return this.indexOfWithinTolerance(n,i,t.LYRICS_MATCH_TOLERANCE)}return-1}},{key:"indexOfWithinTolerance",value:function(t,e,i){for(var n=-1,r=0;r<e.length;r++){var o=Math.abs(t-e[r]);o<=i&&(n=r,i=o)}return n}},{key:"cleanupPosition",value:function(t){return t<0?0:A.numberToUint(Math.round(t))}},{key:"isStaffRelative",value:function(t){return t==he.PLACEMENT_ABOVE||t==he.PLACEMENT_BELOW}},{key:"addElementToContext",value:function(t,e){if(0===t.rhythmDuration||A.is(t,Ua))return e.addElement(t);for(var i=0,n=A.intToUint(e.timeSignature.meterDuration),r=e.elements.length-1;r>=0;r--){var o=e.getElementAt(r);if(0===o.rhythmDuration||A.is(o,Ua))o.rhythmPosition==t.rhythmPosition&&A.is(t,Ha)&&A.is(o,ae)&&(o.rhythmContext.removeElement(o),A.unknownToType(o,ae).rhythmPosition=0,A.unknownToType(t,Ha).addElementAt(o,0));else{if(o.rhythmDuration==t.rhythmDuration&&o.rhythmPosition==t.rhythmPosition&&A.is(o,Sn)&&0===A.unknownToType(o,Sn).notes.length){e.removeElement(o),i=o.rhythmPosition;break}if(o.rhythmPosition<=t.rhythmPosition){i=A.intToUint(o.rhythmPosition+o.rhythmDuration);break}n=o.rhythmPosition}}return t.rhythmPosition<i||t.rhythmPosition+t.rhythmDuration>n?(this._badNotePositionCount++,this.appendError("Bad position","Note at "+t.rhythmPosition+" in measure "+e.measure.index+" ignored."),!1):(e.addElement(t),!0)}},{key:"setImportStyle",value:function(t){switch(this._score.staffMetrics.style=t,t){case pn.STYLE_CCLI:case pn.STYLE_CCLI_MULTI:case pn.STYLE_CCLI_SINGLE:this._score.staffMetrics.showBarNumbers=!0;break;case pn.STYLE_HLC_EDUCATIONAL_PIANO:this._score.staffMetrics.showBarNumbers=!0,this._options.useSystemBreaks=!0;case pn.STYLE_PVG:case pn.STYLE_HLC_PVG:case pn.STYLE_HLC_ACCORDION:case pn.STYLE_HLC_BIG_NOTE:case pn.STYLE_HLC_CHORAL:case pn.STYLE_HLC_EASY_PIANO:case pn.STYLE_HLC_FAKEBOOK:case pn.STYLE_HLC_GUITAR:case pn.STYLE_HLC_PIANO_SOLO:case pn.STYLE_HLC_UKULELE:this._score.staffMetrics.showTabRhythm=!1;break;case pn.STYLE_MS_PVG:case pn.STYLE_MS_EASY_PIANO:this._score.staffMetrics.showTabRhythm=!1,this._options.silenceHiddenNotes=!0;break;case pn.STYLE_HLC_INSTRUMENTAL_SOLO:this._score.staffMetrics.showPartNames=!0,this._score.transposeParts=!0,this._options.silenceHiddenNotes=!0}}},{key:"options",get:function(){return this._options},set:function(t){this._options=t}},{key:"optimizeForCCLI",get:function(){switch(this.options.importStyle){case pn.STYLE_CCLI:case pn.STYLE_CCLI_MULTI:case pn.STYLE_CCLI_SINGLE:case pn.STYLE_CCLI_MULTI_HANGUL:case pn.STYLE_CCLI_SINGLE_HANGUL:return!0;default:return!1}}},{key:"maxMeasures",set:function(t){this._maxMeasures=this._numMeasures}},{key:"maxParts",set:function(t){this._maxParts=this._numParts}},{key:"maxVoices",set:function(t){this._maxVoices=t}}],[{key:"_staticInitializer",value:function(){t.MS_STYLES[pn.STYLE_MS_PVG]=!0,t.MS_STYLES[pn.STYLE_MS_EASY_PIANO]=!0}},{key:"defaultOptions",get:function(){return t._defaultOptions},set:function(e){t._defaultOptions=e}}]),t}(),In=2<<mn.QUARTER-1,Pn=An.DIVISIONS_PER_QUARTER,On=["bracket","dashes","segno","coda","words"],Qn=["Additional Lyrics"],Rn={},Dn=An.MS_STYLES;Dn[pn.STYLE_CCLI_SINGLE]=!0,Dn[pn.STYLE_CCLI_MULTI]=!0;var Fn={};Fn[pn.STYLE_CCLI_SINGLE]=!0,Fn[pn.STYLE_CCLI_MULTI]=!0;var Un=new yn,Vn={"flat-flat":"doubleFlat","double-flat":"doubleFlat",flat:"flat","natural-flat":"flat",natural:"natural",sharp:"sharp","natural-sharp":"sharp","sharp-sharp":"doubleSharp","double-sharp":"doubleSharp"},Bn={G:"G4",C:"C4",F:"F3"},Hn={"256th":mn.TWO_HUNDRED_FIFTY_SIXTH,"128th":mn.ONE_HUNDRED_TWENTY_EIGHTH,"64th":mn.SIXTY_FOURTH,"32nd":mn.THIRTY_SECOND,"16th":mn.SIXTEENTH,eighth:mn.EIGHTH,quarter:mn.QUARTER,half:mn.HALF,whole:mn.WHOLE,breve:mn.BREVE,longa:mn.LONGA},$n={regular:En.SINGLE,dotted:En.DASHED,dashed:En.DASHED,heavy:En.FINAL,"light-light":En.DOUBLE,"light-heavy":En.FINAL,"heavy-light":En.INITIAL,"heavy-heavy":En.FINAL,tick:En.DASHED,none:En.INVISIBLE},Gn=[Mn.C_CLEF_SIGN,Mn.F_CLEF_SIGN,Mn.G_CLEF_SIGN,Mn.PERCUSSION_CLEF_SIGN,Mn.TAB_CLEF_SIGN.toUpperCase()],Yn={accent:Sn.MARCATO_ARTICULATION,"strong-accent":Sn.MARTELLATO_ARTICULATION,staccato:Sn.STACCATO_ARTICULATION,spiccato:Sn.STACCATO_ARTICULATION,tenuto:Sn.TENUTO_ARTICULATION,staccatissimo:Sn.STACCATISSIMO_ARTICULATION,"open-string":Sn.OPEN_ARTICULATION,stopped:Sn.CLOSED_ARTICULATION,"up-bow":Sn.UP_BOW_ARTICULATION,"down-bow":Sn.DOWN_BOW_ARTICULATION,fermata:Sn.FERMATA_ARTICULATION,"breath-mark":Sn.BREATH_ARTICULATION,caesura:Sn.CAESURA_ARTICULATION,harmonic:Sn.OPEN_ARTICULATION},zn={plop:xn.PLOP,scoop:xn.SCOOP,doit:xn.DOIT,falloff:xn.QUICK_FALL},Wn=[xn.PLOP,xn.SCOOP],Xn={major:"","major-sixth":"6","major-seventh":"maj7","major-ninth":"maj9","major-13th":"maj13","major-minor":"m(maj7)",minor:"m","minor-seventh":"m7","minor-sixth":"m6","minor-ninth":"m9","minor-11th":"m11","minor-13th":"m13",dominant:"7","dominant-ninth":"9","dominant-11th":"11","dominant-13th":"13",diminished:"dim","diminished-seventh":"dim7","half-diminished":"m7b5",augmented:"aug","augmented-seventh":"aug7","suspended-fourth":"sus","suspended-second":"sus2"},Kn={major:"",minor:"m",diminished:"dim",augmented:"aug"},jn=["trill-mark","wavy-line"],qn={mordent:Sn.MORDENT_ARTICULATION,"inverted-mordent":Sn.INVERTED_MORDENT_ARTICULATION,turn:Sn.TURN_ARTICULATION,"inverted-turn":Sn.INVERTED_TURN_ARTICULATION,"delayed-turn":Sn.DELAYED_TURN_ARTICULATION,"delayed-inverted-turn":Sn.DELAYED_INVERTED_TURN_ARTICULATION},Jn=/\n{1,}/g,Zn=/\r\n/g;An._staticInitializer(),r.registerClass(An,"com.noteflight.notation.fileformat.musicxml.MusicXmlToScoreTranslator");var tr=function(){function t(e,i,n){y(this,t),this.doc=e,this.elem=i,this.list=n}return p(t,[{key:"tag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.tagNS(null,t,e)}},{key:"tagNS",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.doc,o=e?r.createElementNS(e,i):r.createElement(i);this.elem?this.elem.appendChild(o):(null==this.list&&(this.list=[]),this.list.push(o));var s=new t(this.doc,o,null);n&&n(s)}},{key:"attr",value:function(t,e){this.elem.setAttribute(t,e)}},{key:"attrNS",value:function(t,e,i){this.elem.setAttributeNS(t,e,i)}},{key:"text",value:function(e){if(!q.ignoreWhitespace||!t.WHITESPACE_PATTERN.test(e)){var i=this.doc.createTextNode(e);this.elem.appendChild(i)}}}],[{key:"xmllist",value:function(e){var i=[],n=new t(document.implementation.createDocument("","",null),null,i);return e&&e(n),new ht(i)}},{key:"xml",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.xmlNS(null,t,e)}},{key:"xmlNS",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.implementation.createDocument("","",null),o=e?r.createElementNS(e,i):r.createElement(i);r.appendChild(o);var s=new t(r,o,null);return n&&n(s),new q.Element(r,o)}},{key:"WHITESPACE_PATTERN",get:function(){return er}}]),t}(),er=/^\s*$/;r.registerClass(tr,"com.noteflight.astoes6.XMLBuilder");var ir=function(){function t(e){y(this,t),this._xml=null,this._score=null,this._partInfo=null,this._partClefs=null,this._transposeInterval=null,this._pageMetrics=null,this._millimeters=NaN,this._tenthsPerPoint=NaN,this._slurStarts=[],this._slurStops=[],this._hairpinStop=null,this._measureRepeatByStaff=null,this._divisions_per_quarter=64,this._tupletCounting=0,this._score=e,this._pageMetrics=e.pageMetrics,this._millimeters=e.staffMetrics.lineSpacing*t.MILLIMETERS_PER_POINT,this._tenthsPerPoint=t.TENTHS_PER_SPACE/e.staffMetrics.lineSpacing}return p(t,null,[{key:"TENTHS_PER_SPACE",get:function(){return 10}},{key:"DEFAULT_DIVISIONS_PER_QUARTER",get:function(){return 64}},{key:"NOTE_TYPES",get:function(){return nr}},{key:"DYNAMICS",get:function(){return rr}},{key:"ARTICULATIONS",get:function(){return or}},{key:"TECHNICAL",get:function(){return sr}},{key:"UNKNOWN_HARMONY_KIND",get:function(){return"none"}},{key:"CHORD_KINDS",get:function(){return ar}},{key:"MAX_TUPLET_NESTING",get:function(){return 128}},{key:"MILLIMETERS_PER_POINT",get:function(){return.352777778}},{key:"XML_PROLOGUE",get:function(){return'<?xml version="1.0" encoding="UTF-8"?>'}},{key:"MUSICXML_VERSION_CURRENT",get:function(){return"2.0"}},{key:"MUSICXML_GRAMMAR",get:function(){return lr}},{key:"MUSICXML_MAX_SLURS",get:function(){return 6}},{key:"MAX_PARTS",get:function(){return 64}},{key:"MAX_VOICES",get:function(){return 2}},{key:"HAIRPIN_DEFAULT_SPREAD",get:function(){return 15}},{key:"SLUR_SPAN_TOLERANCE",get:function(){return 0}}]),p(t,[{key:"toXMLString",value:function(){return t.MUSICXML_GRAMMAR+"\n"+this.xml.toXMLString()}},{key:"initialize",value:function(){this.determineDivisions(),q.ignoreComments=!1,this._partInfo=[],this._partClefs=[];for(var e=0;e<t.MAX_PARTS;e++)this._partClefs[e]=[]}},{key:"generateWork",value:function(){var t=this;return tr.xml("work",function(e){e.text("\n                  "),e.tag("work-title",function(e){e.text(t.score.title)}),e.text("\n                ")})}},{key:"generateIdentification",value:function(){var t=this,e=new Date,i=(e.getMonth()+1).toString();1==i.length&&(i="0"+i);var n=e.getDate().toString();return 1==n.length&&(n="0"+n),tr.xml("identification",function(r){r.text("\n                  "),r.tag("creator",function(e){e.attr("type","composer"),e.text(t.score.composer)}),r.text("\n                  "),r.tag("creator",function(e){e.attr("type","lyricist"),e.text(t.score.lyricist)}),r.text("\n                  "),r.tag("rights",function(e){e.text(t.score.copyright)}),r.text("\n                  "),r.tag("encoding",function(t){t.text("\n                    "),t.tag("software",function(t){t.text("Noteflight version "),t.text(ur.CURRENT_VERSION)}),t.text("\n                    "),t.tag("encoding-date",function(t){t.text(A.numberToString(e.getFullYear()+"-"+i+"-"+n))}),t.text("\n                    "),t.tag("supports",function(t){t.attr("attribute","new-system"),t.attr("element","print"),t.attr("type","no"),t.attr("value","no")}),t.text("\n                    "),t.tag("supports",function(t){t.attr("attribute","new-page"),t.attr("element","print"),t.attr("type","no"),t.attr("value","no")}),t.text("\n                  ")}),r.text("\n                ")})}},{key:"generateDefaults",value:function(){var e=this;return tr.xml("defaults",function(i){i.text("\n                    "),i.tag("scaling",function(i){i.text("\n                        "),i.tag("millimeters",function(t){t.text(A.numberToString(e._millimeters))}),i.text("\n                        "),i.tag("tenths",function(e){e.text(A.uintToString(t.TENTHS_PER_SPACE))}),i.text("\n                    ")}),i.text("\n                    "),i.tag("page-layout",function(t){t.text("\n                        "),t.tag("page-height",function(t){t.text(A.numberToString(e._pageMetrics.height*e._tenthsPerPoint))}),t.text("\n                        "),t.tag("page-width",function(t){t.text(A.numberToString(e._pageMetrics.width*e._tenthsPerPoint))}),t.text("\n                        "),t.tag("page-margins",function(t){t.attr("type","both"),t.text("\n                            "),t.tag("left-margin",function(t){t.text(A.numberToString((e.score.staffMetrics.staffLabelPadding+e._pageMetrics.pageMarginLeft+e._pageMetrics.staffMarginLeft)*e._tenthsPerPoint))}),t.text("\n                            "),t.tag("right-margin",function(t){t.text(A.numberToString((e._pageMetrics.pageMarginRight+e._pageMetrics.staffMarginRight)*e._tenthsPerPoint))}),t.text("\n                            "),t.tag("top-margin",function(t){t.text(A.numberToString((e.score.staffMetrics.titlePageTopPadding+e.score.staffMetrics.titlePageFirstStaffPadding+e._pageMetrics.pageMarginTop+e._pageMetrics.staffMarginTop)*e._tenthsPerPoint))}),t.text("\n                            "),t.tag("bottom-margin",function(t){t.text(A.numberToString((e._pageMetrics.pageMarginBottom+e._pageMetrics.staffMarginBottom)*e._tenthsPerPoint))}),t.text("\n                        ")}),t.text("\n                    ")}),i.text("\n                    "),i.tag("system-layout",function(i){i.text("\n                        "),i.tag("system-margins",function(t){t.text("\n                            "),t.tag("left-margin",function(t){t.text(A.numberToString((e.score.staffMetrics.staffLabelPadding+e._pageMetrics.pageMarginLeft+e._pageMetrics.staffMarginLeft)*e._tenthsPerPoint))}),t.text("\n                            "),t.tag("right-margin",function(t){t.text(A.numberToString(e._pageMetrics.staffMarginRight*e._tenthsPerPoint))}),t.text("\n                        ")}),i.text("\n                        "),i.tag("system-distance",function(i){i.text(A.numberToString(e.score.staffMetrics.systemSpacing*t.TENTHS_PER_SPACE))}),i.text("\n                        "),i.tag("top-system-distance",function(i){i.text(A.numberToString(e.score.staffMetrics.systemSpacing*t.TENTHS_PER_SPACE+e._pageMetrics.staffMarginTop*e._tenthsPerPoint))}),i.text("\n                    ")}),i.text("\n                    "),i.tag("staff-layout",function(i){i.text("\n                      "),i.tag("staff-distance",function(i){i.text(A.numberToString(e.score.staffMetrics.staffSpacing*t.TENTHS_PER_SPACE))}),i.text("\n                    ")}),i.text("\n                ")})}},{key:"generateCredits",value:function(t){this.score.title&&t.appendChild(this.createCredit({type:"title",text:this.score.title,fontSize:24,xMultiplier:.5})),null!=this.score.subtitle&&this.score.subtitle.length>0&&t.appendChild(this.createCredit({type:"subtitle",text:this.score.subtitle})),null!=this.score.supertitle&&this.score.supertitle.length>0&&t.appendChild(this.createCredit({type:"dedication",text:this.score.supertitle})),null!=this.score.composer&&this.score.composer.length>0&&t.appendChild(this.createCredit({type:"composer",text:this.score.composer})),null!=this.score.lyricist&&this.score.lyricist.length>0&&t.appendChild(this.createCredit({type:"lyricist",text:this.score.lyricist}))}},{key:"createCredit",value:function(e){var i=this,n=e.type,r=e.text,o=e.fontSize,s=void 0===o?12:o,a=e.xMultiplier,l=void 0===a?.9:a;return tr.xml("credit",function(e){e.attr("page","1"),e.text("\n                      "),e.tag("credit-type",function(t){return t.text(n)}),e.tag("credit-words",function(e){e.attr("font-size","".concat(s)),e.attr("default-x",i._pageMetrics.width*i._tenthsPerPoint*l),e.attr("default-y",i._pageMetrics.height*i._tenthsPerPoint-(i.score.staffMetrics.titlePageTopPadding/2+i.score.staffMetrics.composerY)*t.TENTHS_PER_SPACE),e.attr("justify","right"),e.attr("valign","top"),e.text(r)}),e.text("\n                  ")})}},{key:"generatePartList",value:function(){var t,e=tr.xml("part-list"),i=1,n=1,r=!0,o=!1,s=void 0;try{for(var a,l=this.score.parts[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;n=i<16?i:16,u.staves[0].getMeasureAt(0).clef.sign==Mn.PERCUSSION_CLEF_SIGN&&(n=10);var h=(new fn).translateInstrumentToMusicXml(u.instrumentUri);t=tr.xml("score-part",function(t){t.attr("id","P"+i),t.text("\n                        "),t.tag("part-name",function(t){t.text(u.name)}),t.text("\n                        "),t.tag("part-abbreviation",function(t){t.text(u.shortName)}),t.text("\n                        "),t.tag("score-instrument",function(t){t.attr("id","P"+i+"I1"),t.text("\n                            "),t.tag("instrument-name",function(t){t.text(u.name)}),t.text("\n                            "),t.tag("instrument-sound",function(t){t.text(h)}),t.text("\n                        ")}),t.text("\n                        "),t.tag("midi-instrument",function(t){t.attr("id","P"+i+"I1"),t.text("\n                            "),t.tag("midi-channel",function(t){t.text(A.uintToString(n))}),t.text("\n                            "),t.tag("midi-program",function(t){t.text(A.intToString(u.midiPatch+1))}),t.text("\n                        ")}),t.text("\n                    ")}),e.appendChild(t),i++}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return e}},{key:"generateScore",value:function(){var e,i=this,n=tr.xml("score-partwise",function(e){e.attr("version",t.MUSICXML_VERSION_CURRENT)});n.appendChild(this.generateWork()),n.appendChild(this.generateIdentification()),n.appendChild(this.generateDefaults()),this.generateCredits(n),n.appendChild(this.generatePartList());var r=0,o=!0,s=!1,a=void 0;try{for(var l,u=this.score.parts[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;this._transposeInterval=new $a,r++,e=tr.xml("part",function(t){t.attr("id","P"+r)}),n.appendChild(e),this._measureRepeatByStaff=null;var c=!0,d=!1,f=void 0;try{for(var y,g=h.staves[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value;this._hairpinStop=null,this._slurStops=[];for(var m={},v=function(t){var n=p.measures[t];i._transposeInterval=n.transposingInterval;var o=e.child("measure").query(function(t){return t.attribute("number")==n.index+1}),s=i.score.systemStaff.getMeasureAt(A.intToUint(n.index)),a=null,l=null;if(0==o.length()){if(s.startRepeat&&(a=i.generateBarline(s,En.START_REPEAT)),1==r&&s.repeatEndingNotation){a||(a=tr.xml("barline",function(t){t.attr("location","left")})),a.appendChild(i.generateRepeatEndingStart(s.repeatEndingNotation));var u=s.repeatEndingNotation,c=Math.ceil(u.span/n.duration);m[t+c-1]=u}1==h.staves.length&&(l=i.generateRightSideBarline(s,m,t,r)),e.appendChild(i.generateMeasure(n,s,r,a,l))}else{p.index>0&&o.appendChild(tr.xml("backup",function(t){t.tag("duration",function(t){t.text(A.uintToString(i.calculateDuration(n.duration)))})})),h.staves.indexOf(p)==h.staves.length-1&&(l=i.generateRightSideBarline(s,m,t,r));var d=null,f=o.child("attributes");f.length()>0&&(d=f.get(0)),o.appendChild(i.generateMeasure(n,s,r,null,l,d).children())}},_=0;_<p.measures.length;_++)v(_)}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}e=e.normalize()}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return n}},{key:"determineDivisions",value:function(){var t=[],e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.score.parts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=0;l<this.score.numMeasures;l++){var u=!0,h=!1,c=void 0;try{for(var d,f=a.getNotationsInMeasure(l)[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=A.unknownToType(y,ue);if(A.is(g,Sn)){var p=A.as(g,Sn),m=p.rhythmDuration;if(A.is(p.rhythmContext,Xl)){var v=A.as(p.rhythmContext,Xl);e.indexOf(v.rhythmUnits)<0&&e.push(v.rhythmUnits)}t.indexOf(m)<0&&t.push(m)}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var _=1;e.length>0&&(_=zd.leastCommonMultipleArray(e),this._divisions_per_quarter*=_)}},{key:"calculateDuration",value:function(e){return A.numberToUint(Math.round(e*this._divisions_per_quarter/t.DEFAULT_DIVISIONS_PER_QUARTER))}},{key:"generateMeasure",value:function(t,e,i){var n,r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=A.as(this._partInfo[i],fl),u=A.intToUint(t.staff.part.staves.indexOf(t.staff)),h=A.as(this._partClefs[i][u],Mn),c=tr.xml("measure",function(e){e.attr("number",t.index+1)});if(null==a&&(a=tr.xml("attributes")),e.breakType==hl.PAGE_BREAK_TYPE&&0===t.staff.index&&c.appendChild(tr.xml("print",function(t){t.attr("new-page","yes")})),e.breakType==hl.SYSTEM_BREAK_TYPE&&0===t.staff.index&&c.appendChild(tr.xml("print",function(t){t.attr("new-system","yes")})),o&&c.appendChild(o),c.appendChild(a),null!=t.measureRepeatNotation)null!=this._measureRepeatByStaff&&!0===this._measureRepeatByStaff[u]||(n=tr.xml("measure-style",function(t){t.tag("measure-repeat",function(t){t.attr("type","start"),t.text("1")})}),0!==u&&n.setAttribute("number",u+1),a.appendChild(n),null==this._measureRepeatByStaff&&(this._measureRepeatByStaff=[]),this._measureRepeatByStaff[u]=!0);else{var d=this._measureRepeatByStaff;null!=d&&!0===d[u]&&(n=tr.xml("measure-style",function(t){t.tag("measure-repeat",function(t){t.attr("type","stop")})}),0!==u&&n.setAttribute("number",u+1),a.appendChild(n),d[u]=!1)}var f=t.staff.part;if(0===t.index&&0===u&&a.appendChild(tr.xml("divisions",function(t){t.text(A.uintToString(r._divisions_per_quarter))})),null!=l&&t.keySignature.equals(l.keySignature)||t.staff.getMeasureAt(0).clef.unpitched||a.appendChild(this.generateKeySignature(t.keySignature,f.transposition)),null!=l&&t.timeSignature.equals(l.timeSignature)||(e.timeSignatureNotation?a.appendChild(this.generateTimeSignature(e.timeSignatureNotation)):a.appendChild(this.generateTimeSignature(e.timeSignature))),0===t.index&&0===u&&f.staves.length>1&&a.appendChild(tr.xml("staves",function(t){t.text(A.uintToString(f.staves.length))})),null!=l&&t.tempo.equals(l.tempo)||c.appendChild(this.generateTempo(t.tempo)),(null==h||!t.clef.sameAs(h))&&(null!=t.clef&&a.appendChild(this.generateClef(t.clef,A.intToUint(u+1))),A.is(t.clef,$l))){var y=A.as(t.clef,$l);y.staffNotes.length>0&&a.appendChild(this.generateStaffTuning(y.tuningNotes,y.capo))}0===t.index&&0===u&&(0===f.transposition&&0===f.octaveShift||a.appendChild(this.generateTransposition(f))),this._partInfo[i]=t.measureInfo,this._partClefs[i][u]=t.clef,this._slurStarts=[];var g=!0,p=!1,m=void 0;try{for(var v,_=t.measureNotations[Symbol.iterator]();!(g=(v=_.next()).done);g=!0){var S=v.value,L=A.unknownToType(S,he);A.is(L,Ol)&&this._slurStarts.push(L)}}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}for(var k=0;k<t.numVoices;k++){k>0&&c.appendChild(tr.xml("backup",function(e){e.tag("duration",function(e){e.text(A.uintToString(r.calculateDuration(t.duration)))})}));var T=t.getVoiceNumber(k).elements;if(0===k){T=(0===u&&1==i?T.slice().concat(e.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements.slice()).concat(t.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements.slice()):T.slice().concat(t.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements.slice())).sort(ae.compareScorePosition)}this.generateRhythmContext(c,T,a)}return s&&c.appendChild(s),c}},{key:"generateRhythmContext",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.length>0&&this.generateRhythmElements(t,e,i)}},{key:"generateRhythmElements",value:function(t,e,i){var n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,ue);if(A.is(u,he)){var h=null;if(A.is(u,Sn)&&A.as(u,Sn).notes.length>0){var c,d=A.as(u,Sn),f=d.measure.staff,y=A.intToUint(f.part.staves.indexOf(f)),g=[],p=!0,m=!1,v=void 0;try{for(var _,S=this._slurStarts[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value;c=A.unknownToType(L,Ol),Math.round(c.position)==Math.round(d.position)&&c.voice==d.voice&&g.push(c.clone())}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}var k=!0,T=!1,E=void 0;try{for(var M,b=A.as(u,Sn).notes[Symbol.iterator]();!(k=(M=b.next()).done);k=!0){var w=M.value;if(null!=(h=this.generateNotation(A.as(w,he)))){for(g.length>0&&h.child("notations").length()<=0&&h.appendChild(tr.xml("notations"));g.length>0;){c=A.as(g.pop(),Ol);var x=this.generateSlurStart(c,A.intToUint(y+1));x.doc&&h.child("notations").appendChild(x)}var C=!0,N=!1,I=void 0;try{for(var P,O=A.as(u,Sn).lyrics[Symbol.iterator]();!(C=(P=O.next()).done);C=!0){var Q=P.value,R=this.generateLyric(Q);null!=R&&h.appendChild(R)}}catch(t){N=!0,I=t}finally{try{C||null==O.return||O.return()}finally{if(N)throw I}}t.appendChild(h)}0}}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}}else null!=(h=this.generateNotation(A.as(u,he)))&&t.appendChild(h);A.is(u,Sn)&&this.generateHairpinStop(A.as(u,Sn),t)}else A.is(u,Xl)&&this.generateRhythmContext(t,A.as(u,Xl).elements)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"generateTuplet",value:function(e,i,n,r){for(var o,s=e.rhythmContext,a=s.elements.indexOf(e),l=s.elements.length,u=null,h=1,c=[];A.is(s,Xl);){var d=A.as(s,Xl);A.is(d.rhythmContext,Xl)&&A.as(d.rhythmContext,Xl);var f=e.rhythmDuration,y=d.measureDenominator,g=d.measureNumerator;if(1==h&&(f*=g/y,i.set("duration",this.calculateDuration(f))),r&&!d.tremolo)if(!u&&0===a||u&&0===d.elements.indexOf(u)&&0===a){if(o=tr.xml("tuplet",function(t){t.attr("type","start")}),this._tupletCounting++,o.setAttribute("number",this._tupletCounting),d.rhythmUnits!=d.units||d.rhythmValue!=d.unitValue){var p=tr.xml("tuplet-actual",function(e){e.text("\n                                  "),e.tag("tuplet-number",function(t){t.text(A.intToString(d.rhythmUnits))}),e.text("\n                                  "),e.tag("tuplet-type",function(e){e.text(A.unknownToString(t.NOTE_TYPES[d.rhythmValue]))}),e.text("\n                                ")}),m=tr.xml("tuplet-normal",function(e){e.text("\n                                  "),e.tag("tuplet-number",function(t){t.text(A.uintToString(d.units))}),e.text("\n                                  "),e.tag("tuplet-type",function(e){e.text(A.unknownToString(t.NOTE_TYPES[d.unitValue]))}),e.text("\n                                ")});o.appendChild(p),o.appendChild(m)}c.push(o)}else if(!u&&a==l-1||u&&d.elements.indexOf(u)==d.elements.length-1&&a==l-1){var v=tr.xml("tuplet",function(t){t.attr("type","stop")});v.setAttribute("number",this._tupletCounting),c.push(v),this._tupletCounting--}if(1==h){var _=tr.xml("time-modification");_.set("actual-notes",y),_.set("normal-notes",g),_.set("normal-type",t.NOTE_TYPES[d.unitValue]),i.appendChild(_)}if(u=d,!(s=A.as(s,Xl).rhythmContext)||h>t.MAX_TUPLET_NESTING)break;h++}if(c.length>0)for(var S=A.unknownToType(c[c.length-1],q).attribute("number")-(c.length-1),L=c.length-1;L>=0;L--)(o=A.unknownToType(c[L],q)).setAttribute("number",S),S++,n.appendChild(o)}},{key:"generateNotation",value:function(e){var i=this,n=null,r=e.measure.staff,o=0,s=A.intToUint(e.voiceNumber+1);if(r.index>=0&&(o=A.intToUint(r.part.staves.indexOf(r)),s+=o*t.MAX_VOICES),A.is(e,Gl)||A.is(e,vl)){n=tr.xml("note",function(t){t.text("\n                        "),t.tag("rest"),t.text("\n                        "),t.tag("duration",function(t){t.text(A.uintToString(i.calculateDuration(e.measure.duration)))}),t.text("\n                        "),t.tag("voice",function(t){t.text(A.uintToString(s))}),t.text("\n                        "),t.tag("type",function(t){t.text("whole")}),t.text("\n                    ")}),r.part.staves.length>1&&n.appendChild(tr.xml("staff",function(t){t.text(A.intToString(o+1))}));var a=tr.xml("notations");A.unknownToType(e,Sn).articulations.length>0&&this.generateArticulations(a,A.unknownToType(e,Sn).articulations),a.children().length()&&n.appendChild(a)}else if(A.is(e,de))n=this.generateNote(A.as(e,de));else if(A.is(e,Sn))n=this.generateRest(A.as(e,Sn));else if(A.is(e,Yl))n=this.generateTempo(A.as(e,Yl));else if(A.is(e,Aa)){var l=A.as(e,Aa).transposeInterval(this._transposeInterval);n=this.generateChordSymbol(l)}else if(A.is(e,Ra))n=this.generateExpressionText(A.as(e,Ra));else if(A.is(e,bl))n=this.generatePerformanceText(A.as(e,bl));else if(A.is(e,Va))n=this.generateHairpinStart(A.as(e,Va));else if(A.is(e,Il))n=this.generateSegno(A.as(e,Il));else{if(!A.is(e,Oa))return n;n=this.generateCoda(A.as(e,Oa))}if(null==n)return null;if(!A.is(e,Va))if(A.is(e,Ca)){A.as(e,Ca);A.is(e,Aa)?(0!==e.dx&&n.descendants("kind").setAttribute("relative-x",A.numberToString(e.dx*t.TENTHS_PER_SPACE)),0!==e.dy&&n.descendants("kind").setAttribute("relative-y",A.numberToString(e.dy*t.TENTHS_PER_SPACE))):(0!==e.dx&&n.descendants("words").setAttribute("relative-x",A.numberToString(e.dx*t.TENTHS_PER_SPACE)),0!==e.dy&&n.descendants("words").setAttribute("relative-y",A.numberToString(e.dy*t.TENTHS_PER_SPACE)))}else 0!==e.dx&&n.set("@relative-x",e.dx*t.TENTHS_PER_SPACE),0!==e.dy&&n.set("@relative-y",e.dy*t.TENTHS_PER_SPACE);return 0!==e.effectiveColor&&this.generateColor(n,e),n}},{key:"generateColor",value:function(t,e){if(16777215==e.effectiveColor)t.set("@print-object","no");else{for(var i=e.effectiveColor.toString(16).toUpperCase(),n=i.length;n<6;n++)i="0"+i;i="#"+i,t.set("@color",i)}}},{key:"generateRightSideBarline",value:function(t,e,i,n){var r=null;return t.endRepeat?r=this.generateBarline(t,En.END_REPEAT):t.barlineNotation&&t.barlineNotation.type!=En.SINGLE&&(r=this.generateBarline(t,t.barlineNotation.type)),1==n&&Object.keys(e).includes(i.toString())&&(r||(r=tr.xml("barline",function(t){t.attr("location","right")})),r.appendChild(this.generateRepeatEndingStop(e[i.toString()]))),r}},{key:"generateRepeatEndingStart",value:function(t){return tr.xml("ending",function(e){e.text(t.startingText),e.attr("type","start"),e.attr("number",t.numbers.join(","))})}},{key:"generateRepeatEndingStop",value:function(t){return tr.xml("ending",function(e){e.text(t.startingText),e.attr("type",t.type==ll.TYPE_INITIAL?"stop":"discontinue"),e.attr("number",t.numbers.join(","))})}},{key:"generateBarline",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t.barlineNotation,r=tr.xml("barline",function(t){t.attr("location","right")});if(!n)return r;(n.type!=En.SINGLE&&r.appendChild(tr.xml("bar-style",function(t){t.text(e.mapBarlineType(n.type))})),i==En.START_REPEAT)&&(r.setAttribute("location","left"),r.appendChild(tr.xml("repeat",function(t){t.attr("direction","forward")})));return i==En.END_REPEAT&&(r.setAttribute("location","right"),r.appendChild(tr.xml("repeat",function(t){t.attr("direction","backward")}))),r}},{key:"generateRest",value:function(e){var i=this,n=e.measure.staff,r=0,o=A.intToUint(e.voiceNumber+1);n.index>=0&&(r=A.intToUint(n.part.staves.indexOf(n)),o+=r*t.MAX_VOICES);for(var s=tr.xml("note",function(n){n.text("\n                    "),n.tag("rest"),n.text("\n                    "),n.tag("duration",function(t){t.text(A.uintToString(i.calculateDuration(e.rhythmDuration)))}),n.text("\n                    "),n.tag("voice",function(t){t.text(A.uintToString(o))}),n.text("\n                    "),n.tag("type",function(i){i.text(A.unknownToString(t.NOTE_TYPES[e.value]))}),n.text("\n                ")}),a=0;a<e.dots;a++)s.appendChild(tr.xml("dot"));e.cue&&s.appendChild(tr.xml("cue"));var l=tr.xml("notations");A.is(e.rhythmContext,Xl)&&this.generateTuplet(e,s,l,0===e.notes.length),n.part.staves.length>1&&s.appendChild(tr.xml("staff",function(t){t.text(A.intToString(r+1))})),this.generateSlurStops(e,l);var u=e.previousNoteSet();return e.beam?u&&u.beam?s.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("continue")})):s.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("begin")})):u&&u.beam&&s.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("end")})),l.children().length()>0&&s.appendChild(l),s}},{key:"generateNote",value:function(e){var i=this,n=tr.xml("note"),r=e.noteSet.measure.staff,o=e.measure.getScoreNote(e,this._transposeInterval),s=0,a=A.intToUint(e.voiceNumber+1);r.index>=0&&(s=A.intToUint(r.part.staves.indexOf(r)),a+=s*t.MAX_VOICES);var l=A.intToUint(e.noteSet.notes.indexOf(e));if(e.noteSet.notes.length>1&&l>0&&n.appendChild(tr.xml("chord")),e.noteSet.grace){var u=tr.xml("grace");e.noteSet.appoggiatura&&u.setAttribute("slash","no"),n.appendChild(u)}var h=this.isUnpitched(e);h&&n.appendChild(this.generateUnpitchedNote(e)),h||(n.appendChild(tr.xml("pitch")),n.child("pitch").appendChild(tr.xml("step",function(t){t.text(kt.STEP_NAMES.charAt(o.step))})),o.alteration&&n.child("pitch").appendChild(tr.xml("alter",function(t){t.text(A.intToString(o.alteration))})),n.child("pitch").appendChild(tr.xml("octave",function(t){t.text(A.intToString(o.notatedOctave))}))),e.noteSet.grace||e.noteSet.rhythmContext instanceof Xl||n.appendChild(tr.xml("duration",function(t){t.text(A.uintToString(i.calculateDuration(e.noteSet.rhythmDuration)))})),e.tied&&n.appendChild(tr.xml("tie",function(t){t.attr("type","start")})),(e.tieEnd||e.incomingLiaison==de.TIE_LIAISON)&&n.appendChild(tr.xml("tie",function(t){t.attr("type","stop")})),n.appendChild(tr.xml("voice",function(t){t.text(A.uintToString(a))})),n.appendChild(tr.xml("type",function(i){i.text(A.unknownToString(t.NOTE_TYPES[e.noteSet.value]))}));for(var c=0;c<e.noteSet.dots;c++)n.appendChild(tr.xml("dot"));e.effectiveCue&&n.appendChild(tr.xml("cue"));var d=tr.xml("notations");if(null!=o.accidental){var f=e.accidental;"doubleSharp"==o.accidental?f="double-sharp":"doubleFlat"==o.accidental&&(f="flat-flat");var y=tr.xml("accidental",function(t){t.text(f)});o.courtesyAccidental&&y.setAttribute("parentheses","yes"),n.appendChild(y)}if(null!=e.noteSet.arpeggio){var g=tr.xml("arpeggiate");e.noteSet.arpeggio==Sn.UP_ARPEGGIO?g.setAttribute("direction","up"):e.noteSet.arpeggio==Sn.DOWN_ARPEGGIO&&g.setAttribute("direction","down"),d.appendChild(g)}if(this.generateOrnaments(e.noteSet,d),e.stringIndex>=0){var p=tr.xml("technical");p.appendChild(tr.xml("string",function(t){t.text(A.intToString(e.stringIndex+1))}));var m=e.measure.clef.getEffectiveFret(e);m>=0&&p.appendChild(tr.xml("fret",function(t){t.text(A.intToString(m))})),d.appendChild(p)}A.is(e.rhythmContext,Xl)&&this.generateTuplet(e.noteSet,n,d,0===l),this.generateSlurStops(e.noteSet,d),(e.parentheses||null!=e.noteHead&&e.noteHead!=de.NORMAL_NOTE_HEAD)&&(n.appendChild(this.generateNoteheadType(e)),e.parentheses&&n.child("notehead").setAttribute("parentheses","yes")),r.part.staves.length>1&&n.appendChild(tr.xml("staff",function(t){t.text(A.intToString(s+1))}));var v=e.noteSet.previousNoteSet();if(e.noteSet.beam?v&&v.beam?n.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("continue")})):n.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("begin")})):v&&v.beam&&n.appendChild(tr.xml("beam",function(t){t.attr("number","1"),t.text("end")})),e.tied&&d.appendChild(tr.xml("tied",function(t){t.attr("type","start")})),e.tieEnd&&d.appendChild(tr.xml("tied",function(t){t.attr("type","stop")})),e.noteSet.articulations.length>0||e.hasEffect){var _=e.noteSet.articulations;e.hasPreEffect&&_.push(e.preEffect.type),e.hasPostEffect&&_.push(e.postEffect.type),this.generateArticulations(d,_)}return d.children().length()>0&&n.appendChild(d),n.children().length()>=1?n:null}},{key:"generateOrnaments",value:function(t,e){var i=tr.xml("ornaments");if(t.tremolo>0){var n=tr.xml("tremolo",function(e){e.text(A.intToString(t.tremolo))});t.tremoloDyad?n.setAttribute("type",0===t.rhythmPosition?"start":"stop"):n.setAttribute("type","single"),i.appendChild(n)}if(t.articulations.length>0)for(var r in An.ARTICULATION_ORNAMENT_TABLE)t.hasArticulation(An.ARTICULATION_ORNAMENT_TABLE[r])&&i.appendChild(tr.xml(r));i.children().length()>0&&e.appendChild(i)}},{key:"generateTimeSignature",value:function(t){var e=tr.xml("time",function(e){e.attr("print-object","yes"),e.text("\n                    "),e.tag("beats",function(e){e.text(A.uintToString(t.beats))}),e.text("\n                    "),e.tag("beat-type",function(e){e.text(A.uintToString(t.beatType))}),e.text("\n                ")});switch(t.visibility==zl.HIDDEN_VISIBILITY&&e.setAttribute("print-object","no"),t.timeSymbol){case zl.COMMON_TIME_SYMBOL:e.setAttribute("symbol","common");break;case zl.CUT_TIME_SYMBOL:e.setAttribute("symbol","cut")}return e}},{key:"generateKeySignature",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=A.as(t.clone(),Ga);return 0!==e&&(i=i.transposeFifths(-$a.fromPitches(e).fifths)),tr.xml("key",function(t){t.text("\n                    "),t.tag("fifths",function(t){t.text(A.intToString(i.fifths))}),t.text("\n                    "),t.tag("mode",function(t){t.text(i.mode?i.mode:"major")}),t.text("\n                ")})}},{key:"generateTempo",value:function(e){var i=tr.xml("direction",function(i){i.attr("placement","above"),i.text("\n                "),i.tag("direction-type",function(i){i.text("\n                  "),i.tag("metronome",function(i){i.text("\n                    "),i.tag("beat-unit",function(i){i.text(A.unknownToString(t.NOTE_TYPES[e.value]))}),i.text("\n                    "),i.tag("per-minute",function(t){t.text(A.uintToString(e.bpm))}),i.text("\n                  ")}),i.text("\n                ")}),i.text("\n                "),i.tag("sound",function(t){t.attr("tempo",e.bpm)}),i.text("\n              ")});return 1==e.dots&&i.child("direction-type").child("metronome").appendChild(tr.xml("beat-unit-dot")),i}},{key:"generateClef",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.sign==Mn.PERCUSSION_CLEF_SIGN||t.sign==Mn.PERCUSSION2_CLEF_SIGN?tr.xml("clef",function(t){t.attr("number",e),t.text("\n                        "),t.tag("sign",function(t){t.text("percussion")}),t.text("\n                    ")}):t.sign==Mn.TAB_CLEF_SIGN?tr.xml("clef",function(i){i.attr("number",e),i.text("\n                        "),i.tag("sign",function(e){e.text(t.sign.toUpperCase())}),i.text("\n                        "),i.tag("line",function(e){e.text(A.intToString(t.line+2))}),i.text("\n                    ")}):t.sign==Mn.TENOR_VOICE_CLEF_SIGN?tr.xml("clef",function(i){i.attr("number",e),i.text("\n                        "),i.tag("sign",function(t){t.text("G")}),i.text("\n                        "),i.tag("line",function(e){e.text(A.intToString(t.line+1))}),i.text("\n                        "),i.tag("clef-octave-change",function(t){t.text("-1")}),i.text("\n                    ")}):t.sign==Mn.VOCAL_TENOR_CLEF_SIGN?tr.xml("clef",function(i){i.attr("number",e),i.text("\n                        "),i.tag("sign",function(t){t.text("F")}),i.text("\n                        "),i.tag("line",function(e){e.text(A.intToString(t.line+1))}),i.text("\n                        "),i.tag("clef-octave-change",function(t){t.text("-1")}),i.text("\n                    ")}):tr.xml("clef",function(i){i.attr("number",e),i.text("\n                    "),i.tag("sign",function(e){e.text(t.sign)}),i.text("\n                    "),i.tag("line",function(e){e.text(A.intToString(t.line+1))}),i.text("\n                ")})}},{key:"generateLyric",value:function(t){if(""===t.text)return null;var e=A.intToUint(t.line+1);e<=1&&(e=1);var i=tr.xml("lyric",function(t){t.attr("number",e)});t.direction==he.DIRECTION_UP&&i.setAttribute("placement","above");var n=!1;if(t.noteSet.previousNoteSet(!0)){var r=!0,o=!1,s=void 0;try{for(var a,l=t.noteSet.previousNoteSet(!0).lyrics[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(u.line==t.line&&u.continued){n=!0;break}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}return t.continued?n?i.appendChild(tr.xml("syllabic",function(t){t.text("middle")})):i.appendChild(tr.xml("syllabic",function(t){t.text("begin")})):n?i.appendChild(tr.xml("syllabic",function(t){t.text("end")})):i.appendChild(tr.xml("syllabic",function(t){t.text("single")})),i.appendChild(tr.xml("text",function(e){e.text(t.text)})),t.extend&&i.appendChild(tr.xml("extend")),this.generateColor(i,t),i}},{key:"generateChordSymbol",value:function(e){var i=tr.xml("harmony",function(t){t.text("\n                    "),t.tag("root"),t.text("\n                    "),t.tag("kind"),t.text("\n                ")}),n=e.text.match(/^([A-G]{1}[b#*]?[b#]?)([^\/]*)\/?(.*)$/i);if(null==n||n.length<=0)return null;var r=de.fromString("C");try{r=de.fromString(n[1])}catch(t){if(!A.is(t,Error))throw t;A.as(t,Error);X.trace("unkown root note ",n[1]," in chord",e.text)}if(i.child("root").appendChild(tr.xml("root-step",function(t){t.text(kt.STEP_NAMES.charAt(r.step))})),r.alteration&&i.child("root").appendChild(tr.xml("root-alter",function(t){t.text(A.intToString(r.alteration))})),n.length>=4&&n[3].length>0){var o=r;try{o=de.fromString(n[3])}catch(t){if(!A.is(t,Error))throw t;A.as(t,Error);X.trace("unkown bass note ",n[3]," in chord",e.text)}var s=tr.xml("bass");s.appendChild(tr.xml("bass-step",function(t){t.text(kt.STEP_NAMES.charAt(o.step))})),r.alteration&&s.appendChild(tr.xml("bass-alter",function(t){t.text(A.intToString(o.alteration))})),i.appendChild(s)}var a=t.UNKNOWN_HARMONY_KIND;if(n.length>=3&&(a=this.mapHarmonyKind(n[2]),t.CHORD_KINDS.indexOf(a)<0&&(a=t.UNKNOWN_HARMONY_KIND)),i.set("kind",a),a==t.UNKNOWN_HARMONY_KIND)i.child("kind").setAttribute("text",e.text);else if(n.length>=3&&n[2].length>0){var l=n[2].match(/[b#]{1}[^b#]*/gi);if(null==l||l.length<=0)i.child("kind").setAttribute("text",n[2]);else{i.child("kind").setAttribute("parentheses-degrees","yes");for(var u=0;u<l.length;u++){var h=l[u].match(/([b#]{1})([0-9]{1,2})/);null!=h&&h.length>=3&&i.appendChild(tr.xml("degree",function(t){t.text("\n                                    "),t.tag("degree-value",function(t){t.text(h[2])}),t.text("\n                                    "),t.tag("degree-alter",function(t){t.text(A.intToString("#"==h[1]?1:-1))}),t.text("\n                                    "),t.tag("degree-type",function(t){t.text("alter")}),t.text("\n                                    ")}))}}}if(null!=e.fretboard){var c=tr.xml("frame");if(c.appendChild(tr.xml("frame-strings",function(t){t.text(A.intToString(e.fretboard.strings))})),c.appendChild(tr.xml("frame-frets",function(t){t.text(A.intToString(e.fretboard.frets))})),0!==e.fretboard.firstFret||null!=e.fretboard.firstFretLocation||null!=e.fretboard.firstFretText){var d=tr.xml("first-fret",function(t){t.text(A.intToString(e.fretboard.firstFret))});d.setAttribute("location",e.fretboard.firstFretLocation),d.setAttribute("text",e.fretboard.firstFretText),c.appendChild(d)}var f=!0,y=!1,g=void 0;try{for(var p,m=e.fretboard.notes[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value,_=v.string;_++;var S=tr.xml("frame-note",function(t){t.tag("string",function(t){t.text(A.intToString(_))}),t.tag("fret",function(t){t.text(A.intToString(v.fret))})});v.hasBarre&&S.appendChild(tr.xml("barre",function(t){t.attr("type","{obj.barre}")})),c.appendChild(S)}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}i.appendChild(c)}return i}},{key:"generateExpressionText",value:function(e){var i=tr.xml("direction",function(t){t.attr("placement","below"),t.text("\n                "),t.tag("direction-type"),t.text("\n            ")});return t.DYNAMICS.indexOf(e.text)>=0?i.child("direction-type").appendChild(this.generateDynamic(e)):e.textbox?i.child("direction-type").appendChild(tr.xml("words",function(t){t.attr("enclosure","rectangle"),t.text(e.text)})):i.child("direction-type").appendChild(tr.xml("words",function(t){t.text(e.text)})),i}},{key:"generateSegno",value:function(t){return tr.xml("direction",function(t){t.attr("placement","above"),t.text("\n                    "),t.tag("direction-type",function(t){t.text("\n                        "),t.tag("segno"),t.text("\n                    ")}),t.text("\n                ")})}},{key:"generateCoda",value:function(t){return tr.xml("direction",function(t){t.attr("placement","above"),t.text("\n                    "),t.tag("direction-type",function(t){t.text("\n                        "),t.tag("coda"),t.text("\n                    ")}),t.text("\n                ")})}},{key:"generateDynamic",value:function(t){return tr.xml("dynamics",function(e){e.attr("placement","below"),e.text("\n                  "),e.tag(t.text),e.text("\n                ")})}},{key:"generatePerformanceText",value:function(t){var e=tr.xml("direction",function(t){t.attr("placement","above"),t.text("\n                "),t.tag("direction-type"),t.text("\n            ")});return t.textbox?e.child("direction-type").appendChild(tr.xml("words",function(e){e.attr("enclosure","rectangle"),e.text(t.text)})):e.child("direction-type").appendChild(tr.xml("words",function(e){e.text(t.text)})),e}},{key:"generateTransposition",value:function(t){var e=tr.xml("transpose");return e.appendChild(tr.xml("diatonic",function(e){e.text(A.intToString(-A.intToString(t.transpositionInterval.steps)))})),e.appendChild(tr.xml("chromatic",function(e){e.text(A.intToString(-A.intToString(t.transpositionInterval.pitches)))})),0!==t.octaveShift&&e.appendChild(tr.xml("octave-change",function(e){e.text(A.intToString(-A.intToString(t.octaveShift)))})),e}},{key:"mapBarlineType",value:function(t){switch(t){case En.SINGLE:return"regular";case En.DASHED:return"dashed";case En.DOUBLE:return"light-light";case En.INITIAL:return"heavy-light";case En.FINAL:return"light-heavy";case En.INVISIBLE:return"none";default:return"regular"}}},{key:"mapArticulationType",value:function(t){switch(t){case"marcato":return"accent";case"martellato":return"strong-accent";case"staccato":return"staccato";case"tenuto":return"tenuto";case"staccatissimo":return"staccatissimo";case"open":return"open-string";case"closed":return"stopped";case"upBow":return"up-bow";case"downBow":return"down-bow";case"fermata":return"fermata";case"caesura":return"caesura";case"breath":return"breath-mark";case"plop":return"plop";case"scoop":return"scoop";case"doit":return"doit";case"quickFall":return"falloff";default:return""}}},{key:"generateArticulations",value:function(e,i){var n=tr.xml("articulations"),r=tr.xml("technical"),o=!0,s=!1,a=void 0;try{for(var l,u=i[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToString(h),d=this.mapArticulationType(c);t.ARTICULATIONS.indexOf(d)>=0?n.appendChild(tr.xml(d)):t.TECHNICAL.indexOf(d)>=0&&r.appendChild(tr.xml(d))}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}n.children().length()>0&&e.appendChild(n),r.children().length()>0&&e.appendChild(r)}},{key:"mapHarmonyKind",value:function(t){return(t=t.toLowerCase()).length<=0?"major":/^m7.*$/.test(t)?"minor-seventh":/^m6.*$/.test(t)?"minor-sixth":/^m9.*$/.test(t)?"minor-ninth":/^min7.*$/.test(t)?"minor-seventh":/^min6.*$/.test(t)?"minor-sixth":/^min9.*$/.test(t)?"minor-ninth":/^maj7.*$/.test(t)?"major-seventh":/^7.*$/.test(t)?"dominant":/^M7.*$/.test(t)?"major-seventh":/^sus.*$/.test(t)?"suspended-fourth":/^6.*$/.test(t)?"major-sixth":/^9.*$/.test(t)?"dominant-ninth":/^sus2.*$/.test(t)?"suspended-second":/^11.*$/.test(t)?"dominant-11th":/^13.*$/.test(t)?"dominant-13th":/^m7b5.*$/.test(t)?"half-diminished":/^dim7.*$/.test(t)?"diminished-seventh":/^m11.*$/.test(t)?"minor-11th":/^maj9.*$/.test(t)?"major-ninth":/^M9.*$/.test(t)?"major-ninth":/^maj13.*$/.test(t)?"major-13th":/^M13.*$/.test(t)?"major-13th":/^7#5.*$/.test(t)?"augmented-seventh":/^mmaj7.*$/.test(t)?"major-minor":/^dim.*$/.test(t)?"diminished":/^min.*$/.test(t)?"minor":/^m.*$/.test(t)?"minor":t}},{key:"generateUnpitchedNote",value:function(t){var e=t.transposeDiatonic(12);return tr.xml("unpitched",function(t){t.text("\n                    "),t.tag("display-step",function(t){t.text(kt.STEP_NAMES.charAt(e.step))}),t.text("\n                    "),t.tag("display-octave",function(t){t.text(A.intToString(e.pitch.octave))}),t.text("\n                ")})}},{key:"isUnpitched",value:function(t){return t.noteSet.measure.clef.unpitched}},{key:"generateNoteheadType",value:function(t){switch(t.noteHead){case de.SLASH_NOTE_HEAD:return tr.xml("notehead",function(t){t.text("slash")});case de.HIT_NOTE_HEAD:return tr.xml("notehead",function(t){t.text("slashed")});case de.CROSS_NOTE_HEAD:return tr.xml("notehead",function(t){t.text("x")});case de.SQUARE_NOTE_HEAD:return tr.xml("notehead",function(t){t.text("square")});case de.DIAMOND_NOTE_HEAD:return tr.xml("notehead",function(t){t.attr("filled","yes"),t.text("diamond")});case de.TRIANGLE_NOTE_HEAD:return tr.xml("notehead",function(t){t.text("triangle")});case de.HARMONIC_NOTE_HEAD:return tr.xml("notehead",function(t){t.attr("filled","no"),t.text("diamond")});default:return tr.xml("notehead",function(t){t.text("normal")})}}},{key:"generateSlurStart",value:function(e,i){var n="down"==e.direction?"below":"above",r=A.intToUint(this._slurStops.push(e.clone())-1),o=A.intToUint(i+r);return o>t.MUSICXML_MAX_SLURS?new q:tr.xml("slur",function(t){t.attr("default-x",e.dx),t.attr("default-y",e.dy),t.attr("number",o),t.attr("placement",n),t.attr("type","start")})}},{key:"generateSlurStops",value:function(e,i){for(var n=e.measure.staff,r=A.intToUint(n.part.staves.indexOf(n)+1),o=0;o<this._slurStops.length;o++){var s=A.as(this._slurStops[o],Ol);if(s.span-=e.duration,s.span<=t.SLUR_SPAN_TOLERANCE){var a=A.intToUint(r+o);if(a>t.MUSICXML_MAX_SLURS)return;i.appendChild(this.generateSlurStop(s,a)),this._slurStops.splice(o,1)}}}},{key:"generateSlurStop",value:function(t,e){return tr.xml("slur",function(i){i.attr("default-x",t.endx),i.attr("default-y",t.dy+t.ascent),i.attr("number",e),i.attr("type","stop")})}},{key:"generateHairpinStart",value:function(e){var i=this;return this._hairpinStop=A.as(e.clone(),Va),tr.xml("direction",function(n){n.text("\n                "),n.tag("direction-type",function(i){i.text("\n                  "),i.tag("wedge",function(i){i.attr("default-x",10*e.dx),i.attr("default-y",10*e.dy),i.attr("spread",t.HAIRPIN_DEFAULT_SPREAD),i.attr("type",e.type)}),i.text("\n                ")}),n.text("\n                "),n.tag("staff",function(t){t.text(A.intToString(i.getPartStaffIndex(e.measure.staff)+1))}),n.text("\n              ")})}},{key:"generateHairpinStop",value:function(t,e){var i=this;null!=this._hairpinStop&&(this._hairpinStop.span-=t.rhythmDuration,this._hairpinStop.span<=0&&(this._hairpinStop=null,e.appendChild(tr.xml("direction",function(e){e.text("\n                        "),e.tag("direction-type",function(t){t.text("\n                            "),t.tag("wedge",function(t){t.attr("type","stop")}),t.text("\n                        ")}),e.text("\n                        "),e.tag("staff",function(e){e.text(A.intToString(i.getPartStaffIndex(t.measure.staff)+1))}),e.text("\n                    ")}))))}},{key:"generateStaffTuning",value:function(t,e){var i=tr.xml("staff-details");i.appendChild(tr.xml("staff-lines",function(e){e.text(A.uintToString(t.length))}));for(var n=0;n<t.length;n++){var r=A.as(t[n],de);i.appendChild(tr.xml("staff-tuning",function(t){t.attr("line",n+1),t.text("\n                    "),t.tag("tuning-step",function(t){t.text(A.unknownToString(kt.SHARP_PITCH_NAMES[r.pitch.pitchClass]))}),t.text("\n                    "),t.tag("tuning-octave",function(t){t.text(A.intToString(r.pitch.octave))}),t.text("\n                  ")}))}return i.appendChild(tr.xml("capo",function(t){t.text(A.intToString(e))})),i}},{key:"getPartStaffIndex",value:function(t){return t.part.staves.indexOf(t)}},{key:"xml",get:function(){return null==this._xml&&(this.initialize(),this._xml=this.generateScore()),this._xml}},{key:"score",get:function(){return this._score}}]),t}(),nr=["256th","128th","64th","32nd","16th","eighth","quarter","half","whole","breve","longa"],rr=["p","pp","ppp","pppp","ppppp","pppppp","f","ff","fff","ffff","fffff","ffffff","mp","mf","sf","sfp","sfpp","fp","rf","rfz","sfz","sffz","fz"],or=["accent","strong-accent","staccato","tenuto","detached-legato","staccatissimo","spiccato","scoop","plop","doit","falloff","breath-mark","caesura","stress","unstress","other-articulation"],sr=["up-bow","down-bow","harmonic","open-string","thumb-position","fingering","pluck","double-tongue","triple-tongue","stopped","snap-pizzicato","fret","string","hammer-on","pull-off","bend","tap","heel","toe","fingernails","other-technical"],ar=["major","minor","augmented","diminished","dominant","major-seventh","minor-seventh","diminished-seventh","augmented-seventh","half-diminished","major-minor","major-sixth","minor-sixth","dominant-ninth","major-ninth","minor-ninth","dominant-11th","major-11th","minor-11th","dominant-13th","major-13th","minor-13th","suspended-second","suspended-fourth","Neapolitan","Italian","French","German","pedal","power","Tristan",ir.UNKNOWN_HARMONY_KIND],lr='<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML '+ir.MUSICXML_VERSION_CURRENT+' Partwise//EN"\n  "http://www.musicxml.org/dtds/partwise.dtd">';r.registerClass(ir,"com.noteflight.notation.fileformat.musicxml.MusicXmlWriter");var ur=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this._xml=null,this._score=null,this._partInfo=null,this._partClefs=null,this._unsupportedFeatures=null,this._legacy=!1,this._adjustTopStaffAligned=!1,this._cleanup_837_1545=!1,this._partDisplayLineSize=0,this._modelsById={},this._options=null,this._startingMeasureNumber=-1,this._options=e,this.stripRecordedAudio=e&&e.stripRecordedAudio,this.incrementalMode=!1}return p(t,null,[{key:"LEGACY_VERSION",get:function(){return"0.2"}},{key:"ADJUST_TOP_STAFF_VERSION",get:function(){return"0.3"}},{key:"CLEANUP_837_1545_VERSION",get:function(){return"0.3.1"}},{key:"UPGRADE_REPEAT_ENDINGS_VERSION",get:function(){return"0.3.2"}},{key:"CURRENT_VERSION",get:function(){return"0.4"}}]),p(t,[{key:"translateXml",value:function(e){jd.pushTimer("NotationXmlReader","translateXml",!1,!0);var i=e.attribute("version").toString();if("noteflightScore"!=e.name())throw new Error("Unsupported document type: "+e.name());switch(i){case t.LEGACY_VERSION:this._legacy=!0,this._adjustTopStaffAligned=!0;break;case t.ADJUST_TOP_STAFF_VERSION:this._adjustTopStaffAligned=!0;break;case t.CLEANUP_837_1545_VERSION:this._cleanup_837_1545=!0;break;case t.UPGRADE_REPEAT_ENDINGS_VERSION:this._upgradeRepeatEndings=!0;break;case t.CURRENT_VERSION:break;default:throw new Error("Unsupported <noteflightScore> version: "+i)}return this._xml=e,this.initialize(),this.parseScore(),jd.popTimer("NotationXmlReader","translateXml",!1,!0),this._score}},{key:"translateSequence",value:function(t){var e=new Pl,i=!0,n=!1,r=void 0;try{for(var o,s=t.child("elements").children().list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=null;null!=(l="tuplet"==a.localName()?this.parseTuplet(a,null):this.parseNotation(a))&&e.addElement(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"parseFloatElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,n=0;return t?(n=X.parseFloat(Kd.valueToString(t)),X.isNaN(n)&&(e||(i=!0),n=0)):i=!0,i&&X.trace("There has been an error parsing one of the elements of the NFXML file"),n}},{key:"initialize",value:function(){this._partInfo=[],this._partClefs=[],this._unsupportedFeatures={}}},{key:"parseScore",value:function(){this._score=new Nl;if(this.xml.has("audioMedias")){var t=!0,e=!1,i=void 0;try{for(var n,r=this.xml.child("audioMedias").child("audioMedia").list[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=this.parseAudioMedia(o);this._modelsById[s.id]=s}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}if(this.xml.has("mix")){var a=this.xml.child("mix").get(0);if(a.has("masterGain")&&(this._score.mix.masterGain=this.parseFloatElement(a.child("masterGain"))),a.has("reverbLevel")&&(this._score.mix.reverbLevel=this.parseFloatElement(a.child("reverbLevel"))),a.has("reverbType")){var l=A.xmllistToString(a.child("reverbType"));this._score.mix.reverbType="null"==l?null:l}}if(this.xml.has("title")&&(this._score.title=this.xml.child("title").toString()),this.xml.has("subtitle")&&(this._score.subtitle=this.xml.child("subtitle").toString()),this.xml.has("supertitle")&&(this._score.supertitle=this.xml.child("supertitle").toString()),this.xml.has("composer")&&(this._score.composer=this.xml.child("composer").toString()),this.xml.has("lyricist")&&(this._score.lyricist=this.xml.child("lyricist").toString()),this.xml.has("arranger")&&(this._score.arranger=this.xml.child("arranger").toString(),this._score.showArranger=!0),this.xml.has("copyright")&&(this._score.copyright=this.xml.child("copyright").toString()),this.xml.has("prompt")&&(this._score.prompt=this.xml.child("prompt").toString()),this.xml.has("defaultSlurs")&&(this._score.defaultSlurs=this.xml.child("defaultSlurs").toString()),this.xml.has("viewInfo")){var u=this.xml.child("viewInfo").get(0);this._score.viewScale=this.parseFloatElement(u.child("viewScale")),this._score.displayMode=u.child("displayMode").toString(),this._score.staffMetrics.showPartNames=u.has("showPartNames"),this._score.staffMetrics.showBarNumbers=u.has("showBarNumbers"),this._score.staffMetrics.showBarNumbersOnEachMeasure=u.has("showBarNumbersOnEachMeasure"),this._score.transposeParts=u.has("transposeParts"),u.has("showTabRhythm")&&(this._score.staffMetrics.showTabRhythm="true"==u.child("showTabRhythm").toString()),u.has("startingMeasureNumber")&&(this._startingMeasureNumber=A.numberToInt(this.parseFloatElement(u.child("startingMeasureNumber"))))}if(this.xml.has("scoreMetrics")&&this.parseStaffMetrics(this._score.staffMetrics,this.xml),this.xml.has("pageMetrics")&&this.parsePageMetrics(this._score.pageMetrics,this.xml),this.xml.has("performanceMetrics")){var h=this.xml.child("performanceMetrics").get(0);h.has("graceNoteBeatFraction")&&(this._score.performanceMetrics.graceNoteBeatFraction=this.parseFloatElement(h.child("graceNoteBeatFraction"))),h.has("graceNoteTime")&&(this._score.performanceMetrics.graceNoteTime=this.parseFloatElement(h.child("graceNoteTime")))}var c=!0,d=!1,f=void 0;try{for(var y,g=this.xml.child("encoding").child("problems").child("error").child("text").list[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value;this._score.errors.push(p.toString())}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}var m=!0,v=!1,_=void 0;try{for(var S,L=this.xml.child("encoding").child("unsupported").child("feature").list[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var k=S.value;this._unsupportedFeatures[k.child("name").toString()]=!0}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}this.xml.has("idCounter")&&(this._score.idCounter=A.numberToInt(X.parseInt(this.xml.child("idCounter").toString())));var T=!0,E=!1,M=void 0;try{for(var b,w=this.xml.child("systemPart").list[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){var x=b.value,C=this._legacy?x.child("measures").child("measure"):x.child("staff").child("measure"),N=!0,I=!1,P=void 0;try{for(var O,Q=C.list[Symbol.iterator]();!(N=(O=Q.next()).done);N=!0){var R=O.value;this.parseMeasure(R,this.score.systemStaff)}}catch(t){I=!0,P=t}finally{try{N||null==Q.return||Q.return()}finally{if(I)throw P}}}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}var D=!0,F=!0,U=!1,V=void 0;try{for(var B,H=this.xml.child("part").list[Symbol.iterator]();!(F=(B=H.next()).done);F=!0){var $=B.value;this.parsePart($).visible&&(D=!1)}}catch(t){U=!0,V=t}finally{try{F||null==H.return||H.return()}finally{if(U)throw V}}if(D){var G=!0,Y=!1,z=void 0;try{for(var W,K=this.score.parts[Symbol.iterator]();!(G=(W=K.next()).done);G=!0){W.value.visible=!0}}catch(t){Y=!0,z=t}finally{try{G||null==K.return||K.return()}finally{if(Y)throw z}}}if(this.xml.has("audioTrack")){var j=this.xml.child("audioTrack").get(0);this._score.synchronizedTrack=this.parseAbstractSynchronizedTrack(j),this.xml.has("playback")&&"audioTrack"==this.xml.child("playback").toString()&&this._score.soloMediaTrack()}return this._score}},{key:"parseStaffMetrics",value:function(t,e){var i=e.child("scoreMetrics").get(0);i.has("musicFont")&&t.setMusicFont(i.child("musicFont").toString()),i.has("style")&&(t.style=i.child("style").toString()),i.has("autoMultiMeasureRestCreation")&&(t.autoMultiMeasureRestCreation="true"==i.child("autoMultiMeasureRestCreation").toString()),t.scoreLineSpacing=t.lineSpacing=this.parseFloatElement(i.child("lineSize")),i.has("partDisplayLineSize")&&(t.layoutSpacing=X.parseFloat(A.xmllistToString(i.child("partDisplayLineSize")))),i.has("partDisplayRespectSystemBreaks")&&(t.partDisplayRespectSystemBreaks="false"!==i.child("partDisplayRespectSystemBreaks").toString()),i.has("partDisplayLineSize")&&(this._partDisplayLineSize=X.parseFloat(A.xmllistToString(i.child("partDisplayLineSize")))),t.staffSpacing=this.parseFloatElement(i.child("staffSpacing")),t.systemSpacing=this.parseFloatElement(i.child("systemSpacing")),i.has("titlePageFirstStaffPadding")&&(t.titlePageFirstStaffPadding=this.parseFloatElement(i.child("titlePageFirstStaffPadding"))),i.has("pageTopPadding")&&(t.pageTopPadding=this.parseFloatElement(i.child("pageTopPadding"))),i.has("layoutSpacing")&&(t.layoutSpacing=this.parseFloatElement(i.child("layoutSpacing"))),i.has("verticalAutoSpace")&&(t.verticalAutoSpace="false"!==i.child("verticalAutoSpace").toString()),i.has("centerChordSymbols")&&(t.centerChordSymbols="false"!==i.child("centerChordSymbols").toString()),i.has("keepChordSymbolsApart")&&(t.keepChordSymbolsApart="false"!==i.child("keepChordSymbolsApart").toString()),i.has("systemStretch")&&(t.systemStretch=this.parseFloatElement(i.child("systemStretch"))),i.has("showMultipleHyphens")&&(t.showMultipleHyphens="true"==i.child("showMultipleHyphens")),i.has("hyphensMinPadding")&&(t.hyphensMinPadding=this.parseFloatElement(i.child("hyphensMinPadding"))),i.has("titleSize")&&(t.titleSize=this.parseFloatElement(i.child("titleSize"))),i.has("subtitleSize")&&(t.subtitleSize=this.parseFloatElement(i.child("subtitleSize"))),i.has("supertitleSize")&&(t.supertitleSize=this.parseFloatElement(i.child("supertitleSize"))),i.has("composerSize")&&(t.composerSize=this.parseFloatElement(i.child("composerSize"))),i.has("titlePagePromptSize")&&(t.titlePagePromptSize=this.parseFloatElement(i.child("titlePagePromptSize"))),i.has("copyrightSize")&&(t.copyrightSize=this.parseFloatElement(i.child("copyrightSize"))),i.has("pageNumberSize")&&(t.pageNumberSize=this.parseFloatElement(i.child("pageNumberSize"))),i.has("showCopyrightOnAllPages")&&(t.showCopyrightOnAllPages="true"==i.child("showCopyrightOnAllPages")),i.has("textProportional")&&(t.textProportional="true"==i.child("textProportional")),i.has("lyricsSize")&&(t.lyricsSize=this.parseFloatElement(i.child("lyricsSize"))),i.has("performanceTextSize")&&(t.performanceTextSize=this.parseFloatElement(i.child("performanceTextSize"))),i.has("chordSymbolSize")&&(t.chordSymbolSize=this.parseFloatElement(i.child("chordSymbolSize"))),i.has("indentationSpacing")&&(t.indentationSpacing=this.parseFloatElement(i.child("indentationSpacing"))),i.has("showBarNumbers")&&(t.showBarNumbers="true"==i.child("showBarNumbers")),i.has("showBarNumbersOnEachMeasure")&&(t.showBarNumbersOnEachMeasure="true"==i.child("showBarNumbersOnEachMeasure")),i.has("showPartNames")&&(t.showPartNames="true"==i.child("showPartNames")),i.has("partNamePosition")&&(t.partNamePosition=A.xmllistToString(i.child("partNamePosition"))),i.has("showPartNamesOnEveryPage")&&(t.showPartNamesOnEveryPage="true"==i.child("showPartNamesOnEveryPage")),i.has("showTabRhythm")&&(t.showTabRhythm="true"==i.child("showTabRhythm"))}},{key:"parsePageMetrics",value:function(t,e){var i=e.child("pageMetrics").get(0);i.has("pageSize")&&i.has("orientation")&&t.updatePageSize(A.xmllistToString(i.child("pageSize")),A.xmllistToString(i.child("orientation"))),i.has("pageMarginLeft")&&(t.pageMarginLeft=this.parseFloatElement(i.child("pageMarginLeft"))),i.has("pageMarginRight")&&(t.pageMarginRight=this.parseFloatElement(i.child("pageMarginRight"))),i.has("pageMarginTop")&&(t.pageMarginTop=this.parseFloatElement(i.child("pageMarginTop"))),i.has("pageMarginBottom")&&(t.pageMarginBottom=this.parseFloatElement(i.child("pageMarginBottom")))}},{key:"parseAbstractSynchronizedTrack",value:function(t){var e,i=t.child("url").toString();if(t.has("measureMap"))e=this.parseMeasureMap(t.child("measureMap").get(0));else{if(!t.has("tempoMap"))throw new Error("unrecognized audioTrack element content");e=this.parseTempoMap(t.child("tempoMap").get(0))}var n=Jl.createFromString(i,e);return t.has("muted")&&(n.muted=!0),n.gain=t.has("gain")?this.parseFloatElement(t.child("gain")):0,n}},{key:"parseModel",value:function(t){return"part"==t.name().toString()?this.parsePart(t):this.parseNotation(t)}},{key:"parsePart",value:function(t){var e;if(t.has("id")&&(e=t.child("id").toString()),null!=e){var i=this.score.findPartWithId(e);if(null!=i)return i}var n=new El(e);if(n.name=t.child("name").toString(),n.shortName=t.child("shortName").toString(),n.instrumentUri=t.child("instrumentUri").toString(),t.has("transposition")?n.transposition=A.numberToInt(this.parseFloatElement(t.child("transposition"))):t.has("transpose")&&(n.transpositionInterval=new $a(A.numberToInt(-A.numberToInt(this.parseFloatElement(t.child("transpose").child("diatonic")))),A.numberToInt(-A.numberToInt(this.parseFloatElement(t.child("transpose").child("chromatic")))))),n.octaveShift=A.numberToInt(t.has("octaveShift")?this.parseFloatElement(t.child("octaveShift")):0),n.gain=t.has("gain")?this.parseFloatElement(t.child("gain")):0,n.pan=t.has("pan")?this.parseFloatElement(t.child("pan")):0,n.muted=t.has("muted"),n.noteflightTrackMuted=t.has("noteflightTrackMuted"),n.visible=!t.has("hidden"),n.barlineBreak=t.has("barlineBreak"),n.directionsAboveStaff=t.has("directionsAboveStaff"),n.hasPedal=t.has("hasPedal"),(t.has("scoreMetrics")||t.has("pageMetrics")||0!=this._partDisplayLineSize)&&(n.staffMetrics=this._score.staffMetrics.clone(),n.pageMetrics=this._score.pageMetrics.clone()),0!=this._partDisplayLineSize&&(n.staffMetrics.scoreLineSpacing=this._partDisplayLineSize),t.has("scoreMetrics")&&this.parseStaffMetrics(n.staffMetrics,t),t.has("pageMetrics")&&this.parsePageMetrics(n.pageMetrics,t),!this.incrementalMode){var r=this._legacy?t.child("measures"):t.child("staff"),o=!0,s=!1,a=void 0;try{for(var l,u=r.list[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=this.parseStaff(h,n);if(c!=this.score.systemStaff)for(;c.measures.length<this.score.systemStaff.measures.length;)c.insertBlankMeasureAt(c.measures.length,this.score.systemStaff.getMeasureAt(c.measures.length).measureInfo)}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}if(t.has("audioTracks")&&!this.stripRecordedAudio){var d=!0,f=!1,y=void 0;try{for(var g,p=t.child("audioTracks").children().list[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value,v=this.parseAudioTrack(m);n.addChild(v)}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}}return n}},{key:"parseStaff",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new Rl;if(null!=this._score&&(null!=i?this._score.addStaffAt(n,i):this._score.addStaff(n)),this.incrementalMode){var r=t.child("part").get(0);null!=r&&(e=this.parsePart(r))}n.part=e;var o=!0,s=!1,a=void 0;try{for(var l,u=t.child("overrideClef").list[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;n.overrideClef=this.parseClef(h,n)}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}var c=!0,d=!1,f=void 0;try{for(var y,g=t.child("measure").list[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value;this.parseMeasure(p,n)}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}return""===e.instrumentUri&&n.getMeasureAt(0).clef.unpitched&&(e.instrumentUri="percussion/drums/standard"),n}},{key:"parseMeasure",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new hl;n.tempo=new Yl,n.keySignature=new Ga(0,0,!0);var r=A.as(this._partInfo[e.index],fl),o=A.as(this._partClefs[e.index],Mn);if(e==this.score.systemStaff)null!=i?e.addMeasureAt(n,i):e.addMeasure(n),null!=r&&(n.measureInfo=r);else{var s=this.score.systemStaff.getMeasureAt(A.intToUint(e.numChildren));if(null==s)return null;null!=i?e.addMeasureAt(n,i):e.addMeasure(n),n.measureInfo=s.measureInfo,null!=o&&(n.clef=o)}n.breakType=t.has("breakType")?t.child("breakType").toString():null,n.startRepeat=t.has("startRepeat"),n.endRepeat=t.has("endRepeat"),n.disableCautionaries=t.has("disableCautionaries"),n.systemGap=t.has("systemGap"),n.canHideStaff=t.has("canHideStaff"),n.layoutWeight=A.unknownToNumber(t.has("layoutWeight")?t.child("layoutWeight"):1),n.leftMargin=A.unknownToNumber(t.has("leftMargin")?t.child("leftMargin"):0),n.rightMargin=A.unknownToNumber(t.has("rightMargin")?t.child("rightMargin"):0),n.isSystemMeasure&&(n.measureNumber=A.unknownToNumber(t.has("customizedMeasureNumber")?t.child("customizedMeasureNumber"):null),0===n.index&&this._startingMeasureNumber>=0&&(n.measureNumber=this._startingMeasureNumber));var a=!0,l=!1,u=void 0;try{for(var h,c=t.child("block").list[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=new wa;if(d.child("columns")){var y=!0,g=!1,p=void 0;try{for(var m,v=d.child("columns").child("column").list[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){var _=m.value,S=A.xmllistToString(_.attribute("position")),L=new xa(A.xmllistToString(_.child("text")),A.xmllistToNumber(_.attribute("weight")));""!==S&&(L.position=S),f.addColumn(L)}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}n.addBlock(f)}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}t.child("attributes").has("staffTuning")&&this.parseStaffTuning(t.child("attributes").child("staffTuning").get(0),A.xmlToString(t.child("attributes").child("capo").get(0)),e);var k,T=!0,E=!1,M=void 0;try{for(var b,w=t.child("attributes").children().list[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){var x=b.value;switch(x.name().toString()){case"timeSignature":n.timeSignature=this.parseTimeSignature(x);break;case"keySignature":n.keySignature=this.parseKeySignature(x);break;case"clef":n.clef=this.parseClef(x,e);break;case"tempo":n.tempo=this.parseTempo(x);break;case"staffTuning":case"capo":break;default:throw new Error("Unrecognized XML attribute element: "+x.toXMLString())}}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}if(this._partInfo[e.index]=n.measureInfo,this._partClefs[e.index]=n.clef,this._legacy){var C=!0,N=!1,I=void 0;try{for(var P,O=t.child("notations").children().list[Symbol.iterator]();!(C=(P=O.next()).done);C=!0){var Q=P.value,R=this.parseNotation(Q);null!=R&&(A.is(R,mn)?(k=A.numberToInt(Q.has("voice")?this.parseFloatElement(Q.child("voice")):0),n.addElement(R,k)):n.addElement(R,Kl.NON_METRICAL_VOICE_NUMBER))}}catch(t){N=!0,I=t}finally{try{C||null==O.return||O.return()}finally{if(N)throw I}}}else{this.parseRhythmContainer(t.child("notations").children(),n.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER),n,Kl.NON_METRICAL_VOICE_NUMBER),k=0;var D=!0,F=!1,U=void 0;try{for(var V,B=t.child("voices").child("voice").list[Symbol.iterator]();!(D=(V=B.next()).done);D=!0){var H=V.value;this.parseRhythmContainer(H.children(),n.getVoiceNumber(k,!0),n,k),k++}}catch(t){F=!0,U=t}finally{try{D||null==B.return||B.return()}finally{if(F)throw U}}}return n.isSystemMeasure||("concertTransposition"in this._unsupportedFeatures&&n.transposeInterval(n.staff.part.transposingInterval.inverse()),"accidentals"in this._unsupportedFeatures&&(n.invalidateAccidentals(),n.cleanUpAccidentals()),"beams"in this._unsupportedFeatures&&n.defaultBeaming(),("slurPositioning"in this._unsupportedFeatures||this._score.defaultSlurs)&&n.defaultTransposableSpans()),n.calculateDerived(),this._cleanup_837_1545&&n.isSystemMeasure&&this.cleanupDuplicateTempoNotations(n),n}},{key:"parseRhythmContainer",value:function(t,e,i,n){var r=null,o=null,s=e.timeSignature.meterDuration,a=!0,l=!1,u=void 0;try{for(var h,c=t.list[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if(null!=(o="tuplet"==d.localName()?this.parseTuplet(d,i):this.parseNotation(d))){if(o.rhythmDuration>0){if(null!=r&&o.rhythmPosition<=r.rhythmPosition){this.score.errors.push("Non-monotonic element position "+o.rhythmPosition+" after position "+r.rhythmPosition+" in "+i.path);continue}r=o}else if(this._cleanup_837_1545&&n>=0&&(A.is(o,Ca)||A.is(o,Mn))){i.addElement(o,Kl.NON_METRICAL_VOICE_NUMBER);continue}if(o.rhythmPosition<0||o.rhythmPosition+o.rhythmDuration>s)this.score.errors.push("Invalid element position "+o.rhythmPosition+" in "+i.path);else{if(A.is(o,Ca)&&this._adjustTopStaffAligned){var f=A.unknownToType(o,Ca);f.alignToStaffTop&&0!==f.dy&&i.staff.type.height!=Ul.NUM_LINES_STANDARD-1&&(f.dy-=i.staff.type.height-(Ul.NUM_LINES_STANDARD-1))}"chordSymbol"==d.localName()&&o instanceof ll&&(o.span=s),e.addElement(o)}}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}},{key:"parseNotation",value:function(t){var e=this.createNotation(t);return t.has("dx")&&(e.dx=this.parseFloatElement(t.child("dx"))),t.has("dy")&&(e.dy=this.parseFloatElement(t.child("dy"))),t.has("direction")&&(e.direction=t.child("direction").toString()),t.has("voice")&&A.is(e,ae)&&(A.unknownToType(e,ae).lastVoiceNumber=A.numberToInt(this.parseFloatElement(t.child("voice")))),t.has("cue")&&(e.cue=!0),this.parseColor(t,e),e}},{key:"parseColor",value:function(t,e){if(t.has("color")){var i=t.child("color").toString();"#"==i.charAt(0)&&(i=i.slice(1)),e.color=A.numberToUint(X.parseInt(i,16))}t.has("hidden")&&(e.color=he.HIDDEN_COLOR)}},{key:"parseTuplet",value:function(t,e){var i=new Xl(A.numberToInt(this.parseFloatElement(t.child("position"))),A.numberToUint(this.parseFloatElement(t.child("units"))),A.numberToUint(this.parseFloatElement(t.child("unitValue"))),A.numberToUint(this.parseFloatElement(t.child("rhythmUnits"))),A.numberToUint(this.parseFloatElement(t.child("rhythmValue"))));t.has("voice")&&(i.lastVoiceNumber=A.numberToInt(this.parseFloatElement(t.child("voice")))),t.has("tremolo")&&(i.tremolo=!0),t.has("showActualNumber")&&(i.showActualNumber="true"==t.child("showActualNumber").toString()),t.has("showNormalNumber")&&(i.showNormalNumber="true"==t.child("showNormalNumber").toString()),t.has("showBracket")&&(i.showBracket="true"==t.child("showBracket").toString());var n=t.child("contents").children();return 0!==n.length()&&this.parseRhythmContainer(n,i,e,Kl.UNKNOWN_VOICE_NUMBER),i}},{key:"createNotation",value:function(t){switch(t.name().toString()){case"note":return this.parseNote(t);case"lyric":return this.parseLyric(t);case"noteSet":var e=new Sn;this.parseNoteSet(t,e),this.parseValueNotation(t,e);var i=!0,n=!1,r=void 0;try{for(var o,s=t.child("note").list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.addNote(A.as(this.parseNotation(a),de))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var l=!0,u=!1,h=void 0;try{for(var c,d=t.child("lyric").list[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;e.addLyric(this.parseLyric(f))}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}var y=!0,g=!1,p=void 0;try{for(var m,v=t.child("annotation").list[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){var _=m.value;e.addAnnotation(this.parseAnnotation(_))}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}var S=!0,L=!1,k=void 0;try{for(var T,E=t.child("articulation").list[Symbol.iterator]();!(S=(T=E.next()).done);S=!0){var M=T.value;e.addArticulation(M.text().toString())}}catch(t){L=!0,k=t}finally{try{S||null==E.return||E.return()}finally{if(L)throw k}}return t.has("tremolo")&&(e.tremolo=A.xmlToInt(t.child("tremolo").get(0))),t.has("arpeggio")&&(e.arpeggio=A.xmlToString(t.child("arpeggio").get(0))),e;case"timeSignature":return this.parseTimeSignature(t);case"keySignature":return this.parseKeySignature(t);case"tempo":return this.parseTempo(t);case"clef":return this.parseClef(t);case"barline":return this.parseBarline(t);case"tacet":var b=new Gl,w=!0,x=!1,C=void 0;try{for(var N,I=t.child("annotation").list[Symbol.iterator]();!(w=(N=I.next()).done);w=!0){var P=N.value;b.addAnnotation(this.parseAnnotation(P))}}catch(t){x=!0,C=t}finally{try{w||null==I.return||I.return()}finally{if(x)throw C}}var O=!0,Q=!1,R=void 0;try{for(var D,F=t.child("articulation").list[Symbol.iterator]();!(O=(D=F.next()).done);O=!0){var U=D.value;b.addArticulation(U.text().toString())}}catch(t){Q=!0,R=t}finally{try{O||null==F.return||F.return()}finally{if(Q)throw R}}return b;case"measureRepeat":var V=new vl;this.parseValueNotation(t,V);var B=!0,H=!1,$=void 0;try{for(var G,Y=t.child("annotation").list[Symbol.iterator]();!(B=(G=Y.next()).done);B=!0){var z=G.value;V.addAnnotation(this.parseAnnotation(z))}}catch(t){H=!0,$=t}finally{try{B||null==Y.return||Y.return()}finally{if(H)throw $}}var W=!0,X=!1,K=void 0;try{for(var j,q=t.child("articulation").list[Symbol.iterator]();!(W=(j=q.next()).done);W=!0){var J=j.value;V.addArticulation(J.text().toString())}}catch(t){X=!0,K=t}finally{try{W||null==q.return||q.return()}finally{if(X)throw K}}return V;case"chordSymbol":return this.parseChordSymbol(t);case"expression":return this.parseExpressionText(t);case"performance":return this.parsePerformanceText(t);case"hairpin":return this.parseHairpin(t);case"slur":return this.parseSlur(t);case"multiRest":return this.parseMultiRest(t);case"lineNotation":return this.parseLineNotation(t);case"repeatEnding":return this.parseRepeatEnding(t);case"segno":return this.parseSystemSymbol(Il,t);case"coda":return this.parseSystemSymbol(Oa,t);case xn.PRE_EFFECT:case xn.POST_EFFECT:return this.parseEffectNotation(t);default:throw new Error("Unrecognized XML notation element: "+t.toXMLString())}}},{key:"parseNoteSet",value:function(t,e){e.beam=t.has("beam"),e.topLevelBeam=t.has("topLevelBeam"),e.grace=t.has("grace"),e.explicitRestY=t.has("explicitRestY"),e.grace&&(e.appoggiatura=t.child("grace").get(0).has("appoggiatura"))}},{key:"parseValueNotation",value:function(t,e){e.rhythmPosition=A.numberToUint(X.parseFloat(A.xmllistToString(t.child("position")))),e.value=A.numberToUint(X.parseFloat(A.xmllistToString(t.child("value")))),e.dots=A.intToUint(t.child("dotted").length())}},{key:"parseBarline",value:function(t){var e=A.unknownToString(t.has("type")?t.child("type"):En.SINGLE);return new En(this.parseFloatElement(t.child("position")),e)}},{key:"parseNote",value:function(t){var e=kt.pitchFromString(A.xmllistToString(t.child("pitch"))),i=t.has("step")?"CDEFGAB".indexOf(A.xmllistToString(t.child("step"))):-1,n=t.has("accidental")?t.child("accidental").toString():null,r=t.has("tied"),o=t.has("noteHead")?t.child("noteHead").toString():null,s=new de(e,i,n,r,o);return t.has("liaison")&&(s.liaison=A.xmllistToString(t.child("liaison"))),t.has("tuning")&&(s.tuning=this.parseFloatElement(t.child("tuning"))),t.has("string")&&(s.stringIndex=A.numberToInt(this.parseFloatElement(t.child("string")))),t.has("fret")&&(s.fret=A.numberToInt(this.parseFloatElement(t.child("fret")))),t.has("incomingTie")&&(s.incomingLiaison=de.TIE_LIAISON),t.has("silent")&&(s.silent="false"!=t.child("silent").toString()),s.explicitAccidental=t.has("explicitAccidental"),s.parentheses=t.has("parentheses"),s.courtesyAccidental=t.has("courtesyAccidental"),t.has(xn.PRE_EFFECT)&&s.addPreEffect(A.as(this.parseNotation(t.child(xn.PRE_EFFECT).list[0]),xn)),t.has(xn.POST_EFFECT)&&s.addPostEffect(A.as(this.parseNotation(t.child(xn.POST_EFFECT).list[0]),xn)),s}},{key:"parseAnnotation",value:function(t){var e=new Ea;return e.username=A.xmllistToString(t.child("username")),e.text=A.xmllistToString(t.child("text")),e.created=new Date(this.parseFloatElement(t.child("created"))),e.lastModified=new Date(this.parseFloatElement(t.child("lastModified"))),e}},{key:"parseLyric",value:function(t){var e=A.xmllistToString(t.child("text")),i=A.unknownToInt(t.has("line")?t.child("line"):0),n=t.has("continued"),r=t.has("extend"),o=t.has("noninitial"),s=t.has("direction")?t.child("direction").toString():null,a=new ul(e,i,n,r,o,s);return this.parseColor(t,a),a}},{key:"parseTimeSignature",value:function(t){var e=A.xmllistToNumber(t.child("beats")),i=A.xmllistToNumber(t.child("beatType")),n=new zl(A.numberToUint(e),A.numberToUint(i));return t.has("hidden")?n.visibility=zl.HIDDEN_VISIBILITY:t.has("visibility")?n.visibility=A.xmllistToString(t.child("visibility")):n.visibility=zl.DEFAULT_VISIBILITY,t.has("symbol")&&(n.timeSymbol=A.xmllistToString(t.child("symbol"))),n}},{key:"parseKeySignature",value:function(t){var e=A.xmllistToNumber(t.child("fifths")),i=A.unknownToNumber(t.has("cancel")?t.child("cancel"):0),n=t.has("atonal"),r=new Ga(A.numberToInt(e),A.numberToInt(i),n);return t.has("mode")&&(r.mode=A.xmllistToString(t.child("mode"))),t.has("position")&&(r.rhythmPosition=A.numberToUint(this.parseFloatElement(t.child("position")))),r}},{key:"parseTempo",value:function(t){var e=A.xmllistToNumber(t.child("value")),i=A.intToUint(t.child("dotted").length()),n=A.xmllistToNumber(t.child("bpm")),r=new Yl(A.numberToUint(e),i,A.numberToUint(n)),o=!0,s=!1,a=void 0;try{for(var l,u=t.child("swing").list[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(h.child("type").length()){if(0!==A.xmllistToNumber(h.child("delta"))){r.meterMap=new Hl(A.xmllistToString(h.child("type")),A.xmllistToNumber(h.child("delta")));break}}else r.meterMap=new Hl(Hl.EIGHTH_SWING_TYPE,this.parseFloatElement(h))}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return r}},{key:"parseClef",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t.has("note")&&t.has("line")){var n=new de(kt.pitchFromString(A.xmllistToString(t.child("note")))),r=-1;t.has("displayLineCount")&&(r=this.parseFloatElement(t.child("displayLineCount")));var o=1;t.has("displayLineSpacing")&&(o=this.parseFloatElement(t.child("displayLineSpacing"))),e=new Mn(0,A.xmllistToString(t.child("sign")),A.numberToUint(this.parseFloatElement(t.child("line"))),n,5,r,o)}else{var s=A.xmllistToString(t.child("sign"));if(s==Mn.G_CLEF_SIGN)e=Mn.trebleClef();else if(s==Mn.F_CLEF_SIGN)e=Mn.bassClef();else if(s==Mn.PERCUSSION_CLEF_SIGN)e=Mn.percussionClef();else if(s==Mn.PERCUSSION2_CLEF_SIGN)e=Mn.percussion2Clef();else if(s==Mn.TAB_CLEF_SIGN)e=$l.tabClef(0,i);else{if(s!=Mn.TENOR_VOICE_CLEF_SIGN)throw new Error("Unrecognized clef XML: "+t.toXMLString());e=Mn.tenorVoiceClef()}}return t.has("position")&&(e.rhythmPosition=A.numberToUint(this.parseFloatElement(t.child("position")))),t.has("percussionMap")&&(e.percussionMap=t.child("percussionMap").toString()),e}},{key:"parseChordSymbol",value:function(t){if(this._upgradeRepeatEndings&&ll.LEGACY_REPEAT_ENDING_REGEXP.test(t.child("chord").toString())){var e=t.has("position")?this.parseFloatElement(t.child("position")):0,i=ll.TYPE_FINAL,n=this._score.staffMetrics.repeatEndingBracketEndX,r=t.child("chord").toString(),o=this._score.staffMetrics.repeatEndingBracketHeight,s=this._score.staffMetrics.repeatEndingBracketBold,a=new ll(e,0,i,n,r,o,s);return a.dy=this._score.staffMetrics.repeatEndingDistanceAboveStaff,a}var l=new Aa(A.stringToNumber(t.child("position").toString()),t.child("chord").toString());if(t.has("frame")){var u=new Da;u.strings=A.xmllistToInt(t.child("frame").child("frameStrings")),u.frets=A.xmllistToInt(t.child("frame").child("frameFrets")),t.child("frame").has("firstFret")&&(u.firstFret=A.xmllistToInt(t.child("frame").child("firstFret"))),t.child("frame").has("firstFretLocation")&&(u.firstFretLocation=A.xmllistToString(t.child("frame").child("firstFretLocation"))),t.child("frame").has("firstFretText")&&(u.firstFretText=A.xmllistToString(t.child("frame").child("firstFretText")));var h=!0,c=!1,d=void 0;try{for(var f,y=t.child("frame").child("frameNote").list[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.stringToInt(g.child("string").get(0).toString()),m=A.stringToInt(g.child("fret").get(0).toString()),v=new Fa;v.string=p,v.fret=m,g.has("fingering")&&(v.hasFingering=!0,v.fingering=g.child("fingering").get(0).toString()),g.has("barre")&&(v.hasBarre=!0,v.barre=g.child("barre").get(0).toString()),u.notes.push(v)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}l.fretboard=u}return t.has("textbox")&&(l.textbox=!0),l}},{key:"parseExpressionText",value:function(t){var e=new Ra(A.stringToNumber(t.child("position").toString()),t.child("text").toString());return t.has("textbox")&&(e.textbox=!0),e}},{key:"parsePerformanceText",value:function(t){var e=new bl(A.stringToNumber(t.child("position").toString()),t.child("text").toString());return t.has("justify")&&(e.justify=t.child("justify").toString()),t.has("textbox")&&(e.textbox=!0),t.has("customizationsForViews")&&(e.customizationsForViews=this.parseCustomizationsForViews(t.child("customizationsForViews").list[0],e)),e}},{key:"parseCustomizationsForViews",value:function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t.child("customizationsForView").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u={};l.has("dx")&&(u.dx=parseFloat(l.child("dx").toString())),l.has("dy")&&(u.dy=parseFloat(l.child("dy").toString())),this.parseColor(l,u);var h=new Qe(e,l.child("viewId").toString(),u);i.push(h)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}},{key:"parseHairpin",value:function(t){return new Va(A.stringToNumber(t.child("position").toString()),!t.has("includeGrace")||"true"==t.child("includeGrace").toString(),A.stringToNumber(t.child("span").toString()),t.child("type").toString(),A.stringToNumber(t.child("endx").toString()),A.stringToNumber(t.child("ascent").toString()))}},{key:"parseSlur",value:function(t){var e=t.has("position")?this.parseFloatElement(t.child("position")):0,i=new Ol(e,!t.has("includeGrace")||"true"==t.child("includeGrace").toString(),this.parseFloatElement(t.child("span")),this.parseFloatElement(t.child("endx")),this.parseFloatElement(t.child("ascent")));return t.has("cx1")&&t.has("cy1")&&(i.cx1=this.parseFloatElement(t.child("cx1")),i.cy1=this.parseFloatElement(t.child("cy1"))),t.has("cx2")&&t.has("cy2")&&(i.cx2=this.parseFloatElement(t.child("cx2")),i.cy2=this.parseFloatElement(t.child("cy2"))),t.has("slurHeight")&&(i.slurHeight=this.parseFloatElement(t.child("slurHeight"))),t.has("slurArticulation")&&(i.slurArticulation=t.child("slurArticulation").toString()),i}},{key:"parseMultiRest",value:function(t){return new kl(A.stringToInt(t.child("bars").toString()),A.stringToNumber(t.child("position").toString()),A.stringToNumber(t.child("span").toString()))}},{key:"parseLineNotation",value:function(t){if("trill"==t.child("type")){var e=new Wl(this.parseFloatElement(t.child("position"),!0),this.parseFloatElement(t.child("span")),t.child("type").toString(),this.parseFloatElement(t.child("endx")),t.has("ascent")?this.parseFloatElement(t.child("ascent")):0,t.child("startingText").toString());return t.has("interval")&&(e._interval=parseInt(t.child("interval").toString())),t.has("accidental")&&(e.accidental=t.child("accidental").toString()),e}var i=t.has("position")?this.parseFloatElement(t.child("position")):0,n=!t.has("includeGrace")||"true"==t.child("includeGrace").toString(),r=this.parseFloatElement(t.child("span")),o=t.child("type").toString(),s=this.parseFloatElement(t.child("endx")),a=t.child("startingText").toString(),l=t.has("bracketLength")?this.parseFloatElement(t.child("bracketLength")):0;if([ll.TYPE_INITIAL,ll.TYPE_FINAL].includes(t.child("type").toString())){var u=this._score.staffMetrics.repeatEndingBracketBold;return new ll(i,r,o,s,a,l,u)}var h=t.has("ascent")?this.parseFloatElement(t.child("ascent")):0;return new qa(i,n,r,o,s,h,a,l)}},{key:"parseRepeatEnding",value:function(t){var e=t.has("position")?this.parseFloatElement(t.child("position")):0,i=(!t.has("includeGrace")||t.child("includeGrace").toString(),this.parseFloatElement(t.child("span"))),n=t.child("type").toString(),r=this.parseFloatElement(t.child("endx")),o=t.child("startingText").toString(),s=t.has("bracketLength")?this.parseFloatElement(t.child("bracketLength")):0,a=this._score.staffMetrics.repeatEndingBracketBold;return new ll(e,i,n,r,o,s,a)}},{key:"parseSystemSymbol",value:function(t,e){var i=A.unknownToType(new t,Pa);return e.has("position")&&(i.rhythmPosition=A.numberToUint(this.parseFloatElement(e.child("position")))),i}},{key:"parseEffectNotation",value:function(t){var e=t.child("type").toString(),i=t.has("ascent")?this.parseFloatElement(t.child("ascent")):0,n=t.has("shift")?this.parseFloatElement(t.child("shift")):0;return new xn(e,i,n)}},{key:"parseMeasureMap",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=t.child("measure").list[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=new cu;l.startTime=this.parseFloatElement(a.child("startTime")),e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var u=new Eu;return u.setMeasureStartTimes(this._score,e),u}},{key:"parseTempoMap",value:function(t){var e=-1,i=new Eu,n=!0,r=!1,o=void 0;try{for(var s,a=t.child("measure").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;-1==e&&(e=this.parseFloatElement(l.child("startTime"))),i.appendEntry(new Mu(A.numberToInt(this.parseFloatElement(l.child("index"))),this.parseFloatElement(l.child("startTime"))-e,this.parseFloatElement(l.child("timeScale")),0,0))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i.offset=e,i}},{key:"parseStaffTuning",value:function(t,e,i){var n=[],r=!0,o=!1,s=void 0;try{for(var a,l=t.child("line").list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;n.push(u.child("note").toString())}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}var h=n.length,c=Ul.createTypeFromLineCount(h);c.numLines=h;var d=new Fl,f=A.numberToInt(X.parseInt(e));d.setStaffNotesFromStrings(n,f),c.staffTuning=d,i.type=c}},{key:"cleanupDuplicateTempoNotations",value:function(t){var e,i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t.measureNotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if((e=A.unknownToType(l,he)).position>0)break;A.is(e,Yl)&&i.push(e)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}if(i.length>1){for(var u=0;u<i.length;u++){var h=i[u];e=A.unknownToType(h,he),t.removeElement(e)}var c=A.as(t.tempo.clone(),Yl);t.addElement(c,Kl.NON_METRICAL_VOICE_NUMBER)}}},{key:"parseAudioMedia",value:function(t){var e=A.xmllistToString(t.attribute("id")),i=this.score.findAudioMediaWithId(e);if(null!=i)return i;var n=new Yc(e);return t.has("mediaId")&&(n.mediaId=t.child("mediaId").toString()),t.has("mediaFileId")&&(n.mediaFileId=t.child("mediaFileId").toString()),t.has("contentType")&&(n.contentType=t.child("contentType").toString()),t.has("channelCount")&&(n.channelCount=A.numberToInt(X.parseInt(t.child("channelCount").toString()))),t.has("sampleRate")&&(n.sampleRate=this.parseFloatElement(t.child("sampleRate"))),t.has("duration")&&(n.duration=this.parseFloatElement(t.child("duration"))),n}},{key:"parseAudioTrack",value:function(t){switch(A.as(t.localName(),String)){case"recordedAudioTrack":return this.parseRecordedAudioTrack(t);default:throw new Error("Unsupported AudioTrack type: "+t.localName())}}},{key:"parseRecordedAudioTrack",value:function(t){var e=new wl;if(t.has("gain")&&(e.gain=this.parseFloatElement(t.child("gain"))),t.has("pan")&&(e.pan=this.parseFloatElement(t.child("pan"))),t.has("userId")&&(e.user.userId=A.xmllistToString(t.child("userId"))),t.has("playbackEnabled")){var i=A.xmllistToString(t.child("playbackEnabled"));e.playbackEnabled="true"==i}if(t.has("audioClips")){var n=!0,r=!1,o=void 0;try{for(var s,a=t.child("audioClips").child("audioClip").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=this.parseAudioClip(l);e.addAudioClip(u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}return e}},{key:"parseAudioClip",value:function(t){var e=new Ma;if(this.incrementalMode){var i=t.child("audioMedia").get(0);if(null!=i){var n=this.parseAudioMedia(i);e.audioMedia=n}}else{var r=t.child("audioMediaId").toString(),o=this._modelsById[r];e.audioMedia=o}return e.trackStartTime=this.parseFloatElement(t.child("trackStartTime")),e.mediaStartTime=this.parseFloatElement(t.child("mediaStartTime")),e.mediaEndTime=this.parseFloatElement(t.child("mediaEndTime")),e}},{key:"xml",get:function(){return this._xml}},{key:"score",get:function(){return null==this._score&&(this.initialize(),this.parseScore()),this._score}}]),t}();r.implementsInterfaces(ur,[nn]),r.registerClass(ur,"com.noteflight.notation.fileformat.standard.NotationXmlReader");var hr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._name="US Letter",t._orientation=e.PORTRAIT,t._flashName="letter",t._width=612,t._height=792,t._justify=!0,t._pageMarginLeft=18,t._pageMarginTop=16,t._pageMarginRight=18,t._pageMarginBottom=16,t._staffMarginLeft=16,t._staffMarginTop=32,t._staffMarginRight=16,t._staffMarginBottom=32,t.verticalScoreShadowSize=14,t.horizontalScoreShadowSize=14,t._pageViewSpacing=32,t.upcomingPageBackgroundColor=16777215,t.upcomingPageBackgroundOpacity=1,t.upcomingPageTextFont="Helvetica neue",t.upcomingPageTextSize=18,t.upcomingPageTextColor=12237222,t.trackFlagX=0,t.trackFlagY=0,t.previewTextFont="Helvetica neue",t.previewTextSize=10,t.previewTextColor=9934471,t.previewTextGap=30,t.previewTextBold=!0,t}return c(e,se),p(e,null,[{key:"LANDSCAPE",get:function(){return"Landscape"}},{key:"PORTRAIT",get:function(){return"Portrait"}}]),p(e,[{key:"clone",value:function(){var t={};this.toJson(t);var i=new e;return i.fromJson(t),i}},{key:"toJson",value:function(t){t._name=this._name,t._orientation=this._orientation,t._flashName=this._flashName,t._width=this._width,t._height=this._height,t._justify=this._justify,t._pageMarginLeft=this._pageMarginLeft,t._pageMarginTop=this._pageMarginTop,t._pageMarginRight=this._pageMarginRight,t._pageMarginBottom=this._pageMarginBottom,t._staffMarginLeft=this._staffMarginLeft,t._staffMarginTop=this._staffMarginTop,t._staffMarginRight=this._staffMarginRight,t._staffMarginBottom=this._staffMarginBottom,t._pageViewSpacing=this._pageViewSpacing}},{key:"fromJson",value:function(t){this._name=t._name,this._orientation=t._orientation,this._flashName=t._flashName,this._width=t._width,this._height=t._height,this._justify=t._justify,this._pageMarginLeft=t._pageMarginLeft,this._pageMarginTop=t._pageMarginTop,this._pageMarginRight=t._pageMarginRight,this._pageMarginBottom=t._pageMarginBottom,this._staffMarginLeft=t._staffMarginLeft,this._staffMarginTop=t._staffMarginTop,this._staffMarginRight=t._staffMarginRight,this._staffMarginBottom=t._staffMarginBottom,this._pageViewSpacing=t._pageViewSpacing}},{key:"withDimensions",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=this.clone();return r.updateDimensions(t,e,i,n),r}},{key:"updateDimensions",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.name=t,this.width=i,this.height=n,this.flashName=r,this.orientation=e.PORTRAIT}},{key:"updatePortrait",value:function(){if(this.orientation==e.LANDSCAPE){var t=this.width,i=this.height;this.width=i,this.height=t,this.staffMarginLeft=this.staffMarginRight=16}this.orientation=e.PORTRAIT}},{key:"updateLandscape",value:function(){if(this.orientation==e.PORTRAIT){var t=this.width,i=this.height;this.width=i,this.height=t,this.staffMarginLeft=this.staffMarginRight=32}this.orientation=e.LANDSCAPE}},{key:"printBoundsFor",value:function(t,e,i,n){var r=Math.max(0,Math.min(this.pageMarginLeft+this.staffMarginLeft-2,(i-t)/2)),o=Math.max(0,Math.min(this.pageMarginTop+2,(n-e)/2));return new Qo(r,o,i-2*r,n-2*o)}},{key:"withHorizontalMargins",value:function(t,e,i,n){var r=this.clone();return r._pageMarginLeft=t,r._pageMarginRight=e,r._staffMarginLeft=i,r._staffMarginRight=n,r}},{key:"updatePageSize",value:function(t,i){for(var n=0;n<e.pageSizeTable.length;n++){var r=e.pageSizeTable[n];r.name==t&&this.updateDimensions(r.name,r.width,r.height,r.flashName)}i==e.LANDSCAPE?this.updateLandscape():i==e.PORTRAIT&&this.updatePortrait()}},{key:"name",get:function(){return this._name},set:function(t){var e=this._name;this._name=t,e!==t&&this._propertyChanged("name",e,t)}},{key:"orientation",get:function(){return this._orientation},set:function(t){var e=this._orientation;this._orientation=t,e!==t&&this._propertyChanged("orientation",e,t)}},{key:"flashName",get:function(){return this._flashName},set:function(t){var e=this._flashName;this._flashName=t,e!==t&&this._propertyChanged("flashName",e,t)}},{key:"width",get:function(){return this._width},set:function(t){var e=this._width;this._width=t,e!==t&&this._propertyChanged("width",e,t)}},{key:"height",get:function(){return this._height},set:function(t){var e=this._height;this._height=t,e!==t&&this._propertyChanged("height",e,t)}},{key:"justify",get:function(){return this._justify},set:function(t){var e=this._justify;this._justify=t,e!==t&&this._propertyChanged("justify",e,t)}},{key:"pageMarginLeft",get:function(){return this._pageMarginLeft},set:function(t){var e=this._pageMarginLeft;this._pageMarginLeft=t,e!==t&&this._propertyChanged("pageMarginLeft",e,t)}},{key:"pageMarginTop",get:function(){return this._pageMarginTop},set:function(t){var e=this._pageMarginTop;this._pageMarginTop=t,e!==t&&this._propertyChanged("pageMarginTop",e,t)}},{key:"pageMarginRight",get:function(){return this._pageMarginRight},set:function(t){var e=this._pageMarginRight;this._pageMarginRight=t,e!==t&&this._propertyChanged("pageMarginRight",e,t)}},{key:"pageMarginBottom",get:function(){return this._pageMarginBottom},set:function(t){var e=this._pageMarginBottom;this._pageMarginBottom=t,e!==t&&this._propertyChanged("pageMarginBottom",e,t)}},{key:"staffMarginLeft",get:function(){return this._staffMarginLeft},set:function(t){var e=this._staffMarginLeft;this._staffMarginLeft=t,e!==t&&this._propertyChanged("staffMarginLeft",e,t)}},{key:"staffMarginTop",get:function(){return this._staffMarginTop},set:function(t){var e=this._staffMarginTop;this._staffMarginTop=t,e!==t&&this._propertyChanged("staffMarginTop",e,t)}},{key:"staffMarginRight",get:function(){return this._staffMarginRight},set:function(t){var e=this._staffMarginRight;this._staffMarginRight=t,e!==t&&this._propertyChanged("staffMarginRight",e,t)}},{key:"staffMarginBottom",get:function(){return this._staffMarginBottom},set:function(t){var e=this._staffMarginBottom;this._staffMarginBottom=t,e!==t&&this._propertyChanged("staffMarginBottom",e,t)}},{key:"pageViewSpacing",get:function(){return this._pageViewSpacing},set:function(t){var e=this._pageViewSpacing;this._pageViewSpacing=t,e!==t&&this._propertyChanged("pageViewSpacing",e,t)}},{key:"contentWidth",get:function(){return this.width-(this.pageMarginLeft+this.pageMarginRight+this.staffMarginLeft+this.staffMarginRight)}},{key:"contentHeight",get:function(){return this.height-(this.pageMarginTop+this.pageMarginBottom+this.staffMarginTop+this.staffMarginBottom)}},{key:"bottomVisiblePageYPosition",get:function(){return this.height-(this.pageMarginTop+this.pageMarginBottom+this.staffMarginTop)}},{key:"pageY",get:function(){return this.pageMarginTop+this.staffMarginTop}}],[{key:"inchesToPoints",value:function(t){return 72*t}},{key:"mmToPoints",value:function(t){return t*(72/25.4)}},{key:"fromPageSize",value:function(t,i){for(var n=new e,r=0;r<e.pageSizeTable.length;r++){var o=e.pageSizeTable[r];o.name==t&&n.updateDimensions(A.unknownToString(o.name),A.unknownToNumber(o.width),A.unknownToNumber(o.height),A.unknownToString(o.flashName))}return i==e.LANDSCAPE?n.updateLandscape():i==e.PORTRAIT&&n.updatePortrait(),n}},{key:"pageSizeTable",get:function(){var t=[];return t.push(new O("US Letter",Ou.getString("pageSize.usLetter"),e.inchesToPoints(8.5),e.inchesToPoints(11),"letter")),t.push(new O("US Legal",Ou.getString("pageSize.usLegal"),e.inchesToPoints(8.5),e.inchesToPoints(14),"legal")),t.push(new O("US Tabloid",Ou.getString("pageSize.usTabloid"),e.inchesToPoints(11),e.inchesToPoints(17))),t.push(new O("A3","A3",e.mmToPoints(297),e.mmToPoints(420))),t.push(new O("A4","A4",e.mmToPoints(210),e.mmToPoints(297),"a4")),t}},{key:"pageSizeNames",get:function(){for(var t=[],i=0;i<e.pageSizeTable.length;i++)t.push(e.pageSizeTable[i].nameToShow);return t}}]),e}();r.registerClass(hr,"com.noteflight.notation.metrics.PageMetrics");var cr=function(){function t(e){y(this,t),this._xml=null,this._score=null,this._partInfo=null,this._partClefs=null,this._sequenceWriter=!1,this._score=e,this.incrementalMode=!1,this.defaultPageMetrics=new hr}return p(t,[{key:"initialize",value:function(){this._partInfo=[],this._partClefs=[]}},{key:"generateStaffMetrics",value:function(t,e){e.appendChild(tr.xml("scoreMetrics",function(e){e.text("\n                        "),e.tag("style",function(e){e.text(t.style)}),e.text("\n                        "),e.tag("lineSize",function(e){e.text(A.numberToString(t.scoreLineSpacing))}),e.text("\n                        "),e.tag("staffSpacing",function(e){e.text(A.numberToString(t.staffSpacing))}),e.text("\n                        "),e.tag("systemSpacing",function(e){e.text(A.numberToString(t.systemSpacing))}),e.text("\n                        "),e.tag("showMultipleHyphens",function(e){e.text(A.booleanToString(t.showMultipleHyphens))}),e.text("\n                        "),e.tag("hyphensMinPadding",function(e){e.text(A.numberToString(t.hyphensMinPadding))}),e.text("\n                        "),e.tag("textProportional",function(e){e.text(A.numberToString(t.textProportional))}),e.text("\n                        "),e.tag("titleSize",function(e){e.text(A.numberToString(t.titleSize))}),e.text("\n                        "),e.tag("subtitleSize",function(e){e.text(A.numberToString(t.subtitleSize))}),e.text("\n                        "),e.tag("supertitleSize",function(e){e.text(A.numberToString(t.supertitleSize))}),e.text("\n                        "),e.tag("composerSize",function(e){e.text(A.numberToString(t.composerSize))}),e.text("\n                        "),e.tag("titlePagePromptSize",function(e){e.text(A.numberToString(t.titlePagePromptSize))}),e.text("\n                        "),e.tag("copyrightSize",function(e){e.text(A.numberToString(t.copyrightSize))}),e.text("\n                        "),e.tag("pageNumberSize",function(e){e.text(A.numberToString(t.pageNumberSize))}),e.text("\n                        "),e.tag("showCopyrightOnAllPages",function(e){e.text(A.numberToString(t.showCopyrightOnAllPages))}),e.text("\n                        "),e.tag("lyricsSize",function(e){e.text(A.numberToString(t.lyricsSize))}),e.text("\n                        "),e.tag("performanceTextSize",function(e){e.text(A.numberToString(t.performanceTextSize))}),e.text("\n                        "),e.tag("chordSymbolSize",function(e){e.text(A.numberToString(t.chordSymbolSize))}),e.text("\n                        "),e.tag("indentationSpacing",function(e){e.text(A.numberToString(t.indentationSpacing))}),e.text("\n                        "),e.tag("partDisplayRespectSystemBreaks",function(e){e.text(A.booleanToString(t.partDisplayRespectSystemBreaks))}),e.text("\n                        "),e.tag("layoutSpacing",function(e){e.text(A.numberToString(t.layoutSpacing))}),e.text("\n                        "),e.tag("verticalAutoSpace",function(e){e.text(A.booleanToString(t.verticalAutoSpace))}),e.text("\n                        "),e.tag("centerChordSymbols",function(e){e.text(A.booleanToString(t.centerChordSymbols))}),e.text("\n                        "),e.tag("keepChordSymbolsApart",function(e){e.text(A.booleanToString(t.keepChordSymbolsApart))}),e.text("\n                        "),e.tag("systemStretch",function(e){e.text(A.numberToString(t.systemStretch))}),e.text("\n                        "),e.tag("musicFont",function(e){e.text(t.musicFont)}),e.text("\n                        "),e.tag("autoMultiMeasureRestCreation",function(e){e.text(A.booleanToString(t.autoMultiMeasureRestCreation))}),e.text("\n                        "),e.tag("titlePageFirstStaffPadding",function(e){e.text(A.numberToString(t.titlePageFirstStaffPadding))}),e.text("\n                        "),e.tag("pageTopPadding",function(e){e.text(A.numberToString(t.pageTopPadding))}),e.text("\n                        "),e.tag("showBarNumbers",function(e){e.text(A.booleanToString(t.showBarNumbers))}),e.text("\n                        "),e.tag("showBarNumbersOnEachMeasure",function(e){e.text(A.booleanToString(t.showBarNumbersOnEachMeasure))}),e.text("\n                        "),e.tag("showPartNames",function(e){e.text(A.booleanToString(t.showPartNames))}),e.text("\n                        "),e.tag("partNamePosition",function(e){e.text(A.booleanToString(t.partNamePosition))}),e.text("\n                        "),e.tag("showPartNamesOnEveryPage",function(e){e.text(A.booleanToString(t.showPartNamesOnEveryPage))}),e.text("\n                        "),e.tag("showTabRhythm",function(e){e.text(A.booleanToString(t.showTabRhythm))})}))}},{key:"generatePageMetrics",value:function(t,e){var i=tr.xml("pageMetrics",function(e){e.text("\n                        "),e.tag("pageSize",function(e){e.text(t.name)}),e.text("\n                        "),e.tag("orientation",function(e){e.text(t.orientation)}),e.text("\n                    "),e.tag("pageMarginLeft",function(e){e.text(t.pageMarginLeft)}),e.text("\n                    "),e.tag("pageMarginRight",function(e){e.text(t.pageMarginRight)}),e.text("\n                    "),e.tag("pageMarginTop",function(e){e.text(t.pageMarginTop)}),e.text("\n                    "),e.tag("pageMarginBottom",function(e){e.text(t.pageMarginBottom)}),e.text("\n                    ")});0!==i.children().list.length&&e.appendChild(i)}},{key:"generateScore",value:function(){var t=this,e=tr.xml("noteflightScore",function(e){e.attr("version",ur.CURRENT_VERSION),e.text("\n                    "),e.tag("title",function(e){e.text(t.score.title)}),e.text("\n                    "),e.tag("subtitle",function(e){e.text(t.score.subtitle)}),e.text("\n                    "),e.tag("composer",function(e){e.text(t.score.composer)}),e.text("\n                    "),e.tag("lyricist",function(e){e.text(t.score.lyricist)}),e.text("\n                    "),e.tag("arranger",function(e){e.text(t.score.arranger)}),e.text("\n                    "),e.tag("viewInfo",function(e){e.text("\n                        "),e.tag("viewScale",function(e){e.text(A.numberToString(t.score.viewScale))}),e.text("\n                        "),e.tag("displayMode",function(e){e.text(t.score.displayMode)}),e.text("\n                    ")}),e.text("\n                    ")});if(this.generateStaffMetrics(this.score.staffMetrics,e),""!==this.score.copyright&&e.appendChild(tr.xml("copyright",function(e){e.text(t.score.copyright)})),null!=this.score.prompt&&""!==this.score.prompt&&e.appendChild(tr.xml("prompt",function(e){e.text(t.score.prompt)})),null!=this.score.supertitle&&""!==this.score.supertitle&&e.appendChild(tr.xml("supertitle",function(e){e.text(t.score.supertitle)})),this.score.transposeParts&&e.child("viewInfo").get(0).appendChild(tr.xml("transposeParts")),this.score.defaultSlurs&&e.appendChild(tr.xml("defaultSlurs",function(t){t.text("true")})),null!=this.score.synchronizedTrack&&e.appendChild(this.generateAbstractSynchronizedTrack(this.score.synchronizedTrack)),this.score.mix&&!this.score.mix.equals(new Al)){var i=tr.xml("mix",function(e){e.text("\n                        "),e.tag("masterGain",function(e){e.text(A.numberToString(t.score.mix.masterGain))}),e.text("\n                    ")});i.appendChild(tr.xml("reverbType",function(e){e.text(t.score.mix.reverbType)})),i.appendChild(tr.xml("reverbLevel",function(e){e.text(A.numberToString(t.score.mix.reverbLevel))})),e.appendChild(i)}if(this.generatePageMetrics(this.score.pageMetrics,e),this.score.performanceMetrics&&!this.score.performanceMetrics.equals(new aa)){var n=tr.xml("performanceMetrics",function(e){e.text("\n                        "),e.tag("graceNoteBeatFraction",function(e){e.text(A.numberToString(t.score.performanceMetrics.graceNoteBeatFraction))}),e.text("\n                        "),e.tag("graceNoteTime",function(e){e.text(A.numberToString(t.score.performanceMetrics.graceNoteTime))}),e.text("\n                    ")});e.appendChild(n)}e.appendChild(tr.xml("idCounter",function(e){e.text(A.intToString(t.score.idCounter))}));var r=tr.xml("systemPart",function(t){t.text("\n                        "),t.tag("staff"),t.text("\n                    ")});e.appendChild(r);var o=!0,s=!1,a=void 0;try{for(var l,u=this.score.systemStaff.measures[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;r.child("staff").appendChild(this.generateMeasure(h,this.score.systemStaff.index))}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}var c,d=null,f=!0,y=!1,g=void 0;try{for(var p,m=this.score.staves[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value,_=A.unknownToType(v,Rl);null!=_.part&&_.part==d||(c=this.generatePart(_.part),e.appendChild(c),d=_.part),c&&c.appendChild(this.generateStaff(_))}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}if(this.score.audioMedias.length>0){var S=tr.xml("audioMedias"),L=!0,k=!1,T=void 0;try{for(var E,M=this.score.audioMedias[Symbol.iterator]();!(L=(E=M.next()).done);L=!0){var b=E.value,w=A.unknownToType(b,Yc),x=this.generateAudioMedia(w);S.appendChild(x)}}catch(t){k=!0,T=t}finally{try{L||null==M.return||M.return()}finally{if(k)throw T}}e.appendChild(S)}return e}},{key:"generatePart",value:function(t){var e=tr.xml("part");if(null==t)return e;if(null!=t.id&&""!==t.id&&e.appendChild(tr.xml("id",function(e){e.text(t.id)})),e.appendChild(tr.xml("name",function(e){e.text(t.name)})),""!==t.shortName&&e.appendChild(tr.xml("shortName",function(e){e.text(t.shortName)})),""!==t.instrumentUri&&e.appendChild(tr.xml("instrumentUri",function(e){e.text(t.instrumentUri)})),0!==t.transpositionInterval.pitches&&e.appendChild(tr.xml("transpose",function(e){e.tag("chromatic",function(e){e.text(A.intToString(-A.intToString(t.transpositionInterval.pitches)))}),e.tag("diatonic",function(e){e.text(A.intToString(-A.intToString(t.transpositionInterval.steps)))})})),0!==t.octaveShift&&e.appendChild(tr.xml("octaveShift",function(e){e.text(A.intToString(t.octaveShift))})),0!==t.gain&&e.appendChild(tr.xml("gain",function(e){e.text(A.numberToString(t.gain))})),0!==t.pan&&e.appendChild(tr.xml("pan",function(e){e.text(A.numberToString(t.pan))})),t.muted&&e.appendChild(tr.xml("muted")),t.noteflightTrackMuted&&e.appendChild(tr.xml("noteflightTrackMuted")),t.visible||e.appendChild(tr.xml("hidden")),t.barlineBreak&&e.appendChild(tr.xml("barlineBreak")),t.directionsAboveStaff&&e.appendChild(tr.xml("directionsAboveStaff")),t.hasPedal&&e.appendChild(tr.xml("hasPedal")),t.audioTracks.length>0){var i=tr.xml("audioTracks"),n=!0,r=!1,o=void 0;try{for(var s,a=t.audioTracks[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,ba),h=this.generateAudioTrack(u);i.appendChild(h)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}e.appendChild(i)}return t.staffMetrics&&this.generateStaffMetrics(t.staffMetrics,e),t.pageMetrics&&this.generatePageMetrics(t.pageMetrics,e),e}},{key:"generateStaff",value:function(t){var e=tr.xml("staff");t.overrideClef&&e.appendChild(this.generateClef(t.overrideClef,"overrideClef"));var i=!0,n=!1,r=void 0;try{for(var o,s=t.measures[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.appendChild(this.generateMeasure(a,t.index))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.incrementalMode&&(t.part&&e.appendChild(this.generatePart(t.part)));return e}},{key:"generateMeasure",value:function(t,e){var i=tr.xml("measure"),n=tr.xml("attributes"),r=tr.xml("notations"),o=tr.xml("voices");if(null!=t.breakType&&i.appendChild(tr.xml("breakType",function(e){e.text(t.breakType)})),t.startRepeat&&i.appendChild(tr.xml("startRepeat")),t.endRepeat&&i.appendChild(tr.xml("endRepeat")),t.disableCautionaries&&i.appendChild(tr.xml("disableCautionaries")),t.systemGap&&i.appendChild(tr.xml("systemGap")),t.canHideStaff&&i.appendChild(tr.xml("canHideStaff")),t.isMeasureNumberCustomized&&i.appendChild(tr.xml("customizedMeasureNumber",function(e){e.text(A.numberToString(t.customizedMeasureNumber))})),1!=t.layoutWeight&&i.appendChild(tr.xml("layoutWeight",function(e){e.text(A.numberToString(t.layoutWeight))})),0!==t.leftMargin&&i.appendChild(tr.xml("leftMargin",function(e){e.text(A.numberToString(t.leftMargin))})),0!==t.rightMargin&&i.appendChild(tr.xml("rightMargin",function(e){e.text(A.numberToString(t.rightMargin))})),t.blocks.length>0)for(var s=0;s<t.blocks.length;s++){for(var a=t.blocks[s],l=tr.xml("block",function(t){t.text("\n                            "),t.tag("columns",function(t){t.text("\n                            ")}),t.text("\n\t\t\t\t\t\t")}),u=0;u<a.columns.length;u++){var h=tr.xml("column",function(t){t.attr("weight",a.columns[u].weight),t.attr("position",a.columns[u].position),t.text("\n                                "),t.tag("text",function(t){t.text(a.columns[u].text)}),t.text("\n\t\t\t\t\t\t\t")});l.child("columns").appendChild(h)}i.appendChild(l)}i.appendChild(n),i.appendChild(r),t.isSystemMeasure||i.appendChild(o);var c=A.as(this._partInfo[e],fl),d=A.as(this._partClefs[e],Mn);this.incrementalMode?(n.appendChild(this.generateTimeSignature(t.timeSignature)),n.appendChild(this.generateKeySignature(t.keySignature)),n.appendChild(this.generateTempo(t.tempo)),null!=t.clef&&this.generateMeasureClef(t,n)):e==this.score.systemStaff.index?(null!=c&&t.timeSignature.equals(c.timeSignature)||n.appendChild(this.generateTimeSignature(t.timeSignature)),null!=c&&t.keySignature.equals(c.keySignature)||n.appendChild(this.generateKeySignature(t.keySignature)),null!=c&&t.tempo.equals(c.tempo)||n.appendChild(this.generateTempo(t.tempo))):(null==d||null!=t.clef&&!t.clef.sameAs(d))&&this.generateMeasureClef(t,n),this._partInfo[e]=t.measureInfo,this._partClefs[e]=t.clef,this.generateRhythmContext(r,t.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER));for(var f=0;f<t.numVoices;f++){var y=tr.xml("voice");this.generateRhythmContext(y,t.getVoiceNumber(f)),o.appendChild(y)}return i}},{key:"generateMeasureClef",value:function(t,e){if(A.is(t.clef,$l)){var i=A.as(t.clef,$l);i.staffNotes.length>0&&e.appendChild(this.generateStaffTuning(i.tuningNotes)),i.capo&&0!==i.capo&&e.appendChild(tr.xml("capo",function(t){t.text(A.intToString(i.capo))}))}null!=t.clef&&e.appendChild(this.generateClef(t.clef))}},{key:"generateRhythmContext",value:function(t,e){this.generateRhythmElements(t,e.elements)}},{key:"generateRhythmElements",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,ue);if(A.is(l,he)){var u=this.generateNotation(A.as(l,he));null!=u&&t.appendChild(u)}else A.is(l,Xl)&&t.appendChild(this.generateTuplet(A.as(l,Xl)))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"generateTuplet",value:function(t){var e=tr.xml("tuplet",function(e){e.text("\n                    "),e.tag("position",function(e){e.text(A.uintToString(t.rhythmPosition))}),e.text("\n                    "),e.tag("units",function(e){e.text(A.uintToString(t.units))}),e.text("\n                    "),e.tag("unitValue",function(e){e.text(A.uintToString(t.unitValue))}),e.text("\n                    "),e.tag("rhythmUnits",function(e){e.text(A.intToString(t.rhythmUnits))}),e.text("\n                    "),e.tag("rhythmValue",function(e){e.text(A.intToString(t.rhythmValue))}),e.text("\n                ")});this._sequenceWriter&&t.lastVoiceNumber>0&&e.appendChild(tr.xml("voice",function(e){e.text(A.intToString(t.lastVoiceNumber))})),t.tremolo&&e.appendChild(tr.xml("tremolo")),!1===t.showActualNumber&&e.appendChild(tr.xml("showActualNumber",function(t){t.text("false")})),!0===t.showNormalNumber&&e.appendChild(tr.xml("showNormalNumber",function(t){t.text("true")})),!1===t.showBracket&&e.appendChild(tr.xml("showBracket",function(t){t.text("false")}));var i=tr.xml("contents");return e.appendChild(i),this.generateRhythmContext(i,t),e}},{key:"generateNotation",value:function(t){var e=null,i=!0;if(A.is(t,Gl)){e=tr.xml("tacet");var n=!0,r=!1,o=void 0;try{for(var s,a=t.annotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Ea);e.appendChild(this.generateAnnotation(u))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}var h=!0,c=!1,d=void 0;try{for(var f,y=A.unknownToType(t,Gl).articulations[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.unknownToString(g);e.appendChild(tr.xml("articulation",function(t){t.text(p)}))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}else if(A.is(t,vl)){e=tr.xml("measureRepeat"),this.generateValueNotation(e,t);var m=!0,v=!1,_=void 0;try{for(var S,L=t.annotations[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var k=S.value,T=A.unknownToType(k,Ea);e.appendChild(this.generateAnnotation(T))}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}var E=!0,M=!1,b=void 0;try{for(var w,x=A.unknownToType(t,vl).articulations[Symbol.iterator]();!(E=(w=x.next()).done);E=!0){var C=w.value,N=A.unknownToString(C);e.appendChild(tr.xml("articulation",function(t){t.text(N)}))}}catch(t){M=!0,b=t}finally{try{E||null==x.return||x.return()}finally{if(M)throw b}}}else if(A.is(t,Sn)){var I=A.as(t,Sn);e=tr.xml("noteSet"),this.generateNoteSet(e,I),this.generateValueNotation(e,I);var P=!0,O=!1,Q=void 0;try{for(var R,D=I.notes[Symbol.iterator]();!(P=(R=D.next()).done);P=!0){var F=R.value;e.appendChild(this.generateNotation(F))}}catch(t){O=!0,Q=t}finally{try{P||null==D.return||D.return()}finally{if(O)throw Q}}var U=!0,V=!1,B=void 0;try{for(var H,$=I.lyrics[Symbol.iterator]();!(U=(H=$.next()).done);U=!0){var G=H.value;e.appendChild(this.generateNotation(G))}}catch(t){V=!0,B=t}finally{try{U||null==$.return||$.return()}finally{if(V)throw B}}var Y=!0,z=!1,W=void 0;try{for(var X,K=I.annotations[Symbol.iterator]();!(Y=(X=K.next()).done);Y=!0){var j=X.value,q=A.unknownToType(j,Ea);e.appendChild(this.generateAnnotation(q))}}catch(t){z=!0,W=t}finally{try{Y||null==K.return||K.return()}finally{if(z)throw W}}var J=!0,Z=!1,tt=void 0;try{for(var et,it=I.articulations[Symbol.iterator]();!(J=(et=it.next()).done);J=!0){var nt=et.value,rt=A.unknownToString(nt);e.appendChild(tr.xml("articulation",function(t){t.text(rt)}))}}catch(t){Z=!0,tt=t}finally{try{J||null==it.return||it.return()}finally{if(Z)throw tt}}I.tremolo>0&&e.appendChild(tr.xml("tremolo",function(t){t.text(A.intToString(I.tremolo))})),null!=I.arpeggio&&e.appendChild(tr.xml("arpeggio",function(t){t.text(I.arpeggio)}))}else A.is(t,zl)?e=this.generateTimeSignature(A.as(t,zl)):A.is(t,Ga)?e=this.generateKeySignature(A.as(t,Ga)):A.is(t,Yl)?e=this.generateTempo(A.as(t,Yl)):A.is(t,Mn)?e=this.generateClef(A.as(t,Mn)):A.is(t,En)?e=this.generateBarline(A.as(t,En)):A.is(t,de)?(e=this.generateNote(A.as(t,de)),i=!1):A.is(t,ul)?(e=this.generateLyric(A.as(t,ul)),i=!1):A.is(t,Aa)?e=this.generateChordSymbol(A.as(t,Aa)):A.is(t,Ra)?e=this.generateExpressionText(A.as(t,Ra)):A.is(t,bl)?e=this.generatePerformanceText(A.as(t,bl)):A.is(t,Va)?e=this.generateHairpin(A.as(t,Va)):A.is(t,Ol)?e=this.generateSlur(A.as(t,Ol)):A.is(t,kl)?e=this.generateMultiRest(A.as(t,kl)):A.is(t,ll)?e=this.generateRepeatEnding(A.as(t,ll)):A.is(t,qa)?e=this.generateLineNotation(A.as(t,qa)):A.is(t,Oa)?e=this.generateCoda(A.as(t,Oa)):A.is(t,Il)?e=this.generateSegno(A.as(t,Il)):A.is(t,xn)&&(e=this.generateEffectNotation(A.as(t,xn)));return e?(i&&t.rhythmPosition>0&&e.appendChild(tr.xml("position",function(e){e.text(A.uintToString(t.rhythmPosition))})),0!==t.privateDx&&e.appendChild(tr.xml("dx",function(e){e.text(A.numberToString(t.privateDx))})),0!==t.privateDy&&e.appendChild(tr.xml("dy",function(e){e.text(A.numberToString(t.privateDy))})),null!=t.direction&&e.appendChild(tr.xml("direction",function(e){e.text(t.direction)})),t.cue&&e.appendChild(tr.xml("cue")),this.generateColor(t,e),this._sequenceWriter&&A.is(t,ue)&&t.lastVoiceNumber==Kl.NON_METRICAL_VOICE_NUMBER&&e.appendChild(tr.xml("voice",function(t){t.text("-1")})),e):null}},{key:"generateColor",value:function(t,e){if(null!==t.privateColor&&!this.isBlack(t.privateColor)&&!this.isBlack(t.effectiveColor))if(t.invisible)e.appendChild(tr.xml("hidden"));else{for(var i=t.privateColor.toString(16),n=i.length;n<6;n++)i="0"+i;i="#"+i,e.appendChild(tr.xml("color",function(t){t.text(i)}))}}},{key:"isBlack",value:function(t){return"number"==typeof t?0===t:"string"==typeof t&&0===parseInt(t)}},{key:"generateValueNotation",value:function(t,e){t.appendChild(tr.xml("value",function(t){t.text(A.uintToString(e.value))}));for(var i=0;i<e.dots;i++)t.appendChild(tr.xml("dotted"));this._sequenceWriter&&e.lastVoiceNumber>0&&t.appendChild(tr.xml("voice",function(t){t.text(A.intToString(e.lastVoiceNumber))}))}},{key:"generateNoteSet",value:function(t,e){e.beam&&t.appendChild(tr.xml("beam")),e.topLevelBeam&&t.appendChild(tr.xml("topLevelBeam")),e.explicitRestY&&t.appendChild(tr.xml("explicitRestY")),e.grace&&(e.appoggiatura?t.appendChild(tr.xml("grace",function(t){t.tag("appoggiatura")})):t.appendChild(tr.xml("grace")))}},{key:"generateBarline",value:function(t){var e=tr.xml("barline");return t.type!=En.SINGLE&&e.appendChild(tr.xml("type",function(e){e.text(t.type)})),e}},{key:"generateNote",value:function(t){var e=tr.xml("note",function(e){e.text("\n                    "),e.tag("pitch",function(e){e.text(t.pitch.toString())}),e.text("\n                    "),e.tag("step",function(e){e.text("CDEFGAB".charAt(t.step))}),e.text("\n                ")});return null!=t.accidental&&(e.appendChild(tr.xml("accidental",function(e){e.text(t.accidental)})),t.explicitAccidental&&e.appendChild(tr.xml("explicitAccidental")),t.courtesyAccidental&&e.appendChild(tr.xml("courtesyAccidental"))),t.tied?e.appendChild(tr.xml("tied")):null!=t.liaison&&e.appendChild(tr.xml("liaison",function(e){e.text(t.liaison)})),t.incomingLiaison==de.TIE_LIAISON&&e.appendChild(tr.xml("incomingTie")),null!=t.preEffect&&e.appendChild(this.generateNotation(t.preEffect)),null!=t.postEffect&&e.appendChild(this.generateNotation(t.postEffect)),null!=t.noteHead&&e.appendChild(tr.xml("noteHead",function(e){e.text(t.noteHead)})),0!==t.tuning&&e.appendChild(tr.xml("tuning",function(e){e.text(A.numberToString(t.tuning))})),t.stringIndex>=0&&e.appendChild(tr.xml("string",function(e){e.text(A.intToString(t.stringIndex))})),t.fret>=0&&e.appendChild(tr.xml("fret",function(e){e.text(A.intToString(t.fret))})),t.parentheses&&e.appendChild(tr.xml("parentheses")),t.silent&&e.appendChild(tr.xml("silent",function(e){e.text(A.booleanToString(t.silent))})),e}},{key:"generateAnnotation",value:function(t){return tr.xml("annotation",function(e){e.text("\n                    "),e.tag("username",function(e){e.text(t.username)}),e.text("\n                    "),e.tag("text",function(e){e.text(t.text)}),e.text("\n                    "),e.tag("created",function(e){e.text(A.numberToString(t.created.valueOf()))}),e.text("\n                    "),e.tag("lastModified",function(e){e.text(A.numberToString(t.lastModified.valueOf()))}),e.text("\n                ")})}},{key:"generateTimeSignature",value:function(t){var e=tr.xml("timeSignature",function(e){e.text("\n                    "),e.tag("beats",function(e){e.text(A.uintToString(t.beats))}),e.text("\n                    "),e.tag("beatType",function(e){e.text(A.uintToString(t.beatType))}),e.text("\n                ")});return t.visibility!=zl.DEFAULT_VISIBILITY&&e.appendChild(tr.xml("visibility",function(e){e.text(t.visibility)})),null!=t.timeSymbol&&e.appendChild(tr.xml("symbol",function(e){e.text(t.timeSymbol)})),e}},{key:"generateKeySignature",value:function(t){var e=tr.xml("keySignature",function(e){e.text("\n                    "),e.tag("fifths",function(e){e.text(A.intToString(t.fifths))}),e.text("\n                ")});return 0!==t.cancel&&e.appendChild(tr.xml("cancel",function(e){e.text(A.intToString(t.cancel))})),t.atonal&&e.appendChild(tr.xml("atonal")),null!=t.mode&&e.appendChild(tr.xml("mode",function(e){e.text(t.mode)})),e}},{key:"generateTempo",value:function(t){var e=tr.xml("tempo",function(e){e.text("\n                    "),e.tag("value",function(e){e.text(A.uintToString(t.value))}),e.text("\n                    "),e.tag("bpm",function(e){e.text(A.uintToString(t.bpm))}),e.text("\n                ")});if(t.dots>0&&e.appendChild(tr.xml("dotted")),t.meterMap.type==_l.SWING_TYPE){A.unknownToType(t.meterMap,Hl);e.appendChild(tr.xml("swing",function(e){e.tag("type",function(e){e.text(A.as(t.meterMap,Hl).swingType)}),e.tag("delta",function(e){e.text(A.numberToString(A.as(t.meterMap,Hl).swingDelta))})}))}return e}},{key:"generateClef",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clef",i=tr.xml(e);return t.sign==Mn.TAB_CLEF_SIGN?i.appendChild(tr.xml("sign",function(t){t.text("tab")})):(i.appendChild(tr.xml("sign",function(e){e.text(t.sign)})),i.appendChild(tr.xml("note",function(e){e.text(t.note.pitch.toString())})),i.appendChild(tr.xml("line",function(e){e.text(A.uintToString(t.line))})),t.displayLineCount<t.numLines&&i.appendChild(tr.xml("displayLineCount",function(e){e.text(A.numberToString(t.displayLineCount))})),t.displayLineSpacing>1&&i.appendChild(tr.xml("displayLineSpacing",function(e){e.text(A.numberToString(t.displayLineSpacing))})),t.sign==Mn.PERCUSSION2_CLEF_SIGN&&null!=t.percussionMap&&i.appendChild(tr.xml("percussionMap",function(e){e.text(t.percussionMap)}))),i}},{key:"generateLyric",value:function(t){var e=tr.xml("lyric",function(e){e.text("\n                    "),e.tag("text",function(e){e.text(t.text)}),e.text("\n                ")});return t.line>0&&e.appendChild(tr.xml("line",function(e){e.text(A.intToString(t.line))})),t.continued&&e.appendChild(tr.xml("continued")),t.extend&&e.appendChild(tr.xml("extend")),t.noninitial&&e.appendChild(tr.xml("noninitial")),e}},{key:"generateChordSymbol",value:function(t){var e=tr.xml("chordSymbol",function(e){e.text("\n                    "),e.tag("chord",function(e){e.text(t.text)}),e.text("\n                ")});if(null!=t.fretboard){var i=tr.xml("frame");if(i.appendChild(tr.xml("frameStrings",function(e){e.text(A.intToString(t.fretboard.strings))})),i.appendChild(tr.xml("frameFrets",function(e){e.text(A.intToString(t.fretboard.frets))})),0!==t.fretboard.firstFret){var n=tr.xml("firstFret",function(e){e.text(A.intToString(t.fretboard.firstFret))});i.appendChild(n)}if(null!=t.fretboard.firstFretLocation){var r=tr.xml("firstFretLocation",function(e){e.text(t.fretboard.firstFretLocation)});i.appendChild(r)}if(null!=t.fretboard.firstFretText){var o=tr.xml("firstFretText",function(e){e.text(t.fretboard.firstFretText)});i.appendChild(o)}var s=!0,a=!1,l=void 0;try{for(var u,h=t.fretboard.notes[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=tr.xml("frameNote",function(t){t.tag("string",function(t){t.text(A.intToString(c.string))}),t.tag("fret",function(t){t.text(A.intToString(c.fret))})});c.hasFingering&&d.appendChild(tr.xml("fingering",function(t){t.text(c.fingering)})),c.hasBarre&&d.appendChild(tr.xml("barre",function(t){t.text(c.barre)})),i.appendChild(d)}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}e.appendChild(i)}return t.textbox&&e.appendChild(tr.xml("textbox")),e}},{key:"generateExpressionText",value:function(t){var e=tr.xml("expression",function(e){e.text("\n                    "),e.tag("text",function(e){e.text(t.text)}),e.text("\n                ")});return t.textbox&&e.appendChild(tr.xml("textbox")),e}},{key:"generatePerformanceText",value:function(t){var e=tr.xml("performance",function(e){e.text("\n                    "),e.tag("text",function(e){e.text(t.text)}),e.text("\n                ")});if(null!=t.justify&&e.appendChild(tr.xml("justify",function(e){e.text(t.justify)})),t.textbox&&e.appendChild(tr.xml("textbox")),t.customizationsForViews.length>0){var i=this.generateCustomizationsForViews(t.customizationsForViews);e.appendChild(i)}return e}},{key:"generateCustomizationsForViews",value:function(t){for(var e=this,i=tr.xml("customizationsForViews",function(t){t.text("\n                    ")}),n=function(n){var r=t[n],o=tr.xml("customizationsForView",function(t){t.tag("viewId",function(t){t.text(r.viewId)}),t.text("\n                    "),null!==r.dx&&(t.tag("dx",function(t){t.text(r.dx)}),t.text("\n                    ")),null!==r.dy&&(t.tag("dy",function(t){t.text(r.dy)}),t.text("\n                    "))});e.generateColor(r,o),i.appendChild(o)},r=0;r<t.length;r++)n(r);return i}},{key:"generateHairpin",value:function(t){var e=tr.xml("hairpin",function(e){e.text("\n                    "),e.tag("span",function(e){e.text(A.numberToString(t.span))}),e.text("\n                    "),e.tag("endx",function(e){e.text(A.numberToString(t.endx))}),e.text("\n                    "),e.tag("ascent",function(e){e.text(A.numberToString(t.ascent))}),e.text("\n                    "),e.tag("type",function(e){e.text(t.type)}),e.text("\n                ")});return t.includeGrace||e.appendChild(tr.xml("includeGrace",function(t){t.text("false")})),e}},{key:"generateSlur",value:function(t){var e=tr.xml("slur",function(e){e.text("\n                    "),e.tag("span",function(e){e.text(A.numberToString(t.span))}),e.text("\n                    "),e.tag("endx",function(e){e.text(A.numberToString(t.endx))}),e.text("\n                    "),e.tag("ascent",function(e){e.text(A.numberToString(t.ascent))}),e.text("\n                ")});return t.includeGrace||e.appendChild(tr.xml("includeGrace",function(t){t.text("false")})),0===t.cx1&&0===t.cy1||(e.appendChild(tr.xml("cx1",function(e){e.text(A.numberToString(t.cx1))})),e.appendChild(tr.xml("cy1",function(e){e.text(A.numberToString(t.cy1))}))),0===t.cx2&&0===t.cy2||(e.appendChild(tr.xml("cx2",function(e){e.text(A.numberToString(t.cx2))})),e.appendChild(tr.xml("cy2",function(e){e.text(A.numberToString(t.cy2))}))),0!==t.slurHeight&&e.appendChild(tr.xml("slurHeight",function(e){e.text(A.numberToString(t.slurHeight))})),null!=t.slurArticulation&&e.appendChild(tr.xml("slurArticulation",function(e){e.text(t.slurArticulation)})),e}},{key:"generateMultiRest",value:function(t){return tr.xml("multiRest",function(e){e.text("\n                    "),e.tag("bars",function(e){e.text(A.intToString(t.bars))}),e.text("\n                    "),e.tag("span",function(e){e.text(A.numberToString(t.span))}),e.text("\n                ")})}},{key:"generateLineNotation",value:function(t){var e=tr.xml("lineNotation",function(e){e.text("\n                    "),e.tag("span",function(e){e.text(A.numberToString(t.span))}),e.text("\n                    "),e.tag("endx",function(e){e.text(A.numberToString(t.endx))}),e.text("\n                    "),e.tag("type",function(e){e.text(t.type)}),e.text("\n                    "),e.tag("startingText",function(e){e.text(t.startingText)}),e.text("\n                ")});if(0!==t.ascent&&e.appendChild(tr.xml("ascent",function(e){e.text(A.numberToString(t.ascent))})),0!==t.bracketLength&&e.appendChild(tr.xml("bracketLength",function(e){e.text(A.numberToString(t.bracketLength))})),A.is(t,Wl)){var i=A.as(t,Wl);e.appendChild(tr.xml("interval",function(t){t.text(i.interval)})),null!=i.accidental&&e.appendChild(tr.xml("accidental",function(t){t.text(i.accidental)}))}else t.includeGrace||e.appendChild(tr.xml("includeGrace",function(t){t.text("false")}));return e}},{key:"generateEffectNotation",value:function(t){var e=xn.PLACEMENT_BY_TYPE[t.type],i=tr.xml(e,function(e){e.text("\n                    "),e.tag("type",function(e){e.text(t.type)}),e.text("\n                ")});return 0!==t.ascent&&i.appendChild(tr.xml("ascent",function(e){e.text(A.numberToString(t.ascent))})),0!==t.shift&&i.appendChild(tr.xml("shift",function(e){e.text(A.numberToString(t.shift))})),i}},{key:"generateRepeatEnding",value:function(t){var e=tr.xml("repeatEnding",function(e){e.text("\n                    "),e.tag("span",function(e){e.text(A.numberToString(t.span))}),e.text("\n                    "),e.tag("endx",function(e){e.text(A.numberToString(t.endx))}),e.text("\n                    "),e.tag("type",function(e){e.text(t.type)}),e.text("\n                    "),e.tag("startingText",function(e){e.text(t.startingText)}),e.text("\n                ")});return 0!==t.ascent&&e.appendChild(tr.xml("ascent",function(e){e.text(A.numberToString(t.ascent))})),0!==t.bracketLength&&e.appendChild(tr.xml("bracketLength",function(e){e.text(A.numberToString(t.bracketLength))})),t.includeGrace||e.appendChild(tr.xml("includeGrace",function(t){t.text("false")})),e}},{key:"generateAbstractSynchronizedTrack",value:function(t){var e=tr.xml("audioTrack");return e.appendChild(tr.xml("url",function(e){e.text(t.audioUrl)})),e.appendChild(this.generateTemporalMap(t.temporalMap)),t.muted&&e.appendChild(tr.xml("muted")),0!==t.gain&&e.appendChild(tr.xml("gain",function(e){e.text(A.numberToString(t.gain))})),e}},{key:"generateTemporalMap",value:function(t){for(var e=tr.xml("tempoMap"),i=0;i<t.length;i++){var n=t.getEntryAt(i);e.appendChild(tr.xml("measure",function(e){e.text("\n                                    "),e.tag("index",function(t){t.text(A.intToString(n.measureIndex))}),e.text("\n                                    "),e.tag("startTime",function(e){e.text(A.numberToString(n.onset+t.offset))}),e.text("\n                                    "),e.tag("timeScale",function(t){t.text(A.numberToString(n.timescale))}),e.text("\n                                ")}))}return e}},{key:"generateStaffTuning",value:function(t){for(var e=tr.xml("staffTuning"),i=0;i<t.length;i++){var n=A.as(t[i],de);e.appendChild(tr.xml("line",function(t){t.text("\n                        "),t.tag("note",function(t){t.text(n.pitch.toString())}),t.text("\n                    ")}))}return e}},{key:"generateCoda",value:function(t){return tr.xml("coda")}},{key:"generateSegno",value:function(t){return tr.xml("segno")}},{key:"generateAudioMedia",value:function(t){var e=tr.xml("audioMedia");return e.setAttribute("id",t.id),t.mediaId&&e.appendChild(tr.xml("mediaId",function(e){e.text(t.mediaId)})),t.mediaFileId&&e.appendChild(tr.xml("mediaFileId",function(e){e.text(t.mediaFileId)})),t.contentType&&e.appendChild(tr.xml("contentType",function(e){e.text(t.contentType)})),e.appendChild(tr.xml("channelCount",function(e){e.text(A.intToString(t.channelCount))})),t.sampleRate&&e.appendChild(tr.xml("sampleRate",function(e){e.text(A.numberToString(t.sampleRate))})),t.duration&&e.appendChild(tr.xml("duration",function(e){e.text(A.numberToString(t.duration))})),e}},{key:"generateAudioTrack",value:function(t){return A.is(t,wl)?this.generateRecordedAudioTrack(A.unknownToType(t,wl)):tr.xml("unknownAudioTrack")}},{key:"generateRecordedAudioTrack",value:function(t){var e=tr.xml("recordedAudioTrack");t.gain&&e.appendChild(tr.xml("gain",function(e){e.text(A.numberToString(t.gain))})),t.pan&&e.appendChild(tr.xml("pan",function(e){e.text(A.numberToString(t.pan))})),t.user.userId&&e.appendChild(tr.xml("userId",function(e){e.text(t.user.userId)})),e.appendChild(tr.xml("playbackEnabled",function(e){e.text(A.booleanToString(t.playbackEnabled))}));var i=tr.xml("audioClips"),n=!0,r=!1,o=void 0;try{for(var s,a=t.audioClips[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Ma),h=this.generateAudioClip(u);i.appendChild(h)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e.appendChild(i),e}},{key:"generateAudioClip",value:function(t){var e=this,i=tr.xml("audioClip",function(i){i.text("\n                  "),e.incrementalMode||i.tag("audioMediaId",function(e){e.text(t.audioMedia.id)}),i.text("\n                  "),i.tag("trackStartTime",function(e){e.text(A.numberToString(t.trackStartTime))}),i.text("\n                  "),i.tag("mediaStartTime",function(e){e.text(A.numberToString(t.mediaStartTime))}),i.text("\n                  "),i.tag("mediaEndTime",function(e){e.text(A.numberToString(t.mediaEndTime))}),i.text("\n                ")});if(this.incrementalMode){var n=this.generateAudioMedia(t.audioMedia);i.appendChild(n)}return i}},{key:"xml",get:function(){return null==this._xml&&(this.initialize(),this._xml=this.generateScore()),this._xml}},{key:"score",get:function(){return this._score}}],[{key:"generateSequence",value:function(e){var i=tr.xml("sequence"),n=tr.xml("elements"),r=new t(null);return r._sequenceWriter=!0,r.generateRhythmElements(n,e.elements),i.appendChild(n),i}}]),t}();r.registerClass(cr,"com.noteflight.notation.fileformat.standard.NotationXmlWriter");var dr=function(){function t(){y(this,t)}return p(t,[{key:"createFormFromScore",value:function(e){var i=new au(e).getMeasureIndices(0);return t.getFormDescription(i)}}],[{key:"getFormDescription",value:function(t){for(var e="",i=-1,n=-1,r=function(){n>i&&(""!==e&&(e+=", "),e+=(i+1).toString(),n>i+1&&(e+="-"+n.toString()))},o=0;o<t.length;o++){var s=A.unknownToInt(t[o]);s!=n&&(r(),i=s),n=s+1}return r(),e}}]),t}();r.registerClass(dr,"com.noteflight.notation.fileformat.swperformance.NoteflightToFormTranslator");var fr=function(){function t(){y(this,t)}return p(t,[{key:"createJSONObjectFromScore",value:function(t,e,i){var n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.initialTempo.bpm;o=A.intToUint(Math.floor(o*Math.pow(2,e.speedAdjustment))),n=r?t.audibleStaves.length?t.audibleStaves.slice():t.visibleStaves.slice():t.audibleStaves.slice();var s=e.renderStaves(n,{startMeasureIndex:A.intToUint(i),playAllPassedStavesNFTracksOnly:r}),a=this.getPerformance(s);return 0===a.duration&&r?null:{parts:this.getParts(n,r),performance:a,timeMap:this.getTimeMap(s),noteTimes:this.getNoteTimes(s),scoreMix:{masterGain:t.mix.masterGain,reverbType:t.mix.reverbType,reverbLevel:t.mix.reverbLevel}}}},{key:"getParts",value:function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Rl),h=u.part,c=h.muted;e&&!u.score.audibleStaves.length&&(c=!1),i.push({name:h.name,shortName:h.shortName,instrumentUri:h.instrumentUri,libraryLocation:h.libraryLocation,midiPatch:h.midiPatch,gain:h.gain,pan:h.pan,muted:c,audioTracks:[],recordedAudioTracks:[]})}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}},{key:"getPerformance",value:function(t){var e=t.performance,i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e.elements[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l,u=s.value;if(A.is(u,td)){var h=A.as(u,td);if(l={onset:h.onset,duration:h.duration,tunedOrdinal:h.tunedOrdinal,velocity:h.velocity,channel:h.channel},h.tuning&&(l.tuning=h.tuning),h.articulation&&h.articulation.value!=ed.NORMAL&&(l.articulationValue=h.articulation.value),h.ornament,h.pitchModulations){l.pitchModulations=h.pitchModulations,l.modulationsList=[];var c=A.unknownToType(t.scorePositionMap,Eu);if(null!=c)for(var d=0;d<h.pitchModulations.length;d++)l.modulationsList.push({modEndTime:c.scorePositionToTime(h.onset+h.pitchModulations[d].endTime),modStartTime:c.scorePositionToTime(h.onset+h.pitchModulations[d].startTime)})}i.push(l)}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return{duration:e.duration,lastOnset:e.lastOnset,endTime:e.endTime,elements:i}}},{key:"getTimeMap",value:function(t){var e=[],i=A.unknownToType(t.scorePositionMap,Eu);if(null!=i)for(var n=0;n<i.length;n++){var r=i.getEntryAt(n);e.push({scorePosition:r.scorePosition,onset:r.onset,timescale:r.timescale})}return e}},{key:"getNoteTimes",value:function(t){return $.map(t.performance.elements,function(e){var i=e.onset+e.duration,n=A.unknownToType(t.scorePositionMap,Eu);if(null!=n)return{startTime:n.scorePositionToTime(e.onset),endTime:n.scorePositionToTime(i)}})}}]),t}();r.registerClass(fr,"com.noteflight.notation.fileformat.swperformance.NoteflightToStandingWavePerformanceTranslator");var yr=function t(){y(this,t)};r.registerClass(yr,"com.noteflight.notation.glyph.IGlyph");var gr=function(){function t(e,i){y(this,t),this._w=NaN,this._h=NaN,this._w=e,this._h=i}return p(t,[{key:"createDisplayObject",value:function(t){return new rc}},{key:"originX",get:function(){return 0}},{key:"originY",get:function(){return 0}},{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"text",set:function(t){}}]),t}();r.implementsInterfaces(gr,[yr]),r.registerClass(gr,"com.noteflight.notation.glyph.EmptyGlyph");var pr=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,gr),p(e,[{key:"createDisplayObject",value:function(t){var e=new rc,i=e.graphics;return $c.beginBackgroundFill(i,t),i.drawRect(0,0,this.width,this.height),i.endFill(),e}}]),e}();r.registerClass(pr,"com.noteflight.notation.glyph.BackgroundGlyph");var mr=function t(){y(this,t)};r.registerClass(mr,"com.noteflight.notation.glyph.IGlyphFoundry");var vr=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y(this,t),this.metrics=null,this.clefGlyphs={},this.accidentalGlyphs={},this.restGlyphs={},this.noteHeadGlyphMaps={},this.noteHeadMetricsMaps={},this.articulationAboveGlyphs={},this.articulationBelowGlyphs={},this.tremoloGlyphs={},this.noteFlagGlyphs={},this.barlineGlyphs={},this.otherGlyphs={},this.timeSignatureGlyphs={},this.tabGlyphs={},this.tupletNumberGlyphs={},this.chordSymbolGlyphs={},this.tabArticulationMap={closed:"tap"},this.deltaX=0,this.deltaY=0,this.descriptor=null,this.glyphSpriteFactoryGenerator=null,this.fallbackFoundry=null,this.metrics=e,this.descriptor=i,this.glyphSpriteFactoryGenerator=n,this.fallbackFoundry=r}return p(t,null,[{key:"RHYTHM_DOT",get:function(){return"rhythmDot"}},{key:"FLAG_DOWN",get:function(){return"flagDown"}},{key:"FLAG_UP",get:function(){return"flagUp"}},{key:"BUZZ",get:function(){return"buzz"}},{key:"KEEP_WITH_NEXT",get:function(){return"keepWithNext"}},{key:"PAGE_BREAK",get:function(){return"pageBreak"}},{key:"SYSTEM_BREAK",get:function(){return"systemBreak"}}]),p(t,[{key:"getScaledFoundry",value:function(t){throw new Error("getScaledFoundry() not implemented")}},{key:"initializeGlyphs",value:function(){if(this.descriptor){var e=!0,i=!1,n=void 0;try{for(var r,o=this.descriptor.clefs[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.clefGlyphs[s.sign]=this.glyphFromDescriptor(s.glyph)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var a=!0,l=!1,u=void 0;try{for(var h,c=this.descriptor.accidentals[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;this.accidentalGlyphs[d.sign]=this.glyphFromDescriptor(d.glyph)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}var f=!0,y=!1,g=void 0;try{for(var p,m=this.descriptor.noteheads[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value,_=v.type,S={};this.noteHeadGlyphMaps[_]=S;var L={};this.noteHeadMetricsMaps[_]=L;var k=!0,T=!1,E=void 0;try{for(var M,b=v.noteheads[Symbol.iterator]();!(k=(M=b.next()).done);k=!0){var w=M.value,x=w.value;S[x]=this.glyphFromDescriptor(w.glyph),L[x]=this.metricsFromDescriptor(w.metrics,S[x])}}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}var C=!0,N=!1,A=void 0;try{for(var I,P=this.descriptor.articulations[Symbol.iterator]();!(C=(I=P.next()).done);C=!0){var O=I.value,Q=O.type,R=O.position,D=this.glyphFromDescriptor(O.glyph);"above"!=R&&"both"!=R||(this.articulationAboveGlyphs[Q]=D),"below"!=R&&"both"!=R||(this.articulationBelowGlyphs[Q]=D)}}catch(t){N=!0,A=t}finally{try{C||null==P.return||P.return()}finally{if(N)throw A}}var F=!0,U=!1,V=void 0;try{for(var B,H=this.descriptor.ornaments[Symbol.iterator]();!(F=(B=H.next()).done);F=!0){var $=B.value;switch($.type){case"tremolo":var G=$.value,Y=this.glyphFromDescriptor($.glyph);this.tremoloGlyphs[G]=Y;break;case"buzz":this.otherGlyphs[t.BUZZ]=this.glyphFromDescriptor($.glyph)}}}catch(t){U=!0,V=t}finally{try{F||null==H.return||H.return()}finally{if(U)throw V}}var z=!0,W=!1,X=void 0;try{for(var K,j=this.descriptor.rests[Symbol.iterator]();!(z=(K=j.next()).done);z=!0){var q=K.value,J=!0,Z=!1,tt=void 0;try{for(var et,it=q.rests[Symbol.iterator]();!(J=(et=it.next()).done);J=!0){var nt=et.value;nt.type?this.restGlyphs[""+nt.value+nt.type]=this.glyphFromDescriptor(nt.glyph):this.restGlyphs[nt.value]=this.glyphFromDescriptor(nt.glyph)}}catch(t){Z=!0,tt=t}finally{try{J||null==it.return||it.return()}finally{if(Z)throw tt}}}}catch(t){W=!0,X=t}finally{try{z||null==j.return||j.return()}finally{if(W)throw X}}var rt=!0,ot=!1,st=void 0;try{for(var at,lt=this.descriptor.barlines[Symbol.iterator]();!(rt=(at=lt.next()).done);rt=!0){var ut=at.value;this.barlineGlyphs[ut.type]=this.glyphFromDescriptor(ut.glyph)}}catch(t){ot=!0,st=t}finally{try{rt||null==lt.return||lt.return()}finally{if(ot)throw st}}var ht=!0,ct=!1,dt=void 0;try{for(var ft,yt=this.descriptor.chordSymbols[Symbol.iterator]();!(ht=(ft=yt.next()).done);ht=!0){var gt=ft.value;this.chordSymbolGlyphs[gt.char]=this.glyphFromDescriptor(gt.glyph)}}catch(t){ct=!0,dt=t}finally{try{ht||null==yt.return||yt.return()}finally{if(ct)throw dt}}var pt=!0,mt=!1,vt=void 0;try{for(var _t,St=this.descriptor.others[Symbol.iterator]();!(pt=(_t=St.next()).done);pt=!0){var Lt=_t.value;this.otherGlyphs[Lt.name]=this.glyphFromDescriptor(Lt.glyph)}}catch(t){mt=!0,vt=t}finally{try{pt||null==St.return||St.return()}finally{if(mt)throw vt}}}}},{key:"glyphSpecFromDescriptor",value:function(t){return this.getGlyphSpriteFactory(t.symbol)}},{key:"getGlyphSpriteFactory",value:function(t){return this.glyphSpriteFactoryGenerator.createGlyphSpriteFactory(t)}},{key:"glyphFromDescriptor",value:function(t){if(t){var e=X.isNaN(t.x)?0:t.x*this.metrics.sizeUnit,i=X.isNaN(t.y)?0:-t.y*this.metrics.sizeUnit,n=X.isNaN(t.width)?-1:t.width*this.metrics.sizeUnit,r=X.isNaN(t.height)?-1:t.height*this.metrics.sizeUnit,o=X.isNaN(t.scale)?1:t.scale,s=X.isNaN(t.spacingX)?0:t.spacingX*this.metrics.sizeUnit;return this.createGlyph(this.glyphSpecFromDescriptor(t),e,i,n,r,o,s)}throw new Error("unable to convert glyph descriptor")}},{key:"metricsFromDescriptor",value:function(t,e){var i=new jr;return t&&(i.hasStem=t.stem,i.downX=X.isNaN(t.downX)?0:t.downX,i.downY=X.isNaN(t.downY)?0:t.downY,i.upX=X.isNaN(t.upX)?e.width/this.metrics.sizeUnit:t.upX,i.upY=X.isNaN(t.upY)?0:t.upY),i}},{key:"createGlyph",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6];throw new Error("createGlyph not overridden")}},{key:"getClef",value:function(t){var e=A.unknownToType(this.clefGlyphs[t],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getClef(t)),e||(e=new gr(0,0)),e}},{key:"getAccidental",value:function(t){var e=A.unknownToType(this.accidentalGlyphs[t],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getAccidental(t)),e}},{key:"getRest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=null;return!(i=null==e?A.unknownToType(this.restGlyphs[t],yr):A.unknownToType(this.restGlyphs[t.toString()+e],yr))&&this.fallbackFoundry&&(i=this.fallbackFoundry.getRest(t,e)),i}},{key:"getNoteHead",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==e&&(e=de.NORMAL_NOTE_HEAD);var i=this.noteHeadGlyphMaps[e][Math.max(mn.QUARTER,t)];return!i&&this.fallbackFoundry&&(i=this.fallbackFoundry.getNoteHead(t,e)),i}},{key:"getArticulation",value:function(t,e,i){i&&t in this.tabArticulationMap&&(t=this.tabArticulationMap[t]);var n=e?this.articulationAboveGlyphs:this.articulationBelowGlyphs,r=A.unknownToType(n[t],yr);return!r&&this.fallbackFoundry&&(r=this.fallbackFoundry.getArticulation(t,e,i)),r}},{key:"getStemDecorationSymbol",value:function(t){var e=A.unknownToType(this.otherGlyphs[t],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getStemDecorationSymbol(t)),e}},{key:"getTremolo",value:function(t,e){var i=A.unknownToType(this.tremoloGlyphs[t],yr);return!i&&this.fallbackFoundry&&(i=this.fallbackFoundry.getTremolo(t,e)),i}},{key:"getRhythmDot",value:function(){var e=A.unknownToType(this.otherGlyphs[t.RHYTHM_DOT],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getRhythmDot()),e}},{key:"getStem",value:function(e,i,n,r,o,s){null==s&&(s=de.NORMAL_NOTE_HEAD);var a=[],l=i*this.metrics.lineSpacing,u=e>=0&&e<=mn.EIGHTH,h=A.numberToInt(Math.max(mn.QUARTER,e)),c=this.noteHeadMetricsMaps[s][h],d=(n?c.downX:c.upX)*this.metrics.sizeUnit,f=(n?c.downY:c.upY)*this.metrics.sizeUnit;if(c.hasStem||u&&!o){var y=new Jr(l,this.metrics.stemThickness*this.metrics.sizeUnit,d,f,n);if(o){var g=r?this.metrics.graceSlashFlags:this.metrics.graceSlashBeams;y.setSlash(g.x*this.metrics.lineSpacing,g.y*this.metrics.lineSpacing,g.width*this.metrics.lineSpacing)}a.push(y)}if(r&&u&&(!o||c.hasStem)){var p=A.unknownToType(this.otherGlyphs[(n?t.FLAG_DOWN:t.FLAG_UP)+e.toString()],Nr);a.push(p.offset(d,n?l:-l))}return a}},{key:"getBarline",value:function(t){var e=A.unknownToType(this.barlineGlyphs[t],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getBarline(t)),e}},{key:"getKeepWithNext",value:function(){var e=A.unknownToType(this.otherGlyphs[t.KEEP_WITH_NEXT],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getKeepWithNext()),e}},{key:"getTimeSignature",value:function(t){throw new Error("getTimeSignature not overridden")}},{key:"getTimeSignatureSymbol",value:function(t){var e=A.unknownToType(this.otherGlyphs[t+"Time"],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getTimeSignatureSymbol(t)),e}},{key:"getTupletNumber",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];throw new Error("getTupletNumber not overridden")}},{key:"getTabFret",value:function(t){throw new Error("getTabFret not overridden")}},{key:"getBendAlteration",value:function(t){throw new Error("getBendAlteration not overridden")}},{key:"getTempo",value:function(t,e,i){throw new Error("getTempo not overridden")}},{key:"getLineNotationStart",value:function(t){var e=this.getOtherWithSuffix(t,"LineNotationStart");return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getLineNotationStart(t)),e}},{key:"getLineNotationSegment",value:function(t){var e=this.getOtherWithSuffix(t,"LineNotationSegment");return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getLineNotationSegment(t)),e}},{key:"getLineNotationEnd",value:function(t){var e=this.getOtherWithSuffix(t,"LineNotationEnd");return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getLineNotationEnd(t)),e}},{key:"getDynamics",value:function(t){var e=this.getOtherWithSuffix(t,"Dynamics");return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getDynamics(t)),e}},{key:"getChordSymbol",value:function(t){var e=A.unknownToType(this.chordSymbolGlyphs[t],yr);return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getChordSymbol(t)),e}},{key:"getSymbol",value:function(t){var e=this.getOtherWithSuffix(t,"Symbol");return!e&&this.fallbackFoundry&&(e=this.fallbackFoundry.getSymbol(t)),e}},{key:"getOtherWithSuffix",value:function(t,e){return A.unknownToType(this.otherGlyphs[t+e],yr)}}]),t}();r.implementsInterfaces(vr,[mr]),r.registerClass(vr,"com.noteflight.notation.glyph.DescribedGlyphFoundry");var _r=function(){function t(){y(this,t),this.sizeUnit=NaN,this.lineSpacing=NaN,this.stemThickness=NaN,this.graceSlashFlags=new Qo(-.35,1.25,1,1),this.graceSlashBeams=new Qo(-.35,1,1.2,1.2)}return p(t,[{key:"scale",value:function(e){var i=new t;return i.sizeUnit=this.sizeUnit*e,i.lineSpacing=this.lineSpacing,i.stemThickness=this.stemThickness,i}}]),t}();r.registerClass(_r,"com.noteflight.notation.glyph.FoundryMetrics");var Sr=function t(){y(this,t)};r.registerClass(Sr,"com.noteflight.notation.glyph.IGlyphSpriteFactory");var Lr=function(){function t(){y(this,t)}return p(t,null,[{key:"NONE",get:function(){return"none"}},{key:"ROUND",get:function(){return"round"}},{key:"SQUARE",get:function(){return"square"}}]),t}();r.registerClass(Lr,"flash.display.CapsStyle");var kr=function(){function t(){y(this,t)}return p(t,null,[{key:"BEVEL",get:function(){return"bevel"}},{key:"MITER",get:function(){return"miter"}},{key:"ROUND",get:function(){return"round"}}]),t}();r.registerClass(kr,"flash.display.JointStyle");var Tr=function(){function t(e){y(this,t),this._glyphDef=null,this._glyphDefBounds=null,this._definitionName=null,this._definition=null,this._glyphDef=e;var i=A.unknownToObject(this._glyphDef.bounds);this._glyphDefBounds=new Qo(A.unknownToNumber(i.left),A.unknownToNumber(i.top),i.right-i.left,i.bottom-i.top)}return p(t,null,[{key:"CAPS_TABLE",get:function(){return Er}},{key:"JOINT_TABLE",get:function(){return Mr}}]),p(t,[{key:"createGlyphSprite",value:function(){this._definitionName||(this._definition=new Wr,this.drawGlyph(this._definition.graphics),this._definitionName="_nf_glyph_"+this._glyphDef.name,this._definition.defineAs(this._definitionName));var t=new Xr;return t.useDefinition(this._definition),t.definedBounds=this._glyphDefBounds,t}},{key:"drawGlyph",value:function(e){if(this._glyphDef.svgPaths){var i=!0,n=!1,r=void 0;try{for(var o,s=xt.unknownForOfSource(this._glyphDef.svgPaths)[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.fill?e.beginSvgFill(A.unknownToString(a.fill)):e.beginFill(0,1),a.transform&&e.svgTransform(A.unknownToString(a.transform)),a["stroke-width"]&&e.svgStroke("rgba(0,0,0,1)",A.unknownToString(a["stroke-width"]),A.unknownToString(a["stroke-linecap"]),A.unknownToString(a["stroke-linejoin"]),A.unknownToString(a["stroke-miterlimit"])),e.svgPath(A.unknownToString(a.d))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}else for(var l=!1,u=A.as(this._glyphDef.commands,Array),h=0;h<u.length;){switch(A.unknownToInt(u[h++])){case 1:l&&(e.endFill(),l=!1);var c=A.unknownToNumber(u[h++]),d=A.unknownToUint(u[h++]),f=(A.unknownToUint(u[h++]),A.unknownToUint(u[h++])),y=A.unknownToNumber(u[h++]);e.lineStyle(c,0,1,!1,"normal",A.unknownToString(t.CAPS_TABLE[d]),A.unknownToString(t.JOINT_TABLE[f]),y);break;case 2:l&&e.endFill(),e.beginFill(A.intToUint(u[h++]<<16|u[h++]<<8|u[h++]),u[h++]/255);break;case 3:e.moveTo(A.unknownToNumber(u[h++]),A.unknownToNumber(u[h++]));break;case 4:e.lineTo(A.unknownToNumber(u[h++]),A.unknownToNumber(u[h++]));break;case 5:e.curveTo(A.unknownToNumber(u[h++]),A.unknownToNumber(u[h++]),A.unknownToNumber(u[h++]),A.unknownToNumber(u[h++]));break;case 6:e.pushAlpha(A.unknownToNumber(u[h++]));break;case 7:e.popAlpha();break;case 8:e.endFill();break;case 9:e.lineStyle(0,0,1,!1,"normal",A.unknownToString(t.CAPS_TABLE[0]),A.unknownToString(t.JOINT_TABLE[0]),0)}}}}]),t}();r.implementsInterfaces(Tr,[Sr]);var Er=[Lr.ROUND,Lr.NONE,Lr.SQUARE],Mr=[kr.ROUND,kr.BEVEL,kr.MITER];r.registerClass(Tr,"com.noteflight.notation.glyph.GlyphJSSpriteFactory");var br=function t(){y(this,t)};r.registerClass(br,"com.noteflight.notation.glyph.IGlyphSpriteFactoryGenerator");var wr=function(){function t(e){y(this,t),this._glyphDefs=null,this._glyphDefByName=null,this._glyphDefs=e,this._glyphDefByName={};var i=!0,n=!1,r=void 0;try{for(var o,s=this._glyphDefs[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this._glyphDefByName[a.name]=a}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}return p(t,[{key:"createGlyphSpriteFactory",value:function(t){return new Tr(this._glyphDefByName[t])}}]),t}();r.implementsInterfaces(wr,[br]),r.registerClass(wr,"com.noteflight.notation.glyph.GlyphJSSpriteFactoryGenerator");var xr=function(){function t(e,i){y(this,t),this._metricsDone=!1,this._width=NaN,this._height=NaN,this._horizontalGap=0,this._glyphs=null,this._glyphs=e,this._horizontalGap=i}return p(t,[{key:"addRepeatingGlyph",value:function(t,e){for(var i=0,n=t.width+this._horizontalGap;;){if((i+=n)>=e)return;if(this._glyphs.push(t),i<=0)return}}},{key:"createDisplayObject",value:function(t){this.calculateMetrics();var e=new Wr,i=0,n=!0,r=!1,o=void 0;try{for(var s,a=this._glyphs[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=l.createDisplayObject(t);u.x=i,e.addChild(u),i+=l.width+this._horizontalGap}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return e}},{key:"calculateMetrics",value:function(){if(!this._metricsDone){this._width=this._height=0;var t=!0,e=!1,i=void 0;try{for(var n,r=this._glyphs[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this._width+=o.width+this._horizontalGap,this._height=Math.max(this._height,o.height)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._metricsDone=!0}}},{key:"originX",get:function(){return 0}},{key:"originY",get:function(){return this._glyphs.length>0?this._glyphs[0].originY:0}},{key:"width",get:function(){return this.calculateMetrics(),this._width}},{key:"height",get:function(){return this.calculateMetrics(),this._height}},{key:"text",set:function(t){}}]),t}();r.implementsInterfaces(xr,[yr]),r.registerClass(xr,"com.noteflight.notation.glyph.GlyphSeries");var Cr=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;y(this,t),this._lineWidth=NaN,this._length=NaN,this._lineWidth=i,this._length=e}return p(t,[{key:"createDisplayObject",value:function(t){var e=new Wr,i=e.graphics;return i.lineStyle(this._lineWidth,0),i.moveTo(0,0),i.lineTo(this._length,0),e}},{key:"originX",get:function(){return 0}},{key:"originY",get:function(){return 0}},{key:"width",get:function(){return this._length}},{key:"height",get:function(){return this._lineWidth}},{key:"text",set:function(t){}}]),t}();r.implementsInterfaces(Cr,[yr]),r.registerClass(Cr,"com.noteflight.notation.glyph.HLineGlyph");var Nr=function t(){y(this,t)};r.implementsInterfaces(Nr,[yr]),r.registerClass(Nr,"com.noteflight.notation.glyph.IFoundryGlyph");var Ar=function t(){y(this,t)};r.registerClass(Ar,"com.noteflight.notation.glyph.IGlyphFontLoader");var Ir=function t(){y(this,t)};r.implementsInterfaces(Ir,[vt]),r.registerClass(Ir,"com.noteflight.notation.glyph.IGlyphFoundryFactory");var Pr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(y(this,t),this._factoryMap={},this._supportAshFont=!1,this._intervalId=0,this._fontCheckedCounter=0,this._fontsToLoad=0,this.fonts_table={AshText:new x("AshText.woff",!1)},this._options=e,this._options.mockLoadedFonts){var i=!0,n=!1,r=void 0;try{for(var o,s=this._options.mockLoadedFonts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.fonts_table[a].loaded=!0}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}return p(t,null,[{key:"METRICS_POINT_SIZE",get:function(){return 20}},{key:"WIDTH_TESTS",get:function(){return Or}},{key:"TOLERANCE",get:function(){return 2}},{key:"MAX_FONT_CHECKED",get:function(){return 1e3}},{key:"FONT_CHECKED_INTERVAL",get:function(){return 100}}]),p(t,[{key:"loadGlyphsAndFonts",value:function(e){var i=e.fonts,n=(e.glyphFamily,e.supportAshFont),r=e.callback;if(this._supportAshFont=n,i)for(var o=0;o<i.length;o++)if(this.fonts_table[i[o]]&&!this.fonts_table[i[o]].loaded){if(this._fontsToLoad++,this.fonts_table[i[o]].loaded=!0,"AshText"==i[o]&&!this._supportAshFont)break;var s="<style>@font-face{font-family: '"+i[o]+"';src: url(/fonts/"+this.fonts_table[i[o]].path+");}</style>",a=X.jQuery(s);X.jQuery("head").append(a);var l=this;this._intervalId=A.unknownToUint(X.setInterval(function(){l.checkFontLoaded(r)},t.FONT_CHECKED_INTERVAL))}else o==i.length-1&&0===this._fontsToLoad&&r();else r()}},{key:"checkFontLoaded",value:function(e){this.widthTestSucceeded()||this._fontCheckedCounter*t.FONT_CHECKED_INTERVAL>=t.MAX_FONT_CHECKED?(this._fontsToLoad--,this._fontCheckedCounter==t.MAX_FONT_CHECKED&&X.trace("Error loading font"),X.clearInterval(this._intervalId),0===this._fontsToLoad&&e()):this._fontCheckedCounter++}},{key:"widthTestSucceeded",value:function(){for(var e=0;e<t.WIDTH_TESTS.length;e++)if(Math.abs(this.measureText(t.WIDTH_TESTS[e].text)-t.WIDTH_TESTS[e].width)>t.TOLERANCE)return!1;return!0}},{key:"measureText",value:function(e){var i=X.JS_document().createElement("canvas").getContext("2d"),n=t.METRICS_POINT_SIZE.toString();return n+="px AshText",i.font=n,A.unknownToNumber(i.measureText(e).width)}},{key:"getFoundryFactory",value:function(t){return this._factoryMap[t]||(this._factoryMap[t]=this.createFactory(t)),this._factoryMap[t]}},{key:"createFactory",value:function(t){var e=new so;switch("Ash"!=t||this._supportAshFont||(t="default"),t){case"Ash":return new ro(e);default:return new To(e)}}}]),t}();r.implementsInterfaces(Pr,[Ar]);var Or=[new j("test",24),new j("1234567890",77),new j("mMiIop!%&1234",99)];r.registerClass(Pr,"com.noteflight.notation.glyph.JSGlyphFontLoader");var Qr=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this)))._foundryDef=null,i._fallbackFoundryFactory=null,i._foundryDef=t,i._fallbackFoundryFactory=n,i}return c(e,At),p(e,[{key:"initialize",value:function(){this.dispatchEvent(new ct(ct.COMPLETE))}},{key:"createFoundry",value:function(t){var e=yo.fromJSON(this._foundryDef.descriptor),i=new wr(A.unknownToType(this._foundryDef.symbols,Array)),n=null;return this._fallbackFoundryFactory&&(n=this._fallbackFoundryFactory.createFoundry(t)),new no(t,e,i,40,n)}},{key:"complete",get:function(){return!0}}]),e}();r.implementsInterfaces(Qr,[Ir]),r.registerClass(Qr,"com.noteflight.notation.glyph.JSGlyphFoundryFactory");var Rr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._svg=null,t._svgGraphicsCount=0,t._stage=null,t._x=0,t._y=0,t._scaleX=1,t._scaleY=1,t._rotation=0,t._name=null,t._visible=!0,t._mask=null,t.isMask=!1,t._alpha=1,t._parent=null,t._transform=null,df.implementation==df.SVG&&(t._svg=t.svgContext.createElement("g"),t._svg.id=X.idString(u(u(t)))),t}return c(e,At),p(e,null,[{key:"DEFINE_WITH_USE",get:function(){return!1}},{key:"_frameTimer",get:function(){return Dr},set:function(t){Dr=t}}]),p(e,[{key:"shouldDraw",value:function(){return!this.isMask}},{key:"notifyAddedToStage",value:function(){this.dispatchEvent(new ct(ct.ADDED_TO_STAGE))}},{key:"notifyRemovedFromStage",value:function(){this._stage=null,this.dispatchEvent(new ct(ct.REMOVED_FROM_STAGE))}},{key:"updateTransform",value:function(){this._svg&&this._svg.setAttribute("transform","translate("+this._x+","+this._y+") scale("+this._scaleX+","+this._scaleY+") rotate("+this._rotation+")")}},{key:"getBBox",value:function(){return this._svg?this.svgContext.getBBox(this._svg):null}},{key:"getBounds",value:function(t){var e=this.getBBox(),i=e?e.x:0,n=e?e.y:0,r=e?e.width:0,o=e?e.height:0;null==t&&(t=this);var s=this._svg.getTransformToElement(t._svg),a=this.svgContext.transformPoint(A.unknownToNumber(i),A.unknownToNumber(n),s),l=this.svgContext.transformPoint(A.unknownToNumber(i)+A.unknownToNumber(r),A.unknownToNumber(n)+A.unknownToNumber(o),s);return new Qo(A.unknownToNumber(a.x),A.unknownToNumber(a.y),l.x-a.x,l.y-a.y)}},{key:"getRect",value:function(t){return this.getBounds(t)}},{key:"globalToLocal",value:function(t){var e=this.stage.stageOffset,i=this.svgContext.transformPoint(e.x+t.x,e.y+t.y,this.screenCTM.inverse());return new If(A.unknownToNumber(i.x),A.unknownToNumber(i.y))}},{key:"localToGlobal",value:function(t){var e=this.stage.stageOffset,i=this.svgContext.transformPoint(t.x,t.y,this.screenCTM);return new If(i.x-e.x,i.y-e.y)}},{key:"addEventListener",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(s(h(e.prototype),"addEventListener",this).call(this,t,i,n,r,o),t==ct.ENTER_FRAME){var a=e._frameTimer;a||(a=new By(50),e._frameTimer=a,a.start()),a.addEventListener(Nf.TIMER,xt.bindMethod(this,this.notifyFrame))}}},{key:"removeEventListener",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(h(e.prototype),"removeEventListener",this).call(this,t,i,n),t==ct.ENTER_FRAME&&e._frameTimer&&e._frameTimer.removeEventListener(Nf.TIMER,xt.bindMethod(this,this.notifyFrame))}},{key:"defineAs",value:function(t){this._svg.id=t,this.svgContext.definitions.appendChild(this._svg)}},{key:"useDefinition",value:function(t){e.DEFINE_WITH_USE?(this._svg=this.svgContext.createElement("use"),this._svg.id=X.idString(this),this._svg.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+t._svg.id)):(this._svg=t._svg.cloneNode(!0),this._svg.id=X.idString(this))}},{key:"notifyFrame",value:function(t){this.dispatchEvent(new ct(ct.ENTER_FRAME))}},{key:"updateDisplayListStats",value:function(t){s(h(e.prototype),"updateDisplayListStats",this).call(this,t),t.displayObjectCount++}},{key:"svgElement",get:function(){return this._svg}},{key:"stage",get:function(){return this._stage||this.parent&&(this._stage=this.parent.stage),this._stage}},{key:"svgContext",get:function(){return G.singleton}},{key:"screenCTM",get:function(){return this.svgContext.getScreenCTM(this._svg)}},{key:"textMeasurement",get:function(){return this.svgContext.textMeasurement}},{key:"width",get:function(){var t=this.getBBox();return null!=t?A.unknownToNumber(t.width):0},set:function(t){}},{key:"height",get:function(){var t=this.getBBox();return null!=t?A.unknownToNumber(t.height):0},set:function(t){}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updateTransform()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updateTransform()}},{key:"scaleX",get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.updateTransform()}},{key:"scaleY",get:function(){return this._scaleY},set:function(t){this._scaleY=t,this.updateTransform()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateTransform()}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible=t,this._svg&&this._svg.setAttribute("visibility",t?"visible":"hidden")}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),t&&(t.isMask=!0),this._mask=t,this._svg&&this._mask&&this._mask._svg&&this._mask._svg.setAttribute("display","none")}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha=t,this._svg.setAttribute("opacity",t.toString())}},{key:"parent",get:function(){return this._parent},set:function(t){if(t!=this._parent){var e=this.stage;this._parent=t,this._stage=null,!this._parent&&e&&this.notifyRemovedFromStage(),!e&&this.stage&&this.notifyAddedToStage()}}},{key:"mouseX",get:function(){return A.unknownToNumber(this.stage.mousePositionFor(A.unknownToType(this,Fr)).x)}},{key:"mouseY",get:function(){return A.unknownToNumber(this.stage.mousePositionFor(A.unknownToType(this,Fr)).y)}},{key:"transform",get:function(){return this._transform||(this._transform=new Of(this)),this._transform},set:function(t){this._transform=this.transform}}]),e}(),Dr=null;r.registerClass(Rr,"flash.display.DisplayObject");var Fr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).mouseEnabled=!1,t._dispatchers={},t}return c(e,Rr),p(e,null,[{key:"EVENT_INFO",get:function(){return Ur},set:function(t){Ur=t}},{key:"suppressMouse",get:function(){return Vr},set:function(t){Vr=t}},{key:"_lastDomTarget",get:function(){return Br},set:function(t){Br=t}},{key:"_lastFlashTarget",get:function(){return Hr},set:function(t){Hr=t}},{key:"_lastEventType",get:function(){return $r},set:function(t){$r=t}},{key:"touchStartedCounter",get:function(){return Gr},set:function(t){Gr=t}},{key:"lastTouchMillis",get:function(){return Yr},set:function(t){Yr=t}}]),p(e,[{key:"addEventListener",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];s(h(e.prototype),"addEventListener",this).call(this,t,i,n,r,o),this.initMouseEventSynthesis(this,t,n)}},{key:"initMouseEventSynthesis",value:function(t,i,n){var r=e.EVENT_INFO[i];if(this._svg&&r){var o=r.domType+(n?".capture":"");if(!this._dispatchers[o]){var s=function(o){return e.suppressMouse&&r.suppressable||t.svgDispatchMouseEvent(t,o,i,n),!0};this._dispatchers[o]=s,this._svg.addEventListener(r.domType,s,n)}}}},{key:"svgDispatchMouseEvent",value:function(t,i,n,r){r||i.target==e._lastDomTarget&&i.type==e._lastEventType||(e._lastDomTarget=i.target,e._lastEventType=A.unknownToString(i.type),e._lastFlashTarget=this);var o=!1;if(i.type==li.TOUCHSTART){var s=(new Date).getTime();s-e.lastTouchMillis>200&&(e.touchStartedCounter++,o=!0),e.lastTouchMillis=s}if(i.type==li.TOUCHEND&&(e.touchStartedCounter=Math.max(0,e.touchStartedCounter-1),e.touchStartedCounter>0&&(e.touchStartedCounter=0,o=!0)),!o&&0!==i.button)return null;var a=A.unknownToNumber(i.clientX),l=A.unknownToNumber(i.clientY),u=this.svgContext.transformPoint(a,l,this.screenCTM.inverse()),h=new li(n,!0,r,A.unknownToNumber(u.x),A.unknownToNumber(u.y),null,A.unknownToBoolean(i.ctrlKey),A.unknownToBoolean(i.altKey),A.unknownToBoolean(i.shiftKey),this.stage.mouseButton,0,A.unknownToBoolean(i.metaKey),A.unknownToBoolean(i.ctrlKey));h.target=e._lastFlashTarget;var c=this.stage.stageOffset;return h.stageX=a-c.x,h.stageY=l-c.y,this.stage.trackMouseState(h),r?this.dispatchCaptureEvent(h):this.dispatchEvent(h),h.cancelled&&i.stopPropagation(),h}}]),e}(),Ur={touchstart:new b("touchstart"),touchend:new b("touchend"),mouseDown:new b("mousedown",!0),mouseMove:new b("mousemove",!0),mouseUp:new b("mouseup",!0),click:new b("click")},Vr=!1,Br=null,Hr=null,$r=null,Gr=0,Yr=0;r.registerClass(Fr,"flash.display.InteractiveObject");var zr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._children=[],t._mouseChildren=!1,t}return c(e,Fr),p(e,[{key:"addChild",value:function(t){return this._children.push(t),this._svg&&this._svg.appendChild(t._svg),t.parent=this,t}},{key:"addChildAt",value:function(t,e){return this._svg&&(e>=this._children.length?this._svg.appendChild(t._svg):this._svg.insertBefore(t._svg,this._children[e]._svg)),this._children.splice(e,0,t),t.parent=this,t}},{key:"getChildAt",value:function(t){return this._children[t]}},{key:"contains",value:function(t){return this._children.indexOf(t)>=0}},{key:"getChildIndex",value:function(t){return this._children.indexOf(t)}},{key:"removeChild",value:function(t){var e=this._children.indexOf(t);return e>=0?(this.removeChildAt(e),t):null}},{key:"removeChildAt",value:function(t){var e=this._children[t];return this._svg&&this._svg.contains(e._svg)&&this._svg.removeChild(e._svg),this._children.splice(t,1),e.parent=null,e}},{key:"removeChildren",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2147483647,e=A.numberToInt(Math.min(t,this._children.length-1));e>=0;e--)this.removeChildAt(e)}},{key:"notifyAddedToStage",value:function(){s(h(e.prototype),"notifyAddedToStage",this).call(this);var t=!0,i=!1,n=void 0;try{for(var r,o=this._children[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.notifyAddedToStage()}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"notifyRemovedFromStage",value:function(){s(h(e.prototype),"notifyRemovedFromStage",this).call(this);var t=!0,i=!1,n=void 0;try{for(var r,o=this._children[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.notifyRemovedFromStage()}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"updateDisplayListStats",value:function(t){s(h(e.prototype),"updateDisplayListStats",this).call(this,t),t.displayObjectContainerCount++;var i=!0,n=!1,r=void 0;try{for(var o,a=this._children[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){o.value.updateDisplayListStats(t)}}catch(t){n=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"numChildren",get:function(){return this._children.length}},{key:"mouseChildren",set:function(t){this._mouseChildren=t}}]),e}();r.registerClass(zr,"flash.display.DisplayObjectContainer");var Wr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._graphics=null,t._buttonMode=!1,t._useHandCursor=!1,t}return c(e,zr),p(e,[{key:"buttonMode",get:function(){throw Error("abstract method")},set:function(t){this._buttonMode=t}},{key:"dropTarget",get:function(){throw Error("abstract method")},set:function(t){throw Error("abstract method")}},{key:"hitArea",get:function(){throw Error("abstract method")},set:function(t){throw Error("abstract method")}},{key:"useHandCursor",get:function(){throw Error("abstract method")},set:function(t){this._useHandCursor=t}},{key:"graphics",get:function(){return this._graphics||(this._graphics=new _f(this,this._svg)),this._graphics}}]),e}();r.registerClass(Wr,"flash.display.Sprite");var Xr=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).definedBounds=null,t}return c(e,Wr),p(e,[{key:"getBounds",value:function(t){return t==this&&this.definedBounds?this.definedBounds:s(h(e.prototype),"getBounds",this).call(this,t)}}]),e}();r.registerClass(Xr,"com.noteflight.notation.glyph.JSGlyphSprite");var Kr=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y(this,t),this._length=NaN,this._lineWidth=NaN,this._startX=NaN,this._length=e,this._lineWidth=i,this._startX=n}return p(t,null,[{key:"LINE_X_DISPLACEMENT",get:function(){return.35}}]),p(t,[{key:"createDisplayObject",value:function(e){var i=new Wr,n=i.graphics;return e.printView?(n.beginFill(0),n.drawRect(this._startX-t.LINE_X_DISPLACEMENT,-this._lineWidth/2,this._length+1,this._lineWidth),n.endFill()):(n.lineStyle(this._lineWidth,0,1,!1,yf.NORMAL,Lr.NONE),n.moveTo(this._startX-t.LINE_X_DISPLACEMENT,0),n.lineTo(this._startX+this._length+1-t.LINE_X_DISPLACEMENT,0)),i}},{key:"originX",get:function(){return this._startX}},{key:"originY",get:function(){return 0}},{key:"width",get:function(){return this._length}},{key:"height",get:function(){return this._lineWidth}},{key:"text",set:function(t){}}]),t}();r.implementsInterfaces(Kr,[yr]),r.registerClass(Kr,"com.noteflight.notation.glyph.LegerLineGlyph");var jr=function t(){y(this,t),this.hasStem=!0,this.downX=0,this.downY=.2,this.upX=-.2,this.upY=-.2};r.registerClass(jr,"com.noteflight.notation.glyph.NoteHeadMetrics");var qr=function(t){function e(t,i,n,r){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(o=l(this,h(e).call(this,n,r)))._startX=NaN,o._startY=NaN,o._width=NaN,o._height=NaN,o._color=0,o._startX=t,o._startY=i,o._width=n,o._height=r,o._color=s,o}return c(e,gr),p(e,[{key:"createDisplayObject",value:function(t){var e=new rc,i=e.graphics;return i.lineStyle(1,this._color,100,!1,yf.NORMAL,null,kr.MITER),i.drawRect(this._startX,this._startY,this._width,this._height),e}}]),e}();r.registerClass(qr,"com.noteflight.notation.glyph.RectangleGlyph");var Jr=function(){function t(e,i,n,r,o){y(this,t),this._length=NaN,this._lineWidth=NaN,this._startX=NaN,this._startY=NaN,this._down=!1,this._slashWidth=0,this._slashDx=0,this._slashDy=0,this._length=e,this._lineWidth=i,this._down=o,this._startX=n,this._startY=r}return p(t,null,[{key:"STEM_HIT_VPAD",get:function(){return 5}},{key:"_stemHitWidthCalculated",get:function(){return Zr},set:function(t){Zr=t}},{key:"_stemHitWidth",get:function(){return to},set:function(t){to=t}}]),p(t,[{key:"setSlash",value:function(t,e,i){this._slashWidth=i,this._slashDx=t,this._slashDy=e}},{key:"createDisplayObject",value:function(e){var i=new Wr,n=i.graphics;return n.beginFill(0),this._down?n.drawRect(this._startX,this._startY,this.width,this.height-this._startY):n.drawRect(this._startX-this.width,-this.height,this.width,this.height+this._startY),n.endFill(),0!==this._slashWidth&&(n.beginFill(0),this._down?(n.moveTo(this._startX+this._slashDx,this._startY+this.height-this._slashDy),n.lineTo(this._startX+this._slashDx+this._slashWidth,this._startY+this.height-this._slashDy+this._slashWidth),n.lineTo(this._startX+this._slashDx+this._slashWidth,this._startY+this.height-this._slashDy+this._slashWidth+2*this.width),n.lineTo(this._startX+this._slashDx,this._startY+this.height-this._slashDy+2*this.width),n.lineTo(this._startX+this._slashDx,this._startY+this.height-this._slashDy)):(n.moveTo(this._startX+this._slashDx,-this.height+this._slashDy),n.lineTo(this._startX+this._slashDx+this._slashWidth,-this.height+this._slashDy-this._slashWidth),n.lineTo(this._startX+this._slashDx+this._slashWidth,-this.height+this._slashDy-this._slashWidth-2*this.width),n.lineTo(this._startX+this._slashDx,-this.height+this._slashDy-2*this.width),n.lineTo(this._startX+this._slashDx,-this.height+this._slashDy)),n.endFill()),n.beginFill(0,0),this._down?n.drawRect(this._startX-t.STEM_HIT_WIDTH/2,this._startY-t.STEM_HIT_VPAD,this.width+t.STEM_HIT_WIDTH,this.height-this._startY+t.STEM_HIT_VPAD):n.drawRect(this._startX-this.width-t.STEM_HIT_WIDTH/2,-this.height,this.width+t.STEM_HIT_WIDTH,this.height+this._startY+t.STEM_HIT_VPAD),n.endFill(),i}},{key:"originX",get:function(){return this._startX}},{key:"originY",get:function(){return this._down?this.height:this._startY}},{key:"startX",get:function(){return this._startX}},{key:"startY",get:function(){return this._startY}},{key:"width",get:function(){return this._lineWidth}},{key:"height",get:function(){return this._length},set:function(t){this._length=t}},{key:"text",set:function(t){}}],[{key:"STEM_HIT_WIDTH",get:function(){return t._stemHitWidthCalculated||(t._stemHitWidth=Vd.isFingerTouchScreenType?20:5,t._stemHitWidthCalculated=!0),t._stemHitWidth}}]),t}();r.implementsInterfaces(Jr,[yr]);var Zr=!1,to=0;r.registerClass(Jr,"com.noteflight.notation.glyph.StemGlyph");var eo=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;y(this,t),this._metricsDone=!1,this._width=NaN,this._height=NaN,this._ascent=NaN,this._format=null,this._text=null,this._deltaX=0,this._deltaY=0,this._colorBounds=null,this._textField=null,this._text=i,this._format=e,this._deltaX=n,this._deltaY=r,this._width=o,this._height=s}return p(t,null,[{key:"GUTTER",get:function(){return 2}}]),p(t,[{key:"createDisplayObject",value:function(e){this.calculateMetrics();var i=new Wr,n=this.createTextField();n.mouseEnabled=!1,n.height=n.textHeight,n.antiAliasType=vy.ADVANCED,n.gridFitType=_y.NONE,n.autoSize=My.LEFT,n.sharpness=0;n.getLineMetrics(0);return n.x=this._deltaX-t.GUTTER,n.y=this._deltaY-this._ascent-t.GUTTER,i.addChild(n),i}},{key:"createTextField",value:function(){var t=new Ty;return t.embedFonts=!0,t.selectable=!1,t.defaultTextFormat=this._format,t.text=this._text,t}},{key:"calculateMetrics",value:function(){if(!this._metricsDone){this._textField=this.createTextField();var e=this._textField.getLineMetrics(0);this._width<0&&(this._width=e.width),this._height<0&&(this._height=e.height+t.GUTTER),this._ascent=e.ascent,this._metricsDone=!0}}},{key:"offset",value:function(e,i){this.calculateMetrics();var n=new t(this._format,this._text,this._deltaX+e,this._deltaY+i,this._width,this._height);return n._metricsDone=this._metricsDone,n._ascent=this._ascent,n._colorBounds=this._colorBounds,n._textField=this._textField,n}},{key:"originX",get:function(){return this._deltaX}},{key:"originY",get:function(){return this.calculateMetrics(),this._deltaY-this._ascent+this.height}},{key:"width",get:function(){return this.calculateMetrics(),this._width}},{key:"height",get:function(){return this.calculateMetrics(),this._height}},{key:"text",set:function(t){this._text=t}}]),t}();r.implementsInterfaces(eo,[yr]),r.registerClass(eo,"com.noteflight.notation.glyph.TextGlyph");var io=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;y(this,t),this._metricsDone=!1,this._width=NaN,this._height=NaN,this._scale=NaN,this._deltaX=0,this._deltaY=0,this._originY=0,this._glyphSpriteFactory=null,this._spacingX=0,this._bounds=null,this._scale=e,this._glyphSpriteFactory=i,this._deltaX=n,this._deltaY=r,this._width=o,this._height=s,this._spacingX=a}return p(t,null,[{key:"MIN_HIT_EXTENT",get:function(){return 4}},{key:"HIT_INFLATION_THRESHOLD",get:function(){return 20}}]),p(t,[{key:"createDisplayObject",value:function(t){this.calculateMetrics();var e=this.createGlyphSprite();e.scaleX=this._scale,e.scaleY=this._scale,e.x=this._deltaX,e.y=this._deltaY;var i=new Wr;return i.addChild(e),this.addHitArea(e,i),i}},{key:"addHitArea",value:function(e,i){var n=this._bounds.clone();n.width<t.HIT_INFLATION_THRESHOLD&&n.inflate(t.MIN_HIT_EXTENT,0),n.height<t.HIT_INFLATION_THRESHOLD&&n.inflate(0,t.MIN_HIT_EXTENT),i.graphics.beginFill(0,0),i.graphics.drawRect(e.x+n.x*this._scale,e.y+n.y*this._scale,n.width*this._scale,n.height*this._scale),i.graphics.endFill()}},{key:"createGlyphSprite",value:function(){return this._glyphSpriteFactory.createGlyphSprite()}},{key:"calculateMetrics",value:function(){if(!this._metricsDone){var t=this.createGlyphSprite();this._bounds=t.getBounds(t),this._width<0&&(this._width=(this._bounds.x+this._bounds.width)*this._scale),this._height<0&&(this._height=this._bounds.height*this._scale),this._metricsDone=!0,this._originY=this._deltaY+(this._bounds.y+this._bounds.height)*this._scale}}},{key:"offset",value:function(e,i){return this.calculateMetrics(),new t(this._scale,this._glyphSpriteFactory,this._deltaX+e,this._deltaY+i,this.width,this.height)}},{key:"originX",get:function(){return this._deltaX}},{key:"originY",get:function(){return this.calculateMetrics(),this._originY}},{key:"width",get:function(){return this.calculateMetrics(),this._width}},{key:"height",get:function(){return this.calculateMetrics(),this._height}},{key:"spacingX",get:function(){return this.calculateMetrics(),this._spacingX}},{key:"dy",get:function(){return this.calculateMetrics(),this._deltaY}},{key:"text",set:function(t){}}]),t}();r.implementsInterfaces(io,[Nr]),r.registerClass(io,"com.noteflight.notation.glyph.VectorGlyph");var no=function(t){function e(t,i,n,r){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return y(this,e),(o=l(this,h(e).call(this,t,i,n,s)))._basePoints=NaN,o._glyphScale=NaN,o._basePoints=r,o._glyphScale=4*t.sizeUnit/r,o.initializeGlyphs(),o}return c(e,vr),p(e,[{key:"getScaledFoundry",value:function(t){var i=null;return this.fallbackFoundry&&(i=this.fallbackFoundry.getScaledFoundry(t)),new e(this.metrics.scale(t),this.descriptor,this.glyphSpriteFactoryGenerator,this._basePoints,i)}},{key:"createGlyph",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return new io(this._glyphScale*o,t,e+this.deltaX,i+this.deltaY,n,r,s)}},{key:"createUnscaledGlyph",value:function(t){return this.createGlyph(t,0,0,-1,-1,1/this._glyphScale)}},{key:"getTimeSignature",value:function(t){var e=this.getDigitGlyphs(t,"timeSignature",this.timeSignatureGlyphs);return new xr(e,1)}},{key:"getTupletNumber",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];var e=this.getDigitGlyphs(A.intToUint(t),"tuplet",this.tupletNumberGlyphs);return new xr(e,1)}},{key:"getTabFret",value:function(t){var e=this.getDigitGlyphs(t,"tab",this.tabGlyphs);return new xr(e,1)}},{key:"getBendAlteration",value:function(t){if(0===t)return new gr(0,0);if(.5===t)return A.unknownToType(this.otherGlyphs.quarterBendAlteration,yr);if(1==t)return A.unknownToType(this.otherGlyphs.halfBendAlteration,yr);var e=this.getDigitGlyphs(A.intToUint(Math.floor(t/2)),"tab",this.tabGlyphs);return t%2==1&&e.push(this.otherGlyphs.halfBendAlteration),new xr(e,2)}},{key:"getTempo",value:function(t,e,i){var n=[];if(t>=mn.ONE_HUNDRED_TWENTY_EIGHTH&&t<=mn.WHOLE){var r="tempo"+t+(e?"dot":"");n.push(this.otherGlyphs[r])}return i&&n.push(this.otherGlyphs.tempoEquals),new xr(n,2)}},{key:"getDigitGlyphs",value:function(t,e,i){if(0===t)return[this.getDigit(0,e,i)];for(var n=[];t>0;)n.unshift(this.getDigit(t%10,e,i)),t=A.numberToUint(t/10);return n}},{key:"getDigit",value:function(t,e,i){var n=A.unknownToType(i[t],yr);return null==n&&(n=this.createGlyph(this.getGlyphSpriteFactory(e+t.toString())),i[t]=n),n}}]),e}();r.registerClass(no,"com.noteflight.notation.glyph.VectorGlyphFoundry");var ro=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y(this,e),l(this,h(e).call(this,e.FOUNDRY_DEFINITION,t))}return c(e,Qr),p(e,null,[{key:"FOUNDRY_DEFINITION",get:function(){return oo}}]),e}(),oo={descriptor:{clefs:[{sign:"G",glyph:{symbol:"gClef"}},{sign:"C",glyph:{symbol:"cClef"}},{sign:"F",glyph:{symbol:"fClef"}},{sign:"tenorVoice",glyph:{symbol:"tenorVoiceClef"}},{sign:"percussion",glyph:{symbol:"percussionClef"}},{sign:"percussion2",glyph:{symbol:"percussionClef"}},{sign:"tab",glyph:{symbol:"tabClef"}}],accidentals:[{sign:"doubleFlat",glyph:{symbol:"doubleFlat"}},{sign:"flat",glyph:{symbol:"flat"}},{sign:"natural",glyph:{symbol:"natural"}},{sign:"sharp",glyph:{symbol:"sharp"}},{sign:"doubleSharp",glyph:{symbol:"doubleSharp"}}],chordSymbols:[{char:"@",glyph:{symbol:"flat",x:.25,y:.75,scale:.75,width:.925}},{char:"#",glyph:{symbol:"sharp",x:0,y:1,scale:.75,width:.9}},{char:"$",glyph:{symbol:"natural",x:0,y:1,scale:1,width:.9}},{char:"*",glyph:{symbol:"doubleSharp",x:0,y:1,scale:1}},{char:"%",glyph:{symbol:"doubleFlat",x:0,y:1,scale:1}},{char:"[",glyph:{symbol:"repeatEndingBracket",y:1,width:0}}],noteheads:[{type:"normal",noteheads:[{value:6,glyph:{symbol:"solidNoteHead"},metrics:{stem:!0,downY:.2,upX:1.195,upY:-.2}},{value:7,glyph:{symbol:"halfNoteHead"},metrics:{stem:!0,downY:.2,upX:1.25,upY:-.2}},{value:8,glyph:{symbol:"wholeNoteHead"},metrics:{stem:!1}}]},{type:"stemless",noteheads:[{value:6,glyph:{symbol:"solidNoteHead"},metrics:{stem:!1,downY:.2,upX:1.195,upY:-.2}},{value:7,glyph:{symbol:"halfNoteHead"},metrics:{stem:!1,downY:.2,upX:1.25,upY:-.2}},{value:8,glyph:{symbol:"wholeNoteHead"},metrics:{stem:!1}}]},{type:"slash",noteheads:[{value:6,glyph:{symbol:"slashNoteHead"},metrics:{stem:!0,downY:1,upX:2,upY:-1}},{value:7,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!0,downY:0,upX:2.6,upY:0}},{value:8,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!1}}]},{type:"hit",noteheads:[{value:6,glyph:{symbol:"slashNoteHead"},metrics:{stem:!0,downY:1,upX:2,upY:-1}},{value:7,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!0,downY:0,upX:2.6,upY:0}},{value:8,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!1}}]},{type:"cross",noteheads:[{value:6,glyph:{symbol:"crossNoteHead"},metrics:{stem:!0,downY:.5,upX:1.17,upY:-.5}},{value:7,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!1}}]},{type:"square",noteheads:[{value:6,glyph:{symbol:"squareNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowSquareNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowSquareNoteHead"},metrics:{stem:!1}}]},{type:"diamond",noteheads:[{value:6,glyph:{symbol:"diamondNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowDiamondNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowDiamondNoteHead"},metrics:{stem:!1}}]},{type:"triangle",noteheads:[{value:6,glyph:{symbol:"triangleNoteHead"},metrics:{stem:!0,downX:.5,downY:.5,upX:.67,upY:-.5}},{value:7,glyph:{symbol:"hollowTriangleNoteHead"},metrics:{stem:!0,downX:.5,downY:.5,upX:.67,upY:-.5}},{value:8,glyph:{symbol:"hollowTriangleNoteHead"},metrics:{stem:!1}}]},{type:"harmonic",noteheads:[{value:6,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!1}}]},{type:"crossCircle",noteheads:[{value:6,glyph:{symbol:"crossNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"crossCircleNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"crossCircleNoteHead"},metrics:{stem:!1}}]}],articulations:[{type:"marcato",position:"both",glyph:{symbol:"marcato"}},{type:"closed",position:"both",glyph:{symbol:"closed"}},{type:"open",position:"both",glyph:{symbol:"open"}},{type:"staccato",position:"both",glyph:{symbol:"staccato"}},{type:"tenuto",position:"both",glyph:{symbol:"tenuto"}},{type:"upBow",position:"both",glyph:{symbol:"upBow"}},{type:"downBow",position:"both",glyph:{symbol:"downBow"}},{type:"fermata",position:"above",glyph:{symbol:"fermataAbove"}},{type:"fermata",position:"below",glyph:{symbol:"fermataBelow"}},{type:"martellato",position:"above",glyph:{symbol:"martellatoAbove"}},{type:"martellato",position:"below",glyph:{symbol:"martellatoBelow"}},{type:"martellatoStaccato",position:"above",glyph:{symbol:"martellatoStaccatoAbove"}},{type:"martellatoStaccato",position:"below",glyph:{symbol:"martellatoStaccatoBelow"}},{type:"staccatissimo",position:"above",glyph:{symbol:"staccatissimoAbove"}},{type:"staccatissimo",position:"below",glyph:{symbol:"staccatissimoBelow"}},{type:"tap",position:"both",glyph:{symbol:"tap"}},{type:"caesura",position:"both",glyph:{symbol:"caesura"}},{type:"breath",position:"both",glyph:{symbol:"breath"}},{type:"mordent",position:"both",glyph:{symbol:"mordent"}},{type:"invertedMordent",position:"both",glyph:{symbol:"invertedMordent"}},{type:"turn",position:"both",glyph:{symbol:"turn"}},{type:"delayedTurn",position:"both",glyph:{symbol:"turn"}},{type:"invertedTurn",position:"both",glyph:{symbol:"invertedTurn"}},{type:"delayedInvertedTurn",position:"both",glyph:{symbol:"invertedTurn"}},{type:"hammerOn",position:"both",glyph:{symbol:"hammerOn"}},{type:"pullOff",position:"both",glyph:{symbol:"pullOff"}},{type:"bendJazz",position:"both",glyph:{symbol:"bendJazz",scale:.6}}],ornaments:[{type:"tremolo",value:1,glyph:{symbol:"tremolo1"}},{type:"tremolo",value:2,glyph:{symbol:"tremolo2"}},{type:"tremolo",value:3,glyph:{symbol:"tremolo3"}},{type:"buzz",glyph:{symbol:"buzz"}}],rests:[{type:"normal",rests:[{value:0,glyph:{symbol:"twoHundredFiftySixthRest"}},{value:1,glyph:{symbol:"oneHundredTwentyEighthRest"}},{value:2,glyph:{symbol:"sixtyFourthRest"}},{value:3,glyph:{symbol:"thirtySecondRest"}},{value:4,glyph:{symbol:"sixteenthRest"}},{value:5,glyph:{symbol:"eighthRest"}},{value:6,glyph:{symbol:"quarterRest"}},{value:7,glyph:{symbol:"halfRest"}},{value:7,type:"line",glyph:{symbol:"halfRestWithLine"}},{value:8,glyph:{symbol:"wholeRest"}},{value:8,type:"line",glyph:{symbol:"wholeRestWithLine"}}]}],barlines:[{type:"single",glyph:{symbol:"normalBarline"}},{type:"final",glyph:{symbol:"finalBarline"}},{type:"double",glyph:{symbol:"doubleBarline"}},{type:"initial",glyph:{symbol:"initialBarline"}},{type:"dashed",glyph:{symbol:"dashedBarline"}},{type:"repeat",glyph:{symbol:"repeatBarline"}},{type:"invisible",glyph:{symbol:"invisibleBarline"}},{type:"startRepeat",glyph:{symbol:"endRepeat",x:.5}},{type:"endRepeat",glyph:{symbol:"endRepeat",width:1}},{type:"grandStaff",glyph:{symbol:"grandStaff"}},{type:"topInitialWing",glyph:{symbol:"topStartWing",y:-.8}},{type:"bottomInitialWing",glyph:{symbol:"bottomStartWing",y:.8}},{type:"topStartWing",glyph:{symbol:"topStartWing",x:.63,y:-.8}},{type:"bottomStartWing",glyph:{symbol:"bottomStartWing",x:.63,y:.8}},{type:"topEndWing",glyph:{symbol:"topEndWing",x:.63,y:-.8}},{type:"bottomEndWing",glyph:{symbol:"bottomEndWing",x:.62,y:.8}},{type:"braceBody",glyph:{symbol:"braceBody"}}],others:[{name:"rhythmDot",glyph:{symbol:"rhythmDot"}},{name:"grandStaff",glyph:{symbol:"grandStaff"}},{name:"pppDynamics",glyph:{symbol:"pppDynamics"}},{name:"ppDynamics",glyph:{symbol:"ppDynamics"}},{name:"pDynamics",glyph:{symbol:"pDynamics"}},{name:"mpDynamics",glyph:{symbol:"mpDynamics"}},{name:"mfDynamics",glyph:{symbol:"mfDynamics"}},{name:"fDynamics",glyph:{symbol:"fDynamics"}},{name:"ffDynamics",glyph:{symbol:"ffDynamics"}},{name:"fffDynamics",glyph:{symbol:"fffDynamics"}},{name:"sfDynamics",glyph:{symbol:"sfDynamics"}},{name:"fzDynamics",glyph:{symbol:"fzDynamics"}},{name:"sfzDynamics",glyph:{symbol:"sfzDynamics"}},{name:"rfzDynamics",glyph:{symbol:"rfzDynamics"}},{name:"fpDynamics",glyph:{symbol:"fpDynamics"}},{name:"sfpDynamics",glyph:{symbol:"sfpDynamics"}},{name:"tempo2",glyph:{symbol:"sixtyFourthTempo",scale:1.25}},{name:"tempo2dot",glyph:{symbol:"sixtyFourthDotTempo",scale:1.25}},{name:"tempo3",glyph:{symbol:"thirtySecondTempo",scale:1.25}},{name:"tempo3dot",glyph:{symbol:"thirtySecondDotTempo",scale:1.25}},{name:"tempo4",glyph:{symbol:"sixteenthTempo",scale:1.25}},{name:"tempo4dot",glyph:{symbol:"sixteenthDotTempo",scale:1.25}},{name:"tempo5",glyph:{symbol:"eighthTempo",scale:1.25}},{name:"tempo5dot",glyph:{symbol:"eighthDotTempo",scale:1.25}},{name:"tempo6",glyph:{symbol:"quarterTempo",scale:1.25}},{name:"tempo6dot",glyph:{symbol:"quarterDotTempo",scale:1.25}},{name:"tempo7",glyph:{symbol:"halfTempo",scale:1.25}},{name:"tempo7dot",glyph:{symbol:"halfDotTempo",scale:1.25}},{name:"tempo8",glyph:{symbol:"wholeTempo",scale:1.25}},{name:"tempo8dot",glyph:{symbol:"wholeDotTempo",scale:1.25}},{name:"tempoEquals",glyph:{symbol:"tempoEquals",scale:1.25}},{name:"flagDown0",glyph:{symbol:"twoHundredFiftySixthFlagDown"}},{name:"flagDown1",glyph:{symbol:"oneHundredTwentyEighthFlagDown"}},{name:"flagDown2",glyph:{symbol:"sixtyFourthFlagDown"}},{name:"flagDown3",glyph:{symbol:"thirtySecondFlagDown"}},{name:"flagDown4",glyph:{symbol:"sixteenthFlagDown"}},{name:"flagDown5",glyph:{symbol:"eighthFlagDown"}},{name:"flagUp0",glyph:{symbol:"twoHundredFiftySixthFlagUp"}},{name:"flagUp1",glyph:{symbol:"oneHundredTwentyEighthFlagUp"}},{name:"flagUp2",glyph:{symbol:"sixtyFourthFlagUp"}},{name:"flagUp3",glyph:{symbol:"thirtySecondFlagUp"}},{name:"flagUp4",glyph:{symbol:"sixteenthFlagUp"}},{name:"flagUp5",glyph:{symbol:"eighthFlagUp"}},{name:"timeSignature0",glyph:{symbol:"timeSignature0"}},{name:"timeSignature1",glyph:{symbol:"timeSignature1"}},{name:"timeSignature2",glyph:{symbol:"timeSignature2"}},{name:"timeSignature3",glyph:{symbol:"timeSignature3"}},{name:"timeSignature4",glyph:{symbol:"timeSignature4"}},{name:"timeSignature5",glyph:{symbol:"timeSignature5"}},{name:"timeSignature6",glyph:{symbol:"timeSignature6"}},{name:"timeSignature7",glyph:{symbol:"timeSignature7"}},{name:"timeSignature8",glyph:{symbol:"timeSignature8"}},{name:"timeSignature9",glyph:{symbol:"timeSignature9"}},{name:"tuplet0",glyph:{symbol:"tuplet0"}},{name:"tuplet1",glyph:{symbol:"tuplet1"}},{name:"tuplet2",glyph:{symbol:"tuplet2"}},{name:"tuplet3",glyph:{symbol:"tuplet3"}},{name:"tuplet4",glyph:{symbol:"tuplet4"}},{name:"tuplet5",glyph:{symbol:"tuplet5"}},{name:"tuplet6",glyph:{symbol:"tuplet6"}},{name:"tuplet7",glyph:{symbol:"tuplet7"}},{name:"tuplet8",glyph:{symbol:"tuplet8"}},{name:"tuplet9",glyph:{symbol:"tuplet9"}},{name:"tab0",glyph:{symbol:"tab0"}},{name:"tab1",glyph:{symbol:"tab1"}},{name:"tab2",glyph:{symbol:"tab2"}},{name:"tab3",glyph:{symbol:"tab3"}},{name:"tab4",glyph:{symbol:"tab4"}},{name:"tab5",glyph:{symbol:"tab5"}},{name:"tab6",glyph:{symbol:"tab6"}},{name:"tab7",glyph:{symbol:"tab7"}},{name:"tab8",glyph:{symbol:"tab8"}},{name:"tab9",glyph:{symbol:"tab9"}},{name:"quarterBendAlteration",glyph:{symbol:"quarterBendAlteration"}},{name:"halfBendAlteration",glyph:{symbol:"halfBendAlteration"}},{name:"fullBendAlteration",glyph:{symbol:"fullBendAlteration"}},{name:"pedalLineNotationStart",glyph:{symbol:"pedalDown"}},{name:"octaveUpLineNotationStart",glyph:{symbol:"octaveUp"}},{name:"octaveDownLineNotationStart",glyph:{symbol:"octaveDown"}},{name:"twoOctavesUpLineNotationStart",glyph:{symbol:"twoOctavesUp"}},{name:"trillLineNotationStart",glyph:{symbol:"trill"}},{name:"wavyLineNotationSegment",glyph:{symbol:"shake",spacingX:-.2}},{name:"pedalLineNotationEnd",glyph:{symbol:"pedalUp"}},{name:"segnoSymbol",glyph:{symbol:"segno"}},{name:"codaSymbol",glyph:{symbol:"coda"}},{name:"cutTime",glyph:{symbol:"cutTime"}},{name:"commonTime",glyph:{symbol:"commonTime"}},{name:"arpeggioSymbol",glyph:{symbol:"arpeggio"}},{name:"arpeggioUpSymbol",glyph:{symbol:"arpeggioUp"}},{name:"arpeggioDownSymbol",glyph:{symbol:"arpeggioDown"}},{name:"leftParenthesisSymbol",glyph:{symbol:"leftParenthesis"}},{name:"rightParenthesisSymbol",glyph:{symbol:"rightParenthesis"}},{name:"measureRepeatSymbol",glyph:{symbol:"measureRepeat"}},{name:"scoopSymbol",glyph:{symbol:"scoop",scale:.7}},{name:"plopSymbol",glyph:{symbol:"plop",scale:.7}},{name:"quickFallSymbol",glyph:{symbol:"quickFall",scale:.7}},{name:"doitSymbol",glyph:{symbol:"doit",scale:.7}},{name:"fall1LineNotationSegment",glyph:{symbol:"fall1",spacingX:-.58}},{name:"rip1LineNotationSegment",glyph:{symbol:"rip1",spacingX:-.58}}]},symbols:[{name:"doubleBarline",bounds:{left:0,right:11,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M7,-42L7,0L11,0L11,-42L7,-42M0,-42L0,0L4,0L4,-42L0,-42"}]},{name:"initialBarline",bounds:{left:0,right:15.5,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M0,-42L0,0L9,0L9,-42L0,-42M11.5,-42L11.5,0L15.5,0L15.5,-42L11.5,-42"}]},{name:"normalBarline",bounds:{left:0,right:4,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M4,0L0,0L0,-42L4,-42L4,0"}]},{name:"finalBarline",bounds:{left:0,right:15.5,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M0,-42L0,0L4,0L4,-42L0,-42M6.5,-42L6.5,0L15.5,0L15.5,-42L6.5,-42"}]},{name:"dashedBarline",bounds:{left:0,right:1.5,top:-40.6,bottom:0},svgPaths:[{d:"M1.5,-40.6L1.5,-36.4L0,-36.4L0,-40.6L1.5,-40.6M1.5,-29.25L0,-29.25L0,-33.4L1.5,-33.4L1.5,-29.25M1.5,-26.05L1.5,-21.9L0,-21.9L0,-26.05L1.5,-26.05M1.5,-18.7L1.5,-14.55L0,-14.55L0,-18.7L1.5,-18.7M1.5,-4.2L1.5,0L0,0L0,-4.2L1.5,-4.2M1.5,-7.2L0,-7.2L0,-11.35L1.5,-11.35L1.5,-7.2"}]},{name:"startRepeat",bounds:{left:0,right:18.55,top:-3.138,bottom:3.112},svgPaths:[{d:"M14.358,-2.531L13.75,1.656L14.904,2.748L16.484,3.112Q17.396,3.112 17.882,2.202Q18.368,1.352 18.489,-0.529L18.55,-1.803Q18.368,-2.349 17.396,-2.774L15.816,-3.138Q14.418,-3.138 14.358,-2.531"}]},{name:"endRepeat",bounds:{left:0,right:4.85,top:-2.688,bottom:3.562},svgPaths:[{d:"M0.614,-2.081L0,2.106L1.166,3.198L2.763,3.562Q3.684,3.562 4.175,2.652Q4.666,1.802 4.789,-0.079L4.85,-1.353Q4.666,-1.899 3.684,-2.324L2.087,-2.688Q0.675,-2.688 0.614,-2.081"}]},{name:"gClef",bounds:{left:0,right:34.55,top:-45.15,bottom:28.4},svgPaths:[{d:"M25.2,-24.8L20.6,-18.9L17.5,-14.95L17.05,-14.65L16.95,-14.15L16.9,-9.85L16.9,-8.75Q19.05,-10.9 22.1,-12.55Q25.6,-14.45 28.15,-14.45Q31.35,-14.45 33.05,-12.05Q34.55,-10 34.55,-6.6Q34.5,-1.3 28.55,6Q23.8,11.8 18.1,16Q18.2,16.75 18.8,17.55L19.8,19.15Q20.35,20.5 20.35,22.55L20.3,24.05Q17.45,28.4 16.25,28.4Q15.1,28.4 14.4,26.5Q13.85,25.05 13.85,23.7Q13.85,20.7 16.25,17.75L16.1,16.85Q12.2,18.05 8.75,18.05Q4.5,18.05 2.1,14.2Q0,11 0,6.4Q0.05,2.55 4.1,-3.8Q5.8,-6.6 10.8,-13.15L13.9,-17.6L14.1,-19.4L13.8,-26.35L13.55,-33.35Q13.55,-36.9 14.3,-39.55Q13.75,-41.05 13.75,-43Q13.7,-45.15 15.15,-45.15Q15.85,-45.15 16.45,-44.75Q17,-44.3 17.05,-43.6L17,-42.65L17.05,-41.7Q18.1,-40.45 20.95,-38.75Q24.4,-36.7 25.35,-35.85Q27.45,-34 27.45,-31.8Q27.45,-28.35 25.2,-24.8M23.25,-31.05L20.15,-33.45L16.6,-35.4L16.5,-33.05L16.6,-28.25L16.75,-23.45L16.75,-22.55L16.7,-21.65L16.75,-20.7L20.35,-25.75Q22.75,-29.2 23.25,-31.05M17.35,-1.4Q17.35,3.75 17.85,9.7Q19.05,9.4 23.8,4.35L29.5,-2.15Q31.35,-4.8 31.35,-6Q31.35,-8.2 28.85,-8.2Q26.6,-8.2 22.5,-6.4Q17.95,-4.4 17.5,-2.65Q17.35,-2.2 17.35,-1.4M14.1,-11.75Q11.3,-9.15 7.1,-2.6Q2.5,4.55 2.5,7.4Q2.5,9.95 4.55,11.3Q6.25,12.45 9,12.45Q12.15,12.45 14.9,11.1L15.05,10.05L14.75,5.7L14.55,1.35L14.6,-0.45L13.45,2.1Q12.5,3.9 11.65,3.9Q10.4,3.9 10.45,1.7Q10.45,0.1 11.75,-2.75Q12.75,-5 14.05,-6.9L14.1,-11.75"}]},{name:"fClef",bounds:{left:0,right:36.2,top:-13.65,bottom:23.3},svgPaths:[{d:"M5.7,-11.25Q10.35,-13.65 16.05,-13.65Q21.3,-13.65 24.3,-11.6Q26.4,-7.65 26.4,-3.25Q26.4,3.6 21.6,11.15Q17.9,17.2 11.75,23.1L10.45,23.3Q9.65,23.3 9.45,22.9L9.35,21.75L9.3,21.15L9.2,20.5Q9.2,19.35 10.3,18.5L12.25,17.1L15.2,13.9Q18.65,9.9 20.5,6.55Q22.8,2.45 23.45,-2L23.45,-2.8Q23.45,-5.1 21.85,-6.55Q20.2,-8.05 17.9,-8L16.25,-7.65L15.85,-4.85L15.2,-2.15Q14.4,-0.2 10.65,2.2Q6.95,4.55 4.8,4.55Q0,4.55 0,-3.1Q0,-8.3 5.7,-11.25M30.7,-5.35Q30.65,-6.9 31.4,-8.45L32.7,-8.75Q33.7,-8.75 35.95,-7.55L36.2,-6.8L35.85,-3.95Q35.4,-2.3 33.85,-2.3Q32.25,-2.3 31.1,-3.25Q30.65,-4.2 30.7,-5.35M36.15,3.6L35.45,6.4Q35.05,7.85 32.55,8.55L31.95,8.5L31.45,8.2Q30.85,7.6 30.85,6.45L31.05,5.15L31.15,3.8Q31.75,3 32.95,2.6L35.05,2L35.7,2.3Q36.15,2.85 36.15,3.6"}]},{name:"cClef",bounds:{left:0,right:25.65,top:-21.5,bottom:22.5},svgPaths:[{d:"M10.65,-14.05L11.1,8L11.35,17.35Q11.15,17.85 10.6,17.85L9.4,17.35L9.3,17.15Q8.9,16.25 8.55,6.7L8.3,-4.6Q8.3,-14.75 9.2,-17.65L9.65,-17.7L10.55,-17.5L10.65,-14.05M5.15,-18.3Q5.9,-16.05 5.9,1Q5.9,16.1 5.15,17.65L4.1,17.75Q0.8,17.75 0,16.6L0.25,8.25L0.35,-0.15L0.6,-9.6L0.7,-14.15Q0.9,-17.3 1.2,-18.55L3.45,-18.95Q4.5,-18.95 5.15,-18.3M17.35,-8.95Q20.1,-11.35 21.55,-14.55Q22.65,-17 23.55,-21.35L23.9,-21.5L24.7,-20.6L25.05,-19.35Q25.05,-15.9 23.5,-11.8Q22.05,-7.95 19.85,-5.05Q18.75,-3.65 17,-2.3Q14.85,-0.7 13.55,-0.7Q12.4,-0.7 11.75,-1.7L11.6,-3.1L11.45,-4.45Q11.45,-6.2 12.75,-6.4L13.85,-6.55Q14.8,-6.75 15.75,-7.5L17.35,-8.95M22.15,13.15Q20.45,9.95 15.5,6.95L12.75,5.4Q12.45,5.1 12.45,4Q12.45,2.2 13.35,1.3L13.9,1.25L15.3,1.55Q19.65,2.95 22.7,8Q25.65,12.7 25.65,17.55Q25.6,19.55 24.25,22.25L24.15,22.45L23.55,22.4L23.25,17.75Q23.1,14.9 22.15,13.15"}]},{name:"wholeRest",bounds:{left:-2.45,right:17.55,top:-1.778,bottom:15.722},svgPaths:[{d:"M17.05,0.05L0.1,0.05L-1.4,6.75L0.85,6.6L15.75,6.75L17.05,0.05"},{fill:"rgba(0,0,0,0)",d:"M17.55,-1.778L17.55,15.722L-2.45,15.722L-2.45,-1.778L17.55,-1.778"}]},{name:"halfRest",bounds:{left:-1.6,right:18.4,top:-12.228,bottom:5.272},svgPaths:[{d:"M0.05,-6.85L-1.45,-0.15L15.7,-0.15L17,-6.85L0.05,-6.85"},{fill:"rgba(0,0,0,0)",d:"M18.4,-12.228L18.4,5.272L-1.6,5.272L-1.6,-12.228L18.4,-12.228"}]},{name:"quarterRest",bounds:{left:0,right:13.15,top:-13.5,bottom:12.8},svgPaths:[{d:"M10.8,-13.4Q10.05,-13.15 9.85,-12.65Q9.65,-12.25 9.8,-11.7L10.1,-11.05L10.15,-10.25L10.4,-8.35L10.35,-6.5Q10.15,-5.55 9.2,-4.85Q8.45,-4.25 7.2,-3.9Q6.85,-3.85 6.5,-4.1L6.35,-4.25L5.25,-5.15L3.85,-5.25Q3.2,-4.4 3.15,-3.4Q3.1,-2.7 3.4,-1.75Q4.25,-0.7 4.75,0.75L5.5,3.8L5.75,4.3L5.85,5.2Q5.75,5.65 6.5,6.9L4.8,5.5L3.75,4.35L3.1,2.9L2.2,2.8L1.8,2.85L1.3,3Q0.85,5.85 0.35,10.85Q-0.1,11.55 0,12Q0.15,12.5 1,12.8L2.15,11.8L2.6,10.75L2.75,9.95L3.1,8.95Q4.2,9.8 5.25,10.3L7.85,11.2L8.8,9.75L9,7.95L7.35,0.35L7.65,0.35L8.9,0.2Q10.1,-0.3 11.45,-2.05L13.05,-4.95Q13.35,-7.7 12.7,-12.75L12.25,-13.05Q11.4,-13.7 10.8,-13.4"}]},{name:"eighthRest",bounds:{left:0,right:12.4,top:-8.85,bottom:10},svgPaths:[{d:"M4.05,-8.35Q4.05,-8.85 3.65,-8.85L3.4,-8.8Q2.75,-8.6 2.15,-7.85L1.05,-5.95Q0,-3.8 0,-2.35Q0,-0.5 0.95,0.3Q1.6,0.85 3.05,0.85L5.05,0.6L6.8,0.25L3.8,6.75L3.25,8.5L3.4,9.7Q3.6,10 4.15,10Q4.7,10 5.9,8.55Q7,7.2 7,6.65L6.6,5.9Q6.2,5.4 6.2,4.9Q6.9,2.75 8.25,0.6L10.4,-2.85Q11.7,-4.8 12.2,-5.9L12.25,-6.05L12.4,-6.85L12.3,-7.3L12.05,-7.6L11.6,-7.65L11.1,-7.6L10.95,-7.6Q9.5,-6.1 7.45,-5.05Q5.7,-4.2 4.6,-4.2Q3.85,-4.2 3.6,-4.45Q3.35,-4.75 3.35,-5.3Q3.35,-5.95 3.7,-6.95L4.05,-8.35"}]},{name:"sixteenthRest",bounds:{left:-.3,right:13,top:-10.5,bottom:13.35},svgPaths:[{d:"M4.15,-10.45Q3.55,-10.25 2.95,-9.5L1.85,-7.65Q0.8,-5.4 0.8,-3.95L0.95,-2.65L1.4,-1.7Q0.65,-0.5 0.2,0.9Q-0.3,2.25 -0.3,3.25Q-0.3,5.05 0.5,5.85Q1.15,6.5 2.45,6.5L3.5,6.45L4.8,6.15Q3.65,9.15 3.15,11.9L3.1,12.25L3.1,12.55L3.2,13.2L3.8,13.35Q4.4,13.35 5.55,11.9Q6.65,10.5 6.65,9.95L6.25,9.25Q5.85,8.8 5.85,8.25Q6.7,5.1 7.8,2.45L10.25,-2.9L12.8,-7.6L12.9,-7.85L13,-8.45Q13,-8.95 12.65,-9.25L12.15,-9.35L11.7,-9.3L11.55,-9.25Q10.05,-7.75 8.1,-6.7Q6.45,-5.85 5.4,-5.85Q4.7,-5.85 4.4,-6.15Q4.15,-6.4 4.15,-6.95L4.45,-8.6L4.85,-10Q4.85,-10.5 4.4,-10.5L4.15,-10.45M3.75,-0.75L5.8,-1L7.6,-1.45L6.7,0.65Q5.25,1.35 4.3,1.35L3.3,1.1Q3,0.8 3,0.25L3.2,-0.8L3.5,-0.75L3.75,-0.75"}]},{name:"thirtySecondRest",bounds:{left:0,right:14.05,top:-15.65,bottom:15.55},svgPaths:[{d:"M13.95,-13.95L13.65,-14.35L13.1,-14.5L12.65,-14.4L12.5,-14.35Q11.1,-12.8 9.35,-11.85Q7.7,-10.95 6.7,-10.95Q5.9,-10.95 5.55,-11.35Q5.3,-11.65 5.3,-12.3L5.8,-15.05Q5.8,-15.65 5.3,-15.65L5.05,-15.6Q4.45,-15.4 3.95,-14.7L3,-12.95Q2.25,-10.95 2.25,-9.4L2.25,-9.15L2.5,-7.8L3.1,-6.85Q2.45,-5.6 2.1,-4.3Q1.8,-2.8 1.8,-1.9L1.85,-1.3L2.05,-0.55L1.6,0.3L1.3,0.65Q0.7,1.7 0.35,3.15Q0,4.8 0,5.6Q0.15,7.35 1.1,8.15Q1.8,8.8 3.1,8.8L4.95,8.55L3.65,14.05L3.75,15.3Q3.85,15.55 4.45,15.55Q5.05,15.55 6.05,14.15Q7,12.75 7,12.2L6.7,11.65Q6.05,10.95 6.05,10.5Q7.05,6.05 8.15,2.75Q9.55,-1.75 11.25,-6.1Q12.65,-9.85 13.95,-12.65L13.95,-12.8L14.05,-13.4L13.95,-13.95M4.95,-5.9L5.5,-5.9L9.25,-6.55L8.55,-4.5Q7.15,-3.75 6.2,-3.75Q5.4,-3.75 5.1,-4.05Q4.8,-4.4 4.8,-5L4.95,-5.9M7.1,1.05L6.5,3.25L5.35,3.6L4.45,3.75Q3.65,3.75 3.4,3.4Q3.05,3 3.05,2.45L3.15,1.55L3.4,1.1L4.75,1.35L5.85,1.3L7.1,1.05"}]},{name:"sixtyFourthRest",bounds:{left:0,right:14.75,top:-18.85,bottom:22},svgPaths:[{d:"M13.2,-17.65Q11.75,-16 10.05,-15.1Q8.4,-14.2 7.4,-14.2Q6.65,-14.2 6.25,-14.6Q6,-14.9 6,-15.55L6.5,-18.3Q6.5,-18.85 6,-18.85L5.75,-18.85L4.65,-17.95L3.7,-16.2Q2.95,-14.2 2.95,-12.7L2.95,-12.4L3.2,-11.05Q3.45,-10.4 3.8,-10.05Q3.15,-8.95 2.8,-7.55L2.5,-5.1L2.55,-4.5L2.75,-3.8L2.3,-2.9L2,-2.6Q1.4,-1.5 1.05,-0.1Q0.7,1.35 0.7,2.3Q0.7,3.1 0.95,3.6L1.35,4.45L1.3,4.9Q0.7,5.95 0.35,7.4Q-0.05,9.05 0,9.85Q0.05,10.7 0.4,11.35L1.35,12.4Q2.4,13.05 3.95,13.05L4.35,13L4.65,13L4.2,20.5L4.35,21.75Q4.45,22 5.05,22Q5.6,22 6.6,20.55Q7.4,19.3 7.4,18.65L7.1,18.05Q6.45,17.45 6.45,16.95Q6.45,16 7,12.5L8.25,5.25Q9.15,0.85 9.95,-2.2L11.65,-8L14.65,-15.95L14.65,-16.05L14.75,-16.7L14.65,-17.2L14.35,-17.65L13.8,-17.75L13.35,-17.7L13.2,-17.65M9.95,-9.8L9.25,-7.75Q7.85,-7 6.9,-7Q6.15,-7 5.8,-7.35Q5.5,-7.65 5.5,-8.25L5.65,-9.15L5.9,-9.1L6.2,-9.1L8.2,-9.35L9.95,-9.8M4.1,-2.1L5.45,-1.85L7.8,-2.2L7.2,0L6.05,0.4L5.15,0.5L4,0.15Q3.7,-0.15 3.7,-0.7L4.1,-2.1M3.3,5.45L3.55,5.5L3.85,5.5L5.65,5.3L5.15,7.85L4.1,8.1Q3.5,8.1 3.3,7.7Q3.05,7.4 3.05,6.8L3.15,5.9L3.3,5.45"}]},{name:"oneHundredTwentyEighthRest",bounds:{left:0,right:15.7,top:-24.8,bottom:23.4},svgPaths:[{d:"M6.65,-24.8Q6.1,-24.55 5.6,-23.9L4.7,-22.15Q3.9,-20.15 3.9,-18.6L4.1,-17L4.75,-16Q4.05,-15.85 3.3,-13.95Q2.65,-12.15 2.65,-11.2L2.9,-10.6L3.7,-9.75L3,-8.55Q2.4,-7.8 2,-6Q1.65,-4.65 1.65,-3.65Q1.65,-2.95 1.9,-2.35L2.35,-1.5L2.25,-1.05Q1.6,0.1 1.3,1.45Q0.95,2.9 0.95,3.9L1.1,4.8L1.5,5.55Q0.7,6.6 0.35,7.8Q0,8.9 0,10.3L0.15,12.35Q0.4,13.4 1.4,13.85L3.45,14.15L5.05,14.1L4.9,22.3L5.2,23.05L5.7,23.4Q6.35,23.4 7.25,22L8.1,20.05L7.55,19.3Q7,18.85 7,18.35L8.35,3.45L10.9,-8.15L15.55,-21.9L15.6,-22L15.7,-22.6L15.6,-23.15L15.25,-23.6L14.75,-23.7L14.35,-23.65L14.15,-23.6Q12.75,-21.95 10.95,-21Q9.35,-20.15 8.35,-20.15Q7.65,-20.15 7.2,-20.55Q6.95,-20.9 6.95,-21.5L7.4,-24.2Q7.4,-24.8 6.95,-24.8L6.65,-24.8M10.2,-13.7Q8.7,-12.9 7.9,-12.9Q7.05,-12.9 6.8,-13.3Q6.45,-13.6 6.45,-14.2L6.55,-15.1L7.15,-15.1L9.15,-15.3L10.9,-15.75L10.2,-13.7M8.75,-8.15L8.1,-5.95L7,-5.6L6.1,-5.5Q5.35,-5.5 4.9,-5.8Q4.65,-6.15 4.65,-6.65L4.85,-7.6L5.05,-8.05L6.4,-7.8L8.75,-8.15M4.5,-0.4L4.75,-0.4L6.55,-0.65L6.05,1.9L5.05,2.15Q4.4,2.15 4.2,1.75L3.95,0.85L4.2,-0.45L4.5,-0.4M3,9.25Q2.65,8.8 2.65,8.25Q2.65,7.65 3,7.05L3,6.85L3,6.65L4.2,6.95L5.6,7.05L5.4,8.45L5.4,9.45L4.15,9.65Q3.4,9.65 3,9.25"}]},{name:"halfNoteHead",bounds:{left:0,right:12.5,top:-6.85,bottom:6.9},svgPaths:[{d:"M8.039,-6.85L9.938,-6.65Q11.484,-6.15 12.014,-5.3Q12.544,-4.5 12.5,-2.7L12.456,-1.3Q12.412,2.2 9.938,4.6Q7.509,6.9 4.329,6.9Q2.341,6.95 1.193,5.55Q0.044,4.2 0,1.9Q0,-1.5 2.473,-4.15Q4.947,-6.9 8.039,-6.85M4.505,-2Q3.887,-1.6 3.004,-0.65Q1.988,0.5 1.988,1.1Q1.988,2 3.048,2.55L4.814,2.95Q6.714,2.95 8.525,1.55Q10.512,-0.05 10.468,-2.1L10.424,-2.4L10.336,-2.55L7.862,-3.1Q6.36,-3.05 4.505,-2"}]},{name:"solidNoteHead",bounds:{left:0,right:11.95,top:-5.5,bottom:5.5},svgPaths:[{d:"M8.7,-5.5Q9.95,-5.5 10.8,-4.8Q11.7,-4.1 11.9,-2.8L11.95,-2.45L11.95,-1.8L11.85,-0.7L11.45,0.25L10.05,2.05Q9.2,2.85 8.15,3.5Q6.5,4.55 5,5.05L2.75,5.5Q1.5,5.5 0.75,4.55Q0,3.55 0,2.35Q0.05,1.3 0.6,0.05Q1.1,-1.15 1.9,-2.05L3.15,-3.15Q4.3,-4.2 5.1,-4.5L6.75,-5.15L8.7,-5.5"}]},{name:"wholeNoteHead",bounds:{left:0,right:14.15,top:-6.85,bottom:6.9},svgPaths:[{d:"M9.1,-6.85L11.25,-6.65Q13,-6.15 13.6,-5.3Q14.2,-4.5 14.15,-2.7L14.1,-1.3Q14.05,2.2 11.25,4.6Q8.5,6.9 4.9,6.9Q2.65,6.95 1.35,5.55Q0.05,4.2 0,1.9Q0,-1.5 2.8,-4.15Q5.6,-6.9 9.1,-6.85M5.1,-2Q4.4,-1.6 3.4,-0.65Q2.25,0.5 2.25,1.1Q2.25,2 3.45,2.55L5.45,2.95Q7.6,2.95 9.65,1.55Q11.9,-0.05 11.85,-2.1L11.8,-2.4L11.7,-2.55L8.9,-3.1Q7.2,-3.05 5.1,-2"}]},{name:"eighthFlagUp",bounds:{left:-2,right:10.9,top:-2.6,bottom:28.75},svgPaths:[{d:"M-0.2,-2.4L4.95,4Q7.8,7.55 9.15,10.7Q10.9,14.4 10.9,18.65L10.8,20.8L9.85,25.15Q8.85,28.45 7.85,28.75L7.35,28.5L7.15,28.05L7.1,27.45Q7.1,26.4 7.65,24.1L8.3,20.65Q8.3,17.05 7.35,14.35Q6.5,12.1 4.75,9.9L-1.05,2.5Q-2,1.05 -2,-0.4Q-2,-2.6 -0.9,-2.6L-0.2,-2.4"}]},{name:"sixteenthFlagDown",bounds:{left:0,right:15.7,top:-29.45,bottom:8},svgPaths:[{d:"M12.7,-25.15L13.15,-22.25L12.9,-20.4L12.9,-20.45Q12.25,-20.3 12.25,-19L12.3,-18.6Q11.35,-16.75 9.7,-15.05L3.35,-9.2L1.75,-7.45L0.05,-7.45L0.05,-3.9L0,-3.45L0.05,5.1L0,5.55L0.05,6.8L0.1,6.8Q0.25,8 0.95,8L1.6,7.75Q2.85,6.15 7.4,1.7Q11.6,-2.25 13.15,-4.6Q15.7,-8.35 15.7,-12.2Q15.7,-14.25 15.05,-16.8L14.95,-17.05Q15.7,-19.15 15.7,-21.2Q15.7,-23.25 15.05,-25.8Q14.15,-29.2 12.9,-29.45Q12.25,-29.3 12.25,-28Q12.25,-26.75 12.7,-25.15M13.15,-13.25Q13.15,-9.55 9.7,-6.05L3.35,-0.2L2.05,1.2L2.05,-1.75L7.4,-7.3Q11.4,-11.1 13.1,-13.55L13.15,-13.25"}]},{name:"sixteenthFlagUp",bounds:{left:-2,right:10.95,top:-9.25,bottom:31.8},svgPaths:[{d:"M7.4,7.7Q8.05,9.7 8.2,11.8Q6.9,9.4 5,7.05L0,0.8L0,-2.8L4.8,3.25Q6.6,5.55 7.4,7.7M8.35,23.7L7.75,27.15Q7.15,29.35 7.15,30.5L7.2,31.1L7.4,31.55L7.9,31.8Q8.95,31.4 9.9,28.2L10.85,23.8L10.95,21.7Q10.95,19.25 10.35,16.85L10.85,14.15L10.95,12Q10.95,7.75 9.2,4.05Q7.8,0.9 5,-2.65L-0.15,-9.05L-0.8,-9.25Q-1.75,-9.25 -1.9,-7.65L-2,-7.65L-2,6.6L-0.25,6.6L4.8,12.95Q6.55,15.15 7.4,17.4L7.6,18.05Q7.15,19.85 7.15,20.85L7.2,21.4L7.4,21.85L7.9,22.1L8.25,21.9L8.35,23.7"}]},{name:"thirtySecondFlagUp",bounds:{left:-2,right:10.95,top:-14.25,bottom:36.75},svgPaths:[{d:"M0,-7.8L4.8,-1.75Q6.55,0.45 7.4,2.7Q8.1,4.65 8.25,7.15Q7.15,5 5,2.3L0,-3.95L0,-7.8M5,-7.65L-0.15,-14.05L-0.8,-14.25Q-1.9,-14.25 -1.9,-12.05L-1.9,-11.9L-2,-11.9L-2,8.65L-1.75,8.65L-0.95,10.5L0.85,12.95L4.8,17.9Q6.55,20.1 7.4,22.35L7.6,23Q7.15,24.8 7.15,25.75L7.2,26.35L7.45,26.8L7.95,27.05L8.3,26.85L8.35,28.65L7.75,32.1Q7.15,34.3 7.15,35.45L7.2,36.05L7.45,36.5L7.95,36.75Q8.95,36.35 9.9,33.15L10.85,28.75L10.95,26.65Q10.95,24.2 10.35,21.8L10.85,19.1L10.95,16.95Q10.95,14.3 10.3,12L10.85,9.15L10.95,7Q10.95,2.8 9.2,-1Q7.7,-4.3 5,-7.65M4.8,8.2Q6.6,10.5 7.4,12.65L7.55,13.2L7.2,15.05L5,12L0,5.7L0,2.15L4.8,8.2"}]},{name:"sixtyFourthFlagUp",bounds:{left:-2,right:10.85,top:-19.4,bottom:41.6},svgPaths:[{d:"M4.7,-6.9Q6.45,-4.7 7.3,-2.45Q8,-0.4 8.15,2.05Q7.05,-0.1 4.9,-2.8L0,-8.95L0,-12.8L4.7,-6.9M4.9,-12.8L-0.25,-19.2L-0.9,-19.4Q-1.8,-19.4 -1.95,-18.05L-2,-18.05L-2,13.5L-1.9,13.5L-1.05,15.35L0.75,17.8L4.7,22.75Q6.45,24.95 7.3,27.2L7.5,27.85Q7.05,29.65 7.05,30.6L7.1,31.2L7.3,31.65L7.8,31.9L8.15,31.7L8.25,33.5L7.65,36.95Q7.05,39.15 7.05,40.3L7.1,40.9L7.3,41.35L7.8,41.6Q8.85,41.2 9.8,38L10.75,33.6L10.85,31.5Q10.85,29.05 10.25,26.65L10.75,23.95L10.85,21.8Q10.85,19.15 10.2,16.85L10.75,14L10.85,11.85Q10.85,9.25 10.2,6.85L10.75,4L10.85,1.85Q10.85,-2.35 9.1,-6.15Q7.6,-9.45 4.9,-12.8M0,1L0,-2.8L4.7,3.1Q6.45,5.3 7.3,7.55L7.45,8.05L7.1,10.2L4.9,7.15L0,1M0,7.15L4.7,13.05Q6.5,15.35 7.3,17.5L7.45,18.05L7.1,19.9L4.9,16.85L0,10.7L0,7.15"}]},{name:"oneHundredTwentyEighthFlagUp",bounds:{left:-2,right:10.85,top:-25.9,bottom:41.05},svgPaths:[{d:"M0,-19.35L4.7,-13.4Q6.5,-11.15 7.3,-8.95Q7.85,-7.5 8.05,-5.75Q6.95,-7.75 4.9,-10.35L0,-16.5L0,-19.35M4.9,-19.35L-0.2,-25.75L-0.9,-25.9Q-1.9,-25.9 -2,-24.05L-2,13.1L-1.85,13.1L-1.05,14.8L0.75,17.3L4.7,22.2Q6.5,24.5 7.3,26.65L7.65,27.75Q7.05,29.95 7.05,31.1L7.1,31.65L7.35,32.1L7.85,32.4L8.2,32.1L8.25,33L7.65,36.4Q7.05,38.65 7.05,39.8L7.1,40.35L7.35,40.8L7.85,41.05Q8.85,40.75 9.8,37.45L10.75,33.1L10.85,30.95Q10.85,28.65 10.35,26.65L10.75,24.4L10.85,22.3Q10.85,19.95 10.35,17.8L10.75,15.45L10.85,13.3Q10.85,10.9 10.35,8.85L10.75,6.45L10.85,4.3Q10.85,1.9 10.35,-0.15L10.75,-2.55L10.85,-4.7Q10.85,-8.85 9.1,-12.65Q7.65,-15.9 4.9,-19.35M0,-10.35L4.7,-4.4Q6.5,-2.15 7.3,0.05L7.6,1L7.35,2.05L4.9,-1.35L0,-7.5L0,-10.35M7.6,10L7.35,11.05L4.9,7.6L0,1.5L0,-1.35L4.7,4.6Q6.5,6.85 7.3,9.05L7.6,10M0,7.6L4.7,13.55Q6.5,15.8 7.3,18L7.6,18.95L7.4,19.8L4.9,16.3L0,10.15L0,7.6"}]},{name:"eighthFlagDown",bounds:{left:0,right:15.7,top:-25.05,bottom:3.35},svgPaths:[{d:"M12.25,-23.65Q12.25,-24.95 12.85,-25.05Q14.2,-24.75 15,-21.4Q15.7,-18.7 15.7,-16.8Q15.7,-13 13.1,-9.2Q11.55,-6.95 7.35,-2.9Q3,1.35 1.65,3.15L0.95,3.35Q0,3.35 0,0.95Q0,-1.65 3.35,-4.85L9.7,-10.7Q13.1,-14.15 13.1,-17.9L12.65,-20.75Q12.25,-22.5 12.25,-23.65"}]},{name:"oneHundredTwentyEighthFlagDown",bounds:{left:0,right:15.7,top:-32.9,bottom:27.55},svgPaths:[{d:"M12.25,-31.45Q12.25,-30.2 12.7,-28.6L13.15,-25.7L13.1,-24.8L12.9,-24.9Q12.25,-24.75 12.25,-23.45L12.35,-22.25Q11.5,-20.3 9.7,-18.5L3.35,-12.65Q0.3,-9.7 0.05,-7.4L0.05,-7.35L0,-6.9L0.05,0.65L0,1.1L0.05,8.65L0,9.1L0.05,16.65L0,17.1L0.05,24.65L0,25.1L0.05,26.35L0.1,26.35Q0.25,27.55 0.95,27.55L1.6,27.3Q2.85,25.7 7.4,21.25Q11.6,17.3 13.15,14.95Q15.7,11.2 15.7,7.35Q15.7,5.55 15.1,3.05Q15.7,1.25 15.7,-0.65Q15.7,-2.45 15.1,-4.95Q15.7,-6.75 15.7,-8.65Q15.7,-10.45 15.1,-12.95Q15.7,-14.75 15.7,-16.65Q15.7,-18.45 15.1,-20.95Q15.7,-22.75 15.7,-24.65Q15.7,-26.7 15.05,-29.25Q14.15,-32.65 12.9,-32.9Q12.25,-32.75 12.25,-31.45M12.25,-15.45L12.35,-14.25Q11.5,-12.3 9.7,-10.5L3.35,-4.65L2.05,-3.25L2.05,-5.2L7.4,-10.75Q10.75,-13.9 12.3,-15.9L12.25,-15.45M13.1,-0.8L13,-0.85L13.1,-0.95L13.1,-0.8M12.35,-6.25Q11.5,-4.3 9.7,-2.5L3.35,3.35L2.05,4.75L2.05,2.8Q3.45,1.15 7.4,-2.75Q10.75,-5.9 12.3,-7.9L12.25,-7.45L12.35,-6.25M12.25,0.55L12.35,1.75Q11.5,3.7 9.7,5.5L3.35,11.35L2.05,12.75L2.05,10.8Q3.45,9.15 7.4,5.25L12.3,0.1L12.25,0.55M3.35,19.35L2.05,20.75L2.05,18.8Q3.45,17.15 7.4,13.25Q11.65,9.15 13.1,7.05Q12.8,10.4 9.7,13.5L3.35,19.35"}]},{name:"rhythmDot",bounds:{left:0,right:3.95,top:-2.05,bottom:3.1},svgPaths:[{d:"M0.5,-1.55L0,1.9L0.95,2.8L2.25,3.1Q3,3.1 3.4,2.35Q3.8,1.65 3.9,0.1L3.95,-0.95Q3.8,-1.4 3,-1.75L1.7,-2.05Q0.55,-2.05 0.5,-1.55"}]},{name:"staff",bounds:{left:0,right:40.9,top:-40,bottom:.6},svgPaths:[{d:"M0,-40L40.9,-40L40.9,-39.25L0,-39.25L0,-40M0,-10L40.9,-10L40.9,-9.25L0,-9.25L0,-10M0,-20L40.9,-20L40.9,-19.25L0,-19.25L0,-20M0,-30L40.9,-30L40.9,-29.25L0,-29.25L0,-30M40.9,-0.15L40.9,0.6L0,0.6L0,-0.15L40.9,-0.15"}]},{name:"doubleFlat",bounds:{left:0,right:16.65,top:-21.45,bottom:9.1},svgPaths:[{d:"M0,-17.4L0.3,6.35Q0.65,8.8 1.2,9.1L1.95,8.5L6.95,3.3Q6.85,4.35 7.1,5.7Q7.4,7.45 8.2,7.45L9.05,7.25L13.2,3.1L15.2,0.35Q16,-0.85 16.2,-1.75L16.65,-4.95L16.35,-6.35L15.4,-7.4Q14.5,-7.95 12.6,-8.35L9.1,-9.05Q9.1,-13.15 9.5,-17.85L10,-20.75Q10,-21.45 8.8,-21.45Q8.2,-21.45 7.8,-20.75Q7.45,-20.1 7.45,-19.5L6.95,-7.2Q6.2,-7.85 4.95,-8.3L1.95,-9.05L1.9,-17.5L2.1,-19.5Q2.1,-20.3 1.2,-20.3Q0.6,-20.1 0.35,-19.6Q0.1,-19.05 0,-17.4M6.25,-1.35L4.15,1.8L1.95,4.55L2.2,-4.4Q4.2,-3.95 5.25,-3.2Q6.25,-2.45 6.25,-1.35M12.35,-3.75Q13.75,-3.25 13.75,-2.85L11.9,-0.1L9.8,2.45L9.35,2.9L9.25,2.9L9.25,-3.5Q9.5,-4.15 10.55,-4.15L12.35,-3.75"}]},{name:"doubleSharp",bounds:{left:0,right:11.15,top:-7.95,bottom:8},svgPaths:[{d:"M2.45,-7.15L1.95,-7.35Q1.6,-7.35 1.25,-7.05L0.65,-4.4L0.8,-3.95L4.05,0.5L1.75,3.45Q0.35,5.2 0,6.75L0.85,7.5L5.5,2.25L9.35,7.6L10,8Q10.5,7.95 10.7,7.15L10.95,4.8L10.95,4.65L7.65,-0.45L10.85,-5.65L11.15,-7.15Q11.15,-7.95 10.45,-7.95Q9.9,-7.95 8.2,-5.65L6.05,-2.65L2.45,-7.15"}]},{name:"flat",bounds:{left:0,right:8.95,top:-23.05,bottom:10.25},svgPaths:[{d:"M1.15,-22.85Q1.4,-23.05 1.75,-23.05Q2.4,-22.85 2.5,-21.9L2.45,-20.35Q2.45,-12.3 2.7,-10.05L4.8,-9.4L6.75,-8.45Q8.95,-6.7 8.95,-3.4Q8.95,-0.4 8.25,1.9L7.5,3.8Q5.35,8.85 2.6,10.25Q1.6,10.3 1.05,9.45Q0.75,9.05 0.5,6.3L0.4,2.6L0,-5L0.1,-7.85L0.2,-10.75L0.2,-12.7L0.2,-14.65Q0.2,-20.25 1.15,-22.85M3.5,-4.4L2.9,-4.35L2.7,3.3L2.7,5.05L3.15,4.8Q6.5,-0.05 6.6,-2.85Q5.35,-4.4 3.5,-4.4"}]},{name:"natural",bounds:{left:0,right:7.45,top:-18.4,bottom:21.75},svgPaths:[{d:"M1.45,-18.05Q0.6,-13.35 0.45,-10.35L0,2.7Q0,5.2 0.3,7.4L0.9,7.5L3.25,6.9L5.45,5.75L5.95,19.25Q5.95,21.75 6.4,21.75L6.8,21.4Q7.45,17.4 7.45,14.9L7.3,-7.7Q7.05,-8 6.65,-8L2.1,-6.65L2.6,-17.75Q2.6,-18.4 2.1,-18.4Q1.85,-18.4 1.45,-18.05M5.15,-3.7L5.45,-3.25L5.5,1.4Q5.45,1.75 4,2.25L2.05,2.95L2.2,-2.75L3.65,-3.35L5.15,-3.7"}]},{name:"sharp",bounds:{left:0,right:13.2,top:-21.95,bottom:20},svgPaths:[{d:"M3.5,-18.7L3.5,-16.05L3.45,-12.05L3.4,-7.95L3.45,-7.05L5.9,-8.25L5.85,-11.8Q5.8,-18.15 6.9,-21.55Q7.4,-21.95 7.8,-21.95Q8.15,-21.95 8.35,-21.35Q7.5,-18.45 7.5,-13.8L7.55,-11.55L7.55,-9.3L7.55,-8.8Q11,-10.35 12,-10.35L13.1,-10.1L13.2,-9.7Q13.2,-8.75 11,-7.3L7.85,-5.3L7.8,-4.65L8,1.7L11.3,0.5Q12,0.6 12,1.6L12,1.9Q11.35,3.2 8.2,5.7L8.2,6.15L8.3,13.55Q8.3,20.1 7.25,20Q6.6,19.45 6.4,13.75L6.2,6.65L3.6,8.05L3.6,15.2L3.35,18.15L2.95,18.4L2.75,18.4Q2.05,18.05 1.8,13.95L1.75,8.75L1.45,8.75Q0.2,8.8 0.2,6.75Q0.2,5.4 0.35,5.1Q0.55,4.7 1.65,4.25L1.7,1.8L1.7,-0.7L1.7,-2L1.2,-1.85Q0,-1.85 0,-2.8L0.1,-3.45L0.15,-4.1L0.1,-4.5L0.05,-4.95Q0.05,-5.55 0.6,-5.9L1.7,-6.4L1.75,-6.95L1.65,-9.2L1.6,-11.45Q1.6,-16.55 2.7,-18.8L3.15,-18.95L3.5,-18.7M3.6,-2.75L3.55,3.6L6.05,2.45L6.05,0.8L5.95,-4.15L3.6,-2.75"}]},{name:"timeSignature1",bounds:{left:0,right:2.8,top:-12.05,bottom:12.1},svgPaths:[{d:"M0.3,-7.8L0.45,-3.2L0.1,10.85Q0.1,12.1 0.75,12.1Q1.4,12.1 1.9,10.85L2.25,9.1L2.8,-8.7Q2.8,-10.6 2.4,-11.8L1.5,-12.05Q0.75,-12.05 0.4,-11.45Q0,-10.85 0,-9.65L0.3,-7.8"}]},{name:"timeSignature2",bounds:{left:0,right:11.15,top:-12,bottom:12.05},svgPaths:[{d:"M6.4,-10.55Q4.8,-9.4 3.6,-8.25L1.6,-5.75Q0.8,-4.45 0.4,-3.1Q0,-1.75 0,-0.25Q0,0.25 0.4,0.8Q0.8,1.35 1.3,1.35Q1.9,1.35 2.35,0.9L3.05,-0.4L4.05,-4.3L6.05,-6.15L8.25,-7.6L8.8,-7.1Q8.45,-5.8 7.5,-3.95L5.85,-0.85L3.15,4.5Q2.35,6.1 2,7.55Q1.6,8.95 1.6,10.1Q1.6,11.1 2.15,11.6Q2.7,12.05 3.8,12.05L7.35,11.5Q10.05,10.9 10.6,10.3L10.8,9.75L10.8,7.15Q10.8,6.4 10.25,6.4Q9.3,6.4 7.35,7.05L4.5,7.65L4,7.6L9.9,-4.3L10.8,-6.85L11.15,-9.35Q11.15,-10.65 10.8,-11.3Q10.45,-12 9.7,-12L8.25,-11.65L6.4,-10.55"}]},{name:"timeSignature3",bounds:{left:0,right:10.75,top:-11.95,bottom:11.95},svgPaths:[{d:"M8,-7.5L8.15,-7.4Q7.2,-5.65 5.3,-3.45Q3.9,-1.8 3.2,-0.4Q2.45,0.95 2.45,1.95Q2.45,2.85 3.35,2.9L4.65,1.85Q5.6,1.25 6.2,1.25Q7.05,1.25 7.55,1.6Q8,2 8,2.75Q8,4.1 6.95,5.25Q5.9,6.45 3.85,7.4L3.05,7.7Q2.4,7.7 2.45,6.6Q2.1,5.95 1.75,5.95Q1.15,5.95 0.55,7.65Q0.05,9.3 0.05,9.85Q0.05,10.9 0.4,11.4Q0.8,11.95 1.5,11.95L3.15,11.7L4.8,10.9Q6.85,9.1 7.8,7.7Q9.15,5.8 9.8,3.9Q10.45,2.05 10.45,0.25Q10.45,-0.7 9.85,-1.7Q9.3,-2.7 8.35,-2.9L10.45,-7.7L10.75,-9.45Q10.75,-10.7 10.4,-11.3Q10,-11.95 9.3,-11.95Q8,-11.95 6.55,-11.2Q5.05,-10.5 3.4,-9.05Q1.7,-7.55 0.85,-6.1Q0,-4.75 0,-3.5Q0,-2.55 0.45,-2.55L0.7,-2.6L4.15,-5.6L6.4,-7.1L8,-7.5"}]},{name:"timeSignature4",bounds:{left:0,right:14.4,top:-13.45,bottom:12.55},svgPaths:[{d:"M9.8,-13.45L10.35,-13.3L10.5,-13L9.8,0.95Q13.55,-0.2 13.95,-0.2Q14.25,-0.2 14.25,0.55L14.3,1.55L14.4,2.55Q14.4,3.35 14.1,3.6Q12.9,4.5 9.55,5.2L9.3,9Q9.05,11.6 8.6,12.55L8.15,12.55Q7.1,12.55 7.05,11.7Q7.1,8.65 7.5,5.7L4.95,6.1L2.4,6.4Q0,6.45 0,4.5Q0.05,3 1.5,0.45L4.25,-4.3L6.7,-9.15Q8.65,-13.45 9.8,-13.45M4,2L7.85,1.4L8.25,-6.8L3.5,1.9L4,2"}]},{name:"timeSignature5",bounds:{left:0,right:13.05,top:-11.45,bottom:11.5},svgPaths:[{d:"M8.9,-5.9L11.7,-7.7L12.85,-8.8L13.05,-9.8Q13.05,-11.15 12.1,-11.45L9.95,-10.7L6.65,-8.85L3.6,-6.7Q2.45,-5.75 2.2,-5.05L0.85,-1.3Q0.4,0.3 0.4,1.3Q0.4,2.15 1.2,2.15L2.4,1.9L3.55,1.7Q5.15,1.7 6.25,2.65L7.2,3.8L7.5,5.2Q7.5,6.1 6.8,6.55L4.7,7L2.4,6.6L0.85,6.1Q0.45,6.1 0.25,6.7Q0,7.3 0,8.45Q0,10 1.1,10.75Q2.2,11.5 4.35,11.5Q5.75,11.5 6.8,10.9Q7.8,10.25 8.5,9.05L9.4,6.8L9.65,4.1L9.4,1.25L8.65,-0.65L6.95,-2.1L4.35,-2.85Q5,-3.6 8.9,-5.9"}]},{name:"timeSignature6",bounds:{left:0,right:12.55,top:-12,bottom:12.05},svgPaths:[{d:"M9.55,-9.35L9.9,-10.9Q9.9,-11.95 9.1,-12L7.55,-11.05L6,-9.3Q3.9,-5.85 2.9,-3.3Q1.4,0.4 0.7,3.15Q0.2,5.05 0,8.1Q0,9.05 0.25,9.8L1,11.05L2.25,11.8L3.9,12.05Q5.45,12.05 6.95,11.1Q8.45,10.2 9.9,8.3Q11.2,6.55 11.9,4.9Q12.55,3.2 12.55,1.6Q12.55,0.55 12.2,-0.4Q11.75,-1.6 10.8,-1.6Q9.9,-1.6 8.85,-1.05L6.6,0.65Q5.4,1.75 3.55,4.5L2.4,6.6L2.15,5.75Q2.15,4.7 2.65,2.95L4.1,-1.2L5.95,-5.2Q6.85,-6.7 7.6,-7.25L8.8,-8.05Q9.15,-8.25 9.55,-9.35M9.05,2.6Q10,2.6 10.2,3.7Q9.95,4.5 9.3,5.2Q8.75,5.85 7.8,6.5Q6.95,7.15 6.1,7.45L4.35,7.85L3.95,7.7Q5.05,5.85 6.15,4.65Q7,3.65 7.75,3.1Q8.45,2.6 9.05,2.6"}]},{name:"timeSignature7",bounds:{left:0,right:14.95,top:-12,bottom:12.05},svgPaths:[{d:"M5.5,-4.9Q7.7,-5.95 11.85,-7Q11.75,-5.9 10.9,-3.65L8.4,2.05Q6.75,5.5 5.95,7.65Q5.15,9.9 5.15,10.95Q5.15,12.05 6.2,12.05Q6.8,12.05 7.15,11.15L7.45,9.75L14,-5.35L14.7,-7.5L14.95,-9.65Q14.95,-10.5 14.55,-11.2Q14.05,-12 13.15,-12L11.4,-11.75L3.55,-9.2Q2.4,-8.8 1.7,-7.3L0.6,-4.9Q0,-3.45 0,-2.35Q0,-1.45 0.25,-1.05Q0.5,-0.6 1,-0.6Q1.85,-0.6 3.2,-2.45L5.5,-4.9"}]},{name:"timeSignature8",bounds:{left:0,right:13.2,top:-12,bottom:12},svgPaths:[{d:"M8.95,-7Q8.55,-5.95 6.85,-4.8Q5.25,-3.7 4,-3.7L3.25,-3.85L3.9,-4.9L5.5,-6.05Q7.5,-7.25 8.55,-7.25L9,-7L8.95,-7M0.35,-2.65Q0.35,-1.3 0.9,-0.45Q1.4,0.3 2.75,1L2.85,1.15L0.9,4.1Q0.2,5.25 0,7.45L0.2,9.45Q0.4,10.3 0.75,10.85L1.75,11.7L3.15,12Q4.15,12 5.5,11.3L8.5,9.15L11.05,6.55L12.5,4.25Q13.2,1.8 13.2,0L13.2,-0.05Q13.2,-1.35 12.6,-2.35Q12,-3.4 10.8,-4.05L10.8,-4.25L11.7,-6.6L12,-8.45Q12,-10.2 11.4,-11.1Q10.85,-12 9.6,-12Q6.2,-12 3.25,-9.05Q1.75,-7.55 1.05,-5.95Q0.35,-4.4 0.35,-2.65M7.95,4.85L5.5,6.6L3.75,7.2Q2.9,7.2 2.6,6.85Q2.9,5.9 3.65,4.9Q4.4,3.85 5.65,2.75Q6.85,1.7 7.95,1.15Q9.1,0.6 10,0.6Q10.75,0.6 10.75,1Q10.75,1.75 10.05,2.7L7.95,4.85"}]},{name:"timeSignature9",bounds:{left:0,right:10.7,top:-12.05,bottom:12.05},svgPaths:[{d:"M5.8,-10.85Q3.8,-8.85 2.8,-7.25Q1.4,-5.1 0.7,-3.2Q0,-1.25 0,0.3Q0,1.35 0.4,1.85Q0.8,2.35 1.55,2.35Q2.75,2.35 4.25,1.05L6.8,-0.8L4.25,5.45Q2.45,10.05 2.45,10.8Q2.45,12.05 3,12.05L3.5,11.4L9.85,-4L10.4,-6.35L10.7,-8.85Q10.7,-10.45 10.2,-11.25Q9.75,-12.05 8.75,-12.05L7.25,-11.75L5.8,-10.85M8.2,-7.95L8.4,-6.8Q8.4,-5.95 7.7,-5.4L5.4,-3.4Q3.5,-1.75 2.95,-1.75L2.35,-2.15Q2.35,-2.95 2.85,-3.9Q3.3,-4.8 4.25,-5.9Q5.2,-7 6.1,-7.55Q6.95,-8.1 7.75,-8.1L8.2,-7.95"}]},{name:"timeSignature0",bounds:{left:0,right:11.75,top:-11.5,bottom:11.55},svgPaths:[{d:"M7.4,-11.5L5.85,-11.15L4.4,-10.1L3.1,-8.3L1.9,-5.8Q0.95,-3.4 0.5,-1.3Q0,0.85 0,2.75Q0,4.8 0.7,7.8L1.55,9.55L2.75,10.8Q3.9,11.55 4.8,11.55Q6.3,11.55 7.55,10.5Q8.85,9.4 9.95,7.25L11.3,3.65L11.75,0.25Q11.75,-1.9 11.15,-5.2L10.45,-8.35L9.65,-10.15L8.6,-11.2L7.4,-11.5M8,-6.3L8.85,-3.6Q9.55,-0.7 9.55,0.8L9.5,0.8L9.25,2.65L8.5,4.45L7.25,5.85L5.7,6.85L4.8,6.85Q3.8,6.85 3,5.4Q2.3,4 2.3,3L2.3,1.45Q2.3,0.3 2.6,-1Q2.9,-2.3 3.55,-3.75Q4.35,-5.45 5.25,-6.3Q6.15,-7.15 7.15,-7.15L8,-6.3"}]},{name:"sixtyFourthFlagDown",bounds:{left:0,right:15.7,top:-32.4,bottom:23.05},svgPaths:[{d:"M12.7,-28.1L13.15,-25.2L12.9,-23.35L12.9,-23.4Q12.25,-23.25 12.25,-21.95L12.3,-21.55Q11.35,-19.7 9.7,-18L3.35,-12.15Q0,-8.95 0,-6.4L0.05,2.15L0,2.6L0.05,11.15L0,11.6L0.05,20.15L0,20.6L0.05,21.85L0.1,21.85Q0.25,23.05 0.95,23.05L1.6,22.8Q2.85,21.2 7.4,16.75Q11.6,12.8 13.15,10.45Q15.7,6.7 15.7,2.85Q15.7,0.8 15.05,-1.75L14.95,-2Q15.7,-4.1 15.7,-6.15Q15.7,-8.2 15.05,-10.75L14.95,-11Q15.7,-13.1 15.7,-15.15Q15.7,-17.2 15.05,-19.75L14.95,-20Q15.7,-22.1 15.7,-24.15Q15.7,-26.2 15.05,-28.75Q14.15,-32.15 12.9,-32.4Q12.25,-32.25 12.25,-30.95Q12.25,-29.7 12.7,-28.1M12.25,-12.95L12.3,-12.55Q11.35,-10.7 9.7,-9L3.35,-3.15L2.05,-1.75L2.05,-4.7L7.4,-10.25Q11.4,-14.05 13.1,-16.5L13.15,-16.2L12.9,-14.35L12.9,-14.4Q12.25,-14.25 12.25,-12.95M13.15,-7.2L12.9,-5.35L12.9,-5.4Q12.25,-5.25 12.25,-3.95L12.3,-3.55Q11.35,-1.7 9.7,0L3.35,5.85L2.05,7.25L2.05,4.3Q3.45,2.65 7.4,-1.25Q11.4,-5.05 13.1,-7.5L13.15,-7.2M13.15,1.8Q13.15,5.5 9.7,9L3.35,14.85L2.05,16.25L2.05,13.3Q3.45,11.65 7.4,7.75Q11.4,3.95 13.1,1.5L13.15,1.8"}]},{name:"thirtySecondFlagDown",bounds:{left:0,right:15.7,top:-31.8,bottom:14.65},svgPaths:[{d:"M12.7,-27.5L13.15,-24.6L12.9,-22.75L12.9,-22.8Q12.25,-22.65 12.25,-21.35L12.3,-20.95Q11.35,-19.1 9.7,-17.4L3.35,-11.55Q0.45,-8.8 0.05,-6.45L0.05,-6.25L0,-5.8L0.05,2.75L0,3.2L0.05,11.75L0,12.2L0.05,13.45L0.1,13.45Q0.25,14.65 0.95,14.65L1.6,14.4Q2.85,12.8 7.4,8.35Q11.6,4.4 13.15,2.05Q15.7,-1.7 15.7,-5.55Q15.7,-7.6 15.05,-10.15L14.95,-10.4Q15.7,-12.5 15.7,-14.55Q15.7,-16.6 15.05,-19.15L14.95,-19.4Q15.7,-21.5 15.7,-23.55Q15.7,-25.6 15.05,-28.15Q14.15,-31.55 12.9,-31.8Q12.25,-31.65 12.25,-30.35Q12.25,-29.1 12.7,-27.5M13.15,-15.6L12.9,-13.75L12.9,-13.8Q12.25,-13.65 12.25,-12.35L12.3,-11.95Q11.35,-10.1 9.7,-8.4L3.35,-2.55L2.05,-1.15L2.05,-4.1L7.4,-9.65Q11.4,-13.45 13.1,-15.9L13.15,-15.6M13.15,-6.6Q13.15,-2.9 9.7,0.6L3.35,6.45L2.05,7.85L2.05,4.9Q3.45,3.25 7.4,-0.65Q11.4,-4.45 13.1,-6.9L13.15,-6.6"}]},{name:"grandStaff",bounds:{left:-12.5,right:0,top:-160,bottom:.15},svgPaths:[{d:"M-0.45,-160L-0.45,-159.4Q-3.55,-153.95 -5.45,-148.8L-5.65,-148.25Q-7.6,-142.85 -7.35,-136.45Q-7,-130.65 -5.45,-124.5L-5.35,-124.15L-2.15,-112.05Q-0.6,-106.2 -0.45,-101.6Q-0.4,-93.45 -3.2,-88.65Q-4.15,-87.1 -5.45,-85.55Q-8.05,-82.6 -12.1,-79.9Q-8.05,-77 -5.45,-74Q-4.15,-72.45 -3.2,-70.85Q-0.4,-66 -0.45,-57.8Q-0.6,-53.25 -2.15,-47.4L-5.35,-35.3Q-7,-29 -7.35,-22.95Q-7.6,-16.55 -5.65,-11.2Q-3.7,-5.85 -0.45,-0.4L-0.45,0.15Q-6.45,-8.3 -8.95,-16.25Q-11.45,-24.2 -11.4,-30.8Q-11.25,-37.45 -9.8,-44.1L-6.85,-56.45Q-5.35,-62.2 -5.3,-66.2Q-5.35,-67.85 -5.65,-69.35Q-6.15,-71.75 -7.35,-73.8Q-9.3,-77.1 -12.5,-79.6L-12.5,-80.2Q-9.3,-82.45 -7.35,-85.7Q-5.85,-88.15 -5.45,-91.2L-5.3,-93.2L-5.45,-95.65Q-5.8,-98.9 -6.85,-102.95L-9.8,-115.35Q-11.25,-121.95 -11.4,-128.65Q-11.45,-135.25 -8.95,-143.25Q-7.65,-147.35 -5.45,-151.65Q-3.35,-155.75 -0.45,-160"}]},{name:"slashNoteHead",bounds:{left:0,right:18.25,top:-10.25,bottom:10.45},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M18.25,-8.8L18,-5.95L0.35,10.45Q0.05,10.05 0,9.4L0.1,5.5Q8.05,-3.1 17.5,-10.25Q18.25,-10.25 18.25,-8.8"}]},{name:"hollowSlashNoteHead",bounds:{left:0,right:18.7,top:-13.6,bottom:10.85},svgPaths:[{d:"M14,-13.6Q13.55,-13.6 12.9,-12.25L6.4,-7.35L3.3,-4.1Q1.95,-2.6 1.25,-1.25Q0.6,0 0.6,1.55L0.85,3.4L1.65,5.4L4.15,10.05L5,10.85L10.75,5.35L16.65,-0.85L18.2,-3.15Q18.7,-4.15 18.7,-4.95L14.65,-13.1L14,-13.6M9.4,-6.4L13,-9.2L16.15,-3.45L14.75,-1.5L6,7.15L4.25,3.8Q2.9,1.15 2.9,0.45L3,-0.2L6.15,-3.55L9.4,-6.4"}]},{name:"invisibleBarline",bounds:{left:0,right:1.5,top:-40.232,bottom:.368},svgPaths:[{fill:"rgba(0,0,0,0)",d:"M1.5,-40.232L1.5,0.368L0,0.368L0,-40.232L1.5,-40.232"}]},{name:"repeatBarline",bounds:{left:0,right:22,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M6.5,-42L6.5,0L15.5,0L15.5,-42L6.5,-42M18,-42L18,0L22,0L22,-42L18,-42M0,-42L0,0L4,0L4,-42L0,-42"}]},{name:"topStartWing",bounds:{left:0,right:23.25,top:-17.5,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M22.3,-17Q20.65,-17.9 19.75,-17.25Q15.9,-14.45 10.9,-13.45L1.25,-12.8Q0.3,-12.8 0.1,-12.4Q0,-12.05 0.45,-11.5L0,-11.5L0,0L9,0L9,-10.65Q13.1,-11 16.15,-11.95Q19.8,-13.1 22.8,-15.3Q23.95,-16.1 22.3,-17"}]},{name:"bottomStartWing",bounds:{left:0,right:23.25,top:0,bottom:17.1},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M22.8,14.9Q17.45,10.95 9,10.25L9,0L0,0L0,11.5L0.2,11.5Q-0.25,12.35 1.25,12.35L10.9,13.05Q15.95,14.05 19.75,16.85Q20.65,17.5 22.3,16.6Q23.95,15.7 22.8,14.9"}]},{name:"braceBody",bounds:{left:0,right:9,top:-42,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M9,0L0,0L0,-42L9,-42L9,0"}]},{name:"bottomEndWing",bounds:{left:-13.4,right:9.8,top:0,bottom:17.55},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M9.55,11.8L9.55,0.45L0.55,0.45L0.55,10.7Q-7.55,11.4 -12.95,15.35Q-14.1,16.15 -12.45,17.05Q-10.8,17.95 -9.9,17.3Q-6.05,14.5 -1.05,13.5L8.65,12.8Q10.3,12.8 9.55,11.8"}]},{name:"topEndWing",bounds:{left:-13.85,right:9.3,top:-17.25,bottom:.25},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M9.3,-12.15Q9.15,-12.55 8.2,-12.55L-1.5,-13.2Q-6.5,-14.2 -10.35,-17Q-11.25,-17.65 -12.9,-16.75Q-14.55,-15.85 -13.4,-15.05Q-8.05,-11.15 0.1,-10.4L0.1,0.25L9.1,0.25L9.1,-11.25L8.95,-11.25Q9.4,-11.8 9.3,-12.15"}]},{name:"repeatEndingBracket",bounds:{left:-10.5,right:80.2,top:-22.5,bottom:0},svgPaths:[{fill:"none","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"20",d:"M-10,-5.5L-10,-22M-9.7,-22L79.7,-22"}]},{name:"halfRestWithLine",bounds:{left:-3.763,right:18.516,top:-12.578,bottom:4.922},svgPaths:[{d:"M18.5,-0.196L18.5,0.804L-3.45,0.804L-3.45,-0.196L18.5,-0.196"},{d:"M0.05,-6.85L-1.45,-0.15L15.7,-0.15L17,-6.85L0.05,-6.85"},{fill:"rgba(0,0,0,0)",d:"M18.516,-12.578L18.516,4.922L-3.763,4.922L-3.763,-12.578L18.516,-12.578"}]},{name:"wholeRestWithLine",bounds:{left:-3.5,right:18.5,top:-1.878,bottom:15.622},svgPaths:[{d:"M18.5,-0.095L18.5,1.105L-3.5,1.105L-3.5,-0.095L18.5,-0.095"},{d:"M17,-0.05L0.05,-0.05L-1.45,6.65L0.8,6.5L15.7,6.65L17,-0.05"},{fill:"rgba(0,0,0,0)",d:"M17.5,-1.878L17.5,15.622L-2.5,15.622L-2.5,-1.878L17.5,-1.878"}]},{name:"percussionClef",bounds:{left:0,right:9.85,top:-11.45,bottom:11.45},svgPaths:[{d:"M6.95,-11.35L6.85,-11.2L6.85,-10.95L6.85,10.75L6.9,11.2L7.1,11.4L7.25,11.45L9.2,11.45L9.75,11.35L9.85,10.75L9.85,-10.9L9.75,-11.1L7.35,-11.45L6.95,-11.35M3,-10.45L2.85,-10.6L0.85,-10.85Q0.3,-10.6 0.1,-10.1L0,-9.7L0.25,10.9L0.35,11.15L0.5,11.25L2.7,11.25L2.95,11.2L3.05,11.05L3.15,10.8L3.15,-10.2L3,-10.45"}]},{name:"fermataAbove",bounds:{left:-12.3,right:9.7,top:0,bottom:27.45},svgPaths:[{d:"M6.4,2.65Q4.1,0 1.15,0Q-0.65,0 -2.25,0.7Q-3.9,1.35 -5.35,2.7Q-7.1,4.3 -8.4,6.3Q-9.75,8.35 -10.65,10.8Q-11.45,13 -11.9,15.4Q-12.3,17.85 -12.3,20.4L-12.3,20.6Q-12.3,23.25 -11.95,24.55Q-11.65,25.75 -11.05,26.45Q-10.45,27.2 -9.55,27.45Q-8.85,27.35 -8.85,26.85Q-8.85,26.5 -9.3,25.8L-9.85,24.75L-10.5,22.5L-10.65,19.6L-10.3,16.05Q-9.85,13.3 -9.2,13L-9,13.05L-8.25,13.4L-2.8,12Q-0.95,11.45 1.15,10.25L3.3,8.8L4.25,7.55L4.5,5.5L4.7,5.3L5.85,6.45Q6.9,7.85 7.5,10Q8,12.1 8,14.9L7.55,21.1L6.95,24.95Q6.95,25.6 7.35,25.8L7.55,25.85Q8.1,25.85 8.5,25.15Q8.95,24.45 9.2,23Q9.7,18.1 9.7,14.25Q9.7,11.45 9.2,8L8.1,5.1Q7.4,3.75 6.4,2.65M2.85,16.1Q2.85,15 1.75,15L-3.15,15Q-4.15,15 -4.15,16.95L-4.15,18.55Q-4.15,19.3 -2.55,19.75L-0.3,20.1Q1.6,20.1 2.25,19.5Q2.85,18.9 2.85,17.05L2.85,16.1"}]},{name:"fermataBelow",bounds:{left:-11.45,right:13.5,top:0,bottom:27.8},svgPaths:[{d:"M11.75,10.55Q11.75,12.6 11.2,13.95Q10.7,15.3 9.7,15.95Q9.7,14.5 9.25,13.45L8.45,12.35Q7.95,12 7.3,12Q6.5,12 5.2,12.5Q3.85,12.95 2.05,13.9L-1,15.3L-2.85,15.8L-4.2,15.95Q-4.85,16.2 -4.85,17.1Q-4.85,18.85 -5.3,19.55L-7.15,17.6L-8.55,15.05L-9.3,11.9L-9.6,8.15Q-9.6,6.8 -9.05,4.6Q-8.45,2.3 -8.45,1.05Q-8.45,0 -8.9,0Q-9.2,0 -9.8,0.75L-11.05,6Q-11.45,8.5 -11.45,10.8Q-11.45,13.45 -10.9,15.8Q-10.35,18.15 -9.25,20.2L-7.4,23.1L-5.1,25.4Q-3.65,26.6 -2.1,27.2Q-0.55,27.8 0.95,27.8L3.75,27.4Q5.05,27 6.2,26.25Q7.4,25.45 8.45,24.3L10.4,21.55Q12.25,17.9 12.75,16Q13.5,12.1 13.5,10Q13.5,7.5 13,5.4Q12.45,3.35 11.35,1.75L10.85,1.6Q10.1,1.6 9.65,2.6Q9.75,3.9 10.8,6.55Q11.75,9.15 11.75,10.55M2.8,9.2Q3.5,8.65 3.5,6.85L3.45,5.25Q3.3,4.6 2.35,4.6L-2.5,4.6Q-3,4.6 -3.25,4.9L-3.55,7.25L-3.55,8.15Q-3.55,8.85 -1.85,9.3L0.4,9.65Q2.2,9.65 2.8,9.2"}]},{name:"crossNoteHead",bounds:{left:-.8,right:13.4,top:-6.3,bottom:7.45},svgPaths:[{d:"M3.4,-3L3.85,0.45L1.4,2.1Q-0.6,3.5 -0.65,3.8L-0.8,5.15Q-0.8,6.5 0.1,6.5L2.5,5.05L4.8,3.65L6.05,5.8Q7,7.35 7.65,7.45L8.15,7.3Q8.85,6.65 8.85,5.7Q8.85,5 8.15,3.9L7,2.2L9.6,0.3L12.3,-1.5L13,-2.55Q13.4,-3.3 13.4,-3.8Q13.4,-4.8 12.6,-4.8L9.2,-2.95L5.6,-0.6Q5.2,-1.6 5.2,-4.9L5.2,-5.75Q5.2,-6.3 4.75,-6.3Q4.1,-6.3 3.75,-5.45Q3.4,-4.65 3.4,-3"}]},{name:"hollowSquareNoteHead",bounds:{left:0,right:12.05,top:-6,bottom:6.2},svgPaths:[{d:"M12.05,-6L12.05,6.2L0,6.2L0,-6L12.05,-6M1.4,-4.6L1.4,4.8L10.65,4.8L10.65,-4.6L1.4,-4.6"}]},{name:"squareNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:6.1},svgPaths:[{d:"M12.1,-6L12.1,6.1L0,6.1L0,-6L12.1,-6"}]},{name:"hollowTriangleNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:4.9},svgPaths:[{d:"M0,4.9L6.05,-6L12.1,4.9L0,4.9M9.7,3.5L6.15,-3.25L2.35,3.5L9.7,3.5"}]},{name:"triangleNoteHead",bounds:{left:-.008,right:12.092,top:-6,bottom:4.9},svgPaths:[{d:"M5.928,-6L-0.008,4.9L12.092,4.9L5.928,-6"}]},{name:"hollowDiamondNoteHead",bounds:{left:0,right:12.05,top:-6,bottom:6},svgPaths:[{d:"M0,0L6,-6L12.05,0L6,6L0,0M6,4.2L10.25,0L6,-4.2L1.8,0L6,4.2"}]},{name:"diamondNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:6},svgPaths:[{d:"M6.05,6L0,0L6.05,-6L12.1,0L6.05,6"}]},{name:"marcato",bounds:{left:-5,right:4.8,top:0,bottom:14.7},svgPaths:[{d:"M1.25,3.1L-1.95,0.05L-2.35,0Q-2.85,0 -3.4,1.15L-4.05,2.75L-4.05,2.95L-3.95,3.35L1.3,8.7L-3.5,10.9Q-4,11.15 -4.5,12.2Q-5,13.25 -5,13.85Q-5,14.7 -4.35,14.7L3.05,11.8L3.95,11.4L4.35,10.45L4.8,7.15L4.75,6.75L1.25,3.1"}]},{name:"staccato",bounds:{left:-1.8,right:2,top:0,bottom:3.8},svgPaths:[{d:"M2,1.85Q1.8,3.55 0.1,3.8Q-1.65,3.55 -1.8,1.85Q-1.65,0.15 0.1,0Q1.8,0.15 2,1.85"}]},{name:"closed",bounds:{left:-6.7,right:6.95,top:0,bottom:16.3},svgPaths:[{d:"M0.35,0.25L-0.25,0.6Q-0.55,1.4 -0.55,3.05L-0.5,6.35L-3.45,6.6L-6.1,6.85Q-6.35,6.9 -6.55,7.5L-6.7,8.3L-6.2,9.7Q-5.85,10.3 -3.95,10.3L-0.4,10.15L-0.25,13.15Q-0.2,15 0.2,16.1L0.4,16.3Q0.85,16.3 1.05,15.15L1.25,11.65L1.25,10.05L6.3,9.6Q6.9,9.55 6.95,8.85L6.45,7.4Q5.65,6.75 3.95,6.55L1.2,6.3L1.05,1.85L1.15,0.9Q1.15,0.25 0.35,0.25"}]},{name:"tenuto",bounds:{left:-7.2,right:7.2,top:0,bottom:3.85},svgPaths:[{d:"M6.25,0.15L-5.75,0Q-6.35,0 -6.55,0.3L-6.95,1.7L-7.2,3.25Q-7.2,3.75 -6.65,3.85L-1.2,3.85L6.65,3.6Q7.2,2.75 7.2,1.8L7.2,1.4Q7.2,0.15 6.25,0.15"}]},{name:"martellatoBelow",bounds:{left:-3.8,right:5.7,top:-.35,bottom:17.25},svgPaths:[{d:"M5.25,-0.35Q5,-0.35 4.8,-0.1L-0.45,11.05L-1.75,2.55Q-2,0.65 -2.85,0.65L-3.5,1.3L-3.8,2.3L-3.75,2.85L-3.6,3.45L-1.5,16.3Q-1.35,17.25 -0.9,17.25Q0.05,17.25 0.25,16L0.6,14.05L3.15,7.4L5.5,1.15L5.7,0.25Q5.7,-0.35 5.25,-0.35"}]},{name:"martellatoStaccatoBelow",bounds:{left:-4.8,right:4.95,top:-.6,bottom:22},svgPaths:[{d:"M-4.8,6.75L-2.4,21.05Q-2.25,22 -1.7,22Q-0.9,22 -0.65,20.7L-0.25,18.75Q0.3,16.85 2.35,11.95L4.05,8.4Q4.7,7 4.95,4.55Q4.95,4 4.5,4Q4.25,4 4,4.25L-1.35,15.65L-2.1,10.35Q-2.65,6.45 -3.05,5.5Q-3.3,4.95 -3.8,4.95Q-4.1,4.95 -4.5,5.7L-4.8,6.75M-1.05,3.75Q-0.6,4.5 0.3,4.8Q0.9,4.75 1.15,4.15L1.45,2.4Q1.45,0.9 1.05,0.15Q0.6,-0.6 -0.25,-0.6Q-0.9,-0.6 -1.25,0.3L-1.5,1.75Q-1.5,2.95 -1.05,3.75"}]},{name:"open",bounds:{left:-5.35,right:4.2,top:0,bottom:14.75},svgPaths:[{d:"M4.2,5.75Q4.2,3.7 3.65,2.15Q3.25,1.1 2.6,0.6Q1.95,0.05 1.05,0.05Q-0.7,0.05 -2.5,1.45L-3.95,2.9L-4.85,4.5Q-5.35,6.1 -5.35,8.55L-5.15,11.2L-4.4,13Q-3.9,13.7 -2.7,14.2Q-1.45,14.75 -0.6,14.75Q0.65,14.75 1.6,13.9Q2.55,13.05 3.25,11.35L3.95,8.7L4.2,5.75M1.45,8.5Q0.85,9.65 -0.4,10.1L-1.7,9.95L-2.7,9.1L-3.05,8.3Q-3.05,7.1 -2.25,6.2Q-1.45,5.25 0.15,4.5L0.55,4.5Q2.05,4.5 2.05,5.4Q2.05,7.3 1.45,8.5"}]},{name:"staccatissimoBelow",bounds:{left:-2.5,right:2.8,top:0,bottom:6.5},svgPaths:[{d:"M0.1,0L-2.5,6.5L2.8,6.5L0.1,0"}]},{name:"staccatissimoAbove",bounds:{left:-2.5,right:2.8,top:0,bottom:6.5},svgPaths:[{d:"M0.1,6.5L-2.5,0L2.8,0L0.1,6.5"}]},{name:"martellatoAbove",bounds:{left:-6.5,right:3.8,top:-.05,bottom:17.65},svgPaths:[{d:"M2.25,16.1L2.7,16.2Q3.2,15.95 3.45,15.2L3.8,13.9Q3.8,13 2.45,6.85L0.85,0.1L0.25,-0.05L-0.3,0.1L-3.2,7.05L-6.2,14.85L-6.5,16.65L-6.5,17.25L-6.2,17.65L-5.8,17.5Q-4.45,15 -3.25,11.7L-0.6,5L-0.5,5L0.75,10.9Q1.4,14 2.25,16.1"}]},{name:"martellatoStaccatoAbove",bounds:{left:-6.9,right:4.35,top:-.15,bottom:19.5},svgPaths:[{d:"M0.1,-0.15L-0.85,0.7L-5.25,9.95L-6.25,12.2Q-6.85,13.65 -6.9,14.55Q-6.5,15.4 -5.55,15.05L-5.05,14.3L-2.7,9.15L-0.5,4.65L-0.35,4.5L-0.15,4.65L0.9,8.8L2.35,13.8L2.7,14.15L3.15,14.25Q4.3,14.1 4.35,13.15Q4.05,9.4 3.2,6.15Q1.8,0.7 0.45,-0.1L0.1,-0.15M-1.35,19.5Q-0.2,19.5 0.15,18.35L0.35,16.15L-0.05,14.2L-0.7,14.05Q-1.35,14.05 -2.05,14.7Q-2.7,15.7 -2.7,17.3L-2.4,18.65Q-2.05,19.5 -1.35,19.5"}]},{name:"tuplet0",bounds:{left:0,right:8.35,top:-8.2,bottom:8.25},svgPaths:[{d:"M6.25,-2.55L6.75,0.6Q6.75,2 5.95,3.15Q5.25,4.35 4,4.95L3.35,4.95Q2.7,4.95 2.05,3.8Q1.55,2.95 1.55,2.1L1.55,1.05Q1.55,-0.6 2.45,-2.65Q3.05,-3.9 3.65,-4.5Q4.3,-5.15 5.05,-5.15Q5.7,-5.15 6.25,-2.55M3.1,-7.15Q2.1,-6.1 1.3,-3.9Q0.65,-2.2 0.3,-0.6Q0,0.95 0,2.35Q0,4.4 0.45,5.7Q0.95,7.05 1.9,7.75Q2.65,8.25 3.35,8.25Q4.4,8.25 5.3,7.5Q6.25,6.75 7.05,5.2L8,2.65L8.35,0.15L7.9,-3.7Q7.45,-6.5 6.85,-7.35Q6.25,-8.2 5.25,-8.2Q4.1,-8.2 3.1,-7.15"}]},{name:"tuplet1",bounds:{left:0,right:1.95,top:-8.2,bottom:8.25},svgPaths:[{d:"M0.3,-2.1L0.05,8.1L0.6,8.25Q0.85,8.15 1.05,8Q1.5,7.15 1.5,6.3L1.95,-5.85L1.65,-7.95L1.15,-8.2L0.65,-8.15Q0,-7.35 0,-6.5L0.05,-5.85L0.2,-5.2L0.3,-2.1"}]},{name:"tuplet2",bounds:{left:0,right:7.6,top:-8.15,bottom:8.2},svgPaths:[{d:"M6.65,-8.15Q5.8,-8.15 4.35,-7.2L2.45,-5.65L1.1,-3.95L0.3,-2.15Q0,-1.2 0,-0.2Q0,0.95 0.9,0.95Q1.65,0.95 2.1,-0.3L2.75,-2.95L4.15,-4.2L5.65,-5.15L5.85,-5.1L6,-4.85L2.15,3.05Q1.45,4.55 1.1,6.9Q1.1,7.55 1.5,7.9L2.6,8.2L5.05,7.8Q7,7.35 7.25,7.05L7.35,6.65L7.35,4.9L7.35,4.55L7.2,4.4L7,4.35L5,4.75L3,5.2L2.8,5.15L6.75,-2.9Q7.6,-4.6 7.6,-6.3L7.35,-7.7L6.65,-8.15"}]},{name:"tuplet3",bounds:{left:0,right:7.35,top:-8.6,bottom:7.65},svgPaths:[{d:"M6.75,-8.6L7,-8.45Q7.4,-7.85 7.35,-6.85Q7.4,-5.85 6.6,-4.2L5.85,-2.6L6.55,-1.85Q7.2,-1.25 7.2,-0.25Q7.15,2.15 5.4,4.8Q3.35,7.7 1.05,7.65Q0.65,7.7 0.25,7.4L0.15,7.25L0.05,6.2Q0.05,4.55 1.05,3.65L1.2,3.55L1.55,3.7L1.7,4.05L1.75,4.65L1.9,4.8L2.1,4.8L4.3,3.55Q5.45,2.5 5.45,1.4L5.4,0.9L5.15,0.65Q4.8,0.35 4.25,0.4Q3.8,0.4 3.2,0.85L2.3,1.5L1.95,1.45L1.75,1.25L1.7,0.9Q1.7,-0.45 3.3,-2.35L5.65,-5.35L5.65,-5.55L5.45,-5.6Q4.45,-5.45 2.85,-4.2L0.45,-2.25L0.25,-2.15L0.15,-2.25Q0,-2.45 0,-2.85Q0.05,-4.5 2.35,-6.6Q4.65,-8.6 6.4,-8.6L6.75,-8.6"}]},{name:"tuplet4",bounds:{left:0,right:9.05,top:-8.2,bottom:8.2},svgPaths:[{d:"M4.25,-5.5Q2.9,-2.7 0.95,0.55Q0,2.1 0,3.1Q0,3.7 0.4,3.95L1.5,4.25L4.75,3.85Q4.5,5.55 4.5,7.6Q4.5,8.2 5.15,8.2L5.4,8.15Q5.7,7.45 5.8,5.9L6,3.55Q8.15,3.05 8.9,2.55L9.05,1.85L8.95,0.6L8.8,0.15L6.15,0.85L6.6,-7.9L6.55,-8.1L6.2,-8.2L5.35,-7.5L4.25,-5.5M2.5,1.5L2.25,1.45L5.2,-4.05L4.9,1.1L2.5,1.5"}]},{name:"tuplet5",bounds:{left:0,right:10.25,top:-8.3,bottom:8.35},svgPaths:[{d:"M2.6,-4.45L1.5,-3.25Q0.3,0.05 0.3,1.25Q0.3,1.7 0.6,1.85L0.85,1.9L2.45,1.5Q3.55,1.5 4.4,2.15Q5.25,2.95 5.25,4L4.9,4.95L3.9,5.25L1.15,4.8L0.5,4.55L0.35,4.7Q0,5.3 0,6.3Q0,6.95 0.45,7.45L1.75,8.2L3.25,8.35L4.6,8.2Q5.7,7.55 6.3,6Q6.8,4.7 6.8,3.2Q6.8,1.5 6.35,0.4Q5.9,-0.7 4.95,-1.2L3.25,-1.65L3.25,-1.8Q3.85,-2.45 6.9,-4.2Q9.9,-5.95 10.15,-6.4L10.25,-7.2Q10.25,-7.9 9.85,-8.25L9.65,-8.3L7.95,-7.7L2.6,-4.45"}]},{name:"tuplet6",bounds:{left:0,right:8.85,top:-8.45,bottom:8.45},svgPaths:[{d:"M6.85,-8.2L6.7,-8.4L6.35,-8.45Q5.55,-8.15 4.75,-7.1Q3.9,-6 3.05,-4.15L1.05,1.3Q0,4.55 0,5.7Q0,7.1 0.7,7.8Q1.4,8.45 2.75,8.45Q3.85,8.45 4.9,7.8L6.95,5.9L8.4,3.5L8.85,1.2L8.6,-0.25Q8.25,-1.1 7.65,-1.1L6.25,-0.7L4.65,0.45Q3.25,1.8 2.5,3.15L1.8,4.5L1.65,4.6L1.55,4.5L1.5,4.3L2.1,1.35Q2.5,-0.1 3.4,-2.05Q4.5,-4.4 5.35,-5.1L6.2,-5.65L6.7,-6.45L7,-7.35L6.85,-8.2M5.5,4.6Q4.35,5.45 3.05,5.55L2.9,5.5L2.8,5.35Q3.5,4.15 4.35,3.2Q5.55,1.85 6.35,1.85L6.9,1.95L7.15,2.65Q6.85,3.65 5.5,4.6"}]},{name:"tuplet7",bounds:{left:0,right:10.55,top:-8.45,bottom:8.45},svgPaths:[{d:"M8.05,-8.3L2.5,-6.45Q1.65,-6.2 1.2,-5.15L0.45,-3.45Q0,-2.4 0,-1.7Q0,-0.4 0.7,-0.4Q1.3,-0.4 2.25,-1.75L3.9,-3.45Q6.9,-4.8 7.85,-4.85L8.1,-4.65L8.25,-4.35L4.75,4.2Q3.65,6.8 3.65,7.7L3.9,8.4L4.1,8.45L4.3,8.45Q4.85,8.4 5.05,7.8L5.3,6.9L9.85,-3.75Q10.55,-5.35 10.55,-6.75L10.25,-7.9L9.25,-8.45L8.05,-8.3"}]},{name:"tuplet8",bounds:{left:0,right:9.2,top:-8.4,bottom:8.45},svgPaths:[{d:"M6.15,-8.4L4.55,-8.1Q3.75,-7.75 3,-7.1Q1.7,-5.95 1.05,-4.45Q0.6,-3.4 0.6,-2.3L0.8,-0.85L1.15,-0.15L1.95,0.25L1.9,0.35Q0.95,1.6 0.5,2.75Q0,3.9 0,4.95Q0,6.7 0.45,7.6Q0.9,8.45 1.8,8.45L3.25,8.1L5.1,7.15L6.7,5.7L8.05,3.85L9.15,1.55L9.2,0.45Q9.2,-1.2 8.8,-1.8Q8.2,-2.5 6.55,-2.5L7.25,-3.75L7.45,-5.9Q7.45,-8.35 6.85,-8.3L6.15,-8.4M3.75,-4.65Q4.45,-5.3 5.35,-5.5L5.65,-5.55L5.75,-5.45L5.75,-5.3L4.55,-3.65Q3.75,-3 2.45,-2.7Q3,-3.95 3.75,-4.65M7.5,0.35L7.55,0.45L5.5,3.55L4.3,4.65L3.05,5.35L1.75,5.75Q1.55,5.8 1.5,5.65L1.5,5.25L1.8,4.45Q2.4,3.25 3.3,2.25Q4.25,1.3 5.55,0.6L6.25,0.25L7.5,0.35"}]},{name:"tuplet9",bounds:{left:0,right:7.4,top:-8.25,bottom:8.3},svgPaths:[{d:"M6.05,-8.25Q5.15,-8.25 4.1,-7.4Q2.65,-6.25 1.7,-4.7Q0.75,-3.15 0.35,-1.3L0,0.25Q0,1.35 0.9,1.65L1.95,1.55L4.7,-0.5L4.6,-0.25L1.9,6.65L1.75,7.65L1.75,8.1L1.95,8.3L2.25,8.25L2.45,7.85L6.8,-2.7L7.4,-6.05Q7.4,-7.15 7.05,-7.7Q6.75,-8.25 6.05,-8.25M4.45,-5.25L5.5,-5.55L5.65,-5.4L5.8,-4.65L5.35,-3.65L2.7,-1.45L2.05,-1.15L1.85,-1.15L1.75,-1.3L1.65,-1.4Q1.65,-2.35 2.65,-3.6Q3.45,-4.7 4.45,-5.25"}]},{name:"hollowMiscNoteHead",bounds:{left:-.3,right:10.9,top:-10.8,bottom:8.4},svgPaths:[{d:"M8.25,-1L6.45,1.8L4.45,4.45L3,1.65Q1.95,-0.65 1.95,-1.05Q1.95,-1.95 5.6,-6.4L5.8,-6.45L8.25,-1M0.15,-0.7L-0.3,1.6L3,8.2L3.35,8.4L3.7,8.3L7.25,3.45L10.9,-1.95L7.6,-10.45Q7.4,-10.8 7,-10.8L6.5,-10.55L1.5,-3.2Q0.6,-1.9 0.15,-0.7"}]},{name:"downBow",bounds:{left:-7.15,right:8.55,top:-.35,bottom:18.6},svgPaths:[{d:"M5.8,17.2Q5.8,18.6 6.3,18.6L6.6,18.5Q7.4,15.4 7.55,12.8L7.8,6.85L8.45,3.7L8.3,2.6L8.55,1Q8.55,-0.35 7.95,-0.35L-2.95,0.35L-4.7,0.15L-5.6,0.35Q-6.3,1.5 -6.3,2.55L-5.8,4.65L-6.55,11.65Q-7.15,15.5 -7.15,17.85Q-7.15,18.6 -6.7,18.6L-6.55,18.6Q-5.95,17.9 -5.8,17L-4.8,7.15Q0.55,7.3 6.4,6.1L5.8,17.2"}]},{name:"upBow",bounds:{left:-3.65,right:5.85,top:0,bottom:17.6},svgPaths:[{d:"M5.4,0Q5.15,0 4.95,0.25L-0.3,11.4L-1.6,2.9Q-1.85,1 -2.7,1L-3.35,1.65L-3.65,2.65L-3.6,3.2L-3.45,3.8L-1.35,16.65Q-1.2,17.6 -0.75,17.6Q0.2,17.6 0.4,16.35L0.75,14.4L3.3,7.75L5.65,1.5L5.85,0.6Q5.85,0 5.4,0"}]},{name:"bendJazz",bounds:{left:-2.98,right:21.42,top:19,bottom:30.68},svgPaths:[{d:"M-8.47345,0.5940603 C-6.7156574,3.2856079 2.8767979,15.0043991 12.2938442,0.3424299 C13.072326,-1.1303348 13.8013804,1.4433132 13.1846611,2.5104961 C7.6510371,12.0825648 -2.4552908,15.5346205 -10.9715305,6.1175742 C-10.4165954,5.4177269 -10.5570142,4.1314907 -10.7850543,3.3586257 C-9.1714869,2.045429 -9.5174788,1.2208899 -9.9016646,0.7513294 C-8.1386916,0.461505 -8.297084,0.3817471 -8.47345,0.5940603"}]},{name:"twoHundredFiftySixthRest",bounds:{left:-2.55,right:14.4,top:-26.75,bottom:27.4},svgPaths:[{d:"M5.95,-26.35L5.5,-26.75L5.25,-26.7Q4.05,-26.1 3.3,-23.6Q2.55,-21.25 2.7,-19.9L2.75,-19.5Q2.15,-19.2 1.5,-18.05L0.45,-16.15Q-0.1,-15.1 -0.05,-14.5L0,-14.2Q0,-13.5 0.25,-12.85Q0.5,-12.3 0.9,-11.9Q0.25,-11.7 -0.45,-9.75Q-1,-7.9 -0.95,-7L-0.65,-6.45L0.15,-5.6L-0.25,-4.7L-0.45,-4.4Q-0.95,-3.65 -1.35,-1.8L-1.55,0.6L-1.25,1.85L-0.75,2.7L-0.8,3.15Q-1.4,4.3 -1.7,5.7L-1.9,8.15L-1.7,9.05L-1.25,9.8Q-2,10.85 -2.3,12.05L-2.55,14.65L-2.25,16.65Q-1.9,17.7 -0.95,18.05L1.1,18.25L2.65,18.15L2.85,24.85L2.95,26.35L3.3,27.1L3.8,27.4Q4.45,27.4 5.25,25.9L6.05,23.95L5.4,23.2Q4.8,22.75 4.8,22.3L4.85,19.1L5,14L5.45,7.35L7.4,-4.35L8.8,-10.25L10.3,-15.1L11.35,-18.35L12.95,-21.7L14.35,-24.9L14.4,-25.05L14.4,-25.85L14.25,-26.3L13.95,-26.55L13.5,-26.55L13.05,-26.5L12.9,-26.4Q11.65,-24.75 9.7,-23.45Q8.15,-22.45 7.05,-22.3L6,-22.45Q5.7,-22.65 5.6,-23.2L5.75,-24.9L5.95,-26.35M3.65,-16.1Q3.6,-17.15 3.8,-17.5L3.95,-17.4Q4.65,-16.9 6.1,-17.05L8.05,-17.55L8.4,-17.65L6.7,-15.7Q5.3,-14.9 4.25,-15.2Q3.5,-15.45 3.65,-16.1M7.75,-11.8L7.1,-9.75Q5.6,-9 4.75,-9Q3.95,-9 3.65,-9.35Q3.3,-9.7 3.3,-10.3L3.45,-11.15L4,-11.15L6,-11.4L7.75,-11.8M1.9,-4.15L3.3,-3.85L5.65,-4.2L5,-2L3.85,-1.65L3,-1.55Q2.15,-1.55 1.8,-1.9Q1.55,-2.25 1.55,-2.75L1.7,-3.7L1.9,-4.15M1.65,3.5L3.45,3.25L2.95,5.85L1.9,6.1Q1.35,6.1 1.1,5.7L0.9,4.8L1,3.9L1.1,3.45L1.4,3.5L1.65,3.5M2.5,11L2.3,12.4L2.25,13.4L1.1,13.55Q0.4,13.55 -0.1,13.15L-0.45,12.15L-0.1,11L-0.1,10.8L-0.1,10.55L1.1,10.85L2.5,11"}]},{name:"twoHundredFiftySixthFlagDown",bounds:{left:0,right:15.7,top:-33.4,bottom:35.05},svgPaths:[{d:"M12.25,-31.95Q12.25,-30.7 12.7,-29.1L13.15,-26.2L13.1,-25.3L12.9,-25.4Q12.25,-25.25 12.25,-23.95L12.35,-22.75Q11.5,-20.8 9.7,-19L3.35,-13.15Q0,-9.95 0,-7.4L0.05,0.15L0,0.6L0.05,8.15L0,8.6L0.05,16.15L0,16.6L0.05,24.15L0,24.6L0.05,32.15L0,32.6L0.05,33.85L0.1,33.85Q0.25,35.05 0.95,35.05L1.6,34.8Q2.85,33.2 7.4,28.75Q11.6,24.8 13.15,22.45Q15.7,18.7 15.7,14.85Q15.7,13.05 15.1,10.55Q15.7,8.75 15.7,6.85Q15.7,5.05 15.1,2.55Q15.7,0.75 15.7,-1.15Q15.7,-2.95 15.1,-5.45Q15.7,-7.25 15.7,-9.15Q15.7,-10.95 15.1,-13.45Q15.7,-15.25 15.7,-17.15Q15.7,-18.95 15.1,-21.45Q15.7,-23.25 15.7,-25.15Q15.7,-27.2 15.05,-29.75Q14.15,-33.15 12.9,-33.4Q12.25,-33.25 12.25,-31.95M12.25,-15.95L12.35,-14.75Q11.5,-12.8 9.7,-11L3.35,-5.15L2.05,-3.75L2.05,-5.7L7.4,-11.25Q10.75,-14.4 12.3,-16.4L12.25,-15.95M13.1,-1.3L13,-1.35L13.1,-1.45L13.1,-1.3M12.35,-6.75Q11.5,-4.8 9.7,-3L3.35,2.85L2.05,4.25L2.05,2.3Q3.45,0.65 7.4,-3.25Q10.75,-6.4 12.3,-8.4L12.25,-7.95L12.35,-6.75M12.25,8.05L12.35,9.25Q11.5,11.2 9.7,13L3.35,18.85L2.05,20.25L2.05,18.3Q3.45,16.65 7.4,12.75L12.3,7.6L12.25,8.05M12.35,1.25Q11.5,3.2 9.7,5L3.35,10.85L2.05,12.25L2.05,10.3Q3.45,8.65 7.4,4.75L12.3,-0.4L12.25,0.05L12.35,1.25M9.7,21L3.35,26.85L2.05,28.25L2.05,26.3Q3.45,24.65 7.4,20.75Q11.65,16.65 13.1,14.55Q12.8,17.9 9.7,21"}]},{name:"twoHundredFiftySixthFlagUp",bounds:{left:-2,right:10.85,top:-35,bottom:40.95},svgPaths:[{d:"M0,-28.45L4.7,-22.5Q6.5,-20.25 7.3,-18.05Q7.85,-16.6 8.05,-14.85Q6.95,-16.85 4.9,-19.45L0,-25.6L0,-28.45M4.7,-13.5Q6.5,-11.25 7.3,-9.05L7.6,-8.1L7.35,-7.05L4.9,-10.45L0,-16.6L0,-19.45L4.7,-13.5M4.7,-4.5Q6.5,-2.25 7.3,-0.05L7.6,0.9L7.35,1.95L4.9,-1.45L0,-7.6L0,-10.45L4.7,-4.5M10.75,-11.65L10.85,-13.8Q10.85,-17.95 9.1,-21.75Q7.65,-25 4.9,-28.45L-0.2,-34.85L-0.9,-35Q-2,-35 -2,-32.85L-2,12.65L-1.95,12.65L-1.05,14.7L0.75,17.2L4.7,22.1Q6.5,24.4 7.3,26.55L7.65,27.65Q7.05,29.85 7.05,31L7.1,31.55L7.35,32L7.85,32.3L8.2,32L8.25,32.9L7.65,36.3Q7.05,38.55 7.05,39.7L7.1,40.25L7.35,40.7L7.85,40.95Q8.85,40.65 9.8,37.35L10.75,33L10.85,30.85Q10.85,28.55 10.35,26.55L10.75,24.3L10.85,22.2Q10.85,19.85 10.35,17.7L10.75,15.35L10.85,13.2Q10.85,10.8 10.35,8.75L10.75,6.35L10.85,4.2Q10.85,1.8 10.35,-0.25L10.75,-2.65L10.85,-4.8Q10.85,-7.2 10.35,-9.25L10.75,-11.65M0,1.4L0,-1.45L4.7,4.5Q6.5,6.75 7.3,8.95L7.6,9.9L7.35,10.95L4.9,7.5L0,1.4M0,7.5L4.7,13.45Q6.5,15.7 7.3,17.9L7.6,18.85L7.4,19.7L4.9,16.2L0,10.05L0,7.5"}]},{name:"wholeTempo",bounds:{left:0,right:8.95,top:0,bottom:23.15},svgPaths:[{d:"M8.25,14.3L7.35,13.55L6.15,13.3L4.95,13.5Q4.35,13.7 3.7,14.05L2.15,15.2Q1.45,15.85 1,16.65Q0,18.3 0,20.25Q0,20.95 0.15,21.5L0.55,22.4L1.2,22.95L2.15,23.15L3.75,22.9L5.25,22.25L6.6,21.2L7.85,19.65L8.7,18.05L8.95,16.55L8.8,15.3L8.25,14.3M6.95,16.15Q7.45,16.45 7.45,16.9L7,18L5.7,19.15L4.15,20L2.9,20.3Q1.5,20.3 1.5,19.55Q1.5,18.95 1.9,18.3Q2.3,17.7 3.2,17.05L4.7,16.2L6.1,15.9L6.95,16.15"}]},{name:"wholeDotTempo",bounds:{left:0,right:11.8,top:0,bottom:22.85},svgPaths:[{d:"M8.25,14L7.35,13.25L6.15,13L4.95,13.2Q4.35,13.4 3.7,13.75L2.15,14.9Q1.45,15.55 1,16.35Q0,18 0,19.95Q0,20.65 0.15,21.2L0.55,22.1L1.2,22.65L2.15,22.85L3.75,22.6L5.25,21.95L6.6,20.9L7.85,19.35L8.7,17.75L8.95,16.25L8.8,15L8.25,14M7.45,16.6L7,17.7L5.7,18.85L4.15,19.7L2.9,20Q1.5,20 1.5,19.25Q1.5,18.65 1.9,18Q2.3,17.4 3.2,16.75L4.7,15.9L6.1,15.6L6.95,15.85Q7.45,16.15 7.45,16.6M9.2,21.55L9.8,22.15L10.7,22.35L11.45,21.85L11.75,20.35L11.8,19.7L11.2,19.15L10.3,18.95Q9.55,18.95 9.55,19.3L9.2,21.55"}]},{name:"halfTempo",bounds:{left:0,right:7.75,top:0,bottom:22.85},svgPaths:[{d:"M6.65,1.25L6.65,11.5L6.55,12.85L5.85,12.65L4.7,12.85Q4.15,13 3.65,13.3Q2.6,13.95 1.65,15.2Q0.85,16.35 0.4,17.55Q0,18.75 0,20Q0,21.1 0.45,21.85Q1,22.85 2,22.85Q2.7,22.85 3.45,22.3L5.05,20.55L6.2,18.75L7.05,17L7.45,15.45L7.6,13.95L7.75,0.35L7.7,0.05L7.3,0Q7,0 6.85,0.3L6.65,1.25M5.6,16.7L4.55,18.25L3.15,19.65Q2.55,20.15 2,20.15Q1.35,20.15 1.35,19.35Q1.35,18.75 1.7,18.1Q2.05,17.4 2.8,16.65L4.2,15.55Q4.85,15.15 5.5,15.15L6.15,15.35L5.6,16.7"}]},{name:"halfDotTempo",bounds:{left:0,right:9.6,top:0,bottom:22.85},svgPaths:[{d:"M7.7,0Q7.4,0 7.25,0.3Q7.05,0.6 7.05,1.25L7.05,11.5L6.95,12.85L6.25,12.65L5.1,12.85Q4.55,13 4.05,13.3Q3,13.95 2.05,15.2Q1.25,16.35 0.8,17.55Q0.4,18.75 0.4,20Q0.4,21.1 0.85,21.85Q1.4,22.85 2.4,22.85Q3.1,22.85 3.85,22.3L5.45,20.55L6.6,18.75L7.45,17L7.85,15.45L8,13.95L8.15,0.35L8.1,0.05L7.7,0M6.55,15.35L6,16.7L4.95,18.25L3.55,19.65L2.4,20.15Q1.75,20.15 1.75,19.35Q1.75,18.75 2.1,18.1L3.2,16.65Q3.95,15.9 4.6,15.55L5.9,15.15L6.55,15.35M8.1,18.8Q7.35,18.8 7.35,19.15L7,21.4L7.6,22L8.5,22.2L9.25,21.7L9.55,20.2L9.6,19.55L9,19L8.1,18.8"}]},{name:"quarterTempo",bounds:{left:0,right:6.1,top:0,bottom:22.2},svgPaths:[{d:"M5.05,2.45L5,14.9L3.05,15.25Q2.15,15.6 1.45,16.3Q0.7,16.95 0.35,17.85Q0,18.75 0,19.8Q0,21.05 0.4,21.65Q0.85,22.2 1.7,22.2L2.8,21.95L4.1,21.1L5.25,19.65L5.9,17.45L6.1,13.25L6,2.8Q6,2.3 5.55,2.3L5.05,2.45"}]},{name:"quarterDotTempo",bounds:{left:0,right:9.9,top:0,bottom:21.95},svgPaths:[{d:"M6.25,2.2L6.2,14.65L4.25,15Q3.35,15.35 2.65,16.05Q1.9,16.7 1.55,17.6Q1.2,18.5 1.2,19.55Q1.2,20.8 1.6,21.4Q2.05,21.95 2.9,21.95L4,21.7L5.3,20.85L6.45,19.4L7.1,17.2L7.3,13L7.2,2.55Q7.2,2.05 6.75,2.05L6.25,2.2M7.9,21.75L8.8,21.95L9.55,21.45L9.85,19.95L9.9,19.3L9.3,18.75L8.4,18.55Q7.65,18.55 7.65,18.9L7.3,21.15L7.9,21.75"}]},{name:"eighthTempo",bounds:{left:0,right:12.35,top:-5,bottom:21.05},svgPaths:[{d:"M4.95,-2.6L4.95,13.1L4.45,13.15L3,13.3Q2.25,13.55 1.65,14Q1.1,14.4 0.75,15.05Q0.4,15.7 0.2,16.5L0,18.35Q0,19.5 0.5,20.2L1.25,20.85L2.2,21.05L3.3,20.9L4.2,20.4L5.65,18.45L6.3,16.35L6.55,13.9L6.35,13.2L6.25,12.5L6.35,0.5L9.65,4.15L10.75,6.35Q11.1,7.55 11.1,8.8L10.4,12.7Q9.75,15.3 9.75,16.65L9.9,16.85L10,16.75Q10.6,16.35 11,15.4L11.8,13.05L12.35,8.8L12.1,6.25L11.5,4.1L10.55,2.15L9,0.05L7.95,-1.15L7.1,-2.35L6.8,-3.9Q6.6,-5 6.1,-5L5.75,-4.9L5.25,-3.75L4.95,-2.6"}]},{name:"eighthDotTempo",bounds:{left:0,right:14.7,top:-4.5,bottom:21.55},svgPaths:[{d:"M9.15,-3.4Q8.95,-4.5 8.45,-4.5L8.1,-4.4L7.6,-3.25L7.3,-2.1L7.3,13.6L6.8,13.65L5.35,13.8L4,14.5L3.1,15.55Q2.75,16.2 2.55,17L2.35,18.85Q2.35,20 2.85,20.7L3.6,21.35L4.55,21.55L5.65,21.4L6.55,20.9Q7.3,20.3 7.85,19.25L8,18.95L8.25,18.4L8.65,16.85L8.9,14.4L8.7,13.7L8.6,13L8.7,1L12,4.65L13.1,6.85Q13.45,8.05 13.45,9.3L12.75,13.2Q12.1,15.8 12.1,17.15Q12.1,17.35 12.25,17.35L12.35,17.25Q12.95,16.85 13.35,15.9L14.15,13.55L14.7,9.3L14.45,6.75L13.85,4.6L12.9,2.65L11.35,0.55L10.3,-0.65L9.45,-1.85L9.15,-3.4M9.25,17.6L8.9,19.85L9.5,20.45L10.4,20.65L11.15,20.15L11.45,18.65L11.5,18Q11.4,17.7 10.9,17.45L10,17.25Q9.25,17.25 9.25,17.6"}]},{name:"sixteenthTempo",bounds:{left:0,right:12.3,top:-5,bottom:20.7},svgPaths:[{d:"M5.05,-4.5L5,14.4L3.8,14.2L2.6,14.45L1.4,15.05Q0.7,15.55 0.35,16.1Q0,16.6 0,17.2L0,17.75Q0,18.55 0.15,19.15L0.5,20L1.3,20.5L2.65,20.7Q4.45,20.7 5.35,18.65L5.85,17.05L6.1,15.05L6.1,10.5L6.2,7.3L7.85,8.45L8.9,9.45L10,10.4L9.8,11.35Q9.8,12.05 10.5,12.05L10.7,12L11,12.95L10.85,14.6Q10.85,15.55 11.35,15.55L11.5,15.55L12.05,14.55L12.3,13.1L12.1,11.45L11.55,9.75L11.9,7.75Q11.9,6.65 11.5,5.45Q11.1,4.15 10.25,2.9L7.2,-1.45Q6.9,-1.9 6.4,-4.7L5.75,-5L5.3,-4.8L5.05,-4.5M10.6,8.1L8.5,5.8L6.1,3.65L6.1,1.4L8.9,4.4L10.25,6.35L10.7,7.8L10.6,8.1"}]},{name:"sixteenthDotTempo",bounds:{left:0,right:12.35,top:-4.15,bottom:21.55},svgPaths:[{d:"M5.8,-4.15Q5.6,-4.15 5.35,-3.95L5.1,-3.65L5.05,15.25L3.85,15.05L2.65,15.3L1.45,15.9Q0.75,16.4 0.4,16.95Q0.05,17.45 0.05,18.05L0.05,18.6Q0.05,19.4 0.2,20L0.55,20.85L1.35,21.35L2.7,21.55Q4.5,21.55 5.4,19.5L5.9,17.9L6.15,15.9L6.15,11.35L6.25,8.15L7.9,9.3L8.95,10.3L10.05,11.25L9.85,12.2Q9.85,12.9 10.55,12.9L10.75,12.85L11.05,13.8L10.9,15.45Q10.9,16.4 11.4,16.4L11.55,16.4L12.1,15.4L12.35,13.95L12.15,12.3L11.6,10.6L11.95,8.6Q11.95,7.5 11.55,6.3L10.3,3.75L7.25,-0.6Q6.95,-1.05 6.45,-3.85L5.8,-4.15M10.65,8.95L8.55,6.65L6.15,4.5L6.15,2.25L8.95,5.25L10.3,7.2L10.75,8.65L10.65,8.95M7.05,17.85L6.7,20.1L7.3,20.7L8.2,20.9L8.95,20.4L9.25,18.9L9.3,18.25Q9.2,17.95 8.7,17.7L7.8,17.5Q7.05,17.5 7.05,17.85"}]},{name:"thirtySecondTempo",bounds:{left:0,right:12.3,top:-5,bottom:20.7},svgPaths:[{d:"m 4.362717,17.859654 c 0.4195761,0 0.7720196,0.117481 1.0573309,0.352444 0.302095,0.234962 0.4867083,0.570623 0.5538404,1.006982 l 0.025171,0.176222 0,0.327269 -0.050349,0.553841 -0.2013962,0.478316 -0.7048875,0.906284 c -0.2853108,0.268529 -0.6041888,0.511883 -0.9566323,0.730062 -0.5538404,0.352444 -1.082506,0.612581 -1.5859971,0.780412 l -1.1328546,0.22657 c -0.41957582,0 -0.75523652,-0.159438 -1.00698212,-0.478316 -0.251743,-0.335661 -0.3776158,-0.704888 -0.3776158,-1.10768 0.0167830019,-0.352444 0.1174812,-0.738454 0.3020946,-1.15803 0.1678304,-0.402793 0.3860099,-0.755237 0.6545384,-1.057332 l 0.62936392,-0.55384 c 0.3860098,-0.352443 0.713279,-0.579015 0.9818075,-0.679713 L 3.3809094,18.035876 4.362717,17.859654 M 5.9990631,-0.9205623 8.4158198,2.1255588 C 9.0032268,2.8640123 9.4395848,3.610857 9.7248968,4.3660935 9.9598598,5.020632 10.102515,5.7674772 10.152864,6.606629 9.7836378,5.8849582 9.2381888,5.0709811 8.5165178,4.1646973 l -2.5174547,-3.1468191 0,-1.9384405 M 8.5165178,-0.8450383 5.9235392,-4.0673816 5.59627,-4.1680796 c -0.3692265,0 -0.5538403,0.3692265 -0.5538403,1.1076806 l 0,0.075523 -0.050349,0 0.031428,5.9781814 0.00559,0.012793 0.8472592,-0.2241533 0.069421,6.2735039 2.4700771,2.963708 c 0.587406,0.738454 1.023765,1.485299 1.309077,2.240536 l 0.100698,0.327268 C 9.674584,15.191151 9.59906,15.652685 9.59906,15.971562 l 0.02518,0.302095 0.125873,0.22657 0.251745,0.125873 0.176222,-0.100698 0.02517,0.906284 -0.302094,1.737044 c -0.201428,0.738454 -0.302127,1.300685 -0.302127,1.686695 l 0.02518,0.302095 0.125873,0.226571 0.251745,0.125873 c 0.335661,-0.134265 0.66293,-0.738454 0.981808,-1.812569 l 0.478316,-2.21536 0.05035,-1.057331 c 0,-0.822368 -0.100698,-1.636346 -0.302094,-2.441931 l 0.251745,-1.359426 0.05035,-1.082506 c 0,-0.889502 -0.10909,-1.720261 -0.327269,-2.492281 l 0.27692,-1.43495 0.05035,-1.082506 c 0,-1.4097746 -0.293703,-2.7524175 -0.881109,-4.0279276 C 10.127703,1.3954957 9.422816,0.2794239 8.516531,-0.8450391 m -0.1007,7.9803331 c 0.60419,0.77202 1.040549,1.518865 1.309077,2.240535 L 9.800421,9.65275 9.624199,10.584208 8.5165178,9.048561 5.9990631,5.7508532 C 5.2975766,2.1931452 7.4085168,5.8661922 8.4158198,7.135294 M 4.9920806,2.9752395 5.9047779,2.7866684 l 0.094285,16.8352046 -1.0069825,0 0,-12.18259 z"}]},{name:"thirtySecondDotTempo",bounds:{left:0,right:12.35,top:-4.15,bottom:21.55},svgPaths:[{d:"m 6.3573163,22.294916 a 1.1652542,1.1652542 0 0 1 1.2191135,-1.107164 1.1652542,1.1652542 0 0 1 1.1087725,1.217651 1.1652542,1.1652542 0 0 1 -1.2161857,1.110379 1.1652542,1.1652542 0 0 1 -1.1119839,-1.214719 l 1.1641537,0.05063 z m 0.3173874,0.202161 c 0.021938,-0.449733 0.4020217,-0.797876 0.8519485,-0.780353 0.4499269,0.01752 0.8017834,0.394171 0.7886779,0.844248 -0.013105,0.450077 -0.3862812,0.805614 -0.8364652,0.796927 -0.4501839,-0.0087 -0.8093664,-0.378355 -0.8050993,-0.828602 0.9097621,0.01001 0.9094466,0.01212 9.381e-4,-0.03222 z M 4.362717,17.859654 c 0.4195761,0 0.7720196,0.117481 1.0573309,0.352444 0.302095,0.234962 0.4867083,0.570623 0.5538404,1.006982 l 0.025171,0.176222 0,0.327269 -0.050349,0.553841 -0.2013962,0.478316 -0.7048875,0.906284 c -0.2853108,0.268529 -0.6041888,0.511883 -0.9566323,0.730062 -0.5538404,0.352444 -1.082506,0.612581 -1.5859971,0.780412 l -1.1328546,0.22657 c -0.41957582,0 -0.75523652,-0.159438 -1.00698212,-0.478316 -0.251743,-0.335661 -0.3776158,-0.704888 -0.3776158,-1.10768 0.0167830019,-0.352444 0.1174812,-0.738454 0.3020946,-1.15803 0.1678304,-0.402793 0.3860099,-0.755237 0.6545384,-1.057332 l 0.62936392,-0.55384 c 0.3860098,-0.352443 0.713279,-0.579015 0.9818075,-0.679713 L 3.3809094,18.035876 4.362717,17.859654 M 5.9990631,-0.9205623 8.4158198,2.1255588 C 9.0032268,2.8640123 9.4395848,3.610857 9.7248968,4.3660935 9.9598598,5.020632 10.102515,5.7674772 10.152864,6.606629 9.7836378,5.8849582 9.2381888,5.0709811 8.5165178,4.1646973 l -2.5174547,-3.1468191 0,-1.9384405 M 8.5165178,-0.8450383 5.9235392,-4.0673816 5.59627,-4.1680796 c -0.3692265,0 -0.5538403,0.3692265 -0.5538403,1.1076806 l 0,0.075523 -0.050349,0 0.031428,5.9781814 0.00559,0.012793 0.8472592,-0.2241533 0.069421,6.2735039 2.4700771,2.963708 c 0.587406,0.738454 1.023765,1.485299 1.309077,2.240536 l 0.100698,0.327268 C 9.674584,15.191151 9.59906,15.652685 9.59906,15.971562 l 0.02518,0.302095 0.125873,0.22657 0.251745,0.125873 0.176222,-0.100698 0.02517,0.906284 -0.302094,1.737044 c -0.201428,0.738454 -0.302127,1.300685 -0.302127,1.686695 l 0.02518,0.302095 0.125873,0.226571 0.251745,0.125873 c 0.335661,-0.134265 0.66293,-0.738454 0.981808,-1.812569 l 0.478316,-2.21536 0.05035,-1.057331 c 0,-0.822368 -0.100698,-1.636346 -0.302094,-2.441931 l 0.251745,-1.359426 0.05035,-1.082506 c 0,-0.889502 -0.10909,-1.720261 -0.327269,-2.492281 l 0.27692,-1.43495 0.05035,-1.082506 c 0,-1.4097746 -0.293703,-2.7524175 -0.881109,-4.0279276 C 10.127703,1.3954957 9.422816,0.2794239 8.516531,-0.8450391 m -0.1007,7.9803331 c 0.60419,0.77202 1.040549,1.518865 1.309077,2.240535 L 9.800421,9.65275 9.624199,10.584208 8.5165178,9.048561 5.9990631,5.7508532 C 5.2975766,2.1931452 7.4085168,5.8661922 8.4158198,7.135294 M 4.9920806,2.9752395 5.9047779,2.7866684 l 0.094285,16.8352046 -1.0069825,0 0,-12.18259 z"}]},{name:"sixtyFourthTempo",bounds:{left:0,right:12.3,top:-5,bottom:20.7},svgPaths:[{d:"m 5.5816414,3.7300787 1.0484193,0 0,10.2106983 -1.0484193,0 z M 4.9161418,19.525713 c 0.4303078,0 0.7917663,0.120487 1.0843756,0.361459 0.3098216,0.240972 0.499157,0.585219 0.5680062,1.032739 l 0.025819,0.180729 0,0.33564 -0.051637,0.568006 -0.2065477,0.490551 -0.7229171,0.929465 c -0.2926093,0.275397 -0.6196432,0.524975 -0.9811017,0.748735 -0.5680062,0.361459 -1.110194,0.62825 -1.6265633,0.800373 l -1.161831,0.232366 c -0.4303077,0 -0.774554,-0.163517 -1.03273859,-0.490551 -0.25818466,-0.344246 -0.38727699,-0.722917 -0.38727699,-1.136012 0.0172123,-0.361459 0.12048617,-0.757342 0.30982159,-1.18765 0.1721231,-0.413095 0.39588309,-0.774554 0.67128009,-1.084375 l 0.6454616,-0.568007 c 0.3958832,-0.361458 0.7315232,-0.593824 1.0069202,-0.697098 l 0.8520094,-0.33564 1.0069201,-0.18073 M 9.0212781,0.72987053 C 9.6237089,1.4872122 10.071229,2.25316 10.363838,3.027714 10.604811,3.7334187 10.751115,4.5079727 10.802752,5.3513759 10.424081,4.6112465 9.8646813,3.7764495 9.1245519,2.8469847 l -2.5302098,-3.17567122 0,-1.98802178 2.426936,3.04657883 M 9.1245519,-2.3167083 6.4652498,-5.621472 6.1296097,-5.7247459 c -0.3098216,0 -0.4905508,0.2323662 -0.5421878,0.6970986 l -0.025818,0 0,16.2914513 0.051637,0 0.4389139,0.955284 0.9294648,1.265105 2.039659,2.556028 c 0.6024308,0.757341 1.0499509,1.523289 1.3425599,2.297843 l 0.103274,0.33564 c -0.154911,0.619643 -0.232366,1.092982 -0.232366,1.420016 l 0.02582,0.309821 0.103274,0.232367 0.258185,0.129092 0.180729,-0.103274 0.05164,0.929465 -0.309821,1.781474 c -0.206548,0.757342 -0.309822,1.333954 -0.309822,1.729837 l 0.02582,0.309822 0.103274,0.232366 0.258185,0.129092 c 0.361458,-0.137698 0.705705,-0.757341 1.032739,-1.858929 l 0.49055,-2.272025 0.05164,-1.084376 c 0,-0.843403 -0.103274,-1.6782 -0.309821,-2.504391 l 0.258184,-1.394197 0.05164,-1.110194 c 0,-0.912253 -0.11188,-1.764262 -0.33564,-2.556028 l 0.284003,-1.471653 0.05164,-1.110194 c 0,-0.8950401 -0.11188,-1.7556556 -0.33564,-2.5818465 l 0.284003,-1.4716528 0.05164,-1.1101937 c 0,-1.4458341 -0.301215,-2.8228189 -0.903646,-4.1309545 -0.516369,-1.13601243 -1.239286,-2.2806311 -2.1687511,-3.4338558 m -2.5302098,7.1258964 0,-1.9622034 2.426936,3.046579 C 9.6237089,6.650905 10.071229,7.4168528 10.363838,8.191407 l 0.07746,0.2581847 -0.18073,1.110194 L 9.1245519,7.9848593 6.5943421,4.8091881 m 0,3.1756712 2.426936,3.0465787 c 0.6196431,0.791767 1.0671629,1.557714 1.3425599,2.297844 l 0.07746,0.284003 -0.18073,0.955283 -1.1360121,-1.574926 -2.5302098,-3.1756716 0,-1.8331111 M 5.5616033,3.6546509 6.5943421,3.791401 l 0,17.541604 -1.0327388,0 z"}]},{name:"sixtyFourthDotTempo",bounds:{left:0,right:12.35,top:-4.15,bottom:21.55},svgPaths:[{d:"M 6.7428626,24.288989 A 1.1610343,1.1610343 0 0 1 7.9566754,23.185793 1.1610343,1.1610343 0 0 1 9.0623987,24.397304 1.1610343,1.1610343 0 0 1 7.8531949,25.50555 1.1610343,1.1610343 0 0 1 6.7424313,24.298659 l 1.1600865,0.0469 z M 5.5816414,3.7300787 l 1.0484193,0 0,10.2106983 -1.0484193,0 z M 4.9161418,19.525713 c 0.4303078,0 0.7917663,0.120487 1.0843756,0.361459 0.3098216,0.240972 0.499157,0.585219 0.5680062,1.032739 l 0.025819,0.180729 0,0.33564 -0.051637,0.568006 -0.2065477,0.490551 -0.7229171,0.929465 c -0.2926093,0.275397 -0.6196432,0.524975 -0.9811017,0.748735 -0.5680062,0.361459 -1.110194,0.62825 -1.6265633,0.800373 l -1.161831,0.232366 c -0.4303077,0 -0.774554,-0.163517 -1.03273859,-0.490551 -0.25818466,-0.344246 -0.38727699,-0.722917 -0.38727699,-1.136012 0.0172123,-0.361459 0.12048617,-0.757342 0.30982159,-1.18765 0.1721231,-0.413095 0.39588309,-0.774554 0.67128009,-1.084375 l 0.6454616,-0.568007 c 0.3958832,-0.361458 0.7315232,-0.593824 1.0069202,-0.697098 l 0.8520094,-0.33564 1.0069201,-0.18073 M 9.0212781,0.72987053 C 9.6237089,1.4872122 10.071229,2.25316 10.363838,3.027714 10.604811,3.7334187 10.751115,4.5079727 10.802752,5.3513759 10.424081,4.6112465 9.8646813,3.7764495 9.1245519,2.8469847 l -2.5302098,-3.17567122 0,-1.98802178 2.426936,3.04657883 M 9.1245519,-2.3167083 6.4652498,-5.621472 6.1296097,-5.7247459 c -0.3098216,0 -0.4905508,0.2323662 -0.5421878,0.6970986 l -0.025818,0 0,16.2914513 0.051637,0 0.4389139,0.955284 0.9294648,1.265105 2.039659,2.556028 c 0.6024308,0.757341 1.0499514,1.523289 1.3425604,2.297843 l 0.103274,0.33564 c -0.154911,0.619643 -0.232366,1.092982 -0.232366,1.420016 l 0.02582,0.309821 0.103275,0.232367 0.258184,0.129092 0.180729,-0.103274 0.05164,0.929465 -0.309821,1.781474 c -0.206548,0.757342 -0.309822,1.333954 -0.309822,1.729837 l 0.02582,0.309822 0.103275,0.232366 0.258184,0.129092 c 0.361459,-0.137698 0.705705,-0.757341 1.032739,-1.858929 l 0.49055,-2.272025 0.05164,-1.084376 c 0,-0.843403 -0.103275,-1.6782 -0.309821,-2.504391 l 0.258184,-1.394197 0.05164,-1.110194 c 0,-0.912253 -0.11188,-1.764262 -0.33564,-2.556028 l 0.284003,-1.471653 0.05164,-1.110194 c 0,-0.8950401 -0.11188,-1.7556556 -0.33564,-2.5818465 l 0.284003,-1.4716528 0.05164,-1.1101937 c 0,-1.4458341 -0.301215,-2.8228189 -0.903646,-4.1309545 -0.516369,-1.13601243 -1.239286,-2.2806311 -2.1687516,-3.4338558 m -2.5302098,7.1258964 0,-1.9622034 2.426936,3.046579 C 9.6237089,6.650905 10.071229,7.4168528 10.363838,8.191407 l 0.07746,0.2581847 -0.18073,1.110194 L 9.1245519,7.9848593 6.5943421,4.8091881 m 0,3.1756712 2.426936,3.0465787 c 0.6196431,0.791767 1.0671629,1.557714 1.3425599,2.297844 l 0.07746,0.284003 -0.18073,0.955283 -1.1360121,-1.574926 -2.5302098,-3.1756716 0,-1.8331111 M 5.5616033,3.6546509 6.5943421,3.791401 l 0,17.541604 -1.0327388,0 z"}]},{name:"tempoEquals",bounds:{left:0,right:7.7,top:0,bottom:16.3},svgPaths:[{d:"M0.5,10Q0.1,10 0,10.65L0,11.65L0.55,12.2L1.7,12.4L7.05,12.15L7.15,11.9L7.15,10.65Q7.15,10.2 6.4,10.15L0.5,10M7.5,16.3Q7.7,16.25 7.7,15.65L7.55,14.4L7.45,14.25Q4.9,14.1 0.75,14.1Q0.2,14.1 0.2,14.85L0.3,15.9Q0.5,16.3 1.15,16.3L7.5,16.3"}]},{name:"pDynamics",bounds:{left:-3.25,right:11.5,top:-19.65,bottom:5.55},svgPaths:[{d:"M11.5,-17.4Q11.5,-19.65 9.45,-19.65Q6.85,-19.65 3.9,-15L1.95,-11.5L0.45,-7.9L-0.55,-4.1L-0.85,-0.7L-0.85,1.35L-1.85,1.9L-2.75,2.45L-3.25,4.85Q-3.15,5.45 -2.6,5.55Q-1.15,5.25 1.2,3.7Q3.65,2.05 4.3,0.95Q4.75,0.2 4.75,-1.15Q4.75,-2 4.15,-2Q3.6,-2 0.95,0.3L0.7,-1.5Q0.7,-3.55 1.05,-4.25Q1.3,-3.8 2,-3.8Q3.05,-3.8 4.25,-4.55Q5.5,-5.35 6.85,-6.9Q8.3,-8.55 10.2,-11.95L11.2,-14.75L11.5,-17.4M7.8,-15.9Q8.65,-16.4 9.1,-16.4Q9.75,-16.4 9.75,-15.7Q9.75,-14.6 9.15,-13.4Q8.6,-12.15 7.5,-10.8Q6.45,-9.45 5.35,-8.6Q4.3,-7.7 3.25,-7.25L2.95,-7.25Q2.5,-7.25 2.15,-7.7L2.9,-9.7Q3.95,-12 5.15,-13.55Q6.4,-15.1 7.8,-15.9"}]},{name:"fDynamics",bounds:{left:-.95,right:14.55,top:-22.35,bottom:6.15},svgPaths:[{d:"M12.2,-22.35Q11.3,-22.15 10.45,-21.2Q9.6,-20.2 8.75,-18.45L5.75,-10.65L3.3,-10.2Q2.85,-9.9 2.5,-8.9Q2.15,-7.95 2.15,-7.3Q2.15,-6.2 2.9,-6.2L4.3,-6.4L2.2,-1.55L1.45,-1.55L1.2,-1.65Q0.7,-1.65 0.3,-1.15L-0.4,0.3L-0.95,3.1L-0.5,3.8L-0.25,4.6L-0.3,5.65Q-0.2,6.15 0.45,6.15Q0.9,6.15 1.65,4.75L3.45,0.45L6.15,-6.7L9.85,-7.3Q10.5,-7.5 10.85,-8.3Q11.2,-9.1 11.2,-10.4Q11.2,-11.4 10.8,-11.4L7.65,-10.85L9.45,-15.6L10.75,-18.45Q11.3,-19.4 11.75,-19.4L12.6,-18.85L12.9,-17.85L12.5,-15.95L12.75,-15.55Q12.95,-15.25 13.15,-15.25Q13.5,-15.25 13.9,-15.65L14.55,-18.85Q14.55,-20.1 13.95,-21Q13.35,-21.85 12.2,-22.35"}]},{name:"sfDynamics",bounds:{left:-.3,right:18,top:-15.55,bottom:11.95},svgPaths:[{d:"M14.3,-14.75L12.85,-13Q11.75,-11.2 10.8,-8.45L9.4,-4.4L6.9,-4.05Q6.4,-3.7 6.2,-3.05Q5.95,-2.4 5.95,-1.45Q5.95,-0.6 6.75,-0.65L8.15,-0.75L5.95,4.2L5.3,4.2L4.95,4.15Q4.5,4.15 4.1,4.6Q3.7,5.1 3.4,6.05L2.85,8.85L3.5,10.35L3.5,11.4Q3.6,11.95 4.2,11.95L5.35,10.5L7.2,6.2L9.8,-0.95L12.15,-1.2Q13.3,-1.35 14,-2Q14.75,-2.7 14.75,-4.25Q14.75,-5.2 14.35,-5.2L12.7,-5L11.05,-4.65L12.75,-9.4L14.15,-12.2Q14.75,-13.15 15.2,-13.15Q15.7,-13.15 16.05,-12.6L16.4,-11.6L16,-9.7L16.25,-9.3L16.65,-9Q17.05,-9 17.35,-9.4Q18,-11.3 18,-12.6Q18,-13.9 17.45,-14.5L15.85,-15.55Q15.05,-15.4 14.3,-14.75M6.7,-8.8L5.85,-10.15L4.6,-11.15L3.2,-11.5Q1.7,-11.5 0.95,-10.8Q0.2,-10.1 0.2,-8.65Q0.2,-7.8 0.55,-6.25L2.25,-0.45Q2.25,-0.3 2.05,-0.3Q1.4,-0.3 1.15,-0.85L0.6,-1.5Q0.25,-1.5 -0.05,-0.75L-0.3,0.35Q-0.3,1.35 0.35,2.1Q0.95,2.8 1.95,2.8L3.1,2.55Q3.8,1.65 3.8,-0.45Q3.5,-3.05 2.85,-4.65Q1.9,-7 1.9,-8Q1.9,-8.65 2.3,-8.65L4.15,-8.1Q5.3,-7.5 5.3,-6.8L4.95,-4.65Q4.95,-4.05 5.65,-4.05Q6.25,-4.05 6.65,-5.45Q7.05,-6.55 7.05,-7.35L6.7,-8.8"}]},{name:"ppDynamics",bounds:{left:-3.05,right:18.65,top:-21.8,bottom:5.7},svgPaths:[{d:"M18.25,-21Q17.85,-21.8 17,-21.8Q15.95,-21.8 14.75,-20.6Q13.55,-19.4 12.2,-17.05L11.85,-19Q11.4,-20.25 10.45,-20.25Q9.55,-20.25 8.95,-19.85L7.6,-18.55L5.8,-16.05Q4.05,-13.45 3.25,-11.55Q2.1,-8.9 1.15,-5.45L0.65,-2.1Q0.4,-0.05 -0.05,1L-2.05,2.4Q-3.05,3.3 -3.05,4.5Q-3.05,5.7 -2.45,5.7Q-2.15,5.7 1.95,3.05L6.75,-0.25L6.65,0.3L4.8,2.15Q4,3.15 4,4.7L4.2,5.3L4.3,5.35L4.5,5.4L4.85,5.35L5.3,5.05Q5.7,4.45 9.35,1.6L11.7,-0.45Q12.5,-1.25 12.5,-1.7Q12.5,-3.15 11.8,-3.15Q11.45,-3.15 8.45,-0.9L8.45,-1.1Q8.45,-2.35 8.75,-4Q9.15,-6.2 9.7,-6.5Q10.5,-6.55 11.85,-7.45L14.2,-9.55L16.35,-12.45L18.1,-15.75Q18.65,-17.3 18.65,-18.7Q18.65,-20.2 18.25,-21M14.5,-17.1Q15.35,-17.95 16.05,-18.25L16.45,-18.2L16.6,-17.95L16.6,-17.75L16.15,-15.45Q15.65,-14.25 14.7,-13.1L12.8,-11.3Q11.75,-10.5 10.55,-9.95Q11.2,-12.05 12.75,-14.65L14.5,-17.1M10.1,-15.85Q10.1,-15 9.7,-14.05L8.55,-12.25L7,-10.75L5.35,-9.8L5.05,-9.8L4.8,-10.05L4.65,-10.25Q4.95,-11.55 6.15,-13.55Q7.45,-15.75 8.3,-16.3L9.5,-16.85L9.75,-16.8L9.95,-16.6L10.1,-15.85M8.2,-8.55Q7.6,-6.65 7.05,-2.35L4.3,-1.25L1.7,0.2L2.2,-2.8Q2.45,-4.55 2.85,-5.7L3.1,-5.85Q4.3,-5.8 5.8,-6.9L8.2,-8.55"}]},{name:"pppDynamics",bounds:{left:-1.65,right:27.4,top:-20.9,bottom:5},svgPaths:[{d:"M17.55,-19.95Q16.15,-18.95 14.5,-17.05L14.55,-17.7Q14.55,-18.7 14.2,-19.4Q13.7,-20.25 12.9,-20.25Q11.85,-20.25 10.6,-19.45Q9.3,-18.65 7.7,-17.05Q4.85,-13.7 3.75,-11.95L1.35,-6.5Q0.75,-4.6 0.2,-0.6L-0.05,0.5Q-0.75,1 -1.05,1.95L-1.65,3.65L-1.65,3.95L-1.45,4.25L-1.15,4.45Q-0.5,4.45 1.75,3.4Q4.15,2.3 4.95,2.2L4.4,3.95Q4.4,4.7 4.9,4.7Q5.3,4.7 6,4.15L7.05,3.3L9.2,2.45Q10.75,1.9 11.2,1.45L11.95,0.3Q12.45,-0.5 12.45,-1.05Q12.45,-1.65 11.75,-1.65Q11.15,-1.65 10.25,-1.2L8.65,-0.55L8.65,-1.05Q8.65,-2.35 9.2,-4.25Q9.8,-6.1 10.6,-7.25Q12.75,-7.25 16.25,-9.05Q15.05,-6.25 14.45,-3.85Q13.9,-1.65 13.9,0.1L13.9,0.6L11.8,2.1Q10.85,2.95 10.85,4.4L10.9,4.8L11.1,5L11.25,5Q12.6,4.65 14.15,3.9L17,2.45L17.45,1.1L17.75,-0.25L17.3,-0.7L16.2,-0.4L16,-1.7L16.4,-5.05Q16.9,-7.35 17.5,-8.1L19.6,-8.35Q20.45,-8.55 21.45,-9.25Q23.45,-10.7 24.85,-12.5Q26.2,-14.3 26.95,-16.45L27.4,-18.65Q27.4,-19.6 27,-20.05Q26.6,-20.55 25.75,-20.55Q24.95,-20.55 23.6,-19.85L21.75,-18.45L21.3,-20Q20.85,-20.9 20.1,-20.9Q19,-20.9 17.55,-19.95M12.3,-17.05L12.6,-15.9Q12.6,-15.25 11.75,-14.45Q10.95,-13.7 9.35,-12.75L6.8,-11.4Q5.7,-10.95 4.85,-10.85Q6.05,-12.9 7.7,-14.65L9.95,-16.75Q10.85,-17.45 11.4,-17.45Q11.95,-17.45 12.3,-17.05M17.05,-12.7Q15.4,-11.4 13.9,-11L13.5,-11.05L13.2,-11.4L13.15,-11.85L13.95,-13.1L16.8,-16.45Q18.05,-17.55 18.95,-17.55Q19.75,-17.55 19.75,-16.25L19.4,-15.35Q18.7,-13.95 17.05,-12.7M9.95,-9.65L8.4,-5.75Q7.4,-3.25 6.65,0.25L6,0.5L6,0.35L6.15,-0.9L6.1,-1.25L5.95,-1.35L1.8,0.05L1.75,-0.3Q1.75,-1.5 2.3,-4.15Q2.8,-6.7 3.35,-7.75L4.1,-7.7Q5.65,-7.7 7.15,-8.3L9.95,-9.7L9.95,-9.65M19.55,-12.15L19.6,-12.45Q20.5,-14 21.7,-15.35L23.2,-16.75Q23.9,-17.25 24.45,-17.25Q25.15,-17.25 25.15,-16.4L24.7,-15.1L23.4,-13.6Q22,-12.35 20.45,-11.5L20.1,-11.5L19.55,-12.15"}]},{name:"mpDynamics",bounds:{left:-4.1,right:17.35,top:-15.9,bottom:8.95},svgPaths:[{d:"M13.9,-14.95Q12.8,-14 11.45,-12.05Q9.1,-8.4 8.25,-6.55Q7.35,-4.6 6.45,-1.7L4.65,5L4,5.4Q3.05,5.85 2.7,6.75Q2.5,7.25 2.4,8.65Q2.45,8.95 2.65,8.95Q3.25,8.95 8.2,6.5L8.9,6.05L9.25,5.25L9.65,3.15L9.55,3L9.4,2.95L6.4,4.15Q6.7,1.8 7.5,0.1L10.25,-1.15Q11.4,-2 12.55,-3.4L14.9,-6.85Q16.1,-8.9 16.75,-10.6Q17.35,-12.35 17.35,-13.6Q17.35,-14.75 16.95,-15.35Q16.6,-15.9 15.85,-15.9Q14.95,-15.9 13.9,-14.95M5.8,-12.85L4.5,-11.3L3.65,-10.25L3.85,-12.15L3.65,-13.7L3,-14.2Q2.4,-14.2 1.6,-13.55L-0.15,-11.6L-2.45,-7.8L-3.85,-4.15L-4.1,-3.05Q-4.1,-2.4 -3.6,-2.4Q-3.05,-2.4 -2.8,-2.8L-2.1,-4.55L-0.45,-7.85Q0.9,-10.25 1.65,-10.6L1.85,-10.25Q1.85,-9.15 1.1,-7.35Q0.35,-5.5 0.35,-4.5Q0.35,-3.6 1.1,-3.55Q1.65,-3.7 3.45,-6.65L5.1,-9L6.4,-10.25L5.45,-7.2Q4.9,-5.25 4.9,-4.15Q4.9,-3.2 5.35,-3.2Q5.9,-3.2 6.25,-3.55Q7,-5.15 7.75,-7.7Q8.55,-10.5 8.55,-12Q8.55,-13.6 7.6,-13.6Q6.65,-13.6 5.8,-12.85M9,-3.35L8.85,-3.5Q8.85,-4.95 11.25,-8.75L13.4,-11.7Q14.3,-12.7 14.95,-12.7Q15.35,-12.7 15.35,-11.95Q15.35,-10.95 14.8,-9.7L13.2,-7.1L11.15,-4.9Q10.2,-4 9.15,-3.4L9,-3.35"}]},{name:"mfDynamics",bounds:{left:-5.9,right:19.25,top:-21.1,bottom:9.85},svgPaths:[{d:"M17.65,-21.1Q16.8,-21.1 15.85,-19.85Q14.85,-18.5 13.75,-15.95L11.15,-9.1L9.45,-9.2Q8.5,-9.2 8,-8.2Q7.65,-7.4 7.65,-6.4Q7.65,-5.85 8.1,-5.55L9.5,-5.35L9.9,-5.4L7.9,0.6L7.35,0.35Q6.95,0.35 6.6,0.85Q6.25,1.4 5.95,2.45Q5.45,4.1 5.45,5.35L5.9,7.65L5.8,9Q5.8,9.85 6.4,9.85Q6.85,9.85 7.2,9.35L8.5,4.05Q9.45,0.7 11.75,-5.55Q14.1,-5.85 15.4,-6.4Q16.75,-6.95 17.05,-7.8L17.2,-9.3Q17.2,-10.25 16.8,-10.25L16,-10L15.2,-9.6L12.95,-9.2L15.7,-16.15Q16.75,-18.45 17.15,-18.45L17.25,-17.9L17.05,-15.65Q17.05,-14.35 17.7,-14.35Q18.5,-14.35 18.85,-15.45Q19.25,-16.55 19.25,-18.7L18.8,-20.25Q18.35,-21.1 17.65,-21.1M0.55,-13.25Q-0.25,-13.25 -1.3,-12.15L-3.55,-9.05L-5.3,-5.6Q-5.9,-4.1 -5.9,-3.15Q-5.9,-1.65 -5.4,-1.65Q-4.75,-1.65 -4.4,-2.55L-4.15,-3.85Q-4,-4.7 -2.7,-6.8L-0.7,-9.5L-0.55,-9.55Q-0.3,-9.55 -0.3,-8.95Q-0.3,-8.35 -0.65,-7.1L-1,-5.25Q-1,-4.45 -0.35,-4.45L0.4,-4.7L1.15,-5.75Q1.65,-6.7 3.5,-8.8Q5.5,-11 6.15,-11L6.3,-11L6.4,-10.55Q6.4,-9.3 5.15,-7.1Q3.9,-4.9 3.9,-3.65Q3.9,-2.6 4.5,-2.6Q5.7,-2.6 7.1,-6.8Q7.95,-9.3 8.35,-12.25L8.05,-13.8Q7.8,-14.3 7.2,-14.3L5.65,-13.95L4.05,-12.7L1.6,-9.85L1.4,-12.4Q1.1,-13.25 0.55,-13.25"}]},{name:"fzDynamics",bounds:{left:-1.6,right:15.05,top:-22.7,bottom:6.5},svgPaths:[{d:"M10.85,-19.85Q11.3,-19.35 11.3,-18.6L10.8,-16.25Q11.1,-15.75 11.45,-15.75Q12.15,-15.75 12.7,-17.6Q13.1,-18.95 13.1,-20.05Q13.1,-21.1 12.65,-21.85Q12.1,-22.7 11.05,-22.7Q10.35,-22.7 9.75,-22.1L8.55,-20.3Q7.75,-18.85 6.85,-16.2L5.25,-11.9Q2.6,-10.65 0.95,-9.3Q0.4,-8.4 0.4,-7.3Q0.4,-6.75 1.05,-6.55Q1.35,-6.6 2.45,-7.15L3.85,-7.95L2.5,-4.75L0.95,-1.55L0.75,-1.5L0.45,-1.55L0.15,-1.55Q-0.7,-1.55 -1.15,-0.75Q-1.6,0.1 -1.6,1.7L-1.2,4.35Q-0.7,6.5 -0.05,6.5L0.5,6.1L0.8,4.45Q1.15,1.95 2,-0.15L5.55,-8.35L5.8,-8.85Q8.25,-10 11.45,-11Q9.85,-7.9 8.05,-5.4L6.2,-2.9Q5.7,-2 5.7,-0.8Q5.7,-0.4 5.95,-0.1Q6.3,0.2 6.6,0.2Q7.1,0.2 8.75,-0.7L13,-3.35Q14.2,-4.1 14.6,-4.95Q15.05,-5.7 15.05,-7.15Q15.05,-7.75 14.55,-7.75L12.05,-6.4L9.8,-4.8L12.15,-8.55L13.25,-10.8L13.6,-12.55L13.4,-13.95Q13.15,-14.4 12.65,-14.4L7.15,-12.7L9.4,-18.25Q9.9,-19.3 10.7,-19.85L10.85,-19.85"}]},{name:"ffDynamics",bounds:{left:-1.5,right:21.75,top:-22.9,bottom:8.95},svgPaths:[{d:"M11,-22.9Q10.05,-22.9 8.95,-21.4Q7.8,-19.9 6.55,-16.85L3.6,-8.95L3.4,-8.9L1,-9.25L0.25,-9.05L-0.3,-7.9L-0.55,-6.65Q-0.55,-6 0.1,-5.65L2.2,-5.3L2.35,-5.3Q1.35,-2.2 0.95,-1.85Q0.4,-1.35 -0.3,-1.15L-1.2,-0.65Q-1.5,-0.15 -1.5,1.25Q-1.5,2.75 -1.15,3.45Q-0.8,4.2 -0.1,4.2L0.9,3.6Q1.4,3 1.75,1.8L2.85,-1.9Q3.45,-4 4.2,-5.45L9.2,-6.95Q8.85,-6.45 8.85,-6.1Q8.85,-5.3 9.6,-4.9L11.05,-4.45L8.25,2.35L7.5,1.75L7,1.95Q6.35,2.7 6.35,4.05L6.7,6.75Q7.15,8.95 7.5,8.95Q7.95,8.95 8.3,8.4L8.95,6.8L9.55,4Q10,1.95 10.9,-0.25L12.65,-4.3L16.05,-4.85Q17.2,-5.1 17.9,-5.55Q18.55,-6 18.75,-6.6L19.2,-8.3Q19.2,-8.95 18.5,-8.95L16.2,-8.45Q14.6,-7.95 13.9,-8L16.2,-13.8Q17.15,-16.05 17.85,-17.2Q18.6,-18.4 19.05,-18.4Q19.5,-18.4 19.5,-17.6L19.15,-15.3Q19.15,-14.9 19.45,-14.3Q19.8,-13.85 20.15,-13.85Q20.7,-13.85 21.25,-16.3L21.75,-19.4L21.45,-21Q21,-21.9 20.25,-21.9Q19.05,-21.9 18.05,-20.95Q17.1,-20 16.3,-18.1L12.25,-8.15Q11.3,-8.25 10.5,-8.65L10.55,-9.65L10,-10.4L5.5,-9.1L8.75,-17.7L9.85,-19.35L10,-19.4Q10.6,-19.4 10.6,-17.45L10.4,-14.95Q10.4,-13.7 11,-13.7L11.45,-13.85Q11.9,-14.1 12.45,-16.5L13,-19.5Q13,-20.65 12.45,-21.65Q11.85,-22.9 11,-22.9"}]},{name:"fffDynamics",bounds:{left:-3.05,right:29.55,top:-24.3,bottom:7.2},svgPaths:[{d:"M18.4,-23.4Q17.75,-22.75 17.35,-21.8L14.7,-15.8L11.9,-9.85Q11.45,-9.85 10.75,-10.25L9.65,-10.6Q9.3,-10.6 8.95,-9.8L8.45,-8.65L8.35,-9.25L8.05,-9.75L4.95,-9.2L10.2,-20.15L10.55,-20.3L10.95,-19.95L10.6,-17.25Q10.6,-16.6 11.2,-16.6L12,-17.05L12.7,-19.05L13.1,-21.2Q13.1,-22.6 12.75,-23.35Q12.4,-24.05 11.7,-24.05Q10.95,-24.05 10.3,-23.4Q9.6,-22.7 9,-21.3L3.45,-9.2L1.5,-9.3L0.75,-9.2L0.2,-8.15L-0.15,-6.95Q-0.15,-6.15 0.55,-5.95L1.85,-5.8Q1.1,-3.5 -0.45,-0.5L-0.5,-0.5L-0.8,-1.75L-1.25,-2.9L-1.65,-3L-2.2,-2.95L-3.05,-0.45L-2.85,1.8Q-2.55,3.45 -2.25,3.9Q-1.8,4.65 -0.65,4.65L-0.2,4.55Q0.25,4 0.75,2.15L1.45,-0.5Q2.3,-3.25 3.5,-5.75L5.85,-5.95Q7.15,-6.2 8,-6.85L8.5,-7.35L8.6,-7.35L10.2,-6.4L7.4,-0.85L7.05,0.2L6.95,0.3L6.85,0.15L6.75,-0.75L6.05,-1.2Q5.4,-1.2 4.8,0.65Q4.25,2.2 4.25,3.15Q4.25,4 4.7,5.05Q5.2,6.4 5.85,6.4Q6.55,6.4 6.9,5.05Q7.25,3.55 7.6,3.4L8.35,1.7L8.8,-0.15L10.2,-3.4Q11.35,-5.85 11.8,-6.35L15.25,-7.3Q16.15,-7.75 16.6,-8.45Q17,-9.15 17,-10.15L16.95,-10.8L16.8,-10.95L16.65,-10.95L15.25,-10.6L13.8,-10.05L18,-19.5L18.9,-20.65Q19.2,-20.65 19.2,-20.05L18.85,-18.2L18.4,-16.4Q18.4,-15.05 19.15,-15.05Q19.5,-15.05 19.9,-15.8L20.75,-18.05L21.45,-21.8Q21.45,-22.7 21.1,-23.4Q20.7,-24.3 19.95,-24.3Q19.25,-24.3 18.4,-23.4M18.5,-10.9Q17.9,-10.9 17.4,-9.75Q16.95,-8.65 16.95,-8.05Q16.95,-7.5 17.5,-7.25L18.45,-6.85L15.25,0.45L15.2,0.5L15.15,0.45L14.55,-0.7L14.15,-0.85L13.75,-0.8L13.05,0.25L12.85,2.05Q12.85,3.55 13.35,4.9Q13.9,6.5 15,7.15L15.35,7.2L15.7,6.95Q16,6.45 16.15,4.05Q16.3,1.35 16.65,0.7L19.65,-5.7L20.1,-6.5L22.3,-6.95Q23.9,-7.25 24.3,-7.7L25.15,-10.7Q25.15,-11.1 24.8,-11.1L23.3,-10.55Q22.25,-10.1 21.75,-10.15L21.55,-10.15L23.85,-15.05L25.5,-17.9L26.75,-19.25Q27.25,-19.25 27.25,-18.85L27.05,-15.95Q27,-15.2 27.8,-15.2L28.3,-15.4Q28.65,-15.7 29.1,-17.7L29.55,-20.35Q29.55,-21.35 29.2,-22Q28.75,-22.95 27.9,-22.95Q27.1,-22.95 26.1,-21.9Q25.05,-20.8 23.95,-18.65L19.9,-10.35Q18.9,-10.9 18.5,-10.9"}]},{name:"sfzDynamics",bounds:{left:-5.7,right:15.95,top:-24.1,bottom:6.1},svgPaths:[{d:"M12.1,-19.55L11.6,-17.1Q11.95,-16.65 12.2,-16.65L12.85,-16.85L13.65,-19.05L14.05,-21.4Q14.05,-22.55 13.6,-23.25Q13,-24.1 11.95,-24.1Q11.1,-24.1 10.25,-23.15L9.25,-21.3L5.9,-12.6L3.5,-11.45L1.4,-10Q1,-8.7 0.95,-7.9Q1,-7.2 1.55,-7.2Q1.95,-7.2 4.5,-8.6L3,-5.2L1.45,-1.95L1.25,-1.9L0.6,-2Q-0.25,-2 -0.7,-1.15Q-1.15,-0.35 -1.15,1.35Q-1.15,2.55 -0.75,4.05Q-0.25,6.1 0.45,6.1L0.95,5.9L1.25,4.2Q2.05,0.7 2.55,-0.6L6.45,-9.5Q9,-10.65 12.3,-11.7Q10.75,-8.65 8.7,-5.9L6.8,-3.35Q6.4,-2.6 6.4,-1.2L6.65,-0.5Q6.9,-0.2 7.3,-0.2Q7.75,-0.2 9.4,-1.1L13.85,-3.8Q14.9,-4.5 15.4,-5.45Q15.95,-6.35 15.95,-7.5L15.9,-8.1Q15.85,-8.3 15.4,-8.35Q14.35,-7.95 12.95,-6.95L10.7,-5.25L14.1,-11.5Q14.5,-12.5 14.5,-13.25L14.25,-14.7L13.5,-15.15Q10.75,-14.6 7.85,-13.4L10.1,-19.15Q10.7,-20.45 11.55,-21Q12.1,-20.5 12.1,-19.55M3.75,-18.3L2.7,-19.35Q1.4,-20.15 -0.05,-20.15L-1.4,-19.9L-2.4,-19.05L-3,-17.65L-3.15,-15.75L-2.85,-13L-1.5,-7.2L-1.55,-7.1L-1.9,-7.05Q-2.95,-7.05 -3.45,-7.35L-3.95,-8Q-4.25,-8.35 -4.6,-8.35L-4.8,-8.3Q-5.7,-7.5 -5.7,-6.05Q-5.7,-5.1 -5.25,-4.4Q-4.8,-3.55 -3.9,-3.55L-1.8,-3.55L-1.3,-3.65Q-0.95,-3.95 -0.2,-5.95L0.45,-8.55Q0.45,-9.65 -0.4,-12.1Q-1.25,-14.4 -1.25,-15.75L-1.15,-16.45L-0.1,-16.75Q0.8,-16.75 1.3,-16.3Q1.75,-15.9 1.75,-15.1L1.65,-13.7Q1.65,-12.5 2.3,-12.5L2.6,-12.5L2.8,-12.75Q3.65,-14.7 4.1,-17L3.75,-18.3"}]},{name:"sfpDynamics",bounds:{left:-5.2,right:18.3,top:-21.3,bottom:8.2},svgPaths:[{d:"M11.25,-21.3Q10.35,-21.3 9.25,-19.95Q8.35,-18.9 7.95,-17.9L5.95,-12.7L4.35,-9L1.2,-8.65L0.6,-7.65Q0.3,-7 0.3,-6.5Q0.3,-5.85 1.2,-5.85L3.15,-5.9L2.15,-3.2L0.9,-0.65Q0.7,-1.4 0.25,-1.4Q-0.4,-1.4 -0.6,-1.05L-1.2,0.75L-0.75,3.3L-0.2,5.6L0.25,5.7L0.75,5.5L1.9,3.15Q2.3,2.15 2.3,1.45L2.2,0.1L2.35,-0.55L4.35,-5.45L4.65,-6L8.4,-6.5Q9.55,-6.8 9.85,-7.3L10.3,-9L10.35,-9.1L10.3,-9.3Q10.1,-9.8 9.55,-9.8L5.95,-9.2Q7.25,-12.65 9.1,-16.8L9.75,-17.6L10.55,-18.1Q11.05,-18.1 11.05,-17.45L10.65,-15.55Q10.3,-14.25 10.3,-13.6Q10.3,-12.55 10.95,-12.55L11.5,-13L12.4,-15.45L13.05,-18.1Q13.05,-19.2 12.7,-20.1Q12.15,-21.3 11.25,-21.3M16.75,-13.25Q15.6,-13.25 14.7,-12.65L12.5,-10.55L10.05,-7.1Q7.35,-2.4 6.65,-0.55L6.2,1.75L5.6,3.95L4.25,4.75Q3.4,5.2 3.25,5.7L2.7,7.9L3.15,8.2L10.1,4.75L10.45,3.55L10.6,2.3L10.55,2L10.4,1.9Q9.55,2 7.35,3.15L7.65,1.85Q9.7,1.25 11.05,0.2L13.55,-2.1L15.8,-4.9L17.65,-8.35Q18.3,-9.95 18.3,-11.3Q18.3,-12.1 17.9,-12.65Q17.5,-13.25 16.75,-13.25M1.05,-13.05L1,-12.85Q0,-11.75 0,-10.2Q0,-9.35 0.7,-9.35Q1.2,-9.35 1.65,-9.8L2.5,-11.1Q3.15,-12.55 3.15,-13.85Q3.15,-15.15 2.3,-16.4Q1.4,-17.8 0.1,-17.8Q-0.7,-17.8 -1.35,-17.3Q-2,-16.85 -2.45,-15.9Q-3.3,-14.4 -3.3,-12.65Q-3.3,-11.65 -2.55,-10Q-1.85,-8.35 -1.85,-7.55Q-1.85,-6.75 -2.2,-6.2L-3.2,-5.35L-3.3,-5.6L-3.2,-6.8Q-3.2,-7.7 -3.7,-7.7L-4,-7.5Q-5.2,-5.35 -5.2,-4Q-5.2,-3.05 -4.85,-2.6Q-4.55,-2.1 -3.9,-2.1Q-3.05,-2.1 -2.35,-2.75Q-1.6,-3.45 -1,-4.75Q-0.5,-5.85 -0.25,-6.95L-0.05,-8.9Q-0.05,-9.9 -0.7,-11.5L-1.35,-13.7L-1.35,-14.15L-0.45,-14.45L0.55,-14.1L1.05,-13.05M8.95,-1.5L9.55,-2.75Q10.85,-5.2 13.05,-8.3L14.55,-9.7Q15.3,-10.15 15.95,-10.15L16.15,-10.15L16.25,-10.05L16.3,-9.5Q16.3,-8.95 15.9,-8.15L14.65,-6.3Q13.25,-4.35 12.1,-3.6L9.1,-1.45L9,-1.4L8.95,-1.5"}]},{name:"fpDynamics",bounds:{left:-.95,right:18.5,top:-21.4,bottom:8.2},svgPaths:[{d:"M11.5,-21.4Q10.6,-21.4 9.5,-20.05L8.2,-17.9L6.5,-13.45L4.65,-9.05L2.15,-9.45L1.3,-8.55Q0.8,-7.8 0.8,-7.3Q0.8,-6.55 1.75,-6.2L3.3,-5.75L2.4,-3.15L1.15,-0.7L0.85,-1.1L0.45,-1.3Q-0.2,-1.3 -0.65,-0.55L-0.95,0.8L-0.5,3.6Q0.1,5.75 0.7,5.8L0.95,5.6L2.1,3.2Q2.5,2.2 2.5,1.5L2.4,0.25Q2.4,-0.3 3.45,-2.65L4.75,-5.7L7.75,-6Q8.75,-6.25 9.3,-6.6Q9.85,-6.95 10.05,-7.5L10.45,-9.05Q10.45,-9.65 9.5,-9.65L6.2,-9.15L9.35,-16.9Q10.05,-18.1 10.95,-18.15L11.25,-17.1L10.95,-15.35L10.55,-13.7Q10.55,-12.6 11.15,-12.6L11.8,-13Q12.05,-13.25 12.7,-15.45L13.4,-18.15L12.95,-20.2Q12.45,-21.4 11.5,-21.4M16.95,-13.4Q15.9,-13.4 14.95,-12.8Q13.95,-12.15 12.8,-10.75L10.25,-7.2L8.2,-3.65Q7.3,-1.95 6.85,-0.6L6.35,1.85Q5.95,3.8 5.75,3.95L4.5,4.6Q3.75,5 3.45,5.65L2.9,7.7L3.3,8.2Q7.9,6.05 10.3,4.65Q10.85,3.75 10.85,2.5L10.6,1.85Q9.65,1.95 7.55,3Q7.65,2.15 7.95,1.8Q8.65,1.45 9,1.45Q10,1.1 11.25,0.1L13.8,-2.25L16,-5.05L17.85,-8.45Q18.5,-10.05 18.5,-11.45Q18.5,-12.2 18.15,-12.8Q17.7,-13.4 16.95,-13.4M9.15,-1.6L10.45,-4.15L13.55,-8.75L14.95,-9.95L16.15,-10.3L16.45,-10.3L16.5,-10.2L16.6,-9.65Q16.6,-8.8 15.9,-7.65L13.75,-5.05L11.35,-2.85L9.35,-1.55L9.25,-1.5L9.15,-1.6"}]},{name:"rfzDynamics",bounds:{left:-7.6,right:16.3,top:-25.1,bottom:5.1},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M14.85,-14.25Q14.85,-12.65 13.35,-10.2L11.05,-6.25L13.3,-7.95Q14.9,-9.05 15.8,-9.35L16.25,-9.1L16.3,-8.5Q16.3,-6.2 14.2,-4.8Q8.65,-1.2 7.65,-1.2Q7.3,-1.2 7,-1.5L6.75,-2.2Q6.75,-3.5 7.2,-4.35L9.1,-6.9Q12.15,-11.05 12.65,-12.7Q10.65,-12.25 6.8,-10.5L4.8,-6.05L2.95,-1.6Q1.9,0.85 1.6,3.2L1.35,4.9L0.85,5.1Q0.1,5.1 -0.35,3.1L-0.8,0.35Q-0.8,-3 1,-3L1.3,-2.9L1.6,-2.9L1.85,-2.95L3.4,-6.2L4.85,-9.6Q2.35,-8.15 1.9,-8.15Q1.4,-8.15 1.3,-8.9L1.8,-11Q2.1,-11.5 3.9,-12.4L6.3,-13.6L8.15,-18.7L9.6,-22.3L10.65,-24.1Q11.5,-25.1 12.3,-25.1Q13.35,-25.1 13.95,-24.25Q14.4,-23.55 14.4,-22.35L14.05,-20.05L13.2,-17.85L12.55,-17.6Q12.25,-17.6 12,-18.1L12.25,-19.3L12.45,-20.55Q12.45,-21.5 11.95,-22Q11.05,-21.4 10.5,-20.15L8.2,-14.4Q12.6,-16.15 13.9,-16.15Q14.85,-16.15 14.85,-14.25M-6.25,-20.05L-5.85,-19.95L-3.15,-21.1L-0.3,-20.8Q1.3,-20.05 1.5,-18.7Q1.75,-17.3 1,-14.3L0.8,-14.05L0.55,-14Q-0.1,-13.85 -0.35,-15L-0.45,-16.4Q-0.75,-18.1 -2.6,-17.7L-3.55,-17.25L-3.5,-16.5Q-3.35,-15.3 -2.05,-13.1Q-0.8,-10.75 -0.6,-9.75L-0.8,-7.05L-1.15,-6L-1.5,-5.8L-2.35,-7.95L-2.3,-8.1L-3,-9.75L-4.5,-13.55L-5.45,-16.15L-6.7,-17.6Q-7.65,-18.5 -7.6,-18.85Q-7.4,-19.8 -6.7,-20.2L-6.25,-20.05"}]},{name:"tabClef",bounds:{left:0,right:14.15,top:0,bottom:67},svgPaths:[{d:"M11.1,10.6L9.1,11.45L9.1,16.8L9.05,22.15Q9,26 7.75,26.05Q7.25,26 7.25,24.95L7.25,12.15L4.9,13.1Q3.25,13.8 2.65,13.8Q2,13.8 2,12.45Q2,10.45 3.2,9.85L8.6,7.8L13.4,6Q14.15,6 14.15,7.1Q14.15,9.15 13.1,9.8L11.1,10.6M7.65,31.4Q6.85,31.6 6.2,34.2L5.4,37.6L6.8,37.4L8.25,37.15L7.7,31.5L7.65,31.4M8.95,27.7Q9.35,28.05 9.4,28.5L10.05,35.8Q10.1,36.3 10.5,37.4Q10.85,38.35 10.8,38.95L10.65,39.9L10.5,40.85L10.65,43.1L10.8,45.45Q10.8,46.55 10,46.6Q9.45,46.6 9.2,46.3Q8.85,45.9 8.6,40.85L4.8,41.45L4.4,43.25L4,45.55Q3.75,46.55 3,46.55Q2.25,46.55 2.3,44.45Q2.4,40.9 3.75,35.6Q5.95,27.3 8.15,27.3Q8.65,27.3 8.95,27.7M12.3,59Q12.3,62.2 9.95,64.6Q7.65,67 4.55,67L3.3,66.75Q2.5,66.45 2.5,65.95L2.55,60.65L2.55,55.35Q2.4,55.1 2.4,54.65L2.45,54Q2.65,52.1 4.75,49.85Q6.9,47.6 8.75,47.55Q10.85,47.55 10.85,50.35Q10.85,52.15 8.85,54.75L9.15,54.7Q9.55,54.7 10.25,55.05Q12.3,55.9 12.3,59M8.65,50.6Q7.7,50.6 6,52Q4.25,53.45 4.25,54.35L4.25,55.15L4.3,55.9L7.15,53.6Q8.95,51.8 9.05,50.7L8.65,50.6M4.25,61.6L4.3,63.65L5.3,63.9Q7,63.9 8.75,62.5Q10.5,61.1 10.45,59.35Q10.45,57.9 8.7,57.9Q6.7,57.9 4.2,59.55L4.25,61.6"}]},{name:"tab0",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M2.55,-0.4Q2.55,1.9 2.8,2.75Q3,3.6 3.35,3.9L4.15,4.15L5,3.9L5.55,2.85L5.8,-0.4L5.55,-3.55L4.95,-4.7L4.15,-4.95L3.35,-4.7Q3,-4.4 2.8,-3.65Q2.55,-2.7 2.55,-0.4M1.3,-5.7Q2.3,-7 4.15,-7Q6.05,-7 7.15,-5.65Q8.4,-4.05 8.4,-0.4Q8.4,3.3 7.1,4.9Q6.05,6.2 4.15,6.2Q2.25,6.2 1.15,4.75Q0,3.3 0,-0.4Q0,-4.05 1.3,-5.7"}]},{name:"tab1",bounds:{left:0,right:5.7,top:-7,bottom:6},svgPaths:[{d:"M0,-1.5L0,-3.75Q0.95,-4.1 2.15,-4.95Q3.25,-5.85 3.7,-7L5.7,-7L5.7,6L3.2,6L3.2,-3.4Q1.9,-2.15 0,-1.5"}]},{name:"tab2",bounds:{left:0,right:8.8,top:-7,bottom:6},svgPaths:[{d:"M2.75,-3L0.3,-3.25Q0.5,-5.25 1.7,-6.15Q2.85,-7 4.6,-7Q6.55,-7 7.65,-5.95Q8.8,-4.95 8.8,-3.4L8.45,-1.75L7.4,-0.1L5.75,1.55L4.25,3L3.75,3.7L8.8,3.7L8.8,6L0,6Q0.15,4.7 0.85,3.5Q1.6,2.35 3.7,0.4L5.75,-1.7Q6.3,-2.5 6.3,-3.25Q6.3,-4.05 5.8,-4.5L4.55,-4.95Q3.75,-4.95 3.3,-4.5Q2.85,-4.05 2.75,-3"}]},{name:"tab3",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M4.15,-7Q5.95,-7 6.95,-5.85Q7.85,-4.9 7.85,-3.7Q7.85,-2 6.05,-1Q7.1,-0.75 7.75,0.1Q8.4,0.9 8.4,2.1Q8.4,3.8 7.15,5Q6,6.2 4.2,6.2Q2.45,6.2 1.3,5.2Q0.2,4.15 0,2.5L2.4,2.2Q2.5,3.15 2.95,3.65Q3.45,4.15 4.15,4.15Q4.85,4.15 5.35,3.6Q5.85,3 5.85,2Q5.85,1.05 5.4,0.5Q4.95,-0.05 4.25,-0.05L3.25,0.15L3.5,-1.85Q4.45,-1.85 4.95,-2.3Q5.4,-2.75 5.4,-3.55Q5.4,-4.2 5.05,-4.6Q4.7,-4.95 4.05,-4.95Q3.45,-4.95 3.05,-4.5Q2.6,-4.05 2.55,-3.2L0.3,-3.6Q0.5,-4.8 1,-5.5Q1.45,-6.2 2.3,-6.6L4.15,-7"}]},{name:"tab4",bounds:{left:0,right:9.2,top:-7,bottom:5.9},svgPaths:[{d:"M7.6,-7L7.6,1.15L9.2,1.15L9.2,3.35L7.6,3.35L7.6,5.9L5.15,5.9L5.15,3.35L0,3.35L0,1.2L5.45,-7L7.6,-7M5.15,1.15L5.15,-3.1L2.3,1.15L5.15,1.15"}]},{name:"tab5",bounds:{left:0,right:8.7,top:-7,bottom:6},svgPaths:[{d:"M3.05,-2.5L4.75,-2.9Q6.4,-2.9 7.55,-1.7Q8.7,-0.5 8.7,1.4Q8.7,3.05 7.8,4.3Q6.55,6 4.3,6Q2.5,6 1.35,5.05Q0.2,4.05 0,2.4L2.45,2.15Q2.55,3 3.1,3.5Q3.6,3.95 4.3,3.95Q5.05,3.95 5.6,3.35Q6.1,2.7 6.1,1.5Q6.1,0.3 5.6,-0.3Q5.05,-0.9 4.2,-0.9Q3.1,-0.9 2.3,0.05L0.3,-0.25L1.55,-7L8.15,-7L8.15,-4.7L3.4,-4.7L3.05,-2.5"}]},{name:"tab6",bounds:{left:0,right:8.6,top:-7,bottom:6.2},svgPaths:[{d:"M2.55,-1.35Q3.45,-2.45 4.85,-2.45Q6.4,-2.45 7.5,-1.25Q8.6,-0.05 8.6,1.8Q8.6,3.8 7.45,5Q6.3,6.2 4.5,6.2Q2.55,6.2 1.25,4.7Q0,3.15 0,-0.3Q0,-3.85 1.3,-5.45Q2.6,-7 4.7,-7Q6.2,-7 7.15,-6.2Q8.05,-5.35 8.3,-3.8L6,-3.55L5.5,-4.65L4.55,-4.95Q3.75,-4.95 3.2,-4.25Q2.7,-3.55 2.55,-1.35M3.25,-0.05Q2.75,0.5 2.75,1.6Q2.75,2.85 3.3,3.5Q3.9,4.15 4.6,4.15Q5.3,4.15 5.8,3.65Q6.25,3.1 6.25,1.85Q6.25,0.6 5.75,0Q5.25,-0.6 4.5,-0.6Q3.75,-0.6 3.25,-0.05"}]},{name:"tab7",bounds:{left:0,right:8.4,top:-7,bottom:5.8},svgPaths:[{d:"M8.4,-7L8.4,-5.15Q7.35,-4.15 6.25,-2.2Q5.2,-0.25 4.65,1.9Q4.05,4.1 4.1,5.8L1.7,5.8Q1.75,3.1 2.8,0.3Q3.85,-2.45 5.6,-4.7L0,-4.7L0,-7L8.4,-7"}]},{name:"tab8",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M0.3,-3.7Q0.3,-5.15 1.3,-6.05Q2.3,-7 4.15,-7Q6,-7 7,-6.05Q7.95,-5.15 7.95,-3.7Q7.95,-2.8 7.55,-2.1Q7.1,-1.4 6.25,-1Q7.3,-0.6 7.9,0.25Q8.4,1.1 8.4,2.15Q8.4,3.95 7.3,5.1Q6.15,6.2 4.3,6.2Q2.55,6.2 1.35,5.3Q0,4.2 0,2.25Q0,1.2 0.5,0.35Q1.05,-0.55 2.15,-1Q1.2,-1.45 0.75,-2.15Q0.3,-2.85 0.3,-3.7M4.15,-1.95Q4.85,-1.95 5.3,-2.35Q5.7,-2.8 5.7,-3.5Q5.7,-4.2 5.3,-4.65Q4.85,-5.05 4.15,-5.05Q3.45,-5.05 3.05,-4.6Q2.6,-4.2 2.6,-3.5Q2.6,-2.75 3.05,-2.35Q3.45,-1.95 4.15,-1.95M6,2.05Q6,1.15 5.5,0.6Q5,0 4.2,0Q3.35,0 2.9,0.65Q2.45,1.3 2.45,2.05Q2.45,3.1 2.95,3.65Q3.5,4.25 4.25,4.25Q5,4.25 5.5,3.7Q6,3.15 6,2.05"}]},{name:"tab9",bounds:{left:0,right:8.6,top:-7,bottom:6.2},svgPaths:[{d:"M2.9,-4.4Q2.45,-3.9 2.45,-2.65Q2.45,-1.35 2.95,-0.8Q3.45,-0.2 4.2,-0.2Q4.9,-0.2 5.35,-0.75Q5.85,-1.3 5.85,-2.45Q5.85,-3.65 5.3,-4.3Q4.75,-4.95 4.05,-4.95Q3.35,-4.95 2.9,-4.4M1.15,-5.8Q2.35,-7 4.15,-7Q6.1,-7 7.35,-5.5Q8.6,-3.95 8.6,-0.5Q8.6,3.05 7.3,4.65Q6,6.2 3.9,6.2Q2.4,6.2 1.5,5.4Q0.55,4.6 0.3,3L2.7,2.75Q2.75,3.5 3.15,3.85Q3.5,4.15 4.1,4.15Q4.85,4.15 5.4,3.45Q5.9,2.75 6.05,0.55Q5.15,1.65 3.75,1.65Q2.2,1.65 1.1,0.45Q0,-0.7 0,-2.6Q0,-4.6 1.15,-5.8"}]},{name:"halfBendAlteration",bounds:{left:0,right:17.15,top:-5,bottom:5},svgPaths:[{d:"M2.7,-4.95L4.25,-4.95L4.25,4.85L2.4,4.85L2.4,-2.25Q1.35,-1.25 0,-0.8L0,-2.5L1.6,-3.4Q2.45,-4.1 2.7,-4.95M10.75,-2.1Q10.9,-3.65 11.8,-4.35Q12.65,-4.95 14,-4.95Q15.5,-4.95 16.3,-4.2Q17.15,-3.4 17.15,-2.25L16.9,-1L16.1,0.25L14.85,1.5L13.75,2.55L13.35,3.1L17.15,3.1L17.15,4.85L10.55,4.85Q10.7,3.85 11.2,2.95Q11.7,2.05 13.3,0.6L14.85,-1Q15.25,-1.55 15.25,-2.1L14.95,-3.1L13.95,-3.4L13,-3.1Q12.65,-2.75 12.6,-1.95L10.75,-2.1M10.2,-5L7.85,5L6.4,5L8.7,-5L10.2,-5"}]},{name:"fullBendAlteration",bounds:{left:0,right:19.25,top:-5,bottom:5.05},svgPaths:[{d:"M4.65,-4.8L4.4,-3.5L3.55,-3.6L3,-3.45Q2.75,-3.2 2.75,-2.7L2.75,-2.25L4.2,-2.25L4.2,-0.75L2.75,-0.75L2.75,4.9L0.95,4.9L0.95,-0.75L0,-0.75L0,-2.25L0.95,-2.25L0.95,-2.75L1.15,-4.05Q1.3,-4.5 1.8,-4.8L3.1,-5L4.65,-4.8M7.15,-2.25L7.15,1.05L7.2,2.9L7.6,3.4L8.25,3.65L9.1,3.35L9.6,2.7Q9.8,2.3 9.8,0.75L9.8,-2.25L11.6,-2.25L11.6,4.9L9.85,4.9L9.85,3.8L8.9,4.75L7.6,5.05L6.35,4.75Q5.75,4.45 5.5,3.9Q5.25,3.3 5.25,2.3L5.25,-2.25L7.15,-2.25M19.25,-4.85L19.25,4.9L17.4,4.9L17.4,-4.85L19.25,-4.85M15.45,-4.85L15.45,4.9L13.6,4.9L13.6,-4.85L15.45,-4.85"}]},{name:"pullOff",bounds:{left:-4.5,right:5.4,top:-6,bottom:6.95},svgPaths:[{d:"M2.75,-1.95L2.3,-3.15Q1.9,-3.6 1.25,-3.7L-0.65,-3.8L-1.9,-3.8L-1.9,-0.1L-0.45,-0.1L1.6,-0.3Q2.15,-0.5 2.45,-0.95L2.75,-1.95M5.4,-2Q5.4,-0.8 4.95,0Q4.55,0.85 3.85,1.3L2.5,1.9L-0.2,2.1L-1.9,2.1L-1.9,6.95L-4.5,6.95L-4.5,-6L-0.3,-6L2.8,-5.8Q3.9,-5.5 4.65,-4.5Q5.4,-3.55 5.4,-2"}]},{name:"hammerOn",bounds:{left:-5,right:5.3,top:-6,bottom:6.95},svgPaths:[{d:"M2.7,-6L5.3,-6L5.3,6.95L2.7,6.95L2.7,1.25L-2.4,1.25L-2.4,6.95L-5,6.95L-5,-6L-2.4,-6L-2.4,-0.9L2.7,-0.9L2.7,-6"}]},{name:"octaveUp",bounds:{left:0,right:25.75,top:0,bottom:20},svgPaths:[{d:"M25.55,3.75Q25.55,0 24.2,0Q23.65,0 23.1,0.45Q22.55,0.95 21.95,1.95Q20.45,5.2 19.7,7.8Q17.65,14.6 17.65,17.85Q17.65,18.8 18.3,19L18.55,18.8L19.2,15.8Q19.4,13.9 19.9,12.8L23.8,11.35L22.95,14.8Q22.35,16.9 22.35,18.35Q22.35,18.85 22.8,19Q23.3,18.9 23.6,18.1L24.35,13.95Q24.6,12.3 25,11.1L25.45,10.05L25.75,9L25.65,8.35Q25.4,8.1 25.4,7.5L25.5,5.65L25.55,3.75M23.55,2.75Q24.1,2.75 24.1,4.9L24.1,8.35L22.4,9.25L20.45,9.9Q20.4,9.05 21.65,5.95L22.8,3.55Q23.25,2.75 23.55,2.75M12.95,7.75Q12.95,6.1 12.7,6.1Q12.3,6.1 11.9,6.9L11.5,8.05L11.5,15Q11.5,16.05 11.95,17.2Q12.45,18.7 13.35,18.7L14.45,18.25L15.75,16.05L17.45,11.65Q19.25,6.3 19.25,4.45Q19.25,3.25 18.95,3.25Q18.5,3.25 18.05,4.95L15.9,11.75L14.7,14.45L13.65,15.7Q12.9,14.6 12.9,9.8L12.95,7.75M8.45,5.7Q8.45,6.5 7.05,7.25L4.95,7.9Q4.45,7.9 4.4,7.55Q4.7,6.85 6,5.65Q7.35,4.35 8.05,4.35L8.35,4.45L8.45,5L8.45,5.7M7.5,1.85L5.75,3.05Q4.1,4.55 3.4,6Q2.7,7.6 2.7,9Q2.7,10 3.9,10.65L4.05,10.8Q3.75,11.7 1.75,14Q0.85,14.95 0.45,15.9Q0,16.8 0,17.65Q0,18.8 0.5,19.4Q1.05,20 2.1,20Q3.6,20 4.95,19.2Q6.35,18.45 7.6,16.9Q8.8,15.4 9.45,13.9Q10.05,12.45 10.05,10.95L9.55,7.65L10.35,3.45Q10.35,2.45 10.05,1.95Q9.7,1.45 9.05,1.45L7.5,1.85M7.55,11.15Q7.9,11.15 8.25,11.4L8.55,12.1Q8.55,12.85 8,13.65L6.4,15.35L4.45,16.7L2.8,17.1Q2.1,17.1 1.8,16.75Q1.85,16.15 2.45,15.3L4.15,13.35Q5.25,12.25 6.1,11.7Q7,11.15 7.55,11.15"}]},{name:"octaveDown",bounds:{left:0,right:28.6,top:-19.95,bottom:0},svgPaths:[{d:"M17.35,-12.5L13.85,-6.65L13.35,-5.95L13.25,-5.9L13,-12.7L12.45,-13.05L11.8,-12.7Q11.35,-11.3 11.35,-10.35Q11.35,-6.45 11.65,-4.15Q11.9,-1.9 12.4,-1.3L12.85,-1.25Q13.55,-1.25 14.05,-2.25L14.7,-3.85L17.9,-9.7L19.55,-13.25Q20.05,-14.7 20.05,-15.5L20.05,-17.35Q20.05,-17.8 19.45,-17.65L17.35,-12.5M6,-13.85Q6.3,-13.85 6.3,-13.65Q6.1,-12.95 4.85,-12.05Q3.55,-11.25 2.75,-11.25Q2.2,-11.25 2.25,-11.6Q3.2,-12.75 4.15,-13.3Q5.05,-13.85 6,-13.85M2.35,-15.05Q1.25,-14.05 0.75,-12.95Q0.25,-11.85 0.25,-10.6Q0.25,-9.6 0.65,-9L1.95,-8.05L2.05,-7.95L0.7,-5.85Q0,-4.6 0,-3.5Q0,-1.9 0.55,-1.1Q1.1,-0.3 2.2,-0.3Q2.9,-0.3 3.85,-0.8L5.95,-2.35L7.7,-4.1L8.75,-5.7Q9.2,-6.8 9.2,-8.75Q9.2,-9.65 8.8,-10.4L7.55,-11.55L7.5,-11.75Q8.4,-13.6 8.4,-14.65Q8.4,-15.85 8,-16.5Q7.6,-17.1 6.75,-17.1Q4.35,-17.1 2.35,-15.05M7.6,-8L7.1,-6.8L5.65,-5.3L3.9,-4L2.65,-3.6Q1.9,-3.6 1.8,-3.9L1.85,-4.1Q3.15,-6.2 4.45,-7.3Q5.75,-8.35 7.05,-8.35L7.4,-8.25L7.6,-8.1L7.6,-8M19.75,-1.1Q19.95,-0.4 20.4,-0.05L20.75,0Q22.1,-0.45 23.4,-1.3L25.85,-3.35L27.8,-6Q28.45,-7.35 28.45,-8.65Q28.45,-10 27.9,-10.75Q27.5,-11.4 26.2,-12.1Q28.6,-15.8 28.6,-17.6Q28.6,-19.1 27.7,-19.8L26.9,-19.95Q25.9,-19.95 24.6,-19.05L22.95,-17.5L21.75,-15.5Q21,-13.75 20.6,-11.1L19.55,-2.7L19.75,-1.1M23.85,-14.9Q25.2,-16.2 26.45,-16.65L26.65,-16.65L26.65,-16.5L24.8,-14.05Q23.4,-12.4 22.65,-12.05L22.45,-12.05L22.4,-12.2L22.8,-13.5L23.85,-14.9M22.05,-8.95L23.05,-9Q26.15,-9 26.55,-7.9Q26.2,-6.85 24.5,-5.35Q22.75,-3.75 21.8,-3.75L21.25,-4L21.1,-4.4L21.5,-6.75Q21.85,-8.8 22.05,-8.95"}]},{name:"trill",bounds:{left:0,right:15.7,top:-12.7,bottom:7.9},svgPaths:[{d:"M7.2,-12.65Q6.4,-11.9 5.8,-10L4.8,-6.95L1.05,-6.65Q0.75,-6.4 0.4,-5.4L0,-3.95Q0,-3.05 1.95,-3.05L3.9,-3.15L3.95,-3.15Q3.05,0.9 2.6,5.35Q2.6,6.15 3.05,6.5Q3.5,6.95 4.35,6.95Q5.6,6.95 9.15,3.4L12.05,0.7Q13.1,-0.2 13.5,-0.2L13.75,0.3Q13.75,1.25 13.15,3.25Q12.55,5.2 12.55,6.3Q12.55,7.1 12.8,7.5Q13.1,7.9 13.6,7.9Q14,7.9 14.4,6.8L14.9,5.4L14.7,4.75L14.4,4.2L15.2,1.15Q15.7,-0.65 15.7,-2Q15.7,-2.95 15.35,-3.45Q15,-3.95 14.25,-3.95Q13.65,-3.95 12.4,-3.05L9.35,-0.35Q6.85,2.05 5.05,3.2L4.75,3L5.05,-0.3Q5.3,-2.55 5.7,-3.35L9,-3.65Q9.65,-3.7 9.9,-4.3L10.2,-6Q10.2,-6.65 9.8,-6.8L6.35,-6.95L8,-12.2L7.6,-12.7L7.2,-12.65"}]},{name:"graceUp",bounds:{left:-4.45,right:9.6,top:0,bottom:20.85},svgPaths:[{d:"M9.6,11.7L-4.45,20.85L-4.45,18.4L9.6,9.2L9.6,11.7"}]},{name:"graceDown",bounds:{left:-2.75,right:10.7,top:-18.45,bottom:0},svgPaths:[{d:"M10.7,-9.85L-2.75,-18.45L-2.75,-16.55L10.7,-8L10.7,-9.85"}]},{name:"tap",bounds:{left:-5,right:5.2,top:0,bottom:12.95},svgPaths:[{d:"M5.2,2.2L1.4,2.2L1.4,12.95L-1.2,12.95L-1.2,2.2L-5,2.2L-5,0L5.2,0L5.2,2.2"}]},{name:"tremolo3",bounds:{left:-9.35,right:9.5,top:-11.1,bottom:10.85},svgPaths:[{d:"M8.1,-9.05Q8.9,-9.75 8.9,-10.35L8.45,-11.1L3.45,-9.9L-1.05,-8.25L-4.3,-7.05L-7.45,-6.2L-8,-6.15L-8.85,-4.6L-9.35,-2.8Q-9.35,-1.9 -8.55,-1.9Q-6,-2.35 -3.7,-3.2Q-1.4,-4.05 1.1,-5.3L5.55,-7.45L8.1,-9.05M5.3,-4.2L0.3,-2.15L-5.9,0.1Q-7.15,0.55 -7.95,1.25Q-8.7,1.9 -9.05,2.7Q-9.35,2.95 -9.35,3.5Q-9.35,4.5 -8.4,4.6Q-3.5,3.05 1.35,1.1Q5.35,-0.85 7.45,-2.25Q9.45,-3.65 9.45,-4.35Q9.45,-4.9 8.85,-4.9L5.3,-4.2M8.1,1.3L-3.3,5.5Q-6.9,6.9 -7.75,7.45L-8.4,8.55Q-8.8,9.2 -8.8,9.75Q-8.8,10.85 -7.7,10.85L-7.1,10.8L-4.7,10L2.55,7.45Q5.45,6.05 7.15,4.85Q8.85,3.6 9.4,2.5L9.5,2.3Q9.5,1.65 9,1.55L8.1,1.3"}]},{name:"tremolo1",bounds:{left:-8.5,right:8.35,top:-5.4,bottom:5.9},svgPaths:[{d:"M8.3,-3.7L8.35,-3.9Q8.35,-4.5 7.95,-4.9Q7.55,-5.4 7,-5.4L5.75,-5Q1.45,-3.3 -0.6,-2.2L-6.6,1.55L-7.75,2.75Q-8.5,3.75 -8.5,4.1L-8.45,5.2L-7.9,5.9Q-7.1,5.9 -5,4.85Q-2.9,3.8 0.45,1.8L5.75,-1.55Q7.7,-2.95 8.3,-3.7"}]},{name:"tremolo2",bounds:{left:-10.4,right:9.35,top:-7.7,bottom:9.2},svgPaths:[{d:"M8.25,-7.7Q5.7,-7.5 4.35,-6.9L-9.9,0.65Q-10.2,1.55 -9.6,2.7L-9.3,2.95L-8.9,2.95L-7.4,2.65L-5.65,1.8L4.45,-4.1L8.85,-6.85Q8.9,-7.25 8.25,-7.7M5,-1.25Q3.15,-0.5 0.95,0.65L-5.95,4.45Q-9.35,6.45 -10.4,7.7Q-10.3,8.55 -9.6,8.95L-9.2,9.2Q-7.55,8.9 -5.75,7.8L7,0.3L9.35,-1.45Q8.9,-2.35 8.3,-2.3L5,-1.25"}]},{name:"quarterBendAlteration",bounds:{left:0,right:17.2,top:-5,bottom:5},svgPaths:[{d:"M16,-4.9L16,1.25L17.2,1.25L17.2,2.9L16,2.9L16,4.85L14.1,4.85L14.1,2.9L10.2,2.9L10.2,1.25L14.35,-4.9L16,-4.9M10.2,-5L7.95,5L6.45,5L8.7,-5L10.2,-5M0,-0.85L0,-2.5Q0.75,-2.75 1.55,-3.4Q2.45,-4.1 2.75,-4.95L4.25,-4.95L4.25,4.85L2.4,4.85L2.4,-2.25Q1.4,-1.25 0,-0.85M14.1,1.25L14.1,-2L11.95,1.25L14.1,1.25"}]},{name:"repeatMeasure",bounds:{left:0,right:21,top:-19.25,bottom:0},svgPaths:[{d:"M19.25,-19L1.9,-6.1L0.25,-4.35Q0,-3.9 0,-2.65L0.05,-0.9Q0.2,-0.3 1.2,0Q4.9,-3.5 8.1,-5.9L14.5,-10.6L20.75,-15.3L21,-16.55Q21,-18.45 20.25,-19L19.75,-19.1L19.25,-19M4.85,-19.25L3.45,-18.8L2.45,-17.65Q1.85,-16.3 1.85,-14.6Q1.85,-11.6 3.55,-11.4Q6.15,-12.3 6.15,-17.9L6.15,-18.6Q5.95,-19.25 4.85,-19.25M17,-7.65Q15.75,-7.65 15.15,-6.55Q14.5,-5.45 14.5,-3.25Q14.5,-2.1 14.9,-1.25Q15.45,-0.15 16.45,-0.15Q17.15,-0.15 17.55,-0.6L18.2,-2.65L18.45,-4.85Q18.45,-6.25 18.1,-6.95Q17.7,-7.65 17,-7.65"}]},{name:"breath",bounds:{left:-2.7,right:2.55,top:0,bottom:13.8},svgPaths:[{d:"M2.55,3.9Q2.55,2.9 2.05,1.55Q1.5,0 0.55,0Q-0.65,0 -1.75,2.3Q-2.7,4.25 -2.7,5.6L-2.55,6.45Q-2.1,7.1 -1.1,7.1L0.05,6.8L0.2,6.85Q0.25,7.35 -0.85,9.7Q-2.1,12.2 -2.1,12.95L-2.1,13.15L-1.85,13.65L-1.4,13.8Q-0.85,13.7 -0.05,12.8Q1.1,11.3 1.85,8.6Q2.55,6.15 2.55,3.9"}]},{name:"caesura",bounds:{left:-12.1,right:9.65,top:-.65,bottom:26.7},svgPaths:[{d:"M9.4,-0.65Q8.95,-0.65 8.05,0.05Q6.8,0.95 5.5,2.9L3.35,6.15L1.35,9.75L-2,16.85L-4.1,20.95L-5.55,23.6L-6.35,26Q-5.85,26.7 -5.05,26.7L-4.55,26.7Q-3.3,25.6 -2.25,23.75L-0.4,20.4Q1.1,17.8 2.4,14.75L6.7,5.25L8.45,2.4Q9.65,0.35 9.65,-0.35L9.4,-0.65M3.15,-0.45L2.65,-0.5Q0.55,0.7 -2,4.95L-6.2,13.3L-9.6,20.15L-12.1,24.05Q-11.9,24.95 -10.8,25.7L-10.35,25.75Q-9.7,25.45 -9.1,24.8L-7.85,23.1L-6,19.7Q-5.05,18 -4.2,15.9L-1.7,10.1Q0.05,6.1 1,4.45L2.4,2.15L3.55,-0.25L3.15,-0.45"}]},{name:"commonTime",bounds:{left:0,right:14.75,top:-12.05,bottom:12.05},svgPaths:[{d:"M7.75,-8L9.2,-8.4L10.1,-7.9L9.5,-5.95Q9.05,-4.7 9.05,-3.9Q9.05,-2.3 9.85,-2.3Q10.7,-2.3 11.3,-2.7Q11.9,-3.1 12.3,-3.9Q13,-5.25 13,-6.95L12.8,-9.2Q12.6,-10.15 12.2,-10.75L11.2,-11.7L9.8,-12.05L8,-11.7Q7.15,-11.35 6.25,-10.6L4.55,-8.85L2.95,-6.35Q1.45,-3.85 0.75,-1.6Q0,0.65 0,2.65Q0,6.35 1.8,9.05Q2.85,10.55 4.25,11.25Q5.65,12.05 7.4,12.05Q9.2,12.05 10.8,11.2Q12.45,10.4 13.9,8.75Q14.65,7.85 14.7,7.25L14.75,6Q14.75,4.7 14.45,4.7L13.45,5.75L11.5,7.5Q10.1,8.45 8.55,8.45L5.9,8.05Q4.75,7.65 3.85,6.8Q2.95,5.95 2.5,4.8Q2.05,3.65 2.05,2.2Q2.05,0.75 2.45,-0.7L3.65,-3.65Q4.45,-5.2 5.5,-6.3Q6.55,-7.4 7.75,-8"}]},{name:"cutTime",bounds:{left:0,right:14.85,top:-21.85,bottom:21.9},svgPaths:[{d:"M7.45,-21.7L6.95,-21.85Q6.45,-21.85 6.1,-20.9L5.85,-19.45L6.15,-7.8L3.9,-5.1L2,-2Q1,-0.05 0.5,1.6Q0,3.35 0,4.85Q0,6.65 0.4,7.9Q0.8,9.2 1.55,10Q2.3,10.75 3.55,11.2L6.55,11.75L6.65,20.3Q6.65,21.25 7.05,21.8L7.5,21.9L8.15,20.85L8.35,19.15L8.3,11.55L10.2,10.55L12.15,8.8L13.8,6.7Q14.4,5.7 14.45,4.85L14.7,2.6Q14.75,2.1 14.25,2.1Q13.85,2.1 11.5,4.9L9.45,7L8.05,7.65L8.05,7.5L8.1,-5.8Q9,-6.5 11.25,-6.9L10.15,-4.3Q9.4,-2.6 9.4,-1.65Q9.4,-0.55 9.75,0.05Q10.1,0.55 10.8,0.55Q11.55,0.55 12.2,-0.1L13.6,-2.1Q14.85,-4.5 14.85,-6.1Q14.85,-7.75 14.25,-9.1L13.3,-10.35L11.95,-10.8L9.95,-10.35L7.95,-9.1L7.8,-18.35Q7.7,-21.5 7.45,-21.7M4.85,-2.7L6.35,-4.35L6.5,7.9L6.35,7.9L4.65,7.65Q3.9,7.45 3.4,6.95L2.7,5.75Q2.45,5.05 2.45,4.1Q2.45,2 3.6,-0.45L4.85,-2.7"}]},{name:"turn",bounds:{left:-14.75,right:12.75,top:0,bottom:15.3},svgPaths:[{d:"M12.75,2.75L12.6,0.7Q12.45,0 12.15,0Q11.7,0 10.6,2.5L8.25,7.1L6.5,8.95Q5.65,9.55 4.8,9.55Q3.8,9.55 2.85,9L0.85,7.3L-2.55,3.15Q-3.55,2.05 -4.7,1.5Q-5.75,0.95 -6.9,0.95L-8.4,1.25L-9.85,2.15Q-11.65,4.15 -12.5,5.8Q-13.65,7.9 -14.2,9.8Q-14.75,11.75 -14.75,13.45L-14.45,15.15L-13.95,15.3Q-13.35,15.3 -12.8,13.6L-11.6,9.95L-10.6,8L-9.35,6.85Q-8.7,6.4 -8.25,6.4Q-7.15,6.4 -6.15,6.95Q-5.1,7.45 -4.15,8.55L-0.7,12.65Q0.3,13.75 1.45,14.3L3.75,14.8L5.4,14.55L7,13.7Q8.05,12.95 10.05,10.4Q11.4,8.4 12.1,6.45Q12.75,4.55 12.75,2.75"}]},{name:"mordent",bounds:{left:-12.75,right:14.8,top:-.25,bottom:9.25},svgPaths:[{d:"M14.8,1.4L14.6,0.15L14.35,-0.1Q13.8,0 12.2,2.25Q10.55,4.65 9.9,5.05L9.7,5.1L8.55,4.45L6.75,2.4Q4.6,-0.25 4,-0.25Q3.05,-0.25 0.9,1.9L-2.2,4.65Q-2.65,4.65 -4.25,2.25Q-5.05,1 -5.7,0.45Q-6.35,-0.15 -6.95,-0.15Q-8.6,-0.15 -10.75,3.25L-12.25,6.2L-12.75,8.45Q-12.75,9.4 -12.2,9.25Q-11.3,8.75 -9.6,6.15L-8.3,4.35Q-7.7,3.7 -7.35,3.7Q-6.85,3.9 -5.15,6.3Q-3.65,8.45 -2.55,8.45L-1.2,8L0.6,6.6L3.65,4L4,4L7.1,7.5L9.5,9.1L11.1,8L12.95,5.8L14.35,3.35L14.8,1.4"}]},{name:"invertedMordent",bounds:{left:-9.95,right:12.4,top:0,bottom:21.25},svgPaths:[{d:"M12.4,7.5Q12.4,6.55 11.7,6.35Q10.95,6.45 9.6,8.7L7.7,11.6L7.6,11.6Q6.95,11.15 5.65,9.1Q4.45,7.2 3.65,6.75Q2.5,6.95 1.25,8.55L1.35,3Q1.35,1.15 0.9,0.3L0.1,0Q-0.5,0 -0.85,0.55Q-1.15,1.05 -1.15,2L-0.9,3.8Q-0.75,4.85 -0.75,7.5L-0.85,11.15L-1.5,11.6Q-1.9,11.6 -3.15,9.2Q-4.4,6.85 -5.3,6.85L-6.1,7L-6.75,7.85Q-8.35,10 -9.15,11.8Q-9.95,13.6 -9.95,14.95L-9.9,16L-9.75,16.3L-9.5,16.25Q-9,15.9 -7.5,13.15Q-6.2,10.7 -5.6,10.65L-5.45,10.75L-4.3,12.15L-3.25,14.1Q-2.55,15.45 -1.8,15.45L-1,15.2L-1.15,20.2Q-1.15,21.25 -0.55,21.25Q0.05,21.25 0.4,20.35Q0.8,19.45 0.9,17.7L1.1,13.05L3.2,10.9L3.45,10.9L4.75,12.9Q5.4,14.25 6.65,15.2Q7.15,15.55 7.35,15.55L8.85,14.35L10.55,11.95L11.95,9.35L12.4,7.5"}]},{name:"pedalDown",bounds:{left:0,right:29.6,top:0,bottom:19.05},svgPaths:[{d:"M21.35,3.75Q18.3,4.9 18.15,5.3L17.7,6.5L17.5,7.85L17.5,8.15L17.7,8.45L18.2,8.6L19.2,8.1Q19.95,7.65 20.35,7.65L19.75,12.1L19.6,17.1Q19.6,18.55 19.75,18.9L20.3,19Q21.1,19 21.7,18.25L22.65,16.9L26.4,10.4L27.35,7.85L27.65,5.75Q27.65,2.55 24.9,2.55L21.35,3.75M21.95,7Q23.3,6.15 24.7,6.15Q25.9,6.15 25.9,7.15Q25.9,7.9 25.55,8.65L23.7,12.05Q22,14.8 21.7,14.8Q21.3,14.8 21.15,14.4L21.4,10.3Q21.75,7.35 21.95,7M27.65,18.25Q27.65,19.05 28.2,19.05Q28.8,19.05 29.25,17.95L29.6,16.25Q29.6,15.5 28.95,15.5Q28.35,15.5 27.95,16.6Q27.65,17.55 27.65,18.25M16.65,1.1L13.95,2.6Q10.5,4.85 10.05,5.55Q9.6,6.1 9.4,6.9L9.2,8.75Q9.2,9.15 9.6,9.15L10,9L9.6,16.2Q9.6,17.75 10.1,18.25Q10.65,18.8 12.2,18.8Q16.85,18.8 16.85,14.95Q16.85,14.15 16.4,14.25L16.2,14.3L14.45,15.25L12.45,15.55L11,15.45L11.15,13L14.05,12.05Q16.25,11.1 16.4,10.5L16.85,8.3L16.85,8L16.4,7.7L14.05,8.85Q11.9,9.95 11.05,9.95L11.1,8.75L11.05,8.25Q11.25,7.8 11.8,7.45L17.8,3.8Q18.55,3.25 18.55,1.55L18.3,0.65Q17.75,0.6 16.65,1.1M9.15,0.8Q8.5,0 6.85,0Q4.95,0 2.85,1.6L1.15,3.25Q0.45,4.1 0.2,5L0,6.65Q0,7.1 0.3,7.45L0.65,7.45L2.4,5.8L3.95,4.25Q4.95,3.5 6.3,3.5Q7.25,3.5 7.85,3.95Q7.75,4.55 7.25,5.15L5.6,6.5Q3.65,7.75 2.4,7.85L2.35,6.65L2.15,6.5L1.85,6.65Q1.45,7.55 1.35,8.9L0.85,17.55Q0.8,18.25 1.4,18.25L2.4,17.6Q2.8,17.1 2.8,16.45L2.45,15.7L2.15,15.05L2.35,11.6L4.3,10.5L6.25,9.4Q8,8 8.85,6.45Q9.7,4.9 9.7,3.25Q9.7,1.5 9.15,0.8"}]},{name:"pedalUp",bounds:{left:0,right:18.95,top:-3.95,bottom:18.95},svgPaths:[{d:"M7,-0.05L7.25,3.35L7.35,3.95L5.45,2.2Q4.7,1.65 4.3,1.65Q3.65,1.65 3.3,2.5Q2.95,3.35 2.95,5Q2.95,5.45 3.65,5.9L4.75,6.55L3.55,6.65L1.7,6.55Q0.65,6.55 0.3,7.3Q0,7.85 0,9Q0,10 0.5,10.55Q0.9,11.05 1.8,11.05L5.1,10.25L4.3,11.9Q3.75,12.95 3.75,13.65L3.95,14.7Q4.3,15.1 4.6,15.1L5.45,14.5L7.65,10.8L8.05,15.25Q8.05,16.85 8.3,17.8Q8.45,18.7 8.8,18.95L9,18.9L9.2,18.75Q9.95,17.05 9.95,16.4L9.45,10.6L11.75,12.2L14.05,13.5L14.3,13.35Q14.9,12.5 14.9,11.85Q14.9,11.05 14.15,10L11.85,7.7L15.8,6.4Q17.1,5.95 17.9,5.35L18.95,4.15Q18.7,3 18.2,2.4L17.4,2.2Q16.85,2.2 15.25,2.85L13.1,3.7L14.45,2.1Q15.35,1.05 15.35,0.35Q15.35,-1.25 14.45,-1.2L13.05,0.15L9.05,4.85L8.95,0.45L8.5,-3.75L8.15,-3.95Q7.5,-3.95 7.2,-2.25L7,-0.05"}]},{name:"tenorVoiceClef",bounds:{left:0,right:34.6,top:-47.55,bottom:40.15},svgPaths:[{d:"M25.45,-38.25Q27.55,-36.4 27.6,-34.2Q27.6,-30.75 25.3,-27.2L20.6,-21.3L17.5,-17.35L17.05,-17.05L16.95,-16.55L16.9,-12.25L16.9,-11.15Q19.05,-13.3 22.1,-14.95Q25.7,-16.85 28.3,-16.85Q31.5,-16.85 33.2,-14.45Q34.65,-12.4 34.6,-9Q34.6,-3.7 28.7,3.6Q23.85,9.4 18.1,13.6Q18.15,14.35 18.75,15.15L19.8,16.75Q20.35,18.1 20.35,20.15L20.3,21.65Q17.4,26 16.25,26Q15.1,26 14.4,24.1Q13.85,22.65 13.85,21.3Q13.85,18.3 16.25,15.35L16.1,14.45Q12.2,15.65 8.75,15.65Q4.5,15.65 2.1,11.8Q0,8.6 0,4Q0.05,0.15 4.1,-6.2Q5.8,-9 10.8,-15.55L13.9,-20L14.1,-21.8L13.8,-28.75L13.55,-35.75Q13.55,-39.3 14.3,-41.95Q13.75,-43.45 13.75,-45.4Q13.7,-47.55 15.2,-47.55Q15.85,-47.55 16.4,-47.15Q17,-46.7 17.05,-46L17,-45.05L17.05,-44.1Q18.05,-42.85 20.95,-41.15Q24.45,-39.1 25.45,-38.25M23.25,-33.45Q22.05,-34.7 20.1,-35.85L16.55,-37.8L16.45,-35.45L16.55,-30.65L16.7,-25.85L16.7,-24.95L16.7,-24.05L16.7,-23.1L20.35,-28.15Q22.75,-31.6 23.25,-33.45M11.75,-5.15Q12.75,-7.4 14.05,-9.3L14.1,-14.15Q11.3,-11.55 7.1,-5Q2.5,2.15 2.5,5Q2.5,7.55 4.55,8.9Q6.25,10.05 9,10.05Q12.15,10.05 14.9,8.7L15.05,7.65L14.8,3.3L14.55,-1.05L14.6,-2.85L13.45,-0.3Q12.5,1.5 11.65,1.5Q10.4,1.5 10.45,-0.7Q10.45,-2.3 11.75,-5.15M17.35,-3.8Q17.35,1.35 17.85,7.3Q19,7 23.85,1.95L29.65,-4.55Q31.5,-7.2 31.5,-8.4Q31.5,-10.6 29,-10.6Q26.75,-10.6 22.5,-8.8Q17.95,-6.8 17.5,-5.05Q17.35,-4.6 17.35,-3.8M17.1,29.35Q16.55,29.55 15.85,30.35Q15.1,31.15 15.15,31.7L15.15,31.8L15.4,31.85Q16.9,31.85 19.65,28.55L20.25,27.65L20.15,27.45L19.8,27.35L19.4,27.45L18.7,28.75Q18.15,29.5 17.65,29.5L17.1,29.35M14.75,34.05Q13.7,33 13.7,31.3Q13.7,29.85 14.75,28.5Q17.55,25.05 19.7,25Q21.65,25 21.65,27.9Q21.7,29.25 21,30.05L20.75,30.25Q22.95,30.5 23.55,30.9Q24.6,31.55 24.6,33.5Q24.55,35.35 21.5,37.8Q18.55,40.15 16.6,40.15Q15.35,40.15 14.55,39.05Q13.8,38.05 13.8,36.7Q13.8,35.15 14.75,34.05M16.25,37.85Q17.5,37.85 18.9,36.95L21.2,35.2Q22.85,33.8 22.85,33.15L22.75,32.95L21.25,32.65L20.6,32.75L17.5,34.85Q15.1,36.4 15.15,37.2Q15.1,37.85 16.25,37.85"}]},{name:"coda",bounds:{left:0,right:32.2,top:-2,bottom:42.1},svgPaths:[{d:"M14.8,-0.5Q14.5,0.7 14.5,2.8L14.5,5.6Q13.05,6 11.75,7Q10.45,8.05 9.35,9.8Q8.3,11.3 7.7,12.85Q7.05,14.45 6.75,16.15L1.2,16.35Q0.6,16.6 0.3,17.5Q0,18.4 0,19.9Q0,20.55 0.4,20.9Q0.85,21.25 1.7,21.25L6.65,21.2Q6.85,22.9 7.7,24.6Q8.55,26.35 10.05,28.05L11.8,29.45L14.4,30.6L14.5,40.95Q14.5,42.1 15.15,42.1L15.7,41.8Q16.05,41.45 16.1,36.55L16.1,30.55Q17.6,30.15 19,29.2L21.5,26.8L23.25,24.05Q24,22.55 24.4,20.95L30.75,20.6L31.9,20.1Q32.15,19.85 32.2,18.35L32.2,16.5Q31.65,16 28.35,16L26.65,16.05L24.55,16.1L24,13.05Q23.65,11.65 22.95,10.35L21.35,8.05Q20.25,6.7 19.1,6.05Q17.9,5.4 16.65,5.4L16.2,5.4L16.1,-1.5L16.2,-1.55Q16.15,-1.95 15.55,-2Q15.05,-1.7 14.8,-0.5M22.3,16L22.25,16.1L16.25,16.05L16.25,9.1L16.45,9.05Q17,9.05 17.9,9.65L19.55,10.8L20.9,12.3Q21.6,13.25 21.95,14.15Q22.3,15.1 22.3,16M20.85,22.45L19.35,24.2Q17.55,26 16.2,26.5L16.2,21.1L21.45,21.1L20.85,22.45M13.05,10Q13.85,9.35 14.45,9.35L14.35,16.1L9.2,16.1L9.15,15.85Q9.15,14.6 11.2,12L13.05,10M9.25,21.2L14.25,21.15L14.25,26.6Q12.15,25.7 11.05,24.55L10,23.1L9.25,21.2"}]},{name:"segno",bounds:{left:0,right:21.85,top:0,bottom:29.6},svgPaths:[{d:"M20.85,12.4Q20.35,11 19.55,11Q19,11 18.75,11.45Q18.5,11.95 18.5,12.9Q18.5,14.45 19.3,15.85L20.15,16.1Q21.25,16.1 21.25,14.6Q21.25,13.5 20.85,12.4M15.45,9L12,14.65L7.9,13Q6.05,12.25 3.6,10.55Q2.6,9.75 2.15,8.85Q1.65,7.95 1.65,7Q1.65,6.2 1.95,5.45Q2.2,4.75 2.75,4.15Q3.3,3.55 4,3.25L5.5,2.95Q7.35,2.95 7.65,3.8Q7.2,4.6 7.2,5.6Q7.2,6.75 7.6,7.8Q8.15,9.05 9.15,9.05Q10,9.05 10.45,8.1Q10.8,7.4 10.8,6.45L10.35,4.3L9.5,2.25Q8.9,1.25 7.7,0.6Q6.45,0 5.35,0Q4.15,0 3.15,0.45Q2.15,0.85 1.4,1.75Q0.7,2.55 0.35,3.6Q0,4.6 0,5.85Q0,7.55 0.35,8.9Q0.7,10.3 1.4,11.35L2.95,13.05Q3.85,13.85 5.15,14.6L10.3,16.95L7.55,20.8Q5.3,24 5.3,24.45Q5.3,25.15 5.8,26.75L6.25,26.95L6.55,26.95Q8.05,25.4 9.9,22.55L12.95,17.95Q13.9,18.25 15.05,19L17.5,20.95L19.65,23.35Q20.35,24.45 20.35,25.35L20.1,25.95L19.6,26.3Q19.25,26.3 18.55,25.15Q17.8,24 17.3,24Q16.65,24 16.3,24.4Q15.95,24.8 15.95,25.55Q15.95,27.15 16.6,28.25L17.6,29.25Q18.15,29.6 18.9,29.6Q20.2,29.6 21,28.7Q21.85,27.8 21.85,26.5Q21.85,24.95 21.25,23.3Q20.65,21.7 19.45,20.1Q18.3,18.6 17,17.45Q15.65,16.3 14.15,15.55L17.55,9.95L19.4,6.45Q20,5.05 20,4.3Q20,4 19.55,4L18.85,4.15Q17.3,6.05 15.45,9M3.8,17.05Q3.2,17.05 2.85,17.75Q2.55,18.25 2.55,19.05Q2.55,20.15 3.25,21.7L4.1,21.95Q5,21.95 5.5,20.35L4.9,17.75Q4.3,17.05 3.8,17.05"}]},{name:"arpeggio",bounds:{left:0,right:5.65,top:-11.65,bottom:0},svgPaths:[{d:"M5.65,-8.15L5.6,-8.3L5.55,-8.5L3.25,-11.6L3.1,-11.65L2.9,-11.55L2,-10.2Q2,-9.7 3.45,-7.95L3.85,-7.4L3.85,-7.35L3.35,-6.85L2.75,-6.45Q1.05,-5.5 0.9,-5.15L0.3,-4.4Q0,-4 0,-3.6Q0.45,-2.15 2.25,0L3.25,-0.55L3.95,-1.15L2.05,-4.25L2.05,-4.4L2.6,-4.85L4.05,-5.6Q4.85,-6.1 5.2,-6.7Q5.65,-7.35 5.65,-8.15"}]},{name:"arpeggioUp",bounds:{left:-2.65,right:7.95,top:-16.55,bottom:0},svgPaths:[{d:"M1.6,-5.75L-2.65,-3.6L2.55,-16.55L7.95,-3.6L4.7,-5.25L3.6,-4.15Q2.3,-3.2 2.05,-1.85Q2.15,-1.05 2.95,0L2.25,0L0.9,-1.5Q0.2,-2.35 0,-3.3Q0.2,-4.75 1.6,-5.75"}]},{name:"arpeggioDown",bounds:{left:-2.65,right:7.95,top:-10.05,bottom:6.65},svgPaths:[{d:"M2.25,-10L2.95,-10L4.35,-8.5Q5.05,-7.65 5.25,-6.7Q5.05,-5.25 3.6,-4.15L3.35,-3.95L7.95,-6.3L2.55,6.65L-2.65,-6.3L0.55,-4.65L1.65,-5.8Q2.95,-6.8 3.2,-8.1Q3,-9.25 2.25,-10"}]},{name:"twoOctavesUp",bounds:{left:0,right:36.65,top:-22,bottom:0},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M16.75,-21.4L16.6,-21.95L16.35,-22Q14.3,-21.6 12,-20.4Q9.3,-19.1 8.15,-17.95L6.45,-15.3Q5.25,-13.4 5.25,-12.35Q5.25,-12 5.5,-11.85L6.8,-12.05L8.1,-12.3Q9.5,-12.3 10.4,-11.6Q11.55,-10.75 11.55,-9.55Q11.55,-8.45 10.95,-7.2Q10.25,-5.65 9.45,-5.45L9.25,-5.45L8.7,-6.3L8.4,-6.4Q7.85,-6.2 7.3,-5L6.9,-3.15Q6.9,-1.65 8.05,-1.65Q9.45,-1.65 11.15,-4.1Q12.6,-6.2 13.15,-7.85Q13.8,-9.65 13.8,-11.3Q13.8,-15.1 9.4,-15.65L9.95,-16.05L15.35,-18.75Q16.75,-19.4 16.75,-21.4M3.5,-17.85L3.2,-17.75Q2.15,-16.2 1.85,-14.15L0,-1.75L0,-1.3Q0,-0.45 0.35,-0.1L0.5,0L0.7,-0.1L1.4,-1.7L1.95,-3.5L3.75,-17.2L3.75,-17.4L3.5,-17.85M20.2,-10.75L20.55,-9.9L20.2,-7.85L19.9,-5.7Q19.9,-4.6 20.65,-4.6L21,-4.65L21.9,-6.5L24.45,-9.9Q26.6,-12.65 26.9,-12.8L26.9,-12.25Q26.9,-10.4 26,-6.65Q25.1,-2.95 25.1,-1.05L25.15,-0.9L26,-0.65L26.2,-0.75Q27.35,-2.9 28.3,-7.5Q29.15,-11.9 29.15,-14.55Q29.15,-16.8 28.15,-16.8Q27.25,-16.8 25.55,-14.5L23.1,-11.5L22.85,-11.4L22.55,-13.2Q22.25,-14.7 21.15,-14.7Q20.2,-14.7 19.35,-13.55Q18.1,-11.8 16.5,-8.1Q14.7,-3.95 14.7,-2.35Q14.7,-0.5 15.5,-0.6L15.75,-0.65L16.1,-1.05Q16.75,-2.75 16.8,-3.65Q18.2,-8.55 19.9,-10.65L20.2,-10.75M35.1,-19.3Q32.95,-19.3 30.55,-11.45Q28.5,-4.6 28.5,-1.4Q28.5,-0.45 29.15,-0.3L29.45,-0.45L30.1,-3.5Q30.3,-5.4 30.8,-6.45L34.7,-7.9L33.85,-4.45Q33.25,-2.5 33.25,-0.95Q33.25,-0.35 33.7,-0.3Q34.15,-0.3 34.5,-1.15L35.25,-5.3L35.9,-8.15L36.35,-9.15L36.65,-10.25L36.55,-10.9Q36.3,-11.15 36.3,-11.75L36.4,-13.6L36.45,-15.5Q36.45,-19.3 35.1,-19.3M35,-14.35L35,-10.9L33.25,-10L31.35,-9.35Q31.3,-10.25 32.55,-13.3Q33.8,-16.5 34.4,-16.5Q35,-16.5 35,-14.35"}]},{name:"invertedTurn",bounds:{left:-13.9,right:13.6,top:0,bottom:22.3},svgPaths:[{d:"M11.45,4.7L9.1,9.3L7.35,11.15Q6.5,11.75 5.65,11.75Q4.65,11.75 3.7,11.2Q2.7,10.65 1.7,9.5L1.4,9.15L1.4,0.65L1.3,0.4L1.2,0.25L-0.2,0L-0.75,0.75L-0.8,1.15L-0.75,6.5L-1.7,5.35Q-2.7,4.25 -3.85,3.7Q-4.9,3.15 -6.05,3.15L-7.55,3.45Q-8.3,3.75 -9,4.35Q-10.8,6.35 -11.65,8Q-12.8,10.1 -13.35,12Q-13.9,13.95 -13.9,15.65L-13.6,17.35L-13.1,17.5Q-12.5,17.5 -11.95,15.8L-10.75,12.15L-9.75,10.2L-8.5,9.05Q-7.85,8.6 -7.4,8.6Q-6.3,8.6 -5.3,9.15Q-4.25,9.65 -3.3,10.75L-0.7,13.85L-0.65,21.95L-0.55,22.2L-0.45,22.3L1.1,22.3L1.25,22.25L1.35,22.1L1.4,21.85L1.4,16L2.3,16.5Q3.4,17 4.6,17L6.25,16.75L7.85,15.9Q8.9,15.15 10.9,12.6Q12.25,10.6 12.95,8.65Q13.6,6.75 13.6,4.95L13.45,2.9Q13.3,2.2 13,2.2Q12.55,2.2 11.45,4.7"}]},{name:"shake",bounds:{left:0,right:25.6,top:-5,bottom:3.45},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M4.05,-2.1Q2.6,-2 1.8,-1.15L0,0.75Q0.55,-0.75 3.3,-3.1Q5.05,-4.65 7.6,-5Q8.85,-4.85 9.35,-3.5Q9.8,-2.3 10.6,-1.05L12.7,-0.95L16.25,-4.45L18.45,-4.35L19.15,-3.3L20.65,-0.95Q21.8,0.4 23.5,0.05L25.6,-1.25L22.6,1.95L20.85,3.05L19.7,3.25L19.15,3.15Q18.25,2.9 17.4,1.9L15.3,-0.3Q14.4,-1.35 13.9,-0.85L11.75,1.6Q10.3,3.2 8.8,3.45Q7.55,3.4 6.85,2.2L5.6,-0.85Q4.95,-2.05 4.05,-2.1"}]},{name:"twoOctavesDown",bounds:{left:0,right:40.05,top:-21.5,bottom:.5},svgPaths:[{fill:"rgba(35,31,32,1)",d:"M10.4,-15.55L9.85,-15.15Q14.25,-14.6 14.25,-10.8Q14.25,-9.15 13.6,-7.35Q13.05,-5.7 11.6,-3.6Q9.9,-1.15 8.5,-1.15Q7.35,-1.15 7.35,-2.65L7.75,-4.5Q8.3,-5.7 8.85,-5.9L9.15,-5.8L9.7,-4.95L9.9,-4.95Q10.7,-5.15 11.4,-6.7Q12,-7.95 12,-9.05Q12,-10.25 10.85,-11.1Q9.95,-11.8 8.55,-11.8L7.25,-11.55L5.95,-11.35Q5.7,-11.5 5.7,-11.85Q5.7,-12.9 6.9,-14.8L8.6,-17.45Q9.75,-18.6 12.45,-19.9Q14.75,-21.1 16.8,-21.5L17.05,-21.45L17.2,-20.9Q17.2,-18.9 15.8,-18.25L10.4,-15.55M3.65,-17.25L3.95,-17.35L4.2,-16.9L4.2,-16.7L2.4,-3L1.85,-1.2L1.15,0.4L0.95,0.5L0.8,0.4Q0.45,0.05 0.45,-0.8L0.45,-1.25L2.3,-13.65Q2.6,-15.7 3.65,-17.25M16.2,-0.15L15.95,-0.1Q15.15,0 15.15,-1.85Q15.15,-3.45 16.95,-7.6Q18.55,-11.3 19.8,-13.05Q20.65,-14.2 21.6,-14.2Q22.7,-14.2 23,-12.7L23.3,-10.9L23.55,-11L26,-14Q27.7,-16.3 28.6,-16.3Q29.6,-16.3 29.6,-14.05Q29.6,-11.4 28.75,-7Q27.8,-2.4 26.65,-0.25L26.45,-0.15L25.6,-0.4L25.55,-0.55Q25.55,-2.45 26.45,-6.15Q27.35,-9.9 27.35,-11.75L27.35,-12.3L24.9,-9.4L22.35,-6L21.45,-4.15L21.1,-4.1Q20.35,-4.1 20.35,-5.2L20.65,-7.35L21,-9.4L20.65,-10.25L20.35,-10.15Q18.65,-8.05 17.25,-3.15Q17.2,-2.25 16.55,-0.55L16.2,-0.15M34.45,-16.05Q37.1,-18.15 38.7,-18.15Q40.05,-18.15 40.05,-17Q40.05,-15.25 38.85,-13.75L37.45,-11.95L37.5,-11.75Q38.5,-11.5 39.05,-10.95Q39.55,-10.3 39.55,-9.25Q39.55,-6.05 36.5,-3Q33.55,0.1 30.4,0.1Q28.85,0.1 28.9,-0.85L31.55,-11.35L31.7,-12.4Q31.95,-14.05 34.45,-16.05M38.25,-15.55L38.1,-15.55Q37.05,-15.4 35.5,-14.6Q33.85,-13.75 33.5,-12.9L32.8,-10.8L32.85,-10.75L36,-12.8Q38.1,-14.45 38.4,-15.4L38.25,-15.55M36.05,-9L33.8,-8.45Q32.4,-7.85 31.9,-7.35L31.3,-5.3L30.9,-3.05L30.9,-2.7L31.85,-2.55Q33.5,-2.55 35.7,-4.4Q38,-6.35 38,-7.85Q38,-9 36.05,-9"}]},{name:"crossCircleNoteHead",bounds:{left:-1.25,right:16.25,top:-8.8,bottom:9.55},svgPaths:[{d:"M6.35,-6.3Q5.7,-6.3 5.35,-5.45Q5,-4.65 5,-3L5.45,0.45L3,2.1L1.3,3.4L0.95,3.8Q0.8,4.25 0.8,5.15Q0.8,6.5 1.7,6.5L4.1,5.05Q6.15,3.65 6.4,3.65L7.65,5.8Q8.6,7.35 9.25,7.45L9.75,7.3Q10.45,6.65 10.45,5.7Q10.45,5 9.75,3.9L8.6,2.2L11.2,0.3L11.9,-0.1L13.9,-1.5Q14.3,-1.75 14.6,-2.55Q15,-3.3 15,-3.8Q15,-4.8 14.2,-4.8Q13.85,-4.8 10.8,-2.95L7.2,-0.6Q6.8,-1.6 6.8,-4.9L6.8,-5.75Q6.8,-6.3 6.35,-6.3"},{fill:"none","stroke-width":"0.5","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"0",d:"M0,0"},{fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"20",d:"M15.2,-2.05Q14.85,1.25 13.2,3.75L12.75,4.4L12.15,5.15Q9.6,8.15 6.75,8.5Q3.9,8.85 1.55,7.05Q-0.8,5.25 -0.05,1.55Q0.7,-2.15 2.9,-4.65Q5.15,-7.15 8.2,-7.65Q11.2,-8.15 13.4,-6.75Q15.55,-5.35 15.2,-2.05"}]},{name:"buzz",bounds:{left:-6.55,right:6.4,top:-6.2,bottom:6.75},svgPaths:[{d:"M6.4,-4.05L-2.3,4.5L6.4,4.5L6.4,6.75L-6.55,6.75L-6.55,4.5L2,-3.95L-6.3,-3.95L-6.3,-6.2L6.4,-6.2L6.4,-4.05"}]},{name:"leftParenthesis",bounds:{left:0,right:6,top:-12.25,bottom:12.25},svgPaths:[{d:"M4.3,-11.2Q4.85,-12.25 5.5,-12.25L6,-12.1L5.85,-11.15Q3.6,-5.8 3,-3.8Q1.75,0.2 1.75,4.05L1.85,6.65L2,9.25Q2,11.1 1.55,12.05L1.2,12.25L0.65,11.8Q0,10.3 0,6.15Q0,-0.4 3.05,-8.15Q3.4,-9.25 4.3,-11.2"}]},{name:"rightParenthesis",bounds:{left:0,right:4.25,top:-12.9,bottom:12.05},svgPaths:[{d:"M4.25,-2.5Q4.25,1.1 3.6,4.55Q2.85,8.65 1.4,11.2L0.55,12.05Q0,12.05 0,11.45L0.35,10.1Q2.65,3.6 2.65,-1.55L2.3,-5.65L1.65,-8Q1.2,-9.4 1.2,-10.35Q1.2,-12.9 1.9,-12.9Q2.95,-12.9 3.7,-8.3Q4.25,-4.75 4.25,-2.5"}]},{name:"shortFlagDown",bounds:{left:0,right:10.9,top:0,bottom:21.35},svgPaths:[{d:"M9.05,7.45L9.75,5.3L10,3.35Q10.15,1.65 9.85,0.45L10.2,0Q10.85,1.45 10.9,3.6Q10.95,5.6 10.25,8.05Q9.5,10.5 7.8,12.7Q6,14.9 3.1,17.35Q1.85,18.6 1.5,19.75L1.05,21.35L0,21.35L0,14.2L1.05,14.2L1.05,15Q3.75,13.55 5.75,11.9Q7.75,10.3 9.05,7.45"}]},{name:"shortFlagUp",bounds:{left:0,right:10.9,top:0,bottom:21.75},svgPaths:[{d:"M1.05,0Q1.1,1.1 1.45,2.45Q1.85,3.8 3.1,5Q6.15,7.6 8.1,10Q10.75,13.15 10.9,17.2Q10.9,19.55 10.2,21.75L9.7,21.1L9.85,19.35L9.85,17.6Q9.55,14.55 7.35,12.15Q4.75,9.25 1.05,7.35L1.05,8.15L0,8.15L0,0L1.05,0"}]},{name:"measureRepeat",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0,10L17.14,-10L23.35,-10L6.2,10L0,10M3.67,-4.69Q3.67,-6.98 5.96,-6.98Q8.24,-6.98 8.24,-4.69Q8.24,-2.41 5.96,-2.41Q3.67,-2.41 3.67,-4.69M15.76,4.69Q15.76,2.41 18.04,2.41Q20.33,2.41 20.33,4.69Q20.33,6.98 18.04,6.98Q15.76,6.98 15.76,4.69"}]},{name:"scoop",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,5.0775169 C4.2906409,4.7110211 17.3553994,4.353799 22.1573103,-11.6257134 C22.5542237,-12.4078939 24.1830526,-11.0184729 23.907068,-10.0378357 C21.4339633,-1.1783444 12.7849596,8.0417555 1.2893075,9.0440547 C0.4365,9.1182441 0.1200821,8.3555768 0.0829874,7.7872858 C0.0202973,6.8217103 0.093003,6.1350872 0.3356024,5.5994395 C0.4850941,5.2696675 0.626425,5.1064507 0.8946198,5.0775169"}]},{name:"plop",bounds:{left:.055,right:23.95,top:-16.86,bottom:4.05},svgPaths:[{d:"M0.8946198,-5.0775169 C4.2906409,-4.7110211 17.3553994,-4.353799 22.1573103,11.6257134 C22.5542237,12.4078939 24.1830526,11.0184729 23.907068,10.0378357 C21.4339633,1.1783444 12.7849596,-8.0417555 1.2893075,-9.0440547 C0.4365,-9.1182441 0.1200821,-8.3555768 0.0829874,-7.7872858 C0.0202973,-6.8217103 0.093003,-6.1350872 0.3356024,-5.5994395 C0.4850941,-5.2696675 0.626425,-5.1064507 0.8946198,-5.0775169"}]},{name:"quickFall",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,-5.0775169 C4.2906409,-4.7110211 17.3553994,-4.353799 22.1573103,11.6257134 C22.5542237,12.4078939 24.1830526,11.0184729 23.907068,10.0378357 C21.4339633,1.1783444 12.7849596,-8.0417555 1.2893075,-9.0440547 C0.4365,-9.1182441 0.1200821,-8.3555768 0.0829874,-7.7872858 C0.0202973,-6.8217103 0.093003,-6.1350872 0.3356024,-5.5994395 C0.4850941,-5.2696675 0.626425,-5.1064507 0.8946198,-5.0775169"}]},{name:"doit",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,5.0775169 C4.2906409,4.7110211 17.3553994,4.353799 22.1573103,-11.6257134 C22.5542237,-12.4078939 24.1830526,-11.0184729 23.907068,-10.0378357 C21.4339633,-1.1783444 12.7849596,8.0417555 1.2893075,9.0440547 C0.4365,9.1182441 0.1200821,8.3555768 0.0829874,7.7872858 C0.0202973,6.8217103 0.093003,6.1350872 0.3356024,5.5994395 C0.4850941,5.2696675 0.626425,5.1064507 0.8946198,5.0775169"}]},{name:"fall1",bounds:{left:0,right:14.1,top:0,bottom:4.9},svgPaths:[{d:"M13.74.84a7.22,7.22,0,0,0-.73.85c-.43.54-1.07,1-1.7.48A22.09,22.09,0,0,0,8.94.46.88.88,0,0,0,8,.39a3.3,3.3,0,0,0-1.3,1.27l0,0c-.43.54-1.06,1-1.7.48A21.12,21.12,0,0,0,2.62.46.88.88,0,0,0,1.7.39,3.71,3.71,0,0,0,0,2.51c-.11.6.35.39.49.19C1,2,1.05,1.86,1.62,2.48s1.08,1.22,2,2.18C5,6.05,6,4.17,6.47,3.43c.1-.18.25-.5.43-.84.42-.61.5-.69,1-.11S9,3.7,10,4.66c1.37,1.39,2.38-.49,2.8-1.23A11.76,11.76,0,0,1,14,1.4C14.21,1.17,13.94.64,13.74.84Z"}]},{name:"rip1",bounds:{left:0,right:14.1,top:0,bottom:4.9},svgPaths:[{d:"M13.74.84a7.22,7.22,0,0,0-.73.85c-.43.54-1.07,1-1.7.48A22.09,22.09,0,0,0,8.94.46.88.88,0,0,0,8,.39a3.3,3.3,0,0,0-1.3,1.27l0,0c-.43.54-1.06,1-1.7.48A21.12,21.12,0,0,0,2.62.46.88.88,0,0,0,1.7.39,3.71,3.71,0,0,0,0,2.51c-.11.6.35.39.49.19C1,2,1.05,1.86,1.62,2.48s1.08,1.22,2,2.18C5,6.05,6,4.17,6.47,3.43c.1-.18.25-.5.43-.84.42-.61.5-.69,1-.11S9,3.7,10,4.66c1.37,1.39,2.38-.49,2.8-1.23A11.76,11.76,0,0,1,14,1.4C14.21,1.17,13.94.64,13.74.84Z"}]}]};r.registerClass(ro,"com.noteflight.notation.glyph.ash.AshJSGlyphFoundryFactory");var so=function(t){function e(){return y(this,e),l(this,h(e).call(this,e.FOUNDRY_DEFINITION))}return c(e,Qr),p(e,null,[{key:"FOUNDRY_DEFINITION",get:function(){return ao}}]),e}(),ao={descriptor:{clefs:[],accidentals:[],chordSymbols:[],noteheads:[{type:"normal",noteheads:[]},{type:"stemless",noteheads:[]},{type:"slash",noteheads:[]},{type:"hit",noteheads:[]},{type:"cross",noteheads:[]},{type:"square",noteheads:[]},{type:"diamond",noteheads:[]},{type:"triangle",noteheads:[]},{type:"harmonic",noteheads:[]},{type:"crossCircle",noteheads:[]}],articulations:[],ornaments:[],rests:[{type:"normal",rests:[]}],barlines:[{type:"pageBreak",glyph:{symbol:"pageBreak"}},{type:"systemBreak",glyph:{symbol:"systemBreak"}}],others:[{name:"annotationIconSymbol",glyph:{symbol:"annotationIcon"}},{name:"keepWithNext",glyph:{symbol:"keepWithNext"}}]},symbols:[{name:"pageBreak",bounds:{left:0,right:21.2,top:0,bottom:38.9},svgPaths:[{fill:"rgba(153,153,153,1)",d:"M3.85,13.9L17.3,13.9L17.3,14.85L3.85,14.85L3.85,13.9M3.85,17.65L17.3,17.65L17.3,18.6L3.85,18.6L3.85,17.65M3.85,21.55L17.3,21.55L17.3,22.5L3.85,22.5L3.85,21.55M17.3,30.15L3.85,30.15L3.85,29.2L17.3,29.2L17.3,30.15M17.3,26.4L3.85,26.4L3.85,25.45L17.3,25.45L17.3,26.4M17.3,34.05L3.85,34.05L3.85,33.1L17.3,33.1L17.3,34.05M21.2,38.9L0,38.9L0,10L21.2,10L21.2,38.9M0.95,10.95L0.95,37.95L20.25,37.95L20.25,10.95L0.95,10.95"}]},{name:"systemBreak",bounds:{left:0,right:20.9,top:0,bottom:23.35},svgPaths:[{fill:"rgba(153,153,153,1)",d:"M20.9,10L20.9,12.8Q20.9,15.6 20.5,16.9Q20.05,18.2 18.8,19.15Q17.15,20.45 13.15,20.45L5.75,20.45L5.75,23.35L0,17.65L5.75,11.95L5.75,14.85L14.85,14.85Q17.9,14.85 19.05,13.9Q20.25,12.9 20.25,10.4L20.25,10L20.9,10"}]},{name:"annotationIcon",bounds:{left:0,right:17.5,top:0,bottom:21},svgPaths:[{fill:"rgba(255,255,255,1)","stroke-width":"1","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":"38.4",d:"M16.9,0.5L16.9,11.75L9.95,11.75L9.95,20.4L0.5,20.4L0.5,0.5L16.9,0.5"},{fill:"none","stroke-width":"0.5","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"0",d:"M0,0"},{fill:"none","stroke-width":"1","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":"38.4",d:"M17,11.95L9.95,20.5"}]},{name:"keepWithNext",bounds:{left:-8.5,right:7.5,top:20,bottom:36},svgPaths:[{fill:"rgba(153,153,153,1)",d:"M-8.5,36Q-8.5,28 -0.5,28Q7.5,28 7.5,36L5.5,36Q5.5,30 -0.5,30Q-6.5,30 -6.5,36L-8.5,36"}]}]};r.registerClass(so,"com.noteflight.notation.glyph.common.CommonJSGlyphFoundryFactory");var lo=function(){function t(){y(this,t),this.sign=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.sign&&(t.sign=this.sign),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.sign&&(i.sign=A.unknownToString(e.sign)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.sign=yo.parseString(e,"sign"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(lo,"com.noteflight.notation.glyph.foundrydescriptor.AccidentalDescriptor");var uo=function(){function t(){y(this,t),this.type=null,this.position=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.type&&(t.type=this.type),this.position&&(t.position=this.position),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.type&&(i.type=A.unknownToString(e.type)),e.position&&(i.position=A.unknownToString(e.position)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.type=yo.parseString(e,"type"),i.position=yo.parseString(e,"position"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(uo,"com.noteflight.notation.glyph.foundrydescriptor.ArticulationDescriptor");var ho=function(){function t(){y(this,t),this.type=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.type&&(t.type=this.type),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.type&&(i.type=A.unknownToString(e.type)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.type=yo.parseString(e,"type"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(ho,"com.noteflight.notation.glyph.foundrydescriptor.BarlineDescriptor");var co=function(){function t(){y(this,t),this.char=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.char&&(t.char=this.char),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.char&&(i.char=A.unknownToString(e.char)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.char=yo.parseString(e,"char"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(co,"com.noteflight.notation.glyph.foundrydescriptor.ChordSymbolDescriptor");var fo=function(){function t(){y(this,t),this.sign=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.sign&&(t.sign=this.sign),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.sign&&(i.sign=A.unknownToString(e.sign)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.sign=yo.parseString(e,"sign"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(fo,"com.noteflight.notation.glyph.foundrydescriptor.ClefDescriptor");var yo=function(){function t(){y(this,t),this.clefs=[],this.accidentals=[],this.chordSymbols=[],this.noteheads=[],this.articulations=[],this.ornaments=[],this.rests=[],this.barlines=[],this.others=[]}return p(t,[{key:"toJSON",value:function(){var t={},e=[];t.clefs=e;var i=!0,n=!1,r=void 0;try{for(var o,s=this.clefs[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.push(a.toJSON())}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var l=[];t.accidentals=l;var u=!0,h=!1,c=void 0;try{for(var d,f=this.accidentals[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;l.push(y.toJSON())}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}var g=[];t.chordSymbols=g;var p=!0,m=!1,v=void 0;try{for(var _,S=this.chordSymbols[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value;g.push(L.toJSON())}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}var k=[];t.noteheads=k;var T=!0,E=!1,M=void 0;try{for(var b,w=this.noteheads[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){var x=b.value;k.push(x.toJSON())}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}var C=[];t.articulations=C;var N=!0,A=!1,I=void 0;try{for(var P,O=this.articulations[Symbol.iterator]();!(N=(P=O.next()).done);N=!0){var Q=P.value;C.push(Q.toJSON())}}catch(t){A=!0,I=t}finally{try{N||null==O.return||O.return()}finally{if(A)throw I}}var R=[];t.ornaments=R;var D=!0,F=!1,U=void 0;try{for(var V,B=this.ornaments[Symbol.iterator]();!(D=(V=B.next()).done);D=!0){var H=V.value;R.push(H.toJSON())}}catch(t){F=!0,U=t}finally{try{D||null==B.return||B.return()}finally{if(F)throw U}}var $=[];t.rests=$;var G=!0,Y=!1,z=void 0;try{for(var W,X=this.rests[Symbol.iterator]();!(G=(W=X.next()).done);G=!0){var K=W.value;$.push(K.toJSON())}}catch(t){Y=!0,z=t}finally{try{G||null==X.return||X.return()}finally{if(Y)throw z}}var j=[];t.barlines=j;var q=!0,J=!1,Z=void 0;try{for(var tt,et=this.barlines[Symbol.iterator]();!(q=(tt=et.next()).done);q=!0){var it=tt.value;j.push(it.toJSON())}}catch(t){J=!0,Z=t}finally{try{q||null==et.return||et.return()}finally{if(J)throw Z}}var nt=[];t.others=nt;var rt=!0,ot=!1,st=void 0;try{for(var at,lt=this.others[Symbol.iterator]();!(rt=(at=lt.next()).done);rt=!0){var ut=at.value;nt.push(ut.toJSON())}}catch(t){ot=!0,st=t}finally{try{rt||null==lt.return||lt.return()}finally{if(ot)throw st}}return t}}],[{key:"fromJSON",value:function(e){var i=new t;if(e.clefs){var n=!0,r=!1,o=void 0;try{for(var s,a=xt.unknownForOfSource(e.clefs)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.clefs.push(fo.fromJSON(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}if(e.accidentals){var u=!0,h=!1,c=void 0;try{for(var d,f=xt.unknownForOfSource(e.accidentals)[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;i.accidentals.push(lo.fromJSON(y))}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}if(e.chordSymbols){var g=!0,p=!1,m=void 0;try{for(var v,_=xt.unknownForOfSource(e.chordSymbols)[Symbol.iterator]();!(g=(v=_.next()).done);g=!0){var S=v.value;i.chordSymbols.push(co.fromJSON(S))}}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}}if(e.noteheads){var L=!0,k=!1,T=void 0;try{for(var E,M=xt.unknownForOfSource(e.noteheads)[Symbol.iterator]();!(L=(E=M.next()).done);L=!0){var b=E.value;i.noteheads.push(vo.fromJSON(b))}}catch(t){k=!0,T=t}finally{try{L||null==M.return||M.return()}finally{if(k)throw T}}}if(e.articulations){var w=!0,x=!1,C=void 0;try{for(var N,A=xt.unknownForOfSource(e.articulations)[Symbol.iterator]();!(w=(N=A.next()).done);w=!0){var I=N.value;i.articulations.push(uo.fromJSON(I))}}catch(t){x=!0,C=t}finally{try{w||null==A.return||A.return()}finally{if(x)throw C}}}if(e.ornaments){var P=!0,O=!1,Q=void 0;try{for(var R,D=xt.unknownForOfSource(e.ornaments)[Symbol.iterator]();!(P=(R=D.next()).done);P=!0){var F=R.value;i.ornaments.push(_o.fromJSON(F))}}catch(t){O=!0,Q=t}finally{try{P||null==D.return||D.return()}finally{if(O)throw Q}}}if(e.rests){var U=!0,V=!1,B=void 0;try{for(var H,$=xt.unknownForOfSource(e.rests)[Symbol.iterator]();!(U=(H=$.next()).done);U=!0){var G=H.value;i.rests.push(ko.fromJSON(G))}}catch(t){V=!0,B=t}finally{try{U||null==$.return||$.return()}finally{if(V)throw B}}}if(e.barlines){var Y=!0,z=!1,W=void 0;try{for(var X,K=xt.unknownForOfSource(e.barlines)[Symbol.iterator]();!(Y=(X=K.next()).done);Y=!0){var j=X.value;i.barlines.push(ho.fromJSON(j))}}catch(t){z=!0,W=t}finally{try{Y||null==K.return||K.return()}finally{if(z)throw W}}}if(e.others){var q=!0,J=!1,Z=void 0;try{for(var tt,et=xt.unknownForOfSource(e.others)[Symbol.iterator]();!(q=(tt=et.next()).done);q=!0){var it=tt.value;i.others.push(So.fromJSON(it))}}catch(t){J=!0,Z=t}finally{try{q||null==et.return||et.return()}finally{if(J)throw Z}}}return i}},{key:"fromXML",value:function(e){var i,n=new t,r=!0,o=!1,s=void 0;try{for(var a,l=e.child("clefs").child("clef").list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0)i=a.value,n.clefs.push(fo.fromXML(i))}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}var u=!0,h=!1,c=void 0;try{for(var d,f=e.child("accidentals").child("accidental").list[Symbol.iterator]();!(u=(d=f.next()).done);u=!0)i=d.value,n.accidentals.push(lo.fromXML(i))}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}var y=!0,g=!1,p=void 0;try{for(var m,v=e.child("chordSymbols").child("chordSymbol").list[Symbol.iterator]();!(y=(m=v.next()).done);y=!0)i=m.value,n.chordSymbols.push(co.fromXML(i))}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}var _=!0,S=!1,L=void 0;try{for(var k,T=e.child("noteheads").list[Symbol.iterator]();!(_=(k=T.next()).done);_=!0)i=k.value,n.noteheads.push(vo.fromXML(i))}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}var E=!0,M=!1,b=void 0;try{for(var w,x=e.child("articulations").child("articulation").list[Symbol.iterator]();!(E=(w=x.next()).done);E=!0)i=w.value,n.articulations.push(uo.fromXML(i))}catch(t){M=!0,b=t}finally{try{E||null==x.return||x.return()}finally{if(M)throw b}}var C=!0,N=!1,A=void 0;try{for(var I,P=e.child("ornaments").child("ornament").list[Symbol.iterator]();!(C=(I=P.next()).done);C=!0)i=I.value,n.ornaments.push(_o.fromXML(i))}catch(t){N=!0,A=t}finally{try{C||null==P.return||P.return()}finally{if(N)throw A}}var O=!0,Q=!1,R=void 0;try{for(var D,F=e.child("rests").list[Symbol.iterator]();!(O=(D=F.next()).done);O=!0)i=D.value,n.rests.push(ko.fromXML(i))}catch(t){Q=!0,R=t}finally{try{O||null==F.return||F.return()}finally{if(Q)throw R}}var U=!0,V=!1,B=void 0;try{for(var H,$=e.child("barlines").child("barline").list[Symbol.iterator]();!(U=(H=$.next()).done);U=!0)i=H.value,n.barlines.push(ho.fromXML(i))}catch(t){V=!0,B=t}finally{try{U||null==$.return||$.return()}finally{if(V)throw B}}var G=!0,Y=!1,z=void 0;try{for(var W,X=e.child("others").child("other").list[Symbol.iterator]();!(G=(W=X.next()).done);G=!0)i=W.value,n.others.push(So.fromXML(i))}catch(t){Y=!0,z=t}finally{try{G||null==X.return||X.return()}finally{if(Y)throw z}}return n}},{key:"parseString",value:function(t,e){if(!t)return null;var i=t.attribute(e);return i.length()>0?i.toString():null}},{key:"parseNumber",value:function(e,i){var n=t.parseString(e,i);return n?X.parseFloat(n):NaN}},{key:"parseInteger",value:function(e,i){var n=t.parseString(e,i);return n?X.parseInt(n):0}},{key:"parseBoolean",value:function(e,i){return"true"==t.parseString(e,i)}}]),t}();r.registerClass(yo,"com.noteflight.notation.glyph.foundrydescriptor.FoundryDescriptor");var go=function(){function t(){y(this,t),this.symbol=null,this.x=NaN,this.y=NaN,this.scale=NaN,this.width=NaN,this.height=NaN,this.spacingX=NaN}return p(t,[{key:"toJSON",value:function(){var t={};return this.symbol&&(t.symbol=this.symbol),this.x&&(t.x=this.x),this.y&&(t.y=this.y),this.scale&&(t.scale=this.scale),this.width&&(t.width=this.width),this.height&&(t.height=this.height),this.spacingX&&(t.spacingX=this.spacingX),t}}],[{key:"fromJSON",value:function(e){var i=new t;return null!=e.symbol&&(i.symbol=A.unknownToString(e.symbol)),null!=e.x&&(i.x=A.unknownToNumber(e.x)),null!=e.y&&(i.y=A.unknownToNumber(e.y)),null!=e.scale&&(i.scale=A.unknownToNumber(e.scale)),null!=e.width&&(i.width=A.unknownToNumber(e.width)),null!=e.height&&(i.height=A.unknownToNumber(e.height)),null!=e.spacingX&&(i.spacingX=A.unknownToNumber(e.spacingX)),i}},{key:"fromXML",value:function(e){var i=new t;return i.symbol=yo.parseString(e,"symbol"),i.x=yo.parseNumber(e,"x"),i.y=yo.parseNumber(e,"y"),i.scale=yo.parseNumber(e,"scale"),i.width=yo.parseNumber(e,"width"),i.height=yo.parseNumber(e,"height"),i.spacingX=yo.parseNumber(e,"spacingX"),i}}]),t}();r.registerClass(go,"com.noteflight.notation.glyph.foundrydescriptor.GlyphDescriptor");var po=function(){function t(){y(this,t),this.stem=!1,this.downX=NaN,this.downY=NaN,this.upX=NaN,this.upY=NaN}return p(t,[{key:"toJSON",value:function(){var t={};return this.stem&&(t.stem=this.stem),this.downX&&(t.downX=this.downX),this.downY&&(t.downY=this.downY),this.upX&&(t.upX=this.upX),this.upY&&(t.upY=this.upY),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.stem&&(i.stem=A.unknownToBoolean(e.stem)),e.downX&&(i.downX=A.unknownToNumber(e.downX)),e.downY&&(i.downY=A.unknownToNumber(e.downY)),e.upX&&(i.upX=A.unknownToNumber(e.upX)),e.upY&&(i.upY=A.unknownToNumber(e.upY)),i}},{key:"fromXML",value:function(e){var i=new t;return i.stem=yo.parseBoolean(e,"stem"),i.downX=yo.parseNumber(e,"downX"),i.downY=yo.parseNumber(e,"downY"),i.upX=yo.parseNumber(e,"upX"),i.upY=yo.parseNumber(e,"upY"),i}}]),t}();r.registerClass(po,"com.noteflight.notation.glyph.foundrydescriptor.MetricsDescriptor");var mo=function(){function t(){y(this,t),this.value=0,this.glyph=null,this.metrics=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.value&&(t.value=this.value),this.glyph&&(t.glyph=this.glyph.toJSON()),this.metrics&&(t.metrics=this.metrics.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.value&&(i.value=A.unknownToInt(e.value)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),e.metrics&&(i.metrics=po.fromJSON(e.metrics)),i}},{key:"fromXML",value:function(e){var i=new t;return i.value=A.numberToInt(yo.parseInteger(e,"value")),i.glyph=go.fromXML(e.child("glyph").get(0)),i.metrics=po.fromXML(e.child("metrics").get(0)),i}}]),t}();r.registerClass(mo,"com.noteflight.notation.glyph.foundrydescriptor.NoteheadDescriptor");var vo=function(){function t(){y(this,t),this.type=null,this.noteheads=[]}return p(t,[{key:"toJSON",value:function(){var t={};this.type&&(t.type=this.type);var e=[];t.noteheads=e;var i=!0,n=!1,r=void 0;try{for(var o,s=this.noteheads[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.push(a.toJSON())}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}}],[{key:"fromJSON",value:function(e){var i=new t;if(e.type&&(i.type=A.unknownToString(e.type)),e.noteheads){var n=!0,r=!1,o=void 0;try{for(var s,a=xt.unknownForOfSource(e.noteheads)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.noteheads.push(mo.fromJSON(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}return i}},{key:"fromXML",value:function(e){var i=new t;i.type=yo.parseString(e,"type");var n=!0,r=!1,o=void 0;try{for(var s,a=e.child("notehead").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.noteheads.push(mo.fromXML(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}}]),t}();r.registerClass(vo,"com.noteflight.notation.glyph.foundrydescriptor.NoteheadsDescriptor");var _o=function(){function t(){y(this,t),this.type=null,this.value=0,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.type&&(t.type=this.type),this.value&&(t.value=this.value),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.type&&(i.type=A.unknownToString(e.type)),e.value&&(i.value=A.unknownToInt(e.value)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.type=yo.parseString(e,"type"),i.value=A.numberToInt(yo.parseInteger(e,"value")),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(_o,"com.noteflight.notation.glyph.foundrydescriptor.OrnamentDescriptor");var So=function(){function t(){y(this,t),this.name=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.name&&(t.name=this.name),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.name&&(i.name=A.unknownToString(e.name)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.name=yo.parseString(e,"name"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(So,"com.noteflight.notation.glyph.foundrydescriptor.OtherDescriptor");var Lo=function(){function t(){y(this,t),this.value=0,this.type=null,this.glyph=null}return p(t,[{key:"toJSON",value:function(){var t={};return this.value&&(t.value=this.value),this.type&&(t.type=this.type),this.glyph&&(t.glyph=this.glyph.toJSON()),t}}],[{key:"fromJSON",value:function(e){var i=new t;return e.value&&(i.value=A.unknownToInt(e.value)),e.type&&(i.type=A.unknownToString(e.type)),e.glyph&&(i.glyph=go.fromJSON(e.glyph)),i}},{key:"fromXML",value:function(e){var i=new t;return i.value=A.numberToInt(yo.parseInteger(e,"value")),i.type=yo.parseString(e,"type"),i.glyph=go.fromXML(e.child("glyph").get(0)),i}}]),t}();r.registerClass(Lo,"com.noteflight.notation.glyph.foundrydescriptor.RestDescriptor");var ko=function(){function t(){y(this,t),this.type=null,this.rests=[]}return p(t,[{key:"toJSON",value:function(){var t={};this.type&&(t.type=this.type);var e=[];t.rests=e;var i=!0,n=!1,r=void 0;try{for(var o,s=this.rests[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.push(a.toJSON())}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}}],[{key:"fromJSON",value:function(e){var i=new t;if(e.type&&(i.type=A.unknownToString(e.type)),e.rests){var n=!0,r=!1,o=void 0;try{for(var s,a=xt.unknownForOfSource(e.rests)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.rests.push(Lo.fromJSON(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}return i}},{key:"fromXML",value:function(e){var i=new t;i.type=yo.parseString(e,"type");var n=!0,r=!1,o=void 0;try{for(var s,a=e.child("rest").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.rests.push(Lo.fromXML(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}}]),t}();r.registerClass(ko,"com.noteflight.notation.glyph.foundrydescriptor.RestsDescriptor");var To=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return y(this,e),l(this,h(e).call(this,e.FOUNDRY_DEFINITION,t))}return c(e,Qr),p(e,null,[{key:"FOUNDRY_DEFINITION",get:function(){return Eo}}]),e}(),Eo={descriptor:{clefs:[{sign:"G",glyph:{symbol:"gClef"}},{sign:"C",glyph:{symbol:"cClef"}},{sign:"F",glyph:{symbol:"fClef"}},{sign:"F8below",glyph:{symbol:"f8Clef"}},{sign:"tenorVoice",glyph:{symbol:"tenorVoiceClef"}},{sign:"percussion",glyph:{symbol:"percussionClef"}},{sign:"percussion2",glyph:{symbol:"percussion2Clef"}},{sign:"tab",glyph:{symbol:"tabClef"}}],accidentals:[{sign:"doubleFlat",glyph:{symbol:"doubleFlat"}},{sign:"flat",glyph:{symbol:"flat"}},{sign:"natural",glyph:{symbol:"natural"}},{sign:"sharp",glyph:{symbol:"sharp"}},{sign:"doubleSharp",glyph:{symbol:"doubleSharp"}}],chordSymbols:[{char:"@",glyph:{symbol:"flat",x:.25,y:.375,scale:.75,width:.85}},{char:"#",glyph:{symbol:"sharp",x:.25,y:.75,scale:.75,width:.925}},{char:"$",glyph:{symbol:"natural",x:.25,y:.75,scale:.75,width:.775}},{char:"*",glyph:{symbol:"doubleSharp",x:.25,y:.75,scale:.75,width:1}},{char:"%",glyph:{symbol:"doubleFlat",x:.25,y:.375,scale:.75,width:1.25}},{char:"[",glyph:{symbol:"repeatEndingBracket",width:0}}],noteheads:[{type:"normal",noteheads:[{value:6,glyph:{symbol:"solidNoteHead"},metrics:{stem:!0,downY:.2,upX:1.295,upY:-.2}},{value:7,glyph:{symbol:"halfNoteHead"},metrics:{stem:!0,downY:.2,upX:1.295,upY:-.2}},{value:8,glyph:{symbol:"wholeNoteHead"},metrics:{stem:!1}}]},{type:"stemless",noteheads:[{value:6,glyph:{symbol:"solidNoteHead"},metrics:{stem:!1,downY:.2,upX:1.295,upY:-.2}},{value:7,glyph:{symbol:"halfNoteHead"},metrics:{stem:!1,downY:.2,upX:1.295,upY:-.2}},{value:8,glyph:{symbol:"wholeNoteHead"},metrics:{stem:!1}}]},{type:"slash",noteheads:[{value:6,glyph:{symbol:"slashNoteHead"},metrics:{stem:!0,downY:1,upX:2,upY:-1}},{value:7,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!0,downY:0,upX:2.6,upY:0}},{value:8,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!1}}]},{type:"hit",noteheads:[{value:6,glyph:{symbol:"slashNoteHead"},metrics:{stem:!0,downY:1,upX:2,upY:-1}},{value:7,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!0,downY:0,upX:2.6,upY:0}},{value:8,glyph:{symbol:"hollowSlashNoteHead"},metrics:{stem:!1}}]},{type:"cross",noteheads:[{value:6,glyph:{symbol:"crossNoteHead"},metrics:{stem:!0,downY:.5,upX:1.17,upY:-.5}},{value:7,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!1}}]},{type:"square",noteheads:[{value:6,glyph:{symbol:"squareNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowSquareNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowSquareNoteHead"},metrics:{stem:!1}}]},{type:"diamond",noteheads:[{value:6,glyph:{symbol:"diamondNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowDiamondNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowDiamondNoteHead"},metrics:{stem:!1}}]},{type:"triangle",noteheads:[{value:6,glyph:{symbol:"triangleNoteHead"},metrics:{stem:!0,downX:.5,downY:.5,upX:.67,upY:-.5}},{value:7,glyph:{symbol:"hollowTriangleNoteHead"},metrics:{stem:!0,downX:.5,downY:.5,upX:.67,upY:-.5}},{value:8,glyph:{symbol:"hollowTriangleNoteHead"},metrics:{stem:!1}}]},{type:"harmonic",noteheads:[{value:6,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"hollowMiscNoteHead"},metrics:{stem:!1}}]},{type:"crossCircle",noteheads:[{value:6,glyph:{symbol:"crossNoteHead"},metrics:{stem:!0}},{value:7,glyph:{symbol:"crossCircleNoteHead"},metrics:{stem:!0}},{value:8,glyph:{symbol:"crossCircleNoteHead"},metrics:{stem:!1}}]}],articulations:[{type:"marcato",position:"both",glyph:{symbol:"marcato"}},{type:"closed",position:"both",glyph:{symbol:"closed"}},{type:"open",position:"both",glyph:{symbol:"open"}},{type:"staccato",position:"both",glyph:{symbol:"staccato"}},{type:"tenuto",position:"both",glyph:{symbol:"tenuto"}},{type:"upBow",position:"both",glyph:{symbol:"upBow"}},{type:"downBow",position:"both",glyph:{symbol:"downBow"}},{type:"fermata",position:"above",glyph:{symbol:"fermataAbove"}},{type:"fermata",position:"below",glyph:{symbol:"fermataBelow"}},{type:"martellato",position:"above",glyph:{symbol:"martellatoAbove"}},{type:"martellato",position:"below",glyph:{symbol:"martellatoBelow"}},{type:"martellatoStaccato",position:"above",glyph:{symbol:"martellatoStaccatoAbove"}},{type:"martellatoStaccato",position:"below",glyph:{symbol:"martellatoStaccatoBelow"}},{type:"staccatissimo",position:"above",glyph:{symbol:"staccatissimoAbove"}},{type:"staccatissimo",position:"below",glyph:{symbol:"staccatissimoBelow"}},{type:"tap",position:"both",glyph:{symbol:"tap"}},{type:"caesura",position:"both",glyph:{symbol:"caesura"}},{type:"breath",position:"both",glyph:{symbol:"breath"}},{type:"mordent",position:"both",glyph:{symbol:"mordent"}},{type:"invertedMordent",position:"both",glyph:{symbol:"invertedMordent"}},{type:"turn",position:"both",glyph:{symbol:"turn"}},{type:"delayedTurn",position:"both",glyph:{symbol:"turn"}},{type:"invertedTurn",position:"both",glyph:{symbol:"invertedTurn"}},{type:"delayedInvertedTurn",position:"both",glyph:{symbol:"invertedTurn"}},{type:"hammerOn",position:"both",glyph:{symbol:"hammerOn"}},{type:"pullOff",position:"both",glyph:{symbol:"pullOff"}},{type:"bendJazz",position:"both",glyph:{symbol:"bendJazz",scale:.6}}],ornaments:[{type:"tremolo",value:1,glyph:{symbol:"tremolo1"}},{type:"tremolo",value:2,glyph:{symbol:"tremolo2"}},{type:"tremolo",value:3,glyph:{symbol:"tremolo3"}},{type:"buzz",glyph:{symbol:"buzz"}}],rests:[{type:"normal",rests:[{value:0,glyph:{symbol:"twoHundredFiftySixthRest"}},{value:1,glyph:{symbol:"oneHundredTwentyEighthRest"}},{value:2,glyph:{symbol:"sixtyFourthRest"}},{value:3,glyph:{symbol:"thirtySecondRest"}},{value:4,glyph:{symbol:"sixteenthRest"}},{value:5,glyph:{symbol:"eighthRest"}},{value:6,glyph:{symbol:"quarterRest"}},{value:7,glyph:{symbol:"halfRest"}},{value:7,type:"line",glyph:{symbol:"halfRestWithLine"}},{value:8,glyph:{symbol:"wholeRest"}},{value:8,type:"line",glyph:{symbol:"wholeRestWithLine"}}]}],barlines:[{type:"single",glyph:{symbol:"normalBarline"}},{type:"final",glyph:{symbol:"finalBarline"}},{type:"double",glyph:{symbol:"doubleBarline"}},{type:"initial",glyph:{symbol:"initialBarline"}},{type:"dashed",glyph:{symbol:"dashedBarline"}},{type:"repeat",glyph:{symbol:"repeatBarline"}},{type:"invisible",glyph:{symbol:"invisibleBarline"}},{type:"startRepeat",glyph:{symbol:"endRepeat",x:.5}},{type:"endRepeat",glyph:{symbol:"endRepeat",width:1}},{type:"grandStaff",glyph:{symbol:"grandStaff"}},{type:"topInitialWing",glyph:{symbol:"topStartWing",y:-.8}},{type:"bottomInitialWing",glyph:{symbol:"bottomStartWing",y:.8}},{type:"topStartWing",glyph:{symbol:"topStartWing",x:.42,y:-.8}},{type:"bottomStartWing",glyph:{symbol:"bottomStartWing",x:.42,y:.8}},{type:"topEndWing",glyph:{symbol:"topEndWing",x:.42,y:-.8}},{type:"bottomEndWing",glyph:{symbol:"bottomEndWing",x:.42,y:.8}},{type:"braceBody",glyph:{symbol:"braceBody"}}],others:[{name:"rhythmDot",glyph:{symbol:"rhythmDot"}},{name:"grandStaff",glyph:{symbol:"grandStaff"}},{name:"pppDynamics",glyph:{symbol:"pppDynamics"}},{name:"ppDynamics",glyph:{symbol:"ppDynamics"}},{name:"pDynamics",glyph:{symbol:"pDynamics"}},{name:"mpDynamics",glyph:{symbol:"mpDynamics"}},{name:"mfDynamics",glyph:{symbol:"mfDynamics"}},{name:"fDynamics",glyph:{symbol:"fDynamics"}},{name:"ffDynamics",glyph:{symbol:"ffDynamics"}},{name:"fffDynamics",glyph:{symbol:"fffDynamics"}},{name:"sfDynamics",glyph:{symbol:"sfDynamics"}},{name:"fzDynamics",glyph:{symbol:"fzDynamics"}},{name:"sfzDynamics",glyph:{symbol:"sfzDynamics"}},{name:"rfzDynamics",glyph:{symbol:"rfzDynamics"}},{name:"fpDynamics",glyph:{symbol:"fpDynamics"}},{name:"sfpDynamics",glyph:{symbol:"sfpDynamics"}},{name:"tempo2",glyph:{symbol:"sixtyFourthTempo",scale:1.25}},{name:"tempo2dot",glyph:{symbol:"sixtyFourthDotTempo",scale:1.25}},{name:"tempo3",glyph:{symbol:"thirtySecondTempo",scale:1.25}},{name:"tempo3dot",glyph:{symbol:"thirtySecondDotTempo",scale:1.25}},{name:"tempo4",glyph:{symbol:"sixteenthTempo",scale:1.25}},{name:"tempo4dot",glyph:{symbol:"sixteenthDotTempo",scale:1.25}},{name:"tempo5",glyph:{symbol:"eighthTempo",scale:1.25}},{name:"tempo5dot",glyph:{symbol:"eighthDotTempo",scale:1.25}},{name:"tempo6",glyph:{symbol:"quarterTempo",scale:1.25}},{name:"tempo6dot",glyph:{symbol:"quarterDotTempo",scale:1.25}},{name:"tempo7",glyph:{symbol:"halfTempo",scale:1.25}},{name:"tempo7dot",glyph:{symbol:"halfDotTempo",scale:1.25}},{name:"tempo8",glyph:{symbol:"wholeTempo",scale:1.25}},{name:"tempo8dot",glyph:{symbol:"wholeDotTempo",scale:1.25}},{name:"tempoEquals",glyph:{symbol:"tempoEquals",scale:1.25}},{name:"flagDown0",glyph:{symbol:"twoHundredFiftySixthFlagDown"}},{name:"flagDown1",glyph:{symbol:"oneHundredTwentyEighthFlagDown"}},{name:"flagDown2",glyph:{symbol:"sixtyFourthFlagDown"}},{name:"flagDown3",glyph:{symbol:"thirtySecondFlagDown"}},{name:"flagDown4",glyph:{symbol:"sixteenthFlagDown"}},{name:"flagDown5",glyph:{symbol:"eighthFlagDown"}},{name:"flagUp0",glyph:{symbol:"twoHundredFiftySixthFlagUp"}},{name:"flagUp1",glyph:{symbol:"oneHundredTwentyEighthFlagUp"}},{name:"flagUp2",glyph:{symbol:"sixtyFourthFlagUp"}},{name:"flagUp3",glyph:{symbol:"thirtySecondFlagUp"}},{name:"flagUp4",glyph:{symbol:"sixteenthFlagUp"}},{name:"flagUp5",glyph:{symbol:"eighthFlagUp"}},{name:"timeSignature0",glyph:{symbol:"timeSignature0"}},{name:"timeSignature1",glyph:{symbol:"timeSignature1"}},{name:"timeSignature2",glyph:{symbol:"timeSignature2"}},{name:"timeSignature3",glyph:{symbol:"timeSignature3"}},{name:"timeSignature4",glyph:{symbol:"timeSignature4"}},{name:"timeSignature5",glyph:{symbol:"timeSignature5"}},{name:"timeSignature6",glyph:{symbol:"timeSignature6"}},{name:"timeSignature7",glyph:{symbol:"timeSignature7"}},{name:"timeSignature8",glyph:{symbol:"timeSignature8"}},{name:"timeSignature9",glyph:{symbol:"timeSignature9"}},{name:"tuplet0",glyph:{symbol:"tuplet0"}},{name:"tuplet1",glyph:{symbol:"tuplet1"}},{name:"tuplet2",glyph:{symbol:"tuplet2"}},{name:"tuplet3",glyph:{symbol:"tuplet3"}},{name:"tuplet4",glyph:{symbol:"tuplet4"}},{name:"tuplet5",glyph:{symbol:"tuplet5"}},{name:"tuplet6",glyph:{symbol:"tuplet6"}},{name:"tuplet7",glyph:{symbol:"tuplet7"}},{name:"tuplet8",glyph:{symbol:"tuplet8"}},{name:"tuplet9",glyph:{symbol:"tuplet9"}},{name:"tab0",glyph:{symbol:"tab0"}},{name:"tab1",glyph:{symbol:"tab1"}},{name:"tab2",glyph:{symbol:"tab2"}},{name:"tab3",glyph:{symbol:"tab3"}},{name:"tab4",glyph:{symbol:"tab4"}},{name:"tab5",glyph:{symbol:"tab5"}},{name:"tab6",glyph:{symbol:"tab6"}},{name:"tab7",glyph:{symbol:"tab7"}},{name:"tab8",glyph:{symbol:"tab8"}},{name:"tab9",glyph:{symbol:"tab9"}},{name:"quarterBendAlteration",glyph:{symbol:"quarterBendAlteration"}},{name:"halfBendAlteration",glyph:{symbol:"halfBendAlteration"}},{name:"fullBendAlteration",glyph:{symbol:"fullBendAlteration"}},{name:"pedalLineNotationStart",glyph:{symbol:"pedalDown"}},{name:"octaveUpLineNotationStart",glyph:{symbol:"octaveUp"}},{name:"octaveDownLineNotationStart",glyph:{symbol:"octaveDown"}},{name:"twoOctavesUpLineNotationStart",glyph:{symbol:"twoOctavesUp"}},{name:"trillLineNotationStart",glyph:{symbol:"trill"}},{name:"wavyLineNotationSegment",glyph:{symbol:"shake",spacingX:-.58}},{name:"pedalLineNotationEnd",glyph:{symbol:"pedalUp"}},{name:"segnoSymbol",glyph:{symbol:"segno"}},{name:"codaSymbol",glyph:{symbol:"coda"}},{name:"cutTime",glyph:{symbol:"cutTime"}},{name:"commonTime",glyph:{symbol:"commonTime"}},{name:"arpeggioSymbol",glyph:{symbol:"arpeggio"}},{name:"arpeggioUpSymbol",glyph:{symbol:"arpeggioUp"}},{name:"arpeggioDownSymbol",glyph:{symbol:"arpeggioDown"}},{name:"leftParenthesisSymbol",glyph:{symbol:"leftParenthesis"}},{name:"rightParenthesisSymbol",glyph:{symbol:"rightParenthesis"}},{name:"measureRepeatSymbol",glyph:{symbol:"measureRepeat"}},{name:"scoopSymbol",glyph:{symbol:"scoop",scale:.7}},{name:"plopSymbol",glyph:{symbol:"plop",scale:.7}},{name:"quickFallSymbol",glyph:{symbol:"quickFall",scale:.7}},{name:"doitSymbol",glyph:{symbol:"doit",scale:.7}},{name:"fall1LineNotationSegment",glyph:{symbol:"fall1",spacingX:-.9,scale:.7}},{name:"rip1LineNotationSegment",glyph:{symbol:"rip1",spacingX:-.9,scale:.7}}]},symbols:[{name:"doubleBarline",bounds:{left:0,right:4.9,top:-40.6,bottom:0},svgPaths:[{d:"M1.75,-40.6L1.75,0L0,0L0,-40.6L1.75,-40.6M4.9,-40.6L4.9,0L3.15,0L3.15,-40.6L4.9,-40.6"}]},{name:"initialBarline",bounds:{left:0,right:10.3,top:-40.6,bottom:0},svgPaths:[{d:"M10.3,-40.6L10.3,0L8.75,0L8.75,-40.6L10.3,-40.6M6,-40.6L6,0L0,0L0,-40.6L6,-40.6"}]},{name:"normalBarline",bounds:{left:0,right:1.506,top:-40.6,bottom:0},svgPaths:[{d:"M1.506,0L0.006,0L0.006,-40.6L1.506,-40.6L1.506,0"}]},{name:"finalBarline",bounds:{left:0,right:10.4,top:-40.6,bottom:0},svgPaths:[{d:"M1.6,-40.6L1.6,0L0,0L0,-40.6L1.6,-40.6M10.4,-40.6L10.4,0L4.4,0L4.4,-40.6L10.4,-40.6"}]},{name:"dashedBarline",bounds:{left:0,right:1.5,top:-40.6,bottom:0},svgPaths:[{d:"M1.5,-40.6L1.5,-36.4L0,-36.4L0,-40.6L1.5,-40.6M1.5,-29.25L0,-29.25L0,-33.4L1.5,-33.4L1.5,-29.25M1.5,-26.05L1.5,-21.9L0,-21.9L0,-26.05L1.5,-26.05M1.5,-14.55L0,-14.55L0,-18.7L1.5,-18.7L1.5,-14.55M0,-11.35L1.5,-11.35L1.5,-7.2L0,-7.2L0,-11.35M1.5,-4.2L1.5,0L0,0L0,-4.2L1.5,-4.2"}]},{name:"startRepeat",bounds:{left:0,right:18.184,top:-2.05,bottom:3.1},svgPaths:[{d:"M18.184,0.457Q17.916,2.761 15.634,3.1Q13.286,2.761 13.084,0.457Q13.286,-1.847 15.634,-2.05Q17.916,-1.847 18.184,0.457"}]},{name:"endRepeat",bounds:{left:-.016,right:5.084,top:-2.05,bottom:3.1},svgPaths:[{d:"M5.084,0.457Q4.816,2.761 2.534,3.1Q0.186,2.761 -0.016,0.457Q0.186,-1.847 2.534,-2.05Q4.816,-1.847 5.084,0.457"}]},{name:"gClef",bounds:{left:0,right:24.5,top:-43,bottom:26.4},svgPaths:[{d:"M16.8,-41.3Q17.85,-39.35 18.65,-36.5Q19.45,-33.75 19.55,-31.35Q19.3,-22.85 12.95,-16.4L14.25,-9.7L15.8,-9.85Q19.7,-9.75 22.1,-6.9Q24.45,-4.05 24.5,-0.1Q24.45,3.15 22.7,5.45Q20.95,7.8 18.05,9.2L19.7,17.3L19.8,19.15Q19.6,25.45 12.95,26.35Q10.35,26.6 8.1,25.05Q5.85,23.5 5.45,20.8Q5.35,18.9 6.35,17.4Q7.4,15.95 9.2,15.65Q10.8,15.5 12,16.65Q13.2,17.75 13.3,19.45Q13.25,21.75 11.75,22.6Q10.25,23.5 9.2,23.25Q9.4,24.25 10.65,24.7L12.85,25Q18.35,24.15 18.45,19.05Q18.5,17.7 18.15,16.15L16.75,9.75L13.15,10.3Q7.85,10.15 4.2,6.4Q0.55,2.65 0,-3.15Q-0.2,-8.95 3.25,-13.5Q6.7,-18 10.6,-21.7Q9.45,-26.05 9.4,-30.55Q9.4,-33.6 10.75,-37.6Q12.1,-41.65 14.9,-43Q15.75,-43.2 16.8,-41.3M15.65,-37.1Q13.2,-36.35 12.15,-33.25Q11.1,-30.2 11.05,-27.75Q11.1,-25.2 11.75,-22.8Q14.2,-24.85 16.05,-27.95Q17.85,-31.1 17.8,-34.55Q17.8,-35.55 17.25,-36.3Q16.7,-37.05 15.65,-37.1M11.05,-2.85Q9.85,-1.35 9.85,0.55Q10.1,3.7 12.95,4.9L13.25,5.3L12.7,5.7Q10.4,4.85 8.95,2.9Q7.5,0.9 7.5,-1.65Q7.6,-4.2 9.2,-6.35Q10.8,-8.45 13.1,-9.35L11.9,-15.4Q8.55,-12.6 5.85,-9.05Q3.15,-5.55 2.95,-0.95Q3.1,3.8 6.25,6.4Q9.45,9.05 13.95,8.9L16.55,8.4L13.95,-4.9Q12.2,-4.35 11.05,-2.85M15.15,-5.05L17.8,8Q21.7,5.85 21.75,1.3Q21.5,-1.55 19.7,-3.25Q17.9,-5 15.15,-5.05"}]},{name:"fClef",bounds:{left:0,right:27.8,top:-10,bottom:22},svgPaths:[{d:"M6.8,-8.15L4.75,-7Q4,-6.2 3.55,-5.2Q3.1,-4.2 4.5,-3.9L6.1,-4.25Q7.75,-4.35 8.8,-3.4Q9.9,-2.4 9.95,-1Q9.9,0.4 8.85,1.5Q7.8,2.6 5.9,2.65Q3.9,2.65 2.5,1.45Q1.15,0.3 1.05,-1.55Q1,-3.6 2.15,-5.45Q3.3,-7.25 5.25,-8.35Q6.35,-9 8,-9.5L10.9,-10Q14.7,-10.25 18.25,-7.5Q20.05,-6.05 20.85,-4.5Q21.6,-2.95 21.85,-0.5Q22.1,3.2 19.8,7.2Q17.55,11.15 14.5,13.65L7.85,18.05L0.25,22L0,21.15L7.85,15.65Q11.1,13.05 13.65,8.75Q14.8,6.75 15.5,4.25Q16.25,1.8 16.25,-0.35Q16.4,-3.55 15.3,-5.75Q14.55,-7.15 13.1,-8Q11.55,-8.9 9.55,-8.75L6.8,-8.15M25.65,-6.85Q27.7,-6.6 27.8,-4.7Q27.7,-2.75 25.65,-2.5Q23.5,-2.75 23.45,-4.7Q23.5,-6.6 25.65,-6.85M27.8,4.05Q27.7,6 25.65,6.25Q23.5,6 23.45,4.05Q23.5,2.15 25.65,1.9Q27.7,2.15 27.8,4.05"}]},{name:"cClef",bounds:{left:0,right:27,top:-20,bottom:20.6},svgPaths:[{d:"M18.25,-20Q22.2,-19.95 24.6,-17.4Q26.9,-14.8 26.95,-10.5Q26.9,-7.05 24.95,-4.65Q23,-2.25 19.55,-1.9Q17.7,-1.7 15.35,-2.65L13.5,0.3L15.35,3.25Q17.7,2.3 19.55,2.5Q23,2.9 24.95,5.25Q26.9,7.65 27,11.1Q26.9,15.4 24.6,17.95Q22.2,20.55 18.25,20.6Q15.8,20.65 13.45,19.5Q11.1,18.45 10.95,15.7Q10.95,14.5 11.7,13.6Q12.45,12.75 13.6,12.7Q16.1,12.8 16.35,15.2Q16.25,16.5 15.5,17.1Q14.8,17.7 14.7,18.2Q14.75,18.9 15.6,19.15L17.05,19.4Q20.2,19.2 21,16.7Q21.85,14.2 21.65,11.6Q21.8,9.3 21.2,6.65Q20.65,4.05 17.7,4.05Q15.7,4.35 14.65,6.05Q13.65,7.8 13.45,9.7L13.35,9.7Q13,7.65 11.95,4.95Q10.8,2.25 8.6,0.65L8.6,20.6L7.05,20.6L7.05,-20L8.6,-20L8.6,-0.05Q10.8,-1.6 11.9,-4.35Q13,-7.1 13.35,-9.05L13.45,-9.05Q13.65,-7.2 14.65,-5.45Q15.7,-3.75 17.7,-3.45Q20.7,-3.45 21.25,-6.2Q21.8,-8.9 21.65,-11.25Q21.85,-14.05 21,-16.2Q20.2,-18.4 17.05,-18.75L15.6,-18.6Q14.75,-18.35 14.7,-17.6Q14.8,-17.15 15.5,-16.55Q16.25,-15.95 16.35,-14.65Q16.1,-12.25 13.6,-12.2Q11.15,-12.5 10.95,-15.15Q11.1,-17.9 13.45,-19Q15.85,-20.05 18.25,-20M4.7,-20L4.7,20.6L0,20.6L0,-20L4.7,-20"}]},{name:"wholeRest",bounds:{left:-2.478,right:15.022,top:-5.5,bottom:12},svgPaths:[{d:"M12.627,5L-0.023,5L-0.023,0L12.627,0L12.627,5"},{fill:"rgba(0,0,0,0)",d:"M15.022,12L-2.478,12L-2.478,-5.5L15.022,-5.5L15.022,12"}]},{name:"halfRest",bounds:{left:-2.428,right:15.072,top:-11.25,bottom:6.25},svgPaths:[{d:"M12.627,0L-0.023,0L-0.023,-5L12.627,-5L12.627,0"},{fill:"rgba(0,0,0,0)",d:"M15.072,6.25L-2.428,6.25L-2.428,-11.25L15.072,-11.25L15.072,6.25"}]},{name:"quarterRest",bounds:{left:0,right:10.4,top:-15,bottom:15.35},svgPaths:[{d:"M10.4,-7.2Q6.65,-3.15 6.3,0.2Q6.35,2.3 7.6,4.2L10.2,7.65L9.6,8.45Q8.15,7.65 6.8,7.55Q5.5,7.5 4.65,8.75Q3.6,10.6 4.4,12.2Q5.15,13.8 6.1,14.55L5.55,15.35L1.95,12.2Q0.25,10.45 0,8.1Q0.35,4.7 3.85,4.65Q5.2,4.65 6.95,5.6L6.95,5.5L0.65,-2.7Q2.4,-4.2 3.6,-6.25Q4.8,-8.3 4.6,-10.65Q4,-13.05 2.25,-15L3.95,-15L10.4,-7.2"}]},{name:"eighthRest",bounds:{left:0,right:10.4,top:-10,bottom:8.5},svgPaths:[{d:"M5.35,-6.25L5.25,-5.8Q5.55,-5.15 6.25,-5.5Q8.65,-6.6 9.75,-8.9L10.4,-8.9L5.65,8.5L4.25,8.5L8.1,-5.15Q6.05,-3.85 3.75,-3.65Q2.25,-3.7 1.15,-4.6Q0.1,-5.5 0,-6.95Q0.05,-9.35 2.45,-9.95Q3.7,-10.15 4.6,-9.35Q5.5,-8.55 5.55,-7.25L5.35,-6.25"}]},{name:"sixteenthRest",bounds:{left:0,right:13.3,top:-10,bottom:18.4},svgPaths:[{d:"M3.85,-4.55Q2.75,-5.45 2.7,-6.9Q2.7,-9.3 5.15,-9.95Q6.35,-10.15 7.25,-9.3Q8.15,-8.5 8.2,-7.2L8,-6.15L7.9,-5.7Q8.2,-5.1 8.9,-5.45Q11.25,-6.5 12.55,-8.85L13.3,-8.85L5.7,18.4L4.3,18.4L8.1,4.75Q6.1,6.05 3.8,6.25Q2.3,6.2 1.2,5.3Q0.1,4.4 0,2.95Q0.15,0.15 2.95,-0.15Q4.2,-0.1 4.9,0.8Q5.65,1.7 5.6,2.9L5.3,4.25Q5.45,4.55 5.8,4.5Q6.5,4.5 7.35,3.85L8.65,2.8L10.75,-5.1Q8.7,-3.8 6.4,-3.6Q5,-3.65 3.85,-4.55"}]},{name:"thirtySecondRest",bounds:{left:0,right:16.1,top:-20,bottom:18.5},svgPaths:[{d:"M10.9,-16.2L10.75,-15.75Q11.05,-15.1 11.75,-15.45Q14.1,-16.55 15.4,-18.85L16.1,-18.85L5.75,18.5L4.35,18.5L8.15,4.85Q6.1,6.15 3.8,6.35Q2.3,6.3 1.2,5.4Q0.1,4.5 0,3.05Q0.15,0.25 2.95,-0.05Q5.45,0.3 5.6,2.8L5.3,4.35Q5.45,4.65 5.8,4.6Q6.55,4.6 7.4,3.95L8.75,2.75L10.8,-5.1Q8.75,-3.8 6.45,-3.6Q5,-3.65 3.85,-4.55Q2.75,-5.45 2.7,-6.85Q2.8,-9.65 5.65,-9.95Q6.85,-9.85 7.6,-8.95Q8.3,-8.05 8.25,-6.9L7.95,-5.6Q8.1,-5.3 8.45,-5.35Q9.2,-5.3 10.05,-6L11.4,-7.35L13.6,-15.1Q11.55,-13.8 9.25,-13.6Q7.8,-13.65 6.65,-14.55Q5.55,-15.45 5.5,-16.9Q5.55,-19.3 7.95,-19.95Q9.2,-20.15 10.1,-19.3Q11.05,-18.5 11.05,-17.2Q11.15,-16.65 10.9,-16.2"}]},{name:"sixtyFourthRest",bounds:{left:0,right:18.9,top:-20,bottom:28.5},svgPaths:[{d:"M12.1,-13.6Q10.65,-13.65 9.5,-14.55Q8.4,-15.45 8.35,-16.9Q8.4,-19.3 10.8,-19.95Q12.1,-20.15 13,-19.3Q13.9,-18.5 13.95,-17.2L13.75,-16.2L13.6,-15.75Q13.9,-15.1 14.6,-15.45Q17,-16.55 18.2,-18.85L18.9,-18.85L5.75,28.5L4.35,28.5L8.1,14.9Q6.1,16.2 3.8,16.4Q2.3,16.35 1.2,15.45Q0.1,14.55 0,13.1Q0.15,10.3 2.95,10Q5.45,10.35 5.6,12.85L5.3,14.4Q5.45,14.7 5.8,14.65Q6.5,14.65 7.35,14L8.7,12.8L10.85,4.9Q8.8,6.2 6.45,6.4Q5,6.35 3.85,5.45Q2.75,4.55 2.7,3.15Q2.8,0.35 5.65,0.05Q6.85,0.15 7.6,1.05Q8.35,1.95 8.3,3.1L8,4.4Q8.15,4.7 8.5,4.65Q9.25,4.7 10.1,4L11.45,2.65L13.65,-5.1Q11.6,-3.8 9.3,-3.6Q7.8,-3.65 6.65,-4.55Q5.55,-5.45 5.5,-6.9Q5.55,-9.3 8,-9.95Q9.25,-10.1 10.15,-9.3Q11.1,-8.45 11.1,-7.2L10.95,-6.15L10.8,-5.75Q11.1,-5.1 11.8,-5.45Q13.15,-5.9 14.25,-7.25L16.45,-15.1Q14.45,-13.8 12.1,-13.6"}]},{name:"oneHundredTwentyEighthRest",bounds:{left:0,right:21.5,top:-30,bottom:28.5},svgPaths:[{d:"M21.5,-28.85L5.75,28.5L4.35,28.5L8.05,14.85Q6.1,16.15 3.8,16.35Q2.3,16.3 1.2,15.4Q0.1,14.5 0,13.05Q0.15,10.25 2.95,9.95Q5.45,10.3 5.6,12.8L5.3,14.35Q5.45,14.65 5.8,14.6Q6.5,14.6 7.35,13.95L8.65,12.75L10.7,4.85Q8.75,6.15 6.45,6.35Q5,6.3 3.85,5.4Q2.75,4.5 2.7,3.1Q2.8,0.35 5.65,0.05Q6.85,0.15 7.6,1.05Q8.3,1.95 8.25,3.05L7.95,4.35Q8.1,4.65 8.45,4.6Q9.2,4.65 10,3.95L11.3,2.6L13.6,-5.1Q11.55,-3.8 9.25,-3.6Q7.8,-3.65 6.65,-4.55Q5.55,-5.45 5.5,-6.9Q5.55,-9.3 7.95,-9.95Q9.2,-10.1 10.1,-9.3Q11.05,-8.45 11.05,-7.2L10.9,-6.15L10.75,-5.75Q11.05,-5.1 11.75,-5.45Q13.1,-5.9 14.2,-7.25L16.4,-15.1Q14.4,-13.8 12.05,-13.6Q10.6,-13.65 9.45,-14.55Q8.35,-15.45 8.3,-16.9Q8.35,-19.3 10.75,-19.95Q12.05,-20.1 12.95,-19.3Q13.85,-18.45 13.9,-17.2L13.7,-16.15L13.55,-15.75Q13.85,-15.1 14.55,-15.45Q16.05,-16 17,-17.25L19.05,-25.1Q17.05,-23.8 14.75,-23.6Q13.25,-23.65 12.15,-24.55Q11,-25.45 10.95,-26.9Q11,-29.3 13.4,-29.95Q14.7,-30.15 15.6,-29.3Q16.5,-28.5 16.55,-27.2L16.35,-26.2L16.25,-25.75Q16.5,-25.1 17.25,-25.45Q19.6,-26.55 20.8,-28.85L21.5,-28.85"}]},{name:"halfNoteHead",bounds:{left:0,right:13,top:-5.5,bottom:5.4},svgPaths:[{d:"M4.2,-0.95Q1.5,1 1.4,2.75Q1.35,3.55 2.4,3.65Q3.45,3.7 4.95,3.1Q6.45,2.5 7.95,1.45L10.6,-0.85Q11.65,-2.1 11.65,-3.05Q11.5,-3.65 10.75,-3.75Q9.25,-3.9 7.25,-2.9Q5.3,-1.85 4.2,-0.95M11.45,-4.85Q13.2,-3.4 13,-1.1Q12.75,1.55 10.1,3.4Q7.45,5.25 4.6,5.35Q2.95,5.5 1.6,4.75Q-0.2,3.3 0.05,1Q0.3,-1.7 2.9,-3.5Q5.5,-5.35 8.4,-5.45Q10.1,-5.6 11.45,-4.85"}]},{name:"solidNoteHead",bounds:{left:0,right:13,top:-5.2,bottom:5.2},svgPaths:[{d:"M13,-1.55Q12.8,1.2 10.15,3.15Q7.4,5.1 4.4,5.2Q2.5,5.15 1.3,4.2Q0.05,3.15 0,1.45Q0.2,-1.15 2.85,-3.1Q5.45,-5.1 8.25,-5.2Q10.45,-5.25 11.65,-4.3Q12.95,-3.45 13,-1.55"}]},{name:"wholeNoteHead",bounds:{left:0,right:16.4,top:-5,bottom:5},svgPaths:[{d:"M5,-0.9Q5.2,1.5 6.4,3Q7.6,4.4 9.2,4.2Q11.6,4.1 11.4,0.9Q11.2,-1.6 10,-3Q8.8,-4.4 7.2,-4.2Q6,-4 5.4,-3.3Q4.9,-2.6 5,-0.9M13.2,-4Q16.1,-2.9 16.4,0Q16.2,2.9 13.4,4Q10.7,5.1 8.3,5Q5.9,5.1 3.1,4Q0.3,2.9 0,0Q0.2,-2.9 2.9,-4Q5.7,-5.1 8,-5Q10.4,-5.1 13.2,-4"}]},{name:"eighthFlagUp",bounds:{left:-1.25,right:9.65,top:0,bottom:30},svgPaths:[{d:"M9.65,19.45Q9.6,22.6 8.45,25.45L6.2,30L5.6,30L7.35,25.85Q8.3,23.35 8.3,20.5Q8.15,17.1 6.05,14.4Q4.9,12.9 3.2,11.9Q1.5,10.9 -0.2,10.7L-0.2,11.5L-1.25,11.5L-1.25,0L-0.2,0L0.35,3.3Q0.7,5.15 2.2,7.05L6.8,12.25Q9.45,15.45 9.65,19.45"}]},{name:"sixteenthFlagDown",bounds:{left:0,right:11.4,top:-30,bottom:1.4},svgPaths:[{d:"M9.1,-29.6L9.55,-30Q11.2,-27.55 11.4,-23.3Q11.45,-21.1 10.45,-19.25Q10.9,-18.1 10.9,-16.45Q10.95,-14.4 10.25,-11.95Q9.5,-9.5 7.8,-7.25Q6,-5.05 3.1,-2.6Q1.9,-1.4 1.5,-0.2L1.05,1.4L0,1.4L0,-14.35L1.05,-14.35L1.05,-13.55L5.25,-16.15Q7.6,-17.6 8.9,-19.05Q9.85,-20.25 10.15,-21.4L10.45,-24.1Q10.5,-25.65 10,-27.35L9.1,-29.6M8.7,-16.45L7,-14.55L4.7,-12.35Q3.4,-11.15 2.3,-9.2Q1.2,-7.2 1.05,-5Q3.75,-6.45 5.75,-8.05Q7.75,-9.7 9.05,-12.6L9.75,-14.7L10,-16.65L10,-18.5L8.7,-16.45"}]},{name:"sixteenthFlagUp",bounds:{left:-1.25,right:10.15,top:0,bottom:32.6},svgPaths:[{d:"M6.85,9.95Q9.5,13.15 9.65,17.15Q9.65,19.15 9.05,21.1Q10.1,23.15 10.15,25.55Q10,29.75 8.1,32.6L7.45,32.6L8.7,29.7Q9.25,27.9 9.2,26.35L8.9,23.7Q8.6,22.55 7.6,21.3Q6.3,19.85 3.95,18.45L-0.2,15.85L-0.2,16.65L-1.25,16.65L-1.25,0L-0.2,0L0.2,2.45Q0.6,3.75 1.85,4.95Q4.9,7.6 6.85,9.95M7.55,18.75L8.5,20.15L8.6,17.55Q8.3,14.5 6.1,12.1Q3.5,9.25 -0.2,7.3Q-0.05,9.5 1.05,11.5Q2.15,13.45 3.5,14.7L5.85,16.85L7.55,18.75"}]},{name:"thirtySecondFlagUp",bounds:{left:-1.25,right:10.15,top:-8.5,bottom:31.9},svgPaths:[{d:"M1.85,-3.5Q4.9,-0.9 6.85,1.5Q9.5,4.65 9.65,8.7Q9.65,10.95 9.05,13.05Q9.6,14.65 9.65,16.45Q9.65,18.45 9.05,20.4Q10.1,22.45 10.15,24.85Q10,29.05 8.1,31.9L7.45,31.9L8.7,29Q9.25,27.2 9.2,25.65L8.9,23Q8.6,21.85 7.6,20.6Q6.3,19.15 3.95,17.75L-0.2,15.15L-0.2,15.95L-1.25,15.95L-1.25,-8.5L-0.2,-8.5L0.2,-6.05Q0.6,-4.7 1.85,-3.5M6.1,3.65Q3.5,0.75 -0.2,-1.15L-0.2,-0.7L0.2,1.75Q0.6,3.05 1.85,4.25Q4.9,6.9 6.85,9.25Q7.9,10.5 8.55,11.85L8.6,10.85L8.6,9.1Q8.3,6.05 6.1,3.65M8.6,16.85Q8.3,13.8 6.1,11.4Q3.5,8.55 -0.2,6.6Q-0.05,8.8 1.05,10.8Q2.15,12.75 3.5,14L5.85,16.15L7.55,18.05L8.5,19.45L8.6,16.85"}]},{name:"sixtyFourthFlagUp",bounds:{left:-1.25,right:10.15,top:-16,bottom:32.2},svgPaths:[{d:"M1.85,-11Q4.9,-8.4 6.85,-6Q9.5,-2.85 9.65,1.2Q9.65,3.45 9,5.6Q9.6,7.2 9.65,9.05Q9.65,11.3 9.05,13.4Q9.6,15 9.65,16.8Q9.65,18.8 9.05,20.75Q10.1,22.8 10.15,25.15Q10,29.35 8.1,32.2L7.45,32.2L8.7,29.3Q9.25,27.5 9.2,25.95L8.9,23.35Q8.6,22.2 7.6,20.95Q6.3,19.5 3.95,18.1L-0.2,15.5L-0.2,16.3L-1.25,16.3L-1.25,-16L-0.2,-16L0.2,-13.55Q0.6,-12.2 1.85,-11M1.85,-3.15Q4.9,-0.55 6.85,1.85L8.55,4.45L8.6,3.35L8.6,1.6Q8.3,-1.45 6.1,-3.85Q3.5,-6.75 -0.2,-8.65L-0.2,-8.15L0.2,-5.7Q0.6,-4.35 1.85,-3.15M1.85,4.6Q4.9,7.25 6.85,9.6Q7.9,10.85 8.55,12.2L8.6,11.2L8.6,9.45Q8.3,6.4 6.1,4Q3.5,1.1 -0.2,-0.8L-0.2,-0.35L0.2,2.1Q0.6,3.4 1.85,4.6M8.6,17.2Q8.3,14.15 6.1,11.75Q3.5,8.9 -0.2,6.95Q-0.05,9.15 1.05,11.15Q2.15,13.1 3.5,14.35L5.85,16.5L7.55,18.4L8.5,19.8L8.6,17.2"}]},{name:"oneHundredTwentyEighthFlagUp",bounds:{left:-1.25,right:10.15,top:-23.5,bottom:32.1},svgPaths:[{d:"M1.85,-18.5Q4.9,-15.9 6.85,-13.5Q9.5,-10.35 9.65,-6.3Q9.65,-4.15 9.1,-2.15Q9.6,-0.6 9.65,1.1Q9.65,3.35 9,5.5Q9.6,7.1 9.65,8.95Q9.65,11.2 9.05,13.3Q9.6,14.9 9.65,16.7Q9.65,18.7 9.05,20.65Q10.1,22.7 10.15,25.1Q10,29.25 8.1,32.1L7.45,32.1L8.7,29.2Q9.25,27.45 9.2,25.9L8.9,23.25Q8.6,22.1 7.6,20.85Q6.3,19.4 3.95,18L-0.2,15.4L-0.2,16.2L-1.25,16.2L-1.25,-23.5L-0.2,-23.5L0.2,-21.05Q0.6,-19.7 1.85,-18.5M6.85,-6.1L8.55,-3.45L8.6,-4.15L8.6,-5.9Q8.3,-8.95 6.1,-11.35Q3.5,-14.25 -0.2,-16.15L-0.2,-16.1L0.2,-13.65Q0.6,-12.3 1.85,-11.1Q4.9,-8.5 6.85,-6.1M1.85,-3.25Q4.9,-0.65 6.85,1.75L8.55,4.35L8.6,3.25L8.6,1.5Q8.3,-1.55 6.1,-3.95Q3.5,-6.85 -0.2,-8.75L-0.2,-8.25L0.2,-5.8Q0.6,-4.45 1.85,-3.25M1.85,4.5Q4.9,7.15 6.85,9.5Q7.9,10.75 8.55,12.1L8.6,11.1L8.6,9.35Q8.3,6.3 6.1,3.9Q3.5,1 -0.2,-0.9L-0.2,-0.45L0.2,2Q0.6,3.3 1.85,4.5M8.6,17.1Q8.3,14.05 6.1,11.65Q3.5,8.8 -0.2,6.85Q-0.05,9.05 1.05,11.05Q2.15,13 3.5,14.25L5.85,16.4L7.55,18.3L8.5,19.7L8.6,17.1"}]},{name:"eighthFlagDown",bounds:{left:0,right:10.9,top:-28.25,bottom:1.75},svgPaths:[{d:"M7.5,-28.25Q8.6,-26.5 9.7,-23.7Q10.85,-20.85 10.9,-17.7Q10.7,-13.7 8.05,-10.5L3.45,-5.3Q1.95,-3.4 1.6,-1.55L1.05,1.75L0,1.75L0,-9.75L1.05,-9.75L1.05,-8.95Q2.75,-9.15 4.45,-10.15Q6.15,-11.15 7.3,-12.65Q9.4,-15.35 9.55,-18.75Q9.55,-21.65 8.65,-24.05L6.9,-28L7.5,-28.25"}]},{name:"oneHundredTwentyEighthFlagDown",bounds:{left:0,right:11.4,top:-30,bottom:20.85},svgPaths:[{d:"M9.1,-29.6L9.55,-30Q11.2,-27.55 11.4,-23.3Q11.45,-21.1 10.45,-19.25Q10.9,-18.1 10.9,-16.45Q10.95,-14.75 10.45,-12.7Q10.85,-11.5 10.9,-9.8Q10.95,-8.2 10.5,-6.25L10.9,-3.45Q10.95,-1.8 10.5,0.2L10.9,3.1Q10.95,5.1 10.25,7.55Q9.5,10 7.8,12.2Q6,14.4 3.1,16.85Q1.85,18.1 1.5,19.25L1.05,20.85L0,20.85L0,-14.35L1.05,-14.35L1.05,-13.55L5.25,-16.15Q7.6,-17.6 8.9,-19.05Q9.85,-20.25 10.15,-21.4L10.45,-24.1Q10.5,-25.65 10,-27.35L9.1,-29.6M9.75,-14.7L10,-16.65L10,-18.5L8.7,-16.45L7,-14.55L4.7,-12.35Q3.4,-11.15 2.3,-9.2Q1.2,-7.2 1.05,-5Q3.75,-6.45 5.75,-8.05Q7.75,-9.7 9.05,-12.6L9.75,-14.7M10.05,-11.35Q9.3,-9.2 7.8,-7.25Q6,-5.05 3.1,-2.6Q1.9,-1.4 1.5,-0.2L1.05,1.4L1.05,1.6Q3.75,0.15 5.75,-1.5Q7.75,-3.1 9.05,-5.95L9.75,-8.1L10,-10.05L10.05,-11.35M10,-3.7L10.05,-4.75Q9.3,-2.65 7.8,-0.7Q6,1.5 3.1,3.95Q1.85,5.2 1.5,6.35L1.05,7.95Q3.75,6.5 5.75,4.85Q7.75,3.25 9.05,0.4L9.75,-1.75L10,-3.7M10,2.85L10.05,1.6Q9.3,3.7 7.8,5.65Q6,7.85 3.1,10.3Q1.85,11.55 1.5,12.7L1.05,14.3L1.05,14.5Q3.75,13.05 5.75,11.4Q7.75,9.8 9.05,6.95L9.75,4.8L10,2.85"}]},{name:"rhythmDot",bounds:{left:0,right:3.8,top:-2,bottom:1.8},svgPaths:[{d:"M3.8,-0.15Q3.6,1.55 1.9,1.8Q0.15,1.55 0,-0.15Q0.15,-1.85 1.9,-2Q3.6,-1.85 3.8,-0.15"}]},{name:"staff",bounds:{left:0,right:40.9,top:-40,bottom:.6},svgPaths:[{d:"M0,-30L40.9,-30L40.9,-29.25L0,-29.25L0,-30M0,-20L40.9,-20L40.9,-19.25L0,-19.25L0,-20M0,-10L40.9,-10L40.9,-9.25L0,-9.25L0,-10M0,-40L40.9,-40L40.9,-39.25L0,-39.25L0,-40M40.9,-0.15L40.9,0.6L0,0.6L0,-0.15L40.9,-0.15"}]},{name:"doubleFlat",bounds:{left:0,right:14.7,top:-20,bottom:6.8},svgPaths:[{d:"M7.95,-20L7.95,-4.3Q9.5,-5.65 11.5,-5.8Q12.75,-5.8 13.7,-4.8Q14.65,-3.85 14.7,-2.45Q14.55,-0.65 13.3,0.7Q12.05,2.05 10.7,3.05Q8.55,4.85 6.7,6.8L6.7,0.4L3.95,3.05L0,6.8L0,-20L1.25,-20L1.25,-4.3Q2.75,-5.65 4.75,-5.8Q5.85,-5.8 6.7,-5L6.7,-20L7.95,-20M3.4,-4.25Q2.7,-4.3 2,-3.65Q1.3,-2.95 1.25,-2.5L1.25,4.2L3.6,1.3Q4.85,-0.4 4.95,-2.1Q4.8,-4 3.4,-4.25M7.95,-2.5L7.95,4.2L10.35,1.3Q11.6,-0.4 11.7,-2.1Q11.6,-4 10.15,-4.25Q9.45,-4.3 8.75,-3.65L7.95,-2.5"}]},{name:"doubleSharp",bounds:{left:0,right:10.7,top:-5,bottom:5.6},svgPaths:[{d:"M3.9,-2.6Q3.9,-2.3 4.25,-1.7Q4.55,-1.15 5.35,-1.1Q6.7,-1.35 6.8,-2.65L7.1,-5L10.7,-5L10.7,-1.55L8.4,-1.1Q7.2,-0.95 7,0.35Q7.2,1.7 8.5,1.75L10.7,2.1L10.7,5.6L7.1,5.6L6.8,3.1Q6.6,1.8 5.35,1.7Q4.6,1.8 4.3,2.3L3.95,3.15L3.5,5.6L0,5.6L0,2.1L2.25,1.65Q3.6,1.5 3.7,0.2Q3.65,-0.55 3.1,-0.9L2.25,-1.25L0,-1.55L0,-5L3.5,-5L3.9,-2.6"}]},{name:"flat",bounds:{left:0,right:7.9,top:-20,bottom:6.8},svgPaths:[{d:"M1.2,-4.35Q2.75,-5.7 4.75,-5.85Q6,-5.85 6.95,-4.85Q7.9,-3.9 7.9,-2.5Q7.75,-0.7 6.5,0.65L3.9,3L0,6.8L0,-20L1.2,-20L1.2,-4.35M3.4,-4.3Q2.65,-4.35 1.95,-3.7Q1.25,-3 1.2,-2.55L1.2,4.2L3.55,1.25Q4.85,-0.45 4.95,-2.15Q4.8,-4.05 3.4,-4.3"}]},{name:"natural",bounds:{left:0,right:7,top:-14.2,bottom:13.9},svgPaths:[{d:"M7,-7.4L7,13.9L5.75,13.9L5.75,5.65L0,7.1L0,-14.2L1.25,-14.2L1.25,-5.95L7,-7.4M1.25,-2.1L1.25,3L5.75,1.8L5.75,-3.25L1.25,-2.1"}]},{name:"sharp",bounds:{left:0,right:9,top:-15,bottom:15.1},svgPaths:[{d:"M3.2,-14.05L3.2,-6.55L5.85,-7.25L5.85,-15L7.1,-15L7.1,-7.5L9,-8L9,-3.95L7.1,-3.5L7.1,2.25L9,1.75L9,5.9L7.1,6.4L7.1,13.8L5.85,13.8L5.85,6.7L3.2,7.35L3.2,15.1L1.95,15.1L1.95,7.65L0,8.1L0,4L1.95,3.5L1.95,-2.2L0,-1.7L0,-5.75L1.95,-6.25L1.95,-14.05L3.2,-14.05M3.2,-2.5L3.2,3.2L5.85,2.5L5.85,-3.2L3.2,-2.5"}]},{name:"timeSignature1",bounds:{left:0,right:10.1,top:-8,bottom:8.9},svgPaths:[{d:"M8.05,-8L8.05,5.1Q8.05,6.3 8.4,6.95Q8.75,7.6 10.1,7.65L10.1,8.9L1.65,8.9L1.65,7.65Q3,7.6 3.35,6.95Q3.7,6.3 3.7,5.1L3.7,-3.35L3.65,-3.35L1,1L0,0.6L3.65,-8L8.05,-8"}]},{name:"timeSignature2",bounds:{left:0,right:13.6,top:-8,bottom:9.5},svgPaths:[{d:"M4.65,-4.65Q5.65,-4.25 5.8,-2.75Q5.75,-1.75 4.95,-1.1Q4.15,-0.4 3.15,-0.4Q0.7,-0.65 0.45,-3Q0.45,-4.95 2.05,-6.45Q3.65,-7.9 7.45,-8Q10.35,-7.9 11.8,-6.4Q13.3,-4.95 13.3,-3.05Q12.95,0.15 9.85,1.3Q6.8,2.4 4.55,3.95L4.55,4Q8.05,3.6 10.1,5.05L11.5,5.15Q12.25,4.85 12.35,3.15L13.6,3.15Q13.65,5.3 12.85,7.3Q12,9.35 9.45,9.5Q7.65,9.3 6.5,8.25Q5.35,7.1 3.8,6.8Q1.7,6.9 1.4,8.9L0.1,8.9Q-0.35,6.15 1.7,4.45Q3.75,2.75 5.85,1.65Q7.15,0.85 8.05,-0.4Q9,-1.7 9.05,-3.3Q8.95,-6.85 6.15,-6.6Q3.45,-6.55 3.55,-5.55Q3.7,-5 4.65,-4.65"}]},{name:"timeSignature3",bounds:{left:0,right:12.9,top:-8,bottom:9.5},svgPaths:[{d:"M4.6,-5.2Q5.2,-4.9 5.3,-3.45Q5.1,-1.5 2.75,-1.35Q0.5,-1.5 0.35,-3.8Q0.5,-6.25 2.6,-7.1Q4.65,-8 6.4,-8Q8.45,-8.1 10.55,-6.95Q12.65,-5.8 12.75,-3.3Q12.7,-0.5 8.65,0.45L8.65,0.5Q10.2,0.65 11.55,1.6Q12.85,2.55 12.9,4.4Q12.8,7.25 10.65,8.4Q8.6,9.55 6.25,9.5Q4.25,9.55 2.25,8.7Q0.2,7.85 0,5.5Q0.25,3.1 2.65,2.85Q4.95,3.05 5.15,5.3Q4.95,6.4 4.3,7.2Q4.4,8.2 5.3,8.25Q6.8,8.35 7.7,7.35Q8.65,6.4 8.7,4.85Q8.6,2.65 7.2,1.85Q5.85,1.05 4,1.05L4,-0.2Q6.2,-0.2 7.25,-0.9Q8.4,-1.6 8.4,-3.55Q8.35,-6.6 5.6,-6.75L4.5,-6.6Q3.95,-6.5 3.85,-5.95Q4,-5.5 4.6,-5.2"}]},{name:"timeSignature4",bounds:{left:0,right:13.2,top:-8,bottom:8.8},svgPaths:[{d:"M6.35,-2.3Q3.7,0.95 1.55,2.75L1.55,2.85L6.9,2.85L6.9,-0.6L11.25,-4.7L11.25,2.85L13.2,2.85L13.2,4.25L11.25,4.25L11.25,5Q11.2,6.2 11.55,6.85Q11.9,7.5 13.15,7.55L13.15,8.8L4.9,8.8L4.9,7.55Q6.2,7.5 6.55,6.85Q6.9,6.2 6.9,5L6.9,4.25L0,4.25L0,2.85Q2.2,0.75 3.2,-2.15Q4.3,-5.1 4.6,-8L10.45,-8Q9.05,-5.55 6.35,-2.3"}]},{name:"timeSignature5",bounds:{left:0,right:12.1,top:-8,bottom:8.9},svgPaths:[{d:"M8.7,-5Q7.35,-4.15 5.3,-4.2L1.9,-4.65L1.8,-0.85Q3.8,-2.15 6.1,-2.15Q8.6,-2.1 10.3,-0.75Q12,0.5 12.1,3.1Q12.1,5 10.5,6.9Q8.8,8.75 4.95,8.9Q3.2,8.9 1.65,7.95Q0.15,7.05 0,5.2Q-0.1,4.05 0.6,3.15Q1.3,2.25 2.3,2.2Q4.9,2.2 4.9,4.8Q4.8,5.75 4,6.35Q3.7,6.5 3.65,6.9Q3.95,7.75 4.95,7.65Q5.9,7.75 7.1,6.65Q8.3,4.95 8,2.85Q7.9,1.2 7,0.15Q6.05,-0.85 4.85,-0.9Q3,-0.85 1.65,0.75L0.55,0.75L0.7,-8L5.7,-7.45L10.6,-8Q10.15,-5.8 8.7,-5"}]},{name:"timeSignature6",bounds:{left:0,right:13.4,top:-8,bottom:9.5},svgPaths:[{d:"M7.6,-8Q9.3,-8 10.85,-7.05Q12.35,-6.1 12.6,-4.35Q12.35,-2.05 10,-1.8Q7.75,-2 7.5,-4.1Q7.65,-5.05 8.15,-5.95Q8.35,-6.85 7.15,-6.75Q6.2,-6.7 5.65,-5.85L4.9,-4.15Q4.4,-2.6 4.4,-1.55L4.4,0.95Q6.35,-0.25 8.65,-0.35Q10.65,-0.3 11.95,0.9Q13.35,2.1 13.4,4.15Q13.25,6.7 11.4,8.05Q9.5,9.5 7.1,9.5L7.05,9.5Q3.45,9.4 1.7,6.9Q0,4.4 0,0.9Q0,-2.8 2,-5.35Q3.95,-7.9 7.6,-8M8.8,2.3Q8.35,1.05 7,0.9Q5.65,1.05 5.15,2.3Q4.7,3.6 4.75,4.5Q4.7,5.7 5.15,6.95Q5.65,8.15 7,8.25Q8.35,8.15 8.8,6.95Q9.25,5.7 9.2,4.5Q9.25,3.6 8.8,2.3"}]},{name:"timeSignature7",bounds:{left:0,right:13.6,top:-8,bottom:9.4},svgPaths:[{d:"M8.9,-6.4Q9.7,-5.2 10.85,-5.45Q12.2,-6.05 12.35,-7.5L13.6,-7.5L12.75,-3.4L10.85,0.3Q8.4,4.45 8.55,9.4L2.65,9.4Q2.75,6.55 4.65,4.15Q6.5,1.85 8.7,0.25L10.3,-1.3Q10.95,-2.05 11.2,-3.3Q8.6,-1.3 7.45,-1.85Q6.3,-2.4 5.55,-3.45Q2.65,-6.1 1.4,-2.35L0,-2.35L0,-7.5L1.4,-7.5Q1.5,-6.55 2.3,-6.6Q2.95,-7 3.65,-7.55Q4.3,-8.1 5.9,-8Q8.05,-7.55 8.9,-6.4"}]},{name:"timeSignature8",bounds:{left:0,right:13.1,top:-8,bottom:9.5},svgPaths:[{d:"M6.55,-8Q8.45,-8.05 10.4,-7.2Q12.45,-6.4 12.6,-4.15Q12.35,-1.5 10.05,-0.15Q13.15,1.65 13.1,4Q13.05,6.1 11.1,7.75Q9.2,9.4 6.05,9.5Q3.85,9.5 2,8.35Q0.15,7.15 0,4.8Q0.05,3.4 1,2.35Q1.95,1.3 3.2,0.75Q0.55,-0.5 0.35,-3.45Q0.45,-5.8 2.45,-6.9Q4.45,-8 6.55,-8M8.35,-1.05Q9.85,-2.15 10.15,-4.05Q10.15,-5.55 8.8,-6.15Q7.5,-6.8 6.25,-6.75Q4.1,-6.85 3.55,-4.85Q3.75,-3.5 5.7,-2.3Q7.75,-1.1 8.35,-1.05M7.6,3.15L4.7,1.55Q2.8,2.65 2.5,4.75Q2.55,6.1 3.65,7.1Q4.7,8.05 6,8.1Q7.25,8.3 8.35,7.6Q9.4,6.9 9.5,5.55Q9.3,4.05 7.6,3.15"}]},{name:"timeSignature9",bounds:{left:0,right:13.4,top:-8,bottom:9.5},svgPaths:[{d:"M6.4,-8Q10.05,-7.9 11.75,-5.4Q13.45,-2.9 13.4,0.65Q13.4,3.95 11.5,6.65Q9.65,9.35 5.85,9.5Q4.15,9.5 2.6,8.55Q1.05,7.6 0.8,5.8Q1,3.5 3.35,3.25Q5.75,3.45 5.9,5.7L5.25,7.5Q5.15,8.45 6.2,8.25Q7.85,8.05 8.4,6.05Q8.95,4.3 9,2.55L9.1,0.6L7,1.45L4.8,1.85Q2.85,1.8 1.45,0.6Q0.1,-0.6 0,-2.65Q0.1,-5.2 2.05,-6.6Q3.95,-8 6.35,-8L6.4,-8M4.65,-0.8Q5.15,0.5 6.55,0.65Q7.8,0.5 8.3,-0.8Q8.75,-2.15 8.7,-3.35L8.15,-5.55Q7.7,-6.65 6.55,-6.75Q5.3,-6.65 4.8,-5.55Q4.3,-4.45 4.25,-3.35Q4.15,-2.15 4.65,-0.8"}]},{name:"timeSignature0",bounds:{left:0,right:14.4,top:-8,bottom:9.5},svgPaths:[{d:"M7.2,-8Q11,-7.75 12.7,-4.85Q14.4,-1.95 14.4,0.75Q14.4,3.5 12.7,6.4Q11,9.25 7.2,9.5Q3.4,9.25 1.7,6.4Q0,3.5 0,0.75Q0,-1.95 1.7,-4.85Q3.4,-7.8 7.2,-8M7.2,-6.75Q5.3,-6.5 4.75,-3.7Q4.15,-0.95 4.2,0.8Q4.15,2.55 4.65,5.25Q5.2,8 7.2,8.25Q9.15,8 9.7,5.25Q10.25,2.55 10.15,0.8Q10.2,-0.95 9.65,-3.7Q9.05,-6.5 7.2,-6.75"}]},{name:"sixtyFourthFlagDown",bounds:{left:0,right:11.4,top:-30,bottom:14.3},svgPaths:[{d:"M9.1,-29.6L9.55,-30Q11.2,-27.55 11.4,-23.3Q11.45,-21.1 10.45,-19.25Q10.9,-18.1 10.9,-16.45Q10.95,-14.75 10.45,-12.7Q10.85,-11.5 10.9,-9.8Q10.95,-8.2 10.5,-6.25L10.9,-3.45Q10.95,-1.45 10.25,1Q9.5,3.45 7.8,5.65Q6,7.85 3.1,10.3Q1.85,11.55 1.5,12.7L1.05,14.3L0,14.3L0,-14.35L1.05,-14.35L1.05,-13.55L5.25,-16.15Q7.6,-17.6 8.9,-19.05Q9.85,-20.25 10.15,-21.4L10.45,-24.1Q10.5,-25.65 10,-27.35L9.1,-29.6M9.75,-14.7L10,-16.65L10,-18.5L8.7,-16.45L7,-14.55L4.7,-12.35Q3.4,-11.15 2.3,-9.2Q1.2,-7.2 1.05,-5Q3.75,-6.45 5.75,-8.05Q7.75,-9.7 9.05,-12.6L9.75,-14.7M10.05,-11.35Q9.3,-9.2 7.8,-7.25Q6,-5.05 3.1,-2.6Q1.9,-1.4 1.5,-0.2L1.05,1.4L1.05,1.6Q3.75,0.15 5.75,-1.5Q7.75,-3.1 9.05,-5.95L9.75,-8.1L10,-10.05L10.05,-11.35M7.8,-0.7Q6,1.5 3.1,3.95Q1.85,5.2 1.5,6.35L1.05,7.95Q3.75,6.5 5.75,4.85Q7.75,3.25 9.05,0.4L9.75,-1.75L10,-3.7L10.05,-4.75Q9.3,-2.65 7.8,-0.7"}]},{name:"thirtySecondFlagDown",bounds:{left:0,right:11.4,top:-30,bottom:7.95},svgPaths:[{d:"M9.1,-29.6L9.55,-30Q11.2,-27.55 11.4,-23.3Q11.45,-21.1 10.45,-19.25Q10.9,-18.1 10.9,-16.45Q10.95,-14.75 10.45,-12.7Q10.85,-11.5 10.9,-9.8Q10.95,-7.8 10.25,-5.35Q9.5,-2.9 7.8,-0.7Q6,1.5 3.1,3.95Q1.85,5.2 1.5,6.35L1.05,7.95L0,7.95L0,-14.35L1.05,-14.35L1.05,-13.55L5.25,-16.15Q7.6,-17.6 8.9,-19.05Q9.85,-20.25 10.15,-21.4L10.45,-24.1Q10.5,-25.65 10,-27.35L9.1,-29.6M10,-16.65L10,-18.5L8.7,-16.45L7,-14.55L4.7,-12.35Q3.4,-11.15 2.3,-9.2Q1.2,-7.2 1.05,-5Q3.75,-6.45 5.75,-8.05Q7.75,-9.7 9.05,-12.6L9.75,-14.7L10,-16.65M10.05,-11.35Q9.3,-9.2 7.8,-7.25Q6,-5.05 3.1,-2.6Q1.9,-1.4 1.5,-0.2L1.05,1.4L1.05,1.6Q3.75,0.15 5.75,-1.5Q7.75,-3.1 9.05,-5.95L9.75,-8.1L10,-10.05L10.05,-11.35"}]},{name:"grandStaff",bounds:{left:-12.5,right:0,top:-160,bottom:.15},svgPaths:[{d:"M-0.45,-160L-0.45,-159.4Q-3.55,-153.95 -5.45,-148.8L-5.65,-148.25Q-7.6,-142.85 -7.35,-136.45Q-7,-130.65 -5.45,-124.5L-5.35,-124.15L-2.15,-112.05Q-0.6,-106.2 -0.45,-101.6Q-0.4,-93.45 -3.2,-88.65Q-4.15,-87.1 -5.45,-85.55Q-8.05,-82.6 -12.1,-79.9Q-8.05,-77 -5.45,-74Q-4.15,-72.45 -3.2,-70.85Q-0.4,-66 -0.45,-57.8Q-0.6,-53.25 -2.15,-47.4L-5.35,-35.3Q-7,-29 -7.35,-22.95Q-7.6,-16.55 -5.65,-11.2Q-3.7,-5.85 -0.45,-0.4L-0.45,0.15Q-6.45,-8.3 -8.95,-16.25Q-11.45,-24.2 -11.4,-30.8Q-11.25,-37.45 -9.8,-44.1L-6.85,-56.45Q-5.35,-62.2 -5.3,-66.2Q-5.35,-67.85 -5.65,-69.35Q-6.15,-71.75 -7.35,-73.8Q-9.3,-77.1 -12.5,-79.6L-12.5,-80.2Q-9.3,-82.45 -7.35,-85.7Q-5.85,-88.15 -5.45,-91.2L-5.3,-93.2L-5.45,-95.65Q-5.8,-98.9 -6.85,-102.95L-9.8,-115.35Q-11.25,-121.95 -11.4,-128.65Q-11.45,-135.25 -8.95,-143.25Q-7.65,-147.35 -5.45,-151.65Q-3.35,-155.75 -0.45,-160"}]},{name:"slashNoteHead",bounds:{left:0,right:19.6,top:-13.15,bottom:13.75},svgPaths:[{"stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"miter","stroke-miterlimit":"38.4",d:"M19.1,-5.35L0.5,12.6L0.5,6.45L19.1,-12L19.1,-5.35"}]},{name:"hollowSlashNoteHead",bounds:{left:0,right:27.4,top:-13.75,bottom:13.25},svgPaths:[{fill:"rgba(255,255,255,0)","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"miter","stroke-miterlimit":"38.4",d:"M25.3,-0.25L13.9,11.15L2.5,-0.25L13.85,-11.65L25.3,-0.25"}]},{name:"invisibleBarline",bounds:{left:0,right:1.506,top:-40.25,bottom:.35},svgPaths:[{fill:"rgba(0,0,0,0)",d:"M1.506,0.35L0.006,0.35L0.006,-40.25L1.506,-40.25L1.506,0.35"}]},{name:"repeatBarline",bounds:{left:0,right:14.7,top:-40.6,bottom:0},svgPaths:[{d:"M14.7,-40.6L14.7,0L13.1,0L13.1,-40.6L14.7,-40.6M1.6,-40.6L1.6,0L0,0L0,-40.6L1.6,-40.6M10.4,-40.6L10.4,0L4.4,0L4.4,-40.6L10.4,-40.6"}]},{name:"topStartWing",bounds:{left:0,right:16.4,top:-18,bottom:.1},svgPaths:[{d:"M12.85,-13.05Q11.3,-11.5 9.8,-10.65L6.05,-8.65L6.05,0.1L0,0.1L0,-11.6L6.6,-12.7Q9.65,-13.4 11.05,-14.15Q12.7,-15.1 13.65,-16L15.55,-18L16.4,-17.7Q15.2,-15.2 12.85,-13.05"}]},{name:"bottomStartWing",bounds:{left:0,right:16.4,top:0,bottom:18.1},svgPaths:[{d:"M6.05,8.75L9.8,10.75Q11.3,11.6 12.85,13.15Q15.2,15.3 16.4,17.8L15.55,18.1L13.65,16.1Q12.7,15.2 11.05,14.25Q9.65,13.5 6.6,12.8L0,11.7L0,0L6.05,0L6.05,8.75"}]},{name:"braceBody",bounds:{left:0,right:6.05,top:-40.5,bottom:.1},svgPaths:[{d:"M6.05,0.1L0,0.1L0,-40.5L6.05,-40.5L6.05,0.1"}]},{name:"bottomEndWing",bounds:{left:-10.1,right:6.3,top:0,bottom:18.1},svgPaths:[{d:"M0.25,0L0.25,8.75L-3.5,10.75Q-5,11.6 -6.55,13.15Q-8.9,15.3 -10.1,17.8L-9.25,18.1L-7.35,16.1L-4.75,14.25Q-3.35,13.5 -0.3,12.8L6.3,11.7L6.3,0L0.25,0"}]},{name:"topEndWing",bounds:{left:-10.1,right:6.3,top:-18,bottom:.1},svgPaths:[{d:"M-10.1,-17.7Q-8.9,-15.2 -6.55,-13.05Q-5,-11.5 -3.5,-10.65L0.25,-8.65L0.25,0.1L6.3,0.1L6.3,-11.6L-0.3,-12.7Q-3.35,-13.4 -4.75,-14.15L-7.35,-16L-9.25,-18L-10.1,-17.7"}]},{name:"repeatEndingBracket",bounds:{left:-10.5,right:80.2,top:-22.5,bottom:0},svgPaths:[{fill:"none","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"20",d:"M-10,-5.5L-10,-22M-9.7,-22L79.7,-22"}]},{name:"halfRestWithLine",bounds:{left:-3.469,right:16.231,top:-11.25,bottom:6.25},svgPaths:[{d:"M16.231,0.8L-3.469,0.8L-3.469,-0.2L16.231,-0.2L16.231,0.8"},{d:"M12.627,0L-0.023,0L-0.023,-5L12.627,-5L12.627,0"},{fill:"rgba(0,0,0,0)",d:"M15.072,6.25L-2.428,6.25L-2.428,-11.25L15.072,-11.25L15.072,6.25"}]},{name:"wholeRestWithLine",bounds:{left:-3.519,right:16.181,top:-5.5,bottom:12},svgPaths:[{d:"M16.181,1.1L-3.519,1.1L-3.519,-0.1L16.181,-0.1L16.181,1.1"},{d:"M12.577,5L-0.073,5L-0.073,0L12.577,0L12.577,5"},{fill:"rgba(0,0,0,0)",d:"M14.972,12L-2.528,12L-2.528,-5.5L14.972,-5.5L14.972,12"}]},{name:"percussionClef",bounds:{left:0,right:11.25,top:-17,bottom:17.4},svgPaths:[{d:"M11.25,-17L11.25,17.4L0,17.4L0,-17L11.25,-17M1.9,-13.4L1.9,13.8L9.4,13.8L9.4,-13.4L1.9,-13.4"}]},{name:"fermataAbove",bounds:{left:-14,right:12.5,top:-.8,bottom:13.3},svgPaths:[{d:"M12.5,13.3L11.1,13.3Q10.7,8.75 7.15,6Q3.55,3.3 -0.85,3.25Q-5.15,3.3 -8.7,6Q-12.25,8.8 -12.65,13.3L-14,13.3Q-13.5,7.75 -10.1,3.55Q-6.7,-0.6 -0.85,-0.8Q5.05,-0.6 8.5,3.5Q12,7.65 12.5,13.3M-3.1,11.2Q-3,9.45 -0.8,9.25Q1.25,9.45 1.4,11.2Q1.25,13.1 -0.8,13.3Q-3,13.1 -3.1,11.2"}]},{name:"fermataBelow",bounds:{left:-14,right:12.35,top:0,bottom:14.1},svgPaths:[{d:"M8.45,9.75Q5.05,13.9 -0.8,14.1Q-6.6,13.9 -10.05,9.8Q-13.5,5.65 -14,0L-12.6,0Q-12.2,4.55 -8.7,7.3Q-5.15,10 -0.8,10.05Q3.5,10 7.05,7.3Q10.6,4.5 11,0L12.35,0Q11.85,5.55 8.45,9.75M-0.85,0Q1.35,0.2 1.45,2.1Q1.35,3.85 -0.85,4.05Q-2.9,3.85 -3.05,2.1Q-2.9,0.2 -0.85,0"}]},{name:"hollowSquareNoteHead",bounds:{left:0,right:12.05,top:-6,bottom:6.2},svgPaths:[{d:"M1.4,-4.6L1.4,4.8L10.65,4.8L10.65,-4.6L1.4,-4.6M12.05,-6L12.05,6.2L0,6.2L0,-6L12.05,-6"}]},{name:"squareNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:6.1},svgPaths:[{d:"M12.1,6.1L0,6.1L0,-6L12.1,-6L12.1,6.1"}]},{name:"hollowTriangleNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:4.9},svgPaths:[{d:"M9.7,3.5L6.15,-3.25L2.35,3.5L9.7,3.5M0,4.9L6.05,-6L12.1,4.9L0,4.9"}]},{name:"triangleNoteHead",bounds:{left:-.008,right:12.092,top:-6,bottom:4.9},svgPaths:[{d:"M5.928,-6L-0.008,4.9L12.092,4.9L5.928,-6"}]},{name:"hollowDiamondNoteHead",bounds:{left:0,right:12.05,top:-6,bottom:6},svgPaths:[{d:"M6,4.2L10.25,0L6,-4.2L1.8,0L6,4.2M0,0L6,-6L12.05,0L6,6L0,0"}]},{name:"diamondNoteHead",bounds:{left:0,right:12.1,top:-6,bottom:6},svgPaths:[{d:"M6.05,6L0,0L6.05,-6L12.1,0L6.05,6"}]},{name:"marcato",bounds:{left:-8,right:8.7,top:0,bottom:10.1},svgPaths:[{d:"M4.4,5L-8,1.3L-8,0L8.7,5.05L-8,10.1L-8,8.75L4.4,5.05L4.4,5"}]},{name:"staccato",bounds:{left:-1.8,right:2,top:0,bottom:3.8},svgPaths:[{d:"M2,1.85Q1.8,3.55 0.1,3.8Q-1.65,3.55 -1.8,1.85Q-1.65,0.15 0.1,0Q1.8,0.15 2,1.85"}]},{name:"closed",bounds:{left:-6,right:6,top:0,bottom:12},svgPaths:[{d:"M0.65,12L-0.75,12L-0.75,6.7L-6,6.7L-6,5.25L-0.75,5.25L-0.75,0L0.65,0L0.65,5.25L6,5.25L6,6.7L0.65,6.7L0.65,12"}]},{name:"tenuto",bounds:{left:-6,right:6.1,top:0,bottom:1.6},svgPaths:[{d:"M6.1,1.6L-6,1.6L-6,0L6.1,0L6.1,1.6"}]},{name:"martellatoBelow",bounds:{left:-6,right:4.6,top:0,bottom:16.7},svgPaths:[{d:"M4.6,0L-0.05,16.7L-6,0L-3.2,0L0.6,10.8L0.65,10.8L3.6,0L4.6,0"}]},{name:"martellatoStaccatoBelow",bounds:{left:-6,right:5.15,top:0,bottom:16.55},svgPaths:[{d:"M0.45,3.6Q-1.2,3.45 -1.35,1.8Q-1.2,0.15 0.45,0Q2.05,0.15 2.25,1.8Q2.05,3.45 0.45,3.6M4.15,0L5.15,0L-0.05,16.55L-6,0L-3.4,0L0.6,11.25L0.65,11.25L4.15,0"}]},{name:"open",bounds:{left:-4.75,right:4.8,top:0,bottom:9.55},svgPaths:[{d:"M4.8,4.5Q4.7,9.05 0.05,9.55Q-4.35,9.25 -4.75,4.95Q-4.45,0.4 0.05,0Q4.2,0.3 4.8,4.5M4,4.4Q3.45,1.1 -0.05,1Q-3.65,1.2 -3.85,4.85Q-3.65,8.35 0.05,8.65Q4,8.35 4,4.4"}]},{name:"staccatissimoBelow",bounds:{left:-2.5,right:2.8,top:0,bottom:6.5},svgPaths:[{d:"M0.1,0L-2.5,6.5L2.8,6.5L0.1,0"}]},{name:"staccatissimoAbove",bounds:{left:-2.5,right:2.8,top:0,bottom:6.5},svgPaths:[{d:"M0.1,6.5L-2.5,0L2.8,0L0.1,6.5"}]},{name:"martellatoAbove",bounds:{left:-5,right:5.6,top:0,bottom:16.7},svgPaths:[{d:"M2.85,16.7L-0.95,5.95L-1.05,5.95L-4,16.7L-5,16.7L-0.3,0L5.6,16.7L2.85,16.7"}]},{name:"martellatoStaccatoAbove",bounds:{left:-5,right:6.1,top:0,bottom:16.6},svgPaths:[{d:"M3.55,16.6L-0.45,5.35L-0.5,5.35L-4,16.6L-5,16.6L0.2,0L6.1,16.6L3.55,16.6M-2.1,14.8Q-1.9,13.15 -0.3,13Q1.35,13.15 1.5,14.8Q1.35,16.45 -0.3,16.6Q-1.9,16.45 -2.1,14.8"}]},{name:"tuplet0",bounds:{left:0,right:9.4,top:-6,bottom:6.5},svgPaths:[{d:"M6.4,-6Q7.85,-5.95 8.6,-4.95Q9.3,-3.9 9.4,-2.55Q9.4,0.3 7.75,3.25Q6.1,6.25 3.05,6.5Q1.55,6.4 0.8,5.3Q0.05,4.25 0,2.9Q-0.05,0.1 1.6,-2.85Q3.3,-5.8 6.4,-6M3.95,-3.2Q2.95,-1.25 2.5,0.95Q2,3.2 2.05,4.25Q2.15,5.5 3.1,5.7Q4.5,5.55 5.45,3.6Q6.4,1.7 6.9,-0.55L7.35,-3.8Q7.1,-5.3 6.35,-5.25Q4.9,-5.15 3.95,-3.2"}]},{name:"tuplet1",bounds:{left:0,right:7.9,top:-6,bottom:5.8},svgPaths:[{d:"M7.9,-6L4.6,4.45Q4.55,4.9 5.2,5L6.3,5L6,5.8L0,5.8L0.25,5L0.7,5.05Q1.8,5 2.4,4.1L4.45,-2.55L4.4,-2.6L1.8,-0.45L1.35,-0.85L5.55,-6L7.9,-6"}]},{name:"tuplet2",bounds:{left:0,right:10,top:-6,bottom:6.4},svgPaths:[{d:"M4.55,-2.6Q4.6,-1.6 3.55,-1.5Q2.5,-1.7 2.5,-2.55Q2.6,-3.95 3.8,-4.95Q5,-6 6.45,-6Q7.7,-6.1 8.85,-5.5Q9.9,-4.85 10,-2.95Q9.9,-1.3 8.5,-0.6L5.8,0.6Q3.65,1.25 2.1,2.85L2.1,2.95L2.9,2.85Q4.1,2.9 5.05,3.45Q6,3.95 6.8,3.95Q7.95,3.65 8.55,2.5L9.15,2.85L7.75,5.2Q6.9,6.3 5.65,6.4Q4.65,6.3 3.85,5.6Q3.05,4.9 2,4.85Q1.25,5.05 0.95,5.8L0,5.8Q0.25,2.6 2.55,1.35L2.55,1.25Q4.2,0.25 5.55,-0.3Q7.5,-1.1 7.8,-3.15Q8.1,-5 6.35,-5.25Q4.55,-5.3 4.35,-3.65L4.55,-2.6"}]},{name:"tuplet3",bounds:{left:0,right:9.7,top:-6,bottom:6.5},svgPaths:[{d:"M4.1,-5.2Q5.1,-6 6.15,-6Q9.25,-6.2 9.7,-3.2Q9.75,-1.9 8.7,-1.05Q7.7,-0.2 6.55,0.25L6.55,0.35Q8.2,1.4 8.1,2.65Q7.9,4.3 6.55,5.35Q5.2,6.45 3.65,6.5L1.35,6Q0.1,5.5 0,4.3Q0,2.65 1.45,2.45Q2.6,2.55 2.8,3.6L2.35,4.4Q1.9,4.65 1.85,5.2Q2.3,5.65 2.95,5.7Q4.3,5.6 5,4.25Q5.7,2.95 5.65,1.65Q5.4,0.7 4.75,0.5L3.25,0.4L3.45,-0.55Q5.25,-0.5 6.35,-1.1Q7.45,-1.7 7.5,-3.75Q7.6,-4.9 6.05,-5.25Q5,-5.3 4.85,-4.5L5.2,-3.6Q5.45,-2.6 4.45,-2.2Q3.15,-2.2 2.95,-3.25Q3.1,-4.45 4.1,-5.2"}]},{name:"tuplet4",bounds:{left:0,right:10,top:-6,bottom:6},svgPaths:[{d:"M9,-6Q7.85,-4.15 5.75,-2.2L1.35,1.7L1.35,1.8L5.5,1.8L6.3,-1L9.35,-4L9.6,-4L7.85,1.8L10,1.8L9.75,2.55L7.45,2.55L6.85,4.6Q6.8,5.1 7.5,5.2L8.55,5.2L8.3,6L2.3,6L2.55,5.2Q3.95,5.4 4.6,4.15L5.1,2.55L0,2.55L0.2,1.8Q1.8,0.4 3.05,-1.5Q4.9,-4.3 5.3,-6L9,-6"}]},{name:"tuplet5",bounds:{left:0,right:9.1,top:-6,bottom:6.6},svgPaths:[{d:"M2.15,-0.05L2.25,0Q3.35,-1.05 5.4,-1.15Q8.15,-0.95 8.3,1.9Q8.2,3.9 6.7,5.25Q5.2,6.6 3.2,6.6Q0.25,6.6 0,4Q0,2.75 1.35,2.4Q2.4,2.6 2.25,3.55L1.85,4.4L1.55,5Q1.85,5.95 3,5.8Q4.4,5.6 5.25,4.05Q6.05,2.5 6.1,1.3Q5.95,0.05 4.6,-0.1Q3.15,0 1.9,1.1L1.05,1.1L3.4,-6Q4.85,-5.5 6,-5.55L9.1,-6Q8.55,-5.15 7.6,-4.45Q6.7,-3.75 5.7,-3.7Q4.2,-3.75 3.55,-4.2L2.15,-0.05"}]},{name:"tuplet6",bounds:{left:0,right:8.2,top:-6,bottom:6.5},svgPaths:[{d:"M3.55,-5.25Q4.6,-6 5.85,-6Q8,-6 8.2,-4.15Q8.1,-2.8 6.75,-2.45Q5.5,-2.6 5.5,-3.55Q5.5,-3.95 5.8,-4.25L6.45,-4.9L5.75,-5.25Q4.1,-5.1 3.4,-3.35Q2.75,-1.55 2.55,0.1L2.6,0.1Q3.9,-1.4 5.65,-1.3Q7.55,-0.8 7.75,1.1Q7.8,3.1 6.55,4.7Q5.35,6.4 3.35,6.5Q1.4,6.4 0.65,5.2Q-0.05,4.05 0,2.3Q0.05,-0.9 1.8,-3.45Q2.45,-4.45 3.55,-5.25M5.05,3.85Q5.7,2.2 5.65,1.15Q5.5,0.1 4.55,-0.1Q3.65,-0.3 2.95,1.15Q2.25,2.65 2.2,4.2Q2.2,5.5 3.2,5.7Q4.45,5.5 5.05,3.85"}]},{name:"tuplet7",bounds:{left:0,right:9.4,top:-6,bottom:6},svgPaths:[{d:"M2.9,-3.55Q1.25,-3.05 0.8,-1.15L0,-1.15L1.45,-5.85L2.25,-5.85Q1.55,-5.1 2.35,-4.45L3.25,-5.25Q3.8,-5.7 4.85,-5.85L6.15,-5.25Q6.65,-4.65 7.4,-4.6Q8.5,-4.7 8.65,-6L9.4,-6Q8.6,-2.35 6.5,0.65Q5.15,3.25 4.95,6L1.1,6Q1.3,5 2,3.95L3.4,2.05L5.9,-0.75Q7,-1.8 8.05,-4.1L7.95,-4.15Q5.9,-2.4 5.1,-2.65Q4.55,-2.85 4.05,-3.2L2.9,-3.55"}]},{name:"tuplet8",bounds:{left:0,right:10.4,top:-6,bottom:6.5},svgPaths:[{d:"M2.35,-2.95Q2.5,-4.5 3.75,-5.25Q5.05,-6 6.4,-6Q7.9,-6 9.2,-5.05Q10.45,-4.05 10.4,-2.5Q10.25,-1.45 9.5,-0.8Q8.7,-0.1 7.8,0.25Q9,1.65 9.15,3.05Q9.1,4.95 7.6,5.7Q6.1,6.5 4.45,6.5Q3,6.5 1.55,5.65Q0.1,4.8 0,3.1Q0.1,1.8 1.2,0.95Q2.3,0.15 3.45,-0.25Q2.4,-1.45 2.35,-2.95M7.25,-0.2Q8.55,-1.05 8.85,-2.65Q8.95,-3.6 8.3,-4.4Q7.7,-5.15 6.7,-5.25Q5.15,-5.25 4.75,-3.8Q4.85,-2.6 5.7,-1.75L7.25,-0.2M6.65,4.05Q6.4,2.9 5.5,1.95L3.85,0.25Q1.85,1.2 1.7,3.35Q1.75,4.45 2.6,5.05Q3.5,5.65 4.45,5.7Q5.35,5.7 6.05,5.3Q6.8,4.85 6.65,4.05"}]},{name:"tuplet9",bounds:{left:0,right:8.6,top:-6,bottom:6.5},svgPaths:[{d:"M2.5,-1.25Q2.3,0.25 3.65,0.55Q4.85,0.6 5.65,-0.95Q6.4,-2.4 6.4,-3.65L6.15,-4.65Q5.9,-5.2 5.35,-5.25Q4.05,-5.2 3.3,-3.8Q2.6,-2.4 2.5,-1.25M5,-6Q6.9,-5.95 7.75,-4.75Q8.65,-3.55 8.6,-1.8Q8.55,0.8 6.95,3.35Q5.35,5.95 2.7,6.5Q1.65,6.55 0.8,5.85Q-0.05,5.15 0,4.15Q0.1,3.15 1.05,3.1Q1.9,3.15 2.05,4.05L1.85,5.05Q1.65,5.6 2.3,5.7Q3.75,5.5 4.65,3.65L5.8,0.55L5.7,0.55Q4.4,1.65 2.95,1.75Q0.4,1.6 0.3,-1.05Q0.3,-2.9 1.5,-4.4Q2.7,-5.95 5,-6"}]},{name:"hollowMiscNoteHead",bounds:{left:0,right:12.05,top:-5,bottom:5.5},svgPaths:[{d:"M2.75,-0.65L7.15,3.2L9.35,1.15L4.95,-2.7L2.75,-0.65M6,5.5Q3.35,1.9 0,0.25Q3.45,-2.15 6,-5Q8.65,-1.4 12.05,0.25Q8.75,2.4 6,5.5"}]},{name:"downBow",bounds:{left:-6,right:7.6,top:0,bottom:14.05},svgPaths:[{d:"M7.6,14.05L6.35,14.05L6.35,6.1L-4.75,6.1L-4.75,14.05L-6,14.05L-6,0L7.6,0L7.6,14.05"}]},{name:"upBow",bounds:{left:-4,right:5.2,top:0,bottom:16.7},svgPaths:[{d:"M0.65,16.7L-4,0L-2.8,0L0.65,13.2L0.7,13.2L4.1,0L5.2,0L0.65,16.7"}]},{name:"bendJazz",bounds:{left:-2.98,right:21.42,top:19,bottom:30.68},svgPaths:[{d:"M-8.47345,0.5940603 C-6.7156574,3.2856079 2.8767979,15.0043991 12.2938442,0.3424299 C13.072326,-1.1303348 13.8013804,1.4433132 13.1846611,2.5104961 C7.6510371,12.0825648 -2.4552908,15.5346205 -10.9715305,6.1175742 C-10.4165954,5.4177269 -10.5570142,4.1314907 -10.7850543,3.3586257 C-9.1714869,2.045429 -9.5174788,1.2208899 -9.9016646,0.7513294 C-8.1386916,0.461505 -8.297084,0.3817471 -8.47345,0.5940603"}]},{name:"twoHundredFiftySixthRest",bounds:{left:-2.55,right:21.5,top:-30,bottom:38},svgPaths:[{d:"M21.5,-28.85L5.75,28.5L5.7,28.5L3.1,38L1.7,38L4.4,28.5L4.35,28.5L5.5,24.4Q3.45,25.65 1.2,25.85Q-0.3,25.8 -1.4,24.9Q-2.45,24 -2.55,22.55Q-2.5,20.15 -0.1,19.55Q1.15,19.35 2.05,20.15Q2.95,20.95 3,22.25L2.8,23.25L2.7,23.7Q3,24.35 3.7,24L6.05,22.35L8.05,14.85Q6.1,16.15 3.8,16.35Q2.3,16.3 1.2,15.4Q0.1,14.5 0,13.05Q0.15,10.25 2.95,9.95Q5.45,10.3 5.6,12.8L5.3,14.35Q5.45,14.65 5.8,14.6Q6.5,14.6 7.35,13.95L8.65,12.75L10.7,4.85Q8.75,6.15 6.45,6.35Q5,6.3 3.85,5.4Q2.75,4.5 2.7,3.1Q2.8,0.35 5.65,0.05Q6.85,0.15 7.6,1.05Q8.3,1.95 8.25,3.05L7.95,4.35Q8.1,4.65 8.45,4.6Q9.2,4.65 10,3.95L11.3,2.6L13.6,-5.1Q11.55,-3.8 9.25,-3.6Q7.8,-3.65 6.65,-4.55Q5.55,-5.45 5.5,-6.9Q5.55,-9.3 7.95,-9.95Q9.2,-10.1 10.1,-9.3Q11.05,-8.45 11.05,-7.2L10.9,-6.15L10.75,-5.75Q11.05,-5.1 11.75,-5.45Q13.1,-5.9 14.2,-7.25L16.4,-15.1Q14.4,-13.8 12.05,-13.6Q10.6,-13.65 9.45,-14.55Q8.35,-15.45 8.3,-16.9Q8.35,-19.3 10.75,-19.95Q12.05,-20.1 12.95,-19.3Q13.85,-18.45 13.9,-17.2L13.7,-16.15L13.55,-15.75Q13.85,-15.1 14.55,-15.45Q16.05,-16 17,-17.25L19.05,-25.1Q17.05,-23.8 14.75,-23.6Q13.25,-23.65 12.15,-24.55Q11,-25.45 10.95,-26.9Q11,-29.3 13.4,-29.95Q14.7,-30.15 15.6,-29.3Q16.5,-28.5 16.55,-27.2L16.35,-26.2L16.25,-25.75Q16.5,-25.1 17.25,-25.45Q19.6,-26.55 20.8,-28.85L21.5,-28.85"}]},{name:"twoHundredFiftySixthFlagDown",bounds:{left:0,right:11.4,top:-30,bottom:27.1},svgPaths:[{d:"M9.1,-29.6L9.55,-30Q11.2,-27.55 11.4,-23.3Q11.45,-21.1 10.45,-19.25Q10.9,-18.1 10.9,-16.45Q10.95,-14.75 10.45,-12.7Q10.85,-11.5 10.9,-9.8Q10.95,-8.2 10.5,-6.25L10.9,-3.45Q10.95,-1.8 10.5,0.2L10.9,3.1Q10.95,4.7 10.5,6.6L10.9,9.35Q10.95,11.35 10.25,13.8Q9.5,16.25 7.8,18.45Q6,20.65 3.1,23.1Q1.85,24.35 1.5,25.5L1.05,27.1L0,27.1L0,-14.35L1.05,-14.35L1.05,-13.55L5.25,-16.15Q7.6,-17.6 8.9,-19.05Q9.85,-20.25 10.15,-21.4L10.45,-24.1Q10.5,-25.65 10,-27.35L9.1,-29.6M10,-18.5L8.7,-16.45L7,-14.55L4.7,-12.35Q3.4,-11.15 2.3,-9.2Q1.2,-7.2 1.05,-5Q3.75,-6.45 5.75,-8.05Q7.75,-9.7 9.05,-12.6L9.75,-14.7L10,-16.65L10,-18.5M10.05,-11.35Q9.3,-9.2 7.8,-7.25Q6,-5.05 3.1,-2.6Q1.9,-1.4 1.5,-0.2L1.05,1.4L1.05,1.6Q3.75,0.15 5.75,-1.5Q7.75,-3.1 9.05,-5.95L9.75,-8.1L10,-10.05L10.05,-11.35M10,-3.7L10.05,-4.75Q9.3,-2.65 7.8,-0.7Q6,1.5 3.1,3.95Q1.85,5.2 1.5,6.35L1.05,7.95Q3.75,6.5 5.75,4.85Q7.75,3.25 9.05,0.4L9.75,-1.75L10,-3.7M10,2.85L10.05,1.6Q9.3,3.7 7.8,5.65Q6,7.85 3.1,10.3Q1.85,11.55 1.5,12.7L1.05,14.3L1.05,14.5Q3.75,13.05 5.75,11.4Q7.75,9.8 9.05,6.95L9.75,4.8L10,2.85M10,9.1L10.05,8.15Q9.3,10.25 7.8,12.2Q6,14.4 3.1,16.85Q1.85,18.1 1.5,19.25L1.1,20.75L5.75,17.65Q7.75,16.05 9.05,13.2L9.75,11.05L10,9.1"}]},{name:"twoHundredFiftySixthFlagUp",bounds:{left:-1.25,right:10.15,top:-30.5,bottom:32.1},svgPaths:[{d:"M1.85,-25.5Q4.9,-22.9 6.85,-20.5Q9.5,-17.35 9.65,-13.3Q9.65,-11.3 9.15,-9.35Q9.6,-7.9 9.65,-6.3Q9.65,-4.15 9.1,-2.15Q9.6,-0.6 9.65,1.1Q9.65,3.35 9,5.5Q9.6,7.1 9.65,8.95Q9.65,11.2 9.05,13.3Q9.6,14.9 9.65,16.7Q9.65,18.7 9.05,20.65Q10.1,22.7 10.15,25.1Q10,29.25 8.1,32.1L7.45,32.1L8.7,29.2Q9.25,27.45 9.2,25.9L8.9,23.25Q8.6,22.1 7.6,20.85Q6.3,19.4 3.95,18L-0.2,15.4L-0.2,16.2L-1.25,16.2L-1.25,-30.5L-0.2,-30.5L0.2,-28.05Q0.6,-26.7 1.85,-25.5M6.1,-18.35Q3.5,-21.25 -0.15,-23.1L0.2,-21.05Q0.6,-19.7 1.85,-18.5Q4.9,-15.9 6.85,-13.5L8.6,-10.8L8.6,-11.15L8.6,-12.9Q8.3,-15.95 6.1,-18.35M1.85,-3.25Q4.9,-0.65 6.85,1.75L8.55,4.35L8.6,3.25L8.6,1.5Q8.3,-1.55 6.1,-3.95Q3.5,-6.85 -0.2,-8.75L-0.2,-8.25L0.2,-5.8Q0.6,-4.45 1.85,-3.25M8.6,-5.9Q8.3,-8.95 6.1,-11.35Q3.5,-14.25 -0.2,-16.15L-0.2,-16.1L0.2,-13.65Q0.6,-12.3 1.85,-11.1Q4.9,-8.5 6.85,-6.1L8.55,-3.45L8.6,-4.15L8.6,-5.9M1.85,4.5Q4.9,7.15 6.85,9.5Q7.9,10.75 8.55,12.1L8.6,11.1L8.6,9.35Q8.3,6.3 6.1,3.9Q3.5,1 -0.2,-0.9L-0.2,-0.45L0.2,2Q0.6,3.3 1.85,4.5M8.6,17.1Q8.3,14.05 6.1,11.65Q3.5,8.8 -0.2,6.85Q-0.05,9.05 1.05,11.05Q2.15,13 3.5,14.25L5.85,16.4L7.55,18.3L8.5,19.7L8.6,17.1"}]},{name:"wholeTempo",bounds:{left:0,right:8.2,top:0,bottom:15},svgPaths:[{d:"M2.5,12.05Q2.6,13.25 3.2,14Q3.8,14.7 4.6,14.6Q5.8,14.55 5.7,12.95Q5.6,11.7 5,11Q4.4,10.3 3.6,10.4Q3,10.5 2.7,10.85Q2.45,11.2 2.5,12.05M6.6,10.5Q8.05,11.05 8.2,12.5Q8.1,13.95 6.7,14.5Q5.35,15.05 4.15,15Q2.95,15.05 1.55,14.5Q0.15,13.95 0,12.5Q0.1,11.05 1.45,10.5Q2.85,9.95 4,10Q5.2,9.95 6.6,10.5"}]},{name:"wholeDotTempo",bounds:{left:0,right:10.8,top:0,bottom:15},svgPaths:[{d:"M2.7,10.85Q2.45,11.2 2.5,12.05Q2.6,13.25 3.2,14Q3.8,14.7 4.6,14.6Q5.75,14.55 5.65,12.95Q5.55,11.7 5,11Q4.4,10.3 3.6,10.4Q3,10.5 2.7,10.85M6.55,10.5Q8,11.05 8.15,12.5Q8.05,13.95 6.65,14.5L4.15,15Q2.95,15.05 1.55,14.5Q0.15,13.95 0,12.5Q0.1,11.05 1.45,10.5Q2.85,9.95 4,10Q5.2,9.95 6.55,10.5M9.85,12.9Q10.7,13 10.8,13.85Q10.7,14.7 9.85,14.8Q9,14.7 8.9,13.85Q9,13 9.85,12.9"}]},{name:"halfTempo",bounds:{left:0,right:6,top:0,bottom:20.3},svgPaths:[{d:"M6,0L6,17Q5.9,18.35 4.65,19.3Q3.45,20.25 2.1,20.3L0.7,20Q-0.15,19.25 0,18.1Q0.15,16.7 1.3,15.8Q2.5,14.9 3.85,14.8Q4.6,14.7 5.5,15.25L5.5,0L6,0M3.35,16.15Q2.45,16.65 1.9,17.1Q0.65,18.05 0.65,19Q0.6,19.4 1.1,19.45L2.25,19.15L3.65,18.3L4.85,17.15Q5.35,16.55 5.35,16.05L4.95,15.7Q4.25,15.6 3.35,16.15"}]},{name:"halfDotTempo",bounds:{left:-.05,right:8.6,top:0,bottom:20.3},svgPaths:[{d:"M5.5,0L6,0L6,17Q5.9,18.35 4.65,19.3Q3.45,20.25 2.1,20.3L0.7,20Q0.1,19.45 0,18.75L0,18.1Q0.15,16.7 1.3,15.8Q2.5,14.9 3.85,14.8Q4.6,14.7 5.5,15.25L5.5,0M4.95,15.7Q4.25,15.6 3.35,16.15Q2.45,16.65 1.9,17.1Q0.65,18.05 0.65,19Q0.6,19.4 1.1,19.45L2.25,19.15L3.65,18.3L4.85,17.15Q5.35,16.55 5.35,16.05L4.95,15.7M7.65,18.25Q8.5,18.35 8.6,19.2Q8.5,20.05 7.65,20.15Q6.8,20.05 6.7,19.2Q6.8,18.35 7.65,18.25"}]},{name:"quarterTempo",bounds:{left:0,right:6,top:0,bottom:20},svgPaths:[{d:"M6,0L6,16.7Q5.9,18.1 4.65,19.05Q3.45,19.95 2,20Q1.15,20 0.6,19.5Q0,19.05 0,18.25Q0.05,16.95 1.3,16Q2.55,15.05 3.8,15Q4.9,14.95 5.5,15.45L5.5,0L6,0"}]},{name:"quarterDotTempo",bounds:{left:0,right:8.6,top:0,bottom:20.1},svgPaths:[{d:"M6,0L6,16.7Q5.9,18.1 4.65,19.05Q3.45,19.95 2,20Q1.15,20 0.6,19.5Q0,19.05 0,18.25Q0.05,16.95 1.3,16Q2.55,15.05 3.8,15Q4.9,14.95 5.5,15.45L5.5,0L6,0M7.65,20.1Q6.8,20 6.7,19.15Q6.8,18.3 7.65,18.2Q8.5,18.3 8.6,19.15Q8.5,20 7.65,20.1"}]},{name:"eighthTempo",bounds:{left:0,right:10.95,top:0,bottom:20},svgPaths:[{d:"M9.5,6.1Q10.8,7.7 10.95,9.75Q10.9,11.3 10.3,12.7L9.2,15L8.9,15L9.8,12.95Q10.25,11.7 10.25,10.25Q10.15,8.55 9.15,7.2L7.7,5.95Q6.85,5.45 6,5.35L6,16.7Q5.9,18.1 4.65,19.05Q3.45,19.95 2,20Q1.15,20 0.6,19.5Q0,19.05 0,18.25Q0.05,16.95 1.3,16Q2.55,15.05 3.8,15Q4.9,14.95 5.5,15.45L5.5,0L6,0L6.25,1.65Q6.45,2.55 7.2,3.55L9.5,6.1"}]},{name:"eighthDotTempo",bounds:{left:0,right:12.2,top:0,bottom:20.1},svgPaths:[{d:"M12.2,9.75Q12.15,11.3 11.55,12.7L10.45,15L10.15,15L11.05,12.95Q11.5,11.7 11.5,10.25Q11.4,8.55 10.4,7.2L8.95,5.95Q8.1,5.45 7.25,5.35L7.25,16.7Q7.15,18.1 5.9,19.05Q4.7,19.95 3.25,20Q2.4,20 1.85,19.5Q1.25,19.05 1.25,18.25Q1.3,16.95 2.55,16Q3.8,15.05 5.05,15Q6.15,14.95 6.75,15.45L6.75,0L7.25,0L7.5,1.65Q7.7,2.55 8.45,3.55L10.75,6.1Q12.05,7.7 12.2,9.75M8.8,20.1Q7.95,20 7.85,19.15Q7.95,18.3 8.8,18.2Q9.65,18.3 9.75,19.15Q9.65,20 8.8,20.1"}]},{name:"sixteenthTempo",bounds:{left:0,right:11.1,top:0,bottom:20},svgPaths:[{d:"M10.4,8.8Q10.25,7.3 9.15,6.1Q7.85,4.65 6,3.7Q6.05,4.8 6.6,5.75Q7.15,6.75 7.85,7.35L9,8.45L9.9,9.4L10.35,10.1L10.4,8.8M11.1,12.05L11.1,13.55Q10.9,15.15 10.15,16.35L9.8,16.35L10.45,14.9L10.7,13.2L10.55,11.85Q10.4,11.3 9.9,10.7L8.1,9.25L6,7.95L6,16.7Q5.9,18.1 4.65,19.05Q3.45,19.95 2,20Q1.15,20 0.6,19.5Q0,19.05 0,18.25Q0.05,16.95 1.3,16Q2.55,15.05 3.8,15Q4.9,14.95 5.5,15.45L5.5,0L6,0L6.2,1.25L7,2.5L9.5,5Q10.85,6.6 10.95,8.6L10.65,10.6L11.1,12.05"}]},{name:"sixteenthDotTempo",bounds:{left:0,right:11.15,top:0,bottom:20.1},svgPaths:[{d:"M10.65,10.6Q11.15,11.6 11.15,12.8Q11.1,14.9 10.15,16.35L9.8,16.35L10.45,14.9L10.7,13.2L10.55,11.85Q10.4,11.3 9.9,10.7L8.1,9.25L6,7.95L6,16.7Q5.9,18.1 4.65,19.05Q3.45,19.95 2,20Q1.15,20 0.6,19.5Q0,19.05 0,18.25Q0.05,16.95 1.3,16Q2.55,15.05 3.8,15Q4.9,14.95 5.5,15.45L5.5,0L6,0L6.2,1.25L7,2.5L9.5,5Q10.85,6.6 10.95,8.6L10.65,10.6M10.4,8.8Q10.25,7.3 9.15,6.1Q7.85,4.65 6,3.7Q6.05,4.8 6.6,5.75Q7.15,6.75 7.85,7.35L9,8.45L9.9,9.4L10.35,10.1L10.4,8.8M7.8,20.1Q6.95,20 6.85,19.15Q6.95,18.3 7.8,18.2Q8.65,18.3 8.75,19.15Q8.65,20 7.8,20.1"}]},{name:"thirtySecondTempo",bounds:{left:0,right:11.1,top:0,bottom:20},svgPaths:[{d:"m 10.737408,14.447398 c 0.203446,-0.661989 0.305485,-1.333427 0.305485,-2.011791 C 11.025887,11.823378 10.923848,11.24642 10.737408,10.703476 10.940854,9.9898387 11.042893,9.2516368 11.042893,8.48698 10.992503,7.1113535 10.516325,5.8887842 9.6149879,4.8186427 8.9529995,4.0035967 8.10394,3.1539082 7.0678115,2.2714667 6.6426522,1.8639437 6.3629922,1.543972 6.2269412,1.0854299 6.1085265,0.62562806 6.0417608,-0.05084746 6.0253843,-0.05084746 l -0.3508351,0 0,12.48393446 0,0 0,6.240708 c -0.6298655,-0.32816 -0.9725124,-0.476179 -1.6930784,-0.441536 -0.8181953,0.03212 -1.648988,0.359023 -2.4671832,0.98196 -0.8175655,0.619787 -1.24902337,1.35799 -1.28240624,2.208939 0,0.524048 0.19399857,0.93346 0.58640481,1.226978 0.35965323,0.328159 0.81693563,0.490664 1.37310693,0.490664 0.9492072,-0.03212 1.9084924,-0.343276 2.6945645,-0.931571 0.819455,-0.621677 1.4184572,-1.392632 1.4184572,-2.307827 l 0,-8.069837 c 0.6298651,0.37666 1.1828871,0.796151 1.9286482,1.26603 0.7974096,0.474919 1.370587,0.958026 1.812123,1.45184 0.339498,0.424529 0.537904,0.832052 0.640573,1.22257 0.100778,0.374139 0.141089,0.824493 0.141089,1.351061 0.01637,0.526567 -0.07495,1.30886 -0.260763,1.920459 -0.205967,0.627977 -0.423271,1.061324 -0.6437221,1.691189 l 0.3294191,0 c 0.646241,-1.259731 0.995188,-2.379002 1.044946,-3.806277 -0.01637,-0.815046 -0.202817,-1.785038 -0.55932,-2.481039 z M 6.0852214,3.5022238 l -0.061726,0 0,-0.035273 c 0.022675,0.011338 0.04157,0.024565 0.061726,0.035273 z M 10.457118,13.963661 C 10.321697,13.725571 10.159192,13.487481 9.9733813,13.250023 9.7019088,12.893519 9.412801,12.571027 9.106686,12.281919 8.7829354,11.977064 8.3848604,11.611743 7.9093117,11.186583 7.4507696,10.761424 7.1276486,10.218479 6.7541384,9.5558608 6.4927443,9.080943 6.3044148,8.5883883 6.3044148,8.0800866 l 0,-0.6090799 c 1.2597307,0.6525406 2.1629579,1.4480609 3.0220947,2.3909699 0.7482805,0.8144154 1.1268285,1.7403184 1.2276075,2.7770774 0.01637,0.391146 -0.04599,0.831422 -0.097,1.324607 z m 0.256355,-4.3819755 c 0,0.1870701 -0.127233,0.3565045 -0.127233,0.5095615 C 10.363898,9.6327054 10.02503,9.1917994 9.6672666,8.7660103 9.0052783,7.9673408 8.1303942,7.1189119 7.0955255,6.2188338 6.6697365,5.8113108 6.4706989,5.3867814 6.3340185,4.9452456 6.288668,4.7663639 6.3044148,4.6000794 6.3044148,4.4344247 l 0,-0.9133049 c 1.2597307,0.6374239 2.2662554,1.4323141 3.1247622,2.3915992 0.747651,0.8156763 1.284296,1.7409487 1.284296,2.777078 0,0.254465 0,0.5523911 0,0.8918885 z"}]},{name:"thirtySecondDotTempo",bounds:{left:0,right:11.15,top:0,bottom:20.1},svgPaths:[{d:"m 9.0313454,21.93066 a 0.89786971,0.89786971 0 0 1 -0.4314821,1.191243 0.89786971,0.89786971 0 0 1 -1.1931322,-0.42623 0.89786971,0.89786971 0 0 1 0.420968,-1.194998 0.89786971,0.89786971 0 0 1 1.1968419,0.415698 l -0.8071881,0.393214 z m 1.7060626,-7.483262 c 0.203446,-0.661989 0.305485,-1.333427 0.305485,-2.011791 C 11.025887,11.823378 10.923848,11.24642 10.737408,10.703476 10.940854,9.9898387 11.042893,9.2516368 11.042893,8.48698 10.992503,7.1113535 10.516325,5.8887842 9.6149879,4.8186427 8.9529995,4.0035967 8.10394,3.1539082 7.0678115,2.2714667 6.6426522,1.8639437 6.3629922,1.543972 6.2269412,1.0854299 6.1085265,0.62562806 6.0417608,-0.05084746 6.0253843,-0.05084746 l -0.3508351,0 0,12.48393446 0,0 0,6.240708 c -0.6298655,-0.32816 -0.9725124,-0.476179 -1.6930784,-0.441536 -0.8181953,0.03212 -1.648988,0.359023 -2.4671832,0.98196 -0.8175655,0.619787 -1.24902337,1.35799 -1.28240624,2.208939 0,0.524048 0.19399857,0.93346 0.58640481,1.226978 C 1.1779394,22.978295 1.6352218,23.1408 2.1913931,23.1408 3.1406003,23.10868 4.0998855,22.797524 4.8859576,22.209229 5.7054126,21.587552 6.3044148,20.816597 6.3044148,19.901402 l 0,-8.069837 c 0.6298651,0.37666 1.1828871,0.796151 1.9286482,1.26603 0.7974096,0.474919 1.370587,0.958026 1.812123,1.45184 0.339498,0.424529 0.537904,0.832052 0.640573,1.22257 0.100778,0.374139 0.141089,0.824493 0.141089,1.351061 0.01637,0.526567 -0.07495,1.30886 -0.260763,1.920459 -0.205967,0.627977 -0.423271,1.061324 -0.6437221,1.691189 l 0.3294191,0 c 0.646241,-1.259731 0.995188,-2.379002 1.044946,-3.806277 -0.01637,-0.815046 -0.202817,-1.785038 -0.55932,-2.481039 z M 6.0852214,3.5022238 l -0.061726,0 0,-0.035273 c 0.022675,0.011338 0.04157,0.024565 0.061726,0.035273 z M 10.457118,13.963661 C 10.321697,13.725571 10.159192,13.487481 9.9733813,13.250023 9.7019088,12.893519 9.412801,12.571027 9.106686,12.281919 8.7829354,11.977064 8.3848604,11.611743 7.9093117,11.186583 7.4507696,10.761424 7.1276486,10.218479 6.7541384,9.5558608 6.4927443,9.080943 6.3044148,8.5883883 6.3044148,8.0800866 l 0,-0.6090799 c 1.2597307,0.6525406 2.1629579,1.4480609 3.0220947,2.3909699 0.7482805,0.8144154 1.1268285,1.7403184 1.2276075,2.7770774 0.01637,0.391146 -0.04599,0.831422 -0.097,1.324607 z m 0.256355,-4.3819755 c 0,0.1870701 -0.127233,0.3565045 -0.127233,0.5095615 C 10.363898,9.6327054 10.02503,9.1917994 9.6672666,8.7660103 9.0052783,7.9673408 8.1303942,7.1189119 7.0955255,6.2188338 6.6697365,5.8113108 6.4706989,5.3867814 6.3340185,4.9452456 6.288668,4.7663639 6.3044148,4.6000794 6.3044148,4.4344247 l 0,-0.9133049 c 1.2597307,0.6374239 2.2662554,1.4323141 3.1247622,2.3915992 0.747651,0.8156763 1.284296,1.7409487 1.284296,2.777078 0,0.254465 0,0.5523911 0,0.8918885 z"}]},{name:"sixtyFourthTempo",bounds:{left:0,right:11.1,top:0,bottom:20},svgPaths:[{d:"m 10.671511,18.652939 c 0.203539,-0.662287 0.305623,-1.332767 0.305623,-2.013329 -0.01638,-0.611875 -0.119098,-1.189093 -0.305623,-1.732912 0.203539,-0.71207 0.305623,-1.452496 0.305623,-2.216868 -0.01638,-0.628889 -0.12792,-1.214929 -0.331459,-1.758748 0.222443,-0.730974 0.331459,-1.4783322 0.331459,-2.2427041 C 10.925462,7.3121303 10.450329,6.0890094 9.548584,5.0183846 8.8856662,4.2029705 8.0368542,3.3528982 6.9996273,2.469428 6.5749062,2.0617209 6.2951199,1.6848912 6.1590075,1.2261421 6.0405393,0.76739287 5.9737434,0.03389831 5.9560992,0.03389831 l -0.3497332,0 0,6.81822249 0,0 0,15.0662562 c -0.63015,-0.328309 -1.0422681,-0.475133 -1.7631597,-0.441736 -0.8185648,0.03214 -1.6843908,0.360446 -2.5029557,0.982404 -0.81793466,0.621328 -1.26660144,1.358604 -1.29936924,2.210566 0,0.524285 0.18463394,0.933883 0.57784753,1.226902 C 0.97854455,26.224822 1.4322525,26.3874 1.9880448,26.3874 2.9376808,26.355263 3.9648253,26.043968 4.7525127,25.455408 5.5691871,24.83282 5.606366,24.062147 6.2365159,23.146539 l 0,-6.842169 0,0 0,-0.327678 c 0.6301498,0.390063 1.194134,0.831798 1.97552,1.325836 0.7990301,0.475133 1.3504114,0.959088 1.7908861,1.452496 0.340911,0.424721 0.525545,0.833058 0.627629,1.223121 0.102085,0.356035 0.135483,0.79903 0.135483,1.325835 0.01701,0.526806 -0.07751,1.156956 -0.263403,1.767571 -0.206059,0.62889 -0.425981,0.908046 -0.647164,1.538196 l 0.331459,0 c 0.644643,-1.2603 0.993116,-2.22632 1.044158,-3.652979 -0.01638,-0.7984 -0.202908,-1.606253 -0.559573,-2.303829 z M 6.2365159,3.6673431 c 1.2602997,0.6452735 2.2905949,1.4613178 3.1740652,2.4462422 0.7486179,0.816044 1.2369849,1.7423645 1.2369849,2.778331 0,0.2552108 0,0.5520114 0,0.8922924 0,0.2041686 -0.128551,0.3906933 -0.128551,0.5608333 C 10.282709,9.8692789 9.9417975,9.4275438 9.6008864,9.0198368 8.9385988,8.2044227 8.0645808,7.3543504 7.0267238,6.4708801 6.6020027,6.0631733 6.4495064,5.6302602 6.3133942,5.1715111 6.194926,4.7121317 6.2365159,4.2962327 6.2365159,3.9219236 l 0,-0.2545805 z m 0,4.0014521 c 1.2602997,0.6452736 2.2905949,1.4613178 3.1740652,2.4462418 0.7486179,0.816045 1.2369849,1.742365 1.2369849,2.777702 0,0.25584 0,0.552641 0,0.892292 0,0.187154 -0.128551,0.356665 -0.128551,0.509791 C 10.297832,13.835443 9.9569211,13.394968 9.6008864,12.968987 8.9385988,12.171217 8.0645808,11.321775 7.0267238,10.42129 6.6020027,10.013583 6.4495064,9.5888622 6.3133942,9.1471271 6.194926,8.6883779 6.2365159,8.2718487 6.2365159,7.8981698 l 0,-0.2293746 z M 10.391094,18.168984 C 10.254982,17.931418 10.093034,17.693851 9.9065091,17.455024 9.6342844,17.098359 9.3450455,16.775723 9.0400529,16.486484 8.7174161,16.181491 8.3179011,15.816004 7.842768,15.391283 7.3833886,14.965302 6.9668595,14.422743 6.5938107,13.760455 6.2195019,13.079893 6.0077715,12.365933 5.9560992,11.619205 c 1.2571489,0.662288 2.3277738,1.478332 3.211244,2.446873 0.7486182,0.815414 1.1727088,1.741734 1.2741628,2.777701 0.01701,0.391323 0,0.833058 -0.05041,1.325205 z"}]},{name:"sixtyFourthDotTempo",bounds:{left:0,right:11.15,top:0,bottom:20.1},svgPaths:[{d:"m 8.0690023,24.755751 a 0.80577254,0.80577254 0 0 1 1.0586281,0.416091 0.80577254,0.80577254 0 0 1 -0.4122468,1.060132 0.80577254,0.80577254 0 0 1 -1.0616205,-0.408397 0.80577254,0.80577254 0 0 1 0.4045404,-1.063095 l 0.3312105,0.734553 z m 2.6025087,-6.102812 c 0.203539,-0.662287 0.305623,-1.332767 0.305623,-2.013329 -0.01638,-0.611875 -0.119098,-1.189093 -0.305623,-1.732912 0.203539,-0.71207 0.305623,-1.452496 0.305623,-2.216868 -0.01638,-0.628889 -0.12792,-1.214929 -0.331459,-1.758748 0.222443,-0.730974 0.331459,-1.4783322 0.331459,-2.2427041 C 10.925462,7.3121303 10.450329,6.0890094 9.548584,5.0183846 8.8856662,4.2029705 8.0368542,3.3528982 6.9996273,2.469428 6.5749062,2.0617209 6.2951199,1.6848912 6.1590075,1.2261421 6.0405393,0.76739287 5.9737434,0.03389831 5.9560992,0.03389831 l -0.3497332,0 0,6.81822249 0,0 0,15.0662562 c -0.63015,-0.328309 -1.0422681,-0.475133 -1.7631597,-0.441736 -0.8185648,0.03214 -1.6843908,0.360446 -2.5029557,0.982404 -0.81793466,0.621328 -1.26660144,1.358604 -1.29936924,2.210566 0,0.524285 0.18463394,0.933883 0.57784753,1.226902 C 0.97854455,26.224822 1.4322525,26.3874 1.9880448,26.3874 2.9376808,26.355263 3.9648253,26.043968 4.7525127,25.455408 5.5691871,24.83282 5.606366,24.062147 6.2365159,23.146539 l 0,-6.842169 0,0 0,-0.327678 c 0.6301498,0.390063 1.194134,0.831798 1.97552,1.325836 0.7990301,0.475133 1.3504114,0.959088 1.7908861,1.452496 0.340911,0.424721 0.525545,0.833058 0.627629,1.223121 0.102085,0.356035 0.135483,0.79903 0.135483,1.325835 0.01701,0.526806 -0.07751,1.156956 -0.263403,1.767571 -0.206059,0.62889 -0.425981,0.908046 -0.647164,1.538196 l 0.331459,0 c 0.644643,-1.2603 0.993116,-2.22632 1.044158,-3.652979 -0.01638,-0.7984 -0.202908,-1.606253 -0.559573,-2.303829 z M 6.2365159,3.6673431 c 1.2602997,0.6452735 2.2905949,1.4613178 3.1740652,2.4462422 0.7486179,0.816044 1.2369849,1.7423645 1.2369849,2.778331 0,0.2552108 0,0.5520114 0,0.8922924 0,0.2041686 -0.128551,0.3906933 -0.128551,0.5608333 C 10.282709,9.8692789 9.9417975,9.4275438 9.6008864,9.0198368 8.9385988,8.2044227 8.0645808,7.3543504 7.0267238,6.4708801 6.6020027,6.0631733 6.4495064,5.6302602 6.3133942,5.1715111 6.194926,4.7121317 6.2365159,4.2962327 6.2365159,3.9219236 l 0,-0.2545805 z m 0,4.0014521 c 1.2602997,0.6452736 2.2905949,1.4613178 3.1740652,2.4462418 0.7486179,0.816045 1.2369849,1.742365 1.2369849,2.777702 0,0.25584 0,0.552641 0,0.892292 0,0.187154 -0.128551,0.356665 -0.128551,0.509791 C 10.297832,13.835443 9.9569211,13.394968 9.6008864,12.968987 8.9385988,12.171217 8.0645808,11.321775 7.0267238,10.42129 6.6020027,10.013583 6.4495064,9.5888622 6.3133942,9.1471271 6.194926,8.6883779 6.2365159,8.2718487 6.2365159,7.8981698 l 0,-0.2293746 z M 10.391094,18.168984 C 10.254982,17.931418 10.093034,17.693851 9.9065091,17.455024 9.6342844,17.098359 9.3450455,16.775723 9.0400529,16.486484 8.7174161,16.181491 8.3179011,15.816004 7.842768,15.391283 7.3833886,14.965302 6.9668595,14.422743 6.5938107,13.760455 6.2195019,13.079893 6.0077715,12.365933 5.9560992,11.619205 c 1.2571489,0.662288 2.3277738,1.478332 3.211244,2.446873 0.7486182,0.815414 1.1727088,1.741734 1.2741628,2.777701 0.01701,0.391323 0,0.833058 -0.05041,1.325205 z"}]},{name:"tempoEquals",bounds:{left:0,right:8,top:0,bottom:16.5},svgPaths:[{d:"M8,13.05L0,13.05L0,12L8,12L8,13.05M8,16.5L0,16.5L0,15.4L8,15.4L8,16.5"}]},{name:"pDynamics",bounds:{left:-6.1,right:11.8,top:-14,bottom:3.4},svgPaths:[{d:"M2.85,-4.2L0.75,1.45Q0.7,2 1.25,2.05L3.2,2.05L3.2,3.4L-6.1,3.4L-6.1,2.05L-4,2.05Q-3.3,2 -3,1.25L1.75,-11.8Q1.9,-12.6 1.4,-12.65Q0.25,-12.4 -0.8,-10.7L-2.2,-8.05L-3.2,-8.05L-0.95,-11.9Q0.45,-13.85 2.75,-14Q3.75,-13.95 4.05,-12.3Q6.2,-13.75 8.3,-14Q10.15,-13.95 10.95,-12.8Q11.8,-11.6 11.8,-9.95Q11.75,-7.5 9.95,-5.2Q8.15,-2.95 5.5,-2.75Q3.85,-2.95 2.85,-4.2M8.4,-11.4Q8.45,-12.55 7.5,-12.65Q6.35,-12.7 5.65,-11.65L4.65,-9.7Q3.8,-7.75 3.7,-5.65Q3.65,-4.35 4.65,-4.2Q6.2,-4.5 7.3,-7.25Q8.35,-9.95 8.4,-11.4"}]},{name:"fDynamics",bounds:{left:-6,right:14.7,top:-20.1,bottom:3.3},svgPaths:[{d:"M14,-19.35L14.65,-18.15Q14.8,-17.55 14.45,-16.45Q14.15,-15.35 12.4,-14.95Q11.05,-15.05 11.05,-16.4Q11.3,-17.45 12.05,-17.8L12.9,-18.45Q12.65,-19.05 11.95,-19.05Q11.05,-19.1 10.4,-18.45L9.35,-17.1Q8.35,-15.45 7.8,-13.55L11.25,-13.55L11.25,-12.15L7.4,-12.15L6.05,-7.65L4.45,-3.75L3.15,-1.3L1.6,0.9Q-0.1,3 -2.75,3.3Q-4.05,3.35 -5,2.55Q-5.95,1.75 -6,0.35L-5.65,-1.05Q-5.2,-1.85 -4.05,-2.05Q-2.2,-2 -2.2,-0.2Q-2.5,0.85 -3.45,1.5Q-4,2 -3.3,2.2Q-1.55,2.05 -0.4,-0.55Q0.8,-3.15 1.6,-6.5Q2.45,-9.85 3.25,-12.15L0.6,-12.15L0.6,-13.55L3.8,-13.55Q4.75,-16.05 6.9,-17.95Q9.05,-19.95 11.95,-20.1Q13.45,-20.05 14,-19.35"}]},{name:"sfDynamics",bounds:{left:-6,right:17.9,top:-20.1,bottom:3.3},svgPaths:[{d:"M17.2,-19.35L17.85,-18.15Q18.05,-17.55 17.7,-16.45Q17.35,-15.35 15.65,-14.95Q14.3,-15.05 14.25,-16.4Q14.55,-17.45 15.3,-17.8L16.15,-18.45Q15.85,-19.05 15.2,-19.05Q14.3,-19.1 13.65,-18.45L12.6,-17.1Q11.6,-15.45 11.05,-13.55L14.5,-13.55L14.5,-12.15L10.7,-12.15L9.3,-7.75Q8.35,-4.65 6.25,-0.95Q4.15,2.7 0.6,3.3Q-0.75,3.35 -1.7,2.55Q-2.65,1.75 -2.7,0.35L-2.35,-1.1Q-1.9,-1.9 -0.7,-2.1Q1.15,-2.05 1.15,-0.2Q1,0.6 0.35,1.05L-0.35,1.85L0.05,2.2Q1.8,2.05 2.95,-0.55L4.9,-6.55Q5.75,-9.85 6.55,-12.15L3.95,-12.15L3.95,-13.55L7.05,-13.55Q8.05,-16.05 10.15,-18Q12.3,-20 15.2,-20.1Q16.7,-20.05 17.2,-19.35M0.75,-12.25L0.25,-12.8L-0.45,-12.9Q-1.75,-12.75 -1.95,-11.5Q-1.65,-10.35 0.3,-9.5Q2.35,-8.5 2.4,-6.1Q2.25,-4.65 0.95,-3.85Q-0.3,-3.05 -1.85,-2.95Q-3.35,-2.9 -4.65,-3.7Q-5.9,-4.45 -6,-5.85Q-6.05,-7.25 -4.6,-7.5Q-3.6,-7.45 -3.4,-6.65Q-3.4,-5.9 -3.65,-5.65L-3.85,-5.05Q-3.7,-4.6 -3.15,-4.5L-2.2,-4.4Q-1.6,-4.4 -1,-4.75Q-0.4,-5.15 -0.35,-5.85Q-0.6,-7.1 -2.35,-7.9L-2.35,-7.95Q-4.25,-8.8 -4.55,-10.75Q-4.55,-12.3 -3.4,-13.25Q-2.2,-14.15 -0.45,-14.15Q0.9,-14.1 1.9,-13.5Q2.95,-12.95 3.05,-11.7Q2.95,-10.7 1.95,-10.5Q0.8,-10.55 0.6,-11.5L0.75,-12.25"}]},{name:"ppDynamics",bounds:{left:-6.1,right:26.7,top:-14,bottom:3.4},svgPaths:[{d:"M2.8,-4.2L0.75,1.45Q0.7,2 1.2,2.05L3.15,2.05L3.15,3.4L-6.1,3.4L-6.1,2.05L-4,2.05Q-3.3,2 -3,1.25L1.7,-11.8Q1.85,-12.6 1.35,-12.65Q0.25,-12.4 -0.8,-10.7L-2.2,-8.05L-3.2,-8.05L-0.95,-11.9Q0.45,-13.85 2.7,-14Q3.7,-13.95 4,-12.3Q6.15,-13.75 8.25,-14Q10.05,-13.95 10.85,-12.8Q11.7,-11.6 11.7,-9.95Q11.65,-7.5 9.85,-5.2Q8.1,-2.95 5.45,-2.75Q3.8,-2.95 2.8,-4.2M4.6,-4.2Q6.15,-4.5 7.25,-7.25Q8.3,-9.95 8.3,-11.4Q8.35,-12.55 7.45,-12.65Q6.3,-12.7 5.6,-11.65L4.6,-9.7Q3.75,-7.75 3.65,-5.65Q3.6,-4.35 4.6,-4.2M14.05,-11.9Q15.5,-13.85 17.7,-14Q18.65,-13.95 19,-12.3Q21.15,-13.75 23.2,-14Q25.05,-13.95 25.85,-12.8Q26.7,-11.6 26.7,-9.95Q26.65,-7.5 24.85,-5.2Q23.05,-2.95 20.4,-2.75Q18.8,-2.95 17.75,-4.2L15.8,1.45Q15.7,2 16.2,2.05L18.2,2.05L18.2,3.4L8.9,3.4L8.9,2.05L11,2.05Q11.75,2 12.05,1.25L16.75,-11.8Q16.85,-12.6 16.35,-12.65Q15.3,-12.4 14.25,-10.7L12.85,-8.05L11.85,-8.05Q12.65,-9.9 14.05,-11.9M18.65,-5.65Q18.6,-4.35 19.6,-4.2Q21.15,-4.5 22.2,-7.25Q23.25,-9.95 23.3,-11.4Q23.35,-12.55 22.4,-12.65Q21.25,-12.7 20.6,-11.65Q19.9,-10.65 19.55,-9.7Q18.75,-7.75 18.65,-5.65"}]},{name:"pppDynamics",bounds:{left:-6.1,right:41.9,top:-14,bottom:3.4},svgPaths:[{d:"M2.8,-4.2L0.75,1.45Q0.7,2 1.2,2.05L3.15,2.05L3.15,3.4L-6.1,3.4L-6.1,2.05L-4,2.05Q-3.3,2 -3,1.25L1.7,-11.8Q1.85,-12.6 1.35,-12.65Q0.25,-12.4 -0.8,-10.7L-2.2,-8.05L-3.2,-8.05L-0.95,-11.9Q0.45,-13.85 2.7,-14Q3.7,-13.95 4,-12.3Q6.15,-13.75 8.25,-14Q10.1,-13.95 10.9,-12.8Q11.75,-11.6 11.75,-9.95Q11.7,-7.5 9.9,-5.2Q8.1,-2.95 5.45,-2.75Q3.8,-2.95 2.8,-4.2M4.6,-4.2Q6.15,-4.5 7.25,-7.25Q8.3,-9.95 8.35,-11.4Q8.4,-12.55 7.45,-12.65Q6.3,-12.7 5.6,-11.65L4.6,-9.7Q3.75,-7.75 3.65,-5.65Q3.6,-4.35 4.6,-4.2M14.1,-11.9Q15.55,-13.85 17.75,-14Q18.7,-13.95 19.05,-12.3Q21.2,-13.75 23.25,-14Q25.1,-13.95 25.9,-12.8Q26.75,-11.6 26.75,-9.95Q26.7,-7.5 24.9,-5.2Q23.1,-2.95 20.45,-2.75Q18.85,-2.95 17.8,-4.2L15.85,1.45Q15.75,2 16.25,2.05L18.25,2.05L18.25,3.4L8.95,3.4L8.95,2.05L11.05,2.05Q11.8,2 12.1,1.25L16.8,-11.8Q16.9,-12.6 16.4,-12.65Q15.35,-12.4 14.3,-10.7L12.9,-8.05L11.9,-8.05L14.1,-11.9M18.7,-5.65Q18.65,-4.35 19.65,-4.2Q21.2,-4.5 22.25,-7.25Q23.3,-9.95 23.35,-11.4Q23.4,-12.55 22.45,-12.65Q21.3,-12.7 20.65,-11.65Q19.95,-10.65 19.6,-9.7Q18.8,-7.75 18.7,-5.65M26.9,-8.05Q27.7,-9.9 29.15,-11.9Q30.55,-13.85 32.8,-14Q33.8,-13.95 34.15,-12.3Q36.3,-13.75 38.4,-14Q40.25,-13.95 41.1,-12.8Q41.9,-11.6 41.9,-9.95Q41.85,-7.5 40.05,-5.2Q38.25,-2.95 35.6,-2.75Q33.95,-2.95 32.9,-4.2L30.9,1.45Q30.8,2 31.35,2.05L33.3,2.05L33.3,3.4L23.95,3.4L23.95,2.05L26.05,2.05Q26.8,2 27.1,1.25L31.85,-11.8Q31.95,-12.6 31.45,-12.65Q30.4,-12.4 29.3,-10.7L27.9,-8.05L26.9,-8.05M38.5,-11.4Q38.55,-12.55 37.6,-12.65Q36.45,-12.7 35.75,-11.65Q35.05,-10.65 34.7,-9.7Q33.9,-7.75 33.8,-5.65Q33.75,-4.35 34.75,-4.2Q36.3,-4.5 37.4,-7.25Q38.45,-9.95 38.5,-11.4"}]},{name:"mpDynamics",bounds:{left:-6.1,right:26,top:-14,bottom:3.4},svgPaths:[{d:"M16.95,-14Q17.9,-13.95 18.25,-12.3Q20.4,-13.75 22.5,-14Q24.3,-13.95 25.15,-12.8Q26.05,-11.6 26,-9.95Q25.95,-7.5 24.15,-5.2Q22.35,-2.95 19.7,-2.75Q18.05,-2.95 17,-4.2L15,1.45Q14.9,2 15.45,2.05L17.4,2.05L17.4,3.4L8.1,3.4L8.1,2.05L10.2,2.05Q10.9,2 11.2,1.25L15.95,-11.8Q16.05,-12.6 15.55,-12.65Q14.9,-12.6 14.25,-11.8L13,-9.95L12.1,-9.95Q12.9,-11.5 14.1,-12.75Q15.3,-13.95 16.95,-14M4.55,-14Q5.6,-14 5.95,-12.4Q8,-14.1 9.45,-14Q11.5,-13.85 11.2,-12.3L8.65,-4.95Q8.65,-4.2 9.1,-4.2L10.25,-4.9L11.3,-6.25L12.1,-6.25Q10.8,-3.95 9.95,-3.3Q9.1,-2.7 8.5,-2.75Q6.9,-2.8 6.2,-3.55Q5.5,-4.3 5.8,-5.25L8.3,-12.05Q8.25,-12.65 7.6,-12.6Q6.3,-12.2 5.9,-10.75L3.3,-3.4L0.45,-3.4L3.55,-12.05Q3.5,-12.6 2.9,-12.6Q1.6,-12.2 1.15,-10.75L-1.45,-3.4L-4.3,-3.4L-1.15,-11.8Q-1.1,-12.6 -1.6,-12.65Q-2.65,-12.4 -3.7,-10.65L-5.1,-8L-6.1,-8Q-5.25,-9.85 -3.8,-11.85Q-2.4,-13.85 -0.15,-14Q0.85,-13.95 1.15,-12.4Q3,-14.1 4.55,-14M18.1,-5.65Q18,-4.35 19.05,-4.2Q20.6,-4.5 21.7,-7.25Q22.75,-9.95 22.75,-11.35Q22.85,-12.55 21.9,-12.65Q20.7,-12.7 20.05,-11.65Q19.35,-10.65 19,-9.7Q18.2,-7.75 18.1,-5.65"}]},{name:"mfDynamics",bounds:{left:-6,right:27.3,top:-20.1,bottom:3.3},svgPaths:[{d:"M16.45,-13.55Q17.45,-16.05 19.55,-17.95Q21.7,-19.95 24.55,-20.1Q26.1,-20.05 26.6,-19.35L27.25,-18.15L27.1,-16.45Q26.75,-15.35 25,-14.95Q23.7,-15.05 23.65,-16.4Q23.9,-17.45 24.65,-17.8L25.5,-18.45Q25.25,-19.05 24.55,-19.05Q23.7,-19.1 23.05,-18.45L22,-17.1Q21,-15.45 20.45,-13.55L23.9,-13.55L23.9,-12.15L20.1,-12.15L18.75,-7.7Q17.75,-4.6 15.65,-0.95Q13.6,2.75 10,3.3Q8.7,3.35 7.75,2.55Q6.8,1.75 6.8,0.35Q6.75,-0.3 7.15,-1.1Q7.55,-1.85 8.75,-2.1Q10.55,-2.05 10.55,-0.2Q10.25,0.85 9.3,1.5Q8.75,2 9.45,2.2Q11.2,2.05 12.35,-0.55Q13.5,-3.15 14.3,-6.5Q15.15,-9.85 15.95,-12.15L13.35,-12.15L13.35,-13.55L16.45,-13.55M4.65,-14.15Q5.7,-14.15 6.05,-12.55Q8.05,-14.25 9.55,-14.15Q11.55,-14 11.25,-12.45L8.75,-5.15Q8.75,-4.4 9.15,-4.4L10.2,-4.95L11,-5.9L12.35,-7.9L13.15,-7.9L11.3,-4.9Q10.15,-3.15 8.6,-2.95Q7,-3 6.3,-3.75Q5.55,-4.5 5.9,-5.45L8.4,-12.2Q8.35,-12.8 7.7,-12.75Q6.4,-12.35 6,-10.9L3.4,-3.6L0.55,-3.6L3.65,-12.2Q3.6,-12.75 2.95,-12.75Q1.65,-12.35 1.25,-10.9L-1.4,-3.6L-4.2,-3.6L-1.05,-11.95Q-1,-12.75 -1.5,-12.8Q-2.55,-12.55 -3.6,-10.8L-5.05,-8.2L-6,-8.2L-3.75,-12Q-2.3,-14 -0.05,-14.15Q0.95,-14.1 1.2,-12.55Q3.1,-14.25 4.65,-14.15"}]},{name:"fzDynamics",bounds:{left:-6,right:20,top:-20.1,bottom:3.3},svgPaths:[{d:"M14,-19.35L14.65,-18.15Q14.8,-17.55 14.45,-16.45Q14.1,-15.35 12.4,-14.95Q11.05,-15.05 11.05,-16.4Q11.3,-17.45 12.05,-17.8L12.9,-18.45Q12.65,-19.05 11.95,-19.05Q11.05,-19.1 10.4,-18.45L9.35,-17.1L7.7,-13.55L11.25,-13.55L11.25,-12.15L7.4,-12.15L6.05,-7.7L4.45,-3.75L3.15,-1.3L1.6,0.9Q-0.1,3 -2.75,3.3Q-4.05,3.35 -5,2.55Q-5.95,1.75 -6,0.35L-5.65,-1.1Q-5.2,-1.85 -4.05,-2.1Q-2.2,-2.05 -2.2,-0.2Q-2.5,0.85 -3.45,1.5Q-4,2 -3.3,2.2Q-1.55,2.05 -0.4,-0.55Q0.8,-3.15 1.6,-6.5Q2.45,-9.85 3.25,-12.15L0.6,-12.15L0.6,-13.55L3.8,-13.55Q4.75,-16.05 6.9,-17.95Q9.05,-19.95 11.95,-20.1Q13.45,-20.05 14,-19.35M20,-13.55L20,-12.35L11.6,-5.55L11.65,-5.5Q12.4,-6.1 13.55,-6.1L15.7,-5.35Q16.5,-5.4 16.35,-6.2Q15.65,-6.55 15.55,-7.3Q15.6,-8.1 16.8,-8.3Q18.1,-8.05 18.05,-6.7Q18,-5.15 17.05,-4.1Q16.05,-3 14.6,-2.95Q13.1,-3.05 12.2,-3.65Q11.5,-4.15 10.75,-4.15Q9.95,-4.05 9.5,-3.6L8.35,-3.6Q8.45,-4.2 9.05,-4.8L17,-11.4L14,-11.4Q12.9,-11.15 12.4,-10.05L11.55,-10.05L12.65,-13.55L20,-13.55"}]},{name:"ffDynamics",bounds:{left:-6,right:25.3,top:-20.1,bottom:3.3},svgPaths:[{d:"M14,-19.35L14.65,-18.15Q14.8,-17.55 14.45,-16.45Q14.15,-15.35 12.4,-14.95Q11.05,-15.05 11,-16.4Q11.3,-17.45 12.05,-17.8L12.9,-18.45Q12.65,-19.05 11.95,-19.05Q11.05,-19.1 10.4,-18.45L9.35,-17.1Q8.35,-15.45 7.75,-13.55L14.45,-13.55Q15.45,-16.05 17.55,-17.95Q19.7,-19.95 22.55,-20.1Q24.1,-20.05 24.6,-19.35L25.25,-18.15Q25.45,-17.55 25.1,-16.45Q24.75,-15.35 23,-14.95Q21.7,-15.05 21.65,-16.4Q21.95,-17.45 22.65,-17.8Q23.45,-18.2 23.55,-18.45Q23.25,-19.05 22.55,-19.05Q21.7,-19.1 21.05,-18.45L20,-17.1Q19,-15.45 18.45,-13.55L21.9,-13.55L21.9,-12.15L18.1,-12.15L16.75,-7.65Q15.8,-4.55 13.65,-0.9Q11.5,2.75 7.9,3.3Q6.6,3.35 5.6,2.55Q4.7,1.75 4.65,0.35Q4.6,-0.25 5,-1.05Q5.4,-1.85 6.6,-2.05Q8.4,-2 8.45,-0.2Q8.15,0.85 7.15,1.5Q6.65,2 7.3,2.2Q9.1,2.05 10.25,-0.55Q11.4,-3.15 12.25,-6.5Q13.1,-9.85 13.9,-12.15L7.4,-12.15L6.05,-7.65Q5.05,-4.55 2.95,-0.9Q0.85,2.75 -2.75,3.3Q-4.05,3.35 -5,2.55Q-5.95,1.75 -6,0.35L-5.65,-1.05Q-5.2,-1.85 -4.05,-2.05Q-2.2,-2 -2.2,-0.2Q-2.5,0.85 -3.45,1.5Q-4,2 -3.3,2.2Q-1.55,2.05 -0.4,-0.55Q0.75,-3.15 1.6,-6.5Q2.45,-9.85 3.25,-12.15L0.6,-12.15L0.6,-13.55L3.75,-13.55Q4.75,-16.05 6.85,-17.95Q9,-19.95 11.95,-20.1Q13.45,-20.05 14,-19.35"}]},{name:"fffDynamics",bounds:{left:-6,right:36,top:-20.1,bottom:3.3},svgPaths:[{d:"M14.05,-19.35L14.7,-18.15Q14.85,-17.55 14.5,-16.45Q14.15,-15.35 12.4,-14.95Q11.05,-15.05 11,-16.4Q11.3,-17.45 12.05,-17.8L12.9,-18.45Q12.65,-19.05 11.95,-19.05Q11.05,-19.1 10.4,-18.45L9.35,-17.1Q8.35,-15.45 7.75,-13.55L14.5,-13.55Q15.4,-16.05 17.55,-17.95Q19.7,-19.95 22.6,-20.1Q24.15,-20.05 24.65,-19.35L25.3,-18.15Q25.5,-17.55 25.15,-16.45Q24.8,-15.35 23.05,-14.95Q21.7,-15.05 21.7,-16.4Q21.95,-17.45 22.7,-17.8L23.6,-18.45Q23.3,-19.05 22.6,-19.05Q21.7,-19.1 21.05,-18.45L20,-17.1Q19,-15.45 18.45,-13.55L25.15,-13.55Q26.1,-16.05 28.25,-17.95Q30.35,-19.95 33.25,-20.1Q34.75,-20.05 35.3,-19.35L35.95,-18.15Q36.1,-17.55 35.75,-16.45Q35.45,-15.35 33.7,-14.95Q32.35,-15.05 32.35,-16.4Q32.6,-17.45 33.35,-17.8L34.2,-18.45Q33.95,-19.05 33.25,-19.05Q32.35,-19.1 31.75,-18.45L30.65,-17.1Q29.7,-15.45 29.1,-13.55L32.6,-13.55L32.6,-12.15L28.75,-12.15L27.4,-7.65Q26.45,-4.55 24.3,-0.9Q22.2,2.75 18.55,3.3Q17.25,3.35 16.3,2.55Q15.35,1.75 15.3,0.35Q15.3,-0.25 15.65,-1.05Q16.1,-1.85 17.25,-2.05Q19.1,-2 19.15,-0.2Q18.8,0.85 17.85,1.5Q17.3,2 18,2.2Q19.75,2.05 20.95,-0.55Q22.1,-3.15 22.95,-6.5Q23.8,-9.85 24.6,-12.15L18.05,-12.15L16.7,-7.65Q15.75,-4.55 13.65,-0.9Q11.5,2.75 7.9,3.3Q6.6,3.35 5.6,2.55Q4.7,1.75 4.65,0.35Q4.6,-0.25 5,-1.05Q5.4,-1.85 6.6,-2.05Q8.4,-2 8.45,-0.2Q8.15,0.85 7.15,1.5Q6.65,2 7.3,2.2Q9.1,2.05 10.25,-0.55Q11.4,-3.15 12.25,-6.5L13.95,-12.15L7.4,-12.15L6.05,-7.65Q5.05,-4.55 2.95,-0.9Q0.85,2.75 -2.75,3.3Q-4.05,3.35 -5,2.55Q-5.95,1.75 -6,0.35L-5.65,-1.05Q-5.2,-1.85 -4.05,-2.05Q-2.2,-2 -2.2,-0.2Q-2.5,0.85 -3.45,1.5Q-4,2 -3.3,2.2Q-1.55,2.05 -0.4,-0.55Q0.75,-3.15 1.6,-6.5Q2.45,-9.85 3.25,-12.15L0.6,-12.15L0.6,-13.55L3.75,-13.55Q4.75,-16.05 6.85,-17.95Q9,-19.95 11.95,-20.1Q13.5,-20.05 14.05,-19.35"}]},{name:"sfzDynamics",bounds:{left:-5,right:23.95,top:-19,bottom:4.4},svgPaths:[{d:"M12.05,-12.45L15.5,-12.45L15.5,-11.05L11.7,-11.05L10.3,-6.65Q9.35,-3.55 7.25,0.15Q5.15,3.8 1.6,4.4Q0.25,4.45 -0.7,3.65Q-1.65,2.85 -1.7,1.45L-1.35,0Q-0.9,-0.8 0.3,-1Q2.15,-0.95 2.15,0.9Q2,1.7 1.35,2.15Q0.75,2.6 0.65,2.95L1.05,3.3Q2.8,3.15 3.95,0.55Q5.05,-2.05 5.9,-5.45Q6.75,-8.75 7.55,-11.05L4.95,-11.05L4.95,-12.45L8.05,-12.45Q9.05,-14.95 11.15,-16.9Q13.3,-18.9 16.2,-19Q17.7,-18.95 18.2,-18.25L18.85,-17.05Q19.05,-16.45 18.7,-15.35Q18.35,-14.25 16.65,-13.85Q15.3,-13.95 15.25,-15.3Q15.55,-16.35 16.3,-16.7Q17.05,-17.1 17.15,-17.35Q16.85,-17.95 16.2,-17.95Q15.3,-18 14.65,-17.35Q14,-16.75 13.6,-16Q12.6,-14.35 12.05,-12.45M2.9,-12.4Q3.95,-11.85 4.05,-10.6Q3.95,-9.6 2.95,-9.4Q1.8,-9.45 1.6,-10.4L1.75,-11.15L1.25,-11.7L0.55,-11.8Q-0.75,-11.65 -0.95,-10.4Q-0.65,-9.25 1.3,-8.4Q3.35,-7.4 3.4,-5Q3.25,-3.55 1.95,-2.75Q0.7,-1.95 -0.85,-1.85Q-2.35,-1.8 -3.65,-2.6Q-4.9,-3.35 -5,-4.75Q-5.05,-6.15 -3.6,-6.4Q-2.6,-6.35 -2.4,-5.55Q-2.4,-4.8 -2.65,-4.55L-2.85,-3.95Q-2.7,-3.5 -2.15,-3.4L-1.2,-3.3Q-0.6,-3.3 0,-3.65Q0.6,-4.05 0.65,-4.75Q0.4,-6 -1.35,-6.8L-1.35,-6.85Q-3.25,-7.7 -3.55,-9.65Q-3.55,-11.2 -2.4,-12.15Q-1.2,-13.05 0.55,-13.05Q1.9,-13 2.9,-12.4M15.5,-8.95L16.6,-12.45L23.95,-12.45L23.95,-11.25L15.55,-4.45L15.6,-4.4Q16.35,-5 17.5,-5L19.65,-4.25Q20.45,-4.3 20.3,-5.1Q19.6,-5.45 19.5,-6.2Q19.55,-7 20.75,-7.2Q22.05,-6.95 22,-5.6Q21.95,-4.05 21,-3Q20,-1.9 18.55,-1.85Q17.05,-1.95 16.15,-2.55Q15.45,-3.05 14.7,-3.05Q13.9,-2.95 13.45,-2.5L12.3,-2.5Q12.4,-3.1 13,-3.7L20.95,-10.3L17.95,-10.3Q16.85,-10.05 16.35,-8.95L15.5,-8.95"}]},{name:"sfpDynamics",bounds:{left:-5,right:28.4,top:-19.5,bottom:3.9},svgPaths:[{d:"M18.2,-18.75L18.85,-17.55Q19.05,-16.95 18.7,-15.85Q18.35,-14.75 16.65,-14.35Q15.3,-14.45 15.25,-15.8Q15.55,-16.85 16.3,-17.2Q17.05,-17.6 17.15,-17.85Q16.85,-18.45 16.2,-18.45Q15.3,-18.5 14.65,-17.85Q14,-17.25 13.6,-16.5Q12.6,-14.85 12.05,-12.95L15.5,-12.95L15.5,-11.55L11.7,-11.55L10.3,-7.15Q9.35,-4.05 7.25,-0.35Q5.15,3.3 1.6,3.9Q0.25,3.95 -0.7,3.15Q-1.65,2.35 -1.7,0.95L-1.35,-0.5Q-0.9,-1.3 0.3,-1.5Q2.15,-1.45 2.15,0.4Q2,1.2 1.35,1.65Q0.75,2.1 0.65,2.45L1.05,2.8Q2.8,2.65 3.95,0.05Q5.05,-2.55 5.9,-5.95Q6.75,-9.25 7.55,-11.55L4.95,-11.55L4.95,-12.95L8.05,-12.95Q9.05,-15.45 11.15,-17.4Q13.3,-19.4 16.2,-19.5Q17.7,-19.45 18.2,-18.75M2.9,-12.9Q3.95,-12.35 4.05,-11.1Q3.95,-10.1 2.95,-9.9Q1.8,-9.95 1.6,-10.9L1.75,-11.65L1.25,-12.2L0.55,-12.3Q-0.75,-12.15 -0.95,-10.9Q-0.65,-9.75 1.3,-8.9Q3.35,-7.9 3.4,-5.5Q3.25,-4.05 1.95,-3.25Q0.7,-2.45 -0.85,-2.35Q-2.35,-2.3 -3.65,-3.1Q-4.9,-3.85 -5,-5.25Q-5.05,-6.65 -3.6,-6.9Q-2.6,-6.85 -2.4,-6.05Q-2.4,-5.3 -2.65,-5.05L-2.85,-4.45Q-2.7,-4 -2.15,-3.9L-1.2,-3.8Q-0.6,-3.8 0,-4.15Q0.6,-4.55 0.65,-5.25Q0.4,-6.5 -1.35,-7.3L-1.35,-7.35Q-3.25,-8.2 -3.55,-10.15Q-3.55,-11.7 -2.4,-12.65Q-1.2,-13.55 0.55,-13.55Q1.9,-13.5 2.9,-12.9M17.95,-12.2Q17.3,-12.15 16.65,-11.35Q15.95,-10.5 15.4,-9.5L14.5,-9.5Q15.3,-11.05 16.5,-12.3Q17.7,-13.5 19.35,-13.55Q20.3,-13.5 20.65,-11.85Q22.8,-13.3 24.9,-13.55Q26.7,-13.5 27.55,-12.35Q28.45,-11.15 28.4,-9.5Q28.35,-7.05 26.55,-4.75Q24.75,-2.5 22.1,-2.3Q20.45,-2.5 19.4,-3.75L17.4,1.9Q17.3,2.45 17.85,2.5L19.8,2.5L19.8,3.85L10.5,3.85L10.5,2.5L12.6,2.5Q13.3,2.45 13.6,1.7L18.35,-11.35Q18.45,-12.15 17.95,-12.2M25.15,-10.9Q25.25,-12.1 24.3,-12.2Q23.1,-12.25 22.45,-11.2Q21.75,-10.2 21.4,-9.25Q20.6,-7.3 20.5,-5.2Q20.4,-3.9 21.45,-3.75Q23,-4.05 24.1,-6.8Q25.15,-9.5 25.15,-10.9"}]},{name:"fpDynamics",bounds:{left:-6.2,right:23.9,top:-19.5,bottom:3.9},svgPaths:[{d:"M13.7,-18.75L14.35,-17.55Q14.55,-16.95 14.2,-15.85Q13.85,-14.75 12.15,-14.35Q10.8,-14.45 10.75,-15.8Q11.05,-16.85 11.8,-17.2L12.65,-17.85Q12.35,-18.45 11.7,-18.45Q10.8,-18.5 10.15,-17.85L9.1,-16.5Q8.1,-14.85 7.55,-12.95L11,-12.95L11,-11.55L7.2,-11.55L5.8,-7.15Q4.85,-4.05 2.75,-0.35Q0.65,3.3 -2.9,3.9Q-4.25,3.95 -5.2,3.15Q-6.15,2.35 -6.2,0.95L-5.85,-0.5Q-5.4,-1.3 -4.2,-1.5Q-2.35,-1.45 -2.35,0.4Q-2.5,1.2 -3.15,1.65L-3.85,2.45L-3.45,2.8Q-1.7,2.65 -0.55,0.05Q0.55,-2.55 1.4,-5.95Q2.25,-9.25 3.05,-11.55L0.45,-11.55L0.45,-12.95L3.55,-12.95Q4.55,-15.45 6.65,-17.4Q8.8,-19.4 11.7,-19.5Q13.2,-19.45 13.7,-18.75M16.9,-9.25Q16.1,-7.3 16,-5.2Q15.9,-3.9 16.95,-3.75Q18.5,-4.05 19.6,-6.8Q20.65,-9.5 20.65,-10.9Q20.75,-12.1 19.8,-12.2Q18.6,-12.25 17.95,-11.2Q17.25,-10.2 16.9,-9.25M10.9,-9.5L10,-9.5Q10.8,-11.05 12,-12.3Q13.2,-13.5 14.85,-13.55Q15.8,-13.5 16.15,-11.85Q18.3,-13.3 20.4,-13.55Q22.2,-13.5 23.05,-12.35Q23.95,-11.15 23.9,-9.5Q23.85,-7.05 22.05,-4.75Q20.25,-2.5 17.6,-2.3Q15.95,-2.5 14.9,-3.75L12.9,1.9Q12.8,2.45 13.35,2.5L15.3,2.5L15.3,3.85L6,3.85L6,2.5L8.1,2.5Q8.8,2.45 9.1,1.7L13.85,-11.35Q13.95,-12.15 13.45,-12.2Q12.8,-12.15 12.15,-11.35Q11.45,-10.5 10.9,-9.5"}]},{name:"rfzDynamics",bounds:{left:-7,right:23.95,top:-19,bottom:4.4},svgPaths:[{d:"M12.05,-12.45L15.5,-12.45L15.5,-11.05L11.7,-11.05L10.3,-6.65Q9.35,-3.55 7.25,0.15Q5.15,3.8 1.6,4.4Q0.25,4.45 -0.7,3.65Q-1.65,2.85 -1.7,1.45L-1.35,0Q-0.9,-0.8 0.3,-1Q2.15,-0.95 2.15,0.9Q2,1.7 1.35,2.15Q0.75,2.6 0.65,2.95L1.05,3.3Q2.8,3.15 3.95,0.55Q5.05,-2.05 5.9,-5.45Q6.75,-8.75 7.55,-11.05L4.95,-11.05L4.95,-12.45L8.05,-12.45Q9.05,-14.95 11.15,-16.9Q13.3,-18.9 16.2,-19Q17.7,-18.95 18.2,-18.25L18.85,-17.05Q19.05,-16.45 18.7,-15.35Q18.35,-14.25 16.65,-13.85Q15.3,-13.95 15.25,-15.3Q15.55,-16.35 16.3,-16.7Q17.05,-17.1 17.15,-17.35Q16.85,-17.95 16.2,-17.95Q15.3,-18 14.65,-17.35Q14,-16.75 13.6,-16Q12.6,-14.35 12.05,-12.45M2.9,-9.4Q1.95,-9.45 2,-10.65Q2,-10.9 2.35,-11.55Q2.45,-11.9 2.05,-11.9Q0.9,-11.7 -0.25,-10.1L-1.8,-7.55L-4.4,-2.35L-7,-2.35L-3.35,-10.4Q-3,-11.05 -3.55,-11.25Q-4.25,-11.2 -5.1,-10.3L-6.4,-8.9L-7,-9.15L-4.45,-11.5Q-2.8,-12.65 -1.3,-12.65Q0.25,-12.45 -0.7,-10.7L-0.6,-10.7Q0.85,-12.65 3,-12.95Q4.6,-12.85 4.55,-11.2Q4.35,-9.5 2.9,-9.4M15.5,-8.95L16.6,-12.45L23.95,-12.45L23.95,-11.25L15.55,-4.45L15.6,-4.4Q16.35,-5 17.5,-5L19.65,-4.25Q20.45,-4.3 20.3,-5.1Q19.6,-5.45 19.5,-6.2Q19.55,-7 20.75,-7.2Q22.05,-6.95 22,-5.6Q21.95,-4.05 21,-3Q20,-1.9 18.55,-1.85Q17.05,-1.95 16.15,-2.55Q15.45,-3.05 14.7,-3.05Q13.9,-2.95 13.45,-2.5L12.3,-2.5Q12.4,-3.1 13,-3.7L20.95,-10.3L17.95,-10.3Q16.85,-10.05 16.35,-8.95L15.5,-8.95"}]},{name:"tabClef",bounds:{left:0,right:17.75,top:0,bottom:68},svgPaths:[{d:"M2.45,8.85L2.45,6.2L14.9,6.2L14.9,8.85L10.25,8.85L10.25,22L7.05,22L7.05,8.85L2.45,8.85M5.4,45L2,45L8.1,29.2L11.55,29.2L17.75,45L14.3,45L12.95,41.4L6.7,41.4L5.4,45M7.65,38.75L11.95,38.75L9.8,32.9L7.65,38.75M14.3,53L15.5,54.3Q16,55.15 16,56.15Q16,57.3 15.4,58.2Q14.85,59.15 13.8,59.6Q15.25,60 16,61.05Q16.8,62.05 16.8,63.4Q16.8,64.5 16.3,65.5Q15.8,66.55 14.9,67.15Q14.05,67.75 12.8,67.9L8.95,68L3.65,68L3.65,52.2L9.9,52.2L12.7,52.35Q13.6,52.5 14.3,53M11.3,54.9L8.65,54.85L6.8,54.85L6.8,58.45L8.9,58.45L11.15,58.4Q12,58.3 12.45,57.85Q12.9,57.4 12.9,56.65Q12.9,55.9 12.5,55.45Q12.1,55 11.3,54.9M6.8,61.15L6.8,65.35L9.75,65.35L11.95,65.25Q12.6,65.1 13.1,64.6Q13.5,64.1 13.5,63.25Q13.5,62.55 13.15,62.05L12.2,61.35L9.35,61.15L6.8,61.15"}]},{name:"tab0",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M1.3,-5.7Q2.3,-7 4.15,-7Q6.05,-7 7.15,-5.65Q8.4,-4.05 8.4,-0.4Q8.4,3.3 7.1,4.9Q6.05,6.2 4.15,6.2Q2.25,6.2 1.15,4.75Q0,3.3 0,-0.4Q0,-4.05 1.3,-5.7M2.8,-3.65Q2.55,-2.7 2.55,-0.4Q2.55,1.9 2.8,2.75Q3,3.6 3.35,3.9L4.15,4.15L5,3.9L5.55,2.85L5.8,-0.4L5.55,-3.55L4.95,-4.7L4.15,-4.95L3.35,-4.7Q3,-4.4 2.8,-3.65"}]},{name:"tab1",bounds:{left:0,right:5.7,top:-7,bottom:6},svgPaths:[{d:"M0,-1.5L0,-3.75Q0.95,-4.1 2.15,-4.95Q3.25,-5.85 3.7,-7L5.7,-7L5.7,6L3.2,6L3.2,-3.4Q1.9,-2.15 0,-1.5"}]},{name:"tab2",bounds:{left:0,right:8.8,top:-7,bottom:6},svgPaths:[{d:"M2.75,-3L0.3,-3.25Q0.5,-5.25 1.7,-6.15Q2.85,-7 4.6,-7Q6.55,-7 7.65,-5.95Q8.8,-4.95 8.8,-3.4L8.45,-1.75L7.4,-0.1L5.75,1.55L4.25,3L3.75,3.7L8.8,3.7L8.8,6L0,6Q0.15,4.7 0.85,3.5Q1.6,2.35 3.7,0.4L5.75,-1.7Q6.3,-2.5 6.3,-3.25Q6.3,-4.05 5.8,-4.5L4.55,-4.95Q3.75,-4.95 3.3,-4.5Q2.85,-4.05 2.75,-3"}]},{name:"tab3",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M4.15,-7Q5.95,-7 6.95,-5.85Q7.85,-4.9 7.85,-3.7Q7.85,-2 6.05,-1Q7.1,-0.75 7.75,0.1Q8.4,0.9 8.4,2.1Q8.4,3.8 7.15,5Q6,6.2 4.2,6.2Q2.45,6.2 1.3,5.2Q0.2,4.15 0,2.5L2.4,2.2Q2.5,3.15 2.95,3.65Q3.45,4.15 4.15,4.15Q4.85,4.15 5.35,3.6Q5.85,3 5.85,2Q5.85,1.05 5.4,0.5Q4.95,-0.05 4.25,-0.05L3.25,0.15L3.5,-1.85Q4.45,-1.85 4.95,-2.3Q5.4,-2.75 5.4,-3.55Q5.4,-4.2 5.05,-4.6Q4.7,-4.95 4.05,-4.95Q3.45,-4.95 3.05,-4.5Q2.6,-4.05 2.55,-3.2L0.3,-3.6Q0.5,-4.8 1,-5.5Q1.45,-6.2 2.3,-6.6L4.15,-7"}]},{name:"tab4",bounds:{left:0,right:9.2,top:-7,bottom:5.9},svgPaths:[{d:"M7.6,-7L7.6,1.15L9.2,1.15L9.2,3.35L7.6,3.35L7.6,5.9L5.15,5.9L5.15,3.35L0,3.35L0,1.2L5.45,-7L7.6,-7M5.15,1.15L5.15,-3.1L2.3,1.15L5.15,1.15"}]},{name:"tab5",bounds:{left:0,right:8.7,top:-7,bottom:6},svgPaths:[{d:"M3.05,-2.5L4.75,-2.9Q6.4,-2.9 7.55,-1.7Q8.7,-0.5 8.7,1.4Q8.7,3.05 7.8,4.3Q6.55,6 4.3,6Q2.5,6 1.35,5.05Q0.2,4.05 0,2.4L2.45,2.15Q2.55,3 3.1,3.5Q3.6,3.95 4.3,3.95Q5.05,3.95 5.6,3.35Q6.1,2.7 6.1,1.5Q6.1,0.3 5.6,-0.3Q5.05,-0.9 4.2,-0.9Q3.1,-0.9 2.3,0.05L0.3,-0.25L1.55,-7L8.15,-7L8.15,-4.7L3.4,-4.7L3.05,-2.5"}]},{name:"tab6",bounds:{left:0,right:8.6,top:-7,bottom:6.2},svgPaths:[{d:"M3.25,-0.05Q2.75,0.5 2.75,1.6Q2.75,2.85 3.3,3.5Q3.9,4.15 4.6,4.15Q5.3,4.15 5.8,3.65Q6.25,3.1 6.25,1.85Q6.25,0.6 5.75,0Q5.25,-0.6 4.5,-0.6Q3.75,-0.6 3.25,-0.05M2.55,-1.35Q3.45,-2.45 4.85,-2.45Q6.4,-2.45 7.5,-1.25Q8.6,-0.05 8.6,1.8Q8.6,3.8 7.45,5Q6.3,6.2 4.5,6.2Q2.55,6.2 1.25,4.7Q0,3.15 0,-0.3Q0,-3.85 1.3,-5.45Q2.6,-7 4.7,-7Q6.2,-7 7.15,-6.2Q8.05,-5.35 8.3,-3.8L6,-3.55L5.5,-4.65L4.55,-4.95Q3.75,-4.95 3.2,-4.25Q2.7,-3.55 2.55,-1.35"}]},{name:"tab7",bounds:{left:0,right:8.4,top:-7,bottom:5.8},svgPaths:[{d:"M8.4,-7L8.4,-5.15Q7.35,-4.15 6.25,-2.2Q5.2,-0.25 4.65,1.9Q4.05,4.1 4.1,5.8L1.7,5.8Q1.75,3.1 2.8,0.3Q3.85,-2.45 5.6,-4.7L0,-4.7L0,-7L8.4,-7"}]},{name:"tab8",bounds:{left:0,right:8.4,top:-7,bottom:6.2},svgPaths:[{d:"M2.6,-3.5Q2.6,-2.75 3.05,-2.35Q3.45,-1.95 4.15,-1.95Q4.85,-1.95 5.3,-2.35Q5.7,-2.8 5.7,-3.5Q5.7,-4.2 5.3,-4.65Q4.85,-5.05 4.15,-5.05Q3.45,-5.05 3.05,-4.6Q2.6,-4.2 2.6,-3.5M0.75,-2.15Q0.3,-2.85 0.3,-3.7Q0.3,-5.15 1.3,-6.05Q2.3,-7 4.15,-7Q6,-7 7,-6.05Q7.95,-5.15 7.95,-3.7Q7.95,-2.8 7.55,-2.1Q7.1,-1.4 6.25,-1Q7.3,-0.6 7.9,0.25Q8.4,1.1 8.4,2.15Q8.4,3.95 7.3,5.1Q6.15,6.2 4.3,6.2Q2.55,6.2 1.35,5.3Q0,4.2 0,2.25Q0,1.2 0.5,0.35Q1.05,-0.55 2.15,-1Q1.2,-1.45 0.75,-2.15M6,2.05Q6,1.15 5.5,0.6Q5,0 4.2,0Q3.35,0 2.9,0.65Q2.45,1.3 2.45,2.05Q2.45,3.1 2.95,3.65Q3.5,4.25 4.25,4.25Q5,4.25 5.5,3.7Q6,3.15 6,2.05"}]},{name:"tab9",bounds:{left:0,right:8.6,top:-7,bottom:6.2},svgPaths:[{d:"M1.15,-5.8Q2.35,-7 4.15,-7Q6.1,-7 7.35,-5.5Q8.6,-3.95 8.6,-0.5Q8.6,3.05 7.3,4.65Q6,6.2 3.9,6.2Q2.4,6.2 1.5,5.4Q0.55,4.6 0.3,3L2.7,2.75Q2.75,3.5 3.15,3.85Q3.5,4.15 4.1,4.15Q4.85,4.15 5.4,3.45Q5.9,2.75 6.05,0.55Q5.15,1.65 3.75,1.65Q2.2,1.65 1.1,0.45Q0,-0.7 0,-2.6Q0,-4.6 1.15,-5.8M4.2,-0.2Q4.9,-0.2 5.35,-0.75Q5.85,-1.3 5.85,-2.45Q5.85,-3.65 5.3,-4.3Q4.75,-4.95 4.05,-4.95Q3.35,-4.95 2.9,-4.4Q2.45,-3.9 2.45,-2.65Q2.45,-1.35 2.95,-0.8Q3.45,-0.2 4.2,-0.2"}]},{name:"halfBendAlteration",bounds:{left:0,right:17.15,top:-5,bottom:5},svgPaths:[{d:"M2.7,-4.95L4.25,-4.95L4.25,4.85L2.4,4.85L2.4,-2.25Q1.35,-1.25 0,-0.8L0,-2.5L1.6,-3.4Q2.45,-4.1 2.7,-4.95M10.75,-2.1Q10.9,-3.65 11.8,-4.35Q12.65,-4.95 14,-4.95Q15.5,-4.95 16.3,-4.2Q17.15,-3.4 17.15,-2.25L16.9,-1L16.1,0.25L14.85,1.5L13.75,2.55L13.35,3.1L17.15,3.1L17.15,4.85L10.55,4.85Q10.7,3.85 11.2,2.95Q11.7,2.05 13.3,0.6L14.85,-1Q15.25,-1.55 15.25,-2.1L14.95,-3.1L13.95,-3.4L13,-3.1Q12.65,-2.75 12.6,-1.95L10.75,-2.1M10.2,-5L7.85,5L6.4,5L8.7,-5L10.2,-5"}]},{name:"fullBendAlteration",bounds:{left:0,right:19.25,top:-5,bottom:5.05},svgPaths:[{d:"M4.65,-4.8L4.4,-3.5L3.55,-3.6L3,-3.45Q2.75,-3.2 2.75,-2.7L2.75,-2.25L4.2,-2.25L4.2,-0.75L2.75,-0.75L2.75,4.9L0.95,4.9L0.95,-0.75L0,-0.75L0,-2.25L0.95,-2.25L0.95,-2.75L1.15,-4.05Q1.3,-4.5 1.8,-4.8L3.1,-5L4.65,-4.8M7.15,-2.25L7.15,1.05L7.2,2.9L7.6,3.4L8.25,3.65L9.1,3.35L9.6,2.7Q9.8,2.3 9.8,0.75L9.8,-2.25L11.6,-2.25L11.6,4.9L9.85,4.9L9.85,3.8L8.9,4.75L7.6,5.05L6.35,4.75Q5.75,4.45 5.5,3.9Q5.25,3.3 5.25,2.3L5.25,-2.25L7.15,-2.25M15.45,-4.85L15.45,4.9L13.6,4.9L13.6,-4.85L15.45,-4.85M19.25,-4.85L19.25,4.9L17.4,4.9L17.4,-4.85L19.25,-4.85"}]},{name:"pullOff",bounds:{left:-4.5,right:5.4,top:-6,bottom:6.95},svgPaths:[{d:"M5.4,-2Q5.4,-0.8 4.95,0Q4.55,0.85 3.85,1.3L2.5,1.9L-0.2,2.1L-1.9,2.1L-1.9,6.95L-4.5,6.95L-4.5,-6L-0.3,-6L2.8,-5.8Q3.9,-5.5 4.65,-4.5Q5.4,-3.55 5.4,-2M2.75,-1.95L2.3,-3.15Q1.9,-3.6 1.25,-3.7L-0.65,-3.8L-1.9,-3.8L-1.9,-0.1L-0.45,-0.1L1.6,-0.3Q2.15,-0.5 2.45,-0.95L2.75,-1.95"}]},{name:"hammerOn",bounds:{left:-5,right:5.3,top:-6,bottom:6.95},svgPaths:[{d:"M2.7,-6L5.3,-6L5.3,6.95L2.7,6.95L2.7,1.25L-2.4,1.25L-2.4,6.95L-5,6.95L-5,-6L-2.4,-6L-2.4,-0.9L2.7,-0.9L2.7,-6"}]},{name:"octaveUp",bounds:{left:0,right:25.25,top:0,bottom:14.35},svgPaths:[{d:"M23.3,5.65L21.5,8.05Q20.25,9.4 18.9,9.5Q17.7,9.25 17.7,8.05Q17.8,6.35 19.4,4.9Q20.95,3.4 22.85,3.3Q23.55,3.25 23.95,3.75L24,3.7Q24,3 24.6,3.1L25.1,3.3L23.55,8.2Q23.45,8.55 23.65,8.55L24.4,8.15Q24.85,7.45 25.2,7.3L25.25,7.4L24.3,8.65Q23.45,9.45 22.7,9.5Q22.3,9.45 22.3,9L22.5,8.35L23.35,5.7L23.3,5.65M22.85,3.55Q21.35,3.7 20.2,5.2Q18.95,6.7 18.9,7.95Q18.85,8.6 19.55,8.75Q20.2,8.65 21,7.95L22.2,6.8L23.1,5.55L23.75,4.25Q23.65,3.55 22.85,3.55M16.85,4.45L16.6,3.8Q16.65,3.25 17.05,3.15Q17.75,3.45 17.7,4.2Q17.6,5.85 16.15,7.65Q14.7,9.5 12.8,9.65Q11.4,9.7 11.35,8.45L11.45,7.95L13.1,4.45Q13.3,4.1 12.95,4.05Q12.65,4.1 12.15,4.5L11.5,5.15L11.25,5.15Q11.3,4.7 12.2,4Q13.1,3.35 13.75,3.25Q14.3,3.3 14.25,3.8L14.1,4.45L12.65,7.8L12.55,8.7Q12.6,9.15 13.25,9.2Q14.6,9.1 15.8,7.65Q16.95,6.25 17.05,5.05L16.85,4.45M8.75,0.8Q10.2,1.6 10.3,3.3Q9.95,5.35 7.5,6L6.7,6.3L6.7,6.35Q8.2,6.65 9.4,7.6Q10.6,8.5 10.65,10.05Q10.55,12.15 8.9,13.25Q7.25,14.35 5.1,14.35Q3.25,14.35 1.7,13.35Q0.1,12.35 0,10.6Q0.05,9.2 1.05,8.5Q2,7.8 3.2,7.4L3.95,7.1Q0.85,6.35 0.55,3.65Q0.65,1.9 2.2,0.95Q3.75,0 5.6,0Q7.3,0 8.75,0.8M5.35,0.4Q4,0.45 3.05,1.15Q2.1,1.8 2.05,3Q2.15,4.35 3.4,5.2Q4.65,6.05 6.05,6.05Q6.9,6.05 7.8,5.25Q8.7,4.5 8.75,3.3Q8.5,0.55 5.35,0.4M2.95,8.2Q1.85,9.1 1.7,10.8Q1.95,13.8 5.25,13.9Q8.65,13.8 8.95,10.75Q8.8,9.05 7.3,8.2Q5.8,7.3 4.7,7.3Q4.05,7.3 2.95,8.2"}]},{name:"octaveDown",bounds:{left:0,right:24.75,top:-14.6,bottom:0},svgPaths:[{d:"M22.9,-10.6Q21.6,-10.45 20.2,-8.75Q18.85,-7.05 18.75,-5.9Q18.85,-5.05 19.8,-5.05Q21.4,-5.15 22.55,-6.6Q23.65,-8.05 23.75,-9.4Q23.8,-10.4 22.9,-10.6M24.75,-9.5Q24.65,-7.7 23.2,-6.3Q21.7,-4.9 19.7,-4.85Q17.85,-4.85 17.7,-6.45Q17.75,-7.3 18.1,-8.05L19.7,-12.8L19.9,-13.5Q19.9,-13.8 19.45,-13.75Q19.1,-13.7 18.95,-13.95Q19.05,-14.25 19.45,-14.2Q20.25,-14.15 20.9,-14.55L21.1,-14.6L21.25,-14.45L19.15,-8.25L19.2,-8.15L20.9,-10.2Q22,-11.3 23.15,-11.4Q24,-11.35 24.35,-10.75Q24.75,-10.2 24.75,-9.5M16.85,-10.05Q16.6,-10.25 16.6,-10.7Q16.65,-11.25 17.05,-11.35Q17.75,-11.05 17.7,-10.3Q17.6,-8.65 16.15,-6.85Q14.7,-5 12.8,-4.85Q11.4,-4.8 11.35,-6.05L11.45,-6.55L13.1,-10.05Q13.3,-10.4 12.95,-10.45Q12.65,-10.45 12.15,-10L11.5,-9.35L11.25,-9.35Q11.3,-9.8 12.2,-10.5Q13.1,-11.15 13.75,-11.25Q14.3,-11.2 14.25,-10.7L14.1,-10.1L12.65,-6.7L12.55,-5.8Q12.6,-5.35 13.25,-5.3Q14.6,-5.45 15.8,-6.85Q16.95,-8.3 17.05,-9.45L16.85,-10.05M8.75,-11.15Q8.5,-13.95 5.35,-14.1Q4.05,-14.05 3.1,-13.4Q2.1,-12.7 2.05,-11.5Q2.15,-10.05 3.4,-9.2Q4.65,-8.3 6.05,-8.3Q6.9,-8.3 7.8,-9.1Q8.7,-9.85 8.75,-11.15M8.75,-13.7Q10.2,-12.9 10.3,-11.15Q10.25,-10 9.4,-9.35L7.45,-8.35L6.8,-7.95Q8.35,-7.65 9.55,-6.7Q10.75,-5.8 10.8,-4.2Q10.7,-2.15 9,-1.05Q7.35,0 5.2,0Q3.35,0 1.7,-1Q0.1,-1.95 0,-3.75Q0.05,-5.15 1.05,-5.85L3.35,-7L4,-7.15L4,-7.2Q2.6,-7.6 1.6,-8.45Q0.55,-9.3 0.5,-10.75Q0.65,-12.55 2.2,-13.55Q3.8,-14.5 5.65,-14.5Q7.3,-14.55 8.75,-13.7M1.7,-3.55Q2.05,-0.55 5.35,-0.45Q8.8,-0.55 9.1,-3.55Q8.95,-5.3 7.45,-6.15Q5.9,-7.05 4.8,-7.05L3,-6.1Q1.85,-5.2 1.7,-3.55"}]},{name:"trill",bounds:{left:0,right:20.7,top:-6,bottom:9.4},svgPaths:[{d:"M9.1,-6L9.95,-6L8.2,-1.25L11.1,-1.5L14.25,-1.85Q15.25,-1.8 15.2,-1L14.9,0.45L15,0.45Q16.3,-1.5 18.7,-1.8Q20.5,-1.7 20.7,-0.05Q20.75,1.6 19.2,1.7Q18.1,1.65 18,0.5L18.15,-0.2L18.2,-0.4L17.8,-0.75Q16.5,-0.55 15.5,1.05Q14.5,2.65 14.2,3.6L12.25,8.75L9.4,8.75L9.9,7.4L9.8,7.4Q6.9,9.3 5.75,9.4Q4.25,9.45 3.15,8.8Q2,8.1 2.15,6.6L4.7,0.05L0,0.05L0.55,-1.35L5.2,-1.35L6.2,-4.15L9.1,-6M12,-0.65L7.75,0.05L5.4,6.6Q5.2,7.6 6.1,7.65Q7.1,7.75 10.05,5.9L12.3,-0.05Q12.5,-0.65 12,-0.65"}]},{name:"graceUp",bounds:{left:-4.45,right:9.6,top:0,bottom:20.85},svgPaths:[{d:"M9.6,11.7L-4.45,20.85L-4.45,18.4L9.6,9.2L9.6,11.7"}]},{name:"graceDown",bounds:{left:-2.75,right:10.7,top:-18.45,bottom:0},svgPaths:[{d:"M10.7,-9.85L-2.75,-18.45L-2.75,-16.55L10.7,-8L10.7,-9.85"}]},{name:"tap",bounds:{left:-5,right:5.2,top:0,bottom:12.95},svgPaths:[{d:"M5.2,2.2L1.4,2.2L1.4,12.95L-1.2,12.95L-1.2,2.2L-5,2.2L-5,0L5.2,0L5.2,2.2"}]},{name:"tremolo3",bounds:{left:-6,right:6.05,top:-9.5,bottom:9.65},svgPaths:[{d:"M6.05,-6.4L-6,-0.35L-6,-3.45L6.05,-9.5L6.05,-6.4M6.05,-1.4L-6,4.65L-6,1.55L6.05,-4.5L6.05,-1.4M-6,6.55L6.05,0.5L6.05,3.6L-6,9.65L-6,6.55"}]},{name:"tremolo1",bounds:{left:-6,right:6.05,top:-4.5,bottom:4.65},svgPaths:[{d:"M6.05,-1.4L-6,4.65L-6,1.55L6.05,-4.5L6.05,-1.4"}]},{name:"tremolo2",bounds:{left:-6,right:6.05,top:-7.05,bottom:7.1},svgPaths:[{d:"M6.05,-3.95L-6,2.1L-6,-1L6.05,-7.05L6.05,-3.95M-6,4L6.05,-2.05L6.05,1.05L-6,7.1L-6,4"}]},{name:"quarterBendAlteration",bounds:{left:0,right:17.2,top:-5,bottom:5},svgPaths:[{d:"M0,-0.85L0,-2.5Q0.75,-2.75 1.55,-3.4Q2.45,-4.1 2.75,-4.95L4.25,-4.95L4.25,4.85L2.4,4.85L2.4,-2.25Q1.4,-1.25 0,-0.85M10.2,-5L7.95,5L6.45,5L8.7,-5L10.2,-5M16,-4.9L16,1.25L17.2,1.25L17.2,2.9L16,2.9L16,4.85L14.1,4.85L14.1,2.9L10.2,2.9L10.2,1.25L14.35,-4.9L16,-4.9M14.1,1.25L14.1,-2L11.95,1.25L14.1,1.25"}]},{name:"repeatMeasure",bounds:{left:0,right:26.8,top:-20.45,bottom:0},svgPaths:[{d:"M26.8,-20.45L7.8,0L0,0L19,-20.45L26.8,-20.45M2.75,-15.45Q3,-17.6 5.35,-17.8Q7.65,-17.6 7.9,-15.45Q7.65,-13.35 5.35,-13.15Q3,-13.35 2.75,-15.45M21.5,-2.5Q19.15,-2.75 18.95,-4.85Q19.15,-6.95 21.5,-7.15Q23.8,-6.95 24.05,-4.85Q23.8,-2.75 21.5,-2.5"}]},{name:"breath",bounds:{left:-4,right:4.1,top:0,bottom:11.95},svgPaths:[{d:"M1.95,9.35Q0.1,11.35 -2.5,11.95L-2.6,11.3Q-0.9,10.75 0.1,9.35Q1.05,8 0.7,6.35Q0.55,5.45 -0.45,5.45L-1.4,5.45Q-2.6,5.2 -3.3,4.45Q-3.95,3.65 -4,2.8Q-3.9,1.3 -2.65,0.65Q-1.4,0 0,0Q2,0.05 3.05,1.4Q4.05,2.75 4.1,4.5Q3.75,7.35 1.95,9.35"}]},{name:"caesura",bounds:{left:-11.25,right:11.25,top:0,bottom:20.35},svgPaths:[{d:"M3.5,0L-9.05,20.35L-11.25,20.35L1.3,0L3.5,0M-3.5,20.35L9.05,0L11.25,0L-1.3,20.35L-3.5,20.35"}]},{name:"commonTime",bounds:{left:0,right:18.55,top:-10,bottom:10.45},svgPaths:[{d:"M5.65,-0.4L5.7,2.85Q5.75,4.7 6.45,6.3Q7.25,8.6 10.65,9.05Q13.7,9.05 15.35,7Q17.05,4.85 17.4,2.35L18.55,2.35Q18.25,5.9 16,8.15Q13.7,10.4 9.8,10.45Q7.65,10.4 5.6,9.4Q3.55,8.35 2.3,6.8Q-0.15,3.75 0,-0.1Q0,-4.35 3.55,-7.35Q4.85,-8.5 6.65,-9.25L10.3,-10Q13,-10 15.45,-8.65Q17.9,-7.3 18.4,-4.7Q18.65,-3.3 17.75,-1.9Q16.85,-0.5 14.8,-0.4Q13.4,-0.4 12.3,-1.15Q11.25,-1.9 11.15,-3.3Q11.45,-5.65 14,-6.4Q14.75,-6.45 15.2,-6.85Q15.2,-7.35 14.8,-7.65Q13.55,-8.55 11.95,-8.65Q10.25,-8.75 9,-8.15Q7.75,-7.55 7.1,-6.75Q5.35,-3.95 5.65,-0.4"}]},{name:"cutTime",bounds:{left:0,right:18.55,top:-17,bottom:17.05},svgPaths:[{d:"M9.65,-17L9.65,-10.2Q12.8,-10.2 15.35,-8.85Q17.95,-7.5 18.4,-4.9Q18.65,-3.55 17.75,-2.15Q16.85,-0.75 14.8,-0.65Q13.4,-0.65 12.3,-1.4Q11.25,-2.15 11.15,-3.55Q11.45,-5.85 14,-6.65Q14.75,-6.65 15.2,-7.05Q15.25,-7.85 13.95,-8.3L11.95,-8.85L9.65,-8.6L9.65,8.6Q12.2,9.5 14.4,7.55Q16.6,5.6 17.4,2.1L18.55,2.1Q18.25,5.6 15.95,7.9Q13.65,10.15 9.65,10.25L9.65,17.05L8.25,17.05L8.25,10.05Q4.15,9.25 2.05,6.25Q0,3.3 0,-0.35Q0.1,-3.85 2.35,-6.45Q4.6,-9.1 8.25,-9.9L8.25,-17L9.65,-17M5.65,-2.5L5.65,2.8Q5.65,4 6.15,5.6Q6.7,7.15 8.25,8.15L8.25,-8Q5.65,-6.4 5.65,-2.5"}]},{name:"turn",bounds:{left:-13,right:14.3,top:0,bottom:10.6},svgPaths:[{d:"M14.3,5.4Q14.35,7.6 12.55,9.05Q10.75,10.55 8.35,10.6Q4.05,10.35 0.75,7.7L-4.15,4.4Q-6.05,2.95 -8.3,2.8Q-9.95,3.05 -10.65,3.95Q-11.35,4.85 -11.3,5.85Q-11.3,6.8 -10.75,7.45Q-10.2,8.15 -9.1,8.15Q-8.35,8.05 -7.75,7.55Q-7.15,7.05 -6.05,7Q-4.6,7 -4.05,8.15Q-3.95,9.5 -5.15,10.05L-7.5,10.6Q-10.15,10.4 -11.55,8.75Q-13,7.05 -13,4.75Q-12.75,2.6 -11.1,1.4Q-9.5,0.25 -7.1,0Q-2.75,0.2 0.65,2.9L5.45,6.3L7.35,7.35L9.55,7.8Q11.5,7.55 12.2,6.4Q12.9,5.25 12.65,4.15Q12.3,2.5 10.55,2.45Q9.8,2.55 9.15,3.05L7.35,3.6Q5.65,3.5 5.45,2Q5.55,0.9 6.7,0.45L8.85,0Q11.35,0.1 12.75,1.65Q14.15,3.25 14.3,5.4"}]},{name:"mordent",bounds:{left:-13,right:13.8,top:-1.975,bottom:7.874},svgPaths:[{d:"M4.85,-1.774L9.45,2.045Q10.05,2.698 10.75,2.196L13.8,-1.021L13.8,1.291L8.05,7.523Q7.45,8.176 6.75,7.673L2.15,3.854Q1.55,3.201 0.85,3.703L-2.75,7.523Q-3.35,8.176 -4,7.673L-8.65,3.854Q-9.25,3.151 -9.95,3.703L-13,6.92L-13,4.558L-7.25,-1.573Q-6.65,-2.277 -5.95,-1.774L-1.3,2.045Q-0.75,2.698 -0.05,2.196L3.55,-1.573Q4.15,-2.277 4.85,-1.774"}]},{name:"invertedMordent",bounds:{left:-13,right:12.8,top:0,bottom:16.4},svgPaths:[{d:"M12.8,7.1L8,12.5Q7.45,13.15 6.7,12.65L2.1,8.85Q1.5,8.15 0.8,8.7L0.5,9L0.5,16.4L-0.85,16.4L-0.85,10.4L-2.8,12.5Q-3.35,13.15 -4.05,12.65L-8.7,8.85Q-9.3,8.15 -9.95,8.7L-13,11.9L-13,9.55L-7.25,3.4Q-6.55,2.9 -5.95,3.55L-0.85,7.75L-0.85,0.25L0.5,0.25L0.5,6.7L3.55,3.4Q4.2,2.9 4.8,3.55L9.5,7.3Q10.25,7.85 10.75,7.2L12.8,4.95L12.8,7.1"}]},{name:"pedalDown",bounds:{left:0,right:34.9,top:0,bottom:18.4},svgPaths:[{d:"M22.95,4.75Q20.65,3.65 18.15,3.15L18.25,2.4Q23,3 27.2,5.6Q31.35,8.2 31.45,13Q31.4,14.8 30.1,16.45Q28.8,18.1 26.65,18.25Q23.95,17.95 23.2,15.4L19.25,18.2Q18.35,18.7 17.6,17.95L16.6,16.65L16.05,15.4L12.3,18.25Q11.55,18 11.4,16.9Q10.7,15.15 9.05,14.25L7.05,16.5Q5.55,18.05 4.4,18.25Q3.8,18.35 3.65,17.65Q3.75,16.4 5.25,15.35Q6.75,14.3 7.85,13.75Q9.55,12.8 9.65,11.1L9.2,9.85L7,7.05Q6.6,6.6 6.6,6L7.65,4.05Q8.6,2.65 9.1,0.75Q6.8,0.85 4.45,2Q2.05,3.2 1.9,5.55Q1.9,7.25 3.65,7Q4.95,6.3 5,4.75L5.85,4.8Q6.1,6.7 5.2,8.05Q4.35,9.45 2.85,9.5Q1.35,9.45 0.6,8.5Q-0.15,7.55 0,6.2Q0.2,3.6 3.05,1.8Q5.85,0 9.65,0Q12.25,0.05 14.45,1.45Q16.65,2.8 16.85,5.25Q16.8,7.1 14.75,7.45Q13.25,7.4 12.3,6.4Q11.35,5.35 10.9,4.15L11.7,3.85Q12,4.5 12.65,5L14.1,5.15Q14.95,4.7 14.8,3.9Q14.45,2.45 13.1,1.7Q11.7,0.95 10.2,0.7L8.75,3.8Q8.55,4.8 9.15,5.5L11.35,8.35Q11.8,8.75 11.85,9.5Q11.75,10.45 10.95,11.55L9.5,13.55Q11.3,13.8 12.25,14.35L14.35,15.4L15.8,14.5Q15.55,12.55 16.45,10.5Q17.35,8.45 19.7,8.1Q21.5,8.3 21.65,10Q21.35,11.4 20.2,12.35Q19.1,13.35 17.85,14.05L18.55,15.45Q19.05,16.1 19.9,16.25Q21.75,15.95 22.95,14.6Q22.4,10.1 26.8,8.1Q25.25,5.85 22.95,4.75M25.3,11.2Q24.95,12.55 24.95,13.45Q24.85,14.8 25.55,16Q26.25,17.2 27.25,17.05Q28.75,16.65 28.7,13.75Q28.6,10.7 27.25,8.9Q25.65,9.85 25.3,11.2M34.9,16.75Q34.75,18.1 33.25,18.25Q31.8,18.1 31.65,16.75Q31.8,15.4 33.25,15.3Q34.75,15.4 34.9,16.75M17.6,11Q17.4,12.35 17.75,13.3Q20.35,11.55 20.1,10.5Q19.9,9.5 19.15,9.5Q17.8,9.65 17.6,11"}]},{name:"pedalUp",bounds:{left:0,right:16,top:0,bottom:18.4},svgPaths:[{d:"M10.65,7.65Q10.85,6.15 12.5,6.05Q14.1,6.25 14.25,7.75Q14.15,8.95 12.95,9.3L11.4,9.35Q10.25,9.65 10.45,10.7Q10.95,11.15 11.7,11.1Q12.4,10.9 12.95,10.3Q13.45,9.7 14.4,9.75Q15.95,10 16,11.4Q15.95,12.95 14.4,13.15Q13.45,13.2 12.95,12.6Q12.4,12 11.7,11.8Q10.95,11.8 10.45,12.15Q10.25,13.2 11.4,13.55L12.95,13.55Q14.15,13.95 14.25,15.15Q14.1,16.6 12.5,16.85Q10.85,16.7 10.65,15.3L10.55,14.1Q10.35,13.45 9.55,13.4Q8.1,13.4 8.3,14.6Q8.45,15.2 8.95,15.55Q9.45,15.9 9.6,16.65Q9.85,18.4 7.75,18.4Q5.9,18.4 6.15,16.65Q6.35,15.9 6.85,15.55Q7.4,15.15 7.55,14.55Q7.7,13.75 6.85,13.3Q5.65,13.2 5.45,14.05Q5.25,14.9 5.35,15.25Q5.2,16.7 3.55,16.85Q1.85,16.6 1.7,15.15Q1.8,13.95 3.15,13.55L4.6,13.5Q5.75,13.2 5.55,12.25Q5.1,11.8 4.3,11.8Q3.6,12 3.05,12.6Q2.55,13.2 1.65,13.1Q0.1,12.95 0,11.4Q0.1,10 1.65,9.75Q2.55,9.7 3.05,10.3Q3.6,10.9 4.3,11.1Q5.1,11.15 5.55,10.7Q5.75,9.65 4.6,9.35L3.15,9.25Q1.8,8.95 1.7,7.75Q1.85,6.25 3.55,6.05Q5.2,6.15 5.35,7.65Q5.25,7.95 5.45,8.8Q5.65,9.7 6.8,9.5Q7.7,9.1 7.55,8.3L6.8,7.4Q6.25,7.05 6.05,6.3Q5.85,4.5 7.9,4.4Q9.95,4.5 9.75,6.3Q9.55,7.05 9,7.4Q8.45,7.75 8.25,8.3Q8.15,9.1 9,9.5Q10.35,9.7 10.55,8.85L10.65,7.65M7.85,10.25Q6.8,10.35 6.7,11.4Q6.7,12.5 7.85,12.6Q9.1,12.6 9.3,11.4Q9.15,10.35 7.85,10.25"}]},{name:"tenorVoiceClef",bounds:{left:0,right:24.5,top:-43,bottom:37.9},svgPaths:[{d:"M16.8,-41.3Q17.85,-39.35 18.65,-36.5Q19.45,-33.75 19.55,-31.35Q19.3,-22.85 12.95,-16.4L14.25,-9.7L15.8,-9.85Q19.7,-9.75 22.1,-6.9Q24.45,-4.05 24.5,-0.1Q24.45,3.15 22.7,5.45Q20.95,7.8 18.05,9.2L19.7,17.3L19.8,19.15Q19.65,23.4 16.6,25.2L15.55,25.7L15.35,25.8L16.15,26.2L16.35,26.35Q17.6,27.35 17.55,28.9Q17.4,29.95 16.65,30.6L14.95,31.65Q16.15,33.05 16.3,34.45Q16.25,36.35 14.75,37.1Q13.25,37.9 11.6,37.9Q10.15,37.9 8.7,37.05Q7.25,36.2 7.15,34.5Q7.25,33.2 8.35,32.35Q9.45,31.55 10.6,31.15Q9.55,29.95 9.5,28.45Q9.65,27 10.8,26.25L9.25,25.7L8.1,25.05Q5.85,23.5 5.45,20.8Q5.35,18.9 6.35,17.4Q7.4,15.95 9.2,15.65Q10.8,15.5 12,16.65Q13.2,17.75 13.3,19.45Q13.25,21.75 11.75,22.6Q10.25,23.5 9.2,23.25Q9.4,24.25 10.65,24.7L12.85,25Q18.35,24.15 18.45,19.05Q18.5,17.7 18.15,16.15L16.75,9.75L13.15,10.3Q7.85,10.15 4.2,6.4Q0.55,2.65 0,-3.15Q-0.2,-8.95 3.25,-13.5Q6.7,-18 10.6,-21.7Q9.45,-26.05 9.4,-30.55Q9.4,-33.6 10.75,-37.6Q12.1,-41.65 14.9,-43Q15.75,-43.2 16.8,-41.3M17.25,-36.3Q16.7,-37.05 15.65,-37.1Q13.2,-36.35 12.15,-33.25Q11.1,-30.2 11.05,-27.75Q11.1,-25.2 11.75,-22.8Q14.2,-24.85 16.05,-27.95Q17.85,-31.1 17.8,-34.55Q17.8,-35.55 17.25,-36.3M2.95,-0.95Q3.1,3.8 6.25,6.4Q9.45,9.05 13.95,8.9L16.55,8.4L13.95,-4.9Q12.2,-4.35 11.05,-2.85Q9.85,-1.35 9.85,0.55Q10.1,3.7 12.95,4.9L13.25,5.3L12.7,5.7Q10.4,4.85 8.95,2.9Q7.5,0.9 7.5,-1.65Q7.6,-4.2 9.2,-6.35Q10.8,-8.45 13.1,-9.35L11.9,-15.4Q8.55,-12.6 5.85,-9.05Q3.15,-5.55 2.95,-0.95M15.15,-5.05L17.8,8Q21.7,5.85 21.75,1.3Q21.5,-1.55 19.7,-3.25Q17.9,-5 15.15,-5.05M15.45,27Q14.95,26.35 14.15,26.2L14,26.2L13.9,26.2L12.95,26.35L12.85,26.35Q12.15,26.7 11.9,27.6Q12,28.8 12.85,29.65L14.4,31.2Q15.7,30.35 16,28.75Q16.1,27.8 15.45,27M11,31.65Q9,32.6 8.85,34.75Q8.9,35.85 9.75,36.45Q10.65,37.05 11.6,37.1Q12.5,37.1 13.2,36.7Q13.95,36.25 13.8,35.45Q13.55,34.3 12.65,33.35L11,31.65"}]},{name:"coda",bounds:{left:0,right:26.8,top:0,bottom:28.5},svgPaths:[{d:"M14.2,4.95L14.2,13.6L18.3,13.6Q18.45,11.65 17.8,8.4Q17.4,7.1 16.5,6.05Q15.6,4.95 14.2,4.95M22.5,10.35Q23.2,12.15 23.3,13.6L26.8,13.6L26.8,15.35L23.3,15.35Q23.2,16.65 22.5,18.45Q21.85,20.25 20.95,21.45Q19.15,24.15 14.2,25.3L14.2,28.5L12.15,28.5L12.15,25.3Q7.5,24.15 5.7,21.45Q4.7,20.25 4.1,18.45Q3.4,16.65 3.35,15.35L0,15.35L0,13.6L3.35,13.6Q3.4,12.15 4.1,10.35Q4.7,8.45 5.7,7.3Q7.5,4.5 12.15,3.3L12.15,0.15L14.2,0.15L14.2,3.3Q19.15,4.5 20.95,7.3Q21.85,8.45 22.5,10.35M8.8,8.4Q8.2,11.65 8.25,13.6L12.15,13.6L12.15,4.95Q10.8,4.95 10,6.05Q9.1,7.1 8.8,8.4M8.25,15.35Q8.2,17.15 8.8,20.3Q9.1,21.65 10,22.7Q10.8,23.7 12.15,23.7L12.15,15.35L8.25,15.35M14.2,15.35L14.2,23.7Q15.6,23.7 16.5,22.7Q17.4,21.65 17.8,20.3Q18.45,17.15 18.3,15.35L14.2,15.35"}]},{name:"segno",bounds:{left:0,right:22.7,top:0,bottom:27.2},svgPaths:[{d:"M22.7,10.1Q22.5,11.9 20.45,12Q18.4,11.9 18.25,10.1Q18.4,8.3 20.45,8.15Q22.5,8.3 22.7,10.1M18.9,0.3L21.4,0.3L12.85,12Q15.7,13.4 18.25,15.4Q20.8,17.45 20.95,20.65Q20.9,23.1 19.1,25.1Q17.35,27.1 14.65,27.2Q12.8,27.2 11.25,26.35Q9.75,25.45 9.35,23.75Q9.3,22.75 10,21.95Q10.7,21.2 11.8,21.25Q13.6,21.1 14.15,23.3Q14.4,24.45 14.9,24.75L16,25Q17.95,24.8 18.25,22.25Q18,19.85 15.2,18.4Q12.45,16.95 10.15,15.95L2.45,26.9L0,26.9L8.3,15.2Q5.45,13.8 2.9,11.75Q0.35,9.75 0.2,6.5Q0.25,4.1 2.05,2.1Q3.85,0.15 6.55,0Q8.35,0 9.9,0.85Q11.45,1.75 11.8,3.45Q11.9,4.5 11.15,5.25Q10.45,6 9.35,5.95Q7.5,6.15 6.95,3.9Q6.75,2.75 6.25,2.45L5.2,2.2Q3.2,2.4 2.9,4.95Q3.15,7.4 5.9,8.8L11,11.25L18.9,0.3M2.4,15.2Q4.45,15.35 4.65,17.1Q4.45,18.9 2.4,19.05Q0.35,18.9 0.2,17.1Q0.35,15.35 2.4,15.2"}]},{name:"arpeggio",bounds:{left:0,right:5.25,top:-10.05,bottom:0},svgPaths:[{d:"M2.95,-10L4.35,-8.5Q5.05,-7.65 5.25,-6.7Q5.05,-5.25 3.6,-4.15Q2.3,-3.2 2.05,-1.85Q2.15,-1.05 2.95,0L2.25,0L0.9,-1.5Q0.2,-2.35 0,-3.3Q0.2,-4.8 1.65,-5.8Q2.95,-6.8 3.2,-8.1Q3,-9.25 2.25,-10L2.95,-10"}]},{name:"arpeggioUp",bounds:{left:-2.65,right:7.95,top:-16.55,bottom:0},svgPaths:[{d:"M1.6,-5.75L-2.65,-3.6L2.55,-16.55L7.95,-3.6L4.7,-5.25L3.6,-4.15Q2.3,-3.2 2.05,-1.85Q2.15,-1.05 2.95,0L2.25,0L0.9,-1.5Q0.2,-2.35 0,-3.3Q0.2,-4.75 1.6,-5.75"}]},{name:"arpeggioDown",bounds:{left:-2.65,right:7.95,top:-10.05,bottom:6.65},svgPaths:[{d:"M2.25,-10L2.95,-10L4.35,-8.5Q5.05,-7.65 5.25,-6.7Q5.05,-5.25 3.6,-4.15L3.35,-3.95L7.95,-6.3L2.55,6.65L-2.65,-6.3L0.55,-4.65L1.65,-5.8Q2.95,-6.8 3.2,-8.1Q3,-9.25 2.25,-10"}]},{name:"twoOctavesUp",bounds:{left:0,right:32.2,top:-14.1,bottom:.05},svgPaths:[{d:"M16.25,-13.95L16.3,-13.85L16.25,-12.9L16.25,-12.2L16.15,-12.15L12.15,-12.3L10.3,-12.25L10.25,-8.25L11.6,-9.05L12.95,-9.25L14.95,-8.75Q15.9,-8.3 16.35,-7.35Q16.85,-6.45 16.85,-5.35Q16.85,-3.65 15.7,-2.2Q14,0.05 11.05,0.05L9.95,-0.05Q9.5,-0.2 8.95,-0.45L8.6,-1.45L7.95,-3.05L8.45,-3.3L9.55,-1.55Q9.75,-1.35 10.45,-1.1L11.95,-0.8Q12.9,-0.8 13.65,-1.25Q14.4,-1.65 14.8,-2.5Q15.25,-3.3 15.25,-4.5Q15.25,-6.2 14.3,-7.05Q13.35,-7.85 12.1,-7.85L10.7,-7.55L9.6,-6.65L9.2,-6.75L9.35,-9.15L9.35,-10.05L9.35,-11.8L9.3,-13.35L9.3,-13.85L9.4,-13.95L12.75,-13.8L16.25,-13.95M2.95,-12.45L2.5,-12.3L0.25,-11.3L0.1,-11.35L0,-12.15L0.1,-12.25L2.3,-13.05L4.6,-14.1L4.85,-14L4.75,-8.85L4.75,-5.25L4.85,-1.95Q4.85,-1.3 5,-1.15Q5.15,-0.95 5.4,-0.85L7.1,-0.75L7.1,-0.2L4.05,-0.3L0.8,-0.2L0.8,-0.75L2.4,-0.9L2.75,-1.05L2.9,-1.35L3.05,-3.1L3.15,-5.3L3.15,-9.15L3.1,-12.1L3.05,-12.45L2.95,-12.45M19.8,-11.6L19.75,-11.2L19.4,-9.4L20.4,-10.6Q21.05,-11.3 21.8,-11.65L22.6,-11.9L22.85,-11.85L22.9,-11.6L22.85,-11L22.45,-9.4L23.75,-10.8Q24.4,-11.35 25.1,-11.7L25.9,-11.9L26.15,-11.85L26.2,-11.6L26.1,-11.05L25.6,-8.95L25.15,-6.9L25.2,-6.7L25.3,-6.65L25.5,-6.7L25.85,-6.85L26.35,-7.2L26.45,-6.95L25.65,-6.35L24.8,-5.85L24.5,-5.8L24.25,-5.95L24.15,-6.25L24.15,-6.6L24.3,-7.2L24.75,-8.9L25.1,-10.35L25.25,-10.85L25.2,-11L25.05,-11.05L24.5,-10.85L23.6,-10.25L22.8,-9.3L22.25,-8.15L21.65,-6L20.95,-5.8L20.9,-5.9L21.4,-8.15L21.85,-10.1L21.9,-10.8L21.85,-11L21.75,-11.05L21.35,-10.95L20.5,-10.3L19.7,-9.3Q19.35,-8.75 19.15,-8L18.7,-6L17.95,-5.85L17.85,-5.95L18.2,-7.2L18.5,-8.7L18.85,-10.25L18.9,-10.75L18.85,-11L18.7,-11.05L18.45,-11L17.75,-10.6L17.65,-10.85L18.45,-11.35Q18.9,-11.7 19.25,-11.85L19.55,-11.9L19.75,-11.85L19.8,-11.6M29.8,-11.85L30.55,-12L31.05,-11.95L31.7,-11.8L32.05,-12L32.2,-11.9L31.5,-9.3L31.2,-8.2L30.95,-7.1L30.95,-6.95L31,-6.75L31.1,-6.7L31.35,-6.8L32.05,-7.25L32.1,-7L31.25,-6.25L30.6,-5.85L30.4,-5.8L30.25,-5.95L30.15,-6.2L30.55,-8.4L30.5,-8.45L29.75,-7.45L28.75,-6.45L27.8,-5.85L27.6,-5.8Q27.4,-5.8 27.3,-5.95Q27.15,-6.25 27.15,-6.85Q27.15,-7.65 27.45,-8.75Q27.7,-9.75 28.1,-10.6L28.7,-11.25L29.8,-11.85M29.25,-11.2L28.95,-10.75L28.4,-9.3Q28.05,-8.05 28.05,-7.05L28.05,-6.8L28.15,-6.7L28.25,-6.65L28.65,-6.8L29.65,-7.75L30.55,-9.15L31.15,-11.15L30.65,-11.3L30.05,-11.35L29.25,-11.2"}]},{name:"invertedTurn",bounds:{left:-13,right:14.3,top:-.2,bottom:15.05},svgPaths:[{d:"M12.55,11.45Q10.75,12.95 8.35,13Q5.6,12.85 1.15,9.85L1.15,15.05L-0.15,15.05L-0.15,9.2L-4.15,6.8Q-6.05,5.35 -8.3,5.2Q-9.95,5.45 -10.65,6.35Q-11.35,7.25 -11.3,8.25Q-11.3,9.2 -10.75,9.85Q-10.2,10.55 -9.1,10.55Q-8.35,10.45 -7.75,9.95Q-7.15,9.45 -6.05,9.4Q-4.6,9.4 -4.05,10.55Q-3.95,11.9 -5.15,12.45L-7.5,13Q-10.15,12.8 -11.55,11.15Q-13,9.45 -13,7.15Q-12.75,5 -11.1,3.8Q-9.5,2.65 -7.1,2.4Q-3.95,2.6 -0.15,4.95L-0.15,-0.2L1.15,-0.2L1.15,5.6L5.45,8.7L7.35,9.75L9.55,10.2Q11.5,9.95 12.2,8.8Q12.9,7.65 12.65,6.55Q12.3,4.9 10.55,4.85Q9.8,4.95 9.15,5.45L7.35,6Q5.65,5.9 5.45,4.4Q5.55,3.3 6.7,2.85L8.85,2.4Q11.35,2.5 12.75,4.05Q14.15,5.65 14.3,7.8Q14.35,10 12.55,11.45"}]},{name:"percussion2Clef",bounds:{left:0,right:14,top:-10,bottom:10},svgPaths:[{d:"M5,-10L5,10L0,10L0,-10L5,-10M14,-10L14,10L9,10L9,-10L14,-10"}]},{name:"buzz",bounds:{left:-6.15,right:6.8,top:-6.5,bottom:6.45},svgPaths:[{d:"M6.8,-4.35L-1.85,4.2L6.8,4.2L6.8,6.45L-6.15,6.45L-6.15,4.2L2.4,-4.25L-5.9,-4.25L-5.9,-6.5L6.8,-6.5L6.8,-4.35"}]},{name:"crossCircleNoteHead",bounds:{left:-.15,right:18.15,top:-8.75,bottom:8.85},svgPaths:[{d:"M4.05,-5.95L9,-1.05L13.95,-6L15.05,-4.9L10.1,0L14.95,4.9L13.85,6L9,1.1L4.05,5.95L3.05,4.85L7.9,0L3,-4.85L4.05,-5.95"},{fill:"none","stroke-width":"0.5","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"0",d:"M0,0"},{fill:"none","stroke-width":"1.75","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"20",d:"M9,-7.9Q12.45,-7.9 14.85,-5.6Q17.3,-3.25 17.3,0.05Q17.3,3.35 14.85,5.65Q12.45,8 9,8Q5.55,8 3.1,5.65Q0.7,3.35 0.7,0.05Q0.7,-3.25 3.1,-5.6Q5.55,-7.9 9,-7.9"}]},{name:"leftParenthesis",bounds:{left:0,right:4.75,top:-9.35,bottom:9.4},svgPaths:[{d:"M2.25,-3.65Q1.8,-1.8 1.8,0.05Q1.8,4.75 4.75,9.4L3.5,9.4Q2.05,7.6 1,5.15Q0,2.65 0,0.05Q0,-2.3 0.75,-4.4Q1.65,-6.9 3.5,-9.35L4.75,-9.35L3.15,-6.45Q2.55,-5.1 2.25,-3.65"}]},{name:"rightParenthesis",bounds:{left:0,right:4.8,top:-9.35,bottom:9.4},svgPaths:[{d:"M0,-9.35L1.25,-9.35Q3.15,-6.9 4.05,-4.4Q4.8,-2.3 4.8,0.05Q4.8,2.65 3.75,5.15Q2.75,7.6 1.25,9.4L0,9.4Q3,4.75 3,0.05L2.55,-3.6L1.6,-6.4L0,-9.35"}]},{name:"f8Clef",bounds:{left:0,right:27.8,top:-10,bottom:35.1},svgPaths:[{d:"M6.8,-8.15L4.75,-7Q4,-6.2 3.55,-5.2Q3.1,-4.2 4.5,-3.9L6.1,-4.25Q7.75,-4.35 8.8,-3.4Q9.9,-2.4 9.95,-1Q9.9,0.4 8.85,1.5Q7.8,2.6 5.9,2.65Q3.9,2.65 2.5,1.45Q1.15,0.3 1.05,-1.55Q1,-3.6 2.15,-5.45Q3.3,-7.25 5.25,-8.35Q6.35,-9 8,-9.5L10.9,-10Q14.7,-10.25 18.25,-7.5Q20.05,-6.05 20.85,-4.5Q21.6,-2.95 21.85,-0.5Q22.1,3.2 19.8,7.2Q17.55,11.15 14.5,13.65L7.85,18.05L0.25,22L0,21.15L7.85,15.65Q11.1,13.05 13.65,8.75Q14.8,6.75 15.5,4.25Q16.25,1.8 16.25,-0.35Q16.4,-3.55 15.3,-5.75Q14.55,-7.15 13.1,-8Q11.55,-8.9 9.55,-8.75L6.8,-8.15M25.65,-6.85Q27.7,-6.6 27.8,-4.7Q27.7,-2.75 25.65,-2.5Q23.5,-2.75 23.45,-4.7Q23.5,-6.6 25.65,-6.85M27.8,4.05Q27.7,6 25.65,6.25Q23.5,6 23.45,4.05Q23.5,2.15 25.65,1.9Q27.7,2.15 27.8,4.05M9.25,22.6L10.25,22.4Q11.15,22.2 12.55,22.75Q13.95,23.3 14.35,24.8L14.55,26.1Q14.4,27.15 13.65,27.8L11.95,28.85Q13.15,30.25 13.3,31.65Q13.25,33.55 11.75,34.3L9.6,35.05L8.6,35.1Q7.15,35.1 5.7,34.25Q4.3,33.45 4.15,31.85L4.15,31.7Q4.25,30.4 5.35,29.55Q6.45,28.75 7.6,28.35Q6.55,27.15 6.5,25.65Q6.65,24.2 7.8,23.45L7.75,23.45L8.6,22.85L9.25,22.6M11.15,23.4L11,23.4L10.7,23.4L10.2,23.4L9.55,23.65Q9.15,23.9 8.9,24.8Q9,26 9.85,26.85L11.4,28.4Q12.7,27.55 13,25.95L13.05,25.45L12.9,24.8Q12.75,24.2 12.05,23.85L11.15,23.4M10.8,32.65Q10.55,31.5 9.65,30.55L8,28.85Q6.05,29.8 5.85,31.85L5.85,31.95Q5.9,33.05 6.75,33.65Q7.65,34.25 8.6,34.3L9.6,34.15L10.2,33.9Q10.95,33.45 10.8,32.65"}]},{name:"shortFlagDown",bounds:{left:0,right:10.9,top:0,bottom:21.35},svgPaths:[{d:"M9.05,7.45L9.75,5.3L10,3.35Q10.15,1.65 9.85,0.45L10.2,0Q10.85,1.45 10.9,3.6Q10.95,5.6 10.25,8.05Q9.5,10.5 7.8,12.7Q6,14.9 3.1,17.35Q1.85,18.6 1.5,19.75L1.05,21.35L0,21.35L0,14.2L1.05,14.2L1.05,15Q3.75,13.55 5.75,11.9Q7.75,10.3 9.05,7.45"}]},{name:"shortFlagUp",bounds:{left:0,right:10.9,top:0,bottom:21.75},svgPaths:[{d:"M1.05,0Q1.1,1.1 1.45,2.45Q1.85,3.8 3.1,5Q6.15,7.6 8.1,10Q10.75,13.15 10.9,17.2Q10.9,19.55 10.2,21.75L9.7,21.1L9.85,19.35L9.85,17.6Q9.55,14.55 7.35,12.15Q4.75,9.25 1.05,7.35L1.05,8.15L0,8.15L0,0L1.05,0"}]},{name:"crossNoteHead",bounds:{left:0,right:12.05,top:-6,bottom:6},svgPaths:[{d:"M6,-1.05L10.95,-6L12.05,-4.9L7.1,0L11.95,4.9L10.85,6L6,1.1L1.05,5.95L0.05,4.85L4.9,0L0,-4.85L1.05,-5.95L6,-1.05"}]},{name:"shake",bounds:{left:0,right:26.8,top:-5,bottom:4.8},svgPaths:[{d:"M17.85,-4.8L22.45,-1Q23.05,-0.35 23.75,-0.85L26.8,-4.05L26.8,-1.75L21.05,4.45Q20.45,5.1 19.75,4.6L15.15,0.8Q14.55,0.15 13.85,0.65L10.25,4.45Q9.65,5.1 9,4.6L4.35,0.8Q3.75,0.1 3.05,0.65L0,3.85L0,1.5L5.75,-4.6Q6.35,-5.3 7.05,-4.8L11.7,-1Q12.25,-0.35 12.95,-0.85L16.55,-4.6Q17.15,-5.3 17.85,-4.8"}]},{name:"measureRepeat",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0,10L17.14,-10L23.35,-10L6.2,10L0,10M3.67,-4.69Q3.67,-6.98 5.96,-6.98Q8.24,-6.98 8.24,-4.69Q8.24,-2.41 5.96,-2.41Q3.67,-2.41 3.67,-4.69M15.76,4.69Q15.76,2.41 18.04,2.41Q20.33,2.41 20.33,4.69Q20.33,6.98 18.04,6.98Q15.76,6.98 15.76,4.69"}]},{name:"scoop",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,5.0775169 C4.2906409,4.7110211 17.3553994,4.353799 22.1573103,-11.6257134 C22.5542237,-12.4078939 24.1830526,-11.0184729 23.907068,-10.0378357 C21.4339633,-1.1783444 12.7849596,8.0417555 1.2893075,9.0440547 C0.4365,9.1182441 0.1200821,8.3555768 0.0829874,7.7872858 C0.0202973,6.8217103 0.093003,6.1350872 0.3356024,5.5994395 C0.4850941,5.2696675 0.626425,5.1064507 0.8946198,5.0775169"}]},{name:"plop",bounds:{left:.055,right:23.95,top:-16.86,bottom:4.05},svgPaths:[{d:"M0.8946198,-5.0775169 C4.2906409,-4.7110211 17.3553994,-4.353799 22.1573103,11.6257134 C22.5542237,12.4078939 24.1830526,11.0184729 23.907068,10.0378357 C21.4339633,1.1783444 12.7849596,-8.0417555 1.2893075,-9.0440547 C0.4365,-9.1182441 0.1200821,-8.3555768 0.0829874,-7.7872858 C0.0202973,-6.8217103 0.093003,-6.1350872 0.3356024,-5.5994395 C0.4850941,-5.2696675 0.626425,-5.1064507 0.8946198,-5.0775169"}]},{name:"quickFall",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,-5.0775169 C4.2906409,-4.7110211 17.3553994,-4.353799 22.1573103,11.6257134 C22.5542237,12.4078939 24.1830526,11.0184729 23.907068,10.0378357 C21.4339633,1.1783444 12.7849596,-8.0417555 1.2893075,-9.0440547 C0.4365,-9.1182441 0.1200821,-8.3555768 0.0829874,-7.7872858 C0.0202973,-6.8217103 0.093003,-6.1350872 0.3356024,-5.5994395 C0.4850941,-5.2696675 0.626425,-5.1064507 0.8946198,-5.0775169"}]},{name:"doit",bounds:{left:0,right:23.35,top:-10,bottom:10},svgPaths:[{d:"M0.8946198,5.0775169 C4.2906409,4.7110211 17.3553994,4.353799 22.1573103,-11.6257134 C22.5542237,-12.4078939 24.1830526,-11.0184729 23.907068,-10.0378357 C21.4339633,-1.1783444 12.7849596,8.0417555 1.2893075,9.0440547 C0.4365,9.1182441 0.1200821,8.3555768 0.0829874,7.7872858 C0.0202973,6.8217103 0.093003,6.1350872 0.3356024,5.5994395 C0.4850941,5.2696675 0.626425,5.1064507 0.8946198,5.0775169"}]},{name:"fall1",bounds:{left:0,right:26.8,top:-5,bottom:4.8},svgPaths:[{d:"M17.85,-4.8L22.45,-1Q23.05,-0.35 23.75,-0.85L26.8,-4.05L26.8,-1.75L21.05,4.45Q20.45,5.1 19.75,4.6L15.15,0.8Q14.55,0.15 13.85,0.65L10.25,4.45Q9.65,5.1 9,4.6L4.35,0.8Q3.75,0.1 3.05,0.65L0,3.85L0,1.5L5.75,-4.6Q6.35,-5.3 7.05,-4.8L11.7,-1Q12.25,-0.35 12.95,-0.85L16.55,-4.6Q17.15,-5.3 17.85,-4.8"}]},{name:"rip1",bounds:{left:0,right:26.8,top:-5,bottom:4.8},svgPaths:[{d:"M17.85,-4.8L22.45,-1Q23.05,-0.35 23.75,-0.85L26.8,-4.05L26.8,-1.75L21.05,4.45Q20.45,5.1 19.75,4.6L15.15,0.8Q14.55,0.15 13.85,0.65L10.25,4.45Q9.65,5.1 9,4.6L4.35,0.8Q3.75,0.1 3.05,0.65L0,3.85L0,1.5L5.75,-4.6Q6.35,-5.3 7.05,-4.8L11.7,-1Q12.25,-0.35 12.95,-0.85L16.55,-4.6Q17.15,-5.3 17.85,-4.8"}]}]};r.registerClass(To,"com.noteflight.notation.glyph.sonata.SonataJSGlyphFoundryFactory");var Mo=function t(){y(this,t)};r.registerClass(Mo,"com.noteflight.notation.instrument.IInstrumentResolver");var bo=function t(){y(this,t)};r.implementsInterfaces(bo,[vt]),r.registerClass(bo,"com.noteflight.notation.instrument.IInstrumentSpecification");var wo=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).entry=null,t.audioDescriptor=null,t.mimeType=null,t.location=null,t.specificationBase=null,t.loader=null,t.specification=null,t}return c(e,At),p(e,null,[{key:"WAV_TYPE",get:function(){return"audio/x-wav"}},{key:"MP3_TYPE",get:function(){return"audio/mpeg"}}]),e}();r.registerClass(wo,"com.noteflight.notation.instrument.InstrumentDescriptor");var xo=function(){function t(e){y(this,t),this._name=null,this.children=null,this._name=e,this.children=[]}return p(t,[{key:"addInstrument",value:function(t,e){this.children.push(new Co(t,e))}},{key:"name",get:function(){return this._name}}]),t}();r.registerClass(xo,"com.noteflight.notation.instrument.InstrumentGroup");var Co=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y(this,t),this._instrument=null,this._isMainGroup=!1,this._instrument=e,this._isMainGroup=i}return p(t,[{key:"name",get:function(){return""!==this.instrument.name?this.instrument.name:this.instrument.partPrototype.name}},{key:"instrument",get:function(){return this._instrument}},{key:"isMainGroup",get:function(){return this._isMainGroup}}]),t}();r.registerClass(Co,"com.noteflight.notation.instrument.InstrumentGroupEntry");var No=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this.location=null,this.instrumentBase=null,this._entries=[],this._entryUriMap={},this.groupsList=[],this.location=e}return p(t,null,[{key:"DEFAULT_ENTRY_URI",get:function(){return"default"}}]),p(t,[{key:"getEntryByUri",value:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;;){if(e in this._entryUriMap){var n=this._entryUriMap[e];if(null==i||n.getDescriptorsForType(i).length>0)return n}var r=e.lastIndexOf("/");if(r<0)return this._entryUriMap[t.DEFAULT_ENTRY_URI];e=e.substring(0,r)}return null}},{key:"addEntry",value:function(t){this._entries.push(t),this._entryUriMap[t.uri]=t;var e=!0,i=!1,n=void 0;try{for(var r,o=t.aliasUris[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToString(s);this._entryUriMap[a]=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"entries",get:function(){return this._entries}}]),t}();r.implementsInterfaces(No,[Mo]),r.registerClass(No,"com.noteflight.notation.instrument.InstrumentLibrary");var Ao=function(){function t(e,i){y(this,t),this.library=null,this.uri=null,this.partPrototype=null,this.name=null,this.description=null,this.clefs=null,this.aliasUris=null,this.instrumentDescriptors=null,this.midiPatch=-1,this.mainGroup=null,this.groupsList=null,this.library=e,this.uri=i,this.partPrototype=El.createPart(),this.clefs=[],this.aliasUris=[],this.groupsList=[],this.instrumentDescriptors=[],this.hasPedal=!1}return p(t,[{key:"createPart",value:function(){var t=A.as(this.partPrototype.clone(),El);return t.instrumentUri=this.uri,t.midiPatch=this.midiPatch,t.hasPedal=this.hasPedal,this.library&&(t.libraryLocation=this.library.location),t}},{key:"getDescriptorsForType",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.instrumentDescriptors[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,wo);null!=t&&l.mimeType!=t||e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"label",get:function(){return this.name||this.partPrototype.name}}]),t}();r.registerClass(Ao,"com.noteflight.notation.instrument.InstrumentLibraryEntry");var Io=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0;y(this,t),this._library=null,this._xml=null,this._xml=e,this._library=new No(i),this._library.instrumentBase=n,this.loadAssetFunc=r,this.parseXml()}return p(t,[{key:"parseXml",value:function(){var e=!0,i=!1,n=void 0;try{for(var r,o=this._xml.child("instrument").list[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.xmllistToString(s.child("uri")),l=new Ao(this._library,a),u=!0,h=!1,c=void 0;try{for(var d,f=s.child("alias").list[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;l.aliasUris.push(y.toString())}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}l.description=s.has("description")?s.child("description").toString():null,l.name=s.has("name")?s.child("name").toString():null,l.mainGroup=a.split("/")[0];var g=0,p=!0,m=!1,v=void 0;try{for(var _,S=s.child("group").list[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value;0===g?l.mainGroup=L.toString():l.groupsList.push(L.toString()),g++}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}var k=!0,T=!1,E=void 0;try{for(var M,b=s.child("specification").list[Symbol.iterator]();!(k=(M=b.next()).done);k=!0){var w=M.value,x=new wo;x.entry=l,x.audioDescriptor=new Ad(A.numberToUint(X.parseInt(w.child("sampleRate").toString())),A.numberToUint(X.parseInt(w.child("channels").toString()))),x.mimeType=w.child("type").toString(),x.location=this.loadAssetFunc("instruments/".concat(w.child("location").toString())),x.specificationBase=x.location.substring(0,x.location.lastIndexOf("/")),l.instrumentDescriptors.push(x)}}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}var C=!0,N=!1,I=void 0;try{for(var P,O=s.child("partDefaults").list[Symbol.iterator]();!(C=(P=O.next()).done);C=!0){var Q=P.value;t.parsePartDefaults(l,Q)}}catch(t){N=!0,I=t}finally{try{C||null==O.return||O.return()}finally{if(N)throw I}}this._library.addEntry(l)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"library",get:function(){return this._library}}],[{key:"parsePartDefaults",value:function(t,e){var i=new ur;t.partPrototype.name=e.child("name").toString(),t.partPrototype.shortName=e.child("shortName").toString(),e.has("transposition")&&(t.partPrototype.transposition=A.numberToInt(X.parseInt(e.child("transposition").toString()))),e.has("octaveShift")&&(t.partPrototype.octaveShift=A.numberToInt(X.parseInt(e.child("octaveShift").toString()))),e.has("directionsAboveStaff")&&(t.partPrototype.directionsAboveStaff="true"==e.child("directionsAboveStaff").toString());var n=!0,r=!1,o=void 0;try{for(var s,a=e.child("staff").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=null;l.has("staffTuning")&&(u=new Rl,i.parseStaffTuning(l.child("staffTuning").get(0),A.xmlToString(l.child("capo").get(0)),u));var h=!0,c=!1,d=void 0;try{for(var f,y=l.child("clef").list[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;t.clefs.push(i.parseClef(g,u))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}l.has("pedal")&&(t.hasPedal=!0)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}e.has("midiPatch")&&(t.midiPatch=parseInt(e.child("midiPatch").toString()),isNaN(t.midiPatch)&&(t.midiPatch=-1))}}]),t}();r.registerClass(Io,"com.noteflight.notation.instrument.InstrumentLibraryLoader");var Po=function(){function t(){y(this,t),this.basicLibrary=null,this.premiumLibrary=null,this.premium=!1}return p(t,[{key:"getEntryByUri",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.currentLibrary.getEntryByUri(t,e)}},{key:"currentLibrary",get:function(){return this.premium?this.premiumLibrary:this.basicLibrary}},{key:"entries",get:function(){return this.currentLibrary.entries}}]),t}();r.implementsInterfaces(Po,[Mo]),r.registerClass(Po,"com.noteflight.notation.instrument.InstrumentManifest");var Oo=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0;y(this,t),this._manifest=null,this._xml=null,this._premiumGroupsListMap={},this._basicGroupsListMap={},this._xml=e,this._manifest=new Po,this.parseXml(i,n,r),this.loadGroups()}return p(t,[{key:"createGroupsList",value:function(t,e,i){var n=0,r=!0,o=!1,s=void 0;try{for(var a,l=t.list[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value.toString();e.push(new xo(u)),i[u]=n,n++}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"parseXml",value:function(t,e,i){var n=!0,r=!1,o=void 0;try{for(var s,a=this._xml.child("instrumentLibrary").list[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=new Io(l,t,e,i);"true"==l.attribute("premium").toString()?(this._manifest.premiumLibrary=u.library,this.createGroupsList(l.child("groupsList").child("group"),this._manifest.premiumLibrary.groupsList,this._premiumGroupsListMap)):(this._manifest.basicLibrary=u.library,this.createGroupsList(l.child("groupsList").child("group"),this._manifest.basicLibrary.groupsList,this._basicGroupsListMap))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"loadGroupInstruments",value:function(t,e,i){var n=!0,r=!1,o=void 0;try{for(var s,a=t.entries[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Ao);i.hasOwnProperty(u.mainGroup)&&e[i[u.mainGroup]].addInstrument(u,!0);var h=!0,c=!1,d=void 0;try{for(var f,y=u.groupsList[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.unknownToString(g);i.hasOwnProperty(p)&&e[i[p]].addInstrument(u,!1)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"loadGroups",value:function(){this.loadGroupInstruments(this._manifest.basicLibrary,this._manifest.basicLibrary.groupsList,this._basicGroupsListMap),this.loadGroupInstruments(this._manifest.premiumLibrary,this._manifest.premiumLibrary.groupsList,this._premiumGroupsListMap)}},{key:"manifest",get:function(){return this._manifest}}]),t}();r.registerClass(Oo,"com.noteflight.notation.instrument.InstrumentManifestLoader");var Qo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;y(this,t),this.x=NaN,this.y=NaN,this.width=NaN,this.height=NaN,this.x=e,this.y=i,this.width=n,this.height=r}return p(t,[{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"contains",value:function(t,e){return t>=t&&t<=this.right&&e>=e&&e<=this.bottom}},{key:"inflate",value:function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e}},{key:"union",value:function(e){var i=Math.min(e.x,this.x),n=Math.min(e.y,this.y);return new t(i,n,Math.max(e.right,this.right)-i,Math.max(e.bottom,this.bottom)-n)}},{key:"top",get:function(){return this.y},set:function(t){this.height-=t-this.y,this.y=t}},{key:"bottom",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"left",get:function(){return this.x},set:function(t){this.width-=t-this.x,this.x=t}},{key:"right",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"topLeft",get:function(){return new If(this.left,this.top)}},{key:"bottomRight",get:function(){return new If(this.right,this.bottom)}},{key:"size",get:function(){return new If(this.width,this.height)}}]),t}();r.registerClass(Qo,"flash.geom.Rectangle");var Ro=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).centered=!1,i._context=null,i._valid=!1,i._validating=!1,i._globalValid=!1,i._parent=null,i._constraint=null,i._width=0,i._height=0,i._originX=0,i._originY=0,i.leftConstraint=null,i._context=t,i}return c(e,At),p(e,null,[{key:"EMPTY_RECT",get:function(){return Do}}]),p(e,[{key:"invalidate",value:function(){this._valid=!1,this.invalidateGlobal(),null!=this._parent&&this._parent.invalidate()}},{key:"invalidateGlobal",value:function(){this._globalValid=!1}},{key:"validateLayout",value:function(){this._valid||this._validating||(this._validating=!0,this.doValidateLayout(),this._validating=!1,this._valid=!0)}},{key:"asyncValidateLayout",value:function(t){var e=this;this._valid||this._validating||(this._validating=!0,this.doAsyncValidateLayout(function(){e._validating=!1,e._valid=!0,t()}))}},{key:"validateGlobalLayout",value:function(){this._globalValid||(this.doValidateGlobalLayout(),this._globalValid=!0)}},{key:"doValidateGlobalLayout",value:function(){}},{key:"destroy",value:function(){this.removeListeners(),this.destroyChildren()}},{key:"removeListeners",value:function(){}},{key:"destroyChildren",value:function(){}},{key:"doValidateLayout",value:function(){throw new Error("doValidateLayout() not overridden")}},{key:"doAsyncValidateLayout",value:function(t){throw new Error("doAsyncValidateLayout() not overridden")}},{key:"createDisplayObject",value:function(t){throw new Error("createDisplayObject() not overridden")}},{key:"getXPosition",value:function(t,e){return 0}},{key:"valid",get:function(){return this._valid}},{key:"globalValid",get:function(){return this._globalValid}},{key:"context",get:function(){return this._context}},{key:"width",get:function(){return this.validateLayout(),this._width}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._constraint=t}},{key:"height",get:function(){return this._height}},{key:"originX",get:function(){return this.validateLayout(),this._originX}},{key:"originY",get:function(){return this.validateLayout(),this._originY}},{key:"x",get:function(){return this._constraint?this._constraint.layoutVector.length:0}},{key:"bounds",get:function(){return e.EMPTY_RECT}}]),e}();r.implementsInterfaces(Ro,[wt]);var Do=new Qo(0,0,0,0);r.registerClass(Ro,"com.noteflight.notation.layout.AbstractLayout");var Fo=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t)))._glyphLayouts=[],i}return c(e,Ro),p(e,[{key:"addGlyphLayout",value:function(t){this._glyphLayouts.push(t)}},{key:"getGlyphLayoutAt",value:function(t){return this._glyphLayouts[t]}},{key:"calculateBounds",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._glyphLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.addGlyphToBounds(t,s)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"addGlyphToBounds",value:function(t,e){var i=e.bounds;e.affectsWidth&&(0===t.width?(t.left=i.left,t.right=i.right):(t.left=Math.min(t.left,i.left),t.right=Math.max(t.right,i.right))),e.affectsHeight&&(0===t.height?(t.top=i.top,t.bottom=i.bottom):(t.top=Math.min(t.top,i.top),t.bottom=Math.max(t.bottom,i.bottom)))}},{key:"numGlyphLayouts",get:function(){return this._glyphLayouts.length}}]),e}();r.registerClass(Fo,"com.noteflight.notation.layout.GlyphSetLayout");var Uo=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t)))._clef=null,o._notation=null,o._padding=new Qo,o._bounds=null,o._measureLayout=null,o._foundry=null,o._notation=n,o._measureLayout=i,o._clef=r,o}return c(e,Fo),p(e,[{key:"doValidateLayout",value:function(){this.reviseBoundsAndGeometry()}},{key:"reviseBoundsAndGeometry",value:function(){this._bounds=new Qo,this.calculateBounds(this._bounds),this._width=this._bounds.width+this.padding.width,this._height=this._bounds.height+this.padding.height,this._originX=-(this._bounds.left+this.padding.left),this._originY=-(this._bounds.top+this.padding.bottom)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new lh(t,this)}},{key:"foundry",get:function(){if(null==this._foundry){var t=this.glyphScale;this._foundry=1==t?this.context.foundry:this.context.getScaledFoundry(t)}return this._foundry}},{key:"glyphScale",get:function(){return this.notation.cue?this.context.staffMetrics.cueScale:1}},{key:"leftX",get:function(){return this.x}},{key:"measureLayout",get:function(){return this._measureLayout}},{key:"clef",get:function(){return this._clef}},{key:"padding",get:function(){return this._padding},set:function(t){this.invalidate(),this._padding=t}},{key:"floating",get:function(){return!1}},{key:"bounds",get:function(){return this.validateLayout(),this._bounds}},{key:"notation",get:function(){return this._notation}}]),e}();r.registerClass(Uo,"com.noteflight.notation.layout.NotationLayout");var Vo=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r)))._noteLayouts=[],o._down=!1,o._multiVoice=!1,o._beam=!1,o._stemLength=0,o._clearBottom=NaN,o._clearTop=NaN,o._clearInStaffBottom=NaN,o._clearInStaffTop=NaN,o._extrasBottom=NaN,o._extrasTop=NaN,o._tupletLayout=null,o.alternateVoiceLayout=null,o}return c(e,Uo),p(e,[{key:"clearExtrasTop",value:function(t){X.isNaN(this._extrasTop)&&(this._extrasTop=this.clearAboveStaff(0));var e=this._extrasTop;return this._extrasTop+=t,e}},{key:"clearExtrasBottom",value:function(t){X.isNaN(this._extrasBottom)&&(this._extrasBottom=this.clearBelowStaff(0));var e=this._extrasBottom;return this._extrasBottom-=t,e}},{key:"clearAboveStaff",value:function(t){return X.isNaN(this._clearInStaffTop)&&(this._clearInStaffTop=this._clearTop),this._clearTop=Math.max(this._clearTop,this.clef.displayLineEndIndex-1+this.context.staffMetrics.articulationPadding)+t,this._clearTop}},{key:"clearBelowStaff",value:function(t){return X.isNaN(this._clearInStaffBottom)&&(this._clearInStaffBottom=this._clearBottom),this._clearBottom=Math.min(this._clearBottom,this.clef.displayLineStartIndex-this.context.staffMetrics.articulationPadding)-t,this._clearBottom}},{key:"noteLayouts",get:function(){return this._noteLayouts}},{key:"down",get:function(){return this._down},set:function(t){this._down=t}},{key:"tupletLayout",get:function(){return this._tupletLayout},set:function(t){this._tupletLayout=t}},{key:"beamY",set:function(t){}},{key:"multiVoice",get:function(){return this._multiVoice},set:function(t){this._multiVoice=t}},{key:"beam",get:function(){return this._beam},set:function(t){this._beam=t}},{key:"stemLength",get:function(){return this._stemLength},set:function(t){this._stemLength=t}},{key:"noteSet",get:function(){return A.as(this.notation,Sn)}},{key:"clearTop",get:function(){return this._clearTop}},{key:"clearBottom",get:function(){return this._clearBottom}},{key:"clearInStaffTop",get:function(){return X.isNaN(this._clearInStaffTop)?this._clearTop:this._clearInStaffTop}},{key:"clearInStaffBottom",get:function(){return X.isNaN(this._clearInStaffBottom)?this._clearBottom:this._clearInStaffBottom}},{key:"spanTop",get:function(){return this.clearInStaffTop}},{key:"spanBottom",get:function(){return this.clearInStaffBottom}},{key:"lyricExclusionBottom",get:function(){return this.bounds.top}},{key:"lyricExclusionTop",get:function(){return this.bounds.top+this.bounds.height}}]),e}();r.registerClass(Vo,"com.noteflight.notation.layout.AbstractBeamableLayout");var Bo=function(t){function e(t,i,n,r){var o;y(this,e),(o=l(this,h(e).call(this,t,i,n,r)))._barlineType=null,o._measureStartRepeat=!1,o._startRepeat=!1,o._endRepeat=!1,o._barlineGlyphLayout=null;var s,a,u,c=n.measure.staff.getMeasureAt(A.intToUint(n.measure.index+1));if(n.position==i.measure.duration?(o._endRepeat=n.measure.endRepeat,o._measureStartRepeat=c&&n.measure.index<n.measure.staff.numChildren-1&&c.startRepeat&&!n.measure.systemGap,o._startRepeat=o._measureStartRepeat&&!i.lastLayoutOnSystem):i.needsStaffStartLayout&&(o._startRepeat=n.measure.startRepeat),o._barlineType=n.type,o._endRepeat?o._barlineType=o._startRepeat?En.REPEAT:En.FINAL:o._measureStartRepeat&&!o._startRepeat&&o._barlineType==En.SINGLE?o._barlineType=En.DOUBLE:o._measureStartRepeat&&o._startRepeat&&(o._barlineType=En.INITIAL),o._barlineGlyphLayout=new Zo(t,o.foundry.getBarline(o._barlineType)),o._barlineGlyphLayout.distanceY=-t.staffMetrics.lineThickness,o.addGlyphLayout(o._barlineGlyphLayout),(o._endRepeat||o._startRepeat)&&(a=r.numLines%2==1?[(r.staffHeight-r.lineSpacing)/2,(r.staffHeight+r.lineSpacing)/2]:[r.staffHeight/2-r.lineSpacing,r.staffHeight/2+r.lineSpacing]),o._endRepeat){var d=!0,f=!1,g=void 0;try{for(var p,m=a[Symbol.iterator]();!(d=(p=m.next()).done);d=!0){var v=p.value;u=A.unknownToNumber(v),(s=new Zo(t,o.foundry.getBarline(En.END_REPEAT))).horizontalAnchor=Zo.ANCHOR_RIGHT,s.distanceY=u,o.addGlyphLayout(s)}}catch(t){f=!0,g=t}finally{try{d||null==m.return||m.return()}finally{if(f)throw g}}t.staffMetrics.repeatWings&&(i.topStaffInBarlineGroup&&((s=new Zo(t,o.foundry.getBarline(En.TOP_END_WING))).distanceY=i.measure.effectiveClef.staffHeight,s.verticalAnchor=Zo.ANCHOR_BOTTOM,o.addGlyphLayout(s)),i.bottomStaffInBarlineGroup&&((s=new Zo(t,o.foundry.getBarline(En.BOTTOM_END_WING))).verticalAnchor=Zo.ANCHOR_BOTTOM,o.addGlyphLayout(s)))}if(o._startRepeat){var _=!0,S=!1,L=void 0;try{for(var k,T=a[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value;u=A.unknownToNumber(E),(s=new Zo(t,o.foundry.getBarline(En.START_REPEAT))).distanceX=o._barlineGlyphLayout.width,s.distanceY=u,o.addGlyphLayout(s)}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}t.staffMetrics.repeatWings&&(i.topStaffInBarlineGroup&&((s=new Zo(t,o.foundry.getBarline(o._barlineType==En.INITIAL?En.TOP_INITIAL_WING:En.TOP_START_WING))).distanceY=i.measure.effectiveClef.staffHeight,s.verticalAnchor=Zo.ANCHOR_BOTTOM,o.addGlyphLayout(s)),i.bottomStaffInBarlineGroup&&((s=new Zo(t,o.foundry.getBarline(o._barlineType==En.INITIAL?En.BOTTOM_INITIAL_WING:En.BOTTOM_START_WING))).verticalAnchor=Zo.ANCHOR_BOTTOM,o.addGlyphLayout(s)))}return o.padding=n.position>0?t.staffMetrics.barlinePadding:t.staffMetrics.initialBarlinePadding,o}return c(e,Uo),p(e,[{key:"barlineGlyphLayout",get:function(){return this._barlineGlyphLayout}}],[{key:"getBarlineGlyphView",value:function(t){return A.unknownToType(t,lh).getChildAt(0)}}]),e}();r.registerClass(Bo,"com.noteflight.notation.layout.BarlineLayout");var Ho=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t))).startX=NaN,i.endX=NaN,i.startY=NaN,i.rise=NaN,i.maxLevel=0,i.down=!1,i.beams=[],i._beamableLayouts=[],i}return c(e,Ro),p(e,null,[{key:"CONCAVITY_CONTOUR_THRESHOLD",get:function(){return.6}}]),p(e,[{key:"addBeamableLayout",value:function(t){this._beamableLayouts.push(t)}},{key:"getBeamableLayoutAt",value:function(t){return A.as(this._beamableLayouts[t],rs)}},{key:"setUpBeam",value:function(){var t,e,i,n=!1,r=!0,o=!1,s=void 0;try{for(var a,l=this._beamableLayouts[Symbol.iterator]();!(r=(a=l.next()).done);r=!0)i=a.value,(t=A.unknownToType(i,rs)).beam=!0,n=n||t.multiVoice}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}var u=this.getBeamableLayoutAt(0),h=u.noteSet.measure;if(null!=u.direction)this.down=u.down;else if(n)this.down=u.noteSet.voiceNumber>0;else if(t&&t.clef.defaultStemsUp)this.down=!1;else{var c=0,d=0,f=h.scoreInterval,y=!0,g=!1,p=void 0;try{for(var m,v=this._beamableLayouts[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){i=m.value,t=A.unknownToType(i,rs);var _=!0,S=!1,L=void 0;try{for(var k,T=t.noteSet.notes[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value;c+=t.clef.getPitchLine(h.getScoreNote(E,f))-t.clef.centerLine,d++}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}this.down=c/d>=0}var M=!0,b=!1,w=void 0;try{for(var x,C=this._beamableLayouts[Symbol.iterator]();!(M=(x=C.next()).done);M=!0){var N=x.value;(e=A.unknownToType(N,rs)).down=this.down,e.multiVoice=n}}catch(t){b=!0,w=t}finally{try{M||null==C.return||C.return()}finally{if(b)throw w}}}},{key:"doValidateLayout",value:function(){}},{key:"determineBeamLevels",value:function(){var t=[];this.beams=[];for(var e=0;e<this._beamableLayouts.length;e++){var i=this.getBeamableLayoutAt(e).noteSet.beamLevel;if(i>=0)if(this.maxLevel=A.numberToInt(Math.max(this.maxLevel,i)),i<t.length){for(var n=0;n<=i;n++)t[n].end=e;t.splice(i+1,A.intToUint(t.length-(i+1)))}else for(var r=0;r<=i;r++)r>=t.length?(t[r]=new us(r,e,e),this.beams.push(t[r])):t[r].end=e}var o=!0,s=!1,a=void 0;try{for(var l,u=this.beams[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(h.start>0)for(;h.start<h.end&&0===this.getBeamableLayoutAt(A.unknownToInt(h.start)).noteSet.notes.length;)h.start++;if(h.end<this._beamableLayouts.length-1)for(;h.end>h.start&&0===this.getBeamableLayoutAt(A.unknownToInt(h.end)).noteSet.notes.length;)h.end--}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"doValidateGlobalLayout",value:function(){this.determineBeamLevels();var t=this.getBeamableLayoutAt(0);t.stemLength=t.standardStemLength,t.multiVoice&&(t.stemLength=Math.max(0,t.stemLength-this.context.staffMetrics.beamMultiVoiceCutback));var e=t.stemEnd;this.startX=t.leftX+e.x,this.startY=e.y;var i,n=this.getBeamableLayoutAt(this._beamableLayouts.length-1);if(this.endX=n.leftX+n.stemEnd.x,t.noteSet.value<mn.WHOLE){this.concave?this.rise=0:this.rise=this.getRiseForSteps(2*(n.nearestStemLine-t.nearestStemLine));for(var r=1e3,o=0;o<this._beamableLayouts.length;o++)this.getBeamableLayoutAt(o).standardStemLength>0&&(r=Math.min(r,this.getStemLengthAt(o,!1)));i=t.multiVoice?this.context.staffMetrics.multiVoiceBeamingStemLength:this.context.staffMetrics.beamingStemLength,i*=t.glyphScale,this.maxLevel>1&&(i+=(this.maxLevel-1)*this.effectiveBeamInterval),r<i&&(this.startY+=this.down?r-i:i-r)}else this.rise=n.stemEnd.y-this.startY,i=0;for(var s=0;s<this._beamableLayouts.length;s++){var a=this.getBeamableLayoutAt(s);a.hasStem?a.stemLength=this.getStemLengthAt(s,!0):A.is(a,Cs)?a.beamY=this.startY+this.rise*(a.leftX-this.startX)/(this.endX-this.startX)+(this.effectiveBeamThickness+this.maxLevel*this.effectiveBeamInterval)*(this.down?1:-1):a.beamY=this.startY+this.rise*(a.leftX-this.startX)/(this.endX-this.startX)}}},{key:"getStemLengthAt",value:function(t,e){var i=this.getBeamableLayoutAt(t),n=i.stemEnd,r=i.leftX+n.x,o=this.startY+this.rise*(r-this.startX)/(this.endX-this.startX),s=e?i.stemStartLine:i.nearestStemLine;return this.down?s-o:o-s}},{key:"isBeamStart",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.beams[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.start==t&&s.end>t)return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"isBeamEnd",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.beams[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.start<t&&s.end==t)return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"createDisplayObject",value:function(t){return new rh(t,this)}},{key:"getRiseForSteps",value:function(t){return t<=-3?-1:t>=3?1:t<=-2?-.5:t>=2?.5:t<=-1?-.25:t>=1?.25:0}},{key:"numBeamableLayouts",get:function(){return this._beamableLayouts.length}},{key:"concave",get:function(){if(this._beamableLayouts.length<=2)return!1;for(var t,i,n,r,o=this.getBeamableLayoutAt(0).stemmingLine,s=this.getBeamableLayoutAt(this._beamableLayouts.length-1).stemmingLine,a=0,l=1;l<this._beamableLayouts.length-1;l++){var u=o+(s-o)*l/(this._beamableLayouts.length-1);a+=this.getBeamableLayoutAt(l).stemmingLine-u}var h=[];for(l=0;l<this._beamableLayouts.length;l++)n=this.getBeamableLayoutAt(l).stemmingLine,l>0&&(n<r?i++:n>r&&t++,h[l-1]=Math.abs(n-r)),r=n;var c=Math.abs((t-i)/this._beamableLayouts.length)+Math.abs((o-s)/this._beamableLayouts.length);return this.down?a<-.01&&c<e.CONCAVITY_CONTOUR_THRESHOLD:a>.01&&c<e.CONCAVITY_CONTOUR_THRESHOLD}},{key:"effectiveBeamThickness",get:function(){return this.context.staffMetrics.beamThickness*Math.sqrt(1+this.slope*this.slope)*this.getBeamableLayoutAt(0).glyphScale}},{key:"effectiveBeamInterval",get:function(){return(this.context.staffMetrics.beamThickness+this.context.staffMetrics.beamSpacing)*Math.sqrt(1+this.slope*this.slope)*this.getBeamableLayoutAt(0).glyphScale}},{key:"slope",get:function(){return this.rise/(this.endX-this.startX)}}]),e}();r.registerClass(Ho,"com.noteflight.notation.layout.BeamLayout");var $o=function(){function t(){y(this,t),this._context=null,this._leftNsl=null,this._leftNl=null,this._rightNsl=null,this._rightNl=null,this._singleNote=!1,this._liaisonCount=0,this._width=NaN,this._spacingLine=NaN,this._spacingY=NaN,this._startLine=NaN,this._endLine=NaN,this._pitchDelta=NaN,this._ascent=NaN,this._dy=NaN,this._down=!1}return p(t,[{key:"setLiaisonInfo",value:function(t,e,i,n,r,o,s,a){var l,u;if(this._leftNsl=t,this._leftNl=e,this._rightNsl=i,this._rightNl=n,this._singleNote=r,this._width=o,this._liaisonCount=a,null!=t?(l=t,u=e):(l=i,u=n),!l)throw Error("nsl is expected to be non-null at this point");if(this._context=l.context,l.multiVoice)this._down=l.down;else{var h=!l.down&&null!=this._rightNsl&&this._rightNsl.down&&null!=this._rightNl;this._down=!(l.down||h),h&&(s=this._liaisonCount-1-s),s>Math.floor((this._liaisonCount-1)/2)?this._down=!this._down:1==this._liaisonCount&&!r&&(h?this._rightNsl.noteLayouts.indexOf(this._rightNl)>Math.floor((this._rightNsl.numNoteLayouts-1)/2):l.noteLayouts.indexOf(u)>Math.floor((l.numNoteLayouts-1)/2))&&(this._down=!this._down)}null!=u?(this._spacingLine=u.pitchLine,this._spacingY=u.onStaffLine?this._down?-this.lineDither:this.lineDither:0):this._spacingLine=this._spacingY=0}},{key:"createLiaisonView",value:function(){var t,e,i;if(null!=this._leftNsl){var n=this.leftSpacing;return t=n.x,e=n.y,i=null!=this._rightNsl?this._width-(t+this.rightSpacing.x):this._width-(t+this.horizontalPadding),this.doCreateView(this._leftNsl,this._leftNl,t,e,i)}var r=this.rightSpacing;return t=this.horizontalPadding-this._width,e=r.y,i=this._width-(this.horizontalPadding+r.x),this.doCreateView(this._rightNsl,this._rightNl,t,e,i)}},{key:"doCreateView",value:function(t,e,i,n,r){throw new Error("doCreateView() not overridden")}},{key:"calculateAscent",value:function(){if(null!=this._leftNsl){if(this._startLine=this._leftNl.pitchLine,null!=this._rightNl)this._endLine=this._rightNl.pitchLine,this._pitchDelta=this._rightNl.note.tunedOrdinal-this._leftNl.note.tunedOrdinal;else{var t=this._leftNl.note.liaisonEndNote;null!=t?(this._endLine=this._leftNsl.clef.getPitchLine(this._leftNsl.measureLayout.getScoreNote(t))*this._leftNsl.clef.lineSpacing,this._pitchDelta=t.tunedOrdinal-this._leftNl.note.tunedOrdinal):(this._endLine=this._startLine,this._pitchDelta=0)}this._ascent=this._endLine-this._startLine,this._dy=this._startLine}else{this._endLine=this._rightNl.pitchLine;var e=this._rightNl.note.liaisonStartNote;null!=e?(this._startLine=this._rightNl.clef.getPitchLine(this._rightNl.measureLayout.getScoreNote(e))*this._rightNl.clef.lineSpacing,this._pitchDelta=this._rightNl.note.tunedOrdinal-e.tunedOrdinal):(this._startLine=this._endLine,this._pitchDelta=0),this._ascent=this._endLine-this._startLine,this._dy=this._endLine-this._ascent}}},{key:"tieHeight",value:function(t){return this.staffMetrics.tieStandardHeight(t)*(this._down?-1:1)}},{key:"staffMetrics",get:function(){return this._context.staffMetrics}},{key:"horizontalPadding",get:function(){return this.staffMetrics.tieHorizontalPadding}},{key:"lineDither",get:function(){return this.staffMetrics.tieStaffLineDither}},{key:"leftSpacing",get:function(){if(this.singleNote&&(this._leftNl.note.stemless||!this.adjustForLiasonCrossingStem))return new If(this._leftNsl.noteWidth/2+this.staffMetrics.tieSingleNoteCenterPadding,(this._leftNsl.noteHeight/4+this.staffMetrics.tieSingleNoteBelowSpacing)*(this._leftNsl.down||null!=this._rightNsl&&this._rightNsl.down?1:-1));var t=this._leftNsl.leftX-this._leftNsl.x+this._leftNsl.noteWidth;return this._leftNsl.noteSet.dots>0?t+=this.staffMetrics.dotSpacing+(this._leftNsl.noteSet.dots-1)*this.staffMetrics.multipleDotGap+(this.horizontalPadding+this.staffMetrics.dotSpacing):t+=this.horizontalPadding,this._leftNsl.hasAlternate&&!this._leftNsl.down&&(t+=this._leftNsl.noteWidth),new If(t,this._spacingY)}},{key:"adjustForLiasonCrossingStem",get:function(){return null!=this._leftNsl&&null!=this._rightNsl&&(!this._leftNsl.down&&this._leftNsl.hasStem&&this._rightNsl.down)}},{key:"rightSpacing",get:function(){if(this.singleNote&&(null!=this._leftNl&&this._leftNl.note.stemless||!this.adjustForLiasonCrossingStem))return new If(-this._rightNsl.noteWidth/2+this.staffMetrics.tieSingleNoteCenterPadding,(this._rightNsl.noteHeight/4+this.staffMetrics.tieSingleNoteBelowSpacing)*(this._rightNsl.down?1:-1));var t=this.horizontalPadding+this._rightNsl.x-this._rightNsl.leftX;return this._rightNsl.hasAlternate&&this._rightNsl.down&&(t+=this._rightNsl.noteWidth),new If(t,this._spacingY)}},{key:"singleNote",get:function(){return this._singleNote}}],[{key:"requireSingleNotePadding",value:function(t){return t==de.SLIDE_LIAISON||t==de.BEND_LIAISON||t==de.GLISSANDO_LIAISON||t==de.PRE_BEND_LIAISON}},{key:"createLiaisonLayout",value:function(t){if(t.noteSet&&t.noteSet.hasArticulation(Sn.LV_TIE_ARTICULATION))return new Ws;switch(t.liaison){case de.TIE_LIAISON:return null!=t.measure&&A.is(t.measure.effectiveClef,$l)&&t.cumulativeBend>0?new Go(de.BEND_LIAISON):new Ws;case de.BEND_LIAISON:case de.PRE_BEND_LIAISON:return new Go(t.liaison);case de.SLIDE_LIAISON:case de.GLISSANDO_LIAISON:return new Ns;default:throw new Error("Unrecognized liaison type: "+t.liaison)}}},{key:"adjustLiaisonSpacing",value:function(t){if(!(t.length<2)){var e,i,n;t[0]._spacingLine>t[1]._spacingLine&&(t=t.slice().reverse());var r=t[0].staffMetrics.tieMinimumVerticalSpacing;for(i=-999,e=0;e<t.length;e++)(n=t[e])._down||(n._spacingLine+n._spacingY<i+r&&(n._spacingY=i+1-n._spacingLine),i=n._spacingLine+n._spacingY);for(i=999,e=t.length-1;e>=0;e--)(n=t[e])._down&&(n._spacingLine+n._spacingY>i-r&&(n._spacingY=i-1-n._spacingLine),i=n._spacingLine+n._spacingY)}}}]),t}();r.registerClass($o,"com.noteflight.notation.layout.LiaisonLayout");var Go=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._bendType=null,i._bendType=t,i}return c(e,$o),p(e,[{key:"doCreateView",value:function(t,e,i,n,r){if(this.calculateAscent(),this._rightNl&&this._rightNl.note.liaison==de.PRE_BEND_LIAISON&&this._pitchDelta<=0&&(this._ascent=0),t.clef.showKey)return new ju(i*this.staffMetrics.lineSpacing+1,-(n+this._dy)*this.staffMetrics.lineSpacing,r*this.staffMetrics.lineSpacing-2,2*-this.tieHeight(r)*this.staffMetrics.lineSpacing,-this._ascent*this.staffMetrics.lineSpacing,this.staffMetrics);if(0===this._ascent){if(this._pitchDelta>0)return i+=t.noteWidth,r-=t.noteWidth,new oh((i+this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(n+this._dy+this.staffMetrics.liaisonVerticalPadding-this.staffMetrics.bendIncreasePadding)*this.staffMetrics.lineSpacing,(r-2*this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(this._ascent-t.clef.lineSpacing-this.staffMetrics.liaisonVerticalPadding+this.staffMetrics.bendIncreasePadding)*this.staffMetrics.lineSpacing,this.staffMetrics,this._bendType);i+=t.noteWidth/2,e.note.tied||(r-=t.noteWidth/2),null==this._rightNl||this._rightNl.note.liaison!=de.BEND_LIAISON&&!this._rightNl.note.tied||(r+=this._rightNsl.noteWidth);var o=e.pitchLine<=(t.clef.numLines-1)*t.clef.lineSpacing?this.staffMetrics.liaisonVerticalPadding:-t.clef.lineSpacing;return new ch(i*this.staffMetrics.lineSpacing,-(n+this._dy+o)*this.staffMetrics.lineSpacing,r*this.staffMetrics.lineSpacing,-this._ascent*this.staffMetrics.lineSpacing,[.5*this.staffMetrics.lineSpacing,.5*this.staffMetrics.lineSpacing],this.staffMetrics)}return this._pitchDelta>0?(i+=t.noteWidth,r-=t.noteWidth,new oh((i+this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(n+this._dy+this.staffMetrics.liaisonVerticalPadding)*this.staffMetrics.lineSpacing,(r-2*this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(this._ascent-t.clef.lineSpacing-this.staffMetrics.liaisonVerticalPadding)*this.staffMetrics.lineSpacing,this.staffMetrics,this._bendType)):(i+=t.noteWidth/2,r-=t.noteWidth/2,new sc((i+this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(n+this._dy-t.clef.lineSpacing)*this.staffMetrics.lineSpacing,(r-2*this.staffMetrics.liaisonHorizontalPadding)*this.staffMetrics.lineSpacing,-(this._ascent+t.clef.lineSpacing+1.25)*this.staffMetrics.lineSpacing,this.staffMetrics))}},{key:"leftSpacing",get:function(){return this._leftNsl.clef.showKey?s(h(e.prototype),"leftSpacing",this):new If(0,0)}},{key:"rightSpacing",get:function(){return this._rightNsl.clef.showKey?s(h(e.prototype),"rightSpacing",this):0!==this._rightNl.note.cumulativeBend&&this._rightNl.note.relativeBend<=0?new If(0,0):new If(-this._rightNsl.noteWidth/2,this._rightNsl.noteHeight/4+this.staffMetrics.tieSingleNoteBelowSpacing)}}]),e}();r.registerClass(Go,"com.noteflight.notation.layout.BendLayout");var Yo=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._displayMode=null,n.leftMargin=0,n.rightMargin=0,n.distanceY=0,n.pageBreakY=0,n.forceReflow=!1,n._uuid=Wd.generateUUID(),n._displayMode=i,n}return c(e,Ro),p(e,[{key:"invalidateSystemStart",value:function(){throw new Error("invalidateSystemStart not overriden")}},{key:"prepareLayout",value:function(){throw new Error("prepareLayout not overriden")}},{key:"createDisplayObject",value:function(t){throw new Error("createDisplayObject not overridden")}},{key:"uuid",get:function(){return this._uuid}},{key:"displayMode",get:function(){return this._displayMode}},{key:"staffMetrics",get:function(){return this.context.staffMetrics}},{key:"pageMetrics",get:function(){return this.context.pageMetrics}},{key:"systemMeasure",get:function(){throw new Error("systemMeasure not overriden")}},{key:"unpaddedHeight",get:function(){throw new Error("unpaddedHeight not overriden")}},{key:"bottomY",get:function(){throw new Error("bottomY not overriden")}},{key:"topPadding",get:function(){throw new Error("topPadding not overriden")}},{key:"bottomPadding",get:function(){throw new Error("bottomPadding not overriden")}},{key:"leftPadding",get:function(){throw new Error("leftPadding not overriden")}},{key:"startMeasureIndex",get:function(){throw new Error("startMeasureIndex not overriden")}},{key:"endMeasureIndex",get:function(){throw new Error("endMeasureIndex not overriden")}},{key:"score",get:function(){throw new Error("score not overriden")}},{key:"height",set:function(t){this._height=t},get:function(){return s(h(e.prototype),"height",this)}}]),e}();r.registerClass(Yo,"com.noteflight.notation.layout.ChunkLayout");var zo=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,"paginated")))._block=null,n._measure=null,n._topPadding=5,n._bottomPadding=5,n._height=-1,n._measure=i,n}return c(e,Yo),p(e,[{key:"getViewElements",value:function(t){for(var e=[],i=this.getColumnsViews(t),n=0;n<i.length;n++)e.push(i[n]);return e}},{key:"getColumnsViews",value:function(t){var e=[];if(this._block)for(var i=0;i<this._block.totalColumns;i++){var n={model:this._block.getColumnAt(i),property:"text",editGroupName:Ou.getString("editor/placeholder.textBlock"),updateTextCallback:this.textUpdated.bind(this)},r=new fc(t,My.LEFT,this.staffMetrics.staffTextFont,this.staffMetrics.partNameSize,n);r.multiline=!0,r.wordWrap=!0;var o=(this.pageMetrics.contentWidth-this.staffMetrics.blockSidesPadding)*this._block.getColumnRatio(i)-this.staffMetrics.blockColumnPadding;r.setTextWidth(o),r.x=this.staffMetrics.blockLeftMargin+(this.pageMetrics.contentWidth-this.staffMetrics.blockSidesPadding)*this._block.accumulatedRatio(i),r.y=this.staffMetrics.blockVerticalPadding,e.push(r)}return e}},{key:"setBlock",value:function(t){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:wa.AFTER_SYSTEM)==wa.AFTER_SYSTEM?this._block=this._measure.blocksPositionedAfterSystem[t]:this._block=this._measure.blocksPositionedBeforeSystem[t]}},{key:"textUpdated",value:function(){this._block&&0===this._block.text.length&&this._measure.removeBlock(this._block)}},{key:"getMeasureIndex",value:function(){return this._measure?this._measure.index:-1}},{key:"invalidateGlobal",value:function(){s(h(e.prototype),"invalidateGlobal",this).call(this)}},{key:"invalidateSystemStart",value:function(){this.invalidate()}},{key:"prepareLayout",value:function(){}},{key:"doValidateLayout",value:function(){}},{key:"doValidateGlobalLayout",value:function(){s(h(e.prototype),"doValidateGlobalLayout",this).call(this)}},{key:"createDisplayObject",value:function(t){return new ah(t,this)}},{key:"block",get:function(){return this._block}},{key:"isFirstBeforeBlockOfMeasure",get:function(){return this.block&&this.block.hasColumnPositionedBeforeSystem&&this.block.uuid==this.systemMeasure.blocksPositionedBeforeSystem[0].uuid}},{key:"isFirstAfterBlockOfMeasure",get:function(){return this.block&&this.block.hasColumnPositionedAfterSystem&&this.block.uuid==this.systemMeasure.blocksPositionedAfterSystem[0].uuid}},{key:"height",get:function(){if(-1==this._height){for(var t=new Ec(null,this.context,null,null,null,null,null,A.booleanToString(!1),{fakeView:!0}),e=this.getViewElements(t),i=0,n=0;n<e.length;n++)i=Math.max(i,e[n].height);this.height=t.toLayoutUnits(i)}return this._height},set:function(t){this._height=t}},{key:"unpaddedHeight",get:function(){return 0}},{key:"bottomY",get:function(){return this.distanceY+this.height+this._bottomPadding}},{key:"topPadding",get:function(){return this._topPadding}},{key:"bottomPadding",get:function(){return this._bottomPadding}},{key:"leftPadding",get:function(){return 0}},{key:"score",get:function(){return this.context.score}},{key:"startMeasureIndex",get:function(){return this.getMeasureIndex()}},{key:"endMeasureIndex",get:function(){return this.getMeasureIndex()+1}},{key:"systemMeasure",get:function(){return this._measure}},{key:"blockHeight",set:function(t){this._height=t}}]),e}();r.registerClass(zo,"com.noteflight.notation.layout.BlockLayout");var Wo=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).nextLayout=null,n.showAnnotations=!0,n.scoreInterval=null,n._measure=null,n._notationLayouts=[],n._notationLayoutMap=new Uy,n._globalLayouts=[],n._firstLayoutOnSystem=!1,n._showBarNumber=!1,n._measureNumberNotation=null,n._lastLayoutOnSystem=!1,n._systemMeasureLayout=null,n._topStaffOnSystem=!1,n._bottomStaffOnSystem=!1,n._topStaffInBarlineGroup=!1,n._bottomStaffInBarlineGroup=!1,n._phantomStartBarline=null,n._minY=NaN,n._maxY=NaN,n._minLyricBelowBaseY=NaN,n._maxLyricAboveBaseY=NaN,n._maxLyricAboveY=NaN,n._minLyricBelowY=NaN,n._lyricLayoutsList=[],n._omitNotationsBeforeEnd=!1,n._omitNotationsAtEnd=!1,n._temporarySpans=[],n.measure=i,n}return c(e,Ro),p(e,null,[{key:"MAX_SPACE_DISPLACEMENT",get:function(){return 9999}},{key:"NO_LYRICS_BELOW_STAFF",get:function(){return 100}},{key:"NO_LYRICS_ABOVE_STAFF",get:function(){return-100}}]),p(e,[{key:"getLyricLayoutsListAboveStaff",value:function(){for(var t=[],e=0;e<this._lyricLayoutsList.length;e++)this._lyricLayoutsList[e].aboveStaff&&t.push(this._lyricLayoutsList[e]);return t}},{key:"removeListeners",value:function(){null!=this._measure&&(this._measure.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange)),this._measure.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate)),null!=this._measure.systemMeasure&&(this._measure.systemMeasure.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange)),this._measure.systemMeasure.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate))))}},{key:"destroyChildren",value:function(){for(var t=0;t<this._notationLayouts.length;t++)this._notationLayouts[t].destroy()}},{key:"destroy",value:function(){s(h(e.prototype),"destroy",this).call(this)}},{key:"addNotationLayout",value:function(t){if(null!=t){var e=t.notation;this._notationLayouts.push(t),this._notationLayoutMap.put(e,t)}}},{key:"getNotationLayoutAt",value:function(t){return this._notationLayouts[t]}},{key:"getLayoutForNotation",value:function(t){return A.unknownToType(this._notationLayoutMap.get(t),Uo)}},{key:"invalidate",value:function(){s(h(e.prototype),"invalidate",this).call(this),null!=this.systemMeasureLayout&&this.systemMeasureLayout.invalidate()}},{key:"handleMeasureSequenceChange",value:function(){this.updateMeasureIndex()}},{key:"updateMeasureIndex",value:function(){this.dispatchEvent(new Ni(Ni.UPDATE_MEASURE_INDEX))}},{key:"buildMeasureNumberLayout",value:function(){var t=new ja(0,this.measure,{invisible:!this.requiresMeasureNumber});t.parent=this.measure.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER),t.textbox=this.context.staffMetrics.barNumberBoxed,t.alignToLeftEdge=!0,this._measureNumberNotation=this.createNotationLayout(t,this.measure.effectiveClef),this.addNotationLayout(this._measureNumberNotation)}},{key:"buildChildLayouts",value:function(){var t,e,i;jd.pushTimer("MeasureLayout","buildChildLayouts"),this.initializeNotationLayouts(),this._measureNumberNotation=null,this.topStaffOnSystem&&this.showBarNumber&&this.buildMeasureNumberLayout();var n=this.measure.effectiveClef,r=0,o=this.measure.measureNotations,s=o.filter(function(t){return A.is(t,Va)}),a=[];s.forEach(function(t){a.push(t.position),a.push(t.endPosition.position+1)});var l=n.sign==Mn.PERCUSSION_CLEF_SIGN;this.needsStaffStartLayout&&this.measure.systemMeasure.startRepeat&&(o=o.slice()).unshift(this.phantomStartBarline);for(var u={},h=0,c=0;c<o.length;c++){if(t=A.unknownToType(o[c],he),A.is(t,Mn)){if(this.measure.overrideClef)continue;n=A.as(t,Mn)}if(A.is(t,Ra)&&a.includes(t.position))for(i=0;i<a.length;i++)a[i]===t.position&&(s[Math.floor(i/2)].requiresDefaultInfo=!0);for(;r<this.measure.systemMeasure.numNotations&&this.measure.systemMeasure.getNotationAt(r).position<=t.position&&(e=this.measure.systemMeasure.getNotationAt(r)).position!=this.measure.duration;)e.showOnlyOnSystemStaff&&!this.topStaffOnSystem||this.addNotationLayout(this.createNotationLayout(e,n)),r++;var d=this.createNotationLayout(t,n);if(this.addNotationLayout(d),A.is(d,Vo)){var f=A.unknownToType(d,Vo),y=A.unknownToType(t,Sn);if(y.invisible&&u[y.voiceNumber]?(h--,u[y.voiceNumber]=!1):y.invisible||u[y.voiceNumber]||(h++,u[y.voiceNumber]=!0),f.multiVoice=h>1||l&&A.is(f,_s)||y.invisible&&this.measure.numVoices>1,y.voiceNumber>=1&&c>0)for(i=c;--i>=0;){var g=A.as(this._notationLayoutMap.get(o[i]),Vo);if(null!=g){if(g.noteSet.position<t.position)break;if(0===g.noteSet.voiceNumber&&g.noteSet.position==t.position){g.multiVoice=!y.invisible,g.alternateVoiceLayout=f,f.alternateVoiceLayout=g;break}}}var p=!0,m=!1,v=void 0;try{for(var _,S=y.lyrics[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value;A.is(f,rs)&&this.addNotationLayout(new fs(f,L))}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}}}for(;r<this.measure.systemMeasure.numNotations;)(e=this.measure.systemMeasure.getNotationAt(r++)).showOnlyOnSystemStaff&&!this.topStaffOnSystem||this.addNotationLayout(this.createNotationLayout(e,n));if(this._omitNotationsAtEnd){var k=new En(this.measure.duration,En.INVISIBLE);k.parent=this.measure.getVoiceNumber(0),this.addNotationLayout(new Bo(this.context,this,k,n))}jd.popTimer("MeasureLayout","buildChildLayouts")}},{key:"buildGlobalLayouts",value:function(){this._globalLayouts=[],this.measure.effectiveClef.showRhythm(this.context.score)?(this.determineBeamsAndStems(),this.determineTuplets()):A.is(this.measure.effectiveClef,$l)&&this.determineTabStems()}},{key:"initializeNotationLayouts",value:function(){var t;this.destroyChildren(),this._notationLayouts=[],this._notationLayoutMap=new Uy,this.scoreInterval=this.measure.scoreInterval,this._omitNotationsBeforeEnd=this._omitNotationsAtEnd=!1,this.customMultiRestsEnabled&&(t=this.measure.multiRest)!=hl.MULTI_REST_NONE?(this._omitNotationsAtEnd=t>0,this._omitNotationsBeforeEnd=t==hl.MULTI_REST_END):this.autoMultiRestsEnabled&&(this.isFirstMeasureOfMultiRest?this._omitNotationsAtEnd=!0:this.isLastMeasureOfMultiRest&&(this._omitNotationsBeforeEnd=!0))}},{key:"determineBeamsAndStems",value:function(){for(var t=0;t<this.measure.numVoices;t++)this.determineVoiceBeamsAndStems(t,!1),this.determineVoiceBeamsAndStems(t,!0)}},{key:"determineVoiceBeamsAndStems",value:function(t,e){var i=null,n=!0,r=!1,o=void 0;try{for(var s,a=this._notationLayouts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(A.is(l,rs)&&l.notation.voiceNumber==t){var u=A.as(l,rs),h=u.noteSet;if(h.grace!=e)continue;var c=u.direction;null!=c?(u.down=c==he.DIRECTION_DOWN,null!=i&&i.getBeamableLayoutAt(0).down!=u.down&&(i.numBeamableLayouts>1&&(i.setUpBeam(),this._globalLayouts.push(i)),i=null)):u.multiVoice?u.down=l.notation.voiceNumber>0:u.clef.defaultStemsUp?u.down=!1:u.down=u.stemmingLine>=u.clef.centerLine,u.stemLength=u.standardStemLength,(h.beam||h.tremoloDyad&&0===h.rhythmPosition)&&h.canShowBeam&&(u.hasStem||A.is(u,Cs)||h.tremoloDyad)&&Math.round(h.position+h.duration)<this.measure.duration&&(!e||null!=h.nextGraceNote)?(null==i&&(i=new Ho(this.context)),i.addBeamableLayout(u)):null!=i&&(h.canShowBeam&&i.addBeamableLayout(u),i.numBeamableLayouts>1&&(i.setUpBeam(),this._globalLayouts.push(i)),i=null)}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"determineTabStems",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._notationLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(A.is(o,rs)){var s=A.unknownToType(o,rs);null!=s.direction&&(s.down=s.direction==he.DIRECTION_DOWN)}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"determineTuplets",value:function(){for(var t=0;t<this.measure.numVoices;t++)this.determineRhythmContextTuplets(this.measure.getVoiceNumber(t))}},{key:"determineRhythmContextTuplets",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t.elements[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,ue);A.is(a,Ha)&&(this.determineRhythmContextTuplets(A.as(a,Ha)),A.is(a,Xl)&&this.createTupletLayout(A.as(a,Xl)))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"createTupletLayout",value:function(t){var e=new Ks(this.context,t),i=!0,n=!0,r=!1,o=void 0;try{for(var s,a=this._notationLayouts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(!(i&&A.is(l,_s)&&A.unknownToType(l,_s).noteSet.grace)&&(A.is(l,rs)&&l.notation.inRhythmContext(t))){var u=A.as(l,rs);e.addBeamableLayout(u),u.tupletLayout=e,i=!1}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}0!==e.numBeamableLayouts&&(e.setUpTuplet(),this._globalLayouts.push(e))}},{key:"createNotationLayout",value:function(t,e){if(this._omitNotationsBeforeEnd&&t.position<this.measure.duration||this._omitNotationsAtEnd&&t.position==this.measure.duration)return null;if(A.is(t,Mn))return t.position==this.measure.duration&&this.lastLayoutOnSystem&&this.measure.systemMeasure.disableCautionaries?null:new qo(this.context,this,A.as(t,Mn),!0);if(A.is(t,En))return new Bo(this.context,this,A.as(t,En),e);if(A.is(t,Gl))return new Ys(this.context,this,A.as(t,Gl),e);if(A.is(t,vl))return new ps(this.context,this,A.as(t,vl),e);if(A.is(t,Sn)){var i=A.as(t,Sn);return i.notes.length>0?new _s(this.context,this,i,e):new Cs(this.context,this,i,e)}if(A.is(t,zl))return e.isTab()&&!this.context.score.effectiveStaffMetrics.showTabRhythm&&this._systemMeasureLayout&&!this._systemMeasureLayout.hasNonTabClefs()?null:new Xs(this.context,this,A.as(t,zl),e);if(A.is(t,Ga)){if(t.position==this.measure.duration&&this.lastLayoutOnSystem&&this.measure.systemMeasure.disableCautionaries)return null;var n,r=A.as(t,Ga);if(!this.scoreInterval.octaveMultiple)n=t.position==this.measure.duration&&this.measure.index+1<this.measure.staff.numChildren?this.measure.staff.getMeasureAt(A.intToUint(this.measure.index+1)).scoreInterval:this.scoreInterval,r=r.transposeFifths(n.fifths);return new os(this.context,this,A.as(t,Ga),r,e)}if(A.is(t,Yl))return new zs(this.context,this,A.as(t,Yl),e);if(A.is(t,Aa)){var o=A.as(t,Aa);return new jo(this.context,this,o,o.transposeInterval(this.scoreInterval),e)}if(A.is(t,Ra))return new Jo(this.context,this,A.as(t,Ra),e);if(A.is(t,bl))return new Ms(this.context,this,A.as(t,bl),e);if(A.is(t,ja))return new as(this.context,this,A.as(t,ja),e);if(A.is(t,Ka))return new ss(this.context,this,A.as(t,Ka),e);if(A.is(t,Ua))return null;if(A.is(t,Oa))return new Vs(this.context,this,t,Vs.CODA_TYPE,e);if(A.is(t,Il))return new Vs(this.context,this,t,Vs.SEGNO_TYPE,e);throw new Error("Unhandled notation object in MeasureLayout: "+t)}},{key:"forceZeroWidthLayout",value:function(){this.leftConstraint=new ia([new ra(0)]),this._constraint=new ia([this.leftConstraint]),this._notationLayouts=[],this._globalLayouts=[],this._minLyricBelowBaseY=0,this._maxLyricAboveBaseY=0}},{key:"doValidateLayout",value:function(){var t,i,n;if(this._temporarySpans=[],this.destroyChildren(),jd.pushTimer("MeasureLayout","doValidateLayout"),this._width=0,this.customMultiRestsEnabled&&this.measure.multiRest==hl.MULTI_REST_BODY)return this.forceZeroWidthLayout(),void jd.popTimer("MeasureLayout","doValidateLayout");if(this.autoMultiRestsEnabled&&this.measure.multiRest==hl.MULTI_REST_NONE)if(this.isFirstMeasureOfMultiRest)(t=kl.createMultiRest(A.numberToInt(this.autoMultiRestNumberMeasures))).enabled=!1,t.dy=this.measure.effectiveClef.staffHeight/2,t.parent=this.measure.getVoiceAt(0),t.span=this.autoMultiRestTotalDuration-1,t.rhythmPosition=0,this._temporarySpans.push(t);else if(this.isBodyOfMultiRestButNotLastOne)return this.forceZeroWidthLayout(),void jd.popTimer("MeasureLayout","doValidateLayout");this._minLyricBelowBaseY=e.NO_LYRICS_BELOW_STAFF,this._maxLyricAboveBaseY=e.NO_LYRICS_ABOVE_STAFF,this.buildChildLayouts(),this.buildGlobalLayouts();var r=[],o=!1,s=!1,a=!0,l=!1,u=void 0;try{for(var h,c=this._notationLayouts[Symbol.iterator]();!(a=(h=c.next()).done);a=!0)(i=h.value).validateLayout(),A.is(i,fs)&&((n=A.unknownToType(i,fs)).aboveStaff?(this._maxLyricAboveBaseY=Math.max(this._maxLyricAboveBaseY,n.baseY),s=!0):(this._minLyricBelowBaseY=Math.min(this._minLyricBelowBaseY,n.baseY),o=!0),r.push(i))}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}if(r.length>0){var d=r[0].height,f=!0,y=!1,g=void 0;try{for(var p,m=this._notationLayouts[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)i=p.value,A.is(i,rs)&&(o&&(this._minLyricBelowBaseY=Math.min(this._minLyricBelowBaseY,A.unknownToType(i,rs).lyricExclusionBottom-this.context.staffMetrics.lyricsNotesPadding-this.context.staffMetrics.lyricsAscent*d)),s&&(this._maxLyricAboveBaseY=Math.max(this._maxLyricAboveBaseY,A.unknownToType(i,rs).lyricExclusionTop+this.context.staffMetrics.lyricsNotesPadding+this.context.staffMetrics.lyricsDescent*d)))}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}this._constraint=this.leftPaddingConstraint;var v=new P(this),_=-1;this._lyricLayoutsList=[];var S=!0,L=!1,k=void 0;try{for(var T,E=this._notationLayouts[Symbol.iterator]();!(S=(T=E.next()).done);S=!0)i=T.value,A.is(i.notation,mn)&&i.notation.voiceNumber>=0&&!i.notation.marking?this.constrainValueNotation(v,i):A.is(i.notation,Aa)&&this.context.staffMetrics.keepChordSymbolsApart&&i.notation.voiceNumber==Kl.NON_METRICAL_VOICE_NUMBER&&!i.notation.measure.isSystemMeasure&&i.notation.position>_&&i.notation.position<this.measure.duration?(this.constrainChordSymbolNotation(v,i),_=i.notation.position):i.notation.marking?this.constrainMarkingNotation(v,i):A.is(i.notation,ul)?this.constrainLyricNotation(v,A.as(i,fs)):this.constrainNonVoiceNotation(v,i)}catch(t){L=!0,k=t}finally{try{S||null==E.return||E.return()}finally{if(L)throw k}}var M=this.getMaxVoicesConstraint(v),b=!0,w=!1,x=void 0;try{for(var C,N=v.rootConstraints[Symbol.iterator]();!(b=(C=N.next()).done);b=!0){var I=C.value;M.addScaleDependent(I)}}catch(t){w=!0,x=t}finally{try{b||null==N.return||N.return()}finally{if(w)throw x}}this.leftConstraint=M,this._constraint=new ia([this.leftConstraint]),this._height=this.measure.effectiveClef.staffHeight;var O=!0,Q=!1,R=void 0;try{for(var D,F=this._globalLayouts[Symbol.iterator]();!(O=(D=F.next()).done);O=!0){var U=D.value;A.unknownToType(U,Ro).validateLayout()}}catch(t){Q=!0,R=t}finally{try{O||null==F.return||F.return()}finally{if(Q)throw R}}if(r.length>0){if(null!=this.measure.staff){var V=!0,B=!1,H=void 0;try{for(var $,G=this.measure.staff.getSpanNotations(this.measure.index)[Symbol.iterator]();!(V=($=G.next()).done);V=!0)(t=$.value).transposable&&(ts.ensureSpanDefaulted(t,this.context),this._minLyricBelowBaseY=Math.min(this._minLyricBelowBaseY,t.bottom-this.context.staffMetrics.lyricsNotesPadding),this._maxLyricAboveBaseY=Math.max(this._maxLyricAboveBaseY,t.top+this.context.staffMetrics.lyricsNotesPadding))}catch(t){B=!0,H=t}finally{try{V||null==G.return||G.return()}finally{if(B)throw H}}}for(var Y=0;Y<r.length;Y++)(n=r[Y]).aboveStaff?n.baseY=this._maxLyricAboveBaseY:n.baseY=this._minLyricBelowBaseY}jd.popTimer("MeasureLayout","doValidateLayout")}},{key:"constrainValueNotation",value:function(t,i){var n=i.notation.voiceNumber.toString();if(i.leftConstraint=new oa([new ra(i.originX),t.voiceConstraints[n]]),i.floating?(t.voiceConstraints[n]=new oa([t.voiceConstraints[n],new ra(i.width)]),this._constraint=new oa([]),i.constraint=this._constraint,i.leftConstraint=this._constraint,t.rootConstraints.push(i.constraint)):(this._constraint=new ia([i.leftConstraint]),i.constraint=this._constraint,t.voiceConstraints[n]=new oa([i.constraint,new ra(i.width-i.originX)])),null!=t.floatingCombinedLayout&&null==t.floatingLayouts[n]){var r=new na([]);for(var o in t.floatingLayouts){var s=new oa([new ra(e.MAX_SPACE_DISPLACEMENT)]);t.rootConstraints.push(s),r.addConstraint(s),t.floatingLayouts[o]=new N(t.floatingCombinedLayout.layout,s)}t.floatingCombinedLayout.layout.constraint=t.floatingCombinedLayout.layout.leftConstraint=r,t.floatingCombinedLayout=null}if(null!=t.floatingLayouts[n]){var a=A.as(t.floatingLayouts[n],N);A.as(a.constraint,oa).constraints=[i.constraint,new ra(-(i.originX+a.layout.width-a.layout.originX))],t.floatingLayouts[n]=null}i.floating&&(t.floatingLayouts[n]=new N(i,i.constraint))}},{key:"constrainChordSymbolNotation",value:function(t,e){t.lastChordSymbol&&t.lastChordSymbol.layout?e.leftConstraint=new oa([new ra(e.originX),t.lastChordSymbol.constraint]):null!=t.lastBarline?e.leftConstraint=new oa([new ra(e.originX),t.lastBarline]):e.leftConstraint=new ra(e.originX),e.constraint=new ia([e.leftConstraint]),t.lastChordSymbol=new N(e,new oa([e.constraint,new ra(e.width-e.originX)]))}},{key:"constrainMarkingNotation",value:function(t,e){e.leftConstraint=this.leftPaddingConstraint,e.constraint=new ia([e.leftConstraint]),t.rootConstraints.push(e.constraint)}},{key:"constrainLyricNotation",value:function(t,e){var i=e.lyric,n=i.line.toString();this._lyricLayoutsList.push(e);var r=null;null!=t.lastLyrics[n]&&(r=A.as(t.lastLyrics[n].layout,fs)).lyric.extend&&(this._globalLayouts.push(new ds(this.context,r,e,!1)),this.invalidateGlobal()),null!=r&&r.lyric.position<i.position?e.leftConstraint=new oa([new ra(e.originX),t.lastLyrics[n].constraint]):null!=t.lastBarline?e.leftConstraint=new oa([new ra(e.originX),t.lastBarline]):e.leftConstraint=new ra(e.originX),e.constraint=new ia([e.leftConstraint]),t.lastLyrics[n]=new N(e,new oa([e.constraint,new ra(e.width-e.originX)]))}},{key:"getMaxVoicesConstraint",value:function(t){var e=new ia([]);for(var i in t.voiceConstraints)e.addConstraint(t.voiceConstraints[i]);return e}},{key:"constrainNonVoiceNotation",value:function(t,e){var i,n,r,o=this.getMaxVoicesConstraint(t);if(A.is(e.notation,En))for(i in t.lastLyrics)if(o.addConstraint(t.lastLyrics[i].constraint),null!=t.lastLyrics[i].layout){var s=A.as(t.lastLyrics[i].layout,fs);s.lyric.extend&&(this._globalLayouts.push(new ds(this.context,s,null,!0)),this.invalidateGlobal())}if(e.leftConstraint=new oa([new ra(e.originX),o]),this._constraint=new ia([e.leftConstraint]),e.constraint=this._constraint,e.floating){for(n in r=new oa([o,new ra(e.width)]),t.voiceConstraints)t.voiceConstraints[n]=r;this._constraint=e.constraint=e.leftConstraint=new oa([]),t.rootConstraints.push(e.constraint)}else for(n in this._constraint=e.constraint=new ia([e.leftConstraint]),r=new oa([e.constraint,new ra(e.width-e.originX)]),t.voiceConstraints)t.voiceConstraints[n]=r;if(null!=t.floatingCombinedLayout){var a=t.floatingCombinedLayout;A.as(a.constraint,oa).constraints=[e.constraint,new ra(-(e.originX+a.layout.width-a.layout.originX))],t.floatingCombinedLayout=null}if(A.is(e.notation,En))for(i in t.lastBarline=new oa([e.constraint,new ra(e.width-e.originX)]),t.lastLyrics)t.lastLyrics[i].constraint=t.lastBarline;e.floating&&(t.floatingCombinedLayout=new N(e,e.constraint))}},{key:"invalidateGlobal",value:function(){s(h(e.prototype),"invalidateGlobal",this).call(this);var t=!0,i=!1,n=void 0;try{for(var r,o=this._globalLayouts[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;A.unknownToType(a,Ro).invalidateGlobal()}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}var l=!0,u=!1,c=void 0;try{for(var d,f=this._notationLayouts[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){d.value.invalidateGlobal()}}catch(t){u=!0,c=t}finally{try{l||null==f.return||f.return()}finally{if(u)throw c}}}},{key:"doValidateGlobalLayout",value:function(){var t,i,n;s(h(e.prototype),"doValidateGlobalLayout",this).call(this),this._minY=100,this._maxY=-100,this._minLyricBelowY=e.NO_LYRICS_BELOW_STAFF,this._maxLyricAboveY=e.NO_LYRICS_ABOVE_STAFF;var r,o,a=!0,l=!1,u=void 0;try{for(var c,d=this._globalLayouts[Symbol.iterator]();!(a=(c=d.next()).done);a=!0)n=c.value,i=A.unknownToType(n,Ro),A.is(i,Ho)&&i.validateGlobalLayout()}catch(t){l=!0,u=t}finally{try{a||null==d.return||d.return()}finally{if(l)throw u}}var f=!0,y=!1,g=void 0;try{for(var p,m=this._notationLayouts[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)if(!(r=p.value).notation.excludeFromPositioning&&(r.validateGlobalLayout(),this.dynamicVerticalPad)){if(t=r.bounds,A.is(r,fs)){if(""===(o=A.unknownToType(r,fs)).lyric.text)continue;o.aboveStaff?this._maxLyricAboveY=Math.max(this._maxLyricAboveY,t.bottom):this._minLyricBelowY=Math.min(this._minLyricBelowY,t.top)}this._minY=Math.min(this._minY,t.top),this._maxY=Math.max(this._maxY,t.bottom)}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}var v=!0,_=!1,S=void 0;try{for(var L,k=this._globalLayouts[Symbol.iterator]();!(v=(L=k.next()).done);v=!0)n=L.value,i=A.unknownToType(n,Ro),A.is(i,Ho)||i.validateGlobalLayout(),this.dynamicVerticalPad&&(t=i.bounds,this._minY=Math.min(this._minY,t.top),this._maxY=Math.max(this._maxY,t.bottom))}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}}},{key:"createMeasureView",value:function(t,e){return this.validateGlobalLayout(),new Uh(t,this,e)}},{key:"getMeasurePositionX",value:function(t,i,n){return i?e.computeMeasurePositionX(this.notationLayouts,t,!0,n):null!=this.systemMeasureLayout?this.systemMeasureLayout.getMeasurePositionX(t):0}},{key:"getMeasureXPosition",value:function(t,i,n,r,o){return n?e.computeMeasureXPosition(this.notationLayouts,t,i,!0,r,o):null!=this.systemMeasureLayout?this.systemMeasureLayout.getMeasureXPosition(t,i,r):0}},{key:"getEntryNotation",value:function(t,e){var i=null,n=!0,r=!1,o=void 0;try{for(var s,a=this._notationLayouts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(A.is(l.notation,mn)&&l.notation.voiceNumber==e){if(l.centered)return l;if(t<Math.max(0,l.x-this.context.staffMetrics.mouseNotationPadding))break;i=l}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}if(A.is(i,_s)){var u=A.as(i,_s);if(null==u.clef.tabStemDirection&&(u.down&&t<u.leftX+this.context.staffMetrics.mouseNoteEntryStemMargin||!u.down&&t>u.leftX+u.noteWidth-this.context.staffMetrics.mouseNoteEntryStemMargin))return null}return i}},{key:"handleMeasureChange",value:function(t){this.invalidate()}},{key:"handleMeasureUpdate",value:function(t){A.is(t.source,Ua)||"tempo"!=t.property&&this.invalidate()}},{key:"getScoreNote",value:function(t){return this.measure.getScoreNote(t,this.scoreInterval)}},{key:"topPadding",get:function(){return this.dynamicVerticalPad?Math.max(0,this._maxY-this.measure.effectiveClef.staffHeight):0}},{key:"bottomPadding",get:function(){return this.dynamicVerticalPad?Math.max(0,-this._minY):0}},{key:"minLyricBelowBaseY",get:function(){return this._minLyricBelowBaseY}},{key:"maxLyricAboveBaseY",get:function(){return this._maxLyricAboveBaseY}},{key:"bottomLyricY",get:function(){return this.dynamicVerticalPad?this._minLyricBelowY:e.NO_LYRICS_BELOW_STAFF}},{key:"topLyricY",get:function(){return this.dynamicVerticalPad?this._maxLyricAboveY:e.NO_LYRICS_ABOVE_STAFF}},{key:"lyricLayoutsList",get:function(){return this._lyricLayoutsList}},{key:"measure",get:function(){return this._measure},set:function(t){this.destroy(),this._measure=t,null!=this._measure&&(this._measure.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange)),this._measure.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate)),null!=this._measure.systemMeasure&&(this._measure.systemMeasure.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange)),this._measure.systemMeasure.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate))))}},{key:"temporarySpans",get:function(){return this._temporarySpans}},{key:"notationLayouts",get:function(){return this._notationLayouts}},{key:"globalLayouts",get:function(){return this._globalLayouts}},{key:"systemMeasureLayout",get:function(){return this._systemMeasureLayout},set:function(t){this._systemMeasureLayout=t}},{key:"firstLayoutOnSystem",get:function(){return this._firstLayoutOnSystem},set:function(t){t!=this._firstLayoutOnSystem&&(this._firstLayoutOnSystem=t,this.invalidate())}},{key:"lastLayoutOnSystem",get:function(){return this._lastLayoutOnSystem},set:function(t){t!=this._lastLayoutOnSystem&&(this._lastLayoutOnSystem=t,this.invalidate())}},{key:"showBarNumber",set:function(t){this._showBarNumber=t},get:function(){return this._showBarNumber}},{key:"topStaffOnSystem",get:function(){return this._topStaffOnSystem},set:function(t){t!=this._topStaffOnSystem&&(this._topStaffOnSystem=t,this.invalidate())}},{key:"bottomStaffOnSystem",get:function(){return this._bottomStaffOnSystem},set:function(t){t!=this._bottomStaffOnSystem&&(this._bottomStaffOnSystem=t,this.invalidate())}},{key:"topStaffInBarlineGroup",get:function(){return this._topStaffInBarlineGroup},set:function(t){t!=this._topStaffInBarlineGroup&&(this._topStaffInBarlineGroup=t,this.invalidate())}},{key:"bottomStaffInBarlineGroup",get:function(){return this._bottomStaffInBarlineGroup},set:function(t){t!=this._bottomStaffInBarlineGroup&&(this._bottomStaffInBarlineGroup=t,this.invalidate())}},{key:"needsStaffStartLayout",get:function(){return this.firstLayoutOnSystem||this.measure.previousMeasure&&this.measure.previousMeasure.effectiveSystemMeasure.systemGap}},{key:"showHandle",get:function(){return!this.isMultiRest||this.isFirstMeasureOfMultiRest}},{key:"requiresMeasureNumber",get:function(){return!this.firstLayoutOnSystem&&this.topStaffOnSystem&&this.showBarNumber}},{key:"multiRestsEnabled",get:function(){return this.customMultiRestsEnabled&&this.measure.multiRest!=hl.MULTI_REST_NONE||this.autoMultiRestsEnabled&&this.measure.autoMultiRest(!1)!=hl.MULTI_REST_NONE}},{key:"customMultiRestsEnabled",get:function(){return null!=this.systemMeasureLayout&&this.systemMeasureLayout.singlePart}},{key:"autoMultiRestsEnabled",get:function(){return null!=this.systemMeasureLayout&&this.context.staffMetrics.autoMultiMeasureRestCreation}},{key:"isMultiRest",get:function(){return!(!this.customMultiRestsEnabled||this.measure.multiRest==hl.MULTI_REST_NONE)||this.autoMultiRestsEnabled&&(this.isFirstMeasureOfMultiRest||this.isLastMeasureOfMultiRest||this.isBodyOfMultiRestButNotLastOne)}},{key:"isFirstMeasureOfMultiRest",get:function(){if(this.customMultiRestsEnabled&&this.measure.multiRest>0)return!0;if(!this.autoMultiRestsEnabled||null==this.systemMeasureLayout.measureLayouts)return!1;for(var t=0,e=0;e<this.systemMeasureLayout.measureLayouts.length;e++){var i=this.systemMeasureLayout.measureLayouts[e].measure.autoMultiRest(!1);if(i==hl.MULTI_REST_NONE||i==hl.MULTI_REST_END)return!1;t=Math.max(i,t)}return t>1}},{key:"isLastMeasureOfMultiRest",get:function(){if(null==this.systemMeasureLayout.measureLayouts)return!1;if(this.customMultiRestsEnabled&&this.measure.multiRest==hl.MULTI_REST_END)return!0;for(var t=!1,e=0;e<this.systemMeasureLayout.measureLayouts.length;e++){var i=this.systemMeasureLayout.measureLayouts[e].measure;if(i.autoMultiRestLastMeasure)t=!0;else if(i.autoMultiRest(!1)>=0)return!1}return t}},{key:"isBodyOfMultiRestButNotLastOne",get:function(){if(null==this.systemMeasureLayout.measureLayouts)return!1;if(this.customMultiRestsEnabled&&this.measure.multiRest==hl.MULTI_REST_BODY)return!0;for(var t=0;t<this.systemMeasureLayout.measureLayouts.length;t++){var e=this.systemMeasureLayout.measureLayouts[t].measure;if(!e.autoMultiRestNotFirstMeasure||e.autoMultiRestLastMeasure)return!1}return!0}},{key:"autoMultiRestNumberMeasures",get:function(){for(var t=99999999999,e=0;e<this.systemMeasureLayout.measureLayouts.length;e++)t=Math.min(t,this.systemMeasureLayout.measureLayouts[e].measure.numberAutoMultiMeasureRests());return t}},{key:"autoMultiRestTotalDuration",get:function(){for(var t=9999999999,e=0;e<this.systemMeasureLayout.measureLayouts.length;e++)t=Math.min(t,this.systemMeasureLayout.measureLayouts[e].measure.durationAutoMultiMeasureRests);return t}},{key:"leftPaddingConstraint",get:function(){return new ra(this.context.staffMetrics.barStartPaddingLeft)}},{key:"valueBounds",get:function(){var t,e,i=0;for(e=0;e<this.notationLayouts.length&&(t=this.getNotationLayoutAt(e),!(A.is(t.notation,mn)||t.notation.position>0));e++)t.notation.hasValueConstraint||(i=t.x-t.originX+t.width);var n=this.x;for(e=this.notationLayouts.length-1;e>=0&&(t=this.getNotationLayoutAt(e),!(A.is(t.notation,mn)||t.notation.position<this.measure.duration));e--)t.notation.hasValueConstraint||(n=t.x);return new Qo(i,0,n-i,0)}},{key:"phantomStartBarline",get:function(){var t=this._phantomStartBarline;return null==t&&(t=new En(0,En.INITIAL),this._phantomStartBarline=t,t.parent=this.measure.systemMeasure.getVoiceAt(0)),this._phantomStartBarline}},{key:"dynamicVerticalPad",get:function(){return this.context.score.effectiveStaffMetrics.verticalAutoSpace}}],[{key:"computeMeasurePositionX",value:function(t,i,n,r){var o=null,s=null,a=!0,l=!1,u=void 0;try{for(var h,c=t[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,Uo);if(A.is(f.notation,En)&&f.notation.position>0&&null==s&&(s=f),!e.ignorePosition(f.notation,n,!1,r)){if(f.notation.position>i){s=f;break}o=f}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}if(null==o)return 0;if(null!=s){var y=o.x,g=s.x,p=o.notation.position;return y+(g-y)*(i-p)/(s.notation.position-p)}return o.x}},{key:"getNotationPositions",value:function(t,i,n,r){var o=[],s=NaN,a=!0,l=!1,u=void 0;try{for(var h,c=t[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,Uo);e.ignorePosition(f.notation,i,n,r)||f.x==s||(o.push({x:f.x,position:f.notation.position}),s=f.x)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}return o}},{key:"computeMeasureXPosition",value:function(t,i,n,r,o,s){var a=null,l=null,u=!0,h=!1,c=void 0;try{for(var d,f=t[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=A.unknownToType(y,Uo);if(A.is(g.notation,En)&&g.notation.position>0&&null==l&&(l=g),!(e.ignorePosition(g.notation,r,o,s)||o&&g.notation.position==g.notation.measure.duration)){if(g.x>i){l=g;break}a=g}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}if(null==a)return 0;if(null!=l){var p=a.x,m=l.x,v=a.notation.position,_=l.notation.position;if(n>0){var S=l.notation.position-a.notation.position,L=Math.min(a.notation.measure.timeSignature.beatDuration,n);if(S>L){var k=S*(i-p)/(m-p),T=Math.floor(k/L);v+=T*L,o&&v==a.notation.measure.duration&&(v=Math.max(0,v-L)),p+=T*L*(m-p)/S}}return Math.abs(i-p)<Math.abs(i-m)||o&&A.is(l.notation,En)?v:_}return a.notation.position}},{key:"ignorePosition",value:function(t,e,i,n){if(null==t.measure||t.excludeFromPositioning||A.is(t,ul))return!0;if(i&&A.is(t,En))return!0;if(n>=0&&t.voiceNumber!=n)return!0;var r=A.as(t,Sn);return null==r?!t.metrical:e?null!=r.previousGraceNote:r.grace}}]),e}();r.registerClass(Wo,"com.noteflight.notation.layout.MeasureLayout");var Xo=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t,i))).needTime=!1,s._topStaff=!1,s._topStaff=o,s._sysEndMeasure=n,s._sysNextMeasure=r,s}return c(e,Wo),p(e,[{key:"buildChildLayouts",value:function(){if(this.initializeNotationLayouts(),this.needed){var t=this.measure.systemMeasure.timeSignatureNotation;this.addNotationLayout(this.createNotationLayout(t,this.measure.effectiveClef))}}},{key:"doValidateLayout",value:function(){s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"buildGlobalLayouts",value:function(){this._globalLayouts=[]}},{key:"createMeasureView",value:function(t,i){var n=s(h(e.prototype),"createMeasureView",this).call(this,t,i);return n.highlightEnabled=!1,n}},{key:"handleMeasureChange",value:function(t){}},{key:"needed",get:function(){return null!=this._sysNextMeasure.timeSignatureNotation&&null!=this.measure.systemMeasure.timeSignatureNotation&&!this._sysNextMeasure.baseTimeSignature.sameTimeProperties(this._sysEndMeasure.baseTimeSignature)}}]),e}();r.registerClass(Xo,"com.noteflight.notation.layout.CautionaryLayout");var Ko=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t,i,n,r)))._scale=1,s._x=0,s._y=0,s._globalX=0,s._globalY=0,s._textGlyphHeight=0,s._totalTextGliphHeight=0,s._currentLine=0,s._firstGlyphInCurrentLine=0,s._format=null,s._format=s.createTextFormat(),n.alignToStaffTop?(s.padding=o.clone(),s.padding.y-=r.staffHeight):s.padding=o,s}return c(e,Uo),p(e,[{key:"addGlyph",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new Zo(this.context,t);n.scale=this._scale,i&&(this._x=0,this._currentLine++,this._firstGlyphInCurrentLine=this._glyphLayouts.length);var r=A.numberToInt(this._format.size)*this._scale/this.context.staffMetrics.lineSpacing;this._textGlyphHeight=this._textGlyphHeight<r?r:this._textGlyphHeight,this._globalY=this.distanceY-this._currentLine*this._textGlyphHeight,n.distanceX=this._x+this.textNotation.dxForViewId(this.notation.customizationForViewId),n.distanceY=this._globalY;var o=n.width+(X.isNaN(e)?this.glyphGap:e);switch(this._x+=o,this._globalX=this._x>this._globalX?this._x:this._globalX,this.textNotation.justify){case Ca.JUSTIFY_CENTER:n.horizontalAnchor=Zo.ANCHOR_CENTER;break;case Ca.JUSTIFY_RIGHT:for(var s=this._firstGlyphInCurrentLine;s<this._glyphLayouts.length;s++)this._glyphLayouts[s].distanceX-=o;n.distanceX=this.textNotation.dxForViewId(this.notation.customizationForViewId)-n.width,n.horizontalAnchor=Zo.ANCHOR_LEFT;break;default:n.verticalAnchor=Zo.ANCHOR_BOTTOM}return this.addGlyphLayout(n),t}},{key:"addNoteGlyph",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.foundry.getTempo(t,e,!1);return this._y+=2,this.addGlyph(i),this._y-=2,i}},{key:"addSymbolGlyph",value:function(t){var e=this.foundry.getSymbol(t);this._scale*=this.context.staffMetrics.symbolScale;var i=e.height*this._scale/this.context.staffMetrics.lineSpacing;return this._y+=i,this.addGlyph(e),this._y-=i,this._scale/=this.context.staffMetrics.symbolScale,e}},{key:"addEscapedTextGlyphs",value:function(t){for(var e=0;e<2;e++)t=(t=(t=t.replace(/(^|\s|\n|\r)+([A-G])b([0-9])?($|\s|\n|\r)+/g,"$1$2{flat}$3$4")).replace(/(^|\s|\n|\r)+([A-G])#([0-9])?($|\s|\n|\r)+/g,"$1$2{sharp}$3$4")).replace(/(^|\s|\n|\r)+([A-G])=([0-9])?($|\s|\n|\r)+/g,"$1$2{natural}$3$4");for(;t.length>0;){var i=/\{([a-zA-Z0-9\-\ ]+)\}/.exec(t);if(null==i){this.manageTextGlyphs(t);break}switch(i.index>0&&this.manageTextGlyphs(t.substring(0,i.index)),i[1]){case"coda":case"segno":this.addSymbolGlyph(i[1]);break;case"flat":this.addGlyph(this.foundry.getChordSymbol("@"));break;case"sharp":this.addGlyph(this.foundry.getChordSymbol("#"));break;case"natural":this.addGlyph(this.foundry.getChordSymbol("$"));break;case"double flat":this.addGlyph(this.foundry.getChordSymbol("%"));break;case"double sharp":this.addGlyph(this.foundry.getChordSymbol("*"));break;case"sixteenth":case"16th":this.addNoteGlyph(mn.SIXTEENTH);break;case"eighth":case"8th":this.addNoteGlyph(mn.EIGHTH);break;case"quarter":this.addNoteGlyph(mn.QUARTER);break;case"half":this.addNoteGlyph(mn.HALF);break;case"whole":this.addNoteGlyph(mn.WHOLE);break;case"dotted sixteenth":case"dotted 16th":this.addNoteGlyph(mn.SIXTEENTH,!0);break;case"dotted eighth":case"dotted 8th":this.addNoteGlyph(mn.EIGHTH,!0);break;case"dotted quarter":this.addNoteGlyph(mn.QUARTER,!0);break;case"dotted half":this.addNoteGlyph(mn.HALF,!0);break;case"dotted whole":this.addNoteGlyph(mn.WHOLE,!0);break;default:this.manageTextGlyphs(t.substring(i.index,i.index+i[0].length))}t=t.substring(i.index+i[0].length)}}},{key:"createBoxOutsideText",value:function(){if(this.textNotation.textbox){var t=this.context.staffMetrics.lineSpacing/this._scale,e=this._globalX*t,i=this._textGlyphHeight*(this._currentLine+1)*t,n=this.textNotation.justify==Ca.JUSTIFY_RIGHT?-e:0,r=this._textGlyphHeight*t,o=this.textNotation.effectiveColor,s=0===this._currentLine,a=this.createRectangleGlyph(n,-r,e,i,o,s),l=new Zo(this.context,a);l.scale=this._scale,l.distanceX=this.textNotation.dxForViewId(this.notation.customizationForViewId),l.distanceY=this.distanceY,this.addGlyphLayout(l)}}},{key:"manageTextGlyphs",value:function(t){for(var e=this.splitByLinebreaks(t),i=0;i<e.length;i++)this.addGlyph(this.createTextGlyph(A.unknownToString(e[i])),NaN,i>0)}},{key:"splitByLinebreaks",value:function(t){return t.split(/[\n\r]/)}},{key:"createTextGlyph",value:function(t){return new eo(this._format,t)}},{key:"createRectangleGlyph",value:function(t,e,i,n,r,o){var s=0,a=i+8,l=n+4;return o&&a<l&&(s=-(l-a)/2,a=l),new qr(t-4+s,e+2-2,a,l,r)}},{key:"createTextFormat",value:function(){throw new Error("createTextFormat() not overridden")}},{key:"textNotation",get:function(){return A.as(this.notation,Ca)}},{key:"dx",get:function(){return this.textNotation.dxForViewId(this.notation.customizationForViewId)}},{key:"glyphWidths",get:function(){return this._x}},{key:"glyphHeight",get:function(){return this._y}},{key:"distanceY",get:function(){return-this.padding.bottom+this._y+this.textNotation.dyForViewId(this.notation.customizationForViewId)}},{key:"glyphGap",get:function(){return.125*this._scale}}]),e}();r.registerClass(Ko,"com.noteflight.notation.layout.TextNotationLayout");var jo=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t,i,n,o,t.staffMetrics.chordSymbolPadding)))._scoreChordSymbol=null,s._superscript=!1,s._small=!1,s._scoreChordSymbol=r,s}return c(e,Ko),p(e,null,[{key:"SUPERSCRIPT_SIZE",get:function(){return.75}},{key:"SUPERSCRIPT_Y",get:function(){return.75}},{key:"SMALL_SIZE",get:function(){return.75}},{key:"FIGURED_BASS_SPACING",get:function(){return 2}},{key:"FIGURED_BASS_SIZE",get:function(){return.75}},{key:"SCALE_DEGREE_SPACING",get:function(){return 1.5}},{key:"SCALE_DEGREE_SIZE",get:function(){return.75}}]),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(),s(h(e.prototype),"createBoxOutsideText",this).call(this),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"initializeLayout",value:function(){if(!this.chordSymbol.hideChordSymbols){var t=this._scoreChordSymbol.renderText,e=/^[^:]+: */.exec(t);if(e){var i=A.unknownToString(e[0]);this.addChordText(i.replace(/[\^\!]/g,"")),t=t.substring(i.length);var n=!0,r=!1,o=void 0;try{for(var s,a=this._glyphLayouts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.distanceX-=this._x}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this._x=0}if(Aa.isFiguredBass(t))return void this.addFiguredBass(t,!1,!1);var l=t.split(/([\^\(][0-9@#%*\$\-\+\\_]+[ \/\r\n]+[0-9 \/\r\n@#%*\$\-\+\\_]+[\^\)])/),u=!1,h=!0,c=!1,d=void 0;try{for(var f,y=l[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.unknownToString(g);""!==p&&(u?"("==p.charAt(0)&&")"==p.charAt(p.length-1)?(this.addChordText("("),this.addFiguredBass(p.substring(1,p.length-1),!0,!0),this.addChordText(")")):this.addFiguredBass(p.substring(1,p.length-1),!0,!0):this.addChordText(p)),u=!u}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}var m=this.justifyOffset;if(0!==m){var v=!0,_=!1,S=void 0;try{for(var L,k=this._glyphLayouts[Symbol.iterator]();!(v=(L=k.next()).done);v=!0)L.value.distanceX+=m}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}}}if(null!=this.fretboard){var T=(this.fretboard.strings-1)*this.context.staffMetrics.chordFrameStringSpacing,E=T;null!=this.chordSymbol.effectiveFirstFretText&&(E+=2);var M=new gr(E*this.context.staffMetrics.lineSpacing,0),b=new Zo(this.context,M);if(this.context.staffMetrics.centerChordSymbols&&(b.distanceX-=T/2),this.chordSymbol.hideFretboards){var w=this.context.staffMetrics.chordFrameFretSpacing*this.fretboard.frets,x=!0,C=!1,N=void 0;try{for(var I,P=this._glyphLayouts[Symbol.iterator]();!(x=(I=P.next()).done);x=!0)I.value.distanceY-=w}catch(t){C=!0,N=t}finally{try{x||null==P.return||P.return()}finally{if(C)throw N}}}else this.addGlyphLayout(b)}}},{key:"addChordText",value:function(t){for(var i="",n=0;n<t.length;n++){var r=t.charAt(n);if("!@#$%*^[&".indexOf(r)>=0&&i.length>0&&(this.addGlyph(this.createTextGlyph(i)),i=""),"@#$%*[".indexOf(r)>=0)this.addGlyph(this.foundry.getChordSymbol(r));else if("^"==r)this._superscript=!this._superscript,this._scale=this._superscript?e.SUPERSCRIPT_SIZE:1,this._y=this._superscript?e.SUPERSCRIPT_Y:0;else if("!"==r)this._small=!this._small,this._scale=this._small?e.SMALL_SIZE:1;else if("&"==r){var o=this._x,s=this._y,a=this._scale;this._y+=e.SCALE_DEGREE_SPACING,this._scale*=e.SCALE_DEGREE_SIZE,this.addGlyph(this.createTextGlyph("^")),this._x=o,this._y=s,this._scale=a}else i+=r}i.length>0&&this.addGlyph(this.createTextGlyph(i),i.match(/^_+$/)?0:this.glyphGap)}},{key:"addFiguredBass",value:function(t,i,n){if(!i&&"("==t.charAt(0)&&")"==t.charAt(t.length-1))return this.addChordText("("),this.addFiguredBass(t.substring(1,t.length-1),!0,!1),void this.addChordText(")");this._scale*=e.FIGURED_BASS_SIZE;var r,o,s=this._x,a=this._x,l=this._y,u=t.split(/[ \/\r\n]+/);if(i){var h=0,c=!0,d=!1,f=void 0;try{for(var y,g=u[Symbol.iterator]();!(c=(y=g.next()).done);c=!0)o=y.value,(r=A.unknownToString(o)).length>1&&!r.charAt(0).match(/[0-9\\]/)&&(h=Math.max(h,this.createChordGlyph(r.charAt(0)).width))}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}a+=h*this._scale/this.context.staffMetrics.lineSpacing+this.glyphGap}n&&(this._y+=(u.length-1)*this._scale*e.FIGURED_BASS_SPACING);var p=!0,m=!1,v=void 0;try{for(var _,S=u[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){o=_.value,r=A.unknownToString(o),this._x=a;for(var L=0;L<r.length;L++){var k=r.charAt(L),T=this.createChordGlyph(k);!k.match(/[0-9\\]/)&&0===L&&r.length>1&&(this._x-=T.width*this._scale/this.context.staffMetrics.lineSpacing+this.glyphGap),this.addGlyph(T,"_"==k?0:this.glyphGap),"\\"==k&&(this._x=a),s=Math.max(s,this._x)}this._y-=this._scale*e.FIGURED_BASS_SPACING}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}this._scale/=e.FIGURED_BASS_SIZE,this._x=s,this._y=l}},{key:"createChordGlyph",value:function(t){return"@#$*%".indexOf(t)>=0?this.foundry.getChordSymbol(t):this.createTextGlyph(t)}},{key:"createTextFormat",value:function(){return new Ly(this.context.staffMetrics.chordSymbolFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.chordSymbolSize)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new hh(t,this)}},{key:"chordSymbol",get:function(){return A.as(this.notation,Aa)}},{key:"fretboard",get:function(){return this.chordSymbol.fretboard}},{key:"justifyOffset",get:function(){return this.context.staffMetrics.centerChordSymbols?-this.glyphWidths/2+.5:0}}]),e}();r.registerClass(jo,"com.noteflight.notation.layout.ChordSymbolLayout");var qo=function(t){function e(t,i,n,r){var o;y(this,e),(o=l(this,h(e).call(this,t,i,n,n)))._clefChange=!1,o._clefChange=r;var s=A.unknownToType(n.showSign?o.foundry.getClef(n.sign):new gr(0,0),yr),a=new Zo(t,s);return r?(a.scale=t.staffMetrics.smallClefScale,o.padding=t.staffMetrics.clefChangePadding):o.padding=t.staffMetrics.clefPadding,A.is(n,$l)&&(a.scale=A.as(n,$l).clefScale),a.distanceY=n.line*n.lineSpacing,o.addGlyphLayout(a),o}return c(e,Uo),p(e,[{key:"floating",get:function(){return this._clefChange}},{key:"clefChange",get:function(){return this._clefChange}}]),e}();r.registerClass(qo,"com.noteflight.notation.layout.ClefLayout");var Jo=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r,t.staffMetrics.expressionTextPadding))}return c(e,Ko),p(e,[{key:"doValidateLayout",value:function(){var t=this.foundry.getDynamics(this.textNotation.text);if(null!=t)this.addGlyph(t);else{var i="",n=!0,r=!1,o=void 0;try{for(var a,l=this.textNotation.text.split(" ")[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var u=a.value;null==(t=this.foundry.getDynamics(u))?i+=u+" ":(""!==i&&(this.addGlyph(this.createTextGlyph(i)),i="",this._x+=.5),this._y-=.25,this.addGlyph(t,.5),this._y+=.25)}}catch(t){r=!0,o=t}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}""!==(i=i.replace(/ $/,""))&&this.addGlyph(this.createTextGlyph(i))}s(h(e.prototype),"createBoxOutsideText",this).call(this),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"createTextFormat",value:function(){return new Ly(this.context.staffMetrics.staffTextFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.expressionTextSize,null,null,!0)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new fh(t,this)}}]),e}();r.registerClass(Jo,"com.noteflight.notation.layout.ExpressionTextLayout");var Zo=function(){function t(e,i){if(y(this,t),this.horizontalAnchor=t.ANCHOR_LEFT,this.verticalAnchor=t.ANCHOR_BOTTOM,this.affectsWidth=!0,this.affectsHeight=!0,this.distanceX=0,this.distanceY=0,this._scale=1,this._glyph=null,this._context=null,this._context=e,null==i)throw new Error("null glyph passed to GlyphLayout constructor");this._glyph=i}return p(t,null,[{key:"ANCHOR_LEFT",get:function(){return-1}},{key:"ANCHOR_CENTER",get:function(){return 0}},{key:"ANCHOR_RIGHT",get:function(){return 1}},{key:"ANCHOR_BOTTOM",get:function(){return-1}},{key:"ANCHOR_TOP",get:function(){return 1}}]),p(t,[{key:"createDisplayObject",value:function(t){var e=this._glyph.createDisplayObject(t.info);1!=this.scale&&(e.scaleX*=this.scale,e.scaleY*=this.scale);var i=this.origin;return e.x=i.x*this._context.staffMetrics.lineSpacing,e.y=i.y*-this._context.staffMetrics.lineSpacing,e}},{key:"glyph",get:function(){return this._glyph}},{key:"origin",get:function(){var e,i;switch(this.horizontalAnchor){case t.ANCHOR_LEFT:e=this.distanceX;break;case t.ANCHOR_CENTER:e=this.distanceX-this.width/2;break;case t.ANCHOR_RIGHT:e=-(this.width+this.distanceX)}switch(this.verticalAnchor){case t.ANCHOR_BOTTOM:i=this.distanceY;break;case t.ANCHOR_TOP:i=-(this.height+this.distanceY)}return new If(e,i)}},{key:"bounds",get:function(){var t=this.scale/this._context.staffMetrics.lineSpacing,e=this.origin;return new Qo(this._glyph.originX*t+e.x,-this._glyph.originY*t+e.y,this._glyph.width*t,this._glyph.height*t)}},{key:"width",get:function(){return this._glyph.width*this.scale/this._context.staffMetrics.lineSpacing}},{key:"height",get:function(){return this._glyph.height*this.scale/this._context.staffMetrics.lineSpacing}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t}}]),t}();r.registerClass(Zo,"com.noteflight.notation.layout.GlyphLayout");var ts=function(){function t(e,i){y(this,t),this._staffLayout=null,this._sn=null,this._startPosition=null,this._startBreak=!1,this._endPosition=null,this._endBreak=!1,this._staffLayout=e,this._sn=i,this.initializeSpan()}return p(t,[{key:"initializeSpan",value:function(){t.ensureSpanDefaulted(this._sn,this._staffLayout.context),this._startPosition=new gl(A.intToUint(this._sn.measure.index),this._sn.position),this._startBreak=this._startPosition.measureIndex<this._staffLayout.startMeasureIndex,this._startBreak&&(this._startPosition=new gl(A.intToUint(this._staffLayout.startMeasureIndex),0)),this._endPosition=this._sn.endPosition,this._endBreak=this._endPosition.measureIndex>=this._staffLayout.endMeasureIndex,this._endBreak&&(this._endPosition=new gl(A.intToUint(this._staffLayout.endMeasureIndex-1),this._staffLayout.staff.getMeasureAt(A.intToUint(this._staffLayout.endMeasureIndex-1)).duration))}},{key:"startPoint",value:function(e){var i,n,r=this._startPosition.position;if(this.startBreak){i=this.startBreakPadding;var o=this._staffLayout.staff.score.rangeDuration(this._sn.measurePosition,this._startPosition);n=this._sn.dy+this._sn.ascent*o/this._sn.span}else i=this._sn.dx,n=this._sn.dy,0===r&&this._sn.canStartAtBarline&&(r=-1,i=0);var s=e.getLocalPointInMeasure(this._startPosition.measureIndex,this._staffLayout.staff,r,t.spanStartPosOptions(this._sn));return new If(s.x+i*this.staffMetrics.lineSpacing,s.y-n*this.staffMetrics.lineSpacing)}},{key:"endPoint",value:function(t){var e,i,n;if(this.endBreak){e=this.endBreakPadding;var r=this._staffLayout.staff.score.rangeDuration(this._sn.measurePosition,this._endPosition);i=this._sn.dy+this._sn.ascent*r/this._sn.span,n="normal"}else e=this._sn.endx,i=this._sn.dy+this._sn.ascent,n="noBarline";var o=t.getLocalPointInMeasure(this._endPosition.measureIndex,this._staffLayout.staff,this._endPosition.position,{verticalAlign:"bottom",horizontalAlign:n});return new If(o.x+e*this.staffMetrics.lineSpacing,o.y-i*this.staffMetrics.lineSpacing)}},{key:"createSystemDisplayObject",value:function(t){return this.createSystemSpanView(t.context,this.startPoint(t),this.endPoint(t))}},{key:"createSystemSpanView",value:function(t,e,i){throw new Error("createSystemSpanView() not overridden by subclass")}},{key:"startBreak",get:function(){return this._startBreak}},{key:"endBreak",get:function(){return this._endBreak}},{key:"notation",get:function(){return this._sn}},{key:"staffLayout",get:function(){return this._staffLayout}},{key:"staffMetrics",get:function(){return this._staffLayout.context.staffMetrics}},{key:"startBreakPadding",get:function(){return-this.staffMetrics.barStartPaddingLeft}},{key:"endBreakPadding",get:function(){return 0}}],[{key:"ensureSpanDefaulted",value:function(t,e){if(t.requiresDefaultInfo){t.requiresDefaultInfo=!1;var i=new Qs(e,t);t.setDefaultInfo(i)}}},{key:"spanStartPosOptions",value:function(t){var e={verticalAlign:"bottom"};return t.voiceNumber>=0&&(e.horizontalAlign=t.includeGrace?"grace":"normal",e.voiceNumber=t.voiceNumber),e}}]),t}();r.registerClass(ts,"com.noteflight.notation.layout.SystemSpan");var es=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,ts),p(e,[{key:"createSystemSpanView",value:function(t,e,i){return i.x=Math.max(i.x,e.x+this.staffMetrics.hairpinMinimumWidth*this.staffMetrics.lineSpacing),new ph(t,this,e,i)}},{key:"endBreakPadding",get:function(){return-this.staffMetrics.hairpinPadding.width}}]),e}();r.registerClass(es,"com.noteflight.notation.layout.HairpinSpan");var is=function t(e){y(this,t),this.lyricLayout=null,this.lyricLayout=e};r.registerClass(is,"com.noteflight.notation.layout.HyphenElement");var ns=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t))).decorationLayout=null,s._startLyricLayout=null,s._endLyricLayout=null,s._startMeasure=null,s._endMeasure=null,s._startLyricLayout=i,s._endLyricLayout=r,s._startMeasure=n,s._endMeasure=o,s.createLayout(),s}return c(e,Ro),p(e,[{key:"createLayout",value:function(){var t=new Ly(this.context.staffMetrics.lyricsFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.lyricsSize,null,this.context.staffMetrics.lyricsBold,this.context.staffMetrics.lyricsItalic),e=new eo(t,"-");this.decorationLayout=new Zo(this.context,e),this.decorationLayout.horizontalAnchor=Zo.ANCHOR_LEFT}},{key:"createDisplayObject",value:function(t){return new mh(t,this)}},{key:"startLyricLayout",get:function(){return this._startLyricLayout}},{key:"endLyricLayout",get:function(){return this._endLyricLayout}},{key:"startMeasureExists",get:function(){return!!this.startLyricLayout.lyric.measure}},{key:"beginningOfStaff",get:function(){return this._startMeasure}},{key:"endOfMeasure",get:function(){return this._endMeasure}},{key:"betweenLyrics",get:function(){return!(!this.startLyricLayout||!this.endLyricLayout)}},{key:"startHyphenMeasureIndex",get:function(){return this._startMeasure?this._startMeasure.index:this.startLyricLayout.lyric.measure.index}},{key:"startHyphenMeasurePosition",get:function(){return this._startMeasure?0:this.startLyricLayout.lyric.position}},{key:"endHyphenMeasureIndex",get:function(){return this.endLyricLayout?this.endLyricLayout.lyric.measure.index:this._endMeasure.index}},{key:"endHyphenMeasurePosition",get:function(){return this.endLyricLayout?this.endLyricLayout.lyric.position:this._endMeasure.duration-1}},{key:"lyricRightBound",get:function(){return this._startMeasure?0:this.startLyricLayout.bounds.right}},{key:"lyricLeftBound",get:function(){return this.endLyricLayout?this.endLyricLayout.bounds.left:0}}]),e}();r.registerClass(ns,"com.noteflight.notation.layout.HyphenLayout");var rs=function t(){y(this,t)};r.registerClass(rs,"com.noteflight.notation.layout.IBeamableLayout");var os=function(t){function e(t,i,n,r,o){var s;y(this,e),s=l(this,h(e).call(this,t,i,n,o));var a=0;return o.showKey&&(0!==r.cancel&&0===r.fifths&&(a=s.addKeyAccidentals(r.cancel,o,a,de.NATURAL)),0!==r.fifths&&(a=s.addKeyAccidentals(r.fifths,o,a,r.fifths>0?de.SHARP:de.FLAT))),s.padding=t.staffMetrics.keySignaturePadding,s}return c(e,Uo),p(e,[{key:"addKeyAccidentals",value:function(t,e,i,n){var r=this.foundry.getAccidental(n);e.unpitched&&(r=new gr(r.width,r.height));var o=!0,s=!1,a=void 0;try{for(var l,u=e.getKeySignatureLines(t)[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToNumber(h),d=new Zo(this.context,r);d.distanceX=i,d.distanceY=c,d.horizontalAnchor=Zo.ANCHOR_LEFT,this.addGlyphLayout(d),i+=this.context.staffMetrics.accidentalKeySignatureSpacing}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return i}},{key:"keySignature",get:function(){return A.as(this.notation,Ga)}}]),e}();r.registerClass(os,"com.noteflight.notation.layout.KeySignatureLayout");var ss=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r,t.staffMetrics.performanceTextPadding)))._labelNotationGlyph=null,o}return c(e,Ko),p(e,[{key:"doValidateLayout",value:function(){s(h(e.prototype),"doValidateLayout",this).call(this),this._labelNotationGlyph=this.createTextGlyph(this.textNotation.text),this.addGlyph(this._labelNotationGlyph),this.createBoxOutsideText()}},{key:"createTextFormat",value:function(){return new Ly(this.context.staffMetrics.staffTextFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.labelTextSize)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new _h(t,this)}},{key:"updateLabelNotationText",value:function(t){this._labelNotationGlyph&&(this._labelNotationGlyph.text=t)}}]),e}();r.registerClass(ss,"com.noteflight.notation.layout.LabelNotationLayout");var as=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r,t.staffMetrics.performanceTextPadding))}return c(e,ss),p(e,[{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new Sh(t,this)}}]),e}();r.registerClass(as,"com.noteflight.notation.layout.MeasureNumberNotationLayout");var ls=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).score=null,t.preview=!1,t.scoreLayout=null,t._pageMetrics=null,t.stripMetrics=null,t._foundry=null,t._scaledFoundries=[],t.lyricsContext=new xu(u(u(t))),t}return c(e,At),p(e,[{key:"getScaledFoundry",value:function(t){var e=Math.floor(100*t),i=A.unknownToType(this._scaledFoundries[e],mr);return null==i&&(i=this.foundry.getScaledFoundry(t),this._scaledFoundries[e]=i),i}},{key:"pageMetrics",get:function(){return this.score.effectivePageMetrics},set:function(t){this._pageMetrics=t}},{key:"foundry",get:function(){return this._foundry},set:function(t){this._foundry=t,this._scaledFoundries=[]}},{key:"staffMetrics",get:function(){return this.score.effectiveStaffMetrics}},{key:"partToPrint",get:function(){return this.score?this.score.useIndividualPartInfo:null}}]),e}();r.registerClass(ls,"com.noteflight.notation.layout.LayoutContext");var us=function t(e,i,n){y(this,t),this.level=0,this.start=0,this.end=0,this.level=e,this.start=i,this.end=n};r.registerClass(us,"com.noteflight.notation.layout.LevelBeam");var hs=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,ts),p(e,[{key:"createSystemSpanView",value:function(t,e,i){return new Lh(t,this,e,i)}},{key:"endBreakPadding",get:function(){return-this.staffMetrics.lineNotationPadding.width}}]),e}();r.registerClass(hs,"com.noteflight.notation.layout.LineNotationSpan");var cs=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,hs),p(e,[{key:"createSystemSpanView",value:function(t,e,i){return new kh(t,this,e,i)}}]),e}();r.registerClass(cs,"com.noteflight.notation.layout.RepeatEndingSpan");var ds=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return y(this,e),(r=l(this,h(e).call(this,t)))._startLyric=null,r._endLyric=null,r.decorationLayout=null,r._goesToEndOfMeasure=!1,r._startLyric=i,r._endLyric=n,r._goesToEndOfMeasure=o,r}return c(e,Ro),p(e,[{key:"doValidateLayout",value:function(){}},{key:"doValidateGlobalLayout",value:function(){if(this._startLyric.lyric.extend){var t=this._startLyric.x,e=t+this.context.staffMetrics.lyricExtensionLength,i=this._startLyric.lyric.noteSet,n=i.previousGraceNote&&i.previousGraceNote.hasLyricWithText(this._startLyric.lyric.line);""!==this._startLyric.lyric.text?e=(t+=this._startLyric.bounds.right+this.context.staffMetrics.lyricExtensionPadding)+this.context.staffMetrics.lyricExtensionLength:0!==i.position||n||(t=0,e=this._startLyric.x+this._startLyric.bounds.right+this.context.staffMetrics.lyricExtensionPadding);var r=this._startLyric.lyric.noteSet.nextNoteSet(!0);if(null!=r&&(r.measure==this._startLyric.lyric.noteSet.measure||r.measure.index==this._startLyric.lyric.noteSet.measure.index+1)){var o=r.getLyricAtLine(this._startLyric.lyric.line,this._startLyric.lyric.direction);null!=o&&""===o.text&&o.extend&&(this._goesToEndOfMeasure?e=this._startLyric.measureLayout.x:(e=this._endLyric.x+this._endLyric.bounds.left,""!==this._endLyric.lyric.text&&(e-=this.context.staffMetrics.lyricExtensionPadding)))}var s=new Cr((e-t)*this.context.staffMetrics.lineSpacing,this.context.staffMetrics.lyricExtensionThickness);this.decorationLayout=new Zo(this.context,s),this.decorationLayout.horizontalAnchor=Zo.ANCHOR_LEFT,this.decorationLayout.distanceX=t,this.decorationLayout.distanceY=0}}},{key:"createDisplayObject",value:function(t){return new Eh(t,this)}},{key:"startLyric",get:function(){return this._startLyric}}]),e}();r.registerClass(ds,"com.noteflight.notation.layout.LyricExtenderLayout");var fs=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t.context,t.measureLayout,i,t.clef)))._beamableLayout=null,n._baseY=0,n._lyricGlyphLayout=null,n._defaultingSpan=!1,n._beamableLayout=A.unknownToType(t,rs),n.padding=n.context.staffMetrics.lyricsPadding,n}return c(e,Uo),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"doValidateGlobalLayout",value:function(){s(h(e.prototype),"doValidateGlobalLayout",this).call(this),this.positionLyricGlyph(),this.reviseBoundsAndGeometry()}},{key:"initializeLayout",value:function(){A.as(this._beamableLayout,Vo);this.baseY=this.aboveStaff?this.context.staffMetrics.lyricsAboveStaffBottom+this.context.staffMetrics.lyricsDescent*this.height:this.context.staffMetrics.lyricsBelowStaffTop-this.context.staffMetrics.lyricsAscent*this.height;var t=new Ly(this.context.staffMetrics.lyricsFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.lyricsSize,null,this.context.staffMetrics.lyricsBold,this.context.staffMetrics.lyricsItalic),e=this.lyric.text;this.measureLayout.firstLayoutOnSystem&&0===this.lyric.noteSet.position&&this.lyric.noninitial&&""!==e&&(e="-"+e);var i=new eo(t,e);this._lyricGlyphLayout=new Zo(this.context,i),this.addGlyphLayout(this._lyricGlyphLayout),this.positionLyricGlyph()}},{key:"positionLyricGlyph",value:function(){var t=this.lyric.noteSet.nextNoteSet(!0);this.lyric.extend||this.lyric.continued&&t&&!t.hasLyricWithText(this.lyric.line)?(this._lyricGlyphLayout.horizontalAnchor=Zo.ANCHOR_LEFT,this._lyricGlyphLayout.distanceX=0):(this._lyricGlyphLayout.horizontalAnchor=Zo.ANCHOR_CENTER,this._lyricGlyphLayout.distanceX=this._beamableLayout.notationWidth/2),this._lyricGlyphLayout.distanceY=e.lyricY(this.context,this,null,this.lyric)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new Mh(t,this)}},{key:"lyric",get:function(){return A.as(this.notation,ul)}},{key:"baseY",get:function(){return this._baseY},set:function(t){this._baseY=t}},{key:"lyricGlyphHeight",get:function(){return this._lyricGlyphLayout.height}},{key:"direction",get:function(){return e.lyricDirection(this.context,this.lyric)}},{key:"aboveStaff",get:function(){return this.direction==he.DIRECTION_UP}},{key:"measureIndex",get:function(){return this.measureLayout.measure.index}}],[{key:"lyricDirection",value:function(t,e){return e.direction?e.direction:e.measure&&e.measure.numVoices>=2&&t.staffMetrics.useLyricsDefaultDirection&&1==e.noteSet.voice.index?he.DIRECTION_UP:he.DIRECTION_DOWN}},{key:"lyricY",value:function(t,i,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=0,a=0,l=0;if(e.lyricDirection(t,r)==he.DIRECTION_DOWN)return null!=i&&(l=i.height,s=null!=n?n.minLyricBelowBaseY:i.baseY,o&&(a=i._lyricGlyphLayout.distanceY)),r.line*-t.staffMetrics.lyricsLineSpacing+Math.min(t.staffMetrics.lyricsBelowStaffTop-t.staffMetrics.lyricsAscent*l,s)-a;var u=0;null!=i&&(l=i.height,s=i.baseY-i.lyricGlyphHeight,n&&(s=n.maxLyricAboveBaseY,u=n.maxLyricExtraLinesAboveStaff*t.staffMetrics.lyricsLineSpacing),o&&(a=i._lyricGlyphLayout.distanceY));var h=Math.max(t.staffMetrics.lyricsAboveStaffBottom+t.staffMetrics.lyricsDescent*l,s)-a;return n&&(h=h+u-r.line*t.staffMetrics.lyricsLineSpacing),h}}]),e}();r.registerClass(fs,"com.noteflight.notation.layout.LyricLayout");var ys=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,A.as(i.clone(),hl)))).measure.clef=new Mn(0,null,0,null,0,-1,1),n.showAnnotations=!1,n}return c(e,Wo),p(e,[{key:"buildChildLayouts",value:function(){this._constraint=new ia([this.context.staffMetrics.splitSystemGap])}},{key:"createNotationLayout",value:function(t,e){return null}},{key:"createMeasureView",value:function(t,i){var n=s(h(e.prototype),"createMeasureView",this).call(this,t,i);return n.highlightEnabled=!1,n}},{key:"handleMeasureChange",value:function(t){}},{key:"buildGlobalLayouts",value:function(){this._globalLayouts=[]}},{key:"leftPaddingConstraint",get:function(){return new ra(this.context.staffMetrics.splitSystemGap)}}]),e}();r.registerClass(ys,"com.noteflight.notation.layout.MeasureGapLayout");var gs=function(){function t(e){y(this,t),this._measureIndex=NaN,this._prefixes=[],this._measureIndex=e}return p(t,[{key:"getPrefixAt",value:function(t){return t<this._prefixes.length?this._prefixes[t]:null}},{key:"addPrefix",value:function(t){this._prefixes.push(t)}},{key:"addArrayOfPrefixes",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Ro);this.addPrefix(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"validateLayouts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._prefixes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.validateLayout()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"invalidateLayouts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._prefixes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.invalidate()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"invalidateGlobal",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._prefixes[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.invalidateGlobal()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"destroy",value:function(){this.destroyChildren()}},{key:"destroyChildren",value:function(){for(var t=0;t<this._prefixes.length;t++)this._prefixes[t].destroy()}},{key:"measureIndex",get:function(){return this._measureIndex}},{key:"totalPrefixes",get:function(){return this._prefixes.length}},{key:"prefixes",get:function(){return this._prefixes}},{key:"totalFlowWidth",get:function(){for(var t=0,e=0;e<this.totalPrefixes;e++){var i=this.getPrefixAt(A.intToUint(e));if(A.is(i,Us)){var n=A.as(i,Us);n&&(t+=n.flowWidth)}}return t}}]),t}();r.registerClass(gs,"com.noteflight.notation.layout.MeasurePrefixesLayout");var ps=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).centered=!0,o}return c(e,Vo),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(A.as(this.notation,vl)),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"initializeLayout",value:function(t){var e,i=this.clef.getRestLine(A.intToUint(mn.QUARTER))*this.clef.lineSpacing+t.dy,n=Cs.restType(mn.WHOLE,i,this.clef);(e=new Zo(this.context,this.foundry.getSymbol(vl.MEASURE_REPEAT_SIGN,n))).distanceY=i,this.addGlyphLayout(e)}}]),e}();r.registerClass(ps,"com.noteflight.notation.layout.MeasureRepeatLayout");var ms=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).scoreNote=null,o.scoreNote=i?i.getScoreNote(n):n,o}return c(e,Uo),p(e,[{key:"note",get:function(){return A.as(this.notation,de)}},{key:"pitchLine",get:function(){return this.clef.getPitchLine(this.scoreNote)*this.clef.lineSpacing}},{key:"onStaffLine",get:function(){return 8*this.clef.getPitchLine(this.scoreNote)%8==0}},{key:"effectiveFret",get:function(){return this.clef.getEffectiveFret(this.note)}}]),e}();r.registerClass(ms,"com.noteflight.notation.layout.NoteLayout");var vs=function t(){y(this,t),this.measureIndex=0,this.position=NaN,this.duration=NaN,this.grace=!1,this.top=NaN,this.bottom=NaN,this.x=NaN,this.hasStem=!1,this.noteWidth=NaN};r.registerClass(vs,"com.noteflight.notation.layout.NotePlacement");var _s=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).liaisonEndLayout=null,o.enableStem=!0,o._noteHead=null,o._noteWidth=NaN,o._noteHeight=NaN,o._minLine=NaN,o._maxLine=NaN,o._stemmingLine=NaN,o._voiceOffset=0,o._showRhythm=!1,o._hasAlternate=!1,o._parenthesisWidth=0,o._minAlternateLine=NaN,o._maxAlternateLine=NaN,o._leftAccidental=0,o._stemLayout=null,o._tremoloLayout=null,o._requireLiaisonStartPadding=!1,o._requireLiaisonEndPadding=!1,o._liaisonsDetermined=!1,o._hasLiaisons=!1,o._isTab=!1,o._singleNoteLiaison=!1,o._isTab=A.is(r,$l),o}return c(e,Vo),p(e,null,[{key:"MAX_SUPPORTED_TREMOLO_MARKS",get:function(){return 3}}]),p(e,[{key:"calculateBounds",value:function(t){s(h(e.prototype),"calculateBounds",this).call(this,t);var i=!0,n=!1,r=void 0;try{for(var o,a=this._noteLayouts[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;A.unknownToType(l,ms).calculateBounds(t)}}catch(t){n=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"addNoteLayout",value:function(t){this.invalidate(),this._noteLayouts.push(t)}},{key:"getNoteLayoutAt",value:function(t){return A.unknownToType(this._noteLayouts[t],ms)}},{key:"doValidateLayout",value:function(){this.initializeLayout(),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"initializeLayout",value:function(){if(this._noteLayouts=[],this._alternatePitchLines=[],this._voiceOffset=this.alternateVoiceOffset,this.padding=this.context.staffMetrics.notePadding,this.noteSet.grace&&null==this.noteSet.previousGraceNote&&(this.padding=this.context.staffMetrics.initialGracePadding),this.addNoteHeads(),this._showRhythm=this.clef.showRhythm(this.context.score)&&!this.isPlainSlash,this._showRhythm&&this.noteSet.dots>0&&this.addDots(),this.clef.showKey&&this.addAccidentals(),this.noteSet.arpeggio&&this.addArpeggio(),this._showRhythm&&this.enableStem&&this.addStems(),this.clef.showLegerLines&&this.addLegerLines(),this.addArticulationSpacers(),this.alternateVoiceNoteSetLayout&&0===this._voiceOffset){var t=this.alternateVoiceNoteSetLayout.alternateVoiceOffset;if(t>0){var e=new Zo(this.context,new gr(0,0));e.distanceX=t+this._noteWidth,this.addGlyphLayout(e)}}this.noteSet.hasEffects&&this.addEffects(),this.adjustLiaisonPadding(),this.noteSet.tremolo>0&&!this.noteSet.tremoloDyad&&this.addTremoloMarks()}},{key:"getNextBeamableLayout",value:function(){var t=this.noteSet.nextNoteSet();return null==t?null:A.as(this.measureLayout.getLayoutForNotation(t),rs)}},{key:"getPreviousBeamableLayout",value:function(){var t=this.noteSet.previousNoteSet();return null==t?null:A.as(this.measureLayout.getLayoutForNotation(t),rs)}},{key:"adjustLiaisonPadding",value:function(){if(this.noteSet.liaisonCount>0){var t=1==this.noteSet.notes.length&&!this.multiVoice&&(this._requireLiaisonStartPadding||this.context.staffMetrics.tieSingleNoteEnabled);this._singleNoteLiaison=this._singleNoteLiaison||t,(this._requireLiaisonStartPadding||!t||e.upToDownLiaison(this,this.getNextBeamableLayout()))&&(this.noteSet.position+this.noteSet.duration<this.noteSet.measure.duration||this.measureLayout.lastLayoutOnSystem)&&(this.padding=this.padding.clone(),this.padding.width+=this.context.staffMetrics.noteLiaisonPadding)}if(this.noteSet.liaisonEndCount>0){var i=1==this.noteSet.notes.length&&!this.multiVoice&&(this._requireLiaisonEndPadding||this.context.staffMetrics.tieSingleNoteEnabled);this._singleNoteLiaison=this._singleNoteLiaison||i,!this._requireLiaisonEndPadding&&i&&!e.upToDownLiaison(this.getPreviousBeamableLayout(),this)||!(this.noteSet.position>0||this.measureLayout.firstLayoutOnSystem)&&this.measureLayout.measure.flowsFromPreviousMeasure||(this.padding=this.padding.clone(),this.padding.x-=this.context.staffMetrics.noteLiaisonPadding,this.padding.width+=this.context.staffMetrics.noteLiaisonPadding)}}},{key:"addNoteHeads",value:function(){for(var t=this.noteSet.notes,e=this.down?t.length-1:0,i=this.down?-1:t.length,n=this.down?-1:1,r=-1e3,o=!1,s=!1,a=e;a!=i;a+=n){var l=A.unknownToType(t[a],de);null!=l.liaison&&(this._requireLiaisonStartPadding=this._requireLiaisonStartPadding||$o.requireSingleNotePadding(l.liaison)),null!=l.liaisonStartNote&&(this._requireLiaisonEndPadding=this._requireLiaisonEndPadding||$o.requireSingleNotePadding(l.liaisonStartNote.liaison));var u=new ms(this.context,this.measureLayout,l,this.clef),h=u.pitchLine;if(this.addNoteLayout(u),this.clef.showRhythm(this.context.score)||!l.tieEnd){var c=0,d=0,f=0,y=this.clef.getEffectiveFret(l);if(y>=0&&(null==l.noteHead||l.noteHead==de.NORMAL_NOTE_HEAD)){l.cumulativeBend>0?0!==l.relativeBend?this._noteHead=this.foundry.getBendAlteration(l.cumulativeBend):this._noteHead=new gr(0,0):this._noteHead=this.foundry.getTabFret(A.intToUint(y)),d=this.context.staffMetrics.tabFretWidth,c=Math.max(0,(d-this._noteHead.width/this.context.staffMetrics.lineSpacing)/2);var g=this.context.staffMetrics.tabFretBackgroundPadding,p=new pr(this._noteHead.width+2*g*this.context.staffMetrics.lineSpacing,this._noteHead.height),m=new Zo(this.context,p);m.distanceX=this._voiceOffset-g+c,m.distanceY=h+this._noteHead.originY/this.context.staffMetrics.lineSpacing,this.addGlyphLayout(m),p=new gr(d*this.context.staffMetrics.lineSpacing,this._noteHead.height),(m=new Zo(this.context,p)).distanceX=this._voiceOffset,m.distanceY=h,this.addGlyphLayout(m)}else this._noteHead=this.foundry.getNoteHead(this.isPlainSlash?mn.QUARTER:this.noteSet.value,l.noteHead),this._isTab&&(d=this.context.staffMetrics.tabFretWidth,c=Math.max(0,(d-this._noteHead.width/this.context.staffMetrics.lineSpacing)/2));0===d&&(d=this._noteHead.width/this.context.staffMetrics.lineSpacing),f=this._noteHead.height/this.context.staffMetrics.lineSpacing,s||(this._noteWidth=d,this._noteHeight=f,s=!0);var v=new Zo(this.context,this._noteHead);if(v.distanceX=this._voiceOffset+c,v.distanceY=h,l.cue){var _=this.context.staffMetrics.cueScale;v.scale=_,d*=_,f*=_,this.down||(v.distanceX+=this._noteWidth-d)}if(h==r||2*(h-r)==n?(o=!o)&&(this._alternatePitchLines.push(h),this._hasAlternate?(this._minAlternateLine=Math.min(this._minAlternateLine,h),this._maxAlternateLine=Math.max(this._maxAlternateLine,h)):(this._hasAlternate=!0,this._minAlternateLine=this._maxAlternateLine=h),v.distanceX+=this.down?-d:d):o=!1,r=h,u.addGlyphLayout(v),l.parentheses){var S=new Zo(this.context,this.foundry.getSymbol("leftParenthesis"));S.distanceX=this.context.staffMetrics.parenthesisSpacing-v.distanceX,S.distanceY=h,S.horizontalAnchor=Zo.ANCHOR_RIGHT,u.addGlyphLayout(S),(S=new Zo(this.context,this.foundry.getSymbol("rightParenthesis"))).distanceX=this.context.staffMetrics.parenthesisSpacing+v.distanceX+this._noteHead.width/this.context.staffMetrics.lineSpacing,S.distanceY=h,u.addGlyphLayout(S),this._parenthesisWidth=S.width}}else this._noteWidth=this._noteHeight=0}}},{key:"addDots",value:function(){var t=this.context.staffMetrics.dotSpacing+this._noteWidth+this._voiceOffset,e=0;this._hasAlternate&&!this.down&&(e+=this._noteWidth),this._parenthesisWidth>0&&(e+=this.context.staffMetrics.parenthesisSpacing+this._parenthesisWidth),this.alternateVoiceNoteSetLayout&&0===this._voiceOffset&&this.alternateVoiceNoteSetLayout.noteSet.dots>0&&this.hasStem&&(e=Math.max(e,this.alternateVoiceNoteSetLayout.alternateVoiceOffset)),t+=e;var i=NaN,n=this._noteLayouts,r=this.dotsDown;r&&(n=n.slice().reverse());var o=!0,s=!1,a=void 0;try{for(var l,u=n[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToType(h,ms),d=r?Math.ceil(c.pitchLine)-.5:Math.floor(c.pitchLine)+.5;d==i&&(d+=r?1:-1),i=d;for(var f=0;f<this.noteSet.dots;f++){var y=new Zo(this.context,this.foundry.getRhythmDot());y.distanceX=t+this.context.staffMetrics.multipleDotGap*f,y.distanceY=d,c.addGlyphLayout(y)}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"addAccidentals",value:function(){var t=[];null!=this.alternateVoiceNoteSetLayout&&this.crossoverAccidentalLines>-this.context.staffMetrics.accidentalClearance?this.down?(t=this.noteLayouts.concat(this.alternateVoiceNoteSetLayout.noteLayouts),e.sortNoteLayouts(t)):t=[]:(t=this._noteLayouts,this.down&&(t=t.slice().reverse()));var i=this.context.staffMetrics.accidentalSpacing;this._parenthesisWidth>0&&(i+=this.context.staffMetrics.parenthesisSpacing+this._parenthesisWidth),this._hasAlternate&&this.down&&(i+=this._noteWidth);for(var n=[],r=0;r<t.length;r++)n[r]=i;for(var o=0,s=t.length,a=-1,l=NaN,u=null;o<s;){r=a>0?o++:--s;var h=A.unknownToType(t[r],ms),c=h.scoreNote.accidental;if(null!=c&&(l!=h.pitchLine||u!=c)){u=c,l=h.pitchLine;var d,f=n[r];h.note.courtesyAccidental&&((d=new Zo(this.context,this.foundry.getSymbol("rightParenthesis"))).horizontalAnchor=Zo.ANCHOR_RIGHT,d.distanceX=f,d.distanceY=l,h.addGlyphLayout(d),f+=this.context.staffMetrics.parenthesisSpacing+d.width);var y=new Zo(this.context,this.foundry.getAccidental(c));y.horizontalAnchor=Zo.ANCHOR_RIGHT,y.distanceX=f,y.distanceY=l,h.addGlyphLayout(y),f+=y.width,h.note.courtesyAccidental&&(f+=this.context.staffMetrics.parenthesisSpacing,(d=new Zo(this.context,this.foundry.getSymbol("leftParenthesis"))).horizontalAnchor=Zo.ANCHOR_RIGHT,d.distanceX=f,d.distanceY=l,h.addGlyphLayout(d),f+=d.width);var g=f+this.context.staffMetrics.accidentalSpread;this._leftAccidental=Math.max(this._leftAccidental,g);for(var p=0;p<t.length;p++)Math.abs(A.unknownToType(t[p],ms).pitchLine-h.pitchLine)<this.context.staffMetrics.accidentalClearance&&(n[p]=g);n[r]>i&&(i=n[r],a=-a)}}null!=this.alternateVoiceNoteSetLayout&&this.down&&null!=u&&this.alternateVoiceNoteSetLayout.reviseBoundsAndGeometry()}},{key:"addArpeggio",value:function(){var t=-(this.context.staffMetrics.arpeggioSpacing+this.context.staffMetrics.arpeggioWidth);this._leftAccidental>0?t-=this._leftAccidental:this._hasAlternate&&this.down&&(t-=this._noteWidth),this._parenthesisWidth>0&&(t-=this.context.staffMetrics.parenthesisSpacing+this._parenthesisWidth);var e="arpeggio",i="arpeggio";switch(this.noteSet.arpeggio){case Sn.UP_ARPEGGIO:e="arpeggioUp";break;case Sn.DOWN_ARPEGGIO:i="arpeggioDown"}var n=this.minPitchLine-.5,r=this.maxPitchLine+.5,o=n-r;Math.floor(o)<o&&(n-=.25,r+=.25);for(var s=!0,a=n;a<r;a+=1){var l;l=a<r-1?s?i:"arpeggio":e;var u=new Zo(this.context,this.foundry.getSymbol(l));u.horizontalAnchor=Zo.ANCHOR_LEFT,u.distanceX=t,u.distanceY=a,this.addGlyphLayout(u),s=!1}this.padding=this.padding.clone(),this.padding.x-=this.context.staffMetrics.arpeggioSpacing,this.padding.width+=this.context.staffMetrics.arpeggioSpacing}},{key:"addStems",value:function(){var t=this.stemNoteHead,e=!this.beam,i=this.noteSet.grace&&!this.noteSet.appoggiatura&&null==this.noteSet.previousGraceNote,n=!0,r=!1,o=void 0;try{for(var s,a=this.foundry.getStem(this.noteSet.value,this._stemLength,this.down,e,i,t)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,yr),h=new Zo(this.context,u);h.distanceX=this._voiceOffset+this.stemOffset,h.distanceY=this.stemStartLine,this.addGlyphLayout(h),A.is(u,Jr)&&(this._stemLayout=h)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"addLegerLines",value:function(){for(var t=Math.ceil(this.minPitchLine);t<0;)this.addLeger(t,t>=this._minAlternateLine),t++;for(var e=Math.floor(this.maxPitchLine);e>this.clef.staffHeight;)this.addLeger(e,e<=this._maxAlternateLine),e--}},{key:"addArticulationSpacers",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.noteSet.articulations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToString(o);if(0!=(A.intToUint(Sn.ARTICULATION_ATTRIBUTES[s])&Sn.AFFECTS_WIDTH)){var a=this.foundry.getArticulation(s,!0,this._isTab),l=new Zo(this.context,new gr(0,0));l.horizontalAnchor=Zo.ANCHOR_LEFT,l.distanceX=a.width/this.context.staffMetrics.lineSpacing,this.addGlyphLayout(l),(l=new Zo(this.context,new gr(0,0))).horizontalAnchor=Zo.ANCHOR_RIGHT,l.distanceX=a.width/this.context.staffMetrics.lineSpacing,this.addGlyphLayout(l)}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"calculateClear",value:function(){var t=.5;this._singleNoteLiaison&&(t+=this.context.staffMetrics.tieSingleNoteBelowSpacing),this._down?(this._clearBottom=this.maxPitchLine-this.stemLength-this.context.staffMetrics.articulationPadding,this._clearTop=this.maxPitchLine+t+this.context.staffMetrics.articulationPadding):(this._clearBottom=this.minPitchLine-t-this.context.staffMetrics.articulationPadding,this._clearTop=this.minPitchLine+this.stemLength+this.context.staffMetrics.articulationPadding),this._extrasBottom=this._extrasTop=NaN}},{key:"addArticulations",value:function(){if(0!==this.noteSet.articulations.length)if(this._multiVoice)this._down?this.addBelowArticulations(this.noteSet.articulations,this.hasStem?0:this.noteWidth/2):this.addAboveArticulations(this.noteSet.articulations,this.hasStem?this.noteWidth:this.noteWidth/2);else if(this._down)this.addAboveArticulations(this.noteSet.articulations,this.noteWidth/2);else{var t=[],e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.noteSet.articulations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToString(a);0!=(Sn.ARTICULATION_ATTRIBUTES[l]&Sn.ALWAYS_ABOVE_STAFF)?t.push(l):e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.addAboveArticulations(t,this.hasStem?this.noteWidth:this.noteWidth/2),this.addBelowArticulations(e,this.noteWidth/2)}}},{key:"addStemDecorationGlyph",value:function(t){var e=this.foundry.getStemDecorationSymbol(t),i=new Zo(this.context,e);this.positionStemDecorationSymbol(i,this.context.staffMetrics.stemDecorationVerticalStemOffset,this.context.staffMetrics.stemDecorationVerticalNoteOffset),this.addGlyphLayout(i)}},{key:"addAboveArticulations",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToString(a);if(Sn.ARTICULATION_ATTRIBUTES[l]!=Sn.ARTICULATION_LIAISON)if(Sn.ARTICULATION_ATTRIBUTES[l]==Sn.STEM_DECORATION)this.addStemDecorationGlyph(l);else{var u=this.foundry.getArticulation(l,!0,this._isTab),h=new Zo(this.context,u),c=A.intToUint(Sn.ARTICULATION_ATTRIBUTES[l]);if(h.affectsWidth=0!=(c&Sn.AFFECTS_WIDTH),h.verticalAnchor=Zo.ANCHOR_BOTTOM,0==(c&Sn.ALLOWED_IN_STAFF))this.clearAboveStaff(0);else if(this._clearTop<this.clef.displayLineEndIndex-1+this.context.staffMetrics.articulationPadding)if(1==this.clef.displayLineSpacing&&this.clef.showLegerLines)this._clearTop=Math.floor(this._clearTop+.4999)+.5-h.height/2;else{this._clearTop-=h.height/2;for(var d=this.clef.displayLineEndIndex-1;d>=this.clef.displayLineStartIndex;d-=this.clef.displayLineSpacing)if(Math.abs(this._clearTop-d)<.5){this._clearTop=d+.5-h.height/2;break}}var f=1;l!=Sn.BEND_ARTICULATION||this.down||(f/=2),h.distanceX=e*f+this._voiceOffset,0!=(c&Sn.PLACE_TO_RIGHT)&&(h.distanceX+=this.context.staffMetrics.rightArticulationPadding),h.distanceY=this._clearTop+h.height,this.addGlyphLayout(h),this._clearTop+=h.height+this.context.staffMetrics.articulationSpacing}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"addBelowArticulations",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToString(a);if(Sn.ARTICULATION_ATTRIBUTES[l]!=Sn.ARTICULATION_LIAISON)if(Sn.ARTICULATION_ATTRIBUTES[l]==Sn.STEM_DECORATION)this.addStemDecorationGlyph(l);else{var u=this.foundry.getArticulation(l,!1,this._isTab),h=new Zo(this.context,u),c=A.intToUint(Sn.ARTICULATION_ATTRIBUTES[l]);if(h.affectsWidth=0!=(c&Sn.AFFECTS_WIDTH),h.verticalAnchor=Zo.ANCHOR_BOTTOM,0==(c&Sn.ALLOWED_IN_STAFF))this.clearBelowStaff(0);else if(this._clearBottom>this.clef.displayLineStartIndex-this.context.staffMetrics.articulationPadding)if(1==this.clef.displayLineSpacing&&this.clef.showLegerLines)this._clearBottom=Math.ceil(this._clearBottom-.4999)-.5+h.height/2;else{this._clearBottom+=h.height/2;for(var d=this.clef.displayLineStartIndex;d<this.clef.displayLineEndIndex;d+=this.clef.displayLineSpacing)if(Math.abs(this._clearBottom-d)<.5){this._clearBottom=d-.5+h.height/2;break}}h.distanceX=e+this._voiceOffset,0!=(c&Sn.PLACE_TO_RIGHT)&&(h.distanceX+=this.context.staffMetrics.rightArticulationPadding),h.distanceY=this._clearBottom,this.addGlyphLayout(h),this._clearBottom-=h.height+this.context.staffMetrics.articulationSpacing}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"addTremoloMarks",value:function(){var t=this.noteSet.tremolo;t>e.MAX_SUPPORTED_TREMOLO_MARKS&&(t=e.MAX_SUPPORTED_TREMOLO_MARKS);var i=this.foundry.getTremolo(t,this.down);this._tremoloLayout=new Zo(this.context,i),this.positionStemDecorationSymbol(this._tremoloLayout,this.context.staffMetrics.tremoloVerticalStemOffset,this.context.staffMetrics.tremoloVerticalNoteOffset),this.addGlyphLayout(this._tremoloLayout)}},{key:"addEffects",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._noteLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=o.note.preEffect,a=o.note.postEffect;null!=s&&this.addPreEffect(s,o),null!=a&&this.addPostEffect(a,o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"addPreEffect",value:function(t,e){var i=0,n=e.note.tieEnd,r=0,o=this.hasAlternate&&this.down;switch(t.type){case xn.SCOOP:o&&0==this._leftAccidental&&(r+=this.effectAlternateSpacing(e.pitchLine,2,.5)),i=-this._noteHeight,n&&!this._down&&(i+=this.context.staffMetrics.tieEffectVerticalPadding);break;case xn.PLOP:o&&0==this._leftAccidental&&(r+=this.effectAlternateSpacing(e.pitchLine,.5,2)),i=this._noteHeight,n&&this._down&&(i-=this.context.staffMetrics.tieEffectVerticalPadding);break;case xn.RIP1:case xn.RIP2:if(o){var s=2.5;this._leftAccidental>0&&(s+=.5),r+=this.effectAlternateSpacing(e.pitchLine,s,.5)}return void this.addDraggablePreEffect(t,e,r)}var a=new Zo(this.context,this.foundry.getSymbol(t.type));a.horizontalAnchor=Zo.ANCHOR_RIGHT,a.distanceX=this.context.staffMetrics.glyphEffectSpacing+r+this._leftAccidental,a.distanceY=e.pitchLine+i,e.addGlyphLayout(a)}},{key:"addPostEffect",value:function(t,e){var i=0,n=!1,r=this.context.staffMetrics.glyphEffectSpacing+this.noteWidth+this.leftX;switch(this.hasAlternate&&!this.down&&(r+=this.noteWidth),this.alternateVoiceNoteSetLayout&&0===this._voiceOffset&&(r+=this.alternateVoiceNoteSetLayout.alternateVoiceOffset),t.type){case xn.QUICK_FALL:n=this.down,i=-this._noteHeight/2,i-=e.onStaffLine?this.context.staffMetrics.postEffectVerticalSpacing:0;break;case xn.DOIT:n=!this.dotsDown,i=this._noteHeight/2,i+=e.onStaffLine?this.context.staffMetrics.postEffectVerticalSpacing:0;break;case xn.FALL1:case xn.FALL2:return void this.addDraggablePostEffect(t,e,r)}!this.noteSet.dots||e.onStaffLine&&!n||(r+=2*this.context.staffMetrics.dotSpacing,2==this.noteSet.dots&&(r+=this.context.staffMetrics.multipleDotGap));var o=new Zo(this.context,this.foundry.getSymbol(t.type));o.horizontalAnchor=Zo.ANCHOR_LEFT,o.distanceX=r,o.distanceY=e.pitchLine+i,e.addGlyphLayout(o)}},{key:"addDraggablePreEffect",value:function(t,e,i){var n=new Ps(this.context,this.measureLayout,t,this.clef),r=e.originY+n.verticalSpacing;r+=e.onStaffLine?0:n.offLinePadding,n.spacingY=r-t.dy,n.spacingX=-n.horizontalSpacing+this.x-i+t.dx,n.affectsWidth=!1,e.addGlyphLayout(n)}},{key:"addDraggablePostEffect",value:function(t,e,i){var n=new Is(this.context,this.measureLayout,t,this.clef),r=n.verticalSpacing;r+=e.onStaffLine?0:n.offLinePadding,n.spacingY=r-e.pitchLine-t.dy;var o=n.horizontalSpacing+i+t.dx;this.dotsDown&&e.onStaffLine&&(o+=2*this.context.staffMetrics.dotSpacing,2==this.noteSet.dots&&(o+=this.context.staffMetrics.multipleDotGap)),n.spacingX=o,n.affectsWidth=!1,e.addGlyphLayout(n)}},{key:"effectAlternateSpacing",value:function(t,e,i){var n=e,r=i,o=!0,s=!1,a=void 0;try{for(var l,u=this._alternatePitchLines[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;t<=h?r=Math.min(h-t,r):n=Math.min(t-h,n)}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return n<e||r<i?this.noteWidth:0}},{key:"positionStemDecorationSymbol",value:function(t,e,i){var n=this._isTab&&!this._showRhythm,r=this.down||n,o=this.hasStem&&!n;if(o)t.distanceY=this.stemEnd.y-e*(r?-1:1);else{var s=r?this.minPitchLine:this.maxPitchLine;t.distanceY=s+i*(r?-1:1)}t.distanceX=o?this.down?this.stemOffset:this.stemEnd.x:this.noteWidth/2}},{key:"addLeger",value:function(t,e){var i,n,r=e?2:1,o=(this.down&&e?-1:0)*this._noteHead.width,s=this.context.staffMetrics.legerLineThickness*this.context.staffMetrics.lineSpacing;i=new Kr(this._noteHead.width*(r+this.context.staffMetrics.legerLineRatio),s,o+this._noteHead.width*(-this.context.staffMetrics.legerLineRatio/2)),(n=new Zo(this.context,i)).affectsWidth=!1,n.distanceX=this._voiceOffset,n.distanceY=t,this.addGlyphLayout(n)}},{key:"determineLiaisons",value:function(){if(this._liaisonsDetermined)return this._hasLiaisons;if(this.liaisonEndLayout=null,this._liaisonsDetermined=!0,this._hasLiaisons=this.noteSet.liaisonStart||this.noteSet.hasArticulationWithAttribute(Sn.ARTICULATION_LIAISON),this._hasLiaisons){var t=this.measureLayout.notationLayouts,e=t.indexOf(this);if(e<0)throw new Error("Couldn't find note set layout in parent measure layout!");for(e++;e<t.length;){if(A.unknownToType(t[e],Uo).notation.voiceNumber==this.noteSet.voiceNumber&&A.is(A.unknownToType(t[e],Uo).notation,mn))return this.liaisonEndLayout=A.unknownToType(t[e],Uo),this._hasLiaisons;e++}var i=this.measureLayout.nextLayout;if(null!=i){for(i.validateLayout(),t=i.notationLayouts,e=0;e<t.length;){if(A.unknownToType(t[e],Uo).notation.voiceNumber==this.noteSet.voiceNumber&&A.is(A.unknownToType(t[e],Uo).notation,mn))return this.liaisonEndLayout=A.unknownToType(t[e],Uo),this._hasLiaisons;e++}for(e=0;e<t.length;){if(A.unknownToType(t[e],Uo).notation.voiceNumber!=this.noteSet.voiceNumber&&A.is(A.unknownToType(t[e],Uo).notation,mn))return this.liaisonEndLayout=A.unknownToType(t[e],Uo),this._hasLiaisons;e++}}}return this._hasLiaisons}},{key:"invalidateGlobal",value:function(){s(h(e.prototype),"invalidateGlobal",this).call(this),this._liaisonsDetermined=!1}},{key:"doValidateGlobalLayout",value:function(){this.calculateClear(),this.addArticulations(),this.reviseBoundsAndGeometry()}},{key:"preValidateGlobal",value:function(){var t=this._glyphLayouts.slice();this.validateGlobalLayout(),this._glyphLayouts=t,this.invalidateGlobal()}},{key:"createDisplayObject",value:function(t){return new Hh(t,this)}},{key:"floating",get:function(){return this.noteSet.grace}},{key:"direction",get:function(){var t;return this.context.staffMetrics.ignoreStemDirection||null==(t=this.noteSet.direction)?null!=(t=this.clef.tabStemDirection)?t:this.noteSet.grace&&!this.multiVoice?he.DIRECTION_UP:this.clef.sign==Mn.PERCUSSION_CLEF_SIGN&&1==this.measureLayout.measure.numVoices?this.maxPitchLine<=Mn.PERCUSSION_SPLIT_LINE?he.DIRECTION_DOWN:he.DIRECTION_UP:null:t}},{key:"glyphScale",get:function(){return this.noteSet.grace?s(h(e.prototype),"glyphScale",this)*(this._isTab?this.context.staffMetrics.tabGraceScale:this.context.staffMetrics.graceScale):s(h(e.prototype),"glyphScale",this)}},{key:"leftX",get:function(){return this.x+this._voiceOffset}},{key:"noteWidth",get:function(){return this._noteWidth}},{key:"noteHeight",get:function(){return this._noteHeight}},{key:"hasAlternate",get:function(){return this._hasAlternate}},{key:"showRhythm",get:function(){return this._showRhythm}},{key:"isTab",get:function(){return this._isTab}},{key:"stemLength",set:function(t){(o(h(e.prototype),"stemLength",t,this,!0),null!=this._stemLayout)&&(A.as(this._stemLayout.glyph,Jr).height=t*this.context.staffMetrics.lineSpacing,null!=this._tremoloLayout&&this.positionStemDecorationSymbol(this._tremoloLayout,this.context.staffMetrics.tremoloVerticalStemOffset,this.context.staffMetrics.tremoloVerticalNoteOffset))},get:function(){return s(h(e.prototype),"stemLength",this)}},{key:"hasStem",get:function(){return this.noteSet.value<mn.WHOLE&&!this.isPlainSlash&&!this.furthestNoteFromStem.stemless}},{key:"ascendingNoteLayouts",get:function(){var t=this.noteLayouts.slice();return e.sortNoteLayouts(t),t}},{key:"stemmingLine",get:function(){if(X.isNaN(this._stemmingLine)){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.noteSet.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t+=this.clef.getPitchLine(this.measureLayout.getScoreNote(s))*this.clef.lineSpacing}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this._stemmingLine=t/this.noteSet.notes.length}return this._stemmingLine}},{key:"maxPitchLine",get:function(){if(X.isNaN(this._maxLine)){var t=this.noteSet.notes[this.noteSet.notes.length-1];this._maxLine=this.clef.getPitchLine(this.measureLayout.getScoreNote(t))*this.clef.lineSpacing}return this._maxLine}},{key:"minPitchLine",get:function(){if(X.isNaN(this._minLine)){var t=this.noteSet.notes[0];this._minLine=this.clef.getPitchLine(this.measureLayout.getScoreNote(t))*this.clef.lineSpacing}return this._minLine}},{key:"maxAccidentalLine",get:function(){for(var t=this.noteSet.notes.length-1;t>=0;t--){var e=this.measureLayout.getScoreNote(this.noteSet.notes[t]);if(null!=e.accidental)return this.clef.getPitchLine(e)*this.clef.lineSpacing}return Hy.MIN_VALUE}},{key:"minAccidentalLine",get:function(){for(var t=0;t<this.noteSet.notes.length;t++){var e=this.measureLayout.getScoreNote(this.noteSet.notes[t]);if(null!=e.accidental)return this.clef.getPitchLine(e)*this.clef.lineSpacing}return Hy.MAX_VALUE}},{key:"stemStartLine",get:function(){return this._isTab?this.down?-1:this.clef.staffHeight+1:this.down?this.maxPitchLine:this.minPitchLine}},{key:"nearestStemLine",get:function(){return this.down?Math.min(this.clef.staffHeight+1.5,this.minPitchLine):Math.max(-1.5,this.maxPitchLine)}},{key:"alternateVoiceNoteSetLayout",get:function(){return A.as(this.alternateVoiceLayout,e)}},{key:"numNoteLayouts",get:function(){return this._noteLayouts.length}},{key:"stemOffset",get:function(){return this._isTab?this.context.staffMetrics.tabStemOffset:0}},{key:"stemEnd",get:function(){if(null==this._stemLayout&&(this.hasStem&&this.addStems(),null==this._stemLayout||!this.hasStem))return new If((this.noteSet.rhythmPosition?0:this.noteWidth)+this.stemOffset,(this.minPitchLine+this.maxPitchLine)/2);var t=A.as(this._stemLayout.glyph,Jr).startX/this.context.staffMetrics.lineSpacing+this.stemOffset,e=this.down?this.stemStartLine-this.stemLength:this.stemStartLine+this.stemLength;return new If(t,e)}},{key:"notationWidth",get:function(){return this._noteWidth}},{key:"standardStemLength",get:function(){var t=this.glyphScale*(this.hasStem?this.context.staffMetrics.normalStemLength:this.context.staffMetrics.nullStemLength);return null!=this.clef.tabStemDirection?t:(this.multiVoice&&(this.down?t-=Math.min(this.context.staffMetrics.stemMultiVoiceCutback,Math.max(0,this.clef.centerLine-this.minPitchLine)):t-=Math.min(this.context.staffMetrics.stemMultiVoiceCutback,Math.max(0,this.maxPitchLine-this.clef.centerLine))),t+=this.maxPitchLine-this.minPitchLine,t+=this.down?Math.max(0,this.minPitchLine-this.clef.staffHeight-1.5):Math.max(0,-this.maxPitchLine-1.5))}},{key:"dotsDown",get:function(){return this._down&&this._multiVoice&&this.hasStem&&!(null!=this.alternateVoiceNoteSetLayout&&0===this._voiceOffset&&this.maxPitchLine==this.alternateVoiceNoteSetLayout.minPitchLine)}},{key:"crossoverLines",get:function(){return this.alternateVoiceNoteSetLayout?this.down?this.maxPitchLine-this.alternateVoiceNoteSetLayout.minPitchLine:this.alternateVoiceNoteSetLayout.maxPitchLine-this.minPitchLine:0}},{key:"crossoverAccidentalLines",get:function(){return this.alternateVoiceNoteSetLayout?this.down?this.maxAccidentalLine-this.alternateVoiceNoteSetLayout.minAccidentalLine:this.alternateVoiceNoteSetLayout.maxAccidentalLine-this.minAccidentalLine:Number.MIN_VALUE}},{key:"stemNoteHead",get:function(){return this.furthestNoteFromStem.noteHead}},{key:"furthestNoteFromStem",get:function(){return this.down?this.noteSet.getNoteAt(this.noteSet.notes.length-1):this.noteSet.getNoteAt(0)}},{key:"isPlainSlash",get:function(){return this.stemNoteHead==de.SLASH_NOTE_HEAD&&this.noteSet.duration==this.measureLayout.measure.timeSignature.defaultBeatGroupDuration&&zl.groupStartsAt(this.measureLayout.measure.timeSignature.beatGroups,this.noteSet.rhythmPosition)}},{key:"alternateVoiceOffset",get:function(){if(this.alternateVoiceNoteSetLayout&&!this.alternateVoiceLayout.noteSet.invisible){if(this._isTab)return this.noteSet.grace||this.noteSet.previousGraceNote||!this.alternateVoiceNoteSetLayout.noteSet.previousGraceNote?0:this.context.staffMetrics.initialGracePadding.x-this.context.staffMetrics.tabFretWidth;if(!(this.down&&this.alternateVoiceNoteSetLayout.noteSet.dots>0&&0===this.noteSet.dots)&&(!this.down&&0===this.alternateVoiceNoteSetLayout.noteSet.dots&&this.noteSet.dots>0||this.down)){var t=this.crossoverLines;if((!this.hasStem||!this.alternateVoiceNoteSetLayout.hasStem)&&t>=-.5)return this.alternateVoiceNoteSetLayout.noteSet.dots>0?this.context.staffMetrics.wholeCrossoverOffset+2*this.context.staffMetrics.dotSpacing+this.context.staffMetrics.multipleDotGap*(this.alternateVoiceNoteSetLayout.noteSet.dots-1):this.context.staffMetrics.wholeCrossoverOffset;if(0===t&&this.noteSet.dots==this.alternateVoiceNoteSetLayout.noteSet.dots&&(this.noteSet.getNoteAt(0).noteHead||de.NORMAL_NOTE_HEAD)==(this.alternateVoiceNoteSetLayout.noteSet.getNoteAt(0).noteHead||de.NORMAL_NOTE_HEAD)&&this.noteSet.value==mn.HALF==(this.alternateVoiceNoteSetLayout.noteSet.value==mn.HALF))return 0;if(t>=0)return this.context.staffMetrics.crossoverOffset;if(-.5==t)return this.down?this.context.staffMetrics.nearCrossoverOffset:this.context.staffMetrics.crossoverOffset}}return 0}},{key:"lyricExclusionBottom",get:function(){if(this.down&&0===this.noteSet.lyrics.length&&this.noteSet.liaisonCount>0){var t=2*this.context.staffMetrics.getDurationWidth(A.numberToUint(this.noteSet.duration));return Math.min(this.bounds.top,this.minPitchLine-this.noteHeight-this.context.staffMetrics.tieStandardHeight(t))}this.noteSet.articulations.length>0&&(this._multiVoice?this._down:!this._down)&&this.preValidateGlobal();var i=s(h(e.prototype),"lyricExclusionBottom",this);return null!=this._tupletLayout&&this._tupletLayout.down&&this._tupletLayout.tuplet.shown&&(i-=this.context.staffMetrics.tupletHeight+this.context.staffMetrics.tupletBracketHeight),i}},{key:"lyricExclusionTop",get:function(){if(!this.down&&0===this.noteSet.lyrics.length&&this.noteSet.liaisonCount>0){var t=2*this.context.staffMetrics.getDurationWidth(A.numberToUint(this.noteSet.duration));return Math.max(this.bounds.top+this.bounds.height,this.maxPitchLine+this.noteHeight+this.context.staffMetrics.tieStandardHeight(t))}this.noteSet.articulations.length>0&&(this._multiVoice?!this._down:this._down)&&this.preValidateGlobal();var i=s(h(e.prototype),"lyricExclusionTop",this);return null!=this._tupletLayout&&!this._tupletLayout.down&&this._tupletLayout.tuplet.shown&&(i+=this.context.staffMetrics.tupletHeight+this.context.staffMetrics.tupletBracketHeight),i}}],[{key:"sortNoteLayouts",value:function(t){t.sort(function(t,e){return de.compareNotePitch(t.note,e.note)})}},{key:"upToDownLiaison",value:function(t,e){return null!=t&&null!=e&&(!t.down&&t.hasStem&&e.down)}}]),e}();r.implementsInterfaces(_s,[rs]),r.registerClass(_s,"com.noteflight.notation.layout.NoteSetLayout");var Ss=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._staffLayouts=[],n._systemMeasureLayouts=[],n._systemMeasurePrefixesLayouts={},n._partStaffIndices=[],n._unpaddedHeight=NaN,n._topPadding=NaN,n._bottomPadding=NaN,n.NO_PADDING_CACHED=-9999,n._cachedLeftPadding=n.NO_PADDING_CACHED,n}return c(e,Yo),p(e,[{key:"showPartNames",value:function(){return this.score.showPartNameNextToStaff(this.startMeasureIndex)}},{key:"getSystemMeasurePrefixesLayoutByMeasureIndex",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=xt.objectForOfSource(this._systemMeasurePrefixesLayouts)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.measureIndex==t)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"revalidateSystemMeasurePrefixesAt",value:function(t){var e=t-this.startMeasureIndex;this._systemMeasurePrefixesLayouts[e]&&(this._systemMeasurePrefixesLayouts[e].invalidateLayouts(),this._systemMeasurePrefixesLayouts[e].validateLayouts())}},{key:"getPartLabel",value:function(t){return 0===this.startMeasureIndex?t.name:t.shortName}},{key:"destroyChildren",value:function(){for(var t=0;t<this._staffLayouts.length;t++)this._staffLayouts[t].destroy();for(t=0;t<this._systemMeasureLayouts.length;t++)this._systemMeasureLayouts[t].destroy();var e=!0,i=!1,n=void 0;try{for(var r,o=xt.objectForOfSource(this._systemMeasurePrefixesLayouts)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.destroy()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"canHide",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._staffLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){if(!n.value.canHide)return!1}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!0}},{key:"getPrefixesLayout",value:function(t,e){for(var i=new gs(t),n=this.canHide(),r=0;r<e.length;r++){var o=[],s=!0,a=!1,l=void 0;try{for(var u,h=this._staffLayouts[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=c.getMeasureLayoutByIndex(t);!d||!n&&d.measure.canHideStaff||o.push(c.getMeasurePrefixByIndexAt(t,r))}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}if(o.length){var f=new Us(this.context,this.displayMode);f.setValidMeasureLayouts(o),i.addPrefix(f)}}return i}},{key:"createSystemMeasurePrefixesLayouts",value:function(){this._systemMeasurePrefixesLayouts={};for(var t=this.startMeasureIndex;t<=this.endMeasureIndex;t++){var e=t-this.startMeasureIndex,i=this._staffLayouts[0].getMeasurePrefixesLayoutByMeasureIndex(t);i&&(this._systemMeasurePrefixesLayouts[e]=this.getPrefixesLayout(t,i.prefixes),this._systemMeasurePrefixesLayouts[e].validateLayouts())}}},{key:"setLayouts",value:function(t,e){this.destroyChildren(),this._staffLayouts=t,this._systemMeasureLayouts=e,this.createSystemMeasurePrefixesLayouts(),this.invalidate()}},{key:"insertSystemMeasureLayout",value:function(t,e){this._systemMeasureLayouts.splice(e,0,t)}},{key:"removeSystemMeasureLayout",value:function(t){var e=this._systemMeasureLayouts[t];e&&(e.destroy(),this._systemMeasureLayouts.splice(t,1))}},{key:"getStaffLayoutAt",value:function(t){return this._staffLayouts[t]}},{key:"getSystemMeasureLayoutAt",value:function(t){return this._systemMeasureLayouts[t]}},{key:"invalidateCache",value:function(){this._cachedLeftPadding=this.NO_PADDING_CACHED}},{key:"invalidate",value:function(){s(h(e.prototype),"invalidate",this).call(this),this.invalidateCache()}},{key:"invalidateGlobal",value:function(){s(h(e.prototype),"invalidateGlobal",this).call(this),this.invalidateCache();var t=!0,i=!1,n=void 0;try{for(var r,o=this._staffLayouts[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.invalidateGlobal()}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"invalidateSystemStart",value:function(){this.invalidate();var t=!0,e=!1,i=void 0;try{for(var n,r=this._staffLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.invalidateSystemStart()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"prepareLayout",value:function(){this.createLayout(!1)}},{key:"doValidateLayout",value:function(){this.createLayout(!0)}},{key:"doValidateGlobalLayout",value:function(){s(h(e.prototype),"doValidateGlobalLayout",this).call(this),this.determineStaffPositions()}},{key:"createLayout",value:function(t){var e,i=new ia([]),n=(new ia([]),null);this._partStaffIndices=[];for(var r=0;r<this._staffLayouts.length;r++)e=this._staffLayouts[r],t?e.validateLayout():e.prepareLayout();for(r=0;r<this._staffLayouts.length;r++)e=this._staffLayouts[r],i.addConstraint(e.constraint),e.staff.part==n?this._partStaffIndices[this._partStaffIndices.length-1].push(r):(this._partStaffIndices.push([r]),n=e.staff.part);this._constraint=new oa([new ra(this.leftPadding),i]);var o=!0,s=!1,a=void 0;try{for(var l,u=this._staffLayouts[Symbol.iterator]();!(o=(l=u.next()).done);o=!0)(e=l.value).createHyphens()}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}var h=this.getStaffLayoutAt(0);this.leftMargin=this.context.staffMetrics.ignoreSystemMargins?0:h.getMeasureLayoutAt(0).measure.systemMeasure.effectiveLeftMargin,this.rightMargin=this.context.staffMetrics.ignoreSystemMargins?0:h.getMeasureLayoutAt(h.length-1).measure.systemMeasure.rightMargin}},{key:"determineStaffPositions",value:function(){var t,e,i=0;for(this._height=0,e=0;e<this._staffLayouts.length;e++)(t=this._staffLayouts[e]).validateGlobalLayout();var n={};for(e=0;e<this._staffLayouts.length;e++)if(t=this._staffLayouts[e],0===e&&(this._topPadding=t.topPadding,i+=this._topPadding),this._height+=t.height,i+=t.height,t.distanceY=i,n[e]=i,e!=this._staffLayouts.length-1){var r=Math.max(this.context.staffMetrics.staffSpacing,t.bottomPadding+this._staffLayouts[e+1].topPadding+this.context.staffMetrics.minVerticalGap);this._height+=r,i+=r}this._unpaddedHeight=this._height,null!=t&&(this._bottomPadding=t.bottomPadding),this._height+=this.getStaffLayoutAt(0).topPadding,this.dispatchStaffPositionEvent(n)}},{key:"dispatchStaffPositionEvent",value:function(t){var e=new Vi(Vi.STAFF_SPACING);e.staffYs=t,e.systemHeight=this._height,e.topPadding=this._topPadding,this.dispatchEvent(e)}},{key:"updateHyphens",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!0,n=!1,r=void 0;try{for(var o,s=this._staffLayouts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e&&-1==e.indexOf(a.staff)||a.updateHyphens(t)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"createDisplayObject",value:function(t){return new Xh(t,this)}},{key:"staffLayouts",get:function(){return this._staffLayouts}},{key:"systemMeasureLayouts",get:function(){return this._systemMeasureLayouts}},{key:"systemMeasure",get:function(){return this.getSystemMeasureLayoutAt(0).systemMeasure}},{key:"hasPageBreak",get:function(){return this.systemMeasureLayouts[this.systemMeasureLayouts.length-1].hasPageBreak}},{key:"partStaffIndices",get:function(){return this._partStaffIndices}},{key:"unpaddedHeight",get:function(){return this._unpaddedHeight}},{key:"score",get:function(){return this.getStaffLayoutAt(0).staff.score}},{key:"bottomY",get:function(){return this.distanceY+this.height+this._bottomPadding}},{key:"topPadding",get:function(){return this._topPadding}},{key:"bottomPadding",get:function(){return this._bottomPadding}},{key:"leftPadding",get:function(){if(this._cachedLeftPadding==this.NO_PADDING_CACHED)if(this.showPartNames()){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this._staffLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=this.getPartLabel(s.staff.part);t=Math.max(t,fc.getTextWidth(this.context.staffMetrics,this.context.staffMetrics.staffTextFont,this.context.staffMetrics.partNameSize,!1,!1,!1,a))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this._cachedLeftPadding=t+this.context.staffMetrics.staffLabelPadding}else this._cachedLeftPadding=0;return this._cachedLeftPadding}},{key:"flowWidth",get:function(){var t=this.leftPadding,e=!0,i=!1,n=void 0;try{for(var r,o=this._systemMeasureLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=this.getSystemMeasurePrefixesLayoutByMeasureIndex(A.intToUint(s.systemMeasure.index));a&&(t+=a.totalFlowWidth),t+=s.flowWidth}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"totalWidth",get:function(){return this.flowWidth+this.leftMargin+this.rightMargin}},{key:"partLabelProperty",get:function(){return 0===this.startMeasureIndex?"name":"shortName"}},{key:"staffStartLayouts",get:function(){return 0===this._staffLayouts.length?[]:this._staffLayouts[0].staffStartLayouts}},{key:"startMeasureIndex",get:function(){return this.getStaffLayoutAt(0).startMeasureIndex}},{key:"endMeasureIndex",get:function(){return this.getStaffLayoutAt(0).endMeasureIndex}}]),e}();r.registerClass(Ss,"com.noteflight.notation.layout.SystemLayout");var Ls=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._overlayInitialized=!1,n}return c(e,Ss),p(e,[{key:"determineStaffPositions",value:function(){this._overlayInitialized||(s(h(e.prototype),"determineStaffPositions",this).call(this),this._overlayInitialized=!0)}},{key:"dispatchStaffPositionEvent",value:function(t){}},{key:"getPartLabel",value:function(t){return t.shortName}},{key:"setStaffSpacing",value:function(t){for(var e in t.staffYs){this._staffLayouts[A.stringToNumber(e)].distanceY=A.unknownToNumber(t.staffYs[e])}this._height=t.systemHeight,this._topPadding=t.topPadding}},{key:"showPartNames",value:function(){return this.score.effectiveStaffMetrics.showPartNames&&this.score.effectiveStaffMetrics.partNamePosition==pn.PART_NAME_POSITION_STAFF}},{key:"swapStaffStartMeasures",value:function(t){var e,i;for(e in this.staffLayouts){var n=(i=this.staffLayouts[e]).staff.getMeasureAt(A.intToUint(t));i.staffStartLayout.measure=n}for(e in this.invalidateSystemStart(),this.validateLayout(),this.staffLayouts)(i=this.staffLayouts[e]).invalidateGlobal(),i.validateGlobalLayout();this.dispatchEvent(new Ki(Ki.STAFF_START_CHANGE))}},{key:"createDisplayObject",value:function(t){return new jh(t,this)}},{key:"partLabelProperty",get:function(){return"shortName"}},{key:"startMeasureIndex",get:function(){return this.getStaffLayoutAt(0).staffStartLayout.measure.index}}]),e}();r.registerClass(Ls,"com.noteflight.notation.layout.OverlaySystemLayout");var ks=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).index=0,n.pageHeight=NaN,n.firstSystemY=NaN,n.pageBreakHeight=NaN,n._chunkLayouts=[],n.index=i,n.initChunkLayouts(),n}return c(e,Ro),p(e,[{key:"destroyChildren",value:function(){for(var t=0;t<this._chunkLayouts.length;t++)this._chunkLayouts[t].destroy()}},{key:"initChunkLayouts",value:function(){this._chunkLayouts=[];var t=this.context.staffMetrics;if(this.pageBreakHeight=this.context.pageMetrics.contentHeight/t.lineSpacing,0===this.index){var e=0;null!==this.score.supertitle&&(e=t.titlePageSupertitlePadding+fc.getTextHeight(t,t.supertitleFont,-t.supertitleSize,t.supertitleBold,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.supertitle)),this.firstSystemY=t.titlePageTopPadding+t.titlePageFirstStaffPadding;var i=t.titleY+e+fc.getTextHeight(t,t.titleFont,-t.titleSize,t.titleBold,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.title)+t.composerBottomPadding;this.score.subtitle&&(i+=t.titlePageSubtitlePadding+fc.getTextHeight(t,t.subtitleFont,-t.subtitleSize,t.subtitleBold,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.subtitle));var n=(i=Math.max(i,t.composerY))+t.composerBottomPadding+fc.getTextHeight(t,t.composerFont,-t.composerSize,!1,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.composer);this.firstSystemY=Math.max(this.firstSystemY,n);var r=i+t.composerBottomPadding+fc.getTextHeight(t,t.lyricistFont,-t.composerSize,!1,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.lyricist),o=r;if(this.score.showArranger)o=r+t.arrangerBottomPadding+fc.getTextHeight(t,t.arrangerFont,-t.composerSize,!1,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.arranger),!this.score.arranger&&this.score.lyricist&&(o+=t.arrangerPlaceholderBottomPadding);if(this.firstSystemY=Math.max(this.firstSystemY,o),this.pageBreakHeight-=fc.getTextHeight(t,t.copyrightFont,-t.copyrightSize,!1,!1,!1,this.context.pageMetrics.contentWidth,!0,!1,this.score.copyright),null!=this.score.prompt){var s=fc.getTextHeight(t,t.textFont,-t.titlePagePromptSize,!1,!1,!1,this.context.pageMetrics.contentWidth-t.titlePagePromptPadding.right*t.lineSpacing,!0,!0,this.score.prompt);this.firstSystemY+=s+t.titlePagePromptPadding.bottom}}else this.firstSystemY=t.pageTopPadding;this.positionChunkLayouts(),this.invalidate()}},{key:"checkChunkLayoutsAreConsecutive",value:function(){for(var t=-1,e=0;e<this._chunkLayouts.length;e++){var i=this._chunkLayouts[e];if(i.startMeasureIndex<t){this.truncateChunkLayouts(e);break}t=i.endMeasureIndex}}},{key:"truncateChunkLayouts",value:function(t){for(var e=t;e<this._chunkLayouts.length;e++)this._chunkLayouts[e].destroy();this._chunkLayouts=this._chunkLayouts.slice(0,t)}},{key:"positionChunkLayouts",value:function(){var t=null;this.pageHeight=this.firstSystemY;var e=!1,i=!0,n=!1,r=void 0;try{for(var o,s=this._chunkLayouts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.validateGlobalLayout(),this.positionChunk(a,t)&&(e=!0),this.pageHeight=a.bottomY,t=a}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}for(var l=[],u=0;u<this._chunkLayouts.length;u++)A.is(this._chunkLayouts[u],zo)||l.push(this._chunkLayouts[u]);if(null!=t&&l.length>1&&t.endMeasureIndex<this.score.numMeasures){var h=(this.pageBreakHeight-t.bottomY-this.context.staffMetrics.staffSpacing)/(this._chunkLayouts.length-1);if(h>0){for(var c={},d=1;d<l.length;d++){var f=l[d-1],y=l[d],g=y.distanceY;y.distanceY=y.pageBreakY+(f.distanceY-f.pageBreakY)+Math.min(h,this.context.staffMetrics.systemStretch),c[y.uuid]=y.distanceY-g}this.positionBlockLayoutsAfterSpacing(c),e=!0}}e&&this.invalidate()}},{key:"positionBlockLayoutsAfterSpacing",value:function(t){for(var e=0;e<this._chunkLayouts.length;e++){var i=this._chunkLayouts[e];if(A.is(i,zo)){var n=!1;if(i.block.hasColumnPositionedBeforeSystem){for(var r=e+1;r<this._chunkLayouts.length;r++)if(A.is(this._chunkLayouts[r],Ss)){n=!0;var o=t[this._chunkLayouts[r].uuid];o&&(i.distanceY=i.distanceY+o);break}}else for(var s=e-1;s>=0;s--)if(A.is(this._chunkLayouts[s],Ss)){n=!0;var a=t[this._chunkLayouts[s].uuid];a&&(i.distanceY=i.distanceY+a);break}n||(i.distanceY=this.pageBreakHeight-i.height),i.distanceY+i.height>this.pageBreakHeight&&(i.distanceY=this.pageBreakHeight-i.height)}}}},{key:"positionChunk",value:function(t,e){if(null!=e)t.pageBreakY=e.pageBreakY+e.height+Math.max(this.context.staffMetrics.systemSpacing,e.bottomPadding+t.topPadding+this.context.staffMetrics.minVerticalGap)-t.topPadding,A.is(t,zo)&&t.isFirstBeforeBlockOfMeasure&&(t.pageBreakY=t.pageBreakY+this.context.staffMetrics.blockBeforeBuffer),A.is(t,zo)&&t.isFirstAfterBlockOfMeasure&&(t.pageBreakY=t.pageBreakY+this.context.staffMetrics.blockAfterBuffer);else{var i=-this.context.staffMetrics.topStaffGap+this.firstSystemY;t.pageBreakY=Math.max(i,this.firstSystemY-t.topPadding)}var n=t.distanceY!=t.pageBreakY;return t.distanceY=t.pageBreakY,t.forceReflow=!1,n}},{key:"getChunkLayoutAt",value:function(t){return this._chunkLayouts[t]}},{key:"updateChunkLayout",value:function(t){var e=t.chunkLayout,i=t.pageChunkIndex;e.validateGlobalLayout();var n=null;i>0&&(n=this._chunkLayouts[i-1]),this.positionChunk(e,n),this._chunkLayouts[i]&&this._chunkLayouts[i].destroy(),this._chunkLayouts.splice(i,1,e)}},{key:"addChunkLayout",value:function(t){if(this._chunkLayouts.length>0&&t.startMeasureIndex>0&&this.score.getBreak(t.startMeasureIndex-1)==hl.PAGE_BREAK_TYPE)return this.positionChunkLayouts(),!1;t.validateGlobalLayout(),this._chunkLayouts.length>0?this.positionChunk(t,this._chunkLayouts[this._chunkLayouts.length-1]):this.positionChunk(t,null);var e=t.bottomY;return this._chunkLayouts.length>0&&e>this.pageBreakHeight?(this.positionChunkLayouts(),!1):(this._chunkLayouts.push(t),this.pageHeight=e,this.endMeasureIndex==this.score.numMeasures&&this.positionChunkLayouts(),this.invalidate(),!0)}},{key:"isFirstMeasureOfChunk",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._chunkLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){if(t==r.value.startMeasureIndex)return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"doValidateLayout",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._chunkLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.validateLayout()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"createDisplayObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Zh(t,this,e)}},{key:"getXPosition",value:function(t,e){return e.toViewUnits(t.leftMargin)}},{key:"revalidateMeasurePrefixesAt",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._chunkLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(A.is(s,Ss)){var a=A.as(s,Ss);if(!(t<a.startMeasureIndex||t>a.endMeasureIndex)){a.revalidateSystemMeasurePrefixesAt(t);var l=!0,u=!1,h=void 0;try{for(var c,d=a.staffLayouts[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){c.value.revalidateMeasurePrefixesAt(t)}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"validateMeasuresAt",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new bi(bi.DISPLAY,t,e,!0,i);this.dispatchEvent(n)}},{key:"geometryChangedAt",value:function(t,e){var i=new bi(bi.GEOMETRY_CHANGE,t,e,!0);this.dispatchEvent(i)}},{key:"spanChangedAt",value:function(t,e){var i=new bi(bi.SPAN_CHANGE,t,e,!0);this.dispatchEvent(i)}},{key:"isActualLayout",get:function(){return!0}},{key:"chunkLayoutsLength",get:function(){return this._chunkLayouts.length}},{key:"chunkLayouts",get:function(){return this._chunkLayouts}},{key:"score",get:function(){return this.context.score}},{key:"firstChunkLayout",get:function(){return this._chunkLayouts.length>0?this._chunkLayouts[0]:null}},{key:"lastChunkLayout",get:function(){return this._chunkLayouts.length>0?this._chunkLayouts[this._chunkLayouts.length-1]:null}},{key:"startMeasureIndex",get:function(){return this.getChunkLayoutAt(0).startMeasureIndex}},{key:"endMeasureIndex",get:function(){return this.getChunkLayoutAt(A.intToUint(this._chunkLayouts.length-1)).endMeasureIndex}}]),e}();r.registerClass(ks,"com.noteflight.notation.layout.PageLayout");var Ts=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this,t)))._staffLayouts=[],i._document=null,i._systemMeasureLayouts=[],i._overlay=!1,i._context.scoreLayout=u(u(i)),i}return c(e,Ro),p(e,[{key:"prepareLayout",value:function(){}},{key:"isFirstMeasureOfChunk",value:function(t){return!1}},{key:"getStaffLayoutAt",value:function(t){return this._staffLayouts[t]}},{key:"getSystemMeasureLayoutAt",value:function(t){return A.unknownToType(this._systemMeasureLayouts[t],Us)}},{key:"destroyChildren",value:function(){for(var t=0;t<this._staffLayouts.length;t++){this.getStaffLayoutAt(A.intToUint(t)).destroy()}}},{key:"buildStaffLayouts",value:function(){var t,e;if(this.removeListeners(),this._staffLayouts=[],null!=this.context.partToPrint){e=[];var i=!0,n=!1,r=void 0;try{for(var o,s=this.context.partToPrint.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)t=o.value,e.push(t)}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}else e=this.score.visibleStaves;for(var a=0;a<e.length;a++){t=A.unknownToType(e[a],Rl);var l=[],u=new Rs(this.context,null,this._staffLayouts.length),h=null,c=!0,d=!1,f=void 0;try{for(var y,g=t.measures[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=new Wo(this.context,p);m.topStaffOnSystem=0===a,m.bottomStaffOnSystem=a==e.length-1,l.push(m),null!=h&&(h.nextLayout=m),h=m}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}u.measureLayouts=l,this._staffLayouts.push(u)}}},{key:"addOrRemoveMeasures",value:function(t){if(t.sequenceChanges.length){var e=!0,i=!1,n=void 0;try{for(var r,o=t.sequenceChanges[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.type==Ai.ADD?(this.addMeasureToStaffLayoutsAt(A.unknownToInt(s.measureIndex),A.unknownToType(s.systemMeasure,hl)),this.addSystemMeasureLayoutAt(A.unknownToInt(s.measureIndex)),this.addVisibleMeasure(A.unknownToInt(s.measureIndex))):s.type==Ai.REMOVE&&(this.removeMeasureFromStaffLayoutsAt(A.unknownToInt(s.measureIndex)),this.removeSystemMeasureLayoutAt(A.unknownToInt(s.measureIndex)),this.removeVisibleMeasure(A.unknownToInt(s.measureIndex)))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}ws.clear()}}},{key:"addVisibleMeasure",value:function(t){}},{key:"removeVisibleMeasure",value:function(t){}},{key:"addMeasureToStaffLayoutsAt",value:function(t,e){for(var i=0;i<this._staffLayouts.length;i++){var n=this.getStaffLayoutAt(A.intToUint(i)),r=new Wo(this.context,n.staff.getMeasureAt(A.intToUint(e.index)));n.insertMeasureLayout(r,t)}}},{key:"removeMeasureFromStaffLayoutsAt",value:function(t){for(var e=0;e<this._staffLayouts.length;e++){this.getStaffLayoutAt(A.intToUint(e)).removeMeasureLayout(t)}}},{key:"addSystemMeasureLayoutAt",value:function(t){var e=this.createSystemMeasureLayout(A.intToUint(t));this._systemMeasureLayouts.splice(t,0,e)}},{key:"removeSystemMeasureLayoutAt",value:function(t){var e=A.unknownToType(this._systemMeasureLayouts[t],Us);e&&(e.destroy(),this._systemMeasureLayouts.splice(t,1))}},{key:"revalidateSystemMeasureLayouts",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToInt(s),l=this.getSystemMeasureLayoutAt(A.intToUint(a));l&&(l.invalidateMeasures(),l.validateLayout())}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"rebuildStaffLayouts",value:function(t){if(0!==t)for(var e=0;e<this._staffLayouts.length;e++){var i=this.getStaffLayoutAt(A.intToUint(e)),n=i.getMeasureLayoutAt(t-1);i.truncateMeasureLayouts(t);for(var r=t;r<this.score.numMeasures;r++){var o=new Wo(this.context,i.staff.getMeasureAt(A.intToUint(r)));o.topStaffOnSystem=0===e,o.bottomStaffOnSystem=e==this._staffLayouts.length-1,i.measureLayouts.push(o),null!=n&&(n.nextLayout=o),n=o}}else this.buildStaffLayouts()}},{key:"buildSystemMeasureLayouts",value:function(){for(var t=0;t<this.score.numMeasures;t++)this.layoutMeasureAt(t)}},{key:"rebuildSystemMeasureLayouts",value:function(t){this.rebuildStaffLayouts(t),this._systemMeasureLayouts.splice(t);for(var e=t;e<this.score.numMeasures;e++)this.layoutMeasureAt(A.intToUint(e))}},{key:"layoutMeasureAt",value:function(t){this._systemMeasureLayouts[t]=this.createSystemMeasureLayout(t)}},{key:"createSystemMeasureLayout",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this._staffLayouts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value.getMeasureLayoutAt(t);e.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var l=new Us(this.context,this.displayMode);return l.measureLayouts=e,l}},{key:"disposeSystemMeasureLayouts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._systemMeasureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;A.unknownToType(o,Us).measureLayouts=null}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._systemMeasureLayouts=[]}},{key:"createBlockLayout",value:function(t,e,i){var n=this.score.systemStaff.getMeasureAt(A.numberToUint(t)),r=new zo(this.context,n);return r.setBlock(e,i),r.validateLayout(),r}},{key:"createSystemLayout",value:function(t,e,i,n,r){var o;jd.pushTimer("ScoreLayout","createSystemLayout"),o=this._overlay?new Ls(this.context,r):new Ss(this.context,r);for(var s,a=[],l=0;l<this._staffLayouts.length;l++){s=this._staffLayouts[l];var u=new Rs(this.context,o,a.length);u.measureLayouts=s.measureLayouts.slice(t,e+1),a.push(u)}if(!n){var h=0,c=a.length-1;if(r!=Nl.STRIP_DISPLAY){for(;a[h].canHide&&h+1<a.length;)h++;for(;a[c].canHide&&c-1>=0;)c--}a[h].topStaff=!0,a[c].bottomStaff=!0;var d=[];for(l=0;l<a.length;l++){for(var f=(s=a[l]).staff,y=f.part,g=0;g<s.measureLayouts.length;g++){var p=s.getMeasureLayoutAt(g);p.firstLayoutOnSystem=0===g,p.lastLayoutOnSystem=g==s.measureLayouts.length-1,p.showBarNumber=this.score.effectiveStaffMetrics.showBarNumbersOnEachMeasure&&this.score.effectiveStaffMetrics.showBarNumbers,s.canHide&&r!=Nl.STRIP_DISPLAY||(p.topStaffOnSystem=l==h,p.bottomStaffOnSystem=l==c,p.topStaffInBarlineGroup=p.topStaffOnSystem||f.firstInPart&&d.length>0&&d[d.length-1].staff.part.barlineBreak||y.hasPedal&&f.lastInPart,p.bottomStaffInBarlineGroup=p.bottomStaffOnSystem||f.lastInPart&&y.barlineBreak||y.hasPedal&&f.penultimateInPart)}s.canHide&&r!=Nl.STRIP_DISPLAY||d.push(s)}d.length>0&&(a=d)}if(i)for(var m=t;m<=e;m++){var v=this.getSystemMeasureLayoutAt(A.intToUint(m));v&&(this.context.staffMetrics.autoMultiMeasureRestCreation&&1==v.measureLayouts.length&&v.measureLayouts[0].measure.isTacet&&v.invalidateMeasures(),v.validateLayout())}return o.setLayouts(a,this._systemMeasureLayouts.slice(t,e+1)),i?o.validateLayout():o.prepareLayout(),jd.popTimer("ScoreLayout","createSystemLayout"),o}},{key:"handleMeasureSequenceChange",value:function(t){}},{key:"handleMeasureValidate",value:function(t){}},{key:"handleMeasureGeometryChange",value:function(t){}},{key:"handleMeasureSpanChange",value:function(t){}},{key:"getHyphensBeginningStaff",value:function(t,e){return null}},{key:"getSystemLayoutStartingAt",value:function(t){return null}},{key:"displayMode",get:function(){return this.context.score.displayMode}},{key:"score",get:function(){return this._document.score}},{key:"document",get:function(){return this._document},set:function(t){this._document!=t&&(null!=this._document&&this.disposeSystemMeasureLayouts(),this._document=t,null!=this._document&&(this.buildStaffLayouts(),this.buildSystemMeasureLayouts()))}},{key:"totalPages",get:function(){return 1}},{key:"overlay",get:function(){return this._overlay}},{key:"endMeasureIndex",get:function(){return-1}},{key:"numMeasureLayouts",get:function(){return this._systemMeasureLayouts.length}},{key:"systemBreakWidth",get:function(){return this.context.pageMetrics.contentWidth/this.context.staffMetrics.lineSpacing}},{key:"allMeasureIndices",get:function(){for(var t=[],e=0;e<this.score.numMeasures;e++)t.push(e);return t}}]),e}();r.registerClass(Ts,"com.noteflight.notation.layout.ScoreLayout");var Es=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),(n=l(this,h(e).call(this,t)))._buildIncrementally=i,n._overlay=r,n._pageLayouts=[],n._chunks=[],n.isIncrementalLayoutComplete=!1,n._numMeasures=0,n._forceReflow=!1,n._numMeasures=t.score.numMeasures,n}return c(e,Ts),p(e,null,[{key:"WIDOW_BREAK_WIDTH_RATIO",get:function(){return.75}},{key:"WIDOW_PREVENTION_BARS",get:function(){return 10}},{key:"MAX_CHUNKS_TO_REFLOW",get:function(){return 10}},{key:"MAX_PAGES_TO_REFLOW",get:function(){return 2}}]),p(e,[{key:"destroyChildren",value:function(){s(h(e.prototype),"destroyChildren",this).call(this);for(var t=0;t<this._pageLayouts.length;t++)this._pageLayouts[t].destroy();for(t=0;t<this._chunks.length;t++)this._chunks[t].chunkLayout.destroy()}},{key:"invalidate",value:function(){s(h(e.prototype),"invalidate",this).call(this),this.isIncrementalLayoutComplete=!1}},{key:"createPageLayout",value:function(t,e){return new ks(t,A.intToUint(e))}},{key:"isFirstMeasureOfChunk",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._pageLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){if(r.value.isFirstMeasureOfChunk(t))return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"getNextPageLayout",value:function(t){return this._pageLayouts.length>t+1?this._pageLayouts[t+1]:null}},{key:"doValidateLayout",value:function(){if(!this._overlay)if(this.destroyChildren(),this._chunks=[],this._pageLayouts=[this.createPageLayout(this.context,0)],this._buildIncrementally)this.doIncrementalFlow();else for(;this.doIncrementalFlow(););}},{key:"doAsyncValidateLayout",value:function(t){if(!this._overlay){var e=this;this.destroyChildren(),this._chunks=[],this._pageLayouts=[this.createPageLayout(this.context,0)];!function i(){e.doIncrementalFlow()?X.flash_utils_setTimeout(function(){i()},10):t()}()}}},{key:"getHyphensBeginningStaff",value:function(t,e){for(var i=0;i<this._chunks.length;i++)if(A.is(this._chunks[i].chunkLayout,Ss)){var n=A.unknownToType(this._chunks[i].chunkLayout,Ss);if(this._chunks[i].endPosition.measureIndex==e-1&&n.staffLayouts[t])return n.staffLayouts[t].hyphenStateEndStaff}return null}},{key:"getSystemLayoutStartingAt",value:function(t){for(var e=0;e<this._chunks.length;e++)if(this._chunks[e].startPosition.measureIndex==t&&A.is(this._chunks[e].chunkLayout,Ss))return A.as(this._chunks[e].chunkLayout,Ss);return null}},{key:"getPageContainingMeasure",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._pageLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.startMeasureIndex<=t&&t<=s.endMeasureIndex)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"getXPosition",value:function(t,e){return 0===this._pageLayouts.length?0:this._pageLayouts[0].getXPosition(t,e)}},{key:"createDisplayObject",value:function(t){return new ec(t,this)}},{key:"handleMeasureSequenceChange",value:function(t){var e=t.firstMeasureIndex,i=new Ia(e),n=this.chunkIndexOfElementIdentifier(i);if(n>=0&&n<this._chunks.length){n=A.numberToInt(Math.max(0,n-1));var r=this._chunks[n];r.isSystem&&(r.invalid=!0,r.chunkLayout&&(r.chunkLayout.forceReflow=!0))}t.reflow?(this._forceReflow=!0,this.rebuildSystemMeasureLayouts(e)):this.addOrRemoveMeasures(t);for(var o=t.measureIndices.length>0?t.measureIndices[0]:0,s=0;s<this._chunks.length;s++){var a=this._chunks[s];if(a.chunkLayout.staffLayouts)for(var l=0;l<a.chunkLayout.staffLayouts.length;l++){var u=a.chunkLayout.staffLayouts[l];u.staffStartLayout&&u.staffStartLayout.measure.index>=o&&u.staffStartLayout.handleMeasureSequenceChange();for(var h=0;h<u.measureLayouts.length;h++){var c=u.measureLayouts[h];c.measure.index>=o&&c.handleMeasureSequenceChange()}}}this.handleMeasureValidate(t)}},{key:"runIncrementalFlow",value:function(){if(this._overlay)this.isIncrementalLayoutComplete=!0;else if(this.isIncrementalLayoutComplete=!1,this._buildIncrementally)this.dispatchEvent(new Mi(Mi.CONTINUE_INCREMENTAL_FLOW));else for(;this.doIncrementalFlow(););}},{key:"handleMeasureValidate",value:function(t){var i,n=this.context.score.numMeasures,r=n-this._numMeasures;this._numMeasures=n;var o=[],s={},a=0,l=this._forceReflow,u=!1,h=9999999999,c=0,d=-1,f=-1;!this.overlay&&t.measures&&t.measures.length>0&&(t.type==Ai.SEQUENCE_CHANGE?this.context.dispatchEvent(new Ai(Ai.SEQUENCE_CHANGE,t.measures,t.staves)):this.context.dispatchEvent(new Ai(Ai.INVALIDATE,t.measures,t.staves)));for(var y=0;y<t.measureIndices.length-1;y++)if(t.measureIndices[y]>t.measureIndices[y+1]){l=!0;break}var g,p,m=t.measureIndices,v=new Ia(A.unknownToInt(m[0])),_=this.chunkIndexOfElementIdentifier(v);if(-1!=_&&0!==r)for(this._chunks[_].endPosition.measureIndex+=A.numberToInt(r),y=_+1;y<this._chunks.length;y++)this._chunks[y].startPosition.measureIndex+=A.numberToInt(r),this._chunks[y].endPosition.measureIndex+=A.numberToInt(r);this.revalidateSystemMeasureLayouts(m);var S=!0,L=!1,k=void 0;try{for(var T,E=m[Symbol.iterator]();!(S=(T=E.next()).done);S=!0){g=T.value,p=A.unknownToInt(g);var M=!0,b=!1,w=void 0;try{for(var x,C=this._chunks[Symbol.iterator]();!(M=(x=C.next()).done);M=!0){var N=x.value;if(N.startPosition.measureIndex<=p&&N.endPosition.measureIndex>=p){N.pageLayout.revalidateMeasurePrefixesAt(p);break}}}catch(t){b=!0,w=t}finally{try{M||null==C.return||C.return()}finally{if(b)throw w}}}}catch(t){L=!0,k=t}finally{try{S||null==E.return||E.return()}finally{if(L)throw k}}var I=!0,P=!1,O=void 0;try{for(var Q,R=m[Symbol.iterator]();!(I=(Q=R.next()).done);I=!0)if(g=Q.value,p=A.unknownToInt(g),v=new Ia(p),!(s[_=this.chunkIndexOfElementIdentifier(v)]||_<0)){var D=_;c=Math.max(c,_);var F=1;_>0&&!s[_-1]&&(_--,F++);for(var U=!1;_<this._chunks.length&&(F>0||!U)&&!l;)if(i=this._chunks[_],F--,a>e.MAX_CHUNKS_TO_REFLOW||o.length>e.MAX_PAGES_TO_REFLOW)l=!0;else{var V=0;if(_>0){var B=this._chunks[_-1],H=this._chunks[_];V=A.is(H.chunkLayout,zo)&&H.chunkLayout.block.hasColumnPositionedAfterSystem?B.endPosition.measureIndex:A.is(B.chunkLayout,zo)&&B.chunkLayout.block.hasColumnPositionedBeforeSystem?B.endPosition.measureIndex:B.endPosition.measureIndex+1}if(V>=this._numMeasures)break;i.invalid=!0;var $=F>=0&&t.type==Ai.SEQUENCE_CHANGE;d=i.endPosition.afterBlockIndex,f=i.endPosition.beforeBlockIndex;var G=this.reflowChunk(A.intToUint(_),A.numberToInt(V),d,f,$),Y=i.chunkLayout;if(Y.invalidate(),(G=G||this.chunkRequiresReflow(i))?(h=Math.max(0,_),u=!0,-1==o.indexOf(i.pageLayout.index)&&o.push(i.pageLayout.index),a++):(this.justifyChunkLayout(Y),D==this._chunks.indexOf(i)&&A.is(Y,Ss)&&i.pageLayout.validateMeasuresAt(m,A.as(Y,Ss),t.staves)),_<0){_++;continue}s[_]=1,i.invalid=!1,Y.validateLayout(),U=!1,this._chunks[_+1]&&(U=this._chunks[_].endPosition.measureIndex+1==this._chunks[_+1].startPosition.measureIndex),l||_++}if(l){this.reflowChunksStartingAt(A.intToUint(_));break}U||this.runIncrementalFlow()}}catch(t){P=!0,O=t}finally{try{I||null==R.return||R.return()}finally{if(P)throw O}}if(u){if(0!==r)for(y=A.numberToInt(c+1);y<this._chunks.length;y++){if(i=this._chunks[y],A.is(i.chunkLayout,Ss))A.as(i.chunkLayout,Ss).dispatchEvent(new bi(bi.UPDATE_MEASURE_HANDLE_INDEX,null,null))}for(var z=0;z<o.length;z++){var W=o[z],X=A.unknownToNumber(W);this._pageLayouts[X].checkChunkLayoutsAreConsecutive()}for(this.dispatchEvent(new Hi(Hi.PAGE_REFLOW,o,m,t.staves)),y=0;y<this._chunks.length-1;y++)if(this._chunks[y].endPosition.measureIndex>=this._chunks[y+1].startPosition.measureIndex){this.reflowChunksStartingAt(A.intToUint(y+1));break}h<this._chunks.length&&this.reflowChunksStartingAt(A.numberToUint(h))}this._forceReflow=!1}},{key:"chunkRequiresReflow",value:function(t){var e=t.lastChunkLayout,i=t.pageLayout.pageBreakHeight-e.bottomY;if(i<0&&t.pageLayout.chunkLayoutsLength>1)return!0;var n=this.getNextPageLayout(t.pageLayout.index),r=n?n.firstChunkLayout:null,o=r&&r.height+this.context.staffMetrics.staffSpacing<i,s=A.is(e,Ss)&&!A.unknownToType(e,Ss).hasPageBreak;return o&&s}},{key:"handleMeasureGeometryChange",value:function(t){var e=t.measureIndices;null==e&&(e=this.allMeasureIndices);var i=!0,n=!1,r=void 0;try{for(var o,s=this._chunks[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=!0,u=!1,h=void 0;try{for(var c,d=e[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,y=A.unknownToInt(f);if(A.is(a.chunkLayout,Ss)&&y>=a.startPosition.measureIndex&&y<=a.endPosition.measureIndex){this.justifyChunkLayout(a.chunkLayout),a.pageLayout.geometryChangedAt(e,A.as(a.chunkLayout,Ss));break}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"handleMeasureSpanChange",value:function(t){var e=t.measureIndices;null==e&&(e=this.allMeasureIndices);var i=!0,n=!1,r=void 0;try{for(var o,s=this._chunks[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=!0,u=!1,h=void 0;try{for(var c,d=e[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,y=A.unknownToInt(f);if(A.is(a.chunkLayout,Ss)&&y>=a.startPosition.measureIndex&&y<=a.endPosition.measureIndex){a.pageLayout.spanChangedAt(e,A.as(a.chunkLayout,Ss));break}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"justifyChunkLayout",value:function(t){if(A.is(t,Ss)){var e=A.unknownToType(t,Ss);if(!t.valid){var i=!0,n=!1,r=void 0;try{for(var o,s=e.staffLayouts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.invalidate()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}e.validateLayout()}this.context.pageMetrics.justify?e.constraint.solveForLength(this.systemBreakWidth-(e.leftMargin+e.rightMargin),.5/this.context.staffMetrics.lineSpacing):e.constraint.generateLayoutVector(Zs.STANDARD_WEIGHTS);var a=!0,l=!1,u=void 0;try{for(var h,c=e.staffLayouts[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){h.value.invalidateGlobalAllLayouts()}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}},{key:"reflowChunk",value:function(t,e,i,n,r){if(this._overlay)return!1;var o=this._chunks[t],s=this.createPageChunk(new Ia(e,i,n),o.breakWidth);if(s.startPosition.measureIndex==o.startPosition.measureIndex&&s.endPosition.measureIndex==o.endPosition.measureIndex&&s.startPosition.afterBlockIndex==o.startPosition.afterBlockIndex&&s.endPosition.afterBlockIndex==o.endPosition.afterBlockIndex&&s.startPosition.beforeBlockIndex==o.startPosition.beforeBlockIndex&&s.endPosition.beforeBlockIndex==o.endPosition.beforeBlockIndex&&!r)return!1;s.pageChunkIndex=o.pageChunkIndex;var a=this._chunks.splice(t,1,s);A.unknownToType(a[0],Tl).chunkLayout.destroy(),this.createChunkLayout(s);var l=o.pageLayout.index,u=this._pageLayouts[l];return u.updateChunkLayout(s),u.validateLayout(),s.pageLayout=u,!0}},{key:"destroyPagesAt",value:function(t){for(var e=A.numberToInt(t);e<this._pageLayouts.length;e++)this._pageLayouts[e].destroy();this._pageLayouts=this._pageLayouts.slice(0,A.numberToInt(t))}},{key:"destroyChunkAndFollowingPages",value:function(t){this.destroyPagesAt(t.pageLayout.index+1),t.pageLayout.truncateChunkLayouts(t.pageChunkIndex)}},{key:"reflowChunksStartingAt",value:function(t){if(!(t>=this._chunks.length||this.overlay)){for(var e=t;e<this._chunks.length;e++)this._chunks[e].chunkLayout.destroy();var i=this._chunks[t];this._chunks=this._chunks.slice(0,t),0===i.pageChunkIndex?this.destroyPagesAt(i.pageLayout.index):this.destroyChunkAndFollowingPages(i),this.appendPageChunksStartingAt(t),this.runIncrementalFlow()}}},{key:"findNextChunk",value:function(t){var e=this.context.score.systemStaff.getMeasureAt(A.intToUint(t.measureIndex)),i=this.context.score.systemStaff.getMeasureAt(A.intToUint(t.measureIndex+1));if(!e)return null;if(-1==t.afterBlockIndex&&-1==t.beforeBlockIndex){if(e.hasBlockPositionedAfterSystem)return new Ia(t.measureIndex,0,-1,wa.AFTER_SYSTEM);if(i&&i.hasBlockPositionedBeforeSystem)return new Ia(t.measureIndex+1,-1,0,wa.BEFORE_SYSTEM)}if(t.beforeBlockIndex>-1)return e.hasBlockPositionedBeforeSystem&&t.beforeBlockIndex+1<e.blocksPositionedBeforeSystem.length?new Ia(t.measureIndex,-1,t.beforeBlockIndex+1,wa.BEFORE_SYSTEM):new Ia(t.measureIndex,-1,-1);if(t.afterBlockIndex>-1){if(e.hasBlockPositionedAfterSystem&&t.afterBlockIndex+1<e.blocksPositionedAfterSystem.length)return new Ia(t.measureIndex,t.afterBlockIndex+1,-1,wa.AFTER_SYSTEM);if(i&&i.hasBlockPositionedBeforeSystem)return new Ia(t.measureIndex+1,-1,0,wa.BEFORE_SYSTEM)}return t.measureIndex+1<this.context.score.numMeasures?new Ia(t.measureIndex+1):null}},{key:"doIncrementalFlow",value:function(){if(this._overlay)return!1;jd.pushTimer("PaginatedLayout","globalIncrementalFlow",!0),jd.pushTimer("PaginatedLayout","doIncrementalFlow"),jd.pushTimer("FirstPage","firstPage",!1,!0),jd.pushTimer("PaginatedLayout","scoreLayoutComplete",!1,!0);var t=!1,e=!1;if(!this.isIncrementalLayoutComplete){this.dispatchEvent(new Mi(Mi.INCREMENTAL_LAYOUT_STEP_INITIATED));for(var i,n=this._chunks.length,r=0===n?new Ia(0):this.findNextChunk(this._chunks[n-1].endPosition);!i;)r&&this.flowNextChunk(r)?(i=this.appendPageChunksStartingAt(A.intToUint(n)),n=this._chunks.length-1,r=this.findNextChunk(this._chunks[n].endPosition),n++,e=!0,t=!0):i=!0;if(!t||!r)if(this.isIncrementalLayoutComplete=!0,jd.popTimer("PaginatedLayout","globalIncrementalFlow",!0),jd.popTimer("PaginatedLayout","scoreLayoutComplete",!1,!0),e)this.dispatchPageDisplayEvent(this.pageLayouts.length-1);else{var o=this._chunks[this._chunks.length-1].pageChunkIndex;this.dispatchEvent(new Bi(Bi.CHECK_OLD_REMAINING_CHUNKS,this.pageLayouts.length-1,o))}this.dispatchEvent(new Mi(Mi.INCREMENTAL_LAYOUT_STEP_COMPLETE))}return jd.popTimer("PaginatedLayout","doIncrementalFlow"),t}},{key:"flowNextChunk",value:function(t){if(this._overlay)return!1;if(t.measureIndex<this.numMeasureLayouts){var e=this.createPageChunk(t,this.systemBreakWidth);return this._chunks.push(e),!0}return!1}},{key:"dispatchPageDisplayEvent",value:function(t){var e=new Bi(Bi.PAGE_DISPLAY,t);this.dispatchEvent(e)}},{key:"appendPageChunksStartingAt",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!1;t<this._chunks.length;){var i=this.appendPageChunk(this._chunks[t]);e=e||i,t++}return e}},{key:"shouldRespectSystemBreaks",value:function(){return!this.context.score.isFlowMode}},{key:"calculateSystemLayoutWidth",value:function(t,e){var i=this.createSystemLayout(t,e,!0,!0,Nl.PAGINATED_DISPLAY),n=i.totalWidth;return i.destroy(),n}},{key:"createPageSystem",value:function(t,e){jd.pushTimer("PaginatedLayout","createPageSystem");for(var i=A.intToUint(t.measureIndex),n=A.intToUint(this.numMeasureLayouts-1),r=i,o=null,s=this.shouldRespectSystemBreaks(),a=!1,l=!1,u=!1,h=this.calculateSystemLayoutWidth(i,i),c=-1,d=i;d<=n;d++){o=this.getSystemMeasureLayoutAt(A.intToUint(d));var f=null;if(d+1<n&&(f=this.getSystemMeasureLayoutAt(A.intToUint(d+1))),o.validateLayout(),o.systemMeasure.hasBlockPositionedAfterSystem){r=A.intToUint(d),l=!0;break}if(f&&f.systemMeasure.hasBlockPositionedBeforeSystem){r=A.intToUint(d),u=!0;break}if(s&&o.breakType==hl.KEEP_WITH_NEXT_TYPE&&-1==c&&(c=d),d>i&&(h+=o.flowWidth),o.flowWidth>0&&h>e){if(!(c>-1)){r=A.intToUint(d==i?d:d-1);break}if(c!=i){r=A.numberToUint(c-1);break}}if(o.breakType!=hl.KEEP_WITH_NEXT_TYPE&&(c=-1),s&&(o.breakType==hl.SYSTEM_BREAK_TYPE||o.breakType==hl.PAGE_BREAK_TYPE)){r=A.intToUint(d),a=!0;break}if(d==n){r=A.intToUint(d);break}}var y=this.createSystemLayout(i,r,!0,!0,Nl.PAGINATED_DISPLAY);if(a||l||u){var g=e-(y.leftMargin+y.rightMargin);y.destroy();var p=Tl.createPageChunkWithMeasureIndices(i,r,g);return jd.popTimer("PaginatedLayout","createPageSystem"),p}var m=y.flowWidth;y.destroy();var v=this.createSystemLayout(i,i,!0,!0,Nl.PAGINATED_DISPLAY),_=0,S=v.flowWidth-this.getSystemMeasureLayoutAt(i).flowWidth;v.destroy();for(var L=A.intToUint(r+1);S<e&&L<this.numMeasureLayouts;){if(S+=(o=this.getSystemMeasureLayoutAt(L)).flowWidth,s&&(o.breakType==hl.SYSTEM_BREAK_TYPE||o.breakType==hl.PAGE_BREAK_TYPE)||L==this.context.score.numMeasures-1){for(;;){var k=this.getSystemMeasureLayoutAt(r).flowWidth;if(0===k)_++;else if(r>0&&s){if(this.getSystemMeasureLayoutAt(A.intToUint(r-1)).breakType==hl.KEEP_WITH_NEXT_TYPE)break}if(m-S<=k||S+k>=e||r<=i){_>0&&(r+=A.numberToUint(_));break}S+=k,m-=k,r--,0!==k&&(_=0)}break}L++}var T=Tl.createPageChunkWithMeasureIndices(i,r,e);return jd.popTimer("PaginatedLayout","createPageSystem"),T}},{key:"createPageBlock",value:function(t){this.context.score.systemStaff.getMeasureAt(A.intToUint(t.measureIndex));var e=new Ia(t.measureIndex,t.afterBlockIndex,t.beforeBlockIndex),i=new Tl(t,e,0);return i.isSystem=!1,i}},{key:"createPageChunk",value:function(t,e){var i=this.getSystemMeasureLayoutAt(t.measureIndex).systemMeasure;return-1==t.afterBlockIndex&&-1==t.beforeBlockIndex||t.afterBlockIndex>=i.blocksPositionedAfterSystem.length||t.beforeBlockIndex>=i.blocksPositionedBeforeSystem.length?this.createPageSystem(t,e):this.createPageBlock(t)}},{key:"chunkIndexOfElementIdentifier",value:function(t){for(var e=null,i=0;i<this._chunks.length;i++){if(e=this._chunks[i],t.measureIndex<=e.endPosition.measureIndex&&t.beforeBlockIndex==e.endPosition.beforeBlockIndex&&t.afterBlockIndex==e.endPosition.afterBlockIndex)return i;if(t.measureIndex<=e.endPosition.measureIndex&&-1==t.beforeBlockIndex&&-1==t.afterBlockIndex&&-1==e.endPosition.beforeBlockIndex&&-1==e.endPosition.afterBlockIndex)return i;if(e.endPosition.measureIndex<e.startPosition.measureIndex)return i}return null!=e&&t.measureIndex>e.endPosition.measureIndex?this._chunks.length-1:-1}},{key:"createChunkLayout",value:function(t){t.isSystem?(t.chunkLayout=this.createSystemLayout(A.intToUint(t.startPosition.measureIndex),A.intToUint(t.endPosition.measureIndex),!0,!1,Nl.PAGINATED_DISPLAY),this.justifyChunkLayout(t.chunkLayout)):t.startPosition.activeBlockType==wa.AFTER_SYSTEM?t.chunkLayout=this.createBlockLayout(t.startPosition.measureIndex,t.startPosition.afterBlockIndex,t.startPosition.activeBlockType):t.chunkLayout=this.createBlockLayout(t.startPosition.measureIndex,t.startPosition.beforeBlockIndex,t.startPosition.activeBlockType)}},{key:"updatePageChunk",value:function(t,e,i){this.createChunkLayout(t);var n=this._pageLayouts[i];return t.pageLayout=n,t.pageChunkIndex=A.numberToUint(e),!1}},{key:"appendPageChunk",value:function(t){var e,i=!1;for(this.createChunkLayout(t),0===this._pageLayouts.length?(e=this.createPageLayout(this.context,this._pageLayouts.length),this._pageLayouts.push(e)):e=this._pageLayouts[this._pageLayouts.length-1];!e.addChunkLayout(t.chunkLayout);){if(i=!0,this.context.preview){this.isIncrementalLayoutComplete=!0;break}e=this.createPageLayout(this.context,this._pageLayouts.length),this._pageLayouts.push(e)}return t.pageLayout=e,t.pageChunkIndex=A.intToUint(e.chunkLayoutsLength-1),i&&this.dispatchPageDisplayEvent(Math.max(0,t.pageLayout.index-1)),i}},{key:"displayMode",get:function(){return Nl.PAGINATED_DISPLAY}},{key:"pageLayouts",get:function(){return this._pageLayouts}},{key:"chunks",get:function(){return this._chunks}},{key:"document",set:function(t){o(h(e.prototype),"document",t,this,!0),null==t&&(this.isIncrementalLayoutComplete=!0)},get:function(){return s(h(e.prototype),"document",this)}},{key:"totalPages",get:function(){return this._pageLayouts.length}},{key:"endMeasureIndex",get:function(){return this.pageLayouts[this.pageLayouts.length-1].endMeasureIndex}}]),e}();r.registerClass(Es,"com.noteflight.notation.layout.PaginatedLayout");var Ms=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r,t.staffMetrics.performanceTextPadding))}return c(e,Ko),p(e,[{key:"doValidateLayout",value:function(){this.notation.measure.isSystemMeasure&&!this.measureLayout.topStaffOnSystem||(this.addEscapedTextGlyphs(this.textNotation.text),this.createBoxOutsideText()),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"createTextFormat",value:function(){return new Ly(this.context.staffMetrics.staffTextFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.performanceTextSize)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new nc(t,this)}}]),e}();r.registerClass(Ms,"com.noteflight.notation.layout.PerformanceTextLayout");var bs=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i))).index=i,n}return c(e,ks),p(e,[{key:"createDisplayObject",value:function(t){var e=new Zh(t,this);return e.state=Zh.PLACEHOLDER,A.as(e,Rr)}},{key:"isActualLayout",get:function(){return!1}}]),e}();r.registerClass(bs,"com.noteflight.notation.layout.PlaceholderPageLayout");var ws=function(){function t(){y(this,t)}return p(t,null,[{key:"_prefixesLayoutCache",get:function(){return xs},set:function(t){xs=t}}]),p(t,null,[{key:"cache",value:function(e,i,n){t._prefixesLayoutCache[e]||(t._prefixesLayoutCache[e]={}),t._prefixesLayoutCache[e][i]=n}},{key:"retrieve",value:function(e,i){return t._prefixesLayoutCache[e]||(t._prefixesLayoutCache[e]={}),t._prefixesLayoutCache[e][i]?t._prefixesLayoutCache[e][i]:null}},{key:"invalidate",value:function(e,i){t._prefixesLayoutCache[e]&&t._prefixesLayoutCache[e][i]&&delete t._prefixesLayoutCache[e][i]}},{key:"clear",value:function(){t._prefixesLayoutCache={}}}]),t}(),xs={};r.registerClass(ws,"com.noteflight.notation.layout.PrefixesCache");var Cs=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r)))._restPosition=0,o._voiceDelta=0,o._noteGlyphLayout=null,o._dotGlyphLayout=null,o}return c(e,Vo),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"createDisplayObject",value:function(t){this.doValidateGlobalLayout();var e=new lh(t,this);return this.clef.showRhythm(this.context.score)||(e.hidden=!0),e}},{key:"initializeLayout",value:function(){if(this.padding=this.context.staffMetrics.notePadding,this._restPosition=this.clef.getRestLine(this.noteSet.value)*this.clef.lineSpacing+this.noteSet.dy,this._voiceDelta=0,!this.noteSet.explicitRestY&&this.multiVoice&&this.clef.numLines>1&&(null==this.alternateVoiceLayout||!this.alternateVoiceLayout.noteSet.invisible)){var t=0===this.noteSet.voiceNumber?this.context.staffMetrics.upperVoiceRestOffset:this.context.staffMetrics.lowerVoiceRestOffset;this._voiceDelta+=t}this._restPosition+=this._voiceDelta;var i=e.restType(this.noteSet.value,this._restPosition,this.clef);this._noteGlyphLayout=new Zo(this.context,this.foundry.getRest(this.noteSet.value,i)),this._noteGlyphLayout.distanceY=this._restPosition,this.addGlyphLayout(this._noteGlyphLayout);for(var n=0;n<this.noteSet.dots;n++)this._dotGlyphLayout=new Zo(this.context,this.foundry.getRhythmDot()),this._dotGlyphLayout.distanceX=this.context.staffMetrics.dotSpacing+this.context.staffMetrics.multipleDotGap*n+this._noteGlyphLayout.width,this.addGlyphLayout(this._dotGlyphLayout),this.positionDotGlyph()}},{key:"positionDotGlyph",value:function(){null!=this._dotGlyphLayout&&(this._dotGlyphLayout.distanceY=Math.floor(this._noteGlyphLayout.distanceY)+.5,this.noteSet.value==mn.WHOLE&&(this._dotGlyphLayout.distanceY-=1))}},{key:"doValidateGlobalLayout",value:function(){this._clearTop=this.clef.staffHeight+this._voiceDelta+this.noteSet.dy+this.context.staffMetrics.articulationPadding,this._clearBottom=this._voiceDelta,this._extrasBottom=this._extrasTop=NaN;var t=!0,e=!1,i=void 0;try{for(var n,r=this.noteSet.articulations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToString(o);0!=(A.intToUint(Sn.ARTICULATION_ATTRIBUTES[s])&Sn.ALLOWED_ON_REST)&&this.applyArticulation(s)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"applyArticulation",value:function(t){this._multiVoice?this._down?this.addArticulation(t,!1):this.addArticulation(t,!0):this._down?this.addArticulation(t,!0):Sn.ARTICULATION_ATTRIBUTES[t]&Sn.ALWAYS_ABOVE_STAFF?this.addArticulation(t,!0):this.addArticulation(t,!1)}},{key:"addArticulation",value:function(t,e){var i=A.intToUint(Sn.ARTICULATION_ATTRIBUTES[t]);if(0!=(i&Sn.ALLOWED_ON_REST)){var n=this.foundry.getArticulation(t,e,!1),r=new Zo(this.context,n);r.verticalAnchor=Zo.ANCHOR_BOTTOM,r.distanceX=this._noteGlyphLayout.width/2,0!=(i&Sn.PLACE_TO_RIGHT)&&(r.distanceX+=this.context.staffMetrics.rightArticulationPadding),r.distanceY=e?this._clearTop+r.height:this._clearBottom,this.addGlyphLayout(r),this._clearTop+=r.height+this.context.staffMetrics.articulationSpacing}}},{key:"direction",get:function(){return this.notation.direction}},{key:"stemmingLine",get:function(){return this.stemStartLine}},{key:"stemStartLine",get:function(){return this.clef.getRestLine(this.noteSet.value)}},{key:"nearestStemLine",get:function(){return this.stemStartLine}},{key:"stemEnd",get:function(){var t=this._noteGlyphLayout.width/2,e=this.down?this.stemStartLine-this.stemLength:this.stemStartLine+this.stemLength;return new If(t,e)}},{key:"beamY",set:function(t){if(!this.noteSet.explicitRestY){var e=t+this._noteGlyphLayout.origin.y-(this.down?this._noteGlyphLayout.bounds.top-.5:this._noteGlyphLayout.bounds.bottom+.5);(this.down?e>this._restPosition:e<this._restPosition)&&(this._noteGlyphLayout.distanceY=e,this.positionDotGlyph())}}},{key:"notationWidth",get:function(){return this._noteGlyphLayout.width}},{key:"standardStemLength",get:function(){return 0}},{key:"hasStem",get:function(){return!1}}],[{key:"restType",value:function(t,e,i){return e/=i.lineSpacing,t>=mn.HALF&&(0===i.displayLineCount||Math.abs(e-Math.round(e))>.01||e<0||e>i.numLines-1)?"line":null}}]),e}();r.implementsInterfaces(Cs,[rs]),r.registerClass(Cs,"com.noteflight.notation.layout.RestLayout");var Ns=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,$o),p(e,[{key:"doCreateView",value:function(t,e,i,n,r){this.calculateAscent();var o=0;return t.isTab&&(o=t.clef.lineSpacing*this.staffMetrics.slideStrokeBias*(this._pitchDelta>0?1.5:-1.5)),new Th(i*this.staffMetrics.lineSpacing,-(n-o+this._dy)*this.staffMetrics.lineSpacing,r*this.staffMetrics.lineSpacing,-(this._ascent+2*o)*this.staffMetrics.lineSpacing,this.staffMetrics.slideThickness*this.staffMetrics.lineSpacing,this.staffMetrics)}},{key:"horizontalPadding",get:function(){return this.staffMetrics.slideHorizontalPadding}},{key:"lineDither",get:function(){return this._leftNsl&&this._leftNsl.isTab?0:s(h(e.prototype),"lineDither",this)}},{key:"singleNote",get:function(){return!1}},{key:"adjustForLiasonCrossingStem",get:function(){return!1}}]),e}();r.registerClass(Ns,"com.noteflight.notation.layout.SlideLayout");var As=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).affectsWidth=!0,o.affectsHeight=!0,o.spacingX=0,o.spacingY=0,o._ascent=n.ascent,o._shift=n.shift,o._length=n.length,o}return c(e,Uo),p(e,[{key:"createDisplayObject",value:function(t){throw new Error("Not implemented")}},{key:"bottomLeft",get:function(){var t=Math.min(this.spacingX+this._shift,this.spacingX),e=Math.max(this.spacingY+this._ascent,this.spacingY);return new If(t,e)}},{key:"width",get:function(){return Math.abs(this._shift)}},{key:"ascent",get:function(){return this._ascent}},{key:"shift",get:function(){return this._shift}},{key:"horizontalSpacing",get:function(){throw new Error("Not implemented")}},{key:"verticalSpacing",get:function(){return this.staffMetrics.effectVerticalSpacing}},{key:"offLinePadding",get:function(){throw new Error("Not implemented")}},{key:"bounds",get:function(){var t=this.bottomLeft;return new Qo(t.x,t.y,this._length,this._ascent)}},{key:"staffMetrics",get:function(){return this._context.staffMetrics}}]),e}();r.registerClass(As,"com.noteflight.notation.layout.EffectLayout");var Is=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r))}return c(e,As),p(e,[{key:"createDisplayObject",value:function(t){return new Yh(t,this,this.spacingX,this.spacingY)}},{key:"horizontalSpacing",get:function(){return this.staffMetrics.fallHorizontalSpacing}},{key:"verticalSpacing",get:function(){return this.staffMetrics.postEffectVerticalSpacing}},{key:"offLinePadding",get:function(){return this.notation.wavyType?0:this.staffMetrics.postEffectVerticalPaddingOffLine}}]),e}();r.registerClass(Is,"com.noteflight.notation.layout.FallLayout");var Ps=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r))}return c(e,As),p(e,[{key:"createDisplayObject",value:function(t){return new Gh(t,this,this.spacingX,this.spacingY)}},{key:"horizontalSpacing",get:function(){return this.staffMetrics.ripHorizontalSpacing}},{key:"verticalSpacing",get:function(){return this.staffMetrics.preEffectVerticalSpacing}},{key:"offLinePadding",get:function(){return this.staffMetrics.preEffectVerticalPaddingOffLine}}]),e}();r.registerClass(Ps,"com.noteflight.notation.layout.RipLayout");var Os=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,ts),p(e,[{key:"startPoint",value:function(t){var i=s(h(e.prototype),"startPoint",this).call(this,t);if(this.startBreak){var n=pc.slurHeight(s(h(e.prototype),"endPoint",this).call(this,t).x-i.x,this.staffMetrics);i.x-=this.staffMetrics.noteLiaisonPadding*this.staffMetrics.lineSpacing,i.y+=(n/2+.25*this.staffMetrics.lineSpacing)*(this.slur.direction==he.DIRECTION_DOWN?1:-1)}return i}},{key:"endPoint",value:function(t){var i=s(h(e.prototype),"endPoint",this).call(this,t);if(this.endBreak){var n=pc.slurHeight(i.x-s(h(e.prototype),"startPoint",this).call(this,t).x,this.staffMetrics);i.x+=this.staffMetrics.noteLiaisonPadding*this.staffMetrics.lineSpacing,i.y+=(n/2+.25*this.staffMetrics.lineSpacing)*(this.slur.direction==he.DIRECTION_DOWN?1:-1)}return i}},{key:"createSystemSpanView",value:function(t,e,i){return new pc(t,this,e,i)}},{key:"slur",get:function(){return A.unknownToType(this.notation,Ol)}}]),e}();r.registerClass(Os,"com.noteflight.notation.layout.SlurSpan");var Qs=function(){function t(e,i){y(this,t),this.voiceNumber=0,this.startNoteWidth=NaN,this.endNoteWidth=NaN,this.notesUp=!1,this.notesDown=!1,this.multiVoice=!1,this.multiVoiceDown=!1,this.grace=!1,this.notePlacements=null,this.startEndSpan=NaN,this._forceInitialX=!1,this._forceInitialXPosition=NaN,this._lastExpText=null,this._context=null,this._multiVoiceDownSet=!1,this._sn=null,this._context=e,this._sn=i,this.voiceNumber=this._sn.voiceNumber,this.calculateDefaults(this._sn.measurePosition,this._sn.endPosition,this._sn.measure.staff)}return p(t,[{key:"calculateDefaults",value:function(t,e,i){var n,r=null,o=0;this.notePlacements=[];for(var s=!1,a=t.measureIndex;a<=e.measureIndex;a++){var l=i.getMeasureAt(A.intToUint(a)),u=new Wo(this._context,l),h=new Us(this._context,Nl.STRIP_DISPLAY);h.measureLayouts=[u],h.validateLayout(),u.validateGlobalLayout();var c=!0,d=!1,f=void 0;try{for(var y,g=u.notationLayouts[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=p.notation.voiceNumber,v=this.voiceNumber==Kl.UNKNOWN_VOICE_NUMBER||m==this.voiceNumber;if(A.is(p,Jo)){var _=A.unknownToType(p,Jo);a==e.measureIndex&&p.notation.rhythmPosition<=e.position+1&&(this._lastExpText=_),a==t.measureIndex&&A.is(this._sn,Va)&&p.notation.rhythmPosition==t.position&&(this._forceInitialX=!0,this._forceInitialXPosition=_.dx+_.glyphWidths+this.staffMetrics.hairpinStartExpressionPadding)}if(!(m<0||(s||null==this._sn.defaultDirection)&&!v)){var S=p.notation.position;if(!(a==t.measureIndex&&S<t.position)){if(a==e.measureIndex&&S>e.position)break;if(A.is(p,_s)){if(r=A.unknownToType(p,_s),this.multiVoice=this.multiVoice||r.multiVoice,null==n&&v){if(r.noteSet.grace&&!this._sn.includeGrace)continue;n=r,(s=A.is(this._sn,Ol)&&n.noteSet.grace)&&(this.notePlacements=[])}var L=new vs;if(L.measureIndex=a,L.position=S,L.duration=r.noteSet.duration,L.grace=r.noteSet.grace,L.top=r.spanTop,L.bottom=r.spanBottom,L.x=o+r.x,L.hasStem=r.hasStem,L.noteWidth=r.noteWidth,null!=this._sn.defaultDirection&&this.notePlacements.length>0){var k=A.unknownToType(this.notePlacements[this.notePlacements.length-1],vs);k.measureIndex!=a||k.position!=S||k.grace?this.notePlacements.push(L):(k.top=Math.max(L.top,k.top),k.bottom=Math.min(L.bottom,k.bottom),v&&!L.grace&&(k.x=L.x,k.hasStem=L.hasStem,k.noteWidth=L.noteWidth,k.duration=L.duration),L=k)}else this.notePlacements.push(L);if(r.tupletLayout&&!A.is(l.effectiveClef,$l)){var T=r.tupletLayout,E=this._context.staffMetrics.tupletHeight,M=function(t){T.down?L.bottom=Math.min(L.bottom,t-E):L.top=Math.max(L.top,t+E)};0===r.noteSet.rhythmPosition?T.tuplet.showBracket&&M(T.startY):r.noteSet.rhythmPosition==T.tuplet.duration?T.tuplet.showBracket&&M(T.startY+T.rise):(T.tuplet.showActualNumber||T.tuplet.showNormalNumber)&&M(T.startY+T.rise*(r.x-T.startX)/(T.endX-T.startX))}!r.noteSet.grace&&v&&(r.down?this.notesDown=!0:this.notesUp=!0,this.multiVoice&&r.multiVoice&&r.hasStem&&!this._multiVoiceDownSet&&(this.multiVoiceDown=r.down,this._multiVoiceDownSet=!0))}}}}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}o+=h.x}if(this.multiVoice&&!this._multiVoiceDownSet&&(this.multiVoiceDown=1==this.voiceNumber),this.notePlacements.length>0){var b=A.unknownToType(this.notePlacements[0],vs),w=A.unknownToType(this.notePlacements[this.notePlacements.length-1],vs),x=b.x,C=!0,N=!1,I=void 0;try{for(var P,O=this.notePlacements[Symbol.iterator]();!(C=(P=O.next()).done);C=!0){var Q=P.value;A.unknownToType(Q,vs).x-=x}}catch(t){N=!0,I=t}finally{try{C||null==O.return||O.return()}finally{if(N)throw I}}if(A.is(this._sn,Va))this.startNoteWidth=this._forceInitialX?this._forceInitialXPosition:0,!this._lastExpText||this._lastExpText.notation.rhythmPosition!=w.position&&this._lastExpText.notation.rhythmPosition!=w.position+w.duration?this.endNoteWidth=-.5*this.staffMetrics.hairpinEndExpressionPadding:this.endNoteWidth=this._lastExpText.dx-this.staffMetrics.hairpinEndExpressionPadding;else{var R=new gl(A.intToUint(b.measureIndex),b.position),D=new gl(A.intToUint(w.measureIndex),w.position);this.startNoteWidth=b.noteWidth,this.endNoteWidth=w.noteWidth,this.grace=b.grace,this.startEndSpan=Math.max(b.duration,i.score.rangeDuration(R,D))}}}},{key:"staffMetrics",get:function(){return this._context.staffMetrics}},{key:"empty",get:function(){return 0===this.notePlacements.length}}]),t}();r.registerClass(Qs,"com.noteflight.notation.layout.SpanInfo");var Rs=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t)))._index=NaN,r.distanceY=NaN,r.topStaff=!1,r.bottomStaff=!1,r._measureLayouts=[],r._staffStartLayout=null,r._cautionaryLayout=null,r._staff=null,r._auxiliaryMeasuresPrepared=!1,r._topPadding=NaN,r._bottomPadding=NaN,r._maxLyricAboveBaseY=NaN,r._minLyricBelowBaseY=NaN,r._maxLyricExtraLinesAboveStaff=NaN,r._measurePrefixesLayouts={},r._hyphenLayouts=[],r._hyphenStateBeginningStaff={},r._hyphenStateEndStaff={},r._parent=i,r._index=n,r}return c(e,Ro),p(e,[{key:"updateMeasureLayout",value:function(t){this._measureLayouts[t.measure.index]&&this._measureLayouts[t.measure.index].destroy(),this._measureLayouts[t.measure.index]=t}},{key:"insertMeasureLayout",value:function(t,e){var i=this.getMeasureLayoutAt(e-1),n=this.getMeasureLayoutAt(e+1);i&&(i.nextLayout=t),n&&(t.nextLayout=n),this.measureLayouts.splice(e,0,t)}},{key:"removeMeasureLayout",value:function(t){var e=this.getMeasureLayoutAt(t-1),i=this.getMeasureLayoutAt(t),n=this.getMeasureLayoutAt(t+1);e&&n&&(e.nextLayout=n),i&&(i.destroy(),this.measureLayouts.splice(t,1))}},{key:"getPrefixLayout",value:function(t){var e=ws.retrieve(this.staff.index,t.index);if(e&&(this._staffStartLayout=A.as(e.prefixes[0],Ds),this.staffStartLayout.measure.index>-1))return e;var i=this.staff.score.visibleStavesAtMeasure(t.index),n=0!==t.index&&this.staff.score.effectiveStaffMetrics.showBarNumbers&&(this.context.scoreLayout.overlay&&i.length>0&&i[0]==this.staff||i.length>0&&i[0]==this.staff||this.context.partToPrint&&this.context.partToPrint==this.staff.part&&this.context.partToPrint.staves[0]==this.staff);this._staffStartLayout=new Ds(this.context,t,n);var r=new gs(t.index);return r.addPrefix(this._staffStartLayout),ws.cache(this.staff.index,t.index,r),r}},{key:"updateMeasurePrefixes",value:function(){this._measurePrefixesLayouts={};for(var t=0;t<this._measureLayouts.length;t++){var e=this._measureLayouts[t].measure;if(0===t)this._measurePrefixesLayouts[t]=this.getPrefixLayout(e);else if(e.previousMeasure&&e.previousMeasure.systemMeasure.systemGap){var i=new ys(this.context,e),n=new Ds(this.context,e,!1),r=new gs(e.index);r.addArrayOfPrefixes([i,n]),this._measurePrefixesLayouts[t]=r}}}},{key:"revalidateMeasurePrefixesAt",value:function(t){var e=t-this.startMeasureIndex;this._measurePrefixesLayouts[e]&&(this._measurePrefixesLayouts[e].invalidateLayouts(),this._measurePrefixesLayouts[e].validateLayouts(),ws.invalidate(this.staff.index,t))}},{key:"truncateMeasureLayouts",value:function(t){for(var e=t;e<this._measureLayouts.length;e++)this._measureLayouts[e].destroy();this._measureLayouts.splice(t)}},{key:"invalidateGlobalAllLayouts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.invalidateGlobal()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}var o=!0,s=!1,a=void 0;try{for(var l,u=xt.objectForOfSource(this._measurePrefixesLayouts)[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){l.value.invalidateGlobal()}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"getMeasurePrefixesLayoutAt",value:function(t){return this._measurePrefixesLayouts[t]}},{key:"getMeasurePrefixesLayoutByMeasureIndex",value:function(t){return this.getMeasurePrefixesLayoutAt(t-this.startMeasureIndex)}},{key:"getMeasurePrefixByIndexAt",value:function(t,e){var i=this.getMeasurePrefixesLayoutByMeasureIndex(t).prefixes;return e<i.length?A.as(i[e],Wo):null}},{key:"getMeasureLayoutAt",value:function(t){return this._measureLayouts[t]}},{key:"getMeasureLayoutByIndex",value:function(t){return this.getMeasureLayoutAt(t-this.startMeasureIndex)}},{key:"getSpansInRange",value:function(t,e){var i=[],n=this.staff.getSpanNotationsInRange(t,e),r=!0,o=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,Ua);i.push(this.createSpan(h))}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}if(this.topStaff){n=this.staff.score.systemStaff.getSpanNotationsInRange(t,e);var c=!0,d=!1,f=void 0;try{for(var y,g=n[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=A.unknownToType(p,Ua);i.push(this.createSpan(m))}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}}var v=!0,_=!1,S=void 0;try{for(var L,k=this._measureLayouts[Symbol.iterator]();!(v=(L=k.next()).done);v=!0){var T=L.value,E=!0,M=!1,b=void 0;try{for(var w,x=T.temporarySpans[Symbol.iterator]();!(E=(w=x.next()).done);E=!0){var C=w.value,N=A.unknownToType(C,Ua);i.push(this.createSpan(N))}}catch(t){M=!0,b=t}finally{try{E||null==x.return||x.return()}finally{if(M)throw b}}}}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}return i}},{key:"createSpan",value:function(t){if(A.is(t,Va))return new es(this,t);if(A.is(t,Ol))return new Os(this,t);if(A.is(t,ll))return new cs(this,t);if(A.is(t,qa))return new hs(this,t);throw new Error("Unrecognized SpanNotation type")}},{key:"invalidateSystemStart",value:function(){this.invalidate(),this._staffStartLayout.invalidate()}},{key:"destroyChildren",value:function(){this._staffStartLayout&&this._staffStartLayout.destroy(),this._cautionaryLayout&&this._cautionaryLayout.destroy();for(var t=0;t<this._measureLayouts.length;t++)this._measureLayouts[t].destroy()}},{key:"drawHyphen",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._hyphenLayouts.push(new ns(this.context,t,e,i,n))}},{key:"updateHyphens",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.createHyphens(t),this.dispatchEvent(new Ti(Ti.HYPHENS_UPDATED))}},{key:"createLyricLineId",value:function(t){var e=t.lyric.line.toString();return t.aboveStaff?"-"+e:e}},{key:"createHyphens",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.staff.seenLyrics){this._hyphenLayouts=[],this._hyphenStateEndStaff={},this._hyphenStateBeginningStaff={};var t,e,i,n={},r=!0,o=!1,s=void 0;try{for(var a,l=this.measureLayouts[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=!0,c=!1,d=void 0;try{for(var f,y=u.lyricLayoutsList[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;if(""!==g.lyric.text){n[this.createLyricLineId(g)]||(n[this.createLyricLineId(g)]=g);var p=this._hyphenStateEndStaff[this.createLyricLineId(g)];p&&(this.drawHyphen(p.lyricLayout,null,g),delete this._hyphenStateEndStaff[this.createLyricLineId(g)]),g.lyric.continued&&(this._hyphenStateEndStaff[this.createLyricLineId(g)]=new is(g))}}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}if(u.measure.systemMeasure.endRepeat)for(e in t||(t=u.measure),this._hyphenStateEndStaff)(i=this._hyphenStateEndStaff[e])&&(this.drawHyphen(A.unknownToType(i.lyricLayout,fs),null,null,u.measure),delete this._hyphenStateEndStaff[this.createLyricLineId(A.unknownToType(i.lyricLayout,fs))])}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}var m=this.context.scoreLayout.getHyphensBeginningStaff(this._index,this.systemLayout.startMeasureIndex);if(m)for(e in this._hyphenStateBeginningStaff=m,m){var v=A.unknownToType(n[e],fs);v||t?t&&(!v||t.index<v.measureIndex)?this.drawHyphen(m[e].lyricLayout,this.startMeasure,null,t):v&&(v.measureIndex!=this.startMeasureIndex||v.lyric.position>0)&&this.drawHyphen(m[e].lyricLayout,this.startMeasure,v,null):this._hyphenStateEndStaff[e]=m[e]}for(e in this._hyphenStateEndStaff)(i=this._hyphenStateEndStaff[e])&&this.drawHyphen(A.unknownToType(i.lyricLayout,fs),null,null,this.lastMeasure);this.context.lyricsContext.updateStaffHyphensInfo(this._index,this.systemLayout,this._hyphenStateEndStaff)}}},{key:"prepareLayout",value:function(){if(!this._auxiliaryMeasuresPrepared){var t=this.getMeasureLayoutAt(0).measure,e=this.getMeasureLayoutAt(this._measureLayouts.length-1).measure.systemMeasure;if(e.index<e.staff.numChildren-1&&!e.disableCautionaries){var i=e.staff.getMeasureAt(A.intToUint(e.index+1)),n=t.staff.getMeasureAt(A.intToUint(i.index)),r=new Xo(this.context,n,e,i,this.topStaff);r.needed?this._cautionaryLayout=r:r.destroy()}this._auxiliaryMeasuresPrepared=!0}this._height=this._topPadding=this._bottomPadding=this._minLyricBelowBaseY=this._maxLyricAboveBaseY=this._maxLyricExtraLinesAboveStaff=0,this._width=0,this._constraint=new oa([]),null!=this._cautionaryLayout&&this.validateMeasureLayout(this._cautionaryLayout)}},{key:"doValidateLayout",value:function(){jd.pushTimer("StaffLayout","doValidateLayout"),this.prepareLayout();for(var t=0;t<this._measureLayouts.length;t++){var e=this.getMeasurePrefixesLayoutAt(t);if(e){var i=!0,n=!1,r=void 0;try{for(var o,s=e.prefixes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Wo);this.validateMeasureLayout(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}var u=this._measureLayouts[t];this.validateMeasureLayout(u)}jd.popTimer("StaffLayout","doValidateLayout")}},{key:"ticksBetweenMeasurePositions",value:function(t,e){if(t.measureIndex==e.measureIndex)return e.position-t.position;for(var i=this.score.getSystemStaffMeasureAt(t.measureIndex).duration-t.position,n=t.measureIndex+1;n<e.measureIndex;n++)i+=this.score.getSystemStaffMeasureAt(n).duration;return i+=e.position}},{key:"doValidateGlobalLayout",value:function(){var t;this._height=this._topPadding=this._bottomPadding=this._minLyricBelowBaseY=this._maxLyricAboveBaseY=this._maxLyricExtraLinesAboveStaff=0;var e=!0,i=!1,n=void 0;try{for(var r,o=this._measureLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if((t=r.value).valid){this._minLyricBelowBaseY=Math.min(this._minLyricBelowBaseY,t.minLyricBelowBaseY),this._maxLyricAboveBaseY=Math.max(this._maxLyricAboveBaseY,t.maxLyricAboveBaseY);var s=t.getLyricLayoutsListAboveStaff(),a=!0,l=!1,u=void 0;try{for(var h,c=s[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,fs);this._maxLyricExtraLinesAboveStaff=Math.max(this._maxLyricExtraLinesAboveStaff,f.lyric.line)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var y=!0,g=!1,p=void 0;try{for(var m,v=this._measureLayouts[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){t=m.value;var _=this.getMeasurePrefixesLayoutByMeasureIndex(t.measure.index);if(_){var S=_.prefixes,L=!0,k=!1,T=void 0;try{for(var E,M=S[Symbol.iterator]();!(L=(E=M.next()).done);L=!0){var b=E.value,w=A.unknownToType(b,Wo);this.validateMeasureGlobal(w)}}catch(t){k=!0,T=t}finally{try{L||null==M.return||M.return()}finally{if(k)throw T}}}this.validateMeasureGlobal(t)}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}if(this.context.staffMetrics.verticalAutoSpace){var x=!0,C=!1,N=void 0;try{for(var I,P=this.getSpansInRange(this.startMeasureIndex,this.endMeasureIndex)[Symbol.iterator]();!(x=(I=P.next()).done);x=!0){var O=I.value,Q=A.unknownToType(O,ts);if(A.is(Q.notation,Ol)){var R,D=0;this.startMeasureIndex<=Q.notation.measure.index&&Q.notation.measure.index<this.endMeasureIndex?R=-this.ticksBetweenMeasurePositions(new gl(this.startMeasureIndex,0),Q.notation.measurePosition):D=R=this.ticksBetweenMeasurePositions(Q.notation.measurePosition,new gl(this.startMeasureIndex,0));var F=R;this.startMeasureIndex<=Q.notation.endPosition.measureIndex&&Q.notation.endPosition.measureIndex<this.endMeasureIndex?F+=this.ticksBetweenMeasurePositions(new gl(this.startMeasureIndex,0),Q.notation.endPosition):F+=this.ticksBetweenMeasurePositions(new gl(this.startMeasureIndex,0),new gl(this.lastMeasure.index,this.lastMeasure.duration));var U=Q.notation.getMaxHeightInSegment(D,F),V=U+this.context.staffMetrics.slurPadding-this.getMeasureLayoutAt(0).measure.effectiveClef.staffHeight;this._topPadding=Math.max(this._topPadding,V);var B=U-this.context.staffMetrics.slurPadding;this._bottomPadding=Math.max(this._bottomPadding,-B)}else X.isNaN(Q.notation.top)||(this._topPadding=Math.max(this._topPadding,Q.notation.top-this.getMeasureLayoutAt(0).measure.effectiveClef.staffHeight),this._bottomPadding=Math.max(this._bottomPadding,-Q.notation.bottom))}}catch(t){C=!0,N=t}finally{try{x||null==P.return||P.return()}finally{if(C)throw N}}}if(this._hyphenLayouts.length>0){var H=!0,$=!1,G=void 0;try{for(var Y,z=this._hyphenLayouts[Symbol.iterator]();!(H=(Y=z.next()).done);H=!0){var W=Y.value,K=A.unknownToType(W,ns);K.startLyricLayout.direction==he.DIRECTION_DOWN?(0===this._minLyricBelowBaseY&&(this._minLyricBelowBaseY=-this._bottomPadding+this.context.staffMetrics.lyricsBelowStaffTop),this._bottomPadding=Math.max(this._bottomPadding,-fs.lyricY(this.context,K.startLyricLayout,this,K.startLyricLayout.lyric))):(0===this._maxLyricAboveBaseY&&(this._maxLyricAboveBaseY=this._topPadding),this._topPadding=Math.max(this._topPadding,fs.lyricY(this.context,K.startLyricLayout,this,K.startLyricLayout.lyric)))}}catch(t){$=!0,G=t}finally{try{H||null==z.return||z.return()}finally{if($)throw G}}}}},{key:"validateMeasureGlobal",value:function(t){t.valid&&(t.validateGlobalLayout(),this._height=Math.max(this._height,t.height),this._topPadding=Math.max(this._topPadding,t.topPadding),this._bottomPadding=Math.max(this._bottomPadding,t.bottomPadding),t.bottomLyricY!=Wo.NO_LYRICS_BELOW_STAFF&&(this._bottomPadding=Math.max(this._bottomPadding,-t.bottomLyricY+Math.max(0,t.minLyricBelowBaseY-this._minLyricBelowBaseY))),t.topLyricY!=Wo.NO_LYRICS_ABOVE_STAFF&&(this._topPadding=Math.max(this._topPadding,t.maxLyricAboveBaseY+this._maxLyricExtraLinesAboveStaff*this.context.staffMetrics.lyricsLineSpacing)))}},{key:"validateMeasureLayout",value:function(t){var e=A.unknownToType(this._constraint,oa);null!=t.systemMeasureLayout?t.systemMeasureLayout.validateLayout():t.validateLayout(),e.addConstraint(t.constraint)}},{key:"systemLayout",get:function(){return A.as(this._parent,Ss)}},{key:"measureLayouts",get:function(){return this._measureLayouts},set:function(t){this.destroyChildren(),this._measureLayouts=t;var e=t[0].measure;this._staff=e.staff,this._auxiliaryMeasuresPrepared=!1,this.updateMeasurePrefixes(),this.invalidate()}},{key:"measurePrefixesLayouts",get:function(){return this._measurePrefixesLayouts}},{key:"index",get:function(){return this._index}},{key:"score",get:function(){return this.staff.score}},{key:"canHide",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._measureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){if(!n.value.measure.canHideStaff)return!1}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!0}},{key:"staff",get:function(){return this._staff}},{key:"staffStartLayout",get:function(){return this._staffStartLayout}},{key:"cautionaryLayout",get:function(){return this._cautionaryLayout}},{key:"topPadding",get:function(){return this._topPadding}},{key:"bottomPadding",get:function(){return this._bottomPadding}},{key:"minLyricBelowBaseY",get:function(){return this._minLyricBelowBaseY}},{key:"maxLyricAboveBaseY",get:function(){return this._maxLyricAboveBaseY}},{key:"maxLyricExtraLinesAboveStaff",get:function(){return this._maxLyricExtraLinesAboveStaff}},{key:"staffStartLayouts",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=xt.objectForOfSource(this._measurePrefixesLayouts)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=!0,l=!1,u=void 0;try{for(var h,c=s.prefixes[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;A.is(d,Ds)&&t.push(d)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"hyphenStateBeginningStaff",get:function(){return this._hyphenStateBeginningStaff}},{key:"hyphenStateEndStaff",get:function(){return this._hyphenStateEndStaff}},{key:"lastMeasureLayout",get:function(){return this._measureLayouts[this._measureLayouts.length-1]}},{key:"startMeasure",get:function(){var t=this.getMeasureLayoutAt(0);return t?t.measure:null}},{key:"startMeasureIndex",get:function(){return this.startMeasure?this.startMeasure.index:0}},{key:"endMeasureIndex",get:function(){return this.startMeasureIndex+this._measureLayouts.length}},{key:"lastMeasure",get:function(){return this._measureLayouts[this._measureLayouts.length-1].measure}},{key:"length",get:function(){return this._measureLayouts.length}},{key:"hyphens",get:function(){return this._hyphenLayouts}}]),e}();r.registerClass(Rs,"com.noteflight.notation.layout.StaffLayout");var Ds=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,i))).showAnnotations=!1,r._showMeasureNumber=n,r}return c(e,Wo),p(e,[{key:"buildChildLayouts",value:function(){this.initializeNotationLayouts(),this._measureNumberNotation=null;var t=!0;if(this.measure.effectiveClef.sign==Mn.TAB_CLEF_SIGN)for(var e=this.measure.index-1;e>0;e--)if(!this.measure.staff.measures[e].canHideStaff){t=!1;break}if((this.measure.effectiveClef.sign!=Mn.TAB_CLEF_SIGN||0===this.measure.index||t)&&this.addNotationLayout(this.createNotationLayout(this.measure.effectiveClef,this.measure.effectiveClef)),this.addNotationLayout(this.createNotationLayout(this.measure.keySignature,this.measure.effectiveClef)),this.requiresMeasureNumber){var i=new ja(0,this.measure);i.parent=this.measure.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER),i.textbox=this.context.staffMetrics.barNumberBoxed,this._measureNumberNotation=this.createNotationLayout(i,this.measure.effectiveClef),this.addNotationLayout(this._measureNumberNotation)}}},{key:"createNotationLayout",value:function(t,i){if(A.is(t,Mn))return new qo(this.context,this,A.as(t,Mn),!1);if(A.is(t,Ga)){var n=A.as(t,Ga);return this.measure.scoreInterval.octaveMultiple||(n=n.transposeFifths(this.measure.scoreInterval.fifths)),0===n.fifths?null:new os(this.context,this,A.as(t,Ga),n,i)}return s(h(e.prototype),"createNotationLayout",this).call(this,t,i)}},{key:"createMeasureView",value:function(t,i){var n=s(h(e.prototype),"createMeasureView",this).call(this,t,i);return n.highlightEnabled=!1,n.isStaffStartView=!0,n}},{key:"handleMeasureChange",value:function(t){}},{key:"buildGlobalLayouts",value:function(){this._globalLayouts=[]}},{key:"leftPaddingConstraint",get:function(){return new ra(0)}},{key:"requiresMeasureNumber",get:function(){return this._showMeasureNumber}}]),e}();r.registerClass(Ds,"com.noteflight.notation.layout.StaffStartLayout");var Fs=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),(n=l(this,h(e).call(this,t)))._systemLayout=null,n._buildIncrementally=!1,n._buildIncrementally=i,n._context.scoreLayout=u(u(n)),n._overlay=r,n}return c(e,Ts),p(e,[{key:"isFirstMeasureOfChunk",value:function(t){return 0===t}},{key:"insertMeasure",value:function(t){if(!this._overlay)for(var e=0;e<this._systemLayout.staffLayouts.length;e++){var i=this.getStaffLayoutAt(A.intToUint(e)),n=this._systemLayout.getStaffLayoutAt(A.intToUint(e)),r=i.getMeasureLayoutAt(t),o=n.getMeasureLayoutAt(0);r.topStaffOnSystem=o.topStaffOnSystem,r.bottomStaffOnSystem=o.topStaffOnSystem,r.topStaffInBarlineGroup=o.topStaffInBarlineGroup,r.bottomStaffInBarlineGroup=o.bottomStaffInBarlineGroup,n.insertMeasureLayout(r,t)}}},{key:"removeMeasure",value:function(t){for(var e=0;e<this._systemLayout.staffLayouts.length;e++)this._systemLayout.getStaffLayoutAt(A.intToUint(e)).removeMeasureLayout(t)}},{key:"addVisibleMeasure",value:function(t){this._systemLayout.insertSystemMeasureLayout(this.getSystemMeasureLayoutAt(A.intToUint(t)),t),this.insertMeasure(t)}},{key:"removeVisibleMeasure",value:function(t){this._systemLayout.removeSystemMeasureLayout(t),this.removeMeasure(t)}},{key:"prepareLayout",value:function(){var t=this.createSystemLayout(0,1,!0,!1,Nl.STRIP_DISPLAY);this._width=t.x,t.validateGlobalLayout();var e=this._overlay?1:this.score.numMeasures;this._systemLayout=this.createSystemLayout(0,A.numberToUint(e),!1,!1,Nl.STRIP_DISPLAY),this._overlay||this._systemLayout.addEventListener(Vi.STAFF_SPACING,xt.bindMethod(this,this.handleUpdateStaffSpacing));for(var i=0;i<t.staffLayouts.length;i++)this._systemLayout.getStaffLayoutAt(A.intToUint(i)).distanceY=t.getStaffLayoutAt(A.intToUint(i)).distanceY;t.destroy();var n=this.context.stripMetrics.stripMarginTop/this.context.staffMetrics.lineSpacing+this.context.staffMetrics.pageTopPadding;this._systemLayout.distanceY=n,this._height=this._systemLayout.distanceY+t.height+this.context.stripMetrics.stripMarginBottom/this.context.staffMetrics.lineSpacing}},{key:"handleUpdateStaffSpacing",value:function(t){this.dispatchEvent(t)}},{key:"getXPosition",value:function(t,e){return e.info.staffHandleExtent-e.info.staffHandlePadding+this.context.stripMetrics.stripMarginLeft}},{key:"doValidateLayout",value:function(){this._systemLayout=this.createSystemLayout(0,this.score.numMeasures,!0,!1,Nl.STRIP_DISPLAY),this._width=this._systemLayout.x,this.determineSystemPosition()}},{key:"determineSystemPosition",value:function(){this._systemLayout.validateGlobalLayout();var t=this.context.stripMetrics.stripMarginTop/this.context.staffMetrics.lineSpacing+this.context.staffMetrics.pageTopPadding;this._systemLayout.distanceY=Math.max(-this.context.staffMetrics.topStaffGap,t-this._systemLayout.topPadding),this._height=this._systemLayout.distanceY+this._systemLayout.height+Math.max(this.context.stripMetrics.stripMarginBottom/this.context.staffMetrics.lineSpacing,this._systemLayout.bottomPadding)}},{key:"createDisplayObject",value:function(t){return new Sc(t,this)}},{key:"handleMeasureSequenceChange",value:function(t){this.invalidate(),this.addOrRemoveMeasures(t),t.measureIndices&&t.measureIndices.length?this.revalidateSystemMeasureLayouts(t.measureIndices):this.prepareLayout();var e=new bi(bi.SEQUENCE_CHANGE,t.measureIndices,this._systemLayout);this.dispatchEvent(e)}},{key:"handleMeasureValidate",value:function(t){var e=t.measureIndices,i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToInt(a);l==this._systemLayout.startMeasureIndex&&(this._systemLayout.invalidateSystemStart(),this._systemLayout.validateLayout());var u=this.getSystemMeasureLayoutAt(A.intToUint(l));u.invalidateMeasures(),u.validateLayout()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var h=new bi(bi.DISPLAY,e,this._systemLayout,!1,t.staves);this._systemLayout.dispatchEvent(h),this.dispatchEvent(h),this.dispatchEvent(new Mi(Mi.CONTINUE_INCREMENTAL_FLOW,t.firstMeasureIndex,t))}},{key:"handleMeasureGeometryChange",value:function(t){var e=t.measureIndices;null==e&&(e=this.allMeasureIndices);var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToInt(a);this.getSystemMeasureLayoutAt(A.intToUint(l))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var u=new bi(bi.GEOMETRY_CHANGE,e,this._systemLayout);this._systemLayout.dispatchEvent(u),this.dispatchEvent(u)}},{key:"handleMeasureSpanChange",value:function(t){var e=t.measureIndices;null==e&&(e=this.allMeasureIndices);var i=new bi(bi.SPAN_CHANGE,e,this._systemLayout);this._systemLayout.dispatchEvent(i),this.dispatchEvent(i)}},{key:"updateHyphens",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._systemLayout.updateHyphens(t,e)}},{key:"displayMode",get:function(){return Nl.STRIP_DISPLAY}},{key:"systemLayout",get:function(){return this._systemLayout}},{key:"endMeasureIndex",get:function(){return this._systemLayout.endMeasureIndex}}]),e}();r.registerClass(Fs,"com.noteflight.notation.layout.StripLayout");var Us=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this,t)))._flowWidth=NaN,i._measureLayouts=[],i._layoutPositions=null,i._forceBreakType=null,i._displayMode=null,i._displayMode=n,i}return c(e,Ro),p(e,[{key:"setValidMeasureLayouts",value:function(t){if(this.removeListeners(),this._measureLayouts=t,null!=this._measureLayouts){var e=!0,i=!1,n=void 0;try{for(var r,o=this._measureLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.systemMeasureLayout=this,s.measure.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange),!1),s.measure.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate),!1)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"hasStaffStartLayouts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(A.is(o,Ds))return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"removeListeners",value:function(){if(null!=this._measureLayouts){var t=!0,e=!1,i=void 0;try{for(var n,r=this._measureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value.measure;null!=o&&(o.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange)),o.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate)))}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}}},{key:"handleMeasureChange",value:function(t){this.invalidate()}},{key:"handleMeasureUpdate",value:function(t){A.is(t.source,Ua)||this.invalidate()}},{key:"invalidateMeasures",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._measureLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.invalidate()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"intersectingStaves",value:function(t,e){var i,n=[];if(!this._layoutPositions)return!1;for(var r=this._layoutPositions[t].position;t<this._layoutPositions.length&&!((i=this._layoutPositions[t]).position>r);)i.voiceNumber>=0&&(n[i.staffIndex]=1),t++;for(r=this._layoutPositions[e].position;e<this._layoutPositions.length&&!((i=this._layoutPositions[e]).position>r);){if(i.voiceNumber>=0&&1==n[i.staffIndex])return!0;e++}return!1}},{key:"doValidateLayout",value:function(){if(this._measureLayouts){var t=[];this._layoutPositions=t;var e=new ia([]),i=!0,n=!1,r=void 0;try{for(var o,s=this._measureLayouts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.validateLayout();var l=!0,u=!1,h=void 0;try{for(var c,d=a.notationLayouts[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;f.notation.metrical&&(t[t.length]=new I(f))}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}e.addConstraint(a.leftConstraint),A.unknownToType(a.constraint,ia).addConstraint(e),a.measure.staffHidingChange&&null==this.breakType&&(this._forceBreakType=hl.SYSTEM_BREAK_TYPE)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}t.sort(xt.bindMethod(this,this.compareLayoutPositions));for(var y,g,p=0,m=0,v=new ra(0),_=this.systemMeasure?this.systemMeasure.layoutWeight*Math.exp(Math.LN2*this.context.score.effectiveStaffMetrics.layoutSpacing/10):1;p<t.length;){var S=t[p];for(p++,y=new ia([S.leftConstraint,v]),A.unknownToType(S.constraint,ia).addConstraint(y),g=S.duration>0?S.duration:1e6,S.duration=0,m=p;m<t.length;){var L=t[m],k=L.position-S.position;if(k>0){if(null!=y){var T=this.context.staffMetrics.getDurationWidth(A.numberToUint(k));if(g<1e6&&k<g&&!this.intersectingStaves(p-1,m)){var E=this.context.staffMetrics.getDurationWidth(A.numberToUint(g))*k/g;T=Math.min(T,E)}var M=new sa(T,_);v=new oa([y,M]),y=null}p=m;break}m++,null==y?y=new ia([L.leftConstraint]):y.addConstraint(L.leftConstraint),A.unknownToType(L.constraint,ia).addConstraint(y);var b=L.duration;L.duration=0,b>0&&b<g&&(g=b)}}this._constraint=e,this.context.score.isStripMode?(this._constraint.generateLayoutVector(Zs.STANDARD_WEIGHTS),this._flowWidth=0):(this._constraint.generateLayoutVector(Zs.FLOW_WEIGHTS),this._flowWidth=this.x);var w=this._measureLayouts[0];if(w.isMultiRest){var x=w.isFirstMeasureOfMultiRest,C=w.isBodyOfMultiRestButNotLastOne,N=w.isLastMeasureOfMultiRest;(x||C)&&(this._forceBreakType=hl.FORCE_NO_BREAK),(C||N)&&(this._flowWidth=0)}}}},{key:"getMeasurePositionX",value:function(t){var e=null,i=null;if(null==this._layoutPositions)return X.trace("This condition occurs in the chromaticTransposition test. You should not see this live."),0;var n=!0,r=!1,o=void 0;try{for(var s,a=this._layoutPositions[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.includeInPositioning){if(l.position>t){i=l;break}e=l}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}if(null==e)return 0;if(null!=i){var u=e.x,h=i.x,c=e.position;return u+(h-u)*(t-c)/(i.position-c)}return e.x}},{key:"getMeasureXPosition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,r=null,o=!0,s=!1,a=void 0;try{for(var l,u=this._layoutPositions[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(h.barline&&h.position>0&&null==r&&(r=h),!(!h.includeInPositioning||i&&h.barline||i&&this.systemMeasure&&h.position==this.systemMeasure.duration)){if(h.x>t){r=h;break}n=h}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}if(null==n)return 0;if(null!=r){var c=n.x,d=r.x,f=n.position,y=r.position;if(e>0){var g=r.position-n.position,p=this.systemMeasure?Math.min(this.systemMeasure.timeSignature.beatDuration,e):e;if(g>p){var m=g*(t-c)/(d-c),v=Math.floor(m/p);f+=v*p,i&&this.systemMeasure&&f==this.systemMeasure.duration&&(f=Math.max(0,f-p)),c+=v*p*(d-c)/g}}return Math.abs(t-c)<Math.abs(t-d)||i&&r.barline?f:y}return n.position}},{key:"getNotationPositions",value:function(){var t=[],e=NaN,i=!0,n=!1,r=void 0;try{for(var o,s=this._layoutPositions[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.includeInPositioning&&a.x!=e&&(t.push({x:a.x,position:a.position}),e=a.x)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}},{key:"compareLayoutPositions",value:function(t,e){var i;return 0!=(i=t.position-e.position)?i<0?-1:1:0}},{key:"hasNonTabClefs",value:function(){return this._measureLayouts.some(function(t){return!t.measure.clef.isTab()})}},{key:"index",get:function(){return null==this._measureLayouts?-1:this._measureLayouts[0].measure.index}},{key:"measureLayouts",get:function(){return this._measureLayouts},set:function(t){if(this.removeListeners(),this._measureLayouts=t,null!=this._measureLayouts){var e=!0,i=!1,n=void 0;try{for(var r,o=this._measureLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.systemMeasureLayout=this;var a=s.measure;null!=a&&(a.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleMeasureChange),!1),a.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleMeasureUpdate),!1)),s.invalidate()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}this.invalidate()}},{key:"systemMeasure",get:function(){return null==this._measureLayouts?null:this._measureLayouts[0].measure.systemMeasure}},{key:"breakType",get:function(){return this._forceBreakType?this._forceBreakType==hl.FORCE_NO_BREAK?null:this._forceBreakType:this.context.score.getBreak(this.index)}},{key:"hasPageBreak",get:function(){return this.breakType==hl.PAGE_BREAK_TYPE}},{key:"singlePart",get:function(){if(!this._measureLayouts)return!1;if(this._measureLayouts.length<=1)return!0;for(var t=this._measureLayouts[0].measure.part,e=1;e<this._measureLayouts.length;e++)if(this._measureLayouts[e].measure.part!=t)return!1;return!0}},{key:"flowWidth",get:function(){return this.validateLayout(),this._flowWidth}}]),e}();r.registerClass(Us,"com.noteflight.notation.layout.SystemMeasureLayout");var Vs=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t,i,n,o)))._symbolType=null,s._symbolType=r,s}return c(e,Uo),p(e,null,[{key:"CODA_TYPE",get:function(){return Bs},set:function(t){Bs=t}},{key:"SEGNO_TYPE",get:function(){return Hs},set:function(t){Hs=t}},{key:"BREATH_TYPE",get:function(){return $s},set:function(t){$s=t}},{key:"CAESURA_TYPE",get:function(){return Gs},set:function(t){Gs=t}}]),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"initializeLayout",value:function(){var t=this.foundry.getSymbol(this._symbolType),e=new Zo(this.context,t),i=this.measureLayout.measure.staff;e.distanceX=this.symbol.dx,e.distanceY=i.type.numLines*i.type.lineSpacing+this.symbol.dy+this.context.staffMetrics.symbolOffset,e.scale=this.context.staffMetrics.symbolScale,e.horizontalAnchor=Zo.ANCHOR_CENTER,this.addGlyphLayout(e)}},{key:"createDisplayObject",value:function(t){return this.doValidateGlobalLayout(),new lh(t,this)}},{key:"symbol",get:function(){return A.as(this.notation,Pa)}}]),e}(),Bs="coda",Hs="segno",$s="breath",Gs="caesura";r.registerClass(Vs,"com.noteflight.notation.layout.SystemSymbolLayout");var Ys=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).centered=!0,o}return c(e,Vo),p(e,[{key:"doValidateLayout",value:function(){this.initializeLayout(A.as(this.notation,Gl)),s(h(e.prototype),"doValidateLayout",this).call(this)}},{key:"initializeLayout",value:function(t){var e,i,n=this.clef.getRestLine(A.intToUint(mn.WHOLE))*this.clef.lineSpacing+t.dy,r=0===t.voiceNumber,o=0;!this.noteSet.explicitRestY&&this.multiVoice&&this.clef.numLines>1&&(null==this.alternateVoiceLayout||!this.alternateVoiceLayout.noteSet.invisible)&&(o+=r?this.context.staffMetrics.upperVoiceRestOffset:this.context.staffMetrics.lowerVoiceRestOffset);if(n+=o,this.clef.showRhythm(this.context.score)&&!this.measureLayout.isMultiRest){var s=Cs.restType(mn.WHOLE,n,this.clef);(e=new Zo(this.context,this.foundry.getRest(mn.WHOLE,s))).distanceY=n}else e=new Zo(this.context,new gr(0,0));this.addGlyphLayout(e),i=r?this.clef.staffHeight+o+t.dy+this.context.staffMetrics.articulationPadding:n-e.height-this.context.staffMetrics.articulationPadding;var a=!0,l=!1,u=void 0;try{for(var h,c=t.articulations[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToString(d),y=A.intToUint(Sn.ARTICULATION_ATTRIBUTES[f]);if(0!=(y&Sn.ALLOWED_ON_REST)){var g=this.foundry.getArticulation(f,r,!1),p=new Zo(this.context,g),m=e.width/2;p.verticalAnchor=Zo.ANCHOR_BOTTOM,0!=(y&Sn.PLACE_TO_RIGHT)&&(m+=this.context.staffMetrics.rightArticulationPadding),p.distanceX=m,r&&(i+=p.height),p.distanceY=i,this.addGlyphLayout(p),r?i+=this.context.staffMetrics.articulationSpacing:(i-=this.context.staffMetrics.articulationSpacing,i-=p.height)}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}]),e}();r.registerClass(Ys,"com.noteflight.notation.layout.TacetLayout");var zs=function(t){function e(t,i,n,r){var o,s;y(this,e),o=l(this,h(e).call(this,t,i,n,r)),s=n.measure.timeSignatureNotation?i.firstLayoutOnSystem?t.staffMetrics.tempoTimeSignatureXOffsetFirstMeasure:t.staffMetrics.tempoTimeSignatureXOffset:i.firstLayoutOnSystem?t.staffMetrics.tempoXOffsetFirstMeasure:t.staffMetrics.tempoXOffset;var a=o.foundry.getTempo(n.value,n.dots>0,!0),u=new Zo(t,a),c=i.measure.staff;u.scale=t.staffMetrics.tempoSymbolScale,u.distanceX=-u.width-s,u.distanceY=c.type.numLines*c.type.lineSpacing+n.dy+t.staffMetrics.tempoUnitOffset,u.horizontalAnchor=Zo.ANCHOR_RIGHT,o.addGlyphLayout(u);var d=new eo(o.createTextFormat(),n.bpm.toString()),f=new Zo(t,d);return f.distanceX=u.width+s,f.distanceY=c.type.numLines*c.type.lineSpacing+n.dy+t.staffMetrics.tempoTextOffset,o.addGlyphLayout(f),o}return c(e,Uo),p(e,[{key:"createTextFormat",value:function(){return new Ly(this.context.staffMetrics.tempoFont,this.context.staffMetrics.baseFontSize*this.context.staffMetrics.tempoSymbolSize,null,this.context.staffMetrics.tempoBold)}},{key:"tempo",get:function(){return A.as(this.notation,Yl)}}]),e}();r.registerClass(zs,"com.noteflight.notation.layout.TempoLayout");var Ws=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,$o),p(e,[{key:"doCreateView",value:function(t,e,i,n,r){return new Lc(i*this.staffMetrics.lineSpacing,-(n+e.pitchLine)*this.staffMetrics.lineSpacing,r*this.staffMetrics.lineSpacing,-this.tieHeight(r)*this.staffMetrics.lineSpacing,this.staffMetrics)}}]),e}();r.registerClass(Ws,"com.noteflight.notation.layout.TieLayout");var Xs=function(t){function e(t,i,n,r){var o;y(this,e),o=l(this,h(e).call(this,t,i,n,r));var s=r.showRhythm(t.score);return null!=n.timeSymbol?o.addTimeSignatureGlyph(o.foundry.getTimeSignatureSymbol(n.timeSymbol),s,r.staffHeight/2):(o.addTimeSignatureGlyph(o.foundry.getTimeSignature(n.beats),s,r.staffHeight/2+1),o.addTimeSignatureGlyph(o.foundry.getTimeSignature(n.beatType),s,r.staffHeight/2-1)),o.padding=t.staffMetrics.timeSignaturePadding,o}return c(e,Uo),p(e,[{key:"addTimeSignatureGlyph",value:function(t,e,i){e||(t=new gr(t.width,t.height));var n=new Zo(this.context,t);n.distanceY=i,n.horizontalAnchor=Zo.ANCHOR_CENTER,this.addGlyphLayout(n)}},{key:"timeSignature",get:function(){return A.as(this.notation,zl)}}]),e}();r.registerClass(Xs,"com.noteflight.notation.layout.TimeSignatureLayout");var Ks=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).startX=NaN,n.endX=NaN,n.startY=NaN,n.rise=NaN,n.down=!1,n.numberLayout=null,n._beamableLayouts=[],n._tuplet=null,n._tuplet=i,n}return c(e,Ro),p(e,[{key:"addBeamableLayout",value:function(t){this._beamableLayouts.push(t)}},{key:"getBeamableLayoutAt",value:function(t){return A.as(this._beamableLayouts[t],rs)}},{key:"setUpTuplet",value:function(){if(this.tuplet.showBracket=this.requiresBracket,1==this.getBeamableLayoutAt(0).noteSet.measure.numVoices)this.tuplet.showBracket?this.down=!1:this.down=this.getBeamableLayoutAt(0).down;else{this.down=this.getBeamableLayoutAt(0).noteSet.voiceNumber>0;var t=!0,e=!1,i=void 0;try{for(var n,r=this._beamableLayouts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,rs);if(s.multiVoice&&s.hasStem){this.down=s.down;break}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}}},{key:"doValidateLayout",value:function(){}},{key:"getFirstNonRestLayout",value:function(t){if(t>=this.numBeamableLayouts)return this.getBeamableLayoutAt(0);var e=this.getBeamableLayoutAt(t);return A.is(e,Cs)?this.getFirstNonRestLayout(t+1):e}},{key:"getLastNonRestLayout",value:function(t){if(t<0)return this.getBeamableLayoutAt(this.lastBeamableLayoutIndex);var e=this.getBeamableLayoutAt(t);return A.is(e,Cs)?this.getFirstNonRestLayout(t-1):e}},{key:"doValidateGlobalLayout",value:function(){var t=this.getBeamableLayoutAt(0);this.startX=t.leftX;var e=this.getFirstNonRestLayout(0);this.startY=this.down?e.clearExtrasBottom(0):e.clearExtrasTop(0);var i=this.getBeamableLayoutAt(this.lastBeamableLayoutIndex);this.endX=i.leftX;var n=this.getLastNonRestLayout(this.lastBeamableLayoutIndex),r=0;n&&(r=this.down?n.clearExtrasBottom(0):n.clearExtrasTop(0)),this.tuplet.showBracket?this.endX=this.endX+i.notationWidth:this.down||(this.endX=this.endX+2*i.notationWidth),this.rise=r-this.startY;var o,s,a=0;for(o=0;o<this.numBeamableLayouts;o++){var l=(s=this.getBeamableLayoutAt(o)).leftX+s.notationWidth/2,u=this.startY+this.rise*(l-this.startX)/(this.endX-this.startX);a=this.down?Math.min(a,s.clearExtrasBottom(0)-this.context.staffMetrics.tupletBracketHeight-u):Math.max(a,s.clearExtrasTop(0)+this.context.staffMetrics.tupletBracketHeight-u)}for(this.startY+=a,o=0;o<this.numBeamableLayouts;o++)s=this.getBeamableLayoutAt(o),this.down?s.clearExtrasBottom(this.context.staffMetrics.tupletHeight+this.context.staffMetrics.articulationPadding):s.clearExtrasTop(this.context.staffMetrics.tupletHeight+this.context.staffMetrics.articulationPadding);!this.tuplet.tremolo&&this.tuplet.showActualNumber&&(this.numberLayout=new Zo(this.context,this.context.foundry.getTupletNumber(this.tuplet.rhythmUnits)),this.numberLayout.horizontalAnchor=Zo.ANCHOR_CENTER)}},{key:"createDisplayObject",value:function(t){return new Tc(t,this)}},{key:"tuplet",get:function(){return this._tuplet}},{key:"numBeamableLayouts",get:function(){return this._beamableLayouts.length}},{key:"lastBeamableLayoutIndex",get:function(){return this._beamableLayouts.length-1}},{key:"requiresBracket",get:function(){for(var t=0;t<this.numBeamableLayouts;++t){var e=this.getBeamableLayoutAt(t);if(!e.beam&&!e.notation.grace)return!0}return this.tuplet.hasChildTuplet}},{key:"bounds",get:function(){if(this.tuplet.tremolo)return new Qo(0,0,0,0);var t=new Qo,e=!0,i=!1,n=void 0;try{for(var r,o=this._beamableLayouts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Ro);t=t.union(a.bounds)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var l=this.tuplet.showBracket||this.tuplet.showActualNumber||this.tuplet.showNormalNumber?this.context.staffMetrics.tupletHeight+this.context.staffMetrics.articulationPadding+this.context.staffMetrics.tupletBracketHeight:0;return this.down?new Qo(0,t.top-l,0,l):new Qo(0,t.bottom,0,l)}},{key:"slope",get:function(){return this.rise/(this.endX-this.startX)}}]),e}();r.registerClass(Ks,"com.noteflight.notation.layout.TupletLayout");var js=function t(){y(this,t)};r.registerClass(js,"com.noteflight.notation.layout.constraint.LayoutVector");var qs=function(){function t(){y(this,t),this._layoutVectorValid=!1,this._length=NaN,this._timeScaleDerivative=NaN,this._sizeScaleDerivative=NaN,this.lastWeights=null,this.doneAddingToConstraintsList=!1,this.phaseAddingToConstraintsList=0}return p(t,null,[{key:"MAX_ITERATIONS",get:function(){return 100}}]),p(t,[{key:"setLayoutVector",value:function(t,e,i){this._length=t,this._timeScaleDerivative=e,this._sizeScaleDerivative=i,this._layoutVectorValid=!0}},{key:"setFromLayoutVector",value:function(t){t?this.setLayoutVector(t.length,t.timeScaleDerivative,t.sizeScaleDerivative):this.invalidateLayoutVector()}},{key:"invalidateLayoutVector",value:function(){this._layoutVectorValid=!1}},{key:"generateLayoutVector",value:function(t){(t&&t!=this.lastWeights||!this.layoutVectorValid)&&(this.lastWeights=t||this.lastWeights||Zs.STANDARD_WEIGHTS,this.computeLayoutVector(this.lastWeights))}},{key:"computeLayoutVector",value:function(t){throw new Error("computeLayoutVector() not overridden")}},{key:"solveForLength",value:function(t,e){this.generateLayoutVector(new Zs(0,1)),t<this.layoutVector.length?this.solveSizeScaleForLength(t,e):this.solveTimeScaleForLength(t,e)}},{key:"solveSizeScaleForLength",value:function(e,i){for(var n=1,r=0;r++<t.MAX_ITERATIONS;){if(this.generateLayoutVector(new Zs(0,n)),Math.abs(this.layoutVector.length-e)<i)return;n-=(this.layoutVector.length-e)/this.layoutVector.sizeScaleDerivative}throw new Error("solveSizeScaleForLength failed to converge!")}},{key:"solveTimeScaleForLength",value:function(e,i){for(var n=1,r=0;r++<t.MAX_ITERATIONS;){if(this.generateLayoutVector(new Zs(n,1)),Math.abs(this.layoutVector.length-e)<i)return;0===this.layoutVector.timeScaleDerivative?n+=.1:n-=(this.layoutVector.length-e)/this.layoutVector.timeScaleDerivative}throw new Error("solveTimeScaleForLength failed to converge!")}},{key:"checkConstraintCycles",value:function(){var t=new Uy,e=new Uy;this.doCheckConstraintCycles(t,e)}},{key:"doCheckConstraintCycles",value:function(t,e){if(!xt.isInDictionary(this,t)){if(xt.isInDictionary(this,e))throw new Error("constraint cycle found");e.put(this,!0),this.checkTargetConstraints(t,e),t.put(this,!0)}}},{key:"checkTargetConstraints",value:function(t,e){}},{key:"layoutVectorValid",get:function(){return this._layoutVectorValid}},{key:"length",get:function(){return this._length}},{key:"timeScaleDerivative",get:function(){return this._timeScaleDerivative}},{key:"sizeScaleDerivative",get:function(){return this._sizeScaleDerivative}},{key:"layoutVector",get:function(){return this.layoutVectorValid||this.generateLayoutVector(null),this}}]),t}();r.implementsInterfaces(qs,[js]),r.registerClass(qs,"com.noteflight.notation.layout.constraint.LayoutConstraint");var Js=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._constraints=null,i._scaleDependents=[],i._constraintsList=null,i._constraints=t,i}return c(e,qs),p(e,[{key:"addConstraint",value:function(t){this._constraints.push(t),this.invalidateLayoutVector()}},{key:"addScaleDependent",value:function(t){this._scaleDependents.push(t)}},{key:"checkTargetConstraints",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=this._constraints[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;A.unknownToType(a,qs).doCheckConstraintCycles(t,e)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"generateLayoutVector",value:function(t){var e;if(t&&t!=this.lastWeights||!this.layoutVectorValid){if(!t){var i=!0,n=!1,r=void 0;try{for(var o,s=this.constraintsList[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)if((e=o.value).lastWeights&&e.layoutVectorValid){t=e.lastWeights;break}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}t||(t=Zs.STANDARD_WEIGHTS);var a=!0,l=!1,u=void 0;try{for(var h,c=this.constraintsList[Symbol.iterator]();!(a=(h=c.next()).done);a=!0)(!(e=h.value).layoutVectorValid||t&&t!=e.lastWeights)&&(e.lastWeights=t,e.computeLayoutVector(t))}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}},{key:"computeConstraintsList",value:function(){var t=[],i=[];for(i.push(this);i.length>0;){var n=i[i.length-1];switch(n.phaseAddingToConstraintsList){case 0:var r,o,s=!0,a=!1,l=void 0;try{for(var u,h=n._constraints[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;(r=A.unknownToType(c,qs)).doneAddingToConstraintsList||((o=A.as(r,e))?i.push(o):(t.push(r),r.doneAddingToConstraintsList=!0))}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}var d=!0,f=!1,y=void 0;try{for(var g,p=n._scaleDependents[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value;(r=A.unknownToType(m,qs)).doneAddingToConstraintsList||((o=A.as(r,e))?i.push(o):(t.push(r),r.doneAddingToConstraintsList=!0))}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}n.phaseAddingToConstraintsList=1;break;case 1:t.push(n),n.doneAddingToConstraintsList=!0,i.pop()}}for(var v=0;v<t.length;v++){var _=t[v];_.doneAddingToConstraintsList=!1,_.phaseAddingToConstraintsList=0}return t}},{key:"constraints",get:function(){return this._constraints},set:function(t){this._constraints=t,this.invalidateLayoutVector(),this._constraintsList=null}},{key:"constraintsList",get:function(){return null==this._constraintsList&&(this._constraintsList=this.computeConstraintsList()),this._constraintsList}}]),e}();r.registerClass(Js,"com.noteflight.notation.layout.constraint.CompoundConstraint");var Zs=function(){function t(e,i){y(this,t),this.timeScale=NaN,this.sizeScale=NaN,this.timeScale=e,this.sizeScale=i}return p(t,null,[{key:"STANDARD_WEIGHTS",get:function(){return ta}},{key:"FLOW_WEIGHTS",get:function(){return ea}}]),t}(),ta=new Zs(1,1),ea=new Zs(.9,1);r.registerClass(Zs,"com.noteflight.notation.layout.constraint.LayoutWeights");var ia=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Js),p(e,[{key:"computeLayoutVector",value:function(t){var e=null,i=!0,n=!1,r=void 0;try{for(var o,s=this.constraints[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,qs).layoutVector;(null==e||l.length>e.length)&&(e=l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.setFromLayoutVector(e)}}]),e}();r.registerClass(ia,"com.noteflight.notation.layout.constraint.MaxConstraint");var na=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Js),p(e,[{key:"computeLayoutVector",value:function(t){var e=null,i=!0,n=!1,r=void 0;try{for(var o,s=this.constraints[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,qs).layoutVector;(null==e||l.length<e.length)&&(e=l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.setFromLayoutVector(e)}}]),e}();r.registerClass(na,"com.noteflight.notation.layout.constraint.MinConstraint");var ra=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).sizeLength=NaN,i.sizeLength=t,i}return c(e,qs),p(e,[{key:"computeLayoutVector",value:function(t){this.setLayoutVector(this.sizeLength*t.sizeScale,0,this.sizeLength)}}]),e}();r.registerClass(ra,"com.noteflight.notation.layout.constraint.SpaceConstraint");var oa=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Js),p(e,[{key:"computeLayoutVector",value:function(t){var e=0,i=0,n=0,r=!0,o=!1,s=void 0;try{for(var a,l=this.constraints[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,qs).layoutVector;e+=h.length,i+=h.timeScaleDerivative,n+=h.sizeScaleDerivative}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}this.setLayoutVector(e,i,n)}}]),e}();r.registerClass(oa,"com.noteflight.notation.layout.constraint.SumConstraint");var sa=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return y(this,e),(i=l(this,h(e).call(this))).timeLength=NaN,i.scale=NaN,i.timeLength=t,i.scale=n,i}return c(e,qs),p(e,[{key:"computeLayoutVector",value:function(t){this.setLayoutVector(this.timeLength*t.timeScale*this.scale,this.timeLength*this.scale,0)}}]),e}();r.registerClass(sa,"com.noteflight.notation.layout.constraint.TimeConstraint");var aa=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$unslurredDurationFactor=.9,t._$maxUnslurredPause=.1,t._$staccatoDurationFactor=.25,t._$tenutoDurationFactor=1,t._$defaultVelocity=e.dynamicVelocity("f"),t._$marcatoRelativeVelocity=32,t._$bendStartDurationFactor=.25,t._$bendStopDurationFactor=.75,t._$glissandoStartDurationFactor=.25,t._$glissandoStopDurationFactor=1,t._$slideStartInterval=.025,t._$graceNoteBeatFraction=.125,t._$graceNoteTime=0,t._$letVibrateDuration=10,t._$vibratoFrequency=5,t._$vibratoRange=.5,t._$arpeggioMaxLength=.2,t._$arpeggioMaxSkew=.05,t._$tremoloInterval=.08,t._$trillInterval=.08,t}return c(e,se),p(e,null,[{key:"DYNAMIC_VELOCITY_MAP",get:function(){return la}},{key:"TEMPO_LINE_STAY_AT_NEW_TEMPO",get:function(){return"tempoLineStay"}},{key:"TEMPO_LINE_RETURN_TO_OLD_TEMPO",get:function(){return"tempoLineReturn"}},{key:"TEMPO_LINE_RETURN_AT_A_TEMPO",get:function(){return"tempoLineReturnATempo"}},{key:"FERMATA_NO_RITARD",get:function(){return"fermNoRit"}},{key:"FERMATA_RITARD_TIME_BASED",get:function(){return"fermTimeRit"}},{key:"FERMATA_RITARD_BEAT_BASED",get:function(){return"fermBeatRit"}},{key:"CAESURA_TIME_BASED",get:function(){return"caesuraTimeBased"}},{key:"CAESURA_BEAT_BASED",get:function(){return"caesuraBeatBased"}},{key:"TEMPO_LINE_STATE_DEFAULT",get:function(){return ua}},{key:"TEMPO_RITARD_PERCENT_DEFAULT",get:function(){return 50}},{key:"TEMPO_ACCEL_PERCENT_DEFAULT",get:function(){return 200}},{key:"FERMATA_STATE_DEFAULT",get:function(){return ha}},{key:"FERMATA_PERCENT_DEFAULT",get:function(){return 240}},{key:"FERMATA_RITARD_LENGTH_BEATS_DEFAULT",get:function(){return 1}},{key:"FERMATA_RITARD_LENGTH_TIME_DEFAULT",get:function(){return 2}},{key:"FERMATA_RITARD_PERCENT_DEFAULT",get:function(){return 160}},{key:"CAESURA_STATE_DEFAULT",get:function(){return ca}},{key:"CAESURA_LENGTH_BEATS_DEFAULT",get:function(){return 1}},{key:"CAESURA_LENGTH_TIME_DEFAULT",get:function(){return 1}},{key:"tempoLineState",get:function(){return da},set:function(t){da=t}},{key:"tempoLineRitPercent",get:function(){return fa},set:function(t){fa=t}},{key:"tempoLineAccelPercent",get:function(){return ya},set:function(t){ya=t}},{key:"fermataState",get:function(){return ga},set:function(t){ga=t}},{key:"fermataPercent",get:function(){return pa},set:function(t){pa=t}},{key:"fermataRitLengthBeats",get:function(){return ma},set:function(t){ma=t}},{key:"fermataRitLengthTime",get:function(){return va},set:function(t){va=t}},{key:"fermataRitPercent",get:function(){return _a},set:function(t){_a=t}},{key:"caesuraState",get:function(){return Sa},set:function(t){Sa=t}},{key:"caesuraLengthBeats",get:function(){return La},set:function(t){La=t}},{key:"caesuraLengthTime",get:function(){return ka},set:function(t){ka=t}}]),p(e,[{key:"configureForScoreExport",value:function(){this.unslurredDurationFactor=1,this.staccatoDurationFactor=1,this.tenutoDurationFactor=1}},{key:"equals",value:function(t){var i=A.as(t,e);return i&&this.graceNoteBeatFraction==i.graceNoteBeatFraction&&this.graceNoteTime==i.graceNoteTime}},{key:"unslurredDurationFactor",get:function(){return this._$unslurredDurationFactor},set:function(t){var e=this._$unslurredDurationFactor;this._$unslurredDurationFactor=t,e!==t&&this._propertyChanged("unslurredDurationFactor",e,t)}},{key:"maxUnslurredPause",get:function(){return this._$maxUnslurredPause},set:function(t){var e=this._$maxUnslurredPause;this._$maxUnslurredPause=t,e!==t&&this._propertyChanged("maxUnslurredPause",e,t)}},{key:"staccatoDurationFactor",get:function(){return this._$staccatoDurationFactor},set:function(t){var e=this._$staccatoDurationFactor;this._$staccatoDurationFactor=t,e!==t&&this._propertyChanged("staccatoDurationFactor",e,t)}},{key:"tenutoDurationFactor",get:function(){return this._$tenutoDurationFactor},set:function(t){var e=this._$tenutoDurationFactor;this._$tenutoDurationFactor=t,e!==t&&this._propertyChanged("tenutoDurationFactor",e,t)}},{key:"defaultVelocity",get:function(){return this._$defaultVelocity},set:function(t){var e=this._$defaultVelocity;this._$defaultVelocity=t,e!==t&&this._propertyChanged("defaultVelocity",e,t)}},{key:"marcatoRelativeVelocity",get:function(){return this._$marcatoRelativeVelocity},set:function(t){var e=this._$marcatoRelativeVelocity;this._$marcatoRelativeVelocity=t,e!==t&&this._propertyChanged("marcatoRelativeVelocity",e,t)}},{key:"bendStartDurationFactor",get:function(){return this._$bendStartDurationFactor},set:function(t){var e=this._$bendStartDurationFactor;this._$bendStartDurationFactor=t,e!==t&&this._propertyChanged("bendStartDurationFactor",e,t)}},{key:"bendStopDurationFactor",get:function(){return this._$bendStopDurationFactor},set:function(t){var e=this._$bendStopDurationFactor;this._$bendStopDurationFactor=t,e!==t&&this._propertyChanged("bendStopDurationFactor",e,t)}},{key:"glissandoStartDurationFactor",get:function(){return this._$glissandoStartDurationFactor},set:function(t){var e=this._$glissandoStartDurationFactor;this._$glissandoStartDurationFactor=t,e!==t&&this._propertyChanged("glissandoStartDurationFactor",e,t)}},{key:"glissandoStopDurationFactor",get:function(){return this._$glissandoStopDurationFactor},set:function(t){var e=this._$glissandoStopDurationFactor;this._$glissandoStopDurationFactor=t,e!==t&&this._propertyChanged("glissandoStopDurationFactor",e,t)}},{key:"slideStartInterval",get:function(){return this._$slideStartInterval},set:function(t){var e=this._$slideStartInterval;this._$slideStartInterval=t,e!==t&&this._propertyChanged("slideStartInterval",e,t)}},{key:"graceNoteBeatFraction",get:function(){return this._$graceNoteBeatFraction},set:function(t){var e=this._$graceNoteBeatFraction;this._$graceNoteBeatFraction=t,e!==t&&this._propertyChanged("graceNoteBeatFraction",e,t)}},{key:"graceNoteTime",get:function(){return this._$graceNoteTime},set:function(t){var e=this._$graceNoteTime;this._$graceNoteTime=t,e!==t&&this._propertyChanged("graceNoteTime",e,t)}},{key:"letVibrateDuration",get:function(){return this._$letVibrateDuration},set:function(t){var e=this._$letVibrateDuration;this._$letVibrateDuration=t,e!==t&&this._propertyChanged("letVibrateDuration",e,t)}},{key:"vibratoFrequency",get:function(){return this._$vibratoFrequency},set:function(t){var e=this._$vibratoFrequency;this._$vibratoFrequency=t,e!==t&&this._propertyChanged("vibratoFrequency",e,t)}},{key:"vibratoRange",get:function(){return this._$vibratoRange},set:function(t){var e=this._$vibratoRange;this._$vibratoRange=t,e!==t&&this._propertyChanged("vibratoRange",e,t)}},{key:"arpeggioMaxLength",get:function(){return this._$arpeggioMaxLength},set:function(t){var e=this._$arpeggioMaxLength;this._$arpeggioMaxLength=t,e!==t&&this._propertyChanged("arpeggioMaxLength",e,t)}},{key:"arpeggioMaxSkew",get:function(){return this._$arpeggioMaxSkew},set:function(t){var e=this._$arpeggioMaxSkew;this._$arpeggioMaxSkew=t,e!==t&&this._propertyChanged("arpeggioMaxSkew",e,t)}},{key:"tremoloInterval",get:function(){return this._$tremoloInterval},set:function(t){var e=this._$tremoloInterval;this._$tremoloInterval=t,e!==t&&this._propertyChanged("tremoloInterval",e,t)}},{key:"trillInterval",get:function(){return this._$trillInterval},set:function(t){var e=this._$trillInterval;this._$trillInterval=t,e!==t&&this._propertyChanged("trillInterval",e,t)}}],[{key:"dynamicVelocity",value:function(t){return t in e.DYNAMIC_VELOCITY_MAP?e.DYNAMIC_VELOCITY_MAP[t]:-1}}]),e}(),la={ppp:15,pp:31,p:47,mp:63,mf:79,f:95,ff:111,fff:127},ua=aa.TEMPO_LINE_RETURN_AT_A_TEMPO,ha=aa.FERMATA_NO_RITARD,ca=aa.CAESURA_TIME_BASED,da=aa.TEMPO_LINE_STATE_DEFAULT,fa=aa.TEMPO_RITARD_PERCENT_DEFAULT,ya=aa.TEMPO_ACCEL_PERCENT_DEFAULT,ga=aa.FERMATA_STATE_DEFAULT,pa=aa.FERMATA_PERCENT_DEFAULT,ma=aa.FERMATA_RITARD_LENGTH_BEATS_DEFAULT,va=aa.FERMATA_RITARD_LENGTH_TIME_DEFAULT,_a=aa.FERMATA_RITARD_PERCENT_DEFAULT,Sa=aa.CAESURA_STATE_DEFAULT,La=aa.CAESURA_LENGTH_BEATS_DEFAULT,ka=aa.CAESURA_LENGTH_TIME_DEFAULT;r.registerClass(aa,"com.noteflight.notation.metrics.PerformanceMetrics");var Ta=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$stripMarginLeft=0,t._$stripMarginTop=48,t._$stripMarginRight=8,t._$stripMarginBottom=55,t._$upcomingMeasureBackgroundColor=16777215,t._$upcomingMeasureBackgroundOpacity=1,t._$upcomingMeasureTextFont="Helvetica neue",t._$upcomingMeasureTextSize=11,t._$upcomingMeasureTextColor=12237222,t._$trackFlagX=1,t._$trackFlagY=1,t._$overlayOpacity=.9,t._$overlayColor=16777215,t}return c(e,At),p(e,[{key:"stripMarginLeft",get:function(){return this._$stripMarginLeft},set:function(t){var e=this._$stripMarginLeft;this._$stripMarginLeft=t,e!==t&&this._propertyChanged("stripMarginLeft",e,t)}},{key:"stripMarginTop",get:function(){return this._$stripMarginTop},set:function(t){var e=this._$stripMarginTop;this._$stripMarginTop=t,e!==t&&this._propertyChanged("stripMarginTop",e,t)}},{key:"stripMarginRight",get:function(){return this._$stripMarginRight},set:function(t){var e=this._$stripMarginRight;this._$stripMarginRight=t,e!==t&&this._propertyChanged("stripMarginRight",e,t)}},{key:"stripMarginBottom",get:function(){return this._$stripMarginBottom},set:function(t){var e=this._$stripMarginBottom;this._$stripMarginBottom=t,e!==t&&this._propertyChanged("stripMarginBottom",e,t)}},{key:"upcomingMeasureBackgroundColor",get:function(){return this._$upcomingMeasureBackgroundColor},set:function(t){var e=this._$upcomingMeasureBackgroundColor;this._$upcomingMeasureBackgroundColor=t,e!==t&&this._propertyChanged("upcomingMeasureBackgroundColor",e,t)}},{key:"upcomingMeasureBackgroundOpacity",get:function(){return this._$upcomingMeasureBackgroundOpacity},set:function(t){var e=this._$upcomingMeasureBackgroundOpacity;this._$upcomingMeasureBackgroundOpacity=t,e!==t&&this._propertyChanged("upcomingMeasureBackgroundOpacity",e,t)}},{key:"upcomingMeasureTextFont",get:function(){return this._$upcomingMeasureTextFont},set:function(t){var e=this._$upcomingMeasureTextFont;this._$upcomingMeasureTextFont=t,e!==t&&this._propertyChanged("upcomingMeasureTextFont",e,t)}},{key:"upcomingMeasureTextSize",get:function(){return this._$upcomingMeasureTextSize},set:function(t){var e=this._$upcomingMeasureTextSize;this._$upcomingMeasureTextSize=t,e!==t&&this._propertyChanged("upcomingMeasureTextSize",e,t)}},{key:"upcomingMeasureTextColor",get:function(){return this._$upcomingMeasureTextColor},set:function(t){var e=this._$upcomingMeasureTextColor;this._$upcomingMeasureTextColor=t,e!==t&&this._propertyChanged("upcomingMeasureTextColor",e,t)}},{key:"trackFlagX",get:function(){return this._$trackFlagX},set:function(t){var e=this._$trackFlagX;this._$trackFlagX=t,e!==t&&this._propertyChanged("trackFlagX",e,t)}},{key:"trackFlagY",get:function(){return this._$trackFlagY},set:function(t){var e=this._$trackFlagY;this._$trackFlagY=t,e!==t&&this._propertyChanged("trackFlagY",e,t)}},{key:"overlayOpacity",get:function(){return this._$overlayOpacity},set:function(t){var e=this._$overlayOpacity;this._$overlayOpacity=t,e!==t&&this._propertyChanged("overlayOpacity",e,t)}},{key:"overlayColor",get:function(){return this._$overlayColor},set:function(t){var e=this._$overlayColor;this._$overlayColor=t,e!==t&&this._propertyChanged("overlayColor",e,t)}}]),e}();r.registerClass(Ta,"com.noteflight.notation.metrics.StripMetrics");var Ea=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$username=null,t._$created=null,t._$lastModified=null,t._$text=null,t._$virgin=!1,t}return c(e,se),p(e,null,[{key:"PATH_PREFIX",get:function(){return"a"}}]),p(e,[{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.username=this.username,t.created=this.created,t.lastModified=this.lastModified,t.text=this.text,t}},{key:"username",get:function(){return this._$username},set:function(t){var e=this._$username;this._$username=t,e!==t&&this._propertyChanged("username",e,t)}},{key:"created",get:function(){return this._$created},set:function(t){var e=this._$created;this._$created=t,e!==t&&this._propertyChanged("created",e,t)}},{key:"lastModified",get:function(){return this._$lastModified},set:function(t){var e=this._$lastModified;this._$lastModified=t,e!==t&&this._propertyChanged("lastModified",e,t)}},{key:"text",get:function(){return this._$text},set:function(t){var e=this._$text;this._$text=t,e!==t&&this._propertyChanged("text",e,t)}},{key:"virgin",get:function(){return this._$virgin},set:function(t){var e=this._$virgin;this._$virgin=t,e!==t&&this._propertyChanged("virgin",e,t)}}]),e}();r.registerClass(Ea,"com.noteflight.notation.model.Annotation");var Ma=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).audioMedia=null,t._$trackStartTime=NaN,t._$mediaStartTime=NaN,t._$mediaEndTime=NaN,t}return c(e,se),p(e,[{key:"dispatchWaveformModelUpdateEvent",value:function(){this.part&&this.part.score&&this.part.score.dispatchEvent(new tn(tn.WAVEFORM_MODEL_UPDATE,this.part))}},{key:"handlePropertyChange",value:function(t){s(h(e.prototype),"handlePropertyChange",this).call(this,t),this.dispatchWaveformModelUpdateEvent()}},{key:"toMediaTime",value:function(t){return this.mediaStartTime+(t-this.trackStartTime)}},{key:"toTrackTime",value:function(t){return this.trackStartTime+(t-this.mediaStartTime)}},{key:"trackStartTime",get:function(){return this._$trackStartTime},set:function(t){var e=this._$trackStartTime;this._$trackStartTime=t,e!==t&&this._propertyChanged("trackStartTime",e,t)}},{key:"mediaStartTime",get:function(){return this._$mediaStartTime},set:function(t){var e=this._$mediaStartTime;this._$mediaStartTime=t,e!==t&&this._propertyChanged("mediaStartTime",e,t)}},{key:"mediaEndTime",get:function(){return this._$mediaEndTime},set:function(t){var e=this._$mediaEndTime;this._$mediaEndTime=t,e!==t&&this._propertyChanged("mediaEndTime",e,t)}},{key:"part",get:function(){return this.recordedAudioTrack?this.recordedAudioTrack.part:null}},{key:"recordedAudioTrack",get:function(){return A.as(this.parent,wl)}},{key:"duration",get:function(){return this.mediaEndTime-this.mediaStartTime}},{key:"trackEndTime",get:function(){return this.trackStartTime+this.duration}}]),e}();r.registerClass(Ma,"com.noteflight.notation.model.AudioClip");var ba=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$gain=0,t._$pan=0,t._$playbackEnabled=!0,t}return c(e,se),p(e,[{key:"togglePlayback",value:function(){this.playbackEnabled=!this.playbackEnabled}},{key:"selectPlayback",value:function(){this.playbackEnabled=!0}},{key:"dispatchWaveformModelUpdateEvent",value:function(){this.part&&this.part.score&&this.part.score.dispatchEvent(new tn(tn.WAVEFORM_MODEL_UPDATE,this.part))}},{key:"handlePropertyChange",value:function(t){s(h(e.prototype),"handlePropertyChange",this).call(this,t),this.dispatchWaveformModelUpdateEvent()}},{key:"remove",value:function(){this.part.removeChild(this),this.dispatchWaveformModelUpdateEvent()}},{key:"gain",get:function(){return this._$gain},set:function(t){var e=this._$gain;this._$gain=t,e!==t&&this._propertyChanged("gain",e,t)}},{key:"pan",get:function(){return this._$pan},set:function(t){var e=this._$pan;this._$pan=t,e!==t&&this._propertyChanged("pan",e,t)}},{key:"playbackEnabled",get:function(){return this._$playbackEnabled},set:function(t){var e=this._$playbackEnabled;this._$playbackEnabled=t,e!==t&&this._propertyChanged("playbackEnabled",e,t)}},{key:"part",get:function(){return A.as(this.parent,El)}},{key:"isSelected",get:function(){return this.playbackEnabled}}]),e}();r.registerClass(ba,"com.noteflight.notation.model.AudioTrack");var wa=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._uuid=Wd.generateUUID(),t._totalWeight=0,t._measure=null,t}return c(e,se),p(e,null,[{key:"PATH_PREFIX",get:function(){return"b"}},{key:"BEFORE_SYSTEM",get:function(){return"before"}},{key:"AFTER_SYSTEM",get:function(){return"after"}}]),p(e,[{key:"getColumnAt",value:function(t){return this.columns[t]}},{key:"addColumn",value:function(t){this.addChild(t),this._totalWeight+=t.weight}},{key:"getColumnRatio",value:function(t){return this.columns[t].weight/this.totalWeight}},{key:"accumulatedRatio",value:function(t){for(var e=0,i=0;i<t;i++)e+=this.columns[i].weight;return e/this.totalWeight}},{key:"dispatchModelUpdateEvent",value:function(t){s(h(e.prototype),"dispatchModelUpdateEvent",this).call(this,t),this.measure&&this.measure.dispatchModelUpdateEvent(t)}},{key:"totalColumns",get:function(){return this.columns.length}},{key:"totalWeight",get:function(){return this._totalWeight}},{key:"measure",get:function(){return this._measure},set:function(t){this._measure=t}},{key:"uuid",get:function(){return this._uuid}},{key:"columns",get:function(){return this._children}},{key:"hasColumnPositionedBeforeSystem",get:function(){for(var t=0;t<this.columns.length;t++)if(this.columns[t].position==xa.POSITION_BEFORE_SYSTEM)return!0;return!1}},{key:"hasColumnPositionedAfterSystem",get:function(){for(var t=0;t<this.columns.length;t++)if(this.columns[t].position==xa.POSITION_AFTER_SYSTEM)return!0;return!1}},{key:"text",get:function(){var t="",e=!0,i=!1,n=void 0;try{for(var r,o=this.columns[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){t+=r.value.text}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"path",get:function(){var t=this.measure;return null==t?"/":"".concat(t.path,"/").concat(e.PATH_PREFIX).concat(t.blocks.indexOf(this))}}]),e}();r.registerClass(wa,"com.noteflight.notation.model.Block");var xa=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.POSITION_AFTER_SYSTEM;return y(this,e),(n=l(this,h(e).call(this)))._$text=null,n._$weight=NaN,n.text=t,n.weight=i,n.position=r,n}return c(e,se),p(e,null,[{key:"POSITION_AFTER_SYSTEM",get:function(){return"after"}},{key:"POSITION_BEFORE_SYSTEM",get:function(){return"before"}}]),p(e,[{key:"block",get:function(){return this._parent}},{key:"text",get:function(){return this._$text},set:function(t){var e=this._$text;this._$text=t,e!==t&&this._propertyChanged("text",e,t)}},{key:"weight",get:function(){return this._$weight},set:function(t){var e=this._$weight;this._$weight=t,e!==t&&this._propertyChanged("weight",e,t)}},{key:"position",get:function(){return this._$position},set:function(t){var e=this._$position;this._$position=t,e!==t&&this._propertyChanged("position",e,t)}}]),e}();r.registerClass(xa,"com.noteflight.notation.model.BlockColumn");var Ca=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(t=l(this,h(e).call(this,A.numberToInt(i))))._$text=null,t._$fontStyle=null,t._$fontWeight=null,t._$justify=null,t._$textbox=!1,t.text=n,t.dy=r,t}return c(e,he),p(e,null,[{key:"EXPRESSION_TYPE",get:function(){return"expression"}},{key:"PERFORMANCE_TYPE",get:function(){return"performance"}},{key:"SYSTEM_TEXT_TYPE",get:function(){return"systemText"}},{key:"STYLE_ITALIC",get:function(){return"italic"}},{key:"WEIGHT_BOLD",get:function(){return"bold"}},{key:"JUSTIFY_CENTER",get:function(){return"center"}},{key:"JUSTIFY_RIGHT",get:function(){return"right"}},{key:"STARTING_TEXT_TO_ARTICULATION_TABLE",get:function(){return Na}}]),p(e,[{key:"customizationForView",value:function(t){for(var e=0;e<this.customizationsForViews.length;e++)if(this.customizationsForViews[e].viewId==t)return this.customizationsForViews[e];return null}},{key:"dxForViewId",value:function(t){var e=this.customizationForView(t);return e?e.dx:this.dx}},{key:"dyForViewId",value:function(t){var e=this.customizationForView(t);return e?e.dy:this.dy}},{key:"colorForViewId",value:function(t){var e=this.customizationForView(t);return e?e.color:this.color}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.text=this.text,t.fontStyle=this.fontStyle,t.fontWeight=this.fontWeight,t.justify=this.justify,t.textbox=this.textbox,t}},{key:"text",get:function(){return this._$text},set:function(t){var e=this._$text;this._$text=t,e!==t&&this._propertyChanged("text",e,t)}},{key:"fontStyle",get:function(){return this._$fontStyle},set:function(t){var e=this._$fontStyle;this._$fontStyle=t,e!==t&&this._propertyChanged("fontStyle",e,t)}},{key:"fontWeight",get:function(){return this._$fontWeight},set:function(t){var e=this._$fontWeight;this._$fontWeight=t,e!==t&&this._propertyChanged("fontWeight",e,t)}},{key:"justify",get:function(){return this._$justify},set:function(t){var e=this._$justify;this._$justify=t,e!==t&&this._propertyChanged("justify",e,t)}},{key:"textbox",get:function(){return this._$textbox},set:function(t){var e=this._$textbox;this._$textbox=t,e!==t&&this._propertyChanged("textbox",e,t)}},{key:"metrical",get:function(){return!0}},{key:"movable",get:function(){return!0}},{key:"symbol",get:function(){return!0}},{key:"showOnlyOnSystemStaff",get:function(){return!(!this.measure||!this.measure.isSystemMeasure)||s(h(e.prototype),"showOnlyOnSystemStaff",this)}},{key:"renderText",get:function(){return this.text}},{key:"isEmpty",get:function(){return/^\s*$/.test(this.text)}},{key:"marking",get:function(){return!0}},{key:"articulation",get:function(){var t=e.mapStartingTextToArticulation(this.text);return null!=t?new ed(t):null}},{key:"velocity",get:function(){return-1}}],[{key:"mapStartingTextToArticulation",value:function(t){if(null==t)return null;for(var i in e.STARTING_TEXT_TO_ARTICULATION_TABLE)if(t.match(e.STARTING_TEXT_TO_ARTICULATION_TABLE[i]))return i;return null}}]),e}(),Na={normal:/^arco/i,pizzicato:/^pizz/i,spiccato:/^spic/i};r.registerClass(Ca,"com.noteflight.notation.model.TextNotation");var Aa=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(t=l(this,h(e).call(this,i,n,r)))._$fretboard=null,t}return c(e,Ca),p(e,[{key:"transposeInterval",value:function(t){if(t.octaveMultiple)return this;var i=A.as(this.clone(),e);return i.text=e.transposeSymbol(this.text,t),i}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.fretboard=this.fretboard,t}},{key:"fretboard",get:function(){return this._$fretboard},set:function(t){var e=this._$fretboard;this._$fretboard=t,e!==t&&this._propertyChanged("fretboard",e,t)}},{key:"alignToStaffTop",get:function(){return!0}},{key:"paddingY",get:function(){return null==this.fretboard?this.score.effectiveStaffMetrics.chordSymbolPadding.y:this.score.effectiveStaffMetrics.chordFramePadding.y}},{key:"renderText",get:function(){return e.canonicalizeChord(this.text)}},{key:"hideChordSymbols",get:function(){return!!(this.measure&&this.measure.staff&&this.measure.staff.part)&&this.measure.staff.part.hideChordSymbols}},{key:"hideFretboards",get:function(){return!!(this.measure&&this.measure.staff&&this.measure.staff.part)&&this.measure.staff.part.hideFretboards}},{key:"transposedText",get:function(){return null==this.measure?this.text:e.transposeSymbol(this.text,this.measure.scoreInterval)},set:function(t){null!=this.measure?this.text=e.transposeSymbol(t,this.measure.scoreInterval.inverse()):this.text=t}}],[{key:"canonicalizeChord",value:function(t){return"{{"==t.slice(0,2)&&"}}"==t.slice(-2,t.length)?t.slice(2,-2):"("==t.charAt(0)&&")"==t.charAt(t.length-1)?"("+e.canonicalizeChord(t.substring(1,t.length-1))+")":t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/^([b=#]?)\^([0-9])$/,"$1&$2")).replace(/([A-Ga-g])bb/g,"$1%")).replace(/([A-Ga-g])##/g,"$1*")).replace(/([A-Ga-g])b/g,"$1@")).replace(/b(\d|[IiVv&]+)/g,"@$1")).replace(/=(\d|[IiVv&]+)/g,"$$$1")).replace(/(\/o)/g,"ø")).replace(/b$/,"@")).replace(/=$/,"$$")).replace(/b([ \/\r\n])/g,"@$1")).replace(/=([ \/\r\n])/g,"$$$1")).replace(/(([a-gA-G]|[@#]?[IiVv]+)[@#*%]?)o([\(\)@#\$0-9 \/\r\n,]|$)/,"$1°$3")).replace(/(([A-GNP]|[@#]?[IiVv]+)[@#*%]?)([a-zA-Z\-\+\u00B0\u00F8]*)([\(\)@#\$0-9 \/\r\n,a-z\-\+\u00B0]*[\)0-9])/g,"$1$3^$4^")).replace(/(sus)/gi,"^$1^")).replace(/([456])([239])/g,"$1 $2")).replace(/(([A-G]|[@#]?[IiVv]+)[@#*%]?)(MAJ|DIM|AUG)/g,"$1!$3!")).replace(/\^\^/g,"")).replace(/\u00F8/g,"^ø^")}},{key:"transposeSymbol",value:function(t,i){if(i.octaveMultiple||!t.match(/^\s*[A-G]/))return t;return t.replace(/([^a-zA-Z]|\b)([A-G][b#]?[b#]?)([mM]|maj|Maj|MAJ|min|Min|MIN|sus|Sus|SUS|dim|Dim|DIM|[oO]|[^a-zA-Z]|$)/g,function(t,n,r,o,s,a){return n+e.transposeTone(r,i)+o})}},{key:"transposeTone",value:function(t,e){for(var i=de.fromString(t).transposeInterval(e);i.alteration>1;)i=i.transposeInterval(new $a(1,0));for(;i.alteration<-1;)i=i.transposeInterval(new $a(-1,0));return kt.STEP_NAMES.charAt(i.step)+["bb","b","","#","##"][i.alteration+2]}},{key:"isFiguredBass",value:function(t){return null!=t.match(/^[0-9 \/@#%*\$\-\+\\\(][0-9 \/\r\n@#%*\$\-\+\\_\(\)]*$/)}}]),e}();r.registerClass(Aa,"com.noteflight.notation.model.ChordSymbol");var Ia=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y(this,t),this.measureIndex=e,this.afterBlockIndex=i,this.beforeBlockIndex=n,this.activeBlockType=r};r.registerClass(Ia,"com.noteflight.notation.model.ChunkElementIdentifier");var Pa=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return y(this,e),(t=l(this,h(e).call(this,i))).canBeCustomizedForView=!0,t}return c(e,he),p(e,null,[{key:"SYMBOL_HEIGHT",get:function(){return 2}}]),p(e,[{key:"metrical",get:function(){return!0}},{key:"movable",get:function(){return!0}},{key:"symbol",get:function(){return!0}},{key:"showOnlyOnSystemStaff",get:function(){return!0}},{key:"marking",get:function(){return!0}},{key:"alignToStaffTop",get:function(){return!0}},{key:"paddingY",get:function(){return-this.score.effectiveStaffMetrics.symbolOffset+this.score.effectiveStaffMetrics.symbolScale*e.SYMBOL_HEIGHT}}]),e}();r.registerClass(Pa,"com.noteflight.notation.model.SystemSymbol");var Oa=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return y(this,e),l(this,h(e).call(this,t))}return c(e,Pa),e}();r.registerClass(Oa,"com.noteflight.notation.model.Coda");var Qa=function(){function t(e,i,n,r){y(this,t),this.startVelocity=0,this.endVelocity=0,this.startPosition=0,this.endPosition=0,this.startIndex=0,this.endIndex=0,this.measureDurations=null,this.len=0,this.delta=0,this.startPosition=A.numberToInt(e.position),this.endPosition=A.numberToInt(e.endPosition.position),this.startIndex=A.intToUint(e.measure.index),this.endIndex=e.endPosition.measureIndex,this.len=A.numberToInt(e.span),this.startVelocity=r,this.endVelocity=this.lookAhead(e,n,e.type,this.startVelocity),this.delta=this.endVelocity-this.startVelocity,this.endIndex>this.startIndex&&(this.measureDurations=this.fillMeasureDurations(i))}return p(t,null,[{key:"DEFAULT_VELOCITY_CHANGE",get:function(){return 32}},{key:"MIN_END_VELOCITY",get:function(){return 15}}]),p(t,[{key:"getVelocityAt",value:function(t){return this.startVelocity+Math.ceil(this.delta*Math.max(0,Math.min(1,t/this.len)))}},{key:"lookAhead",value:function(e,i,n,r){var o=e.measure.staff,s=e.endPosition.measureIndex,a=2+s,l=Math.round(e.endPosition.position/4);t:for(var u=s;u<a;u++){var h=o.getMeasureAt(A.intToUint(u)),c=!0,d=!1,f=void 0;try{for(var y,g=xt.unknownForOfSource(i[u])[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=A.unknownToType(p,he);if(m.measure.staff==o&&!(u==s&&Math.round(m.position/4)<l)){if(A.is(m,Ra)){var v=A.unknownToType(m,Ra).velocity;if(v>0){if("crescendo"==n&&v>r)return v;if("diminuendo"==n&&v<r)return v}}if(A.is(m,Ua)&&m.measure==h)break t}}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}if(!h.flowsToNextMeasure)break}return"crescendo"==n?A.numberToInt(Math.min(r+t.DEFAULT_VELOCITY_CHANGE,td.MAX_VELOCITY)):"diminuendo"==n?A.numberToInt(Math.max(r-t.DEFAULT_VELOCITY_CHANGE,t.MIN_END_VELOCITY)):A.numberToInt(td.STANDARD_VELOCITY)}},{key:"overlapsNotation",value:function(t,e){if(this.startIndex==this.endIndex){if(e.position>this.startPosition&&e.position<this.endPosition)return!0}else{if(t==this.startIndex&&e.position>this.startPosition)return!0;if(t==this.endIndex&&e.position<this.endPosition)return!0;if(this.startIndex<t&&t<this.endIndex)return!0}return!1}},{key:"overlapsSpan",value:function(t){return!(t.measure.index>this.endIndex||t.measure.index==this.endIndex&&t.position>=this.endPosition||t.endPosition.measureIndex<this.startIndex||t.endPosition.measureIndex==this.startIndex&&t.endPosition.position<=this.startPosition)&&(this.startIndex>t.measure.index||this.startIndex==t.measure.index&&this.startPosition>=t.position)}},{key:"fillMeasureDurations",value:function(t){var e,i={};for(this.measureDurations=i,e=this.startIndex;e<this.endIndex;e++){var n=t.getMeasureAt(A.intToUint(e));i[e]=n.duration}return i}}]),t}();r.registerClass(Qa,"com.noteflight.notation.model.DynamicGradient");var Ra=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,Ca),p(e,[{key:"velocity",get:function(){return aa.dynamicVelocity(this.text)}},{key:"belowStaff",get:function(){return null!=this.measure&&null!=this.measure.effectiveClef&&this.dy<this.measure.effectiveClef.numLines}},{key:"paddingY",get:function(){return this.score.effectiveStaffMetrics.expressionTextPadding.y}}]),e}();r.registerClass(Ra,"com.noteflight.notation.model.ExpressionText");var Da=function(){function t(){y(this,t),this.strings=0,this.frets=0,this.firstFret=0,this.firstFretLocation=null,this.firstFretText=null,this.notes=[]}return p(t,null,[{key:"FIRST_FRET_LOCATION_RIGHT",get:function(){return"right"}},{key:"FIRST_FRET_LOCATION_LEFT",get:function(){return"left"}}]),p(t,[{key:"effectiveFirstFretText",get:function(){var t=this.firstFretText;return""===t&&(t=null),null==t&&this.firstFret>0&&(t=this.firstFret.toString()+"fr"),t}}]),t}();r.registerClass(Da,"com.noteflight.notation.model.Fretboard");var Fa=function t(){y(this,t),this.string=0,this.fret=0,this.hasFingering=!1,this.fingering=null,this.hasBarre=!1,this.barre=null};r.registerClass(Fa,"com.noteflight.notation.model.FretboardNote");var Ua=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,A.numberToInt(t))))._span=NaN,s._$endx=0,s._$ascent=0,s._$includeGrace=!0,s._$requiresDefaultInfo=!1,s._$requestValidate=0,s.defaultDirection=null,s._$type=null,s.includeGrace=i,s.span=n,s.endx=r,s.ascent=o,s}return c(e,he),p(e,null,[{key:"HAIRPIN_TYPE",get:function(){return"hairpin"}},{key:"SLUR_TYPE",get:function(){return"slur"}},{key:"LINE_TYPE",get:function(){return"line"}}]),p(e,[{key:"adjustSpan",value:function(t){this._span+=t}},{key:"setDefaultInfo",value:function(t){}},{key:"requestValidation",value:function(){this.requestValidate++}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.span=this.span,t.endx=this.endx,t.ascent=this.ascent,t.includeGrace=this.includeGrace,t}},{key:"endx",get:function(){return this._$endx},set:function(t){var e=this._$endx;this._$endx=t,e!==t&&this._propertyChanged("endx",e,t)}},{key:"ascent",get:function(){return this._$ascent},set:function(t){var e=this._$ascent;this._$ascent=t,e!==t&&this._propertyChanged("ascent",e,t)}},{key:"includeGrace",get:function(){return this._$includeGrace},set:function(t){var e=this._$includeGrace;this._$includeGrace=t,e!==t&&this._propertyChanged("includeGrace",e,t)}},{key:"requiresDefaultInfo",get:function(){return this._$requiresDefaultInfo},set:function(t){var e=this._$requiresDefaultInfo;this._$requiresDefaultInfo=t,e!==t&&this._propertyChanged("requiresDefaultInfo",e,t)}},{key:"requestValidate",get:function(){return this._$requestValidate},set:function(t){var e=this._$requestValidate;this._$requestValidate=t,e!==t&&this._propertyChanged("requestValidate",e,t)}},{key:"type",get:function(){return this._$type},set:function(t){var e=this._$type;this._$type=t,e!==t&&this._propertyChanged("type",e,t)}},{key:"span",get:function(){return this._span},set:function(t){var e=t;this._span=t;var i=new Di(Di.MODEL_UPDATE,"span",e,t,this);this.dispatchModelUpdateEvent(i)}},{key:"metrical",get:function(){return!0}},{key:"movable",get:function(){return!0}},{key:"affectsParentLayout",get:function(){return!1}},{key:"transposable",get:function(){return!1}},{key:"affectsEntirePart",get:function(){return!1}},{key:"canStartAtBarline",get:function(){return!1}},{key:"canEndAtBarline",get:function(){return!1}},{key:"endPosition",get:function(){var t=this.measure.staff.score;return null!=t?t.offsetPosition(this.measurePosition,this.span,this.canEndAtBarline):new gl(A.intToUint(this.measure.index),0)}},{key:"top",get:function(){return Math.max(this.dy,this.dy+this.ascent)}},{key:"bottom",get:function(){return Math.min(this.dy,this.dy+this.ascent)}},{key:"belowStaff",get:function(){return null!=this.measure&&null!=this.measure.effectiveClef&&this.dy<this.measure.effectiveClef.numLines}}]),e}();r.registerClass(Ua,"com.noteflight.notation.model.SpanNotation");var Va=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.CRESCENDO,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return y(this,e),(t=l(this,h(e).call(this,i,n,r,s,a))).type=o,t}return c(e,Ua),p(e,null,[{key:"CRESCENDO",get:function(){return"crescendo"}},{key:"DIMINUENDO",get:function(){return"diminuendo"}}]),p(e,[{key:"setDefaultInfo",value:function(t){t.empty||(this.dx=t.startNoteWidth,this.endx=t.endNoteWidth)}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.type=this.type,t}}],[{key:"createHairpin",value:function(t,i){var n=new e(0,!0,0,t,0,0);return n.dy=i.hairpinPadding.y,n}}]),e}();r.registerClass(Va,"com.noteflight.notation.model.Hairpin");var Ba=function t(){y(this,t)};r.registerClass(Ba,"com.noteflight.notation.model.IRhythmContainer");var Ha=function t(){y(this,t)};r.implementsInterfaces(Ha,[Ba,le]),r.registerClass(Ha,"com.noteflight.notation.model.IRhythmContext");var $a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this._steps=0,this._pitches=0,this._steps=e,this._pitches=i}return p(t,[{key:"add",value:function(e){return new t(this.steps+e.steps,this.pitches+e.pitches)}},{key:"normalize",value:function(){return new t(this.stepClass,this.intervalClass)}},{key:"normalizeTritone",value:function(){return 6==this.intervalClass&&4==this.stepClass?new t(this.steps-1,this.pitches):this}},{key:"abs",value:function(){return new t(A.numberToInt(Math.abs(this._steps)),A.numberToInt(Math.abs(this._pitches)))}},{key:"inverse",value:function(){return new t(-this.steps,-this.pitches)}},{key:"toString",value:function(){return this.steps.toString()+":"+this.pitches.toString()}},{key:"steps",get:function(){return this._steps}},{key:"pitches",get:function(){return this._pitches}},{key:"unison",get:function(){return 0===this._steps&&0===this._pitches}},{key:"octaveMultiple",get:function(){return Math.abs(this._steps)%7==0&&Math.abs(this._pitches)%12==0}},{key:"fifths",get:function(){for(var t=this.abs().normalize(),e=de.LEAST_FIFTHS[t.pitches],i=t.steps-de.LEAST_FIFTHS_STEPS[t.pitches];i>3;)i-=7;for(;i<-3;)i+=7;return e-=12*i,this._pitches>=0&&this._steps>=0?e:-e}},{key:"stepClass",get:function(){for(var t=this._steps;t<0;)t+=7;for(;t>=7;)t-=7;return t}},{key:"intervalClass",get:function(){for(var t=this._pitches;t<0;)t+=12;for(;t>=12;)t-=12;return t}}],[{key:"fromPitches",value:function(e){var i=Math.floor(Math.abs(e)/12),n=A.numberToInt(Math.abs(e)%12),r=de.LEAST_FIFTHS_STEPS[n]+7*i;return e<0&&(r=-r),new t(r,e)}},{key:"fromString",value:function(e){var i=e.split(":");return new t(A.unknownToInt(i[0]),A.unknownToInt(i[1]))}}]),t}();r.registerClass($a,"com.noteflight.notation.model.Interval");var Ga=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return y(this,e),(t=l(this,h(e).call(this,0)))._$fifths=0,t._$cancel=0,t._$atonal=!1,t._$mode=null,t.enharmonicDistance=0,t.fifths=i,t.cancel=n,t.atonal=r,t.mode=o,t}return c(e,he),p(e,null,[{key:"MODE_FIFTHS",get:function(){return Ya}},{key:"SHARP_KEY_NAMES",get:function(){return za}},{key:"FLAT_KEY_NAMES",get:function(){return Wa}},{key:"SHARP_FIFTHS",get:function(){return Xa}}]),p(e,[{key:"equals",value:function(t){return t==this||t.fifths==this.fifths}},{key:"getAlteration",value:function(t){return this.fifths>0?e.SHARP_FIFTHS[t]<=this.fifths?1:0:this.fifths<0&&e.SHARP_FIFTHS[t]-8>=this.fifths?-1:0}},{key:"getTranspositions",value:function(){for(var t=[],e=0;e<12;e++)t.push(this.transposeFifths($a.fromPitches(e).normalizeTritone().fifths));return t}},{key:"getNoteForPitch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new de(t);if(null!=e&&t.ordinal==e.pitch.ordinal)return i.step=e.step,i;if(i.alteration==this.getAlteration(A.intToUint(i.step)))return i;var n=i.step;if(this.fifths<0){if(i.step=(i.step+1)%7,i.alteration==this.getAlteration(A.intToUint(i.step)))return i}else if(this.fifths>0&&(i.step=(i.step-1+7)%7,i.alteration==this.getAlteration(A.intToUint(i.step))))return i;if(i.step=n,null!=e){var r=t.ordinal-e.pitch.ordinal;if(-1==r||1==r){var o=Math.abs(i.alteration),s=A.intToUint(i.step);i.step=(e.step+r+7)%7;var a=Math.abs(i.alteration);!(i.alteration==this.getAlteration(A.intToUint(i.step)))&&o<a&&(i.step=s),i.normalizeAlteration(1)}else{var l=A.as(i.clone(),de),u=A.as(e.clone(),de),h=new Sn;h.addNote(l),h.addNote(u),h.normalizeSpelling(this),u.step==e.step?i.step=l.step:u.alteration<=-1&&l.alteration<=-1&&(u.step+6)%7==e.step?i.step=(l.step+6)%7:u.alteration>=1&&l.alteration>=1&&(u.step+1)%7==e.step&&(i.step=(l.step+1)%7)}}return i}},{key:"transposeFifths",value:function(t){if(this.atonal||0===t)return this;var i=A.as(this.clone(),e);for(i.fifths+=t;i.fifths>7;)i.fifths-=12,i.enharmonicDistance+=1;for(;i.fifths<-7;)i.fifths+=12,i.enharmonicDistance-=1;for(i.cancel+=t;i.cancel>7;)i.cancel-=12;for(;i.cancel<-7;)i.cancel+=12;return i}},{key:"transposeByInterval",value:function(t){var e=7*t%12;return this.transposeFifths(e)}},{key:"minimize",value:function(){return-7==this.fifths?this.transposeFifths(12):7==this.fifths?this.transposeFifths(-12):this}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.fifths=this.fifths,t.cancel=this.cancel,t.atonal=this.atonal,t.mode=this.mode,t}},{key:"fifths",get:function(){return this._$fifths},set:function(t){var e=this._$fifths;this._$fifths=t,e!==t&&this._propertyChanged("fifths",e,t)}},{key:"cancel",get:function(){return this._$cancel},set:function(t){var e=this._$cancel;this._$cancel=t,e!==t&&this._propertyChanged("cancel",e,t)}},{key:"atonal",get:function(){return this._$atonal},set:function(t){var e=this._$atonal;this._$atonal=t,e!==t&&this._propertyChanged("atonal",e,t)}},{key:"mode",get:function(){return this._$mode},set:function(t){var e=this._$mode;this._$mode=t,e!==t&&this._propertyChanged("mode",e,t)}},{key:"tonic",get:function(){if(null==this.mode)return null;var t=this.fifths-e.MODE_FIFTHS[this.mode];return t>=0?e.SHARP_KEY_NAMES[t]:e.FLAT_KEY_NAMES[-t]}}]),e}(),Ya={major:0,minor:-3,ionian:0,dorian:-2,phrygian:-4,lydian:1,mixolydian:-1,aeolian:-3,locrian:-5},za=["C","G","D","A","E","B","F#","C#","G#","D#","A#","E#","B#"],Wa=["C","F","Bb","Eb","Ab","Db","Gb","Cb","Fb","Bbb","Ebb","Abb"],Xa=[2,4,6,1,3,5,7];r.registerClass(Ga,"com.noteflight.notation.model.KeySignature");var Ka=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(t=l(this,h(e).call(this,i,n,r))).alignToLeftEdge=!1,t.enabled=!1,t}return c(e,Ca),p(e,[{key:"alignToStaffTop",get:function(){return!0}}]),e}();r.registerClass(Ka,"com.noteflight.notation.model.LabelNotation");var ja=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(this,e),(n=l(this,h(e).call(this,t,i.measureNumber.toString(),0)))._measure=i,n.enabled=!0,n.invisibleText=r.invisible||!1,n}return c(e,Ka),p(e,[{key:"text",get:function(){return this.invisibleText?"":this._measure.measureNumber.toString()},set:function(t){var e=this._$text;this._$text=t,""==t&&(this.invisibleText=!0),e!==t&&this._propertyChanged("text",e,t)}}]),e}();r.registerClass(ja,"com.noteflight.notation.model.MeasureNumberNotation");var qa=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.TYPE_DEFAULT,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return y(this,e),(t=l(this,h(e).call(this,i,n,r,s,a)))._$startingText="",t._$bracketLength=0,t.type=o,t.startingText=u,t.bracketLength=c,t}return c(e,Ua),p(e,null,[{key:"TYPE_DEFAULT",get:function(){return"default"}},{key:"TYPE_OCTAVE_UP",get:function(){return"octaveUp"}},{key:"TYPE_OCTAVE_DOWN",get:function(){return"octaveDown"}},{key:"TYPE_TWO_OCTAVES_UP",get:function(){return"twoOctavesUp"}},{key:"TYPE_LET_VIBRATE",get:function(){return"letVibrate"}},{key:"TYPE_NON_VIBRATO",get:function(){return"nonVibrato"}},{key:"TYPE_CRESCENDO",get:function(){return"crescendo"}},{key:"TYPE_VIBRATO",get:function(){return"vibrato"}},{key:"TYPE_DIMINUENDO",get:function(){return"diminuendo"}},{key:"TYPE_TRILL",get:function(){return"trill"}},{key:"TYPE_PALM_MUTE",get:function(){return"palmMute"}},{key:"TYPE_RITARDANDO",get:function(){return"ritardando"}},{key:"TYPE_ACCELERANDO",get:function(){return"accelerando"}},{key:"TYPE_PEDAL",get:function(){return"pedal"}},{key:"TYPE_SOLID",get:function(){return"solid"}},{key:"TYPE_SOLID_BRACKET_DOWN",get:function(){return"solidBracketDown"}},{key:"TYPE_SOLID_BRACKET_MIDDLE",get:function(){return"solidBracketMiddle"}},{key:"TYPE_SOLID_BRACKET_UP",get:function(){return"solidBracketUp"}},{key:"TYPE_DASHED",get:function(){return"dashed"}},{key:"TYPE_DASHED_FINAL_DOWN",get:function(){return"dashedFinalDown"}},{key:"TYPE_DASHED_FINAL_MIDDLE",get:function(){return"dashedFinalMiddle"}},{key:"TYPE_DASHED_FINAL_UP",get:function(){return"dashedFinalUp"}},{key:"TYPE_MULTIREST",get:function(){return"multirest"}},{key:"ITALIC_TEXT",get:function(){return Ja}},{key:"ALLOW_ASCENT",get:function(){return Za}},{key:"DEFAULT_POSITION_BELOW_STAFF",get:function(){return tl}},{key:"VOCAL_STAFF_ABOVE_STAFF",get:function(){return el}},{key:"DEFAULT_DX",get:function(){return il}},{key:"DEFAULT_ENDX",get:function(){return nl}},{key:"BOTTOM_PADDING",get:function(){return rl}},{key:"STARTING_TEXT_TO_TYPE_TABLE",get:function(){return ol}}]),p(e,[{key:"defaultPositionAboveStaff",value:function(t){return!!(e.VOCAL_STAFF_ABOVE_STAFF.indexOf(this.type)>-1&&t.part.directionsAboveStaff)||-1==e.DEFAULT_POSITION_BELOW_STAFF.indexOf(this.type)}},{key:"setDefaultInfo",value:function(t){t.empty||(e.DEFAULT_DX.hasOwnProperty(this.type)?this.dx=e.DEFAULT_DX[this.type]:this.dx=t.startNoteWidth,e.DEFAULT_ENDX.hasOwnProperty(this.type)?this.endx=e.DEFAULT_ENDX[this.type]:this.endx=0,this.span=t.startEndSpan)}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.type=this.type,t.startingText=this.startingText,t.bracketLength=this.bracketLength,t}},{key:"startingText",get:function(){return this._$startingText},set:function(t){var e=this._$startingText;this._$startingText=t,e!==t&&this._propertyChanged("startingText",e,t)}},{key:"bracketLength",get:function(){return this._$bracketLength},set:function(t){var e=this._$bracketLength;this._$bracketLength=t,e!==t&&this._propertyChanged("bracketLength",e,t)}},{key:"affectsEntirePart",get:function(){return this.type==e.TYPE_PEDAL}},{key:"allowAscent",get:function(){return-1!=e.ALLOW_ASCENT.indexOf(this.type)}},{key:"isBold",get:function(){return!1}},{key:"isItalic",get:function(){return-1!=e.ITALIC_TEXT.indexOf(this.type)}},{key:"top",get:function(){return this.allowAscent?0:s(h(e.prototype),"top",this)}},{key:"bottom",get:function(){return null!=e.BOTTOM_PADDING[this.type]?s(h(e.prototype),"bottom",this)-e.BOTTOM_PADDING[this.type]:this.allowAscent?0:s(h(e.prototype),"bottom",this)}},{key:"canStartAtBarline",get:function(){return!1}},{key:"canEndAtBarline",get:function(){return!0}}],[{key:"createLineNotation",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=A.unknownToType(t==e.TYPE_TRILL?new Wl(0,0,t):new e(0,!0,0,t),e);return null!=n&&(r.startingText=n),r}},{key:"mapStartingTextToType",value:function(t){for(var i in e.STARTING_TEXT_TO_TYPE_TABLE)if(t.match(e.STARTING_TEXT_TO_TYPE_TABLE[i]))return i;return e.TYPE_DEFAULT}},{key:"_staticInitializer",value:function(){e.DEFAULT_DX[e.TYPE_OCTAVE_UP]=-.75,e.DEFAULT_ENDX[e.TYPE_OCTAVE_UP]=1,e.DEFAULT_DX[e.TYPE_OCTAVE_DOWN]=-.75,e.DEFAULT_ENDX[e.TYPE_OCTAVE_DOWN]=1,e.DEFAULT_DX[e.TYPE_LET_VIBRATE]=-.5,e.DEFAULT_ENDX[e.TYPE_LET_VIBRATE]=1,e.DEFAULT_DX[e.TYPE_TRILL]=-.4,e.DEFAULT_ENDX[e.TYPE_TRILL]=0,e.DEFAULT_DX[e.TYPE_VIBRATO]=-.25,e.DEFAULT_ENDX[e.TYPE_VIBRATO]=2,e.DEFAULT_DX[e.TYPE_CRESCENDO]=0,e.DEFAULT_ENDX[e.TYPE_CRESCENDO]=1.5,e.DEFAULT_DX[e.TYPE_DIMINUENDO]=0,e.DEFAULT_ENDX[e.TYPE_DIMINUENDO]=1.5,e.DEFAULT_DX[e.TYPE_ACCELERANDO]=0,e.DEFAULT_ENDX[e.TYPE_ACCELERANDO]=1.5,e.DEFAULT_DX[e.TYPE_RITARDANDO]=0,e.DEFAULT_ENDX[e.TYPE_RITARDANDO]=1.5,e.DEFAULT_DX[e.TYPE_PEDAL]=-1,e.DEFAULT_ENDX[e.TYPE_PEDAL]=1.5,e.DEFAULT_DX[e.TYPE_SOLID]=0,e.DEFAULT_ENDX[e.TYPE_SOLID]=1.5,e.DEFAULT_DX[e.TYPE_DASHED]=0,e.DEFAULT_ENDX[e.TYPE_DASHED]=2,e.BOTTOM_PADDING[e.TYPE_PEDAL]=1.5}}]),e}(),Ja=[qa.TYPE_LET_VIBRATE,qa.TYPE_PALM_MUTE,qa.TYPE_CRESCENDO,qa.TYPE_DIMINUENDO],Za=[qa.TYPE_SOLID,qa.TYPE_SOLID_BRACKET_DOWN,qa.TYPE_SOLID_BRACKET_UP,qa.TYPE_DASHED],tl=[qa.TYPE_PEDAL,qa.TYPE_OCTAVE_DOWN,qa.TYPE_CRESCENDO,qa.TYPE_DIMINUENDO],el=[qa.TYPE_CRESCENDO,qa.TYPE_DIMINUENDO,qa.TYPE_LET_VIBRATE],il={},nl={},rl={},ol={octaveUp:/^8|8va/i,twoOctavesUp:/^15ma|15/i,octaveDown:/^8|8vb|8va bassa/i,trill:/^tr.?/i,diminuendo:/^dim.*/i,crescendo:/^cresc.*/i,letVibrate:/^lv|l\.v\.|let ring/i,nonVibrato:/^nv|n\.v\.|non vib.*/i,palmMute:/^pm|p\.m\.|palm mute.*/i,ritardando:/^rit.*/i,accelerando:/^accel.*/i};qa._staticInitializer(),r.registerClass(qa,"com.noteflight.notation.model.LineNotation");var sl=/^(([0-9\- ]+)\.?(, *[0-9\- ]+)*)\.$/,al=/^(([0-9\-]+)\.?)+\.?$/g,ll=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.TYPE_ENDING_INITIAL,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return y(this,e),(t=l(this,h(e).call(this,i,!1,n,r,o,0,s,a))).bold=u,t.canBeCustomizedForView=!0,t}return c(e,qa),p(e,null,[{key:"isValidText",value:function(t){return!!e.normalizeText(t).match(e.REPEAT_ENDING_REGEXP)}},{key:"normalizeText",value:function(t){return t.replace(/[, ]/g,".").replace(/\.+/g,".").replace(/\.$/,"")}},{key:"TYPE_INITIAL",get:function(){return"endingInitial"}},{key:"TYPE_FINAL",get:function(){return"endingFinal"}},{key:"LEGACY_REPEAT_ENDING_REGEXP",get:function(){return sl}},{key:"REPEAT_ENDING_REGEXP",get:function(){return al}}]),p(e,[{key:"affectsParentLayout",get:function(){return!0}},{key:"canStartAtBarline",get:function(){return!0}},{key:"isBold",get:function(){return this.bold}},{key:"numbers",get:function(){var t=e.normalizeText(this.startingText);return e.isValidText(t)?e.normalizeText(t).split("."):this.type==e.TYPE_INITIAL?["1"]:["2"]}}]),e}();r.registerClass(ll,"com.noteflight.notation.model.RepeatEnding");var ul=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return y(this,e),(t=l(this,h(e).call(this)))._$text=null,t._$line=0,t._$continued=!1,t._$noninitial=!1,t._$extend=!1,t.text=i,t.line=n,t.continued=r,t.extend=o,t.noninitial=s,t.direction=a,t}return c(e,ce),p(e,[{key:"equals",value:function(t){return this.text==t.text&&this.line==t.line&&this.continued==t.continued&&this.extend==t.extend&&this.noninitial==t.noninitial&&this.direction==t.direction}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.text=this.text,t.line=this.line,t.continued=this.continued,t.extend=this.extend,t.noninitial=this.noninitial,t}},{key:"text",get:function(){return this._$text},set:function(t){var e=this._$text;this._$text=t,e!==t&&this._propertyChanged("text",e,t)}},{key:"line",get:function(){return this._$line},set:function(t){var e=this._$line;this._$line=t,e!==t&&this._propertyChanged("line",e,t)}},{key:"continued",get:function(){return this._$continued},set:function(t){var e=this._$continued;this._$continued=t,e!==t&&this._propertyChanged("continued",e,t)}},{key:"noninitial",get:function(){return this._$noninitial},set:function(t){var e=this._$noninitial;this._$noninitial=t,e!==t&&this._propertyChanged("noninitial",e,t)}},{key:"extend",get:function(){return this._$extend},set:function(t){var e=this._$extend;this._$extend=t,e!==t&&this._propertyChanged("extend",e,t)}},{key:"metrical",get:function(){return!0}}]),e}();r.registerClass(ul,"com.noteflight.notation.model.Lyric");var hl=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).id=Qg.uuid(),t._$timeSignature=null,t._$keySignature=null,t._$tempo=null,t._$clef=null,t._$breakType=null,t._$startRepeat=!1,t._$endRepeat=!1,t._$layoutWeight=1,t._$canHideStaff=!1,t._$disableCautionaries=!1,t._$leftMargin=0,t._$rightMargin=0,t._$systemGap=!1,t._blocks=[],t._measureNotations=null,t._spanNotations=null,t._systemMeasure=null,t._accidentalCleanup=Hy.MAX_VALUE,t._clefCleanup=!1,t._liaisonCleanup=!1,t._restCleanup=!1,t._stringAssignmentCleanup=!1,t._seenLyrics=!1,t._mmrInitialized=!1,t._cachedAutoMMRCandidate=!1,t._$measureNumber=0,t.isMeasureNumberCustomized=!1,t._cachedMeasureNumber=-1,t._measureNotations=[],t._spanNotations=[],t.addChild(new Kl),t.addChild(new Kl),t}return c(e,se),p(e,null,[{key:"PAGE_BREAK_TYPE",get:function(){return"page"}},{key:"SYSTEM_BREAK_TYPE",get:function(){return"system"}},{key:"KEEP_WITH_NEXT_TYPE",get:function(){return"keepWithNext"}},{key:"FORCE_NO_BREAK",get:function(){return"noBreak"}},{key:"MULTI_REST_NONE",get:function(){return 0}},{key:"MULTI_REST_BODY",get:function(){return-1}},{key:"MULTI_REST_END",get:function(){return-2}},{key:"FORM_DS",get:function(){return"ds"}},{key:"FORM_DC",get:function(){return"dc"}},{key:"FORM_DS_AL_FINE",get:function(){return"dsfine"}},{key:"FORM_DC_AL_FINE",get:function(){return"dcfine"}},{key:"FORM_DS_AL_CODA",get:function(){return"dscoda"}},{key:"FORM_DC_AL_CODA",get:function(){return"dccoda"}},{key:"FORM_DS_AL_SEGNO",get:function(){return"dssegno"}},{key:"FORM_DC_AL_SEGNO",get:function(){return"dcsegno"}},{key:"FORM_SEGNO",get:function(){return"segno"}},{key:"FORM_TO_CODA",get:function(){return"tocoda"}},{key:"FORM_CODA",get:function(){return"coda"}},{key:"FORM_FINE",get:function(){return"fine"}},{key:"FORMAL_ELEMENTS",get:function(){return cl}},{key:"STARTING_FORMAL_ELEMENTS",get:function(){return dl}}]),p(e,[{key:"clearMeasureNumberCache",value:function(){this._cachedMeasureNumber=-1,this.nextMeasure&&this.nextMeasure.clearMeasureNumberCache()}},{key:"resetMeasureNumber",value:function(){this._cachedMeasureNumber=-1,this.isMeasureNumberCustomized=!1;var t=this._$measureNumber;this._$measureNumber=0,this.nextMeasure&&this.nextMeasure.resetMeasureNumber(),this._propertyChanged("measureNumber",t,0)}},{key:"getMeasureIndexAfterSpan",value:function(t){return t>this.duration&&this.nextMeasure?this.nextMeasure.getMeasureIndexAfterSpan(t-this.duration):this.index}},{key:"addBlock",value:function(t){var e=this._blocks.slice();e.push(t),this.blocks=e}},{key:"getBlockAt",value:function(t){return this.blocks.length-1>=t?this.blocks[t]:null}},{key:"removeBlock",value:function(t){var e=this._blocks.slice(),i=0,n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){if(s.value.uuid==t.uuid)return e.splice(i,1),void(this.blocks=e);i+=1}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"getVoiceAt",value:function(t){return A.as(this.getChildAt(A.intToUint(t)),Kl)}},{key:"getVoiceNumber",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.numVoices<=t&&e;)this.addChild(new Kl);return A.as(this.getChildAt(A.intToUint(t+1)),Kl)}},{key:"removeVoiceNumber",value:function(t){this.removeChildAt(A.intToUint(t+1))}},{key:"addChildAt",value:function(t,i){s(h(e.prototype),"addChildAt",this).call(this,t,i),this.initializeDerivedState()}},{key:"doRemoveChildAt",value:function(t){s(h(e.prototype),"doRemoveChildAt",this).call(this,t),this.initializeDerivedState()}},{key:"addElement",value:function(t,e){this.getVoiceNumber(e,!0).addElement(t)}},{key:"removeElement",value:function(t){t.rhythmContext.removeElement(t)}},{key:"removeCustomizationForViews",value:function(){for(var t=0;t<this.measureElements.length;t++)this.measureElements[t].customizationsForViews=[]}},{key:"defaultTransposableSpans",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=A.unknownToType(t&&null!=this.staff?this.staff.getSpanNotations(this.index):this.spanNotations,Array),i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Ua);l.transposable&&(l.requiresDefaultInfo=!0)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"convertDanglingSlursToTies",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.spanNotations.slice()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,Ua);if(A.is(s,Ol)){var a=A.unknownToType(s,Ol),l=a.voice.noteSetAtPosition(a.position);if(null!=l&&!l.grace){var u=this,h=function(t,e){null==t.getModelProperty(e)?(a.parent.removeChild(a),t.setModelProperty(e,de.TIE_LIAISON)):a.preventDurationDefault=!0},c=function(t){var e,i=l.notes.length>0?l.getNoteAt(0):null,n=!0,r=!1,o=void 0;try{for(var s,c=l.notes[Symbol.iterator]();!(n=(s=c.next()).done);n=!0)if(null==(e=s.value).getModelProperty(t)&&(i=e,null!=a.defaultDirection&&Math.abs(u.getScoreNoteY(e)-a.noteY)<=.5))return void h(i,t)}catch(t){r=!0,o=t}finally{try{n||null==c.return||c.return()}finally{if(r)throw o}}null!=i&&h(i,t)};0===a.span&&0===a.position&&u.allowIncomingLiaisons?c("incomingLiaison"):a.span<=l.duration&&a.position+l.duration==this.duration&&!this.flowsToNextMeasure&&c("liaison")}}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"getNotationAt",value:function(t){return A.as(this._measureNotations[t],he)}},{key:"hasArticulation",value:function(t){var e=this.followingNoteSets(0),i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(A.unknownToType(a,Sn).hasArticulation(t))return!0}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return!1}},{key:"notationAtPosition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Hy.MAX_VALUE,n=!0,r=!1,o=void 0;try{for(var s,a=this.measureNotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,he);if(u.position>t)break;if(A.is(u,e)&&u.position==t&&(i==Hy.MAX_VALUE||i==u.voiceNumber))return u}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return null}},{key:"previousNotationInMeasure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;null!=e&&(n=e);for(var r=n.measureNotations.length-1;r>=0;r--){var o=n.getNotationAt(r);if(o.position<t&&(null==i||i(o)))return o}return null}},{key:"previousNotation",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.index;n>=0;){var r=this.staff.getMeasureAt(A.intToUint(n));n<this.index&&(t=r.duration+1);var o=this.previousNotationInMeasure(t,r,e);if(o)return o;if(!i)break;n--}return null}},{key:"nextNotation",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.index;n<this.staff.measures.length;){var r=this.staff.getMeasureAt(A.intToUint(n));n>this.index&&(t=-1);for(var o=0;o<r.measureNotations.length;o++){var s=r.getNotationAt(o);if(s.position>t&&(null==e||e(s)))return s}if(!i)break;n++}return null}},{key:"precedingNoteSets",value:function(t){this.index;var e=[],i=this;if(0===t){if(0===this.index)return e;t=(i=this.staff.getMeasureAt(A.intToUint(this.index-1))).duration}for(var n=0;n<i.numVoices;n++)for(var r=i.measureNotations.length-1;r>=0;r--){var o=A.as(i.getNotationAt(r),Sn);if(null!=o&&o.voiceNumber==n)if(o.endsAtPosition(t))e.push(o);else if(o.position+o.duration<t)break}return e}},{key:"followingNoteSets",value:function(t){this.index;var e=[],i=this;if(t==i.duration){if(this.index==this.staff.measures.length-1)return e;i=this.staff.getMeasureAt(A.intToUint(this.index+1)),t=0}for(var n=0;n<i.numVoices;n++)for(var r=0;r<i.measureNotations.length;r++){var o=A.as(i.getNotationAt(r),Sn);if(null!=o&&o.voiceNumber==n)if(o.startsAtPosition(t))e.push(o);else if(o.position>t)break}return e}},{key:"getNotatedClefAtMeasurePosition",value:function(t){for(var e=this.clef,i=0;i<this.measureNotations.length;i++){var n=this.getNotationAt(i);if(n.position>t)break;A.is(n,Mn)&&(e=A.as(n,Mn))}return e}},{key:"getEffectiveClefAtMeasurePosition",value:function(t){return this.overrideClef||this.getNotatedClefAtMeasurePosition(t)}},{key:"getLiaisonStart",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;i<0&&(i=e.voiceNumber);var n,r,o,s=this.precedingNoteSets(t);if(i>=0){var a=!0,l=!1,u=void 0;try{for(var h,c=s[Symbol.iterator]();!(a=(h=c.next()).done);a=!0)if(o=h.value,(n=A.unknownToType(o,Sn)).voiceNumber==i&&null!=(r=this.liaisonStartNote(n,e)))return r}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}var d=!0,f=!1,y=void 0;try{for(var g,p=s[Symbol.iterator]();!(d=(g=p.next()).done);d=!0)if(o=g.value,(n=A.unknownToType(o,Sn)).voiceNumber!=i&&null!=(r=this.liaisonStartNote(n,e)))return r}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}return null}},{key:"liaisonStartNote",value:function(t,e){var i=this.findTieMatch(t,e);if(null!=i&&i.tied)return i;if(e.stringIndex>=0)i=t.noteOnString(e.stringIndex);else{var n=e.noteIndex;if(n<0||n>=t.notes.length)return null;i=t.getNoteAt(n)}return null!=i&&i.hasIndexLiaison?i:null}},{key:"getLiaisonEnd",value:function(t){var e,i,n,r=t.noteSet.position+t.noteSet.duration,o=t.voiceNumber,s=this.followingNoteSets(r);if(o>=0){var a=!0,l=!1,u=void 0;try{for(var h,c=s[Symbol.iterator]();!(a=(h=c.next()).done);a=!0)if(n=h.value,(i=A.unknownToType(n,Sn)).voiceNumber==o&&null!=(e=this.liaisonEndNote(i,t)))return e}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}var d=!0,f=!1,y=void 0;try{for(var g,p=s[Symbol.iterator]();!(d=(g=p.next()).done);d=!0)if(n=g.value,(i=A.unknownToType(n,Sn)).voiceNumber!=o&&null!=(e=this.liaisonEndNote(i,t)))return e}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}return null}},{key:"liaisonEndNote",value:function(t,e){if(e.tied)return this.findTieMatch(t,e);if(e.hasIndexLiaison){if(e.stringIndex>=0)return t.noteOnString(e.stringIndex);var i=e.noteIndex;if(i>=0&&i<t.notes.length)return t.getNoteAt(i)}return null}},{key:"findTieMatch",value:function(t,e){return A.is(this.effectiveClef,$l)?t.findChromaticOrdinal(e.pitch.ordinal):t.findDiatonicOrdinal(e.diatonicOrdinal)}},{key:"effectiveScoreAlteration",value:function(t,e,i){var n=this.effectiveAlteration(t,e,i);return this.keySignature.atonal&&0===n&&(n-=this.getScoreNote(e).alteration-e.alteration),n}},{key:"effectiveAlteration",value:function(t,e,i){var n=new bu(this),r=!0,o=!1,s=void 0;try{for(var a,l=this.measureNotations[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,he);if(A.is(h,Sn)){var c=A.as(h,Sn);if(c.position>=t)break;n.processNoteSet(c)}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return n.getDefaultAlteration(t,e,i)}},{key:"cleanUpAccidentals",value:function(){if(this._accidentalCleanup<Hy.MAX_VALUE){var t=new bu(this),e=!0,i=!1,n=void 0;try{for(var r,o=this.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);if(A.is(a,Sn)){var l=A.as(a,Sn);if(l.position>=this._accidentalCleanup){var u=!0,h=!1,c=void 0;try{for(var d,f=l.notes[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;null!=y.accidental&&y.explicitAccidental||(y.accidental=t.getAccidental(y))}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}t.processNoteSet(l)}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this._accidentalCleanup=Hy.MAX_VALUE}}},{key:"addRests",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0;e<this.numVoices;e++)new Nu(this.getVoiceNumber(e)).addRests(t)}},{key:"removeEmptyVoices",value:function(){for(var t=this.numVoices-1;t>=0;t--)0===this.getVoiceNumber(t).numChildren&&this.numVoices>1&&this.removeVoiceNumber(t)}},{key:"combineSameStemVoices",value:function(){var t,e,i=[],n=[],r=-1,o=[],s=!1,a=null,l=null,u=function(){if(n.length>0&&null!=a)for(var t=0;t<n.length;t++){var e=n[t],i=A.unknownToType(e,he);i.parent==l&&(null!=l&&l.removeElement(i),a.addElement(i))}},h=!0,c=!1,d=void 0;try{for(var f,y=this.measureNotations.slice()[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.unknownToType(g,he);if(p.position!=r&&(u(),i=[],n=[],l=a=null,r=p.position),A.is(p,Sn)&&!A.unknownToType(p,Sn).grace){for(var m=A.unknownToType(p,Sn),v=0;v<i.length;v++){var _,S=i[v],L=A.unknownToType(S,Sn);if(L.duration==m.duration)if(0===m.notes.length&&!(null!=(_=m.previousNoteSet())&&_.beam&&o.indexOf(_)<0)||null!=m.direction&&m.direction==L.direction){var k=!0,T=!1,E=void 0;try{for(var M,b=m.notes[Symbol.iterator]();!(k=(M=b.next()).done);k=!0)t=M.value,s=!0,null==L.findSameAs(t)&&L.addNote(t)}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}var w=!0,x=!1,C=void 0;try{for(var N,I=m.lyrics[Symbol.iterator]();!(w=(N=I.next()).done);w=!0)e=N.value,L.addLyric(e)}catch(t){x=!0,C=t}finally{try{w||null==I.return||I.return()}finally{if(x)throw C}}l=m.voice,a=L.voice,o.push(m),m=null;break}}null!=m&&i.push(m)}else p.voiceNumber>=0&&n.push(p)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}if(u(),s){for(var P,O,Q=[],R=0;R<o.length;R++){var D=o[R];P=(O=A.unknownToType(D,ue)).rhythmContext,-1==Q.indexOf(P)&&Q.push(P),P.removeElement(O)}for(var F=0;F<Q.length;F++){var U=Q[F];for(P=A.unknownToType(U,Ha);;){if(P.numElements>0||!A.is(P,ue)){if(A.is(P,Xl))new Nu(P).addRests(!0);break}(P=(O=A.unknownToType(P,ue)).rhythmContext).removeElement(O)}}}}},{key:"addValueNotationWithDuration",value:function(t,e,i,n,r){var o=this.getVoiceNumber(t.lastVoiceNumber,!0);return new Nu(o).addValueNotationWithDuration(t,e,i,n,r)}},{key:"removePositionRange",value:function(t,e,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=Kl.NON_METRICAL_VOICE_NUMBER;o<this.numVoices;o++)if(i==Kl.UNKNOWN_VOICE_NUMBER||o==i){var s=new Cu;s.filter=n,s.cropElements=r,new Nu(this.getVoiceNumber(o)).removePositionRange(t,e,s)}}},{key:"cleanUpClefs",value:function(){if(this._clefCleanup){var t=this.clef,e=!0,i=!1,n=void 0;try{for(var r,o=this.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);A.is(a,Mn)&&(t.sameAs(A.as(a,Mn))?this.removeElement(a):0===(t=A.as(a,Mn)).position&&(this.removeElement(a),this.clef=t))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this._clefCleanup=!1}}},{key:"cleanUpLiaisons",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._liaisonCleanup||t)&&(new wu(this).processMeasure(),this._liaisonCleanup=!1)}},{key:"cleanUpStringAssignments",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];A.is(this.effectiveClef,$l)&&(this._stringAssignmentCleanup||t)&&(new Au(this).processMeasure(),this._stringAssignmentCleanup=!1)}},{key:"calculateDerived",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cleanUpLiaisons(t),this.cleanUpStringAssignments(t)}},{key:"initializeDerivedState",value:function(){this._measureNotations=[],this._spanNotations=[];var t=!0,e=!1,i=void 0;try{for(var n,r=this.voices[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,Kl),a=!0,l=!1,u=void 0;try{for(var h,c=new Nu(s).getNotations()[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,he);this.addDescendantNotation(f)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"handleChildModelChange",value:function(t){var i;if(s(h(e.prototype),"handleChildModelChange",this).call(this,t),A.is(t.parent,Ha))if(A.is(t.child,he))i=A.as(t.child,he),t.kind==Ri.ADD_CHILD_MODEL?this.addDescendantNotation(i):t.kind==Ri.REMOVE_CHILD_MODEL&&this.removeDescendantNotation(i);else if(A.is(t.child,Ha)){var n,r=new Nu(A.as(t.child,Ha)).getNotations();if(t.kind==Ri.ADD_CHILD_MODEL){var o=!0,a=!1,l=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)n=u.value,i=A.unknownToType(n,he),this.addDescendantNotation(i)}catch(t){a=!0,l=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw l}}}else if(t.kind==Ri.REMOVE_CHILD_MODEL){var d=!0,f=!1,y=void 0;try{for(var g,p=r[Symbol.iterator]();!(d=(g=p.next()).done);d=!0)n=g.value,i=A.unknownToType(n,he),this.removeDescendantNotation(i)}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}}}A.is(t.child,ul)&&this.turnOnSeenLyrics()}},{key:"turnOnSeenLyrics",value:function(){this._seenLyrics=!0,this.parent&&A.is(this.parent,Rl)&&(A.unknownToType(this.parent,Rl).seenLyrics=!0)}},{key:"addDescendantNotation",value:function(t){A.is(t,Ua)&&this._spanNotations.push(t),!this.seenLyrics&&A.is(t,Sn)&&A.unknownToType(t,Sn).hasLyrics&&this.turnOnSeenLyrics();for(var e=0;e<this._measureNotations.length;e++)if(ae.compareScorePosition(t,this.getNotationAt(e))<0)return void this._measureNotations.splice(e,0,t);this._measureNotations.push(t)}},{key:"removeDescendantNotation",value:function(t){var e=this._measureNotations.indexOf(t);e>=0&&this._measureNotations.splice(e,1),A.is(t,Ua)&&(e=this._spanNotations.indexOf(t))>=0&&this._spanNotations.splice(e,1)}},{key:"dispatchModelEvent",value:function(t){this.staff&&(this._mmrInitialized&&this.isAutoMultiRestCandidate!=this._cachedAutoMMRCandidate&&this.staff.score.effectiveStaffMetrics.autoMultiMeasureRestCreation&&(this.staff.score.effectiveStaffMetrics.autoMultiMeasureRestCreation=!1,Gy.show(Ou.getString("alerts/autoMultiRestTurnedOffWhileEditing"))),!this._mmrInitialized&&this.staff.score.initCompleted&&(this._cachedAutoMMRCandidate=this.isAutoMultiRestCandidate,this._mmrInitialized=!0)),s(h(e.prototype),"dispatchModelEvent",this).call(this,t),t.kind!=Ri.REMOVING_CHILD_MODEL&&t.kind!=Ri.ADD_CHILD_MODEL||(A.is(t.child,ue)&&(this._accidentalCleanup=A.numberToInt(Math.min(this._accidentalCleanup,A.unknownToType(t.child,ue).position)),this._stringAssignmentCleanup=this._liaisonCleanup=this._restCleanup=!0),A.is(t.child,Mn)&&(this._clefCleanup=!0),A.is(t.child,Kl)&&this.invalidateAccidentals())}},{key:"dispatchModelUpdateEvent",value:function(t){t.measureIndex=this.index,s(h(e.prototype),"dispatchModelUpdateEvent",this).call(this,t),A.is(t.source,de)&&("pitch"!=t.property&&"accidental"!=t.property&&"step"!=t.property&&"liaison"!=t.property||(this._accidentalCleanup=A.numberToInt(Math.min(this._accidentalCleanup,A.unknownToType(t.source,de).position)),this._liaisonCleanup=this._restCleanup=!0)),t.source==this&&"keySignature"==t.property&&(this._accidentalCleanup=0)}},{key:"invalidateAccidentals",value:function(){this._accidentalCleanup=0}},{key:"defaultBeaming",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);A.is(s,Sn)&&A.unknownToType(s,Sn).defaultBeamStart()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"getScoreNote",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t.playable)return this.effectiveClef.getLineNote(this.effectiveClef.centerLine,this,!1);if(null==e&&(e=this.scoreInterval),e.unison||!this.effectiveClef.showKey)return t;var i=t.transposeInterval(e);return null!=t.accidental&&(i.accidental=de.alterationToAccidental(i.alteration)),i}},{key:"getScoreNoteY",value:function(t){return this.effectiveClef.getPitchLine(this.getScoreNote(t))*this.effectiveClef.lineSpacing}},{key:"transposeInterval",value:function(t){if(!t.unison){var e=!0,i=!1,n=void 0;try{for(var r,o=this.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);if(A.is(a,Sn)){var l=!0,u=!1,h=void 0;try{for(var c,d=A.unknownToType(a,Sn).notes[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,y=f.transposeInterval(t);f.pitch=y.pitch,f.step=y.step}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}else if(A.is(a,Aa)){var g=A.as(a,Aa),p=g.transposeInterval(t);g.text=p.text}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"getFormalElements",value:function(){for(var t=[],i=this.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER),n=0;n<i.numElements;){var r=i.getElementAt(n++),o=A.as(r,Ca),s=A.as(r,Il),a=A.as(r,Oa);if(null==o||A.is(o,bl))if(null!=o){var l=this.matchFormalElement(o.text);null!=l&&t.push(new C(l,r))}else null!=s?t.push(new C(e.FORM_SEGNO,r)):null!=a&&t.push(new C(e.FORM_CODA,r))}return t}},{key:"matchFormalElement",value:function(t){var i=t.toLowerCase();i=(i=(i=(i=(i=(i=(i=i.replace(/[ \n\r]+/g,"")).replace(/coda\{coda\}/g,"coda")).replace(/\{coda\}coda/g,"coda")).replace(/al/,"")).replace(/2ndtime/,"")).replace(/lasttime/,"")).replace(/[\.\(\)\{\}]/g,"");var n=!0,r=!1,o=void 0;try{for(var s,a=e.FORMAL_ELEMENTS[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToString(l);if(u==i)return u}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return null}},{key:"getRepeatInfo",value:function(){for(var t=!1,i=new xl,n=[this,this.systemMeasure],r=0;r<n.length;r++)for(var o=n[r],s=A.unknownToType(o,e).getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER),a=0;a<s.numElements;){var l=s.getElementAt(a++),u=null;if(A.is(l,Ca)?u=A.unknownToType(l,Ca).text:A.is(l,qa)&&(u=A.unknownToType(l,qa).startingText,l.span&&(i.endingsDuration=l.span)),null!=u){if(0===l.position&&A.is(l,ll)){var h=l.numbers;t||(i.endings=[],t=!0);var c=!0,d=!1,f=void 0;try{for(var y,g=h[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=A.unknownToString(p).split("-");if(1==m.length)i.endings.push(A.stringToNumber(Zy.trim(A.unknownToString(m[0])))-1);else if(m.length>=2)for(var v=A.numberToInt(A.stringToNumber(Zy.trim(A.unknownToString(m[0])))-1),_=A.numberToInt(A.stringToNumber(Zy.trim(A.unknownToString(m[1])))-1),S=v;S<=_;S++)i.endings.push(S)}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}break}var L=/((play|repeat) +)?([0-9]+)( +times|x)( .*)?$/i.exec(u);if(null!=L){var k=A.numberToInt(A.unknownToNumber(L[3])),T=A.unknownToString(L[2]);null!=T&&"repeat"==T.toLowerCase()&&k++,k>=1&&(i.repeatCount=k);break}}}return i}},{key:"addTempoNotation",value:function(){null==this.tempoNotation&&this.addElement(this.tempo.clone(),Kl.NON_METRICAL_VOICE_NUMBER)}},{key:"defaultAboveBelow",value:function(){var t=null;if(null!=this.staff){null!=this.systemMeasure&&(null!=(t=this.systemMeasure.tempoNotation)&&t.dy==he.PLACEMENT_ABOVE&&(t.dy=0,t.implicitDy=!0),this.systemMeasure.tempo.dy==he.PLACEMENT_ABOVE&&(this.systemMeasure.tempo.dy=0));var e=!0,i=!1,n=void 0;try{for(var r,o=this.staff.getSpanNotations(this.index)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.dy==he.PLACEMENT_ABOVE?(s.y=this.aboveNotesY,s.defaultDirection=he.DIRECTION_UP):s.dy==he.PLACEMENT_BELOW&&(s.y=this.belowNotesY,s.defaultDirection=he.DIRECTION_DOWN)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var a=!0,l=!1,u=void 0;try{for(var h,c=this.allNonMetricalElements[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,he);f.dy==he.PLACEMENT_ABOVE?(f.y=this.aboveNotesY,f.implicitDy=!0,0===f.position&&null!=t&&(f.y=Math.max(f.y,t.y+3.5))):f.dy==he.PLACEMENT_BELOW&&(f.y=this.belowNotesY,f.implicitDy=!0)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}},{key:"defaultTextPositions",value:function(){var t,e,i,n=this.aboveNotesY,r=!1,o=!1,s=!1,a=this.staff.score.effectiveStaffMetrics,l=this.allNonMetricalElements,u=null;this.index>=0&&null!=this.systemMeasure&&(u=this.systemMeasure.tempoNotation),i=this.effectiveClef.staffHeight;var h=!0,c=!1,d=void 0;try{for(var f,y=l[Symbol.iterator]();!(h=(f=y.next()).done);h=!0)e=f.value,t=A.unknownToType(e,he),A.is(t,Aa)&&(r=!0,o=o||null!=A.unknownToType(t,Aa).fretboard,i=Math.max(i,t.y))}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}r&&(n=Math.max(n,i+(o?a.spaceAboveChordFrames:a.spaceAboveChords)),null!=u&&(u.dx=a.tempoFirstMeasureXOffset)),i=0;var g=null,p=null,m=!0,v=!1,_=void 0;try{for(var S,L=l[Symbol.iterator]();!(m=(S=L.next()).done);m=!0)e=S.value,t=A.unknownToType(e,he),(A.is(t,bl)||A.is(t,Pa))&&(A.is(t,bl)&&A.unknownToType(t,bl).text.match(/coda/i)?p=A.as(t,bl):A.is(t,Oa)&&(g=A.as(t,Oa)),s=!0,i=Math.max(i,t.y),(Math.abs(t.dy)<1||t.implicitDy&&t.y>=this.effectiveClef.staffHeight&&t.y<n)&&(t.y=n),t)}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}if(s&&(n=Math.max(n,i+a.spaceAbovePerformanceText),null!=g&&null!=p)){var k=A.as(p.parent,Kl);g.position>p.position||g.position==p.position&&g.dx>p.dx?p.text+=" {coda}":p.text="{coda} "+p.text,A.unknownToType(g,he).parent.removeChild(g),k.removeChild(p),p.rhythmPosition=g.rhythmPosition,p.dx=g.dx,p.dy=g.dy,k.addElement(p)}}},{key:"cleanUpRestPositions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((this._restCleanup||t)&&(this._restCleanup=!1,!(this.numVoices<2))){var e=-1,i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.measureNotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,he);u.position!=e&&(i.length>1&&this.adjustRestPositions(i),e=u.position,i=[]),A.is(u,Sn)&&!u.invisible&&i.push(u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}i.length>1&&this.adjustRestPositions(i)}}},{key:"adjustRestPositions",value:function(t){var e,i,n=[-100,100],r=!1,o=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(o=(l=u.next()).done);o=!0)i=l.value,(e=A.unknownToType(i,Sn)).notes.length>0&&(0===e.voiceNumber?n[1]=Math.min(n[1],this.effectiveClef.getPitchLine(e.getNoteAt(0))):n[0]=Math.max(n[0],this.effectiveClef.getPitchLine(e.getNoteAt(e.notes.length-1))-(this.effectiveClef.numLines-1)),r=!0)}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}var h=!0,c=!1,d=void 0;try{for(var f,y=t[Symbol.iterator]();!(h=(f=y.next()).done);h=!0)i=f.value,e=A.unknownToType(i,Sn),r&&0===e.notes.length&&!e.explicitRestY&&(0===e.voiceNumber?e.dy=Math.max(e.dy,Math.max(n[0]+this.staff.score.effectiveStaffMetrics.upperVoiceRestOffset+.5,0)):1==e.voiceNumber?e.dy=Math.min(e.dy,Math.min(n[1]+this.staff.score.effectiveStaffMetrics.lowerVoiceRestOffset-.5,0)):e.dy=Math.min(e.dy,Math.min(n[1]+2*(this.staff.score.effectiveStaffMetrics.lowerVoiceRestOffset-.5),0)))}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}},{key:"numberAutoMultiMeasureRests",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isAutoMultiRestCandidate||this.breaksMultiRestAfter)return 0;for(var e=1,i=this.nextMeasure;i&&!i.breaksMultiRestBefore&&(e++,!i.breaksMultiRestAfter&&t);)i=i.nextMeasure;return e}},{key:"autoMultiRest",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.isAutoMultiRestCandidate?this.autoMultiRestLastMeasure?e.MULTI_REST_END:this.breaksMultiRestAfter?e.MULTI_REST_NONE:this.autoMultiRestFirstMeasure?A.numberToInt(this.numberAutoMultiMeasureRests(t)):this.autoMultiRestNotFirstMeasure?e.MULTI_REST_BODY:e.MULTI_REST_NONE:e.MULTI_REST_NONE}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.tempo=A.as(this.tempo.clone(),Yl),t.timeSignature=A.as(this.timeSignature.clone(),zl),t.keySignature=A.as(this.keySignature.clone(),Ga),null!=this.clef&&(t.clef=A.as(this.clef.clone(),Mn)),t.breakType=this.breakType,t.startRepeat=this.startRepeat,t.endRepeat=this.endRepeat,t.canHideStaff=this.canHideStaff,t.initializeDerivedState(),t}},{key:"measureNumber",get:function(){if(!this.isSystemMeasure)return this.systemMeasure?this.systemMeasure.measureNumber:-1;if(this.isMeasureNumberCustomized)return this._$measureNumber;if(-1!=this._cachedMeasureNumber)return this._cachedMeasureNumber;if(this.previousMeasure){var t=this.previousMeasure.measureNumber;return this._cachedMeasureNumber=t+1,this._cachedMeasureNumber}return this.timeSignatureNotation&&!this.timeSignatureNotation.sameTimeProperties(this.timeSignature)?this.index:this.index+1},set:function(t){if(null!==t){var e=parseInt(t);this.isSystemMeasure||(this.systemMeasure.measureNumber=e),this.isMeasureNumberCustomized=!!t;var i=this._$measureNumber;this._$measureNumber=Math.abs(parseInt(t)),i!=e&&(this.clearMeasureNumberCache(),this._propertyChanged("measureNumber",i,e))}}},{key:"customizedMeasureNumber",get:function(){return this._$measureNumber}},{key:"timeSignature",get:function(){return this._$timeSignature},set:function(t){var e=this._$timeSignature;this._$timeSignature=t,e!==t&&this._propertyChanged("timeSignature",e,t)}},{key:"keySignature",get:function(){return this._$keySignature},set:function(t){var e=this._$keySignature;this._$keySignature=t,e!==t&&this._propertyChanged("keySignature",e,t)}},{key:"tempo",get:function(){return this._$tempo},set:function(t){var e=this._$tempo;this._$tempo=t,e!==t&&this._propertyChanged("tempo",e,t)}},{key:"clef",get:function(){return this._$clef},set:function(t){var e=this._$clef;this._$clef=t,e!==t&&this._propertyChanged("clef",e,t)}},{key:"breakType",get:function(){return this._$breakType},set:function(t){var e=this._$breakType;this._$breakType=t,e!==t&&this._propertyChanged("breakType",e,t)}},{key:"startRepeat",get:function(){return this._$startRepeat},set:function(t){var e=this._$startRepeat;this._$startRepeat=t,e!==t&&this._propertyChanged("startRepeat",e,t)}},{key:"endRepeat",get:function(){return this._$endRepeat},set:function(t){var e=this._$endRepeat;this._$endRepeat=t,e!==t&&this._propertyChanged("endRepeat",e,t)}},{key:"layoutWeight",get:function(){return this._$layoutWeight},set:function(t){var e=this._$layoutWeight;this._$layoutWeight=t,e!==t&&this._propertyChanged("layoutWeight",e,t)}},{key:"canHideStaff",get:function(){return this._$canHideStaff},set:function(t){var e=this._$canHideStaff;this._$canHideStaff=t,e!==t&&this._propertyChanged("canHideStaff",e,t)}},{key:"disableCautionaries",get:function(){return this._$disableCautionaries},set:function(t){var e=this._$disableCautionaries;this._$disableCautionaries=t,e!==t&&this._propertyChanged("disableCautionaries",e,t)}},{key:"leftMargin",get:function(){return this._$leftMargin},set:function(t){var e=this._$leftMargin;this._$leftMargin=t,e!==t&&this._propertyChanged("leftMargin",e,t)}},{key:"rightMargin",get:function(){return this._$rightMargin},set:function(t){var e=this._$rightMargin;this._$rightMargin=t,e!==t&&this._propertyChanged("rightMargin",e,t)}},{key:"systemGap",get:function(){return this._$systemGap},set:function(t){var e=this._$systemGap;this._$systemGap=t,e!==t&&this._propertyChanged("systemGap",e,t)}},{key:"systemMeasure",get:function(){return this._systemMeasure},set:function(t){this._systemMeasure=t}},{key:"isSystemMeasure",get:function(){return null!=this.staff&&null==this.systemMeasure}},{key:"measureInfo",get:function(){var t=new fl;return t.tempo=this.tempo,t.timeSignature=this.timeSignature,t.keySignature=this.keySignature,t},set:function(t){this.tempo=t.tempo,this.timeSignature=t.timeSignature,this.keySignature=t.keySignature}},{key:"effectiveSystemMeasure",get:function(){return this.isSystemMeasure?this:this.systemMeasure}},{key:"duration",get:function(){return this.timeSignature.meterDuration}},{key:"durationInSeconds",get:function(){return this.measureInfo.tempo.timeScale*this.duration}},{key:"scorePosition",get:function(){if(null==this.staff)return 0;for(var t=0,e=0;e<this.index;e++)t+=this.staff.getMeasureAt(A.intToUint(e)).duration;return t}},{key:"seenLyrics",get:function(){return this._seenLyrics}},{key:"effectiveLeftMargin",get:function(){return this.staff&&this.staff.score.effectiveStaffMetrics.indentationSpacing>0&&(0===this.index&&this.staff.isSystemStaff||this.isFirstMeasureOfCoda)?this.staff.score.effectiveStaffMetrics.indentationSpacing:this.leftMargin}},{key:"isTacet",get:function(){return A.is(this.getVoiceNumber(0).noteSetAtPosition(0),Gl)}},{key:"blocks",get:function(){return this._blocks},set:function(t){var e=this._blocks.slice(),i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.measure=this}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this._blocks=t;var a=this._blocks.slice();this._propertyChanged("blocks",e,a)}},{key:"blocksPositionedBeforeSystem",get:function(){for(var t=[],e=0;e<this.blocks.length;e++)this.blocks[e].hasColumnPositionedBeforeSystem&&t.push(this.blocks[e]);return t}},{key:"blocksPositionedAfterSystem",get:function(){for(var t=[],e=0;e<this.blocks.length;e++)this.blocks[e].hasColumnPositionedAfterSystem&&t.push(this.blocks[e]);return t}},{key:"hasBlockPositionedBeforeSystem",get:function(){return this.blocksPositionedBeforeSystem.length>0}},{key:"hasBlockPositionedAfterSystem",get:function(){return this.blocksPositionedAfterSystem.length>0}},{key:"numVoices",get:function(){return this.numChildren-1}},{key:"voices",get:function(){return this._children}},{key:"staff",get:function(){return A.as(this.parent,Rl)}},{key:"part",get:function(){return null!=this.parent?this.staff.part:null}},{key:"measureNotations",get:function(){return this._measureNotations}},{key:"spanNotations",get:function(){return this._spanNotations}},{key:"overrideClef",get:function(){return this.staff?this.staff.overrideClef:null}},{key:"effectiveClef",get:function(){return this.overrideClef||this.clef}},{key:"numNotations",get:function(){return this._measureNotations.length}},{key:"measureElements",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.voices[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Kl);t=t.concat(a.elements.slice())}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t.sort(ae.comparePosition),t}},{key:"allNonMetricalElements",get:function(){var t=this.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements.slice();return this.systemMeasure&&(t=t.concat(this.systemMeasure.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements.slice())),t}},{key:"timeSignatureNotation",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);if(A.is(s,zl))return A.as(s,zl)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return null}},{key:"baseTimeSignature",get:function(){return this.timeSignatureNotation?this.timeSignatureNotation:this.timeSignature}},{key:"keySignatureNotation",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);if(A.is(s,Ga))return A.as(s,Ga)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return null}},{key:"tempoNotation",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);if(A.is(s,Yl))return A.as(s,Yl)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return null}},{key:"barlineNotation",get:function(){for(var t=this.measureNotations.length-1;t>=0;t--){var e=A.as(this.getNotationAt(t),En);if(null!=e)return e}return null}},{key:"repeatEndingNotation",get:function(){for(var t=this.measureNotations.length-1;t>=0;t--){var e=A.as(this.getNotationAt(t),ll);if(null!=e)return e}return null}},{key:"finalClefNotation",get:function(){for(var t=this.measureNotations.length-1;t>=0;t--){var e=A.as(this.getNotationAt(t),Mn);if(null!=e)return e.position==this.timeSignature.meterDuration?e:null}return null}},{key:"scoreInterval",get:function(){if(this.isSystemMeasure||!this.staff)return new $a;var t=this.staff.score.transposeParts?this.staff.part.transposingInterval:this.staff.part.concertInterval,e=this.staff.part.alternateKey;if(t.octaveMultiple&&!e)return t;var i=this.keySignature.transposeFifths(t.fifths),n=i.enharmonicDistance,r=this.staff.getMeasureAt(0);if((i.fifths<=-5||i.fifths>=5)&&!this.keySignature.equals(r.keySignature)){var o=r.keySignature.transposeFifths(r.scoreInterval.fifths),s=i.fifths>0?12-i.fifths:12+i.fifths;e=Math.abs(o.fifths-i.fifths)>Math.abs(o.fifths-s)}return e&&(i.fifths<=-5?n--:i.fifths>=5&&n++),t.add(new $a(n,0))}},{key:"transposingInterval",get:function(){if(this.isSystemMeasure)return new $a;var t=this.staff.part.transposingInterval;return t.octaveMultiple?t:t.add(new $a(this.keySignature.transposeFifths(t.fifths).enharmonicDistance,0))}},{key:"isAtonalKeySignature",get:function(){return this.keySignature.atonal}},{key:"isFirstMeasureOfCoda",get:function(){if((this.systemMeasure||this).hasStartCoda)return!0;for(var t=this.staff.score.staves,e=0;e<t.length;++e){var i=t[e];if(i.numChildren>this.index&&i.getMeasureAt(this.index).hasStartCoda)return!0}return!1}},{key:"hasStartCoda",get:function(){for(var t=this.getFormalElements(),i=0;i<t.length;i++){var n=t[i];if(n.formalElementName==e.FORM_CODA&&n.rhythmElement.position<=this.duration/2)return!0}return!1}},{key:"flowsToNextMeasure",get:function(){if(this.index>=this.staff.score.numMeasures-1)return!1;var t=this.systemMeasure.barlineNotation;if(null!=t&&t.type==En.DOUBLE)for(var i=this.staff.score.getStaffAt(0).getMeasureAt(A.intToUint(this.index)),n=[this.systemMeasure,i],r=0;r<n.length;r++){var o=n[r],s=A.unknownToType(o,e),a=!0,l=!1,u=void 0;try{for(var h,c=s.getFormalElements()[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if(e.STARTING_FORMAL_ELEMENTS.indexOf(d.formalElementName)>=0)return!1}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}if(this.systemMeasure.endRepeat&&this.staff.numChildren>this.index+1){var f=this.staff.getMeasureAt(A.intToUint(this.index+1)).getRepeatInfo();if(null!=f.endings&&f.endings.length>0)return!1}return!0}},{key:"previousMeasure",get:function(){return this.index<=0?null:this.staff.getMeasureAt(A.intToUint(this.index-1))}},{key:"nextMeasure",get:function(){return this.index+1>=this.staff.totalMeasures?null:this.staff.getMeasureAt(A.intToUint(this.index+1))}},{key:"flowsFromPreviousMeasure",get:function(){return!!this.previousMeasure&&(!this.previousMeasure.canHideStaff&&this.previousMeasure.flowsToNextMeasure)}},{key:"allowIncomingLiaisons",get:function(){return!this.flowsFromPreviousMeasure||this.systemMeasure.startRepeat||this.isFirstMeasureOfCoda}},{key:"aboveNotesY",get:function(){var t=this.effectiveClef.staffHeight,e=(this.scoreInterval,!0),i=!1,n=void 0;try{for(var r,o=this.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);if(A.is(a,Sn)){var l=A.unknownToType(a,Sn);if(l.notes.length>0){var u=this.getScoreNoteY(l.getNoteAt(l.notes.length-1));this.numVoices>1&&(u+=this.staff.score.effectiveStaffMetrics.normalStemLength),t=Math.max(t,u)}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t+2.5}},{key:"belowNotesY",get:function(){var t=0,e=(this.scoreInterval,!0),i=!1,n=void 0;try{for(var r,o=this.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);if(A.is(a,Sn)){var l=A.unknownToType(a,Sn);if(l.notes.length>0){var u=this.getScoreNoteY(l.getNoteAt(l.notes.length-1));this.numVoices>1&&(u-=this.staff.score.effectiveStaffMetrics.normalStemLength),t=Math.min(t,u)}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t-4}},{key:"staffHidingChange",get:function(){var t=this.index;return t>=0&&t+1<this.staff.measures.length&&this.staff.getMeasureAt(A.intToUint(t+1)).canHideStaff!=this.canHideStaff}},{key:"isAutoMultiRestCandidate",get:function(){if(this.staff&&this.staff.score.effectiveStaffMetrics.autoMultiMeasureRestCreation){var t=this.getVoiceNumber(0).noteSetAtPosition(0);return A.is(t,Gl)&&this.multiRest==e.MULTI_REST_NONE&&1==this.numVoices&&!t.hasArticulation(Sn.FERMATA_ARTICULATION)&&!t.hasArticulation(Sn.CAESURA_ARTICULATION)&&0===this.systemMeasure.getFormalElements().length}return!1}},{key:"breaksMultiRestBefore",get:function(){return!this.isAutoMultiRestCandidate||this.systemMeasure.timeSignatureNotation||this.systemMeasure.tempoNotation||this.systemMeasure.startRepeat||this.systemMeasure.getVoiceAt(0).hasRehearsalLetter||null!=this.getRepeatInfo().endings||this.measureNotations.length>1}},{key:"breaksMultiRestAfter",get:function(){return!!(!this.isAutoMultiRestCandidate||this.systemMeasure.barlineNotation&&this.systemMeasure.barlineNotation.breaksMultiMeasureRest||this.systemMeasure.endRepeat||this.systemMeasure.breakType)}},{key:"autoMultiRestFirstMeasure",get:function(){return this.isAutoMultiRestCandidate&&(!this.previousMeasure||!this.previousMeasure.isAutoMultiRestCandidate||this.previousMeasure.breaksMultiRestAfter||this.breaksMultiRestBefore)&&this.numberAutoMultiMeasureRests(!1)>=2}},{key:"autoMultiRestNotFirstMeasure",get:function(){return this.isAutoMultiRestCandidate&&!this.breaksMultiRestBefore&&null!=this.previousMeasure&&!this.previousMeasure.breaksMultiRestAfter&&!this.previousMeasure.autoMultiRestLastMeasure}},{key:"autoMultiRestLastMeasure",get:function(){return this.autoMultiRestNotFirstMeasure&&!this.breaksMultiRestBefore&&(this.breaksMultiRestAfter||!this.nextMeasure||!this.nextMeasure.isAutoMultiRestCandidate||this.nextMeasure.breaksMultiRestBefore)}},{key:"durationAutoMultiMeasureRests",get:function(){if(!this.isAutoMultiRestCandidate||this.breaksMultiRestAfter)return 0;for(var t=this.duration,e=this.nextMeasure;e&&e.breaksMultiRestBefore&&(t+=e.duration,!e.breaksMultiRestAfter);)e=e.nextMeasure;return t}},{key:"multiRest",get:function(){if(null==this.staff)return e.MULTI_REST_NONE;var t,i=!0,n=!1,r=void 0;try{for(var o,s=this.spanNotations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(t=A.unknownToType(a,Ua),A.is(t,kl))return A.unknownToType(t,kl).bars}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}var l=!0,u=!1,h=void 0;try{for(var c,d=this.staff.getSpanNotations(this.index)[Symbol.iterator]();!(l=(c=d.next()).done);l=!0)if(t=c.value,A.is(t,kl))return this.index==t.endPosition.measureIndex?e.MULTI_REST_END:e.MULTI_REST_BODY}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}return e.MULTI_REST_NONE}},{key:"anyMultiRestType",get:function(){var t=this.multiRest;return t!=e.MULTI_REST_NONE?t:this.autoMultiRest(!1)}},{key:"measureRepeatNotation",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);if(A.is(s,vl))return A.as(s,vl)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return null}}]),e}(),cl=[hl.FORM_DC,hl.FORM_DS,hl.FORM_DS_AL_FINE,hl.FORM_DC_AL_FINE,hl.FORM_DS_AL_CODA,hl.FORM_DC_AL_CODA,hl.FORM_DS_AL_SEGNO,hl.FORM_DC_AL_SEGNO,hl.FORM_SEGNO,hl.FORM_TO_CODA,hl.FORM_CODA,hl.FORM_FINE],dl=[hl.FORM_DC,hl.FORM_DS,hl.FORM_DS_AL_FINE,hl.FORM_DC_AL_FINE,hl.FORM_DS_AL_CODA,hl.FORM_DC_AL_CODA,hl.FORM_DS_AL_SEGNO,hl.FORM_DC_AL_SEGNO];r.registerClass(hl,"com.noteflight.notation.model.Measure");var fl=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$timeSignature=null,t._$keySignature=null,t._$tempo=null,t}return c(e,At),p(e,[{key:"equals",value:function(t){return this.timeSignature.equals(t.timeSignature)&&this.keySignature.equals(t.keySignature)&&this.tempo.equals(t.tempo)}},{key:"clone",value:function(){var t=new e;return t.tempo=A.as(this.tempo.clone(),Yl),t.timeSignature=A.as(this.timeSignature.clone(),zl),t.keySignature=A.as(this.keySignature.clone(),Ga),t}},{key:"timeSignature",get:function(){return this._$timeSignature},set:function(t){var e=this._$timeSignature;this._$timeSignature=t,e!==t&&this._propertyChanged("timeSignature",e,t)}},{key:"keySignature",get:function(){return this._$keySignature},set:function(t){var e=this._$keySignature;this._$keySignature=t,e!==t&&this._propertyChanged("keySignature",e,t)}},{key:"tempo",get:function(){return this._$tempo},set:function(t){var e=this._$tempo;this._$tempo=t,e!==t&&this._propertyChanged("tempo",e,t)}}]),e}();r.registerClass(fl,"com.noteflight.notation.model.MeasureInfo");var yl=function(){function t(e){y(this,t)}return p(t,null,[{key:"MAX_VALUE",get:function(){return 4294967295}},{key:"MIN_VALUE",get:function(){return 0}}]),t}();r.registerClass(yl,"uint");var gl=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this._measureIndex=0,this._position=NaN,this._measureIndex=e,this._position=i}return p(t,null,[{key:"MAX_POSITION",get:function(){return pl}},{key:"MIN_POSITION",get:function(){return ml}}]),p(t,[{key:"isGreaterThan",value:function(t){return this.compareTo(t)>0}},{key:"compareTo",value:function(t){return this.measureIndex<t.measureIndex?-1:this.measureIndex>t.measureIndex?1:this.position<t.position?-1:this.position>t.position?1:0}},{key:"toString",value:function(){return"[measure: "+this.measureIndex+", pos: "+this.position+"]"}},{key:"measureIndex",get:function(){return this._measureIndex}},{key:"position",get:function(){return this._position}}]),t}(),pl=new gl(yl.MAX_VALUE,0),ml=new gl(0,0);r.registerClass(gl,"com.noteflight.notation.model.MeasurePosition");var vl=function(t){function e(){return y(this,e),l(this,h(e).call(this,0,null,0,0))}return c(e,Sn),p(e,null,[{key:"MEASURE_REPEAT_SIGN",get:function(){return"measureRepeat"}}]),p(e,[{key:"clone",value:function(){return A.as(s(h(e.prototype),"clone",this).call(this),e)}},{key:"rhythmDuration",get:function(){return null==this.measure?0!==s(h(e.prototype),"rhythmDuration",this)?s(h(e.prototype),"rhythmDuration",this):0:A.numberToUint(this.measure.duration)},set:function(t){o(h(e.prototype),"rhythmDuration",t,this,!0)}}],[{key:"setMeasureToMeasureRepeat",value:function(t){t.removePositionRange(0,A.numberToInt(t.duration),Kl.UNKNOWN_VOICE_NUMBER),t.removeEmptyVoices();var i=t.getVoiceNumber(0,!0),n=new e;return i.addElement(n),n}}]),e}();r.registerClass(vl,"com.noteflight.notation.model.MeasureRepeat");var _l=function(){function t(e){y(this,t),this._type=null,this._type=e}return p(t,null,[{key:"IDENTITY_TYPE",get:function(){return"none"}},{key:"SWING_TYPE",get:function(){return"swing"}},{key:"IDENTITY",get:function(){return Sl}}]),p(t,[{key:"equals",value:function(t){return this._type==t.type}},{key:"setSwingDelta",value:function(t,e){return e}},{key:"transformPosition",value:function(t){return t.position}},{key:"transformDuration",value:function(t){return t.duration}},{key:"type",get:function(){return this._type}}]),t}(),Sl=new _l(_l.IDENTITY_TYPE);r.registerClass(_l,"com.noteflight.notation.model.MeterMap");var Ll=function(){function t(e){y(this,t),this.commandType=0,this.channel=0,this.pitch=0,this.velocity=0,this.value=0,this.parameter=0,this.timestamp=0,this.type=null,this.timestampInMilliseconds=NaN;var i=e.split("&"),n=new Date,r=!0,o=!1,s=void 0;try{for(var a,l=i[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToString(u);if(h.length>0){var c=h.split(" ");if(c.length>0){var d=A.numberToInt(X.parseInt(A.unknownToString(c[0]),16));switch(this.commandType=240&d,this.channel=15&d,this.timestamp=A.numberToUint(A.unknownToNumber(c[4])/1e3),this.timestampInMilliseconds=n.time,this.commandType){case t.NOTE_OFF_COMMAND:this.pitch=A.numberToInt(X.parseInt(A.unknownToString(c[1]),16)),this.velocity=0,this.type=t.NOTE_OFF;break;case t.NOTE_ON_COMMAND:this.pitch=A.numberToInt(X.parseInt(A.unknownToString(c[1]),16)),this.velocity=A.numberToInt(X.parseInt(A.unknownToString(c[2]),16)),this.velocity>0?this.type=t.NOTE_ON:this.type=t.NOTE_OFF;break;case t.PITCH_BEND_COMMAND:this.value=A.numberToInt(X.parseInt(A.unknownToString(c[2]),16)-64),this.type=t.PITCH_BEND;break;case t.CONTROLLER_COMMAND:this.parameter=A.numberToInt(X.parseInt(A.unknownToString(c[1]),16)),this.value=A.numberToInt(X.parseInt(A.unknownToString(c[2]),16)),this.type=t.CONTROLLER}}}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}return p(t,null,[{key:"PITCH_BEND_COMMAND",get:function(){return 224}},{key:"CONTROLLER_COMMAND",get:function(){return 176}},{key:"NOTE_ON_COMMAND",get:function(){return 144}},{key:"NOTE_OFF_COMMAND",get:function(){return 128}},{key:"NOTE_ON",get:function(){return"noteOn"}},{key:"NOTE_OFF",get:function(){return"noteOff"}},{key:"PITCH_BEND",get:function(){return"pitchBend"}},{key:"CONTROLLER",get:function(){return"controller"}}]),t}();r.registerClass(Ll,"com.noteflight.notation.model.MidiSocketMessage");var kl=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),(t=l(this,h(e).call(this,n,!0,r,qa.TYPE_MULTIREST)))._$bars=0,t.bars=i,t.bracketLength=2,t}return c(e,qa),p(e,[{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.bars=this.bars,t}},{key:"bars",get:function(){return this._$bars},set:function(t){var e=this._$bars;this._$bars=t,e!==t&&this._propertyChanged("bars",e,t)}}],[{key:"createMultiRest",value:function(t){return new e(t,0,0)}}]),e}();r.registerClass(kl,"com.noteflight.notation.model.MultiRest");var Tl=function(){function t(e,i,n){y(this,t),this.startPosition=null,this.endPosition=null,this.chunkLayout=null,this.pageLayout=null,this.pageChunkIndex=0,this.invalid=!1,this.breakWidth=NaN,this.isSystem=!0,this.startPosition=e,this.endPosition=i,this.breakWidth=n}return p(t,[{key:"lastChunkLayout",get:function(){return this.pageLayout?this.pageLayout.lastChunkLayout:null}}],[{key:"createPageChunkWithMeasureIndices",value:function(e,i,n){return new t(new Ia(e),new Ia(i),n)}}]),t}();r.registerClass(Tl,"com.noteflight.notation.model.PageChunk");var El=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return y(this,e),(t=l(this,h(e).call(this)))._$id=i,t._$name="",t._$shortName="",t._$transpositionInterval=null,t._$octaveShift=0,t._$alternateKey=!1,t._$instrumentUri="",t._$libraryLocation=null,t.midiPatch=0,t._$visible=!0,t._$gain=0,t._$pan=0,t._$muted=!1,t._$noteflightTrackMuted=!1,t._$barlineBreak=!1,t._$showAudioWaveform=!1,t._$directionsAboveStaff=!1,t.instrument=null,t.synthesizer=null,t.staves=null,t.pitchShift=0,t.hideChordSymbols=!1,t.hideFretboards=!1,t.transpositionInterval=new $a,t.hasPedal=!1,t._staffMetrics=null,t._pageMetrics=null,t}return c(e,se),p(e,null,[{key:"PATH_PREFIX",get:function(){return"p"}},{key:"NON_LAYOUT_PROPERTIES",get:function(){return Ml}}]),p(e,[{key:"handlePropertyChange",value:function(t){s(h(e.prototype),"handlePropertyChange",this).call(this,t),"showAudioWaveform"==t.property&&this.score.dispatchEvent(new tn(tn.WAVEFORM_MODEL_UPDATE,this))}},{key:"dispatchErrorLoadingInstrument",value:function(t){this.dispatchEvent(new Ri(Ri.ERROR_LOADING_INSTRUMENT,t))}},{key:"getNotationsInMeasure",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e=e.concat(a.getMeasureAt(A.intToUint(t)).measureNotations)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e.sort(ae.compareScorePosition),e}},{key:"addAudioTrack",value:function(t){this.addChild(t),this.score.dispatchEvent(new tn(tn.WAVEFORM_MODEL_UPDATE,this))}},{key:"getRecordedAudioTracksByUser",value:function(t){var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.recordedAudioTracks[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,wl);l.user.userId==t.userId&&e.push(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"getOrCreateTrackByUser",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.recordedAudioTracks[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,wl);if(a.user.userId==t.userId)return a}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var l=new wl;return l.user=t,this.addAudioTrack(l),l}},{key:"muteRecordedTracks",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.recordedAudioTracks[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;A.unknownToType(o,wl).playbackEnabled=!1}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"muteTracksForPart",value:function(){this.noteflightTrackMuted=!0,this.muteRecordedTracks()}},{key:"layoutPropertyChange",value:function(t){return!(t.property.toString()in e.NON_LAYOUT_PROPERTIES)}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.id=Qg.uuid(),t.name=this.name,t.shortName=this.shortName,t.transpositionInterval=this.transpositionInterval,t.octaveShift=this.octaveShift,t.directionsAboveStaff=this.directionsAboveStaff,t.instrumentUri=this.instrumentUri,t.libraryLocation=this.libraryLocation,t.midiPatch=this.midiPatch,t.gain=this.gain,t.pan=this.pan,t.muted=this.muted,t.hasPedal=this.hasPedal,t}},{key:"id",get:function(){return this._$id},set:function(t){var e=this._$id;this._$id=t,e!==t&&this._propertyChanged("id",e,t)}},{key:"name",get:function(){return this._$name},set:function(t){var e=this._$name;this._$name=t,e!==t&&this._propertyChanged("name",e,t)}},{key:"shortName",get:function(){return this._$shortName},set:function(t){var e=this._$shortName;this._$shortName=t,e!==t&&this._propertyChanged("shortName",e,t)}},{key:"transpositionInterval",get:function(){return this._$transpositionInterval},set:function(t){var e=this._$transpositionInterval;this._$transpositionInterval=t,e!==t&&this._propertyChanged("transpositionInterval",e,t)}},{key:"octaveShift",get:function(){return this._$octaveShift},set:function(t){var e=this._$octaveShift;this._$octaveShift=t,e!==t&&this._propertyChanged("octaveShift",e,t)}},{key:"alternateKey",get:function(){return this._$alternateKey},set:function(t){var e=this._$alternateKey;this._$alternateKey=t,e!==t&&this._propertyChanged("alternateKey",e,t)}},{key:"instrumentUri",get:function(){return this._$instrumentUri},set:function(t){var e=this._$instrumentUri;this._$instrumentUri=t,e!==t&&this._propertyChanged("instrumentUri",e,t)}},{key:"libraryLocation",get:function(){return this._$libraryLocation},set:function(t){var e=this._$libraryLocation;this._$libraryLocation=t,e!==t&&this._propertyChanged("libraryLocation",e,t)}},{key:"visible",get:function(){return this._$visible},set:function(t){var e=this._$visible;this._$visible=t,e!==t&&this._propertyChanged("visible",e,t)}},{key:"gain",get:function(){return this._$gain},set:function(t){var e=this._$gain;this._$gain=t,e!==t&&this._propertyChanged("gain",e,t)}},{key:"pan",get:function(){return this._$pan},set:function(t){var e=this._$pan;this._$pan=t,e!==t&&this._propertyChanged("pan",e,t)}},{key:"muted",get:function(){return this._$muted},set:function(t){var e=this._$muted;this._$muted=t,e!==t&&this._propertyChanged("muted",e,t)}},{key:"noteflightTrackMuted",get:function(){return this._$noteflightTrackMuted},set:function(t){var e=this._$noteflightTrackMuted;this._$noteflightTrackMuted=t,e!==t&&this._propertyChanged("noteflightTrackMuted",e,t)}},{key:"barlineBreak",get:function(){return this._$barlineBreak},set:function(t){var e=this._$barlineBreak;this._$barlineBreak=t,e!==t&&this._propertyChanged("barlineBreak",e,t)}},{key:"showAudioWaveform",get:function(){return this._$showAudioWaveform},set:function(t){var e=this._$showAudioWaveform;this._$showAudioWaveform=t,e!==t&&this._propertyChanged("showAudioWaveform",e,t)}},{key:"directionsAboveStaff",get:function(){return this._$directionsAboveStaff},set:function(t){var e=this._$directionsAboveStaff;this._$directionsAboveStaff=t,e!==t&&this._propertyChanged("directionsAboveStaff",e,t)}},{key:"staffMetrics",get:function(){return this._staffMetrics},set:function(t){var e=this._staffMetrics,i=!1;this._staffMetrics&&(i=!0,this._staffMetrics.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._staffMetrics.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),this._staffMetrics=t,this._staffMetrics&&(this._staffMetrics.parent=this,this._staffMetrics.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._staffMetrics.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),i&&this.dispatchModelEvent(new Di(Di.MODEL_UPDATE,"pageMetrics",e,this._staffMetrics,this))}},{key:"pageMetrics",get:function(){return this._pageMetrics},set:function(t){var e=this._pageMetrics,i=!1;this.pageMetrics&&(i=!0,this._pageMetrics.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._pageMetrics.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),this._pageMetrics=t,this._pageMetrics&&(this._pageMetrics.parent=this,this._pageMetrics.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._pageMetrics.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),i&&this.dispatchModelEvent(new Di(Di.MODEL_UPDATE,"pageMetrics",e,this._pageMetrics,this))}},{key:"nameToShow",get:function(){return this.name?this.name:this.synthesizer?A.unknownToString(this.synthesizer.instrumentName):""}},{key:"transposition",get:function(){return-this.transpositionInterval.pitches},set:function(t){this.transpositionInterval=$a.fromPitches(-t).normalizeTritone()}},{key:"transposingInterval",get:function(){var t=this.transpositionInterval;return 0!==this.pitchShift&&(t=$a.fromPitches(t.pitches+this.pitchShift).normalizeTritone()),0!==this.octaveShift&&(t=new $a(t.steps+7*this.octaveShift,t.pitches+12*this.octaveShift)),t}},{key:"score",get:function(){return this.staves.length>0?this.staves[0].score:null}},{key:"staffIndices",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.staves[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push(s.index)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"concertInterval",get:function(){return $a.fromPitches(12*this.octaveShift)}},{key:"audioTracks",get:function(){return this._children}},{key:"hasTracks",get:function(){return this.recordedAudioTracks.length>0}},{key:"recordedAudioTracks",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.audioTracks[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,ba);A.is(a,wl)&&t.push(A.unknownToType(a,wl))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"firstRecordedAudioTrackForPlayback",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.audioTracks[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,ba);if(A.is(s,wl)&&s.playbackEnabled)return A.as(s,wl)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return null}}],[{key:"createPart",value:function(){return new e(Qg.uuid())}}]),e}(),Ml={staves:!0,instrument:!0,midiPatch:!0,gain:!0,pan:!0,muted:!0};r.registerClass(El,"com.noteflight.notation.model.Part");var bl=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,Ca),p(e,[{key:"canBeCustomizedForView",get:function(){return this.measure&&this.measure.isSystemMeasure},set:function(t){}},{key:"alignToStaffTop",get:function(){return!0}},{key:"paddingY",get:function(){return this.score.effectiveStaffMetrics.performanceTextPadding.y}}]),e}();r.registerClass(bl,"com.noteflight.notation.model.PerformanceText");var wl=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$user=null,t.user=new ii,t}return c(e,ba),p(e,[{key:"addAudioClip",value:function(t){this.addChild(t),this.dispatchWaveformModelUpdateEvent()}},{key:"hasClipsAfterTime",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.sortedAudioClips[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(A.unknownToType(s,Ma).trackEndTime>t)return!0}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"addAudioClipAndRemoveOverlap",value:function(t){for(var e=0;e<this._children.length;e++){var i=A.unknownToType(this._children[e],Ma);if(i.trackEndTime<=t.trackStartTime||i.trackStartTime>=t.trackEndTime);else if(i.trackStartTime<t.trackStartTime&&i.trackEndTime>t.trackStartTime&&i.trackEndTime<=t.trackEndTime)i.mediaEndTime=i.mediaStartTime+(t.trackStartTime-i.trackStartTime);else if(i.trackEndTime>t.trackEndTime&&i.trackStartTime<t.trackEndTime&&i.trackStartTime>=t.trackStartTime)i.mediaStartTime=i.mediaStartTime+(t.trackEndTime-i.trackStartTime),i.trackStartTime=t.trackEndTime;else if(i.trackStartTime>=t.trackStartTime&&i.trackEndTime<=t.trackEndTime)this.removeChildAt(A.intToUint(e)),e--;else if(i.trackStartTime<t.trackStartTime&&i.trackEndTime>t.trackEndTime){var n=new Ma;n.audioMedia=i.audioMedia,n.mediaStartTime=i.mediaStartTime+(t.trackEndTime-i.trackStartTime),n.mediaEndTime=i.mediaEndTime,n.trackStartTime=t.trackEndTime,this.addAudioClip(n),i.mediaEndTime=i.mediaStartTime+(t.trackStartTime-i.trackStartTime)}}this.addAudioClip(t)}},{key:"user",get:function(){return this._$user},set:function(t){var e=this._$user;this._$user=t,e!==t&&this._propertyChanged("user",e,t)}},{key:"audioClips",get:function(){return this._children}},{key:"sortedAudioClips",get:function(){var t=this.audioClips.slice();return t.sort(function(t,e){return t.trackStartTime<e.trackStartTime?-1:t.trackStartTime>e.trackStartTime?1:0}),t}}]),e}();r.registerClass(wl,"com.noteflight.notation.model.RecordedAudioTrack");var xl=function t(){y(this,t),this.repeatCount=0,this.endings=null,this.endingsDuration=0,this.endMeasureIndex=-1};r.registerClass(xl,"com.noteflight.notation.model.RepeatInfo");var Cl=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,se),p(e,[{key:"getElementAt",value:function(t){return A.as(this.getChildAt(A.intToUint(t)),ue)}},{key:"addElementAt",value:function(t,e){this.addChildAt(A.unknownToType(t,se),e)}},{key:"addElement",value:function(t){for(var e=0;e<this.elements.length;e++)if(t.rhythmPosition<this.getElementAt(e).rhythmPosition)return void this.addChildAt(A.unknownToType(t,se),e);this.addChild(A.unknownToType(t,se))}},{key:"removeElement",value:function(t){this.removeChild(A.unknownToType(t,se))}},{key:"noteSetAtPosition",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.elements[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.rhythmPosition>t)break;if(A.is(s,Sn)&&s.rhythmPosition==t)return A.as(s,Sn)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"elements",get:function(){return this._children}},{key:"numElements",get:function(){return this._children.length}},{key:"timeSignature",get:function(){throw new Error("get timeSignature() not overridden")}},{key:"duration",get:function(){return this.timeSignature.meterDuration}}]),e}();r.implementsInterfaces(Cl,[Ba]),r.registerClass(Cl,"com.noteflight.notation.model.RhythmContainer");var Nl=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$mix=null,t._$systemStaff=null,t._$title="",t._$lockTitle=!1,t._$subtitle="",t._$supertitle=null,t._$composer="",t._$lockComposer=!1,t._$lyricist="",t._$lockLyricist=!1,t._$arranger="",t._$showArranger=!1,t._$copyright="",t._$lockCopyright=!1,t._$prompt=null,t._$footer=null,t._$lockFooter=!1,t._$transposeParts=!1,t._$defaultSlurs=!1,t._$playbackMode=e.PLAYBACK_MODE_NORMAL,t._$displayMode=e.PAGINATED_DISPLAY,t._$viewScale=1.5,t._$synchronizedTrack=null,t._staffMetrics=null,t._pageMetrics=null,t._$performanceMetrics=null,t.useIndividualPartInfo=null,t.errors=[],t._forceComplete=!1,t.scoreId=null,t.idCounter=1,t.draftSynchronizedTrack=null,t.initCompleted=!1,t.mix=new Al,t.mix.parent=u(u(t)),t.mix.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(u(u(t)),t.handleChildModelChange)),t.mix.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(u(u(t)),t.handleChildModelUpdate)),t.systemStaff=new Rl,t.systemStaff.parent=u(u(t)),t.systemStaff.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(u(u(t)),t.handleChildModelChange)),t.systemStaff.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(u(u(t)),t.handleChildModelUpdate)),t.initializeStaffMetrics(),t.initializePageMetrics(),t.performanceMetrics=new aa,t.performanceMetrics.parent=u(u(t)),t.performanceMetrics.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(u(u(t)),t.handleChildModelChange)),t.performanceMetrics.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(u(u(t)),t.handleChildModelUpdate)),t}return c(e,se),p(e,null,[{key:"PLAYBACK_MODE_NORMAL",get:function(){return"normal"}},{key:"PLAYBACK_MODE_SILENT",get:function(){return"silent"}},{key:"PLAYBACK_MODE_ECHO",get:function(){return"echo"}},{key:"PAGINATED_DISPLAY",get:function(){return"paginated"}},{key:"FLOW_DISPLAY",get:function(){return"flow"}},{key:"STRIP_DISPLAY",get:function(){return"strip"}},{key:"PERFORM_DISPLAY",get:function(){return"perform"}},{key:"SYSTEM_STAFF_PATH_PREFIX",get:function(){return"s"}},{key:"STAFF_METRICS_PATH_PREFIX",get:function(){return"m"}},{key:"PAGE_METRICS_PATH_PREFIX",get:function(){return"p"}},{key:"PERFORMANCE_METRICS_PATH_PREFIX",get:function(){return"r"}},{key:"SCORE_MIX_PATH_PREFIX",get:function(){return"x"}}]),p(e,[{key:"initializeStaffMetrics",value:function(){this.staffMetrics=new pn}},{key:"initializePageMetrics",value:function(){this.pageMetrics=hr.fromPageSize("US Letter",hr.PORTRAIT)}},{key:"isViewCustomizable",value:function(){return this.totalParts>1&&(1==this.numVisibleParts||this.useIndividualPartInfo)}},{key:"layoutPropertyChange",value:function(t){var e=t.property.toString();return"title"!=e&&("composer"!=e&&"lyricist"!=e&&"copyright"!=e&&"arranger"!=e||(A.is(t.oldValue,String)&&t.oldValue.toString().search(/[\n\r]/)>=0||A.is(t.newValue,String)&&t.newValue.toString().search(/[\n\r]/)>=0))}},{key:"visibleStavesAtMeasure",value:function(t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=this.parts[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.visible){var u=!0,h=!1,c=void 0;try{for(var d,f=l.staves[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;y.getMeasureAt(A.intToUint(t)).canHideStaff&&this.displayMode!=e.STRIP_DISPLAY||i.push(y)}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}},{key:"getMeasureIdsInSystemMeasure",value:function(t,e){for(var i=-1,n=this.staves.concat(this.systemStaff),r=0;r<n.length;r++)if(n[r].id==e)for(var o=0;o<n[r].measures.length;o++)if(n[r].measures[o].id==t){i=n[r].measures[o].index;break}return-1==i?[]:n.map(function(t){for(var e=0;e<t.measures.length;e++)if(t.measures[e].index==i)return t.measures[e].id})}},{key:"getMeasureByIndexAndStaffIndex",value:function(t,e){return this.staves[e].getMeasureAt(t)}},{key:"toggleMediaSynced",value:function(){this.synchronizedTrack&&(this.synchronizedTrack.muted=!this.synchronizedTrack.muted)}},{key:"getStaffById",value:function(t){for(var e=0;e<this.staves.length;e++)if(this.staves[e].id==t)return this.staves[e];return null}},{key:"getStaffIndex",value:function(t){for(var e=0,i=0;i<this.parts.length;i++){if(i==t)return e;e+=this.parts[i].staves.length}return e}},{key:"soloMediaTrack",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.muted=!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this.synchronizedTrack&&(this.synchronizedTrack.muted=!1)}},{key:"playAll",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.muted=!1}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"getSystemStaffMeasureAt",value:function(t){return this.systemStaff.getMeasureAt(A.intToUint(t))}},{key:"showAllParts",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.visible=!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"getMeasureForBreakInfo",value:function(t){if(!this.staffMetrics.scoreDisplayRespectSystemBreaks)return null;var e=A.unknownToType(this.visibleStaves[0],Rl);this.useIndividualPartInfo&&this.totalParts>1&&(e=this.useIndividualPartInfo.staves[0]);var i=this.visibleParts.length;return(i>1||1==this.totalParts||1==i&&this.effectiveStaffMetrics.partDisplayRespectSystemBreaks)&&(e=this.systemStaff),e?e.getMeasureAt(A.numberToUint(t)):null}},{key:"getBreak",value:function(t){var e=this.getMeasureForBreakInfo(t);return e?e.breakType:null}},{key:"setBreak",value:function(t,e){var i=this.getMeasureForBreakInfo(t);i&&(i.breakType=e)}},{key:"applyBreak",value:function(t,e){var i=this.getMeasureForBreakInfo(t);i&&(i.breakType==e?(i.breakType=null,i.disableCautionaries=!1):i.breakType=e)}},{key:"forceCompletion",value:function(){this._forceComplete=!0}},{key:"addChildAt",value:function(t,i){s(h(e.prototype),"addChildAt",this).call(this,t,i);var n=A.unknownToType(t,Rl);t.addEventListener(zi.SPAN_CHANGE,xt.bindMethod(this,this.handleSpanChange));var r=n.part;null!=r&&this.registerPart(r)}},{key:"removeChildAt",value:function(t){var i=A.unknownToType(this.getChildAt(t),Rl),n=i.part;null==n||this.isPartReferencedByAnotherStaff(n,i)||(n.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),n.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),n.removeEventListener(Ri.ERROR_LOADING_INSTRUMENT,xt.bindMethod(this,this.handleErrorLoadingInstrument))),1==n.staves.length&&this.removeCustomizationsForView(n.id),s(h(e.prototype),"removeChildAt",this).call(this,t)}},{key:"removeCustomizationsForView",value:function(t){for(var e=0;e<this.systemStaff.measures.length;e++)for(var i=this.systemStaff.measures[e].measureElements,n=0;n<i.length;n++)i[n].removeCustomizationForView(t)}},{key:"isPartReferencedByAnotherStaff",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=this.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a!=e&&a.part==t)return!0}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return!1}},{key:"dispatchModelEvent",value:function(t){s(h(e.prototype),"dispatchModelEvent",this).call(this,t),t.parent==this&&this.dispatchEvent(new Wi(Wi.STAFF_CHANGE))}},{key:"registerPart",value:function(t){t.parent!=this&&(t.parent=this,t.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange),!1,0,!0),t.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate),!1,0,!0),t.addEventListener(Ri.ERROR_LOADING_INSTRUMENT,xt.bindMethod(this,this.handleErrorLoadingInstrument),!1,0,!0))}},{key:"handleErrorLoadingInstrument",value:function(t){this.dispatchEvent(t)}},{key:"addStaff",value:function(t){return this.addChild(t),t}},{key:"addStaffAt",value:function(t,e){return this.addChildAt(t,e),t}},{key:"getStaffAt",value:function(t){return A.as(this.getChildAt(t),Rl)}},{key:"pathToChild",value:function(t){return t==this.systemStaff?e.SYSTEM_STAFF_PATH_PREFIX:t==this.staffMetrics?e.STAFF_METRICS_PATH_PREFIX:t==this.pageMetrics?e.PAGE_METRICS_PATH_PREFIX:t==this.performanceMetrics?e.PERFORMANCE_METRICS_PATH_PREFIX:t==this.mix?e.SCORE_MIX_PATH_PREFIX:s(h(e.prototype),"pathToChild",this).call(this,t)}},{key:"resolvePathComponent",value:function(t){return t==e.SYSTEM_STAFF_PATH_PREFIX?this.systemStaff:t==e.STAFF_METRICS_PATH_PREFIX?this.staffMetrics:t==e.PAGE_METRICS_PATH_PREFIX?this.pageMetrics:t==e.PERFORMANCE_METRICS_PATH_PREFIX?this.performanceMetrics:t==e.SCORE_MIX_PATH_PREFIX?this.mix:s(h(e.prototype),"resolvePathComponent",this).call(this,t)}},{key:"movePart",value:function(t,e){for(var i=this.parts[t].staves,n=this.getStaffIndex(t),r=0;r<i.length;r++)this.removeChildAt(A.intToUint(n));var o=this.getStaffIndex(e);for(r=0;r<i.length;r++)this.addChildAt(A.unknownToType(i[r],se),A.intToUint(o+r))}},{key:"insertBlankStaffAt",value:function(t,e,i){this.addChildAt(t,A.intToUint(e));for(var n=0;n<this.numMeasures;n++){var r=new hl,o=this.systemStaff.getMeasureAt(A.intToUint(n));r.clef=A.as(i.clone(),Mn),i.parent=r,r.measureInfo=o.measureInfo.clone(),t.addMeasureAt(r,A.intToUint(n)),r.addElement(new Gl,0)}}},{key:"insertBlankMeasureAt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=A.numberToUint(Math.max(0,t-1)),n=new hl,r=this.systemStaff.getMeasureAt(i);if(e)n.measureInfo=e;else{var o=r.measureInfo.clone();o.timeSignature=r.baseTimeSignature,n.measureInfo=o}this.systemStaff.addMeasureAt(n,A.intToUint(t));var s=new En(n.duration);if(t==this.numMeasures-1){s.type=En.FINAL;var a=r.barlineNotation;null!=a&&a.type==En.FINAL&&(a.type=En.SINGLE)}n.addElement(s,Kl.NON_METRICAL_VOICE_NUMBER);var l=!0,u=!1,h=void 0;try{for(var c,d=this.staves[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;A.unknownToType(f,Rl).insertBlankMeasureAt(t,n.measureInfo)}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}},{key:"insertScoreMeasureAt",value:function(t,e,i){var n=A.as(t.systemStaff.getMeasureAt(A.intToUint(e)).clone(),hl);if(i==this.numMeasures){var r=this.systemStaff.getMeasureAt(A.intToUint(i-1)).barlineNotation,o=n.barlineNotation;null!=o&&(o.type=En.FINAL),null!=r&&r.type==En.FINAL&&(r.type=En.SINGLE)}this.systemStaff.addMeasureAt(n,A.intToUint(i));for(var s=0;s<this.staves.length;s++){var a=A.numberToInt(Math.min(s,t.staves.length-1));n=A.as(t.getStaffAt(A.intToUint(a)).getMeasureAt(A.intToUint(e)).clone(),hl),s<t.staves.length?(this.getStaffAt(A.intToUint(s)).addMeasureAt(n,A.intToUint(i)),n.calculateDerived(!0)):this.getStaffAt(A.intToUint(s)).insertBlankMeasureAt(i,n.measureInfo)}}},{key:"insertMeasureAfter",value:function(t){t.measure.index+1>=this.numMeasures&&this.insertBlankMeasureAt(t.measure.index+1);var e=t.measure.staff.getMeasureAt(A.intToUint(t.measure.index+1));if(t.voiceNumber>=e.numVoices){var i=new Kl;e.addChildAt(i,A.intToUint(t.voiceNumber+1));var n=new Gl;i.addElement(n)}}},{key:"insertScoreAt",value:function(t,e){for(var i=0;i<t.numMeasures;i++)this.insertScoreMeasureAt(t,i,e+i)}},{key:"ensureDuration",value:function(t,e,i){for(;t<this.numMeasures&&i>0;)i-=this.systemStaff.getMeasureAt(A.intToUint(t)).duration-e,e=0,t++;for(;i>0;)this.insertBlankMeasureAt(t),i-=this.systemStaff.getMeasureAt(A.intToUint(t)).duration,t++}},{key:"resetMeasureNumbers",value:function(){this.systemStaff.getMeasureAt(0).resetMeasureNumber()}},{key:"clearMeasureNumbersCache",value:function(){this.systemStaff.getMeasureAt(0).clearMeasureNumberCache()}},{key:"setTempoAtMeasure",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yl.MAX_VALUE,n=this.systemStaff.getMeasureAt(e).tempo,r=e;r<this.numMeasures;r++){var o=this.systemStaff.getMeasureAt(A.intToUint(r));if(i!=yl.MAX_VALUE?r==i:!o.tempo.equals(n))return void this.defaultSystemMeasureNotations(r,!0);o.tempo=t,null!=o.tempoNotation&&o.removeElement(o.tempoNotation),r==e&&this.defaultSystemMeasureNotations(r,!0);var s=!0,a=!1,l=void 0;try{for(var u,h=this.staves[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;A.unknownToType(c,Rl).getMeasureAt(A.intToUint(r)).tempo=t}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}}},{key:"defaultMeasureBoundary",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.defaultSystemMeasureNotations(t,e);var i=!0,n=!1,r=void 0;try{for(var o,s=this.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl);l.defaultClefChanges(t),t<this.numMeasures&&l.getMeasureAt(A.intToUint(t)).cleanUpLiaisons(!0)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"defaultSystemMeasureNotations",value:function(t,e){var i,n;if(!(t>this.numMeasures))if(t!=this.numMeasures)if(i=this.systemStaff.getMeasureAt(A.intToUint(t)),0===t)e&&(i.timeSignature.visibility!=zl.HIDDEN_VISIBILITY&&null==i.timeSignatureNotation?i.addElement(A.as(i.timeSignature.clone(),zl),Kl.NON_METRICAL_VOICE_NUMBER):i.timeSignature.visibility==zl.HIDDEN_VISIBILITY&&null!=i.timeSignatureNotation&&i.removeElement(i.timeSignatureNotation)),i.addTempoNotation();else{var r=(n=this.systemStaff.getMeasureAt(A.intToUint(t-1))).timeSignatureNotation;if(e){var o=!i.timeSignature.equals(n.timeSignature)&&(null==r||!i.timeSignature.equals(r))&&i.timeSignature.visibility!=zl.HIDDEN_VISIBILITY||i.timeSignature.visibility==zl.SHOWN_VISIBILITY;o&&null==i.timeSignatureNotation?i.addElement(A.as(i.timeSignature.clone(),zl),Kl.NON_METRICAL_VOICE_NUMBER):o||null==i.timeSignatureNotation||i.removeElement(i.timeSignatureNotation)}if(!i.tempo.equals(n.tempo)?i.addTempoNotation():null!=i.tempoNotation&&i.removeElement(i.tempoNotation),i.keySignature.equals(n.keySignature))i.keySignature.equals(n.keySignature)&&null!=n.keySignatureNotation&&(n.removeElement(n.keySignatureNotation),null!=n.barlineNotation&&(n.barlineNotation.type=En.SINGLE));else{var s=A.as(i.keySignature.clone(),Ga);s.cancel=n.keySignature.fifths,s.rhythmPosition=A.numberToUint(n.duration),null!=n.keySignatureNotation&&n.removeElement(n.keySignatureNotation),n.addElement(s,Kl.NON_METRICAL_VOICE_NUMBER),null!=n.barlineNotation&&(n.barlineNotation.type=En.DOUBLE)}}else null!=(n=this.systemStaff.getMeasureAt(A.intToUint(t-1))).keySignatureNotation&&n.removeElement(n.keySignatureNotation)}},{key:"rangeDuration",value:function(t,e){return this.systemStaff.rangeDuration(t,e)}},{key:"offsetPosition",value:function(t,e,i){return this.systemStaff.offsetPosition(t,e,i)}},{key:"handleSpanChange",value:function(t){this.dispatchEvent(t)}},{key:"showPartNameNextToStaff",value:function(t){return this.effectiveStaffMetrics.showPartNames&&(this.parts.length>1&&(1==this.numVisibleParts||this.useIndividualPartInfo)&&this.effectiveStaffMetrics.partNamePosition==pn.PART_NAME_POSITION_STAFF||this.parts.length>1&&this.numVisibleParts>1&&null==this.useIndividualPartInfo||1==this.parts.length&&this.effectiveStaffMetrics.partNamePosition==pn.PART_NAME_POSITION_STAFF)&&(0===t||this.numVisibleParts>1&&null==this.useIndividualPartInfo)}},{key:"showPartNameAtTopLeftOfThePage",value:function(t){return this.effectiveStaffMetrics.showPartNames&&(1==this.numVisibleParts||this.useIndividualPartInfo)&&this.effectiveStaffMetrics.partNamePosition==pn.PART_NAME_POSITION_TOP_LEFT_OF_THE_PAGE&&(0===t||this.effectiveStaffMetrics.showPartNamesOnEveryPage)}},{key:"toggleAudioWaveforms",value:function(){var t=!this.audioWaveformsShown,e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.showAudioWaveform=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"addSampleRecordingObjects",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)for(var s=r.value;s.numChildren>0;)s.removeChildAt(0)}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}for(var a=0;a<t.length;a++){var l=t[a],u=this.parts[l.partIdx],h=this.createSampleClip(l),c=new wl;c.gain=a+1,c.pan=.1*a,c.playbackEnabled=A.unknownToBoolean(l.enabled),c.addAudioClip(h),c.user.userId=A.unknownToString(l.userId),u.addAudioTrack(c)}}},{key:"createSampleClip",value:function(t){var e=Yc.createAudioMedia();e.mediaId=A.unknownToString(t.result.media_id),e.mediaFileId=A.unknownToString(t.result.media_file_id),e.contentType=A.unknownToString(t.result.content_type),e.channelCount=A.unknownToInt(t.result.channel_count1),e.sampleRate=A.unknownToNumber(t.result.sample_rate),e.duration=A.unknownToNumber(t.result.duration);var i=new Ma;return i.trackStartTime=A.unknownToNumber(t.startTime?t.startTime:0),i.mediaStartTime=0,i.mediaEndTime=e.duration,i.audioMedia=e,i}},{key:"getTracksUserIds",value:function(){for(var t=[],e=0;e<this.parts.length;e++)for(var i=this.parts[e].recordedAudioTracks,n=0;n<i.length;n++)-1==t.indexOf(i[n].user.userId)&&t.push(i[n].user.userId);return t}},{key:"setTracksUserInformation",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=!0,l=!1,u=void 0;try{for(var h,c=s.recordedAudioTracks[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToType(d,wl);f.user.userId==t.userId&&(f.user=t)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"assignPartIds",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;null!=o.id&&""!==o.id||(o.id=Qg.uuid())}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"findPartWithId",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.staves[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value.part;if(null!=s&&s.id==t)return s}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"findAudioMediaWithId",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.staves[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value.part;if(null!=s&&s.id==t){var a=!0,l=!1,u=void 0;try{for(var h,c=s.audioTracks[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if(d instanceof wl){var f=!0,y=!1,g=void 0;try{for(var p,m=d.audioClips[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value;if(v instanceof Ma){var _=v.audioMedia;if(null!=_&&_.id==t)return _}}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"createDraftSynchronizedTrack",value:function(){var t=this.synchronizedTrack,e=t?t.clone():null;this.draftSynchronizedTrack=e}},{key:"isDraftSynchronizedTrackChanged",value:function(){return null!=this.draftSynchronizedTrack&&!Jl.equals(this.draftSynchronizedTrack,this.synchronizedTrack)}},{key:"saveDraftSynchronizedTrack",value:function(){this.synchronizedTrack=this.draftSynchronizedTrack,this.draftSynchronizedTrack=null}},{key:"discardDraftSynchronizedTrack",value:function(){this.draftSynchronizedTrack=null}},{key:"staffMetrics",get:function(){return this._staffMetrics},set:function(t){var e=this._staffMetrics,i=!1;this._staffMetrics&&(i=!0,this._staffMetrics.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._staffMetrics.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),this._staffMetrics=t,this._staffMetrics.parent=this,this._staffMetrics.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._staffMetrics.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),i&&this.dispatchModelEvent(new Di(Di.MODEL_UPDATE,"staffMetrics",e,this._staffMetrics,this))}},{key:"mix",get:function(){return this._$mix},set:function(t){var e=this._$mix;this._$mix=t,e!==t&&this._propertyChanged("mix",e,t)}},{key:"systemStaff",get:function(){return this._$systemStaff},set:function(t){var e=this._$systemStaff;this._$systemStaff=t,e!==t&&this._propertyChanged("systemStaff",e,t)}},{key:"title",get:function(){return this._$title},set:function(t){var e=this._$title;this._$title=t,e!==t&&this._propertyChanged("title",e,t)}},{key:"lockTitle",get:function(){return this._$lockTitle},set:function(t){var e=this._$lockTitle;this._$lockTitle=t,e!==t&&this._propertyChanged("lockTitle",e,t)}},{key:"subtitle",get:function(){return this._$subtitle},set:function(t){var e=this._$subtitle;this._$subtitle=t,e!==t&&this._propertyChanged("subtitle",e,t)}},{key:"supertitle",get:function(){return this._$supertitle},set:function(t){var e=this._$supertitle;this._$supertitle=t,e!==t&&this._propertyChanged("supertitle",e,t)}},{key:"composer",get:function(){return this._$composer},set:function(t){var e=this._$composer;this._$composer=t,e!==t&&this._propertyChanged("composer",e,t)}},{key:"lockComposer",get:function(){return this._$lockComposer},set:function(t){var e=this._$lockComposer;this._$lockComposer=t,e!==t&&this._propertyChanged("lockComposer",e,t)}},{key:"lyricist",get:function(){return this._$lyricist},set:function(t){var e=this._$lyricist;this._$lyricist=t,e!==t&&this._propertyChanged("lyricist",e,t)}},{key:"lockLyricist",get:function(){return this._$lockLyricist},set:function(t){var e=this._$lockLyricist;this._$lockLyricist=t,e!==t&&this._propertyChanged("lockLyricist",e,t)}},{key:"arranger",get:function(){return this._$arranger},set:function(t){var e=this._$arranger;this._$arranger=t,e!==t&&this._propertyChanged("arranger",e,t)}},{key:"showArranger",get:function(){return this._$showArranger},set:function(t){var e=this._$showArranger;this._$showArranger=t,e!==t&&this._propertyChanged("showArranger",e,t)}},{key:"copyright",get:function(){return this._$copyright},set:function(t){var e=this._$copyright;this._$copyright=t,e!==t&&this._propertyChanged("copyright",e,t)}},{key:"lockCopyright",get:function(){return this._$lockCopyright},set:function(t){var e=this._$lockCopyright;this._$lockCopyright=t,e!==t&&this._propertyChanged("lockCopyright",e,t)}},{key:"prompt",get:function(){return this._$prompt},set:function(t){var e=this._$prompt;this._$prompt=t,e!==t&&this._propertyChanged("prompt",e,t)}},{key:"footer",get:function(){return this._$footer},set:function(t){var e=this._$footer;this._$footer=t,e!==t&&this._propertyChanged("footer",e,t)}},{key:"lockFooter",get:function(){return this._$lockFooter},set:function(t){var e=this._$lockFooter;this._$lockFooter=t,e!==t&&this._propertyChanged("lockFooter",e,t)}},{key:"transposeParts",get:function(){return this._$transposeParts},set:function(t){var e=this._$transposeParts;this._$transposeParts=t,e!==t&&this._propertyChanged("transposeParts",e,t)}},{key:"defaultSlurs",get:function(){return this._$defaultSlurs},set:function(t){var e=this._$defaultSlurs;this._$defaultSlurs=t,e!==t&&this._propertyChanged("defaultSlurs",e,t)}},{key:"playbackMode",get:function(){return this._$playbackMode},set:function(t){var e=this._$playbackMode;this._$playbackMode=t,e!==t&&this._propertyChanged("playbackMode",e,t)}},{key:"displayMode",get:function(){return this._$displayMode},set:function(t){var e=this._$displayMode;this._$displayMode=t,e!==t&&this._propertyChanged("displayMode",e,t)}},{key:"viewScale",get:function(){return this._$viewScale},set:function(t){var e=this._$viewScale;this._$viewScale=t,e!==t&&this._propertyChanged("viewScale",e,t)}},{key:"synchronizedTrack",get:function(){return this._$synchronizedTrack},set:function(t){var e=this._$synchronizedTrack;this._$synchronizedTrack=t,e!==t&&this._propertyChanged("synchronizedTrack",e,t)}},{key:"pageMetrics",get:function(){return this._pageMetrics},set:function(t){var e=this._pageMetrics,i=!1;this._pageMetrics&&(i=!0,this._pageMetrics.removeEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._pageMetrics.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate))),this._pageMetrics=t,this._pageMetrics.parent=this,this._pageMetrics.addEventListener(Ri.MODEL_CHANGE,xt.bindMethod(this,this.handleChildModelChange)),this._pageMetrics.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleChildModelUpdate)),i&&this.dispatchModelEvent(new Di(Di.MODEL_UPDATE,"pageMetrics",e,this._pageMetrics,this))}},{key:"effectiveStaffMetrics",get:function(){if(1==this.numVisibleParts&&this.parts.length>1){var t=this.visibleParts[0];if(t.staffMetrics)return t.staffMetrics}return this.useIndividualPartInfo&&this.useIndividualPartInfo.staffMetrics?this.useIndividualPartInfo.staffMetrics:this._staffMetrics}},{key:"effectivePageMetrics",get:function(){if(1==this.numVisibleParts&&this.parts.length>1){var t=this.visibleParts[0];if(t.pageMetrics)return t.pageMetrics}return this.useIndividualPartInfo&&this.useIndividualPartInfo.pageMetrics?this.useIndividualPartInfo.pageMetrics:this._pageMetrics},set:function(t){1==this.numVisibleParts&&this.parts.length>1&&(this.visibleParts[0].pageMetrics=t);this.pageMetrics=t}},{key:"performanceMetrics",get:function(){return this._$performanceMetrics},set:function(t){var e=this._$performanceMetrics;this._$performanceMetrics=t,e!==t&&this._propertyChanged("performanceMetrics",e,t)}},{key:"customizationForViewId",get:function(){return this.isViewCustomizable()?this.useIndividualPartInfo?this.useIndividualPartInfo.id:this.visibleParts[0].id:null}},{key:"atonalKeySignatureMeasures",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.staves[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=!0,l=!1,u=void 0;try{for(var h,c=s.measures[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;d.isAtonalKeySignature&&t.push(d)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"staves",get:function(){return this._children}},{key:"visibleStaves",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(s.visible){var a=!0,l=!1,u=void 0;try{for(var h,c=s.staves[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;t.push(d)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"numVisibleStaves",get:function(){return this.visibleStaves.length}},{key:"numVisibleParts",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.visible&&t++}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"visibleParts",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.visible&&t.push(s)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"firstVisiblePartAtFirstMeasure",get:function(){var t=A.unknownToType(this.visibleStavesAtMeasure(0)[0],Rl);return t?t.part:null}},{key:"audibleStaves",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(!s.muted){var a=!1,l=!0,u=!1,h=void 0;try{for(var c,d=s.audioTracks[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;if(A.unknownToType(f,ba).playbackEnabled){a=!0;break}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}if(!s.noteflightTrackMuted||a){var y=!0,g=!1,p=void 0;try{for(var m,v=s.staves[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){var _=m.value;t.push(_)}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}}}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"totalInvisibleParts",get:function(){return this.parts.length-this.numVisibleParts}},{key:"parts",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.staves[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Rl);t.indexOf(a.part)<0?(t.push(a.part),a.part.staves=[a]):a.part.staves.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"totalParts",get:function(){return this.parts.length}},{key:"complete",get:function(){if(this._forceComplete)return!0;if(this.playbackMode==e.PLAYBACK_MODE_NORMAL){var t=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;if(null==s.instrument||!s.instrument.complete)return!1}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}return!(this.synchronizedTrack&&!this.synchronizedTrack.complete)}},{key:"numMeasures",get:function(){return A.intToUint(this.systemStaff.numChildren)}},{key:"numStaves",get:function(){return A.intToUint(this.numChildren)}},{key:"isAudioTrackDisplayable",get:function(){return!1}},{key:"isPaginatedMode",get:function(){return this.displayMode==e.PAGINATED_DISPLAY}},{key:"isFlowMode",get:function(){return this.displayMode==e.FLOW_DISPLAY}},{key:"isStripMode",get:function(){return this.displayMode==e.STRIP_DISPLAY}},{key:"isPerformMode",get:function(){return this.displayMode==e.PERFORM_DISPLAY}},{key:"displayModeHasPages",get:function(){return this.isPaginatedMode||this.isFlowMode||this.isPerformMode}},{key:"hasSlurs",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.staves[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){if(n.value.hasSlurs)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"path",get:function(){return""}},{key:"initialTempo",get:function(){var t=this.systemStaff.getMeasureAt(0).tempo;return null==t&&(t=new Yl),t},set:function(t){this.setTempoAtMeasure(t,0)}},{key:"partsPageOrientations",get:function(){for(var t=[],e=0;e<this.parts.length;e++){var i=this.parts[e].pageMetrics?this.parts[e].pageMetrics.orientation:this.pageMetrics.orientation;t.push(i)}return t}},{key:"isAnyPartHidden",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.parts[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){if(!n.value.visible)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"initialKey",get:function(){return this.systemStaff.getMeasureAt(0).keySignature}},{key:"partsWithAudioMedias",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.hasTracks&&t.push(s)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"hasTracks",get:function(){return this.partsWithAudioMedias.length>0}},{key:"audioWaveformsShown",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.partsWithAudioMedias[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;if(A.unknownToType(o,El).showAudioWaveform)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"audioMedias",get:function(){var t=[],e=new Uy,i=!0,n=!1,r=void 0;try{for(var o,s=this.parts[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=!0,u=!1,h=void 0;try{for(var c,d=a.recordedAudioTracks[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,y=A.unknownToType(f,wl),g=!0,p=!1,m=void 0;try{for(var v,_=y.audioClips[Symbol.iterator]();!(g=(v=_.next()).done);g=!0){var S=v.value,L=A.unknownToType(S,Ma).audioMedia;e.get(L)||(t.push(L),e.put(L,!0))}}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}},{key:"unpersistedAudioMedias",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.audioMedias[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Yc);a.mediaFileData&&!a.mediaFileId&&t.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}}]),e}();r.registerClass(Nl,"com.noteflight.notation.model.Score");var Al=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$masterGain=0,t._$reverbLevel=-7,t._$reverbType=e.DEFAULT_REVERB_TYPE,t}return c(e,se),p(e,null,[{key:"DEFAULT_REVERB_TYPE",get:function(){return"Medium"}}]),p(e,[{key:"equals",value:function(t){var i=A.as(t,e);return i&&this.masterGain==i.masterGain&&this.reverbLevel==i.reverbLevel&&this.reverbType==i.reverbType}},{key:"masterGain",get:function(){return this._$masterGain},set:function(t){var e=this._$masterGain;this._$masterGain=t,e!==t&&this._propertyChanged("masterGain",e,t)}},{key:"reverbLevel",get:function(){return this._$reverbLevel},set:function(t){var e=this._$reverbLevel;this._$reverbLevel=t,e!==t&&this._propertyChanged("reverbLevel",e,t)}},{key:"reverbType",get:function(){return this._$reverbType},set:function(t){var e=this._$reverbType;this._$reverbType=t,e!==t&&this._propertyChanged("reverbType",e,t)}}]),e}();r.registerClass(Al,"com.noteflight.notation.model.ScoreMix");var Il=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return y(this,e),l(this,h(e).call(this,t))}return c(e,Pa),e}();r.registerClass(Il,"com.noteflight.notation.model.Segno");var Pl=function(){function t(){y(this,t),this._elements=[],this._duration=0,this._singleVoice=!0}return p(t,[{key:"addElement",value:function(t){this._singleVoice&&this._elements.length>0&&t.lastVoiceNumber!=this._elements[this._elements.length-1].lastVoiceNumber&&(this._singleVoice=!1),this._duration=Math.max(this._duration,t.rhythmPosition+t.rhythmDuration);for(var e=0;e<this._elements.length;e++)if(t.rhythmPosition<this._elements[e].rhythmPosition)return void this._elements.splice(e,0,t);this._elements.push(t)}},{key:"mergeToStaff",value:function(t,e,i){var n=0,r=!0,o=!1,s=void 0;try{for(var a,l=this.elements[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;e=t.offsetPosition(e,u.rhythmPosition-n,!1),A.is(u,vl)&&0!==e.position||(t.mergeElement(u,e,i),n=u.rhythmPosition)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"elements",get:function(){return this._elements}},{key:"singleVoiceNumber",get:function(){return this._singleVoice&&this._elements.length>0?this.elements[0].lastVoiceNumber:Kl.UNKNOWN_VOICE_NUMBER}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}}]),t}();r.registerClass(Pl,"com.noteflight.notation.model.Sequence");var Ol=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(t=l(this,h(e).call(this,i,n,r,o,s)))._$cx1=0,t._$cy1=0,t._$cx2=0,t._$cy2=0,t._$slurHeight=0,t._$slurArticulation=null,t.preventDurationDefault=!1,t.direction=he.DIRECTION_UP,t}return c(e,Ua),p(e,null,[{key:"HAMMER_ON_ARTICULATION",get:function(){return"hammerOn"}},{key:"PULL_OFF_ARTICULATION",get:function(){return"pullOff"}},{key:"ARTICULATION_FRIENDLY_NAMES",get:function(){return Ql}}]),p(e,[{key:"setDefaultInfo",value:function(t){var e,i,n,r,o=t.grace&&0===this.span,s=A.is(this.measure.effectiveClef,$l);if(t.staffMetrics.ignoreSlurDirection||null==this.defaultDirection?t.multiVoice?(e=t.multiVoiceDown,o=!1):e=!(!o||s)||!t.notesDown:e=this.defaultDirection==he.DIRECTION_DOWN,this.direction=e?he.DIRECTION_DOWN:he.DIRECTION_UP,t.empty)this.dx=this.dy=this.endx=this.ascent=0;else{this.dx>=0&&(this.dx=t.startNoteWidth*(s?.75:.5));var a=A.unknownToType(t.notePlacements[0],vs),l=A.unknownToType(t.notePlacements[t.notePlacements.length-1],vs);if(o&&!s&&t.notesDown&&!0===l.hasStem)this.endx=.25*-t.endNoteWidth,this.dy=a.bottom,this.ascent=.25*(l.bottom-this.dy);else if(e){if(this.endx<=t.endNoteWidth&&(this.endx=t.endNoteWidth*(s?.25:.5)),this.dy=a.bottom-(s?.3:0),this.ascent=s?0:l.bottom-this.dy,(i=l.x-a.x)>0){var u=0,h=!0,c=!1,d=void 0;try{for(var f,y=t.notePlacements[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value;n=this.dy+this.ascent*(g.x-a.x)/i,0!==(r=this.getSlurScaleAtOffset(i,A.unknownToNumber(g.x)))&&(r=Math.max(t.staffMetrics.slurMinNormalizedHeight,r),u=Math.min(u,(g.bottom-n)/r))}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}this.slurHeight=u}}else if(this.endx<=t.endNoteWidth&&(this.endx=t.endNoteWidth*(s?.25:.5)),this.dy=a.top+(s?.3:0),this.ascent=s?0:l.top-this.dy,(i=l.x-a.x)>0){var p=0,m=!0,v=!1,_=void 0;try{for(var S,L=t.notePlacements[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var k=S.value;n=this.dy+this.ascent*(k.x-a.x)/i,0!==(r=this.getSlurScaleAtOffset(i,A.unknownToNumber(k.x)))&&(r=Math.max(t.staffMetrics.slurMinNormalizedHeight,r),p=Math.max(p,(k.top-n)/r))}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}this.slurHeight=p}this.preventDurationDefault||(this.span=t.startEndSpan)}this.cx1=0,this.cx2=0,this.cy1=0,this.cy2=0}},{key:"getSlurScaleAtOffset",value:function(t,e){return e=Math.max(0,Math.min(1,Math.abs(e-.5*t)/(.5*t))),Math.sqrt(1-e*e)}},{key:"slurHeightAtPointWithBezierApproximation",value:function(t){var e=this.dy,i=this.dy+this.ascent,n=e+4/3*this.slurHeight,r=n+this.ascent,o=t/this.span;return Nc.cubicBezierCurve(o,e,n,r,i)}},{key:"slurRiseRate",value:function(t){var e=this.dy,i=e+this.ascent,n=e+4/3*this.slurHeight,r=n+this.ascent,o=t/this.span;return Nc.cubicBezierCurveDerivativeCoord(o,e,n,r,i)}},{key:"getMaxHeightInSegment",value:function(t,e){if(0===t&&e==this.span)return this.direction==he.DIRECTION_UP?this.top:this.bottom;var i=this.slurHeightAtPointWithBezierApproximation(t),n=this.slurHeightAtPointWithBezierApproximation(e);if(0===t){var r=this.slurRiseRate(e);return this.direction==he.DIRECTION_UP&&r<=0?this.top:this.direction==he.DIRECTION_DOWN&&r>=0?this.bottom:n}if(0!==t&&e==this.span){var o=this.slurRiseRate(t);return this.direction==he.DIRECTION_UP&&o>=0?this.top:this.direction==he.DIRECTION_DOWN&&o<=0?this.bottom:i}if(0!==t&&e!=this.span){var s=this.slurRiseRate(t),a=this.slurRiseRate(e),l=s/Math.abs(s)!=a/Math.abs(a);if(this.direction==he.DIRECTION_UP)return l?this.top:Math.max(i,n);if(this.direction==he.DIRECTION_DOWN)return l?this.bottom:Math.min(i,n)}}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.cx1=this.cx1,t.cy1=this.cy1,t.cx2=this.cx2,t.cy2=this.cy2,t.slurArticulation=this.slurArticulation,t}},{key:"cx1",get:function(){return this._$cx1},set:function(t){var e=this._$cx1;this._$cx1=t,e!==t&&this._propertyChanged("cx1",e,t)}},{key:"cy1",get:function(){return this._$cy1},set:function(t){var e=this._$cy1;this._$cy1=t,e!==t&&this._propertyChanged("cy1",e,t)}},{key:"cx2",get:function(){return this._$cx2},set:function(t){var e=this._$cx2;this._$cx2=t,e!==t&&this._propertyChanged("cx2",e,t)}},{key:"cy2",get:function(){return this._$cy2},set:function(t){var e=this._$cy2;this._$cy2=t,e!==t&&this._propertyChanged("cy2",e,t)}},{key:"slurHeight",get:function(){return this._$slurHeight},set:function(t){var e=this._$slurHeight;this._$slurHeight=t,e!==t&&this._propertyChanged("slurHeight",e,t)}},{key:"slurArticulation",get:function(){return this._$slurArticulation},set:function(t){var e=this._$slurArticulation;this._$slurArticulation=t,e!==t&&this._propertyChanged("slurArticulation",e,t)}},{key:"transposable",get:function(){return!0}},{key:"top",get:function(){return Math.max(this.dy,this.dy+this.ascent,this.dy+(this.cy1+this.cy2+this.ascent)/2,this.dy+this.slurHeight)}},{key:"bottom",get:function(){return Math.min(this.dy,this.dy+this.ascent,this.dy+(this.cy1+this.cy2+this.ascent)/2,this.dy+this.slurHeight)}},{key:"noteY",get:function(){return this.dy+(this.defaultDirection==he.DIRECTION_DOWN?1:-1)}}],[{key:"_staticInitializer",value:function(){e.ARTICULATION_FRIENDLY_NAMES[e.HAMMER_ON_ARTICULATION]="Hammer-on",e.ARTICULATION_FRIENDLY_NAMES[e.PULL_OFF_ARTICULATION]="Pull-off"}}]),e}(),Ql={};Ol._staticInitializer(),r.registerClass(Ol,"com.noteflight.notation.model.Slur");var Rl=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$type=null,t._$overrideClef=null,t._part=null,t.seenLyrics=!1,t.id=Qg.uuid(),t._spanNotations=[],t.type=new Ul,t}return c(e,se),p(e,[{key:"spanNotationsAt",value:function(t){return this._spanNotations[t]}},{key:"getMeasureAt",value:function(t){return A.as(this.getChildAt(t),hl)}},{key:"addMeasure",value:function(t){this.addChild(t)}},{key:"addMeasureAt",value:function(t,e){for(;this.numChildren<e;)this.addMeasure(new hl);this.addChildAt(t,e)}},{key:"addChildAt",value:function(t,i){var n,r=A.unknownToType(t,hl);if(null==this.score||this.isSystemStaff||(r.systemMeasure=this.score.systemStaff.getMeasureAt(i)),s(h(e.prototype),"addChildAt",this).call(this,t,i),i==this.numChildren-1){if(this._spanNotations[i]=[],i>0){var o=!0,a=!1,l=void 0;try{for(var u,c=this._spanNotations[i-1][Symbol.iterator]();!(o=(u=c.next()).done);o=!0)(n=u.value).endPosition.measureIndex>=i&&this._spanNotations[i].push(n)}catch(t){a=!0,l=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw l}}}}else{var d=this._spanNotations[i].slice(),f=!0,y=!1,g=void 0;try{for(var p,m=d[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)(n=p.value).measure.index<i&&this.removeSpanNotation(n)}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}this._spanNotations.splice(i,0,[]);var v=!0,_=!1,S=void 0;try{for(var L,k=d[Symbol.iterator]();!(v=(L=k.next()).done);v=!0)(n=L.value).measure.index<i&&this.addSpanNotation(n)}catch(t){_=!0,S=t}finally{try{v||null==k.return||k.return()}finally{if(_)throw S}}}var T=!0,E=!1,M=void 0;try{for(var b,w=r.spanNotations[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){var x=b.value;n=A.unknownToType(x,Ua),this.addSpanNotation(n)}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}r.seenLyrics&&(this.seenLyrics=!0)}},{key:"doRemoveChildAt",value:function(t){var i,n=this.getMeasureAt(t);if(null!=n){var r=!0,o=!1,a=void 0;try{for(var l,u=n.spanNotations[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;i=A.unknownToType(c,Ua),this.removeSpanNotation(i)}}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}s(h(e.prototype),"doRemoveChildAt",this).call(this,t);var d=this._spanNotations[t].slice();this._spanNotations.splice(t,1);var f=!0,y=!1,g=void 0;try{for(var p,m=d[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)(i=p.value).measure.index<t&&(this.removeSpanNotation(i),this.addSpanNotation(i))}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}}},{key:"removeMeasure",value:function(t){this.removeChild(t)}},{key:"handleChildModelChange",value:function(t){var i;if(s(h(e.prototype),"handleChildModelChange",this).call(this,t),A.is(t.child,Ua)){var n=A.as(t.child,Ua);t.kind==Ri.ADD_CHILD_MODEL?this.addSpanNotation(n):t.kind==Ri.REMOVING_CHILD_MODEL&&this.removeSpanNotation(n)}if(A.is(t.child,Ha)){var r,o=new Nu(A.as(t.child,Ha)).getNotations();if(t.kind==Ri.ADD_CHILD_MODEL){var a=!0,l=!1,u=void 0;try{for(var c,d=o[Symbol.iterator]();!(a=(c=d.next()).done);a=!0)i=c.value,r=A.unknownToType(i,he),A.is(r,Ua)&&this.addSpanNotation(A.as(r,Ua))}catch(t){l=!0,u=t}finally{try{a||null==d.return||d.return()}finally{if(l)throw u}}}else if(t.kind==Ri.REMOVING_CHILD_MODEL){var f=!0,y=!1,g=void 0;try{for(var p,m=o[Symbol.iterator]();!(f=(p=m.next()).done);f=!0)i=p.value,r=A.unknownToType(i,he),A.is(r,Ua)&&this.removeSpanNotation(A.as(r,Ua))}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}}}},{key:"handleChildModelUpdate",value:function(t){if(s(h(e.prototype),"handleChildModelUpdate",this).call(this,t),A.is(t.source,Ua)){var i=A.as(t.source,Ua);if("span"==t.property||"rhythmPosition"==t.property)this.removeSpanNotation(i),this.addSpanNotation(i);else for(var n="requestValidate"==t.property,r=i.measure.index;r<=i.endPosition.measureIndex;r++)this.dispatchSpanChange(r,n)}if(A.is(t.source,de)&&("step"===t.property||"pitch"===t.property)){for(var o=[],a=this.getSpanNotations(t.measureIndex),l=0;l<a.length;l++)a[l].rhythmPosition===t.source.rhythmPosition&&o.push(a[l]);for(var u=0;u<o.length;u++)A.is(o[u],Wl)&&o[u].recalculateTrill()}}},{key:"addSpanNotation",value:function(t){for(var e=t.measure.index,i=t.endPosition.measureIndex;e<=i&&e<this._spanNotations.length;){this._spanNotations[e].push(t),this.dispatchSpanChange(e),e++}}},{key:"removeSpanNotation",value:function(t){for(var e=t.measure.index;e<this._spanNotations.length;){var i=this._spanNotations[e],n=i.indexOf(t);if(n<0)return;i.splice(n,1),this.dispatchSpanChange(e),e++}}},{key:"dispatchSpanChange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.dispatchEvent(new zi(zi.SPAN_CHANGE,this.getMeasureAt(A.intToUint(t)),e))}},{key:"getSpanNotations",value:function(t){return this._spanNotations[t]}},{key:"getPerformanceSpans",value:function(t){var e=this.getSpanNotations(t);if(null==this.part||1==this.part.staves.length)return e;e=e.slice();var i=!0,n=!1,r=void 0;try{for(var o,s=this.part.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a!=this){var l=!0,u=!1,h=void 0;try{for(var c,d=a.getSpanNotations(t)[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value;f.affectsEntirePart&&e.push(f)}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"getSpanNotationsInRange",value:function(t,e){for(var i=new Uy,n=[],r=t;r<e;r++){var o=!0,s=!1,a=void 0;try{for(var l,u=this._spanNotations[r][Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;null==i.get(h)&&(n.push(h),i.put(h,h))}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}return n}},{key:"mergeElement",value:function(t,e,i){var n;if(A.is(t,mn)&&A.unknownToType(t,mn).metrical){if(A.is(t,Sn)&&0===A.unknownToType(t,Sn).notes.length){if(A.is(t,vl)){var r=this.getMeasureAt(e.measureIndex);r.removePositionRange(0,A.numberToInt(r.duration),Kl.UNKNOWN_VOICE_NUMBER),r.removeEmptyVoices(),(n=A.as(A.unknownToType(t,he).clone(),he)).rhythmPosition=A.numberToUint(e.position),r.addElement(n,n.lastVoiceNumber)}return}var o=A.as(A.unknownToType(t,mn).clone(),mn);i!=Kl.UNKNOWN_VOICE_NUMBER&&(o.lastVoiceNumber=i),this.applyToMeasureRanges(e,o.rhythmDuration,function(t,e,i,n,r){t.addValueNotationWithDuration(o,A.numberToInt(e),i,i<n,r)})}else if(A.is(t,Xl)){var s=A.as(A.unknownToType(t,Xl).clone(),Xl),a=this.getMeasureAt(e.measureIndex);e.position+s.rhythmDuration>a.duration?Gy.show(Ou.getString("alerts/cantMergeTuplet")):(s.rhythmPosition=A.numberToUint(e.position),i!=Kl.UNKNOWN_VOICE_NUMBER&&(s.lastVoiceNumber=i),a.addElement(s,s.lastVoiceNumber))}else(n=A.as(A.unknownToType(t,he).clone(),he)).rhythmPosition=A.numberToUint(e.position),this.getMeasureAt(e.measureIndex).addElement(n,n.lastVoiceNumber)}},{key:"offsetPosition",value:function(t,e,i){for(var n=t.measureIndex,r=t.position;;)if(e>0){var o=this.getMeasureAt(A.intToUint(n)).timeSignature;if(null==o)return new gl(A.intToUint(n),0);var s=A.numberToInt(o.meterDuration-r);if(e<s||i&&e==s)return new gl(A.intToUint(n),r+e);if(++n>=this.numChildren)return new gl(A.intToUint(n-1),this.getMeasureAt(A.intToUint(n-1)).duration);e-=s,r=0}else{if(!(e<0))return new gl(A.intToUint(n),r);if(-e<r||!i&&-e==r)return new gl(A.intToUint(n),r+e);if(--n<0)return new gl(0,0);e+=r,r=this.getMeasureAt(A.intToUint(n)).duration}return new gl(A.intToUint(n),r)}},{key:"rangeDuration",value:function(t,e){var i=t.compareTo(e);if(0===i)return 0;if(i>0){var n=t;t=e,e=n}for(var r=0,o=t.measureIndex;o<e.measureIndex;)r+=this.getMeasureAt(A.intToUint(o)).duration,o++;return r+=e.position-t.position,i>0?-r:r}},{key:"clearStaffRange",value:function(t,e,i){this.applyToMeasureRanges(t,e,function(t,e,n,r,o){t.removePositionRange(A.numberToInt(e),n,i)})}},{key:"addRests",value:function(t,e){this.applyToMeasureRanges(t,e,function(t,e,i,n,r){t.addRests()})}},{key:"applyToMeasureRanges",value:function(t,e,i){for(var n=t.measureIndex,r=t.position,o=!0;e>0;){var s=this.getMeasureAt(n),a=A.numberToInt(Math.min(e,s.duration-r));i(s,r,a,e,o),e-=a,r=0,n++,o=!1}}},{key:"defaultClefChanges",value:function(t){var e,i;if(!(t>this.score.numMeasures))if(t!=this.score.numMeasures)if(e=this.getMeasureAt(A.intToUint(t)),0===t);else{var n=(i=this.getMeasureAt(A.intToUint(t-1))).getNotatedClefAtMeasurePosition(i.duration);if(!e.clef.sameAs(n)){null!=i.finalClefNotation&&i.removeElement(i.finalClefNotation);var r=A.as(e.clef.clone(),Mn);r.rhythmPosition=A.numberToUint(i.duration),i.addElement(r,Kl.NON_METRICAL_VOICE_NUMBER)}}else{var o=(i=this.getMeasureAt(A.intToUint(t-1))).finalClefNotation;null!=o&&i.removeElement(o)}}},{key:"insertBlankMeasureAt",value:function(t,e){var i=A.numberToUint(Math.max(0,t-1)),n=new hl,r=this.getMeasureAt(i);n.clef=A.as(r.getEffectiveClefAtMeasurePosition(r.duration).clone(),Mn),n.measureInfo=e.clone(),this.addMeasureAt(n,A.intToUint(t)),n.addElement(new Gl,0)}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.type=this.type,t}},{key:"getPreviousNoteSet",value:function(t){for(var e=t[t.length-1];A.is(e,Xl);){var i=A.unknownToType(e,Xl);e=A.unknownToType(i.elements[i.elements.length-1],ue)}return A.as(e,Sn)}},{key:"transposeInterval",value:function(t,e,i){var n=$a.fromString(i);this._applyToNotes(t,function(t){if(t.playable){var e=t.transposeInterval(n);t.pitch=e.pitch,t.step=e.step,t.accidental=e.accidental,t.fret=-1}}),this._applyToNonNotes(e,function(t){if(A.is(t,Aa)){var e=A.as(t,Aa),i=e.transposeInterval(n);e.text=i.text}})}},{key:"_applyToNotes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!=i&&t.sort(i);var n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e(A.unknownToType(l,de))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"_applyToNonNotes",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){e(this,o.value)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"_enharmonicShift",value:function(t){var e,i,n=null,r=[],o=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(o=(l=u.next()).done);o=!0)n=l.value,A.is(n,de)?r.push(n):A.is(n,Sn)&&(r=r.concat(A.unknownToType(n,Sn).notes))}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}var h=[],c=!0,d=!1,f=void 0;try{for(var y,g=t[Symbol.iterator]();!(c=(y=g.next()).done);c=!0)n=y.value,(A.is(n,vl)||!A.is(n,de)&&!A.is(n,Sn))&&h.push(n)}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}if(1==t.length&&(A.is(t[0],de)||A.is(t[0],Sn)&&1==A.unknownToType(t[0],Sn).notes.length)){e=A.unknownToType(A.is(t[0],de)?t[0]:A.unknownToType(t[0],Sn).notes[0],de),i=new $a(1,0);var p=e.transposeInterval(i);p.step==(e.step+1)%7&&(-2!=p.alteration||p.step!=de.C&&p.step!=de.F)||(i=new $a(-2,0),(p=e.transposeInterval(i)).step==(e.step+5)%7&&(2!=p.alteration||p.step!=de.B&&p.step!=de.E)||(i=new $a(-1,0)))}else{var m=0;this._applyToNotes(r,function(t){t.playable&&(e=t.measure.getScoreNote(t,t.measure.scoreInterval),m+=e.alteration)}),i=new $a(m<0?-1:1,0)}this.transposeInterval(r,h,i.toString())}},{key:"improveSpelling",value:function(t,i){var n=this.getMeasureAt(t),r=i?n.previousMeasure:null,o=n.keySignature,s=null,a=n.getVoiceNumber(0).elements;if(r){var l=r.getVoiceNumber(0).elements;s=this.getPreviousNoteSet(l)}for(var u=function(t){var e=A.as(t,Sn);return null!=e&&e.notes.length>0},h=0;h<a.length;h++)for(var c=e.extractNoteSets([a[h]]),d=0;d<c.length;d++){var f=A.unknownToType(c[d],Sn);s=A.as(n.previousNotation(f.position,u,!0),Sn);for(var y=0;y<f.notes.length;y++){var g=null;s&&(g=s.findClosestMatchingPitch(f.notes[y].pitch.ordinal));var p=o.getNoteForPitch(f.notes[y].pitch,g);f.notes[y].step=p.step,f.notes[y].pitch=p.pitch}var m=f.normalizeSpelling(o);Math.abs(m)>f.notes.length&&this._enharmonicShift([f])}}},{key:"type",get:function(){return this._$type},set:function(t){var e=this._$type;this._$type=t,e!==t&&this._propertyChanged("type",e,t)}},{key:"overrideClef",get:function(){return this._$overrideClef},set:function(t){var e=this._$overrideClef;this._$overrideClef=t,e!==t&&this._propertyChanged("overrideClef",e,t)}},{key:"score",get:function(){return A.as(this.parent,Nl)}},{key:"part",get:function(){return this._part},set:function(t){var e=this._part;this._part=t,null!=this.score&&(this.score.registerPart(this._part),this.score.dispatchEvent(new Wi(Wi.STAFF_CHANGE)));var i=new Di(Di.MODEL_UPDATE,"part",e,t,this);this.dispatchModelUpdateEvent(i)}},{key:"isSystemStaff",get:function(){return null!=this.score&&this.score.systemStaff==this}},{key:"totalMeasures",get:function(){return this.numChildren}},{key:"measures",get:function(){return this._children}},{key:"firstInPart",get:function(){return this.part.staves[0]==this}},{key:"lastInPart",get:function(){return this.part.staves[this.part.staves.length-1]==this}},{key:"penultimateInPart",get:function(){return this.part.staves[this.part.staves.length-2]==this}},{key:"hasSlurs",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._spanNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=!0,a=!1,l=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;if(A.is(c,Ol))return!0}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}}],[{key:"extractNoteSets",value:function(t){for(var i=[],n=0;n<t.length;n++)A.is(t[n],Xl)?i.concat(e.extractNoteSets(A.unknownToType(t[n],Xl).elements)):A.is(t[n],Sn)&&i.push(t[n]);return i}}]),e}();r.registerClass(Rl,"com.noteflight.notation.model.Staff");var Dl=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(r=l(this,h(e).call(this,i,n)))._staffIndex=0,r._dx=NaN,r._dy=NaN,r._staffIndex=t,r._dx=o,r._dy=s,r}return c(e,gl),p(e,[{key:"toString",value:function(){return"[staff: "+this.staffIndex+", measure: "+this.measureIndex+", pos: "+this.position+", dx: "+this._dx+", dy: "+this._dy+"]"}},{key:"staffIndex",get:function(){return this._staffIndex}},{key:"dx",get:function(){return this._dx}},{key:"dy",get:function(){return this._dy}}]),e}();r.registerClass(Dl,"com.noteflight.notation.model.StaffPosition");var Fl=function(){function t(){y(this,t),this._staffNotes=null,this._capo=0,this._staffNotes=[]}return p(t,[{key:"setStaffNotesFromStrings",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._staffNotes=[];for(var i=0;i<t.length;i++)this._staffNotes.push(new de(kt.pitchFromString(A.unknownToString(t[i]))).transposeInterval($a.fromPitches(e)));this._capo=e}},{key:"staffNotes",get:function(){return this._staffNotes}},{key:"capo",get:function(){return this._capo}}],[{key:"defaultGuitarTuning",value:function(){var e=new t;return e.setStaffNotesFromStrings(["E2","A2","D3","G3","B3","E4"]),e}},{key:"defaultBassTuning",value:function(){var e=new t;return e.setStaffNotesFromStrings(["E1","A1","D2","G2"]),e}}]),t}();r.registerClass(Fl,"com.noteflight.notation.model.StaffTuning");var Ul=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(t=l(this,h(e).call(this)))._type=e.STANDARD_TYPE,t._$numLines=e.DEFAULT_NUM_LINES,t._$lineSpacing=e.DEFAULT_LINE_SPACING,t._$staffTuning=null,null==n&&(t.staffTuning=new Fl),t.staffTuning=n,i>0&&(t.numLines=i),t}return c(e,At),p(e,null,[{key:"DEFAULT_NUM_LINES",get:function(){return 5}},{key:"STANDARD_TYPE",get:function(){return"standard"}},{key:"NUM_LINES_STANDARD",get:function(){return 5}},{key:"GUITAR_TAB_TYPE",get:function(){return"guitarTab"}},{key:"NUM_LINES_GUITAR_TAB",get:function(){return 6}},{key:"BASS_TAB_TYPE",get:function(){return"bassTab"}},{key:"NUM_LINES_BASS_TAB",get:function(){return 4}},{key:"VALID_TYPES",get:function(){return Vl}},{key:"TAB_TYPES",get:function(){return Bl}},{key:"DEFAULT_LINE_SPACING",get:function(){return 1}},{key:"TAB_LINE_SPACING",get:function(){return 1.5}}]),p(e,[{key:"isTablature",value:function(){return e.TAB_TYPES.indexOf(this._type)>=0}},{key:"numLines",get:function(){return this._$numLines},set:function(t){var e=this._$numLines;this._$numLines=t,e!==t&&this._propertyChanged("numLines",e,t)}},{key:"lineSpacing",get:function(){return this._$lineSpacing},set:function(t){var e=this._$lineSpacing;this._$lineSpacing=t,e!==t&&this._propertyChanged("lineSpacing",e,t)}},{key:"staffTuning",get:function(){return this._$staffTuning},set:function(t){var e=this._$staffTuning;this._$staffTuning=t,e!==t&&this._propertyChanged("staffTuning",e,t)}},{key:"type",get:function(){return this._type},set:function(t){e.VALID_TYPES.indexOf(t)<0||(this._type=t)}},{key:"height",get:function(){return(this.numLines-1)*this.lineSpacing}}],[{key:"createTypeFromClef",value:function(t){var i=A.is(t,$l)?e.GUITAR_TAB_TYPE:e.STANDARD_TYPE;return e.createType(i,t.numLines)}},{key:"createTypeFromLineCount",value:function(t){var i=e.STANDARD_TYPE;return t==e.NUM_LINES_BASS_TAB?i=e.BASS_TAB_TYPE:t==e.NUM_LINES_GUITAR_TAB&&(i=e.GUITAR_TAB_TYPE),e.createType(i,t)}},{key:"createType",value:function(t,i){e.VALID_TYPES.indexOf(t)<0&&(t=e.STANDARD_TYPE);var n=new e;switch(n.type=t,n.numLines=A.intToUint(i),t){case e.GUITAR_TAB_TYPE:case e.BASS_TAB_TYPE:n.lineSpacing=e.TAB_LINE_SPACING}return n}}]),e}(),Vl=[Ul.STANDARD_TYPE,Ul.GUITAR_TAB_TYPE,Ul.BASS_TAB_TYPE],Bl=[Ul.GUITAR_TAB_TYPE,Ul.BASS_TAB_TYPE];r.registerClass(Ul,"com.noteflight.notation.model.StaffType");var Hl=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y(this,e),(i=l(this,h(e).call(this,_l.SWING_TYPE)))._swingType=null,i._swingDelta=NaN,i._swingType=t,i._swingDelta=n,i}return c(e,_l),p(e,null,[{key:"EIGHTH_SWING_TYPE",get:function(){return"8"}},{key:"SIXTEENTH_SWING_TYPE",get:function(){return"16"}}]),p(e,[{key:"equals",value:function(t){return A.is(t,e)&&A.unknownToType(t,e)._swingDelta==this._swingDelta&&A.unknownToType(t,e)._swingType==this._swingType}},{key:"transformPosition",value:function(t){return A.is(t.rhythmContext,Xl)?t.position:this._swingType==e.EIGHTH_SWING_TYPE&&t.duration<32?t.position:this._swingType==e.SIXTEENTH_SWING_TYPE&&t.duration<16?t.position:this.swingPosition(t.position)}},{key:"transformDuration",value:function(t){return A.is(t.rhythmContext,Xl)?t.duration:this._swingType==e.EIGHTH_SWING_TYPE&&(t.duration<32||48==t.duration)?t.duration:this._swingType==e.SIXTEENTH_SWING_TYPE&&(t.duration<16||24==t.duration)?t.duration:this.swingPosition(t.position+t.duration)-this.swingPosition(t.position)}},{key:"swingPosition",value:function(t){return this._swingType==e.EIGHTH_SWING_TYPE&&Math.round(t)%64==32?t+32*this._swingDelta:this._swingType==e.SIXTEENTH_SWING_TYPE&&Math.round(t)%32==16?t+16*this._swingDelta:t}},{key:"swingDelta",get:function(){return this._swingDelta}},{key:"swingType",get:function(){return this._swingType}}]),e}();r.registerClass(Hl,"com.noteflight.notation.model.SwingMeterMap");var $l=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(t=l(this,h(e).call(this,i,Mn.TAB_CLEF_SIGN,Ul.NUM_LINES_STANDARD,null,Ul.NUM_LINES_GUITAR_TAB)))._$stringNotes=null,t._capo=0,n?(n.type.staffTuning?(t.staffNotes=n.type.staffTuning.staffNotes,t.capo=n.type.staffTuning.capo):t.staffNotes=Fl.defaultGuitarTuning().staffNotes,t.numLines=A.numberToUint(t.displayLineCount=n.type.numLines),t.lineSpacing=n.type.lineSpacing):(t.staffNotes=Fl.defaultGuitarTuning().staffNotes,t.numLines=A.numberToUint(t.displayLineCount=Ul.NUM_LINES_GUITAR_TAB),t.lineSpacing=Ul.TAB_LINE_SPACING),t.note=t.stringNotes[0],t.line=A.intToUint(t.numLines-1),t}return c(e,Mn),p(e,null,[{key:"STRING_NAMES",get:function(){return"ABCDEFG"}},{key:"BEND_NUMBER_OFFSET",get:function(){return 3}}]),p(e,[{key:"getPitchLine",value:function(t){return t.stringIndex<0?0:t.cumulativeBend>0?this.numLines-1+e.BEND_NUMBER_OFFSET:this.numLines-1-t.stringIndex}},{key:"getEffectiveFret",value:function(t){if(t.fret>=0)return t.fret;var e=this.stringNotes[t.stringIndex];if(null==e)return-1;var i=t.pitch.ordinal-e.pitch.ordinal;return i>=0?i:-1}},{key:"getLineNote",value:function(t,e){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var i=A.numberToInt(Math.max(0,Math.min(this.numLines-1,Math.round(this.numLines-1-t)))),n=this.stringNotes[i],r=new de(n.pitch,n.step,n.accidental);return r.stringIndex=i,r.fret=-1,r}},{key:"showRhythm",value:function(t){return t.effectiveStaffMetrics.showTabRhythm}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.stringNotes=this.stringNotes,t.capo=this._capo,t}},{key:"stringNotes",get:function(){return this._$stringNotes},set:function(t){var e=this._$stringNotes;this._$stringNotes=t,e!==t&&this._propertyChanged("stringNotes",e,t)}},{key:"capo",get:function(){return this._capo},set:function(t){this._capo=t}},{key:"staffNotes",get:function(){return this.stringNotes.slice().reverse()},set:function(t){this.stringNotes=t.slice().reverse()}},{key:"clefScale",get:function(){return(this.numLines-1)/(Ul.NUM_LINES_GUITAR_TAB-1)}},{key:"showKey",get:function(){return!1}},{key:"tabStemDirection",get:function(){return he.DIRECTION_DOWN}},{key:"showLegerLines",get:function(){return!1}},{key:"tuning",set:function(t){for(var e=[],i=0;i<t.length;i++)e.push(new de(kt.pitchFromString(A.unknownToString(t[i]))).transposeInterval($a.fromPitches(this._capo)));this.staffNotes=e},get:function(){var t=[],e=this.stringNotes.slice(),i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,de);t.push(kt.getPitch(l.pitch.ordinal-this._capo).toString())}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}},{key:"tuningNotes",get:function(){for(var t=[],e=0;e<this.tuning.length;e++)t.push(new de(kt.pitchFromString(this.tuning[e])));return t.reverse()}}],[{key:"tabClef",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}}]),e}();r.registerClass($l,"com.noteflight.notation.model.TablatureClef");var Gl=function(t){function e(){return y(this,e),l(this,h(e).call(this,0,null,0,0))}return c(e,Sn),p(e,[{key:"clone",value:function(){return A.as(s(h(e.prototype),"clone",this).call(this),e)}},{key:"rhythmDuration",get:function(){return null==this.measure?0:A.numberToUint(this.measure.duration)},set:function(t){o(h(e.prototype),"rhythmDuration",t,this,!0)}}]),e}();r.registerClass(Gl,"com.noteflight.notation.model.Tacet");var Yl=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120;return y(this,e),(t=l(this,h(e).call(this,0)))._$value=0,t._$dots=0,t._$bpm=0,t._$meterMap=null,t.value=i,t.dots=n,t.bpm=r,t.meterMap=_l.IDENTITY,t}return c(e,he),p(e,[{key:"equals",value:function(t){return t==this||t.value==this.value&&t.dots==this.dots&&t.bpm==this.bpm&&t.meterMap.equals(this.meterMap)}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.value=this.value,t.dots=this.dots,t.bpm=this.bpm,t.meterMap=this.meterMap,t}},{key:"value",get:function(){return this._$value},set:function(t){var e=this._$value;this._$value=t,e!==t&&this._propertyChanged("value",e,t)}},{key:"dots",get:function(){return this._$dots},set:function(t){var e=this._$dots;this._$dots=t,e!==t&&this._propertyChanged("dots",e,t)}},{key:"bpm",get:function(){return this._$bpm},set:function(t){var e=this._$bpm;this._$bpm=t,e!==t&&this._propertyChanged("bpm",e,t)}},{key:"meterMap",get:function(){return this._$meterMap},set:function(t){var e=this._$meterMap;this._$meterMap=t,e!==t&&this._propertyChanged("meterMap",e,t)}},{key:"showOnlyOnSystemStaff",get:function(){return!0}},{key:"timeScale",get:function(){return 60/this.bpm/mn.valueToDuration(this.value,this.dots)}},{key:"movable",get:function(){return!0}},{key:"marking",get:function(){return!0}},{key:"metrical",get:function(){return!0}},{key:"alignToStaffTop",get:function(){return!0}},{key:"paddingY",get:function(){return-this.score.effectiveStaffMetrics.tempoTextOffset}}]),e}();r.registerClass(Yl,"com.noteflight.notation.model.Tempo");var zl=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return y(this,e),(t=l(this,h(e).call(this,0)))._$visibility=e.DEFAULT_VISIBILITY,t._$timeSymbol=null,t._beats=4,t._beatType=4,t._defaultBeamEnds=null,t._beats=i,t._beatType=n,t._defaultBeamEnds=t.beamGroups,t}return c(e,he),p(e,null,[{key:"CUT_TIME_SYMBOL",get:function(){return"cut"}},{key:"COMMON_TIME_SYMBOL",get:function(){return"common"}},{key:"DEFAULT_VISIBILITY",get:function(){return"default"}},{key:"SHOWN_VISIBILITY",get:function(){return"shown"}},{key:"HIDDEN_VISIBILITY",get:function(){return"hidden"}}]),p(e,[{key:"equals",value:function(t){return t==this||t._beats==this._beats&&t._beatType==this._beatType&&t.timeSymbol==this.timeSymbol&&t.visibility==this.visibility}},{key:"sameTimeProperties",value:function(t){return t==this||t._beats==this._beats&&t._beatType==this._beatType&&t.timeSymbol==this.timeSymbol}},{key:"appendTimeSignature",value:function(t){for(var i=A.as(this.clone(),e),n=t._beats,r=t._beatType;r<i._beatType;)n*=2,r*=2;for(;i._beatType<r;)i._beats*=2,i._beatType*=2;return i._beats+=n,i}},{key:"getRangeDurations",value:function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];if(t=A.numberToInt(Math.min(this.meterDuration,t)),e=A.numberToInt(Math.min(this.meterDuration-t,e)),t%this.beatDuration>0&&!n&&(i=A.numberToInt(Math.min(e,this.beatDuration-t%this.beatDuration)))>0&&(r=r.concat(mn.ascendingValueDurations(i,n)),e-=i,t+=i),this.simpleDuple||n)if(t>0&&this.simpleDuple&&!n){var o=e%this.beatDuration;e-=o,r=(r=r.concat(mn.ascendingValueDurations(e,n))).concat(mn.descendingValueDurations(o,n))}else r=r.concat(mn.descendingValueDurations(e,n));else for(var s=this.beamGroups,a=0,l=0;l<s.length&&e>0;l++)if(t<(a+=A.unknownToInt(s[l]))){if((i=A.numberToInt(Math.min(e,a-t)))==s[l])r=r.concat(mn.descendingValueDurations(i,!0));else{for(;i>=this.beatDuration&&!n;)r.push(this.beatDuration),i-=this.beatDuration,e-=this.beatDuration,t+=this.beatDuration;r=r.concat(mn.descendingValueDurations(i,n))}e-=i,t+=i}return r}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t._beats=this._beats,t._beatType=this._beatType,t._defaultBeamEnds=se.cloneArray(this._defaultBeamEnds),t.visibility=this.visibility,t.timeSymbol=this.timeSymbol,t}},{key:"visibility",get:function(){return this._$visibility},set:function(t){var e=this._$visibility;this._$visibility=t,e!==t&&this._propertyChanged("visibility",e,t)}},{key:"timeSymbol",get:function(){return this._$timeSymbol},set:function(t){var e=this._$timeSymbol;this._$timeSymbol=t,e!==t&&this._propertyChanged("timeSymbol",e,t)}},{key:"beats",get:function(){return this._beats}},{key:"beatType",get:function(){return this._beatType}},{key:"meterDuration",get:function(){return this._beats*this.beatDuration}},{key:"beatDuration",get:function(){return A.numberToInt(256/this._beatType)}},{key:"beatValue",get:function(){return mn.durationToValue(A.intToUint(this.beatDuration))}},{key:"simpleDuple",get:function(){for(var t=this._beats;0==(1&t);)t>>=1;return 1==t}},{key:"triple",get:function(){return this._beats%3==0}},{key:"compound",get:function(){return this.triple&&this._beats>3?3:0}},{key:"defaultBeatGroupDuration",get:function(){return this.compound>0?this.beatDuration*this.compound:this.beatDuration}},{key:"defaultBeamGroupDuration",get:function(){return this.defaultBeatGroupDuration}},{key:"beamGroups",get:function(){for(var t=[],e=0;e<this.meterDuration/this.defaultBeamGroupDuration;e++)t[e]=this.defaultBeamGroupDuration;return t}},{key:"beatGroups",get:function(){for(var t=[],e=0;e<this.meterDuration/this.defaultBeatGroupDuration;e++)t[e]=this.defaultBeatGroupDuration;return t}},{key:"beamEnds",get:function(){return this._defaultBeamEnds}}],[{key:"groupStartsAt",value:function(t,e){for(var i=0,n=0;n<t.length;n++){if(e==i)return!0;i+=A.unknownToInt(t[n])}return!1}},{key:"inSameGroup",value:function(t,e,i){for(var n=0,r=0;r<t.length;r++){var o=A.numberToInt(n+t[r]);if(e>=n&&e<o)return i<o;n=o}return!1}}]),e}();r.registerClass(zl,"com.noteflight.notation.model.TimeSignature");var Wl=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qa.TYPE_DEFAULT,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return y(this,e),(t=l(this,h(e).call(this,i,!1,n,r,o,s,a)))._accidental=null,t._hadTarget=!1,t._interval=2,t._accidentalInvalid=!0,t._intervalInvalid=!0,t}return c(e,qa),p(e,[{key:"recalculate",value:function(){this._accidentalInvalid&&(this._accidentalInvalid=!1,this._hadTarget?this.recalculateAccidental():null!=this.target&&(this._intervalInvalid=!0),this._hadTarget=null!=this.target)}},{key:"recalculateInterval",value:function(){if(this.recalculate(),this._intervalInvalid){if(null==this.target)return;this._intervalInvalid=!1,this._interval=this.dummyNeighbor.pitch.ordinal-this.target.pitch.ordinal}}},{key:"recalculateAccidental",value:function(){if(null!=this.target){var t=this.target.transposeInterval(new $a(1,this._interval));t.normalizeAlteration(),t.alteration==this.measure.effectiveAlteration(this.position,t,this.voiceNumber)?this.accidental=null:this.accidental=de.alterationToAccidental(t.alteration)}}},{key:"recalculateTrill",value:function(){this._accidental=null,this._hadTarget=!1,this._intervalInvalid=!0,this.recalculateInterval()}},{key:"setDefaultInfo",value:function(){this._accidentalInvalid=this._intervalInvalid=!0}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.accidental=this.accidental,t._interval=this.interval,t}},{key:"accidental",set:function(t){var e=t;this.recalculate(),this._accidental=t,this._intervalInvalid=!0;var i=new Di(Di.MODEL_UPDATE,"accidental",e,t,this);this.dispatchModelUpdateEvent(i)},get:function(){return this.recalculate(),this._accidental}},{key:"interval",get:function(){return this.recalculateInterval(),this._interval}},{key:"scoreAccidental",get:function(){return this.measure.getScoreNote(this.dummyNeighbor).accidental}},{key:"alteration",get:function(){return null==this.accidental?0:de.accidentalToAlteration(this.accidental)}},{key:"transposable",get:function(){return!0}},{key:"dummyNeighbor",get:function(){var t,e=this.target;if(e){t=e.transposeDiatonic(1);var i=this.accidental?this.alteration:this.measure.effectiveAlteration(e.position,t,e.voiceNumber);t.pitch=t.diatonicPitch.transpose(i)}else t=new de(kt.getPitch(0));return t.accidental=this.accidental,t}},{key:"target",get:function(){if(null==this.measure)return null;var t=A.as(this.measure.notationAtPosition(this.position,Sn,this.voiceNumber),Sn);if(null==t)return null;var e=null,i=!0,n=!1,r=void 0;try{for(var o,s=t.notes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;(null==e||a.pitch.ordinal>e.pitch.ordinal)&&(e=a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}}]),e}();r.registerClass(Wl,"com.noteflight.notation.model.Trill");var Xl=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return y(this,e),(t=l(this,h(e).call(this,i)))._$timeSignature=null,t._$units=0,t._$unitValue=0,t._$tremolo=!1,t._$showActualNumber=!0,t._$showNormalNumber=!1,t._$showBracket=!0,t.units=n,t.unitValue=r,t.timeSignature=new zl(o,256>>s),t}return c(e,ae),p(e,[{key:"getElementAt",value:function(t){return A.as(this.getChildAt(A.intToUint(t)),ue)}},{key:"addElement",value:function(t){for(var e=0;e<this.elements.length;e++)if(t.rhythmPosition<this.getElementAt(e).rhythmPosition)return this.addChildAt(A.unknownToType(t,se),e),!0;return this.addChild(A.unknownToType(t,se)),!0}},{key:"addElementAt",value:function(t,e){this.addChildAt(A.unknownToType(t,se),e)}},{key:"removeElement",value:function(t){this.removeChild(A.unknownToType(t,se))}},{key:"noteSetAtPosition",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.elements[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,ue);if(a.rhythmPosition>t)break;if(A.is(a,Sn)&&a.rhythmPosition==t)return A.as(a,Sn)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"getPosition",value:function(t){return this.position+t/this.tupletRatio}},{key:"getDuration",value:function(t){return t/this.tupletRatio}},{key:"getRhythmPosition",value:function(t){return(t-this.position)*this.tupletRatio}},{key:"getRhythmDuration",value:function(t){return t*this.tupletRatio}},{key:"clone",value:function(){var t=A.as(s(h(e.prototype),"clone",this).call(this),e);return t.units=this.units,t.unitValue=this.unitValue,t.timeSignature=this.timeSignature,t.tremolo=this.tremolo,t.showActualNumber=this.showActualNumber,t.showNormalNumber=this.showNormalNumber,t.showBracket=this.showBracket,t}},{key:"timeSignature",get:function(){return this._$timeSignature},set:function(t){var e=this._$timeSignature;this._$timeSignature=t,e!==t&&this._propertyChanged("timeSignature",e,t)}},{key:"units",get:function(){return this._$units},set:function(t){var e=this._$units;this._$units=t,e!==t&&this._propertyChanged("units",e,t)}},{key:"unitValue",get:function(){return this._$unitValue},set:function(t){var e=this._$unitValue;this._$unitValue=t,e!==t&&this._propertyChanged("unitValue",e,t)}},{key:"tremolo",get:function(){return this._$tremolo},set:function(t){var e=this._$tremolo;this._$tremolo=t,e!==t&&this._propertyChanged("tremolo",e,t)}},{key:"showActualNumber",get:function(){return this._$showActualNumber},set:function(t){var e=this._$showActualNumber;this._$showActualNumber=t,e!==t&&this._propertyChanged("showActualNumber",e,t)}},{key:"showNormalNumber",get:function(){return this._$showNormalNumber},set:function(t){var e=this._$showNormalNumber;this._$showNormalNumber=t,e!==t&&this._propertyChanged("showNormalNumber",e,t)}},{key:"showBracket",get:function(){return this._$showBracket},set:function(t){var e=this._$showBracket;this._$showBracket=t,e!==t&&this._propertyChanged("showBracket",e,t)}},{key:"elements",get:function(){return this._children}},{key:"numElements",get:function(){return this._children.length}},{key:"validTuplet",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.elements[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t+=A.unknownToType(s,ue).rhythmDuration}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t==this.timeSignature.meterDuration}},{key:"topLevelTuplet",get:function(){return this.rhythmContext&&A.is(this.rhythmContext,Kl)}},{key:"hasChildTuplet",get:function(){var t=!0,i=!1,n=void 0;try{for(var r,o=this.descendants[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,a=A.unknownToType(s,ue);if(A.is(a,e))return!0}}catch(t){i=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}return!1}},{key:"containsRest",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.elements[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,ue);if(A.is(s,Sn)&&A.unknownToType(s,Sn).isRest())return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}},{key:"shown",get:function(){return this.showBracket||this.showActualNumber||this.showNormalNumber}},{key:"rhythmDuration",get:function(){return A.intToUint(this.units*mn.valueToDuration(this.unitValue))}},{key:"tupletRatio",get:function(){return this.timeSignature.meterDuration/this.duration}},{key:"rhythmUnits",get:function(){return this.timeSignature.beats}},{key:"rhythmValue",get:function(){return this.timeSignature.beatValue}},{key:"measureNumerator",get:function(){var t=1<<Math.max(0,this.unitValue-this.rhythmValue);return this.rhythmContext.measureNumerator*(this.units*t)}},{key:"measureDenominator",get:function(){return A.intToUint(A.intToUint(this.rhythmContext.measureDenominator*this.rhythmUnits))}}]),e}();r.implementsInterfaces(Xl,[Ha,ue]),r.registerClass(Xl,"com.noteflight.notation.model.Tuplet");var Kl=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,Cl),p(e,null,[{key:"NON_METRICAL_VOICE_NUMBER",get:function(){return-1}},{key:"UNKNOWN_VOICE_NUMBER",get:function(){return-999}},{key:"NORMAL_MAX_VOICES",get:function(){return 2}}]),p(e,[{key:"addElement",value:function(t){for(var i=0;i<this.elements.length;i++)if(this.elements[i].rhythmPosition===t.rhythmPosition&&this.collision(t,this.elements[i]))return!1;return s(h(e.prototype),"addElement",this).call(this,t),!0}},{key:"getPosition",value:function(t){return t}},{key:"getDuration",value:function(t){return t}},{key:"getRhythmPosition",value:function(t){return t}},{key:"getRhythmDuration",value:function(t){return t}},{key:"clone",value:function(){return s(h(e.prototype),"clone",this).call(this)}},{key:"_canCollideWithClef",value:function(t){return A.is(t,Ua)||A.is(t,Ca)}},{key:"collision",value:function(t,e){return t instanceof En&&e instanceof En||(!!(A.is(t,Mn)&&!this._canCollideWithClef(e)||A.is(e,Mn)&&!this._canCollideWithClef(t))||(!(!A.is(t,Sn)||!A.is(e,Sn)||t.grace||e.grace)||!!(A.is(t,Gl)&&!A.is(e,kl)&&A.is(e,Sn)&&!e.grace||A.is(e,Gl)&&!A.is(t,kl)&&A.is(t,Sn)&&!t.grace)))}},{key:"timeSignature",get:function(){return this.measure.timeSignature}},{key:"rhythmDuration",get:function(){return A.intToUint(this.timeSignature.meterDuration)}},{key:"units",get:function(){return this.timeSignature.beats}},{key:"unitValue",get:function(){return A.intToUint(this.timeSignature.beatValue)}},{key:"voiceNumber",get:function(){var t=this.index;return t<0?e.UNKNOWN_VOICE_NUMBER:t-1}},{key:"measure",get:function(){return A.as(this.parent,hl)}},{key:"measureNumerator",get:function(){return 1}},{key:"measureDenominator",get:function(){return 1}},{key:"hasRehearsalLetter",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.elements[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);if(A.is(s,bl)&&A.unknownToType(s,bl).textbox)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}}]),e}();r.implementsInterfaces(Kl,[Ha]),r.registerClass(Kl,"com.noteflight.notation.model.Voice");var jl=function t(){y(this,t)};r.registerClass(jl,"com.noteflight.notation.performance.ISynchronizedTrackFactory");var ql=function(){function t(){y(this,t)}return p(t,[{key:"create",value:function(t,e){var i=/.*(v=|\/v\/)([-_\w]+)/.exec(t);return null==i&&(i=/(http:\/\/youtu\.be\/)([-_\w]+)/.exec(t)),i?new _u("http://www.youtube.com/v/"+i[2],e):t.match(/\.mp3$/)||t.match(/\.m4v$/)||t.match(/\.ogv$/)||t.match(/\.mp4$/)||t.match(/\.m4a$/)||-1!=t.indexOf("//soundcloud.com/")?new _u(t,e):null}}]),t}();r.implementsInterfaces(ql,[jl]),r.registerClass(ql,"com.noteflight.notation.performance.SynchronizedHtml5MediaFactory");var Jl=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this))).muted=!1,n.gain=0,n._complete=!1,n._temporalMap=null,n._audioUrl=null,n._temporalMap=i,n._audioUrl=t,n}return c(e,At),p(e,null,[{key:"YOUTUBE",get:function(){return Zl},set:function(t){Zl=t}},{key:"SOUNDCLOUD",get:function(){return tu},set:function(t){tu=t}},{key:"AUDIO",get:function(){return eu},set:function(t){eu=t}},{key:"VIDEO",get:function(){return iu},set:function(t){iu=t}},{key:"_html5Factories",get:function(){return nu},set:function(t){nu=t}}]),p(e,[{key:"dispatchLoadingStarted",value:function(){this.dispatchEvent(new gt(gt.PROGRESS_START,this,"loading audio track"))}},{key:"getStartTime",value:function(t){return this._temporalMap.measureIndexToTime(t)+this._temporalMap.offset}},{key:"load",value:function(){throw new Error("abstract load() not overridden")}},{key:"createView",value:function(){return null}},{key:"destroy",value:function(){throw new Error("abstract destroy() not overridden")}},{key:"createPlayer",value:function(t){throw new Error("abstract createPlayer() not overridden")}},{key:"forceComplete",value:function(){this._complete=!0}},{key:"handleAudioComplete",value:function(t){this._complete=!0,this.dispatchEvent(t)}},{key:"audioUrl",get:function(){return this._audioUrl}},{key:"type",get:function(){return-1!=this._audioUrl.indexOf("youtube.com")?e.YOUTUBE:-1!=this._audioUrl.indexOf("soundcloud.com")?e.SOUNDCLOUD:-1!=this._audioUrl.indexOf(".mp3")||-1!=this._audioUrl.indexOf(".m4a")?e.AUDIO:e.VIDEO}},{key:"temporalMap",get:function(){return this._temporalMap}},{key:"length",get:function(){throw new Error("abstract get length() not overridden")}},{key:"seekPosition",get:function(){return 0},set:function(t){}},{key:"complete",get:function(){return this._complete}}],[{key:"createFromString",value:function(t,i){var n=e._html5Factories,r=!0,o=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,jl).create(t,i);if(null!=h)return h}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return null}},{key:"equals",value:function(t,e){return t==e||null!=t&&null!=e&&(t.muted==e.muted&&t.gain==e.gain&&t.audioUrl==e.audioUrl&&!!Eu.equals(t.temporalMap,e.temporalMap))}}]),e}(),Zl="youtube",tu="soundcloud",eu="audio",iu="video",nu=[new ql];r.registerClass(Jl,"com.noteflight.notation.performance.AbstractSynchronizedTrack");var ru=function(){function t(){y(this,t),this._dict=new Uy}return p(t,[{key:"process",value:function(t,e,i){this.collectCaesuras(t,e);var n=!0,r=!1,o=void 0;try{for(var s,a=xt.dictionaryForOfSource(this._dict)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToNumber(l);i.processCaesura(u)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"collectCaesuras",value:function(t,e){for(var i=0;i<t.length;i++){var n=A.unknownToType(t[i],Rl),r=0,o=!0,s=!1,a=void 0;try{for(var l,u=e[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToUint(h),d=n.getMeasureAt(c),f=d.measureNotations,y=!0,g=!1,p=void 0;try{for(var m,v=f[Symbol.iterator]();!(y=(m=v.next()).done);y=!0){var _=m.value,S=A.unknownToType(_,he);if(A.is(S,Sn)){var L=A.as(S,Sn),k=!0,T=!1,E=void 0;try{for(var M,b=L.articulations[Symbol.iterator]();!(k=(M=b.next()).done);k=!0){var w=M.value;A.unknownToString(w)==Sn.CAESURA_ARTICULATION&&this.addCaesura(r,L)}}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}}}}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}r+=d.duration}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}}},{key:"addCaesura",value:function(t,e){var i=t+e.position+e.duration;this._dict.put(i,i)}}]),t}();r.registerClass(ru,"com.noteflight.notation.performance.CaesuraPerformanceProcessor");var ou=function t(e,i,n){y(this,t),this.measureIndex=0,this.scorePosition=0,this.duration=0,this.measureIndex=e,this.scorePosition=i,this.duration=n};r.registerClass(ou,"com.noteflight.notation.performance.FermataElement");var su=function(){function t(){y(this,t),this._dict=new Uy,this._voiceCount=null}return p(t,[{key:"process",value:function(t,e,i,n){this.collectFermatas(t,e);var r=!0,o=!1,s=void 0;try{for(var a,l=xt.dictionaryForOfSource(this._dict)[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=0,c=new ou(0,0,Hy.MAX_VALUE),d=!0,f=!1,y=void 0;try{for(var g,p=u[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value;h++,m.duration<c.duration&&(c=m)}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}h==this._voiceCount[c.measureIndex]&&n.processFermata(c,i)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"collectFermatas",value:function(t,e){this._voiceCount={};for(var i=!0,n=0;n<t.length;n++){var r=A.unknownToType(t[n],Rl),o=0,s=[],a=!0,l=!1,u=void 0;try{for(var h,c=e[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToUint(d),y=-1==s.indexOf(f);i&&y&&(this._voiceCount[f]=0);var g=!1,p=!1,m=r.getMeasureAt(f),v=m.measureNotations,_=!0,S=!1,L=void 0;try{for(var k,T=v[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value,M=A.unknownToType(E,he);if(A.is(M,Sn)){var b=A.as(M,Sn),w=b.voiceNumber,x=b.isRest()&&(0===b.value||b.value==mn.WHOLE)&&0===b.dots&&0===b.position&&b.rhythmDuration>=m.duration&&b.voiceNumber!=Kl.UNKNOWN_VOICE_NUMBER,C=!1,N=!0,I=!1,P=void 0;try{for(var O,Q=b.articulations[Symbol.iterator]();!(N=(O=Q.next()).done);N=!0){var R=O.value;A.unknownToString(R)==Sn.FERMATA_ARTICULATION&&(this.addFermata(f,o,b),C=!0)}}catch(t){I=!0,P=t}finally{try{N||null==Q.return||Q.return()}finally{if(I)throw P}}x&&!C||(0===w&&(g=!0),1==w&&(p=!0))}}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}y&&(g&&(this._voiceCount[f]+=1),p&&(this._voiceCount[f]+=1)),o+=m.duration,s.push(f)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}i=!1}}},{key:"addFermata",value:function(t,e,i){var n=new ou(t,i.position+e,i.rhythmDuration),r=n.scorePosition+n.duration;null==this._dict.get(r)&&this._dict.put(r,[]),this._dict.get(r).push(n)}}]),t}();r.registerClass(su,"com.noteflight.notation.performance.FermataPerformanceProcessor");var au=function(){function t(e){y(this,t),this._score=null,this._currentIndex=0,this._endings=null,this._repeatStack=null,this._stopped=!1,this._currentForm=null,this._currentFormStartingMeasure=-1,this._formalElementsDict=new Uy,this._score=e,this._infoRepeats={}}return p(t,null,[{key:"NOT_FOUND",get:function(){return-1}},{key:"MAX_NUMBER_OF_MEASURES_TO_PLAY",get:function(){return 1e4}}]),p(t,[{key:"getMeasureIndices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.reset();var n=[],r=!1;for(this.findFormalElements();;){var o=this.processMeasure();if(o<0||i>-1&&o>=i)break;if(!r&&o>=e&&(r=!0),r&&n.push(o),n.length>=t.MAX_NUMBER_OF_MEASURES_TO_PLAY)return n}return n}},{key:"reset",value:function(){this._currentIndex=0,this._stopped=!1,this._repeatStack=[],this._endings=[],this._currentForm=null,this._currentFormStartingMeasure=-1,this._formalElementsDict=new Uy}},{key:"getFormIndex",value:function(e){return null!=this._formalElementsDict.get(e)?A.unknownToInt(this._formalElementsDict.get(e)):t.NOT_FOUND}},{key:"removeFormIndex",value:function(t){xt.deleteFromDictionary(this._formalElementsDict,t)}},{key:"getStartingFormalElementAtIndex",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=xt.dictionaryForInSource(this._formalElementsDict)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.as(s,String);if(this._formalElementsDict.get(a)==t&&this.isStartingFormalElement(a))return a}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"isStartingFormalElement",value:function(t){return hl.STARTING_FORMAL_ELEMENTS.indexOf(t)>=0}},{key:"startForm",value:function(e){var i=!1;if(e==hl.FORM_DC||e==hl.FORM_DC_AL_CODA||e==hl.FORM_DC_AL_FINE||e==hl.FORM_DC_AL_SEGNO)this._currentIndex=0,i=!0;else if(e==hl.FORM_DS||e==hl.FORM_DS_AL_CODA||e==hl.FORM_DS_AL_FINE){var n=this.getFormIndex(hl.FORM_SEGNO);n!=t.NOT_FOUND&&(this._currentIndex=A.intToUint(n),i=!0)}return!!i&&(this.topRepeat&&this.topRepeat.endingSeen&&this.topRepeat.iteration<this.topRepeat.maxEnding?(this.topRepeat.iteration++,this.topRepeat.endingSeen=!1):this._repeatStack=[],this._endings=[],!0)}},{key:"_repeatEndingThatBelongsTo",value:function(t){for(var e in this._infoRepeats)if(!(t<parseInt(e))&&t<=this._infoRepeats[e].endMeasureIndex)return this._infoRepeats[e];return null}},{key:"processMeasure",value:function(){var e,i,n,r;do{if(this._stopped||this._currentIndex>=this._score.numMeasures)return-1;var o=0;for(e=this._score.getStaffAt(A.intToUint(o)).getMeasureAt(this._currentIndex);o<this._score.numStaves&&e.canHideStaff;)e=this._score.getStaffAt(A.intToUint(o)).getMeasureAt(this._currentIndex),o++;i=this._score.systemStaff.getMeasureAt(this._currentIndex),n=!1;var s=this._endings.length>0;if(this.processEndings(e),this._endings.length>0&&null!=this.topRepeat){var a=!0,l=!1,u=void 0;try{for(var h,c=this._endings[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;this.topRepeat.maxEnding=Math.max(this.topRepeat.maxEnding,d)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}!this.topRepeat.incrementedDueToFormalElement&&null!=this._currentForm&&this._currentFormStartingMeasure>=i.index&&(this.topRepeat.incrementedDueToFormalElement=!0,this.topRepeat.iteration++),this._endings.indexOf(this.topRepeat.iteration)<0?(n=!0,this._currentIndex++,i&&i.endRepeat&&(this._endings=[])):s||(this.topRepeat.endingSeen=!0)}i.startRepeat&&!n&&(this._endings=[])}while(n);i&&i.startRepeat&&(null!=(r=this.topRepeat)&&r.startIndex==this._currentIndex||this._repeatStack.push(new V(this._currentIndex,0)));var f=this._currentIndex++,y=e.getRepeatInfo();if(null!=y.endings&&(y.endMeasureIndex=e.getMeasureIndexAfterSpan(y.endingsDuration),this._infoRepeats[e.index]=y),null==this._currentForm){var g=this.getStartingFormalElementAtIndex(f);if(null!=g)if(this.startForm(g)){this._currentForm=g,this._currentFormStartingMeasure=f,this.topRepeat&&this.topRepeat.endingSeen&&(this.topRepeat.iteration++,this.topRepeat.endingSeen=!1);var p=this._repeatEndingThatBelongsTo(e.index);if(p&&null!=p.endings){var m=0,v=f;switch(this._currentForm){case hl.FORM_DS:m=this.getFormIndex(hl.FORM_SEGNO);break;case hl.FORM_DS_AL_CODA:m=this.getFormIndex(hl.FORM_SEGNO);case hl.FORM_DC_AL_CODA:(v=this.getFormIndex(hl.FORM_TO_CODA))!=t.NOT_FOUND&&(v=this.getFormIndex(hl.FORM_CODA));break;case hl.FORM_DS_AL_FINE:m=this.getFormIndex(hl.FORM_SEGNO);case hl.FORM_DC_AL_FINE:v=this.getFormIndex(hl.FORM_FINE);break;case hl.FORM_DC_AL_SEGNO:v=this.getFormIndex(hl.FORM_SEGNO)}(r=new V(m,0,v)).endingSeen=!0,r.iteration=p.endings[0],this._repeatStack.push(r)}return f}}switch(this._currentForm){case hl.FORM_DS:case hl.FORM_DC:break;case hl.FORM_DS_AL_CODA:case hl.FORM_DC_AL_CODA:var _=this.getFormIndex(hl.FORM_TO_CODA);if(_!=t.NOT_FOUND&&this._currentIndex==_){var S=this.getFormIndex(hl.FORM_CODA);if(S!=t.NOT_FOUND)return this._currentIndex=A.intToUint(S),this.removeFormIndex(hl.FORM_CODA),f}break;case hl.FORM_DS_AL_FINE:case hl.FORM_DC_AL_FINE:var L=this.getFormIndex(hl.FORM_FINE);L!=t.NOT_FOUND&&f==L&&(this._stopped=!0);break;case hl.FORM_DC_AL_SEGNO:var k=this.getFormIndex(hl.FORM_SEGNO);if(k!=t.NOT_FOUND&&this._currentIndex==k)return-1}return i&&i.endRepeat&&((null==(r=this.topRepeat)||0===this._endings.length&&r.implicitStart&&r.endIndex!=f)&&(r=new V(0,0,f),this._repeatStack.push(r)),0===this._endings.length?r.iteration+1<r.repeatCount?(r.iteration++,r.endingSeen=!1,this._currentIndex=r.startIndex):this._repeatStack.pop():this._endings.indexOf(r.iteration)>=0&&(r.iteration++,r.endingSeen=!1,this._endings=[],this._currentIndex=r.startIndex)),f}},{key:"findFormalElements",value:function(){for(var t=[this._score.systemStaff].concat(this._score.staves.slice()),e=0;e<this._score.numMeasures;e++){var i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl).getMeasureAt(A.intToUint(e)),u=l.getFormalElements(),h=!0,c=!1,d=void 0;try{for(var f,y=u[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=A.unknownToString(g.formalElementName),m=A.unknownToType(g.rhythmElement,ue);p==hl.FORM_CODA&&null==this._formalElementsDict.get(hl.FORM_TO_CODA)&&(p=hl.FORM_TO_CODA);var v=e;p!=hl.FORM_TO_CODA&&p!=hl.FORM_SEGNO||m.position>=l.duration/2&&v++,this._formalElementsDict.put(p,v)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}},{key:"processEndings",value:function(t){var e=t.getRepeatInfo();null!=e.endings?this._endings=e.endings:null!=this.topRepeat&&e.repeatCount>=2&&(this.topRepeat.repeatCount=e.repeatCount)}},{key:"topRepeat",get:function(){return this._repeatStack.length>0?this._repeatStack[this._repeatStack.length-1]:null}}]),t}();r.registerClass(au,"com.noteflight.notation.performance.FormParser");var lu=function t(){y(this,t)};r.registerClass(lu,"com.noteflight.performance.IScorePositionMap");var uu=function(){function t(){y(this,t)}return p(t,[{key:"scorePositionToTime",value:function(t){return t}},{key:"timeToScorePosition",value:function(t){return t}}]),t}();r.implementsInterfaces(uu,[lu]),r.registerClass(uu,"com.noteflight.notation.performance.IdentityScorePositionMap");var hu=function t(e,i){y(this,t),this.compositeNote=null,this.lastNote=null,this.compositeNote=e,this.lastNote=i};r.registerClass(hu,"com.noteflight.notation.performance.LiaisonState");var cu=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$startTime=NaN,t}return c(e,At),p(e,[{key:"toString",value:function(){return"time: "+this.startTime}},{key:"startTime",get:function(){return this._$startTime},set:function(t){var e=this._$startTime;this._$startTime=t,e!==t&&this._propertyChanged("startTime",e,t)}}]),e}();r.registerClass(cu,"com.noteflight.notation.performance.MeasureDescriptor");var du=function(){function t(e,i){y(this,t),this.lastVelocity=0,this.lastArticulation=null,this.entries=[],this.addEntry(new fu(0,A.numberToInt(e),null,i))}return p(t,[{key:"addEntry",value:function(t){for(var e=this.entries.length;e>0&&t.position<this.entries[e-1].position;)e--;e>0&&t.position==this.entries[e-1].position&&null==t.articType&&null==this.entries[e-1].articType&&(this.entries.splice(e-1,1),e--),this.entries.splice(e,0,t)}},{key:"addVelocity",value:function(t,e){this.addEntry(new fu(t,A.numberToInt(e),null,null))}},{key:"addGradient",value:function(t,e){this.addEntry(new fu(t,-1,e,null))}},{key:"addArticulation",value:function(t,e){this.addEntry(new fu(t,-1,null,e))}}]),t}();r.registerClass(du,"com.noteflight.notation.performance.MeasureStateMap");var fu=function t(e,i,n,r){y(this,t),this.position=NaN,this.gradient=null,this.velocity=0,this.articType=null,this.position=e,this.gradient=n,this.velocity=i,this.articType=r};r.registerClass(fu,"com.noteflight.notation.performance.MeasureStateMapEntry");var yu=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._documentController=null,t.metronomeInstrument=null,t.descriptor=null,t._$muted=!0,t.gain=0,t.pan=0,t.channel=0,t}return c(e,At),p(e,null,[{key:"METRONOME_URI",get:function(){return"percussion/unpitched/metronome/premium"}},{key:"FIRST_NOTE",get:function(){return 62}},{key:"SECOND_NOTE",get:function(){return 55}},{key:"MUTED_NOTE",get:function(){return 1}}]),p(e,[{key:"muted",get:function(){return this._$muted},set:function(t){var e=this._$muted;this._$muted=t,e!==t&&this._propertyChanged("muted",e,t)}},{key:"part",get:function(){var t=El.createPart();return t.instrumentUri=e.METRONOME_URI,t.gain=this.gain,t.pan=this.pan,t}}]),e}();r.registerClass(yu,"com.noteflight.notation.performance.Metronome");var gu=function(t){function e(t,i,n,r,o,s){var a,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return y(this,e),(a=l(this,h(e).call(this)))._$performance=null,a._$instruments=null,a._$parts=null,a._$scorePositionMap=null,a._$measureIndices=null,a.ticksBeforeActualScore=0,a._scoreMix=null,a.performance=t,a.instruments=i,a.parts=n,a.scorePositionMap=r,a.measureIndices=o,a._scoreMix=s,a.ticksBeforeActualScore=u,a}return c(e,At),p(e,[{key:"performance",get:function(){return this._$performance},set:function(t){var e=this._$performance;this._$performance=t,e!==t&&this._propertyChanged("performance",e,t)}},{key:"instruments",get:function(){return this._$instruments},set:function(t){var e=this._$instruments;this._$instruments=t,e!==t&&this._propertyChanged("instruments",e,t)}},{key:"parts",get:function(){return this._$parts},set:function(t){var e=this._$parts;this._$parts=t,e!==t&&this._propertyChanged("parts",e,t)}},{key:"scorePositionMap",get:function(){return this._$scorePositionMap},set:function(t){var e=this._$scorePositionMap;this._$scorePositionMap=t,e!==t&&this._propertyChanged("scorePositionMap",e,t)}},{key:"measureIndices",get:function(){return this._$measureIndices},set:function(t){var e=this._$measureIndices;this._$measureIndices=t,e!==t&&this._propertyChanged("measureIndices",e,t)}},{key:"scoreMix",get:function(){return this._scoreMix}}]),e}();r.registerClass(gu,"com.noteflight.notation.performance.NotationPerformance");var pu=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._$instrumentResolver=null,n._$player=null,n._$metrics=null,n._$defaultTempo=new Yl(A.intToUint(mn.QUARTER),0,120),n._$pitchAdjustment=0,n._$isRecording=!1,n._$metronome=new yu,n._$countInMeasures=2,n._$metronomeLoop=!1,n.loopStart=-1,n.loopEnd=-1,n.stavesToMuteForRecording=[],n.playAudioRecordings=!0,n._scoreMix=new Al,n._timeFactor=1,n._timeScale=0,n._playStart=0,n._music=null,n._liaisons=null,n._temporalMap=null,n._chordTimeSkew=NaN,n._supportLegatoArticulation=!1,n._slurred=!1,n._slurStart=!1,n._slurEnd=!1,n._noteSetPerformance=[],n._pedalEnd=NaN,n._lastInstrument=null,n._lastStaff=null,n._startMeasureIndex=0,n._usePlayerGain=!0,n._renderExact=!1,n._forMidi=!0,n.instrumentResolver=t,n.metrics=i,n._isPlaying=!1,n}return c(e,At),p(e,null,[{key:"CLOSED_HIGH_HAT",get:function(){return 43}},{key:"MAX_PEDAL_NOTE_LENGTH",get:function(){return 4}},{key:"MIN_NOTE_LENGTH",get:function(){return.001}}]),p(e,[{key:"initializeLiaisons",value:function(){this._liaisons=new Uy(!0)}},{key:"getInstrument",value:function(t,e){var i=t.part.instrument;return null!=i&&(i.mixGain=t.part.gain+this._scoreMix.masterGain+this.partCountBackoff(e),i.mixPan=t.part.pan,this._usePlayerGain=!1),i}},{key:"partCountBackoff",value:function(t){return 12-1*Math.max(0,t-5)}},{key:"getScoreDuration",value:function(t){return this.temporalMap?this.temporalMap.getScoreDuration(t):0}},{key:"useSyncedTemporalMap",value:function(t){t.synchronizedTrack&&!t.synchronizedTrack.muted&&(this._temporalMap=t.synchronizedTrack.temporalMap.clone())}},{key:"createBendLiaison",value:function(t,e,i){throw new Error("createBendLiaison() not overridden")}},{key:"createSlideLiaison",value:function(t,e,i){throw new Error("createSlideLiaison() not overridden")}},{key:"createVibrato",value:function(t){throw new Error("createVibrato() not overridden")}},{key:"getLiaisonByEndingPitch",value:function(t){if(t.liaisonEndNote){var e=!0,i=!1,n=void 0;try{for(var r,o=xt.dictionaryForInSource(this._liaisons)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(A.is(s,de)){var a=A.as(s,de);if(a.liaisonEndNote&&a.liaisonEndNote.pitch.ordinal==t.liaisonEndNote.pitch.ordinal)return a}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}return null}},{key:"getLiaisonByStartingPitch",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=xt.dictionaryForInSource(this._liaisons)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(A.is(s,de)){var a=A.as(s,de);if(a.pitch.ordinal==t.pitch.ordinal)return a}}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"applyLiaison",value:function(t,e,i){var n=i.liaisonStartNote;if(null==n&&null!=i.incomingLiaison&&(n=this.getLiaisonByStartingPitch(i)),null!=n){var r=this._liaisons.get(n);if(null==r){switch(n.liaison){case de.TIE_LIAISON:n=this.getLiaisonByStartingPitch(i);break;case de.SLIDE_LIAISON:case de.BEND_LIAISON:case de.PRE_BEND_LIAISON:n=this.getLiaisonByEndingPitch(n)}r=this._liaisons.get(n)}if(null!=r&&null!=n){var o=r.compositeNote,s=r.lastNote;switch(n.liaison){case de.TIE_LIAISON:o.duration+=t.duration;break;case de.PRE_BEND_LIAISON:o.pitchModulations.push(this.createBendLiaison(o,s,t)),o.onset+=s.duration,o.duration+=t.duration-s.duration;break;case de.BEND_LIAISON:o.pitchModulations.push(this.createBendLiaison(o,s,t)),o.duration+=t.duration;break;case de.SLIDE_LIAISON:var a=this.createSlideLiaison(o,s,t);o.pitchModulations.push(a),o.duration+=t.duration;break;case de.GLISSANDO_LIAISON:var l=new Xc(A.numberToInt(t.tunedOrdinal-o.tunedOrdinal));o.ornament=l,this.addPerformableNote(t)}return xt.deleteFromDictionary(this._liaisons,n),o}}return t}},{key:"applyArticulationDuration",value:function(t,i,n,r){if(n.hasArticulation(Sn.STACCATO_ARTICULATION)?t.duration=t.duration-i.duration+i.duration*this.metrics.staccatoDurationFactor:n.hasArticulation(Sn.TENUTO_ARTICULATION)?t.duration=t.duration-i.duration+i.duration*this.metrics.tenutoDurationFactor:n.hasArticulation(Sn.LV_TIE_ARTICULATION)?t.duration=Math.max(t.duration,e.MAX_PEDAL_NOTE_LENGTH/this._timeScale):this._slurred&&!this._slurEnd||A.is(t.ornament,Xc)?this._supportLegatoArticulation&&!this._slurStart&&(t.articulation=new ed(ed.LEGATO)):t.duration=Math.max(t.duration-this.metrics.maxUnslurredPause/this._timeScale,t.duration*this.metrics.unslurredDurationFactor),null!=r){var o=!0,s=!1,a=void 0;try{for(var l,u=r[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;switch(A.unknownToType(h,qa).type){case qa.TYPE_VIBRATO:var c=this.createVibrato(t);t.pitchModulations.push(c)}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}return t}},{key:"renderStaves",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loopStart=-1,this.loopEnd=-1;var n=i.startMeasureIndex||0,r=i.ignoreSpeedAdjustment||!1,o=i.renderExact||!1,s=i.forMidi||!1,a=i.endMeasureIndex||-1,l=i.ignoreSyncedTemporalMap||!1,u=i.playAllPassedStavesNFTracksOnly||!1,h=t[0].score;h.parts;this._startMeasureIndex=n,this._music=new nd,this._temporalMap=new Eu(n),this._renderExact=o,this._forMidi=s;var c=[],d=[],f=!0,y=h.synchronizedTrack&&!h.synchronizedTrack.muted&&!l;!u&&y&&h.synchronizedTrack.temporalMap.generateScorePositions(h);var g=this.metrics.defaultVelocity,p=new au(h),m=p.getMeasureIndices(0,a),v=p.getMeasureIndices(n,a);m.length==au.MAX_NUMBER_OF_MEASURES_TO_PLAY&&this.dispatchEvent(new ct(ct.TOO_MANY_MEASURES_TO_PLAY));for(var _,S=new vu(t,m),L=0;L<t.length;L++){var k=t[L];if(u||!k.part.muted){var T=!1;if(!u&&this.playAudioRecordings){var E=!0,M=!1,b=void 0;try{for(var w,x=k.part.audioTracks[Symbol.iterator]();!(E=(w=x.next()).done);E=!0){var C=w.value;if(A.unknownToType(C,ba).playbackEnabled){T=!0;break}}}catch(t){M=!0,b=t}finally{try{E||null==x.return||x.return()}finally{if(M)throw b}}}if(u||!k.part.noteflightTrackMuted||T){d.push(k.part);var N=this.getInstrument(k,k.score.numStaves),I=c.length;c.push(N),this._chordTimeSkew=0,this._noteSetPerformance=[],this._supportLegatoArticulation=!1,null!=N&&(this._chordTimeSkew=N.info.chordTimeSkew,this._supportLegatoArticulation=N.info.supportedArticulations.indexOf(ed.LEGATO)>=0),_=0;var P=0,O=0;this.initializeLiaisons();var Q,R=k.getMeasureAt(0).effectiveClef.unpitched?0:this.pitchAdjustment,D=ed.normal,F=null,U=!1,V=!0,B=!1,H=void 0;try{for(var $,G=m[Symbol.iterator]();!(V=($=G.next()).done);V=!0){var Y=$.value,z=A.unknownToUint(Y),W=this.getSourceMeasureIndex(k,z),X=k.getMeasureAt(W);!U&&z>=n&&(U=!0,O=_);var K=k.getMeasureAt(z),j=X.tempo;null==j&&(j=this.defaultTempo),this._timeScale=j.timeScale,r||(this._timeScale*=this.timeFactor);var q=j.meterMap;this._renderExact&&q.type==_l.SWING_TYPE&&(q=new _l(_l.IDENTITY_TYPE));var J=k.getPerformanceSpans(W);if(f&&this._temporalMap.appendEntry(new Mu(z,P,this._timeScale,_,0)),U&&(u||!k.part.noteflightTrackMuted&&-1==this.stavesToMuteForRecording.indexOf(L))){var Z=X.measureNotations,tt=0;F=null;var et=S.scoreMap[L][W],it=0,nt=!0,rt=!1,ot=void 0;try{for(var st,at=Z[Symbol.iterator]();!(nt=(st=at.next()).done);nt=!0){var lt=st.value,ut=A.unknownToType(lt,he);if(A.is(ut,Sn)){var ht=A.as(ut,Sn),dt=ht.voiceNumber,ft=null;this._slurred=!1,this._slurStart=!1,this._slurEnd=!1;var yt=!0,gt=!1,pt=void 0;try{for(var mt,vt=J[Symbol.iterator]();!(yt=(mt=vt.next()).done);yt=!0){var _t=mt.value,St=A.unknownToType(_t,Ua);(W>St.measure.index||ut.position+ut.duration/2>=St.position)&&(W<St.endPosition.measureIndex||ut.position<=St.endPosition.position)&&(St.voiceNumber==Kl.NON_METRICAL_VOICE_NUMBER||St.voiceNumber==dt||St.affectsEntirePart)&&(A.is(St,Ol)?(this._slurred=!0,this._slurStart=St.measure.index==W&&ut.position==St.position,this._slurEnd=St.endPosition.measureIndex==W&&St.endPosition.position>=ut.position&&St.endPosition.position<=ut.position+ut.duration/2):A.is(St,qa)&&(null==ft&&(ft=[]),ft.push(St)))}}catch(t){gt=!0,pt=t}finally{try{yt||null==vt.return||vt.return()}finally{if(gt)throw pt}}for(F&&F.endIndex==W&&F.endPosition<ht.position&&(F=null);it<et.entries.length&&et.entries[it].position<=ht.position;){var Lt=et.entries[it];if(null!=Lt.articType&&(D=new ed(Lt.articType)),!F)if(Lt.gradient){Q=-(F=Lt.gradient).startPosition;for(var kt=F.startIndex;kt<W;kt++)Q+=A.unknownToNumber(F.measureDurations[kt]);g=F.startVelocity}else Lt.velocity>=0&&(g=Lt.velocity);it++}var Tt=ht.notes,Et=0,Mt=this._chordTimeSkew/this._timeScale;null!=ht.arpeggio&&Tt.length>=2&&(Mt=Math.min(this.metrics.arpeggioMaxSkew,this.metrics.arpeggioMaxLength/(Tt.length-1))/this._timeScale),0!==Mt&&(Et=-(Tt.length-1)*Mt,(ht.hasArticulation(Sn.UP_BOW_ARTICULATION)||ht.arpeggio==Sn.DOWN_ARPEGGIO)&&(Tt=Tt.slice().reverse()));var bt=!0,wt=!1,Ct=void 0;try{for(var Nt,At=Tt[Symbol.iterator]();!(bt=(Nt=At.next()).done);bt=!0){var It=Nt.value,Pt=A.unknownToType(It,de);if(Pt.playable&&!Pt.silent){var Ot=new td,Qt=q.transformPosition(ht)+Et+tt;if(Ot.onset=_+Qt-O,Ot.duration=Math.max(e.MIN_NOTE_LENGTH/this._timeScale,q.transformDuration(ht)-(Et+tt)),ht.grace)if(ht.appoggiatura)Ot.duration=mn.valueToDuration(ht.value,ht.dots);else{var Rt=this.metrics.graceNoteTime/this._timeScale,Dt=mn.valueToDuration(j.value,j.dots)*this.metrics.graceNoteBeatFraction+Rt;Ot.duration=Dt,Ot.onset-=Dt*ht.numFollowingGraceNotes,Qt-=Dt*ht.numFollowingGraceNotes,null==ht.previousGraceNote&&this.clipLastNoteSetDuration(Ot.onset)}F&&(g=F.getVelocityAt(Q+Qt)),Ot.velocity=g,Ot.channel=I,Ot.articulation=D,Ot.pitch=0===R?Pt.pitch:Pt.pitch.transpose(A.numberToInt(R)),Ot.tuning=Pt.tuning,0===Mt||o||(Et+=Mt),this._noteSetPerformance=[],Ot=this.applyArticulationOnset(Ot,Pt,ht,ft),this.applyTremolo(ht,Ot);var Ft=this.applyLiaison(Ot,ht,Pt);Pt.liaison?(xt.isInDictionary(Pt,this._liaisons)&&this.addPerformableNote(this._liaisons.get(Pt).compositeNote),this._liaisons.put(Pt,new hu(Ft,Ot))):this.addPerformableNote(this.applyArticulationDuration(Ft,Ot,ht,ft))}}}catch(t){wt=!0,Ct=t}finally{try{bt||null==At.return||At.return()}finally{if(wt)throw Ct}}ht.grace?ht.appoggiatura&&(tt+=mn.valueToDuration(ht.value,ht.dots)):tt=0}else if(A.is(ut,Ra)||A.is(ut,bl)){var Ut=A.as(ut,Ca);if(Ut.velocity<=0){var Vt=Ut.articulation;null!=Vt&&(D=Vt)}}}}catch(t){rt=!0,ot=t}finally{try{nt||null==at.return||at.return()}finally{if(rt)throw ot}}}_+=K.duration,P+=K.duration*this._timeScale}}catch(t){B=!0,H=t}finally{try{V||null==G.return||G.return()}finally{if(B)throw H}}var Bt=!0,Ht=!1,$t=void 0;try{for(var Gt,Yt=xt.dictionaryForOfSource(this._liaisons)[Symbol.iterator]();!(Bt=(Gt=Yt.next()).done);Bt=!0){var zt=Gt.value;this.addPerformableNote(zt.compositeNote)}}catch(t){Ht=!0,$t=t}finally{try{Bt||null==Yt.return||Yt.return()}finally{if(Ht)throw $t}}f=!1}}}if(new Tu(t,m).processTempoLines(this._temporalMap),!u&&y&&(this._temporalMap=h.synchronizedTrack.temporalMap.clone()),this._playStart=this._temporalMap.measureIndexToTime(n),!u&&this.playAudioRecordings)for(var Wt=0;Wt<d.length;Wt++){var Xt=A.unknownToType(d[Wt],El),Kt=!1,jt=!0,qt=!1,Jt=void 0;try{for(var Zt,te=Xt.staffIndices[Symbol.iterator]();!(jt=(Zt=te.next()).done);jt=!0){var ee=Zt.value,ie=A.unknownToNumber(ee);if(-1!=this.stavesToMuteForRecording.indexOf(ie)){Kt=!0;break}}}catch(t){qt=!0,Jt=t}finally{try{jt||null==te.return||te.return()}finally{if(qt)throw Jt}}if(!Kt){var ne=!0,re=!1,oe=void 0;try{for(var se,ae=Xt.recordedAudioTracks[Symbol.iterator]();!(ne=(se=ae.next()).done);ne=!0){var le=se.value,ue=A.unknownToType(le,wl);if(ue.playbackEnabled){var ce=!0,fe=!1,ye=void 0;try{for(var ge,pe=ue.audioClips[Symbol.iterator]();!(ce=(ge=pe.next()).done);ce=!0){var me=ge.value,ve=A.unknownToType(me,Ma);this.addAudioClip(ve,Wt)}}catch(t){fe=!0,ye=t}finally{try{ce||null==pe.return||pe.return()}finally{if(fe)throw ye}}}}}catch(t){re=!0,oe=t}finally{try{ne||null==ae.return||ae.return()}finally{if(re)throw oe}}}}if(this._temporalMap.lopOffHead(n),this._temporalMap.startMeasureIndex=n,this.isRecording||!this.metronome.muted||!u&&y){var _e=h.systemStaff;null!=this.metronome.metronomeInstrument&&(this.metronome.metronomeInstrument.mixGain=this.metronome.gain+this._scoreMix.masterGain+this.partCountBackoff(h.numStaves),this.metronome.metronomeInstrument.mixPan=this.metronome.pan),c.push(this.metronome.metronomeInstrument);var Se=c.length-1;this.metronome.channel=Se,d.push(this.metronome.part);var Le=0,ke=v.slice(0);this.metronomeLoop&&ke.push(ke[ke.length-1]);var Te,Ee=!this.temporalMap._entries.length,Me=0,be=!0,we=!1,xe=void 0;try{for(var Ce,Ne=ke[Symbol.iterator]();!(be=(Ce=Ne.next()).done);be=!0){var Ae=Ce.value,Ie=A.unknownToUint(Ae);if(Te=_e.getMeasureAt(Ie),Ee){var Pe=Te.tempo;null==Pe&&(Pe=this.defaultTempo);var Oe=Pe.timeScale;r||(Oe*=this.timeFactor),this._temporalMap.appendEntry(new Mu(Ie,Me,Oe,Le,0)),Me+=Te.duration*Oe}for(var Qe=0;Qe<Te.timeSignature.beats;Qe++)this.createMetronomePerformableNote(Qe,g,Se,Le,Te.timeSignature.beatDuration,{muted:this.metronome.muted}),Le+=Te.timeSignature.beatDuration}}catch(t){we=!0,xe=t}finally{try{be||null==Ne.return||Ne.return()}finally{if(we)throw xe}}if(this.metronomeLoop){var Re=_e.getMeasureAt(A.unknownToUint(v[0])).duration*this.countInMeasures,De=_e.getMeasureAt(A.unknownToUint(v[v.length-1])).duration;this.loopStart=Le-De+Re,this.loopEnd=Le+Re}if(this.isRecording){Te=_e.getMeasureAt(A.unknownToUint(v[0]));var Fe=this.countInMeasures*Te.timeSignature.beats;Le=Te.timeSignature.beatDuration;for(var Ue=1;Ue<=Fe;Ue++)this.createMetronomePerformableNote(Ue%Te.timeSignature.beats,g,Se,-Le,Te.timeSignature.beatDuration,{articulation:ed.MUTED}),Le+=Te.timeSignature.beatDuration}}(i.loop&&(this.loopStart=0,this.loopEnd=this._temporalMap.getScoreDurationInTicks(h)),u||!y)&&((new su).process(t,v,_,this._temporalMap),(new ru).process(t,v,this._temporalMap));var Ve=-this._music.startTime;if(this._music.startTime<0){var Be=Ve,He=Be*this.getStartTimeScale(h,n,l);this._music.offsetPerformance(Be),this._temporalMap.offsetMap(Be,He)}return new gu(this._music,c,d,this._temporalMap,v,h.mix,Ve)}},{key:"entryExistsForMeasureIndex",value:function(t){return!!this._temporalMap&&this._temporalMap.entryExistsForMeasureIndex(t)}},{key:"getStartTimeScale",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!t.synchronizedTrack||t.synchronizedTrack.muted||i?this._temporalMap?this._temporalMap.getTimescaleForMeasureIndex(e):0:t.synchronizedTrack.temporalMap.getTimescaleForMeasureIndex(e)}},{key:"createMetronomePerformableNote",value:function(t,e,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=new td,a=0===t?yu.FIRST_NOTE:yu.SECOND_NOTE;o&&o.muted&&(a=yu.MUTED_NOTE),s.pitch=new kt(a),s.velocity=e,s.channel=i,s.onset=n,s.duration=r/2,o&&o.articulation&&(s.articulation=new ed(A.unknownToString(o.articulation))),this.addPerformableNote(s)}},{key:"addPerformableNote",value:function(t){if(null==t.ornament)this._music.addElement(t),this._noteSetPerformance.push(t);else{var e=!0,i=!1,n=void 0;try{for(var r,o=t.ornament.ornamentNote(t)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,td);this._music.addElement(a),this._noteSetPerformance.push(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"addAudioClip",value:function(t,e){var i=t.trackStartTime-this._playStart,n=t.mediaStartTime||0,r=t.mediaEndTime-n;if(!(i+r<0)){if(i<0){var o=-i;n+=o,r-=o,i=0}var s=this._temporalMap.timeToScorePosition(i),a=this._temporalMap.timeToScorePosition(i+r)-s,l=new Zc;l.onset=s,l.startOffset=n,l.channel=e,l.duration=a,l.mediaDuration=r,l.audioMedia=t.audioMedia,this._music.addElement(l)}}},{key:"clipLastNoteSetDuration",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._noteSetPerformance[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,td);a.onset+a.duration>=t&&(a.duration=Math.max(0,t-a.onset))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"applyArticulationOnset",value:function(t,i,n,r){if(null!=i.noteHead)switch(i.noteHead){case de.CROSS_NOTE_HEAD:t.articulation=new ed(ed.MUTED);break;case de.HARMONIC_NOTE_HEAD:t.articulation=new ed(ed.HARMONIC);break;case de.DIAMOND_NOTE_HEAD:t.articulation=new ed(ed.CLOSED);break;case de.SQUARE_NOTE_HEAD:t.articulation=new ed(ed.SQUARE);break;case de.TRIANGLE_NOTE_HEAD:t.articulation=new ed(ed.TRIANGLE);break;case de.CROSS_CIRCLE_NOTE_HEAD:t.articulation=new ed(ed.CROSS_CIRCLE)}if(n&&(n.hasArticulation(Sn.OPEN_ARTICULATION)&&(t.articulation=new ed(ed.OPEN)),n.hasArticulation(Sn.BUZZ_ARTICULATION)&&(t.articulation=new ed(ed.BUZZ))),null!=r){var o=!0,s=!1,a=void 0;try{for(var l,u=r[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToType(h,qa);switch(c.type){case qa.TYPE_OCTAVE_DOWN:t.pitch=t.pitch.transpose(-12);break;case qa.TYPE_OCTAVE_UP:t.pitch=t.pitch.transpose(12);break;case qa.TYPE_TWO_OCTAVES_UP:t.pitch=t.pitch.transpose(24);break;case qa.TYPE_PEDAL:case qa.TYPE_LET_VIBRATE:if(null!=i.liaisonEndNote||this._forMidi||this._renderExact)break;var d=c.measure.staff.rangeDuration(c.measurePosition,n.measurePosition);this._pedalEnd=t.onset+(c.span-d),t.duration=Math.max(t.duration,Math.min(e.MAX_PEDAL_NOTE_LENGTH/this._timeScale,this._pedalEnd-t.onset));break;case qa.TYPE_PALM_MUTE:t.articulation=new ed(ed.MUTED);break;case qa.TYPE_TRILL:var f=A.as(c,Wl).interval;t.ornament=new od(this.metrics.trillInterval/this._timeScale,f)}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}return n&&n.hasArticulation(Sn.MARCATO_ARTICULATION)&&(t.velocity=Math.min(td.MAX_VELOCITY,t.velocity+this.metrics.marcatoRelativeVelocity)),t}},{key:"applyTremolo",value:function(t,e){if(t.tremolo>0&&!t.grace){var i=Math.min(mn.QUARTER,t.value)-t.tremolo,n=mn.valueToDuration(Math.max(i,1));n*=t.duration/t.rhythmDuration,t.tremoloDyad?(e.duration*=2,n*=2,e.ornament=new rd(n,2,t.rhythmPosition?1:0),t.rhythmPosition>0&&(e.onset-=t.duration)):e.ornament=new rd(n)}}},{key:"doNotStartPlayback",value:function(){this.player&&this.player.doNotStartPlayback()}},{key:"scorePositionToTime",value:function(t){return this._temporalMap?this._temporalMap.scorePositionToTime(t):0}},{key:"createWav",value:function(t,e){this.createPlayer(t).createWav(t.scorePositionMap.scorePositionToTime(t.performance.endTime),e)}},{key:"createMP3",value:function(t,e){this.createPlayer(t).createMP3(t.scorePositionMap.scorePositionToTime(t.performance.endTime),e)}},{key:"createPlayer",value:function(t){var e=new qc(t.instruments,t.scorePositionMap,{parts:t.parts,scoreMix:t.scoreMix});return Kc.getInstance().createMusicPlayer(t.performance,e)}},{key:"startPerformance",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=new qc(t.instruments,t.scorePositionMap,{parts:t.parts,scoreMix:t.scoreMix});this._scoreMix=t.scoreMix;var o=Kc.getInstance(),s=o.createMusicPlayer(t.performance,r);if(this.player=s,s){s.addEventListener(dt.PROGRESS,xt.bindMethod(this,this.handlePlayerProgress)),s.addEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handlePlayerStop)),s.addEventListener(yt.INSTRUMENT_LOAD,xt.bindMethod(this,this.handleInstrumentLoad)),this._usePlayerGain&&(s.gain=Qd.decibelsToFactor(this._scoreMix.masterGain));var a={loopStart:this.loopStart,loopEnd:this.loopEnd};s.play(e,-1,a,i,n),this._isPlaying=!0}else xt.bindMethod(o,o.tooManyContexts)?Gy.show(Ou.getString("alerts/tooManyAudioContexts")):Gy.show(Ou.getString("alerts/audioOutputNotSupported"))}},{key:"playPerformance",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(this._isPlaying&&this.stopPerformance(),e.synchronizedTrack&&!e.synchronizedTrack.muted){this._scoreMix=e.mix;var s=e.synchronizedTrack.createPlayer(A.numberToInt(n));if(s){var a=this,l=t.ticksBeforeActualScore*this.getStartTimeScale(e,n)*1e3;X.flash_utils_setTimeout(function(){a.dispatchEvent(new ji(ji.SYNCHRONIZED_MEDIA_PLAY,s.firstMeasureTime))},l)}}this.startPerformance(t,i,r,o)}},{key:"stopPerformance",value:function(){null!=this.player&&(this.player.stop(),this.player=null,this.loopStart=-1,this.loopEnd=-1,this.stavesToMuteForRecording=[]),this._isPlaying=!1,this.dispatchEvent(new ji(ji.SYNCHRONIZED_MEDIA_STOP))}},{key:"pausePerformance",value:function(){null!=this.player&&this.player.pause(),this._isPlaying=!1,this.dispatchEvent(new ji(ji.SYNCHRONIZED_MEDIA_PAUSE))}},{key:"prepareToResumePlayback",value:function(){null!=this.player&&this.player.prepareToResumePlayback()}},{key:"startFromBeginning",value:function(){this.dispatchEvent(new ji(ji.SYNCHRONIZED_MEDIA_START_FROM_BEGINNING))}},{key:"echoNotes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new nd,r=[],o=[],s=!0,a=!1,l=void 0;try{for(var u,h=t[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;if(A.is(c,de)){var d=A.as(c,de);if(!d.playable)continue;var f=!!(d.noteSet&&d.noteSet.measure&&d.noteSet.measure.staff);if(f?(this._lastStaff=d.noteSet.measure.staff,this._lastInstrument=this.getInstrument(this._lastStaff,e)):null==this._lastInstrument&&null!=i&&(this._lastStaff=i,this._lastInstrument=this.getInstrument(this._lastStaff,e)),null==this._lastStaff)continue;var y=r.indexOf(this._lastInstrument);y<0&&(y=r.length,r.push(this._lastInstrument),o.push(this._lastStaff.part));var g=f&&d.noteSet.measure.effectiveClef.unpitched?0:this.pitchAdjustment,p=new td;p.onset=0,p.channel=y,p.pitch=d.pitch.transpose(A.numberToInt(g)),p.velocity=td.STANDARD_VELOCITY,p.duration=.3,this.applyArticulationOnset(p,d,d.noteSet,null),n.addElement(p)}}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}var m=new qc(r,new uu,{parts:o,scoreMix:this._lastStaff?this._lastStaff.score.mix:null}),v=Kc.getInstance().createMusicPlayer(n,m);v&&(v.addEventListener(yt.INSTRUMENT_LOAD,xt.bindMethod(this,this.handleInstrumentLoad)),v.play())}},{key:"handlePlayerProgress",value:function(t){this.dispatchEvent(t)}},{key:"handlePlayerStop",value:function(t){var e=this.player;null!=e&&(e.removeEventListener(dt.PROGRESS,xt.bindMethod(this,this.handlePlayerProgress)),e.removeEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handlePlayerStop))),this.dispatchEvent(t),this.player=null}},{key:"handleInstrumentLoad",value:function(t){this.dispatchEvent(t)}},{key:"getSourceMeasureIndex",value:function(t,e){for(var i=e;i>=0;i--){if(null==t.getMeasureAt(i).measureRepeatNotation)return i}return 0}},{key:"instrumentResolver",get:function(){return this._$instrumentResolver},set:function(t){var e=this._$instrumentResolver;this._$instrumentResolver=t,e!==t&&this._propertyChanged("instrumentResolver",e,t)}},{key:"player",get:function(){return this._$player},set:function(t){var e=this._$player;this._$player=t,e!==t&&this._propertyChanged("player",e,t)}},{key:"metrics",get:function(){return this._$metrics},set:function(t){var e=this._$metrics;this._$metrics=t,e!==t&&this._propertyChanged("metrics",e,t)}},{key:"defaultTempo",get:function(){return this._$defaultTempo},set:function(t){var e=this._$defaultTempo;this._$defaultTempo=t,e!==t&&this._propertyChanged("defaultTempo",e,t)}},{key:"pitchAdjustment",get:function(){return this._$pitchAdjustment},set:function(t){var e=this._$pitchAdjustment;this._$pitchAdjustment=t,e!==t&&this._propertyChanged("pitchAdjustment",e,t)}},{key:"isRecording",get:function(){return this._$isRecording},set:function(t){var e=this._$isRecording;this._$isRecording=t,e!==t&&this._propertyChanged("isRecording",e,t)}},{key:"metronome",get:function(){return this._$metronome},set:function(t){var e=this._$metronome;this._$metronome=t,e!==t&&this._propertyChanged("metronome",e,t)}},{key:"countInMeasures",get:function(){return this._$countInMeasures},set:function(t){var e=this._$countInMeasures;this._$countInMeasures=t,e!==t&&this._propertyChanged("countInMeasures",e,t)}},{key:"metronomeLoop",get:function(){return this._$metronomeLoop},set:function(t){var e=this._$metronomeLoop;this._$metronomeLoop=t,e!==t&&this._propertyChanged("metronomeLoop",e,t)}},{key:"speedAdjustment",get:function(){return-Math.log(this.timeFactor)/Math.LN2},set:function(t){this.timeFactor=Math.pow(2,-t)}},{key:"timeFactor",get:function(){return this._timeFactor},set:function(t){this._timeFactor=t}},{key:"temporalMap",get:function(){return this._temporalMap}},{key:"lastMeasureIndexWithEntry",get:function(){return this._temporalMap?this._temporalMap.lastMeasureIndexWithEntry:0}},{key:"nextMeasurePosition",get:function(){return this.temporalMap.timeToNextMeasurePosition(this.playbackTimePosition)}},{key:"nextMeasurePositionIfAny",get:function(){return this.temporalMap.timeToNextMeasurePositionIfAny(this.playbackTimePosition)}},{key:"playbackTimePosition",set:function(t){this.player&&(this.player.position=t)},get:function(){return null==this.player?NaN:this.player.position}},{key:"playbackStartMeasure",get:function(){return null==this.player?0:this._startMeasureIndex}},{key:"position",get:function(){return null==this.player?null:this._temporalMap.timeToMeasurePosition(this.player.position)},set:function(t){var e=this.player;null!=e&&(e.position=this._temporalMap.measureIndexToTime(t.measureIndex))}},{key:"statusText",get:function(){return""}}],[{key:"createNotationPerformer",value:function(t,e){return new mu(t,e)}}]),e}();r.registerClass(pu,"com.noteflight.notation.performance.NotationPerformer");var mu=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,pu),p(e,[{key:"createModulation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s={};return s.name=t,s.startTime=e,s.endTime=i,s.minValue=n,s.maxValue=r,s.frequency=o,s}},{key:"createBendLiaison",value:function(t,e,i){var n=t.duration-e.duration,r=e.duration,o=n+r*this.metrics.bendStartDurationFactor,s=n+r*this.metrics.bendStopDurationFactor,a=e.tunedOrdinal-t.tunedOrdinal,l=i.tunedOrdinal-t.tunedOrdinal;return this.createModulation(de.BEND_LIAISON,o,s,a,l)}},{key:"createSlideLiaison",value:function(t,e,i){var n=e.duration,r=Math.min(n,this.metrics.slideStartInterval/this._timeScale),o=t.duration,s=e.tunedOrdinal-t.tunedOrdinal,a=i.tunedOrdinal-t.tunedOrdinal;return this.createModulation(de.SLIDE_LIAISON,o-r,o,s,a)}},{key:"createVibrato",value:function(t){return this.createModulation(qa.TYPE_VIBRATO,0,t.duration,0,this.metrics.vibratoRange,this.metrics.vibratoFrequency)}}]),e}();r.registerClass(mu,"com.noteflight.notation.performance.NotationPerformerHtml5");var vu=function t(e,i){y(this,t),this.metrics=new aa,this.scoreMap=null,this.scoreMap=[];var n=null,r=null,o=(e[0].score.numMeasures,0),s=!0,a=!1,l=void 0;try{for(var u,h=e[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=[],f=e[o+1]&&e[o+1].part==c.part,g=null!=r&&c.part==r.part;f?n=[]:g||(n=null);var p,m,v=[];for(p=0;p<c.numChildren;p++){f&&n&&(n[p]=[]);var _=c.getMeasureAt(p),S=[],L=!0,k=!1,T=void 0;try{for(var E,M=_.getVoiceNumber(Kl.NON_METRICAL_VOICE_NUMBER).elements[Symbol.iterator]();!(L=(E=M.next()).done);L=!0){var b=E.value;if(m=A.unknownToType(b,he),A.is(m,Ra)&&A.unknownToType(m,Ra).velocity>0&&(S.push(m),f&&A.unknownToType(m,Ra).belowStaff&&n&&n[p].push(m)),A.is(m,Ra)||A.is(m,bl))null!=A.as(m,Ca).articulation&&S.push(m)}}catch(t){k=!0,T=t}finally{try{L||null==M.return||M.return()}finally{if(k)throw T}}var w=!0,x=!1,C=void 0;try{for(var N,I=c.getSpanNotations(p)[Symbol.iterator]();!(w=(N=I.next()).done);w=!0){m=N.value;var P=A.unknownToType(m,Ua);("crescendo"==P.type||"diminuendo"==P.type)&&P.span>0&&(S.push(m),f&&A.unknownToType(m,Ua).belowStaff&&n&&n[p].push(m))}}catch(t){x=!0,C=t}finally{try{w||null==I.return||I.return()}finally{if(x)throw C}}g&&n&&(S=n[p].concat(S)),S.sort(ae.compareScorePosition),v[p]=S}var O=new Uy,Q=A.numberToInt(this.metrics.defaultVelocity),R=null,D=!0,F=!1,U=void 0;try{for(var V,B=i[Symbol.iterator]();!(D=(V=B.next()).done);D=!0){var H=V.value;if(d[p=A.unknownToUint(H)])Q=d[p].lastVelocity,R=d[p].lastArticulation;else{var $=new du(Q,R);d[p]=$;var G=!0,Y=!1,z=void 0;try{for(var W,X=xt.unknownForOfSource(v[p])[Symbol.iterator]();!(G=(W=X.next()).done);G=!0){var K=W.value;if(m=A.unknownToType(K,he),A.is(m,Ra)){var j=A.unknownToType(m,Ra).velocity;j>0&&($.addVelocity(m.position,j),Q=j)}if(A.is(m,Ra)||A.is(m,bl)){var q=A.as(m,Ca).articulation;null!=q&&($.addArticulation(m.position,q.value),R=q.value)}else if(A.is(m,Ua)){var J=A.unknownToType(O.get(m),Qa);null==J&&(J=new Qa(A.unknownToType(m,Ua),c,v,Q),O.put(m,J));for(var Z=!1,tt=J.startIndex;tt<=J.endIndex&&!Z;tt++){var et=!0,it=!1,nt=void 0;try{for(var rt,ot=xt.unknownForOfSource(v[tt])[Symbol.iterator]();!(et=(rt=ot.next()).done);et=!0){var st=rt.value,at=A.unknownToType(st,he);if(A.is(at,Ra)){if(A.unknownToType(at,Ra).velocity>0&&J.overlapsNotation(tt,at)){Z=!0;break}}else if(A.is(at,Ua)&&at!=m&&at.measure.staff==c&&J.overlapsSpan(A.unknownToType(at,Ua))){Z=!0;break}}}catch(t){it=!0,nt=t}finally{try{et||null==ot.return||ot.return()}finally{if(it)throw nt}}}Z||($.addGradient(J.startIndex<p?0:J.startPosition,J),J.endIndex==p&&(Q=J.endVelocity))}}}catch(t){Y=!0,z=t}finally{try{G||null==X.return||X.return()}finally{if(Y)throw z}}$.lastVelocity||($.lastVelocity=Q),null==$.lastArticulation&&($.lastArticulation=R)}}}catch(t){F=!0,U=t}finally{try{D||null==B.return||B.return()}finally{if(F)throw U}}this.scoreMap.push(d),r=c,o++}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}};r.registerClass(vu,"com.noteflight.notation.performance.StateMap");var _u=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,Jl),p(e,[{key:"load",value:function(){}},{key:"createView",value:function(){return null}},{key:"destroy",value:function(){}},{key:"createPlayer",value:function(t){return new Lu(this.getStartTime(t))}},{key:"loadVideo",value:function(){}},{key:"handleLoaderReady",value:function(t){}},{key:"handlePlayerReady",value:function(t){}},{key:"handlePlayerError",value:function(t){this.dispatchEvent(new Cf(Cf.IO_ERROR,!1,!1,""))}},{key:"handlePlayerStateChange",value:function(t){}},{key:"handleAudioEvent",value:function(t){this.dispatchEvent(t)}},{key:"clone",value:function(){var t=this._temporalMap.clone(),i=new e(this._audioUrl,t);return i.muted=this.muted,i.gain=this.gain,i._complete=this._complete,i}},{key:"player",get:function(){return null}},{key:"length",get:function(){return 0}},{key:"seekPosition",get:function(){return 0},set:function(t){}}]),e}();r.registerClass(_u,"com.noteflight.notation.performance.SynchronizedHtml5Media");var Su=function t(){y(this,t)};r.implementsInterfaces(Su,[vt]),r.registerClass(Su,"com.noteflight.performance.IMusicPlayer");var Lu=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._firstMeasureTime=0,i._firstMeasureTime=t,i}return c(e,At),p(e,[{key:"play",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4]}},{key:"stop",value:function(){this.dispatchEvent(new ct(ct.SOUND_COMPLETE))}},{key:"handleTimer",value:function(t){this.dispatchEvent(new dt(dt.PROGRESS))}},{key:"createWav",value:function(t,e){}},{key:"pause",value:function(){}},{key:"prepareToResumePlayback",value:function(){}},{key:"doNotStartPlayback",value:function(){}},{key:"position",get:function(){return 0},set:function(t){}},{key:"firstMeasureTime",get:function(){return this._firstMeasureTime},set:function(t){this._firstMeasureTime=t}},{key:"syncTrack",get:function(){return!0}},{key:"gain",get:function(){return 0},set:function(t){}}]),e}();r.implementsInterfaces(Lu,[Su]),r.registerClass(Lu,"com.noteflight.notation.performance.SynchronizedHtml5MediaPlayer");var ku=function(){function t(e,i,n){y(this,t),this._type=null,this._startPos=null,this._endPos=null,this._type=e,this._startPos=i,this._endPos=n}return p(t,[{key:"startPos",get:function(){return this._startPos},set:function(t){this._startPos=t}},{key:"endPos",get:function(){return this._endPos},set:function(t){this._endPos=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t}}],[{key:"compareTempoElement",value:function(t,e){var i=t.startPos.compareTo(e.startPos);return i||((i=t.endPos.compareTo(e.endPos))||(t.type<e.type?-1:t.type>e.type?1:0))}}]),t}();r.registerClass(ku,"com.noteflight.notation.performance.TempoLineElement");var Tu=function(){function t(e,i){y(this,t),this._tempoLines=[],this._aTempoList=[];var n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){for(var l=s.value,u=A.unknownToType(l,Rl),h=0;h<u.numChildren;h++){var c=!0,d=!1,f=void 0;try{for(var g,p=u.getSpanNotations(h)[Symbol.iterator]();!(c=(g=p.next()).done);c=!0){var m=g.value,v=A.unknownToType(m,Ua);if(v.span>0&&(v.type==qa.TYPE_ACCELERANDO||v.type==qa.TYPE_RITARDANDO)){var _=v.measurePosition,S=v.endPosition,L=new ku(v.type,_,S);this._tempoLines.push(L)}}}catch(t){d=!0,f=t}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}var k=0,T=!0,E=!1,M=void 0;try{for(var b,w=i[Symbol.iterator]();!(T=(b=w.next()).done);T=!0){var x=b.value,C=A.unknownToInt(x),N=u.getMeasureAt(A.intToUint(C)),I=N.measureNotations,P=!0,O=!1,Q=void 0;try{for(var R,D=I[Symbol.iterator]();!(P=(R=D.next()).done);P=!0){var F=R.value,U=A.unknownToType(F,he);if(A.is(U,bl)||A.is(U,Ra)){var V=A.as(U,Ca);/^a tempo/i.test(V.text)&&this._aTempoList.push(V.position+k)}}}catch(t){O=!0,Q=t}finally{try{P||null==D.return||D.return()}finally{if(O)throw Q}}N.systemMeasure.endRepeat&&this._aTempoList.push(k+N.duration),k+=N.duration}}catch(t){E=!0,M=t}finally{try{T||null==w.return||w.return()}finally{if(E)throw M}}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this.sortByPosition(),this.removeDuplicates(),this._aTempoList.sort(function(t,e){return t-e})}return p(t,[{key:"sortByPosition",value:function(){this._tempoLines.sort(ku.compareTempoElement)}},{key:"removeDuplicates",value:function(){for(var t=0;t<this._tempoLines.length-1;++t)0===ku.compareTempoElement(this._tempoLines[t],this._tempoLines[t+1])&&(this._tempoLines.splice(t+1,1),--t)}},{key:"processTempoLines",value:function(t){for(var e=[],i=new Ua(0,!1,0,0,0),n=new gl(0,0),r=new gl(0,0),o=new ku(i.type,n,r),s=-1;(s=this.getNextCluster(s,o))>=0;)0!==o.startPos.compareTo(o.endPos)&&e.push(new ku(o.type,o.startPos,o.endPos));t.processTempoLineClusters(e,this._aTempoList)}},{key:"getNextCluster",value:function(t,e){t<-1&&(t=-1);var i=t+1;if(this._tempoLines.length>0&&i<this._tempoLines.length){for(e.type=this._tempoLines[i].type,e.startPos=this._tempoLines[i].startPos,e.endPos=this._tempoLines[i].endPos;++i<this._tempoLines.length;){var n=this._tempoLines[i];if(n.startPos.isGreaterThan(e.endPos)){--i;break}if(n.type!=e.type){e.endPos=n.startPos,--i;break}n.endPos.isGreaterThan(e.endPos)&&(e.endPos=n.endPos)}return i}return-1}}]),t}();r.registerClass(Tu,"com.noteflight.notation.performance.TempoLineMap");var Eu=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return y(this,e),(t=l(this,h(e).call(this)))._startMeasureIndex=0,t._entries=[],t.offset=0,t._timeScaleMinimumChange=1e-4,t._scorePositionIndex=0,t._startMeasureIndex=i,t}return c(e,At),p(e,null,[{key:"MINIMUM_TIME_INTERVAL",get:function(){return.001}}]),p(e,[{key:"dumpTemporalMap",value:function(){X.trace(" "),X.trace("TemporalMap:");for(var t=0;t<this.length;++t){var e=this.getEntryAt(t);X.trace("i: ",t," measureIndex: ",e.measureIndex," scorePosition: ",e.scorePosition," onset: ",e.onset," timescale: ",e.timescale," measurePosition: ",e.measurePosition)}X.trace("--- end map"),X.trace("")}},{key:"setMeasureStartTimes",value:function(t,e){var i;this._entries=[];for(var n=null,r=null,o=A.intToUint(this._startMeasureIndex);o<t.numMeasures&&o<e.length;){var s=A.unknownToType(e[o],cu),a=new Mu(o,s.startTime,0,0,0);if(this._entries.push(a),null!=n&&null!=r){var l=s.startTime-n.startTime;a.timescale=r.timescale=l/i}n=s,r=a,i=t.systemStaff.getMeasureAt(o).duration,o++}}},{key:"getScoreDurationInTicks",value:function(t){var e=this._entries[this.length-1];return e?e.scorePosition+t.getSystemStaffMeasureAt(e.measureIndex).duration:0}},{key:"getScoreDuration",value:function(t){return this.scorePositionToTime(this.getScoreDurationInTicks(t))}},{key:"generateScorePositions",value:function(t){for(var e=0,i=0;i<this._entries.length;i++){var n=this._entries[i];n.scorePosition=e;var r=t.getSystemStaffMeasureAt(n.measureIndex);if(!r)return;e+=r.duration}}},{key:"adjustTo0",value:function(){if(0!==this._entries.length){if(0!==this._entries[0].onset){var t=this._entries[0].onset;this.offset+=t;for(var e=0;e<this._entries.length;e++){this._entries[e].onset-=t}}}else this.offset=0}},{key:"getEntryAt",value:function(t){return this._entries[t]}},{key:"appendEntry",value:function(t){this._entries.push(t)}},{key:"removeEntryAt",value:function(t){this._entries.splice(t,1),this.adjustTo0()}},{key:"updateEntryAt",value:function(t,e){this._entries[t]=e}},{key:"offsetMap",value:function(t,e){this.offsetMapFromIndex(0,t,e)}},{key:"offsetMapFromIndex",value:function(t,e,i){if(e){var n=0,r=0,o=0,s=0;if(t>=0&&t<this.length){var a=this.getEntryAt(A.numberToInt(t));n=a.timescale,r=a.measureIndex,o=a.onset,s=a.scorePosition,a.measurePosition;for(var l=A.numberToInt(t);l<this.length;l++){var u=this.getEntryAt(l);u.onset+=i,u.scorePosition+=e}}e>0&&this._entries.splice(A.numberToInt(t),0,new Mu(r,o,n,s,-e))}}},{key:"lopOffHead",value:function(t){var e=this.getNextEntryIndexForMeasIndex(t);if(e>0){var i=this.getEntryAt(e),n=i.scorePosition,r=i.onset;this._entries.splice(0,A.intToUint(e)),this.offsetMap(-n,-r)}}},{key:"scorePositionToTime",value:function(t){if(!this.length)return 0;var e=this.getEntryAt(A.numberToInt(this._scorePositionIndex));return(null==e||t<e.scorePosition||this._scorePositionIndex+1<this.length&&t>=this.getEntryAt(A.numberToInt(this._scorePositionIndex+1)).scorePosition)&&(this._scorePositionIndex=this.getEntryIndexForPosition(t),e=this.getEntryAt(A.numberToInt(this._scorePositionIndex))),null!=e?e.onset+(t-e.scorePosition)*e.timescale:t*this.getEntryAt(0).timescale}},{key:"measureIndexToTime",value:function(t){var e=this.startTime,i=this.getFirstEntryForMeasIndex(t);return null!=i&&(e=i.onset),e}},{key:"timeToNextMeasurePositionIfAny",value:function(t){if(0!==this.length&&t>this.startTime){var e=this.getEntryIndexForTime(t);if(e+1<this._entries.length){var i=this.getEntryAt(e+1);return new gl(A.intToUint(i.measureIndex),0)}}return null}},{key:"timeToNextMeasurePosition",value:function(t){var e=this.timeToNextMeasurePositionIfAny(t);return e||new gl(A.intToUint(this._startMeasureIndex),0)}},{key:"timeToMeasurePosition",value:function(t){var e=null;if(0===this.length||t<=this.startTime)e=new gl(A.intToUint(this._startMeasureIndex),0);else{var i=this.getEntryIndexForTime(t),n=this.getEntryAt(i);if(null==n)e=new gl(A.intToUint(this._startMeasureIndex),0);else{var r=n.measureIndex,o=n.timescale;0===o&&(o=.015625);var s=(t-n.onset)/o+n.measurePosition;e=new gl(A.intToUint(r),s>0?s:0)}}return e}},{key:"timeToScorePosition",value:function(t){if(0===this.length||t<=this.startTime)return 0===this.length?0:this.getEntryAt(0).scorePosition;var e=this.getEntryForTime(t);return e.scorePosition+(t-e.onset)/e.timescale}},{key:"measurePositionToScorePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.getNextEntryIndexForMeasIndex(t.measureIndex,e);if(i>=0){var n=this.getEntryAt(i);if(null!=n)return n.scorePosition+t.position}return-1}},{key:"getEntryIndexForMeasurePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.measurePositionToScorePosition(t);if(i>=0){var n=this.getEntryIndexForPosition(i);if(e&&n>0)if(this.getEntryAt(n).measureIndex==t.measureIndex+1)return n-1;return n}return-1}},{key:"getTimescaleForMeasureIndex",value:function(t){var e=this.getEntryForMeasurePosition(new gl(A.numberToUint(t),0));return e?e.timescale:-1}},{key:"entryExistsForMeasureIndex",value:function(t){return null!=this.getEntryForMeasurePosition(new gl(A.numberToUint(t),0))}},{key:"getEntryForMeasurePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getEntryIndexForMeasurePosition(t,e);return this.getEntryAt(i)}},{key:"getTimescaleForMeasurePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getEntryForMeasurePosition(t,e).timescale}},{key:"getTimescaleForScorePosition",value:function(t){return this.getEntryForPosition(t).timescale}},{key:"getTimescaleForScorePositionEnd",value:function(t){var e=this.getEntryIndexForPosition(t);if(e<0)return 0;var i=this.getEntryAt(e),n=i.timescale;return i.scorePosition<t&&e<this.length-1&&(n=(i=this.getEntryAt(++e)).timescale),n}},{key:"getFirstEntryForMeasIndex",value:function(t){var e=this.getFirstEntryIndexForMeasIndex(t);return e<0?null:this.getEntryAt(e)}},{key:"getFirstEntryIndexForMeasIndex",value:function(t){for(var e=0;e<this.length;++e){if(this.getEntryAt(e).measureIndex>=t)return e}return-1}},{key:"getNextEntryIndexForMeasIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=-1;e&&("scorePosition"in e?i=A.unknownToNumber(e.scorePosition):e.scorePosition=-1);for(var n=0;n<this.length;++n){var r=this.getEntryAt(n);if(r.measureIndex==t&&0===r.measurePosition&&r.scorePosition>i)return e&&(e.scorePosition=r.scorePosition),n}return-1}},{key:"getEntryIndexForTime",value:function(t){return Xd.binarySearch(this._entries,t,xt.bindMethod(this,this.compareOnset))}},{key:"compareOnset",value:function(t,e){var i=t-A.as(e,Mu).onset;return i<0?-1:i>0?1:0}},{key:"getEntryForTime",value:function(t){var e=this.getEntryIndexForTime(t);return e<0?null:this.getEntryAt(e)}},{key:"getEntryIndexForPosition",value:function(t){return Xd.binarySearch(this._entries,t,xt.bindMethod(this,this.comparePosition))}},{key:"comparePosition",value:function(t,e){var i=t-A.as(e,Mu).scorePosition;return i<0?-1:i>0?1:0}},{key:"getEntryForPosition",value:function(t){var e=this.getEntryIndexForPosition(t);return e<0?null:this.getEntryAt(e)}},{key:"processTempoLineClusters",value:function(t,e){for(var i=this.buildOriginalTempoList(),n=[],r=0;r<t.length;++r)for(var o=t[r],s={scorePosition:-1},a={scorePosition:-1},l=this.measurePositionToScorePosition(o.startPos,s);l>=0;){var u=this.measurePositionToScorePosition(o.endPos,a);if(l!=u){var h={type:o.type,startScorePos:l,endScorePos:u};n.push(h)}l=this.measurePositionToScorePosition(o.startPos,s)}n.sort(function(t,e){var i=t.startScorePos-e.startScorePos;return i||((i=t.endScorePos-e.endScorePos)||(t.type<e.type?-1:t.type>e.type?1:0))});for(var c=0;c<n.length;++c){var d=n[c];if(this.punchTempoLineIntoTemporalMap(d,e,i),0===this._timeScaleMinimumChange){this.dispatchEvent(new ct(ct.TOO_MANY_TEMPO_CHANGE_MARKINGS));break}}}},{key:"_setTimeScaleMinimumChange",value:function(t,e){var i;return i=Math.abs(e-t)/Math.pow(2,-14)<1e6?1e-4:0,this._timeScaleMinimumChange=i,i}},{key:"buildOriginalTempoList",value:function(){for(var t=[],e=-1,i=0;i<this._entries.length;++i){var n=this.getEntryAt(i);n.timescale!=e&&(t.push(new z(n.scorePosition,n.timescale)),e=n.timescale)}return t}},{key:"punchTempoLineIntoTemporalMap",value:function(t,e,i){var n=A.unknownToNumber(t.startScorePos),r=A.unknownToNumber(t.endScorePos),o=qa.TYPE_RITARDANDO==t.type,s=this.getTimescaleForScorePosition(n),a=this.getTimescaleForScorePositionEnd(r);if(s<a&&o||s>a&&!o){if(0===this._setTimeScaleMinimumChange(s,a))return;this.addGradualTempoChange(n,r,s,a),this.addTempoChangeAtScorePosition(r,a),this.updateStartOfMeasureRecords(n,r)}else{var l=a,u=s==a;if(o)a=s*(1/(aa.tempoLineRitPercent/100));else a=s*(1/(aa.tempoLineAccelPercent/100));if(u&&(l=a),0===this._setTimeScaleMinimumChange(s,a))return;if(this.addGradualTempoChange(n,r,s,a),aa.TEMPO_LINE_RETURN_TO_OLD_TEMPO==aa.tempoLineState)this.addTempoChangeAtScorePosition(r,s);else if(this.addTempoChangeAtScorePosition(r,l),aa.TEMPO_LINE_RETURN_AT_A_TEMPO==aa.tempoLineState){var h=Number.MAX_VALUE,c=this.findOriginalTempo(n,r,e,i);c&&(h=A.unknownToNumber(c.scorePosition),this.addTempoChangeAtScorePosition(h,A.unknownToNumber(c.timescale))),this.updateTimeScale(r,s,l,h)}else this.updateTimeScale(r,s,l);this.updateStartOfMeasureRecords(n,r)}this.recomputeOnsetTimes()}},{key:"findOriginalTempo",value:function(t,e,i,n){if(0===n.length)return null;for(var r=0;r<i.length;++r)if(i[r]>=e){for(var o=i[r],s=n[0].timescale,a=1;a<n.length&&!(n[a].scorePosition>t);++a)s=n[a].timescale;return new z(o,s)}return null}},{key:"updateTimeScale",value:function(t,e,i){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE,r=this.getEntryIndexForPosition(t);++r<this.length;){var o=this.getEntryAt(r);if(o.timescale!=e)break;if(o.scorePosition>=n)break;o.timescale=i}}},{key:"addGradualTempoChange",value:function(t,i,n,r){var o=!0;if(Math.abs(r-n)<=this._timeScaleMinimumChange?o=!1:(i-t)*(n+r)/2<=e.MINIMUM_TIME_INTERVAL&&(o=!1),o){var s=this.interpolatePosition(t,i),a=this.interpolateTempo(n,r);this.addGradualTempoChange(t,s,n,a),this.addGradualTempoChange(s,i,a,r)}else this.addTempoChangeAtScorePosition(t,n)}},{key:"interpolatePosition",value:function(t,e){return t+(e-t)/2}},{key:"interpolateTempo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;if(0===t||0===e)return t+(e-t)/2;var n=1/t;return 1/(n+(1/e-n)*i)}},{key:"addTempoChangeAtScorePosition",value:function(t,e){var i=this.getEntryIndexForPosition(t);if(i>=0){var n=this.getEntryAt(i);if(n.scorePosition==t)n.timescale=e;else{var r=new Mu(0,0,0,0,0);r.measureIndex=n.measureIndex,r.scorePosition=t,r.onset=n.onset+(t-n.scorePosition)*n.timescale,r.timescale=e,r.measurePosition=n.measurePosition+(t-n.scorePosition),this._entries.splice(i+1,0,r)}}}},{key:"updateStartOfMeasureRecords",value:function(t,e){var i=this.getEntryIndexForPosition(t),n=this.getEntryIndexForPosition(e);if(!(i<0||n<0))for(var r=this.getEntryAt(i),o=i+1;o<n;++o){var s=this.getEntryAt(o);if(!s.measurePosition&&o<this.length-1){var a=this.getEntryAt(o+1),l=(s.scorePosition-r.scorePosition)/(a.scorePosition-r.scorePosition),u=this.interpolateTempo(r.timescale,a.timescale,l);s.timescale=u}r=s}}},{key:"processFermata",value:function(t,e){var i=t.scorePosition,n=t.scorePosition+t.duration;this.punchOut(i,n,e)&&(this.punchInFermata(i,n,t.duration),this.applyRitardBeforeFermata(i))}},{key:"punchOut",value:function(t,e,i){if(e<=t)return!1;var n=this.getEntryIndexForPosition(t),r=this.getEntryIndexForPosition(e);if(n<0||r<0)return!1;this.getEntryAt(n);var o=this.getEntryAt(r);if(e>=i)e=i,r=this.length;else if(e>o.scorePosition)if(n==r){var s=new Mu(o.measureIndex,o.onset+(e-o.scorePosition)*o.timescale,o.timescale,e,o.measurePosition+(e-o.scorePosition));this._entries.splice(++r,0,s)}else{var a=e-o.scorePosition;o.onset+=a*o.timescale,o.scorePosition=e,o.measurePosition+=a}var l=r-n-1;return l>0&&this._entries.splice(n+1,A.intToUint(l)),!0}},{key:"punchInFermata",value:function(t,e,i){var n=this.getEntryIndexForPosition(t);if(!(n<0)){var r=this.getEntryAt(n),o=i*r.timescale*(aa.fermataPercent/100-1);if(t>r.scorePosition){var s=new Mu(r.measureIndex,r.onset+(t-r.scorePosition)*r.timescale,r.timescale*aa.fermataPercent/100,t,r.measurePosition+(t-r.scorePosition));this._entries.splice(++n,0,s)}else r.timescale*=aa.fermataPercent/100;this.adjustOnsetTimes(n+1,o)}}},{key:"applyRitardBeforeFermata",value:function(t){if(aa.FERMATA_NO_RITARD!=aa.fermataState){var e=this.getEntryIndexForPosition(t),i=this.getEntryAt(e),n=0;if(aa.FERMATA_RITARD_TIME_BASED==aa.fermataState)n=Math.max(i.onset-aa.fermataRitLengthTime,0);else{var r=Math.max(t-64*aa.fermataRitLengthBeats,0);n=this.scorePositionToTime(r)}if(n<i.onset){for(var o=this.getEntryIndexForTime(n),s=this.getEntryAt(o),a=o,l=s.measureIndex,u=this.getEntryAt(++a),h=!1;u.onset<i.onset;){if(u.measureIndex==l){h=!0;break}l=u.measureIndex,u=this.getEntryAt(++a)}if(!h){var c=this.timeToScorePosition(n),d=t,f=s.timescale,y=f*aa.fermataRitPercent/100;this.addGradualTempoChange(c,d,f,y),this.recomputeOnsetTimes()}}}}},{key:"adjustOnsetTimes",value:function(t,e){if(t>=0)for(var i=t;i<this.length;i++){this.getEntryAt(i).onset+=e}}},{key:"recomputeOnsetTimes",value:function(){if(this.length){var t=this.getEntryAt(0);t.onset=0;for(var e=1;e<this.length;e++){var i=this.getEntryAt(e);i.onset=t.onset+(i.scorePosition-t.scorePosition)*t.timescale,t=i}}}},{key:"processCaesura",value:function(t){var e=this.getEntryForPosition(t),i=0;i=aa.CAESURA_TIME_BASED==aa.caesuraState?aa.caesuraLengthTime:64*aa.caesuraLengthBeats*e.timescale,this.addTempoChangeAtScorePosition(t,e.timescale);var n=this.getEntryIndexForPosition(t);for(e=this.getEntryAt(n),this._entries.splice(n,0,new Mu(e.measureIndex,e.onset,i,e.scorePosition,e.measurePosition)),++n;n<this.length;++n)(e=this.getEntryAt(n)).onset+=i}},{key:"clone",value:function(){var t=new e(A.intToUint(this._startMeasureIndex));t.offset=this.offset;for(var i=0;i<this.length;i++)t.appendEntry(this.getEntryAt(i).clone());return t}},{key:"length",get:function(){return this._entries.length}},{key:"startMeasureIndex",set:function(t){this._startMeasureIndex=A.numberToInt(t)}},{key:"startTime",get:function(){return 0===this.length?0:this._entries[0].onset}},{key:"startPosition",get:function(){return 0===this.length?0:this._entries[0].scorePosition}},{key:"startTimeScale",get:function(){return 0===this.length?0:this._entries[0].timescale}},{key:"startTimes",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this._entries[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push(s.onset)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"lastMeasureIndexWithEntry",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this._entries[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t=Math.max(t,s.measureIndex)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}}],[{key:"equals",value:function(t,e){if(t==e)return!0;if(null==t||null==e)return!1;if(t._startMeasureIndex!=e._startMeasureIndex||t.offset!=e.offset||t._scorePositionIndex!=e._scorePositionIndex||t.length!=e.length)return!1;for(var i=0;i<t.length;i++){var n=t._entries[i],r=e._entries[i];if(!Mu.equals(n,r))return!1}return!0}}]),e}();r.implementsInterfaces(Eu,[lu]),r.registerClass(Eu,"com.noteflight.notation.performance.TemporalMap");var Mu=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this)))._$measureIndex=0,s._measurePosition=NaN,s._$_scorePosition=NaN,s._$onset=NaN,s._$timescale=NaN,s.measureIndex=t,s.onset=i,s.timescale=n,s._scorePosition=r,s._measurePosition=o,s}return c(e,At),p(e,[{key:"clone",value:function(){return new e(this.measureIndex,this.onset,this.timescale,this._scorePosition,this._measurePosition)}},{key:"measureIndex",get:function(){return this._$measureIndex},set:function(t){var e=this._$measureIndex;this._$measureIndex=t,e!==t&&this._propertyChanged("measureIndex",e,t)}},{key:"_scorePosition",get:function(){return this._$_scorePosition},set:function(t){var e=this._$_scorePosition;this._$_scorePosition=t,e!==t&&this._propertyChanged("_scorePosition",e,t)}},{key:"onset",get:function(){return this._$onset},set:function(t){var e=this._$onset;this._$onset=t,e!==t&&this._propertyChanged("onset",e,t)}},{key:"timescale",get:function(){return this._$timescale},set:function(t){var e=this._$timescale;this._$timescale=t,e!==t&&this._propertyChanged("timescale",e,t)}},{key:"scorePosition",get:function(){return this._scorePosition},set:function(t){this._scorePosition=t}},{key:"measurePosition",get:function(){return this._measurePosition},set:function(t){this._measurePosition=t}}],[{key:"equals",value:function(t,e){return t==e||null!=t&&null!=e&&(t.measureIndex==e.measureIndex&&t.measurePosition==e.measurePosition&&t.scorePosition==e.scorePosition&&t.onset==e.onset&&t.timescale==e.timescale)}}]),e}();r.registerClass(Mu,"com.noteflight.notation.performance.TemporalMapEntry");var bu=function(){function t(e){y(this,t),this._measure=null,this._keySignature=null,this._ordinalAlteration=null,this._stepAlteration=null,this._measure=e,this._keySignature=e.keySignature,this.reset()}return p(t,[{key:"reset",value:function(){this._ordinalAlteration={},this._stepAlteration={}}},{key:"processNoteSet",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t.notes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(0===t.position){var a=this._measure.getLiaisonStart(t.position,s);if(null!=a&&a.tied)continue}this._ordinalAlteration[s.diatonicOrdinal]=s.alteration,this._stepAlteration[s.step]=s.alteration}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"getDefaultAlteration",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=this.getContextualAlteration(t,e,i);return-999==n?this._keySignature.getAlteration(A.intToUint(e.step)):n}},{key:"getContextualAlteration",value:function(t,e){for(var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=t,o=e,s=this._measure,a=!1;s&&null!=(i=s.getLiaisonStart(r,o,n))&&i.tied;)r<=i.noteSet.position&&(s=s.previousMeasure),r=i.noteSet.position,o=i,a=!0;return a?o.alteration:e.diatonicOrdinal in this._ordinalAlteration?A.unknownToInt(this._ordinalAlteration[e.diatonicOrdinal]):null!=this._measure.effectiveClef&&this._measure.effectiveClef.unpitched?0:-999}},{key:"getAccidental",value:function(t){return t.explicitAccidental?t.accidental:this._keySignature.atonal&&!t.measure.scoreInterval.octaveMultiple?t.alteration==this.getContextualAlteration(t.position,t)?null:0!==t.transposeInterval(t.measure.scoreInterval).alteration?de.alterationToAccidental(t.alteration):null:t.alteration==this.getDefaultAlteration(t.position,t)?null:de.alterationToAccidental(t.alteration)}}]),t}();r.registerClass(bu,"com.noteflight.notation.processing.AccidentalProcessor");var wu=function(){function t(e){y(this,t),this._measure=null,this._ordinalTies=null,this._singleNoteLiaisons=["glissando","bend"],this._indexLiaisons=null,this._measure=e,this._ordinalTies=[],this._indexLiaisons=[];for(var i=0;i<this._measure.numVoices;i++)this._ordinalTies.push({}),this._indexLiaisons.push({})}return p(t,[{key:"processMeasure",value:function(){var t=null,e=!0,i=!1,n=void 0;try{for(var r,o=this._measure.measureNotations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);A.is(a,Sn)&&(t=A.as(a,Sn),this.processNoteSet(t))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var l=this._measure.followingNoteSets(this._measure.duration),u=!0,h=!1,c=void 0;try{for(var d,f=l[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;t=A.unknownToType(y,Sn);var g=!0,p=!1,m=void 0;try{for(var v,_=t.notes[Symbol.iterator]();!(g=(v=_.next()).done);g=!0){var S=v.value;S.liaisonStartNote=t.measure.getLiaisonStart(0,S),null!=S.liaisonStartNote&&S.liaisonStartNote.tied?S.accidental=null:S.accidental=new bu(t.measure).getAccidental(S),null!=S.liaisonStartNote&&(S.liaisonStartNote.liaisonEndNote=S)}}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}},{key:"getStartNote",value:function(t,e){if(0===t.position&&!t.noteSet.previousGraceNote)return this._measure.getLiaisonStart(t.position,t);var i=this.getStartNoteInVoice(t,e,t.voiceNumber);if(null==i)for(var n=0;n<this._measure.numVoices&&(n==t.voiceNumber||null==(i=this.getStartNoteInVoice(t,e,n)));n++);return i}},{key:"getStartNoteInVoice",value:function(t,e,i){var n=this._ordinalTies[i][t.pitch.ordinal];return null!=n&&n.noteSet.endsAtPosition(t.position)?(delete this._ordinalTies[i][t.pitch.ordinal],n):null!=(n=this._indexLiaisons[i][e])&&n.noteSet.endsAtPosition(t.position)?(delete this._indexLiaisons[i][e],n):null}},{key:"pendingOneNoteLiaisons",value:function(t){var e=[];if(Object.keys(this._indexLiaisons[t.voiceNumber])>0)for(var i in this._indexLiaisons[t.voiceNumber]){var n=this._indexLiaisons[t.voiceNumber][i];this._singleNoteLiaisons.indexOf(n.liaison)>-1&&e.push(n)}return e}},{key:"clearPendingOneNoteLiaisons",value:function(t){if(Object.keys(this._indexLiaisons[t.voiceNumber])>0){var e=[];for(var i in this._indexLiaisons[t.voiceNumber]){var n=this._indexLiaisons[t.voiceNumber][i];this._singleNoteLiaisons.indexOf(n.liaison)>-1&&e.push(i)}for(var r in e)delete this._indexLiaisons[t.voiceNumber][r]}}},{key:"processNoteSet",value:function(t){var e,i;if(0!==t.position||t.previousGraceNote){i=0;var n=!0,r=!1,o=void 0;try{for(var s,a=t.notes[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){(e=s.value).liaisonStartNote=this.getStartNote(e,e.stringIndex>=0?e.stringIndex:i),null!=e.liaisonStartNote&&(e.liaisonStartNote.liaisonEndNote=e),i++;var l=this.pendingOneNoteLiaisons(e);i==t.notes.length&&l.length>0&&(e.liaisonStartNote=l[l.length-1],null!=e.liaisonStartNote&&(e.liaisonStartNote.liaisonEndNote=e),this.clearPendingOneNoteLiaisons(e))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}else{var u=!0,h=!1,c=void 0;try{for(var d,f=t.notes[Symbol.iterator]();!(u=(d=f.next()).done);u=!0)(e=d.value).liaisonStartNote=this._measure.getLiaisonStart(t.position,e),null!=e.liaisonStartNote&&(e.liaisonStartNote.liaisonEndNote=e)}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}i=0;var y=!0,g=!1,p=void 0;try{for(var m,v=t.notes[Symbol.iterator]();!(y=(m=v.next()).done);y=!0)(e=m.value).tied?this._ordinalTies[t.voiceNumber][e.pitch.ordinal]=e:e.hasIndexLiaison&&(this._indexLiaisons[t.voiceNumber][e.stringIndex>=0?e.stringIndex:i]=e),e.liaisonEndNote=null,i++}catch(t){g=!0,p=t}finally{try{y||null==v.return||v.return()}finally{if(g)throw p}}}}]),t}();r.registerClass(wu,"com.noteflight.notation.processing.LiaisonProcessor");var xu=function(){function t(e){y(this,t),this._context=null,this._context=e}return p(t,[{key:"hyphenElementsAreEqual",value:function(t,e){if(Kd.countNumberOfElements(t)!=Kd.countNumberOfElements(e))return!1;for(var i in t)if(!t[i]||!e[i]||!t[i].lyricLayout.lyric.equals(e[i].lyricLayout.lyric))return!1;return!0}},{key:"updateStaffHyphensInfo",value:function(t,e,i){var n=this._context.scoreLayout.getSystemLayoutStartingAt(e.endMeasureIndex);if(n){var r=n.staffLayouts[t];if(r)this.hyphenElementsAreEqual(r.hyphenStateBeginningStaff,i)||r.updateHyphens()}}}]),t}();r.registerClass(xu,"com.noteflight.notation.processing.LyricsContext");var Cu=function t(){y(this,t),this.filter=null,this.ignoreGraceNotesAtBeginning=!1,this.cropElements=!1};r.registerClass(Cu,"com.noteflight.notation.processing.RemovePositionRangeOptions");var Nu=function(){function t(e){y(this,t),this._rhythmContext=null,this._position=NaN,this._rhythmContext=e,this.reset()}return p(t,[{key:"reset",value:function(){this._position=0}},{key:"removePositionRange",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[],r=0;r<this._rhythmContext.elements.length;r++){var o=this._rhythmContext.getElementAt(r);(o.duration>0&&o.rhythmPosition<t+e&&o.rhythmPosition+o.rhythmDuration>t||0===o.duration&&o.rhythmPosition<t+e&&o.rhythmPosition>=t)&&(i&&(i.filter&&!i.filter(o)||i.ignoreGraceNotesAtBeginning&&o.rhythmPosition==t)||n.push(o))}for(var s=0;s<n.length;s++){var a=n[s],l=A.unknownToType(a,ue);i&&i.cropElements&&l.rhythmPosition<t&&A.is(l,Sn)&&mn.isDurationValid(A.intToUint(t-l.rhythmPosition))?A.unknownToType(l,Sn).rhythmDuration=A.intToUint(t-l.rhythmPosition):this._rhythmContext.removeElement(l)}}},{key:"createRestsInRange",value:function(t,e,i,n){var r=[];if(0===t&&e==this._rhythmContext.rhythmDuration&&A.is(this._rhythmContext,Kl))r.push(new Gl);else{var o=this._rhythmContext.timeSignature.getRangeDurations(t,e,!1),s=t,a=!0,l=!1,u=void 0;try{for(var h,c=o[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value,f=A.unknownToInt(d),y=new Sn(s);y.rhythmDuration=A.intToUint(f),i&&(y.color=he.HIDDEN_COLOR,y.beam=n),r.push(y),s+=f}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}}return r}},{key:"addRests",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,i=[],n=[],r=null,o=!1,s=0;s<=this._rhythmContext.elements.length;s++){var a,l;if(s<this._rhythmContext.elements.length){if(0===(l=this._rhythmContext.getElementAt(s)).rhythmDuration)continue;a=l.rhythmPosition}else l=null,a=this._rhythmContext.timeSignature.meterDuration;if(a>e){if(A.is(l,Sn)){if(0===(r=A.unknownToType(l,Sn)).notes.length&&(!t||r.invisible&&0===r.lyrics.length)){n.push(r);continue}var u=r.previousNoteSet();u&&(o=u.beam)}i=i.concat(this.createRestsInRange(e,A.numberToInt(a-e),t,o))}e=A.numberToInt(a),null!=l&&(e+=l.rhythmDuration)}for(var h=0;h<n.length;h++){var c=n[h],d=A.unknownToType(c,Sn);this._rhythmContext.removeElement(d)}var f=!0,y=!1,g=void 0;try{for(var p,m=i[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value;r=A.unknownToType(v,Sn),this._rhythmContext.addElement(r)}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}},{key:"addValueNotationWithDuration",value:function(t,e,i,n,r){for(var o=[],s=mn.descendingValueDurations(i,!0),a=e,l=0;l<s.length;l++){var u=A.unknownToInt(s[l]),h=A.as(t.clone(),mn);if(h.rhythmDuration=A.intToUint(u),h.rhythmPosition=A.intToUint(a),A.is(h,Sn)&&(l<s.length-1||n)&&A.unknownToType(h,Sn).setAllTies(!0),!r&&A.is(h,Sn))for(var c=A.unknownToType(h,Sn).lyrics,d=0;d<c.length;d++)A.unknownToType(h,Sn).removeLyric(A.unknownToType(c[d],ul));this._rhythmContext.addElement(h),o.push(h),a+=u}return o}},{key:"noteSetAtPosition",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.getNotations()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,he);if(a.position>t)break;if(A.is(a,Sn)&&a.position==t)return A.as(a,Sn)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return null}},{key:"getNotations",value:function(){var t=[];return this.doGetNotations(t,this._rhythmContext),t}},{key:"doGetNotations",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=e.elements[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,ue);A.is(l,he)?t.push(l):A.is(l,Ha)&&this.doGetNotations(t,A.as(l,Ha))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}}]),t}();r.registerClass(Nu,"com.noteflight.notation.processing.RhythmProcessor");var Au=function(){function t(e){y(this,t),this._measure=null,this._stringNotes=null,this._measure=e,this._stringNotes=A.unknownToType(e.effectiveClef,$l).stringNotes}return p(t,[{key:"processMeasure",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._measure.measureNotations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,he);A.is(s,Sn)&&this.processNoteSet(A.as(s,Sn))}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"processNoteSet",value:function(t){var e,i=!0,n=!1,r=void 0;try{for(var o,s=t.notes.slice().reverse()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;(e=A.unknownToType(a,de)).stringIndex<0&&this.defaultNoteString(t,e)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"defaultNoteString",value:function(t,e){for(var i=0;i<this._stringNotes.length-1&&!(A.unknownToType(this._stringNotes[i],de).pitch.ordinal<=e.pitch.ordinal);i++);for(;t.noteOnString(i)&&i<this._stringNotes.length-1;)i++;e.stringIndex=i}}]),t}();r.registerClass(Au,"com.noteflight.notation.processing.StringAssignmentProcessor");var Iu=function(){function t(){y(this,t),this._eventHandler="noteflightEventHandler",this._initializeExternalComplete=!1,this._staffMetrics=null,this._score=null,this.callbacks={}}return p(t,null,[{key:"SELECTION_CHANGE",get:function(){return"selectionChange"}},{key:"PLAYBACK_REQUEST",get:function(){return"playbackRequest"}},{key:"PLAYBACK_STOP",get:function(){return"playbackStop"}},{key:"SCORE_DATA_LOADED",get:function(){return"scoreDataLoaded"}},{key:"EDITOR_READY",get:function(){return"editorReady"}},{key:"PARTS_TRANSPOSED",get:function(){return"partsTransposed"}},{key:"NOTE_SIZE_CHANGE",get:function(){return"noteSizeChange"}},{key:"PAGE_SIZE_CHANGE",get:function(){return"pageSizeChange"}},{key:"START_LOAD_SCORE",get:function(){return"startLoadScore"}},{key:"START_CREATING_DOM_ELEMENTS",get:function(){return"startCreatingDomElements"}},{key:"END_CREATING_DOM_ELEMENTS",get:function(){return"endCreatingDomElements"}},{key:"SCORE_READY",get:function(){return"scoreReady"}},{key:"SCORE_XML_READY",get:function(){return"scoreXmlReady"}},{key:"SCORE_DATA_READY",get:function(){return"scoreDataReady"}}]),p(t,[{key:"setDefaultZoom",value:function(t){throw new Error("Not implemented")}},{key:"getDefaultZoom",value:function(){throw new Error("Not implemented")}},{key:"printScore",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];throw new Error("Not implemented")}},{key:"checkContentInjection",value:function(){throw new Error("Not implemented")}},{key:"loadMusicXML",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("Not implemented")}},{key:"loadNoteflightXML",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("Not implemented")}},{key:"loadScoreURL",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("Not implemented")}},{key:"loadScore",value:function(t){throw new Error("Not implemented")}},{key:"dispatchNoteflightEvent",value:function(t){throw new Error("Not implemented")}},{key:"addCallback",value:function(t,e){this.callbacks[t]=e}},{key:"handleEditorReady",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{this.initializeExternal();var e=[];for(var i in this.callbacks)e.push(i);this.dispatchNoteflightEvent({type:t.EDITOR_READY,methodNames:e})}catch(t){if(!A.is(t,Error))throw t;A.as(t,Error)}}},{key:"initializeOnScoreLoaded",value:function(){this.document.addEventListener(Gi.ADD_SELECTION,xt.bindMethod(this,this.handleSelectEvent)),this.document.addEventListener(Gi.REMOVE_SELECTION,xt.bindMethod(this,this.handleSelectEvent)),this.document.addEventListener($i.PLAY_BACK,xt.bindMethod(this,this.handlePlaybackEvent)),this.document.addEventListener($i.STOP,xt.bindMethod(this,this.handleStopEvent)),this.controller.addEventListener(Si.PARTS_TRANSPOSED,xt.bindMethod(this,this.handlePartsTransposed)),this._staffMetrics&&this._staffMetrics.removeEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handleMetricsPropertyChange)),this._staffMetrics=this.controller.score.effectiveStaffMetrics,this._staffMetrics.addEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handleMetricsPropertyChange)),this._score&&this._score.removeEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handleScorePropertyChange)),this._score=this.controller.score,this._score.addEventListener(zy.PROPERTY_CHANGE,xt.bindMethod(this,this.handleScorePropertyChange))}},{key:"initializeExternal",value:function(){this._initializeExternalComplete||(this.addExternalCallbacks(),this._initializeExternalComplete=!0)}},{key:"addExternalCallbacks",value:function(){this.addCallback("loadMusicXML",xt.bindMethod(this,this.loadMusicXML)),this.addCallback("loadNoteflightXML",xt.bindMethod(this,this.loadNoteflightXML)),this.addCallback("loadScoreURL",xt.bindMethod(this,this.loadScoreURL)),this.addCallback("setMasterGain",xt.bindMethod(this,this.setMasterGain)),this.addCallback("getMasterGain",xt.bindMethod(this,this.getMasterGain)),this.addCallback("getPlaybackSpeed",xt.bindMethod(this,this.getPlaybackSpeed)),this.addCallback("setPlaybackSpeed",xt.bindMethod(this,this.setPlaybackSpeed)),this.addCallback("setDefaultZoom",xt.bindMethod(this,this.setDefaultZoom)),this.addCallback("getDefaultZoom",xt.bindMethod(this,this.getDefaultZoom)),this.addCallback("selectFragment",xt.bindMethod(this,this.selectFragment)),this.addCallback("selectMeasures",xt.bindMethod(this,this.selectMeasures)),this.addCallback("selectRange",xt.bindMethod(this,this.selectRange)),this.addCallback("deleteSelection",xt.bindMethod(this,this.deleteSelection)),this.addCallback("setEventHandler",xt.bindMethod(this,this.setEventHandler)),this.addCallback("stopPlayback",xt.bindMethod(this,this.stopPlayback)),this.addCallback("restartPlayback",xt.bindMethod(this,this.restartPlayback)),this.addCallback("playFromSelection",xt.bindMethod(this,this.playFromSelection)),this.addCallback("playFromMeasure",xt.bindMethod(this,this.playFromMeasure)),this.addCallback("playSelection",xt.bindMethod(this,this.playSelection)),this.addCallback("pause",xt.bindMethod(this,this.pause)),this.addCallback("resume",xt.bindMethod(this,this.resume)),this.addCallback("togglePause",xt.bindMethod(this,this.togglePause)),this.addCallback("playFromTimeOffset",xt.bindMethod(this,this.playFromTimeOffset)),this.addCallback("showPositionCursor",xt.bindMethod(this,this.showPositionCursor)),this.addCallback("hidePositionCursor",xt.bindMethod(this,this.hidePositionCursor)),this.addCallback("getScore",xt.bindMethod(this,this.getScore)),this.addCallback("getMusicXML",xt.bindMethod(this,this.getMusicXML)),this.addCallback("getNoteflightXML",xt.bindMethod(this,this.getNoteflightXML)),this.addCallback("setAdvanceAfterNoteEntry",xt.bindMethod(this,this.setAdvanceAfterNoteEntry)),this.addCallback("setPlaybackMode",xt.bindMethod(this,this.setPlaybackMode)),this.addCallback("getPlaybackMode",xt.bindMethod(this,this.getPlaybackMode)),this.addCallback("setVisibleParts",xt.bindMethod(this,this.setVisibleParts)),this.addCallback("pasteNoteSets",xt.bindMethod(this,this.pasteNoteSets)),this.addCallback("getSelection",xt.bindMethod(this,this.getSelection)),this.addCallback("clearSelection",xt.bindMethod(this,this.clearSelection)),this.addCallback("getPlaybackStatus",xt.bindMethod(this,this.getPlaybackStatus)),this.addCallback("getParts",xt.bindMethod(this,this.getParts)),this.addCallback("setPartProperties",xt.bindMethod(this,this.setPartProperties)),this.addCallback("setZoom",xt.bindMethod(this,this.setZoom)),this.addCallback("getZoom",xt.bindMethod(this,this.getZoom)),this.addCallback("getKeySignature",xt.bindMethod(this,this.getKeySignature)),this.addCallback("getTranspositions",xt.bindMethod(this,this.getTranspositions)),this.addCallback("setTransposeParts",xt.bindMethod(this,this.setTransposeParts)),this.addCallback("getTransposeParts",xt.bindMethod(this,this.getTransposeParts)),this.addCallback("getNoteSize",xt.bindMethod(this,this.getNoteSize)),this.addCallback("setNoteSize",xt.bindMethod(this,this.setNoteSize)),this.addCallback("printScore",xt.bindMethod(this,this.printScore)),this.addCallback("getPlaybackTransposition",xt.bindMethod(this,this.getPlaybackTransposition)),this.addCallback("setPlaybackTransposition",xt.bindMethod(this,this.setPlaybackTransposition)),this.addCallback("transpose",xt.bindMethod(this,this.transpose)),this.addCallback("getInitialTempo",xt.bindMethod(this,this.getInitialTempo)),this.addCallback("getPlaybackTempo",xt.bindMethod(this,this.getPlaybackTempo)),this.addCallback("setPlaybackTempo",xt.bindMethod(this,this.setPlaybackTempo)),this.addCallback("getPageSize",xt.bindMethod(this,this.getPageSize)),this.addCallback("setPageSize",xt.bindMethod(this,this.setPageSize)),this.addCallback("getPageSizeNames",xt.bindMethod(this,this.getPageSizeNames)),this.addCallback("overrideStaffClef",xt.bindMethod(this,this.overrideStaffClef))}},{key:"checkExportPermission",value:function(){if(0==(this.document.permissions&ei.EXPORT_PERMISSION))throw new Error("Score permissions do not allow copying of data")}},{key:"selectFragment",value:function(t){null!=t&&""!==t&&("#"==t.charAt(0)&&(t=t.substring(1)),new ni(this.document).decodeSelection(t),this.documentView.ensureSelectionVisible())}},{key:"getScore",value:function(){var t=[],e={staves:t},i=!0,n=!1,r=void 0;try{for(var o,s=this.score.staves[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=A.unknownToType(a,Rl),u=[],h={measures:u};t.push(h);var c=!0,d=!1,f=void 0;try{for(var y,g=l.measures[Symbol.iterator]();!(c=(y=g.next()).done);c=!0){var p=y.value,m=[],v={noteSets:m};u.push(v);var _=!0,S=!1,L=void 0;try{for(var k,T=p.measureNotations[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value,M=A.unknownToType(E,he);if(A.is(M,Sn)){var b=A.as(M,Sn),w=[],x={position:b.position/(1<<mn.QUARTER),duration:b.duration/(1<<mn.QUARTER),voice:b.voiceNumber,beam:b.beam,notes:w};m.push(x);var C=!0,N=!1,I=void 0;try{for(var P,O=b.notes[Symbol.iterator]();!(C=(P=O.next()).done);C=!0){var Q=P.value;w.push({pitch:Q.pitch.ordinal,step:Q.step,alteration:Q.alteration,accidental:Q.accidental,noteHead:Q.noteHead,tied:Q.tied})}}catch(t){N=!0,I=t}finally{try{C||null==O.return||O.return()}finally{if(N)throw I}}}}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}}}catch(t){d=!0,f=t}finally{try{c||null==g.return||g.return()}finally{if(d)throw f}}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"getMusicXML",value:function(){return this.checkExportPermission(),new ir(this.score).toXMLString()}},{key:"getNoteflightXML",value:function(){return this.checkExportPermission(),new cr(this.score).xml.toXMLString()}},{key:"noteSetsToSequence",value:function(t){var e=new Pl,i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=new Sn(a.position*(1<<mn.QUARTER),[]);l.rhythmDuration=A.numberToUint(a.duration*(1<<mn.QUARTER)),l.beam=!0===a.beam;var u=!0,h=!1,c=void 0;try{for(var d,f=xt.unknownForOfSource(a.notes)[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=A.unknownToString(y.noteHead?y.noteHead:null),p=new de(kt.getPitch(A.unknownToInt(y.pitch)),A.unknownToInt(y.step),null,!0===y.tied,g);l.addNote(p)}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}e.addElement(l)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"selectMeasures",value:function(t,e){e<0&&(e=this.score.numMeasures+e+1),this.document.selection=new Ke(this.score,t,e),this.documentView.ensureSelectionVisible()}},{key:"selectRange",value:function(t,e,i,n){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(null!=o){r=[];var s=!0,a=!1,l=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=A.unknownToNumber(c),f=this.score.getStaffAt(A.numberToUint(d));null!=f&&r.push(f)}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}else r=this.score.staves.slice();var y=new gl(A.intToUint(t),e*(1<<mn.QUARTER)),g=new gl(A.intToUint(i),n*(1<<mn.QUARTER));this.document.selection=new Je(this.score,y,g,r),this.documentView.ensureSelectionVisible()}},{key:"getSelection",value:function(){return this.controller.selection}},{key:"clearSelection",value:function(){this.controller.clearSelection()}},{key:"deleteSelection",value:function(){this.controller.removeSelection()}},{key:"playFromSelection",value:function(){this.controller.playFromSelection()}},{key:"playFromMeasure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.controller.playFromMeasure(t,e)}},{key:"playSelection",value:function(t){this.controller.playSelection(t)}},{key:"pause",value:function(){this.controller.pause()}},{key:"resume",value:function(){this.controller.resume()}},{key:"playFromTimeOffset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.controller.playFromMeasure(0,t)}},{key:"showPositionCursor",value:function(t,e){this.documentView.showPositionCursor(new gl(A.intToUint(t),e*(1<<mn.QUARTER)))}},{key:"hidePositionCursor",value:function(){this.documentView.hidePositionCursor()}},{key:"stopPlayback",value:function(){this.controller.stop()}},{key:"restartPlayback",value:function(){this.controller.restartPlayback()}},{key:"setAdvanceAfterNoteEntry",value:function(t){this.document.advanceAfterNoteEntry=t}},{key:"setPlaybackMode",value:function(t){this.score.playbackMode=t}},{key:"getPlaybackMode",value:function(){return this.score.playbackMode}},{key:"setVisibleParts",value:function(t){for(var e=0===t.length,i=0;i<this.score.parts.length;i++)this.score.parts[i].visible=e||t.indexOf(i)>=0}},{key:"pasteNoteSets",value:function(t,e,i,n){this.checkContentInjection();var r=this.noteSetsToSequence(t),o=new gl(A.numberToUint(i),n*(1<<mn.QUARTER));this.controller.pasteSequence(r,this.score.getStaffAt(A.numberToUint(e)),o)}},{key:"setEventHandler",value:function(t){this._eventHandler=t}},{key:"handleSelectEvent",value:function(e){var i="#"+new ni(this.document).encodeSelection(),n={type:t.SELECTION_CHANGE,fragment:i},r=this.document.selection;if(A.is(r,Ke))n.kind="measure",n.startIndex=r.selectedMeasures.startIndex,n.startOffset=0,n.endIndex=r.selectedMeasures.endIndex,n.endOffset=0;else if(null!=r){A.is(r,Je)?n.kind="range":A.is(r,qe)&&(n.kind="object");var o=r.selectedRange;n.startIndex=o.start.measureIndex,n.startOffset=o.start.position/(1<<mn.QUARTER),n.endIndex=o.end.measureIndex,n.endOffset=o.end.position/(1<<mn.QUARTER);var s=[],a=!0,l=!1,u=void 0;try{for(var h,c=o.staves[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;s.push(d.index)}}catch(t){l=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(l)throw u}}n.staffIndices=s}this.dispatchNoteflightEvent(n)}},{key:"handlePlaybackEvent",value:function(e){this.dispatchNoteflightEvent({type:t.PLAYBACK_REQUEST,index:e.measurePosition.measureIndex,offset:e.measurePosition.position})}},{key:"handleStopEvent",value:function(e){this.dispatchNoteflightEvent({type:t.PLAYBACK_STOP,index:e.measurePosition.measureIndex,offset:e.measurePosition.position})}},{key:"handlePartsTransposed",value:function(e){this.dispatchNoteflightEvent({type:t.PARTS_TRANSPOSED})}},{key:"handleMetricsPropertyChange",value:function(e){"lineSpacing"==e.property&&this.dispatchNoteflightEvent({type:t.NOTE_SIZE_CHANGE})}},{key:"handleScorePropertyChange",value:function(e){"pageMetrics"==e.property&&this.dispatchNoteflightEvent({type:t.PAGE_SIZE_CHANGE})}},{key:"getParts",value:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this.score.parts[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t.push({name:s.name,transposition:s.transposition,octaveShift:s.octaveShift,instrumentUri:s.instrumentUri,visible:s.visible,gain:s.gain,pan:s.pan,muted:s.muted})}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"setPartProperties",value:function(t,e){var i=this.score.parts[t];for(var n in e)try{this.controller.setPartProperty(i,n,e[n])}catch(t){if(!A.is(t,Error))throw t;A.as(t,Error)}}},{key:"setZoom",value:function(t){this.score.viewScale=t}},{key:"getZoom",value:function(){return this.score.viewScale}},{key:"setMasterGain",value:function(t){this.score.mix.masterGain=t}},{key:"getMasterGain",value:function(){return this.score.mix.masterGain}},{key:"setTransposeParts",value:function(t){this.controller.setScoreProperty("transposeParts",t)}},{key:"getTransposeParts",value:function(){return this.score.transposeParts}},{key:"keySignatureToJson",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i={fifths:t.fifths};if(null!=t.mode&&(i.tonic=t.tonic,i.mode=t.mode),e&&(t.fifths<=-5||t.fifths>=5)){var n=A.as(t.clone(),Ga);n.fifths+=n.fifths<0?12:-12,i.alternateKey=this.keySignatureToJson(n,!1)}return i}},{key:"getKeySignature",value:function(){return this.keySignatureToJson(this.score.initialKey)}},{key:"getTranspositions",value:function(){var t=this;return this.score.initialKey.getTranspositions().map(function(e,i,n){return t.keySignatureToJson(e)})}},{key:"getNoteSize",value:function(){return this.score.effectiveStaffMetrics.lineSpacing}},{key:"setNoteSize",value:function(t){this.score.effectiveStaffMetrics.scoreLineSpacing=t}},{key:"getPlaybackSpeed",value:function(){return this.performer?this.performer.speedAdjustment:0}},{key:"setPlaybackSpeed",value:function(t){this.performer.speedAdjustment=t}},{key:"getPlaybackTransposition",value:function(){return this.performer?this.performer.pitchAdjustment:0}},{key:"setPlaybackTransposition",value:function(t){this.performer.pitchAdjustment=t}},{key:"togglePause",value:function(){this.controller.togglePause()}},{key:"transpose",value:function(t){var e=Gd.parseFromOptions(t,"resumePlayback",!1),i=Gd.parseFromOptions(t,"ignoreStemDirection",!1),n=Gd.parseFromOptions(t,"ignoreSlurDirection",!0),r=Gd.parseFromOptions(t,"alternateKey",!1),o=Gd.parseFromOptions(t,"hideChordSymbols",!1),s=Gd.parseFromOptions(t,"hideFretboards",!1);if(t&&t.partSemitones&&A.is(t.partSemitones,Array)){var a=t&&t.playbackSemitones?X.parseInt(A.unknownToString(t.playbackSemitones)):0;this.controller.transposeParts(A.unknownToType(t.partSemitones,Array),a,e,i,n,r,o,s)}else{var l=t&&t.semitones?X.parseInt(A.unknownToString(t.semitones)):0;this.controller.transpose(l,e,i,n,r,o,s)}}},{key:"getInitialTempo",value:function(){return this.score&&this.score.initialTempo&&this.score.initialTempo.bpm>0?this.score.initialTempo.bpm:0}},{key:"getPlaybackTempo",value:function(){if(this.score&&this.score.initialTempo&&this.score.initialTempo.bpm>0){var t=this.score.initialTempo.bpm;return this.performer?A.numberToInt(t/this.performer.timeFactor):t}return 0}},{key:"setPlaybackTempo",value:function(t){t>0&&this.performer&&this.score&&this.score.initialTempo&&this.score.initialTempo.bpm>0&&(this.performer.timeFactor=A.uintToNumber(this.score.initialTempo.bpm)/t,this.restartPlayback())}},{key:"getPageSize",value:function(){return this.score?{name:this.score.effectivePageMetrics.name,orientation:this.score.effectivePageMetrics.orientation}:null}},{key:"setPageSize",value:function(t,e){if(this.score){var i=hr.fromPageSize(t,e);i&&(this.score.effectivePageMetrics=i)}}},{key:"getPageSizeNames",value:function(){return hr.pageSizeNames}},{key:"getPlaybackStatus",value:function(){var t={};if(this.controller.isPlaying){t.playing=!0;var e=this.performer.position;t.startMeasure=this.performer.playbackStartMeasure,t.timeFromStartMeasure=this.performer.playbackTimePosition,t.currentMeasure=e.measureIndex,t.quarterNoteOffset=e.position/(1<<mn.QUARTER)}else t.playing=!1;return t}},{key:"overrideStaffClef",value:function(t,e){var i=A.as(this.controller.score.staves[t],Rl),n=Mn.parseString(e);this.controller.overrideStaffClef(i,n)}},{key:"controller",get:function(){throw new Error("Not implemented")}},{key:"documentView",get:function(){throw new Error("Not implemented")}},{key:"score",get:function(){return this.controller.score}},{key:"performer",get:function(){return this.controller.performer}},{key:"document",get:function(){return this.controller.document}}]),t}();r.registerClass(Iu,"com.noteflight.notation.service.AbstractBrowserInterface");var Pu=function t(){y(this,t)};r.implementsInterfaces(Pu,[vt]),r.registerClass(Pu,"com.noteflight.notation.service.IMidiInputService");var Ou=function(){function t(){y(this,t)}return p(t,null,[{key:"getString",value:function(t,e,i){return $$nf.resourceHook?$$nf.resourceHook(t,e,i):"["+t+"]"}}]),t}();r.registerClass(Ou,"com.noteflight.notation.service.Localizer");var Qu=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._$score=null,n._$scoreId=null,n._$viewScoreURI=null,n._$saveScoreURI=null,n._$saveScoreCopyURI=null,n._$addCommentURI=null,n._$addFavoriteURI=null,n._$versionId=null,n._$scoreDescriptor=null,n._$configuration=new Du,n._$versions=null,n._$numVersions=0,n._$lastVersion=null,n._$comments=[],n._$numComments=0,n._$favorites=[],n._$numFavorites=0,n._$inFavorites=!1,n._$author=null,n._$historical=!1,n._$everyoneRole=null,n._$scoreUserRoles=[],n._$searchable=!1,n._$copyable=!1,n._$template=!1,n._$premiumInstruments=!1,n._$saved=!1,n._$imported=!1,n._$effectiveRole=null,n.score=t,n.scoreId=i,n}return c(e,At),p(e,null,[{key:"AUTHOR_ROLE",get:function(){return"author"}},{key:"COAUTHOR_ROLE",get:function(){return"coauthor"}},{key:"REVIEWER_ROLE",get:function(){return"reviewer"}},{key:"READER_ROLE",get:function(){return"reader"}},{key:"TEMPLATE_ROLE",get:function(){return"template"}},{key:"DEMO_ROLE",get:function(){return"demo"}},{key:"PUBLIC_COMMUNITY",get:function(){return"public"}},{key:"LEARNING_COMMUNITY",get:function(){return"learningEdition"}}]),p(e,[{key:"configureAsDemo",value:function(){this.configuration.enablePremiumInstruments=!0,this.configuration.enableTemplateCreation=!0,this.configuration.enableBrowseAndSearch=!0,this.configuration.enableColor=!0,this.configuration.enableMixer=!0,this.configuration.enableSelectFont=!0,this.configuration.enablePartDisplay=!0,this.configuration.enablePrompt=!0,this.configuration.enableMidi=!0,this.numVersions=0}},{key:"score",get:function(){return this._$score},set:function(t){var e=this._$score;this._$score=t,e!==t&&this._propertyChanged("score",e,t)}},{key:"scoreId",get:function(){return this._$scoreId},set:function(t){var e=this._$scoreId;this._$scoreId=t,e!==t&&this._propertyChanged("scoreId",e,t)}},{key:"viewScoreURI",get:function(){return this._$viewScoreURI},set:function(t){var e=this._$viewScoreURI;this._$viewScoreURI=t,e!==t&&this._propertyChanged("viewScoreURI",e,t)}},{key:"saveScoreURI",get:function(){return this._$saveScoreURI},set:function(t){var e=this._$saveScoreURI;this._$saveScoreURI=t,e!==t&&this._propertyChanged("saveScoreURI",e,t)}},{key:"saveScoreCopyURI",get:function(){return this._$saveScoreCopyURI},set:function(t){var e=this._$saveScoreCopyURI;this._$saveScoreCopyURI=t,e!==t&&this._propertyChanged("saveScoreCopyURI",e,t)}},{key:"addCommentURI",get:function(){return this._$addCommentURI},set:function(t){var e=this._$addCommentURI;this._$addCommentURI=t,e!==t&&this._propertyChanged("addCommentURI",e,t)}},{key:"addFavoriteURI",get:function(){return this._$addFavoriteURI},set:function(t){var e=this._$addFavoriteURI;this._$addFavoriteURI=t,e!==t&&this._propertyChanged("addFavoriteURI",e,t)}},{key:"versionId",get:function(){return this._$versionId},set:function(t){var e=this._$versionId;this._$versionId=t,e!==t&&this._propertyChanged("versionId",e,t)}},{key:"scoreDescriptor",get:function(){return this._$scoreDescriptor},set:function(t){var e=this._$scoreDescriptor;this._$scoreDescriptor=t,e!==t&&this._propertyChanged("scoreDescriptor",e,t)}},{key:"configuration",get:function(){return this._$configuration},set:function(t){var e=this._$configuration;this._$configuration=t,e!==t&&this._propertyChanged("configuration",e,t)}},{key:"versions",get:function(){return this._$versions},set:function(t){var e=this._$versions;this._$versions=t,e!==t&&this._propertyChanged("versions",e,t)}},{key:"numVersions",get:function(){return this._$numVersions},set:function(t){var e=this._$numVersions;this._$numVersions=t,e!==t&&this._propertyChanged("numVersions",e,t)}},{key:"lastVersion",get:function(){return this._$lastVersion},set:function(t){var e=this._$lastVersion;this._$lastVersion=t,e!==t&&this._propertyChanged("lastVersion",e,t)}},{key:"comments",get:function(){return this._$comments},set:function(t){var e=this._$comments;this._$comments=t,e!==t&&this._propertyChanged("comments",e,t)}},{key:"numComments",get:function(){return this._$numComments},set:function(t){var e=this._$numComments;this._$numComments=t,e!==t&&this._propertyChanged("numComments",e,t)}},{key:"favorites",get:function(){return this._$favorites},set:function(t){var e=this._$favorites;this._$favorites=t,e!==t&&this._propertyChanged("favorites",e,t)}},{key:"numFavorites",get:function(){return this._$numFavorites},set:function(t){var e=this._$numFavorites;this._$numFavorites=t,e!==t&&this._propertyChanged("numFavorites",e,t)}},{key:"inFavorites",get:function(){return this._$inFavorites},set:function(t){var e=this._$inFavorites;this._$inFavorites=t,e!==t&&this._propertyChanged("inFavorites",e,t)}},{key:"author",get:function(){return this._$author},set:function(t){var e=this._$author;this._$author=t,e!==t&&this._propertyChanged("author",e,t)}},{key:"historical",get:function(){return this._$historical},set:function(t){var e=this._$historical;this._$historical=t,e!==t&&this._propertyChanged("historical",e,t)}},{key:"everyoneRole",get:function(){return this._$everyoneRole},set:function(t){var e=this._$everyoneRole;this._$everyoneRole=t,e!==t&&this._propertyChanged("everyoneRole",e,t)}},{key:"scoreUserRoles",get:function(){return this._$scoreUserRoles},set:function(t){var e=this._$scoreUserRoles;this._$scoreUserRoles=t,e!==t&&this._propertyChanged("scoreUserRoles",e,t)}},{key:"searchable",get:function(){return this._$searchable},set:function(t){var e=this._$searchable;this._$searchable=t,e!==t&&this._propertyChanged("searchable",e,t)}},{key:"copyable",get:function(){return this._$copyable},set:function(t){var e=this._$copyable;this._$copyable=t,e!==t&&this._propertyChanged("copyable",e,t)}},{key:"template",get:function(){return this._$template},set:function(t){var e=this._$template;this._$template=t,e!==t&&this._propertyChanged("template",e,t)}},{key:"premiumInstruments",get:function(){return this._$premiumInstruments},set:function(t){var e=this._$premiumInstruments;this._$premiumInstruments=t,e!==t&&this._propertyChanged("premiumInstruments",e,t)}},{key:"saved",get:function(){return this._$saved},set:function(t){var e=this._$saved;this._$saved=t,e!==t&&this._propertyChanged("saved",e,t)}},{key:"imported",get:function(){return this._$imported},set:function(t){var e=this._$imported;this._$imported=t,e!==t&&this._propertyChanged("imported",e,t)}},{key:"effectiveRole",get:function(){return this._$effectiveRole},set:function(t){var e=this._$effectiveRole;this._$effectiveRole=t,e!==t&&this._propertyChanged("effectiveRole",e,t)}},{key:"editByAuthor",get:function(){return null!=this.author&&null!=this.configuration.user&&this.author.userId==this.configuration.user.userId}},{key:"permissions",get:function(){return A.intToUint(e.permissionsForRole(this.effectiveRole)|e.permissionsForConfiguration(this.configuration))}},{key:"isPrivate",get:function(){return null==this.everyoneRole&&0===this.scoreUserRoles.length}}],[{key:"permissionsForConfiguration",value:function(t){var e=0;return t.enableExport&&(e|=ei.EXPORT_PERMISSION),t.enableTemplateCreation&&(e|=ei.TEMPLATE_CREATION_PERMISSION),t.enableDeveloperFeatures&&(e|=ei.DEVELOPER_FEATURES_PERMISSION),t.enableAshFont&&(e|=ei.ASH_FONT_PERMISSION),t.enableSelectFont&&(e|=ei.SELECT_FONT_PERMISSION),t.enablePremiumInstruments&&(e|=ei.PREMIUM_INSTRUMENTS_PERMISSION),t.enableUserBasedSharing&&(e|=ei.USER_BASED_SHARING_PERMISSION),t.enableColor&&(e|=ei.COLOR_PERMISSION),t.enableMixer&&(e|=ei.MIXER_PERMISSION),t.enablePartDisplay&&(e|=ei.PART_DISPLAY_PERMISSION),t.enablePrompt&&(e|=ei.PROMPT_PERMISSION),t.enableMidi&&(e|=ei.MIDI_PERMISSION),t.enableEditMarkings&&(e|=ei.EDIT_MARKINGS_PERMISSION),t.enablePrinting&&(e|=ei.PRINTING_PERMISSION),e}},{key:"permissionsForRole",value:function(t){switch(t){case e.AUTHOR_ROLE:case e.COAUTHOR_ROLE:return A.intToUint(ei.SAVE_PERMISSION|ei.SAVE_COPY_PERMISSION|ei.EDIT_PERMISSION|ei.COMMENT_PERMISSION);case e.REVIEWER_ROLE:return A.intToUint(ei.SAVE_COPY_PERMISSION|ei.COMMENT_PERMISSION);case e.TEMPLATE_ROLE:case e.DEMO_ROLE:return ei.EDIT_PERMISSION;case e.READER_ROLE:default:return ei.SAVE_COPY_PERMISSION}}}]),e}();r.registerClass(Qu,"com.noteflight.notation.service.ScoreData");var Ru=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$title="",t._$composer="",t._$description="",t._$tags="",t}return c(e,At),p(e,null,[{key:"UNTITLED_TITLE",get:function(){return"Untitled"}}]),p(e,[{key:"title",get:function(){return this._$title},set:function(t){var e=this._$title;this._$title=t,e!==t&&this._propertyChanged("title",e,t)}},{key:"composer",get:function(){return this._$composer},set:function(t){var e=this._$composer;this._$composer=t,e!==t&&this._propertyChanged("composer",e,t)}},{key:"description",get:function(){return this._$description},set:function(t){var e=this._$description;this._$description=t,e!==t&&this._propertyChanged("description",e,t)}},{key:"tags",get:function(){return this._$tags},set:function(t){var e=this._$tags;this._$tags=t,e!==t&&this._propertyChanged("tags",e,t)}}]),e}();r.registerClass(Ru,"com.noteflight.notation.service.ScoreDescriptor");var Du=function(){function t(){y(this,t),this.user=null,this.instrumentManifestURI=null,this.scoreTemplatesURI=null,this.enableExport=!1,this.enableTemplateCreation=!1,this.enablePremiumInstruments=!1,this.enableScoreSharing=!1,this.enableUserBasedSharing=!1,this.enableBrowseAndSearch=!1,this.enableColor=!1,this.enableMixer=!1,this.enablePartDisplay=!1,this.enablePrompt=!1,this.enableMidi=!1,this.enableContentInjection=!1,this.enableDeveloperFeatures=!1,this.enableEditMarkings=!1,this.enableAshFont=!1,this.enableSelectFont=!1,this.enablePrinting=!1,this.scriptDomainRegexps=null,this.viewerInfo={}}return p(t,[{key:"getConfigurationProperty",value:function(t){return A.as(Kd.getObjectProperty(this,t),Boolean)}}]),t}();r.registerClass(Du,"com.noteflight.notation.service.ScoreEditorConfiguration");var Fu=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$versionId=null,t._$creator=null,t._$created=null,t._$versionURI=null,t}return c(e,At),p(e,[{key:"versionId",get:function(){return this._$versionId},set:function(t){var e=this._$versionId;this._$versionId=t,e!==t&&this._propertyChanged("versionId",e,t)}},{key:"creator",get:function(){return this._$creator},set:function(t){var e=this._$creator;this._$creator=t,e!==t&&this._propertyChanged("creator",e,t)}},{key:"created",get:function(){return this._$created},set:function(t){var e=this._$created;this._$created=t,e!==t&&this._propertyChanged("created",e,t)}},{key:"versionURI",get:function(){return this._$versionURI},set:function(t){var e=this._$versionURI;this._$versionURI=t,e!==t&&this._propertyChanged("versionURI",e,t)}}]),e}();r.registerClass(Fu,"com.noteflight.notation.service.VersionData");var Uu=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._jsflightController=null,i._jsflightController=t,i}return c(e,Iu),p(e,[{key:"setDefaultZoom",value:function(t){}},{key:"getDefaultZoom",value:function(){return 1}},{key:"printScore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.controller.requestPrintScore(t)}},{key:"handleStartCreatingDomElements",value:function(){this.dispatchNoteflightEvent({type:Iu.START_CREATING_DOM_ELEMENTS})}},{key:"handleEndCreatingDomElements",value:function(){this.dispatchNoteflightEvent({type:Iu.END_CREATING_DOM_ELEMENTS})}},{key:"handleScoreLoaded",value:function(){this.initializeOnScoreLoaded(),this.initializeExternal(),this.dispatchNoteflightEvent({type:Iu.SCORE_DATA_LOADED})}},{key:"handleStartLoadScore",value:function(){this.dispatchNoteflightEvent({type:Iu.START_LOAD_SCORE})}},{key:"handleScoreReady",value:function(){this.dispatchNoteflightEvent({type:Iu.SCORE_READY})}},{key:"handleScoreXmlReady",value:function(){this.dispatchNoteflightEvent({type:Iu.SCORE_XML_READY})}},{key:"handleScoreDataReady",value:function(){this.dispatchNoteflightEvent({type:Iu.SCORE_DATA_READY})}},{key:"checkContentInjection",value:function(){if(0==(this._jsflightController.scoreDocument.permissions&ei.CONTENT_INJECTION_PERMISSION))throw new Error("Content injection/extraction is not permitted in this community.")}},{key:"loadMusicXML",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.checkContentInjection(),this._jsflightController.loadScore(t,{permissions:this._jsflightController.scoreDocument.permissions},e)}},{key:"loadNoteflightXML",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.checkContentInjection(),this._jsflightController.loadScore(t,{permissions:this._jsflightController.scoreDocument.permissions},e)}},{key:"loadScoreURL",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"loadScore",value:function(t){var e=this._jsflightController.score;t.viewScale=e.viewScale,t.displayMode=e.displayMode,this._jsflightController.displayScore(t)}},{key:"dispatchNoteflightEvent",value:function(t){t.timestamp=(new Date).getTime(),this._jsflightController.dispatchJsflightEvent("noteflight.clientApiEvent",[t])}},{key:"controller",get:function(){return this._jsflightController.scoreController}},{key:"documentView",get:function(){return this._jsflightController.scoreDocumentView}}]),e}();r.registerClass(Uu,"com.noteflight.notation.service.jsflight.JsflightBrowserInterface");var Vu=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._controller=null,i._functionNames=null,i._xml=null,i._snapshotCount=0,i._recording=!1,i._controller=t,i.addControllerListeners(),i}return c(e,At),p(e,[{key:"record",value:function(){this._snapshotCount=0,this._xml=tr.xml("actions"),this._recording=!0}},{key:"stopRecording",value:function(){this._recording=!1}},{key:"undoTestStep",value:function(){this._controller.undo()}},{key:"addSnapshot",value:function(t){var e="snap"+this._snapshotCount++;return this._xml.appendChild(tr.xml("snapshot",function(i){i.attr("id",e),i.attr("description",t)})),e}},{key:"addControllerListeners",value:function(){this._controller.addEventListener(Si.DOCUMENT_CHANGE,xt.bindMethod(this,this.dispatchEvent),!1,0,!0),this._controller.addEventListener(Si.PERFORMER_CHANGE,xt.bindMethod(this,this.dispatchEvent),!1,0,!0),this._controller.addEventListener(Gi.ADD_SELECTION,xt.bindMethod(this,this.dispatchEvent),!1,0,!0),this._controller.addEventListener(Gi.REMOVE_SELECTION,xt.bindMethod(this,this.dispatchEvent),!1,0,!0)}},{key:"recordAction",value:function(t,e){if(this._recording){var i=this.serializeAction(t,e);this._xml.appendChild(i),X.trace(i.toXmlString())}return A.as(Kd.getObjectProperty(this._controller,t),Function).apply(this._controller,e)}},{key:"serializeAction",value:function(t,e){var i=tr.xml("action",function(e){e.attr("name",t)}),n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i.appendChild(this.serializeValue(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}},{key:"serializeValue",value:function(t){if(null==t)return tr.xml("null");if(A.is(t,Hy)||A.is(t,yl)||A.is(t,Number))return tr.xml("number",function(e){e.text(A.unknownToObject(t).toString())});if(A.is(t,Boolean))return t?tr.xml("boolean",function(t){t.text("true")}):tr.xml("boolean",function(t){t.text("false")});if(A.is(t,String))return tr.xml("string",function(e){e.text(A.unknownToString(t))});if(A.is(t,Array)){var e=tr.xml("array"),i=!0,n=!1,r=void 0;try{for(var o,s=xt.unknownForOfSource(t)[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.appendChild(this.serializeValue(a))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}if(A.is(t,se)){var l=A.as(t,se);if(null!=l.parent)return tr.xml("model",function(t){t.attr("path",l.path)});var u=tr.xml("model");if(A.is(l,he))return u.appendChild(new cr(this.score).generateNotation(A.as(l,he))),u;if(A.is(l,Rl))return u.appendChild(new cr(this.score).generateStaff(A.as(l,Rl))),u;if(A.is(l,El))return u.appendChild(new cr(this.score).generatePart(A.as(l,El))),u}throw new Error("Could not serialize value: "+t)}},{key:"checkEditPermission",value:function(){return this._controller.checkEditPermission()}},{key:"highlightPartWithCursor",value:function(){return this._controller.highlightPartWithCursor()}},{key:"copyClipboard",value:function(){this.recordAction("copyClipboard",[])}},{key:"cutClipboard",value:function(){this.recordAction("cutClipboard",[])}},{key:"undo",value:function(){this.recordAction("undo",[])}},{key:"undoAll",value:function(){this.recordAction("undoAll",[])}},{key:"redo",value:function(){this.recordAction("redo",[])}},{key:"redoAll",value:function(){this.recordAction("redoAll",[])}},{key:"pasteClipboard",value:function(){this.recordAction("pasteClipboard",[])}},{key:"pasteSequence",value:function(t,e,i){throw new Error("pasteSequence cannot be used in interactive tests since its args can't be marshalled in the action.xml file.")}},{key:"echoSelectedNotes",value:function(){this._controller.echoSelectedNotes()}},{key:"echoNotes",value:function(t){this._controller.echoNotes(t)}},{key:"play",value:function(){this.recordAction("play",[])}},{key:"playFromSelection",value:function(){this.recordAction("playFromSelection",[])}},{key:"playFromMeasure",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.recordAction("playFromMeasure",[t,e])}},{key:"playSelectionLooped",value:function(){this.recordAction("playSelectionLooped",[])}},{key:"playFromNotation",value:function(t){this.recordAction("playFromNotation",[t])}},{key:"stop",value:function(){this.recordAction("stop",[])}},{key:"forceStop",value:function(){this.recordAction("forceStop",[])}},{key:"renderFullTemporalMap",value:function(){return this._controller.performer.temporalMap}},{key:"restartPlayback",value:function(){this.recordAction("restartPlayback",[])}},{key:"pause",value:function(){return this.recordAction("pause",[]),this._controller.pause()}},{key:"resumeSyncMedia",value:function(){this.recordAction("resumeSyncMedia",[])}},{key:"pauseSyncMedia",value:function(){this.recordAction("pauseSyncMedia",[])}},{key:"resume",value:function(){this.recordAction("resume",[])}},{key:"togglePlayStop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recordAction("togglePlayStop",[t])}},{key:"togglePause",value:function(){this.recordAction("togglePause",[])}},{key:"modeRequiresShowCursor",value:function(){return this._controller.modeRequiresShowCursor()}},{key:"playAll",value:function(){this.recordAction("playAll",[])}},{key:"testTranscriber",value:function(){this.recordAction("testTranscriber",[])}},{key:"selectNextNoteSet",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("selectNextNoteSet",[t])}},{key:"selectPreviousNoteSet",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("selectPreviousNoteSet",[t])}},{key:"selectNextNoteOnString",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("selectNextNoteOnString",[t])}},{key:"selectPreviousNoteOnString",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("selectPreviousNoteOnString",[t])}},{key:"moveUpString",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("moveUpString",[t])}},{key:"moveDownString",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.recordAction("moveDownString",[t])}},{key:"setStringIndex",value:function(t){this.recordAction("setStringIndex",[t])}},{key:"mapMidiPatches",value:function(){this.recordAction("mapMidiPatches",[])}},{key:"selectionRight",value:function(){this.recordAction("selectionRight",[])}},{key:"selectionLeft",value:function(){this.recordAction("selectionLeft",[])}},{key:"setEntryAfterSelection",value:function(t){this.recordAction("setEntryAfterSelection",[t])}},{key:"enterStepAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("enterStepAtSelection",[t,e])}},{key:"enterPitchAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("enterPitchAtSelection",[t,e])}},{key:"repeatSelection",value:function(){this.recordAction("repeatSelection",[])}},{key:"moveSelection",value:function(t,e,i,n){this.recordAction("moveSelection",[t,e,i,n])}},{key:"convertSelectionToRest",value:function(t,e){this.recordAction("convertSelectionToRest",[t,e])}},{key:"addStepToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("addStepToSelection",[t,e])}},{key:"findClosestMatchingPitch",value:function(t,e){return A.unknownToType(this.recordAction("findClosestMatchingPitch",[t,e]),de)}},{key:"addPitchToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("addPitchToSelection",[t,e])}},{key:"placeStepAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("placeStepAtSelection",[t,e])}},{key:"placePitchAtSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("placePitchAtSelection",[t,e])}},{key:"addStringToSelection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("addStringToSelection",[t,e])}},{key:"adjustStringIndex",value:function(t){this.recordAction("adjustStringIndex",[t])}},{key:"setSelectionFret",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.recordAction("setSelectionFret",[t,e])}},{key:"enterRestAtSelection",value:function(){this.recordAction("enterRestAtSelection",[])}},{key:"prepareEntryAfterSelection",value:function(){this.recordAction("prepareEntryAfterSelection",[])}},{key:"addNoteToNoteSet",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.recordAction("addNoteToNoteSet",[t,e,i])}},{key:"adjustSelectionDuration",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.recordAction("adjustSelectionDuration",[t,e])}},{key:"setSelectionDuration",value:function(t,e){this.recordAction("setSelectionDuration",[t,e])}},{key:"stepSelectionDuration",value:function(t){this.recordAction("stepSelectionDuration",[t])}},{key:"changeNoteSetValue",value:function(t,e,i){return A.unknownToType(this.recordAction("changeNoteSetValue",[t,e,i]),Sn)}},{key:"createTuplet",value:function(t,e){return A.unknownToType(this.recordAction("createTuplet",[t,e]),Xl)}},{key:"createTuplet2",value:function(t){return A.unknownToType(this.recordAction("createTuplet2",[t]),Xl)}},{key:"removeContainingTuplet",value:function(){this.recordAction("removeContainingTuplet",[])}},{key:"startTremolo",value:function(){return A.unknownToType(this.recordAction("startTremolo",[]),Xl)}},{key:"selectVoice",value:function(t){this.recordAction("selectVoice",[t])}},{key:"removeSelectedVoice",value:function(){this.recordAction("removeSelectedVoice",[])}},{key:"startAudioRecording",value:function(t){this._controller.startAudioRecording(t)}},{key:"stopAudioRecording",value:function(){this._controller.stopAudioRecording()}},{key:"modifyTies",value:function(){this.recordAction("modifyTies",[])}},{key:"modifyCourtesyAccidentals",value:function(){this.recordAction("modifyCourtesyAccidentals",[])}},{key:"modifyParentheses",value:function(){this.recordAction("modifyParentheses",[])}},{key:"modifyIncomingTies",value:function(){this.recordAction("modifyIncomingTies",[])}},{key:"modifyLiaisons",value:function(t){this.recordAction("modifyLiaisons",[t])}},{key:"modifyBeamAtSelection",value:function(){this.recordAction("modifyBeamAtSelection",[])}},{key:"modifyBeamBeforeSelection",value:function(){this.recordAction("modifyBeamBeforeSelection",[])}},{key:"modifyArticulation",value:function(t){this.recordAction("modifyArticulation",[t])}},{key:"setTremolo",value:function(t){this.recordAction("setTremolo",[t])}},{key:"modifyQuarterBendAlteration",value:function(){this.recordAction("modifyQuarterBendAlteration",[])}},{key:"modifyCue",value:function(){this.recordAction("modifyCue",[])}},{key:"modifyDirection",value:function(t){this.recordAction("modifyDirection",[t])}},{key:"modifyNotationsDirection",value:function(t){this.recordAction("modifyNotationsDirection",[t])}},{key:"modifyArpeggio",value:function(t){this.recordAction("modifyArpeggio",[t])}},{key:"modifyGrace",value:function(t){this.recordAction("modifyGrace",[t])}},{key:"setXOffset",value:function(t){this.recordAction("setXOffset",[t])}},{key:"setYOffset",value:function(t){this.recordAction("setYOffset",[t])}},{key:"setColor",value:function(t){this.recordAction("setColor",[t])}},{key:"modifyNoteHead",value:function(){this.recordAction("modifyNoteHead",[])}},{key:"setNoteHead",value:function(t){this.recordAction("setNoteHead",[t])}},{key:"enterSlash",value:function(){this.recordAction("enterSlash",[])}},{key:"setBarlineType",value:function(t){this.recordAction("setBarlineType",[t])}},{key:"modifyStartRepeat",value:function(){this.recordAction("modifyStartRepeat",[])}},{key:"modifyEndRepeat",value:function(){this.recordAction("modifyEndRepeat",[])}},{key:"transposeSelectionAtOctave",value:function(t){this.recordAction("transposeSelectionAtOctave",[t])}},{key:"transposeSelectionDiatonic",value:function(t){this.recordAction("transposeSelectionDiatonic",[t])}},{key:"transposeSelectionInterval",value:function(t){this.recordAction("transposeSelectionInterval",[t])}},{key:"transposeSelectionChromatic",value:function(t){this.recordAction("transposeSelectionChromatic",[t])}},{key:"enharmonicShift",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.recordAction("enharmonicShift",[t])}},{key:"applyAccidentalToSelection",value:function(t){this.recordAction("applyAccidentalToSelection",[t])}},{key:"toggleTextbox",value:function(){this.recordAction("toggleTextbox",[])}},{key:"selectNotation",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("selectNotation",[t,e])}},{key:"selectNotationRange",value:function(t){this.recordAction("selectNotationRange",[t])}},{key:"modifyNotationSelection",value:function(t){this.recordAction("modifyNotationSelection",[t])}},{key:"selectRangeForMeasure",value:function(t){this.recordAction("selectRangeForMeasure",[t])}},{key:"selectPart",value:function(t){this.recordAction("selectPart",[t])}},{key:"selectTuplet",value:function(t){this.recordAction("selectTuplet",[t])}},{key:"selectStaff",value:function(t){this.recordAction("selectStaff",[t])}},{key:"selectMeasure",value:function(t){this.recordAction("selectMeasure",[t])}},{key:"selectScore",value:function(){this.recordAction("selectScore",[])}},{key:"filterSelection",value:function(t){this.recordAction("filterSelection",[t])}},{key:"extendRangeToMeasure",value:function(t){this.recordAction("extendRangeToMeasure",[t])}},{key:"extendRangeToStaff",value:function(t){this.recordAction("extendRangeToStaff",[t])}},{key:"extendMeasureSelection",value:function(t){this.recordAction("extendMeasureSelection",[t])}},{key:"clearSelection",value:function(){this.recordAction("clearSelection",[])}},{key:"insertBlankMeasureAt",value:function(t){this.recordAction("insertBlankMeasureAt",[t])}},{key:"resetMeasureNumbers",value:function(){this.recordAction("resetMeasureNumbers",[])}},{key:"addMeasureAfterSelection",value:function(){this.recordAction("addMeasureAfterSelection",[])}},{key:"insertBlankStaffAt",value:function(t,e,i){this.recordAction("insertBlankStaffAt",[t,e,i])}},{key:"movePart",value:function(t,e){this.recordAction("movePart",[t,e])}},{key:"removeSelection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recordAction("removeSelection",[t])}},{key:"removeSelectionMarkings",value:function(){this.recordAction("removeSelectionMarkings",[])}},{key:"deleteSelection",value:function(){this.recordAction("deleteSelection",[])}},{key:"setTempoAtMeasure",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yl.MAX_VALUE;this.recordAction("setTempoAtMeasure",[t,e,i])}},{key:"setSelectionTempo",value:function(t){this.recordAction("setSelectionTempo",[t])}},{key:"changeTimeSignature",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.recordAction("changeTimeSignature",[t,e])}},{key:"changeKeySignature",value:function(t){this.recordAction("changeKeySignature",[t])}},{key:"changeClef",value:function(t){this.recordAction("changeClef",[t])}},{key:"overrideStaffClef",value:function(t,e){this.recordAction("overrideStaffClef",[t,e])}},{key:"applyBreakSet",value:function(t){this.recordAction("applyBreakSet",[t])}},{key:"applyBreak",value:function(t){this.recordAction("applyBreak",[t])}},{key:"toggleCautionaries",value:function(){this.recordAction("toggleCautionaries",[])}},{key:"toggleHideStaff",value:function(){this.recordAction("toggleHideStaff",[])}},{key:"toggleBarlineBreaks",value:function(){this.recordAction("toggleBarlineBreaks",[])}},{key:"addMultiRest",value:function(){this.recordAction("addMultiRest",[])}},{key:"changeInstrument",value:function(t,e){this.recordAction("changeInstrument",[t,e])}},{key:"addSpanToSelection",value:function(t){this.recordAction("addSpanToSelection",[t])}},{key:"applyPreEffectToSelection",value:function(t){this.recordAction("applyPreEffectToSelection",[t])}},{key:"applyPostEffectToSelection",value:function(t){this.recordAction("applyPostEffectToSelection",[t])}},{key:"addAnnotation",value:function(){return A.unknownToType(this.recordAction("addAnnotation",[]),Ea)}},{key:"updateAnnotationText",value:function(t,e){this.recordAction("updateAnnotationText",[t,e])}},{key:"removeAnnotation",value:function(t){this.recordAction("removeAnnotation",[t])}},{key:"setMusicFont",value:function(t){this._controller.setMusicFont(t)}},{key:"addSegno",value:function(){this.recordAction("addSegno",[])}},{key:"addCoda",value:function(){this.recordAction("addCoda",[])}},{key:"toggleSplitSystem",value:function(){this.recordAction("toggleSplitSystem",[])}},{key:"addRepeatEnding",value:function(){this.recordAction("addRepeatEnding",[])}},{key:"setMeasureRepeat",value:function(){this.recordAction("setMeasureRepeat",[])}},{key:"addRehearsalLetter",value:function(){this.recordAction("addRehearsalLetter",[])}},{key:"resetLayout",value:function(){this.recordAction("resetLayout",[])}},{key:"setLayoutWeight",value:function(t,e){this.recordAction("setLayoutWeight",[t,e])}},{key:"setScoreProperty",value:function(t,e){this.recordAction("setScoreProperty",[t,e])}},{key:"getScoreProperty",value:function(t){return Kd.getObjectProperty(this._controller.score,t)}},{key:"setPartProperty",value:function(t,e,i){this.recordAction("setPartProperty",[t,e,i])}},{key:"saveClipboard",value:function(){this._controller.saveClipboard()}},{key:"showHtml5Shadow",value:function(){return!1}},{key:"nudgeSelection",value:function(t){this.recordAction("nudgeSelection",[t])}},{key:"requestPrintScore",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.recordAction("requestPrintScore",[t])}},{key:"logToAnalytics",value:function(t,e){this._controller.logToAnalytics(t,e)}},{key:"transpose",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.recordAction("transpose",[t,e,i,n,r,o,s])}},{key:"transposeParts",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.recordAction("transposeParts",[t,e,i,n,r,o,s,a])}},{key:"toggleShowAudioWaveform",value:function(t){this.recordAction("toggleShowAudioWaveform",[t])}},{key:"moveCursorToMeasureIndex",value:function(t){this.recordAction("moveCursorToMeasureIndex",[t])}},{key:"performanceModeAction",value:function(t,e){this.recordAction("performanceModeAction",[t,e])}},{key:"isNotationInteractionAvailable",value:function(){return this._controller.isNotationInteractionAvailable()}},{key:"toggleAudioWaveforms",value:function(){this.recordAction("toggleAudioWaveforms",[])}},{key:"clipsCanBeOverwritten",value:function(t,e,i){return this._controller.clipsCanBeOverwritten(t,e,i)}},{key:"showEditKeySignatureDialog",value:function(){this.recordAction("showEditKeySignatureDialog",[])}},{key:"showEditTimeSignatureDialog",value:function(){this.recordAction("showEditTimeSignatureDialog",[])}},{key:"setPerformanceMode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._controller.setPerformanceMode(t,e)}},{key:"setIsAboutToPlayValue",value:function(t){this.recordAction("setIsAboutToPlayValue",[t])}},{key:"entryExistsForMeasureIndex",value:function(t){return this._controller.entryExistsForMeasureIndex(t)}},{key:"togglePartVisibility",value:function(t){this.recordAction("togglePartVisibility",[t])}},{key:"printTimingStats",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.recordAction("printTimingStats",[t])}},{key:"addTextBlock",value:function(t){return this.recordAction("addTextBlock",[t])}},{key:"applyScoreEdit",value:function(t){return this.recordAction("applyScoreEdit",[t])}},{key:"applyScoreEdits",value:function(t){return this.recordAction("applyScoreEdits",[t])}},{key:"actions",get:function(){return this._xml}},{key:"document",get:function(){return this._controller.document},set:function(t){this._controller.document=t}},{key:"score",get:function(){return this._controller.score}},{key:"performer",get:function(){return this._controller.performer},set:function(t){this._controller.performer=t}},{key:"selection",get:function(){return this._controller.selection}},{key:"keySignatureSelection",get:function(){return this._controller.keySignatureSelection}},{key:"timeSignatureSelection",get:function(){return this._controller.timeSignatureSelection}},{key:"clefSelection",get:function(){return this._controller.clefSelection}},{key:"transcriber",get:function(){return this._controller.transcriber}},{key:"pausePosition",set:function(t){this._controller.pausePosition=t},get:function(){return this._controller.pausePosition}},{key:"viewer",get:function(){return this._controller.viewer},set:function(t){this._controller.viewer=t}},{key:"partToHighlight",get:function(){return this._controller.partToHighlight}},{key:"isPlaying",get:function(){return this._controller.isPlaying}},{key:"isInPlayMode",get:function(){return!1}},{key:"isPerformanceMode",get:function(){return!1}},{key:"disableNotationInteraction",set:function(t){this._controller.disableNotationInteraction=t},get:function(){return this._controller.disableNotationInteraction}}]),e}();r.implementsInterfaces(Vu,[Xt]),r.registerClass(Vu,"com.noteflight.notation.testharness.ActionRecorder");var Bu=function t(){y(this,t)};r.registerClass(Bu,"com.noteflight.notation.transcription.IPerformanceProcessor");var Hu=function t(){y(this,t),this.measure=null,this.measureIndex=0,this.duration=NaN,this.cost=NaN,this.rightTie=-1,this.leftTie=[],this.staffIndex=0,this.noteSetsEndPosition={}};r.registerClass(Hu,"com.noteflight.notation.transcription.MeasureTranscription");var $u=function t(){y(this,t),this.position=NaN,this.samePitchCollision=!1};r.registerClass($u,"com.noteflight.notation.transcription.NoteSetTranscribed");var Gu=function(){function t(e,i,n,r,o){y(this,t),this._scorePart=null,this._staffIndexInPart=-1,this._stavesInformation=[],this._tempoMap=null,this._performance=null,this._oldPerformanceElements=[],this._settings=null,this._score=null,this._scorePart=e,this._staffIndexInPart=i,this._tempoMap=n,this._measureIndices=r,this._settings=o,this._performance=new nd,this._score=this._scorePart.staves[0].score}return p(t,null,[{key:"OFFSET_NOTE_ON_FACTOR",get:function(){return 25}},{key:"OFFSET_NOTE_OFF_FACTOR",get:function(){return 5}},{key:"COMPLEXITY_FACTOR",get:function(){return.27}},{key:"CHORD_COST_FACTOR",get:function(){return.4}},{key:"TUPLET_COST_FACTOR",get:function(){return 2.4}},{key:"SAME_PITCH_COLLISION",get:function(){return Yu}},{key:"MIN_QUANTUM_TIME",get:function(){return.125}},{key:"ABSOLUTE_SECONDS_ROUNDING",get:function(){return.125}}]),p(t,[{key:"addElement",value:function(t){this._performance.addElement(t)}},{key:"recoverOldData",value:function(){this._performance=new nd;for(var t=0;t<this._oldPerformanceElements.length;t++)this._performance.addElement(this._oldPerformanceElements[t])}},{key:"finish",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.savePerformance(),this.splitStaves(),this.transcribeMeasures(t),this.postProcessing(),this.tieNotesAcrossMeasures(),this.copyVoices()}},{key:"splitStaves",value:function(){var t=this._performance.elements;if(this._settings.splitStaves&&1!=this._scorePart.staves.length){for(var e=0;e<this._scorePart.staves.length;e++)this._stavesInformation.push(new H([])),this._stavesInformation[e].staff=this._scorePart.staves[e];for(e=0;e<t.length;e++){var i=t[e].pitch.ordinal>this._settings.staffThreshold?0:1;this._stavesInformation[i].elements.push(t[e])}}else this._stavesInformation.push(new H(t)),this._stavesInformation[0].staff=this._settings.splitStaves?this._scorePart.staves[0]:this._scorePart.staves[this._staffIndexInPart]}},{key:"getStaffElements",value:function(t,e,i){for(var n=[],r=this._stavesInformation[i].elements,o=0;o<r.length;o++){var s=A.unknownToType(r[o],Jc);s.onset<e&&s.onset+s.duration>t&&n.push(s)}return n}},{key:"transcribeMeasures",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._performance.endTime,i=0;i<this._stavesInformation.length;i++){this._stavesInformation[i].elements;for(var n=0,r=0,o=[];n<=e;){var s=A.unknownToInt(this._measureIndices[r]),a=this._stavesInformation[i].staff.getMeasureAt(A.intToUint(s));if(!a)return;var l=n+a.duration,u=this.getStaffElements(n,l,i);if(u.length>0){var h=this.transcribeMeasure(n,l,a,u,i);o.push(h)}if(n=l,r++,!t.skipAddingEmptyMeasures&&r==this._measureIndices.length&&n<=e){var c=A.unknownToNumber(this._measureIndices[this._measureIndices.length-1]);this._score.insertBlankMeasureAt(A.numberToInt(c+1)),this._measureIndices.push(c+1)}}this._stavesInformation[i].transcribedMeasures=o}}},{key:"transcribeMeasure",value:function(e,i,n,r,o){for(var s=A.numberToUint(this.getMinQuantization(n.tempo)),a=A.numberToUint(Math.max(n.timeSignature.beatValue,s)),l=null,u=a,h=a;h>=s;h--){var c=this.quantizeMeasure(h,a,r,e,i,n.timeSignature);if(c.cost!=Number.MAX_VALUE||h==s){if(null!=l&&c.cost>=l.cost)break;u=h,l=c}}if(null==l)throw Error("result should be non-null");if(this._settings.detectTriplets)for(var d=0,f=n.timeSignature.beatValue,y=mn.valueToDuration(f);d<n.duration;){for(var g=0;g<2;g++){f=n.timeSignature.beatValue-g;var p=e+d,m=p+2*(y=mn.valueToDuration(f)),v=p+3*y;if(!((r=this.getStaffElements(p,m,o)).length<=1)){var _=new Xl(d,2,A.intToUint(f),3,A.intToUint(f)),S=this.quantizeMeasure(u,a,r,p,m,_.timeSignature),L=this.quantizeMeasure(A.intToUint(f),a,r,p,v,_.timeSignature,1.5);if(L.cost*t.TUPLET_COST_FACTOR<S.cost){for(var k=L.measure.measureElements,T=0;T<k.length;T++)A.is(k[T],Sn)&&k[T].rhythmPosition+k[T].rhythmDuration<=_.timeSignature.meterDuration&&_.addElement(k[T]);if(!_.validTuplet||_.elements.length<=1)continue;l.measure.removePositionRange(A.numberToInt(p-e),A.numberToInt(m-p),0,null,!0);var E=l.measure.previousNotationInMeasure(d);for(T=0;T<L.leftTie.length;T++)if(A.is(E,Sn)){var M=A.unknownToType(E,Sn).findChromaticOrdinal(A.unknownToInt(L.leftTie[T]));M&&(M.tied=!0)}l.measure.addElement(_,0);break}}}d+=A.numberToInt(2*y)}return l.measureIndex=n.index,l.staffIndex=o,l}},{key:"calculateOffsetCost",value:function(t){return t*t}},{key:"calculateComplexityCost",value:function(t,e){for(var i=t,n=1;i>0&&0==(e&n);)i--,n<<=1;return i}},{key:"chordCost",value:function(e,i){return Math.abs((i-e)*t.CHORD_COST_FACTOR)}},{key:"quantizePosition",value:function(t,e){var i=new Wu;t=Math.max(t,0),i.proportionalPosition=t/e;var n=Math.round(i.proportionalPosition);return i.deltaTicks=(i.proportionalPosition-n)*e,i.position=n*e,i}},{key:"addNoteSets",value:function(t,e,i,n,r,o){for(var s=n.getRangeDurations(A.numberToInt(e),A.numberToInt(i),!0),a=0;a<s.length;a++){var l=new Sn(e);l.rhythmDuration=A.unknownToUint(s[a]);var u=!0,h=!1,c=void 0;try{for(var d,f=t[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value,g=A.unknownToType(y,de),p=A.as(g.clone(),de);p.tied=a+1<s.length,l.addNote(p)}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}r.addElement(l,o),e+=A.unknownToNumber(s[a])}return s}},{key:"createAndAddNoteSets",value:function(t,e,i,n,r,o){for(var s=-1,a=n.getVoiceNumber(o).elements,l=!1,u=new $u,h=0;h<a.length;h++){var c=a[h].rhythmPosition,d=c+a[h].rhythmDuration;if(c<e+i&&d>e){s=h;break}}if(-1==s)return this.addNoteSets([t],e,i,r,n,o),u.position=e,u.samePitchCollision=l,u;for(var f,y=a[s].rhythmPosition,g=A.numberToInt(s),p=A.is(a[g],Sn)?A.as(a[g],Sn):null;g>=0&&null!=p&&p.notes.length>0&&p.notes[0].tied;)y=a[g].rhythmPosition,g--;for(g=A.numberToInt(s),p=A.is(a[g],Sn)?A.as(a[g],Sn):null;g<a.length-1&&p&&p.notes.length>0&&p.notes[0].tied;)g++;f=a[g].rhythmPosition+a[g].rhythmDuration;var m=(p=A.is(a[s],Sn)?A.as(a[s],Sn):null)?p.notes.slice():null;if(null==m)throw Error("arrayOfNotes should be non-null");for(var v=0;v<m.length;v++)if(t.sameAs(A.unknownToType(m[v],de))){l=!0;break}return m.push(t),n.removePositionRange(A.numberToInt(y),A.numberToInt(f),o),f=Math.max(f,e+i),this.addNoteSets(m,y,f-y,r,n,o),u.position=y,u.samePitchCollision=l,u}},{key:"getTotalNumberOfNoteSets",value:function(t){for(var e=0,i=t.measureNotations,n=0;n<i.length;n++)A.is(i[n],Sn)&&e++;return e}},{key:"quantizeMeasure",value:function(e,i,n,r,o,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=new Hu;l.measure=new hl,l.measure.timeSignature=s,l.cost=0,l.duration=s.meterDuration;for(var u,h=mn.valueToDuration(e),c=0,d=o-r,f={},y=!1,g=0,p=0;p<n.length;p++){var m=!1,v=!1,_=(n[p].onset-r)*a;if(_>=0){var S=this.quantizePosition(_,h);(c=S.position)>=o-r?m=!0:(g++,u=Math.abs(this._tempoMap.scorePositionToTime(r+_/a)-this._tempoMap.scorePositionToTime(r+c/a)),l.cost+=this.calculateOffsetCost(u)*t.OFFSET_NOTE_ON_FACTOR,l.cost+=this.calculateComplexityCost(A.intToUint(i-e),A.numberToUint(S.proportionalPosition))*t.COMPLEXITY_FACTOR)}else l.leftTie.push(n[p].pitch.ordinal);var L=(n[p].onset+n[p].duration-r)*a;!m&&L<=o-r?(f=this.quantizePosition(L,h),d=A.unknownToNumber(f.position),0===f.position&&_<0&&(v=!0,l.leftTie=[]),u=Math.abs(this._tempoMap.scorePositionToTime(r+L/a)-this._tempoMap.scorePositionToTime(r+d/a)),l.cost+=this.calculateOffsetCost(u)*t.OFFSET_NOTE_OFF_FACTOR,l.cost+=this.calculateComplexityCost(A.intToUint(i-e),A.unknownToUint(f.proportionalPosition))*t.COMPLEXITY_FACTOR):(d=o-r,y=!0);var k=d-c;c+k>(o-r)*a&&(X.trace("CRITICAL ERROR - note out of range"),k=(o-r)*a-c);var T=new de(n[p].pitch);if(!m&&!v){0===k&&(k=h,u=Math.abs(this._tempoMap.scorePositionToTime(r+(c+k)/a)-this._tempoMap.scorePositionToTime(r+c/a)),l.cost+=this.calculateOffsetCost(u)*t.OFFSET_NOTE_ON_FACTOR);var E=this.createAndAddNoteSets(T,c,k,l.measure,s,0);y&&(l.rightTie=c),l.noteSetsEndPosition[E.position]=A.unknownToNumber(f.position),E.samePitchCollision&&(l.cost=Number.MAX_VALUE)}}var M=this.getTotalNumberOfNoteSets(l.measure);return l.cost+=this.chordCost(M,g),l}},{key:"tieNotesAcrossMeasures",value:function(){for(var t=0;t<this._stavesInformation.length;t++)for(var e=0;e<this._stavesInformation[t].transcribedMeasures.length-1;e++){var i=this._stavesInformation[t].transcribedMeasures;if(i[e].rightTie>-1){var n=i[e].measure.getVoiceNumber(0).noteSetAtPosition(i[e].rightTie),r=i[e+1].measure.getVoiceNumber(0).noteSetAtPosition(0);if(n&&r)for(var o=0;o<n.notes.length;o++)for(var s=0;s<r.notes.length;s++)if(n.notes[o].pitch.ordinal==r.notes[s].pitch.ordinal){n.notes[o].tied=!0;break}}}}},{key:"savePerformance",value:function(){this._oldPerformanceElements=this._performance.elements.slice();for(var t=[],e=0;e<this._oldPerformanceElements.length;e++)t.push({index:e,onset:this._oldPerformanceElements[e].onset,duration:this._oldPerformanceElements[e].duration,pitch:this._oldPerformanceElements[e].pitch.ordinal})}},{key:"postProcessing",value:function(){for(var e=0;e<this._stavesInformation.length;e++){var i=0,n=!0,r=!1,o=void 0;try{for(var s,a=this._stavesInformation[e].transcribedMeasures[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){for(var l=s.value,u=A.unknownToType(l,Hu),h=u.measure.getVoiceNumber(0),c=0;c<h.elements.length;c++)if(A.is(h.elements[c],Sn)){var d=h.elements[c].rhythmPosition,f=h.elements[c].rhythmDuration,y=(this._stavesInformation[e].staff.getMeasureAt(A.intToUint(u.measureIndex)).timeSignature.beatDuration,Math.floor(Math.log(f)/Math.log(2))),g=A.numberToInt(Math.pow(2,y));if(d%(2*g)==0&&f<2*g){var p=u.duration-(d+f);c+1<h.elements.length&&(p=h.elements[c+1].rhythmPosition-(d+f)),f+p>=2*g&&u.noteSetsEndPosition.hasOwnProperty(d)&&this._tempoMap.scorePositionToTime(i+d+2*g)-this._tempoMap.scorePositionToTime(i+u.noteSetsEndPosition[d])<=t.ABSOLUTE_SECONDS_ROUNDING&&(h.elements[c].rhythmDuration=A.intToUint(2*g))}}i+=u.measure.duration}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}},{key:"copyVoices",value:function(){for(var t=0;t<this._stavesInformation.length;t++){var e=!0,i=!1,n=void 0;try{for(var r,o=this._stavesInformation[t].transcribedMeasures[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,Hu),l=a.measureIndex,u=this._stavesInformation[t].staff.getMeasureAt(a.measureIndex);u.removeVoiceNumber(0);for(var h,c=null,d=a.measure.getVoiceNumber(0),f=0;f<d.elements.length;f++){var y=d.elements[f].rhythmPosition,g=d.elements[f].rhythmDuration;if(h=!1,c&&y<c.end&&y+g>c.start){X.trace("ERROR TRANSCRIBING. NOTES OVERLAPPING! ",c),h=!0;break}c={start:y,end:y+g},y+g>a.duration&&(A.is(d.elements[f],Sn)?d.elements[f].rhythmDuration=A.numberToUint(a.duration-d.elements[f].rhythmPosition):d.elements.splice(f,1))}h||(u.addChildAt(a.measure.getVoiceNumber(0),1),u.addRests(),this._stavesInformation[t].staff.improveSpelling(l,!0),u.defaultBeaming(),u.cleanUpAccidentals())}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"getMinQuantization",value:function(e){if(this._settings.customQuantization)return this._settings.customQuantizationValue;var i=e.bpm/60*(1<<e.value)*t.MIN_QUANTUM_TIME;return mn.durationToValue(A.numberToUint(i))}}]),t}();r.implementsInterfaces(Gu,[Bu]);var Yu=Number.MAX_VALUE;r.registerClass(Gu,"com.noteflight.notation.transcription.PartTranscriber");var zu=function(){function t(){y(this,t),this.startTime=0,this._partTranscriber=null,this._settings=new Xu,this._temporalMap=null,this._enabled=!1,this._part=null,this._staffIndex=-1}return p(t,[{key:"createTranscriber",value:function(t,e,i,n){this._temporalMap=i,this._part=t,this._staffIndex=e,e=this.settings.splitStaves?-1:e,this._partTranscriber=new Gu(t,e,i,n,this.settings)}},{key:"addElement",value:function(t){this._enabled&&this._partTranscriber.addElement(t)}},{key:"addElementInMilliseconds",value:function(t){t.onset=t.onset/1e3,t.duration=t.duration/1e3,this.addElementInSeconds(t)}},{key:"addElementInSeconds",value:function(t){var e=this._temporalMap.timeToScorePosition(t.onset-this.startTime/1e3),i=this._temporalMap.timeToScorePosition(t.onset+t.duration-this.startTime/1e3);t.onset=e,t.duration=i-e,this.addElement(t)}},{key:"finish",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._partTranscriber.finish(t)}},{key:"recoverOldData",value:function(){this._partTranscriber.recoverOldData()}},{key:"settings",get:function(){return this._settings}},{key:"enabled",set:function(t){this._enabled=t}},{key:"transcribedStavesIndices",get:function(){if(!this._part)return null;if(this.settings.splitStaves){for(var t=[],e=0;e<this._part.staves.length;e++)t.push(this._part.staves[e].index);return t}return[this._part.staves[this._staffIndex].index]}}]),t}();r.implementsInterfaces(zu,[Bu]),r.registerClass(zu,"com.noteflight.notation.transcription.PerformanceTranscriber");var Wu=function t(){y(this,t),this.position=NaN,this.proportionalPosition=NaN,this.deltaTicks=NaN};r.registerClass(Wu,"com.noteflight.notation.transcription.QuantizedPosition");var Xu=function t(){y(this,t),this.detectTriplets=!0,this.splitStaves=!0,this.staffThreshold=47,this.customQuantization=!1,this.customQuantizationValue=4};r.registerClass(Xu,"com.noteflight.notation.transcription.TranscriberSettings");var Ku=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).apparentSize=6,i._context=null,i._handleSize=NaN,i._rolled=!1,i._context=t,i.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(i)),i.addRollHighlight)),i.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(i)),i.removeRollHighlight)),i.addEventListener(ct.ADDED_TO_STAGE,xt.bindMethod(u(u(i)),i.handleAddedToStage)),i.addEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(u(u(i)),i.handleRemovedFromStage)),i.updateHandleSize(),i.updateGraphics(),i}return c(e,Wr),p(e,[{key:"handleAddedToStage",value:function(t){this._context.documentView.addEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.handleScaleChange))}},{key:"removeDisplayScaleChangeEvent",value:function(){this._context.documentView.removeEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.handleScaleChange))}},{key:"handleRemovedFromStage",value:function(t){this.removeDisplayScaleChangeEvent()}},{key:"destroy",value:function(){this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.removeRollHighlight)),this.removeEventListener(ct.ADDED_TO_STAGE,xt.bindMethod(this,this.handleAddedToStage)),this.removeEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(this,this.handleRemovedFromStage)),this.removeDisplayScaleChangeEvent()}},{key:"updateGraphics",value:function(){}},{key:"updateHandleSize",value:function(){this._handleSize=this.apparentSize/this._context.info.displayScale}},{key:"handleScaleChange",value:function(t){this.updateHandleSize(),this.updateGraphics()}},{key:"addRollHighlight",value:function(t){this._rolled=!0,this.updateGraphics(),t.stopPropagation()}},{key:"removeRollHighlight",value:function(t){this._rolled=!1,this.updateGraphics(),t.stopPropagation()}},{key:"handleSize",get:function(){return this._handleSize}},{key:"context",get:function(){return this._context}},{key:"position",get:function(){return new If(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"rolled",get:function(){return this._rolled}},{key:"strokeThickness",get:function(){return(this._rolled?2:1)/this.context.info.displayScale}},{key:"strokeAlpha",get:function(){return this._rolled?1:.5}}]),e}();r.implementsInterfaces(Ku,[wt]),r.registerClass(Ku,"com.noteflight.notation.view.AbstractHandle");var ju=function(t){function e(t,i,n,r,o,s){var a;y(this,e),(a=l(this,h(e).call(this))).x=t,a.y=i;var u=new If(-o,n);return u.normalize(r),a.graphics.lineStyle(s.lineThickness*s.lineSpacing,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.moveTo(0,0),a.graphics.lineTo(n/2+u.x,o/2+u.y),a.graphics.lineTo(n,o),a}return c(e,Wr),e}();r.registerClass(ju,"com.noteflight.notation.view.AngleBracketView");var qu=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;y(this,t),this.alphaMultiplier=NaN,this.alphaOffset=NaN,this.blueMultiplier=NaN,this.blueOffset=NaN,this.color=0,this.greenMultiplier=NaN,this.greenOffset=NaN,this.redMultiplier=NaN,this.redOffset=NaN,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=n,this.alphaMultiplier=r,this.redOffset=o,this.greenOffset=s,this.blueOffset=a,this.alphaOffset=l};r.registerClass(qu,"flash.geom.ColorTransform");var Ju=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).feedback=!1,i._context=null,i._lastSelected=!1,i._context=t,i}return c(e,Wr),p(e,null,[{key:"DARKEN_OFFSET",get:function(){return 60}},{key:"DEFAULT_TRANSFORM",get:function(){return Zu}},{key:"_lightenCache",get:function(){return th},set:function(t){th=t}},{key:"_darkenCache",get:function(){return eh},set:function(t){eh=t}}]),p(e,[{key:"destroy",value:function(){this.removeListeners(),this.destroyChildren()}},{key:"removeListeners",value:function(){}},{key:"destroyChildren",value:function(){}},{key:"toViewUnits",value:function(t){return this._context.toViewUnits(t)}},{key:"initializeView",value:function(){this.graphics.clear(),this.updateView(),this.updateStatus()}},{key:"updateView",value:function(){}},{key:"updateSelectionFeedback",value:function(){}},{key:"updateGeometry",value:function(){}},{key:"updateStatus",value:function(){this.setColorTransform(this.getColorTransform()),this.alpha=16777215!=this.color||this.displayInSelectionColor?1:0,this.selected!=this._lastSelected&&(this.updateSelectionFeedback(),this._lastSelected=this.selected)}},{key:"setColorTransform",value:function(t){this.transform.colorTransform=t}},{key:"getColorTransform",value:function(){return this.feedback?e.lightenTransform(this.context.info.feedbackColor):this.displayInSelectionColor?0===this.effectiveColor?e.lightenTransform(A.unknownToUint(this.context.info.selectionColors[0])):e.darkenTransform(this.effectiveColor):0===this.color?e.DEFAULT_TRANSFORM:16777215==this.color?e.lightenTransform(0):e.lightenTransform(this.color)}},{key:"mouseChildrenOnRoll",value:function(){Ec.useRolloverEvents&&(this.addEventListener(li.ROLL_OVER,xt.bindMethod(this,this.enableMouseChildren)),this.addEventListener(li.ROLL_OUT,xt.bindMethod(this,this.disableMouseChildren)),this.mouseChildren=!1)}},{key:"enableMouseChildren",value:function(t){t.target==this&&(this.mouseChildren=!0)}},{key:"disableMouseChildren",value:function(t){t.target==this&&(this.mouseChildren=!1)}},{key:"context",get:function(){return this._context}},{key:"staffMetrics",get:function(){return this._context.layoutContext.staffMetrics}},{key:"pageMetrics",get:function(){return this._context.layoutContext.pageMetrics}},{key:"displayInSelectionColor",get:function(){return this.selected}},{key:"color",get:function(){return 0}},{key:"effectiveColor",get:function(){return 0}},{key:"selected",get:function(){return!1}},{key:"editable",get:function(){return null!=this.context.document&&this.context.document.editable}}],[{key:"lightenTransform",value:function(t){var i=e._lightenCache[t];return null==i&&(i=new qu(1,1,1,1,t>>16,t>>8&255,255&t),e._lightenCache[t]=i),i}},{key:"darkenTransform",value:function(t){var i=e._darkenCache[t];return null==i&&(i=new qu(1,1,1,1,Math.max(0,(t>>16)-e.DARKEN_OFFSET),Math.max(0,(t>>8&255)-e.DARKEN_OFFSET),Math.max(0,(255&t)-e.DARKEN_OFFSET)),e._darkenCache[t]=i),i}}]),e}();r.implementsInterfaces(Ju,[wt]);var Zu=new qu,th={},eh={};r.registerClass(Ju,"com.noteflight.notation.view.ScoreObjectView");var ih=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._notation=null,n._rolled=!1,n._hidden=!1,n._handles=[],n._notation=i,n.addEventListener(li.MOUSE_OVER,xt.bindMethod(u(u(n)),n.addRollHighlight)),n.addEventListener(li.MOUSE_OUT,xt.bindMethod(u(u(n)),n.removeRollHighlight)),n}return c(e,Ju),p(e,[{key:"removeListeners",value:function(){this.removeEventListener(li.MOUSE_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.MOUSE_OUT,xt.bindMethod(this,this.removeRollHighlight))}},{key:"updateStatus",value:function(){s(h(e.prototype),"updateStatus",this).call(this),this._rolled&&this.notation.enabled&&!this.feedback?(this.buttonMode=!0,this.useHandCursor=!0,this.alpha=1):(this.buttonMode=!1,this.useHandCursor=!1)}},{key:"addRollHighlight",value:function(t){this._rolled=!t.buttonDown,this.updateStatus(),t.stopPropagation()}},{key:"removeRollHighlight",value:function(t){this._rolled=!1,this.updateStatus(),t.stopPropagation()}},{key:"addHandle",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null==n&&(n=new gc(this.context)),this._handles.push(n),n.x=t,n.y=e,this.addChild(n),n.addEventListener(li.MOUSE_DOWN,xt.bindMethod(i,i.handleMouseDown))}},{key:"destroyChildren",value:function(){this.removeHandles()}},{key:"removeHandles",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._handles[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,wt);s.destroy(),this.removeChild(A.as(s,Rr))}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._handles=[]}},{key:"notation",get:function(){return this._notation}},{key:"hidden",get:function(){return this._hidden},set:function(t){this._hidden=t,this.updateStatus()}},{key:"color",get:function(){return this._hidden?16777215:this.notation.color}},{key:"effectiveColor",get:function(){return this._hidden?16777215:this.notation.effectiveColor}},{key:"selected",get:function(){return null!=this.context.document&&null!=this.context.document.selection&&(!!this.context.document.selection.includes(this.notation)&&(A.is(this.context.document.selection,qe)||null==this.notation.valueNotation||this.notation.valueNotation==this.notation))}}]),e}();r.registerClass(ih,"com.noteflight.notation.view.SelectableView");var nh=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,A.as(n.parent,he))))._annotation=null,r._notationLayout=null,r._viewContext=null,r._annotationMeditaor=null,r.ANNOTATION_MARGIN_TOP=12,r.ANNOTATION_ICON_NAME="annotationIcon",r._annotation=n,r._notationLayout=i,r._viewContext=t,r._annotationMeditaor=r.context.registerAnnotationView(u(u(r))),r.initializeView(),r}return c(e,ih),p(e,[{key:"destroy",value:function(){this._annotationMeditaor.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"getGlyph",value:function(){return this._viewContext.layoutContext.foundry.getSymbol(this.ANNOTATION_ICON_NAME)}},{key:"updateView",value:function(){var t=this.getGlyph().createDisplayObject(this._viewContext.info);t.y=t.y-this.ANNOTATION_MARGIN_TOP,this.addChild(t)}},{key:"annotation",get:function(){return this._annotation}},{key:"notationLayout",get:function(){return this._notationLayout}},{key:"selected",get:function(){if(s(h(e.prototype),"selected",this))return!0;if(A.is(this.context.document.selection,qe)){var t=this.context.document.selection.selectedNotations();if(1==t.length&&t[0].valueNotation==this.notation)return!0}return!1}}]),e}();r.registerClass(nh,"com.noteflight.notation.view.AnnotationView");var rh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i.getBeamableLayoutAt(0).noteSet)))._layout=i,n._beamMediator=t.registerBeamView(u(u(n))),n.initializeView(),n}return c(e,ih),p(e,[{key:"destroy",value:function(){this._beamMediator.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"updateView",value:function(){var t=this.toViewUnits(this.layout.effectiveBeamThickness);this.layout.down||(t*=-1);var e=!0,i=!1,n=void 0;try{for(var r,o=this.layout.beams[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=this.layout.getBeamableLayoutAt(A.unknownToInt(s.start)),l=this.layout.getBeamableLayoutAt(A.unknownToInt(s.end)),u=A.unknownToInt(s.level),h=(this.layout.down?u:-u)*this.layout.effectiveBeamInterval,c=a.leftX+a.stemEnd.x,d=l.leftX+l.stemEnd.x;if(a.noteSet.tremoloDyad&&(u>0||!a.hasStem||a.noteSet.value==mn.QUARTER)){var f=(d-c)/4;c+=Math.min(f,this.staffMetrics.tremoloInsetLength),d-=Math.min(f,this.staffMetrics.tremoloInsetLength),a.hasStem||(h+=this.layout.down?-this.layout.maxLevel/2:this.layout.maxLevel/2,!a.down&&A.is(a,_s)&&A.unknownToType(a,_s).hasAlternate&&(c+=a.notationWidth),l.down&&A.is(l,_s)&&A.unknownToType(l,_s).hasAlternate&&(d-=l.notationWidth))}if(s.start==s.end){if(A.is(a,Cs))continue;!!this.layout.isBeamStart(A.unknownToUint(s.start))||!this.layout.isBeamEnd(A.unknownToUint(s.start))&&zl.groupStartsAt(a.noteSet.measure.timeSignature.beamGroups,a.noteSet.rhythmPosition)?d=c+this.layout.context.staffMetrics.fractionalBeamLength:c=d-this.layout.context.staffMetrics.fractionalBeamLength}var y=this.toViewUnits(c),g=-this.toViewUnits(this.layout.startY+h+this.layout.rise*(c-this.layout.startX)/(this.layout.endX-this.layout.startX)),p=this.toViewUnits(d),m=-this.toViewUnits(this.layout.startY+h+this.layout.rise*(d-this.layout.startX)/(this.layout.endX-this.layout.startX));this.graphics.beginFill(0),this.graphics.moveTo(y,g),this.graphics.lineTo(y,g-t),this.graphics.lineTo(p,m-t),this.graphics.lineTo(p,m),this.graphics.lineTo(y,g),this.graphics.endFill()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"layout",get:function(){return this._layout}},{key:"color",get:function(){var t=this._layout.getBeamableLayoutAt(0).noteSet.color;return t==this._layout.getBeamableLayoutAt(this._layout.numBeamableLayouts-1).noteSet.color?t:0}}]),e}();r.registerClass(rh,"com.noteflight.notation.view.BeamView");var oh=function(t){function e(t,i,n,r,o,s){var a;y(this,e),a=l(this,h(e).call(this)),s==de.PRE_BEND_LIAISON&&(t+=n,n=0,i-=o.lineSpacing/2,r+=o.lineSpacing/2),a.x=t,a.y=i,a.graphics.lineStyle(o.lineThickness*o.lineSpacing,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.moveTo(0,0);var u=r+o.bendArrowHeight*o.lineSpacing;return a.graphics.curveTo(n,0,n,u),a.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.beginFill(0),a.graphics.moveTo(n,r),a.graphics.lineTo(n-o.bendArrowWidth*o.lineSpacing/2,u),a.graphics.lineTo(n+o.bendArrowWidth*o.lineSpacing/2,u),a.graphics.lineTo(n,r),a.graphics.endFill(),a}return c(e,Wr),e}();r.registerClass(oh,"com.noteflight.notation.view.BendView");var sh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._layout=i,n}return c(e,Ju),p(e,[{key:"layout",get:function(){return this._layout}}]),e}();r.registerClass(sh,"com.noteflight.notation.view.ChunkView");var ah=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._layout=null,n._context=null,n._context=t,n._layout=i,n.initializeView(),n}return c(e,sh),p(e,[{key:"initializeView",value:function(){s(h(e.prototype),"initializeView",this).call(this)}},{key:"updateView",value:function(){this.layout.validateGlobalLayout();for(var t=A.unknownToType(this.layout,zo).getViewElements(this.context),e=0;e<t.length;e++)this.addChild(A.unknownToType(t[e],Rr));this.updateGeometry()}},{key:"updateGeometry",value:function(){this.layout.validateGlobalLayout()}},{key:"layout",get:function(){return this._layout}}]),e}();r.registerClass(ah,"com.noteflight.notation.view.BlockView");var lh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,null!=i?i.notation:null)))._layout=null,n._notationViewMediator=null,n._views=[],n._notationViews=[],n._layout=i,n._notationViewMediator=t.registerNotationView(u(u(n))),n.initializeView(),n}return c(e,ih),p(e,[{key:"destroy",value:function(){this._notationViewMediator.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"updateView",value:function(){this.destroyChildren(),this._views=[];for(var t=0;t<this.layout.numGlyphLayouts;t++){var e=this.layout.getGlyphLayoutAt(t).createDisplayObject(this.context);this._views.push(e),this.addChild(e)}}},{key:"layout",get:function(){return this._layout},set:function(t){this._layout=t}}]),e}();r.registerClass(lh,"com.noteflight.notation.view.NotationView");var uh=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,lh),p(e,[{key:"editText",value:function(){throw new Error("editText() not overridden")}},{key:"editMeasureText",value:function(t,e){var i=A.unknownToType(e(this.context,this.notation,t),fc);this.visible=!1;var n=this;i.addEventListener(Yy.VALUE_COMMIT,function(t){A.unknownToType(n.notation,Ca).isEmpty&&n.notation.measure.removeElement(n.notation),n.visible=!0})}}],[{key:"addMeasureText",value:function(t){var e=t.context,i=t.measure,n=t.notation,r=t.groupName,o=t.createFieldFunction,s=t.listenerNotation,a=!!t.box,l=t.transientNotation;n.parent=i;var u=A.unknownToType(o(e,n,null,s),fc);return n.textbox=a,u.addEventListener(Yy.VALUE_COMMIT,function(t){n.isEmpty||l||(e.controller.document.undoHistory.openGroupName=r,i.addElement(n,Kl.NON_METRICAL_VOICE_NUMBER))}),u}},{key:"createEditField",value:function(t,e,i,n,r,o,s,a,l,u){var h,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"text";if((h=new fc(t,e,i,n,{model:s,property:c,editGroupName:u,markdown:!1,bold:r,italic:o})).showPrompt=!1,h.clearSelectionOnFocus=!1,A.is(s,Ca)&&A.unknownToType(s,Ca).alignToStaffTop){var d;if(s.measure.isSystemMeasure)d=A.unknownToType(t.layoutContext.score.visibleStaves[0],Rl).getMeasureAt(A.intToUint(s.measure.index));else d=s.measure;l+=d.effectiveClef.staffHeight}var f=null!=s.rhythmContext?s.position:s.rhythmPosition,y=A.unknownToType(s.measure.isSystemMeasure?t.layoutContext.score.visibleStavesAtMeasure(s.measure.index)[0]:s.measure.staff,Rl),g=t.documentView.getPointInMeasure(s.measure.index,y,f,{verticalAlign:"bottom"});g=t.documentView.globalToFeedback(g),h.x=g.x-2+t.layoutContext.staffMetrics.lineSpacing*(a+s.dx),h.y=g.y-t.layoutContext.staffMetrics.lineSpacing*(l+s.dy)-h.ascent,t.documentView.addFeedbackChild(h);h.setFocus(),h.highlightEnd();return h.addEventListener(Yy.VALUE_COMMIT,function(e){t.documentView.removeFeedbackChild(h)}),h}}]),e}();r.registerClass(uh,"com.noteflight.notation.view.TextNotationView");var hh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._fretboardView=null,!i.chordSymbol.hideFretboards&&i.chordSymbol.fretboard&&(n._fretboardView=new yh(i.dx,i.glyphWidths,i.distanceY,i.chordSymbol.fretboard,t.layoutContext.staffMetrics),n._fretboardView.x+=n.toViewUnits(i.justifyOffset),n.addChild(n._fretboardView)),n}return c(e,uh),p(e,null,[{key:"CHORD_LINE_GAP",get:function(){return 6}}]),p(e,[{key:"editText",value:function(){s(h(e.prototype),"editMeasureText",this).call(this,"Edit Chord Symbol",e.createChordSymbolField)}}],[{key:"addChordSymbol",value:function(t,i,n,r){var o=new Aa(n,""),s=i.previousNotation(n,function(t){return A.is(t,Aa)},!0);null==s||null!=r&&s.dy==r.dy?null!=r?o.dy=r.dy+(r.dy>=0?e.CHORD_LINE_GAP:-e.CHORD_LINE_GAP):i.staff.index==i.staff.score.numStaves-1&&i.staff.index>0&&(i.effectiveClef.isTab?o.dy+=t.layoutContext.staffMetrics.chordBelowStaffOffsetTab:o.dy+=t.layoutContext.staffMetrics.chordBelowStaffOffset):o.dy=s.dy,uh.addMeasureText({context:t,measure:i,notation:o,groupName:"Add Chord Symbol",createFieldFunction:e.createChordSymbolField})}},{key:"commitChordSymbol",value:function(t,e,i){if(i.commitChar&&i.commitChar==String.fromCharCode(9)){var n=-1;if(e.rhythmContext?n=e.position:t.documentController.scoreDocument.selection&&t.documentController.scoreDocument.selection.selectedRange&&(n=t.documentController.scoreDocument.selection.selectedRange.start.position),n>-1){var r=e.measure.nextNotation(n,function(t){return A.is(t,Sn)&&A.as(t,Sn).notes.length>0},!0);if(r){t.document.validateNow();var o=A.as(r.measure.notationAtPosition(r.position,Aa),Aa);o?(t.documentController.scoreDocument.selection=new qe(t.document.score,[o]),o.dispatchEvent(new Fi(Fi.EDIT))):(t.controller.selectNotation(r),t.documentController.addChordSymbol())}}}}},{key:"createChordSymbolField",value:function(t,i,n){var r=uh.createEditField(t,My.LEFT,t.layoutContext.staffMetrics.chordSymbolFont,t.layoutContext.staffMetrics.chordSymbolSize,!1,!1,i,0,-t.layoutContext.staffMetrics.chordSymbolPadding.bottom,n,"transposedText");r.multiline=!0,r.autoCommitChars=String.fromCharCode(13)+String.fromCharCode(9),r.autoCommitFunction=function(t,e){return!Aa.isFiguredBass(Aa.canonicalizeChord(t.uncommittedText))};return r.addEventListener(Yy.VALUE_COMMIT,function(n){e.commitChordSymbol(t,i,r)}),r}}]),e}();r.registerClass(hh,"com.noteflight.notation.view.ChordSymbolView");var ch=function(t){function e(t,i,n,r,o,s){var a,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;y(this,e),(a=l(this,h(e).call(this))).x=t,a.y=i;var c=s.lineThickness*s.lineSpacing;null==u||u.printView||(a.graphics.lineStyle(Math.max(5,c),0,0),a.graphics.moveTo(0,0),a.graphics.lineTo(n,r)),a.graphics.lineStyle(c,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.moveTo(0,0);for(var d=Math.sqrt(n*n+r*r),f=0;;){var g=!1,p=!0,m=!1,v=void 0;try{for(var _,S=o[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var L=_.value,k=A.unknownToNumber(L),T=new If(n,r);if(T.normalize(f),g?a.graphics.moveTo(T.x,T.y):a.graphics.lineTo(T.x,T.y),g=!g,(f+=k)>d)return l(a)}}catch(t){m=!0,v=t}finally{try{p||null==S.return||S.return()}finally{if(m)throw v}}}return a}return c(e,Wr),e}();r.registerClass(ch,"com.noteflight.notation.view.DashedLineView");var dh=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(t=l(this,h(e).call(this))).source=null,t.symbol=null,t.source=i,t.symbol=n,t}return c(e,Wr),e}();r.registerClass(dh,"com.noteflight.notation.view.EmbedDisplayObject");var fh=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,uh),p(e,[{key:"editText",value:function(){s(h(e.prototype),"editMeasureText",this).call(this,"Edit Dynamics/Expression",e.createExpressionTextField)}}],[{key:"addExpressionText",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;uh.addMeasureText({context:t,measure:i,notation:new Ra(n,"",r),groupName:"Add Dynamics/Expression",createFieldFunction:e.createExpressionTextField})}},{key:"createExpressionTextField",value:function(t,e,i){var n=uh.createEditField(t,My.LEFT,t.layoutContext.staffMetrics.staffTextFont,t.layoutContext.staffMetrics.expressionTextSize,!1,!0,e,0,-t.layoutContext.staffMetrics.expressionTextPadding.bottom,i);return n.autoCommitChars=String.fromCharCode(13),n}}]),e}();r.registerClass(fh,"com.noteflight.notation.view.ExpressionTextView");var yh=function(t){function e(t,i,n,r,o){var s;y(this,e),(s=l(this,h(e).call(this)))._staffMetrics=null,s._staffMetrics=o;var a=(r.strings-1)*s._staffMetrics.chordFrameStringSpacing;return s.x=(t-(a-i)/2)*s._staffMetrics.lineSpacing,s.y=(-n+e.PADDING_TOP)*s._staffMetrics.lineSpacing,s.drawFretboard(r),s}return c(e,Wr),p(e,null,[{key:"TOP_FRET_HEAVIER_THICKNESS",get:function(){return.25}},{key:"PADDING_TOP",get:function(){return 1.5}},{key:"STOP_RADIUS",get:function(){return.25}},{key:"SILENT_SIDE",get:function(){return.5}},{key:"SILENT_PADDING",get:function(){return.25}},{key:"FINGERING_VERTICAL_NUDGE",get:function(){return.25}},{key:"FINGERING_TEXT_SIZE",get:function(){return.14}},{key:"FIRST_FRET_TEXT_SIZE",get:function(){return.18}},{key:"BARRE_BOTTOM_OF_CURVE",get:function(){return-.5}},{key:"BARRE_TOP_OF_CURVE",get:function(){return-.8}},{key:"BARRE_PADDING",get:function(){return-.2}},{key:"HALF_LINE",get:function(){return.5}}]),p(e,[{key:"makeFingeringTextField",value:function(){var t=new Ty;return t.autoSize=My.CENTER,t.antiAliasType=vy.ADVANCED,t.gridFitType=_y.NONE,t.embedFonts=!0,t.selectable=!1,t.defaultTextFormat=new Ly("Tahoma",e.FINGERING_TEXT_SIZE*this._staffMetrics.baseFontSize,null,null,null,null,null,null,wy.CENTER),t}},{key:"makeFirstFretTextField",value:function(t){var i=new Ty;return i.autoSize=t==Da.FIRST_FRET_LOCATION_LEFT?My.RIGHT:My.LEFT,i.antiAliasType=vy.ADVANCED,i.gridFitType=_y.NONE,i.embedFonts=!0,i.selectable=!1,i.defaultTextFormat=new Ly("Tahoma",e.FIRST_FRET_TEXT_SIZE*this._staffMetrics.baseFontSize,null,null,null,null,null,null,t==Da.FIRST_FRET_LOCATION_LEFT?wy.LEFT:wy.RIGHT),i}},{key:"drawFretboard",value:function(t){this.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER);var i=this._staffMetrics.chordFrameStringSpacing*(t.strings-1)*this._staffMetrics.lineSpacing,n=this._staffMetrics.chordFrameFretSpacing*t.frets*this._staffMetrics.lineSpacing;this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,i,n),this.graphics.endFill();for(var r=0;r<t.frets+1;r++)this.graphics.moveTo(0,r*this._staffMetrics.chordFrameFretSpacing*this._staffMetrics.lineSpacing),this.graphics.lineTo(i,r*this._staffMetrics.chordFrameFretSpacing*this._staffMetrics.lineSpacing);for(r=0;r<t.strings;r++)this.graphics.moveTo(r*this._staffMetrics.chordFrameStringSpacing*this._staffMetrics.lineSpacing,0),this.graphics.lineTo(r*this._staffMetrics.chordFrameStringSpacing*this._staffMetrics.lineSpacing,n);0===t.firstFret&&(this.graphics.lineStyle(e.TOP_FRET_HEAVIER_THICKNESS*this._staffMetrics.lineSpacing,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),this.graphics.moveTo(0,0),this.graphics.lineTo(i,0));var o,s,a,l,u=[];for(r=1;r<=t.strings;r++)u.push(r);this.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER);var h=!0,c=!1,d=void 0;try{for(var f,y=t.notes[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var g=f.value,p=g.string+1,m=u.indexOf(p);if(-1!=m&&u.splice(m,1),a=(t.strings-p)*this._staffMetrics.chordFrameStringSpacing*this._staffMetrics.lineSpacing,l=0===t.firstFret?g.fret-e.HALF_LINE:0===g.fret?-e.HALF_LINE:g.fret-t.firstFret+e.HALF_LINE,l*=this._staffMetrics.chordFrameFretSpacing*this._staffMetrics.lineSpacing,0===g.fret?this.graphics.drawCircle(a,l,e.STOP_RADIUS*this._staffMetrics.lineSpacing):(this.graphics.beginFill(0),this.graphics.drawCircle(a,l,e.STOP_RADIUS*this._staffMetrics.lineSpacing),this.graphics.endFill()),g.hasFingering){var v=this.makeFingeringTextField();this.addChild(v),v.text=g.fingering,v.y=(t.frets*this._staffMetrics.chordFrameFretSpacing-e.FINGERING_VERTICAL_NUDGE)*this._staffMetrics.lineSpacing,v.x=a-v.width/2}g.hasBarre&&("start"==g.barre?o=a:s=a)}}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}l=-(e.SILENT_SIDE+e.SILENT_PADDING);for(var _=0;_<u.length;_++){var S=u[_],L=A.as(S,Hy);a=(t.strings-L)*this._staffMetrics.chordFrameStringSpacing-e.SILENT_SIDE/2,this.graphics.moveTo(a*this._staffMetrics.lineSpacing,l*this._staffMetrics.lineSpacing),this.graphics.lineTo((a+e.SILENT_SIDE)*this._staffMetrics.lineSpacing,(l+e.SILENT_SIDE)*this._staffMetrics.lineSpacing),this.graphics.moveTo(a*this._staffMetrics.lineSpacing,(l+e.SILENT_SIDE)*this._staffMetrics.lineSpacing),this.graphics.lineTo((a+e.SILENT_SIDE)*this._staffMetrics.lineSpacing,l*this._staffMetrics.lineSpacing)}var k=t.effectiveFirstFretText;if(null!=k){var T=this.makeFirstFretTextField(t.firstFretLocation);this.addChild(T),T.text=k,T.y=-T.getLineMetrics(0).ascent/2,t.firstFretLocation==Da.FIRST_FRET_LOCATION_LEFT?T.x=-T.width*this._staffMetrics.lineSpacing:T.x=this._staffMetrics.chordFrameStringSpacing*(t.strings-1)*this._staffMetrics.lineSpacing}if(!X.isNaN(o)){this.graphics.beginFill(0),this.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.BEVEL),this.graphics.moveTo(o,e.BARRE_PADDING*this._staffMetrics.lineSpacing);var E=o+(s-o)/2;this.graphics.curveTo(E,e.BARRE_BOTTOM_OF_CURVE*this._staffMetrics.lineSpacing,s,e.BARRE_PADDING*this._staffMetrics.lineSpacing),this.graphics.curveTo(E,e.BARRE_TOP_OF_CURVE*this._staffMetrics.lineSpacing,o,e.BARRE_PADDING*this._staffMetrics.lineSpacing),this.graphics.endFill()}}}]),e}();r.registerClass(yh,"com.noteflight.notation.view.FretboardView");var gh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i.notation)))._span=null,n._spanNotationViewMediator=null,n._span=i,n._spanNotationViewMediator=t.registerSpanNotationView(u(u(n))),n}return c(e,ih),p(e,[{key:"destroy",value:function(){this._spanNotationViewMediator.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"span",get:function(){return this._span}}]),e}();r.registerClass(gh,"com.noteflight.notation.view.SpanView");var ph=function(t){function e(t,i,n,r){var o;y(this,e),(o=l(this,h(e).call(this,t,i))).w=NaN,o.broken=!1,o.startGap=NaN,o.endGap=NaN,o.stroke=NaN,o.startHandle=null,o.endHandle=null,o.pEnd=null;var s=A.unknownToType(i.notation,Va),a=Math.atan2(r.y-n.y,r.x-n.x);o.rotation=180*a/Math.PI,o.x=n.x,o.y=n.y,o.w=If.distance(r,n),o.pEnd=r,o.stroke=o.staffMetrics.hairpinThickness*o.staffMetrics.lineSpacing;var u=o.staffMetrics.hairpinLongThreshold*o.staffMetrics.lineSpacing,c=o.w>u?o.staffMetrics.hairpinLongEndGap:o.staffMetrics.hairpinShortEndGap;return s.type==Va.CRESCENDO?(o.startGap=o.toViewUnits(i.startBreak?o.staffMetrics.hairpinBreakGap:0),o.endGap=o.toViewUnits(c)):(o.startGap=o.toViewUnits(c),o.endGap=o.toViewUnits(i.endBreak?o.staffMetrics.hairpinBreakGap:0)),o.initializeView(),o}return c(e,gh),p(e,[{key:"updateView",value:function(){this.drawGraphics(0,Math.max(4,this.stroke)),this.drawGraphics(1,this.stroke)}},{key:"drawGraphics",value:function(t,e){this.graphics.lineStyle(e,0,t),this.graphics.moveTo(0,this.startGap/2),this.graphics.lineTo(this.w,this.endGap/2),this.graphics.moveTo(0,-this.startGap/2),this.graphics.lineTo(this.w,-this.endGap/2)}},{key:"updateSelectionFeedback",value:function(){s(h(e.prototype),"updateSelectionFeedback",this).call(this),null!=this.context.document&&this.context.document.isModelEditable(this.notation)&&(this.selected?(this.span.startBreak||this.addHandle(0,0,new Ie(this.context,this.span.notation)),this.span.endBreak||this.addHandle(this.w,0,new Ne(this.context,this.span.notation))):this.removeHandles())}}]),e}();r.registerClass(ph,"com.noteflight.notation.view.HairpinView");var mh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._layout=null,n._decorationView=null,n._layout=i,n.initializeView(),n}return c(e,Ju),p(e,[{key:"updateStaffGeometry",value:function(t){this._decorationView.y=-this.toViewUnits(fs.lyricY(this.context.layoutContext,this.layout.startLyricLayout,t,this.layout.startLyricLayout.lyric))}},{key:"updateView",value:function(){for(;this.numChildren>0;)this.removeChildAt(0);this._decorationView=this.layout.decorationLayout.createDisplayObject(this.context),this.addChild(this._decorationView)}},{key:"layout",get:function(){return this._layout}},{key:"width",get:function(){return this.textMeasurement.textWidth(this._svg)},set:function(t){}}]),e}();r.registerClass(mh,"com.noteflight.notation.view.HyphenView");var vh=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(y(this,e),(n=l(this,h(e).call(this)))._context=t,n._lastChange=0,n.graphics.clear(),r)n.graphics.lineStyle(1,t.info.dragHighlightInsertionPointColor);else{n.alpha=0,n.graphics.beginFill(0,0);var s=t.toViewUnits(t.layoutContext.staffMetrics.mouseNoteEntrySlopHeight),a=t.toViewUnits(t.layoutContext.staffMetrics.mouseNoteEntrySlopWidth);n.graphics.drawRect(0,-s,a,i+2*s),n.graphics.endFill(),n.graphics.lineStyle(1,0),n.addEventListener(ct.ENTER_FRAME,xt.bindMethod(u(u(n)),n.handleEnterFrame)),n.addEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(u(u(n)),n.handleRemovedFromStage))}return n.graphics.moveTo(0,o),n.graphics.lineTo(0,o+i),n}return c(e,Wr),p(e,null,[{key:"CHANGE_DELAY",get:function(){return.5}},{key:"MAX_ALPHA",get:function(){return.9}}]),p(e,[{key:"handleRemovedFromStage",value:function(t){this.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleEnterFrame",value:function(t){this.visible=null!=this.stage&&(this.stage.focus==this._context.documentView||null==this.stage.focus);var i=X.flash_utils_getTimer()/1e3;this.visible&&i-this._lastChange>=e.CHANGE_DELAY&&(this.alpha=0===this.alpha?e.MAX_ALPHA:0,this._lastChange=i)}}]),e}();r.registerClass(vh,"com.noteflight.notation.view.InsertionPoint");var _h=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,uh),p(e,[{key:"updateLabelNotationText",value:function(t){this.layout.updateLabelNotationText(t);var e=A.as(this.getChildAt(0),Wr);e&&(A.as(e.getChildAt(0),Ty).text=t)}}]),e}();r.registerClass(_h,"com.noteflight.notation.view.LabelNotationView");var Sh=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,_h),p(e,[{key:"editText",value:function(){}}]),e}();r.registerClass(Sh,"com.noteflight.notation.view.MeasureNumberNotationView");var Lh=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i))).lineNotation=A.unknownToType(i.notation,qa),o.x=n.x,o.y=n.y,o.w=Math.max(0,r.x-n.x),o.pEnd=r,o.stroke=o.staffMetrics.lineNotationThickness*o.staffMetrics.lineSpacing,o.initializeView(),o}return c(e,gh),p(e,null,[{key:"DEFAULT_DASH_LENGTH",get:function(){return 4}},{key:"DEFAULT_DASH_SPACING",get:function(){return 3}},{key:"DEFAULT_BRACKET_LENGTH",get:function(){return 4}},{key:"LINE_TYPE_DASHED",get:function(){return"dashed"}},{key:"LINE_TYPE_SOLID",get:function(){return"solid"}},{key:"LINE_TYPE_MULTIREST",get:function(){return"multirest"}},{key:"LINE_TYPE_WAVY",get:function(){return"wavy"}},{key:"LINE_TYPE_NONE",get:function(){return"none"}},{key:"BRACKET_UP",get:function(){return"bracketUp"}},{key:"BRACKET_DOWN",get:function(){return"bracketDown"}},{key:"BRACKET_MIDDLE",get:function(){return"bracketMiddle"}},{key:"BRACKET_NONE",get:function(){return"bracketNone"}}]),p(e,[{key:"updateView",value:function(){var t=1;if(A.is(this.lineNotation,kl))if(!this.span.startBreak&&this.span.staffLayout.getMeasureLayoutAt(this.span.notation.measure.index-this.span.staffLayout.startMeasureIndex).multiRestsEnabled)this.w+=this.toViewUnits(.25);else{if(this.context.info.printView)return;t=.3,this.w-=this.toViewUnits(1)}this.drawGraphics(t)}},{key:"drawGraphics",value:function(t){var i,r=n(this.lineSettings,5),o=r[0],s=r[1],a=r[2],l=r[3],u=r[4],h=0,c=0;if(!this.span.startBreak){var d=this.context.layoutContext.foundry.getLineNotationStart(this.lineNotation.type);if(null!=d&&(i=d.createDisplayObject(this.context.info),h=d.width+A.as(d,Nr).spacingX,i.y=A.as(d,Nr).dy,this.addChild(i)),this.lineNotation.startingText){var f=this.createTextFormat(),y=new eo(f,this.lineNotation.startingText);i=y.createDisplayObject(this.context.info),"top"==l?(i.y+=y.originY+this.staffMetrics.lineNotationYPosition+u,i.x+=4):"middle"==l?(i.y+=.25*f.size,h=y.width):h=y.width,this.addChild(i)}if(A.is(this.lineNotation,Wl)){var g=A.as(this.lineNotation,Wl);if(null!=g.accidental){var p=g.scoreAccidental,m=A.as(this.context.layoutContext.foundry.getAccidental(p),Nr);(i=m.createDisplayObject(this.context.info)).y=m.dy-d.height-this.staffMetrics.trillAccidentalYSpacing*this.staffMetrics.lineSpacing,h+=this.staffMetrics.trillAccidentalXSpacing*this.staffMetrics.lineSpacing,i.x=h,h+=m.width,i.scaleX=i.scaleY=this.staffMetrics.trillAccidentalScale,this.addChild(i)}}this.graphics.lineStyle(this.stroke,0,t),a==e.BRACKET_DOWN?(this.graphics.moveTo(0,0),this.graphics.lineTo(0,this.bracketLength)):a==e.BRACKET_UP?(this.graphics.moveTo(0,0),this.graphics.lineTo(0,-this.bracketLength)):a==e.BRACKET_MIDDLE&&(this.graphics.moveTo(0,this.bracketLength/2),this.graphics.lineTo(0,-this.bracketLength/2))}if(!this.span.endBreak){var v=this.context.layoutContext.foundry.getLineNotationEnd(this.lineNotation.type);null!=v&&(i=v.createDisplayObject(this.context.info),c=v.width+A.as(v,Nr).spacingX,i.x=this.w-v.width,i.y=A.as(v,Nr).dy,this.addChild(i)),this.graphics.lineStyle(this.stroke,0,t),s==e.BRACKET_DOWN?(this.graphics.moveTo(this.w,-this.toViewUnits(this.lineNotation.ascent)),this.graphics.lineTo(this.w,-this.toViewUnits(this.lineNotation.ascent)+this.bracketLength)):s==e.BRACKET_UP?(this.graphics.moveTo(this.w,-this.toViewUnits(this.lineNotation.ascent)),this.graphics.lineTo(this.w,-this.toViewUnits(this.lineNotation.ascent)-this.bracketLength)):s==e.BRACKET_MIDDLE&&(this.graphics.moveTo(this.w,-this.toViewUnits(this.lineNotation.ascent)+this.bracketLength/2),this.graphics.lineTo(this.w,-this.toViewUnits(this.lineNotation.ascent)-this.bracketLength/2))}if(o==e.LINE_TYPE_DASHED){var _=[e.DEFAULT_DASH_LENGTH,e.DEFAULT_DASH_SPACING],S=new ch(0,0,this.w-(h+c),-this.toViewUnits(this.lineNotation.ascent),_,this.staffMetrics,this.context.info);S.x=h,this.addChild(S)}else if(o==e.LINE_TYPE_WAVY){var L=this.context.layoutContext.foundry.getLineNotationSegment(o),k=new xr([],A.as(L,Nr).spacingX);k.addRepeatingGlyph(L,this.w-(h+c));var T=k.createDisplayObject(this.context.info);T.x=h,T.y=A.as(L,Nr).dy,this.addChild(T)}else if(o==e.LINE_TYPE_MULTIREST){if(!this.span.startBreak){var E=this.context.layoutContext.foundry.getTimeSignature(A.intToUint(A.unknownToType(this.lineNotation,kl).bars));(i=E.createDisplayObject(this.context.info)).x=this.w/2-E.width/2,i.y=-E.height-this.toViewUnits(2),i.alpha=t,this.addChild(i)}var M=new Bh(0,0,this.w-(h+c),-this.toViewUnits(this.lineNotation.ascent),this.staffMetrics,t);M.x=h,M.alpha=t,this.addChild(M)}else if(o==e.LINE_TYPE_SOLID){var b=new Th(0,0,this.w-(h+c),-this.toViewUnits(this.lineNotation.ascent),this.toViewUnits(this.staffMetrics.lineThickness),this.staffMetrics,this.context.info);b.x=h,this.addChild(b)}}},{key:"createTextFormat",value:function(){return new Ly(this.font,this.fontSize,null,this.isBold,this.isItalic)}},{key:"showHandles",value:function(){return!(A.is(this.lineNotation,kl)||A.is(this.lineNotation,ll))}},{key:"updateSelectionFeedback",value:function(){s(h(e.prototype),"updateSelectionFeedback",this).call(this),null!=this.context.document&&this.context.document.isModelEditable(this.notation)&&this.showHandles()&&(this.selected?(this.span.startBreak||this.addHandle(0,0,new Ie(this.context,this.lineNotation,this.lineNotation.allowAscent)),this.span.endBreak||this.addHandle(this.w,-this.toViewUnits(this.lineNotation.ascent),new Ne(this.context,this.lineNotation,this.lineNotation.allowAscent))):this.removeHandles())}},{key:"calculateFontSize",value:function(){return this.staffMetrics.baseFontSize*this.staffMetrics.lineNotationFontSize}},{key:"isItalic",get:function(){return this.lineNotation.isItalic}},{key:"isBold",get:function(){return this.lineNotation.isBold}},{key:"font",get:function(){return this.staffMetrics.staffTextFont}},{key:"fontSize",get:function(){return this.calculateFontSize()}},{key:"lineSettings",get:function(){var t,i,n,r="bottom";switch(this.lineNotation.type){case qa.TYPE_TRILL:case qa.TYPE_VIBRATO:t=e.LINE_TYPE_WAVY,i=e.BRACKET_NONE;break;case qa.TYPE_OCTAVE_DOWN:t=e.LINE_TYPE_DASHED,i=e.BRACKET_UP;break;case qa.TYPE_OCTAVE_UP:t=e.LINE_TYPE_DASHED,i=e.BRACKET_DOWN;break;case qa.TYPE_PEDAL:t=e.LINE_TYPE_NONE,i=e.BRACKET_NONE;break;case qa.TYPE_SOLID:t=e.LINE_TYPE_SOLID,i=e.BRACKET_NONE;break;case qa.TYPE_SOLID_BRACKET_DOWN:t=e.LINE_TYPE_SOLID,n=i=e.BRACKET_DOWN;break;case qa.TYPE_SOLID_BRACKET_MIDDLE:t=e.LINE_TYPE_SOLID,n=i=e.BRACKET_MIDDLE;break;case qa.TYPE_SOLID_BRACKET_UP:t=e.LINE_TYPE_SOLID,n=i=e.BRACKET_UP;break;case qa.TYPE_DASHED:t=e.LINE_TYPE_DASHED,i=e.BRACKET_NONE,r="middle";break;case qa.TYPE_DASHED_FINAL_DOWN:t=e.LINE_TYPE_DASHED,i=e.BRACKET_DOWN,r="middle";break;case qa.TYPE_PALM_MUTE:case qa.TYPE_LET_VIBRATE:case qa.TYPE_DASHED_FINAL_MIDDLE:t=e.LINE_TYPE_DASHED,i=e.BRACKET_MIDDLE,r="middle";break;case qa.TYPE_DASHED_FINAL_UP:t=e.LINE_TYPE_DASHED,i=e.BRACKET_UP,r="middle";break;case qa.TYPE_MULTIREST:t=e.LINE_TYPE_MULTIREST,n=e.BRACKET_MIDDLE,i=e.BRACKET_MIDDLE,r="top";break;default:t=e.LINE_TYPE_DASHED,i=e.BRACKET_NONE}return[t,i,n,r,0]}},{key:"bracketLength",get:function(){return this.lineNotation.bracketLength>0?this.toViewUnits(this.lineNotation.bracketLength):this.toViewUnits(this.staffMetrics.lineNotationBracketHeight)}}]),e}();r.registerClass(Lh,"com.noteflight.notation.view.LineNotationView");var kh=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i,n,r))).repeatEnding=i.notation,o}return c(e,Lh),p(e,null,[{key:"addRepeatEnding",value:function(t,i){var n=t.layoutContext.staffMetrics.repeatEndingBracketHeight/2,r=new Aa(i.position,i.startingText,n);uh.addMeasureText({context:t,measure:i.measure,notation:r,groupName:"Edit Repeat Ending Text",createFieldFunction:e.createRepeatEndingField,listenerNotation:i,transientNotation:!0})}},{key:"createRepeatEndingField",value:function(t,e,i,n){var r=t.layoutContext.staffMetrics.staffTextFont,o=uh.createEditField(t,My.LEFT,r,t.layoutContext.staffMetrics.chordSymbolSize,!1,!1,e,0,e.dy,i,"text");return o.multiline=!1,o.autoCommitChars=String.fromCharCode(13)+String.fromCharCode(9),o.addEventListener(Yy.VALUE_COMMIT,function(e){ll.isValidText(o.text)||t.controller.dispatchTipEvent(mt.INVALID_REPEAT_TEXT),n.startingText=o.text}),n.startingText="",o}}]),p(e,[{key:"calculateFontSize",value:function(){return this.staffMetrics.baseFontSize*this.staffMetrics.chordSymbolSize}},{key:"editText",value:function(){e.addRepeatEnding(this.context,this.repeatEnding)}},{key:"lineSettings",get:function(){var t,e=Lh.LINE_TYPE_SOLID,i=Lh.BRACKET_DOWN,n=this.staffMetrics.repeatEndingBracketTextYOffset;return this.lineNotation.type==ll.TYPE_INITIAL&&(t=Lh.BRACKET_DOWN),[e,t,i,"top",n]}}]),e}();r.registerClass(kh,"com.noteflight.notation.view.RepeatEndingView");var Th=function(t){function e(t,i,n,r,o,s){var a,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return y(this,e),(a=l(this,h(e).call(this))).x=t,a.y=i,null==u||u.printView||(a.graphics.lineStyle(Math.max(5,o),0,0),a.graphics.moveTo(0,0),a.graphics.lineTo(n,r)),a.graphics.lineStyle(o,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.moveTo(0,0),a.graphics.lineTo(n,r),a}return c(e,Wr),e}();r.registerClass(Th,"com.noteflight.notation.view.LineView");var Eh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._layout=null,n._decorationView=null,n._layout=i,n.initializeView(),n}return c(e,Ju),p(e,[{key:"updateStaffGeometry",value:function(t){this._decorationView.y=-this.toViewUnits(fs.lyricY(this.context.layoutContext,this.layout.startLyric,t,this.layout.startLyric.lyric))}},{key:"updateView",value:function(){for(;this.numChildren>0;)this.removeChildAt(0);this._decorationView=this.layout.decorationLayout.createDisplayObject(this.context),this.addChild(this._decorationView)}},{key:"layout",get:function(){return this._layout}}]),e}();r.registerClass(Eh,"com.noteflight.notation.view.LyricExtenderView");var Mh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i))).staffLayout=null,n}return c(e,uh),p(e,[{key:"editText",value:function(){var t=e.createLyricField(this.context,this.lyric,this.lyricLayout,this.staffLayout,null);""===this.lyric.text&&(this.lyric.text=" "),this.context.document.validateNow(),this.visible=!1;var i=this;t.addEventListener(Yy.VALUE_COMMIT,function(n){e.commitLyric(i.context,i.lyric,t),i.visible=!0})}},{key:"updateGeometry",value:function(){s(h(e.prototype),"updateGeometry",this).call(this),this.y=-this.toViewUnits(fs.lyricY(this.context.layoutContext,this.lyricLayout,this.staffLayout,this.lyric,!0))}},{key:"lyricLayout",get:function(){return A.as(this.layout,fs)}},{key:"lyric",get:function(){return this.lyricLayout.lyric}}],[{key:"addLyric",value:function(t,i,n,r){t.controller.document.undoHistory.openGroup("Add Lyrics");var o=null;i.lyrics.length>0&&(o=i.lyrics[0].direction);var s=new ul(" ",n,!1,!1,r,o);i.addLyric(s),t.document.validateNow();var a=e.createLyricField(t,s,null,null,null);a.addEventListener(Yy.VALUE_COMMIT,function(i){e.commitLyric(t,s,a)})}},{key:"commitLyric",value:function(t,e,i){var n=e.noteSet,r=!i.commitChar||i.commitChar==String.fromCharCode(27),o=i.commitChar&&i.commitChar==String.fromCharCode(13);if(null!=i.commitChar)for(o&&e.continued||(e.continued="-"==i.commitChar),o&&e.extend||(e.extend="_"==i.commitChar);e.text.length>0&&e.text.charAt(e.text.length-1)==i.commitChar;)e.text=e.text.substring(0,e.text.length-1);if(""===e.text&&(o||r)){if(t.controller.document.undoHistory.openGroupName="Remove Lyrics",null!=n&&n.removeLyric(e)," "!=i.commitChar)return}else e.text=e.text.replace(/\+/g," ");if(" "==i.commitChar||"-"==i.commitChar||"_"==i.commitChar){var s,a=null;null!=n&&(a=n.nextNoteSet(!0)),null!=a&&((s=a.getLyricAtLine(e.line))||a.addLyric(new ul(" ",e.line))),t.document.validateNow(),null!=a&&(null!=s?s.dispatchEvent(new Fi(Fi.EDIT)):(t.controller.selectNotation(a),t.documentController.addLyric(e.line,"-"==i.commitChar)))}else o&&(t.controller.selectNotation(n),t.documentController.addLyric(e.line+1))}},{key:"createLyricField",value:function(t,e,i,n,r){var o=uh.createEditField(t,My.CENTER,t.layoutContext.staffMetrics.lyricsFont,t.layoutContext.staffMetrics.lyricsSize,t.layoutContext.staffMetrics.lyricsBold,t.layoutContext.staffMetrics.lyricsItalic,e,1,fs.lyricY(t.layoutContext,i,n,e),r);return o.autoCommitChars=" -_"+String.fromCharCode(13)+String.fromCharCode(27),o}}]),e}();r.registerClass(Mh,"com.noteflight.notation.view.LyricView");var bh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._skin=null,n._overSkin=null,n.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(n)),n.addRollHighlight)),n.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(n)),n.removeRollHighlight)),n.addEventListener(li.MOUSE_DOWN,xt.bindMethod(u(u(n)),n.dontPropagate)),n.addEventListener(li.CLICK,xt.bindMethod(u(u(n)),n.handleMouseDown)),n._skin=t,n.addChild(n._skin),n._overSkin=i,n._overSkin.visible=!1,n.addChild(n._overSkin),n}return c(e,Wr),p(e,[{key:"removeListeners",value:function(){this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.removeRollHighlight)),this.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.dontPropagate)),this.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleMouseDown))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"addRollHighlight",value:function(t){this._skin.visible=!1,this._overSkin.visible=!0,t.stopPropagation()}},{key:"removeRollHighlight",value:function(t){this._skin.visible=!0,this._overSkin.visible=!1,t.stopPropagation()}},{key:"dontPropagate",value:function(t){t.stopPropagation()}},{key:"handleMouseDown",value:function(t){t.stopPropagation()}}]),e}();r.implementsInterfaces(bh,[wt]),r.registerClass(bh,"com.noteflight.notation.view.RollButton");var wh=function(t){function e(t,i){var n;y(this,e),(n=l(this,h(e).call(this,new dh,new dh)))._handle=t,n._measure=i;var r=t.handleHeight-7;return n.graphics.beginFill(11579568,1),n.graphics.drawCircle(8,r,5),n.graphics.endFill(),n.graphics.beginFill(16777215,1),n.graphics.drawRect(5.5,r/2+2.5,5,2),n.graphics.endFill(),n.graphics.beginFill(0,0),n.graphics.drawRect(0,0,t.handleHeight,t.handleHeight),n.graphics.endFill(),n}return c(e,bh),p(e,null,[{key:"DeleteMeasureIcon",get:function(){return xh},set:function(t){xh=t}},{key:"DeleteMeasureOverIcon",get:function(){return Ch},set:function(t){Ch=t}},{key:"_width",get:function(){return MeasureDeleter$_width},set:function(t){MeasureDeleter$_width=t}},{key:"_widthComputed",get:function(){return MeasureDeleter$_widthComputed},set:function(t){MeasureDeleter$_widthComputed=t}},{key:"_height",get:function(){return MeasureDeleter$_height},set:function(t){MeasureDeleter$_height=t}},{key:"_heightComputed",get:function(){return MeasureDeleter$_heightComputed},set:function(t){MeasureDeleter$_heightComputed=t}}]),p(e,[{key:"destroy",value:function(){s(h(e.prototype),"destroy",this).call(this),this._measure=null}},{key:"handleMouseDown",value:function(t){this._handle.dispatchEvent(new wi(wi.MEASURE_EDIT,wi.DELETE,this._measure)),s(h(e.prototype),"handleMouseDown",this).call(this,t)}},{key:"width",get:function(){return 14},set:function(t){}},{key:"height",get:function(){return 14},set:function(t){}}]),e}(),xh=null,Ch=null;r.registerClass(wh,"com.noteflight.notation.view.MeasureDeleter");var Nh=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t)))._textField=null,r._addBefore=null,r._addAfter=null,r._playFrom=null,r._playLoop=null,r._delete=null,r._breakObject=null,r._rolled=!1,r._rollEvent=null,r.aboutToBeActive=!1,r._layout=i,r._systemView=n,r._measureHandleMediator=r.context.registerMeasureView(u(u(r))),r.systemStaffMeasure=r.context.document.score.systemStaff.getMeasureAt(A.intToUint(r._layout.measure.index)),r.initializeView(),r.useHandCursor=!0,r.buttonMode=!0,Ec.useRolloverEvents?(r.addEventListener(li.CLICK,xt.bindMethod(u(u(r)),r.addRollHighlight)),r.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(r)),r.addRollHighlight)),r.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(r)),r.removeRollHighlight))):r.addEventListener(li.CLICK,xt.bindMethod(u(u(r)),r.handleClickAsRoll)),r}return c(e,Ju),p(e,null,[{key:"_lastRolled",get:function(){return Ah},set:function(t){Ah=t}}]),p(e,[{key:"removeListeners",value:function(){Ec.useRolloverEvents?(this.removeEventListener(li.CLICK,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.removeRollHighlight))):this.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClickAsRoll))}},{key:"destroyChildren",value:function(){this._addBefore&&(this._addBefore.destroy(),this.removeChild(this._addBefore)),this._addAfter&&(this._addAfter.destroy(),this.removeChild(this._addAfter)),this._delete&&(this._delete.destroy(),this.removeChild(this._delete)),this._playFrom&&(this._playFrom.destroy(),this.removeChild(this._playFrom)),this._playLoop&&(this._playLoop.destroy(),this.removeChild(this._playLoop)),this._breakObject&&this.removeChild(this._breakObject),this._textField&&(this._textField.destroy(),this.removeChild(this._textField))}},{key:"destroy",value:function(){this._measureHandleMediator.destroy(),this._systemView=null,this.systemStaffMeasure=null,s(h(e.prototype),"destroy",this).call(this)}},{key:"updateView",value:function(){this.destroyChildren();var t={model:this.measure,property:"measureNumber",editGroupName:"",markdown:!1,bold:this.measure.isMeasureNumberCustomized,underline:this.measure.isMeasureNumberCustomized};if(this._textField=new fc(this.context,My.LEFT,this.context.info.handleFont,this.context.info.handleTextSize/this.staffMetrics.baseFontSize,t),this.measure.isMeasureNumberCustomized&&this._textField.setColor(15357219),this._textField.width=this.handleWidth-2,this.addChild(this._textField),this.measure){this.context.controller.document.editable&&(this._addBefore=new Ih(this,this.measure,!1),this._addBefore.visible=!1,this._addBefore.y=this.context.info.measureInserterOffset,this.addChild(this._addBefore),this._addAfter=new Ih(this,this.measure,!0),this._addAfter.visible=!1,this._addAfter.y=this.context.info.measureInserterOffset,this.addChild(this._addAfter),this._addBefore.scaleX=this._addBefore.scaleY=this._addAfter.scaleX=this._addAfter.scaleY=this.context.info.inserterScale,this._delete=new wh(this,this.measure),this._delete.visible=!1,this._delete.x=0,this._delete.y=(this.context.info.measureHandleHeight-this._delete.height)/2,this.addChild(this._delete)),this.context.documentView.viewInfo.hidePlaybackControls||(this._playFrom=new Qh(this,this.measure),this._playFrom.visible=!1,this._playFrom.x=this._textField.width+4,this._playFrom.y=(this.context.info.measureHandleHeight-this._playFrom.height)/2,this.addChild(this._playFrom),this._playLoop=new Qh(this,this.measure,!0),this._playLoop.visible=!1,this._playLoop.x=this._playFrom.x+this.playButtonWidth,this._playLoop.y=(this.context.info.measureHandleHeight-this._playLoop.height)/2,this.addChild(this._playLoop));var e=this._layout.systemMeasureLayout.breakType;if(null!=e){var i,n;switch(e){case hl.PAGE_BREAK_TYPE:i=vr.PAGE_BREAK;break;case hl.SYSTEM_BREAK_TYPE:i=vr.SYSTEM_BREAK;break;case hl.KEEP_WITH_NEXT_TYPE:i=vr.KEEP_WITH_NEXT}i==vr.PAGE_BREAK||i==vr.SYSTEM_BREAK?(n=this.context.layoutContext.foundry.getBarline(i),this._breakObject=n.createDisplayObject(this.context.info),this._breakObject.x=this.handleWidth,this._breakObject.y=this.context.info.measureHandleHeight,this.addChild(this._breakObject)):i==vr.KEEP_WITH_NEXT&&(n=this.context.layoutContext.foundry.getKeepWithNext(),this._breakObject=n.createDisplayObject(this.context.info),this._breakObject.x=this.handleWidth,this._breakObject.y=this.context.info.measureHandleHeight,this.addChild(this._breakObject))}}}},{key:"focusMeasureNumber",value:function(t){this._textField.handleJSClick(t)}},{key:"updateStatus",value:function(){if(this.graphics.clear(),this.handleWidth<=0)this.removeChild(this._textField);else{this.visible=this._layout.showHandle;var t=!1,e=null;if(null!=this.context.document&&null!=this.measure){var i=this.context.document.selection;(A.is(i,Je)||A.is(i,Ke))&&null!=(e=A.as(i,Ke))&&(t=e.includes(this.measure))}if(this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,this.handleWidth,this.context.info.measureHandleMouseHeight),this.graphics.endFill(),t?this.graphics.beginFill(this.context.info.measureHighlightColor,this.context.info.measureHighlightAlpha):(this._rolled&&this.graphics.lineStyle(1,this.context.info.measureHandleHighlightColor),this.graphics.beginFill(this.context.info.handleColor,this.context.info.measureHandleAlpha)),this.graphics.drawRect(0,0,this.handleWidth-2,this.context.info.measureHandleHeight),this.graphics.endFill(),null!=e&&null!=this.context.document.dragHighlight){var n=this.context.document.dragHighlight.start;n.measureIndex==this._layout.measure.index?(this.graphics.lineStyle(2,this.context.info.dragHighlightInsertionPointColor),this.graphics.moveTo(-1,-2),this.graphics.lineTo(-1,this.context.info.measureHandleHeight+2)):n.measureIndex==this._layout.measure.index+1&&n.measureIndex==this.context.document.score.numMeasures&&(this.graphics.lineStyle(2,this.context.info.dragHighlightInsertionPointColor),this.graphics.moveTo(this.handleWidth+1,-2),this.graphics.lineTo(this.handleWidth+1,this.context.info.measureHandleHeight+2))}this._textField.width=this.handleWidth-2,null!=this._addBefore&&null!=this._addAfter&&(this._addBefore.visible=this._rolled,this._addAfter.visible=this._rolled,this._addAfter.x=this.handleWidth),null!=this._playFrom&&(this._playFrom.visible=this._rolled),null!=this._playLoop&&(this._playLoop.visible=this._rolled),null!=this._delete&&(this._delete.x=this.handleWidth-this.measureDeleterWidth-4,this._delete.visible=this._rolled),null!=this._breakObject&&(this._breakObject.x=this.handleWidth)}}},{key:"addRollHighlight",value:function(t){this._rollEvent=t,null!=e._lastRolled&&e._lastRolled!=this&&e._lastRolled.removeRollHighlight(t),e._lastRolled=this,this._rolled=!t.buttonDown,this.updateStatus(),t.type==li.ROLL_OVER&&t.stopPropagation()}},{key:"handleClickAsRoll",value:function(t){this.context.controller.isNotationInteractionAvailable()&&this.showControls()}},{key:"showControls",value:function(){null!=e._lastRolled&&e._lastRolled!=this&&(e._lastRolled._rolled=!1,e._lastRolled.updateStatus()),e._lastRolled=this,this._rolled=!0,this.updateStatus(),null!=this._systemView&&this._systemView.showHandles()}},{key:"removeRollHighlight",value:function(t){null!=this._rollEvent&&$c.isSyntheticMouseEvent(this._rollEvent,t)||(this._rolled=!1,this.aboutToBeActive=!1,this.updateStatus(),t.stopPropagation())}},{key:"updateMeasureIndex",value:function(){this._textField.text=this._layout.measure.measureNumber.toString()}},{key:"addAfter",get:function(){return this._addAfter}},{key:"active",get:function(){return this._rolled||this.aboutToBeActive}},{key:"layout",get:function(){return this._layout}},{key:"measure",get:function(){return this.context.document.score.systemStaff.getMeasureAt(A.intToUint(this._layout.measure.index))}},{key:"selected",get:function(){if(null==this.context.document)return!1;var t=this.context.document.selection;return A.is(t,Ke)&&t.includes(this.measure)}},{key:"handleHeight",get:function(){return this.context.info.measureHandleHeight}},{key:"handleWidth",get:function(){return this.toViewUnits(this._layout.constraint.layoutVector.length)}},{key:"measureDeleterWidth",get:function(){return this._delete?(0===this.context.cachedMeasureDeleterWidth&&(this.context.cachedMeasureDeleterWidth=this._delete.width),this.context.cachedMeasureDeleterWidth):0}},{key:"playButtonWidth",get:function(){return this._playFrom?(0===this.context.cachedPlayButtonWidth&&(this.context.cachedPlayButtonWidth=this._playFrom.width),this.context.cachedPlayButtonWidth):0}}]),e}(),Ah=null;r.registerClass(Nh,"com.noteflight.notation.view.MeasureHandle");var Ih=function(t){function e(t,i,n){var r;y(this,e),(r=l(this,h(e).call(this,new dh,new dh)))._handle=t,r._measure=i,r._addAfter=n,r.h=t.handleHeight-4;return r.w=3,r.graphics.beginFill(0,1),r.graphics.drawRect(-r.w/2,3,r.w,r.h),r.graphics.endFill(),r.graphics.beginFill(0,1),r.graphics.drawRect(-r.h/2,3+r.h/2-r.w/2,r.h,r.w),r.graphics.endFill(),r.graphics.beginFill(0,0),r.graphics.drawRect(0,0,t.handleHeight,t.handleHeight),r.graphics.endFill(),r}return c(e,bh),p(e,null,[{key:"AddMeasureIcon",get:function(){return Ph},set:function(t){Ph=t}},{key:"AddMeasureOverIcon",get:function(){return Oh},set:function(t){Oh=t}}]),p(e,[{key:"destroy",value:function(){s(h(e.prototype),"destroy",this).call(this),this._measure=null}},{key:"handleMouseDown",value:function(t){var i=this._addAfter?wi.ADD_AFTER:wi.ADD_BEFORE;this._handle.dispatchEvent(new wi(wi.MEASURE_EDIT,i,this._measure)),s(h(e.prototype),"handleMouseDown",this).call(this,t)}},{key:"right",get:function(){return Math.max(this._handle.handleHeight,this.w/2,this.h/2)}}]),e}(),Ph=null,Oh=null;r.registerClass(Ih,"com.noteflight.notation.view.MeasureInserter");var Qh=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,new dh,new dh)))._handle=t,r._measure=i,r._looping=n,r.render(),r}return c(e,bh),p(e,null,[{key:"PlayFromMeasureIcon",get:function(){return Rh},set:function(t){Rh=t}},{key:"PlayFromMeasureOverIcon",get:function(){return Dh},set:function(t){Dh=t}},{key:"_width",get:function(){return MeasurePlayer$_width},set:function(t){MeasurePlayer$_width=t}},{key:"_widthComputed",get:function(){return MeasurePlayer$_widthComputed},set:function(t){MeasurePlayer$_widthComputed=t}},{key:"_height",get:function(){return MeasurePlayer$_height},set:function(t){MeasurePlayer$_height=t}},{key:"_heightComputed",get:function(){return MeasurePlayer$_heightComputed},set:function(t){MeasurePlayer$_heightComputed=t}}]),p(e,[{key:"render",value:function(){var t=this.height,e=Math.min(t,7),i=Math.max(e,t-6),n=(t-i)/2;this._looping?(this.scaleX=.22,this.scaleY=.27,this.graphics.beginFill(6710872),this.graphics.svgPath("M42.69,13.88l-3.51-2.11v-.09H39L31.81,7.33v4.39l-11.54.06c-8.07,0-13.08,5-13.08,12.94v2.37h4.21V24.72c0-3.26,1.15-8.74,8.88-8.74l11.53-.06v4.51Z"),this.graphics.svgPath("M38.47,22.6V25c0,3.26-1.15,8.74-8.88,8.74l-11.53.06V29.25L7.18,35.8l3.51,2.11V38h.15l7.22,4.35V38l11.54-.06c8.07,0,13.08-5,13.08-12.94V22.6Z"),this.graphics.endFill()):(this.graphics.beginFill(15357219,1),this.graphics.moveTo(2,n),this.graphics.lineTo(2,n+i),this.graphics.lineTo(2+i,t/2),this.graphics.lineTo(2,n),this.graphics.endFill()),this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,t/this.scaleX,t/this.scaleY),this.graphics.endFill()}},{key:"destroy",value:function(){s(h(e.prototype),"destroy",this).call(this),this._measure=null}},{key:"handleMouseDown",value:function(t){this._handle.dispatchEvent(this.clickEvent),s(h(e.prototype),"handleMouseDown",this).call(this,t)}},{key:"width",get:function(){return this._handle.handleHeight},set:function(t){}},{key:"height",get:function(){return this._handle.handleHeight},set:function(t){}},{key:"clickEvent",get:function(){return new wi(wi.MEASURE_EDIT,this._looping?wi.PLAY_LOOP:wi.PLAY_BACK,this._measure)}}]),e}(),Rh=null,Dh=null;r.registerClass(Qh,"com.noteflight.notation.view.MeasurePlayer");var Fh=function(){function t(e){y(this,t),this._prefixes=[],this._measureIndex=NaN,this._measureIndex=e}return p(t,[{key:"justifyMeasureViews",value:function(){for(var t=0;t<this._prefixes.length;t++)this._prefixes[t].justifyMeasureView()}},{key:"addPrefix",value:function(t){this._prefixes.push(t)}},{key:"measureIndex",get:function(){return this._measureIndex}},{key:"prefixes",get:function(){return this._prefixes}},{key:"staffStartView",get:function(){for(var t=0;t<this._prefixes.length;t++)if(this._prefixes[t].isStaffStartView)return this._prefixes[t];return null}}]),t}();r.registerClass(Fh,"com.noteflight.notation.view.MeasurePrefixesView");var Uh=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t))).highlightEnabled=!0,r.isStaffStartView=!1,r._layout=null,r._staffView=null,r._staffLines=null,r._measureWaveform=null,r._notationViews=[],r._measureNumberView=null,r._barlineViews=[],r._labelViews=[],r._barlineUnscaledHeight=NaN,r._annotationViews=[],r._globalViews=[],r._entryNote=null,r._entryNoteSet=null,r._insertionPoint=null,r._insertionVoiceNumber=0,r._insertionNoteSet=null,r._highlightLeft=0,r._highlightRight=0,r._yStart=NaN,r._yEnd=NaN,r._barlineHeight=0,r._measureMask=null,r._backdropSprite=null,r._measureEditMediator=null,r._actualContent=null,r._state=e.SCORE,r._layout=i,r._staffView=n,r._measureMask=new Wr,r._measureMask.mouseEnabled=!1,r.mask=r._measureMask,r._measureEditMediator=r.context.registerMeasureView(u(u(r))),r.context.waveformController&&r.context.waveformController.addEventListener(en.WAVEFORM_UPDATE,xt.bindMethod(u(u(r)),r.handleWaveformUpdate)),r.initializeView(),r.mouseChildrenOnRoll(),r.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(r)),r.handleRollOut)),r._layout.addEventListener(Ni.UPDATE_MEASURE_INDEX,xt.bindMethod(u(u(r)),r.handleUpdateMeasureIndex)),r}return c(e,Ju),p(e,null,[{key:"MEASURE_MASK_SLOP",get:function(){return 4}},{key:"SCORE",get:function(){return"score"}},{key:"PLACEHOLDER",get:function(){return"placeholder"}}]),p(e,[{key:"updateStaffLayout",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._notationViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;A.is(s,Mh)&&(s.staffLayout=t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"removeListeners",value:function(){this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.handleRollOut)),this._layout.removeEventListener(Ni.UPDATE_MEASURE_INDEX,xt.bindMethod(this,this.handleUpdateMeasureIndex))}},{key:"destroyChildren",value:function(){for(var t=0;t<this._notationViews.length;t++)this._notationViews[t].destroy(),this._staffLines&&this._staffLines.removeChild(this._notationViews[t]);for(this._staffLines&&(this._staffLines.destroy(),this._actualContent.removeChild(this._staffLines),this._staffLines=null),this._measureWaveform&&(this._measureWaveform.destroy(),this._actualContent.removeChild(this._measureWaveform),this._measureWaveform=null),t=0;t<this._annotationViews.length;t++)this._annotationViews[t].destroy();for(t=0;t<this._globalViews.length;t++)this._globalViews[t].destroy();this.removeInsertionPoint(),this._backdropSprite&&this._actualContent.removeChild(this._backdropSprite)}},{key:"destroy",value:function(){this._measureEditMediator.destroy(),this.context.waveformController&&this.context.waveformController.removeEventListener(en.WAVEFORM_UPDATE,xt.bindMethod(this,this.handleWaveformUpdate))}},{key:"removeActualContent",value:function(){this._actualContent&&this.removeChild(this._actualContent)}},{key:"showPlaceholder",value:function(){this.removeActualContent()}},{key:"showScore",value:function(){this._actualContent&&-1==this.getChildIndex(this._actualContent)&&this.addChild(this._actualContent)}},{key:"updateView",value:function(){if(this.destroyChildren(),this._layout.validateLayout(),this.removeActualContent(),this._actualContent=new Wr,this.addChild(this._actualContent),this._backdropSprite=new Wr,this._actualContent.addChild(this._backdropSprite),!this.context.info.printView&&!A.is(this._layout,Ds)&&!A.is(this._layout,Xo)){var t=this._layout.getMeasurePositionX(0,!0,-1),e=this._layout.getMeasurePositionX(this.measure.duration-1,!0,-1);this._measureWaveform=new Vh(this.context,this.measure,t,e),this._actualContent.addChild(this._measureWaveform)}var i=this.measure.effectiveClef;this._staffLines=new _c(this.context,i.numLines,i.lineSpacing,this._layout.x,i.displayLineStartIndex,i.displayLineEndIndex,i.displayLineSpacing),this._staffLines.y=0,this._yStart=0-this.toViewUnits(i.staffHeight),this._yEnd=0,this._actualContent.addChild(this._staffLines),this._notationViews=[],this._barlineViews=[],this._annotationViews=[],this._globalViews=[],this._labelViews=[],this._measureNumberView=null;var n=[],r=!0,o=!1,s=void 0;try{for(var a,l=this._layout.notationLayouts[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;u instanceof Ko?n.push(u):this.updateChild(u)}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}for(var h=0;h<n.length;h++){var c=n[h];this.updateChild(c)}this.updateGeometry()}},{key:"wakeUpCachedMeasureView",value:function(){this.layout.updateMeasureIndex(),this.updateGeometry()}},{key:"updateChild",value:function(t){var e=t.createDisplayObject(this.context);if(A.is(t.notation,ja)&&(this._measureNumberView=e),this._staffLines.addChild(e),this._notationViews.push(e),A.is(e,Mh)&&(e.staffLayout=this._staffView.layout),A.is(t,Bo)){var i=Bo.getBarlineGlyphView(e);this.layout.bottomStaffInBarlineGroup&&(this._barlineViews.push(i),this._barlineUnscaledHeight=this.context.toViewUnits(A.unknownToType(t,Bo).barlineGlyphLayout.height))}if(this.layout.showAnnotations&&!this.context.info.printView){var n=!0,r=!1,o=void 0;try{for(var s,a=t.notation.allAnnotations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Ea),h=new nh(this.context,t,u);this._actualContent.addChild(h),this._annotationViews.push(h)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}}},{key:"updateGeometry",value:function(){if(null==this._staffLines)throw Error("this._staffLines should be non-null");this._layout.validateGlobalLayout(),this._staffLines.staffWidth=this._layout.x,this._staffLines.updateGeometry();var t=this._measureWaveform;if(t){var e=this._layout.getMeasurePositionX(0,!0,-1),i=this._layout.getMeasurePositionX(this.measure.duration-1,!0,-1);t.left=e,t.right=i,t.updateGeometry()}var n=!0,r=!1,o=void 0;try{for(var s,a=this._notationViews[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(this.updateChildGeometry(l),A.is(l.notation,Oa)||A.is(l.notation,Il)){var u=l.notation.rhythmPosition<=this.measure.duration/2,h=this._staffView.getMeasurePrefixesViewByMeasureIndex(this.measure.index);h&&h.staffStartView&&A.is(l.notation,Oa)?l.x=u?-h.staffStartView.width:this.width:l.x=u?0:this.width}else A.is(l.notation,Ka)&&A.unknownToType(l.notation,Ka).alignToLeftEdge&&(l.x=0)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}this.updateBarlineHeight();var c=null,d=!0,f=!1,y=void 0;try{for(var g,p=this._annotationViews[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var m=g.value,v=this.toViewUnits(m.notationLayout.x);null!=c&&(v=Math.max(v,c.x+c.width)),m.x=v,A.is(m.notationLayout,rs)?m.y=-this.toViewUnits(A.unknownToType(m.notationLayout,rs).clearExtrasTop(0)):m.y=this._yStart-this.toViewUnits(this.staffMetrics.staffSpacing/2),c=m}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}var _=!0,S=!1,L=void 0;try{for(var k,T=this._globalViews[Symbol.iterator]();!(_=(k=T.next()).done);_=!0){var E=k.value;this._actualContent.removeChild(E)}}catch(t){S=!0,L=t}finally{try{_||null==T.return||T.return()}finally{if(S)throw L}}this._globalViews=[];var M=!0,b=!1,w=void 0;try{for(var x,C=this._layout.globalLayouts[Symbol.iterator]();!(M=(x=C.next()).done);M=!0){var N=x.value;E=A.unknownToType(N,Ro).createDisplayObject(this.context),A.is(E,Eh)&&A.unknownToType(E,Eh).updateStaffGeometry(this._staffView.layout),this._actualContent.addChild(E),this._globalViews.push(E)}}catch(t){b=!0,w=t}finally{try{M||null==C.return||C.return()}finally{if(b)throw w}}}},{key:"justifyMeasureView",value:function(){this.layout.invalidateGlobal(),this.layout.validateGlobalLayout(),this.updateGeometry()}},{key:"updateBarlineHeight",value:function(){if(this.layout.bottomStaffInBarlineGroup){for(var t=this.measure.index,e=this._staffView.layout.startMeasureIndex,i=this._staffView.viewIndex;i>0;){var n=this._staffView.layout.systemLayout.getStaffLayoutAt(A.intToUint(i)).getMeasureLayoutAt(t-e);if(n&&n.topStaffInBarlineGroup)break;i--}var r=this._staffView.layout.systemLayout.getStaffLayoutAt(A.intToUint(i)),o=this._staffView.layout;this._barlineHeight=this.toViewUnits(o.distanceY-(r.distanceY-r.height));var s=!0,a=!1,l=void 0;try{for(var u,h=this._barlineViews[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;A.unknownToType(c,Rr).scaleY=(this._barlineHeight+this.toViewUnits(this.staffMetrics.lineThickness))/this._barlineUnscaledHeight}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}}},{key:"updateChildGeometry",value:function(t){if(t.layout){var e=this.layout.getLayoutForNotation(t.layout.notation);if(e){if(t.layout=e,e.centered){var i=this.layout.valueBounds;t.x=this.toViewUnits(i.x+(i.width-e.width)/2)}else t.x=this.toViewUnits(e.x);e.notation.parent&&t.updateGeometry()}}}},{key:"removeNoteEntryView",value:function(){null!=this.context.noteEntryView&&(this.context.noteEntryView.parent.removeChild(this.context.noteEntryView),this.context.noteEntryView=null),this._entryNote=null,this._entryNoteSet=null}},{key:"updateNoteEntryView",value:function(t,e,i){if(this.removeNoteEntryView(),null==this._staffLines)throw Error("this._staffLines should be non-null");if(null!=t&&A.is(t.notation,Sn)&&null!=t.notation.measure){var n=A.as(t.notation,Sn),r=t.clef,o=this.toViewUnits(t.leftX),s=this._staffLines.y,a=(s-e)/(this.staffMetrics.lineSpacing*r.lineSpacing),l=r.getLineNote(a,t.notation.measure);if(A.is(r,$l)){if(l.stringIndex>=0&&null!=n.noteOnString(l.stringIndex))return}else if(l=l.alter(this.measure.effectiveAlteration(n.position,l,n.voiceNumber)),!i&&n.hasDiatonicPitch(l.step,l.notatedOctave))return;l.enabled=!1,this._entryNote=l,this._entryNoteSet=n;var u=new Sn(this._entryNoteSet.position,[this._entryNote],mn.QUARTER,0);u.parent=this._entryNoteSet.parent,u.enabled=!1;var h=A.as(this._layout.createNotationLayout(u,r),_s);h.enableStem=!1,h.validateLayout();var c=A.as(t,_s);if(null!=c&&n.measure.numVoices>1&&(c.down&&h.minPitchLine>c.maxPitchLine||!c.down&&h.maxPitchLine<c.minPitchLine))return;this.context.noteEntryView=A.as(h.createDisplayObject(this.context),lh);var d=new If(o,s);this.context.noteEntryView.x=d.x,this.context.noteEntryView.y=d.y,this.context.noteEntryView.feedback=!0,this.context.noteEntryView.updateStatus(),this._staffLines.addChild(this.context.noteEntryView)}}},{key:"updateStatus",value:function(){if(s(h(e.prototype),"updateStatus",this).call(this),this.alpha=!this.context.info.printView&&this.context.document.editable&&this.measure.canHideStaff&&!A.is(this._layout,Xo)?this.context.info.hiddenMeasureAlpha:1,this.graphics.clear(),this.removeInsertionPoint(),this.removeNoteEntryView(),this._highlightLeft=this._highlightRight=0,null!=this._layout.systemMeasureLayout&&null!=this.context.document&&null!=this.context.document.selection&&!A.is(this._layout,Ds)&&this.context.controller.isNotationInteractionAvailable()){if(this.highlightEnabled&&this.context.document.selection.includes(this.measure))if(A.is(this.context.document.selection,Je)){var t=A.as(this.context.document.selection,Je),i=new gl(A.intToUint(this.measure.index),0),n=new gl(A.intToUint(this.measure.index),this.measure.duration);this._highlightLeft=t.start.compareTo(i)<=0?0:this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(t.start.position)),this._highlightRight=t.end.compareTo(n)>0?this.toViewUnits(this._layout.x):this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(t.end.position)),this.graphics.beginFill(this.context.info.measureHighlightColor,this.context.info.measureHighlightAlpha),this.graphics.drawRect(this._highlightLeft,this.highlightTop,this._highlightRight-this._highlightLeft,this.highlightHeight),this.graphics.endFill(),t.start.measureIndex==i.measureIndex&&this.measure.staff==t.staves[0]&&this.showInsertionPoint(t.start.position)}else if(A.is(this.context.document.selection,Ke)){var r=A.as(this.context.document.selection,Ke);r.includes(this.measure)&&(this._highlightLeft=0,this._highlightRight=this.measureWidth,r.startIndex==this.measure.index&&this.layout.topStaffOnSystem&&this.showInsertionPoint(0))}if(this.highlightEnabled&&null!=this.context.document.dragHighlight){if(this.context.document.dragHighlight.intersectsMeasure(this.measure))if(A.is(this.context.document.selection,Ke))this.layout.bottomStaffInBarlineGroup&&(this.graphics.lineStyle(2,this.context.info.dragHighlightInsertionPointColor,this.context.info.dragHighlightOutlineAlpha),this.graphics.moveTo(0,this.staffBottom),this.graphics.lineTo(0,this.staffBottom-this._barlineHeight));else{var o=this.context.document.dragHighlight;if(0===o.end.compareTo(o.start))this.showInsertionPoint(o.start.position,null,!0);else{var a=new gl(A.intToUint(this.measure.index),0),l=new gl(A.intToUint(this.measure.index),this.measure.duration),u=o.start.compareTo(a)<0,c=u?0:this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(o.start.position))-2,d=o.end.compareTo(l)>0,f=d?this.toViewUnits(this._layout.x):this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(o.end.position))-2;this.graphics.lineStyle(2,this.context.info.dragHighlightOutlineColor,this.context.info.dragHighlightOutlineAlpha),this.graphics.moveTo(c,this.highlightTop),this.graphics.lineTo(f-1,this.highlightTop),this.graphics.moveTo(c,this.highlightTop+this.highlightHeight),this.graphics.lineTo(f-1,this.highlightTop+this.highlightHeight),u||(this.graphics.moveTo(c,this.highlightTop),this.graphics.lineTo(c,this.highlightTop+this.highlightHeight)),d||(this.graphics.moveTo(f,this.highlightTop),this.graphics.lineTo(f,this.highlightTop+this.highlightHeight)),this.graphics.lineStyle()}}}else if(A.is(this.context.document.selection,qe)){var y=this.context.document.firstSelectedNoteSet;if(null!=y&&!y.grace){if(this.context.document.entryAfterSelection){var g=y.nextNoteSet(!0);if(null==g&&y.measure==this.measure)return void this.showInsertionPoint(this.measure.duration,y);y=g}null!=y&&y.measure==this.measure&&(this._highlightLeft=this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(y.position)),this._highlightRight=this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(y.position+y.duration)),this.showInsertionPoint(y.position,y))}}}}},{key:"acceptNoteEntry",value:function(t){var e,i=this._insertionPoint;if(null==i)return!1;if(this.measure.numNotations>=1&&A.is(this.measure.getNotationAt(0),Gl))return!0;e=t.target==this?new If(t.localX,t.localY):this.globalToLocal(new If(t.stageX,t.stageY));var n=this.toViewUnits(this.staffMetrics.mouseNoteEntrySlopWidth);return e.x>i.x&&e.x<i.x+n}},{key:"removeInsertionPoint",value:function(){null!=this._insertionPoint&&(this._backdropSprite.removeChild(this._insertionPoint),this._insertionPoint=null)}},{key:"showInsertionPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.context.info.testView&&this.context.controller.document.editable&&null==this._insertionPoint){var n,r=A.as(this._layout.measure.effectiveClef,$l);if(r&&A.is(this.context.controller.document.selection,qe)){var o=this.context.controller.document.stringIndex,s=this.toViewUnits(r.lineSpacing+this.context.info.tabInsertionPointExtension),a=this.staffTop-s/2;n=this.toViewUnits(o*r.lineSpacing)+a,this._insertionPoint=new vh(this.context,s,i)}else{var l,u=this.context.info.measureInsertionPointInset;n=this.highlightTop+this.toViewUnits(u),null!=e&&e.measure.numVoices>1?(this._insertionVoiceNumber=e.voiceNumber,l=0===this._insertionVoiceNumber?-this.toViewUnits(this.context.info.measureInsertionMultiVoiceOffset):this.toViewUnits(this.context.info.measureInsertionMultiVoiceOffset)):(this._insertionVoiceNumber=0,l=0),this._insertionNoteSet=e,this._insertionPoint=new vh(this.context,this.highlightHeight-this.toViewUnits(2*u),i,l)}var h=this._insertionPoint;null!=h&&(h.y=n,h.x=this.toViewUnits(this._layout.systemMeasureLayout.getMeasurePositionX(t)-this.context.info.measureInsertionPointPadding),this._backdropSprite.addChild(h))}}},{key:"handleRollOut",value:function(t){null!=t.relatedObject&&null==t.relatedObject.stage||this.removeNoteEntryView()}},{key:"handleWaveformUpdate",value:function(t){var e=this._measureWaveform;if(e&&this.measure.staff){var i=t.parts,n=this.measure.staff.part;i.indexOf(n)>=0&&e.updateGeometry()}}},{key:"updateMeasureNumberView",value:function(){if(this._measureNumberView){var t=this.layout.requiresMeasureNumber?this.measure.measureNumber.toString():"";this._measureNumberView.updateLabelNotationText(t)}}},{key:"handleUpdateMeasureIndex",value:function(t){this.updateMeasureNumberView()}},{key:"layout",get:function(){return this._layout},set:function(t){this._layout=t}},{key:"measure",get:function(){return this._layout.measure}},{key:"measureId",get:function(){return this._layout.measure.id}},{key:"systemMeasure",get:function(){return this.measure.isSystemMeasure?this.measure:this.measure.systemMeasure}},{key:"measureIndex",get:function(){return this.measure.index}},{key:"measureWidth",get:function(){return this.toViewUnits(this._layout.x)}},{key:"entryNote",get:function(){return this._entryNote}},{key:"entryNoteSet",get:function(){return this._entryNoteSet}},{key:"insertionNoteSet",get:function(){return this._insertionNoteSet}},{key:"entryVoiceNumber",get:function(){return this._insertionVoiceNumber}},{key:"mouseInStaff",get:function(){return null!=this._staffLines&&this._staffLines.mouseInStaff}},{key:"state",get:function(){return this._state},set:function(t){this._state!=t&&(t==e.PLACEHOLDER?this.showPlaceholder():t==e.SCORE&&this.showScore(),this._state=t)}},{key:"isPlaceholder",get:function(){return this._state==e.PLACEHOLDER}},{key:"staffTop",get:function(){return this._yStart}},{key:"staffBottom",get:function(){return this._yEnd}},{key:"highlightTop",get:function(){return this._yStart-this.toViewUnits(this.context.info.measureHighlightMargin)}},{key:"highlightHeight",get:function(){return this._yEnd-this._yStart+this.toViewUnits(2*this.context.info.measureHighlightMargin)}}]),e}();r.registerClass(Uh,"com.noteflight.notation.view.MeasureView");var Vh=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t))).measure=null,o.left=NaN,o.right=NaN,o.BRACKET_HEIGHT=36,o.BRACKET_WIDTH=5,o.BRACKET_CURVE=2,o.BRACKET_Y=-28,o.measure=i,o.left=n,o.right=r,o}return c(e,Ju),p(e,null,[{key:"MAX_BAR_HEIGHT",get:function(){return 10}},{key:"COLOR",get:function(){return 15973807}}]),p(e,[{key:"updateGeometry",value:function(){if(this.graphics.clear(),this.measure.staff){var t=this.measure.staff.part;if(t.showAudioWaveform){var e=t.firstRecordedAudioTrackForPlayback;e&&this.drawWaveform(this.graphics,e)}}}},{key:"drawWaveform",value:function(t,i){if(!(this.measure.staff.measures.indexOf(this.measure)<0)){var n=this.context.waveformController.temporalMap;if(null!=n){for(var r=this.measure.scorePosition,o=n.scorePositionToTime(r),s=n.scorePositionToTime(r+this.measure.duration),a=this.toViewUnits(this.left),l=this.toViewUnits(this.right)-a,u=Math.floor(l/3),h=s-o,c=h/u,d=[],f=[],y=0;y<u;y++)d.push(0),f.push(0);var g=[],p=[],m=i.audioClips;for(y=0;y<m.length;y++){var v=A.unknownToType(m[y],Ma),_=v.audioMedia.mediaFileData;if(_){for(var S,L=_.getChannelData(0),k=(_.sampleRate,v.trackStartTime),T=v.trackEndTime,E=0;E<u;E++){var M=o+c*E,b=M+c,w=M>k?M:k,x=b<T?b:T;if(w<x){var C=v.toMediaTime(w),N=v.toMediaTime(x),I=Math.floor(C*_.sampleRate),P=Math.floor(N*_.sampleRate);P>L.length&&(P=A.unknownToInt(L.length));for(var O=I;O<P;O++){var Q=A.unknownToNumber(L[O]);d[E]+=Q*Q,f[E]++}}}k>=o&&k<s&&h>0&&(S=a+l*((k-o)/h),g.push(S)),T>=o&&T<s&&h>0&&(S=a+l*((T-o)/h),p.push(S))}}var R=[];for(y=0;y<u;y++){var D=f[y]>0?Math.sqrt(d[y]/f[y]):0;R.push(D)}this.drawWaveformBars(t,R,a,3,2,this.toViewUnits(e.MAX_BAR_HEIGHT)),this.drawClipStarts(t,g),this.drawClipEnds(t,p)}}}},{key:"drawWaveformBars",value:function(t,i,n,r,o,s){t.beginFill(e.COLOR);for(var a=0;a<i.length;a++){var l=n+a*r,u=l+o,h=0-i[a]*s;t.moveTo(l,h),t.lineTo(u,h),t.lineTo(u,0),t.lineTo(l,0),t.lineTo(l,h)}t.endFill()}},{key:"drawClipStarts",value:function(t,i){for(var n=0;n<i.length;n++){var r=A.unknownToNumber(i[n]);t.lineStyle(1,e.COLOR),t.moveTo(r+this.BRACKET_WIDTH,this.BRACKET_Y),t.lineTo(r+this.BRACKET_CURVE,this.BRACKET_Y),t.curveTo(r,this.BRACKET_Y,r,this.BRACKET_Y+this.BRACKET_CURVE),t.lineTo(r,this.BRACKET_Y+this.BRACKET_HEIGHT-this.BRACKET_CURVE),t.curveTo(r,this.BRACKET_Y+this.BRACKET_HEIGHT,r+this.BRACKET_CURVE,this.BRACKET_Y+this.BRACKET_HEIGHT),t.lineTo(r+this.BRACKET_WIDTH,this.BRACKET_Y+this.BRACKET_HEIGHT)}}},{key:"drawClipEnds",value:function(t,i){for(var n=0;n<i.length;n++){var r=A.unknownToNumber(i[n]);r-=1,t.lineStyle(1,e.COLOR),t.moveTo(r-this.BRACKET_WIDTH,this.BRACKET_Y),t.lineTo(r-this.BRACKET_CURVE,this.BRACKET_Y),t.curveTo(r,this.BRACKET_Y,r,this.BRACKET_Y+this.BRACKET_CURVE),t.lineTo(r,this.BRACKET_Y+this.BRACKET_HEIGHT-this.BRACKET_CURVE),t.curveTo(r,this.BRACKET_Y+this.BRACKET_HEIGHT,r-this.BRACKET_CURVE,this.BRACKET_Y+this.BRACKET_HEIGHT),t.lineTo(r-this.BRACKET_WIDTH,this.BRACKET_Y+this.BRACKET_HEIGHT)}}}]),e}();r.registerClass(Vh,"com.noteflight.notation.view.MeasureWaveformView");var Bh=function(t){function e(t,i,n,r,o,s){var a;return y(this,e),(a=l(this,h(e).call(this))).x=t,a.y=i,a.graphics.lineStyle(o.lineSpacing,0,s,!1,yf.NORMAL,Lr.NONE,kr.MITER),a.graphics.moveTo(0,-.5*o.lineThickness),a.graphics.lineTo(n,-.5*o.lineThickness),a}return c(e,Wr),e}();r.registerClass(Bh,"com.noteflight.notation.view.MultiRestView");var Hh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._liaisonSprite=null,n}return c(e,lh),p(e,[{key:"updateView",value:function(){this.destroyChildren(),this._notationViews=[],s(h(e.prototype),"updateView",this).call(this);for(var t=A.unknownToType(this.layout,_s),i=0;i<t.numNoteLayouts;i++){var n=new lh(this.context,t.getNoteLayoutAt(i));this.addChild(n),this._notationViews.push(n)}}},{key:"updateGeometry",value:function(){s(h(e.prototype),"updateGeometry",this).call(this),this.updateLiaisonGeometry()}},{key:"destroyChildren",value:function(){if(this._notationViews)for(var t=0;t<this._notationViews.length;t++)this._notationViews[t].destroy()}},{key:"updateLiaisonGeometry",value:function(){null!=this._liaisonSprite&&this._liaisonSprite.parent==this&&this.removeChild(this._liaisonSprite);var t,e=A.unknownToType(this.layout,_s),i=e.determineLiaisons(),n=0===e.noteSet.position&&!e.noteSet.previousGraceNote&&e.noteSet.liaisonEnd&&(e.measureLayout.firstLayoutOnSystem||e.measureLayout.measure.allowIncomingLiaisons);if(i||n)if(this._liaisonSprite=new Wr,this.addChild(this._liaisonSprite),n&&this.drawLiaisonContinuations(e,e.leftX),null!=e.liaisonEndLayout){if(e.liaisonEndLayout.measureLayout!=e.measureLayout){if(e.measureLayout.lastLayoutOnSystem||!e.noteSet.measure.flowsToNextMeasure)return t=e.measureLayout.x-e.x,void this.drawLiaisons(e,null,t);t=e.measureLayout.x-e.x+e.liaisonEndLayout.x}else t=e.liaisonEndLayout.x-e.x;this.drawLiaisons(e,A.as(e.liaisonEndLayout,_s),t)}else t=e.measureLayout.x-e.x,this.drawLiaisons(e,null,t)}},{key:"drawLiaisons",value:function(t,e,i){var n=!t.multiVoice&&1==t.noteSet.notes.length&&(null==e||1==e.noteSet.notes.length),r=t.noteSet.liaisonCount,o=0,s=[],a=t.measureLayout.measure.effectiveClef.showRhythm(this.context.layoutContext.score),l=t.noteSet.hasArticulation(Sn.LV_TIE_ARTICULATION),u=!0,h=!1,c=void 0;try{for(var d,f=t.noteLayouts[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y,g=d.value,p=A.unknownToType(g,ms),m=p.note.liaison;if(l){var v=this.context.toViewUnits(t.context.staffMetrics.maxLvTieWidth),_=Math.min(i,v);r=p.note.noteSet.notes.length,(y=$o.createLiaisonLayout(p.note)).setLiaisonInfo(t,p,null,null,n,_,o,r)}else{if(null==m||!a&&m==de.TIE_LIAISON&&0===p.note.cumulativeBend)continue;var S=null;if(null!=e){if(!a&&e.noteSet.invisible)continue;var L=!0,k=!1,T=void 0;try{for(var E,M=e.noteLayouts[Symbol.iterator]();!(L=(E=M.next()).done);L=!0){var b=E.value,w=A.unknownToType(b,ms);if(w.note.liaisonStartNote==p.note){S=w;break}}}catch(t){k=!0,T=t}finally{try{L||null==M.return||M.return()}finally{if(k)throw T}}null==S&&(e=null)}m!=de.TIE_LIAISON||t.context.staffMetrics.tieSingleNoteEnabled||(n=!1),(y=$o.createLiaisonLayout(p.note)).setLiaisonInfo(t,p,e,S,n,i,o,r)}s.push(y),o++}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}this.addLiaisonViews(s)}},{key:"drawLiaisonContinuations",value:function(t,e){var i=!t.multiVoice&&1==t.noteSet.notes.length,n=t.noteSet.liaisonEndCount,r=0,o=[],s=t.measureLayout.measure.effectiveClef.showRhythm(this.context.layoutContext.score),a=t.measureLayout.firstLayoutOnSystem,l=!0,u=!1,h=void 0;try{for(var c,d=t.noteLayouts[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f,y=c.value,g=A.unknownToType(y,ms),p=null,m=g.note;if(null!=m.incomingLiaison)f=(p=A.as(m.clone(),de)).liaison=m.incomingLiaison;else{if(null==(p=m.liaisonStartNote)||null==p.measure||null==p.measure.staff||!p.measure.flowsToNextMeasure||p.liaisonEndNote!=m&&null!=p.liaisonEndNote||!a)continue;f=p.liaison}if(null!=f&&(s||f!=de.TIE_LIAISON)){f!=de.TIE_LIAISON||t.context.staffMetrics.tieSingleNoteEnabled||(i=!1);var v=$o.createLiaisonLayout(p);v.setLiaisonInfo(null,null,t,g,i,e,r,n),o.push(v),r++}}}catch(t){u=!0,h=t}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}this.addLiaisonViews(o)}},{key:"addLiaisonViews",value:function(t){if(t.length>0){$o.adjustLiaisonSpacing(t);var e=!0,i=!1,n=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,$o).createLiaisonView();null!=a&&this._liaisonSprite.addChild(a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.updateStatus()}}}]),e}();r.registerClass(Hh,"com.noteflight.notation.view.NoteSetView");var $h=function(t){function e(t,i,n,r){var o;return y(this,e),(o=l(this,h(e).call(this,t,i.notation)))._layout=i,o._notation=i.notation,o.startX=n,o.startY=r,o._effectMediator=t.registerEffectView(u(u(o))),o.initializeView(),o}return c(e,ih),p(e,null,[{key:"WAVY_SPACING_ADJUSTMENT",get:function(){return-1.6}}]),p(e,[{key:"addHandle",value:function(t,e,i){var n=new gc(this.context);this._notation.wavyType?(n.rotation=-this._notation.rotation*(180/Math.PI),n.y=0,n.x=A.is(i,Be)?Math.sqrt(Math.pow(t,2)+Math.pow(e,2))+this.toViewUnits(1):t):(n.y=e,n.x=t),this._handles.push(n),this._children[0].addChild(n),n.addEventListener(li.MOUSE_DOWN,xt.bindMethod(i,i.handleMouseDown))}},{key:"destroyChildren",value:function(){this.removeHandles()}},{key:"updateSelectionFeedback",value:function(){null!=this.context.document&&this.context.document.isModelEditable(this._notation)&&(this.selected&&0==this._handles.length?(this.addHandle(this.toViewUnits(this._layout.shift),this.toViewUnits(this._layout.ascent),new Be(this.context,this._notation,this)),this.addHandle(0,0,new Ve(this.context,this._notation,this))):this.selected||this.removeHandles())}},{key:"removeHandles",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._handles[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,wt);this._children[0].removeChild(A.as(s,Rr)),s.destroy()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._handles=[]}},{key:"destroy",value:function(){this._effectMediator.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"layout",get:function(){return this._layout}},{key:"notation",get:function(){return this._notation}},{key:"selected",get:function(){return null!=this.context.document&&null!=this.context.document.selection&&(!!this.context.document.selection.includes(this._notation)&&A.is(this.context.document.selection,qe))}},{key:"spacingXAdjustment",get:function(){return this.toViewUnits(e.WAVY_SPACING_ADJUSTMENT)/6}}]),e}();r.registerClass($h,"com.noteflight.notation.view.EffectView");var Gh=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r))}return c(e,$h),p(e,[{key:"updateView",value:function(){switch(this._notation.type){case xn.RIP1:var t=this.layout._context.foundry.getLineNotationSegment(xn.RIP1),e=new xr([],this.spacingXAdjustment+t.spacingX),i=Math.max(this.toViewUnits(Math.sqrt(Math.pow(this.layout.shift,2)+Math.pow(this.layout.ascent,2))),t.width+t.spacingX);e.addRepeatingGlyph(t,i);var n=e.createDisplayObject(this.context.info);n.x=this.toViewUnits(this.startX),n.y=this.toViewUnits(this.startY),n.rotation=this._notation.rotation*(180/Math.PI),this.addChild(n);break;case xn.RIP2:this.addChild(new Th(this.toViewUnits(this.startX),this.toViewUnits(this.startY),this.toViewUnits(-this.layout.width),this.toViewUnits(this.layout.ascent),this.toViewUnits(this.layout.staffMetrics.slideThickness),this.layout.staffMetrics))}}}]),e}();r.registerClass(Gh,"com.noteflight.notation.view.RipView");var Yh=function(t){function e(t,i,n,r){return y(this,e),l(this,h(e).call(this,t,i,n,r))}return c(e,$h),p(e,[{key:"updateView",value:function(){switch(this._notation.type){case xn.FALL1:var t=this.layout._context.foundry.getLineNotationSegment(xn.FALL1),e=new xr([],this.spacingXAdjustment+t.spacingX),i=Math.max(this.toViewUnits(Math.sqrt(Math.pow(this.layout.shift,2)+Math.pow(this.layout.ascent,2))),t.width+t.spacingX);e.addRepeatingGlyph(t,i);var n=e.createDisplayObject(this.context.info);n.x=this.toViewUnits(this.startX),n.y=this.toViewUnits(this.startY),n.rotation=this._notation.rotation*(180/Math.PI),this.addChild(n);break;case xn.FALL2:this.addChild(new Th(this.toViewUnits(this.startX),this.toViewUnits(this.startY),this.toViewUnits(this.layout.width),this.toViewUnits(this.layout.ascent),this.toViewUnits(this.layout.staffMetrics.slideThickness),this.layout.staffMetrics))}}}]),e}();r.registerClass(Yh,"com.noteflight.notation.view.FallView");var zh=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t)))._layout=null,r._viewIndex=0,r._staffStartView=null,r._measureViews=[],r._cautionaryView=null,r._endSprite=null,r._hyphenViews=[],r._measurePrefixesViews={},r._hyphenWidth=0,r._measuresInMemory={},r._layout=i,r._viewIndex=n,!r.context.info.printView&&A.is(i.staffStartLayout.measure.effectiveClef,$l)&&r.context.controller.document.editable&&(r.mouseChildren=!1,r.addEventListener(li.MOUSE_UP,xt.bindMethod(u(u(r)),r.tabEditingDisallowed))),i.addEventListener(Ti.HYPHENS_UPDATED,xt.bindMethod(u(u(r)),r.handleHyphensUpdated)),r.initializeView(),r}return c(e,Ju),p(e,[{key:"removeListeners",value:function(){!this.context.info.printView&&A.is(this.layout.staffStartLayout.measure.effectiveClef,$l)&&this.context.controller.document.editable&&this.removeEventListener(li.MOUSE_UP,xt.bindMethod(this,this.tabEditingDisallowed)),this.layout.removeEventListener(Ti.HYPHENS_UPDATED,xt.bindMethod(this,this.handleHyphensUpdated))}},{key:"destroyChildren",value:function(){this._staffStartView&&this._staffStartView.destroy(),this._cautionaryView&&this._cautionaryView.destroy()}},{key:"removeMeasure",value:function(t){var e=[],i=this.getMeasurePrefixesViewAt(t);if(i)for(var n=i.prefixes,r=0;r<n.length;r++)this.removeChild(n[r].mask),this.removeChild(n[r]),e.push(n[r]);return this.removeChild(this._measureViews[t].mask),this.removeChild(this._measureViews[t]),e.concat(this._measureViews.splice(t,1)),e}},{key:"truncateMeasureViewsStartingAt",value:function(t){for(var e=this._measureViews.length-1;e>=A.numberToInt(t);e--)this.removeMeasure(t)}},{key:"updateLayoutToMeasureViews",value:function(){for(var t=0;t<this._measureViews.length;t++)this._measureViews[t].updateStaffLayout(this.layout)}},{key:"handleHyphensUpdated",value:function(t){this.score.isStripMode?this.updateGeometry():this.updateView()}},{key:"getMeasureViewAt",value:function(t){return A.as(this._measureViews[t],Uh)}},{key:"getMeasureXPosition",value:function(t){return this.numMeasureViews-1<t?0:this._measureViews[t].x}},{key:"getMeasureIndexAtPosition",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=A.numberToInt(e);i<this.numMeasureViews-1;i++)if(this._measureViews[i].x>=t)return this._measureViews[i].measureIndex;return this.lastDrawnMeasure.measureIndex}},{key:"hideMeasure",value:function(t){this._measureViews[t].state=Uh.PLACEHOLDER}},{key:"showHiddenMeasure",value:function(t){this._measureViews[t].state=Uh.SCORE}},{key:"updateMeasureAt",value:function(t){this.updatePrefixes(t),this.updateMeasureViewAt(t)}},{key:"updatePrefixes",value:function(t){var e=this._layout.getMeasurePrefixesLayoutAt(t);if(e){var i=e.prefixes,n=this.getMeasurePrefixesViewAt(t);if(n)for(var r=n.prefixes,o=0;o<r.length;o++)r[o].destroy(),this.removeChild(r[o].mask),this.removeChild(r[o]),r[o]=i[o].createMeasureView(this.context,this),this.addChild(r[o]),this.addChild(r[o].mask)}}},{key:"updateMeasureViewAt",value:function(t){var e=this._layout.getMeasureLayoutAt(t).measure.id,i=this.context.getGlobalMeasureView(e,this.staffId),n=this.getMeasureViewAt(t);i?(i.layout=this.layout.getMeasureLayoutAt(t),i.layout.handleMeasureSequenceChange(),this._measureViews[t]=i,this.addChild(i),this.addChild(i.mask),i.updateGeometry()):null!=n&&(this.removeChild(n.mask),this.removeChild(n),n=this._layout.getMeasureLayoutAt(t).createMeasureView(this.context,this),this._measureViews[t]=n,this.addChild(n),this.addChild(n.mask),this.context.setGlobalMeasureView(n.measureId,this.staffId,n))}},{key:"justifyMeasureAt",value:function(t){var e=this._measureViews[t];if(e){var i=this.getMeasurePrefixesViewAt(t);i&&i.justifyMeasureViews(),e.justifyMeasureView()}t==this._measureViews.length-1&&null!=this._cautionaryView&&this._cautionaryView.updateGeometry()}},{key:"measureViewWidthAt",value:function(t){return 0===t||this.numMeasureViews-1==t?this._measureViews[t].width:this.numMeasureViews>t+1?this._measureViews[t+1].x-this._measureViews[t].x:0}},{key:"getMeasurePositionX",value:function(t){return t>=this._measureViews.length?0:this.getMeasureViewAt(t).x}},{key:"getPositionXInStaff",value:function(t,e){var i=this.getMeasureViewAt(t-this.layout.startMeasureIndex);return i?this.getMeasurePositionX(t-this.layout.startMeasureIndex)+this.toViewUnits(i.layout.getMeasurePositionX(e,!1,-1)):0}},{key:"createHyphen",value:function(t){var e=A.as(t.createDisplayObject(this.context),mh);return e.updateStaffGeometry(this._layout),this.addChild(e),this._hyphenViews.push(e),e}},{key:"placeHyphens",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=A.as(t.createDisplayObject(this.context),mh);0===this._hyphenWidth&&(this._hyphenWidth=r.width);for(var o=this._hyphenWidth+this.toViewUnits(this.layout.context.staffMetrics.hyphensMinPadding),s=i-e,a=this.layout.context.staffMetrics.showMultipleHyphens?Math.floor(s/o):1,l=s/(a=Math.max(1,a)),u=e+(l-this._hyphenWidth)*n,h=0;h<a;h++)(r=this.createHyphen(t)).x=u,u+=l}},{key:"createHyphensBetweenTwoLyrics",value:function(t){var e=this.getPositionXInStaff(A.numberToInt(t.startHyphenMeasureIndex),A.numberToInt(t.startHyphenMeasurePosition))+this.toViewUnits(t.lyricRightBound),i=this.getPositionXInStaff(A.numberToInt(t.endHyphenMeasureIndex),A.numberToInt(t.endHyphenMeasurePosition))+this.toViewUnits(t.lyricLeftBound);e<i&&this.placeHyphens(t,e,i,.5)}},{key:"createHyphensFromTheBeginningOfTheStaff",value:function(t){var e=this.getPositionXInStaff(A.numberToInt(t.startHyphenMeasureIndex),0),i=this.getPositionXInStaff(A.numberToInt(t.endHyphenMeasureIndex),A.numberToInt(t.endHyphenMeasurePosition))+this.toViewUnits(t.lyricLeftBound);this.placeHyphens(t,e,i,0)}},{key:"haveMeasureLayoutsBeenLoaded",value:function(t){return t.startHyphenMeasureIndex<=this.layout.endMeasureIndex}},{key:"createHyphensUntilTheEndOfTheMeasure",value:function(t){if(this.haveMeasureLayoutsBeenLoaded(t)){var e=this.getPositionXInStaff(A.numberToInt(t.startHyphenMeasureIndex),A.numberToInt(t.startHyphenMeasurePosition))+this.toViewUnits(t.lyricRightBound),i=this.getPositionXInStaff(A.numberToInt(t.endHyphenMeasureIndex),A.numberToInt(t.endHyphenMeasurePosition));0!==i&&this.placeHyphens(t,e,i,1)}}},{key:"updateView",value:function(){this.destroyChildren(),this.truncateMeasureViewsStartingAt(0);var t=!0,e=!1,i=void 0;try{for(var n,r=this._hyphenViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this.removeChild(o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}if(this._measurePrefixesViews={},this._hyphenViews=[],this._measureViews=[],this.context.info.displayMode!=Nl.STRIP_DISPLAY){for(var s=0;s<this._layout.measureLayouts.length;s++){var a=this._layout.measureLayouts[s].measure;this.createMeasurePrefixesViewsAt(a.index),this.createMeasureViewAt(s,!1)}this._staffStartView=this._measurePrefixesViews[0].prefixes[0],null!=this._layout.cautionaryLayout&&(this._cautionaryView=this._layout.cautionaryLayout.createMeasureView(this.context,this),this.addChild(this._cautionaryView),this.addChild(this._cautionaryView.mask))}this.updateGeometry()}},{key:"positionEndSprite",value:function(t){null==this._endSprite&&(this._endSprite=new Wr,this._endSprite.graphics.beginFill(16711680,0),this._endSprite.graphics.drawRect(0,0,2,2),this.addChild(this._endSprite)),this._endSprite.x=t}},{key:"createMeasurePrefixesViewsAt",value:function(t){var e=new Fh(t);this._measurePrefixesViews[t-this._layout.startMeasureIndex]=e;var i=this.score.getMeasureByIndexAndStaffIndex(t,this.staffIndex),n=this._layout.getMeasurePrefixesLayoutByMeasureIndex(t);if(n){var r=0,o=!0,s=!1,a=void 0;try{for(var l,u=n.prefixes[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=null,d=this.context.getGlobalMeasureView(i.id,this.staffId,{isMeasurePrefix:!0,measurePrefixIndex:r});d?(c=d).wakeUpCachedMeasureView():(c=h.createMeasureView(this.context,this),this.context.setGlobalMeasureView(i.id,this.staffId,c,{isMeasurePrefix:!0,measurePrefixIndex:r})),this.addChild(c),this.addChild(c.mask),e.addPrefix(c),r++}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}}},{key:"createMeasureViewAt",value:function(t,e){var i=this._layout.getMeasureLayoutAt(t),n=i.measure;if(i){if(e){this._layout.validateMeasureLayout(i);var r=this._layout.getMeasureLayoutAt(t+1);null!=r&&this._layout.validateMeasureLayout(r)}var o=this.context.getGlobalMeasureView(n.id,this.staffId),s=null;o?(o.layout=this.layout.getMeasureLayoutAt(n.index-this.layout.startMeasureIndex),(s=o).wakeUpCachedMeasureView()):(s=i.createMeasureView(this.context,this),this.context.setGlobalMeasureView(s.measureId,this.staffId,s)),this._measureViews[t]=s,this.addChild(this._measureViews[t]),this.addChild(this._measureViews[t].mask),s.updateGeometry()}}},{key:"updateGeometry",value:function(){s(h(e.prototype),"updateGeometry",this).call(this),this.arrangeMeasures(),this.arrangeHyphens()}},{key:"updateMeasureGeometry",value:function(){for(var t=0;t<this._measureViews.length;t++){this.getMeasureViewAt(t).updateGeometry()}}},{key:"updateBarlineHeight",value:function(){for(var t=0;t<this._measureViews.length;t++){this.getMeasureViewAt(t).updateBarlineHeight()}}},{key:"getMeasurePrefixesViewAt",value:function(t){return this._measurePrefixesViews[t]}},{key:"getMeasurePrefixesViewByMeasureIndex",value:function(t){return this.getMeasurePrefixesViewAt(t-this.layout.startMeasureIndex)}},{key:"arrangeMeasures",value:function(){for(var t=0,e=0;e<this._measureViews.length;e++){var i=this.getMeasureViewAt(e),n=this.getMeasurePrefixesViewAt(e);if(n){var r=!0,o=!1,s=void 0;try{for(var a,l=n.prefixes[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;u.x=t,t+=u.measureWidth}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}i.x=t,i.mask.x=t,t+=i.measureWidth}null!=this._cautionaryView&&(this._cautionaryView.x=t,this._cautionaryView.mask.x=t)}},{key:"arrangeHyphens",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._hyphenViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this.removeChild(o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._hyphenViews=[];var s=!0,a=!1,l=void 0;try{for(var u,h=this._layout.hyphens[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;c.startMeasureExists&&(c.beginningOfStaff?this.createHyphensFromTheBeginningOfTheStaff(c):c.endOfMeasure?this.createHyphensUntilTheEndOfTheMeasure(c):c.endLyricLayout&&c.betweenLyrics&&this.createHyphensBetweenTwoLyrics(c))}}catch(t){a=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(a)throw l}}}},{key:"tabEditingDisallowed",value:function(t){}},{key:"layout",get:function(){return this._layout}},{key:"staffIndex",get:function(){return this._layout.staff.index}},{key:"viewIndex",get:function(){return this._viewIndex}},{key:"staffId",get:function(){return this._layout.staff.id}},{key:"score",get:function(){return this._layout.score}},{key:"lastDrawnMeasure",get:function(){return this._measureViews[this._measureViews.length-1]}},{key:"numMeasureViews",get:function(){return this._measureViews.length}},{key:"staffStartViews",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=xt.objectForOfSource(this._measurePrefixesViews)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value.staffStartView;s&&t.push(s)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}}]),e}();r.registerClass(zh,"com.noteflight.notation.view.StaffView");var Wh=function(t){function e(t,i,n){return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,zh),p(e,[{key:"updateMeasureAt",value:function(t){this.updatePrefixes(t)}},{key:"updateView",value:function(){this.destroyChildren(),this._measurePrefixesViews={},this.createMeasurePrefixesViewsAt(0),this._staffStartView=this._measurePrefixesViews[0].prefixes[0]}},{key:"lastDrawnMeasure",get:function(){return this.getMeasurePrefixesViewAt(0).prefixes[0]}}]),e}();r.registerClass(Wh,"com.noteflight.notation.view.OverlayStaffView");var Xh=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._layout=null,n._staffViews=[],n._spanViews=[],n._measureHandles=[],n._staffHandles=[],n._backdropSprite=null,n._partLabels=[],n._fullHeightViews=[],n._handleAlpha=0,n._rollEvent=null,n.HANDLE_ANIMATION_TIME_CONSTANT=3,n.MAX_MEASURES_TO_LOAD=50,n.isIncrementalFlowComplete=!1,n._measuresInMemory={},n._layout=i,n._layout.addEventListener(bi.DISPLAY,xt.bindMethod(u(u(n)),n.handleMeasureDisplay),!1,0,!0),n._layout.addEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(u(u(n)),n.handleMeasureGeometryChange),!1,0,!0),n._layout.addEventListener(bi.SPAN_CHANGE,xt.bindMethod(u(u(n)),n.handleMeasureSpanChange),!1,0,!0),n._layout.addEventListener(bi.UPDATE_MEASURE_HANDLE_INDEX,xt.bindMethod(u(u(n)),n.handleUpdateMeasureHandleIndex),!1,0,!0),n.initializeView(),t.info.printView||t.info.testView||(Ec.useRolloverEvents?(n.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(n)),n.handleRollOut)),n._backdropSprite.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(n)),n.handleRollOut)),n.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(n)),n.handleRollOver)),n._backdropSprite.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(n)),n.handleRollOver)),n.addEventListener(li.CLICK,xt.bindMethod(u(u(n)),n.handleRollOver)),n.addEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(u(u(n)),n.handleRemovedFromStage))):n.addEventListener(li.CLICK,xt.bindMethod(u(u(n)),n.handleClickAsRoll))),t.info.printView||(n.context.document.score.systemStaff.addEventListener(Fi.SYSTEM_STATUS_CHANGE,xt.bindMethod(u(u(n)),n.handleStatusChange),!1,0,!0),n.context.document.score.systemStaff.addEventListener(Fi.FOCUS_MEASURE_NUMBER,xt.bindMethod(u(u(n)),n.handleFocusMeasureNumber),!1,0,!0)),n}return c(e,sh),p(e,null,[{key:"_lastRolled",get:function(){return Kh},set:function(t){Kh=t}},{key:"ONE",get:function(){return"one"}},{key:"UP_TO_SCROLL_POS",get:function(){return"upToScrollPos"}},{key:"EVERYTHING",get:function(){return"everything"}},{key:"RECALCULATE_AVG_MEASURE_WIDTH",get:function(){return 40}}]),p(e,[{key:"removeListeners",value:function(){this._layout.removeEventListener(bi.DISPLAY,xt.bindMethod(this,this.handleMeasureDisplay)),this._layout.removeEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureGeometryChange)),this._layout.removeEventListener(bi.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureSpanChange)),this._layout.removeEventListener(bi.UPDATE_MEASURE_HANDLE_INDEX,xt.bindMethod(this,this.handleUpdateMeasureHandleIndex)),this.context.info.printView||this.context.info.testView||(Ec.useRolloverEvents?(this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.handleRollOut)),this._backdropSprite.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.handleRollOut)),this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.handleRollOver)),this._backdropSprite.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.handleRollOver)),this.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleRollOver))):this.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClickAsRoll))),this.context.info.printView||(this.context.document.score.systemStaff.removeEventListener(Fi.SYSTEM_STATUS_CHANGE,xt.bindMethod(this,this.handleStatusChange)),this.context.document.score.systemStaff.removeEventListener(Fi.FOCUS_MEASURE_NUMBER,xt.bindMethod(this,this.handleFocusMeasureNumber))),this.removeEnterFrameListener()}},{key:"getStaffViewAt",value:function(t){return A.as(this._staffViews[t],zh)}},{key:"measureViewWidthAt",value:function(t){return this.getStaffViewAt(0).measureViewWidthAt(t)}},{key:"hideMeasure",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._staffViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.hideMeasure(t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"showHiddenMeasure",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._staffViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.showHiddenMeasure(t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"getStaffView",value:function(t){var e;e=t.isSystemStaff?this._layout.getStaffLayoutAt(0).staff:t;var i=!0,n=!1,r=void 0;try{for(var o,s=this._staffViews[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a.layout.staff==e)return a}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return null}},{key:"getLocalPointInMeasure",value:function(t,e,i,n){var r=!0,o=!1,s=-1;if(null!=n&&(r="top"==n.verticalAlign,o="grace"==n.horizontalAlign,s=A.unknownToInt("voiceNumber"in n?n.voiceNumber:-1)),t>=this._layout.startMeasureIndex&&t<this._layout.endMeasureIndex){var a,l=null!=e?this.getStaffView(e):this.getStaffViewAt(0);if(null==l)return null;for(;null==(a=l.getMeasureViewAt(t-this._layout.startMeasureIndex));)this.flowMeasures(1),this.arrangeMeasureHandles();var u,h=i<0?0:a.layout.getMeasurePositionX(i,o,s),c=l.x+a.x+this.toViewUnits(h);return u=null==e?r?l.y-this.toViewUnits(l.layout.height+this.staffMetrics.measureHandlePadding):this.systemHeight:r?l.y-this.toViewUnits(l.layout.height):l.y,new If(c,u)}return null}},{key:"getPointInMeasure",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=this.getLocalPointInMeasure(t,e,i,n);return null!=r&&(r=this.localToGlobal(r)),r}},{key:"getLocalMeasureStart",value:function(t){if(t>=this._layout.startMeasureIndex&&t<=this._layout.endMeasureIndex){var e=A.numberToInt(Math.min(t,this._layout.endMeasureIndex-1)),i=this.getStaffViewAt(0),n=i.getMeasureViewAt(e-this._layout.startMeasureIndex);if(null==n)return null;var r=i.x+n.x,o=i.y-this.toViewUnits(this._layout.bottomPadding);return t==this._layout.endMeasureIndex&&(r+=n.measureWidth),new If(r,o)}return null}},{key:"getPositionUnderPoint",value:function(t,e,i){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!1,a=!1,l=-1,u=null;null!=o&&(s="grace"==o.horizontalAlign,a="noBarline"==o.horizontalAlign,l=A.unknownToInt("voiceNumber"in o?o.voiceNumber:-1),u=o.measurePosition);var h=null!=r?this.getStaffView(r):this.getStaffViewAt(0);if(u)n=h.getMeasureViewAt(u.measureIndex-this._layout.startMeasureIndex);else{var c=this._layout.startMeasureIndex,d=this._layout.endMeasureIndex-1;if(null==h)throw Error("staffView should not be null");for(var f=h.globalToLocal(e);c<=d;){var y=A.numberToInt((c+d)/2),g=(n=h.getMeasureViewAt(y-this._layout.startMeasureIndex))?n.x:NaN;X.isNaN(g)||f.x<g?d=y-1:c=y+1}n=h.getMeasureViewAt(d-this._layout.startMeasureIndex)}if(null==n)return null;var p=n.globalToLocal(e).x/t.layoutContext.staffMetrics.lineSpacing,m=n.layout;if(!m.systemMeasureLayout)return null;var v=null;v=u?u.position:m.getMeasureXPosition(p,i,s,a,l);var _=p-m.getMeasurePositionX(v,s,l),S=this.globalToLocal(e);if(null==r)for(var L=0;L<this._layout.staffLayouts.length;L++)if(L==this._layout.staffLayouts.length-1||S.y<=this.getStaffViewAt(L).y+this.toViewUnits(this.staffMetrics.staffSpacing)){r=this.getStaffViewAt(L).layout.staff;break}if(null==r)throw Error("staff should not be null");var k=0;return null!=(h=this.getStaffView(r))&&(k=(h.y-S.y)/this.staffMetrics.lineSpacing),new Dl(A.intToUint(r.index),A.intToUint(m.measure.index),v,_,k)}},{key:"initializeView",value:function(){this._spanViews=[],s(h(e.prototype),"initializeView",this).call(this)}},{key:"updateLabelsAndBrackets",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.getStaffViewAt(0).staffStartViews,i=0;i<e.length;i++)if(!(e[i].measure.index<t)){var n=!0,r=!1,o=void 0;try{for(var s,a=this._layout.partStaffIndices[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=A.unknownToType(l,Array),h=u[0],c=u[u.length-1],d=this._layout.getStaffLayoutAt(h),f=d.staff.part,y=d.staff.score;if(f.hasPedal&&f.staves.length>2&&c--,0==i&&y.showPartNameNextToStaff(this._layout.startMeasureIndex)){var g={model:f,property:this._layout.partLabelProperty,editGroupName:Ou.getString("editor/placeholder.partName")},p=new fc(this.context,My.RIGHT,this.staffMetrics.staffTextFont,this.staffMetrics.partNameSize,g),m=new Q(p,h,c,i);this._partLabels.push(m),this.addChild(p)}if(h<c){var v=this.context.layoutContext.foundry.getBarline(En.GRAND_STAFF),_=v.createDisplayObject(this.context.info);d.canHide&&!this.context.info.printView&&(_.alpha=this.context.info.hiddenMeasureAlpha);var S={view:_,unscaledHeight:v.height,start:h,end:c,staffStartIndex:i};this.updateFullHeightGeometry(S),this._fullHeightViews.push(S),this.addChild(_)}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}this.updatePartLabelsGeometry()}},{key:"updatePartLabelsGeometry",value:function(){var t=this._layout.leftPadding,e=!0,i=!1,n=void 0;try{for(var r,o=this._partLabels[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.updatePartLabelGeometry(s,t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"updateView",value:function(){this.destroyChildren(),this._staffViews=[],this.layout.validateGlobalLayout();for(var t=0;t<this._layout.staffLayouts.length;t++){var e=this._layout.staffLayouts[t];this.createStaffView(e,t==this._layout.staffLayouts.length-1,t)}if(this._partLabels=[],this._fullHeightViews=[],this.updateLabelsAndBrackets(),this._backdropSprite=new Wr,this._backdropSprite.alpha=0,!this.context.info.printView||this.context.info.testView){this._measureHandles=[];for(var i=this._layout.startMeasureIndex;i<this._layout.endMeasureIndex;i++)this.updateOrAddMeasureHandle(i);this._staffHandles=[];var n=!0,r=!1,o=void 0;try{for(var s,a=this._staffViews[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this._staffHandles.push(this.addStaffHandle(l))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}var u=!0,h=!1,c=void 0;try{for(var d,f=this._staffViews[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;this.addChild(y)}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}this.updateGeometry(),this.updateSpanNotations(null)}},{key:"updateBackdrop",value:function(){if(this.graphics.clear(),this._backdropSprite.graphics.clear(),!this.context.info.printView&&A.is(this.context.document.selection,Ke)){var t=A.as(this.context.document.selection,Ke);if(t.startIndex<this._layout.endMeasureIndex&&t.endIndex>this._layout.startMeasureIndex){var e=A.numberToInt(Math.max(this._layout.startMeasureIndex,t.startIndex)),i=A.numberToInt(Math.min(this._layout.endMeasureIndex,t.endIndex)),n=this.getLocalMeasureStart(e),r=this.getLocalMeasureStart(i);if(null==r&&i>this.getStaffViewAt(0).numMeasureViews-1&&(r=this.getLocalMeasureStart(this.getStaffViewAt(0).numMeasureViews-1)),n&&r){var o=n.x,s=r.x;this.graphics.beginFill(this.context.info.measureHighlightColor,this.context.info.measureHighlightAlpha),this.graphics.drawRect(o,-this.toViewUnits(-this.layout.topPadding+this.context.info.systemHighlightMargin),s-o,this.systemHeight+this.toViewUnits(2*this.context.info.systemHighlightMargin-this.layout.topPadding)),this.graphics.endFill()}}}var a,l=this.getLocalMeasureStart(this._layout.endMeasureIndex);if(null!=l&&(this._backdropSprite.graphics.beginFill(0,0),this._backdropSprite.graphics.drawRect(0,0,l.x,this.systemHeight+this.toViewUnits(this._layout.bottomPadding)),this._backdropSprite.graphics.endFill()),this._layout.getStaffLayoutAt(0).staff.score.numVisibleStaves>1){var u=this.toViewUnits(this.staffMetrics.systemLineThickness),h=this.getStaffViewAt(0).staffStartViews;for(a=0;a<h.length;a++){var c=h[a].x-1+this.toViewUnits(this._layout.leftPadding),d=this.getStaffViewAt(0).y-this.toViewUnits(this._layout.getStaffLayoutAt(0).staffStartLayout.measure.effectiveClef.staffHeight);this.graphics.beginFill(0,1),this.graphics.drawRect(c,d,u,this.getStaffViewAt(this._staffViews.length-1).y-d),this.graphics.endFill()}}for(a=0;a<this._measureHandles.length;a++)this._measureHandles[a].updateStatus()}},{key:"createStaffView",value:function(t,e,i){var n=new zh(this.context,t,i);return n.x=this.toViewUnits(this._layout.leftPadding),n.y=this.toViewUnits(t.distanceY),this._staffViews.push(n),this.y}},{key:"destroyChildren",value:function(){if(e._lastRolled=null,this._backdropSprite)for(;this._backdropSprite.numChildren>0;)this._backdropSprite.removeChildAt(0);for(var t=0;t<this._measureHandles.length;t++)this._measureHandles[t].destroy();for(t=0;t<this._staffHandles.length;t++)this._staffHandles[t].destroy();for(t=0;t<this._staffViews.length;t++)this._staffViews[t].destroy();for(t=0;t<this._partLabels.length;t++)this._partLabels[t].field.destroy();for(t=0;t<this._spanViews.length;t++)if(this._spanViews[t])for(var i=0;i<this._spanViews[t].length;i++)this._spanViews[t][i].destroy()}},{key:"deleteMeasureHandlesStartingAt",value:function(t){for(var e=t;e<this._measureHandles.length;e++){var i=this._measureHandles[e];this._backdropSprite.removeChild(i),i.destroy()}this._measureHandles.splice(t)}},{key:"updateOrAddMeasureHandle",value:function(t){var e=this.measureHandleY,i=t-this._layout.startMeasureIndex,n=this.getStaffViewAt(0).getMeasureViewAt(A.numberToInt(i));if(null!=n){var r=n.layout,o=new Nh(this.context,r,this);o.y=e;var s=this._measureHandles[i];this._measureHandles[i]=o,s&&(this._backdropSprite.removeChild(s),s.destroy()),this._backdropSprite.addChildAt(o,0)}}},{key:"arrangeMeasureHandles",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(null!=this._measureHandles)for(var e=-1==t?this._layout.startMeasureIndex:t,i=A.numberToInt(e);i<this._layout.endMeasureIndex;i++){var n=this._measureHandles[i-this._layout.startMeasureIndex];if(null!=n){var r=this.getLocalMeasureStart(i);if(null==r)break;n.x=r.x,n.y=this.measureHandleY,n.updateStatus()}}}},{key:"addStaffHandle",value:function(t){var e=new mc(this.context,t.layout,this);return e.y=t.y,this._backdropSprite.addChild(e),e}},{key:"arrangeStaffHandles",value:function(){if(null!=this._staffHandles)for(var t=0;t<this._staffHandles.length;t++)this._staffHandles[t].y=this._staffViews[t].y}},{key:"updateMeasureViewsStartingAt",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._staffViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)for(var s=r.value,a=A.numberToInt(t);a<this.numMeasures;a++)s.updateMeasureAt(a-this._layout.startMeasureIndex)}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"handleMeasureDisplay",value:function(t){if(null!=this.stage){var e,i,n,r;this.layout.validateGlobalLayout();var o={},s=!1,a=!1,l=t.measureIndices,u=!0,h=!1,c=void 0;try{for(var d,f=t.measureIndices[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;if(!(y<this._layout.startMeasureIndex||y>=this._layout.endMeasureIndex))if(t.staves&&t.staves.length&&-1!=t.staves[0].index){var g=!0,p=!1,m=void 0;try{for(var v,_=t.staves[Symbol.iterator]();!(g=(v=_.next()).done);g=!0)if(-1!=(e=v.value).index&&(n=this.getViewForStaff(e))){var S=y-this._layout.startMeasureIndex;if(S>=n.numMeasureViews)o[n.layout.index]=n;else{r=n.getMeasureViewAt(S),n.updateLayoutToMeasureViews();var L=new eg;s||a||L.record(r),n.updateMeasureAt(S),s||a||(r=n.getMeasureViewAt(S),L.isWidthDifferent(r)?s=!0:L.isHeightDifferent(r)&&(a=!0)),s||a||n.updateGeometry(),o[n.layout.index]=n}}}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}}else{var k=!0,T=!1,E=void 0;try{for(var M,b=this._staffViews[Symbol.iterator]();!(k=(M=b.next()).done);k=!0)(n=M.value).updateMeasureAt(y-this._layout.startMeasureIndex),o[n.layout.index]=n}catch(t){T=!0,E=t}finally{try{k||null==b.return||b.return()}finally{if(T)throw E}}s=!0}}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}if(s||a){var w=!0,x=!1,C=void 0;try{for(var N,I=this._staffViews[Symbol.iterator]();!(w=(N=I.next()).done);w=!0)for(n=N.value,i=this._layout.startMeasureIndex;i<this._layout.endMeasureIndex;i++)(t.justify||this.context.controller.score.isStripMode)&&(-1==t.measureIndices.indexOf(i)||t.staves&&-1==t.staves.indexOf(n.layout.staff))&&(n.justifyMeasureAt(A.numberToInt(i-this._layout.startMeasureIndex)),o[n.layout.index]=n)}catch(t){x=!0,C=t}finally{try{w||null==I.return||I.return()}finally{if(x)throw C}}}var P=!0,O=!1,Q=void 0;try{for(var R,D=xt.objectForOfSource(o)[Symbol.iterator]();!(P=(R=D.next()).done);P=!0){var F=R.value;(n=A.unknownToType(F,zh)).updateGeometry()}}catch(t){O=!0,Q=t}finally{try{P||null==D.return||D.return()}finally{if(O)throw Q}}this.updateGeometry(),l=[];for(var U=this._layout.startMeasureIndex;U<this._layout.endMeasureIndex;U++){var V=U-this._layout.startMeasureIndex,B=this.getStaffViewAt(0).getMeasureViewAt(V);B&&!B.isPlaceholder&&l.push(U)}this.updateSpanNotations(l)}}},{key:"handleMeasureGeometryChange",value:function(t){if(null!=this.stage){var e=!0,i=!1,n=void 0;try{for(var r,o=this._staffViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){for(var s=r.value,a=this._layout.startMeasureIndex;a<this._layout.endMeasureIndex;a++)(t.justify||t.measureIndices.indexOf(a)>=0)&&s.justifyMeasureAt(a-this._layout.startMeasureIndex);s.updateGeometry()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.updateGeometry(),this.updateSpanNotations(null)}}},{key:"handleMeasureSpanChange",value:function(t){null!=this.stage&&this.updateSpanNotations(t.measureIndices)}},{key:"updateStavesGeometry",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._staffViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.updateGeometry()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"updateGeometry",value:function(){this.layout.validateGlobalLayout(),this.context.documentView?this.x=this.context.documentView.scoreLayout.getXPosition(this._layout,this.context):this.x=this.toViewUnits(this._layout.leftMargin),this.backdropSprite.x=this.x;for(var t=0;t<this.numStaffViews;t++){var e=this.getStaffViewAt(t);null!=e.layout&&(e.y=this.toViewUnits(e.layout.distanceY),e.updateBarlineHeight())}this.arrangeStaffHandles(),this.updateBackdrop(),this.arrangeMeasureHandles(),this.updatePartLabelsGeometry();var i=!0,n=!1,r=void 0;try{for(var o,s=this._fullHeightViews[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.updateFullHeightGeometry(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"updatePartLabelGeometry",value:function(t,e){var i=A.unknownToType(t.field,fc),n=A.unknownToNumber(t.start),r=this._layout.getStaffLayoutAt(A.numberToUint(n)),o=A.unknownToNumber(t.end),s=this._layout.getStaffLayoutAt(A.numberToUint(o)),a=this.getStaffViewAt(0).staffStartViews[t.staffStartIndex];i.x=a.x+this.toViewUnits(e)-this.toViewUnits(this.staffMetrics.staffLabelPadding),i.y=this.toViewUnits((r.distanceY-r.height/2+s.distanceY-s.height/2)/2)-i.ascent/2-2}},{key:"updateFullHeightGeometry",value:function(t){var e=A.unknownToType(t.view,Rr),i=A.unknownToNumber(t.start),n=this._layout.getStaffLayoutAt(A.numberToUint(i)),r=A.unknownToNumber(t.end),o=this._layout.getStaffLayoutAt(A.numberToUint(r)),s=this.getStaffViewAt(0).staffStartViews[t.staffStartIndex];e.x=s.x+this.toViewUnits(this._layout.leftPadding)-this.toViewUnits(this.staffMetrics.grandStaffPadding),e.scaleY=this.toViewUnits(o.distanceY-(n.distanceY-n.height))/t.unscaledHeight,e.y=this._staffViews[r].y}},{key:"updateSpanNotations",value:function(t){var e,i,n,r;if(null==t){i=(e=this._layout.startMeasureIndex)+this.getStaffViewAt(0).numMeasureViews}else{e=this._layout.endMeasureIndex,i=0;var o=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value,c=A.unknownToInt(h);e=A.numberToInt(Math.min(e,c)),i=A.numberToInt(Math.max(i,c+1))}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}e=A.numberToInt(Math.max(this._layout.startMeasureIndex,e)),i=A.numberToInt(Math.min(this._layout.endMeasureIndex,i))}for(var d=e;d<i;d++)if(null!=this._spanViews[d]){var f=!0,y=!1,g=void 0;try{for(var p,m=this._spanViews[d].slice()[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var v=p.value,_=A.unknownToType(v,Ju);for(this.removeChild(_),n=d;n>=this._layout.startMeasureIndex&&null!=this._spanViews[n]&&(r=this._spanViews[n].indexOf(_))>=0;){for(var S=this._spanViews[n].splice(r,1),L=0;L<S.length;L++)S[L].destroy();n--}for(n=d+1;n<this._layout.endMeasureIndex&&null!=this._spanViews[n]&&(r=this._spanViews[n].indexOf(_))>=0;){for(var k=this._spanViews[n].splice(r,1),T=0;T<k.length;T++)k[T].destroy();n++}}}catch(t){y=!0,g=t}finally{try{f||null==m.return||m.return()}finally{if(y)throw g}}}for(var E=0;E<this._layout.staffLayouts.length;E++){var M=!0,b=!1,w=void 0;try{for(var x,C=this._layout.getStaffLayoutAt(A.intToUint(E)).getSpansInRange(e,i)[Symbol.iterator]();!(M=(x=C.next()).done);M=!0){var N=x.value,I=A.unknownToType(N,ts),P=I.createSystemDisplayObject(this);for(this.addChild(P),n=A.numberToInt(Math.max(this._layout.startMeasureIndex,I.notation.measure.index)),r=A.numberToInt(Math.min(this._layout.endMeasureIndex,I.notation.endPosition.measureIndex+1)),d=n;d<r;d++)null==this._spanViews[d]&&(this._spanViews[d]=[]),this._spanViews[d].push(P)}}catch(t){b=!0,w=t}finally{try{M||null==C.return||C.return()}finally{if(b)throw w}}}}},{key:"handleStatusChange",value:function(t){this._layout.startMeasureIndex<=t.endMeasureIndex&&this._layout.endMeasureIndex>=t.startMeasureIndex&&this.updateBackdrop()}},{key:"handleFocusMeasureNumber",value:function(t){var e=this;this._layout.startMeasureIndex<=t.startMeasureIndex&&t.startMeasureIndex<=this._layout.endMeasureIndex-1&&(this.updateBackdrop(),setTimeout(function(){e._measureHandles[t.startMeasureIndex-e._layout.startMeasureIndex].focusMeasureNumber(t)},1))}},{key:"handleUpdateMeasureHandleIndex",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._measureHandles[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.updateMeasureIndex()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"handleRollOut",value:function(t){null!=this._rollEvent&&$c.isSyntheticMouseEvent(this._rollEvent,t)||(this._handleAlpha=0)}},{key:"handleRollOver",value:function(t){this._rollEvent=t,null!=e._lastRolled&&e._lastRolled!=this&&e._lastRolled.handleRollOut(t),e._lastRolled=this,this._handleAlpha=1,this.addEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleClickAsRoll",value:function(t){this.context.controller.isNotationInteractionAvailable()&&this.showHandles()}},{key:"areHandlesShown",value:function(){for(var t=0;t<this._measureHandles.length;t++)if(this._measureHandles[t].active)return!0;return!1}},{key:"showHandles",value:function(){e._lastRolled!=this&&e.clearLastRolled(),e._lastRolled=this,this._backdropSprite.alpha=1}},{key:"removeEnterFrameListener",value:function(){this.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame))}},{key:"handleRemovedFromStage",value:function(t){this.removeEnterFrameListener()}},{key:"handleEnterFrame",value:function(t){this._backdropSprite.alpha+=(this._handleAlpha-this._backdropSprite.alpha)/this.HANDLE_ANIMATION_TIME_CONSTANT,this._backdropSprite.alpha<.1&&(this._backdropSprite.alpha=0,this.removeEventListener(ct.ENTER_FRAME,xt.bindMethod(this,this.handleEnterFrame)))}},{key:"flowMeasures",value:function(t){var e=this.getStaffViewAt(0),i=A.numberToInt(this.numMeasureViews);if(i<this.numMeasures){for(var n=0;n<this._staffViews.length;n++){e=this.getStaffViewAt(n);for(var r=i;r<i+t;r++){if(r>=this.numMeasures){this.isIncrementalFlowComplete=!0;break}e.createMeasurePrefixesViewsAt(r),e.createMeasureViewAt(r,!0),(0===n&&!this.context.info.printView||this.context.info.testView)&&this.updateOrAddMeasureHandle(r)}e.updateGeometry()}this.updateLabelsAndBrackets(i)}else this.isIncrementalFlowComplete=!0}},{key:"doIncrementalFlow",value:function(){var t;switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.ONE){case e.UP_TO_SCROLL_POS:t=this.estimateNumberOfMeasuresToLoad();break;case e.EVERYTHING:t=this.MAX_MEASURES_TO_LOAD;break;default:t=1}t>0&&(this.flowMeasures(Math.min(this.MAX_MEASURES_TO_LOAD,t)),this.isMoreFlowNeeded?this.arrangeMeasureHandles():(this.updateGeometry(),this.updateSpanNotations(null)))}},{key:"truncateSystemViewAt",value:function(t){for(var e=0;e<this._staffViews.length;e++)this._staffViews[e].truncateMeasureViewsStartingAt(t);for(e=A.numberToInt(t);e<this._spanViews.length;e++)if(this._spanViews[e])for(var i=0;i<this._spanViews[e].length;i++)this.removeChild(this._spanViews[e][i]),this._spanViews[e][i].destroy();this.isIncrementalFlowComplete=!1}},{key:"updateMeasureHandlesStartingAt",value:function(t){for(var e=A.numberToInt(t);e<this._layout.endMeasureIndex;e++)this.updateOrAddMeasureHandle(e);this.deleteMeasureHandlesStartingAt(this._layout.endMeasureIndex)}},{key:"getMeasureXPosition",value:function(t){return this._staffViews[0].getMeasureXPosition(t)}},{key:"getStaffXPosition",value:function(){return this._staffViews[0].x}},{key:"estimateNumberOfMeasuresToLoad",value:function(){var t=this.getStaffViewAt(0),e=t.numMeasureViews,i=t.getMeasureViewAt(e-1);if(!i)return 1;var n=(this.context.documentView.viewportWidth+this.context.documentView.horizontalScrollPosition)/this.context.documentView.viewInfo.displayScale;return Math.ceil(Math.max(0,(n-i.x)/this.averageCurrentMeasuresWidth))}},{key:"getViewForStaff",value:function(t){return this.staffViews.find(function(e){return e.layout.staff==t})}},{key:"backdropSprite",get:function(){return this._backdropSprite}},{key:"layout",get:function(){return this._layout}},{key:"systemHeight",get:function(){return this.toViewUnits(this._layout.height)}},{key:"staffViews",get:function(){return this._staffViews}},{key:"numStaffViews",get:function(){return this._staffViews.length}},{key:"numMeasureViews",get:function(){return this._staffViews[0].numMeasureViews}},{key:"numMeasures",get:function(){return this.context.document.score.numMeasures}},{key:"firstStaffHandle",get:function(){return this._staffHandles[0]}},{key:"lastMeasureHandle",get:function(){return this._measureHandles[this._measureHandles.length-1]}},{key:"lastDrawnMeasure",get:function(){return this._staffViews[this._staffViews.length-1].lastDrawnMeasure}},{key:"measureHandleY",get:function(){var t=Math.max(1,5/this.context.layoutContext.staffMetrics.lineSpacing);return this.toViewUnits(this._layout.topPadding)-this.toViewUnits(this.staffMetrics.measureHandlePadding)*t-this.context.info.measureHandleHeight}},{key:"isMoreFlowNeeded",get:function(){var t=this.context.documentView,e=this.getStaffViewAt(0),i=e.numMeasureViews,n=e.getMeasureViewAt(i-1),r=this.context.documentView.viewInfo.displayScale,o=(t.viewportWidth+t.horizontalScrollPosition)/r;return i!=this.numMeasures&&(null==n||n.x<=o)}},{key:"averageCurrentMeasuresWidth",get:function(){var t=this.getStaffViewAt(0).numMeasureViews,i=this.getStaffViewAt(0).getMeasureViewAt(t-1);return i?((0===this.context.cachedMeasureWidth||t-this.context.cachedMeasureWidthForTheLastTime>e.RECALCULATE_AVG_MEASURE_WIDTH)&&(this.context.cachedMeasureWidth=(i.x+i.width)/t,this.context.cachedMeasureWidthForTheLastTime=t),this.context.cachedMeasureWidth):0}},{key:"endSpritePosition",get:function(){var t,e=this.getStaffViewAt(0),i=e.numMeasureViews,n=e.getMeasureViewAt(i-1);return this.isIncrementalFlowComplete?new If(n.x+n.width):(i>0&&(t=A.numberToInt(this.numMeasures/i*n.x)),new If(t,0))}}],[{key:"clearLastRolled",value:function(){null!=e._lastRolled&&(e._lastRolled._backdropSprite.alpha=0)}}]),e}(),Kh=null;r.registerClass(Xh,"com.noteflight.notation.view.SystemView");var jh=function(t){function e(t,i){var n;return y(this,e),n=l(this,h(e).call(this,t,i)),i.addEventListener(Ki.STAFF_START_CHANGE,xt.bindMethod(u(u(n)),n.handleStaffStartChange)),n}return c(e,Xh),p(e,[{key:"initializeView",value:function(){s(h(e.prototype),"initializeView",this).call(this),this.updateGeometry()}},{key:"handleStaffStartChange",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this._staffViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.updateMeasureAt(0)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"createStaffView",value:function(t,e,i){var n=new Wh(this.context,t,i);return n.x=this.toViewUnits(this._layout.leftPadding),n.y=this.toViewUnits(t.distanceY),this._staffViews.push(n),this.y}},{key:"updateSpanNotations",value:function(t){}},{key:"removeListeners",value:function(){this._layout.removeEventListener(Ki.STAFF_START_CHANGE,xt.bindMethod(this,this.handleStaffStartChange))}},{key:"handleMeasureDisplay",value:function(t){if(null!=this.stage){var e,i,n;this.layout.validateGlobalLayout();var r=!0,o=!1,s=void 0;try{for(var a,l=t.measureIndices[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if((i=A.unknownToNumber(u))==this._layout.startMeasureIndex){if(t.staves&&t.staves.length&&-1!=t.staves[0].index){var h=!0,c=!1,d=void 0;try{for(var f,y=t.staves[Symbol.iterator]();!(h=(f=y.next()).done);h=!0)-1!=(e=f.value).index&&(n=this.getViewForStaff(e))&&n.updateMeasureAt(A.numberToInt(i-this._layout.startMeasureIndex))}catch(t){c=!0,d=t}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}else{var g=!0,p=!1,m=void 0;try{for(var v,_=this._staffViews[Symbol.iterator]();!(g=(v=_.next()).done);g=!0)(n=v.value).updateMeasureAt(A.numberToInt(i-this._layout.startMeasureIndex))}catch(t){p=!0,m=t}finally{try{g||null==_.return||_.return()}finally{if(p)throw m}}}var S=!0,L=!1,k=void 0;try{for(var T,E=this._staffViews[Symbol.iterator]();!(S=(T=E.next()).done);S=!0)(n=T.value).updateGeometry()}catch(t){L=!0,k=t}finally{try{S||null==E.return||E.return()}finally{if(L)throw k}}}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}this.updateGeometry()}}}]),e}();r.registerClass(jh,"com.noteflight.notation.view.OverlaySystemView");var qh=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$feedbackColor=6710886,t._$selectionColors=[15356451,10824234],t._$scoreColor=16777215,t._$scoreDropShadowDistance=4,t._$scoreDropShadowColor=3355443,t._$scoreDropShadowAlpha=.8,t._$scoreDropShadowEnabled=!0,t._$handleFont="Tahoma",t._$handleTextSize=8,t._$handleColor=15658734,t._$measureHighlightColor=15356451,t._$measureHighlightAlpha=.15,t._$measureInserterOffset=18,t._$measureHandleHeight=14,t._$measureHandleMouseHeight=48,t._$measureHandleHighlightColor=16772812,t._$measureHandlePadding=2,t._$measureHandleAlpha=.8,t._$inserterScale=.75,t._$hiddenMeasureAlpha=.25,t._$staffHandleWidth=12,t._$staffHandleExtent=24,t._$staffHandlePadding=-10,t._$dragHighlightOutlineColor=13421772,t._$dragHighlightOutlineAlpha=1,t._$dragHighlightInsertionPointColor=15356451,t._$measureHighlightMargin=2,t._$systemHighlightMargin=2,t._$measureInsertionPointInset=1,t._$measureInsertionMultiVoiceOffset=2.5,t._$measureInsertionPointPadding=.5,t._$tabInsertionPointExtension=.6,t._$doubleClickMillis=300,t._$displayScale=1,t._$displayMode=Nl.PAGINATED_DISPLAY,t._$displayTop=0,t._$printView=!1,t._$testView=!1,t._$buildIncrementally=!0,t._$buildWhileIdle=!0,t._$buildScoreAsSoonAsPossible=!1,t._$hidePlaybackControls=!1,t.shadowBottomUrl=null,t.shadowBottomLeftUrl=null,t.shadowBottomRightUrl=null,t.shadowLeftUrl=null,t.shadowPreviewUrl=null,t.shadowRightUrl=null,t.shadowTopUrl=null,t.shadowTopLeftUrl=null,t.shadowTopRightUrl=null,t}return c(e,At),p(e,[{key:"clone",value:function(){var t=new e;return t.feedbackColor=this.feedbackColor,t.selectionColors=this.selectionColors.slice(),t.displayScale=this.displayScale,t}},{key:"feedbackColor",get:function(){return this._$feedbackColor},set:function(t){var e=this._$feedbackColor;this._$feedbackColor=t,e!==t&&this._propertyChanged("feedbackColor",e,t)}},{key:"selectionColors",get:function(){return this._$selectionColors},set:function(t){var e=this._$selectionColors;this._$selectionColors=t,e!==t&&this._propertyChanged("selectionColors",e,t)}},{key:"scoreColor",get:function(){return this._$scoreColor},set:function(t){var e=this._$scoreColor;this._$scoreColor=t,e!==t&&this._propertyChanged("scoreColor",e,t)}},{key:"scoreDropShadowDistance",get:function(){return this._$scoreDropShadowDistance},set:function(t){var e=this._$scoreDropShadowDistance;this._$scoreDropShadowDistance=t,e!==t&&this._propertyChanged("scoreDropShadowDistance",e,t)}},{key:"scoreDropShadowColor",get:function(){return this._$scoreDropShadowColor},set:function(t){var e=this._$scoreDropShadowColor;this._$scoreDropShadowColor=t,e!==t&&this._propertyChanged("scoreDropShadowColor",e,t)}},{key:"scoreDropShadowAlpha",get:function(){return this._$scoreDropShadowAlpha},set:function(t){var e=this._$scoreDropShadowAlpha;this._$scoreDropShadowAlpha=t,e!==t&&this._propertyChanged("scoreDropShadowAlpha",e,t)}},{key:"scoreDropShadowEnabled",get:function(){return this._$scoreDropShadowEnabled},set:function(t){var e=this._$scoreDropShadowEnabled;this._$scoreDropShadowEnabled=t,e!==t&&this._propertyChanged("scoreDropShadowEnabled",e,t)}},{key:"handleFont",get:function(){return this._$handleFont},set:function(t){var e=this._$handleFont;this._$handleFont=t,e!==t&&this._propertyChanged("handleFont",e,t)}},{key:"handleTextSize",get:function(){return this._$handleTextSize},set:function(t){var e=this._$handleTextSize;this._$handleTextSize=t,e!==t&&this._propertyChanged("handleTextSize",e,t)}},{key:"handleColor",get:function(){return this._$handleColor},set:function(t){var e=this._$handleColor;this._$handleColor=t,e!==t&&this._propertyChanged("handleColor",e,t)}},{key:"measureHighlightColor",get:function(){return this._$measureHighlightColor},set:function(t){var e=this._$measureHighlightColor;this._$measureHighlightColor=t,e!==t&&this._propertyChanged("measureHighlightColor",e,t)}},{key:"measureHighlightAlpha",get:function(){return this._$measureHighlightAlpha},set:function(t){var e=this._$measureHighlightAlpha;this._$measureHighlightAlpha=t,e!==t&&this._propertyChanged("measureHighlightAlpha",e,t)}},{key:"measureInserterOffset",get:function(){return this._$measureInserterOffset},set:function(t){var e=this._$measureInserterOffset;this._$measureInserterOffset=t,e!==t&&this._propertyChanged("measureInserterOffset",e,t)}},{key:"measureHandleHeight",get:function(){return this._$measureHandleHeight},set:function(t){var e=this._$measureHandleHeight;this._$measureHandleHeight=t,e!==t&&this._propertyChanged("measureHandleHeight",e,t)}},{key:"measureHandleMouseHeight",get:function(){return this._$measureHandleMouseHeight},set:function(t){var e=this._$measureHandleMouseHeight;this._$measureHandleMouseHeight=t,e!==t&&this._propertyChanged("measureHandleMouseHeight",e,t)}},{key:"measureHandleHighlightColor",get:function(){return this._$measureHandleHighlightColor},set:function(t){var e=this._$measureHandleHighlightColor;this._$measureHandleHighlightColor=t,e!==t&&this._propertyChanged("measureHandleHighlightColor",e,t)}},{key:"measureHandlePadding",get:function(){return this._$measureHandlePadding},set:function(t){var e=this._$measureHandlePadding;this._$measureHandlePadding=t,e!==t&&this._propertyChanged("measureHandlePadding",e,t)}},{key:"measureHandleAlpha",get:function(){return this._$measureHandleAlpha},set:function(t){var e=this._$measureHandleAlpha;this._$measureHandleAlpha=t,e!==t&&this._propertyChanged("measureHandleAlpha",e,t)}},{key:"inserterScale",get:function(){return this._$inserterScale},set:function(t){var e=this._$inserterScale;this._$inserterScale=t,e!==t&&this._propertyChanged("inserterScale",e,t)}},{key:"hiddenMeasureAlpha",get:function(){return this._$hiddenMeasureAlpha},set:function(t){var e=this._$hiddenMeasureAlpha;this._$hiddenMeasureAlpha=t,e!==t&&this._propertyChanged("hiddenMeasureAlpha",e,t)}},{key:"staffHandleWidth",get:function(){return this._$staffHandleWidth},set:function(t){var e=this._$staffHandleWidth;this._$staffHandleWidth=t,e!==t&&this._propertyChanged("staffHandleWidth",e,t)}},{key:"staffHandleExtent",get:function(){return this._$staffHandleExtent},set:function(t){var e=this._$staffHandleExtent;this._$staffHandleExtent=t,e!==t&&this._propertyChanged("staffHandleExtent",e,t)}},{key:"staffHandlePadding",get:function(){return this._$staffHandlePadding},set:function(t){var e=this._$staffHandlePadding;this._$staffHandlePadding=t,e!==t&&this._propertyChanged("staffHandlePadding",e,t)}},{key:"dragHighlightOutlineColor",get:function(){return this._$dragHighlightOutlineColor},set:function(t){var e=this._$dragHighlightOutlineColor;this._$dragHighlightOutlineColor=t,e!==t&&this._propertyChanged("dragHighlightOutlineColor",e,t)}},{key:"dragHighlightOutlineAlpha",get:function(){return this._$dragHighlightOutlineAlpha},set:function(t){var e=this._$dragHighlightOutlineAlpha;this._$dragHighlightOutlineAlpha=t,e!==t&&this._propertyChanged("dragHighlightOutlineAlpha",e,t)}},{key:"dragHighlightInsertionPointColor",get:function(){return this._$dragHighlightInsertionPointColor},set:function(t){var e=this._$dragHighlightInsertionPointColor;this._$dragHighlightInsertionPointColor=t,e!==t&&this._propertyChanged("dragHighlightInsertionPointColor",e,t)}},{key:"measureHighlightMargin",get:function(){return this._$measureHighlightMargin},set:function(t){var e=this._$measureHighlightMargin;this._$measureHighlightMargin=t,e!==t&&this._propertyChanged("measureHighlightMargin",e,t)}},{key:"systemHighlightMargin",get:function(){return this._$systemHighlightMargin},set:function(t){var e=this._$systemHighlightMargin;this._$systemHighlightMargin=t,e!==t&&this._propertyChanged("systemHighlightMargin",e,t)}},{key:"measureInsertionPointInset",get:function(){return this._$measureInsertionPointInset},set:function(t){var e=this._$measureInsertionPointInset;this._$measureInsertionPointInset=t,e!==t&&this._propertyChanged("measureInsertionPointInset",e,t)}},{key:"measureInsertionMultiVoiceOffset",get:function(){return this._$measureInsertionMultiVoiceOffset},set:function(t){var e=this._$measureInsertionMultiVoiceOffset;this._$measureInsertionMultiVoiceOffset=t,e!==t&&this._propertyChanged("measureInsertionMultiVoiceOffset",e,t)}},{key:"measureInsertionPointPadding",get:function(){return this._$measureInsertionPointPadding},set:function(t){var e=this._$measureInsertionPointPadding;this._$measureInsertionPointPadding=t,e!==t&&this._propertyChanged("measureInsertionPointPadding",e,t)}},{key:"tabInsertionPointExtension",get:function(){return this._$tabInsertionPointExtension},set:function(t){var e=this._$tabInsertionPointExtension;this._$tabInsertionPointExtension=t,e!==t&&this._propertyChanged("tabInsertionPointExtension",e,t)}},{key:"doubleClickMillis",get:function(){return this._$doubleClickMillis},set:function(t){var e=this._$doubleClickMillis;this._$doubleClickMillis=t,e!==t&&this._propertyChanged("doubleClickMillis",e,t)}},{key:"displayScale",get:function(){return this._$displayScale},set:function(t){var e=this._$displayScale;this._$displayScale=t,e!==t&&this._propertyChanged("displayScale",e,t)}},{key:"displayMode",get:function(){return this._$displayMode},set:function(t){var e=this._$displayMode;this._$displayMode=t,e!==t&&this._propertyChanged("displayMode",e,t)}},{key:"displayTop",get:function(){return this._$displayTop},set:function(t){var e=this._$displayTop;this._$displayTop=t,e!==t&&this._propertyChanged("displayTop",e,t)}},{key:"printView",get:function(){return this._$printView},set:function(t){var e=this._$printView;this._$printView=t,e!==t&&this._propertyChanged("printView",e,t)}},{key:"testView",get:function(){return this._$testView},set:function(t){var e=this._$testView;this._$testView=t,e!==t&&this._propertyChanged("testView",e,t)}},{key:"buildIncrementally",get:function(){return this._$buildIncrementally},set:function(t){var e=this._$buildIncrementally;this._$buildIncrementally=t,e!==t&&this._propertyChanged("buildIncrementally",e,t)}},{key:"buildWhileIdle",get:function(){return this._$buildWhileIdle},set:function(t){var e=this._$buildWhileIdle;this._$buildWhileIdle=t,e!==t&&this._propertyChanged("buildWhileIdle",e,t)}},{key:"buildScoreAsSoonAsPossible",get:function(){return this._$buildScoreAsSoonAsPossible},set:function(t){var e=this._$buildScoreAsSoonAsPossible;this._$buildScoreAsSoonAsPossible=t,e!==t&&this._propertyChanged("buildScoreAsSoonAsPossible",e,t)}},{key:"hidePlaybackControls",get:function(){return this._$hidePlaybackControls},set:function(t){var e=this._$hidePlaybackControls;this._$hidePlaybackControls=t,e!==t&&this._propertyChanged("hidePlaybackControls",e,t)}}]),e}();r.registerClass(qh,"com.noteflight.notation.view.ViewInfo");var Jh=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._$staffHandleExtent=5,t}return c(e,qh),p(e,[{key:"clone",value:function(){var t=new e;return t.feedbackColor=this.feedbackColor,t.selectionColors=this.selectionColors.slice(),t.displayScale=this.displayScale,t}},{key:"staffHandleExtent",get:function(){return this._$staffHandleExtent},set:function(t){var e=this._$staffHandleExtent;this._$staffHandleExtent=t,e!==t&&this._propertyChanged("staffHandleExtent",e,t)}}]),e}();r.registerClass(Jh,"com.noteflight.notation.view.OverlayViewInfo");var Zh=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y(this,e),(n=l(this,h(e).call(this,t)))._layout=i,n._context=t,n._isLastPage=r.isLastPage,n._showEndOfPreviewText=r.showEndOfPreviewText,n._chunkViews=[],n._backdropSprite=null,n._contentSprite=null,n._shadowSprite=null,n._scoreTextFields=[],n._createdShadows=0,n._state=e.SCORE,n._actualPage=null,n._placeholderInMemory=null,n._pageCleared=!1,i.isActualLayout&&n.init(),n}return c(e,Ju),p(e,null,[{key:"SCORE",get:function(){return"score"}},{key:"PLACEHOLDER",get:function(){return"placeholder"}},{key:"MAX_COPYRIGHT_SIZE",get:function(){return 9.6}},{key:"DEFAULT_PAGE_MARGIN_TOP",get:function(){return 16}},{key:"DEFAULT_PAGE_MARGIN_LEFT",get:function(){return 16}},{key:"DEFAULT_PAGE_MARGIN_RIGHT",get:function(){return 18}},{key:"DEFAULT_WATERMARK_STARTING_PAGE",get:function(){return 0}}]),p(e,[{key:"init",value:function(){this.setListeners(),this.initializeView(),this.mouseChildrenOnRoll()}},{key:"setListeners",value:function(){this._layout.addEventListener(bi.DISPLAY,xt.bindMethod(this,this.handleMeasureDisplay),!1),this._layout.addEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay),!1),this._layout.addEventListener(bi.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay),!1)}},{key:"refreshPageView",value:function(){this.update(),this.positionChunkViews(),this._pageCleared=!1}},{key:"setNewLayout",value:function(t){this.removeListeners(),this._layout=t,this.setListeners(),this.state==e.SCORE&&this.refreshPageView()}},{key:"showPlaceholder",value:function(){if(this.removeChild(this._actualPage),!this._placeholderInMemory){this._placeholderInMemory=new Wr,this._placeholderInMemory.graphics.beginFill(this.pageMetrics.upcomingPageBackgroundColor,this.pageMetrics.upcomingPageBackgroundOpacity),this._placeholderInMemory.graphics.drawRect(0,0,this.pageMetrics.width,this.pageMetrics.height),this.context.documentView.showHtml5Shadow()&&(this._placeholderInMemory.x=this.pageMetrics.horizontalScoreShadowSize);var t=new Ty;t.text=Ou.getString("editor.buildingPage",[(this.index+1).toString()]),t.antiAliasType=vy.ADVANCED,t.embedFonts=!0,t.defaultTextFormat=new Ly(this.pageMetrics.upcomingPageTextFont,this.pageMetrics.upcomingPageTextSize,null,!1,!1,null,null,null,wy.LEFT),t.textColor=this.pageMetrics.upcomingPageTextColor,t.backgroundColor=16777215,t.background=!1,t.multiline=!0,t.wordWrap=!0,t.x=this.pageMetrics.width/2-t.width/2,t.y=this.pageMetrics.height/2-t.height/2,this._placeholderInMemory.addChild(t)}this.addChild(this._placeholderInMemory)}},{key:"showScore",value:function(){this.layout.isActualLayout&&((this._pageCleared||this.layout.isActualLayout&&!this._actualPage)&&this.refreshPageView(),this._placeholderInMemory&&this.getChildIndex(this._placeholderInMemory)>-1&&this.removeChild(this._placeholderInMemory),this.layout.isActualLayout&&this.addChild(this._actualPage))}},{key:"clearPage",value:function(){if(this._actualPage)for(this._pageCleared=!0;this._actualPage.numChildren>0;)this._actualPage.removeChildAt(0)}},{key:"clearChunksStartingAt",value:function(t){for(var e=A.numberToInt(t);e<this._chunkViews.length;e++){var i=A.unknownToType(this._chunkViews[e],sh);i.destroy(),this._contentSprite.removeChild(i)}}},{key:"removeListeners",value:function(){this._layout.removeEventListener(bi.DISPLAY,xt.bindMethod(this,this.handleMeasureDisplay)),this._layout.removeEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay)),this._layout.removeEventListener(bi.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay))}},{key:"destroyChildren",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._chunkViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;A.unknownToType(o,sh).destroy()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}for(var s=0;s<this._scoreTextFields.length;s++)this._scoreTextFields[s].destroy()}},{key:"getPointInMeasure",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t>=this.startMeasureIndex&&t<this.endMeasureIndex){var r=!0,o=!1,s=void 0;try{for(var a,l=this._chunkViews[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,h=A.unknownToType(u,sh);if(A.is(h,Xh)){var c=A.unknownToType(h,Xh).getPointInMeasure(t,e,i,n);if(null!=c)return c}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}return null}},{key:"getPositionUnderPoint",value:function(t,e,i){for(var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=0;s<this._chunkViews.length;s++){var a=A.unknownToType(this._chunkViews[s],sh);if(A.is(a,Xh)){var l=(n=A.unknownToType(a,Xh)).getPointInMeasure(n.layout.startMeasureIndex,null,0,{verticalAlign:"bottom"});if(e.y<=l.y+this.toViewUnits(this.staffMetrics.systemSpacing/2)){if(s<this._chunkViews.length){var u=A.unknownToType(this._chunkViews[s+1],sh);if(A.is(u,Xh)){var h=A.unknownToType(u,Xh),c=h.getPointInMeasure(h.layout.startMeasureIndex,null,0,{verticalAlign:"top"}).y-this.toViewUnits(this.staffMetrics.measureHandlePadding);if(h.areHandlesShown()&&e.y>c)return h.getPositionUnderPoint(t,e,i,r,o)}}return n.getPositionUnderPoint(t,e,i,r,o)}}}return null!=n?n.getPositionUnderPoint(t,e,i,r,o):null}},{key:"createCopyrightField",value:function(t){var i={bold:this.staffMetrics.copyrightBold,editableElement:!this.layout.score.lockCopyright,editGroupName:Ou.getString("editor/placeholder.copyright"),italics:!1,markdown:!1,maxSize:e.MAX_COPYRIGHT_SIZE,model:this._layout.score,property:"copyright"},n=new fc(this.context,My.CENTER,this.staffMetrics.copyrightFont,-this.staffMetrics.copyrightSize,i);n.multiline=!0,n.x=this.pageMetrics.contentWidth/2,n.y=this.pageMetrics.contentHeight-n.height,t&&(n.y=Math.min(t.y-n.height,n.y)),this._scoreTextFields.push(n),this._contentSprite.addChild(n)}},{key:"createFooterField",value:function(){var t={bold:this.staffMetrics.footerBold,editableElement:!1,editGroupName:Ou.getString("editor/placeholder.footer"),markdown:!1,model:this._layout.score,property:"footer"},e=new fc(this.context,My.LEFT,this.staffMetrics.footerFont,-this.staffMetrics.footerSize,t);return e.multiline=!0,e.wordWrap=!0,e.setColor(this.staffMetrics.footerColor),e.setTextWidth(this.pageMetrics.contentWidth),e.x=this.pageMetrics.contentWidth/2-e.width/2,e.y=this.pageMetrics.bottomVisiblePageYPosition-e.height,e}},{key:"updateBackdrop",value:function(t){$c.beginBackgroundFill(this.graphics,this.context.info);var e=0,i=0;this.context.documentView&&this.context.documentView.showHtml5Shadow()&&(e=this.pageMetrics.horizontalScoreShadowSize,i=this.pageMetrics.verticalScoreShadowSize,this.createShadow(t)),this.graphics.drawRect(e,i,this.pageMetrics.width,t),this.graphics.endFill()}},{key:"createShadow",value:function(t){var e=this.pageMetrics.width-2*this.pageMetrics.horizontalScoreShadowSize;this.createShadowImage(2*this.pageMetrics.horizontalScoreShadowSize,0,e,1,"Top"),this.createShadowImage(0,0,1,1,"TopLeft"),this.createShadowImage(this.pageMetrics.width,0,1,1,"TopRight");var i=t-2*this.pageMetrics.verticalScoreShadowSize;this._showEndOfPreviewText?(i=t-this.pageMetrics.verticalScoreShadowSize,i+=1*this.pageMetrics.horizontalScoreShadowSize):(this.createShadowImage(2*this.pageMetrics.horizontalScoreShadowSize,this.pageMetrics.verticalScoreShadowSize+t,e,1,"Bottom"),this.createShadowImage(0,t,1,1,"BottomLeft"),this.createShadowImage(this.pageMetrics.width,t,1,1,"BottomRight")),this.createShadowImage(0,2*this.pageMetrics.verticalScoreShadowSize,1,i,"Left"),this.createShadowImage(this.pageMetrics.horizontalScoreShadowSize+this.pageMetrics.width,2*this.pageMetrics.verticalScoreShadowSize,1,i,"Right")}},{key:"createShadowImage",value:function(t,e,i,n,r){var o=this._context.documentView.cachedShadows[r+this._layout.index];if(o)this.positionShadowImage(o,this,t,e,i,n);else{var s=t,a=e,l=i,u=n,h=r,c=this,d=new gf;d.contentLoaderInfo.addEventListener(ct.COMPLETE,function t(){c.positionShadowImage(d,c,s,a,l,u),c._context.documentView.cachedShadows[h+c._layout.index]=d,d.contentLoaderInfo.removeEventListener(ct.COMPLETE,t)});var f=this._context.info["shadow".concat(r,"Url")];d.load(new Ff(f))}}},{key:"positionShadowImage",value:function(t,e,i,n,r,o){t.x=i,t.y=n,t.scaleX=r,t.scaleY=o,e._shadowSprite.addChild(t),e._createdShadows++,8==e._createdShadows&&e._context.documentView.updateScoreDimensions()}},{key:"resizeWatermark",value:function(t){var e=t.width,i=t.height,n=this.pageMetrics.width-this.pageMetrics.pageMarginLeft-this.pageMetrics.pageMarginRight-this.pageMetrics.staffMarginLeft-this.pageMetrics.staffMarginRight,r=this.pageMetrics.height-this.pageMetrics.pageMarginTop-this.pageMetrics.pageMarginBottom-this.pageMetrics.staffMarginTop-this.pageMetrics.staffMarginBottom,o=this._context.documentView.watermarkScale;t.scaleX=o,t.scaleY=o,t.x=n/2-e*o/2,t.y=r/2-i*o/2,this._contentSprite.addChild(t)}},{key:"update",value:function(){this.updateView()}},{key:"updateView",value:function(){this.destroyChildren(),this._actualPage&&this.getChildIndex(this._actualPage)>-1&&this.removeChild(this._actualPage),this._placeholderInMemory&&this.getChildIndex(this._placeholderInMemory)>-1&&this.removeChild(this._placeholderInMemory),this._actualPage=new Wr,this.addChild(this._actualPage),this._shadowSprite=new Wr,this._shadowSprite.x=0,this._shadowSprite.y=0,this._actualPage.addChild(this._shadowSprite),this._scoreTextFields=[];var t=this.pageMetrics.pageMarginLeft+this.pageMetrics.staffMarginLeft,i=this.pageMetrics.pageMarginTop+this.pageMetrics.staffMarginTop;!this.context.info.printView&&this.context.documentView.showHtml5Shadow()&&(t+=this.pageMetrics.horizontalScoreShadowSize,i+=this.pageMetrics.verticalScoreShadowSize),this._backdropSprite=new Wr,this._backdropSprite.x=t,this._backdropSprite.y=i,this._actualPage.addChild(this._backdropSprite),this._contentSprite=new Wr,this._contentSprite.x=t,this._contentSprite.y=i,this._actualPage.addChild(this._contentSprite);var n,r,o,s,a=new Wr;a.graphics.beginFill(16711680),a.graphics.drawRect(0,0,this.pageMetrics.width,this.pageMetrics.height),a.graphics.endFill(),a.mouseEnabled=!1,this._actualPage.addChild(a),this._contentSprite.mask=a;var l=this._layout.score,u=!1;if(l.showPartNameAtTopLeftOfThePage(this._layout.index)){var h=new fc(this.context,My.LEFT,this.staffMetrics.textFont,-this.staffMetrics.partNameSize,{editableElement:!1});u=!0,h.x=0,h.y=-this.pageMetrics.staffMarginTop+this.staffMetrics.partNameAtTheTopOffset-(this.pageMetrics.pageMarginTop-e.DEFAULT_PAGE_MARGIN_TOP),h.text=l.useIndividualPartInfo?l.useIndividualPartInfo.name:l.visibleParts[0].name,this._scoreTextFields.push(h),this._contentSprite.addChild(h)}var c=null;if(this._layout.score.footer&&(c=this.createFooterField(),this._scoreTextFields.push(c),this._contentSprite.addChild(c)),0===this._layout.index){var d=0;if(null!==this._layout.score.supertitle){n={model:this._layout.score,property:"supertitle",editGroupName:Ou.getString("editor/placeholder.supertitle"),markdown:!1,bold:this.staffMetrics.supertitleBold};var f=new fc(this.context,My.CENTER,this.staffMetrics.supertitleFont,-this.staffMetrics.supertitleSize,n);f.multiline=!0,f.x=this.pageMetrics.contentWidth/2,f.y=-this.pageMetrics.staffMarginTop+this.toViewUnits(this.staffMetrics.titleY),this._scoreTextFields.push(f),this._contentSprite.addChild(f),d=f.y+f.height}n={model:this._layout.score,property:"title",editGroupName:Ou.getString("editor/placeholder.title"),markdown:!1,bold:this.staffMetrics.titleBold,editableElement:!this.layout.score.lockTitle};var y=new fc(this.context,My.CENTER,this.staffMetrics.titleFont,-this.staffMetrics.titleSize,n);y.x=this.pageMetrics.contentWidth/2,y.y=0!=d?d+this.toViewUnits(this.staffMetrics.titlePageSupertitlePadding):-this.pageMetrics.staffMarginTop+this.toViewUnits(this.staffMetrics.titleY),this._scoreTextFields.push(y),this._contentSprite.addChild(y),n={model:this._layout.score,property:"subtitle",editGroupName:Ou.getString("editor/placeholder.subtitle"),markdown:!1,bold:this.staffMetrics.subtitleBold};var g=new fc(this.context,My.CENTER,this.staffMetrics.subtitleFont,-this.staffMetrics.subtitleSize,n);g.multiline=!0,g.x=this.pageMetrics.contentWidth/2,g.y=y.y+y.height+this.toViewUnits(this.staffMetrics.titlePageSubtitlePadding),this._scoreTextFields.push(g),this._contentSprite.addChild(g);var p=-this.pageMetrics.staffMarginTop+this.toViewUnits(this.staffMetrics.composerY),m=this._layout.score.subtitle?g:y,v=m.y+m.height+this.toViewUnits(this.staffMetrics.composerBottomPadding);if(p=Math.max(p,v),n={model:this._layout.score,property:"composer",editGroupName:Ou.getString("editor/placeholder.composer"),markdown:!1,bold:this.staffMetrics.composerBold,editableElement:!this.layout.score.lockComposer},(r=new fc(this.context,My.RIGHT,this.staffMetrics.composerFont,-this.staffMetrics.composerSize,n)).multiline=!0,r.x=this.pageMetrics.contentWidth,r.y=p,this._scoreTextFields.push(r),this._contentSprite.addChild(r),n={model:this._layout.score,property:"lyricist",editGroupName:Ou.getString("editor/placeholder.lyricist"),markdown:!1,bold:this.staffMetrics.lyricsBold,editableElement:!this.layout.score.lockLyricist},(o=new fc(this.context,My.LEFT,this.staffMetrics.lyricistFont,-this.staffMetrics.composerSize,n)).multiline=!0,o.x=0,o.y=p,this._scoreTextFields.push(o),this._contentSprite.addChild(o),this.layout.score.showArranger){var _=o.y+o.height;n={model:this._layout.score,property:"arranger",editGroupName:Ou.getString("editor/placeholder.text"),markdown:!1,bold:this.staffMetrics.arrangerBold},(s=new fc(this.context,My.LEFT,this.staffMetrics.arrangerFont,-this.staffMetrics.composerSize,n)).multiline=!0,s.x=0,s.y=_,this._scoreTextFields.push(s),this._contentSprite.addChild(s)}this._showEndOfPreviewText||this.createCopyrightField(c)}else{var S=new fc(this.context,My.RIGHT,this.staffMetrics.textFont,-this.staffMetrics.pageNumberSize,{editableElement:!1});S.x=this.pageMetrics.contentWidth+(this.pageMetrics.pageMarginRight-e.DEFAULT_PAGE_MARGIN_RIGHT),S.y=-this.pageMetrics.staffMarginTop-(this.pageMetrics.pageMarginTop-e.DEFAULT_PAGE_MARGIN_TOP),u&&(S.y+=this.staffMetrics.partNameAtTheTopOffset);var L=(this._layout.index+1).toString();if(this.staffMetrics.pageNumberIncludesTitle){var k=this._layout.score.title;null!=k&&""!==k&&(L=k+" - "+L)}S.text=L,this._scoreTextFields.push(S),this._contentSprite.addChild(S),this.staffMetrics.showCopyrightOnAllPages&&!this._showEndOfPreviewText&&this.createCopyrightField(c)}this._chunkViews=[];for(var T=0;T<this._layout.chunkLayoutsLength;T++){var E=this._layout.getChunkLayoutAt(A.intToUint(T));E.validateGlobalLayout();var M=A.as(E.createDisplayObject(this.context),sh);if(M.y=this.toViewUnits(E.distanceY),this._contentSprite.addChild(M),A.is(M,Xh)){var b=A.unknownToType(M,Xh);b.backdropSprite.x=M.x,b.backdropSprite.y=M.y,this._backdropSprite.addChild(b.backdropSprite)}this._chunkViews.push(M)}if(0===this._layout.index&&null!=this._layout.score.prompt){n={model:this._layout.score,property:"prompt",editGroupName:Ou.getString("editor/placeholder.prompt"),markdown:!0};var w=new fc(this.context,My.LEFT,this.staffMetrics.textFont,-this.staffMetrics.titlePagePromptSize,n);w.x=this.toViewUnits(this.staffMetrics.titlePagePromptPadding.left);var x=this.toViewUnits(this.staffMetrics.titlePageFirstStaffPadding+this.staffMetrics.titlePagePromptPadding.top);if(null!=r&&null!=o){var C=Math.max(r.y+r.height,o.y+o.height);x=Math.max(x,C)}w.y=x,w.multiline=!0,w.wordWrap=!0,w.setTextWidth(this.pageMetrics.contentWidth-this.toViewUnits(this.staffMetrics.titlePagePromptPadding.right)),this._scoreTextFields.push(w),this._contentSprite.addChild(w)}if(0===this._layout.index&&this._layout.score.hasTracks&&!this.context.info.printView){var N=new kc(this.context,this._layout.score);N.x=this.toViewUnits(this.pageMetrics.trackFlagX),N.y=-this.pageMetrics.staffMarginTop+this.toViewUnits(this.pageMetrics.trackFlagY),this._contentSprite.addChild(N)}var I=this._context.documentView,P=I&&I.watermarkStartingPage?I.watermarkStartingPage:e.DEFAULT_WATERMARK_STARTING_PAGE;I&&""!==I.watermarkUrl&&this._layout.index>P&&this.drawPreviewWatermark();var O=this.pageMetrics.height;this._showEndOfPreviewText&&(this.drawPreviewFeedback(),O=this._contentSprite.y+this.lastSystem.y+this.lastSystem.height),this.updateBackdrop(O)}},{key:"drawPreviewWatermark",value:function(){var t=this,e=new gf;e._svg.classList.add("previewWatermark");e.contentLoaderInfo.addEventListener(ct.COMPLETE,function i(){t.resizeWatermark(e),e.contentLoaderInfo.removeEventListener(ct.COMPLETE,i)}),e.load(new Ff(this._context.documentView.watermarkUrl))}},{key:"drawPreviewFeedback",value:function(){var t=this._contentSprite.y+this.lastSystem.y+this.lastSystem.height,e=!this.context.info.printView&&this.context.documentView.showHtml5Shadow()?this.pageMetrics.horizontalScoreShadowSize:0,i=this.pageMetrics.width;this.createShadowImage(e,t,i,1,"Preview");var n=new Ty;n.text=Ou.getString("editor.endOfPreview"),n.antiAliasType=vy.ADVANCED,n.embedFonts=!0,n.defaultTextFormat=new Ly(this.pageMetrics.previewTextFont,this.pageMetrics.previewTextSize,null,this.pageMetrics.previewTextBold,!1,null,null,null,wy.CENTER),n.textColor=this.pageMetrics.previewTextColor,n.x=this.pageMetrics.width/2+e-n.width/2,n.y=t+this.pageMetrics.previewTextGap,this._actualPage.addChild(n)}},{key:"positionChunkViews",value:function(){this.layout.positionChunkLayouts();var t=!0,e=!1,i=void 0;try{for(var n,r=this._chunkViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=A.unknownToType(o,sh);s.y=this.toViewUnits(s.layout.distanceY),A.is(s,Xh)&&(A.unknownToType(s,Xh).backdropSprite.y=this.toViewUnits(s.layout.distanceY))}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"handleMeasureDisplay",value:function(t){if(null!=this.stage){for(var e=0;e<this._chunkViews.length;e++){var i=A.unknownToType(this._chunkViews[e],sh);if(A.is(i,Xh)){var n=A.unknownToType(i,Xh);if(n.layout.startMeasureIndex==t.systemLayout.startMeasureIndex){n.layout.constraint.generateLayoutVector(t.systemLayout.constraint.lastWeights),n.layout.dispatchEvent(t);break}}}this.positionChunkViews()}}},{key:"isPlaceholder",get:function(){return this._state==e.PLACEHOLDER}},{key:"layout",get:function(){return this._layout},set:function(t){this.removeListeners(),this._layout=t,this.setListeners(),this.state==e.SCORE&&this.refreshPageView()}},{key:"index",get:function(){return this._layout.index}},{key:"showEndOfPreviewText",get:function(){return this._showEndOfPreviewText}},{key:"startMeasureIndex",get:function(){return this._layout.startMeasureIndex}},{key:"endMeasureIndex",get:function(){return this._layout.endMeasureIndex}},{key:"state",get:function(){return this._state},set:function(t){if(this._state!=t){if(t==e.PLACEHOLDER)this.showPlaceholder();else if(t==e.SCORE){if(!this.layout.isActualLayout)return;this.showScore()}this._state=t}}},{key:"lastDrawnMeasure",get:function(){for(var t=this._chunkViews.length-1;t>=0;t--){var e=A.unknownToType(this._chunkViews[t],sh);if(A.is(e,Xh))return A.as(e,Xh).lastDrawnMeasure}return null}},{key:"systemViews",get:function(){return this._chunkViews}},{key:"lastSystem",get:function(){return this._chunkViews[this._chunkViews.length-1]}},{key:"actualSystemViews",get:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var r,o=this._chunkViews[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=A.unknownToType(s,sh);A.is(a,Xh)&&t.push(A.as(a,Xh))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}}]),e}();r.registerClass(Zh,"com.noteflight.notation.view.PageView");var tc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._layout=null,n._viewportChangeTimer=new By(e.VIEWPORT_CHANGE_DELAY,1),n._forceViewBuild=!1,n._targetMeasureIndex=NaN,n._isBuilding=!1,n._idleManager=null,n._endSprite=null,n._hasChangedSinceLastPullFlow=!0,n._upcomingMeasuresCreated=!1,n._layout=i,t.registerScoreView(u(u(n))),n.addEventListener(ct.ADDED_TO_STAGE,xt.bindMethod(u(u(n)),n.onAddedToStage)),n.addEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(u(u(n)),n.onRemovedFromStage)),n}return c(e,Ju),p(e,null,[{key:"VIEWPORT_CHANGE_DELAY",get:function(){return 100}}]),p(e,[{key:"onAddedToStage",value:function(t){if(null!=this.context.documentView){if(this.context.documentView.addEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.onScaleChange),!1,0,!0),this.context.documentView.addEventListener(ci.REBUILD_LAYOUT,xt.bindMethod(this,this.forcePageFlow),!1,0,!0),this.context.documentView.addEventListener(ci.FORCE_PAGE_FLOW,xt.bindMethod(this,this.forcePageFlow),!1,0,!0),this.context.documentView.addEventListener(ci.CANCEL_FORCE_BUILD,xt.bindMethod(this,this.cancelForceBuild),!1,0,!0),this.context.documentView.stage.addEventListener(ct.RESIZE,xt.bindMethod(this,this.onResize),!1,0,!0),this._viewportChangeTimer.addEventListener(Nf.TIMER,xt.bindMethod(this,this.handleViewportChangeTimer)),this.context.document.addEventListener($i.PLAY_BACK,xt.bindMethod(this,this.onPlayback),!1,0,!0),this.context.document.addEventListener($i.STOP,xt.bindMethod(this,this.onStopPlayback),!1,0,!0),null!=this._idleManager&&this._idleManager.addEventListener(Ei.IDLE,xt.bindMethod(this,this.onIdle)),!this.context.overlay){this.context.documentView.addEventListener(hi.SCROLL,xt.bindMethod(this,this.onScroll),!1,0,!0);var e=this;this._layout.addEventListener(Mi.CONTINUE_INCREMENTAL_FLOW,function(t){e.continueIncrementalFlow(!0,!0,{measureIndex:t.index,staves:t.invalidStaves})})}var i=A.as(this.context.controller,Le);i&&i.performanceMode==Le.RECORD&&this.forceBuild()}}},{key:"onRemovedFromStage",value:function(t){this.context.documentView.removeEventListener(hi.SCROLL,xt.bindMethod(this,this.onScroll)),this.context.documentView.removeEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.onScaleChange)),this.context.documentView.removeEventListener(ci.REBUILD_LAYOUT,xt.bindMethod(this,this.forcePageFlow)),this.context.documentView.removeEventListener(ci.FORCE_PAGE_FLOW,xt.bindMethod(this,this.forcePageFlow)),this.context.documentView.removeEventListener(ci.CANCEL_FORCE_BUILD,xt.bindMethod(this,this.cancelForceBuild)),this.context.documentView.stage.removeEventListener(ct.RESIZE,xt.bindMethod(this,this.onResize)),this._viewportChangeTimer.removeEventListener(Nf.TIMER,xt.bindMethod(this,this.handleViewportChangeTimer)),this.context.document.removeEventListener($i.PLAY_BACK,xt.bindMethod(this,this.onPlayback)),this.context.document.removeEventListener($i.STOP,xt.bindMethod(this,this.onStopPlayback)),null!=this._idleManager&&this._idleManager.removeEventListener(Ei.IDLE,xt.bindMethod(this,this.onIdle))}},{key:"getPointInMeasure",value:function(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3];throw new Error("getPointInMeasure() not overridden")}},{key:"forceFirstMeasuresToBeShown",value:function(){throw new Error("forceFirstMeasuresToBeShown not overridden")}},{key:"ensureSystemAfterMeasureDrawn",value:function(t){throw new Error("ensureSystemAfterMeasureDrawn() not overridden")}},{key:"getPositionUnderPoint",value:function(t,e,i){arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];throw new Error("getStaffPositionUnderPoint() not overridden")}},{key:"startViewportChangeTimer",value:function(){this._viewportChangeTimer.delay=e.VIEWPORT_CHANGE_DELAY,this._viewportChangeTimer.running||this._viewportChangeTimer.start()}},{key:"onScaleChange",value:function(t){this.startViewportChangeTimer()}},{key:"onScroll",value:function(t){this.scrollDirectionAffectsFlow(t.direction)&&(this.startViewportChangeTimer(),this.ensureScoreInViewportIsVisible())}},{key:"ensureScoreInViewportIsVisible",value:function(){throw new Error("ensureScoreInViewportIsVisible() not overriden")}},{key:"onResize",value:function(t){this.startViewportChangeTimer()}},{key:"handleViewportChangeTimer",value:function(t){this.pullFlow(!0),this._viewportChangeTimer.stop()}},{key:"scrollDirectionAffectsFlow",value:function(t){throw new Error("scrollDirectionAffectsLayout() not overriden")}},{key:"optimizeMeasureViews",value:function(){throw new Error("optimizeMeasureViews() not overridden")}},{key:"continueIncrementalFlow",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];throw new Error("continueIncrementalFlow() not overriden")}},{key:"noMoreFlowNeeded",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"pullFlowComplete",value:function(){}},{key:"hasChangedSinceLastPullFlow",value:function(){this._hasChangedSinceLastPullFlow=!0}},{key:"pullFlow",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.context.overlay)return this.pullFlowComplete();this._targetMeasureIndex=A.unknownToNumber(e?e.measureIndex:null);var i=A.unknownToType(e?e.staves:null,Array);this.showIncrementalFeedback(!0),this.isIncrementalFlowComplete||(this.isMoreFlowNeeded?(this.continueIncrementalFlow(t,!0),this._hasChangedSinceLastPullFlow=!0,this.estimateScrollBar()):(this._forceViewBuild||this.showIncrementalFeedback(!1),this.context.info.buildWhileIdle&&this.startIdleManager(),this.pullFlowComplete(),this._hasChangedSinceLastPullFlow&&(this.noMoreFlowNeeded(this._targetMeasureIndex,i),this._hasChangedSinceLastPullFlow=!1,this.estimateScrollBar()))),this.isIncrementalFlowComplete&&(this.showIncrementalFeedback(!1),this.pullFlowComplete(),this._hasChangedSinceLastPullFlow&&(this.noMoreFlowNeeded(this._targetMeasureIndex,i),this._hasChangedSinceLastPullFlow=!1,this.estimateScrollBar()))}},{key:"startIdleManager",value:function(){null==this._idleManager&&(this._idleManager=new di(this.context.documentView,this.initialIdleTimeout,this.subsequentIdleTimeout),this._idleManager.addEventListener(Ei.IDLE,xt.bindMethod(this,this.onIdle))),this._idleManager.enabled=!0}},{key:"onIdle",value:function(t){this.isIncrementalFlowComplete?this._idleManager.enabled=!1:this.continueIncrementalFlow(!0,!1)}},{key:"onPlayback",value:function(t){this.isIncrementalFlowComplete||this._forceViewBuild||this._idleManager&&(this._idleManager.paused=!0)}},{key:"onStopPlayback",value:function(t){this._idleManager&&(this._idleManager.paused=!1)}},{key:"forcePageFlow",value:function(t){this.forceBuild()}},{key:"forceBuild",value:function(){if(!this.context.overlay)if(this.context.document.validateNow(),this._forceViewBuild=!0,this._isBuilding||this.isIncrementalFlowComplete)this.isIncrementalFlowComplete&&(this.dispatchEvent(new ct(ct.COMPLETE)),this._forceViewBuild=!1);else{var t=this;this._isBuilding=!0,function e(){t._forceViewBuild&&!t.isIncrementalFlowComplete&&t.continueIncrementalFlow(!0,!0)?t.context.documentView.callLater(e):(t._forceViewBuild=!1,t._isBuilding=!1,t.isIncrementalFlowComplete&&(t.showIncrementalFeedback(!1),t.dispatchEvent(new ct(ct.COMPLETE))))}()}}},{key:"cancelForceBuild",value:function(t){this._forceViewBuild=!1}},{key:"positionIncrementalFeedback",value:function(){}},{key:"showIncrementalFeedback",value:function(t){this.context.buildIncrementally&&(t||this.context.documentView.dispatchEvent(new Mi(Mi.REPORT_PAGE_FLOW,-1)))}},{key:"updateIncrementalFeedback",value:function(t,e){if(this.context.buildIncrementally&&("page"==e||"measure"==e&&this._forceViewBuild)){var i="page"==e?Mi.REPORT_PAGE_FLOW:Mi.REPORT_STRIP_FLOW;this.context.documentView.dispatchEvent(new Mi(i,t))}}},{key:"estimateScrollBar",value:function(){this.context.buildIncrementally&&(this.hasLastViewBeenCreated?this.positionEndSprite(new If)&&this.context.documentView.updateScoreDimensions():this.positionEndSprite(this.endSpritePosition))}},{key:"createUpcomingMeasures",value:function(){throw new Error("abstract method createUpcomingMeasures() not overridden")}},{key:"positionEndSprite",value:function(t){return this.isIncrementalFlowComplete&&this._upcomingMeasuresCreated||(this._upcomingMeasuresCreated=!0,this.createUpcomingMeasures()),this.isIncrementalFlowComplete}},{key:"updateBackdrop",value:function(){throw new Error("abstract method updateBackdrop() not overridden")}},{key:"lastDrawnMeasure",get:function(){throw new Error("get lastDrawnMeasure() not overridden")}},{key:"isIncrementalFlowComplete",get:function(){throw new Error("isIncrementalLayoutComplete() not overriden")}},{key:"isMoreFlowNeeded",get:function(){throw new Error("isMoreLayoutNeeded() not overridden")}},{key:"endSpritePosition",get:function(){throw new Error("endSpritePosition() not overridden")}},{key:"initialIdleTimeout",get:function(){return this.context.documentView.viewInfo.buildScoreAsSoonAsPossible?di.ASAP_INITIAL_IDLE_TIMEOUT:this.context.controller.viewer?di.VIEWER_INITIAL_IDLE_TIMEOUT:di.DEFAULT_INITIAL_IDLE_TIMEOUT}},{key:"subsequentIdleTimeout",get:function(){return di.DEFAULT_SUBSEQUENT_IDLE_TIMEOUT}},{key:"hasLastViewBeenCreated",get:function(){throw new Error("hasLastViewBeenCreated() not overriden")}},{key:"totalPageFlowElements",get:function(){return-1}}]),e}();r.registerClass(tc,"com.noteflight.notation.view.ScoreView");var ec=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._viewContext=t,n._pageViews=[],n._lastTotalPageViews=0,n._pageMetrics=null,n._numOfPagesPerSide=3,n._lastCurrentPageIndex=-1,n._placeholderIndexBelow=Number.MAX_VALUE,n._lastTopPageViewport=-1,n._lastBottomPageViewport=-1,n._firstPageDisplayed=!1,n._pageMetrics=i.context.pageMetrics,n.context.documentView&&n.context.documentView.overlay||(i.addEventListener(Bi.PAGE_DISPLAY,xt.bindMethod(u(u(n)),n.handlePageDisplayEvent)),i.addEventListener(Bi.CHECK_OLD_REMAINING_CHUNKS,xt.bindMethod(u(u(n)),n.handleCheckUnusedChunks)),i.addEventListener(Hi.PAGE_REFLOW,xt.bindMethod(u(u(n)),n.handlePageReflow)),i.addEventListener(Mi.INCREMENTAL_LAYOUT_STEP_INITIATED,xt.bindMethod(u(u(n)),n.dispatchEvent)),i.addEventListener(Mi.INCREMENTAL_LAYOUT_STEP_COMPLETE,xt.bindMethod(u(u(n)),n.dispatchEvent)),n.calculateNumberOfContextPages(),n.initializeView()),n}return c(e,tc),p(e,null,[{key:"INCREMENTAL_LAYOUT_LOOKAHEAD",get:function(){return 300}}]),p(e,[{key:"getPageViewAt",value:function(t){return this._pageViews[t]}},{key:"getPointInMeasure",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!0,o=!1,s=void 0;try{for(var a,l=this._pageViews[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(!(!u||!u.layout.isActualLayout||t<u.startMeasureIndex||t>=u.endMeasureIndex)){u.state==Zh.PLACEHOLDER&&(u.state=Zh.SCORE);var h=u.getPointInMeasure(t,e,i,n);if(null!=h)return h}}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return null}},{key:"forceFirstMeasuresToBeShown",value:function(){this._pageViews.length>0&&this._pageViews[0].showScore()}},{key:"createPageViewsInViewport",value:function(){for(var t=this.currentTopPageIndexInViewport,e=this.currentBottomPageIndexInViewport,i=A.numberToInt(t);i<=e;i++){var n=i==this.layout.pageLayouts.length-1;this.addPageView(i,!0,{isLastPage:n,showEndOfPreviewText:n&&this.context.controller&&this.context.controller.showEndOfPreviewText})}this._firstPageDisplayed||(this._firstPageDisplayed=!0,jd.popTimer("FirstPage","firstPage",!1,!0))}},{key:"pullFlowComplete",value:function(){this.createPageViewsInViewport(),this.removeUnnecessaryUpcomingPages(),this.optimizeMeasureViews(),this.createUpcomingMeasures()}},{key:"getWidthOfPages",value:function(t){var e=t*this._pageMetrics.width;return e+=(t-1)*this._pageMetrics.pageViewSpacing,this.context.documentView.showHtml5Shadow()&&(e+=2*this._pageMetrics.horizontalScoreShadowSize),e}},{key:"getHeightOfPages",value:function(t){var e=t*this._pageMetrics.height;return e+=(t-1)*this._pageMetrics.pageViewSpacing,this.context.documentView.showHtml5Shadow()&&(e+=2*this._pageMetrics.verticalScoreShadowSize),this.context.controller.showEndOfPreviewText&&(e=e-this._pageMetrics.height+this._pageViews[this._pageViews.length-1].height+this._pageMetrics.previewTextGap),e}},{key:"ensureScoreInViewportIsVisible",value:function(){var t=this.currentTopPageIndexInViewport,e=this.currentBottomPageIndexInViewport;this._lastTopPageViewport<=t&&this._lastBottomPageViewport>=e||(this._lastTopPageViewport=t,this._lastBottomPageViewport=e,this.showHiddenPages(t,e))}},{key:"optimizeMeasureViews",value:function(){if(this.context.documentView&&!(this._pageViews.length<2*this._numOfPagesPerSide+1)){var t=this.currentBottomPageIndexInViewport;Math.abs(t-this._lastCurrentPageIndex)<=1||(this.isIncrementalFlowComplete&&(t=Math.min(t,this._pageViews.length)),this.showHiddenPages(t-this._numOfPagesPerSide,t+this._numOfPagesPerSide),this.isIncrementalFlowComplete&&this._pageViews.length!=this._lastTotalPageViews&&this.estimateScrollBar(),this._lastTotalPageViews=this._pageViews.length,this.hidePages(0,t-this._numOfPagesPerSide-1),t+this._numOfPagesPerSide+1<this._placeholderIndexBelow&&(this._placeholderIndexBelow=Math.min(this._pageViews.length,this._placeholderIndexBelow),this.hidePages(t+this._numOfPagesPerSide+1,this._placeholderIndexBelow),this._placeholderIndexBelow=t+this._numOfPagesPerSide+1),this._placeholderIndexBelow=Math.max(t+this._numOfPagesPerSide+1,this._placeholderIndexBelow),this._lastCurrentPageIndex=t)}}},{key:"calculateNumberOfContextPages",value:function(){this._numOfPagesPerSide=Math.max(1,.5*this.layout.context.staffMetrics.scoreLineSpacing)}},{key:"showHiddenPages",value:function(t,e){for(var i=A.numberToInt(t);i<=e;i++)if(!(i<0)&&this._pageViews[i]){if(i>=this._pageViews.length)break;this._pageViews[i].state=Zh.SCORE}}},{key:"hidePages",value:function(t,e){for(var i=A.numberToInt(t);i<=e;i++)if(!(i<0)&&this._pageViews[i]){if(i>=this._pageViews.length)break;this._pageViews[i].state=Zh.PLACEHOLDER}}},{key:"removeUnnecessaryUpcomingPages",value:function(){if(this.isIncrementalFlowComplete){for(var t=this._pageViews.length-1;t>=this.layout.totalPages;t--)this._pageViews[t]&&(this._pageViews[t].destroy(),this.removeChild(this._pageViews[t]),delete this._pageViews[t]);this.estimateScrollBar()}}},{key:"getSystemViewAfterMeasure",value:function(t){for(var e=0;e<this._pageViews.length;e++){var i=this._pageViews[e];if(i&&i.layout.isActualLayout&&!(t<i.layout.startMeasureIndex||t>i.layout.endMeasureIndex||(i.state=Zh.SCORE,i.state!=Zh.SCORE||i.lastDrawnMeasure&&i.lastDrawnMeasure.measure.index<t)))for(var n=0;n<i.actualSystemViews.length;n++){var r=A.unknownToType(i.actualSystemViews[n],Xh);if(!(r.lastDrawnMeasure.measure.index<t)){var o=!0,s=!1,a=void 0;try{for(var l,u=r.staffViews[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(!(h.lastDrawnMeasure.measure.index<t))for(var c=0;c<h.numMeasureViews;c++){if(h.getMeasureViewAt(A.numberToInt(c)).measure.index==t){var d=A.unknownToType(i.actualSystemViews[n+1],Xh);if(d)return d;var f=this._pageViews[e+1];return f?A.unknownToType(f.actualSystemViews[0],Xh):null}}}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}}}return null}},{key:"getPositionUnderPoint",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=!0,s=!1,a=void 0;try{for(var l,u=this._pageViews[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(h.state!=Zh.PLACEHOLDER&&e.y<=h.localToGlobal(new If(0,this._pageMetrics.height)).y)return h.getPositionUnderPoint(t,e,i,n,r)}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}return null}},{key:"getPageUnderPoint",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!0,o=!1,s=void 0;try{for(var a,l=this._pageViews[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(null!=u.getPointInMeasure(t,e,i,n))return u}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}return null}},{key:"updateView",value:function(){this.destroyChildren(),this._pageViews=[];var t=1==this.layout.pageLayouts.length;this.addPageView(0,!0,{isLastPage:t,showEndOfPreviewText:t&&this.context.controller&&this.context.controller.showEndOfPreviewText}),this.pullFlow(!1),this.createPageViewsInViewport()}},{key:"updateBackdrop",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._pageViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.updateBackdrop()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"addPageView",value:function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t*(this.isHorizontalFlow?this._pageMetrics.width+this._pageMetrics.pageViewSpacing:this._pageMetrics.height+this._pageMetrics.pageViewSpacing);if(e){var o=this.layout.pageLayouts[t];if(!o||this._pageViews[t]&&this._pageViews[t].state==Zh.SCORE&&this._pageViews[t].showEndOfPreviewText==n.showEndOfPreviewText)return;this._pageViews[t]&&(this._pageViews[t].destroy(),this.removeChild(this._pageViews[t])),i=A.as(o.createDisplayObject(this.context,n),Zh),this.showIncrementalFeedback(!1)}else{var s=new bs(this.context.layoutContext,A.intToUint(t));i=A.as(s.createDisplayObject(this.context),Zh)}this.isHorizontalFlow?i.x+=r:i.y+=r,this.addChild(i),this._pageViews[t]=A.as(i,Zh)}},{key:"destroyChildren",value:function(){for(var t=0;t<this._pageViews.length;t++)this._pageViews[t]&&this._pageViews[t].destroy()}},{key:"removeListeners",value:function(){this.layout.removeEventListener(Bi.PAGE_DISPLAY,xt.bindMethod(this,this.handlePageDisplayEvent)),this.layout.removeEventListener(Bi.CHECK_OLD_REMAINING_CHUNKS,xt.bindMethod(this,this.handleCheckUnusedChunks)),this.layout.removeEventListener(Hi.PAGE_REFLOW,xt.bindMethod(this,this.handlePageReflow)),this.layout.removeEventListener(Mi.INCREMENTAL_LAYOUT_STEP_INITIATED,xt.bindMethod(this,this.dispatchEvent)),this.layout.removeEventListener(Mi.INCREMENTAL_LAYOUT_STEP_COMPLETE,xt.bindMethod(this,this.dispatchEvent))}},{key:"murderPage",value:function(t){var e=this._pageViews[t];e&&(this.removeChild(e),e.destroy())}},{key:"handleCheckUnusedChunks",value:function(t){var e=this._pageViews[t.pageIndex];e&&e.clearChunksStartingAt(t.lastChunkIndex+1)}},{key:"handlePageDisplayEvent",value:function(t){for(var e,i=A.numberToInt(t.pageIndex);i<this._pageViews.length;i++){var n=this.layout.pageLayouts[i];if(n){if(this._pageViews[i])this._pageViews[i].setNewLayout(n,t)}else this.murderPage(i),(!e||e>i)&&(e=i)}e&&(this._pageViews=this._pageViews.slice(0,A.numberToInt(e)),this.hasChangedSinceLastPullFlow()),this.createUpcomingMeasures()}},{key:"handlePageReflow",value:function(t){var e=!1,i=!0,n=!1,r=void 0;try{for(var o,s=t.pageIndices[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=this.layout.pageLayouts[a];if(l){var u=this._pageViews[a];u&&!u.isPlaceholder&&(e?u.state=Zh.PLACEHOLDER:(u.updateView(l,t.measureIndices,t.staves),u.positionChunkViews(),e=!0))}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"createUpcomingMeasures",value:function(){if(this.context.controller&&!this.context.layoutContext.preview){for(var t=Math.max(0,this.lastRealPageViewIndex),e=!1,i=A.numberToInt(t);i<this.pageCountGuess;i++)this.addPageView(i,!1),e=!0;e&&this._viewContext.documentView.updateScoreDimensions()}}},{key:"scrollDirectionAffectsFlow",value:function(t){return this.isHorizontalFlow?t==Xy.HORIZONTAL:t==Xy.VERTICAL}},{key:"ensureSystemAfterMeasureDrawn",value:function(t){this.getSystemViewAfterMeasure(t)||this.isIncrementalFlowComplete||this.pullFlow(!0,{measureIndex:t+1})}},{key:"doIncrementalFlow",value:function(){return this.layout.doIncrementalFlow()}},{key:"continueIncrementalFlow",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){var i=this;return this.context.documentView.callLater(function(){i.doIncrementalFlow(),i.pullFlow(t)}),!0}for(;this.isMoreFlowNeeded&&!this.layout.isIncrementalLayoutComplete;)this.doIncrementalFlow();return this.showIncrementalFeedback(!1),!1}},{key:"layout",get:function(){return A.as(this._layout,Es)}},{key:"lastRealPageViewIndex",get:function(){for(var t=this._pageViews.length-1,e=this._pageViews[t];!e&&t>0;)t--,e=this._pageViews[t];return A.numberToInt(t+1)}},{key:"pageViews",get:function(){return this._pageViews}},{key:"isHorizontalFlow",get:function(){return this.context.flowDirection==Ec.FLOW_HORIZONTAL}},{key:"totalPageFlowElements",get:function(){return this.lastRealPageViewIndex}},{key:"currentTopPageIndexInViewport",get:function(){if(!this.context.documentView)return 0;var t=this.context.documentView.verticalScrollPosition/this.context.documentView.viewInfo.displayScale;return Math.floor(t/(this._pageMetrics.height+this._pageMetrics.pageViewSpacing))}},{key:"currentBottomPageIndexInViewport",get:function(){if(!this.context.documentView)return this.layout.pageLayouts.length-1;var t=(this.context.documentView.verticalScrollPosition+this.context.documentView.viewportHeight)/this.context.documentView.viewInfo.displayScale;return Math.floor(t/(this._pageMetrics.height+this._pageMetrics.pageViewSpacing))}},{key:"width",get:function(){return this.getWidthOfPages(1)},set:function(t){o(h(e.prototype),"width",t,this,!0)}},{key:"height",get:function(){return this.context.documentView.overlay?0:this.getHeightOfPages(A.numberToInt(this.lastDrawnPage.index+1))},set:function(t){o(h(e.prototype),"height",t,this,!0)}},{key:"lastDrawnScorePage",get:function(){for(var t=this._pageViews.length-1;t>=0;t--)if(this._pageViews[t]&&this._pageViews[t].state==Zh.SCORE)return this._pageViews[t];return this._pageViews[0]}},{key:"lastDrawnPage",get:function(){for(var t=this._pageViews.length-1;t>=0;t--)if(this._pageViews[t])return this._pageViews[t];return this._pageViews[0]}},{key:"lastDrawnMeasure",get:function(){return this.lastDrawnScorePage.lastDrawnMeasure}},{key:"hasLastViewBeenCreated",get:function(){return this._pageViews.length==this.layout.totalPages&&this._pageViews[this._pageViews.length-1]&&this._pageViews[this._pageViews.length-1].layout.isActualLayout}},{key:"pageCountGuess",get:function(){if(this.isIncrementalFlowComplete)return this.layout.totalPages;var t=this._pageViews[0];if(!t)return 0;var e=t.layout.endMeasureIndex-t.layout.startMeasureIndex,i=Math.ceil(this.context.document.score.numMeasures/e);return Math.max(i,this.layout.totalPages)}},{key:"endSpritePosition",get:function(){if(this.isHorizontalFlow){var t=A.numberToInt(this.getWidthOfPages(A.numberToInt(this.pageCountGuess)));return new If(t,0)}var e=A.numberToInt(this.pageCountGuess*this.toViewUnits(this._pageMetrics.height));return new If(0,e)}},{key:"isIncrementalFlowComplete",get:function(){return this.layout.isIncrementalLayoutComplete}},{key:"isMoreFlowNeeded",get:function(){var t=this.context.documentView.viewInfo.displayScale,e=this.lastDrawnScorePage;if(this.layout.context.preview||!this.context.document.score.displayModeHasPages)return!1;if(this._targetMeasureIndex){var i=this.layout.getPageContainingMeasure(this._targetMeasureIndex);return!i||i.index>=this.layout.pageLayouts.length}return this.isHorizontalFlow?(this.context.documentView.viewportWidth+this.context.documentView.horizontalScrollPosition)/t>e.x+this.context.layoutContext.pageMetrics.width:(this.updateIncrementalFeedback(this.layout.pageLayouts.length,"page"),this.currentBottomPageIndexInViewport+1>this.layout.pageLayouts.length-1)}}]),e}();r.registerClass(ec,"com.noteflight.notation.view.PaginatedView");var ic=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._staff=null,n._addBelow=!1,n._rolled=!1,n._skin=null,n._overSkin=null,n._staff=t,n._addBelow=i,n.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(n)),n.addRollHighlight)),n.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(n)),n.removeRollHighlight)),n.addEventListener(li.MOUSE_DOWN,xt.bindMethod(u(u(n)),n.handleMouseDown)),n._skin=new dh,n.addChild(n._skin),n._overSkin=new dh,n._overSkin.visible=!1,n.addChild(n._overSkin),n}return c(e,Wr),p(e,[{key:"removeListeners",value:function(){this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.removeRollHighlight)),this.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown))}},{key:"destroy",value:function(){this.removeListeners()}},{key:"addRollHighlight",value:function(t){this._skin.visible=!1,this._overSkin.visible=!0,t.stopPropagation()}},{key:"removeRollHighlight",value:function(t){this._skin.visible=!0,this._overSkin.visible=!1,t.stopPropagation()}},{key:"handleMouseDown",value:function(t){var e=this._addBelow?Xi.ADD_BELOW:Xi.ADD_ABOVE;this.dispatchEvent(new Xi(Xi.PART_EDIT,e,this._staff)),t.stopPropagation()}}]),e}();r.registerClass(ic,"com.noteflight.notation.view.PartInserter");var nc=function(t){function e(t,i){return y(this,e),l(this,h(e).call(this,t,i))}return c(e,uh),p(e,[{key:"editText",value:function(){s(h(e.prototype),"editMeasureText",this).call(this,"Edit Performance Text",e.createPerformanceTextField)}}],[{key:"addPerformanceText",value:function(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];uh.addMeasureText({context:t,measure:i,notation:new bl(n,"",r),groupName:"Add Performance Text",createFieldFunction:e.createPerformanceTextField,box:o})}},{key:"createPerformanceTextField",value:function(t,e,i){var n;switch(e.justify){case Ca.JUSTIFY_CENTER:n=My.CENTER;break;case Ca.JUSTIFY_RIGHT:n=My.RIGHT;break;default:n=My.LEFT}var r=uh.createEditField(t,n,t.layoutContext.staffMetrics.staffTextFont,t.layoutContext.staffMetrics.performanceTextSize,!1,!1,e,0,-t.layoutContext.staffMetrics.performanceTextPadding.bottom,i);return r.multiline=!0,r}}]),e}();r.registerClass(nc,"com.noteflight.notation.view.PerformanceTextView");var rc=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._graphics=null,t}return c(e,Rr),p(e,[{key:"graphics",get:function(){return this._graphics||(this._graphics=new _f(this,this._svg)),this._graphics}}]),e}();r.registerClass(rc,"flash.display.Shape");var oc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._color=0,n._width=NaN,n._cursorHeight=NaN,n._highlights=[],n._color=t,n._width=i,n._cursorHeight=0,n.updateGraphics(),n}return c(e,rc),p(e,null,[{key:"HIGHLIGHT_WIDTH",get:function(){return 6}}]),p(e,[{key:"updateGraphics",value:function(){this.graphics.clear(),this.graphics.beginFill(this._color),this.graphics.moveTo(0,this._width*Math.SQRT1_2),this.graphics.lineTo(-this._width/2,0),this.graphics.lineTo(this._width/2,0),this.graphics.lineTo(0,this._width*Math.SQRT1_2),this.graphics.endFill(),this.graphics.lineStyle(1,this._color),this.graphics.moveTo(0,this._width),this.graphics.lineTo(0,this._cursorHeight);for(var t=0;t<this._highlights.length;t++){var i=this._highlights[t];this.graphics.lineStyle(0,0,0),this.graphics.beginFill(this._color,.5),this.graphics.moveTo(0,i.top),this.graphics.lineTo(e.HIGHLIGHT_WIDTH/2,i.top),this.graphics.lineTo(e.HIGHLIGHT_WIDTH/2,i.top+i.height),this.graphics.lineTo(-e.HIGHLIGHT_WIDTH/2,i.top+i.height),this.graphics.lineTo(-e.HIGHLIGHT_WIDTH/2,i.top),this.graphics.lineTo(0,i.top),this.graphics.endFill()}}},{key:"hideCursor",value:function(){this.visible=!1,this.x=this._width,this.y=0}},{key:"clearHighlights",value:function(){this._highlights=[]}},{key:"addHighlight",value:function(t,e){this._highlights.push(new R(t,e))}},{key:"cursorHeight",set:function(t){this._cursorHeight=t,this.updateGraphics()}}]),e}();r.registerClass(oc,"com.noteflight.notation.view.PlaybackCursor");var sc=function(t){function e(t,i,n,r,o){var s;y(this,e),(s=l(this,h(e).call(this))).x=t,s.y=i,s.graphics.lineStyle(o.lineThickness*o.lineSpacing,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),s.graphics.moveTo(0,0);var a=r-o.bendArrowHeight*o.lineSpacing;return s.graphics.curveTo(n,0,n,a),s.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.MITER),s.graphics.beginFill(0),s.graphics.moveTo(n,r),s.graphics.lineTo(n-o.bendArrowWidth*o.lineSpacing/2,a),s.graphics.lineTo(n+o.bendArrowWidth*o.lineSpacing/2,a),s.graphics.lineTo(n,r),s.graphics.endFill(),s}return c(e,Wr),e}();r.registerClass(sc,"com.noteflight.notation.view.ReleaseView");var ac=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Ku),p(e,[{key:"updateGraphics",value:function(){this.graphics.clear(),this.graphics.lineStyle(this.strokeThickness,0,this.strokeAlpha),this.graphics.beginFill(16777215,0),this.graphics.drawEllipse(-this.handleSize/2,-this.handleSize/2,this.handleSize,this.handleSize),this.graphics.endFill()}}]),e}();r.registerClass(ac,"com.noteflight.notation.view.RoundHandle");var lc=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,Wr),e}();r.registerClass(lc,"mx.core.FlexSprite");var uc=function t(){y(this,t)};r.implementsInterfaces(uc,[vt]),r.registerClass(uc,"mx.core.IFlexDisplayObject");var hc=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,lc),p(e,null,[{key:"DEFAULT_MAX_HEIGHT",get:function(){return 1e4}},{key:"DEFAULT_MAX_WIDTH",get:function(){return 1e4}},{key:"DEFAULT_MEASURED_HEIGHT",get:function(){return 22}},{key:"DEFAULT_MEASURED_MIN_HEIGHT",get:function(){return 22}},{key:"DEFAULT_MEASURED_MIN_WIDTH",get:function(){return 40}},{key:"DEFAULT_MEASURED_WIDTH",get:function(){return 160}}]),p(e,[{key:"callLater",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D.mx_core_UIComponent_callLater(this,t,e)}},{key:"setFocus",value:function(){this.stage.focus=null}},{key:"createChildren",value:function(){}},{key:"commitProperties",value:function(){}}]),e}();r.implementsInterfaces(hc,[uc]),r.registerClass(hc,"mx.core.UIComponent");var cc=function t(){y(this,t)};r.registerClass(cc,"mx.managers.IFocusManagerComponent");var dc=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return y(this,e),(t=l(this,h(e).call(this)))._scoreDocument=null,t._scoreView=null,t._scoreLayout=null,t._viewContext=null,t._context=null,t._notationView=null,t._feedbackLayer=null,t._notationLayer=null,t._playbackCursor=null,t._scrolling=!1,t._manualScrollWithMouseClick=!1,t._$forceManualScrolling=!1,t._forceManualScrollingTime=new Date,t.MIN_TIME_SET_MANUAL_SCROLLING=1e3,t._glyphFontLoader=null,t._dragAutoScrollEnabled=!1,t._dragAutoScrollOrigin=null,t.autoPosLocation=new If(0,0),t._priorSelectionPositioningState=0,t._$viewInfo=null,t._$complete=!1,t.preview=!1,t.watermarkUrl="",t.watermarkScale=1,t._transparentPlaybackCursor=!1,t._overlay=!1,t.overlayMediator=null,t.cachedShadows={},t._overlay=i,i?(t.viewInfo=new Jh,t.overlayMediator=new re(u(u(t)))):(t.viewInfo=new qh,t.overlayMediator=new oe(u(u(t)))),t.addEventListener(Yy.INITIALIZE,xt.bindMethod(u(u(t)),t.handleInitialize)),t}return c(e,hc),p(e,null,[{key:"DRAG_SCROLL_THRESHOLD",get:function(){return 40}},{key:"DRAG_SCROLL_AMOUNT",get:function(){return 20}},{key:"SELPOS_NULL",get:function(){return-1}},{key:"SELPOS_INVALID",get:function(){return 0}},{key:"SELPOS_OFF",get:function(){return 1}},{key:"SELPOS_ON",get:function(){return 2}},{key:"MIN_TIME_TO_SCROLL_TO_NEXT_MEASURE",get:function(){return.7}}]),p(e,[{key:"showHtml5Shadow",value:function(){return this._viewContext&&this._viewContext.controller.showHtml5Shadow()}},{key:"createChildren",value:function(){s(h(e.prototype),"createChildren",this).call(this),this._notationLayer=new $y,this.addChild(this._notationLayer),this._notationView=new hc,this._notationLayer.addChild(this._notationView),this._feedbackLayer=new hc,this._notationLayer.addChild(this._feedbackLayer),this._playbackCursor=new oc(A.unknownToUint(this.viewInfo.selectionColors[0]),8),this._playbackCursor.hideCursor(),this.transparentPlaybackCursor&&this.makePlaybackCursorTransparent(),this._feedbackLayer.addChild(this._playbackCursor)}},{key:"makePlaybackCursorTransparent",value:function(){this._playbackCursor&&(this._playbackCursor.alpha=0)}},{key:"initializeView",value:function(){this.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.captureMouseDown),!0),this.addEventListener(li.MOUSE_UP,xt.bindMethod(this,this.captureMouseUp),!0)}},{key:"handleInitialize",value:function(t){this.initializeView()}},{key:"handleMouseDown",value:function(t){this.setFocus()}},{key:"captureMouseDown",value:function(t){}},{key:"captureMouseUp",value:function(t){this._manualScrollWithMouseClick=!1}},{key:"enableNotationViews",value:function(t){this._notationLayer.mouseChildren=t}},{key:"ensureSelectionVisible",value:function(){this.scoreDocument.requestModelChange(xt.bindMethod(this,this.doEnsureSelectionVisible),1)}},{key:"doEnsureSelectionVisible",value:function(){var t=this.scoreDocument.selection;t&&this.scrollToPosition(t.selectedRange.start)}},{key:"handleIncrementalLayoutStepInitiated",value:function(t){this._priorSelectionPositioningState=this.selectionPositioningState}},{key:"handleIncrementalLayoutStepComplete",value:function(t){this.selectionPositioningState!=this._priorSelectionPositioningState&&this.doEnsureSelectionVisible()}},{key:"showPositionCursor",value:function(t){this.scrollToPosition(t,!0)}},{key:"hidePositionCursor",value:function(){this._playbackCursor.hideCursor()}},{key:"setForceManualScrolling",value:function(t){this.forceManualScrolling=t,this._forceManualScrollingTime=new Date}},{key:"resumeScrolling",value:function(){var t=this._viewContext.documentController.performer.position;if(t){this.setForceManualScrolling(!1);var e=this.getPointInMeasure(t.measureIndex,null,t.position,{verticalAlign:"top"});this.scrollToPoint(e)}}},{key:"highlightStavesWithCursor",value:function(t){if(this._playbackCursor.clearHighlights(),this._viewContext.controller.highlightPartWithCursor()&&this._playbackCursor.visible){for(var e=this._viewContext.controller.partToHighlight.staves,i=0;i<e.length;i++){var n=this.getPointInMeasure(t.measureIndex,A.unknownToType(e[i],Rl),t.position,{verticalAlign:"top"}),r=this.getPointInMeasure(t.measureIndex,A.unknownToType(e[i],Rl),t.position,{verticalAlign:"bottom"});if(n&&r){var o=this._feedbackLayer.globalToLocal(n),s=this._feedbackLayer.globalToLocal(r);this._playbackCursor.addHighlight(o.y-this._playbackCursor.y,s.y-o.y)}}this._playbackCursor.updateGraphics()}}},{key:"scrollToPosition",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t&&!this._overlay){var r=t,o=this._viewContext.controller.performer.temporalMap,s=this.scoreDocument.score.getSystemStaffMeasureAt(t.measureIndex);this._viewContext.controller.isPlaying&&n&&t.position>=s.duration/2&&o.scorePositionToTime(s.scorePosition+s.duration)-o.scorePositionToTime(s.scorePosition+t.position)<e.MIN_TIME_TO_SCROLL_TO_NEXT_MEASURE&&n.nextMeasurePositionIfAny&&(r=n.nextMeasurePosition),this._scoreView.ensureSystemAfterMeasureDrawn(t.measureIndex);var a=this.measurePositionToViewSegment(r),l=this.measurePositionToViewSegment(t);a?(i&&l&&this.updatePlaybackCursor(l),this.doScrollToPosition(a,i),this.highlightStavesWithCursor(t)):this._playbackCursor.visible=!1}}},{key:"measurePositionToViewSegment",value:function(t){var e,i;return t&&(e=this.getPointInMeasure(t.measureIndex,null,t.position,{verticalAlign:"top"}),i=this.getPointInMeasure(t.measureIndex,null,t.position,{verticalAlign:"bottom"}),e&&i)?new Qo(e.x,e.y,1,i.y-e.y):null}},{key:"doScrollToPosition",value:function(t,e){if(this.updatePlaybackScrollMode(t),!(this.autoscrolling||e&&this.forceManualScrolling)){var i=this.controller.score.isPerformMode||e,n=this.bringSegmentIntoView(t,i);n&&this.scrollToPoint(n)}}},{key:"getViewFrame",value:function(){var t=this.scoreDocument.score.isStripMode,e=this.scoreDocument.score.isPerformMode,i=t?10+this.overlayMediator.scaledOverlayWidth:0,n=e?0:25,r=this.viewportWidth-(t?10:0),o=this.viewportHeight;return new Qo(i,n,r-i,o-n)}},{key:"bringSegmentIntoView",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getViewFrame(),r=e.bringIntoView(t.left,t.right,n.left,n.right,i),o=e.bringIntoView(t.top,t.bottom,n.top,n.bottom,i);return 0!==r||0!==o?new If(this.horizontalScrollPosition+r,this.verticalScrollPosition+o):null}},{key:"updatePlaybackCursor",value:function(t){this._playbackCursor.visible||(this._manualScrollWithMouseClick=!1,this.setForceManualScrolling(!1),this._playbackCursor.clearHighlights());var e=this._feedbackLayer.globalToLocal(t.topLeft);this._playbackCursor.visible=!0,this._playbackCursor.x=e.x,this._playbackCursor.y=e.y;var i=this._feedbackLayer.globalToLocal(t.bottomRight);this._playbackCursor.cursorHeight=i.y-e.y}},{key:"updatePlaybackScrollMode",value:function(t){var e=t.topLeft,i=t.bottomRight;(new Date).getTime()-this._forceManualScrollingTime.getTime()>this.MIN_TIME_SET_MANUAL_SCROLLING&&(e.y>0&&e.y<this.stage.height||i.y>0&&i.y<this.stage.height)&&this.setForceManualScrolling(!1)}},{key:"scrollToPoint",value:function(t){}},{key:"pageTopForY",value:function(t){if(0===t)return 0;if(A.is(this._scoreView,ec)){var e=A.unknownToType(this._scoreView,ec).pageViews;if(e.length>0){var i=e[0].localToGlobal(new If(0,0)).y;if(t<i)return i}var n=0,r=!0,o=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value.localToGlobal(new If(0,0)).y;if(n<t&&t<u)return(u+n)/2-t>=0?n:u;n=u}}catch(t){o=!0,s=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}if(n)return n}return t}},{key:"initializeDragAutoScroll",value:function(){this._dragAutoScrollEnabled=!1,this._dragAutoScrollOrigin=new If(this.mouseX,this.mouseY)}},{key:"handleDragAutoScroll",value:function(){}},{key:"createNewLayoutContext",value:function(){return new ls}},{key:"createLayoutContext",value:function(t){var e=this.createNewLayoutContext();return e.score=t,e.stripMetrics=new Ta,e}},{key:"handleMeasureSequenceChange",value:function(t){null!=t.measures||t.measureIndices.length?(t.measures[0].clearMeasureNumberCache(),this._scoreLayout.handleMeasureSequenceChange(t),this.updateScoreDimensions()):(this._scoreLayout.score.clearMeasureNumbersCache(),this.updateLayout())}},{key:"handleMeasureValidate",value:function(t){jd.pushTimer("ScoreDocumentView","handleMeasureValidate"),null==t.measures?this.updateLayout():(this._scoreLayout&&this._scoreLayout.handleMeasureValidate(t),this.updateScoreDimensions()),jd.popTimer("ScoreDocumentView","handleMeasureValidate")}},{key:"handleMeasureGeometryChange",value:function(t){jd.pushTimer("ScoreDocumentView","handleMeasureValidate"),this._scoreLayout.handleMeasureGeometryChange(t),jd.popTimer("ScoreDocumentView","handleMeasureValidate")}},{key:"handleMeasureSpanChange",value:function(t){this._scoreLayout&&this._scoreLayout.handleMeasureSpanChange(t)}},{key:"handleFoundryChange",value:function(t){this._context.foundry=null,this.scoreDocument.rebuildScore()}},{key:"handleModelUpdate",value:function(t){if(A.is(t.source,Nl))switch(t.property.toString()){case"viewScale":this.setScale(A.unknownToNumber(t.newValue));break;case"displayMode":this.setDisplayMode(t.newValue.toString())}}},{key:"handleModeChange",value:function(t){this._viewContext&&this._viewContext.controller.modeRequiresShowCursor()?this.showPositionCursor(this._viewContext.controller.pausePosition):this.hidePositionCursor(),t.forceScoreBuild&&this.forcePageFlow()}},{key:"forcePageFlow",value:function(){this.dispatchEvent(new ci(ci.FORCE_PAGE_FLOW))}},{key:"forceFirstMeasuresToBeShown",value:function(){this._scoreView.forceFirstMeasuresToBeShown()}},{key:"setScale",value:function(t){var e=this.viewInfo.displayScale;this.viewInfo.displayScale=t;var i=this.horizontalScrollPosition,n=this.verticalScrollPosition;this._notationLayer.scaleX=this.viewInfo.displayScale,this._notationLayer.scaleY=this.viewInfo.displayScale;var r=this.viewInfo.displayScale/e;this.horizontalScrollPosition=(i+this.width/2)*r-this.width/2,this.verticalScrollPosition=(n+this.height/2)*r-this.height/2,this.dispatchEvent(new ci(ci.DISPLAY_SCALE_CHANGE)),this._overlay&&this.overlayMediator.checkOverlayWidth()}},{key:"setDisplayMode",value:function(t){this.viewContext&&this.viewContext.globalInvalidation(),this.viewInfo.displayMode=t,null!=this._scoreLayout&&(this.horizontalScrollPosition=this.verticalScrollPosition=0,this.scoreDocument.rebuildScore())}},{key:"createFoundryForContext",value:function(t){if(null==t.foundry){var e=this._glyphFontLoader.getFoundryFactory(t.staffMetrics.glyphFamily);t.foundry=e.createFoundry(t.staffMetrics.createFoundryMetrics())}}},{key:"updateLayout",value:function(){var t=0!=(this.scoreDocument.permissions&ei.ASH_FONT_PERMISSION);this._glyphFontLoader.loadGlyphsAndFonts({fonts:this._context.staffMetrics.fonts,glyphFamily:this._context.staffMetrics.glyphFamily,supportAshFont:t,callback:xt.bindMethod(this,this.doUpdateLayout)})}},{key:"doUpdateLayout",value:function(){for(jd.pushTimer("ScoreDocumentView","doUpdateLayout"),this.createFoundryForContext(this._context),ws.clear(),null!=this._scoreLayout&&(this._scoreLayout.destroy(),this._scoreLayout.document=null,this.hidePositionCursor()),this.scoreDocument.resetValidation();this._notationView.numChildren>0;)this._notationView.removeChildAt(0);switch(jd.pushTimer("ScoreDocumentView","create layout"),this.viewInfo.displayMode){case Nl.STRIP_DISPLAY:this._scoreLayout=new Fs(this._context,this.viewInfo.buildIncrementally,this._overlay),this._scoreLayout.document=this.scoreDocument,this._scoreLayout.prepareLayout();break;default:this._scoreLayout=this.createPaginatedLayout(this._context,this.viewInfo.buildIncrementally,this._overlay),this._scoreLayout.document=this.scoreDocument,this._scoreLayout.validateLayout()}jd.popTimer("ScoreDocumentView","create layout"),this._viewContext=this.createViewContext(),jd.pushTimer("ScoreDocumentView","create display object"),this._scoreView&&(this._scoreView.removeEventListener(Mi.INCREMENTAL_LAYOUT_STEP_INITIATED,xt.bindMethod(this,this.handleIncrementalLayoutStepInitiated)),this._scoreView.removeEventListener(Mi.INCREMENTAL_LAYOUT_STEP_COMPLETE,xt.bindMethod(this,this.handleIncrementalLayoutStepComplete)),this._scoreView.destroy()),this._scoreView=A.as(this._scoreLayout.createDisplayObject(this._viewContext),tc),jd.popTimer("ScoreDocumentView","create display object"),this.overlayMediator.setup(),this._scoreView.addEventListener(Mi.INCREMENTAL_LAYOUT_STEP_INITIATED,xt.bindMethod(this,this.handleIncrementalLayoutStepInitiated)),this._scoreView.addEventListener(Mi.INCREMENTAL_LAYOUT_STEP_COMPLETE,xt.bindMethod(this,this.handleIncrementalLayoutStepComplete)),this._notationView.addChild(this._scoreView),this._notationLayer.scaleX=this.viewInfo.displayScale,this._notationLayer.scaleY=this.viewInfo.displayScale,this.updateScoreDimensions(),this.scoreDocument.dispatchEvent(new ci(ci.LAYOUT_UPDATED)),jd.popTimer("ScoreDocumentView","doUpdateLayout")}},{key:"createViewContext",value:function(){return null}},{key:"createPaginatedLayout",value:function(t,e,i){return new Es(t,e,i)}},{key:"updateScoreDimensions",value:function(){null!=this._scoreView&&(this._notationView.height=this.height,this._notationView.width=this.width)}},{key:"updateDisplayList",value:function(t,e){if(null!=this.scoreDocument){this._notationLayer.height<e?this.viewInfo.displayTop=(this.height-this._notationLayer.height)/2:this.viewInfo.displayTop=0;var i=this.viewInfo.displayTop;this._notationLayer.y!=i&&(this._notationLayer.y=i,this.dispatchEvent(new ci(ci.SCORE_LAYOUT_CHANGE)))}}},{key:"keyDownHandler",value:function(t){}},{key:"addFeedbackChild",value:function(t){this._feedbackLayer.addChild(t)}},{key:"removeFeedbackChild",value:function(t){this._feedbackLayer.contains(t)&&this._feedbackLayer.removeChild(t)}},{key:"globalToFeedback",value:function(t){return this._feedbackLayer.globalToLocal(t)}},{key:"getPointInMeasure",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._scoreView.getPointInMeasure(t,e,i,n)}},{key:"getPositionUnderPoint",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this._scoreView.getPositionUnderPoint(t,e,i,n,r)}},{key:"editAnnotation",value:function(t){}},{key:"getAnnotationPosition",value:function(t){var e=A.unknownToType(t.parent,he);return this.globalToLocal(this.getPointInMeasure(e.measure.index,null,e.position,{verticalAlign:"top"}))}},{key:"rebuildLayout",value:function(){this.dispatchEvent(new ci(ci.REBUILD_LAYOUT))}},{key:"resetScrollPosition",value:function(){this.verticalScrollPosition=0,this.horizontalScrollPosition=0}},{key:"activateFocusManager",value:function(){}},{key:"deactivateFocusManager",value:function(){}},{key:"forceManualScrolling",get:function(){return this._$forceManualScrolling},set:function(t){var e=this._$forceManualScrolling;this._$forceManualScrolling=t,e!==t&&this._propertyChanged("forceManualScrolling",e,t)}},{key:"viewInfo",get:function(){return this._$viewInfo},set:function(t){var e=this._$viewInfo;this._$viewInfo=t,e!==t&&this._propertyChanged("viewInfo",e,t)}},{key:"complete",get:function(){return this._$complete},set:function(t){var e=this._$complete;this._$complete=t,e!==t&&this._propertyChanged("complete",e,t)}},{key:"layoutContext",get:function(){return this._context}},{key:"viewContext",get:function(){return this._viewContext}},{key:"notationView",get:function(){return this._notationView}},{key:"scoreView",get:function(){return this._scoreView}},{key:"viewportWidth",get:function(){return this.width}},{key:"viewportHeight",get:function(){return this.height}},{key:"scoreDocument",get:function(){return this._scoreDocument},set:function(t){null!=this._scoreDocument&&(this._scoreDocument.removeEventListener(Ai.SEQUENCE_CHANGE,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.removeEventListener(Ai.ADD,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.removeEventListener(Ai.REMOVE,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.removeEventListener(Ai.VALIDATE,xt.bindMethod(this,this.handleMeasureValidate)),this._scoreDocument.removeEventListener(Ai.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureGeometryChange)),this._scoreDocument.removeEventListener(Ai.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureSpanChange)),this._scoreDocument.removeEventListener(Ai.FOUNDRY_CHANGE,xt.bindMethod(this,this.handleFoundryChange)),this._scoreDocument.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate)),this._scoreDocument.removeEventListener(Qi.MODE_CHANGE,xt.bindMethod(this,this.handleModeChange))),this._scoreDocument=t,null!=this._scoreDocument&&(this._context=this.createLayoutContext(this._scoreDocument.score),this._overlay||(this._scoreDocument.layoutContext=this._context),this._context.preview=this.preview,this.viewInfo.displayMode=this._scoreDocument.score.displayMode,this.viewInfo.displayScale=this._scoreDocument.score.viewScale,this._scoreDocument.addEventListener(Ai.SEQUENCE_CHANGE,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.addEventListener(Ai.ADD,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.addEventListener(Ai.REMOVE,xt.bindMethod(this,this.handleMeasureSequenceChange)),this._scoreDocument.addEventListener(Ai.VALIDATE,xt.bindMethod(this,this.handleMeasureValidate)),this._scoreDocument.addEventListener(Ai.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureGeometryChange)),this._scoreDocument.addEventListener(Ai.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureSpanChange)),this._scoreDocument.addEventListener(Ai.FOUNDRY_CHANGE,xt.bindMethod(this,this.handleFoundryChange)),this._scoreDocument.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate)),this._scoreDocument.addEventListener(Qi.MODE_CHANGE,xt.bindMethod(this,this.handleModeChange)))}},{key:"verticalScrollPosition",get:function(){return 0},set:function(t){}},{key:"horizontalScrollPosition",get:function(){return 0},set:function(t){}},{key:"transparentPlaybackCursor",set:function(t){this._transparentPlaybackCursor=t,this.transparentPlaybackCursor&&this.makePlaybackCursorTransparent()},get:function(){return this._transparentPlaybackCursor}},{key:"glyphFontLoader",get:function(){return this._glyphFontLoader},set:function(t){this._glyphFontLoader=t}},{key:"overlay",get:function(){return this._overlay}},{key:"overlayWidth",get:function(){return this.overlayMediator.overlayWidth}},{key:"scrolling",get:function(){return this._scrolling},set:function(t){this._scrolling=t}},{key:"selectionPositioningState",get:function(){var t=this.scoreDocument.selection;if(!t)return e.SELPOS_NULL;var i=this.measurePositionToViewSegment(t.selectedRange.start);return i?null==this.bringSegmentIntoView(i)?e.SELPOS_ON:e.SELPOS_OFF:e.SELPOS_INVALID}},{key:"autoscrolling",get:function(){return this._manualScrollWithMouseClick&&this._playbackCursor.visible||this._scrolling}},{key:"scoreLayout",get:function(){return this._scoreLayout}},{key:"width",get:function(){return this._scoreView?this._scoreView.width*this.viewInfo.displayScale:0},set:function(t){o(h(e.prototype),"width",t,this,!0)}},{key:"height",get:function(){return this._scoreView?this._scoreView.height*this.viewInfo.displayScale:0},set:function(t){o(h(e.prototype),"height",t,this,!0)}},{key:"embedHeight",get:function(){var t=(this.layoutContext.staffMetrics.staffSpacing+5)*this.scoreDocument.score.numStaves;return t+=2*this.layoutContext.staffMetrics.systemSpacing,A.numberToInt(t*this.layoutContext.staffMetrics.lineSpacing+16)}},{key:"embedWidth",get:function(){return 640}}],[{key:"bringIntoView",value:function(t,e,i,n,r){var o=t-i>=0,s=n-e>=0,a=t-i,l=e-(n-i),u=0;return!o&&s?u=r?l:Math.max(a,l):o&&!s&&(u=r?a:Math.min(a,l)),u}}]),e}();r.implementsInterfaces(dc,[cc]),r.registerClass(dc,"com.noteflight.notation.view.ScoreDocumentView");var fc=function(t){function e(t,i,n,r,o){var s;return y(this,e),(s=l(this,h(e).call(this,t))).showPrompt=!0,s.clearSelectionOnFocus=!0,s.autoCommitChars="",s.autoCommitFunction=null,s.commitChar=null,s._markdown=!1,s._textField=null,s._model=null,s._property=null,s._editGroupName=null,s._font=null,s._size=NaN,s._maxSize=NaN,s._bold=!1,s._italic=!1,s._underline=!1,s._autoSize=null,s._text=null,s._wordWrap=!1,s._textWidth=0,s._editableElement=!0,s._updateTextCallback=null,s._autoSize=i,s._font=n,s._size=r,o.maxSize&&(s._maxSize=o.maxSize),o.bold&&(s._bold=o.bold),o.italic&&(s._italic=o.italic),o.underline&&(s._underline=o.underline),o.model&&(s._model=o.model),o.property&&(s._property=o.property),o.editGroupName&&(s._editGroupName=o.editGroupName),o.markdown&&(s._markdown=o.markdown),o.updateTextCallback&&(s._updateTextCallback=o.updateTextCallback),void 0!==o.editableElement&&(s._editableElement=o.editableElement),s.initializeView(),s}return c(e,Ju),p(e,null,[{key:"_scoreTextFieldWithFocus",get:function(){return yc},set:function(t){yc=t}}]),p(e,[{key:"setFocus",value:function(){this.context.documentView.deactivateFocusManager(),this.context.documentView.stage.focus=this._textField}},{key:"highlightEnd",value:function(){this._textField.text.length>0&&this._textField.setSelection(this._textField.text.length,this._textField.text.length)}},{key:"removeListeners",value:function(){this._textField&&(this._textField.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._textField.removeEventListener(ui.KEY_DOWN,xt.bindMethod(this,this.handleKeyDown)),this._textField.removeEventListener(xf.FOCUS_IN,xt.bindMethod(this,this.handleFocusIn)),this._textField.removeEventListener(xf.FOCUS_OUT,xt.bindMethod(this,this.handleFocusOut)),this._textField.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleJSClick)),this._markdown&&!this.editable&&this._textField.removeEventListener(kf.LINK,xt.bindMethod(this,this.handleLink)),null!=this._model&&this._model.removeEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate)))}},{key:"updateView",value:function(){null!=this._textField&&this._textField.parent==this&&this.removeChild(this._textField),this._textField=e.createTextField(this.staffMetrics,this._font,this._size,this._bold,this._italic,this._underline,this._autoSize,this._maxSize),this._textField.addEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this._textField.addEventListener(ui.KEY_DOWN,xt.bindMethod(this,this.handleKeyDown)),this._textField.addEventListener(xf.FOCUS_IN,xt.bindMethod(this,this.handleFocusIn)),this._textField.addEventListener(xf.FOCUS_OUT,xt.bindMethod(this,this.handleFocusOut)),this._textField.addEventListener(li.CLICK,xt.bindMethod(this,this.handleJSClick)),this._markdown&&!this.editable&&this._textField.addEventListener(kf.LINK,xt.bindMethod(this,this.handleLink)),null!=this._model?(this._textField.type=this.editable?by.INPUT:by.DYNAMIC,this._textField.selectable=!0,this._model.addEventListener(Di.MODEL_UPDATE,xt.bindMethod(this,this.handleModelUpdate),!1,0,!0),this.updateText()):(this._textField.type=by.DYNAMIC,this._textField.selectable=!1),this._textField.wordWrap=this._wordWrap,this._wordWrap&&this._textWidth>0&&(this._textField.width=this._textWidth),this.addChild(this._textField)}},{key:"setFieldText",value:function(t,e){this._autoSize==My.RIGHT&&e.search(/[\n\r]/)>=0&&(t.defaultTextFormat=new Ly(t.defaultTextFormat.font,t.defaultTextFormat.size,null,this._bold,this._italic,this._underline,null,null,wy.RIGHT)),t.text=e}},{key:"setTextWidth",value:function(t){this._textWidth=t,this._textField.width=t}},{key:"setColor",value:function(t){this._textField.textColor=t}},{key:"adjustTextPosition",value:function(){switch(this._textField.autoSize){case My.NONE:case My.LEFT:break;case My.CENTER:this._textField.x=-(this._textField.textWidth+4)/2;break;case My.RIGHT:this._textField.x=-(this._textField.textWidth+4)}}},{key:"commitValue",value:function(){this._text=this._textField.text.replace(/^\s+|\s+$/g,""),this._model.getModelProperty(this._property)==this.text||this.valueIsPrompt&&""===this.text||(null!=this._editGroupName&&(this.context.controller.document.undoHistory.openGroupName=this._editGroupName),this._model.setModelProperty(this._property,this.text)),this.dispatchEvent(new Yy(Yy.VALUE_COMMIT)),this._markdown&&this.updateView()}},{key:"updateText",value:function(){null!=this._model.getModelProperty(this._property)&&this._model.getModelProperty(this._property).toString().replace(/^\s+|\s+$/g,"").length>0||this.context.info&&this.context.info.printView||!this.editable||!this.showPrompt?(this.text=null==this._model.getModelProperty(this._property)?"":this._model.getModelProperty(this._property).toString(),this._textField.textColor=0):(this.text=null==this._editGroupName?"":"("+this._editGroupName+")",this._textField.textColor=13421772),this._updateTextCallback&&this._updateTextCallback()}},{key:"handleModelUpdate",value:function(t){t.property==this._property&&this.updateText()}},{key:"handleMouseDown",value:function(t){t.stopPropagation()}},{key:"handleJSClick",value:function(t){this.editable&&this.context.controller.isNotationInteractionAvailable()&&(this.stage.focus=this._textField,t.stopPropagation())}},{key:"handleKeyDown",value:function(t){t.stopPropagation();var e=t.charCode>0?t.charCode:t.keyCode;this.autoCommitChars.indexOf(String.fromCharCode(e))>=0&&(null==this.autoCommitFunction||this.autoCommitFunction(this,t))?(this.commitChar=String.fromCharCode(e),t.preventDefault(),this.context.documentView.setFocus()):27==t.keyCode&&(t.preventDefault(),this.context.documentView.setFocus())}},{key:"handleFocusIn",value:function(t){this.editable&&(this._textField.background=!0,""===this._model.getModelProperty(this._property)||this.valueIsPrompt?(this.text="",this._textField.textColor=0):this._textField.text=this.text,this.clearSelectionOnFocus&&(this.context.controller.document.undoHistory.openGroup("Clear Selection"),this.context.controller.clearSelection()),this.context.documentView.deactivateFocusManager(),e._scoreTextFieldWithFocus=this)}},{key:"handleFocusOut",value:function(t){if(this.editable){this._textField.background=!1,this.commitValue(),this.updateText(),e._scoreTextFieldWithFocus=null;var i=this;X.flash_utils_setTimeout(function(){null==e._scoreTextFieldWithFocus&&i.context.documentView.activateFocusManager()},0)}}},{key:"handleLink",value:function(t){X.flash_net_navigateToURL(new Ff(t.text),"_blank")}},{key:"model",get:function(){return this._model}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this.setFieldText(this._textField,t),this.adjustTextPosition()}},{key:"uncommittedText",get:function(){return this._textField.text}},{key:"multiline",get:function(){return this._textField.multiline},set:function(t){this._textField.multiline=t}},{key:"wordWrap",set:function(t){this._wordWrap=t,this._textField.wordWrap=t},get:function(){return this._textField.wordWrap}},{key:"ascent",get:function(){return this._textField.getLineMetrics(0).ascent+2}},{key:"width",get:function(){return this.textMeasurement.textWidth(this._svg)},set:function(t){}},{key:"height",get:function(){return this.textMeasurement.textHeight(this._svg)},set:function(t){}},{key:"valueIsPrompt",get:function(){return!!this.model.getModelProperty(this._property).toString().match(/^([_?]+)$/)}},{key:"editable",get:function(){return!!this._editableElement&&(!(null==this.context.document||!this.context.document.isModelEditable(this._model))||s(h(e.prototype),"editable",this))}}],[{key:"getTextWidth",value:function(t,i,n,r,o,s,a){var l=e.createTextField(t,i,n,r,o,s,My.LEFT);return l.text=a,l.textWidth/t.lineSpacing}},{key:"getTextHeight",value:function(t,i,n,r,o,s,a,l,u,h){var c=e.createTextField(t,i,n,r,o,s,My.LEFT);return c.multiline=l,c.wordWrap=u,null!=h&&0===h.length&&(h="A"),c.text=h,c.width=a,c.textHeight/t.lineSpacing}},{key:"createTextField",value:function(t,e,i,n,r,o,s){var a,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;switch(s){case My.RIGHT:a=wy.RIGHT;break;case My.CENTER:a=wy.CENTER;break;default:a=wy.LEFT}var u=new Ty,h=i<0?t.creditFontSize*-i:t.baseFontSize*i;return l>0&&(h=Math.min(h,l)),u.antiAliasType=vy.ADVANCED,u.embedFonts=!0,u.defaultTextFormat=new Ly(e,h,null,n,r,o,null,null,a),u.textColor=0,u.autoSize=s,u.backgroundColor=16777215,u.background=!1,u}}]),e}(),yc=null;r.registerClass(fc,"com.noteflight.notation.view.ScoreTextField");var gc=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t))}return c(e,Ku),p(e,[{key:"updateGraphics",value:function(){this.graphics.clear(),this.graphics.lineStyle(this.strokeThickness,0,this.strokeAlpha),this.graphics.beginFill(16777215,0),this.graphics.drawRect(-this.handleSize/2,-this.handleSize/2,this.handleSize,this.handleSize),this.graphics.endFill()}}]),e}();r.registerClass(gc,"com.noteflight.notation.view.SelectionHandle");var pc=function(t){function e(t,i,n,r){var o;y(this,e),(o=l(this,h(e).call(this,t,i)))._slur=null,o._p1=null,o._p2=null,o._dist=NaN,o._c1=null,o._c2=null,o._delta=NaN,o._halfWidth=NaN,o._slur=i.slur,o._p1=n,o._p2=r,o._dist=If.distance(o._p2,o._p1);var s,a,u=2*e.slurHeight(o._dist,o.staffMetrics),c=2*Math.PI/360*45,d=Math.atan2(o._p2.y-o._p1.y,o._p2.x-o._p1.x),f=Math.abs(o._slur.slurHeight)*Math.cos(d),g=2*e.slurHeight(o._dist,o.staffMetrics,f);return o._slur.direction==he.DIRECTION_UP&&(c=-c),0===o._slur.cx1&&0===o._slur.cy1?(s=Math.cos(d+c)*u,a=Math.sin(d+c)*g,o._c1=o._p1.add(new If(s,a))):(o._c1=new If(o._p1.x+o._slur.cx1*o.staffMetrics.lineSpacing,o._p1.y-o._slur.cy1*o.staffMetrics.lineSpacing),i.endBreak&&(o._c1.x=Math.min(o._c1.x,o._p1.x+.5*(o._p2.x-o._p1.x)))),0===o._slur.cx2&&0===o._slur.cy2?(s=Math.cos(d+Math.PI-c)*u,a=Math.sin(d+Math.PI-c)*g,o._c2=o._p2.add(new If(s,a))):(o._c2=new If(o._p2.x+o._slur.cx2*o.staffMetrics.lineSpacing,o._p2.y-o._slur.cy2*o.staffMetrics.lineSpacing),i.startBreak&&(o._c2.x=Math.max(o._c2.x,o._p2.x+.5*(o._p1.x-o._p2.x)))),o._halfWidth=(o._p2.x-o._p1.x)/2,o.initializeView(),o}return c(e,gh),p(e,null,[{key:"HANDLE_DISPLAY_THRESHOLD",get:function(){return 30}}]),p(e,[{key:"updateView",value:function(){for(s(h(e.prototype),"updateView",this).call(this);this.numChildren>0;)this.removeChildAt(0);if(null!=this._slur.slurArticulation){var t=this.context.layoutContext.foundry.getArticulation(this._slur.slurArticulation,!0,!1);if(null!=t){var i=t.createDisplayObject(this.context.info),n=this.cMid,r=this._c1.y+this._c2.y>this._p1.y+this._p2.y;i.x=(this._p1.x+this._p2.x)/2,i.y=n.y+(r?1:-1)*this.staffMetrics.slurArticulationPadding*t.height,this.addChild(i)}}0!==this._halfWidth&&(this.graphics.beginFill(0),this.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.BEVEL),this.graphics.moveTo(this._p1.x,this._p1.y),this._delta=this.staffMetrics.tieMaxStroke*this.staffMetrics.lineSpacing/2,Nc.cubicToQuadratic(xt.bindMethod(this,this.lineTo),xt.bindMethod(this,this.curveTo),this._p1.x,this._p1.y,this._c1.x,this._c1.y,this._c2.x,this._c2.y,this._p2.x,this._p2.y,this.staffMetrics.slurTolerance),this._delta=-this._delta,Nc.cubicToQuadratic(xt.bindMethod(this,this.lineTo),xt.bindMethod(this,this.curveTo),this._p2.x,this._p2.y,this._c2.x,this._c2.y,this._c1.x,this._c1.y,this._p1.x,this._p1.y,this.staffMetrics.slurTolerance),this.graphics.endFill(),this.graphics.lineStyle(4,0,0),this._delta=0,this.graphics.moveTo(this._p1.x,this._p1.y),Nc.cubicToQuadratic(xt.bindMethod(this,this.lineTo),xt.bindMethod(this,this.curveTo),this._p1.x,this._p1.y,this._c1.x,this._c1.y,this._c2.x,this._c2.y,this._p2.x,this._p2.y,this.staffMetrics.slurTolerance))}},{key:"mapY",value:function(t,e){return e+this._delta*(this._halfWidth-Math.abs(t-(this._p1.x+this._halfWidth)))/this._halfWidth}},{key:"lineTo",value:function(t,e){this.graphics.lineTo(t,this.mapY(t,e))}},{key:"curveTo",value:function(t,e,i,n){this.graphics.curveTo(t,this.mapY(t,e),i,this.mapY(i,n))}},{key:"updateSelectionFeedback",value:function(){if(s(h(e.prototype),"updateSelectionFeedback",this).call(this),null!=this.context.document&&this.context.document.isModelEditable(this.notation)){var t=this._dist*this.context.info.displayScale>e.HANDLE_DISPLAY_THRESHOLD;if(this.selected){if(!this.span.startBreak&&(this.addHandle(this._p1.x,this._p1.y,new Ie(this.context,this.span.notation)),t)){var i=new xe(this.context,A.unknownToType(this.span.notation,Ol),xe.LEFT_CONTROL,this.c1Start);this.addHandle(this._c1.x,this._c1.y,i,new ac(this.context));var n=new Ce(this.context,A.unknownToType(this.span.notation,Ol),this.c1Start,this.c2Start),r=this.cMid;this.addHandle(r.x,r.y,n)}if(!this.span.endBreak&&(this.addHandle(this._p2.x,this._p2.y,new Ne(this.context,this.span.notation)),t)){var o=new xe(this.context,A.unknownToType(this.span.notation,Ol),xe.RIGHT_CONTROL,this.c2Start);this.addHandle(this._c2.x,this._c2.y,o,new ac(this.context))}}else this.removeHandles()}}},{key:"c1Start",get:function(){return new If((this._c1.x-this._p1.x)/this.staffMetrics.lineSpacing,-(this._c1.y-this._p1.y)/this.staffMetrics.lineSpacing)}},{key:"c2Start",get:function(){return new If((this._c2.x-this._p2.x)/this.staffMetrics.lineSpacing,-(this._c2.y-this._p2.y)/this.staffMetrics.lineSpacing)}},{key:"cMid",get:function(){return If.interpolate(this._c1,this._c2,.5)}}],[{key:"slurHeight",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.slurStandardHeight(t/e.lineSpacing);return i>n&&i*e.lineSpacing<t/2?i*e.lineSpacing:n*e.lineSpacing}}]),e}();r.registerClass(pc,"com.noteflight.notation.view.SlurView");var mc=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t)))._layout=null,r._textField=null,r._addAbove=null,r._addBelow=null,r._rolled=!1,r._mouseDownSeen=!1,r._systemView=null,r._rollEvent=null,r._partMediator=null,r.buttonMode=!0,r.useHandCursor=!0,r._layout=i,r._systemView=n,r._partMediator=r.context.registerPartView(u(u(r))),r.initializeView(),r.addEventListener(li.CLICK,xt.bindMethod(u(u(r)),r.handleClick)),Ec.useRolloverEvents?(r.addEventListener(li.MOUSE_DOWN,xt.bindMethod(u(u(r)),r.handleMouseDown)),r.addEventListener(li.ROLL_OVER,xt.bindMethod(u(u(r)),r.addRollHighlight)),r.addEventListener(li.ROLL_OUT,xt.bindMethod(u(u(r)),r.removeRollHighlight))):r.addEventListener(li.MOUSE_DOWN,xt.bindMethod(u(u(r)),r.handleMouseDownAsRoll)),r}return c(e,Ju),p(e,null,[{key:"_lastRolled",get:function(){return vc},set:function(t){vc=t}}]),p(e,[{key:"removeListeners",value:function(){this.removeEventListener(li.CLICK,xt.bindMethod(this,this.handleClick)),Ec.useRolloverEvents?(this.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDown)),this.removeEventListener(li.ROLL_OVER,xt.bindMethod(this,this.addRollHighlight)),this.removeEventListener(li.ROLL_OUT,xt.bindMethod(this,this.removeRollHighlight))):this.removeEventListener(li.MOUSE_DOWN,xt.bindMethod(this,this.handleMouseDownAsRoll))}},{key:"destroyChildren",value:function(){this._addAbove&&A.unknownToType(this._addAbove,ic).destroy(),this._addBelow&&A.unknownToType(this._addBelow,ic).destroy()}},{key:"destroy",value:function(){this._partMediator.destroy(),this._layout=null,s(h(e.prototype),"destroy",this).call(this)}},{key:"wholeStaffSelected",value:function(t,e){return 0===t&&null!=this.layout&&e==this.layout.context.score.numMeasures-1}},{key:"updateView",value:function(){this.x=this.context.info.staffHandlePadding,this.context.controller.document.editable&&(this._addAbove=new ic(this.staff,!1),this._addAbove.x=this.context.info.staffHandleExtent,this._addAbove.visible=!1,this.addChild(this._addAbove),this._addBelow=new ic(this.staff,!0),this._addBelow.x=this.context.info.staffHandleExtent,this._addBelow.visible=!1,this.addChild(this._addBelow),this._addAbove.scaleX=this._addAbove.scaleY=this._addBelow.scaleX=this._addBelow.scaleY=this.context.info.inserterScale)}},{key:"updateStatus",value:function(){this.graphics.clear();var t=!1,e=this.staff;if(null!=this.context.document&&null!=e&&null!=e.score){var i=this.context.document.selection;if(A.is(i,Je)||A.is(i,Ke)){var n=A.as(i,Je),r=this._layout;null!=n&&null!=r&&(t=n.includesEntireStaffRange(e,A.intToUint(r.startMeasureIndex),A.intToUint(r.endMeasureIndex)))}}this.graphics.beginFill(0,0),this.graphics.drawRect(-this.context.info.staffHandleExtent,-this.handleHeight+this.toViewUnits(this.staffMetrics.staffSpacing/2)-5,1.5*this.context.info.staffHandleExtent,this.handleHeight-2+10),this.graphics.endFill(),t?this.graphics.beginFill(this.context.info.measureHighlightColor,this.context.info.measureHighlightAlpha):(this._rolled&&this.graphics.lineStyle(1,this.context.info.measureHandleHighlightColor),this.graphics.beginFill(this.context.info.handleColor,this.context.info.measureHandleAlpha)),this.graphics.drawRect(-this.context.info.staffHandleExtent,-this.handleHeight+this.toViewUnits(this.staffMetrics.staffSpacing/2),this.context.info.staffHandleWidth,this.handleHeight-2),this.graphics.endFill(),null!=this._addAbove&&null!=this._addBelow&&(this._addAbove.visible=this._rolled,this._addAbove.x=-this.context.info.staffHandleWidth,this._addAbove.y=-this.handleHeight+this.toViewUnits(this.staffMetrics.staffSpacing/2),this._addBelow.visible=this._rolled,this._addBelow.x=-this.context.info.staffHandleWidth,this._addBelow.y=this.toViewUnits(this.staffMetrics.staffSpacing/2))}},{key:"processHandleClick",value:function(t){var e=t.shiftKey?Xi.ADD_TO_SELECTION:Xi.SELECT;this.dispatchEvent(new Xi(Xi.PART_EDIT,e,this.staff)),t.stopPropagation()}},{key:"handleMouseDown",value:function(t){this._mouseDownSeen=!0,this._rolled&&t.localX<-this.context.info.staffHandleExtent+this.context.info.staffHandleWidth&&this.processHandleClick(t)}},{key:"handleMouseDownAsRoll",value:function(t){this.context.controller.isNotationInteractionAvailable()&&(this._mouseDownSeen=!0,t.localX<-this.context.info.staffHandleExtent+this.context.info.staffHandleWidth&&this.processHandleClick(t),this._systemView.showHandles())}},{key:"handleClick",value:function(t){this.context.controller.isNotationInteractionAvailable()&&(this._mouseDownSeen?this.addRollHighlight(t):t.localX<-this.context.info.staffHandleExtent+this.context.info.staffHandleWidth&&this.processHandleClick(t))}},{key:"addRollHighlight",value:function(t){this._rollEvent=t,null!=e._lastRolled&&e._lastRolled!=this&&e._lastRolled.removeRollHighlight(t),e._lastRolled=this,this._rolled=!t.buttonDown,this.updateStatus(),t.stopPropagation()}},{key:"removeRollHighlight",value:function(t){null!=this._rollEvent&&$c.isSyntheticMouseEvent(this._rollEvent,t)||(this._rolled=!1,this.updateStatus(),t.stopPropagation())}},{key:"layout",get:function(){return this._layout}},{key:"staff",get:function(){return null!=this._layout?this._layout.staff:null}},{key:"selected",get:function(){return!1}},{key:"handleHeight",get:function(){return null!=this._layout?this.toViewUnits(this._layout.height+this.staffMetrics.staffSpacing):0}}]),e}(),vc=null;r.registerClass(mc,"com.noteflight.notation.view.StaffHandle");var _c=function(t){function e(t,i,n,r,o,s,a){var c;return y(this,e),(c=l(this,h(e).call(this,t)))._minY=NaN,c._numLines=0,c._lineSpacing=NaN,c._staffWidth=NaN,c._displayLineStartIndex=NaN,c._displayLineEndIndex=NaN,c._displayLineSpacing=NaN,c._numLines=i,c._lineSpacing=n,c._staffWidth=r,c._displayLineStartIndex=o,c._displayLineEndIndex=s,c._displayLineSpacing=a,c.addEventListener(ct.ADDED_TO_STAGE,xt.bindMethod(u(u(c)),c.handleAddedToStage)),c.addEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(u(u(c)),c.handleRemovedFromStage)),c}return c(e,Ju),p(e,null,[{key:"MOUSE_CATCHER_MARGIN",get:function(){return 1.5}}]),p(e,[{key:"removeListeners",value:function(){this.removeEventListener(ct.ADDED_TO_STAGE,xt.bindMethod(this,this.handleAddedToStage)),this.removeEventListener(ct.REMOVED_FROM_STAGE,xt.bindMethod(this,this.handleRemovedFromStage)),this.removeDisplayScaleChangeEvent()}},{key:"destroyChildren",value:function(){for(var t=0;t<this.numChildren;t++)A.unknownToType(this.getChildAt(t),lh).destroy()}},{key:"removeDisplayScaleChangeEvent",value:function(){null!=this.context.documentView&&this.context.documentView.removeEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.handleScaleChange))}},{key:"handleAddedToStage",value:function(t){null!=this.context.documentView&&this.context.documentView.addEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.handleScaleChange))}},{key:"handleRemovedFromStage",value:function(t){null!=this.context.documentView&&this.context.documentView.removeEventListener(ci.DISPLAY_SCALE_CHANGE,xt.bindMethod(this,this.handleScaleChange))}},{key:"handleScaleChange",value:function(t){this.updateGeometry()}},{key:"updateGeometry",value:function(){var t,i;this._minY=-this.toViewUnits((this._numLines-1)*this._lineSpacing),this.graphics.clear(),this.graphics.beginFill(0,0),this.graphics.drawRect(0,this._minY-this.toViewUnits(e.MOUSE_CATCHER_MARGIN),this.toViewUnits(this.staffWidth),-this._minY+this.toViewUnits(2*e.MOUSE_CATCHER_MARGIN)),this.graphics.endFill();var n=this.staffMetrics.lineThickness*this.staffMetrics.lineSpacing;if(!this.context.info.printView&&n*this.context.info.displayScale<=1){this.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE);var r=this.toViewUnits(this.staffWidth);for(i=this._displayLineStartIndex;i<this._displayLineEndIndex;i+=this._displayLineSpacing)t=this.toViewUnits(i*this._lineSpacing),this.graphics.moveTo(-1,-t),this.graphics.lineTo(r-1,-t)}else for(i=this._displayLineStartIndex;i<this._displayLineEndIndex;i+=this._displayLineSpacing)t=this.toViewUnits(i*this._lineSpacing),this.graphics.beginFill(0),this.graphics.drawRect(-1,-t,this.toViewUnits(this.staffWidth),n),this.graphics.endFill()}},{key:"staffWidth",get:function(){return this._staffWidth},set:function(t){this._staffWidth=t}},{key:"mouseInStaff",get:function(){return this.mouseY<=0&&this.mouseY>this._minY}}]),e}();r.registerClass(_c,"com.noteflight.notation.view.StaffLines");var Sc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t,i)))._systemView=null,n._stripMetrics=null,n._contentSprite=null,n._backdropSprite=null,n._lastHeight=NaN,n._currentViewHeight=0,n._incrementalFlowWasComplete=!1,n._lastTotalPageFlowElements=-1,n._measurePlaceholders={},n._measurePlaceholdersContainer=null,n._firstMeasurePlaceholderIndex=Number.MAX_VALUE,n._lastHiddenMeasureLeftSide=-1,n._firstHiddenMeasureRightSide=Number.MAX_VALUE,n._extraViewportsPerSide=2,n._lastCurrentMeasureIndex=-1,n._cachedPlaceholders={},n._measurePlaceholderWidth=NaN,n._measurePlaceholderHeight=-1,n._lastLeftMeasureViewport=-1,n._lastRightMeasureViewport=-1,n._stripMetrics=i.context.stripMetrics,i.addEventListener(bi.SEQUENCE_CHANGE,xt.bindMethod(u(u(n)),n.handleMeasureSequenceChange),!1,0,!0),i.addEventListener(bi.DISPLAY,xt.bindMethod(u(u(n)),n.handleMeasureDisplay),!1,0,!0),i.addEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(u(u(n)),n.handleMeasureDisplay),!1,0,!0),i.addEventListener(bi.SPAN_CHANGE,xt.bindMethod(u(u(n)),n.handleMeasureDisplay),!1,0,!0),n.calculateNumberOfMeasuresToShow(),n.initializeView(),n}return c(e,tc),p(e,null,[{key:"UPCOMING_MEASURE_VIEWS_REFRESH_THRESHOLD",get:function(){return.001}}]),p(e,[{key:"removeListeners",value:function(){this.layout.removeEventListener(bi.SEQUENCE_CHANGE,xt.bindMethod(this,this.handleMeasureSequenceChange)),this.layout.removeEventListener(bi.DISPLAY,xt.bindMethod(this,this.handleMeasureDisplay)),this.layout.removeEventListener(bi.GEOMETRY_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay)),this.layout.removeEventListener(bi.SPAN_CHANGE,xt.bindMethod(this,this.handleMeasureDisplay))}},{key:"forceFirstMeasuresToBeShown",value:function(){this.showHiddenMeasures(0,15)}},{key:"calculateNumberOfMeasuresToShow",value:function(){this._extraViewportsPerSide=Math.max(.5,.25*this.staffMetrics.scoreLineSpacing)}},{key:"updateViewStartingAt",value:function(t){this._systemView.truncateSystemViewAt(t),this._systemView.updateMeasureViewsStartingAt(t),this.pullFlow(!1),this._systemView.updateMeasureHandlesStartingAt(t),this._systemView.updateStavesGeometry(),this._systemView.updateGeometry(),this.updateGeometry()}},{key:"updateView",value:function(){if(this._backdropSprite&&this.removeChild(this._backdropSprite),this._contentSprite&&(this.removeChild(this._contentSprite),this._systemView.destroy()),this._backdropSprite=new Wr,this._backdropSprite.x=0,this.addChild(this._backdropSprite),this.layout.systemLayout.prepareLayout(),this._contentSprite=new Wr,this._contentSprite.x=0,this.addChild(this._contentSprite),this._systemView=A.as(this.layout.systemLayout.createDisplayObject(this.context),Xh),this.pullFlow(!1),this._contentSprite.addChild(this._systemView),this._backdropSprite.addChild(this._systemView.backdropSprite),this._layout.score.hasTracks&&!this.context.info.printView){var t=new kc(this.context,this._layout.score);t.x=this.toViewUnits(this.layout.context.stripMetrics.trackFlagX),t.y=this.toViewUnits(this.layout.context.stripMetrics.trackFlagY),this.addChild(t)}this.updateGeometry()}},{key:"updateBackdrop",value:function(){this.graphics.clear();var t=Math.max(this.systemViewWidth,this.backdropSpriteWidth)+(this._stripMetrics.stripMarginLeft+this._stripMetrics.stripMarginRight),e=this.toViewUnits(this._systemView.layout.distanceY),i=Math.min(0,e),n=this.toViewUnits(this.layout.height)-i;this._currentViewHeight=n,this._backdropSprite.y=e,this._contentSprite.y=e;var r=i;this.context.overlay?this.graphics.beginFill(A.numberToUint(this._stripMetrics.overlayColor),this._stripMetrics.overlayOpacity):$c.beginBackgroundFill(this.graphics,this.context.info),this.graphics.drawRect(0,r,t,n),this.graphics.endFill()}},{key:"getPointInMeasure",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._systemView.getPointInMeasure(t,e,i,n)}},{key:"pullFlowComplete",value:function(){var t=this;X.flash_utils_setTimeout(function(){t.optimizeMeasureViews()},10)}},{key:"ensureScoreInViewportIsVisible",value:function(){var t=this.leftMeasureIndexInViewport,e=this.getRightMeasureIndexInViewport(t);this._lastLeftMeasureViewport<=t&&this._lastRightMeasureViewport>=e||(this._lastLeftMeasureViewport=t,this._lastRightMeasureViewport=e,this.showHiddenMeasures(t,e))}},{key:"getRightMeasureIndexInViewport",value:function(t){var e=(this.context.documentView.horizontalScrollPosition+this.context.documentView.viewportWidth)/this.context.documentView.viewInfo.displayScale,i=this._contentSprite.x+this._systemView.x;return Math.ceil(this._systemView.getStaffViewAt(0).getMeasureIndexAtPosition(e-i,t))}},{key:"optimizeMeasureViews",value:function(){if(!this.context.overlay){this._firstMeasurePlaceholderIndex=Math.min(this._firstMeasurePlaceholderIndex,this.totalPageFlowElements);var t=Math.abs(this._measurePlaceholderHeight-this._currentViewHeight)>e.UPCOMING_MEASURE_VIEWS_REFRESH_THRESHOLD;t&&this.removeAnyExistingPlaceholder();var i=this.totalPageFlowElements!=this._lastTotalPageFlowElements;i&&this.buildMeasurePlaceholders(this.totalPageFlowElements,this.context.document.score.numMeasures-1),this.totalPageFlowElements>this._firstMeasurePlaceholderIndex&&(this.removeMeasurePlaceholders(this._firstMeasurePlaceholderIndex,this.totalPageFlowElements-1),this._firstMeasurePlaceholderIndex=this.totalPageFlowElements);this._contentSprite.x,this._systemView.x;var n=this.leftMeasureIndexInViewport,r=this.getRightMeasureIndexInViewport(n),o=Math.max(r-n,10),s=this._extraViewportsPerSide/2;if(!(Math.abs(n-this._lastCurrentMeasureIndex)<=s)||t){(this.isIncrementalFlowComplete&&!this._incrementalFlowWasComplete||i)&&(n=Math.min(n,this.totalPageFlowElements-o));var a=Math.floor(Math.max(0,n-this._extraViewportsPerSide*o)),l=Math.ceil(Math.min(n+(this._extraViewportsPerSide+1)*o,this.totalPageFlowElements-1));this.showHiddenMeasures(a,l),a-1>this._lastHiddenMeasureLeftSide&&(this.hideMeasures(this._lastHiddenMeasureLeftSide,a-1),this._lastHiddenMeasureLeftSide=a-1),this._lastHiddenMeasureLeftSide=Math.min(a-1,this._lastHiddenMeasureLeftSide),l+1<this._firstHiddenMeasureRightSide&&(this._firstHiddenMeasureRightSide=Math.min(this.totalPageFlowElements,this._firstHiddenMeasureRightSide),this.hideMeasures(l+1,this._firstHiddenMeasureRightSide)),this._firstHiddenMeasureRightSide=Math.max(l+1,this._firstHiddenMeasureRightSide),this.isIncrementalFlowComplete&&!this._incrementalFlowWasComplete||i?(this.estimateScrollBar(),this._incrementalFlowWasComplete=!0):this._incrementalFlowWasComplete=!1,this._lastTotalPageFlowElements=this.totalPageFlowElements,this._lastCurrentMeasureIndex=n}}}},{key:"hideMeasures",value:function(t,e){for(var i=A.numberToInt(t);i<=e;i++)if(!(i<0)){if(i>=this.totalPageFlowElements)break;this._systemView.hideMeasure(i)}}},{key:"showHiddenMeasures",value:function(t,e){for(var i=A.numberToInt(t);i<=e;i++)if(!(i<0)){if(i>=this.totalPageFlowElements)break;this._systemView.showHiddenMeasure(i),this._measurePlaceholders[i]&&this.removeMeasurePlaceholder(i)}}},{key:"ensureSystemAfterMeasureDrawn",value:function(t){}},{key:"getPositionUnderPoint",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this._systemView.getPositionUnderPoint(t,e,i,n,r)}},{key:"handleMeasureDisplay",value:function(t){null!=this.stage&&this.updateGeometry(),this.updatePositionPlaceholdersContainer()}},{key:"handleMeasureSequenceChange",value:function(t){null!=this.stage&&(t.measureIndices&&0!==t.measureIndices.length?this.updateViewStartingAt(A.unknownToNumber(t.measureIndices[0])):this.updateView())}},{key:"updateGeometry",value:function(){s(h(e.prototype),"updateGeometry",this).call(this),this.staffMetrics.verticalAutoSpace&&this.determineSystemPosition(),this.updateBackdrop()}},{key:"updateSystemGeometry",value:function(){this._systemView.updateGeometry(),this.updateGeometry()}},{key:"determineSystemPosition",value:function(){if(this.layout.invalidateGlobal(),this._systemView.layout.invalidateGlobal(),this.layout.determineSystemPosition(),this.layout.height!=this._lastHeight){var t=!0,e=!1,i=void 0;try{for(var n,r=this._systemView.staffViews[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;o.updateGeometry(),o.updateMeasureGeometry()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}this._systemView.updateGeometry(),this._systemView.updateSpanNotations(null),this._lastHeight=this.layout.height}}},{key:"scrollDirectionAffectsFlow",value:function(t){return t==Xy.HORIZONTAL}},{key:"doIncrementalFlow",value:function(){if(this.context.documentView.viewInfo.displayMode==Nl.STRIP_DISPLAY&&!this.context.overlay){var t=Xh.UP_TO_SCROLL_POS;!this._forceViewBuild&&this.context.buildIncrementally||(t=Xh.EVERYTHING),this._systemView.doIncrementalFlow(t),this.updateGeometry(),this.context.documentView.updateScoreDimensions()}}},{key:"createUpcomingMeasures",value:function(){}},{key:"updatePositionPlaceholdersContainer",value:function(){this._measurePlaceholdersContainer&&(this._measurePlaceholdersContainer.x=this.lastMeasurePoint.x+this.lastMeasureView.measureWidth+this._contentSprite.x+this._systemView.x)}},{key:"removeMeasurePlaceholders",value:function(t,e){if(this._measurePlaceholdersContainer){for(var i=!1,n=A.numberToInt(e);n>=t;n--)this._measurePlaceholders[n]&&(this.removeMeasurePlaceholder(n),i=!0);if(i){var r=0;for(n=A.numberToInt(e+1);n<this.context.document.score.numMeasures&&this._measurePlaceholders[n];n++)this._measurePlaceholders[n].x=r,r+=this.measurePlaceholderWidth;this.updatePositionPlaceholdersContainer()}}}},{key:"removeAnyExistingPlaceholder",value:function(){this.removeMeasurePlaceholders(this._firstMeasurePlaceholderIndex,this.context.document.score.numMeasures-1)}},{key:"createMeasurePlaceholder",value:function(t){this._measurePlaceholdersContainer||(this._measurePlaceholdersContainer=new Wr,this.addChild(this._measurePlaceholdersContainer));var e=this.createPlaceholderView(t);this._measurePlaceholders[t]=e,this._measurePlaceholdersContainer.addChild(e)}},{key:"createPlaceholderView",value:function(t){var e;if(this._cachedPlaceholders[t])e=A.unknownToType(this._cachedPlaceholders[t],Wr);else{(e=new Wr).graphics.beginFill(this._stripMetrics.upcomingMeasureBackgroundColor,this._stripMetrics.upcomingMeasureBackgroundOpacity),e.graphics.drawRect(0,0,this.measurePlaceholderWidth,this.backdropHeight),e.graphics.endFill(),e.graphics.beginFill(this._stripMetrics.upcomingMeasureTextColor,this._stripMetrics.upcomingMeasureBackgroundOpacity),e.graphics.drawRect(this.measurePlaceholderWidth-1,.25*this.backdropHeight,1,this.backdropHeight/2),e.graphics.endFill(),e.x=this.measurePlaceholderWidth*(t-this.totalPageFlowElements),e.y=0;var i=new Ty;i.text=Ou.getString("editor.buildingMeasure",[this.context.document.score.getSystemStaffMeasureAt(t).measureNumber.toString()]),i.embedFonts=!0,i.defaultTextFormat=new Ly(this._stripMetrics.upcomingMeasureTextFont,this._stripMetrics.upcomingMeasureTextSize,null,!1,!1,!1,null,null,wy.LEFT),i.textColor=this._stripMetrics.upcomingMeasureTextColor,i.width=.5*this._systemView.averageCurrentMeasuresWidth,i.backgroundColor=16777215,i.background=!1,i.multiline=!0,i.wordWrap=!0,i.antiAliasType=vy.ADVANCED,i.x=this.measurePlaceholderWidth/2-i.width/2,i.y=this.backdropHeight/2-i.height/2,e.addChild(i),this._measurePlaceholderHeight=this.backdropHeight}return e}},{key:"removeMeasurePlaceholder",value:function(t){this._measurePlaceholdersContainer&&(this._measurePlaceholdersContainer.removeChild(this._measurePlaceholders[t]),this._measurePlaceholders[t]=null)}},{key:"buildMeasurePlaceholders",value:function(t,e){if(!this._measurePlaceholders[t]){for(var i=A.numberToInt(t);i<=e;i++)this._measurePlaceholders[i]||this.createMeasurePlaceholder(i);this._measurePlaceholdersContainer&&(this._measurePlaceholdersContainer.x=this.lastMeasurePoint.x+this.lastMeasureView.measureWidth+this._contentSprite.x+this._systemView.x)}}},{key:"continueIncrementalFlow",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.context.buildIncrementally){if(t){var n=this;return this.context.documentView.callLater(function(){if(n.doIncrementalFlow(),e){n.showIncrementalFeedback(!0);n._systemView.getStaffViewAt(0);n.updateIncrementalFeedback(A.numberToInt(n.totalPageFlowElements),"measure")}i&&i.staves&&A.as(i.staves,Array).length>0&&n.hasChangedSinceLastPullFlow(),n.pullFlow(t,i)}),!0}for(;this.isMoreFlowNeeded;)this._systemView.doIncrementalFlow(Xh.UP_TO_SCROLL_POS);return this.context.documentView.updateScoreDimensions(),this.updateBackdrop(),this.estimateScrollBar(),this.pullFlow(t),!0}for(;!this.isIncrementalFlowComplete;)this.doIncrementalFlow();return!1}},{key:"noMoreFlowNeeded",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.layout.updateHyphens(t,e)}},{key:"layout",get:function(){return A.as(this._layout,Fs)}},{key:"totalPageFlowElements",get:function(){return this._systemView.getStaffViewAt(0).numMeasureViews}},{key:"firstMeasurePoint",get:function(){return this._systemView.getLocalMeasureStart(0)}},{key:"lastMeasurePoint",get:function(){return this._systemView.getLocalMeasureStart(A.numberToInt(this.totalPageFlowElements-1))}},{key:"staffMetrics",get:function(){return this.layout.context.staffMetrics}},{key:"backdropHeight",get:function(){var t=Math.min(0,this.toViewUnits(this._systemView.layout.distanceY));return this.toViewUnits(this.layout.height)-t}},{key:"backdropSpriteWidth",get:function(){var t=this._systemView.lastMeasureHandle;if(!t)return 0;var e=t.x+t.handleWidth;return t.addAfter&&(e+=t.addAfter.right*t.addAfter.scaleX),e-(this._systemView.firstStaffHandle.x-this.context.info.staffHandleExtent)}},{key:"systemViewWidth",get:function(){var t=this._systemView.getStaffViewAt(0),e=t.lastDrawnMeasure;return e.x+e.measureWidth+t.x+this._systemView.x-1}},{key:"width",get:function(){var t=Math.max(this.systemViewWidth,this.backdropSpriteWidth)+this._stripMetrics.stripMarginLeft+this._stripMetrics.stripMarginRight;if(this._measurePlaceholdersContainer){var e=this._measurePlaceholdersContainer.x+this._measurePlaceholdersContainer.width;t=Math.max(t,e)}return t},set:function(t){o(h(e.prototype),"width",t,this,!0)}},{key:"height",get:function(){var t=Math.min(0,this.toViewUnits(this._systemView.layout.distanceY));return this.toViewUnits(this.layout.height)-t},set:function(t){o(h(e.prototype),"height",t,this,!0)}},{key:"lastDrawnMeasure",get:function(){return this._systemView.lastDrawnMeasure}},{key:"hasLastViewBeenCreated",get:function(){return this.isIncrementalFlowComplete}},{key:"overlayMeasureIndex",get:function(){var t=this.context.documentView.overlayWidth,e=this.context.documentView.horizontalScrollPosition/this.context.documentView.viewInfo.displayScale-(this._contentSprite.x+this._systemView.x+this._systemView.staffViews[0].x)+t;return Math.floor(Math.max(0,this._systemView.getStaffViewAt(0).getMeasureIndexAtPosition(e)-1))}},{key:"leftMeasureIndexInViewport",get:function(){var t=this.context.documentView.horizontalScrollPosition/this.context.documentView.viewInfo.displayScale,e=this._contentSprite.x+this._systemView.x;return Math.floor(Math.max(0,this._systemView.getStaffViewAt(0).getMeasureIndexAtPosition(t-e)-1))}},{key:"isIncrementalFlowComplete",get:function(){return this._systemView.isIncrementalFlowComplete}},{key:"isMoreFlowNeeded",get:function(){return this._systemView.isMoreFlowNeeded&&this.context.documentView.viewInfo.displayMode==Nl.STRIP_DISPLAY}},{key:"endSpritePosition",get:function(){var t=this._measurePlaceholders[this.context.document.score.numMeasures-1];return!this.isIncrementalFlowComplete&&t?new If(t.x+this.measurePlaceholderWidth,0):this._systemView.endSpritePosition}},{key:"lastMeasureView",get:function(){return this._systemView.getStaffViewAt(0).getMeasureViewAt(A.numberToInt(this.totalPageFlowElements-1))}},{key:"measurePlaceholderWidth",get:function(){return this._measurePlaceholderWidth||(this._measurePlaceholderWidth=this._systemView.averageCurrentMeasuresWidth),this._measurePlaceholderWidth}},{key:"subsequentIdleTimeout",get:function(){return 250}}]),e}();r.registerClass(Sc,"com.noteflight.notation.view.StripView");var Lc=function(t){function e(t,i,n,r,o){var s;y(this,e),(s=l(this,h(e).call(this))).x=t,s.y=i;var a=o.tieShoulder(n/o.lineSpacing),u=o.tieMaxStroke*o.lineSpacing/2;return s.graphics.beginFill(0),s.graphics.lineStyle(0,0,1,!1,yf.NORMAL,Lr.NONE,kr.BEVEL),s.graphics.moveTo(0,0),s.graphics.curveTo(n*a,r+u,.5*n,r+u),s.graphics.curveTo(n*(1-a),r+u,n,0),s.graphics.curveTo(n*(1-a),r-u,.5*n,r-u),s.graphics.curveTo(n*a,r-u,0,0),s.graphics.endFill(),s}return c(e,Wr),e}();r.registerClass(Lc,"com.noteflight.notation.view.TieView");var kc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._score=null,n._viewContext=null,n._trackFlagMediator=null,n.CIRCLE_COLOR_NOT_SHOWN=6710872,n.CIRCLE_COLOR_SHOWN=16141856,n._viewContext=t,n._score=i,n._trackFlagMediator=n.context.registerTrackFlagView(u(u(n))),n.initializeView(),n}return c(e,Ju),p(e,[{key:"destroy",value:function(){this._trackFlagMediator.destroy(),s(h(e.prototype),"destroy",this).call(this)}},{key:"updateView",value:function(){var t=new Wr,e=[2,5,4,4.5,3],i=1*e.length+.5*(e.length-1),n=t.graphics,r=this._score.audioWaveformsShown?this.CIRCLE_COLOR_SHOWN:this.CIRCLE_COLOR_NOT_SHOWN;n.beginFill(r,1),n.drawCircle(i/2,4,6),n.endFill();for(var o=0,s=0;s<e.length;s++)n.beginFill(16777215,1),n.moveTo(o,6.5),n.lineTo(o,6.5-e[s]),n.lineTo(o+1,6.5-e[s]),n.lineTo(o+1,6.5),n.lineTo(o,6.5),n.endFill(),o+=1.5;this.addChild(t)}}]),e}();r.registerClass(kc,"com.noteflight.notation.view.TrackFlagView");var Tc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t)))._layout=null,n._layout=i,n.addEventListener(li.CLICK,xt.bindMethod(u(u(n)),n.handleClick)),n.initializeView(),n}return c(e,Ju),p(e,[{key:"handleClick",value:function(t){this.context.controller.selectTuplet(this._layout.tuplet)}},{key:"updateView",value:function(){for(;this.numChildren>0;)this.removeChildAt(0);if(null!=this.layout.numberLayout){var t=this.toViewUnits(this.layout.startX),e=-this.toViewUnits(this.layout.startY),i=this.toViewUnits(this.layout.endX),n=-this.toViewUnits(this.layout.startY+this.layout.rise),r=this.toViewUnits(this.staffMetrics.tupletBracketHeight)*(this.layout.down?-1:1),o=(t+i)/2,s=e+.5*(n-e);this.layout.tuplet.showBracket&&(s-=r);var a=this.layout.numberLayout.createDisplayObject(this.context),l=this.toViewUnits(this.layout.numberLayout.width);if(a.x=o-l/2,a.y=s,this.addChild(a),this.layout.tuplet.showBracket){var u=a.x-this.toViewUnits(this.staffMetrics.tupletNumberPadding),h=e+(n-e)*(u-t)/(i-t)-r,c=a.x+l+this.toViewUnits(this.staffMetrics.tupletNumberPadding),d=e+(n-e)*(c-t)/(i-t)-r;this.graphics.lineStyle(this.staffMetrics.lineThickness,0),this.graphics.moveTo(t,e),this.graphics.lineTo(t,e-r),this.graphics.lineTo(u,h),this.graphics.moveTo(c,d),this.graphics.lineTo(i,n-r),this.graphics.lineTo(i,n)}}}},{key:"layout",get:function(){return this._layout}}]),e}();r.registerClass(Tc,"com.noteflight.notation.view.TupletView");var Ec=function(t){function i(t,e,n,r,o,s){var a,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.FLOW_VERTICAL,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return y(this,i),(a=l(this,h(i).call(this)))._$info=null,a._$layoutContext=null,a._$documentController=null,a._$controller=null,a._$documentView=null,a._$stage=null,a._$buildIncrementally=!1,a.options=f,a._$flowDirection=null,a.cachedMeasureDeleterWidth=0,a.cachedPlayButtonWidth=0,a.cachedMeasureWidth=0,a.cachedMeasureWidthForTheLastTime=0,a.noteEntryView=null,a.notationMediatorClass=null,a.spanNotationMediatorClass=null,a.annotationMediatorClass=null,a.trackFlagMediatorClass=null,a.measureMediatorClass=null,a.measureHandleMediatorClass=null,a.staffHandleMediatorClass=null,a.fakeView=f.fakeView,i.initializeUseRolloverEvents(),a.info=t,a.layoutContext=e,a.controller=n,a.documentController=r,a.documentView=o,a.stage=s,a.buildIncrementally=c,a.flowDirection=d,a.notationMediatorClass=Bt,a.spanNotationMediatorClass=Ae,a.annotationMediatorClass=Nt,a.trackFlagMediatorClass=Re,a.measureMediatorClass=jt,a.measureHandleMediatorClass=Jt,a.staffHandleMediatorClass=Pe,a.handleMeasuresInvalidation=a.handleMeasuresInvalidation.bind(u(u(a))),a.handleGlobalInvalidation=a.handleGlobalInvalidation.bind(u(u(a))),a.handleValidation=a.handleValidation.bind(u(u(a))),a.fakeView||(a.layoutContext.addEventListener(Ai.INVALIDATE,a.handleMeasuresInvalidation),a.layoutContext.addEventListener(Ai.SEQUENCE_CHANGE,a.handleMeasuresInvalidation),a.documentController.scoreDocument.addEventListener(Ai.REBUILD_SCORE,a.handleGlobalInvalidation),a.documentController.scoreDocument.measureValidator.addEventListener(Ai.REBUILD_SCORE,a.handleGlobalInvalidation),a.controller.addEventListener(xi.PART_MOVED,a.handleGlobalInvalidation),a.controller.addEventListener(Ci.VALIDATE_CACHE,a.handleValidation)),a}return c(i,At),p(i,null,[{key:"FLOW_HORIZONTAL",get:function(){return"horizontal"}},{key:"FLOW_VERTICAL",get:function(){return"vertical"}},{key:"useRolloverEvents",get:function(){return Mc},set:function(t){Mc=t}},{key:"GLOBAL_MEASURE_VIEWS",get:function(){return bc},set:function(t){bc=t}}]),p(i,[{key:"getGlobalMeasureView",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.fakeView||this.overlay||!this.score.displayModeHasPages)return null;if(!this.globalMeasureViews[e])return null;if(!this.globalMeasureViews[e][t])return null;if(i.isMeasurePrefix){if(this.globalMeasureViews[e][t].measurePrefixViews)return this.globalMeasureViews[e][t].measurePrefixViews[i.measurePrefixIndex]}else if(this.globalMeasureViews[e][t].measureView)return this.globalMeasureViews[e][t].measureView;return null}},{key:"setGlobalMeasureView",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!this.fakeView&&this.score.displayModeHasPages&&(this.globalMeasureViews[e]||(this.globalMeasureViews[e]={}),this.globalMeasureViews[e][t]||(this.globalMeasureViews[e][t]={}),n.isMeasurePrefix?(this.globalMeasureViews[e][t].measurePrefixViews||(this.globalMeasureViews[e][t].measurePrefixViews=[]),this.globalMeasureViews[e][t].measurePrefixViews[n.measurePrefixIndex]=i):this.globalMeasureViews[e][t].measureView=i)}},{key:"handleMeasuresInvalidation",value:function(t){var e={},i=t.staves.map(function(t){return t.id}),n=t.measures.map(function(t){return t.id});1==i.length&&i[0]==this.score.systemStaff.id?(i=this.score.staves.map(function(t){return t.id}),e={deleteAll:!0}):i.length>1&&-1!=i.indexOf(this.score.systemStaff.id)?e={deleteRangeOfMeasures:!0}:t.type==Ai.SEQUENCE_CHANGE&&(i=this.score.staves.map(function(t){return t.id}),e={deleteRangeOfMeasures:!0}),this.measuresInvalidation(i,n,e)}},{key:"handleGlobalInvalidation",value:function(){this.globalInvalidation()}},{key:"handleValidation",value:function(){this.cacheValidation()}},{key:"cacheValidation",value:function(){var t=this.score.visibleStaves.map(function(t){return t.id});for(var e in t.push(this.score.systemStaff.id),this.globalMeasureViews)if(-1==t.indexOf(e))this.measuresInvalidation([e],null,{deleteAll:!0}),delete this.globalMeasureViews[e];else{var i=this.score.getStaffById(e);if(i){var n=i.measures.map(function(t){return t.id}),r=this.globalMeasureViews[e];for(var o in r)-1==n.indexOf(o)&&this.measuresInvalidation([e],[o])}}}},{key:"globalInvalidation",value:function(){for(var t in this.globalMeasureViews)this.measuresInvalidation([t],null,{deleteAll:!0});this.globalMeasureViews={}}},{key:"measuresInvalidation",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.deleteAll){i||(i=[]);for(var r=0;r<t.length;r++)this.globalMeasureViews[t[r]]&&(i=i.concat(Object.keys(this.globalMeasureViews[t[r]])))}if(n.deleteRangeOfMeasures){for(var o=[],s=0;s<t.length;s++)for(var a=t[s],l=0;l<i.length;l++)o=o.concat(this.score.getMeasureIdsInSystemMeasure(i[l],a));i=e(new Set(o))}for(var u=0;u<t.length;u++){for(var h=t[u],c=0;c<i.length;c++)if(this.globalMeasureViews[h]){if(!this.globalMeasureViews[h][i[c]])continue;if(this.globalMeasureViews[h][i[c]].measurePrefixViews)for(var d=0;d<this.globalMeasureViews[h][i[c]].measurePrefixViews.length;d++)this.globalMeasureViews[h][i[c]].measurePrefixViews[d].destroy();this.globalMeasureViews[h][i[c]].measureView&&this.globalMeasureViews[h][i[c]].measureView.destroy(),this.globalMeasureViews[h][i[c]]=null}this.globalMeasureViews[h]=null}}},{key:"getPositionUnderMouse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.documentView.getPositionUnderPoint(this,new If(this.stage.mouseX,this.stage.mouseY),t,e)}},{key:"registerMeasureView",value:function(t){if(null!=this.controller){var e=null;return A.is(t,Uh)?e=A.unknownToType(new this.measureMediatorClass,Ct):A.is(t,Nh)&&(e=A.unknownToType(new this.measureHandleMediatorClass,Ct)),null!=e&&e.handleViewEvents(t),e}return null}},{key:"registerPartView",value:function(t){if(null!=this.controller){var e=null;return A.is(t,mc)&&(e=A.unknownToType(new this.staffHandleMediatorClass,Ct)),null!=e&&e.handleViewEvents(t),e}return null}},{key:"registerAnnotationView",value:function(t){if(null!=this.controller){var e=A.unknownToType(new this.annotationMediatorClass,Ct);return e.handleViewEvents(t),e}return null}},{key:"registerTrackFlagView",value:function(t){if(null!=this.controller){var e=A.unknownToType(new this.trackFlagMediatorClass,Ct);return e.handleViewEvents(t),e}return null}},{key:"registerNotationView",value:function(t){if(null!=this.controller){var e=A.unknownToType(new this.notationMediatorClass,Ct);return e.handleViewEvents(t),e}return null}},{key:"registerSpanNotationView",value:function(t){if(null!=this.controller){var e=A.unknownToType(new this.spanNotationMediatorClass,Ct);return e.handleViewEvents(t),e}return null}},{key:"registerEffectView",value:function(t){if(null!=this.controller){var e=new Ue;return e.handleViewEvents(t),e}return null}},{key:"registerBeamView",value:function(t){if(null!=this.controller){var e=new Yt;return e.handleViewEvents(t),e}return null}},{key:"registerScoreView",value:function(t){null!=this.controller&&(new Me).handleViewEvents(t)}},{key:"toViewUnits",value:function(t){return t*this.layoutContext.staffMetrics.lineSpacing}},{key:"toLayoutUnits",value:function(t){return t/this.layoutContext.staffMetrics.lineSpacing}},{key:"info",get:function(){return this._$info},set:function(t){var e=this._$info;this._$info=t,e!==t&&this._propertyChanged("info",e,t)}},{key:"layoutContext",get:function(){return this._$layoutContext},set:function(t){var e=this._$layoutContext;this._$layoutContext=t,e!==t&&this._propertyChanged("layoutContext",e,t)}},{key:"documentController",get:function(){return this._$documentController},set:function(t){var e=this._$documentController;this._$documentController=t,e!==t&&this._propertyChanged("documentController",e,t)}},{key:"controller",get:function(){return this._$controller},set:function(t){var e=this._$controller;this._$controller=t,e!==t&&this._propertyChanged("controller",e,t)}},{key:"documentView",get:function(){return this._$documentView},set:function(t){var e=this._$documentView;this._$documentView=t,e!==t&&this._propertyChanged("documentView",e,t)}},{key:"score",get:function(){return this.layoutContext.score}},{key:"globalMeasureViews",get:function(){return i.GLOBAL_MEASURE_VIEWS},set:function(t){i.GLOBAL_MEASURE_VIEWS=t}},{key:"stage",get:function(){return this._$stage},set:function(t){var e=this._$stage;this._$stage=t,e!==t&&this._propertyChanged("stage",e,t)}},{key:"buildIncrementally",get:function(){return this._$buildIncrementally},set:function(t){var e=this._$buildIncrementally;this._$buildIncrementally=t,e!==t&&this._propertyChanged("buildIncrementally",e,t)}},{key:"flowDirection",get:function(){return this._$flowDirection},set:function(t){var e=this._$flowDirection;this._$flowDirection=t,e!==t&&this._propertyChanged("flowDirection",e,t)}},{key:"document",get:function(){return null!=this.controller?this.controller.document:null}},{key:"waveformController",get:function(){return this.documentController?this.documentController.waveformController:null}},{key:"overlay",get:function(){return!!this.documentView&&this.documentView.overlay}},{key:"scoreView",get:function(){return this.documentView.scoreView}}],[{key:"initializeUseRolloverEvents",value:function(){i.useRolloverEvents=!1}}]),i}(),Mc=!1,bc={};r.registerClass(Ec,"com.noteflight.notation.view.ViewContext");var wc=function(){function t(e,i,n){y(this,t),this.rootSvg=null,this.sizingDiv=null,this.viewportDiv=null,this.rootSvg=e,this.sizingDiv=i,this.viewportDiv=n}return p(t,[{key:"updateScoreDimensions",value:function(t,e){this.sizingDiv&&(this.sizingDiv.style.width=t+"px",this.sizingDiv.style.height=e+"px")}},{key:"horizontalScrollPosition",get:function(){return A.unknownToNumber(this.viewportDiv.scrollLeft)},set:function(t){this.viewportDiv.scrollLeft=t}},{key:"verticalScrollPosition",get:function(){return A.unknownToNumber(this.viewportDiv.scrollTop)},set:function(t){this.viewportDiv.scrollTop=t}},{key:"stageWidth",get:function(){return X.parseInt(A.unknownToString(this.viewportDiv.style.width))}},{key:"stageHeight",get:function(){return X.parseInt(A.unknownToString(this.viewportDiv.style.height))}}]),t}();r.registerClass(wc,"com.noteflight.notation.view.astojsflight.ScoreDOMElements");var xc=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return y(this,e),(t=l(this,h(e).call(this,i))).controller=null,t.scoreController=null,t.scoreDocumentController=null,t.domElements=null,t.scrollToPage=!1,t}return c(e,dc),p(e,[{key:"publicCreateChildren",value:function(){this.createChildren()}},{key:"createViewContext",value:function(){return new Ec(this.viewInfo,this._context,this.scoreController,this.scoreDocumentController,this,this.stage,this.viewInfo.buildIncrementally,Ec.FLOW_VERTICAL)}},{key:"updateScoreDimensions",value:function(){s(h(e.prototype),"updateScoreDimensions",this).call(this),this._overlay||this.controller.updateScoreDimensions(A.numberToInt(this.width),A.numberToInt(this.height))}},{key:"getViewFrame",value:function(){return s(h(e.prototype),"getViewFrame",this).call(this)}},{key:"scrollToPoint",value:function(t){var e=this;e._scrolling=!0,this.controller.animateScrollPosition(t,function(){e._scrolling=!1})}},{key:"activateFocusManager",value:function(){}},{key:"deactivateFocusManager",value:function(){}},{key:"editAnnotation",value:function(t){}},{key:"viewportWidth",get:function(){return this.stage.width}},{key:"viewportHeight",get:function(){return this.stage.height}},{key:"horizontalScrollPosition",get:function(){return this.controller.horizontalScrollPosition},set:function(t){this.controller.horizontalScrollPosition=t}},{key:"verticalScrollPosition",get:function(){return this.controller.verticalScrollPosition},set:function(t){this.controller.verticalScrollPosition=t}}]),e}();r.registerClass(xc,"com.noteflight.notation.view.jsflight.JsflightScoreDocumentView");var Cc=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this)))._$documentController=null,i._$playing=!1,i._$loaded=!1,i._$hasTrack=!1,i._$enableNotationInPlayback=!1,i._seekPosition=-1,i.useDraftSynchronizedTrack=!1,i.documentController=t,i}return c(e,At),p(e,[{key:"playAudio",value:function(){}},{key:"stopAudio",value:function(){null!=this.documentController.performer&&this.documentController.performer.stopPerformance(),this.playing=!1,this.documentController.enableNotationInPlayback=!1}},{key:"loadTrack",value:function(t){this.unloadTrack();var e=Jl.createFromString(t,new Eu);null!=e&&(e.addEventListener(ct.COMPLETE,xt.bindMethod(this,this.handleAudioComplete)),e.addEventListener(Cf.IO_ERROR,xt.bindMethod(this,this.handleAudioError)),e.load(),null!=this.score&&(this.synchronizedTrack=e),this.hasTrack=!0,this.loaded=!1,this.playing=!1)}},{key:"unloadTrack",value:function(){var t=this.score;null!=t&&null!=this.synchronizedTrack&&(this.synchronizedTrack.destroy(),this.synchronizedTrack=null,t.playbackMode=Nl.PLAYBACK_MODE_NORMAL,this.documentController.performer.stopPerformance(),this.documentController.hidePositionCursor(),this.hasTrack=!1,this.loaded=!1)}},{key:"updateTemporalMap",value:function(){this.positionChanged()}},{key:"handleAudioError",value:function(t){Gy.show(Ou.getString("alerts/loadTrackError",[t.text]))}},{key:"positionChanged",value:function(){null!=this.documentController&&this.showPositionCursor(this._seekPosition)}},{key:"handleAudioComplete",value:function(t){var e=this.synchronizedTrack;null!=e&&e.createView(),this.loaded=!0,this.updateTemporalMap(),null!=e&&(this.seekPosition=e.seekPosition)}},{key:"handleAudioProgress",value:function(t){this.updateSeekPosition(),this.playing=!0}},{key:"handleSoundComplete",value:function(t){this.updateSeekPosition(),this.playing=!1}},{key:"updateSeekPosition",value:function(){null!=this.score&&null!=this.synchronizedTrack&&null!=this.documentController.performer.player&&this.documentController.performer.player.syncTrack&&(this.seekPosition=this.documentController.performer.player.position)}},{key:"showPositionCursor",value:function(t){null!=this.temporalMap&&this.documentController.showPositionCursor(this.temporalMap.timeToMeasurePosition(t))}},{key:"initialize",value:function(){var t=this.synchronizedTrack;null!=t&&(this.hasTrack=!0,t.complete?this.handleAudioComplete(null):(t.addEventListener(ct.COMPLETE,xt.bindMethod(this,this.handleAudioComplete)),t.addEventListener(Cf.IO_ERROR,xt.bindMethod(this,this.handleAudioError)))),this.documentController.performer.addEventListener(dt.PROGRESS,xt.bindMethod(this,this.handleAudioProgress)),this.documentController.performer.addEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handleSoundComplete))}},{key:"destroy",value:function(){this.documentController.hidePositionCursor(),null!=this.documentController.performer&&(this.documentController.performer.removeEventListener(dt.PROGRESS,xt.bindMethod(this,this.handleAudioProgress)),this.documentController.performer.removeEventListener(ct.SOUND_COMPLETE,xt.bindMethod(this,this.handleSoundComplete))),this.loaded=!1,this.hasTrack=!1,this.playing=!1}},{key:"documentController",get:function(){return this._$documentController},set:function(t){var e=this._$documentController;this._$documentController=t,e!==t&&this._propertyChanged("documentController",e,t)}},{key:"playing",get:function(){return this._$playing},set:function(t){var e=this._$playing;this._$playing=t,e!==t&&this._propertyChanged("playing",e,t)}},{key:"loaded",get:function(){return this._$loaded},set:function(t){var e=this._$loaded;this._$loaded=t,e!==t&&this._propertyChanged("loaded",e,t)}},{key:"hasTrack",get:function(){return this._$hasTrack},set:function(t){var e=this._$hasTrack;this._$hasTrack=t,e!==t&&this._propertyChanged("hasTrack",e,t)}},{key:"enableNotationInPlayback",get:function(){return this._$enableNotationInPlayback},set:function(t){var e=this._$enableNotationInPlayback;this._$enableNotationInPlayback=t,e!==t&&this._propertyChanged("enableNotationInPlayback",e,t)}},{key:"score",get:function(){return null==this.documentController||null==this.documentController.scoreDocument?null:this.documentController.scoreDocument.score}},{key:"synchronizedTrack",get:function(){var t=this.score;return null!=t?this.useDraftSynchronizedTrack?t.draftSynchronizedTrack:t.synchronizedTrack:null},set:function(t){var e=this.score;if(null==e)return null;this.useDraftSynchronizedTrack?e.draftSynchronizedTrack=t:e.synchronizedTrack=t}},{key:"temporalMap",get:function(){return null!=this.synchronizedTrack?this.synchronizedTrack.temporalMap:null}},{key:"seekPosition",get:function(){return this._seekPosition},set:function(t){this._seekPosition=t,this.positionChanged()}}]),e}();r.registerClass(Cc,"com.noteflight.notation.view.popup.AudioTrackMediator");var Nc=function(){function t(){y(this,t)}return p(t,null,[{key:"half",get:function(){return Ac},set:function(t){Ac=t}},{key:"bezBoundsRect",get:function(){return Ic},set:function(t){Ic=t}},{key:"sx",get:function(){return Pc},set:function(t){Pc=t}},{key:"sy",get:function(){return Oc},set:function(t){Oc=t}},{key:"m1",get:function(){return Qc},set:function(t){Qc=t}},{key:"m2",get:function(){return Rc},set:function(t){Rc=t}},{key:"m3",get:function(){return Dc},set:function(t){Dc=t}},{key:"dx",get:function(){return Fc},set:function(t){Fc=t}},{key:"dy",get:function(){return Uc},set:function(t){Uc=t}},{key:"dx1",get:function(){return Vc},set:function(t){Vc=t}},{key:"dx2",get:function(){return Bc},set:function(t){Bc=t}},{key:"returnResult",get:function(){return Hc},set:function(t){Hc=t}}]),p(t,null,[{key:"barycenter",value:function(t,e,i,n){return(1-n)*(1-n)*t+2*(1-n)*n*e+n*n*i}},{key:"perimeter",value:function(e,i,n,r,o,s){for(var a,l,u,h,c=e,d=i,f=0,y=0;y<=1;y+=.001)a=t.barycenter(e,n,o,y),l=t.barycenter(i,r,s,y),u=Math.abs(a-c),h=Math.abs(l-d),f+=Math.sqrt(u*u+h*h),c=a,d=l;return f}},{key:"cubicBezierCurve",value:function(t,e,i,n,r){return e*Math.pow(1-t,3)+3*i*t*Math.pow(1-t,2)+3*n*(1-t)*Math.pow(t,2)+r*Math.pow(t,3)}},{key:"cubicBezierCurveDerivativeCoord",value:function(t,e,i,n,r){return 3*((i-e)*Math.pow(1-t,2)+2*(n-i)*(1-t)*t+(r-n)*Math.pow(t,2))}},{key:"pointOnQuadraticCurve",value:function(t,e,i,n,r,o,s){var a=t/100;return{x:e+a*(2*(1-a)*(n-e)+a*(o-e)),y:i+a*(2*(1-a)*(r-i)+a*(s-i))}}},{key:"bezierBounds",value:function(e,i,n,r,o,s){var a;return e==n&&n==o?(t.bezBoundsRect.x=e,t.bezBoundsRect.y=Math.min(i,s),t.bezBoundsRect.width=1e-4,t.bezBoundsRect.height=Math.abs(s-i),t.bezBoundsRect):i==r&&r==s?(t.bezBoundsRect.x=Math.min(e,o),t.bezBoundsRect.y=i,t.bezBoundsRect.width=Math.abs(o-e),t.bezBoundsRect.height=1e-4,t.bezBoundsRect):(i>s?r>s?t.bezBoundsRect.y=s:(a=-(r-i)/(s-2*r+i),t.bezBoundsRect.y=(1-a)*(1-a)*i+2*a*(1-a)*r+a*a*s):r>i?t.bezBoundsRect.y=i:(a=-(r-i)/(s-2*r+i),t.bezBoundsRect.y=(1-a)*(1-a)*i+2*a*(1-a)*r+a*a*s),i>s?r<i?t.bezBoundsRect.bottom=i:(a=-(r-i)/(s-2*r+i),t.bezBoundsRect.bottom=(1-a)*(1-a)*i+2*a*(1-a)*r+a*a*s):s>r?t.bezBoundsRect.bottom=s:(a=-(r-i)/(s-2*r+i),t.bezBoundsRect.bottom=(1-a)*(1-a)*i+2*a*(1-a)*r+a*a*s),e>o?n>o?t.bezBoundsRect.x=o:(a=-(n-e)/(o-2*n+e),t.bezBoundsRect.x=(1-a)*(1-a)*e+2*a*(1-a)*n+a*a*o):n>e?t.bezBoundsRect.x=e:(a=-(n-e)/(o-2*n+e),t.bezBoundsRect.x=(1-a)*(1-a)*e+2*a*(1-a)*n+a*a*o),e>o?n<e?t.bezBoundsRect.right=e:(a=-(n-e)/(o-2*n+e),t.bezBoundsRect.right=(1-a)*(1-a)*e+2*a*(1-a)*n+a*a*o):n<o?t.bezBoundsRect.right=o:(a=-(n-e)/(o-2*n+e),t.bezBoundsRect.right=(1-a)*(1-a)*e+2*a*(1-a)*n+a*a*o),t.bezBoundsRect)}},{key:"lineIntersects",value:function(t,e,i,n){var r=t.x,o=t.y,s=n.x,a=n.y,l=e.x-r,u=i.x-s,h=new If;l||u||(h.x=0,h.y=0);var c=(e.y-o)/l,d=(i.y-a)/u;if(!l)return h.x=r,h.y=d*(r-s)+a,h;if(!u)return h.x=s,h.y=c*(s-r)+o,h;var f=(-d*s+a+c*r-o)/(c-d),y=c*(f-r)+o;return h.x=f,h.y=y,h}},{key:"midPoint",value:function(e,i){return new If((e.x+i.x)*t.half,(e.y+i.y)*t.half)}},{key:"splitBezier",value:function(e,i,n,r){var o=t.midPoint(e,i),s=t.midPoint(i,n),a=t.midPoint(n,r),l=t.midPoint(o,s),u=t.midPoint(s,a),h=t.midPoint(l,u);return{b0:{p1:e,c1:o,c2:l,p2:h},b1:{p1:h,c1:u,c2:a,p2:r}}}},{key:"roundTo",value:function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}},{key:"degressToRadius",value:function(t){return t*(Math.PI/180)}},{key:"radiusToDegress",value:function(t){return t*(180/Math.PI)}},{key:"rotatePoint",value:function(e,i){var n=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),r=Math.atan2(e.y,e.x)+t.degressToRadius(i);return new If(t.roundTo(n*Math.cos(r),3),t.roundTo(n*Math.sin(r),3))}},{key:"rotatePointOnCenterPoint",value:function(t,e,i){var n=new If,r=i/180*Math.PI;return n.x=e.x+(Math.cos(r)*(t.x-e.x)-Math.sin(r)*(t.y-e.y)),n.y=e.y+(Math.sin(r)*(t.x-e.x)+Math.cos(r)*(t.y-e.y)),n}},{key:"cubicToQuadratic",value:function(e,i,n,r,o,s,a,l,u,h,c){if(t.dx1=o-n,t.dx2=a-u,(t.dx1<0?-t.dx1:t.dx1)<1e-5&&(t.dx1=0),(t.dx2<0?-t.dx2:t.dx2)<1e-5&&(t.dx2=0),r!=h||s!=r||l!=h){if(t.dx1||t.dx2)if(t.dx1)if(t.dx2)if(t.m1=(s-r)/t.dx1,t.m2=(l-h)/t.dx2,(t.m1<0?-t.m1:t.m1)==(t.m2<0?-t.m2:t.m2)){if(t.m3=(h-r)/(u-n),t.m1==t.m2&&t.m3==t.m1)return void e(u,h);t.m1>t.m3&&t.m2<t.m3||t.m1<t.m3&&t.m2>t.m3?(t.sx=(o+a)/2,t.sy=(s+l)/2,t.dx=.125*(n+u+4*t.sx-3*(o+a)),t.dy=.125*(r+h+4*t.sy-3*(s+l))):(t.dx=c,t.dy=c)}else t.sx=(-t.m2*u+h+t.m1*n-r)/(t.m1-t.m2),t.sy=t.m1*(t.sx-n)+r,t.dx=.125*(n+u+4*t.sx-3*(o+a)),t.dy=.125*(r+h+4*t.sy-3*(s+l));else t.sx=u,t.sy=(s-r)/t.dx1*(u-n)+r,t.dx=.125*(n+u+4*t.sx-3*(o+a)),t.dy=.125*(r+h+4*t.sy-3*(s+l));else t.sx=n,t.sy=(l-h)/t.dx2*(n-u)+h,t.dx=.125*(n+u+4*t.sx-3*(o+a)),t.dy=.125*(r+h+4*t.sy-3*(s+l));else{var d=n-u;if(d<0&&(d=-d),!d||d<1e-5)return void e(u,h);if(t.dy=r-s,t.dy<0&&(t.dy=-t.dy),!t.dy||t.dy<1e-5){if(t.dy=h-l,t.dy<0&&(t.dy=-t.dy),!t.dy||t.dy<1e-5)return void e(u,h);t.sx=a,t.sy=l}else t.dy=h-l,t.dy<0&&(t.dy=-t.dy),!t.dy||t.dy<1e-5?(t.sx=o,t.sy=s):s<r&&l<h||s>r&&l>h?(t.sx=(o+a)/2,t.sy=(s+l)/2):(t.dx=c,t.dy=c);t.dx||(t.dx=.125*(n+u+4*t.sx-3*(o+a)),t.dy=.125*(r+h+4*t.sy-3*(s+l)))}if(t.dx*t.dx+t.dy*t.dy>c){var f=.5*(n+o),y=.5*(r+s),g=.5*(o+a),p=.5*(s+l),m=.5*(a+u),v=.5*(l+h),_=.5*(f+g),S=.5*(y+p),L=.5*(g+m),k=.5*(p+v),T=.5*(_+L),E=.5*(S+k);t.cubicToQuadratic(e,i,n,r,f,y,_,S,T,E,c),t.cubicToQuadratic(e,i,T,E,L,k,m,v,u,h,c)}else i(t.sx,t.sy,u,h)}else e(u,h)}}]),t}(),Ac=.5,Ic=new Qo,Pc=NaN,Oc=NaN,Qc=NaN,Rc=NaN,Dc=NaN,Fc=NaN,Uc=NaN,Vc=NaN,Bc=NaN,Hc=null;r.registerClass(Nc,"com.noteflight.notation.view.utilities.GeometryUtils");var $c=function(){function t(){y(this,t)}return p(t,null,[{key:"beginBackgroundFill",value:function(t,e){t.beginFill(16777215)}},{key:"isSyntheticMouseEvent",value:function(t,e){var i=new If(t.stageX,t.stageY),n=new If(e.stageX,e.stageY),r=If.distance(i,n);return r<=1||r>=1e6}}]),t}();r.registerClass($c,"com.noteflight.notation.view.utilities.ViewUtils");var Gc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._position=0,n._performance=null,n._startTime=NaN,n._endTime=NaN,n._realizer=null,n._playing=!1,n._doNotStartPlayback=!1,n._sequencer=null,n._progressTimer=null,n._performance=t,n._realizer=i,n._progressTimer=new By(e.PROGRESS_INTERVAL),n._progressTimer.addEventListener(Nf.TIMER,xt.bindMethod(u(u(n)),n.handleProgressTimer)),n}return c(e,At),p(e,null,[{key:"PROGRESS_INTERVAL",get:function(){return 50}},{key:"RELEASE_PADDING",get:function(){return 1}}]),p(e,[{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._startTime=t;var o=this._realizer.scorePositionMap.timeToScorePosition(t);this._endTime=e<0?this._realizer.scorePositionMap.scorePositionToTime(this._performance.endTime):e;var s=e<0?this._performance.endTime:Math.min(this._performance.endTime,this._realizer.scorePositionMap.timeToScorePosition(e)),a=this._performance.getStartingElements(o,s);this._sequencer=this.createSequencer(t,e,a,this._realizer,i),this._progressTimer.start();var l=this,u=this._sequencer;if(null!=u){var h=u;h.loadInstruments(function(){if(l._doNotStartPlayback)return l._doNotStartPlayback=!1,void(r&&r());h.startPlaying(),l._playing=!0,n&&n()},xt.bindMethod(this,this.progressCallback))}}},{key:"createWav",value:function(t,e){this.createAudio(t,"createWav",e)}},{key:"createMP3",value:function(t,e){this.createAudio(t,"createMP3",e)}},{key:"createAudio",value:function(t,e,i){var n=this,r=this.getAudioSynthesisContext(),o=this.createOfflineSynthesisContext(t,A.unknownToNumber(r.context.sampleRate));o.onLoad=function(){o.setScore(r.score);var s=n._realizer.scorePositionMap.timeToScorePosition(0),a=n._performance.getStartingElements(s,n._performance.endTime),l=n.createSequencer(0,-1,a,n._realizer,{context:o});o.updateAllPartsInstruments(),l[e](t,function(t){i(t),r.updateAllPartsInstruments()})}}},{key:"progressCallback",value:function(t,e){var i=Ou.getString("content.playback");this.dispatchEvent(new yt(yt.INSTRUMENT_LOAD,i,t,e))}},{key:"createOfflineSynthesisContext",value:function(t,e){return D.com_noteflight_performance_MusicPlayer_createOfflineSynthesisContext(this,t,e)}},{key:"getAudioSynthesisContext",value:function(){return D.com_noteflight_performance_MusicPlayer_getAudioSynthesisContext(this)}},{key:"createSequencer",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return D.com_noteflight_performance_MusicPlayer_createSequencer(this,t,e,i,n,r)}},{key:"stop",value:function(){null!=this._sequencer&&(this._sequencer.stop(),this._sequencer=null),this.stopInternal()}},{key:"pause",value:function(){null!=this._sequencer&&(this._sequencer.pause(),this._progressTimer.stop())}},{key:"prepareToResumePlayback",value:function(){null!=this._sequencer&&this._sequencer.prepareToResumePlayback()}},{key:"doNotStartPlayback",value:function(){this._playing||(this._doNotStartPlayback=!0)}},{key:"stopInternal",value:function(){this._playing=!1,this._progressTimer.stop(),this.dispatchEvent(new ct(ct.SOUND_COMPLETE))}},{key:"handleProgressTimer",value:function(t){this.dispatchEvent(new dt(dt.PROGRESS)),!(this.position>this._endTime+e.RELEASE_PADDING)||this._sequencer&&this._sequencer.metronomeLoop||(null!=this._sequencer&&(this._sequencer.haltPlayback(),this._sequencer=null),this.stopInternal())}},{key:"position",get:function(){if(null==this._sequencer)return 0;var t=A.unknownToNumber(this._sequencer.timeOffset());return Math.max(0,X.isNaN(t)?this._startTime:t)},set:function(t){this._sequencer&&this._sequencer.setPausedTime(t)}},{key:"rawPosition",get:function(){return null==this._sequencer?0:A.unknownToNumber(this._sequencer.timeOffset())}},{key:"syncTrack",get:function(){return!1}},{key:"statusText",get:function(){return""}},{key:"gain",get:function(){return 0},set:function(t){}},{key:"firstMeasureTime",get:function(){return 0},set:function(t){}}]),e}();r.implementsInterfaces(Gc,[Su]),r.registerClass(Gc,"com.noteflight.performance.MusicPlayer");var Yc=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).id=null,i.mediaId=null,i.mediaFileId=null,i.contentType=null,i.channelCount=0,i.sampleRate=NaN,i.duration=NaN,i.mediaFileData=null,i.loadState=e.LOAD_STATE_NOT_LOADED,i.id=t,i}return c(e,At),p(e,null,[{key:"LOAD_STATE_NOT_LOADED",get:function(){return"notLoaded"}},{key:"LOAD_STATE_LOADING",get:function(){return"loading"}},{key:"LOAD_STATE_LOADED",get:function(){return"loaded"}},{key:"LOAD_STATE_LOAD_ERROR",get:function(){return"loadError"}}]),p(e,[{key:"load",value:function(){this.notLoaded&&(this.loadState=e.LOAD_STATE_LOADING,this.dispatchEvent(new zc(zc.AUDIO_MEDIA_LOADING,this)),e.loadAudioMedia(this))}},{key:"notifyLoaded",value:function(){this.loadState=e.LOAD_STATE_LOADED,this.dispatchEvent(new zc(zc.AUDIO_MEDIA_LOADED,this))}},{key:"notifyLoadError",value:function(){this.loadState=e.LOAD_STATE_LOAD_ERROR,this.dispatchEvent(new zc(zc.AUDIO_MEDIA_LOAD_ERROR,this))}},{key:"notLoaded",get:function(){return this.loadState==e.LOAD_STATE_NOT_LOADED}},{key:"loading",get:function(){return this.loadState==e.LOAD_STATE_LOADING}},{key:"loadingComplete",get:function(){return this.loadState==e.LOAD_STATE_LOADED||this.loadState==e.LOAD_STATE_LOAD_ERROR}}],[{key:"loadAudioMedia",value:function(t){D.com_noteflight_performance_AudioMedia_loadAudioMedia(t)}},{key:"createAudioMedia",value:function(){return new e(Qg.uuid())}}]),e}();r.registerClass(Yc,"com.noteflight.performance.AudioMedia");var zc=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).audioMedia=null,n.audioMedia=i,n}return c(e,ct),p(e,null,[{key:"AUDIO_MEDIA_LOADING",get:function(){return"audioMediaLoading"}},{key:"AUDIO_MEDIA_LOADED",get:function(){return"audioMediaLoaded"}},{key:"AUDIO_MEDIA_LOAD_ERROR",get:function(){return"audioMediaLoadError"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.audioMedia)}}]),e}();r.registerClass(zc,"com.noteflight.performance.AudioMediaLoadEvent");var Wc=function t(){y(this,t)};r.registerClass(Wc,"com.noteflight.performance.IPerformableOrnament");var Xc=function(){function t(e){y(this,t),this._step=0,this._step=e}return p(t,[{key:"ornamentNote",value:function(t){var e=A.numberToInt(Math.abs(this._step));if(e<=1)return[t];for(var i=t.onset,n=[],r=[],o=A.numberToInt(this._step/e),s=t.duration/e,a=0;a<e;a++){var l=t.cloneNote();l.ornament=null,l.pitchModulations=n,l.onset=i,l.duration=s,l.pitch=t.pitch.transpose(a*o),r.push(l),i+=s}return r}}]),t}();r.implementsInterfaces(Xc,[Wc]),r.registerClass(Xc,"com.noteflight.performance.GlissandoOrnament");var Kc=function(){function t(){if(y(this,t),this._playbackEnabled=!0,null!=t._instance)throw new Error("Attempt to create multiple instances of MusicPlayerManager")}return p(t,null,[{key:"_instance",get:function(){return jc},set:function(t){jc=t}}]),p(t,[{key:"createMusicPlayer",value:function(t,e){return D.com_noteflight_performance_MusicPlayerManager_createMusicPlayer(this,t,e)}},{key:"tooManyContexts",value:function(){return!1}},{key:"playbackEnabled",get:function(){return this._playbackEnabled},set:function(t){this._playbackEnabled=t}}],[{key:"getInstance",value:function(){return null==t._instance&&(t._instance=new t),t._instance}}]),t}(),jc=null;r.registerClass(Kc,"com.noteflight.performance.MusicPlayerManager");var qc=function(){function t(e,i,n){y(this,t),this.instruments=null,this.performanceInfo=null,this.scorePositionMap=null,this.instruments=e,this.scorePositionMap=i,this.performanceInfo=n}return p(t,[{key:"realizePerformanceElements",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new Pd,n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l,u=s.value,h=A.unknownToType(u,td),c=A.unknownToType(this.instruments[h.channel],_t);if(null!=c){if(null!=this.scorePositionMap){var d=h.duration,f=h.onset;h.onset=this.scorePositionMap.scorePositionToTime(f)+e,h.duration=this.scorePositionMap.scorePositionToTime(f+d)+e-h.onset,l=c.realize(h),h.onset=f,h.duration=d}else l=c.realize(h);null!=l&&i.addElement(l)}}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}}]),t}();r.registerClass(qc,"com.noteflight.performance.MusicRealizer");var Jc=function t(){y(this,t),this.onset=NaN,this.duration=NaN,this.pitch=null};r.registerClass(Jc,"com.noteflight.performance.PerformanceElement");var Zc=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).channel=0,t.startOffset=0,t.mediaDuration=0,t.audioMedia=null,t}return c(e,Jc),e}();r.registerClass(Zc,"com.noteflight.performance.PerformableClip");var td=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).velocity=0,t.channel=0,t.tuning=0,t.articulation=null,t.ornament=null,t.pitchModulations=[],t.articulation=ed.normal,t}return c(e,Jc),p(e,null,[{key:"MAX_VELOCITY",get:function(){return 127}},{key:"STANDARD_VELOCITY",get:function(){return 100}}]),p(e,[{key:"cloneNote",value:function(){var t=new e;return t.onset=this.onset,t.duration=this.duration,t.pitch=this.pitch,t.velocity=this.velocity,t.channel=this.channel,t.tuning=this.tuning,t.articulation=this.articulation,t.ornament=this.ornament,t.pitchModulations=this.pitchModulations.slice(),t}},{key:"tunedOrdinal",get:function(){return this.pitch.ordinal+this.tuning/100}}]),e}();r.registerClass(td,"com.noteflight.performance.PerformableNote");var ed=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";y(this,t),this.value=null,this.value=e}return p(t,null,[{key:"NORMAL",get:function(){return"normal"}},{key:"LEGATO",get:function(){return"legato"}},{key:"MUTED",get:function(){return"muted"}},{key:"HARMONIC",get:function(){return"harmonic"}},{key:"SQUARE",get:function(){return"square"}},{key:"TRIANGLE",get:function(){return"triangle"}},{key:"CROSS_CIRCLE",get:function(){return"crossCircle"}},{key:"HAMMER_ON",get:function(){return"hammerOn"}},{key:"PULL_OFF",get:function(){return"pullOff"}},{key:"UP_BOW",get:function(){return"upBow"}},{key:"DOWN_BOW",get:function(){return"downBow"}},{key:"CLOSED",get:function(){return"closed"}},{key:"OPEN",get:function(){return"open"}},{key:"FERMATA",get:function(){return"fermata"}},{key:"MARCATO",get:function(){return"marcato"}},{key:"MARTELLATO",get:function(){return"martellato"}},{key:"STACCATO",get:function(){return"staccato"}},{key:"STACCATISSIMO",get:function(){return"staccatissimo"}},{key:"TENUTO",get:function(){return"tenuto"}},{key:"BUZZ",get:function(){return"buzz"}},{key:"PIZZICATO",get:function(){return"pizzicato"}},{key:"SPICCATO",get:function(){return"spiccato"}},{key:"normal",get:function(){return id}}]),t}(),id=new ed(ed.NORMAL);r.registerClass(ed,"com.noteflight.performance.PerformableNoteArticulation");var nd=function(){function t(){y(this,t),this._elements=[],this._dirty=!1,this._startTime=Number.MAX_VALUE,this._endTime=Number.MIN_VALUE}return p(t,[{key:"addElement",value:function(t){!this._dirty&&this._elements.length>0&&t.onset<this._elements[this._elements.length-1].onset&&(this._dirty=!0),this._elements.push(t),this._startTime=Math.min(this._startTime,t.onset),this._endTime=Math.max(this._endTime,t.onset+t.duration)}},{key:"getStartingElements",value:function(t,e){this.ensureSorted();for(var i=[],n=0;n<this._elements.length;n++){var r=this._elements[n].onset;r>=t&&r<e&&i.push(this._elements[n])}return i}},{key:"getActiveElements",value:function(t,e){this.ensureSorted();for(var i=[],n=0;n<this._elements.length;n++){var r=this._elements[n];r.onset<e&&r.onset+r.duration>t&&i.push(r)}return i}},{key:"offsetPerformance",value:function(t){for(var e=0;e<this._elements.length;e++){this._elements[e].onset+=t}this._startTime+=t,this._endTime+=t}},{key:"ensureSorted",value:function(){this._dirty&&(this._elements.sort(t.sortByOnset),this._dirty=!1)}},{key:"elements",get:function(){return this.ensureSorted(),this._elements}},{key:"lastOnset",get:function(){var t=this.elements;return 0===t.length?0:A.unknownToType(t[t.length-1],Jc).onset}},{key:"startTime",get:function(){return this._elements.length>0?this._startTime:0}},{key:"endTime",get:function(){return this._elements.length>0?this._endTime:0}},{key:"duration",get:function(){return this._elements.length>0?this._endTime-this._startTime:0}}],[{key:"sortByOnset",value:function(t,e){var i=t.onset,n=e.onset;return i>n?1:i<n?-1:0}}]),t}();r.registerClass(nd,"com.noteflight.performance.Performance");var rd=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y(this,t),this._period=NaN,this._cycleLength=0,this._phase=0,this._period=e,this._cycleLength=i,this._phase=n}return p(t,[{key:"ornamentNote",value:function(t){for(var e=t.onset,i=[],n=[];e<t.onset+t.duration;){var r=t.cloneNote();r.ornament=null,r.pitchModulations=i,r.onset=e+this._period*this._phase,r.duration=this._period,n.push(r),e+=this._period*this._cycleLength}return n}}]),t}();r.implementsInterfaces(rd,[Wc]),r.registerClass(rd,"com.noteflight.performance.TremoloOrnament");var od=function(){function t(e,i){y(this,t),this._period=NaN,this._step=0,this._period=e,this._step=i}return p(t,[{key:"ornamentNote",value:function(t){for(var e=t.onset,i=[],n=!1,r=t.pitch.transpose(this._step),o=[];e<t.onset+t.duration;){var s=t.cloneNote();s.ornament=null,s.pitchModulations=i,s.onset=e,s.duration=this._period,n&&(s.pitch=r),o.push(s),e+=this._period,n=!n}return o}}]),t}();r.implementsInterfaces(od,[Wc]),r.registerClass(od,"com.noteflight.performance.TrillOrnament");var sd=function(){function t(){y(this,t)}return p(t,null,[{key:"STATUS_NOTE_OFF",get:function(){return 8}},{key:"STATUS_NOTE_ON",get:function(){return 9}},{key:"STATUS_AFTERTOUCH",get:function(){return 10}},{key:"STATUS_CONTROL_CHANGE",get:function(){return 11}},{key:"STATUS_PROGRAM_CHANGE",get:function(){return 12}},{key:"STATUS_CHANNEL_PRESSURE",get:function(){return 13}},{key:"STATUS_PITCH_WHEEL",get:function(){return 14}},{key:"STATUS_SYSTEM",get:function(){return 15}},{key:"STATUS_SYSTEM_EX",get:function(){return 240}},{key:"STATUS_MTC_QUARTER_FRAME",get:function(){return 241}},{key:"STATUS_SONG_POSITION_POINTER",get:function(){return 242}},{key:"STATUS_SONG_SELECT",get:function(){return 243}},{key:"STATUS_TUNE_REQUEST",get:function(){return 246}},{key:"STATUS_CLOCK",get:function(){return 248}},{key:"STATUS_TICK",get:function(){return 249}},{key:"STATUS_START",get:function(){return 250}},{key:"STATUS_CONTINUE",get:function(){return 251}},{key:"STATUS_STOP",get:function(){return 252}},{key:"STATUS_ACTIVE_SENSE",get:function(){return 254}},{key:"STATUS_RESET",get:function(){return 255}},{key:"STATUS_SYSTEM_EX_END",get:function(){return 247}},{key:"MIDI_MIDDLE_C",get:function(){return 60}},{key:"KEY_SIGNATURE_MODE_MAJOR",get:function(){return 0}},{key:"KEY_SIGNATURE_MODE_MINOR",get:function(){return 1}},{key:"GENERAL_MIDI_PERCUSSION_OFFSET",get:function(){return 35}},{key:"PITCH_BASS_DRUM",get:function(){return"A2"}},{key:"PITCH_SNARE",get:function(){return"E3"}},{key:"PITCH_TOM_FLOOR",get:function(){return"D3"}},{key:"PITCH_TOM_LOW",get:function(){return"F3"}},{key:"PITCH_TOM_HIGH",get:function(){return"A3"}},{key:"PITCH_HIGH_HAT_PEDAL",get:function(){return"C3"}},{key:"PITCH_HIGH_HAT_CLOSED",get:function(){return"G3"}},{key:"PITCH_HIGH_HAT_OPEN",get:function(){return"G#3"}},{key:"PITCH_CYMBAL_RIDE",get:function(){return"B3"}},{key:"percussionNames",get:function(){return ad}},{key:"generalMidiToNoteflightDrumMap",get:function(){return ld}},{key:"instrumentNameToMidiMap",get:function(){return _d}},{key:"berkleeToGeneralMidiDrumMap",get:function(){return ud}},{key:"PASToGeneralMidiDrumMap",get:function(){return hd}},{key:"_percussionIndices",get:function(){return Sd},set:function(t){Sd=t}},{key:"DEFAULT_PERCUSSION_NUMBER",get:function(){return 43}},{key:"NO_KIT_PERCUSSION_INSTRUMENTS",get:function(){return["Bass Drum","Bongo","Conga","Cowbell","Cymbals","Sleigh Bell","Snare","Toms"]}},{key:"BASS_DRUM_MAP",get:function(){return cd}},{key:"BONGO_MAP",get:function(){return dd}},{key:"CONGA_MAP",get:function(){return fd}},{key:"COWBELL_MAP",get:function(){return yd}},{key:"CYMBAL_MAP",get:function(){return gd}},{key:"TOM_MAP",get:function(){return pd}},{key:"SLEIGH_BELL_MAP",get:function(){return md}},{key:"SNARE_MAP",get:function(){return vd}}]),p(t,null,[{key:"noteNumToPitch",value:function(e){return kt.middleC().transpose(e-t.MIDI_MIDDLE_C)}},{key:"pitchToNoteNum",value:function(t){return A.intToUint(t.ordinal+12)}},{key:"findPercussionMidiMap",value:function(e,i){var n=null;return t.NO_KIT_PERCUSSION_INSTRUMENTS.indexOf(i)>-1&&(n=t.instrumentNameToMidiMap[i]),null==n&&(n=e==Mn.BERKLEE_MAP?t.berkleeToGeneralMidiDrumMap:t.PASToGeneralMidiDrumMap),n}},{key:"pitchToPercussionNoteNum",value:function(e,i,n,r){var o=e.toString(),s=t.findPercussionMidiMap(n,r),a=null,l=s[i];return null!=l&&l[o]&&(a=l[o]),null==a&&"normal"!=i&&(l=s.normal)[o]&&(a=l[o]),null!=a?A.intToUint(t.percussionIndices[a]+t.GENERAL_MIDI_PERCUSSION_OFFSET):t.DEFAULT_PERCUSSION_NUMBER}},{key:"noteNumToPercussionPitch",value:function(e){var i=t.percussionNames[e-t.GENERAL_MIDI_PERCUSSION_OFFSET],n=t.generalMidiToNoteflightDrumMap[i];return null!=n?kt.pitchFromString(n):t.noteNumToPitch(e)}},{key:"percussionIndices",get:function(){if(null==t._percussionIndices){t._percussionIndices={};for(var e=0;e<t.percussionNames.length;e++)t._percussionIndices[t.percussionNames[e]]=e}return t._percussionIndices}}]),t}(),ad=["Acoustic Bass Drum","Bass Drum 1","Side Stick","Acoustic Snare","Hand Clap","Electric Snare","Low Floor Tom","Closed Hi-Hat","High Floor Tom","Pedal Hi-Hat","Low Tom","Open Hi-Hat","Low-Mid Tom","Hi-Mid Tom","Crash Cymbal 1","High Tom","Ride Cymbal 1","Chinese Cymbal","Ride Bell","Tambourine","Splash Cymbal","Cowbell","Crash Cymbal 2","Vibraslap","Ride Cymbal 2","Hi Bongo","Low Bongo","Mute Hi Conga","Open Hi Conga","Low Conga","High Timbale","Low Timbale","High Agogo","Low Agogo","Cabasa","Maracas","Short Whistle","Long Whistle","Short Guiro","Long Guiro","Claves","Hi Wood Block","Low Wood Block","Mute Cuica","Open Cuica","Mute Triangle","Open Triangle"],ld={"Acoustic Bass Drum":sd.PITCH_BASS_DRUM,"Bass Drum 1":sd.PITCH_BASS_DRUM,"Side Stick":sd.PITCH_SNARE,"Acoustic Snare":sd.PITCH_SNARE,"Hand Clap":sd.PITCH_SNARE,"Electric Snare":sd.PITCH_SNARE,"Low Floor Tom":sd.PITCH_TOM_FLOOR,"Closed Hi-Hat":sd.PITCH_HIGH_HAT_CLOSED,"High Floor Tom":sd.PITCH_TOM_FLOOR,"Pedal Hi-Hat":sd.PITCH_HIGH_HAT_PEDAL,"Low Tom":sd.PITCH_TOM_LOW,"Open Hi-Hat":sd.PITCH_HIGH_HAT_OPEN,"Low-Mid Tom":sd.PITCH_TOM_LOW,"Hi-Mid Tom":sd.PITCH_TOM_LOW,"Crash Cymbal 1":sd.PITCH_CYMBAL_RIDE,"High Tom":sd.PITCH_TOM_HIGH,"Ride Cymbal 1":sd.PITCH_CYMBAL_RIDE,"Chinese Cymbal":sd.PITCH_CYMBAL_RIDE,"Ride Bell":sd.PITCH_CYMBAL_RIDE,Tambourine:sd.PITCH_CYMBAL_RIDE,"Splash Cymbal":sd.PITCH_CYMBAL_RIDE,Cowbell:sd.PITCH_SNARE,"Crash Cymbal 2":sd.PITCH_CYMBAL_RIDE,Vibraslap:sd.PITCH_SNARE,"Ride Cymbal 2":sd.PITCH_CYMBAL_RIDE,"Hi Bongo":sd.PITCH_TOM_HIGH,"Low Bongo":sd.PITCH_TOM_LOW,"Mute Hi Conga":sd.PITCH_TOM_LOW,"Open Hi Conga":sd.PITCH_TOM_LOW,"Low Conga":sd.PITCH_TOM_FLOOR,"High Timbale":sd.PITCH_TOM_HIGH,"Low Timbale":sd.PITCH_TOM_LOW,"High Agogo":sd.PITCH_TOM_HIGH,"Low Agogo":sd.PITCH_TOM_LOW,Cabasa:sd.PITCH_HIGH_HAT_CLOSED,Maracas:sd.PITCH_HIGH_HAT_CLOSED,"Short Whistle":sd.PITCH_HIGH_HAT_CLOSED,"Long Whistle":sd.PITCH_HIGH_HAT_CLOSED,"Short Guiro":sd.PITCH_HIGH_HAT_CLOSED,"Long Guiro":sd.PITCH_HIGH_HAT_CLOSED,Claves:sd.PITCH_HIGH_HAT_CLOSED,"Hi Wood Block":sd.PITCH_TOM_HIGH,"Low Wood Block":sd.PITCH_TOM_LOW,"Mute Cuica":sd.PITCH_HIGH_HAT_CLOSED,"Open Cuica":sd.PITCH_HIGH_HAT_OPEN,"Mute Triangle":sd.PITCH_HIGH_HAT_CLOSED,"Open Triangle":sd.PITCH_HIGH_HAT_OPEN},ud={normal:{A2:"Bass Drum 1",C3:"Pedal Hi-Hat",D3:"Low Floor Tom",E3:"Acoustic Snare",F3:"Low-Mid Tom",G3:"Closed Hi-Hat",A3:"High Tom",B3:"Ride Cymbal 1",C4:"Crash Cymbal 1",D4:"Chinese Cymbal",E4:"Ride Bell"},open:{G3:"Open Hi-Hat"}},hd={normal:{D4:"Pedal Hi-Hat",E4:"Bass Drum 1",F4:"Acoustic Bass Drum",G4:"Low Floor Tom",A4:"High Floor Tom",B4:"Low Tom",C5:"Acoustic Snare",D5:"Low-Mid Tom",E5:"Hi-Mid Tom",F5:"High Tom",G5:"Closed Hi-Hat",A5:"Crash Cymbal 1",B5:"Crash Cymbal 2",C6:"Chinese Cymbal"},open:{G5:"Open Hi-Hat"},closed:{F5:"Ride Bell"},muted:{F5:"Ride Cymbal 1"}},cd={normal:{B4:"Bass Drum 1"}},dd={normal:{G4:"Low Bongo",D5:"Hi Bongo"}},fd={normal:{D5:"Low Conga",G4:"Open Hi Conga"}},yd={normal:{D5:"Cowbell",G4:"Cowbell"}},gd={normal:{E4:"Crash Cymbal 1",B4:"Crash Cymbal 2",F5:"Crash Cymbal 2"}},pd={normal:{E4:"Low Tom",B4:"Low-Mid Tom",F5:"High Tom"}},md={normal:{B4:"Ride Bell"}},vd={normal:{E4:"Acoustic Snare",B4:"Acoustic Snare",F5:"Acoustic Snare"}},_d={"Bass Drum":sd.BASS_DRUM_MAP,Bongo:sd.BONGO_MAP,Cowbell:sd.COWBELL_MAP,Cymbals:sd.CYMBAL_MAP,Toms:sd.TOM_MAP,"Sleigh Bell":sd.SLEIGH_BELL_MAP,Snare:sd.SNARE_MAP},Sd=null;r.registerClass(sd,"com.noteflight.performance.midi.Midi");var Ld=function(){function t(){y(this,t),this.tempo=120,this.ppqn=0,this.tracks=0,this.format=t.UNRECOGNIZED_FORMAT,this.tracksTruncated=!1,this.mapChannelsToPerformances=!1,this._time=0,this._timeMetric=0,this._midi=null,this._channelTable=null,this._programTable=null,this._programIdx=0,this._tempoTable=null,this._tempoIdx=0,this._timeSignatureTable=null,this._timeSignatureIdx=0,this._keySignatureTable=null,this._keySignatureIdx=0,this._performances=null,this._bpm=120,this._trackIdx=0,this._instrumentNames=null,this._trackNames=null,this._copyrights=null}return p(t,null,[{key:"HEADER_CHUNK",get:function(){return"MThd"}},{key:"TRACK_CHUNK",get:function(){return"MTrk"}},{key:"UNRECOGNIZED_FORMAT",get:function(){return 99}},{key:"SINGLE_TRACK_FORMAT",get:function(){return 0}},{key:"SIMULTANEOUS_TRACKS_FORMAT",get:function(){return 1}},{key:"SEPARATE_TRACKS_FORMAT",get:function(){return 2}},{key:"META_STATUS",get:function(){return 255}},{key:"META_SEQUENCE_NUMBER",get:function(){return 0}},{key:"META_TEXT",get:function(){return 1}},{key:"META_COPYRIGHT",get:function(){return 2}},{key:"META_TRACK_NAME",get:function(){return 3}},{key:"META_INSTRUMENT",get:function(){return 4}},{key:"META_LYRIC",get:function(){return 5}},{key:"META_MARKER",get:function(){return 6}},{key:"META_CUE_POINT",get:function(){return 7}},{key:"META_PATCH_NAME",get:function(){return 8}},{key:"META_PORT_NAME",get:function(){return 9}},{key:"META_CHANNEL_PREFIX",get:function(){return 32}},{key:"META_END_OF_TRACK",get:function(){return 47}},{key:"META_TEMPO",get:function(){return 81}},{key:"META_SMPTE_OFFSET",get:function(){return 84}},{key:"META_TIME_SIGNATURE",get:function(){return 88}},{key:"META_KEY_SIGNATURE",get:function(){return 89}},{key:"META_PROPRIETARY",get:function(){return 127}},{key:"PULSE",get:function(){return 24}},{key:"THIRTYSECONDS_PER_PULSE",get:function(){return 8}},{key:"MICROSECONDS_PER_MINUTE",get:function(){return 6e7}},{key:"DRUM_CHANNEL",get:function(){return 10}},{key:"HEADER_LENGTH",get:function(){return 6}},{key:"DIVISIONS",get:function(){return 480}},{key:"MAX_SOUNDING_TRACKS",get:function(){return 256}},{key:"MAX_CHANNELS",get:function(){return 256}},{key:"DEFAULT_TEMPO",get:function(){return 120}}]),p(t,[{key:"writeMessages",value:function(e,i){for(var n=0,r=0,o=0;o<e.length;o++)r=A.numberToUint(Math.round(e[o].onset*t.DIVISIONS/64)),this.writeVariableInt(A.intToUint(r-n),i),e[o].write(i),n=r}},{key:"createTempoTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=new Dy;(i=t.toASCII(i)).length>0&&(r.writeByte(0),r.writeByte(t.META_STATUS),r.writeByte(t.META_TRACK_NAME),r.writeByte(i.length),r.writeUTFBytes(i)),(n=t.toASCII(n)).length>0&&(r.writeByte(0),r.writeByte(t.META_STATUS),r.writeByte(t.META_COPYRIGHT),r.writeByte(n.length),r.writeUTFBytes(n)),null!=e&&(e.sort(xt.bindMethod(this,this.sortByOnset)),this.writeMessages(e,r)),r.writeByte(0),r.writeByte(t.META_STATUS),r.writeByte(t.META_END_OF_TRACK),r.writeByte(0);var o=new Dy;return o.writeUTFBytes(t.TRACK_CHUNK),o.writeInt(r.position),o.writeBytes(r),o}},{key:"createMidiTrack",value:function(e,i,n,r,o,s){var a=new Dy;if(a.writeByte(0),a.writeByte(16*sd.STATUS_PROGRAM_CHANGE+n),r<0&&(r=0),a.writeByte(r),o.length>0){a.writeByte(0),a.writeByte(t.META_STATUS),a.writeByte(t.META_INSTRUMENT);var l=new Dy;l.writeUTFBytes(o),a.writeByte(l.length),a.writeUTFBytes(o)}for(var u=[],h=0;h<e.length;h++){var c,d=A.as(e[h],td);if(d.channel==i)c=9==n?sd.pitchToPercussionNoteNum(d.pitch,null!=d.articulation?d.articulation.value:"normal",s,o):sd.pitchToNoteNum(d.pitch),u.push(new Ed(A.intToUint(h),d.onset,sd.STATUS_NOTE_ON,n,c,A.numberToUint(d.velocity))),u.push(new Ed(A.intToUint(h),d.onset+d.duration,sd.STATUS_NOTE_OFF,n,c,0))}u.sort(xt.bindMethod(this,this.sortByOnset)),this.writeMessages(u,a),this.writeVariableInt(t.DIVISIONS,a),a.writeByte(t.META_STATUS),a.writeByte(t.META_END_OF_TRACK),a.writeByte(0);var f=new Dy;return f.writeUTFBytes(t.TRACK_CHUNK),f.writeInt(a.position),f.writeBytes(a),f}},{key:"sortByOnset",value:function(t,e){return t.onset<e.onset?-1:t.onset>e.onset?1:t.onset==e.onset?t.index<e.index?-1:1:0}},{key:"createMidi",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this._midi=new Dy,this._midi.writeUTFBytes(t.HEADER_CHUNK),this._midi.writeUnsignedInt(t.HEADER_LENGTH),this._midi.writeShort(t.SIMULTANEOUS_TRACKS_FORMAT),this._midi.writeShort(e+1),this._midi.writeShort(t.DIVISIONS),this._midi}},{key:"checkFileFormat",value:function(e){for(this._midi=e,this._midi.endian=Vy.BIG_ENDIAN,this._midi.position=0;this._midi.bytesAvailable;){var i=this._midi.readUTFBytes(4),n=this._midi.readUnsignedInt(),r=this._midi.position;if(8==r&&i!=t.HEADER_CHUNK)return t.UNRECOGNIZED_FORMAT;if(i==t.HEADER_CHUNK)return this.format=A.intToUint(this._midi.readUnsignedShort()),this.format;this._midi.position=A.intToUint(r+n)}return this.format=t.UNRECOGNIZED_FORMAT,this.format}},{key:"createPerformance",value:function(e){for(this._midi=e,this._midi.endian=Vy.BIG_ENDIAN,this._performances=[],this._instrumentNames=[],this.resetState();this._midi.bytesAvailable>4;){var i=this._midi.readUTFBytes(4),n=this._midi.readUnsignedInt(),r=this._midi.position;if(0===n)break;if(8==this._midi.position&&i!=t.HEADER_CHUNK)throw new Error("invalid MIDI file format");switch(i){case t.HEADER_CHUNK:this.format=A.intToUint(this._midi.readUnsignedShort()),this.tracks=A.intToUint(this._midi.readUnsignedShort()),this.tracks>t.MAX_SOUNDING_TRACKS?(this.tracks=A.intToUint(t.MAX_SOUNDING_TRACKS+1),this.tracksTruncated=!0):this.format==t.SINGLE_TRACK_FORMAT&&(this.tracks=2),this.mapChannelsToPerformances&&(this.tracks=A.intToUint(t.MAX_CHANNELS+1));for(var o=0;o<this.tracks-1;o++)this._performances[o]=new nd;var s=this._midi.readByte(),a=this._midi.readUnsignedByte();this.ppqn=s>=0?s<<8|a:60/(this.tempo*(1/(-s*a)));break;case t.TRACK_CHUNK:if(this.format==t.SINGLE_TRACK_FORMAT&&(this._trackIdx=1),this._trackIdx>=t.MAX_SOUNDING_TRACKS)break;this._trackIdx++,this._trackIdx>this._performances.length&&this._performances.push(new nd),this._trackIdx>this.tracks&&(this.tracks=this._trackIdx),this.readTrackEvents()}this._midi.position=A.intToUint(r+n)}if(this.mapChannelsToPerformances)for(var l=0;l<this._performances.length;l++){A.as(this._performances[l],nd).elements.length<=0&&(this._performances.splice(l,1),l--)}var u=this.generateChannelMap();return new bd(this._performances,this._timeSignatureTable,this._keySignatureTable,this._tempoTable,this._instrumentNames,this._programTable,this._trackNames,this._copyrights,u)}},{key:"generateChannelMap",value:function(){for(var e=[],i=0;i<this._performances.length;i++){var n=A.as(this._performances[i],nd);if(!(n.elements.length<=0)){for(var r=[],o=0;o<=t.MAX_SOUNDING_TRACKS;o++)r[o]=0;for(o=0;o<n.elements.length;o++)r[A.as(n.elements[o],Md).channel]++;var s=0,a=0;for(o=1;o<=t.MAX_SOUNDING_TRACKS;o++)r[o]>a&&(s=o,a=A.unknownToUint(r[o]));e[i+1]=s+1}}return e}},{key:"_currentTempoForMetric",value:function(e){var i=t.DEFAULT_TEMPO;this._tempoTable.length>0&&(i=this._tempoTable[0].bpm);for(var n=0;n<this._tempoTable.length;n++)this._tempoTable[n].onsetMetric<=e&&(i=this._tempoTable[n].bpm);return i}},{key:"readTrackEvents",value:function(){this.format==t.SIMULTANEOUS_TRACKS_FORMAT&&(this._time=0,this._timeMetric=0);for(var e=0;;){var i=this.readVariableInt(),n=this._currentTempoForMetric(this._timeMetric)*this.ppqn;n>0&&(this._time+=60*i/n),this._timeMetric+=i/this.ppqn;var r=this._midi.readUnsignedByte();0!=(128&r)?e=r:this._midi.position-=1;var o=e>>4;if(o==sd.STATUS_SYSTEM){if(e==sd.STATUS_SYSTEM_EX)this.readSystemExclusive();else if(this.readSystemMessage(e))break}else this.readChannelMessage(o,A.intToUint(15&e))}}},{key:"readChannelMessage",value:function(t,e){var i,n;switch(t){case sd.STATUS_NOTE_OFF:i=this._midi.readUnsignedByte(),n=this._midi.readUnsignedByte(),this.readNoteOff(e,i,n);break;case sd.STATUS_NOTE_ON:i=this._midi.readUnsignedByte(),(n=this._midi.readUnsignedByte())>0?this.readNoteOn(e,i,n):this.readNoteOff(e,i,n);break;case sd.STATUS_AFTERTOUCH:i=this._midi.readUnsignedByte(),n=this._midi.readUnsignedByte();break;case sd.STATUS_CONTROL_CHANGE:this._midi.readUnsignedByte(),this._midi.readUnsignedByte();break;case sd.STATUS_PROGRAM_CHANGE:var r=this._midi.readUnsignedByte();this.readProgramChange(e,r);break;case sd.STATUS_CHANNEL_PRESSURE:n=this._midi.readUnsignedByte();break;case sd.STATUS_PITCH_WHEEL:this._midi.readUnsignedByte(),this._midi.readUnsignedByte()}}},{key:"readSystemMessage",value:function(e){var i=this._midi.readUnsignedByte(),n=this.readVariableInt();switch(i){case t.META_END_OF_TRACK:return!0;case t.META_TEMPO:var r=this._midi.readUnsignedByte();r<<=8,r|=this._midi.readUnsignedByte(),r<<=8,r|=this._midi.readUnsignedByte();var o=t.MICROSECONDS_PER_MINUTE/r;this._tempoIdx=this._tempoTable.push(new xd(this._tempoIdx,this._time,o,this._timeMetric));break;case t.META_TIME_SIGNATURE:var s=this._midi.readUnsignedByte(),a=this._midi.readUnsignedByte(),l=this._midi.readUnsignedByte(),u=this._midi.readUnsignedByte();this._timeSignatureIdx=this._timeSignatureTable.push(new Nd(this._timeSignatureIdx,this._time,s,a,l,u,this._timeMetric));break;case t.META_KEY_SIGNATURE:var h=this._midi.readByte(),c=this._midi.readUnsignedByte();this._keySignatureIdx=this._keySignatureTable.push(new Td(this._keySignatureIdx,this._time,h,c,A.numberToUint(this._timeMetric)));A.unknownToType(this._keySignatureTable[this._keySignatureIdx-1],Td);break;case t.META_INSTRUMENT:var d=this._midi.readUTFBytes(n);this._instrumentNames[this._trackIdx].push(d);break;case t.META_TRACK_NAME:var f=this._midi.readUTFBytes(n);this._trackNames[this._trackIdx].push(f);break;case t.META_COPYRIGHT:var y=this._midi.readUTFBytes(n);this._copyrights[this._trackIdx].push(y);break;default:this._midi.position+=n}return!1}},{key:"readSystemExclusive",value:function(){for(this._midi.readUnsignedByte();this._midi.readUnsignedByte()!=sd.STATUS_SYSTEM_EX_END;);}},{key:"readNoteOn",value:function(t,e,i){var n=new Md;n.pitch=sd.noteNumToPitch(e),n.velocity=i,n.channel=t,n.onset=this._time,n.onsetMetric=this._timeMetric,this._channelTable[(t<<8)+e]=n}},{key:"readNoteOff",value:function(e,i,n){var r=A.unknownToType(this._channelTable[(e<<8)+i],Md);if(null!=r){var o;if(r.duration=this._time-r.onset,r.durationMetric=this._timeMetric-r.onsetMetric,this.mapChannelsToPerformances){var s=e<=t.MAX_CHANNELS?e:t.MAX_CHANNELS-1;o=A.as(this._performances[s],nd)}else o=A.as(this._performances[this._trackIdx-1],nd);null!=o&&o.addElement(r)}}},{key:"readProgramChange",value:function(t,e){this._trackIdx;this._programIdx=this._programTable.push(new wd(this._programIdx,this._time,sd.STATUS_PROGRAM_CHANGE,this._trackIdx,t,e))}},{key:"resetState",value:function(){this._midi.position=0,this._channelTable=new Array(t.MAX_SOUNDING_TRACKS),this._tempoTable=[],this._timeSignatureTable=[],this._keySignatureTable=[],this._programTable=[],this._instrumentNames=new Array(t.MAX_SOUNDING_TRACKS),this._trackNames=new Array(t.MAX_SOUNDING_TRACKS),this._copyrights=new Array(t.MAX_SOUNDING_TRACKS);for(var e=0;e<t.MAX_SOUNDING_TRACKS;e++)this._instrumentNames[e]=[],this._trackNames[e]=[],this._copyrights[e]=[]}},{key:"readVariableInt",value:function(){var t,e=0;do{t=this._midi.readUnsignedByte(),e=A.intToUint((e<<7)+(127&t))}while(0!=(128&t));return e}},{key:"writeVariableInt",value:function(t,e){if(!(t>268435455))if(t<=127)e.writeByte(t);else{for(var i=A.intToUint(127&t);(t>>=7)>0;)i<<=8,i|=128,i+=A.intToUint(A.intToUint(127&t));for(;e.writeByte(i),128&i;)i>>=8}}}],[{key:"toASCII",value:function(t){return t.replace(/[^\x20-\x7E]/g,"?")}}]),t}();r.registerClass(Ld,"com.noteflight.performance.midi.MidiFile");var kd=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;y(this,t),this.index=0,this.onset=NaN,this.onsetMetric=NaN,this.statusCode=0,this.index=e,this.onset=i,this.statusCode=n,this.onsetMetric=r}return p(t,[{key:"write",value:function(t){}}]),t}();r.registerClass(kd,"com.noteflight.performance.midi.MidiMessage");var Td=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return y(this,e),(r=l(this,h(e).call(this,t,i,Ld.META_KEY_SIGNATURE,s)))._fifths=0,r._mode=0,r._fifths=n,r._mode=o,r}return c(e,kd),p(e,null,[{key:"LENGTH",get:function(){return 2}}]),p(e,[{key:"write",value:function(t){t.writeByte(Ld.META_STATUS),t.writeByte(this.statusCode),t.writeByte(e.LENGTH),t.writeByte(this._fifths),t.writeByte(sd.KEY_SIGNATURE_MODE_MAJOR)}},{key:"fifths",get:function(){return this._fifths}},{key:"mode",get:function(){return this._mode}}]),e}();r.registerClass(Td,"com.noteflight.performance.midi.MidiKeySignature");var Ed=function(t){function e(t,i,n,r,o,s){var a;return y(this,e),(a=l(this,h(e).call(this,t,i,n)))._noteNum=0,a._velocity=0,a._channel=0,a._channel=r,a._noteNum=o,a._velocity=s,a}return c(e,kd),p(e,[{key:"write",value:function(t){t.writeByte(16*this.statusCode+this._channel),t.writeByte(this._noteNum),t.writeByte(this._velocity)}},{key:"toString",value:function(){return" index "+this.index+"\n onset "+this.onset+"\n statusCode "+this.statusCode+"\n channel "+this._channel+"\n noteNum "+this._noteNum+"\n velocity "+this._velocity}}]),e}();r.registerClass(Ed,"com.noteflight.performance.midi.MidiNote");var Md=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).onsetMetric=NaN,t.durationMetric=NaN,t}return c(e,td),p(e,[{key:"toString",value:function(){return" onset "+this.onset+"\n duration "+this.duration+"\n onsetMetric "+this.onsetMetric+"\n durationMetric "+this.durationMetric+"\n pitch "+this.pitch+"\n velocity "+this.velocity+"\n channel "+this.channel+"\n articulation "+this.articulation}}]),e}();r.registerClass(Md,"com.noteflight.performance.midi.MidiPerformableNote");var bd=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;y(this,t),this.performances=null,this.timeSignatures=null,this.keySignatures=null,this.tempi=null,this.instrumentNames=null,this.programChanges=null,this.trackNames=null,this.copyrights=null,this.channelMap=null,this.performances=e,this.timeSignatures=i,this.keySignatures=n,this.tempi=r,this.instrumentNames=o,this.programChanges=s,this.trackNames=a,this.copyrights=l,this.channelMap=u}return p(t,[{key:"quartersToTime",value:function(t){var e=this.tempi;if(null!=e)for(var i=e.length-1;i>=0;i--){var n=A.unknownToType(e[i],xd);if(n.onsetMetric<=t)return n.onset+60*(t-n.onsetMetric)/n.bpm}return 0}}]),t}();r.registerClass(bd,"com.noteflight.performance.midi.MidiPerformance");var wd=function(t){function e(t,i,n,r,o,s){var a;return y(this,e),(a=l(this,h(e).call(this,t,i,n))).programNumber=0,a.track=0,a.channel=0,a.track=r,a.channel=o,a.programNumber=s,a}return c(e,kd),p(e,[{key:"write",value:function(t){t.writeByte(16*this.statusCode+this.channel),t.writeByte(this.programNumber)}},{key:"toString",value:function(){return" index "+this.index+"\n onset "+this.onset+"\n statusCode "+this.statusCode+"\n track "+this.track+"\n channel "+this.channel+"\n programNumber "+this.programNumber}}]),e}();r.registerClass(wd,"com.noteflight.performance.midi.MidiProgramChange");var xd=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return y(this,e),(n=l(this,h(e).call(this,t,i,Ld.META_TEMPO)))._bpm=NaN,n._bpm=r,n.onsetMetric=o,n}return c(e,kd),p(e,null,[{key:"LENGTH",get:function(){return 4}}]),p(e,[{key:"write",value:function(t){t.writeByte(Ld.META_STATUS),t.writeByte(this.statusCode),t.writeByte(3);var e=A.numberToUint(Math.round(Ld.MICROSECONDS_PER_MINUTE/this.bpm));t.writeByte(e>>16),t.writeByte(e>>8),t.writeByte(e)}},{key:"bpm",get:function(){return this._bpm},set:function(t){this._bpm=t}}]),e}();r.registerClass(xd,"com.noteflight.performance.midi.MidiTempo");var Cd=function(t){function e(t,i,n){var r;return y(this,e),(r=l(this,h(e).call(this,t,i,Ld.META_TEXT)))._text=null,r._text=n,r}return c(e,kd),p(e,[{key:"write",value:function(t){this._text.length<=0||(t.writeByte(Ld.META_STATUS),t.writeByte(this.statusCode),t.writeByte(this._text.length),t.writeUTFBytes(this._text))}}]),e}();r.registerClass(Cd,"com.noteflight.performance.midi.MidiText");var Nd=function(t){function e(t,i,n,r){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return y(this,e),(o=l(this,h(e).call(this,t,i,Ld.META_TIME_SIGNATURE)))._numerator=0,o._denominator=0,o._pulse=0,o._thirtysecondsPerPulse=0,o._numerator=n,o._denominator=r,o._pulse=s<=0?s:Ld.PULSE,o._thirtysecondsPerPulse=a<=0?a:Ld.THIRTYSECONDS_PER_PULSE,o.onsetMetric=u,o}return c(e,kd),p(e,null,[{key:"LENGTH",get:function(){return 4}}]),p(e,[{key:"write",value:function(t){t.writeByte(Ld.META_STATUS),t.writeByte(this.statusCode),t.writeByte(e.LENGTH),t.writeByte(this._numerator),t.writeByte(A.numberToInt(Math.round(Math.log(this._denominator)/Math.LN2))),t.writeByte(Ld.PULSE),t.writeByte(Ld.THIRTYSECONDS_PER_PULSE)}},{key:"numerator",get:function(){return this._numerator}},{key:"denominator",get:function(){return A.numberToUint(Math.round(Math.pow(2,this._denominator)))}},{key:"pulse",get:function(){return this._pulse}},{key:"thirtysecondsPerPulse",get:function(){return this._thirtysecondsPerPulse}}]),e}();r.registerClass(Nd,"com.noteflight.performance.midi.MidiTimeSignature");var Ad=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.RATE_44100,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.CHANNELS_STEREO;y(this,t),this._rate=0,this._channels=0,this._rate=e,this._channels=i}return p(t,null,[{key:"CHANNELS_MONO",get:function(){return 1}},{key:"CHANNELS_STEREO",get:function(){return 2}},{key:"RATE_44100",get:function(){return 44100}},{key:"RATE_22050",get:function(){return 22050}},{key:"RATE_11025",get:function(){return 11025}},{key:"RATE_5512",get:function(){return 5512}}]),p(t,[{key:"rate",get:function(){return this._rate}},{key:"channels",get:function(){return this._channels}}],[{key:"compare",value:function(t,e){return t.rate==e.rate&&t.channels==e.channels}}]),t}();r.registerClass(Ad,"com.noteflight.standingwave3.elements.AudioDescriptor");r.registerClass(function t(){y(this,t)},"com.noteflight.standingwave3.elements.IAudioSource");var Id=function t(){y(this,t)};r.registerClass(Id,"com.noteflight.standingwave3.performance.IPerformance");var Pd=function(){function t(){y(this,t),this._elements=[],this._dirty=!1,this._frameCount=0,this._lastIndex=0}return p(t,[{key:"addElement",value:function(t){!this._dirty&&this._elements.length>0&&t.start<this._elements[this._elements.length-1].start&&(this._dirty=!0),this._elements.push(t),this._frameCount=Math.max(this._frameCount,t.end)}},{key:"addSourceAt",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.addElement(new Od(t,e,i,n))}},{key:"getElementsInRange",value:function(t,e){var i=this.elements,n=[];for(this._lastIndex=Math.max(0,Math.min(this._lastIndex,i.length-1));this._lastIndex>0&&i[this._lastIndex-1].start>=t;)this._lastIndex--;for(;this._lastIndex<i.length&&i[this._lastIndex].start<t;)this._lastIndex++;for(;this._lastIndex<i.length&&i[this._lastIndex].start<e;)n.push(i[this._lastIndex++]);return n}},{key:"clone",value:function(){var e=new t,i=!0,n=!1,r=void 0;try{for(var o,s=this.elements[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e.addElement(new Od(a.startTime,a.source.clone()))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"ensureSorted",value:function(){this._dirty&&(this._elements.sort(t.sortByStart),this._dirty=!1)}},{key:"elements",get:function(){return this.ensureSorted(),this._elements}},{key:"lastStart",get:function(){var t=this.elements;return 0===t.length?0:t[t.length-1].start}},{key:"frameCount",get:function(){return this._frameCount}}],[{key:"sortByStart",value:function(t,e){var i=t.start,n=e.start;return i>n?1:i<n?-1:0}}]),t}();r.implementsInterfaces(Pd,[Id]),r.registerClass(Pd,"com.noteflight.standingwave3.performance.ListPerformance");var Od=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;y(this,t),this._source=null,this._start=NaN,this.gain=NaN,this.pan=NaN,this._start=Math.floor(e*i.descriptor.rate),this._source=i,this.gain=n,this.pan=r}return p(t,[{key:"onset",set:function(t){this._start=Math.floor(t*this.source.descriptor.rate)},get:function(){return this._start/this.source.descriptor.rate}},{key:"source",get:function(){return this._source}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._start+this._source.frameCount}},{key:"startTime",get:function(){return this._start/this.source.descriptor.rate}},{key:"endTime",get:function(){return this.end/this.source.descriptor.rate}}]),t}();r.registerClass(Od,"com.noteflight.standingwave3.performance.PerformableAudioSource");var Qd=function(){function t(){y(this,t)}return p(t,null,[{key:"DECIBELS_PER_DECADE",get:function(){return 20}},{key:"MINIMUM_SIGNAL",get:function(){return Rd}},{key:"MINIMUM_CONTROL",get:function(){return Dd}},{key:"ZERO_GAIN_DECIBELS",get:function(){return Fd}},{key:"MINIMUM_CONTROL_LN",get:function(){return Ud}}]),p(t,null,[{key:"decibelsToFactor",value:function(e){return Math.exp(e*Math.LN10/t.DECIBELS_PER_DECADE)}},{key:"factorToDecibels",value:function(e){return Math.log(e)*Math.LOG10E*t.DECIBELS_PER_DECADE}},{key:"panToFactors",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-3,n={},r=t.decibelsToFactor(i);return e<-1&&(e=-1),e>1&&(e=1),e>0?(n.left=r*(1-e),n.right=r*(1-e)+e):(n.left=r*(1+e)-e,n.right=r*(1+e)),n}},{key:"concaveUnipolar",value:function(e){return Math.log(Math.max(t.MINIMUM_CONTROL,e))/t.MINIMUM_CONTROL_LN}},{key:"noteNumberToFrequency",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:440)*Math.pow(2,(t-69)/12)}},{key:"frequencyToNoteNumber",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:440;return 69+12*Math.log(t/e)}}]),t}(),Rd=1/65536,Dd=1/128,Fd=Qd.factorToDecibels(Qd.MINIMUM_SIGNAL),Ud=Math.log(Qd.MINIMUM_CONTROL);r.registerClass(Qd,"com.noteflight.standingwave3.utils.AudioUtils");var Vd=function(){function t(){y(this,t)}return p(t,null,[{key:"_environmentKnown",get:function(){return Bd},set:function(t){Bd=t}},{key:"_isFingerTouchScreenType",get:function(){return Hd},set:function(t){Hd=t}},{key:"mockLocalStorage",get:function(){return $d},set:function(t){$d=t}}]),p(t,null,[{key:"getLocalStorage",value:function(){return this.mockLocalStorage?this.mockLocalStorage:D.com_noteflight_utils_ApplicationUtil_getLocalStorage()}},{key:"ensureEnvironmentKnown",value:function(){t._environmentKnown||(t._isFingerTouchScreenType="finger"==Kd.getObjectProperty(Uf,"touchscreenType"),t._environmentKnown=!0)}},{key:"isFingerTouchScreenType",get:function(){return t.ensureEnvironmentKnown(),t._isFingerTouchScreenType}}]),t}(),Bd=!1,Hd=!1,$d=null;r.registerClass(Vd,"com.noteflight.utils.ApplicationUtil");var Gd=function(){function t(){y(this,t)}return p(t,null,[{key:"parseBoolean",value:function(t){return"boolean"==typeof t?A.unknownToType(t,Boolean):"string"==typeof t&&"true"==A.castUnknownToString(t).toLowerCase()}},{key:"parseFromOptions",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&i&&e.hasOwnProperty(i)?t.parseBoolean(e[i]):n}},{key:"parseFromXml",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.child(i).get(0);return r&&r.text()?t.parseBoolean(r.text().toString()):n}}]),t}();r.registerClass(Gd,"com.noteflight.utils.BooleanUtil");var Yd=function(){function t(){y(this,t)}return p(t,null,[{key:"parseToInt",value:function(t){return"number"==typeof t?A.as(t,Hy):"string"==typeof t?A.numberToInt(X.parseInt(A.as(t,String))):0}},{key:"parseFromOptions",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e&&i&&e.hasOwnProperty(i)?t.parseToInt(e[i]):n}},{key:"parseFromXml",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.child(i).get(0);return r&&r.text()?t.parseToInt(r.text().toString()):n}}]),t}();r.registerClass(Yd,"com.noteflight.utils.IntUtil");var zd=function(){function t(){y(this,t)}return p(t,null,[{key:"greatestCommonDivisor",value:function(t,e){for(var i=t%e;i;)i=(t=e)%(e=i);return e}},{key:"greatestCommonDivisorArray",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<0)return 0;if(1==e.length)return A.unknownToUint(e[0]);for(var i=t.greatestCommonDivisor(A.unknownToUint(e[0]),A.unknownToUint(e[1])),n=2;n<e.length;n++)i=t.greatestCommonDivisor(i,A.unknownToUint(e[n]));return i}},{key:"leastCommonMultipleArray",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<0)return 0;if(1==e.length)return A.unknownToUint(e[0]);for(var i=t.leastCommonMultiple(A.unknownToUint(e[0]),A.unknownToUint(e[1])),n=2;n<e.length;n++)i=t.leastCommonMultiple(i,A.unknownToUint(e[n]));return i}},{key:"leastCommonMultiple",value:function(e,i){return A.numberToUint(A.numberToUint(e*i/t.greatestCommonDivisor(e,i)))}}]),t}();r.registerClass(zd,"com.noteflight.utils.MathUtil");var Wd=function(){function t(){y(this,t)}return p(t,null,[{key:"generateUUID",value:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)})}}]),t}();r.registerClass(Wd,"com.noteflight.utils.IDUtil");var Xd=function(){function t(){y(this,t)}return p(t,null,[{key:"binarySearch",value:function(t,e,i){for(var n=0,r=t.length-1;n<=r;){var o=A.numberToInt((n+r)/2);A.unknownToInt(i(e,t[o]))<0?r=o-1:n=o+1}return r}}]),t}();r.registerClass(Xd,"com.noteflight.utils.NFArrayUtil");var Kd=function(){function t(){y(this,t)}return p(t,null,[{key:"countNumberOfElements",value:function(t){var e=0;for(var i in t)e++;return e}},{key:"setObjectProperty",value:function(t,e,i){t[e]=i}},{key:"getObjectProperty",value:function(t,e){return t[e]}},{key:"getIntObjectProperty",value:function(t,e){return A.unknownToInt(t[e])}},{key:"getNumberObjectProperty",value:function(t,e){return A.unknownToNumber(t[e])}},{key:"valueToString",value:function(t){return null==t?null:A.is(t,Object)?A.as(t,Object).toString():A.unknownToObject(t).toString()}}]),t}();r.registerClass(Kd,"com.noteflight.utils.ObjectUtil");var jd=function(){function t(){y(this,t)}return p(t,null,[{key:"timerStack",get:function(){return qd},set:function(t){qd=t}},{key:"indent",get:function(){return Jd},set:function(t){Jd=t}},{key:"globalTimerStack",get:function(){return Zd},set:function(t){Zd=t}},{key:"statsTimerStack",get:function(){return tf},set:function(t){tf=t}},{key:"statsTimerResults",get:function(){return ef},set:function(t){ef=t}},{key:"enabled",get:function(){return nf},set:function(t){nf=t}},{key:"simpleOutput",get:function(){return rf},set:function(t){rf=t}},{key:"silentMode",get:function(){return of},set:function(t){of=t}},{key:"classWhitelist",get:function(){return sf},set:function(t){sf=t}},{key:"methodWhitelist",get:function(){return af},set:function(t){af=t}},{key:"classBlacklist",get:function(){return lf},set:function(t){lf=t}},{key:"methodBlacklist",get:function(){return uf},set:function(t){uf=t}}]),p(t,null,[{key:"pushTimer",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.isEnabled(e,i)&&t.doPushTimer(e,i,n,r)}},{key:"popTimer",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.isEnabled(e,i)&&t.doPopTimer(e,i,n,r)}},{key:"printTimingStats",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i="",n=0;n<t.statsTimerResults.length;n++)i+=t.statsTimerResults[n].text+": "+t.statsTimerResults[n].time+"ms\n";e?Gy.show(i):X.trace(i)}},{key:"doPushTimer",value:function(e,i,n,r){var o;if(n)for(var s=0;s<t.globalTimerStack.length;s++)if((o=A.unknownToType(t.globalTimerStack[s],B)).className==e&&o.methodName==i)return;o=new B(e,i,new Date,0),r?t.statsTimerStack.push(o):n?(t.log("+ Global time: "+t.getIndentString()+t.who(o)),t.globalTimerStack.push(o)):(t.simpleOutput||t.log("+ "+t.getIndentString()+t.who(o)+" {"),t.timerStack.push(o))}},{key:"doPopTimer",value:function(e,i,n,r){var o,s,a;if(r){for(a=0;a<t.statsTimerStack.length;a++)if((s=A.unknownToType(t.statsTimerStack[a],B)).className==e&&s.methodName==i)return t.statsTimerResults.push(new W(t.who(s),(new Date).getTime()-s.now.getTime())),void t.statsTimerStack.splice(a,1)}else if(n){for(a=0;a<t.globalTimerStack.length;a++)if((s=A.unknownToType(t.globalTimerStack[a],B)).className==e&&s.methodName==i)return o=(new Date).getTime()-s.now.getTime(),void t.log("- Global time: "+o+" - "+t.who(s));t.log("expected global timer"+e+"."+i+" to match "+t.who(s))}else{if(0===t.timerStack.length)return t.log("timer stack is empty!"),void(t.enabled=!1);if(e!=(s=t.timerStack.pop()).className||i!=s.methodName)return t.log("expected "+e+"."+i+" to match "+t.who(s)),void(t.enabled=!1);var l=(o=(new Date).getTime()-s.now.getTime())-s.childTime;t.timerStack.length>0&&(t.timerStack[t.timerStack.length-1].childTime+=o);t.simpleOutput?t.log(" - "+o+" - "+l+" - "+t.who(s)+" - "):t.log("- "+t.getIndentString()+"} "+o+"ms ("+l+"ms) - "+t.who(s))}}},{key:"getIndentString",value:function(){for(var e=t.timerStack.length,i=A.numberToInt(2*e);t.indent.length<i;)t.indent=t.indent+t.indent;return t.indent.substr(0,i)}},{key:"isEnabled",value:function(e,i){return!!t.enabled&&(!(t.classBlacklist.indexOf(e)>-1)&&(!(t.methodBlacklist.indexOf(i)>-1)&&(!(t.classWhitelist.length>0&&-1==t.classWhitelist.indexOf(e))&&!(t.methodWhitelist.length>0&&-1==t.methodWhitelist.indexOf(i)))))}},{key:"log",value:function(e){if(!t.silentMode){X.trace(e);try{Af.call("console.log",e)}catch(t){throw t}}}},{key:"who",value:function(t){return t.className+"."+t.methodName}}]),t}(),qd=[],Jd=" ",Zd=[],tf=[],ef=[],nf=!1,rf=!1,of=!1,sf=[],af=[],lf=[],uf=[];r.registerClass(jd,"com.noteflight.utils.PerfUtil");var hf=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y(this,t),this._synchronous=!1,this._process=null,this._nextStep=null,this._nextStepTimer=null,this._completionEvent=null,this._complete=!1,this._process=e,this._synchronous=i}return p(t,[{key:"start",value:function(t){if(this._complete=!1,this._completionEvent=null,this._nextStep=t,this._synchronous)for(;null!=this._nextStep;){var e=this._nextStep;this._nextStep=null,e()}else this._nextStep()}},{key:"yield",value:function(t){this._synchronous?this._nextStep=t:(this._nextStep=t,this._nextStepTimer=new By(10,1),this._nextStepTimer.addEventListener(Nf.TIMER,xt.bindMethod(this,this.timerComplete)),this._nextStepTimer.start())}},{key:"timerComplete",value:function(t){null!=this._nextStep&&this._nextStep()}},{key:"reportProgress",value:function(t){this._process.dispatchEvent(t)}},{key:"complete",value:function(t){this._complete=!0,this._completionEvent=t,this._process.dispatchEvent(t)}},{key:"completionEvent",get:function(){return this._completionEvent}}]),t}();r.registerClass(hf,"com.noteflight.utils.ProgressManager");var cf=function(){function t(){y(this,t)}return p(t,null,[{key:"normalizeWhitespace",value:function(t){return t.replace(/\s+/g," ")}},{key:"levenshteinDistance",value:function(t,e){for(var i,n=new Array(t.length+1),r=0;r<=t.length;r++)n[r]=new Array(e.length+1),n[r][0]=r;for(var o=0;o<=e.length;o++)n[0][o]=o;for(r=1;r<=t.length;r++)for(o=1;o<=e.length;o++)i=t.charAt(r)==e.charAt(o)?0:1,n[r][o]=A.numberToUint(Math.min(n[r-1][o]+1,n[r][o-1])),n[r][o]=A.numberToUint(Math.min(n[r][o],n[r-1][o-1]+i));return n[t.length][e.length]}},{key:"formatMarkdown",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i";return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank"><u>$1</u></a>').replace(/\*([^*]+)\*/g,"<"+e+">$1</"+e+">")}}]),t}();r.registerClass(cf,"com.noteflight.utils.StringUtil");var df=function(){function t(){y(this,t)}return p(t,null,[{key:"CANVAS",get:function(){return"canvas"}},{key:"SVG",get:function(){return"svg"}},{key:"implementation",get:function(){return ff}}]),p(t,[{key:"clear",value:function(){}},{key:"beginFill",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"beginSvgFill",value:function(t){}},{key:"endFill",value:function(){}},{key:"lineTo",value:function(t,e){}},{key:"moveTo",value:function(t,e){}},{key:"svgPath",value:function(t){}},{key:"svgStroke",value:function(t,e,i,n,r){}},{key:"lineStyle",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7]}},{key:"drawRect",value:function(t,e,i,n){}},{key:"drawEllipse",value:function(t,e,i,n){}},{key:"drawCircle",value:function(t,e,i){}},{key:"curveTo",value:function(t,e,i,n){}},{key:"pushAlpha",value:function(t){}},{key:"popAlpha",value:function(){}}],[{key:"colorToRGBA",value:function(t,e){return"rgba("+(t>>>16&255)+","+(t>>>8&255)+","+(255&t)+","+e+")"}},{key:"extractAlphaFromRGBA",value:function(t){return A.stringToNumber(t.replace(/^.*,(.+)\)/,"$1"))}}]),t}(),ff=df.SVG;r.registerClass(df,"flash.display.Graphics");var yf=function(){function t(){y(this,t)}return p(t,null,[{key:"HORIZONTAL",get:function(){return"horizontal"}},{key:"NONE",get:function(){return"none"}},{key:"NORMAL",get:function(){return"normal"}},{key:"VERTICAL",get:function(){return"vertical"}}]),t}();r.registerClass(yf,"flash.display.LineScaleMode");var gf=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).content=null,t.contentLoaderInfo=null,t.contentLoaderInfo=new pf,t}return c(e,zr),p(e,[{key:"load",value:function(t){var e=this,i=new(A.unknownToType(X.JS_window().Image,L));i.addEventListener("load",function(){e.loadSvgImage(e,i,t)}),i.src=t.url}},{key:"loadSvgImage",value:function(t,e,i){var n=this.svgContext.createElement("image");n.setAttributeNS("http://www.w3.org/1999/xlink","href",i.url),n.setAttributeNS(null,"height",e.height),n.setAttributeNS(null,"width",e.width),this._svg.appendChild(n),t.contentLoaderInfo.dispatchCompleteEvent()}}]),e}();r.registerClass(gf,"flash.display.Loader");var pf=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,At),p(e,[{key:"dispatchCompleteEvent",value:function(){this.dispatchEvent(new ct(ct.COMPLETE))}}]),e}();r.registerClass(pf,"flash.display.LoaderInfo");var mf=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this))).align=null,n.allowsFullScreen=!1,n.allowsFullScreenInteractive=!1,n.autoOrients=!1,n.color=0,n.colorCorrection=null,n.colorCorrectionSupport=null,n.deviceOrientation=null,n.displayState=null,n.frameRate=NaN,n.fullScreenHeight=0,n.fullScreenSourceRect=null,n.fullScreenWidth=0,n.mouseLock=!1,n.orientation=null,n.quality=null,n.scaleMode=null,n.showDefaultContextMenu=!1,n.softKeyboardRect=null,n.stageFocusRect=!1,n.stageHeight=0,n.stageWidth=0,n.supportedOrientations=null,n.wmodeGPU=!1,n.controller=null,n._mouseX=NaN,n._mouseY=NaN,n.mouseButton=!1,n._focus=null,n._focusElement=null,n.controller=t,i||(i=t.rootSvg),i.append(n.svgElement),n.addEventListener(li.MOUSE_DOWN,xt.bindMethod(u(u(n)),n.trackMouseState),!0),n.addEventListener(li.MOUSE_MOVE,xt.bindMethod(u(u(n)),n.trackMouseState),!0),n.addEventListener(li.MOUSE_UP,xt.bindMethod(u(u(n)),n.trackMouseState),!0),n}return c(e,zr),p(e,null,[{key:"supportsOrientationChange",get:function(){return vf},set:function(t){vf=t}}]),p(e,[{key:"trackMouseState",value:function(t){this._mouseX=t.stageX,this._mouseY=t.stageY,t.type==li.MOUSE_DOWN?this.mouseButton=!0:t.type==li.MOUSE_UP&&(this.mouseButton=!1)}},{key:"mousePositionFor",value:function(t){if(t==this)return{x:this._mouseX,y:this._mouseY};var e=this.stageOffset;return this.svgContext.transformPoint(e.x+this._mouseX,e.y+this._mouseY,t.screenCTM.inverse())}},{key:"width",get:function(){return this.controller.stageWidth},set:function(t){o(h(e.prototype),"width",t,this,!0)}},{key:"height",get:function(){return this.controller.stageHeight},set:function(t){o(h(e.prototype),"height",t,this,!0)}},{key:"stageOffset",get:function(){return this.controller.stageOffset}},{key:"stage",get:function(){return this}},{key:"focus",get:function(){return this._focus},set:function(t){if(t!=this._focus){var e=this._focus;if(this._focus=t,e&&(this._focusElement&&!t&&X.setTimeout(function(){this._focusElement&&!this._focus&&this._focusElement.blur()},100),A.is(e,Ty)&&A.unknownToType(e,Ty).teardownFocusElement()),t&&t==this._focus&&A.is(t,Ty)){if(!this._focusElement){var i=X.jQuery('<textarea autocapitalize="off" autocorrect="off" style="overflow-x: hidden; overflow-y: hidden;">');this.controller.sizingDiv.append(i),this._focusElement=i[0]}A.unknownToType(t,Ty).setupFocusElement(this._focusElement),this._focusElement.focus()}}}},{key:"displayListStats",get:function(){var t=new M;return this.updateDisplayListStats(t),t}}]),e}(),vf=!1;r.registerClass(mf,"flash.display.Stage");var _f=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this)))._svg=null,n._object=null,n._fillProperties=null,n._strokeProperties=null,n._transformProperties=null,n._path=null,n._pathData=null,n._alphaStack=null,n._globalAlpha=1,n._object=t,n._svg=i,n}return c(e,df),p(e,null,[{key:"CAPS_MAP",get:function(){return Sf}},{key:"JOINT_MAP",get:function(){return Lf}}]),p(e,[{key:"clear",value:function(){for(;this._object._svgGraphicsCount>0;)this._svg.removeChild(this._svg.firstChild),this._object._svgGraphicsCount--;this._path=null,this._fillProperties=null,this._strokeProperties=null,this._transformProperties=null}},{key:"beginFill",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={};this._fillProperties=i,0===t&&e*this._globalAlpha==1||(i.fill=df.colorToRGBA(t,e*this._globalAlpha)),this._path=null}},{key:"beginSvgFill",value:function(t){this._fillProperties={fill:t},this._path=null}},{key:"endFill",value:function(){this._fillProperties=null,this._path=null}},{key:"lineTo",value:function(t,e){this.createPath(!0),this.appendPathData("L"+t+","+e)}},{key:"moveTo",value:function(t,e){this.createPath(!1),this.appendPathData("M"+t+","+e)}},{key:"svgPath",value:function(t){this.createPath(!1),this.appendPathData(t)}},{key:"svgStroke",value:function(t,e,i,n,r){this._strokeProperties={},t&&(this._strokeProperties.stroke=t),e&&(this._strokeProperties["stroke-width"]=e),i&&(this._strokeProperties["stroke-linecap"]=i),n&&(this._strokeProperties["stroke-linejoin"]=n),r&&(this._strokeProperties["stroke-miterlimit"]=r)}},{key:"svgTransform",value:function(t){this._transformProperties={transform:t},this._path=null}},{key:"lineStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]?arguments[5]:null),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a={};if(this._strokeProperties=a,a.stroke=df.colorToRGBA(i,n*this._globalAlpha),!X.isNaN(t)&&t>.5?a["stroke-width"]=t:a["stroke-width"]=.5,r){var l=e.CAPS_MAP[r];l&&(a["stroke-linecap"]=l)}if(o){var u=e.JOINT_MAP[o];u&&(a["stroke-linejoin"]=u)}(s<3||s>4)&&(a["stroke-miterlimit"]=s),this._path=null}},{key:"drawRect",value:function(t,e,i,n){this._path=null;var r=this.svgContext.createElement("rect");r.setAttribute("x",t),r.setAttribute("y",e),r.setAttribute("width",i),r.setAttribute("height",n),this.applyFillAndStroke(r),this.appendGraphicsElement(r)}},{key:"drawEllipse",value:function(t,e,i,n){this._path=null;var r=this.svgContext.createElement("ellipse");r.setAttribute("cx",t+i/2),r.setAttribute("cy",e+n/2),r.setAttribute("rx",i/2),r.setAttribute("ry",n/2),this.applyFillAndStroke(r),this.appendGraphicsElement(r)}},{key:"drawCircle",value:function(t,e,i){this._path=null;var n=this.svgContext.createElement("circle");n.setAttribute("cx",t),n.setAttribute("cy",e),n.setAttribute("r",i),this.applyFillAndStroke(n),this.appendGraphicsElement(n)}},{key:"curveTo",value:function(t,e,i,n){this.createPath(!0),this.appendPathData("Q"+t+","+e+" "+i+","+n)}},{key:"pushAlpha",value:function(t){this._path=null,null==this._alphaStack&&(this._alphaStack=[]),this._alphaStack.push(this._globalAlpha),this._globalAlpha=this._globalAlpha*t}},{key:"popAlpha",value:function(){this._path=null,this._globalAlpha=this._alphaStack.pop()}},{key:"applyFillAndStroke",value:function(t){var e;if(this._fillProperties)for(e in this._fillProperties)t.setAttribute(e,this._fillProperties[e]);else t.setAttribute("fill","none");if(this._strokeProperties)for(e in this._strokeProperties)t.setAttribute(e,this._strokeProperties[e]);else t.setAttribute("stroke","none")}},{key:"applyTransform",value:function(t){if(this._transformProperties)for(var e in this._transformProperties)t.setAttribute(e,this._transformProperties[e])}},{key:"createPath",value:function(t){null==this._path&&(this._path=this.svgContext.createElement("path"),this.applyFillAndStroke(this._path),this.applyTransform(this._path),this.appendGraphicsElement(this._path),this._pathData=""),t&&""===this._pathData&&(this._pathData="M0,0")}},{key:"appendPathData",value:function(t){null!=this._path&&(this._pathData+=t,this._path.setAttribute("d",this._pathData))}},{key:"setPathAttribute",value:function(t,e){null!=this._path&&this._path.setAttribute(t,e)}},{key:"appendGraphicsElement",value:function(t){this._object._svgGraphicsCount<this._svg.childNodes.length?this._svg.insertBefore(t,this._svg.childNodes[this._object._svgGraphicsCount]):this._svg.appendChild(t),this._object._svgGraphicsCount++}},{key:"svgContext",get:function(){return this._object.svgContext}}]),e}(),Sf={none:"butt",round:"round",square:"square"},Lf={bevel:"bevel",miter:"miter",round:"round"};r.registerClass(_f,"flash.display.SvgGraphics");var kf=function(t){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];return y(this,e),l(this,h(e).call(this))}return c(e,ct),p(e,null,[{key:"LINK",get:function(){return"link"}},{key:"TEXT_INPUT",get:function(){return"textInput"}}]),p(e,[{key:"text",get:function(){return D.flash_events_TextEvent_$get$text(this)},set:function(t){D.flash_events_TextEvent_$set$text(this,t)}}]),e}();r.registerClass(kf,"flash.events.TextEvent");var Tf=function(t){function e(t){var i;arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];return y(this,e),(i=l(this,h(e).call(this))).errorID=0,i}return c(e,kf),p(e,null,[{key:"ERROR",get:function(){return"error"}}]),e}();r.registerClass(Tf,"flash.events.ErrorEvent");var Ef=function(t){function e(t){return y(this,e),l(this,h(e).call(this,t,!0))}return c(e,ct),p(e,null,[{key:"SCORE_LOADING_ERROR",get:function(){return"scoreLoadingError"}}]),p(e,[{key:"clone",value:function(){return new e(this.type)}}]),e}();r.registerClass(Ef,"com.noteflight.notation.event.GenericErrorEvent");var Mf=function(){function t(e,i,n,r,o){y(this,t),this.type=null,this.eventId=NaN,this.listener=null,this.useCapture=!1,this.priority=0,this.useWeakReference=!1,this.type=e,this.eventId=this.getId(e),this.listener=i,this.useCapture=n,this.priority=r,this.useWeakReference=o}return p(t,null,[{key:"eventIds",get:function(){return bf},set:function(t){bf=t}},{key:"eventIdCounter",get:function(){return wf},set:function(t){wf=t}}]),p(t,[{key:"getId",value:function(e){return t.eventIds[e]?A.unknownToNumber(t.eventIds[e]):(t.eventIdCounter+=1,t.eventIds[e]=t.eventIdCounter,t.eventIdCounter)}},{key:"matches",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(null!=e&&t.eventIds[e]!=this.eventId||n!=this.useCapture||null!=i&&i!=this.listener)}},{key:"updateDisplayListStats",value:function(t){t.eventListenerCount++,this.useWeakReference&&t.weakEventListenerCount++;var e=Kd.getObjectProperty(this.listener,"$$nf_boundTo");A.is(e,Rr)&&(t.displayObjectEventListenerCount++,A.as(e,Rr).stage||t.unstagedDisplayObjectEventListenerCount++)}}]),t}(),bf={},wf=0;r.registerClass(Mf,"flash.events.EventDispatcherListener");var xf=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"none";return y(this,e),(i=l(this,h(e).call(this,t,n,r))).direction=null,i.isRelatedObjectInaccessible=!1,i.keyCode=0,i.relatedObject=null,i.shiftKey=!1,i.relatedObject=o,i.shiftKey=s,i.keyCode=a,i.direction=u,i}return c(e,ct),p(e,null,[{key:"FOCUS_IN",get:function(){return"focusIn"}},{key:"FOCUS_OUT",get:function(){return"focusOut"}},{key:"KEY_FOCUS_CHANGE",get:function(){return"keyFocusChange"}},{key:"MOUSE_FOCUS_CHANGE",get:function(){return"mouseFocusChange"}}]),e}();r.registerClass(xf,"flash.events.FocusEvent");var Cf=function(t){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];return y(this,e),l(this,h(e).call(this))}return c(e,Tf),p(e,null,[{key:"IO_ERROR",get:function(){return"ioError"}},{key:"STANDARD_ERROR_IO_ERROR",get:function(){return"standardErrorIoError"}},{key:"STANDARD_INPUT_IO_ERROR",get:function(){return"standardInputIoError"}},{key:"STANDARD_OUTPUT_IO_ERROR",get:function(){return"standardOutputIoError"}}]),e}();r.registerClass(Cf,"flash.events.IOErrorEvent");var Nf=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,ct),p(e,null,[{key:"TIMER",get:function(){return"timer"}},{key:"TIMER_COMPLETE",get:function(){return"timerComplete"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.bubbles,this.cancelable)}}]),e}();r.registerClass(Nf,"flash.events.TimerEvent");var Af=function(){function t(){y(this,t)}return p(t,null,[{key:"call",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return X.flash_external_ExternalInterface_call(t,i)}}]),t}();r.registerClass(Af,"flash.external.ExternalInterface");var If=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this.x=NaN,this.y=NaN,this.x=e,this.y=i}return p(t,null,[{key:"ORIGIN",get:function(){return Pf}}]),p(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"normalize",value:function(t){var e=this.length;0===e?(this.x=0,this.y=0):(this.x=this.x/e*t,this.y=this.y/e*t)}},{key:"length",get:function(){return t.distance(t.ORIGIN,this)}}],[{key:"distance",value:function(t,e){var i=e.x-t.x,n=e.y-t.y;return 0===i?n>=0?n:-n:0===n?i>=0?i:-i:Math.sqrt(i*i+n*n)}},{key:"interpolate",value:function(e,i,n){return new t(e.x+n*(i.x-e.x),e.y+n*(i.y-e.y))}}]),t}(),Pf=new If(0,0);r.registerClass(If,"flash.geom.Point");var Of=function(){function t(e){y(this,t),this._object=null,this._colorTransform=null,this._object=e}return p(t,[{key:"removeUnusedStrokes",value:function(t){for(var e=A.unknownToType(t.childNodes,Array),i=0;i<e.length;i++){var n=e[i],r=A.unknownToString(n.getAttribute?n.getAttribute("stroke"):null);if(r){var o=df.extractAlphaFromRGBA(r);"none"==r||X.isNaN(o)||0===o||n.removeAttribute("stroke")}this.removeUnusedStrokes(n)}}},{key:"colorTransform",get:function(){return this._colorTransform},set:function(t){if(this._colorTransform=t,this._object._svg)if(0===t.redOffset&&0===t.greenOffset&&0===t.blueOffset)this._object._svg.style.removeProperty("fill"),this._object._svg.style.removeProperty("stroke");else{var e=df.colorToRGBA(A.intToUint(((255&t.redOffset)<<16)+((255&t.greenOffset)<<8)+(255&t.blueOffset)),1);this._object._svg.style.fill=e,this._object._svg.style.stroke=e,this.removeUnusedStrokes(this._object._svg)}}}]),t}();r.registerClass(Of,"flash.geom.Transform");var Qf=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).client=null,t.data=null,t.fps=NaN,t.objectEncoding=0,t.size=0,t}return c(e,At),p(e,null,[{key:"defaultObjectEncoding",get:function(){return Rf},set:function(t){Rf=t}}]),p(e,null,[{key:"getLocal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return D.flash_net_SharedObject_getLocal(t,e,i)}}]),e}(),Rf=0;r.registerClass(Qf,"flash.net.SharedObject");var Df=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).bytesLoaded=0,t.bytesTotal=0,t.data=null,t.dataFormat="text",t}return c(e,At),e}();r.registerClass(Df,"flash.net.URLLoader");var Ff=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this.authenticate=!1,this.cacheResponse=!1,this.contentType=null,this.data=null,this.digest=null,this.followRedirects=!1,this.idleTimeout=NaN,this.manageCookies=!1,this.method=null,this.requestHeaders=null,this.url=null,this.useCache=!1,this.userAgent=null,this.url=e};r.registerClass(Ff,"flash.net.URLRequest");r.registerClass(function t(){y(this,t)},"flash.net.URLVariables");var Uf=function(){function t(){y(this,t)}return p(t,null,[{key:"avHardwareDisable",get:function(){return Vf},set:function(t){Vf=t}},{key:"cpuArchitecture",get:function(){return Bf},set:function(t){Bf=t}},{key:"hasAccessibility",get:function(){return Hf},set:function(t){Hf=t}},{key:"hasAudio",get:function(){return $f},set:function(t){$f=t}},{key:"hasAudioEncoder",get:function(){return Gf},set:function(t){Gf=t}},{key:"hasEmbeddedVideo",get:function(){return Yf},set:function(t){Yf=t}},{key:"hasIME",get:function(){return zf},set:function(t){zf=t}},{key:"hasMP3",get:function(){return Wf},set:function(t){Wf=t}},{key:"hasPrinting",get:function(){return Xf},set:function(t){Xf=t}},{key:"hasScreenBroadcast",get:function(){return Kf},set:function(t){Kf=t}},{key:"hasScreenPlayback",get:function(){return jf},set:function(t){jf=t}},{key:"hasStreamingAudio",get:function(){return qf},set:function(t){qf=t}},{key:"hasStreamingVideo",get:function(){return Jf},set:function(t){Jf=t}},{key:"hasTLS",get:function(){return Zf},set:function(t){Zf=t}},{key:"hasVideoEncoder",get:function(){return ty},set:function(t){ty=t}},{key:"isDebugger",get:function(){return ey},set:function(t){ey=t}},{key:"isEmbeddedInAcrobat",get:function(){return iy},set:function(t){iy=t}},{key:"language",get:function(){return ny},set:function(t){ny=t}},{key:"languages",get:function(){return ry},set:function(t){ry=t}},{key:"localFileReadDisable",get:function(){return oy},set:function(t){oy=t}},{key:"manufacturer",get:function(){return sy},set:function(t){sy=t}},{key:"maxLevelIDC",get:function(){return ay},set:function(t){ay=t}},{key:"os",get:function(){return ly},set:function(t){ly=t}},{key:"pixelAspectRatio",get:function(){return uy},set:function(t){uy=t}},{key:"playerType",get:function(){return hy},set:function(t){hy=t}},{key:"screenColor",get:function(){return cy},set:function(t){cy=t}},{key:"screenDPI",get:function(){return dy},set:function(t){dy=t}},{key:"screenResolutionX",get:function(){return fy},set:function(t){fy=t}},{key:"screenResolutionY",get:function(){return yy},set:function(t){yy=t}},{key:"serverString",get:function(){return gy},set:function(t){gy=t}},{key:"supports32BitProcesses",get:function(){return py},set:function(t){py=t}},{key:"supports64BitProcesses",get:function(){return my},set:function(t){my=t}},{key:"touchscreenType",get:function(){return t.getTouchscreenType()}}]),p(t,null,[{key:"getTouchscreenType",value:function(){return D.flash_system_Capabilities_getTouchscreenType()}}]),t}(),Vf=!1,Bf=null,Hf=!1,$f=!1,Gf=!1,Yf=!1,zf=!1,Wf=!1,Xf=!1,Kf=!1,jf=!1,qf=!1,Jf=!1,Zf=!1,ty=!1,ey=!1,iy=!1,ny=null,ry=null,oy=!1,sy=null,ay=null,ly=null,uy=NaN,hy=null,cy=null,dy=NaN,fy=NaN,yy=NaN,gy=null,py=!1,my=!1;r.registerClass(Uf,"flash.system.Capabilities");var vy=function(){function t(){y(this,t)}return p(t,null,[{key:"ADVANCED",get:function(){return"advanced"}},{key:"NORMAL",get:function(){return"normal"}}]),t}();r.registerClass(vy,"flash.text.AntiAliasType");var _y=function(){function t(){y(this,t)}return p(t,null,[{key:"NONE",get:function(){return"none"}},{key:"PIXEL",get:function(){return"pixel"}},{key:"SUBPIXEL",get:function(){return"subpixel"}}]),t}();r.registerClass(_y,"flash.text.GridFitType");var Sy=function t(e,i,n){y(this,t),this.element=null,this.width=NaN,this.x=NaN,this.element=e,this.width=i,this.x=n};r.registerClass(Sy,"flash.text.TextElement");var Ly=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;y(this,t),this.align=null,this.blockIndent=null,this.bold=null,this.bullet=null,this.color=0,this.font=null,this.indent=null,this.italic=null,this.kerning=null,this.leading=null,this.leftMargin=null,this.letterSpacing=null,this.rightMargin=null,this.size=NaN,this.tabStops=null,this.target=null,this.underline=null,this.url=null,this.font=e,this.size=i,this.color=null!=n?n:0,this.bold=r,this.italic=o,this.underline=s,this.url=a,this.target=l,this.align=u,this.leftMargin=h,this.rightMargin=c,this.indent=d,this.leading=f};r.registerClass(Ly,"flash.text.TextFormat");var ky={},Ty=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this)))._inputElement=null,t._inputAnchor=null,t._focusTime=NaN,t._antiAliasType=vy.NORMAL,t._embedFonts=!1,t._defaultTextFormat=e.DEFAULT_TEXT_FORMAT,t._textColor=0,t._autoSize=My.NONE,t._backgroundColor=16777215,t._background=!1,t._multiline=!1,t._wordWrap=!1,t._text="",t._selectable=!0,t._type=by.DYNAMIC,t._gridFitType=_y.PIXEL,t._sharpness=NaN,t._textHeight=0,t._textWidth=0,t._fieldWidth=0,t._lineMetrics=null,t._positionRequested=!1,t}return c(e,Fr),p(e,null,[{key:"DEFAULT_TEXT_FORMAT",get:function(){return Ey}},{key:"METRICS_POINT_SIZE",get:function(){return 100}},{key:"GUTTER",get:function(){return 2}}]),p(e,[{key:"measureText",value:function(t){var i;return i=this._defaultTextFormat.bold?"bold ":this._defaultTextFormat.italic?"italic ":"normal ",i+=e.METRICS_POINT_SIZE.toString(),i+="px ",i+=this._defaultTextFormat.font,this.textMeasurement.canvasTextWidth(t,i)*this._defaultTextFormat.size/e.METRICS_POINT_SIZE}},{key:"letterMapKey",value:function(t){for(var e=this.defaultTextFormat,i=["font","bold","italic","underline","size"],n=t,r=0;r<i.length;r++){var o=i[r];e.hasOwnProperty(o)?n=n+"-"+e[o].toString():n+="-null"}return n}},{key:"calculateWordWidth",value:function(t){var i=0,n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=this.letterMapKey(l);if(!ky[u]){var h=new e;if(this.defaultTextFormat&&(h.defaultTextFormat=this.defaultTextFormat)," "==l){h.text="V V";var c=h.width;h.text="VV";var d=h.width;ky[u]=c-d}else h.text=l,ky[u]=h.width}i+=ky[u]}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}},{key:"updateText",value:function(){for(;this._svg.childNodes.length>0;)this._svg.removeChild(this._svg.childNodes[0]);var t=this._text.split(/\n/),i=e.GUTTER,n=[];for(this._textHeight=this._textWidth=0;t.length>0;){for(var r=A.unknownToString(t.shift()),o=this.svgContext.createElement("text"),s=0;r.length>0&&" "==r.charAt(0);)s+=this.measureText(" "),r=r.substring(1);var a=e.GUTTER;i+=this._defaultTextFormat.size,s>0&&(a+=s,o.setAttribute("data-leading-space-width",s)),o.setAttribute("x",a),o.setAttribute("y",i);var l=this.svgContext.document.createTextNode(r);if(o.appendChild(l),this._svg.appendChild(o),this._wordWrap&&this._fieldWidth>0){for(var u=0,h=0,c="",d=r.indexOf(" ");d>-1;){var f=r.substring(h,d+1),y=this.calculateWordWidth(f);if(!(0===h||(u+=y)<this._fieldWidth)){c=r.substring(h),r=r.substring(0,h),l.textContent=r;break}h+=f.length,d=r.indexOf(" ",h)}c&&t.unshift(c)}var g=s+this.measureText(r);this._textWidth=Math.max(this._textWidth,g),this._textHeight+=this._defaultTextFormat.size,n.push(new Sy(o,g,a))}if(this._lineMetrics=null,this._autoSize==My.CENTER||this._autoSize==My.RIGHT)for(var p=0;p<n.length;p++)this._autoSize==My.CENTER?n[p].element.setAttribute("x",n[p].x+(this._textWidth-n[p].width)/2):this._autoSize==My.RIGHT&&n[p].element.setAttribute("x",n[p].x+(this._textWidth-n[p].width))}},{key:"getLineMetrics",value:function(t){if(0===t&&null!=this._lineMetrics)return this._lineMetrics;var e=new xy(2,this.textWidth,this.textHeight,this._defaultTextFormat.size,0,0);return 0===t&&(this._lineMetrics=e),e}},{key:"setSelection",value:function(t,e){this._inputElement&&this._inputElement.setSelectionRange(t,e)}},{key:"setupFocusElement",value:function(t){this.dispatchEvent(new xf(xf.FOCUS_IN)),this._svg.setAttribute("visibility","hidden"),this._inputElement=t;var e=X.jQuery(t),i=Math.round(this._defaultTextFormat.size*this.screenScale);return e.css("font-family",this._defaultTextFormat.font),e.css("font-style",this._defaultTextFormat.italic?"italic":"normal"),e.css("font-size",i),e.css("line-height",i+"px"),e.val(this.text),e.css("position","absolute"),e.css("border","0px"),e.bind("keydown",xt.bindMethod(this,this.inputKeyDown)),e.bind("keyup",xt.bindMethod(this,this.inputKeyUp)),e.bind("keypress",xt.bindMethod(this,this.inputKeyPress)),e.bind("blur",xt.bindMethod(this,this.inputBlur)),e.css("white-space",this._wordWrap?"normal":"pre"),this._autoSize==My.CENTER?(this._inputAnchor=new If(this.width/2,0),e.css("text-align","center")):this._autoSize==My.RIGHT?(this._inputAnchor=new If(this.width,0),e.css("text-align","right")):(this._inputAnchor=new If(0,0),e.css("text-align","left")),this.positionInput(),e.show(),this._focusTime=X.flash_utils_getTimer(),this._inputElement}},{key:"teardownFocusElement",value:function(){this.text=A.unknownToString(X.jQuery(this._inputElement).val()),this._svg.setAttribute("visibility","visible");var t=X.jQuery(this._inputElement);t.unbind("keydown"),t.unbind("keypress"),t.unbind("blur"),t.hide(),this.dispatchEvent(new xf(xf.FOCUS_OUT)),this._inputElement=null}},{key:"positionInput",value:function(){if(null!=this._inputElement){var t=X.jQuery(this._inputElement);this.text=A.unknownToString(t.val());var i=this.textWidth+1.25*this._defaultTextFormat.size,n=new If(this._inputAnchor.x+e.GUTTER,this._inputAnchor.y+e.GUTTER);this._autoSize==My.CENTER?n.x-=i/2:this._autoSize==My.RIGHT&&(n.x-=i),n=this.localToGlobal(n),n=this.stage.controller.scoreDocumentView.globalToLocal(n),t.css("left",n.x+"px"),t.css("top",n.y+"px"),t.css("width",i*this.screenScale+"px"),t.css("height",this.textHeight*this.screenScale+"px")}}},{key:"inputKeyDown",value:function(t){var e=this;this._positionRequested||(this._positionRequested=!0,X.JS_window().setTimeout(function(){e._positionRequested=!1,e.positionInput()},10)),this.dispatchKeyboardEvent(t,ui.KEY_DOWN)}},{key:"inputKeyUp",value:function(t){this.dispatchKeyboardEvent(t,ui.KEY_UP)}},{key:"inputKeyPress",value:function(t){this.dispatchKeyboardEvent(t,ui.KEY_DOWN),!this.multiline&&13==t.keyCode&&this.stage&&(this.stage.focus=null)}},{key:"inputBlur",value:function(t){X.flash_utils_getTimer()-this._focusTime>100?this.stage.focus=null:null!=this._inputElement&&this._inputElement.focus()}},{key:"dispatchKeyboardEvent",value:function(t,e){var i=new ui(e,!0,!1,A.unknownToUint(t.charCode),A.unknownToUint(t.keyCode),0,A.unknownToBoolean(t.ctrlKey),A.unknownToBoolean(t.altKey),A.unknownToBoolean(t.shiftKey),A.unknownToBoolean(t.ctrlKey),A.unknownToBoolean(t.ctrlKey));this.dispatchEvent(i),i.isDefaultPrevented()&&t.preventDefault()}},{key:"antiAliasType",get:function(){return this._antiAliasType},set:function(t){this._antiAliasType=t}},{key:"embedFonts",get:function(){return this._embedFonts},set:function(t){this._embedFonts=t}},{key:"defaultTextFormat",get:function(){return this._defaultTextFormat},set:function(t){this._defaultTextFormat=t,this._svg&&(this._svg.setAttribute("font-family",t.font),this._svg.setAttribute("font-size",t.size),this._svg.setAttribute("font-style",t.italic?"italic":"normal"),this._svg.setAttribute("font-weight",t.bold?"bold":"normal"),this._svg.setAttribute("text-decoration",t.underline?"underline":"none"),t.color&&this._svg.setAttribute("fill",df.colorToRGBA(A.intToUint(t.color),1)),this._svg.setAttribute("stroke","none")),this.updateText()}},{key:"textColor",get:function(){return this._textColor},set:function(t){this._textColor=t,this._svg&&this._svg.setAttribute("fill",df.colorToRGBA(t,1))}},{key:"autoSize",get:function(){return this._autoSize},set:function(t){this._autoSize=t}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t}},{key:"background",get:function(){return this._background},set:function(t){this._background=t}},{key:"multiline",get:function(){return this._multiline},set:function(t){this._multiline!=t&&(this._multiline=t,this.updateText())}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!=t&&(this._wordWrap=t,this.updateText())}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this.updateText()}},{key:"htmlText",get:function(){return this.text},set:function(t){this.text=t}},{key:"selectable",get:function(){return this._selectable},set:function(t){this._selectable=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t}},{key:"gridFitType",get:function(){return this._gridFitType},set:function(t){this._gridFitType=t}},{key:"sharpness",get:function(){return this._sharpness},set:function(t){this._sharpness=t}},{key:"textHeight",get:function(){return this._textHeight}},{key:"textWidth",get:function(){return this._textWidth}},{key:"width",get:function(){return this.textMeasurement.textWidth(this._svg)},set:function(t){this._fieldWidth!=t&&(this._fieldWidth=t,this._wordWrap&&this.updateText())}},{key:"height",get:function(){return this.textMeasurement.textHeight(this._svg)},set:function(t){}},{key:"screenScale",get:function(){return A.unknownToNumber(this._svg.getCTM().a)}}]),e}(),Ey=new Ly("",12,0);r.registerClass(Ty,"flash.text.TextField");var My=function(){function t(){y(this,t)}return p(t,null,[{key:"CENTER",get:function(){return"center"}},{key:"LEFT",get:function(){return"left"}},{key:"NONE",get:function(){return"none"}},{key:"RIGHT",get:function(){return"right"}}]),t}();r.registerClass(My,"flash.text.TextFieldAutoSize");var by=function(){function t(){y(this,t)}return p(t,null,[{key:"DYNAMIC",get:function(){return"dynamic"}},{key:"INPUT",get:function(){return"input"}}]),t}();r.registerClass(by,"flash.text.TextFieldType");var wy=function(){function t(){y(this,t)}return p(t,null,[{key:"CENTER",get:function(){return"center"}},{key:"END",get:function(){return"end"}},{key:"JUSTIFY",get:function(){return"justify"}},{key:"LEFT",get:function(){return"left"}},{key:"RIGHT",get:function(){return"right"}},{key:"START",get:function(){return"start"}}]),t}();r.registerClass(wy,"flash.text.TextFormatAlign");var xy=function t(e,i,n,r,o,s){y(this,t),this.ascent=NaN,this.descent=NaN,this.height=NaN,this.leading=NaN,this.width=NaN,this.x=NaN,this.x=e,this.width=i,this.height=n,this.ascent=r,this.descent=o,this.leading=s};r.registerClass(xy,"flash.text.TextLineMetrics");var Cy=function(){function t(){y(this,t)}return p(t,null,[{key:"capsLock",get:function(){return Ny},set:function(t){Ny=t}},{key:"hasVirtualKeyboard",get:function(){return Ay},set:function(t){Ay=t}},{key:"numLock",get:function(){return Iy},set:function(t){Iy=t}},{key:"physicalKeyboardType",get:function(){return Py},set:function(t){Py=t}},{key:"A",get:function(){return 65}},{key:"ALTERNATE",get:function(){return 18}},{key:"AUDIO",get:function(){return 16777239}},{key:"B",get:function(){return 66}},{key:"BACK",get:function(){return 16777238}},{key:"BACKQUOTE",get:function(){return 192}},{key:"BACKSLASH",get:function(){return 220}},{key:"BACKSPACE",get:function(){return 8}},{key:"BLUE",get:function(){return 16777219}},{key:"C",get:function(){return 67}},{key:"CAPS_LOCK",get:function(){return 20}},{key:"CHANNEL_DOWN",get:function(){return 16777221}},{key:"CHANNEL_UP",get:function(){return 16777220}},{key:"CharCodeStrings",get:function(){return Oy}},{key:"COMMA",get:function(){return 188}},{key:"COMMAND",get:function(){return 15}},{key:"CONTROL",get:function(){return 17}},{key:"D",get:function(){return 68}},{key:"DELETE",get:function(){return 46}},{key:"DOWN",get:function(){return 40}},{key:"DVR",get:function(){return 16777241}},{key:"E",get:function(){return 69}},{key:"END",get:function(){return 35}},{key:"ENTER",get:function(){return 13}},{key:"EQUAL",get:function(){return 187}},{key:"ESCAPE",get:function(){return 27}},{key:"EXIT",get:function(){return 16777237}},{key:"F",get:function(){return 70}},{key:"F1",get:function(){return 112}},{key:"F10",get:function(){return 121}},{key:"F11",get:function(){return 122}},{key:"F12",get:function(){return 123}},{key:"F13",get:function(){return 124}},{key:"F14",get:function(){return 125}},{key:"F15",get:function(){return 126}},{key:"F2",get:function(){return 113}},{key:"F3",get:function(){return 114}},{key:"F4",get:function(){return 115}},{key:"F5",get:function(){return 116}},{key:"F6",get:function(){return 117}},{key:"F7",get:function(){return 118}},{key:"F8",get:function(){return 119}},{key:"F9",get:function(){return 120}},{key:"FAST_FORWARD",get:function(){return 16777226}},{key:"G",get:function(){return 71}},{key:"GREEN",get:function(){return 16777217}},{key:"GUIDE",get:function(){return 16777236}},{key:"H",get:function(){return 72}},{key:"HELP",get:function(){return 16777245}},{key:"HOME",get:function(){return 36}},{key:"I",get:function(){return 73}},{key:"INFO",get:function(){return 16777235}},{key:"INPUT",get:function(){return 16777243}},{key:"INSERT",get:function(){return 45}},{key:"J",get:function(){return 74}},{key:"K",get:function(){return 75}},{key:"KEYNAME_BEGIN",get:function(){return"Begin"}},{key:"KEYNAME_BREAK",get:function(){return"Break"}},{key:"KEYNAME_CLEARDISPLAY",get:function(){return"ClrDsp"}},{key:"KEYNAME_CLEARLINE",get:function(){return"ClrLn"}},{key:"KEYNAME_DELETE",get:function(){return"Delete"}},{key:"KEYNAME_DELETECHAR",get:function(){return"DelChr"}},{key:"KEYNAME_DELETELINE",get:function(){return"DelLn"}},{key:"KEYNAME_DOWNARROW",get:function(){return"Down"}},{key:"KEYNAME_END",get:function(){return"End"}},{key:"KEYNAME_EXECUTE",get:function(){return"Exec"}},{key:"KEYNAME_F1",get:function(){return"F1"}},{key:"KEYNAME_F10",get:function(){return"F10"}},{key:"KEYNAME_F11",get:function(){return"F11"}},{key:"KEYNAME_F12",get:function(){return"F12"}},{key:"KEYNAME_F13",get:function(){return"F13"}},{key:"KEYNAME_F14",get:function(){return"F14"}},{key:"KEYNAME_F15",get:function(){return"F15"}},{key:"KEYNAME_F16",get:function(){return"F16"}},{key:"KEYNAME_F17",get:function(){return"F17"}},{key:"KEYNAME_F18",get:function(){return"F18"}},{key:"KEYNAME_F19",get:function(){return"F19"}},{key:"KEYNAME_F2",get:function(){return"F2"}},{key:"KEYNAME_F20",get:function(){return"F20"}},{key:"KEYNAME_F21",get:function(){return"F21"}},{key:"KEYNAME_F22",get:function(){return"F22"}},{key:"KEYNAME_F23",get:function(){return"F23"}},{key:"KEYNAME_F24",get:function(){return"F24"}},{key:"KEYNAME_F25",get:function(){return"F25"}},{key:"KEYNAME_F26",get:function(){return"F26"}},{key:"KEYNAME_F27",get:function(){return"F27"}},{key:"KEYNAME_F28",get:function(){return"F28"}},{key:"KEYNAME_F29",get:function(){return"F29"}},{key:"KEYNAME_F3",get:function(){return"F3"}},{key:"KEYNAME_F30",get:function(){return"F30"}},{key:"KEYNAME_F31",get:function(){return"F31"}},{key:"KEYNAME_F32",get:function(){return"F32"}},{key:"KEYNAME_F33",get:function(){return"F33"}},{key:"KEYNAME_F34",get:function(){return"F34"}},{key:"KEYNAME_F35",get:function(){return"F35"}},{key:"KEYNAME_F4",get:function(){return"F4"}},{key:"KEYNAME_F5",get:function(){return"F5"}},{key:"KEYNAME_F6",get:function(){return"F6"}},{key:"KEYNAME_F7",get:function(){return"F7"}},{key:"KEYNAME_F8",get:function(){return"F8"}},{key:"KEYNAME_F9",get:function(){return"F9"}},{key:"KEYNAME_FIND",get:function(){return"Find"}},{key:"KEYNAME_HELP",get:function(){return"Help"}},{key:"KEYNAME_HOME",get:function(){return"Home"}},{key:"KEYNAME_INSERT",get:function(){return"Insert"}},{key:"KEYNAME_INSERTCHAR",get:function(){return"InsChr"}},{key:"KEYNAME_INSERTLINE",get:function(){return"InsLn"}},{key:"KEYNAME_LEFTARROW",get:function(){return"Left"}},{key:"KEYNAME_MENU",get:function(){return"Menu"}},{key:"KEYNAME_MODESWITCH",get:function(){return"ModeSw"}},{key:"KEYNAME_NEXT",get:function(){return"Next"}},{key:"KEYNAME_PAGEDOWN",get:function(){return"PgDn"}},{key:"KEYNAME_PAGEUP",get:function(){return"PgUp"}},{key:"KEYNAME_PAUSE",get:function(){return"Pause"}},{key:"KEYNAME_PREV",get:function(){return"Prev"}},{key:"KEYNAME_PRINT",get:function(){return"Print"}},{key:"KEYNAME_PRINTSCREEN",get:function(){return"PrntScrn"}},{key:"KEYNAME_REDO",get:function(){return"Redo"}},{key:"KEYNAME_RESET",get:function(){return"Reset"}},{key:"KEYNAME_RIGHTARROW",get:function(){return"Right"}},{key:"KEYNAME_SCROLLLOCK",get:function(){return"ScrlLck"}},{key:"KEYNAME_SELECT",get:function(){return"Select"}},{key:"KEYNAME_STOP",get:function(){return"Stop"}},{key:"KEYNAME_SYSREQ",get:function(){return"SysReq"}},{key:"KEYNAME_SYSTEM",get:function(){return"Sys"}},{key:"KEYNAME_UNDO",get:function(){return"Undo"}},{key:"KEYNAME_UPARROW",get:function(){return"Up"}},{key:"KEYNAME_USER",get:function(){return"User"}},{key:"L",get:function(){return 76}},{key:"LAST",get:function(){return 16777233}},{key:"LEFT",get:function(){return 37}},{key:"LEFTBRACKET",get:function(){return 219}},{key:"LIVE",get:function(){return 16777232}},{key:"M",get:function(){return 77}},{key:"MASTER_SHELL",get:function(){return 16777246}},{key:"MENU",get:function(){return 16777234}},{key:"MINUS",get:function(){return 189}},{key:"N",get:function(){return 78}},{key:"NEXT",get:function(){return 16777230}},{key:"NUMBER_0",get:function(){return 48}},{key:"NUMBER_1",get:function(){return 49}},{key:"NUMBER_2",get:function(){return 50}},{key:"NUMBER_3",get:function(){return 51}},{key:"NUMBER_4",get:function(){return 52}},{key:"NUMBER_5",get:function(){return 53}},{key:"NUMBER_6",get:function(){return 54}},{key:"NUMBER_7",get:function(){return 55}},{key:"NUMBER_8",get:function(){return 56}},{key:"NUMBER_9",get:function(){return 57}},{key:"NUMPAD",get:function(){return 21}},{key:"NUMPAD_0",get:function(){return 96}},{key:"NUMPAD_1",get:function(){return 97}},{key:"NUMPAD_2",get:function(){return 98}},{key:"NUMPAD_3",get:function(){return 99}},{key:"NUMPAD_4",get:function(){return 100}},{key:"NUMPAD_5",get:function(){return 101}},{key:"NUMPAD_6",get:function(){return 102}},{key:"NUMPAD_7",get:function(){return 103}},{key:"NUMPAD_8",get:function(){return 104}},{key:"NUMPAD_9",get:function(){return 105}},{key:"NUMPAD_ADD",get:function(){return 107}},{key:"NUMPAD_DECIMAL",get:function(){return 110}},{key:"NUMPAD_DIVIDE",get:function(){return 111}},{key:"NUMPAD_ENTER",get:function(){return 108}},{key:"NUMPAD_MULTIPLY",get:function(){return 106}},{key:"NUMPAD_SUBTRACT",get:function(){return 109}},{key:"O",get:function(){return 79}},{key:"P",get:function(){return 80}},{key:"PAGE_DOWN",get:function(){return 34}},{key:"PAGE_UP",get:function(){return 33}},{key:"PAUSE",get:function(){return 16777224}},{key:"PERIOD",get:function(){return 190}},{key:"PLAY",get:function(){return 16777223}},{key:"PREVIOUS",get:function(){return 16777231}},{key:"Q",get:function(){return 81}},{key:"QUOTE",get:function(){return 222}},{key:"R",get:function(){return 82}},{key:"RECORD",get:function(){return 16777222}},{key:"RED",get:function(){return 16777216}},{key:"REWIND",get:function(){return 16777227}},{key:"RIGHT",get:function(){return 39}},{key:"RIGHTBRACKET",get:function(){return 221}},{key:"S",get:function(){return 83}},{key:"SEARCH",get:function(){return 16777247}},{key:"SEMICOLON",get:function(){return 186}},{key:"SETUP",get:function(){return 16777244}},{key:"SHIFT",get:function(){return 16}},{key:"SKIP_BACKWARD",get:function(){return 16777229}},{key:"SKIP_FORWARD",get:function(){return 16777228}},{key:"SLASH",get:function(){return 191}},{key:"SPACE",get:function(){return 32}},{key:"STOP",get:function(){return 16777225}},{key:"STRING_BEGIN",get:function(){return"   "}},{key:"STRING_BREAK",get:function(){return"   "}},{key:"STRING_CLEARDISPLAY",get:function(){return"   "}},{key:"STRING_CLEARLINE",get:function(){return"   "}},{key:"STRING_DELETE",get:function(){return"   "}},{key:"STRING_DELETECHAR",get:function(){return"   "}},{key:"STRING_DELETELINE",get:function(){return"   "}},{key:"STRING_DOWNARROW",get:function(){return"   "}},{key:"STRING_END",get:function(){return"   "}},{key:"STRING_EXECUTE",get:function(){return"   "}},{key:"STRING_F1",get:function(){return"   "}},{key:"STRING_F10",get:function(){return"   "}},{key:"STRING_F11",get:function(){return"   "}},{key:"STRING_F12",get:function(){return"   "}},{key:"STRING_F13",get:function(){return"   "}},{key:"STRING_F14",get:function(){return"   "}},{key:"STRING_F15",get:function(){return"   "}},{key:"STRING_F16",get:function(){return"   "}},{key:"STRING_F17",get:function(){return"   "}},{key:"STRING_F18",get:function(){return"   "}},{key:"STRING_F19",get:function(){return"   "}},{key:"STRING_F2",get:function(){return"   "}},{key:"STRING_F20",get:function(){return"   "}},{key:"STRING_F21",get:function(){return"   "}},{key:"STRING_F22",get:function(){return"   "}},{key:"STRING_F23",get:function(){return"   "}},{key:"STRING_F24",get:function(){return"   "}},{key:"STRING_F25",get:function(){return"   "}},{key:"STRING_F26",get:function(){return"   "}},{key:"STRING_F27",get:function(){return"   "}},{key:"STRING_F28",get:function(){return"   "}},{key:"STRING_F29",get:function(){return"   "}},{key:"STRING_F3",get:function(){return"   "}},{key:"STRING_F30",get:function(){return"   "}},{key:"STRING_F31",get:function(){return"   "}},{key:"STRING_F32",get:function(){return"   "}},{key:"STRING_F33",get:function(){return"   "}},{key:"STRING_F34",get:function(){return"   "}},{key:"STRING_F35",get:function(){return"   "}},{key:"STRING_F4",get:function(){return"   "}},{key:"STRING_F5",get:function(){return"   "}},{key:"STRING_F6",get:function(){return"   "}},{key:"STRING_F7",get:function(){return"   "}},{key:"STRING_F8",get:function(){return"   "}},{key:"STRING_F9",get:function(){return"   "}},{key:"STRING_FIND",get:function(){return"   "}},{key:"STRING_HELP",get:function(){return"   "}},{key:"STRING_HOME",get:function(){return"   "}},{key:"STRING_INSERT",get:function(){return"   "}},{key:"STRING_INSERTCHAR",get:function(){return"   "}},{key:"STRING_INSERTLINE",get:function(){return"   "}},{key:"STRING_LEFTARROW",get:function(){return"   "}},{key:"STRING_MENU",get:function(){return"   "}},{key:"STRING_MODESWITCH",get:function(){return"   "}},{key:"STRING_NEXT",get:function(){return"   "}},{key:"STRING_PAGEDOWN",get:function(){return"   "}},{key:"STRING_PAGEUP",get:function(){return"   "}},{key:"STRING_PAUSE",get:function(){return"   "}},{key:"STRING_PREV",get:function(){return"   "}},{key:"STRING_PRINT",get:function(){return"   "}},{key:"STRING_PRINTSCREEN",get:function(){return"   "}},{key:"STRING_REDO",get:function(){return"   "}},{key:"STRING_RESET",get:function(){return"   "}},{key:"STRING_RIGHTARROW",get:function(){return"   "}},{key:"STRING_SCROLLLOCK",get:function(){return"   "}},{key:"STRING_SELECT",get:function(){return"   "}},{key:"STRING_STOP",get:function(){return"   "}},{key:"STRING_SYSREQ",get:function(){return"   "}},{key:"STRING_SYSTEM",get:function(){return"   "}},{key:"STRING_UNDO",get:function(){return"   "}},{key:"STRING_UPARROW",get:function(){return"   "}},{key:"STRING_USER",get:function(){return"   "}},{key:"SUBTITLE",get:function(){return 16777240}},{key:"T",get:function(){return 84}},{key:"TAB",get:function(){return 9}},{key:"U",get:function(){return 85}},{key:"UP",get:function(){return 38}},{key:"V",get:function(){return 86}},{key:"VOD",get:function(){return 16777242}},{key:"W",get:function(){return 87}},{key:"X",get:function(){return 88}},{key:"Y",get:function(){return 89}},{key:"YELLOW",get:function(){return 16777218}},{key:"Z",get:function(){return 90}}]),t}(),Ny=!1,Ay=!1,Iy=!1,Py=null,Oy=null;r.registerClass(Cy,"flash.ui.Keyboard");var Qy=function t(){y(this,t)};r.registerClass(Qy,"flash.utils.IDataInput");var Ry=function t(){y(this,t)};r.registerClass(Ry,"flash.utils.IDataOutput");var Dy=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y(this,t),this._endian=Vy.BIG_ENDIAN,this._bigEndian=!0,this._length=0,this._position=0,this.objectEncoding=0,this._buffer=null,this._u8view=null,e?(this._u8view=e,this._buffer=e.buffer,this._length=A.unknownToUint(this._u8view.length),this._position=0):(this._buffer=t.createTypedBuffer(1),this._u8view=t.createUint8Array(this._buffer))}return p(t,null,[{key:"defaultObjectEncoding",get:function(){return Fy},set:function(t){Fy=t}}]),p(t,[{key:"ensureLength",value:function(e){for(var i=A.unknownToUint(this._buffer.byteLength);i<e;)i*=2;if(i>this._buffer.byteLength){var n=t.createTypedBuffer(i);t.copyBuffer(this._buffer,0,n,0,this._length),this._buffer=n,this._u8view=t.createUint8Array(this._buffer)}}},{key:"writeU8Byte",value:function(t){this.ensureLength(A.intToUint(this._position+1)),this._u8view[this.position]=t,this._position+=1,this._position>=this._length&&(this._length=this._position)}},{key:"getUnsignedByte",value:function(t){return A.unknownToUint(t>=0&&t<this.length?this._u8view[t]:0)}},{key:"readUnsignedByte",value:function(){var t=A.unknownToUint(this._u8view[this._position]);return this._position<this._length-1&&this._position++,t}},{key:"writeByte",value:function(t){this.writeU8Byte(A.intToUint(t))}},{key:"readByte",value:function(){var t=this.readUnsignedByte();return t>127&&(t-=256),t}},{key:"writeShort",value:function(t){this._bigEndian?(this.writeByte(t>>8&255),this.writeByte(255&t)):(this.writeByte(255&t),this.writeByte(t>>8&255))}},{key:"readUnsignedShort",value:function(){var t=0;return this._bigEndian?(t|=this.readUnsignedByte()<<8,t|=this.readUnsignedByte()):(t|=this.readUnsignedByte(),t|=this.readUnsignedByte()<<8),t}},{key:"readShort",value:function(){var t=this.readUnsignedShort();return t>32767&&(t-=65536),t}},{key:"writeInt",value:function(t){this._bigEndian?(this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)):(this.writeByte(255&t),this.writeByte(t>>8&255),this.writeByte(t>>16&255),this.writeByte(t>>24&255))}},{key:"writeUnsignedInt",value:function(t){this._bigEndian?(this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)):(this.writeByte(255&t),this.writeByte(t>>8&255),this.writeByte(t>>16&255),this.writeByte(t>>24&255))}},{key:"readUnsignedInt",value:function(){var t=0;return this._bigEndian?(t|=this.readUnsignedByte()<<24,t|=this.readUnsignedByte()<<16,t|=this.readUnsignedByte()<<8,t|=this.readUnsignedByte()):(t|=this.readUnsignedByte(),t|=this.readUnsignedByte()<<8,t|=this.readUnsignedByte()<<16,t|=this.readUnsignedByte()<<24),A.intToUint(t)}},{key:"readInt",value:function(){var t=this.readUnsignedInt();return t>2147483648&&(t-=4294967296),t}},{key:"writeUTFBytes",value:function(t){for(var e=0;e<t.length;e++){var i=A.numberToUint(t.charCodeAt(e));i<=127?this.writeByte(i):i<=2047?(this.writeByte(192|i>>6&31),this.writeByte(128|63&i)):(this.writeByte(224|i>>12&15),this.writeByte(128|i>>6&63),this.writeByte(128|63&i))}}},{key:"readUTFBytes",value:function(t){for(var e=0,i="";e<t;){var n,r,o=this.readUnsignedByte();if(e++,0==(128&o))r=o;else if(192==(224&o))n=this.readUnsignedByte(),e++,r=A.intToUint((31&o)<<6|63&n);else if(224==(240&o)){n=this.readUnsignedByte();var s=this.readUnsignedByte();e+=2,r=A.intToUint((15&o)<<12|(63&n)<<6|63&s)}i+=String.fromCharCode(r)}return i}},{key:"readBytes",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(n<=0||n>this.bytesAvailable)&&(n=this.bytesAvailable);var r=A.intToUint(i+n);e.ensureLength(r),t.copyBuffer(this._buffer,this._position,e._buffer,i,n),this._position+=n,r>e._length&&(e._length=r)}},{key:"writeBytes",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(n<=0||i+n>e._length)&&(n=A.intToUint(e._length-i));var r=A.intToUint(this._position+n);this.ensureLength(r),t.copyBuffer(e._buffer,i,this._buffer,this._position,n),this._position+=n,this._position>=this._length&&(this._length=this._position)}},{key:"toString",value:function(){return D.flash_utils_ByteArray_toString(this)}},{key:"endian",get:function(){return this._endian},set:function(t){this._endian=t,this._bigEndian=this._endian==Vy.BIG_ENDIAN}},{key:"length",get:function(){return this._length},set:function(t){t>=0&&t<=this._length&&(this._length=t),this._position>=this._length&&(this._position=this._length)}},{key:"position",get:function(){return this._position},set:function(t){t>=0&&t<=this.length&&(this._position=t)}},{key:"bytesAvailable",get:function(){return A.intToUint(this.position<this.length?this.length-this.position:0)}}],[{key:"createTypedBuffer",value:function(t){return D.flash_utils_ByteArray_createTypedBuffer(t)}},{key:"createUint8Array",value:function(t){return D.flash_utils_ByteArray_createUint8Array(t)}},{key:"copyBuffer",value:function(t,e,i,n,r){D.flash_utils_ByteArray_copyBuffer(t,e,i,n,r)}}]),t}();r.implementsInterfaces(Dy,[Qy,Ry]);var Fy=0;r.registerClass(Dy,"flash.utils.ByteArray");var Uy=function(){function t(){y(this,t),this.map=new Map}return p(t,[{key:"get",value:function(t){return this.map.get(t)}},{key:"put",value:function(t,e){return this.map.set(t,e)}},{key:"hasOwnProperty",value:function(t){return"string"==typeof t&&this.map.has(t)}}]),t}();r.registerClass(Uy,"flash.utils.Dictionary");var Vy=function(){function t(){y(this,t)}return p(t,null,[{key:"BIG_ENDIAN",get:function(){return"bigEndian"}},{key:"LITTLE_ENDIAN",get:function(){return"littleEndian"}}]),t}();r.registerClass(Vy,"flash.utils.Endian");var By=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y(this,e),(i=l(this,h(e).call(this)))._currentCount=0,i._delay=NaN,i._repeatCount=0,i._running=!1,i._currentTimer=null,i._running=!1,i._currentCount=0,i._currentTimer=null,i.delay=t,i.repeatCount=n,i}return c(e,At),p(e,[{key:"reset",value:function(){this.stop(),this._currentCount=0}},{key:"start",value:function(){this._running||(this._running=!0,this.startTimer())}},{key:"stop",value:function(){this._running&&(this._running=!1,this.stopTimer())}},{key:"checkInterval",value:function(){this._running&&(this._currentCount++,this.hasMoreRepeats||this.stop(),this.dispatchEvent(new Nf(Nf.TIMER)),this.hasMoreRepeats||this.dispatchEvent(new Nf(Nf.TIMER_COMPLETE)))}},{key:"startTimer",value:function(){this.stopTimer(),this._currentTimer=X.setInterval(xt.bindMethod(this,this.checkInterval),this._delay)}},{key:"stopTimer",value:function(){this._currentTimer&&(X.clearInterval(this._currentTimer),this._currentTimer=null)}},{key:"currentCount",get:function(){return this._currentCount}},{key:"delay",get:function(){return this._delay},set:function(t){this._delay=t,this._running&&(this.stop(),this.start())}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._running&&!this.hasMoreRepeats&&this.stop()}},{key:"running",get:function(){return this._running}},{key:"currentTime",get:function(){return(new Date).getTime()}},{key:"hasMoreRepeats",get:function(){return 0===this._repeatCount||this._currentCount<this._repeatCount}}]),e}();r.registerClass(By,"flash.utils.Timer");var Hy=function(){function t(e){y(this,t)}return p(t,null,[{key:"MAX_VALUE",get:function(){return 2147483647}},{key:"MIN_VALUE",get:function(){return-2147483648}}]),t}();r.registerClass(Hy,"int");var $y=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,hc),e}();r.registerClass($y,"mx.containers.Canvas");var Gy=function(t){function e(){var t;return y(this,e),(t=l(this,h(e).call(this))).text=null,t}return c(e,hc),p(e,null,[{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return D.mx_controls_Alert_show(t)}}]),e}();r.registerClass(Gy,"mx.controls.Alert");var Yy=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return y(this,e),l(this,h(e).call(this,t,i,n))}return c(e,ct),p(e,null,[{key:"ADD",get:function(){return"add"}},{key:"ADD_FOCUS_MANAGER",get:function(){return"addFocusManager"}},{key:"APPLICATION_COMPLETE",get:function(){return"applicationComplete"}},{key:"BACK_KEY_PRESSED",get:function(){return"backKeyPressed"}},{key:"BUTTON_DOWN",get:function(){return"buttonDown"}},{key:"CHANGE_END",get:function(){return"changeEnd"}},{key:"CHANGE_START",get:function(){return"changeStart"}},{key:"CHANGING",get:function(){return"changing"}},{key:"CONTENT_CREATION_COMPLETE",get:function(){return"contentCreationComplete"}},{key:"CREATION_COMPLETE",get:function(){return"creationComplete"}},{key:"CURSOR_UPDATE",get:function(){return"cursorUpdate"}},{key:"DATA_CHANGE",get:function(){return"dataChange"}},{key:"ENTER",get:function(){return"enter"}},{key:"ENTER_FRAME",get:function(){return"flexEventEnterFrame"}},{key:"ENTER_STATE",get:function(){return"enterState"}},{key:"EXIT_STATE",get:function(){return"exitState"}},{key:"FLEX_WINDOW_ACTIVATE",get:function(){return"flexWindowActivate"}},{key:"FLEX_WINDOW_DEACTIVATE",get:function(){return"flexWindowDeactivate"}},{key:"HIDE",get:function(){return"hide"}},{key:"IDLE",get:function(){return"idle"}},{key:"INIT_COMPLETE",get:function(){return"initComplete"}},{key:"INITIALIZE",get:function(){return"initialize"}},{key:"INIT_PROGRESS",get:function(){return"initProgress"}},{key:"INVALID",get:function(){return"invalid"}},{key:"LOADING",get:function(){return"loading"}},{key:"MENU_KEY_PRESSED",get:function(){return"menuKeyPressed"}},{key:"MUTED_CHANGE",get:function(){return"mutedChange"}},{key:"NAVIGATOR_STATE_LOADING",get:function(){return"navigatorStateLoading"}},{key:"NAVIGATOR_STATE_SAVING",get:function(){return"navigatorStateSaving"}},{key:"PREINITIALIZE",get:function(){return"preinitialize"}},{key:"READY",get:function(){return"ready"}},{key:"REMOVE",get:function(){return"remove"}},{key:"RENDER",get:function(){return"flexEventRender"}},{key:"REPEAT",get:function(){return"repeat"}},{key:"REPEAT_END",get:function(){return"repeatEnd"}},{key:"REPEAT_START",get:function(){return"repeatStart"}},{key:"SELECTION_CHANGE",get:function(){return"selectionChange"}},{key:"SHOW",get:function(){return"show"}},{key:"STATE_CHANGE_COMPLETE",get:function(){return"stateChangeComplete"}},{key:"STATE_CHANGE_INTERRUPTED",get:function(){return"stateChangeInterrupted"}},{key:"TRANSFORM_CHANGE",get:function(){return"transformChange"}},{key:"TRANSITION_END",get:function(){return"transitionEnd"}},{key:"TRANSITION_START",get:function(){return"transitionStart"}},{key:"UPDATE_COMPLETE",get:function(){return"updateComplete"}},{key:"URL_CHANGED",get:function(){return"urlChanged"}},{key:"VALID",get:function(){return"valid"}},{key:"VALUE_COMMIT",get:function(){return"valueCommit"}}]),e}();r.registerClass(Yy,"mx.events.FlexEvent");var zy=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return y(this,e),(i=l(this,h(e).call(this,t,n,r))).kind=null,i.newValue=null,i.oldValue=null,i.property=null,i.source=null,i.kind=o,i.property=s,i.oldValue=a,i.newValue=u,i.source=c,i}return c(e,ct),p(e,null,[{key:"PROPERTY_CHANGE",get:function(){return"propertyChange"}}]),p(e,null,[{key:"createUpdateEvent",value:function(t,i,n,r){return new e(e.PROPERTY_CHANGE,!1,!1,Wy.UPDATE,i,n,r,t)}}]),e}();r.registerClass(zy,"mx.events.PropertyChangeEvent");var Wy=function(){function t(){y(this,t)}return p(t,null,[{key:"DELETE",get:function(){return"delete"}},{key:"UPDATE",get:function(){return"update"}}]),t}();r.registerClass(Wy,"mx.events.PropertyChangeEventKind");var Xy=function(){function t(){y(this,t)}return p(t,null,[{key:"HORIZONTAL",get:function(){return"horizontal"}},{key:"VERTICAL",get:function(){return"vertical"}}]),t}();r.registerClass(Xy,"mx.events.ScrollEventDirection");var Ky=function(){function t(){y(this,t)}return p(t,null,[{key:"currentCursorID",get:function(){return jy},set:function(t){jy=t}},{key:"currentCursorXOffset",get:function(){return qy},set:function(t){qy=t}},{key:"currentCursorYOffset",get:function(){return Jy},set:function(t){Jy=t}},{key:"NO_CURSOR",get:function(){return 0}}]),p(t,null,[{key:"setCursor",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0}},{key:"removeAllCursors",value:function(){}}]),t}(),jy=0,qy=NaN,Jy=NaN;r.registerClass(Ky,"mx.managers.CursorManager");var Zy=function(){function t(){y(this,t)}return p(t,null,[{key:"trim",value:function(t){return D.mx_utils_StringUtil2_trim(t)}}]),t}();r.registerClass(Zy,"mx.utils.StringUtil2");r.registerClass(function t(){y(this,t)},"mx.graphics.RectangularDropShadow");r.registerClass(function t(){y(this,t)},"IDomElement");var tg=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y(this,t),this.svgContext=e,this._textWidthCanvas=n||e.document.createElement("canvas"),this._textWidthCanvasContext=this._textWidthCanvas.getContext("2d"),i&&(this._textMeasurementCaches=i,this._canvasTextWidthCache=i.canvasTextWidthCache,this._textWidthCache=i.textWidthCache,this._textHeightCache=i.textHeightCache)}return p(t,[{key:"withCache",value:function(t,e,i,n){if(t){var r=i(e),o=t[r];return null==o?(this._textMeasurementCaches.requiresRegeneration=!0,t[r]=-1,0):o<0?(this._textMeasurementCaches.requiresRegeneration=!0,0):o}return n(e)}},{key:"canvasTextWidth",value:function(t,e){var i=this;return this.withCache(this._canvasTextWidthCache,{text:t,font:e},function(t){return i._canvasTextWidthCacheKey(t.text,t.font)},function(t){return i._textWidthCanvasContext.font=t.font,i._textWidthCanvasContext.measureText(t.text).width})}},{key:"_canvasTextWidthCacheKey",value:function(t,e){return this._escapeNonAscii("".concat(e,"|").concat(t))}},{key:"textHeight",value:function(t){var e=this;return this.withCache(this._textHeightCache,t,function(t){return e._textHeightCacheKey(t)},function(t){return e.svgContext.internalGetBBox(t).height})}},{key:"_textHeightCacheKey",value:function(t){return this._textSvgToCacheKey(t)}},{key:"textWidth",value:function(t){var e=this;return this.withCache(this._textWidthCache,t,function(t){return e._textWidthCacheKey(t)},function(t){return e.svgContext.internalGetBBox(t).width})}},{key:"_textWidthCacheKey",value:function(t){return this._textSvgToCacheKey(t)}},{key:"_textSvgToCacheKey",value:function(t){var e=this._extractTextSizingInfo(t);return null==e?null:this._escapeNonAscii(JSON.stringify(e))}},{key:"_escapeNonAscii",value:function(t){for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);if(n<32||n>126){var r="0000"+n.toString(16);e+="\\u"+r.substring(r.length-4)}else e+=String.fromCharCode(n)}return e}},{key:"_extractTextSizingInfo",value:function(t){var e=this._extractTextInfo(t);return null!=e?e:t.nodeType!=Node.ELEMENT_NODE||"g"!=t.nodeName||this._hasSizeChangingTransform(t)||1!=t.childNodes.length?null:this._extractTextSizingInfo(t.firstChild)}},{key:"_extractTextInfo",value:function(t){if(t.nodeType!=Node.ELEMENT_NODE||"g"!=t.nodeName||this._hasSizeChangingTransform(t))return null;var e=this._extractFontInfo(t);if(null==e)return null;var i=[];e.push(i);for(var n=t.childNodes,r=0;r<n.length;r++){var o=this._extractTextLine(n[r]);if(null==o)return null;i.push(o)}return e}},{key:"_hasSizeChangingTransform",value:function(t){if(!t.hasAttribute("transform"))return!1;var e=t.getAttribute("transform");return e.indexOf("scale(1,1)")<0||e.indexOf("rotate(0)")<0}},{key:"_extractFontInfo",value:function(t){return t.hasAttribute("font-family")&&t.hasAttribute("font-size")&&t.hasAttribute("font-style")&&t.hasAttribute("font-weight")?[t.getAttribute("font-family"),this._getNumberAttribute(t,"font-size"),t.getAttribute("font-style"),t.getAttribute("font-weight")]:null}},{key:"_extractTextLine",value:function(t){return t.nodeType==Node.ELEMENT_NODE&&"text"==t.nodeName&&t.hasAttribute("x")&&t.hasAttribute("y")&&1==t.childNodes.length&&t.firstChild.nodeType==Node.TEXT_NODE?[this._getNumberAttribute(t,"x"),this._getNumberAttribute(t,"y"),t.firstChild.nodeValue]:null}},{key:"_getNumberAttribute",value:function(t,e){var i=t.getAttribute(e);if("NaN"==i)return NaN;var n=parseFloat(i),r=1;return n<0&&(n=-n,r=-1),Math.floor(1e5*n+.5)/1e5*r}}]),t}();r.registerClass(tg,"TextMeasurement");var eg=function(){function t(){y(this,t)}return p(t,[{key:"record",value:function(e){t.alwaysReturnDifferent||(this.width=e.width,this.height=e.height)}},{key:"isWidthDifferent",value:function(e){return!!t.alwaysReturnDifferent||e.width!=this.width}},{key:"isHeightDifferent",value:function(e){return!!t.alwaysReturnDifferent||e.height!=this.height}}],[{key:"alwaysReturnDifferent",get:function(){return ig},set:function(t){ig=t}}]),t}(),ig=!1;r.registerClass(eg,"com.noteflight.notation.view.MeasureViewDimensions");var ng=function(){function t(){y(this,t),this.unconfirmedMessages=[],this.messagesByEditId={}}return p(t,[{key:"updateIds",value:function(t,e){this.sessionId=t,this.participantId=e;var i=!0,n=!1,r=void 0;try{for(var o,s=this.unconfirmedMessages[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.transformIds(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"addMessage",value:function(t){this.unconfirmedMessages.push(t),this.messagesByEditId[t.editId]=t}},{key:"confirmMessage",value:function(t){var e=this.messagesByEditId[t.editId];if(e){var i=this.unconfirmedMessages.indexOf(e);i>=0&&this.unconfirmedMessages.splice(i,1),delete this.messagesByEditId[t.editId]}}},{key:"transformIds",value:function(t){t.sessionId=this.sessionId,t.participantId=this.participantId}},{key:"isEmpty",get:function(){return 0===this.unconfirmedMessages.length}}]),t}();r.registerClass(ng,"com.noteflight.notation.editorio.MessageStore");var rg=function(t){function e(){return y(this,e),l(this,h(e).call(this))}return c(e,At),p(e,[{key:"send",value:function(t){throw Error("abstract method")}}]),e}();r.registerClass(rg,"com.noteflight.notation.editorio.PubSubConnection");var og=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).message=i,n}return c(e,ct),p(e,null,[{key:"PUBLIC_MESSAGE_RECEIVED",get:function(){return"publcMessageReceived"}},{key:"PRIVATE_MESSAGE_RECEIVED",get:function(){return"privateMessageReceived"}},{key:"DISCONNECTED",get:function(){return"clientDisconnected"}},{key:"RECONNECTED",get:function(){return"clientReconnected"}},{key:"CONNECTED",get:function(){return"clientConnected"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.message)}}]),e}();r.registerClass(og,"com.noteflight.notation.editorio.PubSubConnectionEvent");var sg=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"message",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"message",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return y(this,e),(i=l(this,h(e).call(this))).client=t,i.publicTopic=n,i.privateTopic=r,i.lastWillTopic=o,i.lastWillMessage=s,i.client.on("message",function(t,e){return i.handleMessage(t,e)}),i.client.on("close",function(){return i.handleDisconnect()}),i.client.on("reconnect",function(){return i.handleReconnect()}),i.client.on("connect",function(){return i.handleConnect()}),i}return c(e,rg),p(e,[{key:"subscribe",value:function(t){this.client.subscribe(t)}},{key:"send",value:function(t,e){this.client.publish(t,e)}},{key:"handleMessage",value:function(t,e){t==this.publicTopic?this.handlePublicMessage(e):t==this.privateTopic&&this.handlePrivateMessage(e)}},{key:"handlePublicMessage",value:function(t){var e=new og(og.PUBLIC_MESSAGE_RECEIVED,t);this.dispatchEvent(e)}},{key:"handlePrivateMessage",value:function(t){var e=new og(og.PRIVATE_MESSAGE_RECEIVED,t);this.dispatchEvent(e)}},{key:"handleConnect",value:function(){var t=new og(og.CONNECTED);this.dispatchEvent(t)}},{key:"handleDisconnect",value:function(){var t=new og(og.DISCONNECTED);this.dispatchEvent(t)}},{key:"handleReconnect",value:function(){var t=new og(og.RECONNECTED);this.dispatchEvent(t)}},{key:"disconnect",value:function(){this.send(this.lastWillTopic,this.lastWillMessage),this.client.end()}},{key:"connected",get:function(){return this.client.connected}}]),e}();r.registerClass(sg,"com.noteflight.notation.editorio.AwsIotConnection");var ag=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"message",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"message";return y(this,e),(i=l(this,h(e).call(this))).socket=t,i.socket.on(n,function(t){return i.handlePublicMessage(t)}),i.socket.on(r,function(t){return i.handlePrivateMessage(t)}),i.socket.on("disconnect",function(){return i.handleDisconnect()}),i.socket.on("reconnect",function(){return i.handleReconnect()}),i.socket.on("connect",function(){return i.handleConnect()}),i}return c(e,rg),p(e,[{key:"send",value:function(t,e){this.socket.emit("message",e)}},{key:"handlePublicMessage",value:function(t){var e=new og(og.PUBLIC_MESSAGE_RECEIVED,t);this.dispatchEvent(e)}},{key:"handlePrivateMessage",value:function(t){var e=new og(og.PRIVATE_MESSAGE_RECEIVED,t);this.dispatchEvent(e)}},{key:"handleConnect",value:function(){var t=new og(og.CONNECTED);this.dispatchEvent(t)}},{key:"handleDisconnect",value:function(){var t=new og(og.DISCONNECTED);this.dispatchEvent(t)}},{key:"handleReconnect",value:function(){var t=new og(og.RECONNECTED);this.dispatchEvent(t)}},{key:"disconnect",value:function(){this.socket.close()}},{key:"connected",get:function(){return this.socket.connected}}]),e}();r.registerClass(ag,"com.noteflight.notation.editorio.SocketIoConnection");var lg=function(e){function i(t){var e;return y(this,i),(e=l(this,h(i).call(this))).scoreDocument=t,e.score=e.scoreDocument.score,e.measureValidator=e.scoreDocument.measureValidator,e.ignoringModelEvents=!1,e.modelJson=new ug(e.score),e.openEdit(),e.addListeners(),e}return c(i,At),p(i,null,[{key:"IGNORED_MODEL_UPDATES",get:function(){return["requiresDefaultInfo"]}}]),p(i,[{key:"openEdit",value:function(){this.edit=new cg,this.undoHistory.numGroups>0&&(this.edit.name=this.undoHistory.openGroupName)}},{key:"addListeners",value:function(){var t=this;this.score.addEventListener(Ri.MODEL_CHANGE,function(e){return t.handleModelChange(e)}),this.score.addEventListener(Di.MODEL_UPDATE,function(e){return t.handleModelUpdate(e)}),this.scoreDocument.addEventListener(Gi.ADD_SELECTION,function(e){return t.handleAddSelection(e)}),this.scoreDocument.addEventListener(Gi.REMOVE_SELECTION,function(e){return t.handleRemoveSelection(e)}),this.scoreDocument.measureValidator.addEventListener(Ai.VALIDATED,function(e){return t.handleMeasureValidatorComplete()})}},{key:"toJson",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.modelJson.toJson(t,e)}},{key:"whileIgnoringModelEvents",value:function(t){var e=this.ignoringModelEvents;try{this.ignoringModelEvents=!0,t()}finally{this.ignoringModelEvents=e}}},{key:"handleModelChange",value:function(t){if(!this.ignoringModelEvents)switch(t.kind){case Ri.ADD_CHILD_MODEL:var e=this.toJson(t.child),i=new vg(t.parent.path,e,t.index,t.child);this.addModelOperation(i);break;case Ri.REMOVE_CHILD_MODEL:var n=null;t.parent instanceof Rl&&t.child instanceof hl&&((n=new hg).measureIndex=t.index);var r=new _g(t.parent.path,t.index,t.child);r.removedChildJson=this.toJson(t.child,n),this.addModelOperation(r);break;case Ri.ADD_ANNOTATION:var o=this.toJson(t.child),s=new Lg(t.parent.path,o,t.index,t.child);this.addModelOperation(s);break;case Ri.REMOVE_ANNOTATION:var a=new kg(t.parent.path,t.index,t.child);a.removedAnnotationJson=this.toJson(t.child),this.addModelOperation(a);break;case Ri.EDIT_ANNOTATION:var l=this.toJson(t.newValue),u=new Tg(t.parent.path,t.property,l,t.oldValue,t.newValue);this.addModelOperation(u)}}},{key:"handleModelUpdate",value:function(t){if(!this.ignoringModelEvents&&!this.shouldIgnoreModelUpdate(t)){var e=this.toJson(t.newValue),i=new Sg(t.source.path,t.property,e,t.oldValue,t.newValue);this.addModelOperation(i)}}},{key:"shouldIgnoreModelUpdate",value:function(t){return!!i.IGNORED_MODEL_UPDATES.includes(t.property)||!(!A.is(t.source,Rl)||"type"!=t.property)}},{key:"handleAddSelection",value:function(t){if(!this.ignoringModelEvents){var e=this.toJson(t.selection),i=new Eg(e,t.selection);this.addSelectionOperation(i)}}},{key:"handleRemoveSelection",value:function(t){if(!this.ignoringModelEvents){var e=this.toJson(t.selection),i=new Mg(e,t.selection);this.addSelectionOperation(i)}}},{key:"addModelOperation",value:function(t){this.addScoreEditOperation(t)}},{key:"addSelectionOperation",value:function(t){this.addScoreEditOperation(t)}},{key:"addScoreEditOperation",value:function(e){var i=this;this.edit.addOperation(e),this.measureValidator.willProcess||t(function(){return i.doneWaiting()})}},{key:"doneWaiting",value:function(){this.measureValidator.willProcess||this.completeEdit()}},{key:"handleMeasureValidatorComplete",value:function(){this.completeEdit()}},{key:"completeEdit",value:function(){if(this.edit.operations.length>0){var t=new Cg(Cg.SCORE_EDIT,this.edit);this.openEdit(),this.dispatchEvent(t)}}},{key:"getCurrentSelectionJson",value:function(){return this.modelJson.toJson(this.scoreDocument.selection)}},{key:"startNewEdit",value:function(t){this.completeEdit(),this.edit.name=t}},{key:"setEditName",value:function(t){this.edit.name=t}},{key:"undoHistory",get:function(){return this.scoreDocument.undoHistory}}]),i}();r.registerClass(lg,"com.noteflight.notation.editorio.ScoreEditListener");var ug=function(){function t(e){y(this,t),this.score=e}return p(t,[{key:"toJson",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t)return null;if("number"==typeof t||"boolean"==typeof t||"string"==typeof t)return t;if(Array.isArray(t))return t.map(function(t){return e.toJson(t,i)});if(A.is(t,xn)){var n=A.as(t,xn);return{type:"EffectNotation",xml:this.xmlWriter.generateEffectNotation(n).toXMLString()}}if(A.is(t,he)){var o=A.as(t,he);return{type:"Notation",xml:this.xmlWriter.generateNotation(o).toXMLString()}}if(A.is(t,Xl)){var s=A.as(t,Xl);return{type:"Tuplet",xml:this.xmlWriter.generateTuplet(s).toXMLString()}}if(A.is(t,Rl)){var a=A.as(t,Rl);return{type:"Staff",xml:this.xmlWriter.generateStaff(a).toXMLString()}}if(A.is(t,hl)){var l=A.as(t,hl);return{type:"Measure",xml:(null!=i&&null!=i.measureIndex?this.xmlWriter.generateMeasure(l,i.measureIndex):this.xmlWriter.generateMeasure(l,l.staff.index)).toXMLString()}}if(A.is(t,Ea)){var u=A.as(t,Ea);return{type:"Annotation",xml:this.xmlWriter.generateAnnotation(u).toXMLString()}}if(A.is(t,El)){var h=A.as(t,El);return{type:"Part",xml:this.xmlWriter.generatePart(h).toXMLString()}}if(A.is(t,ii))return{type:"ScoreUser",username:t.username,userId:t.userId};if(A.is(t,Jl)){var c=A.as(t,Jl);return{type:"AbstractSynchronizedTrack",xml:this.xmlWriter.generateAbstractSynchronizedTrack(c).toXMLString()}}if(A.is(t,wl)){var d=A.as(t,wl);return{type:"RecordedAudioTrack",xml:this.xmlWriter.generateRecordedAudioTrack(d).toXMLString()}}if(A.is(t,Ma)){var f=A.as(t,Ma);return{type:"AudioClip",xml:this.xmlWriter.generateAudioClip(f).toXMLString()}}if(A.is(t,Kl)){var y=A.as(t,Kl),g=tr.xml("voice");return this.xmlWriter.generateRhythmContext(g,y),{type:"Voice",xml:g.toXMLString()}}if(A.is(t,kt))return{type:"ChromaticPitch",pitch:A.as(t,kt).toString()};if(A.is(t,qe))return{type:"ObjectSelection",selectedObjects:A.as(t,qe).selectedObjects.map(function(t){return t.path})};if(A.is(t,Je)){var p=A.as(t,Je);return{type:"RangeSelection",staves:p.staves.map(function(t){return t.path}),start:{measureIndex:p.start.measureIndex,position:p.start.position},end:{measureIndex:p.end.measureIndex,position:p.end.position},direction:p.direction}}if(A.is(t,Ke)){var m=A.as(t,Ke);return{type:"MeasureSelection",startIndex:m.startIndex,endIndex:m.endIndex}}if(A.is(t,wa))return{type:"Block",columns:A.as(t,wa).columns.map(function(t){return e.toJson(t,i)})};if(A.is(t,xa)){var v=A.as(t,xa);return{type:"BlockColumn",text:v.text,weight:v.weight}}if(A.is(t,hr)){var _={type:"PageMetrics"};return A.as(t,hr).toJson(_),_}console.log("unknown serialization",t);var S=r.getClass(t);return null==S?{type:"unknown"}:{class:r.getClassName(S)}}},{key:"fromJson",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==t)return null;if("number"==typeof t||"boolean"==typeof t||"string"==typeof t)return t;if(Array.isArray(t))return t.map(function(t){return e.fromJson(t,i)});if("object"!==f(t)||!t)throw Error("fromJson, unknown value",t);switch(t.type){case"ChromaticPitch":return kt.pitchFromString(t.pitch);case"Notation":case"EffectNotation":var n=q.parse(t.xml);return this.xmlReader.parseNotation(n);case"Tuplet":var r=q.parse(t.xml);return this.xmlReader.parseTuplet(r);case"Annotation":var o=q.parse(t.xml);return this.xmlReader.parseAnnotation(o);case"Part":var s=q.parse(t.xml);return this.xmlReader.parsePart(s);case"RecordedAudioTrack":var a=q.parse(t.xml);return this.xmlReader.parseRecordedAudioTrack(a);case"AudioClip":var l=q.parse(t.xml);return this.xmlReader.parseAudioClip(l);case"AbstractSynchronizedTrack":var u=q.parse(t.xml);return this.xmlReader.parseAbstractSynchronizedTrack(u);case"ObjectSelection":var h=t.selectedObjects.map(function(t){return e.resolvePath(t)}).filter(function(t){return null!=t});return new qe(this.score,h);case"RangeSelection":var c=t.staves.map(function(t){return e.resolvePath(t)}).filter(function(t){return null!=t}),d=new gl(t.start.measureIndex,t.start.position),y=new gl(t.end.measureIndex,t.end.position);return new Je(this.score,d,y,c,t.direction);case"MeasureSelection":return new Ke(this.score,t.startIndex,t.endIndex);case"Block":var g=new wa,p=t.columns.map(function(t){return e.fromJson(t,i)}),m=!0,v=!1,_=void 0;try{for(var S,L=p[Symbol.iterator]();!(m=(S=L.next()).done);m=!0){var k=S.value;g.addColumn(k)}}catch(t){v=!0,_=t}finally{try{m||null==L.return||L.return()}finally{if(v)throw _}}return g;case"ScoreUser":return new ii(t.username,t.userId);case"BlockColumn":return new xa(t.text,t.weight);case"Measure":var T=q.parse(t.xml);if(null!=i&&null!=i.staff&&null!=i.measureIndex)return this.xmlReader.parseMeasure(T,i.staff,i.measureIndex);throw Error("fromJson, attempting to parse a Measure without supplying a Part or measure index");case"Staff":var E=q.parse(t.xml);if(null!=i&&null!=i.staffIndex)return this.xmlReader.parseStaff(E,null,i.staffIndex);throw Error("fromJson, attempting to parse a Staff without supplying a staffIndex");case"Voice":var M=q.parse(t.xml);if(null!=i&&null!=i.measure&&null!=i.voiceNumber)return this.xmlReader.parseRhythmContainer(M.children(),i.voice,i.measure,i.voiceNumber);throw Error("fromJson, attempting to parse a Voice without supplying a voice, measure, and voiceNumber");case"PageMetrics":var b=new hr;return b.fromJson(t),b;default:throw Error('fromJson, unknown object type "'.concat(t.type,'"'))}}},{key:"resolvePath",value:function(t){return"/"==t?null:this.score.resolvePath(t)}},{key:"xmlWriter",get:function(){var t=new cr(this.score);return t.incrementalMode=!0,t.initialize(),t}},{key:"xmlReader",get:function(){var t=new ur;return t._score=this.score,t.incrementalMode=!0,t.initialize(),t}}]),t}();r.registerClass(ug,"com.noteflight.notation.editorio.ModelJson");var hg=function t(){y(this,t)};r.registerClass(hg,"com.noteflight.notation.editorio.ModelJsonContext");var cg=function(){function t(){y(this,t),this.name=null,this.operations=[]}return p(t,[{key:"addOperation",value:function(t){this.operations.push(t)}},{key:"getLastSelectionOperation",value:function(){for(var t=this.operations.length-1;t>=0;t--){var e=this.operations[t];if(e.isSelectionOperation)return e}return null}},{key:"getNonSelectionEdit",value:function(){var e=new t,i=!0,n=!1,r=void 0;try{for(var o,s=this.operations[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.isSelectionOperation||e.operations.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"undo",value:function(t){for(var e=this.operations.length-1;e>=0;e--){this.operations[e].undo(t)}}},{key:"redo",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=this.operations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.redo(t)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"toJson",value:function(){return{type:"ScoreEdit",schema:"1.0",name:this.name,operations:this.operations.map(function(t){return t.toJson()})}}},{key:"releaseUndoData",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.operations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.releaseUndoData()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}},{key:"isEmpty",get:function(){return 0===this.operations.length}},{key:"changesContent",get:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.operations[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){if(n.value.changesContent)return!0}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!1}}],[{key:"fromJson",value:function(e){var i=new t;return i.name=e.name,i.operations=e.operations.map(function(t){return gg.fromJson(t)}),i}}]),t}();r.registerClass(cg,"com.noteflight.notation.editorio.ScoreEdit");var dg=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t),this.fromJson(e)}return p(t,[{key:"toJson",value:function(){return{schema:"1.0",scoreId:this.scoreId,sessionId:this.sessionId,participantId:this.participantId,editSortKey:this.editSortKey,editNumber:this.editNumber,editId:this.editId,fullSave:this.fullSave,fullSaveEditNumber:this.fullSaveEditNumber,prevEditId:this.prevEditId,packetCount:this.packetCount,packetData:this.packetData,packetNumber:this.packetNumber,scoreEditName:this.scoreEditName,scoreEditSchema:this.scoreEditSchema,readTopic:this.readTopic,writeTopic:this.writeTopic}}},{key:"fromJson",value:function(t){this.scoreId=t.scoreId,this.sessionId=t.sessionId,this.participantId=t.participantId,this.editSortKey=this.toInt(t.editSortKey),this.editNumber=this.toInt(t.editNumber),this.editId=t.editId,this.fullSave=t.fullSave,this.fullSaveEditNumber=t.fullSaveEditNumber,this.prevEditId=t.prevEditId,this.packetCount=this.toInt(t.packetCount),this.packetData=t.packetData,this.packetNumber=this.toInt(t.packetNumber),this.scoreEditName=t.scoreEditName,this.scoreEditSchema=t.scoreEditSchema,this.readTopic=t.readTopic,this.writeTopic=t.writeTopic}},{key:"clone",value:function(){return t.fromJson(this.toJson())}},{key:"toInt",value:function(t){return null==t?null:"number"==typeof t?Math.floor(t):"string"==typeof t?parseInt(t):null}}],[{key:"fromJson",value:function(e){var i=new t;return i.fromJson(e),i}}]),t}();r.registerClass(dg,"com.noteflight.notation.editorio.ScoreEditMessage");var fg=function(){function t(e){y(this,t),this.packets=Array(e),this.remainingPackets=e}return p(t,[{key:"hasPacket",value:function(t){return null!=this.packets[t]}},{key:"addPacket",value:function(t){var e=t.packetNumber;this.hasPacket(e)||(this.packets[e]=t,this.remainingPackets--)}},{key:"complete",get:function(){return this.remainingPackets<=0}},{key:"scoreEditMessage",get:function(){var t,i=this.packets.map(function(t){return t.packetData}),n=(t="").concat.apply(t,e(i)),r=this.packets[0].toJson();return r.packetCount=1,r.packetNumber=0,r.packetData=n,new dg(r)}}]),t}();r.registerClass(fg,"com.noteflight.notation.editorio.ScoreEditMessagePackets");var yg=function(){function t(e,i){y(this,t),this.scoreEditApplicator=e,this.scoreEditListener=i,this.head=null,this.messagePacketsByEditId={},this.editsByEditId={},this.editsByPrevEditId={},this.unappliedEdits=[],this.unsentMessages=[]}return p(t,[{key:"receivePacket",value:function(t){var e=t.editId,i=this.messagePacketsByEditId[e];if(null==i&&(i=new fg(t.packetCount),this.messagePacketsByEditId[e]=i),i.addPacket(t),i.complete){delete this.messagePacketsByEditId[e];var n=i.scoreEditMessage,r=n.packetData,o=atob(r),s=$e.inflate(o,{to:"string"}),a=JSON.parse(s),l=cg.fromJson(a);n.scoreEdit=l,n.applied=!1,this._receiveEdit(n)}}},{key:"addLocalEdit",value:function(t){t.applied=!0,null!=this.head&&(t.prevEditId=this.head.editId,this.head=t),this._addEditToIndexes(t),this.unsentMessages.push(t)}},{key:"clearUnsentMessages",value:function(){this.unsentMessages=[]}},{key:"_receiveEdit",value:function(t){var e=this.editsByEditId[t.editId];null!=e?null==e.editNumber&&null!=t.editNumber&&(e.editNumber=t.editNumber):(this._addEditToIndexes(t),this._checkIfHead(t)),this._applyUnappliedEdits()}},{key:"_checkIfHead",value:function(t){var e=this;null==this.head&&t.fullSaveEditNumber&&(this.scoreEditListener.whileIgnoringModelEvents(function(){var i=t.scoreEdit;e.scoreEditApplicator.applyScoreEdit(i)}),this.head=t,t.applied=!0,this._removeEditFromUnappliedEdits(t))}},{key:"_applyUnappliedEdits",value:function(){for(var t=!1;!t;){var e=!1,i=!0,n=!1,r=void 0;try{for(var o,s=this.unappliedEdits[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(this._applyUnappliedEdit(a)){e=!0;break}}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}e||(t=!0)}this._advanceHead()}},{key:"_applyUnappliedEdit",value:function(t){var e=this.editsByEditId[t.prevEditId];if(null==e)return!1;if(!e.applied||null==e.editNumber)return!1;var i=this.editsByPrevEditId[t.prevEditId];if(null!=i){var n=!0,r=!1,o=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){if(null==s.value.editNumber)return!1}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}if(t.applied=!0,this._removeEditFromUnappliedEdits(t),i.length>1){var l=this.editsByEditId[t.prevEditId];this._resolveConflict(l)}return!0}},{key:"_addEditToIndexes",value:function(t){this.editsByEditId[t.editId]=t;var e=this.editsByPrevEditId[t.prevEditId];null==e&&(e=[],this.editsByPrevEditId[t.prevEditId]=e),e.push(t),t.applied||this._addEditToUnappliedEdits(t)}},{key:"_removeEditFromIndexes",value:function(t){delete this.editsByEditId[t.editId];var e=this.editsByPrevEditId[t.prevEditId];if(null!=e){var i=e.indexOf(t);i>=0&&e.splice(i,1),0==e.length&&delete this.editsByPrev[t.prevEditId]}t.applied||this._removeEditFromUnappliedEdits(t)}},{key:"_addEditToUnappliedEdits",value:function(t){this.unappliedEdits.indexOf(t)<0&&(this.unappliedEdits.push(t),this.unappliedEdits.sort(function(t,e){var i=t.editNumber,n=e.editNumber;return i==n?0:null==i?1:null==n?-1:i-n}))}},{key:"_removeEditFromUnappliedEdits",value:function(t){var e=this.unappliedEdits.indexOf(t);e>=0&&this.unappliedEdits.splice(e,1)}},{key:"_advanceHead",value:function(){var t=this;this.scoreEditListener.whileIgnoringModelEvents(function(){for(;;){if(null==t.head)return;var e=t.editsByPrevEditId[t.head.editId];if(null==e||1!=e.length)return;var i=e[0];if(!i.applied)return;var n=i.scoreEdit;t.scoreEditApplicator.applyScoreEdit(n),t.head=i}})}},{key:"_resolveConflict",value:function(t){this._rewindHeadTo(t);var e=this.editsByPrevEditId[t.editId],i=this._getLowestNumberedEdit(e),n=!0,r=!1,o=void 0;try{for(var s,a=e.slice()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;l!=i&&this._removeEditFromIndexes(l)}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"_getLowestNumberedEdit",value:function(t){var e=null,i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;(null==e||a.editNumber<e.editNumber)&&(e=a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return e}},{key:"_rewindHeadTo",value:function(t){if(this._canRewindHeadTo(t))for(;this.head!=t;)this._rewindHead()}},{key:"_canRewindHeadTo",value:function(t){for(var e=this.head;e!=t;){if(null==e||null==e.prevEditId)return!1;e=this.editsByEditId[e.prevEditId]}return!0}},{key:"_rewindHead",value:function(){this.head.scoreEdit.undo(this.scoreEditApplicator),this.head=this.editsByEditId[this.head.prevEditId]}}]),t}();r.registerClass(yg,"com.noteflight.notation.editorio.ScoreEditMessages");var gg=function(){function t(){y(this,t)}return p(t,[{key:"apply",value:function(t){throw Error("abstract method")}},{key:"undo",value:function(t){throw Error("abstract method")}},{key:"redo",value:function(t){throw Error("abstract method")}},{key:"toJson",value:function(){throw Error("abstract method")}},{key:"releaseUndoData",value:function(){}},{key:"isSelectionOperation",get:function(){return!1}},{key:"changesContent",get:function(){throw Error("abstract method")}}],[{key:"fromJson",value:function(t){switch(t.type){case"AddChildModelOperation":return new vg(t.path,t.child,t.index);case"RemoveChildModelOperation":return new _g(t.path,t.index,t.removedChild);case"UpdateModelPropertyOperation":return new Sg(t.path,t.property,t.value);case"AddAnnotationOperation":return new Lg(t.path,t.child,t.index);case"RemoveAnnotationOperation":return new kg(t.path,t.index,t.removedAnnotation);case"UpdateAnnotationOperation":return new Tg(t.path,t.property,t.value);case"AddSelectionOperation":return new Eg(t.selection);case"RemoveSelectionOperation":return new Mg(t.selection);case"FullSaveOperation":return bg.fromJson(t);default:throw Error('Unknown type "'.concat(t.type,'"'))}}}]),t}();r.registerClass(gg,"com.noteflight.notation.editorio.ScoreEditOperation");var pg=function(t){function e(t){var i;return y(this,e),(i=l(this,h(e).call(this))).path=t,i}return c(e,gg),p(e,[{key:"changesContent",get:function(){return!0}}]),e}();r.registerClass(pg,"com.noteflight.notation.editorio.ModelOperation");var mg=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),(i=l(this,h(e).call(this))).selection=t,i.newSelection=n,i}return c(e,gg),p(e,[{key:"isSelectionOperation",get:function(){return!0}},{key:"changesContent",get:function(){return!1}}]),e}();r.registerClass(mg,"com.noteflight.notation.editorio.SelectionOperation");var vg=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return y(this,e),(r=l(this,h(e).call(this,t))).child=i,r.index=n,r.addedChild=o,r}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyAddChildModelOperation(this)}},{key:"undo",value:function(t){t.undoAddChildModelOperation(this)}},{key:"redo",value:function(t){t.redoAddChildModelOperation(this)}},{key:"toJson",value:function(){return{type:"AddChildModelOperation",path:this.path,child:this.child,index:this.index}}},{key:"releaseUndoData",value:function(){this.addedChild=null}}]),e}();r.registerClass(vg,"com.noteflight.notation.editorio.AddChildModelOperation");var _g=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t))).index=i,n.removedChild=r,n.removedChildJson=null,n}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyRemoveChildModelOperation(this)}},{key:"undo",value:function(t){t.undoRemoveChildModelOperation(this)}},{key:"redo",value:function(t){t.redoRemoveChildModelOperation(this)}},{key:"toJson",value:function(){return{type:"RemoveChildModelOperation",path:this.path,index:this.index,removedChild:this.removedChildJson}}},{key:"releaseUndoData",value:function(){this.removedChild=null}}]),e}();r.registerClass(_g,"com.noteflight.notation.editorio.RemoveChildModelOperation");var Sg=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return y(this,e),(r=l(this,h(e).call(this,t))).property=i,r.value=n,r.oldValue=o,r.newValue=s,r}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyUpdateModelPropertyOperation(this)}},{key:"undo",value:function(t){t.undoUpdateModelPropertyOperation(this)}},{key:"redo",value:function(t){t.redoUpdateModelPropertyOperation(this)}},{key:"toJson",value:function(){return{type:"UpdateModelPropertyOperation",path:this.path,property:this.property,value:this.value}}},{key:"releaseUndoData",value:function(){this.newValue=null,this.oldValue=null}}]),e}();r.registerClass(Sg,"com.noteflight.notation.editorio.UpdateModelPropertyOperation");var Lg=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return y(this,e),(r=l(this,h(e).call(this,t))).child=i,r.index=n,r.addedChild=o,r}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyAddAnnotationOperation(this)}},{key:"undo",value:function(t){t.undoAddAnnotationOperation(this)}},{key:"redo",value:function(t){t.redoAddAnnotationOperation(this)}},{key:"toJson",value:function(){return{type:"AddAnnotationOperation",path:this.path,child:this.child,index:this.index}}},{key:"releaseUndoData",value:function(){this.addedChild=null}}]),e}();r.registerClass(Lg,"com.noteflight.notation.editorio.AddAnnotationOperation");var kg=function(t){function e(t,i){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return y(this,e),(n=l(this,h(e).call(this,t))).index=i,n.removedAnnotation=r,n.removedAnnotationJson=null,n}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyRemoveAnnotationOperation(this)}},{key:"undo",value:function(t){t.undoRemoveAnnotationOperation(this)}},{key:"redo",value:function(t){t.redoRemoveAnnotationOperation(this)}},{key:"toJson",value:function(){return{type:"RemoveAnnotationOperation",path:this.path,index:this.index,removedAnnotation:this.removedAnnotationJson}}},{key:"releaseUndoData",value:function(){this.removedAnnotation=null}}]),e}();r.registerClass(kg,"com.noteflight.notation.editorio.RemoveAnnotationOperation");var Tg=function(t){function e(t,i,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return y(this,e),(r=l(this,h(e).call(this,t))).property=i,r.value=n,r.oldValue=o,r.newValue=s,r}return c(e,pg),p(e,[{key:"apply",value:function(t){t.applyUpdateAnnotationOperation(this)}},{key:"undo",value:function(t){t.undoUpdateAnnotationOperation(this)}},{key:"redo",value:function(t){t.redoUpdateAnnotationOperation(this)}},{key:"toJson",value:function(){return{type:"UpdateAnnotationOperation",path:this.path,property:this.property,value:this.value}}},{key:"releaseUndoData",value:function(){this.newValue=null,this.oldValue=null}}]),e}();r.registerClass(Tg,"com.noteflight.notation.editorio.UpdateAnnotationOperation");var Eg=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),l(this,h(e).call(this,t,i))}return c(e,mg),p(e,[{key:"apply",value:function(t){t.applyAddSelectionOperation(this)}},{key:"undo",value:function(t){t.undoAddSelectionOperation(this)}},{key:"redo",value:function(t){t.redoAddSelectionOperation(this)}},{key:"toJson",value:function(){return{type:"AddSelectionOperation",selection:this.selection}}}]),e}();r.registerClass(Eg,"com.noteflight.notation.editorio.AddSelectionOperation");var Mg=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return y(this,e),l(this,h(e).call(this,t,i))}return c(e,mg),p(e,[{key:"apply",value:function(t){t.applyRemoveSelectionOperation(this)}},{key:"undo",value:function(t){t.undoRemoveSelectionOperation(this)}},{key:"redo",value:function(t){t.redoRemoveSelectionOperation(this)}},{key:"toJson",value:function(){return{type:"RemoveSelectionOperation",selection:this.selection}}}]),e}();r.registerClass(Mg,"com.noteflight.notation.editorio.RemoveSelectionOperation");var bg=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this))).versionNumber=t,n.selections=i,n}return c(e,gg),p(e,[{key:"apply",value:function(t){t.applyFullSaveOperation(this)}},{key:"undo",value:function(t){t.undoFullSaveOperation(this)}},{key:"redo",value:function(t){t.redoFullSaveOperation(this)}},{key:"toJson",value:function(){return{type:"FullSaveOperation",versionNumber:this.versionNumber,selections:this.selections.map(function(t){return t.toJson()})}}}],[{key:"fromJson",value:function(t){var i=t.selections.map(function(t){return wg.fromJson(t)});return new e(t.versionNumber,i)}}]),e}();r.registerClass(bg,"com.noteflight.notation.editorio.FullSaveOperation");var wg=function(){function t(e,i,n){y(this,t),this.participantId=e,this.selection=i,this.cursor=n}return p(t,[{key:"toJson",value:function(){return{participantId:this.participantId,selection:this.selection,cursor:this.cursor}}}],[{key:"fromJson",value:function(e){return new t(e.participantId,e.selection,e.cursor)}}]),t}();r.registerClass(wg,"com.noteflight.notation.editorio.SavedSelection");var xg=function(){function t(e){y(this,t),this.scoreDocument=e,this.score=this.scoreDocument.score,this.modelJson=new ug(this.score)}return p(t,[{key:"fromJson",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.modelJson.fromJson(t,e)}},{key:"applyScoreEdit",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t.operations[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;this.applyScoreEditOperation(s)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"applyScoreEditOperation",value:function(t){t.apply(this)}},{key:"_resolvePath",value:function(t){return null==t||""===t?this.score:this.score.resolvePath(t)}},{key:"applyAddChildModelOperation",value:function(t){var e=this._resolvePath(t.path);if(e instanceof Rl&&"Measure"==t.child.type)this.applyAddMeasure(e,t);else if(e instanceof Nl&&"Staff"==t.child.type)this.applyAddStaff(t);else if(e instanceof hl&&"Voice"==t.child.type)this.applyAddVoice(e,t);else if(e instanceof de&&"EffectNotation"==t.child.type)this.applyAddEffect(e,t);else{var i=this.fromJson(t.child),n=t.index;e.addChildAt(i,n)}}},{key:"applyAddMeasure",value:function(t,e){var i=new hg;i.staff=t,i.measureIndex=e.index,this.fromJson(e.child,i)}},{key:"applyAddStaff",value:function(t){var e=new hg;e.staffIndex=t.index;this.score.parts;this.fromJson(t.child,e)}},{key:"applyAddVoice",value:function(t,e){var i=e.index,n=new Kl;t.addChildAt(n,i);var r=i-1,o=new hg;o.voice=n,o.measure=t,o.voiceNumber=r,this.fromJson(e.child,o)}},{key:"applyAddEffect",value:function(t,e){var i=this.fromJson(e.child);i.isPreEffect?t.addPreEffect(i):t.addPostEffect(i)}},{key:"applyRemoveChildModelOperation",value:function(t){var e=this._resolvePath(t.path),i=t.index;e.removeChildAt(i)}},{key:"applyUpdateModelPropertyOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=this.fromJson(t.value);e[i]=n;this.score.parts}},{key:"applyAddAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=this.fromJson(t.child),n=t.index;e.addAnnotationAt(i,n)}},{key:"applyRemoveAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.index;e.removeAnnotationAt(i)}},{key:"applyUpdateAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=this.fromJson(t.value);e[i]=n}},{key:"applyAddSelectionOperation",value:function(t){var e=this.fromJson(t.selection);this.scoreDocument.select(e)}},{key:"applyRemoveSelectionOperation",value:function(t){var e=this.fromJson(t.selection);this.scoreDocument.deselect(e)}},{key:"setSelection",value:function(t){var e=this.modelJson.fromJson(t);this.scoreDocument.selection=e}},{key:"applyFullSaveOperation",value:function(t){var e=this.fromJson(t.selections[0].selection);this.scoreDocument.select(e)}},{key:"undoAddChildModelOperation",value:function(t){var e=this._resolvePath(t.path);if(A.is(e,de)&&t.addedChild&&A.is(t.addedChild,xn))this.undoAddEffect(e,t.addedChild);else{var i=t.index;e.removeChildAt(i)}}},{key:"undoAddEffect",value:function(t,e){e.isPreEffect?t.removePreEffect(e):t.removePostEffect(e)}},{key:"undoRemoveChildModelOperation",value:function(t){var e=this._resolvePath(t.path),i=t.removedChild,n=t.index;e.addChildAt(i,n)}},{key:"undoUpdateModelPropertyOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=t.oldValue;e[i]=n}},{key:"undoAddAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.index;e.removeAnnotationAt(i)}},{key:"undoRemoveAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.removedAnnotation,n=t.index;e.addAnnotationAt(i,n)}},{key:"undoUpdateAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=t.oldValue;e[i]=n}},{key:"undoAddSelectionOperation",value:function(t){var e=t.newSelection;this.scoreDocument.deselect(e)}},{key:"undoRemoveSelectionOperation",value:function(t){var e=t.newSelection;this.scoreDocument.select(e)}},{key:"undoFullSaveOperation",value:function(t){}},{key:"redoAddChildModelOperation",value:function(t){var e=this._resolvePath(t.path),i=t.addedChild;if(A.is(e,de)&&A.is(i,xn))this.redoAddEffect(e,i);else{var n=t.index;e.addChildAt(i,n)}}},{key:"redoAddEffect",value:function(t,e){e.isPreEffect?t.addPreEffect(e):t.addPostEffect(e)}},{key:"redoRemoveChildModelOperation",value:function(t){var e=this._resolvePath(t.path),i=t.index;e.removeChildAt(i)}},{key:"redoUpdateModelPropertyOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=t.newValue;e[i]=n}},{key:"redoAddAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.addedChild,n=t.index;e.addAnnotationAt(i,n)}},{key:"redoRemoveAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.index;e.removeAnnotationAt(i)}},{key:"redoUpdateAnnotationOperation",value:function(t){var e=this._resolvePath(t.path),i=t.property,n=t.newValue;e[i]=n}},{key:"redoAddSelectionOperation",value:function(t){var e=t.newSelection;this.scoreDocument.select(e)}},{key:"redoRemoveSelectionOperation",value:function(t){var e=t.newSelection;this.scoreDocument.deselect(e)}},{key:"redoFullSaveOperation",value:function(t){}}]),t}();r.registerClass(xg,"com.noteflight.notation.editorio.ScoreEditApplicator");var Cg=function(t){function e(t,i){var n;return y(this,e),(n=l(this,h(e).call(this,t))).scoreEdit=i,n}return c(e,ct),p(e,null,[{key:"SCORE_EDIT",get:function(){return"scoreEdit"}}]),p(e,[{key:"clone",value:function(){return new e(this.type,this.scoreEdit)}}]),e}();r.registerClass(Cg,"com.noteflight.notation.editorio.ScoreEditEvent");var Ng=function(){function t(e,i){y(this,t),this.edit=e,this.scoreEditApplicator=i}return p(t,[{key:"undo",value:function(){this.edit.undo(this.scoreEditApplicator)}},{key:"redo",value:function(){this.edit.redo(this.scoreEditApplicator)}},{key:"releaseUndoData",value:function(){this.edit.releaseUndoData()}},{key:"changesContent",get:function(){return this.edit.changesContent}}]),t}();r.registerClass(Ng,"com.noteflight.notation.editorio.UndoableScoreEdit");var Ag=function(){function t(e,i){y(this,t),this.jsflightController=e,this.loadingScoreCalled=!1,this.seenFullStorageAlert=!1,this.saveCountdownTriggered=!1,this.countdown=null,this.loadingFromVersionHistory=!1,this.enabled=!i.hasOwnProperty("enabled")||i.enabled,this.useLocalStorage=!i.hasOwnProperty("useLocalStorage")||i.useLocalStorage}return p(t,null,[{key:"COUNTDOWN_TRIGGER",get:function(){return 200}},{key:"SAVE_COUNTDOWN_TIMEOUT",get:function(){return 1e4}},{key:"SCORE_OPERATIONS_LIMIT",get:function(){return 5e3}},{key:"DISPLAY_MODES",get:function(){return[Nl.PAGINATED_DISPLAY,Nl.FLOW_DISPLAY,Nl.STRIP_DISPLAY,Nl.PERFORM_DISPLAY]}}]),p(t,[{key:"loadingScore",value:function(t,e){this.loadingScoreCalled=!0,this.scoreId=t,this.scoreVersion=e?e.toString():null,this._loadLocalEdits()}},{key:"localSavesRejected",value:function(){this._removeLocalEdits()}},{key:"scoreLoaded",value:function(t){var e=this;this.scoreEditListener=new lg(t),this.scoreEditApplicator=new xg(t),this.scoreEditListener.addEventListener(Cg.SCORE_EDIT,function(t){return e._onScoreEdit(t)}),this.loadingFromVersionHistory?this.loadingFromVersionHistory=!1:this._applyScoreEdits(),t.undoHistory.addEventListener(Zi.UNDO_GROUP_OPENED,function(t){return e._undoGroupOpened(t)}),t.undoHistory.addEventListener(Zi.UNDO_GROUP_NAME_CHANGED,function(t){return e._undoGroupNameChanged(t)}),t.undoHistory.addEventListener(Zi.UNDO_ABOUT_TO_UNDO,function(t){return e._undoGroupAboutToUndo(t)}),t.undoHistory.addEventListener(Zi.UNDO_ABOUT_TO_REDO,function(t){return e._undoGroupAboutToRedo(t)})}},{key:"_applyScoreEdits",value:function(){var e=this;this.enabled&&this.scoreEditListener.whileIgnoringModelEvents(function(){var i=!1,n=!0,r=!1,o=void 0;try{for(var s,a=e.localEdits.edits[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(!i)if(t.DISPLAY_MODES.includes(l.name)&&e.jsflightController.resizeToFit(l.name),null==l.schema||"1.0"==l.schema){var u=cg.fromJson(l);e.scoreEditApplicator.applyScoreEdit(u)}else console.log('Warning - unable to apply ScoreEdit with outdated schema "'.concat(l.schema,'"')),i=!0}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}i||e.scoreEditApplicator.setSelection(e.localEdits.selection)})}},{key:"_onScoreEdit",value:function(t){this.enabled&&this.handleScoreEdit(t.scoreEdit);var e=new Ng(t.scoreEdit,this.scoreEditApplicator);this.undoHistory.addEdit(e)}},{key:"handleScoreEdit",value:function(e){var i=this,n=e.getLastSelectionOperation(),r=n?e.getNonSelectionEdit():e;if(n){var o=this.scoreEditListener.getCurrentSelectionJson();this.localEdits.setSelection(o)}r.isEmpty||this.localEdits.addEdit(r);var s=this.scoreOperationCount;if(this.saveCountdownTriggered&&clearTimeout(this.countdown),s>t.SCORE_OPERATIONS_LIMIT?this.createLocalDraft():s>t.COUNTDOWN_TRIGGER?(this.countdown=setTimeout(function(){return i.createLocalDraft()},t.SAVE_COUNTDOWN_TIMEOUT),this.saveCountdownTriggered=!0,this._saveLocalEdits()):this._saveLocalEdits(),this.jsflightController._recordScoreEdits){var a=JSON.stringify(e.toJson());console.log('<action name="applyScoreEdit"><string><![CDATA['.concat(a,"]]></string></action>"))}}},{key:"scoreSaved",value:function(t){this.scoreVersion=t,this._removeLocalEdits()}},{key:"_loadLocalEdits",value:function(){var t=this._getLocalEdits(),e=Pg.fromLocalStorageString(t);e?this.localEdits=e:(this._removeLocalEdits(),this.localEdits=new Pg(this.scoreVersion))}},{key:"_getLocalEdits",value:function(){return this.enabled&&this.useLocalStorage?this._localStorage.getItem(this._localEditsKey):null}},{key:"_removeLocalEdits",value:function(){this.enabled&&this.useLocalStorage&&(this._localStorage.removeItem(this._localEditsKey),this.seenFullStorageAlert=!1),this.localEdits=new Pg(this.scoreVersion)}},{key:"_saveLocalEdits",value:function(){if(this.enabled&&this.useLocalStorage){var t=this.localEdits.toLocalStorageString();try{this._localStorage.setItem(this._localEditsKey,t)}catch(t){this.seenFullStorageAlert||22!=t.code&&1014!=t.code||(NF.alert(Ou.getString("editor.localStorageFull")),this.seenFullStorageAlert=!0)}}}},{key:"createLocalDraft",value:function(){var t=this.jsflightController.saveScore(!0).toXmlString();this.localEdits.draft=t,this.localEdits.clearEdits(),this._saveLocalEdits(),this.saveCountdownTriggered=!1}},{key:"_undoGroupOpened",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit(e)}},{key:"_undoGroupNameChanged",value:function(t){var e=t.groupName;null!=e&&this._setEditName(e)}},{key:"_undoGroupAboutToUndo",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit("Undo ".concat(e))}},{key:"_undoGroupAboutToRedo",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit("Redo ".concat(e))}},{key:"_startNewEdit",value:function(t){this.scoreEditListener.startNewEdit(t)}},{key:"_setEditName",value:function(t){this.scoreEditListener.setEditName(t)}},{key:"hasLocalEdits",get:function(){return this.localEdits&&(this.hasLocalDraft||this.hasLocalIncrementalEdits)}},{key:"localEditsUpdatedAt",get:function(){return this.localEdits.updatedAt}},{key:"hasLocalDraft",get:function(){return this.localEdits.hasDraft}},{key:"hasLocalIncrementalEdits",get:function(){return this.localEdits.hasEdits}},{key:"undoHistory",get:function(){return this.jsflightController.scoreDocument.undoHistory}},{key:"localDraft",get:function(){if(this.localEdits.draft)return this.localEdits.draft;throw Error("No local draft available")}},{key:"localEditsOutOfDate",get:function(){return null!=this.localEdits&&this.localEdits.baseScoreVersion!=this.scoreVersion}},{key:"_localStorage",get:function(){return Vd.getLocalStorage()}},{key:"scoreOperationCount",get:function(){var t=0,e=!0,i=!1,n=void 0;try{for(var r,o=this.localEdits.edits[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){t+=r.value.operations.length}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return t}},{key:"_localEditsKey",get:function(){return"_nf_localEdits_".concat(this.scoreId)}}]),t}();r.registerClass(Ag,"com.noteflight.notation.editorio.IncrementalLocalSaveManager");var Ig=function(){function t(e,i,n,r){y(this,t),this.jsflightController=e,this.loadingScoreCalled=!1,this.loadingFromVersionHistory=!1,this.participantIds=[],this.messageStore=new ng,this.enabled=!i.hasOwnProperty("enabled")||i.enabled,this.remoteIsmEngaged=!!i.hasOwnProperty("remoteIsmEngaged")&&i.remoteIsmEngaged,this.initializePubSub(r,n),this.beginResendCountdown()}return p(t,null,[{key:"EDIT_PAYLOAD_LIMIT",get:function(){return 12e4}},{key:"RESEND_LOOP_TIME",get:function(){return 1e4}},{key:"DISPLAY_MODES",get:function(){return[Nl.PAGINATED_DISPLAY,Nl.FLOW_DISPLAY,Nl.STRIP_DISPLAY,Nl.PERFORM_DISPLAY]}}]),p(t,[{key:"loadingScore",value:function(t,e){this.loadingScoreCalled=!0,this.scoreId=t,this.scoreVersion=e?e.toString():null,this.jsflightController.incrementalLocalSaveManager.loadingScore(e)}},{key:"initializePubSub",value:function(t,e){var i=this;this.writeTopic=e.writeTopic,this.readTopic=e.readTopic,this.sessionId=e.sessionId,this.participantId=e.participantId,this.participantIds.push(e.participantId),this.messageStore.updateIds(e.sessionId,e.participantId),this.pubSubConnection="development"==NF.environment?new ag(t,this.readTopic,this.writeTopic):new sg(t,this.readTopic,this.writeTopic,e.lwTopic,e.lwPayload),this.pubSubConnection.addEventListener(og.CONNECTED,function(t){return i._onConnect(t)}),this.pubSubConnection.addEventListener(og.PUBLIC_MESSAGE_RECEIVED,function(t){return i._onPublicMessage(t)}),this.pubSubConnection.addEventListener(og.PRIVATE_MESSAGE_RECEIVED,function(t){return i._onPrivateMessage(t)}),this.editIdCounter=0}},{key:"beginResendCountdown",value:function(){var e=this;setTimeout(function(){e._resendUnconfirmedMessages()},t.RESEND_LOOP_TIME)}},{key:"scoreLoaded",value:function(t){var e=this;this.scoreEditListener=new lg(t),this.scoreEditApplicator=new xg(t),this.scoreEditListener.addEventListener(Cg.SCORE_EDIT,function(t){return e._onScoreEdit(t)}),this.scoreEditMessages=new yg(this.scoreEditApplicator,this.scoreEditListener),this.loadingFromVersionHistory?this.loadingFromVersionHistory=!1:this._receiveScoreEditMessages(),t.undoHistory.addEventListener(Zi.UNDO_GROUP_OPENED,function(t){return e._undoGroupOpened(t)}),t.undoHistory.addEventListener(Zi.UNDO_GROUP_NAME_CHANGED,function(t){return e._undoGroupNameChanged(t)}),t.undoHistory.addEventListener(Zi.UNDO_ABOUT_TO_UNDO,function(t){return e._undoGroupAboutToUndo(t)}),t.undoHistory.addEventListener(Zi.UNDO_ABOUT_TO_REDO,function(t){return e._undoGroupAboutToRedo(t)}),this.remoteIsmEngaged||this.scoreEditListener.removeEventListener(Cg.SCORE_EDIT)}},{key:"_receiveScoreEditMessages",value:function(){var e=NF.incrementalSaveSession.score_edits.map(function(t){return new dg(t)}),i=!1,n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;i||(t.DISPLAY_MODES.includes(l.scoreEditName)&&this.jsflightController.resizeToFit(l.scoreEditName),null==l.scoreEditSchema||"1.0"==l.scoreEditSchema?this.scoreEditMessages.receivePacket(l):(console.log('Warning - unable to apply ScoreEdit with outdated schema "'.concat(l.scoreEditSchema,'"')),i=!0))}}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}}},{key:"_onScoreEdit",value:function(t){this.enabled&&this.handleScoreEdit(t.scoreEdit),this.lastWriteAt=(new Date).getTime();var e=new Ng(t.scoreEdit,this.scoreEditApplicator);this.undoHistory.addEdit(e)}},{key:"handleScoreEdit",value:function(t){if(this._recordEdit(t),this.jsflightController._recordScoreEdits){var e=JSON.stringify(t.toJson());console.log('<action name="applyScoreEdit"><string><![CDATA['.concat(e,"]]></string></action>"))}}},{key:"scoreSaved",value:function(t){this.scoreVersion=t;var e=this.scoreEditListener.getCurrentSelectionJson(),i=[new wg(this.participantId,e,null)],n=new bg(t,i),r=new cg;r.name="Save Score",r.operations=[n],this._recordEdit(r)}},{key:"_onConnect",value:function(t){this._resendUnconfirmedMessages()}},{key:"chopItUp",value:function(t,e){for(var i=[],n=Math.ceil(t.length/e),r=0;r<n;r++)i.push(t.slice(r*e,(r+1)*e));return i}},{key:"validateEdits",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(-1===this.participantIds.indexOf(s.participantId))return!1}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}return!0}},{key:"_generateEditId",value:function(){var t=this.editIdCounter++;return"".concat(t,"-").concat(this.participantId)}},{key:"_recordEdit",value:function(t){if(this.enabled){var e=this._generateEditId(),i=new dg({scoreId:this.scoreId,sessionId:this.sessionId,participantId:this.participantId,editId:e});t.operations[0]instanceof bg&&(i.fullSave=!0),i.scoreEdit=t,this.scoreEditMessages.addLocalEdit(i),(this.remoteIsmEngaged||i.fullSave)&&this._sendUnsentEdits()}}},{key:"_sendUnsentEdits",value:function(){var e=this.scoreEditMessages.unsentMessages,i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)for(var a=o.value,l=a.scoreEdit,u=l.toJson(),h=JSON.stringify(u),c=$e.deflate(h,{to:"string"}),d=btoa(c),f=this.chopItUp(d,t.EDIT_PAYLOAD_LIMIT),y=0;y<f.length;y++){var g=f[y],p=a.clone();p.packetNumber=y,p.packetCount=f.length,p.packetData=g,p.scoreEditSchema=u.schema,p.readTopic=this.readTopic,p.writeTopic=this.writeTopic,p.scoreEditName=l.name;var m=p.toJson();this.messageStore.addMessage(m);var v=JSON.stringify(m);this.connected&&this.pubSubConnection.send(this.writeTopic,v)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.scoreEditMessages.clearUnsentMessages()}},{key:"_resendUnconfirmedMessages",value:function(){if(this.connected){var t=this.messageStore.unconfirmedMessages,e=!0,i=!1,n=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value,a=JSON.stringify(s);this.pubSubConnection.send(this.writeTopic,a)}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"_onPublicMessage",value:function(t){var e={};try{if(e=JSON.parse(t.message),this.messageStore.confirmMessage(e),this.jsflightController._simultaneousEditing&&(null==e.scoreEditSchema||"1.0"==e.scoreEditSchema)){var i=new dg(e);this.scoreEditMessages.receivePacket(i)}}catch(t){}var n=e.participantId;!this.jsflightController._simultaneousEditing&&n&&-1===this.participantIds.indexOf(n)&&(this.pubSubConnection.disconnect(),this.enabled=!1,NF.alert(Ou.getString("editor.pubsub.participantInvalidated")))}},{key:"_onPrivateMessage",value:function(t){var e={};try{e=JSON.parse(t.message)}catch(t){}e.alert&&(this.pubSubConnection.disconnect(),this.enabled=!1,NF.alert(Ou.getString("editor.pubsub.".concat(e.alert))))}},{key:"_undoGroupOpened",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit(e)}},{key:"_undoGroupNameChanged",value:function(t){var e=t.groupName;null!=e&&this._setEditName(e)}},{key:"_undoGroupAboutToUndo",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit("Undo ".concat(e))}},{key:"_undoGroupAboutToRedo",value:function(t){var e=t.groupName;null!=e&&this._startNewEdit("Redo ".concat(e))}},{key:"_startNewEdit",value:function(t){this.scoreEditListener.startNewEdit(t)}},{key:"_setEditName",value:function(t){this.scoreEditListener.setEditName(t)}},{key:"undoHistory",get:function(){return this.jsflightController.scoreDocument.undoHistory}},{key:"connected",get:function(){return this.pubSubConnection.connected}},{key:"hasLocalDraft",get:function(){return this.jsflightController.incrementalLocalSaveManager.localEdits.hasDraft}},{key:"localDraft",get:function(){return this.jsflightController.incrementalLocalSaveManager.localDraft}}]),t}();r.registerClass(Ig,"com.noteflight.notation.editorio.IncrementalSaveManager");var Pg=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(new Date).getTime(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;y(this,t),this.baseScoreVersion=e,this.createdAt=i,this.updatedAt=n,this.draft=r,this.edits=o,this.selection=s}return p(t,[{key:"addEdit",value:function(t){var e=t.toJson();this.edits.push(e),this._setUpdatedAt()}},{key:"clearEdits",value:function(){this.edits=[]}},{key:"setSelection",value:function(t){this.selection=t}},{key:"setDraft",value:function(t){this.draft=t,this._setUpdatedAt()}},{key:"_setUpdatedAt",value:function(){this.updatedAt=(new Date).getTime()}},{key:"toLocalStorageString",value:function(){var t={version:"1.1",baseScoreVersion:this.baseScoreVersion,createdAt:this.createdAt,updatedAt:this.updatedAt,draft:this.draft,edits:this.edits,selection:this.selection};return JSON.stringify(t)}},{key:"hasDraft",get:function(){return null!=this.draft}},{key:"hasEdits",get:function(){return this.edits.length>0}}],[{key:"fromLocalStorageString",value:function(e){if(!e)return null;var i;try{i=JSON.parse(e)}catch(t){if("SyntaxError"==t.name)return null}return i?"1.1"!=i.version?null:new t(i.baseScoreVersion,i.createdAt,i.updatedAt,i.draft,i.edits,i.selection):null}}]),t}();r.registerClass(Pg,"com.noteflight.notation.editorio.LocalEdits");var Og=i(80),Qg=function(){function t(){y(this,t)}return p(t,null,[{key:"uuid",value:function(){if(null!=Rg){var t="000000000000".concat(Rg++),e=t.substring(t.length-12);return"00000000-9000-9000-".concat(e)}return Og()}},{key:"mockUUIDSeed",get:function(){return Rg},set:function(t){Rg=t}}]),t}(),Rg=null;r.registerClass(Qg,"UUIDGenerator"),window.$$nf={},$$nf.classes=m,$$nf.aliasNativeClasses=function(){},$$nf.initializeClasses=function(){},$$nf.defineNativeFunctions=function(){},$$nf.clinitClasses=function(){},$$nf.operator_is=function(t,e){return $$nf.classes.com.noteflight.astoes6.Convert.is(t,e)}}()}).call(this,i(103).setImmediate)},324:function(t,e,i){"use strict";var n={8:{charCode:8},13:{charCode:13},16:{modifier:"shift"},17:{modifier:"control"},18:{modifier:"alt"},91:{modifier:"control"}},r={},o=null,s=null,a=function(t){return t.target==window||"body"==t.target.localName||"svg"==t.target.localName};$$nf.mediateKeyboard=function(t){var e=window;e.addEventListener("keydown",function(e){if(a(e)){var i=n[e.keyCode]||{};r.shift=e.shiftKey,r.control=e.ctrlKey||e.metaKey,i.modifier||(t(e,r,e.keyCode,i.charCode||e.charCode)?(e.preventDefault(),s=e):(o=e.keyCode,s=null))}}),e.addEventListener("keypress",function(e){a(e)&&(s&&e.timeStamp-s.timeStamp<100&&e.keyCode==s.keyCode?s=null:(t(e,r,e.keyCode,e.charCode)&&e.preventDefault(),o=null))}),e.addEventListener("keyup",function(e){if(a(e)){var i=n[e.keyCode]||{};i.modifier?delete r[i.modifier]:e.keyCode==o&&(t(e,r,e.keyCode,e.charCode)&&e.preventDefault(),o=null)}})}},325:function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r;!function(t){t.fn.jsnoteflight=function(i){return e[i]?e[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==n(i)&&i?void t.error("Method "+i+" does not exist on jQuery.jsnoteflight"):e.init.apply(this,arguments)};var e={init:function(e){e||(e={});!function(e){if(r)return;r=!0,$$nf.aliasNativeClasses(),$$nf.initializeClasses(),$$nf.defineNativeFunctions(),$$nf.clinitClasses();var i=e.instrumentPrefix;$$nf.synthesis={playbackSpeed:1,contextOptions:{loadAssetFunc:e.loadAssetFunc,instrumentBase:i,manifestLocation:e.loadAssetFunc("instruments/manifest.xml"),basicPerformance:e.basicPerformance,premium:!1}},$$nf.synthesis.context=new nfsyn.SynthesisContext($$nf.synthesis.contextOptions);var n=t('<div id="svgContext"></div>');t("body").append(n);var o=t('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="width:0px;height:0px;"></svg>');n.append(o);var s=$$nf.classes.SvgContext;s.singleton=new s(o,e.svgContextOptions),e.requireAudioElementHack&&t("body").append('<audio style="width:0px;height:0px;"></audio>')}(e);var i=new(0,$$nf.classes.com.noteflight.notation.controller.jsflight.JsflightController)(t,this,$$nf.synthesis,$$nf.mediateKeyboard,e);return this.data("jsnoteflight",i),i.initialize(),this.trigger("noteflight.editorReady"),this},detectScoreType:function(t){return this.data("jsnoteflight").detectScoreType(t)},loadScore:function(t,e,i){return e=e||{},this.data("jsnoteflight").loadScore(t,e,i)},saveScore:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.data("jsnoteflight").saveScore(t)},getMusicXML:function(){return this.data("jsnoteflight").getMusicXML()},exportToMidi:function(t){t=t||{};var e=this.data("jsnoteflight").exportToMidi(t);if(e)return new Uint8Array(e._buffer,0,e._length);return null},getPlaybackMeasures:function(){return this.data("jsnoteflight").getPlaybackMeasures()},getStandingWaveJson:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.data("jsnoteflight");return JSON.stringify(e.getStandingWaveJson(t))},validateNow:function(){return this.data("jsnoteflight").scoreDocument.validateNow(),this},scoreController:function(){return this.data("jsnoteflight").scoreController},documentController:function(){return this.data("jsnoteflight").scoreDocumentController},resizeToFit:function(t,e){var i=this.data("jsnoteflight");if(i)return i.resizeToFit(t,e)},ensureSelectionVisible:function(){return this.data("jsnoteflight").ensureSelectionVisible(),this},setPremiumInstruments:function(t){$$nf.synthesis.context.setPremiumInstruments&&$$nf.synthesis.context.setPremiumInstruments(t)},setPlaybackSpeed:function(t){$$nf.synthesis.playbackSpeed=t},scrollToPreviousPage:function(){this.data("jsnoteflight").scrollToPreviousPage()},scrollToNextPage:function(){this.data("jsnoteflight").scrollToNextPage()},centerCurrentPage:function(){this.data("jsnoteflight").centerCurrentPage()},getDisplayListStats:function(){return this.data("jsnoteflight").displayListStats},getFitMode:function(){return this.data("jsnoteflight").options.fit},setFitMode:function(t){this.data("jsnoteflight").options.fit=t},invokeApiMethod:function(t,e){return this.data("jsnoteflight").invokeApiMethod(t,e)},togglePerformanceBenchmarking:function(t){this.data("jsnoteflight").togglePerformanceBenchmarking(t)},togglePerfBenchSimpleOutput:function(t){this.data("jsnoteflight").togglePerfBenchSimpleOutput(t)},togglePerfBenchSilentMode:function(t){this.data("jsnoteflight").togglePerfBenchSilentMode(t)},setPerfBenchClassWhitelist:function(t){var e=this.data("jsnoteflight");if(t){var i=JSON.parse(t);e.setPerfBenchClassWhitelist(i)}},setPerfBenchMethodWhitelist:function(t){var e=this.data("jsnoteflight");if(t){var i=JSON.parse(t);e.setPerfBenchMethodWhitelist(i)}},setPerfBenchClassBlacklist:function(t){var e=this.data("jsnoteflight");if(t){var i=JSON.parse(t);e.setPerfBenchClassBlacklist(i)}},setPerfBenchMethodBlacklist:function(t){var e=this.data("jsnoteflight");if(t){var i=JSON.parse(t);e.setPerfBenchMethodBlacklist(i)}},printTimingStats:function(t){this.data("jsnoteflight").printTimingStats(t)},recordControllerActions:function(t){this.data("jsnoteflight").recordControllerActions(t)},recordScoreEdits:function(t){this.data("jsnoteflight").recordScoreEdits(t)},simultaneousEditing:function(t){this.data("jsnoteflight").simultaneousEditing(t)}};self.initializeController=function(){this.data("jsnoteflight").initialize()}}(jQuery)},55:function(t,e,i){t.exports=i(7)(654)},7:function(t,e){t.exports=clientLib},80:function(t,e,i){t.exports=i(7)(709)}});